<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html" class="current">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5352040">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5352096">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5352150">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5352201">//&nbsp;Package&nbsp;json&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;JSON&nbsp;objects&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5352280">//&nbsp;RFC&nbsp;4627.&nbsp;The&nbsp;mapping&nbsp;between&nbsp;JSON&nbsp;objects&nbsp;and&nbsp;Go&nbsp;values&nbsp;is&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="5352353">//&nbsp;in&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Marshal&nbsp;and&nbsp;Unmarshal&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5352418">//</span><br>
<span class="lineno"></span><span class="comment" id="5352421">//&nbsp;See&nbsp;&#34;JSON&nbsp;and&nbsp;Go&#34;&nbsp;for&nbsp;an&nbsp;introduction&nbsp;to&nbsp;this&nbsp;package:</span><br>
<span class="lineno">10</span><span class="comment" id="5352479">//&nbsp;http://golang.org/doc/articles/json_and_go.html</span><br>
<span class="lineno"></span><span class="keyword" id="5352530">package</span>&nbsp;<span class="ident" id="5352538">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5352544">import</span>&nbsp;<span class="op" id="5352551">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352554">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352563">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352575">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352594">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352602">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352613">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352624">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352632">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352643">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352654">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352662">&#34;unicode&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5352673">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5352688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5352691">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5352734">//</span><br>
<span class="lineno">30</span><span class="comment" id="5352737">//&nbsp;Marshal&nbsp;traverses&nbsp;the&nbsp;value&nbsp;v&nbsp;recursively.</span><br>
<span class="lineno"></span><span class="comment" id="5352783">//&nbsp;If&nbsp;an&nbsp;encountered&nbsp;value&nbsp;implements&nbsp;the&nbsp;Marshaler&nbsp;interface</span><br>
<span class="lineno"></span><span class="comment" id="5352845">//&nbsp;and&nbsp;is&nbsp;not&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;Marshal&nbsp;calls&nbsp;its&nbsp;MarshalJSON&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="5352911">//&nbsp;to&nbsp;produce&nbsp;JSON.&nbsp;&nbsp;The&nbsp;nil&nbsp;pointer&nbsp;exception&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary</span><br>
<span class="lineno"></span><span class="comment" id="5352984">//&nbsp;but&nbsp;mimics&nbsp;a&nbsp;similar,&nbsp;necessary&nbsp;exception&nbsp;in&nbsp;the&nbsp;behavior&nbsp;of</span><br>
<span class="lineno">35</span><span class="comment" id="5353048">//&nbsp;UnmarshalJSON.</span><br>
<span class="lineno"></span><span class="comment" id="5353066">//</span><br>
<span class="lineno"></span><span class="comment" id="5353069">//&nbsp;Otherwise,&nbsp;Marshal&nbsp;uses&nbsp;the&nbsp;following&nbsp;type-dependent&nbsp;default&nbsp;encodings:</span><br>
<span class="lineno"></span><span class="comment" id="5353144">//</span><br>
<span class="lineno"></span><span class="comment" id="5353147">//&nbsp;Boolean&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;booleans.</span><br>
<span class="lineno">40</span><span class="comment" id="5353190">//</span><br>
<span class="lineno"></span><span class="comment" id="5353193">//&nbsp;Floating&nbsp;point,&nbsp;integer,&nbsp;and&nbsp;Number&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="5353263">//</span><br>
<span class="lineno"></span><span class="comment" id="5353266">//&nbsp;String&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;strings&nbsp;coerced&nbsp;to&nbsp;valid&nbsp;UTF-8,</span><br>
<span class="lineno"></span><span class="comment" id="5353330">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="5353392">//&nbsp;The&nbsp;angle&nbsp;brackets&nbsp;&#34;&lt;&#34;&nbsp;and&nbsp;&#34;&gt;&#34;&nbsp;are&nbsp;escaped&nbsp;to&nbsp;&#34;\u003c&#34;&nbsp;and&nbsp;&#34;\u003e&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5353463">//&nbsp;to&nbsp;keep&nbsp;some&nbsp;browsers&nbsp;from&nbsp;misinterpreting&nbsp;JSON&nbsp;output&nbsp;as&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5353530">//&nbsp;Ampersand&nbsp;&#34;&amp;&#34;&nbsp;is&nbsp;also&nbsp;escaped&nbsp;to&nbsp;&#34;\u0026&#34;&nbsp;for&nbsp;the&nbsp;same&nbsp;reason.</span><br>
<span class="lineno"></span><span class="comment" id="5353596">//</span><br>
<span class="lineno"></span><span class="comment" id="5353599">//&nbsp;Array&nbsp;and&nbsp;slice&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;arrays,&nbsp;except&nbsp;that</span><br>
<span class="lineno">50</span><span class="comment" id="5353660">//&nbsp;[]byte&nbsp;encodes&nbsp;as&nbsp;a&nbsp;base64-encoded&nbsp;string,&nbsp;and&nbsp;a&nbsp;nil&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5353722">//&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5353758">//</span><br>
<span class="lineno"></span><span class="comment" id="5353761">//&nbsp;Struct&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.&nbsp;Each&nbsp;exported&nbsp;struct&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5353829">//&nbsp;becomes&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;object&nbsp;unless</span><br>
<span class="lineno">55</span><span class="comment" id="5353870">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&#39;s&nbsp;tag&nbsp;is&nbsp;&#34;-&#34;,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5353904">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&nbsp;is&nbsp;empty&nbsp;and&nbsp;its&nbsp;tag&nbsp;specifies&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option.</span><br>
<span class="lineno"></span><span class="comment" id="5353976">//&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5354014">//&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or&nbsp;string&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5354089">//&nbsp;length&nbsp;zero.&nbsp;The&nbsp;object&#39;s&nbsp;default&nbsp;key&nbsp;string&nbsp;is&nbsp;the&nbsp;struct&nbsp;field&nbsp;name</span><br>
<span class="lineno">60</span><span class="comment" id="5354162">//&nbsp;but&nbsp;can&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value.&nbsp;The&nbsp;&#34;json&#34;&nbsp;key&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5354237">//&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value&nbsp;is&nbsp;the&nbsp;key&nbsp;name,&nbsp;followed&nbsp;by&nbsp;an&nbsp;optional&nbsp;comma</span><br>
<span class="lineno"></span><span class="comment" id="5354316">//&nbsp;and&nbsp;options.&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="5354342">//</span><br>
<span class="lineno"></span><span class="comment" id="5354345">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;this&nbsp;package.</span><br>
<span class="lineno">65</span><span class="comment" id="5354387">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="5354413">//</span><br>
<span class="lineno"></span><span class="comment" id="5354416">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5354463">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="5354494">//</span><br>
<span class="lineno">70</span><span class="comment" id="5354497">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5354547">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;omitted&nbsp;from&nbsp;the&nbsp;object&nbsp;if&nbsp;its&nbsp;value&nbsp;is&nbsp;empty,</span><br>
<span class="lineno"></span><span class="comment" id="5354615">//&nbsp;&nbsp;&nbsp;//&nbsp;as&nbsp;defined&nbsp;above.</span><br>
<span class="lineno"></span><span class="comment" id="5354641">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="5354682">//</span><br>
<span class="lineno">75</span><span class="comment" id="5354685">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;Field&#34;&nbsp;(the&nbsp;default),&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5354749">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;skipped&nbsp;if&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="5354788">//&nbsp;&nbsp;&nbsp;//&nbsp;Note&nbsp;the&nbsp;leading&nbsp;comma.</span><br>
<span class="lineno"></span><span class="comment" id="5354820">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="5354855">//</span><br>
<span class="lineno">80</span><span class="comment" id="5354858">//&nbsp;The&nbsp;&#34;string&#34;&nbsp;option&nbsp;signals&nbsp;that&nbsp;a&nbsp;field&nbsp;is&nbsp;stored&nbsp;as&nbsp;JSON&nbsp;inside&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5354929">//&nbsp;JSON-encoded&nbsp;string.&nbsp;It&nbsp;applies&nbsp;only&nbsp;to&nbsp;fields&nbsp;of&nbsp;string,&nbsp;floating&nbsp;point,</span><br>
<span class="lineno"></span><span class="comment" id="5355006">//&nbsp;or&nbsp;integer&nbsp;types.&nbsp;This&nbsp;extra&nbsp;level&nbsp;of&nbsp;encoding&nbsp;is&nbsp;sometimes&nbsp;used&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5355079">//&nbsp;communicating&nbsp;with&nbsp;JavaScript&nbsp;programs:</span><br>
<span class="lineno"></span><span class="comment" id="5355122">//</span><br>
<span class="lineno">85</span><span class="comment" id="5355125">//&nbsp;&nbsp;&nbsp;&nbsp;Int64String&nbsp;int64&nbsp;`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="5355166">//</span><br>
<span class="lineno"></span><span class="comment" id="5355169">//&nbsp;The&nbsp;key&nbsp;name&nbsp;will&nbsp;be&nbsp;used&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;non-empty&nbsp;string&nbsp;consisting&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5355239">//&nbsp;only&nbsp;Unicode&nbsp;letters,&nbsp;digits,&nbsp;dollar&nbsp;signs,&nbsp;percent&nbsp;signs,&nbsp;hyphens,</span><br>
<span class="lineno"></span><span class="comment" id="5355310">//&nbsp;underscores&nbsp;and&nbsp;slashes.</span><br>
<span class="lineno">90</span><span class="comment" id="5355338">//</span><br>
<span class="lineno"></span><span class="comment" id="5355341">//&nbsp;Anonymous&nbsp;struct&nbsp;fields&nbsp;are&nbsp;usually&nbsp;marshaled&nbsp;as&nbsp;if&nbsp;their&nbsp;inner&nbsp;exported&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="5355424">//&nbsp;were&nbsp;fields&nbsp;in&nbsp;the&nbsp;outer&nbsp;struct,&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;amended</span><br>
<span class="lineno"></span><span class="comment" id="5355509">//&nbsp;as&nbsp;described&nbsp;in&nbsp;the&nbsp;next&nbsp;paragraph.</span><br>
<span class="lineno"></span><span class="comment" id="5355548">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;given&nbsp;in&nbsp;its&nbsp;JSON&nbsp;tag&nbsp;is&nbsp;treated&nbsp;as</span><br>
<span class="lineno">95</span><span class="comment" id="5355625">//&nbsp;having&nbsp;that&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="5355675">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;of&nbsp;interface&nbsp;type&nbsp;is&nbsp;treated&nbsp;the&nbsp;same&nbsp;as&nbsp;having</span><br>
<span class="lineno"></span><span class="comment" id="5355752">//&nbsp;that&nbsp;type&nbsp;as&nbsp;its&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="5355807">//</span><br>
<span class="lineno"></span><span class="comment" id="5355810">//&nbsp;The&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;for&nbsp;struct&nbsp;fields&nbsp;are&nbsp;amended&nbsp;for&nbsp;JSON&nbsp;when</span><br>
<span class="lineno">100</span><span class="comment" id="5355881">//&nbsp;deciding&nbsp;which&nbsp;field&nbsp;to&nbsp;marshal&nbsp;or&nbsp;unmarshal.&nbsp;If&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5355943">//&nbsp;multiple&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level,&nbsp;and&nbsp;that&nbsp;level&nbsp;is&nbsp;the&nbsp;least</span><br>
<span class="lineno"></span><span class="comment" id="5356009">//&nbsp;nested&nbsp;(and&nbsp;would&nbsp;therefore&nbsp;be&nbsp;the&nbsp;nesting&nbsp;level&nbsp;selected&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5356077">//&nbsp;usual&nbsp;Go&nbsp;rules),&nbsp;the&nbsp;following&nbsp;extra&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="5356130">//</span><br>
<span class="lineno">105</span><span class="comment" id="5356133">//&nbsp;1)&nbsp;Of&nbsp;those&nbsp;fields,&nbsp;if&nbsp;any&nbsp;are&nbsp;JSON-tagged,&nbsp;only&nbsp;tagged&nbsp;fields&nbsp;are&nbsp;considered,</span><br>
<span class="lineno"></span><span class="comment" id="5356215">//&nbsp;even&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;untagged&nbsp;fields&nbsp;that&nbsp;would&nbsp;otherwise&nbsp;conflict.</span><br>
<span class="lineno"></span><span class="comment" id="5356292">//&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;exactly&nbsp;one&nbsp;field&nbsp;(tagged&nbsp;or&nbsp;not&nbsp;according&nbsp;to&nbsp;the&nbsp;first&nbsp;rule),&nbsp;that&nbsp;is&nbsp;selected.</span><br>
<span class="lineno"></span><span class="comment" id="5356391">//&nbsp;3)&nbsp;Otherwise&nbsp;there&nbsp;are&nbsp;multiple&nbsp;fields,&nbsp;and&nbsp;all&nbsp;are&nbsp;ignored;&nbsp;no&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment" id="5356472">//</span><br>
<span class="lineno">110</span><span class="comment" id="5356475">//&nbsp;Handling&nbsp;of&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;is&nbsp;new&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span><span class="comment" id="5356532">//&nbsp;Prior&nbsp;to&nbsp;Go&nbsp;1.1,&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;were&nbsp;ignored.&nbsp;To&nbsp;force&nbsp;ignoring&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5356611">//&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;in&nbsp;both&nbsp;current&nbsp;and&nbsp;earlier&nbsp;versions,&nbsp;give&nbsp;the&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5356693">//&nbsp;a&nbsp;JSON&nbsp;tag&nbsp;of&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5356715">//</span><br>
<span class="lineno">115</span><span class="comment" id="5356718">//&nbsp;Map&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.</span><br>
<span class="lineno"></span><span class="comment" id="5356756">//&nbsp;The&nbsp;map&#39;s&nbsp;key&nbsp;type&nbsp;must&nbsp;be&nbsp;string;&nbsp;the&nbsp;object&nbsp;keys&nbsp;are&nbsp;used&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="5356828">//&nbsp;as&nbsp;map&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="5356844">//</span><br>
<span class="lineno"></span><span class="comment" id="5356847">//&nbsp;Pointer&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to.</span><br>
<span class="lineno">120</span><span class="comment" id="5356897">//&nbsp;A&nbsp;nil&nbsp;pointer&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5356947">//</span><br>
<span class="lineno"></span><span class="comment" id="5356950">//&nbsp;Interface&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;contained&nbsp;in&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5357018">//&nbsp;A&nbsp;nil&nbsp;interface&nbsp;value&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5357076">//</span><br>
<span class="lineno">125</span><span class="comment" id="5357079">//&nbsp;Channel,&nbsp;complex,&nbsp;and&nbsp;function&nbsp;values&nbsp;cannot&nbsp;be&nbsp;encoded&nbsp;in&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="comment" id="5357147">//&nbsp;Attempting&nbsp;to&nbsp;encode&nbsp;such&nbsp;a&nbsp;value&nbsp;causes&nbsp;Marshal&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5357209">//&nbsp;an&nbsp;UnsupportedTypeError.</span><br>
<span class="lineno"></span><span class="comment" id="5357237">//</span><br>
<span class="lineno"></span><span class="comment" id="5357240">//&nbsp;JSON&nbsp;cannot&nbsp;represent&nbsp;cyclic&nbsp;data&nbsp;structures&nbsp;and&nbsp;Marshal&nbsp;does&nbsp;not</span><br>
<span class="lineno">130</span><span class="comment" id="5357309">//&nbsp;handle&nbsp;them.&nbsp;&nbsp;Passing&nbsp;cyclic&nbsp;structures&nbsp;to&nbsp;Marshal&nbsp;will&nbsp;result&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5357378">//&nbsp;an&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span><span class="comment" id="5357404">//</span><br>
<span class="lineno"></span><span class="keyword" id="5357407">func</span>&nbsp;<span class="ident" id="5357412">Marshal</span><span class="op" id="5357419">(</span><span class="ident" id="5357420">v</span>&nbsp;<span class="keyword" id="5357422">interface</span><span class="op" id="5357431">{</span><span class="op" id="5357432">}</span><span class="op" id="5357433">)</span>&nbsp;<span class="op" id="5357435">(</span><span class="op" id="5357436">[</span><span class="op" id="5357437">]</span><span class="builtintype" id="5357438">byte</span><span class="op" id="5357442">,</span>&nbsp;<span class="builtintype" id="5357444">error</span><span class="op" id="5357449">)</span>&nbsp;<span class="op" id="5357451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357454">e</span>&nbsp;<span class="op" id="5357456">:=</span>&nbsp;<span class="op" id="5357459">&amp;</span><span class="ident" id="5357460">encodeState</span><span class="op" id="5357471">{</span><span class="op" id="5357472">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357475">err</span>&nbsp;<span class="op" id="5357479">:=</span>&nbsp;<span class="ident" id="5357482">e</span><span class="op" id="5357483">.</span><span class="ident" id="5357484">marshal</span><span class="op" id="5357491">(</span><span class="ident" id="5357492">v</span><span class="op" id="5357493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357496">if</span>&nbsp;<span class="ident" id="5357499">err</span>&nbsp;<span class="op" id="5357503">!=</span>&nbsp;<span class="builtintype" id="5357506">nil</span>&nbsp;<span class="op" id="5357510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357514">return</span>&nbsp;<span class="builtintype" id="5357521">nil</span><span class="op" id="5357524">,</span>&nbsp;<span class="ident" id="5357526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357534">return</span>&nbsp;<span class="ident" id="5357541">e</span><span class="op" id="5357542">.</span><span class="ident" id="5357543">Bytes</span><span class="op" id="5357548">(</span><span class="op" id="5357549">)</span><span class="op" id="5357550">,</span>&nbsp;<span class="builtintype" id="5357552">nil</span><br>
<span class="lineno">140</span><span class="op" id="5357556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5357559">//&nbsp;MarshalIndent&nbsp;is&nbsp;like&nbsp;Marshal&nbsp;but&nbsp;applies&nbsp;Indent&nbsp;to&nbsp;format&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5357633">func</span>&nbsp;<span class="ident" id="5357638">MarshalIndent</span><span class="op" id="5357651">(</span><span class="ident" id="5357652">v</span>&nbsp;<span class="keyword" id="5357654">interface</span><span class="op" id="5357663">{</span><span class="op" id="5357664">}</span><span class="op" id="5357665">,</span>&nbsp;<span class="ident" id="5357667">prefix</span><span class="op" id="5357673">,</span>&nbsp;<span class="ident" id="5357675">indent</span>&nbsp;<span class="builtintype" id="5357682">string</span><span class="op" id="5357688">)</span>&nbsp;<span class="op" id="5357690">(</span><span class="op" id="5357691">[</span><span class="op" id="5357692">]</span><span class="builtintype" id="5357693">byte</span><span class="op" id="5357697">,</span>&nbsp;<span class="builtintype" id="5357699">error</span><span class="op" id="5357704">)</span>&nbsp;<span class="op" id="5357706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357709">b</span><span class="op" id="5357710">,</span>&nbsp;<span class="ident" id="5357712">err</span>&nbsp;<span class="op" id="5357716">:=</span>&nbsp;<span class="ident" id="5357719">Marshal</span><span class="op" id="5357726">(</span><span class="ident" id="5357727">v</span><span class="op" id="5357728">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357731">if</span>&nbsp;<span class="ident" id="5357734">err</span>&nbsp;<span class="op" id="5357738">!=</span>&nbsp;<span class="builtintype" id="5357741">nil</span>&nbsp;<span class="op" id="5357745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357749">return</span>&nbsp;<span class="builtintype" id="5357756">nil</span><span class="op" id="5357759">,</span>&nbsp;<span class="ident" id="5357761">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357769">var</span>&nbsp;<span class="ident" id="5357773">buf</span>&nbsp;<span class="ident" id="5357777">bytes</span><span class="op" id="5357782">.</span><span class="ident" id="5357783">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357791">err</span>&nbsp;<span class="op" id="5357795">=</span>&nbsp;<span class="ident" id="5357797">Indent</span><span class="op" id="5357803">(</span><span class="op" id="5357804">&amp;</span><span class="ident" id="5357805">buf</span><span class="op" id="5357808">,</span>&nbsp;<span class="ident" id="5357810">b</span><span class="op" id="5357811">,</span>&nbsp;<span class="ident" id="5357813">prefix</span><span class="op" id="5357819">,</span>&nbsp;<span class="ident" id="5357821">indent</span><span class="op" id="5357827">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357830">if</span>&nbsp;<span class="ident" id="5357833">err</span>&nbsp;<span class="op" id="5357837">!=</span>&nbsp;<span class="builtintype" id="5357840">nil</span>&nbsp;<span class="op" id="5357844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357848">return</span>&nbsp;<span class="builtintype" id="5357855">nil</span><span class="op" id="5357858">,</span>&nbsp;<span class="ident" id="5357860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357868">return</span>&nbsp;<span class="ident" id="5357875">buf</span><span class="op" id="5357878">.</span><span class="ident" id="5357879">Bytes</span><span class="op" id="5357884">(</span><span class="op" id="5357885">)</span><span class="op" id="5357886">,</span>&nbsp;<span class="builtintype" id="5357888">nil</span><br>
<span class="lineno"></span><span class="op" id="5357892">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="5357895">//&nbsp;HTMLEscape&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;U+2028&nbsp;and&nbsp;U+2029</span><br>
<span class="lineno"></span><span class="comment" id="5357977">//&nbsp;characters&nbsp;inside&nbsp;string&nbsp;literals&nbsp;changed&nbsp;to&nbsp;\u003c,&nbsp;\u003e,&nbsp;\u0026,&nbsp;\u2028,&nbsp;\u2029</span><br>
<span class="lineno"></span><span class="comment" id="5358064">//&nbsp;so&nbsp;that&nbsp;the&nbsp;JSON&nbsp;will&nbsp;be&nbsp;safe&nbsp;to&nbsp;embed&nbsp;inside&nbsp;HTML&nbsp;&lt;script&gt;&nbsp;tags.</span><br>
<span class="lineno"></span><span class="comment" id="5358133">//&nbsp;For&nbsp;historical&nbsp;reasons,&nbsp;web&nbsp;browsers&nbsp;don&#39;t&nbsp;honor&nbsp;standard&nbsp;HTML</span><br>
<span class="lineno">160</span><span class="comment" id="5358199">//&nbsp;escaping&nbsp;within&nbsp;&lt;script&gt;&nbsp;tags,&nbsp;so&nbsp;an&nbsp;alternative&nbsp;JSON&nbsp;encoding&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5358270">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="5358282">func</span>&nbsp;<span class="ident" id="5358287">HTMLEscape</span><span class="op" id="5358297">(</span><span class="ident" id="5358298">dst</span>&nbsp;<span class="op" id="5358302">*</span><span class="ident" id="5358303">bytes</span><span class="op" id="5358308">.</span><span class="ident" id="5358309">Buffer</span><span class="op" id="5358315">,</span>&nbsp;<span class="ident" id="5358317">src</span>&nbsp;<span class="op" id="5358321">[</span><span class="op" id="5358322">]</span><span class="builtintype" id="5358323">byte</span><span class="op" id="5358327">)</span>&nbsp;<span class="op" id="5358329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358332">//&nbsp;The&nbsp;characters&nbsp;can&nbsp;only&nbsp;appear&nbsp;in&nbsp;string&nbsp;literals,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358387">//&nbsp;so&nbsp;just&nbsp;scan&nbsp;the&nbsp;string&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358435">start</span>&nbsp;<span class="op" id="5358441">:=</span>&nbsp;<span class="num" id="5358444">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358447">for</span>&nbsp;<span class="ident" id="5358451">i</span><span class="op" id="5358452">,</span>&nbsp;<span class="ident" id="5358454">c</span>&nbsp;<span class="op" id="5358456">:=</span>&nbsp;<span class="keyword" id="5358459">range</span>&nbsp;<span class="ident" id="5358465">src</span>&nbsp;<span class="op" id="5358469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358473">if</span>&nbsp;<span class="ident" id="5358476">c</span>&nbsp;<span class="op" id="5358478">==</span>&nbsp;<span class="string" id="5358481">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5358485">||</span>&nbsp;<span class="ident" id="5358488">c</span>&nbsp;<span class="op" id="5358490">==</span>&nbsp;<span class="string" id="5358493">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5358497">||</span>&nbsp;<span class="ident" id="5358500">c</span>&nbsp;<span class="op" id="5358502">==</span>&nbsp;<span class="string" id="5358505">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5358509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358514">if</span>&nbsp;<span class="ident" id="5358517">start</span>&nbsp;<span class="op" id="5358523">&lt;</span>&nbsp;<span class="ident" id="5358525">i</span>&nbsp;<span class="op" id="5358527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358533">dst</span><span class="op" id="5358536">.</span><span class="ident" id="5358537">Write</span><span class="op" id="5358542">(</span><span class="ident" id="5358543">src</span><span class="op" id="5358546">[</span><span class="ident" id="5358547">start</span><span class="op" id="5358552">:</span><span class="ident" id="5358553">i</span><span class="op" id="5358554">]</span><span class="op" id="5358555">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358565">dst</span><span class="op" id="5358568">.</span><span class="ident" id="5358569">WriteString</span><span class="op" id="5358580">(</span><span class="string" id="5358581">`\u00`</span><span class="op" id="5358587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358592">dst</span><span class="op" id="5358595">.</span><span class="ident" id="5358596">WriteByte</span><span class="op" id="5358605">(</span><span class="ident" id="5358606">hex</span><span class="op" id="5358609">[</span><span class="ident" id="5358610">c</span><span class="op" id="5358611">&gt;&gt;</span><span class="num" id="5358613">4</span><span class="op" id="5358614">]</span><span class="op" id="5358615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358620">dst</span><span class="op" id="5358623">.</span><span class="ident" id="5358624">WriteByte</span><span class="op" id="5358633">(</span><span class="ident" id="5358634">hex</span><span class="op" id="5358637">[</span><span class="ident" id="5358638">c</span><span class="op" id="5358639">&amp;</span><span class="num" id="5358640">0xF</span><span class="op" id="5358643">]</span><span class="op" id="5358644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358649">start</span>&nbsp;<span class="op" id="5358655">=</span>&nbsp;<span class="ident" id="5358657">i</span>&nbsp;<span class="op" id="5358659">+</span>&nbsp;<span class="num" id="5358661">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358669">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358725">if</span>&nbsp;<span class="ident" id="5358728">c</span>&nbsp;<span class="op" id="5358730">==</span>&nbsp;<span class="num" id="5358733">0xE2</span>&nbsp;<span class="op" id="5358738">&amp;&amp;</span>&nbsp;<span class="ident" id="5358741">i</span><span class="op" id="5358742">+</span><span class="num" id="5358743">2</span>&nbsp;<span class="op" id="5358745">&lt;</span>&nbsp;<span class="builtinfunc" id="5358747">len</span><span class="op" id="5358750">(</span><span class="ident" id="5358751">src</span><span class="op" id="5358754">)</span>&nbsp;<span class="op" id="5358756">&amp;&amp;</span>&nbsp;<span class="ident" id="5358759">src</span><span class="op" id="5358762">[</span><span class="ident" id="5358763">i</span><span class="op" id="5358764">+</span><span class="num" id="5358765">1</span><span class="op" id="5358766">]</span>&nbsp;<span class="op" id="5358768">==</span>&nbsp;<span class="num" id="5358771">0x80</span>&nbsp;<span class="op" id="5358776">&amp;&amp;</span>&nbsp;<span class="ident" id="5358779">src</span><span class="op" id="5358782">[</span><span class="ident" id="5358783">i</span><span class="op" id="5358784">+</span><span class="num" id="5358785">2</span><span class="op" id="5358786">]</span><span class="op" id="5358787">&amp;^</span><span class="num" id="5358789">1</span>&nbsp;<span class="op" id="5358791">==</span>&nbsp;<span class="num" id="5358794">0xA8</span>&nbsp;<span class="op" id="5358799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358804">if</span>&nbsp;<span class="ident" id="5358807">start</span>&nbsp;<span class="op" id="5358813">&lt;</span>&nbsp;<span class="ident" id="5358815">i</span>&nbsp;<span class="op" id="5358817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358823">dst</span><span class="op" id="5358826">.</span><span class="ident" id="5358827">Write</span><span class="op" id="5358832">(</span><span class="ident" id="5358833">src</span><span class="op" id="5358836">[</span><span class="ident" id="5358837">start</span><span class="op" id="5358842">:</span><span class="ident" id="5358843">i</span><span class="op" id="5358844">]</span><span class="op" id="5358845">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358855">dst</span><span class="op" id="5358858">.</span><span class="ident" id="5358859">WriteString</span><span class="op" id="5358870">(</span><span class="string" id="5358871">`\u202`</span><span class="op" id="5358878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358883">dst</span><span class="op" id="5358886">.</span><span class="ident" id="5358887">WriteByte</span><span class="op" id="5358896">(</span><span class="ident" id="5358897">hex</span><span class="op" id="5358900">[</span><span class="ident" id="5358901">src</span><span class="op" id="5358904">[</span><span class="ident" id="5358905">i</span><span class="op" id="5358906">+</span><span class="num" id="5358907">2</span><span class="op" id="5358908">]</span><span class="op" id="5358909">&amp;</span><span class="num" id="5358910">0xF</span><span class="op" id="5358913">]</span><span class="op" id="5358914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358919">start</span>&nbsp;<span class="op" id="5358925">=</span>&nbsp;<span class="ident" id="5358927">i</span>&nbsp;<span class="op" id="5358929">+</span>&nbsp;<span class="num" id="5358931">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358935">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358941">if</span>&nbsp;<span class="ident" id="5358944">start</span>&nbsp;<span class="op" id="5358950">&lt;</span>&nbsp;<span class="builtinfunc" id="5358952">len</span><span class="op" id="5358955">(</span><span class="ident" id="5358956">src</span><span class="op" id="5358959">)</span>&nbsp;<span class="op" id="5358961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358965">dst</span><span class="op" id="5358968">.</span><span class="ident" id="5358969">Write</span><span class="op" id="5358974">(</span><span class="ident" id="5358975">src</span><span class="op" id="5358978">[</span><span class="ident" id="5358979">start</span><span class="op" id="5358984">:</span><span class="op" id="5358985">]</span><span class="op" id="5358986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358989">}</span><br>
<span class="lineno"></span><span class="op" id="5358991">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="5358994">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5359052">//&nbsp;can&nbsp;marshal&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="5359095">type</span>&nbsp;<span class="ident" id="5359100">Marshaler</span>&nbsp;<span class="keyword" id="5359110">interface</span>&nbsp;<span class="op" id="5359120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359123">MarshalJSON</span><span class="op" id="5359134">(</span><span class="op" id="5359135">)</span>&nbsp;<span class="op" id="5359137">(</span><span class="op" id="5359138">[</span><span class="op" id="5359139">]</span><span class="builtintype" id="5359140">byte</span><span class="op" id="5359144">,</span>&nbsp;<span class="builtintype" id="5359146">error</span><span class="op" id="5359151">)</span><br>
<span class="lineno">195</span><span class="op" id="5359153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5359156">//&nbsp;An&nbsp;UnsupportedTypeError&nbsp;is&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when&nbsp;attempting</span><br>
<span class="lineno"></span><span class="comment" id="5359222">//&nbsp;to&nbsp;encode&nbsp;an&nbsp;unsupported&nbsp;value&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5359262">type</span>&nbsp;<span class="ident" id="5359267">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="5359288">struct</span>&nbsp;<span class="op" id="5359295">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359298">Type</span>&nbsp;<span class="ident" id="5359303">reflect</span><span class="op" id="5359310">.</span><span class="ident" id="5359311">Type</span><br>
<span class="lineno"></span><span class="op" id="5359316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5359319">func</span>&nbsp;<span class="op" id="5359324">(</span><span class="ident" id="5359325">e</span>&nbsp;<span class="op" id="5359327">*</span><span class="ident" id="5359328">UnsupportedTypeError</span><span class="op" id="5359348">)</span>&nbsp;<span class="ident" id="5359350">Error</span><span class="op" id="5359355">(</span><span class="op" id="5359356">)</span>&nbsp;<span class="builtintype" id="5359358">string</span>&nbsp;<span class="op" id="5359365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359368">return</span>&nbsp;<span class="string" id="5359375">&#34;json:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5359402">+</span>&nbsp;<span class="ident" id="5359404">e</span><span class="op" id="5359405">.</span><span class="ident" id="5359406">Type</span><span class="op" id="5359410">.</span><span class="ident" id="5359411">String</span><span class="op" id="5359417">(</span><span class="op" id="5359418">)</span><br>
<span class="lineno">205</span><span class="op" id="5359420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5359423">type</span>&nbsp;<span class="ident" id="5359428">UnsupportedValueError</span>&nbsp;<span class="keyword" id="5359450">struct</span>&nbsp;<span class="op" id="5359457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359460">Value</span>&nbsp;<span class="ident" id="5359466">reflect</span><span class="op" id="5359473">.</span><span class="ident" id="5359474">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359481">Str</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5359487">string</span><br>
<span class="lineno">210</span><span class="op" id="5359494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5359497">func</span>&nbsp;<span class="op" id="5359502">(</span><span class="ident" id="5359503">e</span>&nbsp;<span class="op" id="5359505">*</span><span class="ident" id="5359506">UnsupportedValueError</span><span class="op" id="5359527">)</span>&nbsp;<span class="ident" id="5359529">Error</span><span class="op" id="5359534">(</span><span class="op" id="5359535">)</span>&nbsp;<span class="builtintype" id="5359537">string</span>&nbsp;<span class="op" id="5359544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359547">return</span>&nbsp;<span class="string" id="5359554">&#34;json:&nbsp;unsupported&nbsp;value:&nbsp;&#34;</span>&nbsp;<span class="op" id="5359582">+</span>&nbsp;<span class="ident" id="5359584">e</span><span class="op" id="5359585">.</span><span class="ident" id="5359586">Str</span><br>
<span class="lineno"></span><span class="op" id="5359590">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="5359593">//&nbsp;Before&nbsp;Go&nbsp;1.2,&nbsp;an&nbsp;InvalidUTF8Error&nbsp;was&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5359660">//&nbsp;attempting&nbsp;to&nbsp;encode&nbsp;a&nbsp;string&nbsp;value&nbsp;with&nbsp;invalid&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="comment" id="5359729">//&nbsp;As&nbsp;of&nbsp;Go&nbsp;1.2,&nbsp;Marshal&nbsp;instead&nbsp;coerces&nbsp;the&nbsp;string&nbsp;to&nbsp;valid&nbsp;UTF-8&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5359799">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune&nbsp;U+FFFD.</span><br>
<span class="lineno">220</span><span class="comment" id="5359868">//&nbsp;This&nbsp;error&nbsp;is&nbsp;no&nbsp;longer&nbsp;generated&nbsp;but&nbsp;is&nbsp;kept&nbsp;for&nbsp;backwards&nbsp;compatibility</span><br>
<span class="lineno"></span><span class="comment" id="5359945">//&nbsp;with&nbsp;programs&nbsp;that&nbsp;might&nbsp;mention&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5359985">type</span>&nbsp;<span class="ident" id="5359990">InvalidUTF8Error</span>&nbsp;<span class="keyword" id="5360007">struct</span>&nbsp;<span class="op" id="5360014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360017">S</span>&nbsp;<span class="builtintype" id="5360019">string</span>&nbsp;<span class="comment" id="5360026">//&nbsp;the&nbsp;whole&nbsp;string&nbsp;value&nbsp;that&nbsp;caused&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5360074">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5360077">func</span>&nbsp;<span class="op" id="5360082">(</span><span class="ident" id="5360083">e</span>&nbsp;<span class="op" id="5360085">*</span><span class="ident" id="5360086">InvalidUTF8Error</span><span class="op" id="5360102">)</span>&nbsp;<span class="ident" id="5360104">Error</span><span class="op" id="5360109">(</span><span class="op" id="5360110">)</span>&nbsp;<span class="builtintype" id="5360112">string</span>&nbsp;<span class="op" id="5360119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360122">return</span>&nbsp;<span class="string" id="5360129">&#34;json:&nbsp;invalid&nbsp;UTF-8&nbsp;in&nbsp;string:&nbsp;&#34;</span>&nbsp;<span class="op" id="5360163">+</span>&nbsp;<span class="ident" id="5360165">strconv</span><span class="op" id="5360172">.</span><span class="ident" id="5360173">Quote</span><span class="op" id="5360178">(</span><span class="ident" id="5360179">e</span><span class="op" id="5360180">.</span><span class="ident" id="5360181">S</span><span class="op" id="5360182">)</span><br>
<span class="lineno"></span><span class="op" id="5360184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5360187">type</span>&nbsp;<span class="ident" id="5360192">MarshalerError</span>&nbsp;<span class="keyword" id="5360207">struct</span>&nbsp;<span class="op" id="5360214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360217">Type</span>&nbsp;<span class="ident" id="5360222">reflect</span><span class="op" id="5360229">.</span><span class="ident" id="5360230">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360236">Err</span>&nbsp;&nbsp;<span class="builtintype" id="5360241">error</span><br>
<span class="lineno"></span><span class="op" id="5360247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5360250">func</span>&nbsp;<span class="op" id="5360255">(</span><span class="ident" id="5360256">e</span>&nbsp;<span class="op" id="5360258">*</span><span class="ident" id="5360259">MarshalerError</span><span class="op" id="5360273">)</span>&nbsp;<span class="ident" id="5360275">Error</span><span class="op" id="5360280">(</span><span class="op" id="5360281">)</span>&nbsp;<span class="builtintype" id="5360283">string</span>&nbsp;<span class="op" id="5360290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360293">return</span>&nbsp;<span class="string" id="5360300">&#34;json:&nbsp;error&nbsp;calling&nbsp;MarshalJSON&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5360344">+</span>&nbsp;<span class="ident" id="5360346">e</span><span class="op" id="5360347">.</span><span class="ident" id="5360348">Type</span><span class="op" id="5360352">.</span><span class="ident" id="5360353">String</span><span class="op" id="5360359">(</span><span class="op" id="5360360">)</span>&nbsp;<span class="op" id="5360362">+</span>&nbsp;<span class="string" id="5360364">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="5360369">+</span>&nbsp;<span class="ident" id="5360371">e</span><span class="op" id="5360372">.</span><span class="ident" id="5360373">Err</span><span class="op" id="5360376">.</span><span class="ident" id="5360377">Error</span><span class="op" id="5360382">(</span><span class="op" id="5360383">)</span><br>
<span class="lineno"></span><span class="op" id="5360385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5360388">var</span>&nbsp;<span class="ident" id="5360392">hex</span>&nbsp;<span class="op" id="5360396">=</span>&nbsp;<span class="string" id="5360398">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="5360418">//&nbsp;An&nbsp;encodeState&nbsp;encodes&nbsp;JSON&nbsp;into&nbsp;a&nbsp;bytes.Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5360470">type</span>&nbsp;<span class="ident" id="5360475">encodeState</span>&nbsp;<span class="keyword" id="5360487">struct</span>&nbsp;<span class="op" id="5360494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360497">bytes</span><span class="op" id="5360502">.</span><span class="ident" id="5360503">Buffer</span>&nbsp;<span class="comment" id="5360510">//&nbsp;accumulated&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360533">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360546">[</span><span class="num" id="5360547">64</span><span class="op" id="5360549">]</span><span class="builtintype" id="5360550">byte</span><br>
<span class="lineno">245</span><span class="op" id="5360555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5360558">var</span>&nbsp;<span class="ident" id="5360562">encodeStatePool</span>&nbsp;<span class="ident" id="5360578">sync</span><span class="op" id="5360582">.</span><span class="ident" id="5360583">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5360589">func</span>&nbsp;<span class="ident" id="5360594">newEncodeState</span><span class="op" id="5360608">(</span><span class="op" id="5360609">)</span>&nbsp;<span class="op" id="5360611">*</span><span class="ident" id="5360612">encodeState</span>&nbsp;<span class="op" id="5360624">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360627">if</span>&nbsp;<span class="ident" id="5360630">v</span>&nbsp;<span class="op" id="5360632">:=</span>&nbsp;<span class="ident" id="5360635">encodeStatePool</span><span class="op" id="5360650">.</span><span class="ident" id="5360651">Get</span><span class="op" id="5360654">(</span><span class="op" id="5360655">)</span><span class="op" id="5360656">;</span>&nbsp;<span class="ident" id="5360658">v</span>&nbsp;<span class="op" id="5360660">!=</span>&nbsp;<span class="builtintype" id="5360663">nil</span>&nbsp;<span class="op" id="5360667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360671">e</span>&nbsp;<span class="op" id="5360673">:=</span>&nbsp;<span class="ident" id="5360676">v</span><span class="op" id="5360677">.</span><span class="op" id="5360678">(</span><span class="op" id="5360679">*</span><span class="ident" id="5360680">encodeState</span><span class="op" id="5360691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360695">e</span><span class="op" id="5360696">.</span><span class="ident" id="5360697">Reset</span><span class="op" id="5360702">(</span><span class="op" id="5360703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360707">return</span>&nbsp;<span class="ident" id="5360714">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360717">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360720">return</span>&nbsp;<span class="builtinfunc" id="5360727">new</span><span class="op" id="5360730">(</span><span class="ident" id="5360731">encodeState</span><span class="op" id="5360742">)</span><br>
<span class="lineno"></span><span class="op" id="5360744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5360747">func</span>&nbsp;<span class="op" id="5360752">(</span><span class="ident" id="5360753">e</span>&nbsp;<span class="op" id="5360755">*</span><span class="ident" id="5360756">encodeState</span><span class="op" id="5360767">)</span>&nbsp;<span class="ident" id="5360769">marshal</span><span class="op" id="5360776">(</span><span class="ident" id="5360777">v</span>&nbsp;<span class="keyword" id="5360779">interface</span><span class="op" id="5360788">{</span><span class="op" id="5360789">}</span><span class="op" id="5360790">)</span>&nbsp;<span class="op" id="5360792">(</span><span class="ident" id="5360793">err</span>&nbsp;<span class="builtintype" id="5360797">error</span><span class="op" id="5360802">)</span>&nbsp;<span class="op" id="5360804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360807">defer</span>&nbsp;<span class="keyword" id="5360813">func</span><span class="op" id="5360817">(</span><span class="op" id="5360818">)</span>&nbsp;<span class="op" id="5360820">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360824">if</span>&nbsp;<span class="ident" id="5360827">r</span>&nbsp;<span class="op" id="5360829">:=</span>&nbsp;<span class="builtinfunc" id="5360832">recover</span><span class="op" id="5360839">(</span><span class="op" id="5360840">)</span><span class="op" id="5360841">;</span>&nbsp;<span class="ident" id="5360843">r</span>&nbsp;<span class="op" id="5360845">!=</span>&nbsp;<span class="builtintype" id="5360848">nil</span>&nbsp;<span class="op" id="5360852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360857">if</span>&nbsp;<span class="ident" id="5360860">_</span><span class="op" id="5360861">,</span>&nbsp;<span class="ident" id="5360863">ok</span>&nbsp;<span class="op" id="5360866">:=</span>&nbsp;<span class="ident" id="5360869">r</span><span class="op" id="5360870">.</span><span class="op" id="5360871">(</span><span class="ident" id="5360872">runtime</span><span class="op" id="5360879">.</span><span class="ident" id="5360880">Error</span><span class="op" id="5360885">)</span><span class="op" id="5360886">;</span>&nbsp;<span class="ident" id="5360888">ok</span>&nbsp;<span class="op" id="5360891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5360897">panic</span><span class="op" id="5360902">(</span><span class="ident" id="5360903">r</span><span class="op" id="5360904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360914">if</span>&nbsp;<span class="ident" id="5360917">s</span><span class="op" id="5360918">,</span>&nbsp;<span class="ident" id="5360920">ok</span>&nbsp;<span class="op" id="5360923">:=</span>&nbsp;<span class="ident" id="5360926">r</span><span class="op" id="5360927">.</span><span class="op" id="5360928">(</span><span class="builtintype" id="5360929">string</span><span class="op" id="5360935">)</span><span class="op" id="5360936">;</span>&nbsp;<span class="ident" id="5360938">ok</span>&nbsp;<span class="op" id="5360941">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5360947">panic</span><span class="op" id="5360952">(</span><span class="ident" id="5360953">s</span><span class="op" id="5360954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360964">err</span>&nbsp;<span class="op" id="5360968">=</span>&nbsp;<span class="ident" id="5360970">r</span><span class="op" id="5360971">.</span><span class="op" id="5360972">(</span><span class="builtintype" id="5360973">error</span><span class="op" id="5360978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360985">}</span><span class="op" id="5360986">(</span><span class="op" id="5360987">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360990">e</span><span class="op" id="5360991">.</span><span class="ident" id="5360992">reflectValue</span><span class="op" id="5361004">(</span><span class="ident" id="5361005">reflect</span><span class="op" id="5361012">.</span><span class="ident" id="5361013">ValueOf</span><span class="op" id="5361020">(</span><span class="ident" id="5361021">v</span><span class="op" id="5361022">)</span><span class="op" id="5361023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361026">return</span>&nbsp;<span class="builtintype" id="5361033">nil</span><br>
<span class="lineno"></span><span class="op" id="5361037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5361040">func</span>&nbsp;<span class="op" id="5361045">(</span><span class="ident" id="5361046">e</span>&nbsp;<span class="op" id="5361048">*</span><span class="ident" id="5361049">encodeState</span><span class="op" id="5361060">)</span>&nbsp;<span class="builtintype" id="5361062">error</span><span class="op" id="5361067">(</span><span class="ident" id="5361068">err</span>&nbsp;<span class="builtintype" id="5361072">error</span><span class="op" id="5361077">)</span>&nbsp;<span class="op" id="5361079">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5361082">panic</span><span class="op" id="5361087">(</span><span class="ident" id="5361088">err</span><span class="op" id="5361091">)</span><br>
<span class="lineno"></span><span class="op" id="5361093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5361096">var</span>&nbsp;<span class="ident" id="5361100">byteSliceType</span>&nbsp;<span class="op" id="5361114">=</span>&nbsp;<span class="ident" id="5361116">reflect</span><span class="op" id="5361123">.</span><span class="ident" id="5361124">TypeOf</span><span class="op" id="5361130">(</span><span class="op" id="5361131">[</span><span class="op" id="5361132">]</span><span class="builtintype" id="5361133">byte</span><span class="op" id="5361137">(</span><span class="builtintype" id="5361138">nil</span><span class="op" id="5361141">)</span><span class="op" id="5361142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="5361145">func</span>&nbsp;<span class="ident" id="5361150">isEmptyValue</span><span class="op" id="5361162">(</span><span class="ident" id="5361163">v</span>&nbsp;<span class="ident" id="5361165">reflect</span><span class="op" id="5361172">.</span><span class="ident" id="5361173">Value</span><span class="op" id="5361178">)</span>&nbsp;<span class="builtintype" id="5361180">bool</span>&nbsp;<span class="op" id="5361185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361188">switch</span>&nbsp;<span class="ident" id="5361195">v</span><span class="op" id="5361196">.</span><span class="ident" id="5361197">Kind</span><span class="op" id="5361201">(</span><span class="op" id="5361202">)</span>&nbsp;<span class="op" id="5361204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361207">case</span>&nbsp;<span class="ident" id="5361212">reflect</span><span class="op" id="5361219">.</span><span class="ident" id="5361220">Array</span><span class="op" id="5361225">,</span>&nbsp;<span class="ident" id="5361227">reflect</span><span class="op" id="5361234">.</span><span class="ident" id="5361235">Map</span><span class="op" id="5361238">,</span>&nbsp;<span class="ident" id="5361240">reflect</span><span class="op" id="5361247">.</span><span class="ident" id="5361248">Slice</span><span class="op" id="5361253">,</span>&nbsp;<span class="ident" id="5361255">reflect</span><span class="op" id="5361262">.</span><span class="ident" id="5361263">String</span><span class="op" id="5361269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361273">return</span>&nbsp;<span class="ident" id="5361280">v</span><span class="op" id="5361281">.</span><span class="ident" id="5361282">Len</span><span class="op" id="5361285">(</span><span class="op" id="5361286">)</span>&nbsp;<span class="op" id="5361288">==</span>&nbsp;<span class="num" id="5361291">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361294">case</span>&nbsp;<span class="ident" id="5361299">reflect</span><span class="op" id="5361306">.</span><span class="ident" id="5361307">Bool</span><span class="op" id="5361311">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361315">return</span>&nbsp;<span class="op" id="5361322">!</span><span class="ident" id="5361323">v</span><span class="op" id="5361324">.</span><span class="ident" id="5361325">Bool</span><span class="op" id="5361329">(</span><span class="op" id="5361330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361333">case</span>&nbsp;<span class="ident" id="5361338">reflect</span><span class="op" id="5361345">.</span><span class="ident" id="5361346">Int</span><span class="op" id="5361349">,</span>&nbsp;<span class="ident" id="5361351">reflect</span><span class="op" id="5361358">.</span><span class="ident" id="5361359">Int8</span><span class="op" id="5361363">,</span>&nbsp;<span class="ident" id="5361365">reflect</span><span class="op" id="5361372">.</span><span class="ident" id="5361373">Int16</span><span class="op" id="5361378">,</span>&nbsp;<span class="ident" id="5361380">reflect</span><span class="op" id="5361387">.</span><span class="ident" id="5361388">Int32</span><span class="op" id="5361393">,</span>&nbsp;<span class="ident" id="5361395">reflect</span><span class="op" id="5361402">.</span><span class="ident" id="5361403">Int64</span><span class="op" id="5361408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361412">return</span>&nbsp;<span class="ident" id="5361419">v</span><span class="op" id="5361420">.</span><span class="ident" id="5361421">Int</span><span class="op" id="5361424">(</span><span class="op" id="5361425">)</span>&nbsp;<span class="op" id="5361427">==</span>&nbsp;<span class="num" id="5361430">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361433">case</span>&nbsp;<span class="ident" id="5361438">reflect</span><span class="op" id="5361445">.</span><span class="ident" id="5361446">Uint</span><span class="op" id="5361450">,</span>&nbsp;<span class="ident" id="5361452">reflect</span><span class="op" id="5361459">.</span><span class="ident" id="5361460">Uint8</span><span class="op" id="5361465">,</span>&nbsp;<span class="ident" id="5361467">reflect</span><span class="op" id="5361474">.</span><span class="ident" id="5361475">Uint16</span><span class="op" id="5361481">,</span>&nbsp;<span class="ident" id="5361483">reflect</span><span class="op" id="5361490">.</span><span class="ident" id="5361491">Uint32</span><span class="op" id="5361497">,</span>&nbsp;<span class="ident" id="5361499">reflect</span><span class="op" id="5361506">.</span><span class="ident" id="5361507">Uint64</span><span class="op" id="5361513">,</span>&nbsp;<span class="ident" id="5361515">reflect</span><span class="op" id="5361522">.</span><span class="ident" id="5361523">Uintptr</span><span class="op" id="5361530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361534">return</span>&nbsp;<span class="ident" id="5361541">v</span><span class="op" id="5361542">.</span><span class="ident" id="5361543">Uint</span><span class="op" id="5361547">(</span><span class="op" id="5361548">)</span>&nbsp;<span class="op" id="5361550">==</span>&nbsp;<span class="num" id="5361553">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361556">case</span>&nbsp;<span class="ident" id="5361561">reflect</span><span class="op" id="5361568">.</span><span class="ident" id="5361569">Float32</span><span class="op" id="5361576">,</span>&nbsp;<span class="ident" id="5361578">reflect</span><span class="op" id="5361585">.</span><span class="ident" id="5361586">Float64</span><span class="op" id="5361593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361597">return</span>&nbsp;<span class="ident" id="5361604">v</span><span class="op" id="5361605">.</span><span class="ident" id="5361606">Float</span><span class="op" id="5361611">(</span><span class="op" id="5361612">)</span>&nbsp;<span class="op" id="5361614">==</span>&nbsp;<span class="num" id="5361617">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361620">case</span>&nbsp;<span class="ident" id="5361625">reflect</span><span class="op" id="5361632">.</span><span class="ident" id="5361633">Interface</span><span class="op" id="5361642">,</span>&nbsp;<span class="ident" id="5361644">reflect</span><span class="op" id="5361651">.</span><span class="ident" id="5361652">Ptr</span><span class="op" id="5361655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361659">return</span>&nbsp;<span class="ident" id="5361666">v</span><span class="op" id="5361667">.</span><span class="ident" id="5361668">IsNil</span><span class="op" id="5361673">(</span><span class="op" id="5361674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361677">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361680">return</span>&nbsp;<span class="builtintype" id="5361687">false</span><br>
<span class="lineno"></span><span class="op" id="5361693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5361696">func</span>&nbsp;<span class="op" id="5361701">(</span><span class="ident" id="5361702">e</span>&nbsp;<span class="op" id="5361704">*</span><span class="ident" id="5361705">encodeState</span><span class="op" id="5361716">)</span>&nbsp;<span class="ident" id="5361718">reflectValue</span><span class="op" id="5361730">(</span><span class="ident" id="5361731">v</span>&nbsp;<span class="ident" id="5361733">reflect</span><span class="op" id="5361740">.</span><span class="ident" id="5361741">Value</span><span class="op" id="5361746">)</span>&nbsp;<span class="op" id="5361748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361751">valueEncoder</span><span class="op" id="5361763">(</span><span class="ident" id="5361764">v</span><span class="op" id="5361765">)</span><span class="op" id="5361766">(</span><span class="ident" id="5361767">e</span><span class="op" id="5361768">,</span>&nbsp;<span class="ident" id="5361770">v</span><span class="op" id="5361771">,</span>&nbsp;<span class="builtintype" id="5361773">false</span><span class="op" id="5361778">)</span><br>
<span class="lineno">300</span><span class="op" id="5361780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5361783">type</span>&nbsp;<span class="ident" id="5361788">encoderFunc</span>&nbsp;<span class="keyword" id="5361800">func</span><span class="op" id="5361804">(</span><span class="ident" id="5361805">e</span>&nbsp;<span class="op" id="5361807">*</span><span class="ident" id="5361808">encodeState</span><span class="op" id="5361819">,</span>&nbsp;<span class="ident" id="5361821">v</span>&nbsp;<span class="ident" id="5361823">reflect</span><span class="op" id="5361830">.</span><span class="ident" id="5361831">Value</span><span class="op" id="5361836">,</span>&nbsp;<span class="ident" id="5361838">quoted</span>&nbsp;<span class="builtintype" id="5361845">bool</span><span class="op" id="5361849">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5361852">var</span>&nbsp;<span class="ident" id="5361856">encoderCache</span>&nbsp;<span class="keyword" id="5361869">struct</span>&nbsp;<span class="op" id="5361876">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361879">sync</span><span class="op" id="5361883">.</span><span class="ident" id="5361884">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361893">m</span>&nbsp;<span class="keyword" id="5361895">map</span><span class="op" id="5361898">[</span><span class="ident" id="5361899">reflect</span><span class="op" id="5361906">.</span><span class="ident" id="5361907">Type</span><span class="op" id="5361911">]</span><span class="ident" id="5361912">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5361924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5361927">func</span>&nbsp;<span class="ident" id="5361932">valueEncoder</span><span class="op" id="5361944">(</span><span class="ident" id="5361945">v</span>&nbsp;<span class="ident" id="5361947">reflect</span><span class="op" id="5361954">.</span><span class="ident" id="5361955">Value</span><span class="op" id="5361960">)</span>&nbsp;<span class="ident" id="5361962">encoderFunc</span>&nbsp;<span class="op" id="5361974">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361977">if</span>&nbsp;<span class="op" id="5361980">!</span><span class="ident" id="5361981">v</span><span class="op" id="5361982">.</span><span class="ident" id="5361983">IsValid</span><span class="op" id="5361990">(</span><span class="op" id="5361991">)</span>&nbsp;<span class="op" id="5361993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361997">return</span>&nbsp;<span class="ident" id="5362004">invalidValueEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362028">return</span>&nbsp;<span class="ident" id="5362035">typeEncoder</span><span class="op" id="5362046">(</span><span class="ident" id="5362047">v</span><span class="op" id="5362048">.</span><span class="ident" id="5362049">Type</span><span class="op" id="5362053">(</span><span class="op" id="5362054">)</span><span class="op" id="5362055">)</span><br>
<span class="lineno"></span><span class="op" id="5362057">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="5362060">func</span>&nbsp;<span class="ident" id="5362065">typeEncoder</span><span class="op" id="5362076">(</span><span class="ident" id="5362077">t</span>&nbsp;<span class="ident" id="5362079">reflect</span><span class="op" id="5362086">.</span><span class="ident" id="5362087">Type</span><span class="op" id="5362091">)</span>&nbsp;<span class="ident" id="5362093">encoderFunc</span>&nbsp;<span class="op" id="5362105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362108">encoderCache</span><span class="op" id="5362120">.</span><span class="ident" id="5362121">RLock</span><span class="op" id="5362126">(</span><span class="op" id="5362127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362130">f</span>&nbsp;<span class="op" id="5362132">:=</span>&nbsp;<span class="ident" id="5362135">encoderCache</span><span class="op" id="5362147">.</span><span class="ident" id="5362148">m</span><span class="op" id="5362149">[</span><span class="ident" id="5362150">t</span><span class="op" id="5362151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362154">encoderCache</span><span class="op" id="5362166">.</span><span class="ident" id="5362167">RUnlock</span><span class="op" id="5362174">(</span><span class="op" id="5362175">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362178">if</span>&nbsp;<span class="ident" id="5362181">f</span>&nbsp;<span class="op" id="5362183">!=</span>&nbsp;<span class="builtintype" id="5362186">nil</span>&nbsp;<span class="op" id="5362190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362194">return</span>&nbsp;<span class="ident" id="5362201">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362208">//&nbsp;To&nbsp;deal&nbsp;with&nbsp;recursive&nbsp;types,&nbsp;populate&nbsp;the&nbsp;map&nbsp;with&nbsp;an</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362267">//&nbsp;indirect&nbsp;func&nbsp;before&nbsp;we&nbsp;build&nbsp;it.&nbsp;This&nbsp;type&nbsp;waits&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362328">//&nbsp;real&nbsp;func&nbsp;(f)&nbsp;to&nbsp;be&nbsp;ready&nbsp;and&nbsp;then&nbsp;calls&nbsp;it.&nbsp;&nbsp;This&nbsp;indirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362392">//&nbsp;func&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;recursive&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362435">encoderCache</span><span class="op" id="5362447">.</span><span class="ident" id="5362448">Lock</span><span class="op" id="5362452">(</span><span class="op" id="5362453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362456">if</span>&nbsp;<span class="ident" id="5362459">encoderCache</span><span class="op" id="5362471">.</span><span class="ident" id="5362472">m</span>&nbsp;<span class="op" id="5362474">==</span>&nbsp;<span class="builtintype" id="5362477">nil</span>&nbsp;<span class="op" id="5362481">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362485">encoderCache</span><span class="op" id="5362497">.</span><span class="ident" id="5362498">m</span>&nbsp;<span class="op" id="5362500">=</span>&nbsp;<span class="builtinfunc" id="5362502">make</span><span class="op" id="5362506">(</span><span class="keyword" id="5362507">map</span><span class="op" id="5362510">[</span><span class="ident" id="5362511">reflect</span><span class="op" id="5362518">.</span><span class="ident" id="5362519">Type</span><span class="op" id="5362523">]</span><span class="ident" id="5362524">encoderFunc</span><span class="op" id="5362535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362541">var</span>&nbsp;<span class="ident" id="5362545">wg</span>&nbsp;<span class="ident" id="5362548">sync</span><span class="op" id="5362552">.</span><span class="ident" id="5362553">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362564">wg</span><span class="op" id="5362566">.</span><span class="ident" id="5362567">Add</span><span class="op" id="5362570">(</span><span class="num" id="5362571">1</span><span class="op" id="5362572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362575">encoderCache</span><span class="op" id="5362587">.</span><span class="ident" id="5362588">m</span><span class="op" id="5362589">[</span><span class="ident" id="5362590">t</span><span class="op" id="5362591">]</span>&nbsp;<span class="op" id="5362593">=</span>&nbsp;<span class="keyword" id="5362595">func</span><span class="op" id="5362599">(</span><span class="ident" id="5362600">e</span>&nbsp;<span class="op" id="5362602">*</span><span class="ident" id="5362603">encodeState</span><span class="op" id="5362614">,</span>&nbsp;<span class="ident" id="5362616">v</span>&nbsp;<span class="ident" id="5362618">reflect</span><span class="op" id="5362625">.</span><span class="ident" id="5362626">Value</span><span class="op" id="5362631">,</span>&nbsp;<span class="ident" id="5362633">quoted</span>&nbsp;<span class="builtintype" id="5362640">bool</span><span class="op" id="5362644">)</span>&nbsp;<span class="op" id="5362646">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362650">wg</span><span class="op" id="5362652">.</span><span class="ident" id="5362653">Wait</span><span class="op" id="5362657">(</span><span class="op" id="5362658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362662">f</span><span class="op" id="5362663">(</span><span class="ident" id="5362664">e</span><span class="op" id="5362665">,</span>&nbsp;<span class="ident" id="5362667">v</span><span class="op" id="5362668">,</span>&nbsp;<span class="ident" id="5362670">quoted</span><span class="op" id="5362676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362682">encoderCache</span><span class="op" id="5362694">.</span><span class="ident" id="5362695">Unlock</span><span class="op" id="5362701">(</span><span class="op" id="5362702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362706">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362739">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362806">f</span>&nbsp;<span class="op" id="5362808">=</span>&nbsp;<span class="ident" id="5362810">newTypeEncoder</span><span class="op" id="5362824">(</span><span class="ident" id="5362825">t</span><span class="op" id="5362826">,</span>&nbsp;<span class="builtintype" id="5362828">true</span><span class="op" id="5362832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362835">wg</span><span class="op" id="5362837">.</span><span class="ident" id="5362838">Done</span><span class="op" id="5362842">(</span><span class="op" id="5362843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362846">encoderCache</span><span class="op" id="5362858">.</span><span class="ident" id="5362859">Lock</span><span class="op" id="5362863">(</span><span class="op" id="5362864">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362867">encoderCache</span><span class="op" id="5362879">.</span><span class="ident" id="5362880">m</span><span class="op" id="5362881">[</span><span class="ident" id="5362882">t</span><span class="op" id="5362883">]</span>&nbsp;<span class="op" id="5362885">=</span>&nbsp;<span class="ident" id="5362887">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362890">encoderCache</span><span class="op" id="5362902">.</span><span class="ident" id="5362903">Unlock</span><span class="op" id="5362909">(</span><span class="op" id="5362910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362913">return</span>&nbsp;<span class="ident" id="5362920">f</span><br>
<span class="lineno"></span><span class="op" id="5362922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5362925">var</span>&nbsp;<span class="op" id="5362929">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362932">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362950">=</span>&nbsp;<span class="ident" id="5362952">reflect</span><span class="op" id="5362959">.</span><span class="ident" id="5362960">TypeOf</span><span class="op" id="5362966">(</span><span class="builtinfunc" id="5362967">new</span><span class="op" id="5362970">(</span><span class="ident" id="5362971">Marshaler</span><span class="op" id="5362980">)</span><span class="op" id="5362981">)</span><span class="op" id="5362982">.</span><span class="ident" id="5362983">Elem</span><span class="op" id="5362987">(</span><span class="op" id="5362988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362991">textMarshalerType</span>&nbsp;<span class="op" id="5363009">=</span>&nbsp;<span class="ident" id="5363011">reflect</span><span class="op" id="5363018">.</span><span class="ident" id="5363019">TypeOf</span><span class="op" id="5363025">(</span><span class="builtinfunc" id="5363026">new</span><span class="op" id="5363029">(</span><span class="ident" id="5363030">encoding</span><span class="op" id="5363038">.</span><span class="ident" id="5363039">TextMarshaler</span><span class="op" id="5363052">)</span><span class="op" id="5363053">)</span><span class="op" id="5363054">.</span><span class="ident" id="5363055">Elem</span><span class="op" id="5363059">(</span><span class="op" id="5363060">)</span><br>
<span class="lineno"></span><span class="op" id="5363062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5363065">//&nbsp;newTypeEncoder&nbsp;constructs&nbsp;an&nbsp;encoderFunc&nbsp;for&nbsp;a&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5363121">//&nbsp;The&nbsp;returned&nbsp;encoder&nbsp;only&nbsp;checks&nbsp;CanAddr&nbsp;when&nbsp;allowAddr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5363189">func</span>&nbsp;<span class="ident" id="5363194">newTypeEncoder</span><span class="op" id="5363208">(</span><span class="ident" id="5363209">t</span>&nbsp;<span class="ident" id="5363211">reflect</span><span class="op" id="5363218">.</span><span class="ident" id="5363219">Type</span><span class="op" id="5363223">,</span>&nbsp;<span class="ident" id="5363225">allowAddr</span>&nbsp;<span class="builtintype" id="5363235">bool</span><span class="op" id="5363239">)</span>&nbsp;<span class="ident" id="5363241">encoderFunc</span>&nbsp;<span class="op" id="5363253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363256">if</span>&nbsp;<span class="ident" id="5363259">t</span><span class="op" id="5363260">.</span><span class="ident" id="5363261">Implements</span><span class="op" id="5363271">(</span><span class="ident" id="5363272">marshalerType</span><span class="op" id="5363285">)</span>&nbsp;<span class="op" id="5363287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363291">return</span>&nbsp;<span class="ident" id="5363298">marshalerEncoder</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363319">if</span>&nbsp;<span class="ident" id="5363322">t</span><span class="op" id="5363323">.</span><span class="ident" id="5363324">Kind</span><span class="op" id="5363328">(</span><span class="op" id="5363329">)</span>&nbsp;<span class="op" id="5363331">!=</span>&nbsp;<span class="ident" id="5363334">reflect</span><span class="op" id="5363341">.</span><span class="ident" id="5363342">Ptr</span>&nbsp;<span class="op" id="5363346">&amp;&amp;</span>&nbsp;<span class="ident" id="5363349">allowAddr</span>&nbsp;<span class="op" id="5363359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363363">if</span>&nbsp;<span class="ident" id="5363366">reflect</span><span class="op" id="5363373">.</span><span class="ident" id="5363374">PtrTo</span><span class="op" id="5363379">(</span><span class="ident" id="5363380">t</span><span class="op" id="5363381">)</span><span class="op" id="5363382">.</span><span class="ident" id="5363383">Implements</span><span class="op" id="5363393">(</span><span class="ident" id="5363394">marshalerType</span><span class="op" id="5363407">)</span>&nbsp;<span class="op" id="5363409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363414">return</span>&nbsp;<span class="ident" id="5363421">newCondAddrEncoder</span><span class="op" id="5363439">(</span><span class="ident" id="5363440">addrMarshalerEncoder</span><span class="op" id="5363460">,</span>&nbsp;<span class="ident" id="5363462">newTypeEncoder</span><span class="op" id="5363476">(</span><span class="ident" id="5363477">t</span><span class="op" id="5363478">,</span>&nbsp;<span class="builtintype" id="5363480">false</span><span class="op" id="5363485">)</span><span class="op" id="5363486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363490">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363497">if</span>&nbsp;<span class="ident" id="5363500">t</span><span class="op" id="5363501">.</span><span class="ident" id="5363502">Implements</span><span class="op" id="5363512">(</span><span class="ident" id="5363513">textMarshalerType</span><span class="op" id="5363530">)</span>&nbsp;<span class="op" id="5363532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363536">return</span>&nbsp;<span class="ident" id="5363543">textMarshalerEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363565">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363568">if</span>&nbsp;<span class="ident" id="5363571">t</span><span class="op" id="5363572">.</span><span class="ident" id="5363573">Kind</span><span class="op" id="5363577">(</span><span class="op" id="5363578">)</span>&nbsp;<span class="op" id="5363580">!=</span>&nbsp;<span class="ident" id="5363583">reflect</span><span class="op" id="5363590">.</span><span class="ident" id="5363591">Ptr</span>&nbsp;<span class="op" id="5363595">&amp;&amp;</span>&nbsp;<span class="ident" id="5363598">allowAddr</span>&nbsp;<span class="op" id="5363608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363612">if</span>&nbsp;<span class="ident" id="5363615">reflect</span><span class="op" id="5363622">.</span><span class="ident" id="5363623">PtrTo</span><span class="op" id="5363628">(</span><span class="ident" id="5363629">t</span><span class="op" id="5363630">)</span><span class="op" id="5363631">.</span><span class="ident" id="5363632">Implements</span><span class="op" id="5363642">(</span><span class="ident" id="5363643">textMarshalerType</span><span class="op" id="5363660">)</span>&nbsp;<span class="op" id="5363662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363667">return</span>&nbsp;<span class="ident" id="5363674">newCondAddrEncoder</span><span class="op" id="5363692">(</span><span class="ident" id="5363693">addrTextMarshalerEncoder</span><span class="op" id="5363717">,</span>&nbsp;<span class="ident" id="5363719">newTypeEncoder</span><span class="op" id="5363733">(</span><span class="ident" id="5363734">t</span><span class="op" id="5363735">,</span>&nbsp;<span class="builtintype" id="5363737">false</span><span class="op" id="5363742">)</span><span class="op" id="5363743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363750">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363754">switch</span>&nbsp;<span class="ident" id="5363761">t</span><span class="op" id="5363762">.</span><span class="ident" id="5363763">Kind</span><span class="op" id="5363767">(</span><span class="op" id="5363768">)</span>&nbsp;<span class="op" id="5363770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363773">case</span>&nbsp;<span class="ident" id="5363778">reflect</span><span class="op" id="5363785">.</span><span class="ident" id="5363786">Bool</span><span class="op" id="5363790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363794">return</span>&nbsp;<span class="ident" id="5363801">boolEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363814">case</span>&nbsp;<span class="ident" id="5363819">reflect</span><span class="op" id="5363826">.</span><span class="ident" id="5363827">Int</span><span class="op" id="5363830">,</span>&nbsp;<span class="ident" id="5363832">reflect</span><span class="op" id="5363839">.</span><span class="ident" id="5363840">Int8</span><span class="op" id="5363844">,</span>&nbsp;<span class="ident" id="5363846">reflect</span><span class="op" id="5363853">.</span><span class="ident" id="5363854">Int16</span><span class="op" id="5363859">,</span>&nbsp;<span class="ident" id="5363861">reflect</span><span class="op" id="5363868">.</span><span class="ident" id="5363869">Int32</span><span class="op" id="5363874">,</span>&nbsp;<span class="ident" id="5363876">reflect</span><span class="op" id="5363883">.</span><span class="ident" id="5363884">Int64</span><span class="op" id="5363889">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363893">return</span>&nbsp;<span class="ident" id="5363900">intEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363912">case</span>&nbsp;<span class="ident" id="5363917">reflect</span><span class="op" id="5363924">.</span><span class="ident" id="5363925">Uint</span><span class="op" id="5363929">,</span>&nbsp;<span class="ident" id="5363931">reflect</span><span class="op" id="5363938">.</span><span class="ident" id="5363939">Uint8</span><span class="op" id="5363944">,</span>&nbsp;<span class="ident" id="5363946">reflect</span><span class="op" id="5363953">.</span><span class="ident" id="5363954">Uint16</span><span class="op" id="5363960">,</span>&nbsp;<span class="ident" id="5363962">reflect</span><span class="op" id="5363969">.</span><span class="ident" id="5363970">Uint32</span><span class="op" id="5363976">,</span>&nbsp;<span class="ident" id="5363978">reflect</span><span class="op" id="5363985">.</span><span class="ident" id="5363986">Uint64</span><span class="op" id="5363992">,</span>&nbsp;<span class="ident" id="5363994">reflect</span><span class="op" id="5364001">.</span><span class="ident" id="5364002">Uintptr</span><span class="op" id="5364009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364013">return</span>&nbsp;<span class="ident" id="5364020">uintEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364033">case</span>&nbsp;<span class="ident" id="5364038">reflect</span><span class="op" id="5364045">.</span><span class="ident" id="5364046">Float32</span><span class="op" id="5364053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364057">return</span>&nbsp;<span class="ident" id="5364064">float32Encoder</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364080">case</span>&nbsp;<span class="ident" id="5364085">reflect</span><span class="op" id="5364092">.</span><span class="ident" id="5364093">Float64</span><span class="op" id="5364100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364104">return</span>&nbsp;<span class="ident" id="5364111">float64Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364127">case</span>&nbsp;<span class="ident" id="5364132">reflect</span><span class="op" id="5364139">.</span><span class="ident" id="5364140">String</span><span class="op" id="5364146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364150">return</span>&nbsp;<span class="ident" id="5364157">stringEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364172">case</span>&nbsp;<span class="ident" id="5364177">reflect</span><span class="op" id="5364184">.</span><span class="ident" id="5364185">Interface</span><span class="op" id="5364194">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364198">return</span>&nbsp;<span class="ident" id="5364205">interfaceEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364223">case</span>&nbsp;<span class="ident" id="5364228">reflect</span><span class="op" id="5364235">.</span><span class="ident" id="5364236">Struct</span><span class="op" id="5364242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364246">return</span>&nbsp;<span class="ident" id="5364253">newStructEncoder</span><span class="op" id="5364269">(</span><span class="ident" id="5364270">t</span><span class="op" id="5364271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364274">case</span>&nbsp;<span class="ident" id="5364279">reflect</span><span class="op" id="5364286">.</span><span class="ident" id="5364287">Map</span><span class="op" id="5364290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364294">return</span>&nbsp;<span class="ident" id="5364301">newMapEncoder</span><span class="op" id="5364314">(</span><span class="ident" id="5364315">t</span><span class="op" id="5364316">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364319">case</span>&nbsp;<span class="ident" id="5364324">reflect</span><span class="op" id="5364331">.</span><span class="ident" id="5364332">Slice</span><span class="op" id="5364337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364341">return</span>&nbsp;<span class="ident" id="5364348">newSliceEncoder</span><span class="op" id="5364363">(</span><span class="ident" id="5364364">t</span><span class="op" id="5364365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364368">case</span>&nbsp;<span class="ident" id="5364373">reflect</span><span class="op" id="5364380">.</span><span class="ident" id="5364381">Array</span><span class="op" id="5364386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364390">return</span>&nbsp;<span class="ident" id="5364397">newArrayEncoder</span><span class="op" id="5364412">(</span><span class="ident" id="5364413">t</span><span class="op" id="5364414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364417">case</span>&nbsp;<span class="ident" id="5364422">reflect</span><span class="op" id="5364429">.</span><span class="ident" id="5364430">Ptr</span><span class="op" id="5364433">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364437">return</span>&nbsp;<span class="ident" id="5364444">newPtrEncoder</span><span class="op" id="5364457">(</span><span class="ident" id="5364458">t</span><span class="op" id="5364459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364462">default</span><span class="op" id="5364469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364473">return</span>&nbsp;<span class="ident" id="5364480">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364504">}</span><br>
<span class="lineno"></span><span class="op" id="5364506">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="5364509">func</span>&nbsp;<span class="ident" id="5364514">invalidValueEncoder</span><span class="op" id="5364533">(</span><span class="ident" id="5364534">e</span>&nbsp;<span class="op" id="5364536">*</span><span class="ident" id="5364537">encodeState</span><span class="op" id="5364548">,</span>&nbsp;<span class="ident" id="5364550">v</span>&nbsp;<span class="ident" id="5364552">reflect</span><span class="op" id="5364559">.</span><span class="ident" id="5364560">Value</span><span class="op" id="5364565">,</span>&nbsp;<span class="ident" id="5364567">quoted</span>&nbsp;<span class="builtintype" id="5364574">bool</span><span class="op" id="5364578">)</span>&nbsp;<span class="op" id="5364580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364583">e</span><span class="op" id="5364584">.</span><span class="ident" id="5364585">WriteString</span><span class="op" id="5364596">(</span><span class="string" id="5364597">&#34;null&#34;</span><span class="op" id="5364603">)</span><br>
<span class="lineno"></span><span class="op" id="5364605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="keyword" id="5364608">func</span>&nbsp;<span class="ident" id="5364613">marshalerEncoder</span><span class="op" id="5364629">(</span><span class="ident" id="5364630">e</span>&nbsp;<span class="op" id="5364632">*</span><span class="ident" id="5364633">encodeState</span><span class="op" id="5364644">,</span>&nbsp;<span class="ident" id="5364646">v</span>&nbsp;<span class="ident" id="5364648">reflect</span><span class="op" id="5364655">.</span><span class="ident" id="5364656">Value</span><span class="op" id="5364661">,</span>&nbsp;<span class="ident" id="5364663">quoted</span>&nbsp;<span class="builtintype" id="5364670">bool</span><span class="op" id="5364674">)</span>&nbsp;<span class="op" id="5364676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364679">if</span>&nbsp;<span class="ident" id="5364682">v</span><span class="op" id="5364683">.</span><span class="ident" id="5364684">Kind</span><span class="op" id="5364688">(</span><span class="op" id="5364689">)</span>&nbsp;<span class="op" id="5364691">==</span>&nbsp;<span class="ident" id="5364694">reflect</span><span class="op" id="5364701">.</span><span class="ident" id="5364702">Ptr</span>&nbsp;<span class="op" id="5364706">&amp;&amp;</span>&nbsp;<span class="ident" id="5364709">v</span><span class="op" id="5364710">.</span><span class="ident" id="5364711">IsNil</span><span class="op" id="5364716">(</span><span class="op" id="5364717">)</span>&nbsp;<span class="op" id="5364719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364723">e</span><span class="op" id="5364724">.</span><span class="ident" id="5364725">WriteString</span><span class="op" id="5364736">(</span><span class="string" id="5364737">&#34;null&#34;</span><span class="op" id="5364743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364755">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364758">m</span>&nbsp;<span class="op" id="5364760">:=</span>&nbsp;<span class="ident" id="5364763">v</span><span class="op" id="5364764">.</span><span class="ident" id="5364765">Interface</span><span class="op" id="5364774">(</span><span class="op" id="5364775">)</span><span class="op" id="5364776">.</span><span class="op" id="5364777">(</span><span class="ident" id="5364778">Marshaler</span><span class="op" id="5364787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364790">b</span><span class="op" id="5364791">,</span>&nbsp;<span class="ident" id="5364793">err</span>&nbsp;<span class="op" id="5364797">:=</span>&nbsp;<span class="ident" id="5364800">m</span><span class="op" id="5364801">.</span><span class="ident" id="5364802">MarshalJSON</span><span class="op" id="5364813">(</span><span class="op" id="5364814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364817">if</span>&nbsp;<span class="ident" id="5364820">err</span>&nbsp;<span class="op" id="5364824">==</span>&nbsp;<span class="builtintype" id="5364827">nil</span>&nbsp;<span class="op" id="5364831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364835">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364882">err</span>&nbsp;<span class="op" id="5364886">=</span>&nbsp;<span class="ident" id="5364888">compact</span><span class="op" id="5364895">(</span><span class="op" id="5364896">&amp;</span><span class="ident" id="5364897">e</span><span class="op" id="5364898">.</span><span class="ident" id="5364899">Buffer</span><span class="op" id="5364905">,</span>&nbsp;<span class="ident" id="5364907">b</span><span class="op" id="5364908">,</span>&nbsp;<span class="builtintype" id="5364910">true</span><span class="op" id="5364914">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364920">if</span>&nbsp;<span class="ident" id="5364923">err</span>&nbsp;<span class="op" id="5364927">!=</span>&nbsp;<span class="builtintype" id="5364930">nil</span>&nbsp;<span class="op" id="5364934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364938">e</span><span class="op" id="5364939">.</span><span class="builtintype" id="5364940">error</span><span class="op" id="5364945">(</span><span class="op" id="5364946">&amp;</span><span class="ident" id="5364947">MarshalerError</span><span class="op" id="5364961">{</span><span class="ident" id="5364962">v</span><span class="op" id="5364963">.</span><span class="ident" id="5364964">Type</span><span class="op" id="5364968">(</span><span class="op" id="5364969">)</span><span class="op" id="5364970">,</span>&nbsp;<span class="ident" id="5364972">err</span><span class="op" id="5364975">}</span><span class="op" id="5364976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364979">}</span><br>
<span class="lineno"></span><span class="op" id="5364981">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="5364984">func</span>&nbsp;<span class="ident" id="5364989">addrMarshalerEncoder</span><span class="op" id="5365009">(</span><span class="ident" id="5365010">e</span>&nbsp;<span class="op" id="5365012">*</span><span class="ident" id="5365013">encodeState</span><span class="op" id="5365024">,</span>&nbsp;<span class="ident" id="5365026">v</span>&nbsp;<span class="ident" id="5365028">reflect</span><span class="op" id="5365035">.</span><span class="ident" id="5365036">Value</span><span class="op" id="5365041">,</span>&nbsp;<span class="ident" id="5365043">quoted</span>&nbsp;<span class="builtintype" id="5365050">bool</span><span class="op" id="5365054">)</span>&nbsp;<span class="op" id="5365056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365059">va</span>&nbsp;<span class="op" id="5365062">:=</span>&nbsp;<span class="ident" id="5365065">v</span><span class="op" id="5365066">.</span><span class="ident" id="5365067">Addr</span><span class="op" id="5365071">(</span><span class="op" id="5365072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365075">if</span>&nbsp;<span class="ident" id="5365078">va</span><span class="op" id="5365080">.</span><span class="ident" id="5365081">IsNil</span><span class="op" id="5365086">(</span><span class="op" id="5365087">)</span>&nbsp;<span class="op" id="5365089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365093">e</span><span class="op" id="5365094">.</span><span class="ident" id="5365095">WriteString</span><span class="op" id="5365106">(</span><span class="string" id="5365107">&#34;null&#34;</span><span class="op" id="5365113">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365128">m</span>&nbsp;<span class="op" id="5365130">:=</span>&nbsp;<span class="ident" id="5365133">va</span><span class="op" id="5365135">.</span><span class="ident" id="5365136">Interface</span><span class="op" id="5365145">(</span><span class="op" id="5365146">)</span><span class="op" id="5365147">.</span><span class="op" id="5365148">(</span><span class="ident" id="5365149">Marshaler</span><span class="op" id="5365158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365161">b</span><span class="op" id="5365162">,</span>&nbsp;<span class="ident" id="5365164">err</span>&nbsp;<span class="op" id="5365168">:=</span>&nbsp;<span class="ident" id="5365171">m</span><span class="op" id="5365172">.</span><span class="ident" id="5365173">MarshalJSON</span><span class="op" id="5365184">(</span><span class="op" id="5365185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365188">if</span>&nbsp;<span class="ident" id="5365191">err</span>&nbsp;<span class="op" id="5365195">==</span>&nbsp;<span class="builtintype" id="5365198">nil</span>&nbsp;<span class="op" id="5365202">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5365206">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365253">err</span>&nbsp;<span class="op" id="5365257">=</span>&nbsp;<span class="ident" id="5365259">compact</span><span class="op" id="5365266">(</span><span class="op" id="5365267">&amp;</span><span class="ident" id="5365268">e</span><span class="op" id="5365269">.</span><span class="ident" id="5365270">Buffer</span><span class="op" id="5365276">,</span>&nbsp;<span class="ident" id="5365278">b</span><span class="op" id="5365279">,</span>&nbsp;<span class="builtintype" id="5365281">true</span><span class="op" id="5365285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365291">if</span>&nbsp;<span class="ident" id="5365294">err</span>&nbsp;<span class="op" id="5365298">!=</span>&nbsp;<span class="builtintype" id="5365301">nil</span>&nbsp;<span class="op" id="5365305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365309">e</span><span class="op" id="5365310">.</span><span class="builtintype" id="5365311">error</span><span class="op" id="5365316">(</span><span class="op" id="5365317">&amp;</span><span class="ident" id="5365318">MarshalerError</span><span class="op" id="5365332">{</span><span class="ident" id="5365333">v</span><span class="op" id="5365334">.</span><span class="ident" id="5365335">Type</span><span class="op" id="5365339">(</span><span class="op" id="5365340">)</span><span class="op" id="5365341">,</span>&nbsp;<span class="ident" id="5365343">err</span><span class="op" id="5365346">}</span><span class="op" id="5365347">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365350">}</span><br>
<span class="lineno"></span><span class="op" id="5365352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5365355">func</span>&nbsp;<span class="ident" id="5365360">textMarshalerEncoder</span><span class="op" id="5365380">(</span><span class="ident" id="5365381">e</span>&nbsp;<span class="op" id="5365383">*</span><span class="ident" id="5365384">encodeState</span><span class="op" id="5365395">,</span>&nbsp;<span class="ident" id="5365397">v</span>&nbsp;<span class="ident" id="5365399">reflect</span><span class="op" id="5365406">.</span><span class="ident" id="5365407">Value</span><span class="op" id="5365412">,</span>&nbsp;<span class="ident" id="5365414">quoted</span>&nbsp;<span class="builtintype" id="5365421">bool</span><span class="op" id="5365425">)</span>&nbsp;<span class="op" id="5365427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365430">if</span>&nbsp;<span class="ident" id="5365433">v</span><span class="op" id="5365434">.</span><span class="ident" id="5365435">Kind</span><span class="op" id="5365439">(</span><span class="op" id="5365440">)</span>&nbsp;<span class="op" id="5365442">==</span>&nbsp;<span class="ident" id="5365445">reflect</span><span class="op" id="5365452">.</span><span class="ident" id="5365453">Ptr</span>&nbsp;<span class="op" id="5365457">&amp;&amp;</span>&nbsp;<span class="ident" id="5365460">v</span><span class="op" id="5365461">.</span><span class="ident" id="5365462">IsNil</span><span class="op" id="5365467">(</span><span class="op" id="5365468">)</span>&nbsp;<span class="op" id="5365470">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365474">e</span><span class="op" id="5365475">.</span><span class="ident" id="5365476">WriteString</span><span class="op" id="5365487">(</span><span class="string" id="5365488">&#34;null&#34;</span><span class="op" id="5365494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365498">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365509">m</span>&nbsp;<span class="op" id="5365511">:=</span>&nbsp;<span class="ident" id="5365514">v</span><span class="op" id="5365515">.</span><span class="ident" id="5365516">Interface</span><span class="op" id="5365525">(</span><span class="op" id="5365526">)</span><span class="op" id="5365527">.</span><span class="op" id="5365528">(</span><span class="ident" id="5365529">encoding</span><span class="op" id="5365537">.</span><span class="ident" id="5365538">TextMarshaler</span><span class="op" id="5365551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365554">b</span><span class="op" id="5365555">,</span>&nbsp;<span class="ident" id="5365557">err</span>&nbsp;<span class="op" id="5365561">:=</span>&nbsp;<span class="ident" id="5365564">m</span><span class="op" id="5365565">.</span><span class="ident" id="5365566">MarshalText</span><span class="op" id="5365577">(</span><span class="op" id="5365578">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365581">if</span>&nbsp;<span class="ident" id="5365584">err</span>&nbsp;<span class="op" id="5365588">==</span>&nbsp;<span class="builtintype" id="5365591">nil</span>&nbsp;<span class="op" id="5365595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365599">_</span><span class="op" id="5365600">,</span>&nbsp;<span class="ident" id="5365602">err</span>&nbsp;<span class="op" id="5365606">=</span>&nbsp;<span class="ident" id="5365608">e</span><span class="op" id="5365609">.</span><span class="ident" id="5365610">stringBytes</span><span class="op" id="5365621">(</span><span class="ident" id="5365622">b</span><span class="op" id="5365623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365629">if</span>&nbsp;<span class="ident" id="5365632">err</span>&nbsp;<span class="op" id="5365636">!=</span>&nbsp;<span class="builtintype" id="5365639">nil</span>&nbsp;<span class="op" id="5365643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365647">e</span><span class="op" id="5365648">.</span><span class="builtintype" id="5365649">error</span><span class="op" id="5365654">(</span><span class="op" id="5365655">&amp;</span><span class="ident" id="5365656">MarshalerError</span><span class="op" id="5365670">{</span><span class="ident" id="5365671">v</span><span class="op" id="5365672">.</span><span class="ident" id="5365673">Type</span><span class="op" id="5365677">(</span><span class="op" id="5365678">)</span><span class="op" id="5365679">,</span>&nbsp;<span class="ident" id="5365681">err</span><span class="op" id="5365684">}</span><span class="op" id="5365685">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365688">}</span><br>
<span class="lineno"></span><span class="op" id="5365690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5365693">func</span>&nbsp;<span class="ident" id="5365698">addrTextMarshalerEncoder</span><span class="op" id="5365722">(</span><span class="ident" id="5365723">e</span>&nbsp;<span class="op" id="5365725">*</span><span class="ident" id="5365726">encodeState</span><span class="op" id="5365737">,</span>&nbsp;<span class="ident" id="5365739">v</span>&nbsp;<span class="ident" id="5365741">reflect</span><span class="op" id="5365748">.</span><span class="ident" id="5365749">Value</span><span class="op" id="5365754">,</span>&nbsp;<span class="ident" id="5365756">quoted</span>&nbsp;<span class="builtintype" id="5365763">bool</span><span class="op" id="5365767">)</span>&nbsp;<span class="op" id="5365769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365772">va</span>&nbsp;<span class="op" id="5365775">:=</span>&nbsp;<span class="ident" id="5365778">v</span><span class="op" id="5365779">.</span><span class="ident" id="5365780">Addr</span><span class="op" id="5365784">(</span><span class="op" id="5365785">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365788">if</span>&nbsp;<span class="ident" id="5365791">va</span><span class="op" id="5365793">.</span><span class="ident" id="5365794">IsNil</span><span class="op" id="5365799">(</span><span class="op" id="5365800">)</span>&nbsp;<span class="op" id="5365802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365806">e</span><span class="op" id="5365807">.</span><span class="ident" id="5365808">WriteString</span><span class="op" id="5365819">(</span><span class="string" id="5365820">&#34;null&#34;</span><span class="op" id="5365826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365841">m</span>&nbsp;<span class="op" id="5365843">:=</span>&nbsp;<span class="ident" id="5365846">va</span><span class="op" id="5365848">.</span><span class="ident" id="5365849">Interface</span><span class="op" id="5365858">(</span><span class="op" id="5365859">)</span><span class="op" id="5365860">.</span><span class="op" id="5365861">(</span><span class="ident" id="5365862">encoding</span><span class="op" id="5365870">.</span><span class="ident" id="5365871">TextMarshaler</span><span class="op" id="5365884">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365887">b</span><span class="op" id="5365888">,</span>&nbsp;<span class="ident" id="5365890">err</span>&nbsp;<span class="op" id="5365894">:=</span>&nbsp;<span class="ident" id="5365897">m</span><span class="op" id="5365898">.</span><span class="ident" id="5365899">MarshalText</span><span class="op" id="5365910">(</span><span class="op" id="5365911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365914">if</span>&nbsp;<span class="ident" id="5365917">err</span>&nbsp;<span class="op" id="5365921">==</span>&nbsp;<span class="builtintype" id="5365924">nil</span>&nbsp;<span class="op" id="5365928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365932">_</span><span class="op" id="5365933">,</span>&nbsp;<span class="ident" id="5365935">err</span>&nbsp;<span class="op" id="5365939">=</span>&nbsp;<span class="ident" id="5365941">e</span><span class="op" id="5365942">.</span><span class="ident" id="5365943">stringBytes</span><span class="op" id="5365954">(</span><span class="ident" id="5365955">b</span><span class="op" id="5365956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365962">if</span>&nbsp;<span class="ident" id="5365965">err</span>&nbsp;<span class="op" id="5365969">!=</span>&nbsp;<span class="builtintype" id="5365972">nil</span>&nbsp;<span class="op" id="5365976">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365980">e</span><span class="op" id="5365981">.</span><span class="builtintype" id="5365982">error</span><span class="op" id="5365987">(</span><span class="op" id="5365988">&amp;</span><span class="ident" id="5365989">MarshalerError</span><span class="op" id="5366003">{</span><span class="ident" id="5366004">v</span><span class="op" id="5366005">.</span><span class="ident" id="5366006">Type</span><span class="op" id="5366010">(</span><span class="op" id="5366011">)</span><span class="op" id="5366012">,</span>&nbsp;<span class="ident" id="5366014">err</span><span class="op" id="5366017">}</span><span class="op" id="5366018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366021">}</span><br>
<span class="lineno"></span><span class="op" id="5366023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5366026">func</span>&nbsp;<span class="ident" id="5366031">boolEncoder</span><span class="op" id="5366042">(</span><span class="ident" id="5366043">e</span>&nbsp;<span class="op" id="5366045">*</span><span class="ident" id="5366046">encodeState</span><span class="op" id="5366057">,</span>&nbsp;<span class="ident" id="5366059">v</span>&nbsp;<span class="ident" id="5366061">reflect</span><span class="op" id="5366068">.</span><span class="ident" id="5366069">Value</span><span class="op" id="5366074">,</span>&nbsp;<span class="ident" id="5366076">quoted</span>&nbsp;<span class="builtintype" id="5366083">bool</span><span class="op" id="5366087">)</span>&nbsp;<span class="op" id="5366089">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366092">if</span>&nbsp;<span class="ident" id="5366095">quoted</span>&nbsp;<span class="op" id="5366102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366106">e</span><span class="op" id="5366107">.</span><span class="ident" id="5366108">WriteByte</span><span class="op" id="5366117">(</span><span class="string" id="5366118">&#39;&#34;&#39;</span><span class="op" id="5366121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366127">if</span>&nbsp;<span class="ident" id="5366130">v</span><span class="op" id="5366131">.</span><span class="ident" id="5366132">Bool</span><span class="op" id="5366136">(</span><span class="op" id="5366137">)</span>&nbsp;<span class="op" id="5366139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366143">e</span><span class="op" id="5366144">.</span><span class="ident" id="5366145">WriteString</span><span class="op" id="5366156">(</span><span class="string" id="5366157">&#34;true&#34;</span><span class="op" id="5366163">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366166">}</span>&nbsp;<span class="keyword" id="5366168">else</span>&nbsp;<span class="op" id="5366173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366177">e</span><span class="op" id="5366178">.</span><span class="ident" id="5366179">WriteString</span><span class="op" id="5366190">(</span><span class="string" id="5366191">&#34;false&#34;</span><span class="op" id="5366198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366204">if</span>&nbsp;<span class="ident" id="5366207">quoted</span>&nbsp;<span class="op" id="5366214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366218">e</span><span class="op" id="5366219">.</span><span class="ident" id="5366220">WriteByte</span><span class="op" id="5366229">(</span><span class="string" id="5366230">&#39;&#34;&#39;</span><span class="op" id="5366233">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366236">}</span><br>
<span class="lineno"></span><span class="op" id="5366238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5366241">func</span>&nbsp;<span class="ident" id="5366246">intEncoder</span><span class="op" id="5366256">(</span><span class="ident" id="5366257">e</span>&nbsp;<span class="op" id="5366259">*</span><span class="ident" id="5366260">encodeState</span><span class="op" id="5366271">,</span>&nbsp;<span class="ident" id="5366273">v</span>&nbsp;<span class="ident" id="5366275">reflect</span><span class="op" id="5366282">.</span><span class="ident" id="5366283">Value</span><span class="op" id="5366288">,</span>&nbsp;<span class="ident" id="5366290">quoted</span>&nbsp;<span class="builtintype" id="5366297">bool</span><span class="op" id="5366301">)</span>&nbsp;<span class="op" id="5366303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366306">b</span>&nbsp;<span class="op" id="5366308">:=</span>&nbsp;<span class="ident" id="5366311">strconv</span><span class="op" id="5366318">.</span><span class="ident" id="5366319">AppendInt</span><span class="op" id="5366328">(</span><span class="ident" id="5366329">e</span><span class="op" id="5366330">.</span><span class="ident" id="5366331">scratch</span><span class="op" id="5366338">[</span><span class="op" id="5366339">:</span><span class="num" id="5366340">0</span><span class="op" id="5366341">]</span><span class="op" id="5366342">,</span>&nbsp;<span class="ident" id="5366344">v</span><span class="op" id="5366345">.</span><span class="ident" id="5366346">Int</span><span class="op" id="5366349">(</span><span class="op" id="5366350">)</span><span class="op" id="5366351">,</span>&nbsp;<span class="num" id="5366353">10</span><span class="op" id="5366355">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366358">if</span>&nbsp;<span class="ident" id="5366361">quoted</span>&nbsp;<span class="op" id="5366368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366372">e</span><span class="op" id="5366373">.</span><span class="ident" id="5366374">WriteByte</span><span class="op" id="5366383">(</span><span class="string" id="5366384">&#39;&#34;&#39;</span><span class="op" id="5366387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366393">e</span><span class="op" id="5366394">.</span><span class="ident" id="5366395">Write</span><span class="op" id="5366400">(</span><span class="ident" id="5366401">b</span><span class="op" id="5366402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366405">if</span>&nbsp;<span class="ident" id="5366408">quoted</span>&nbsp;<span class="op" id="5366415">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366419">e</span><span class="op" id="5366420">.</span><span class="ident" id="5366421">WriteByte</span><span class="op" id="5366430">(</span><span class="string" id="5366431">&#39;&#34;&#39;</span><span class="op" id="5366434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366437">}</span><br>
<span class="lineno"></span><span class="op" id="5366439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5366442">func</span>&nbsp;<span class="ident" id="5366447">uintEncoder</span><span class="op" id="5366458">(</span><span class="ident" id="5366459">e</span>&nbsp;<span class="op" id="5366461">*</span><span class="ident" id="5366462">encodeState</span><span class="op" id="5366473">,</span>&nbsp;<span class="ident" id="5366475">v</span>&nbsp;<span class="ident" id="5366477">reflect</span><span class="op" id="5366484">.</span><span class="ident" id="5366485">Value</span><span class="op" id="5366490">,</span>&nbsp;<span class="ident" id="5366492">quoted</span>&nbsp;<span class="builtintype" id="5366499">bool</span><span class="op" id="5366503">)</span>&nbsp;<span class="op" id="5366505">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366508">b</span>&nbsp;<span class="op" id="5366510">:=</span>&nbsp;<span class="ident" id="5366513">strconv</span><span class="op" id="5366520">.</span><span class="ident" id="5366521">AppendUint</span><span class="op" id="5366531">(</span><span class="ident" id="5366532">e</span><span class="op" id="5366533">.</span><span class="ident" id="5366534">scratch</span><span class="op" id="5366541">[</span><span class="op" id="5366542">:</span><span class="num" id="5366543">0</span><span class="op" id="5366544">]</span><span class="op" id="5366545">,</span>&nbsp;<span class="ident" id="5366547">v</span><span class="op" id="5366548">.</span><span class="ident" id="5366549">Uint</span><span class="op" id="5366553">(</span><span class="op" id="5366554">)</span><span class="op" id="5366555">,</span>&nbsp;<span class="num" id="5366557">10</span><span class="op" id="5366559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366562">if</span>&nbsp;<span class="ident" id="5366565">quoted</span>&nbsp;<span class="op" id="5366572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366576">e</span><span class="op" id="5366577">.</span><span class="ident" id="5366578">WriteByte</span><span class="op" id="5366587">(</span><span class="string" id="5366588">&#39;&#34;&#39;</span><span class="op" id="5366591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366597">e</span><span class="op" id="5366598">.</span><span class="ident" id="5366599">Write</span><span class="op" id="5366604">(</span><span class="ident" id="5366605">b</span><span class="op" id="5366606">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366609">if</span>&nbsp;<span class="ident" id="5366612">quoted</span>&nbsp;<span class="op" id="5366619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366623">e</span><span class="op" id="5366624">.</span><span class="ident" id="5366625">WriteByte</span><span class="op" id="5366634">(</span><span class="string" id="5366635">&#39;&#34;&#39;</span><span class="op" id="5366638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366641">}</span><br>
<span class="lineno"></span><span class="op" id="5366643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="5366646">type</span>&nbsp;<span class="ident" id="5366651">floatEncoder</span>&nbsp;<span class="builtintype" id="5366664">int</span>&nbsp;<span class="comment" id="5366668">//&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5366687">func</span>&nbsp;<span class="op" id="5366692">(</span><span class="ident" id="5366693">bits</span>&nbsp;<span class="ident" id="5366698">floatEncoder</span><span class="op" id="5366710">)</span>&nbsp;<span class="ident" id="5366712">encode</span><span class="op" id="5366718">(</span><span class="ident" id="5366719">e</span>&nbsp;<span class="op" id="5366721">*</span><span class="ident" id="5366722">encodeState</span><span class="op" id="5366733">,</span>&nbsp;<span class="ident" id="5366735">v</span>&nbsp;<span class="ident" id="5366737">reflect</span><span class="op" id="5366744">.</span><span class="ident" id="5366745">Value</span><span class="op" id="5366750">,</span>&nbsp;<span class="ident" id="5366752">quoted</span>&nbsp;<span class="builtintype" id="5366759">bool</span><span class="op" id="5366763">)</span>&nbsp;<span class="op" id="5366765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366768">f</span>&nbsp;<span class="op" id="5366770">:=</span>&nbsp;<span class="ident" id="5366773">v</span><span class="op" id="5366774">.</span><span class="ident" id="5366775">Float</span><span class="op" id="5366780">(</span><span class="op" id="5366781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366784">if</span>&nbsp;<span class="ident" id="5366787">math</span><span class="op" id="5366791">.</span><span class="ident" id="5366792">IsInf</span><span class="op" id="5366797">(</span><span class="ident" id="5366798">f</span><span class="op" id="5366799">,</span>&nbsp;<span class="num" id="5366801">0</span><span class="op" id="5366802">)</span>&nbsp;<span class="op" id="5366804">||</span>&nbsp;<span class="ident" id="5366807">math</span><span class="op" id="5366811">.</span><span class="ident" id="5366812">IsNaN</span><span class="op" id="5366817">(</span><span class="ident" id="5366818">f</span><span class="op" id="5366819">)</span>&nbsp;<span class="op" id="5366821">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366825">e</span><span class="op" id="5366826">.</span><span class="builtintype" id="5366827">error</span><span class="op" id="5366832">(</span><span class="op" id="5366833">&amp;</span><span class="ident" id="5366834">UnsupportedValueError</span><span class="op" id="5366855">{</span><span class="ident" id="5366856">v</span><span class="op" id="5366857">,</span>&nbsp;<span class="ident" id="5366859">strconv</span><span class="op" id="5366866">.</span><span class="ident" id="5366867">FormatFloat</span><span class="op" id="5366878">(</span><span class="ident" id="5366879">f</span><span class="op" id="5366880">,</span>&nbsp;<span class="string" id="5366882">&#39;g&#39;</span><span class="op" id="5366885">,</span>&nbsp;<span class="op" id="5366887">-</span><span class="num" id="5366888">1</span><span class="op" id="5366889">,</span>&nbsp;<span class="builtintype" id="5366891">int</span><span class="op" id="5366894">(</span><span class="ident" id="5366895">bits</span><span class="op" id="5366899">)</span><span class="op" id="5366900">)</span><span class="op" id="5366901">}</span><span class="op" id="5366902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366908">b</span>&nbsp;<span class="op" id="5366910">:=</span>&nbsp;<span class="ident" id="5366913">strconv</span><span class="op" id="5366920">.</span><span class="ident" id="5366921">AppendFloat</span><span class="op" id="5366932">(</span><span class="ident" id="5366933">e</span><span class="op" id="5366934">.</span><span class="ident" id="5366935">scratch</span><span class="op" id="5366942">[</span><span class="op" id="5366943">:</span><span class="num" id="5366944">0</span><span class="op" id="5366945">]</span><span class="op" id="5366946">,</span>&nbsp;<span class="ident" id="5366948">f</span><span class="op" id="5366949">,</span>&nbsp;<span class="string" id="5366951">&#39;g&#39;</span><span class="op" id="5366954">,</span>&nbsp;<span class="op" id="5366956">-</span><span class="num" id="5366957">1</span><span class="op" id="5366958">,</span>&nbsp;<span class="builtintype" id="5366960">int</span><span class="op" id="5366963">(</span><span class="ident" id="5366964">bits</span><span class="op" id="5366968">)</span><span class="op" id="5366969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366972">if</span>&nbsp;<span class="ident" id="5366975">quoted</span>&nbsp;<span class="op" id="5366982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366986">e</span><span class="op" id="5366987">.</span><span class="ident" id="5366988">WriteByte</span><span class="op" id="5366997">(</span><span class="string" id="5366998">&#39;&#34;&#39;</span><span class="op" id="5367001">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367007">e</span><span class="op" id="5367008">.</span><span class="ident" id="5367009">Write</span><span class="op" id="5367014">(</span><span class="ident" id="5367015">b</span><span class="op" id="5367016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367019">if</span>&nbsp;<span class="ident" id="5367022">quoted</span>&nbsp;<span class="op" id="5367029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367033">e</span><span class="op" id="5367034">.</span><span class="ident" id="5367035">WriteByte</span><span class="op" id="5367044">(</span><span class="string" id="5367045">&#39;&#34;&#39;</span><span class="op" id="5367048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367051">}</span><br>
<span class="lineno">525</span><span class="op" id="5367053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5367056">var</span>&nbsp;<span class="op" id="5367060">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367063">float32Encoder</span>&nbsp;<span class="op" id="5367078">=</span>&nbsp;<span class="op" id="5367080">(</span><span class="ident" id="5367081">floatEncoder</span><span class="op" id="5367093">(</span><span class="num" id="5367094">32</span><span class="op" id="5367096">)</span><span class="op" id="5367097">)</span><span class="op" id="5367098">.</span><span class="ident" id="5367099">encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367107">float64Encoder</span>&nbsp;<span class="op" id="5367122">=</span>&nbsp;<span class="op" id="5367124">(</span><span class="ident" id="5367125">floatEncoder</span><span class="op" id="5367137">(</span><span class="num" id="5367138">64</span><span class="op" id="5367140">)</span><span class="op" id="5367141">)</span><span class="op" id="5367142">.</span><span class="ident" id="5367143">encode</span><br>
<span class="lineno">530</span><span class="op" id="5367150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5367153">func</span>&nbsp;<span class="ident" id="5367158">stringEncoder</span><span class="op" id="5367171">(</span><span class="ident" id="5367172">e</span>&nbsp;<span class="op" id="5367174">*</span><span class="ident" id="5367175">encodeState</span><span class="op" id="5367186">,</span>&nbsp;<span class="ident" id="5367188">v</span>&nbsp;<span class="ident" id="5367190">reflect</span><span class="op" id="5367197">.</span><span class="ident" id="5367198">Value</span><span class="op" id="5367203">,</span>&nbsp;<span class="ident" id="5367205">quoted</span>&nbsp;<span class="builtintype" id="5367212">bool</span><span class="op" id="5367216">)</span>&nbsp;<span class="op" id="5367218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367221">if</span>&nbsp;<span class="ident" id="5367224">v</span><span class="op" id="5367225">.</span><span class="ident" id="5367226">Type</span><span class="op" id="5367230">(</span><span class="op" id="5367231">)</span>&nbsp;<span class="op" id="5367233">==</span>&nbsp;<span class="ident" id="5367236">numberType</span>&nbsp;<span class="op" id="5367247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367251">numStr</span>&nbsp;<span class="op" id="5367258">:=</span>&nbsp;<span class="ident" id="5367261">v</span><span class="op" id="5367262">.</span><span class="ident" id="5367263">String</span><span class="op" id="5367269">(</span><span class="op" id="5367270">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367274">if</span>&nbsp;<span class="ident" id="5367277">numStr</span>&nbsp;<span class="op" id="5367284">==</span>&nbsp;<span class="string" id="5367287">&#34;&#34;</span>&nbsp;<span class="op" id="5367290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367295">numStr</span>&nbsp;<span class="op" id="5367302">=</span>&nbsp;<span class="string" id="5367304">&#34;0&#34;</span>&nbsp;<span class="comment" id="5367308">//&nbsp;Number&#39;s&nbsp;zero-val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367335">e</span><span class="op" id="5367336">.</span><span class="ident" id="5367337">WriteString</span><span class="op" id="5367348">(</span><span class="ident" id="5367349">numStr</span><span class="op" id="5367355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367359">return</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367370">if</span>&nbsp;<span class="ident" id="5367373">quoted</span>&nbsp;<span class="op" id="5367380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367384">sb</span><span class="op" id="5367386">,</span>&nbsp;<span class="ident" id="5367388">err</span>&nbsp;<span class="op" id="5367392">:=</span>&nbsp;<span class="ident" id="5367395">Marshal</span><span class="op" id="5367402">(</span><span class="ident" id="5367403">v</span><span class="op" id="5367404">.</span><span class="ident" id="5367405">String</span><span class="op" id="5367411">(</span><span class="op" id="5367412">)</span><span class="op" id="5367413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367417">if</span>&nbsp;<span class="ident" id="5367420">err</span>&nbsp;<span class="op" id="5367424">!=</span>&nbsp;<span class="builtintype" id="5367427">nil</span>&nbsp;<span class="op" id="5367431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367436">e</span><span class="op" id="5367437">.</span><span class="builtintype" id="5367438">error</span><span class="op" id="5367443">(</span><span class="ident" id="5367444">err</span><span class="op" id="5367447">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367455">e</span><span class="op" id="5367456">.</span><span class="builtintype" id="5367457">string</span><span class="op" id="5367463">(</span><span class="builtintype" id="5367464">string</span><span class="op" id="5367470">(</span><span class="ident" id="5367471">sb</span><span class="op" id="5367473">)</span><span class="op" id="5367474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367477">}</span>&nbsp;<span class="keyword" id="5367479">else</span>&nbsp;<span class="op" id="5367484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367488">e</span><span class="op" id="5367489">.</span><span class="builtintype" id="5367490">string</span><span class="op" id="5367496">(</span><span class="ident" id="5367497">v</span><span class="op" id="5367498">.</span><span class="ident" id="5367499">String</span><span class="op" id="5367505">(</span><span class="op" id="5367506">)</span><span class="op" id="5367507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367510">}</span><br>
<span class="lineno">550</span><span class="op" id="5367512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5367515">func</span>&nbsp;<span class="ident" id="5367520">interfaceEncoder</span><span class="op" id="5367536">(</span><span class="ident" id="5367537">e</span>&nbsp;<span class="op" id="5367539">*</span><span class="ident" id="5367540">encodeState</span><span class="op" id="5367551">,</span>&nbsp;<span class="ident" id="5367553">v</span>&nbsp;<span class="ident" id="5367555">reflect</span><span class="op" id="5367562">.</span><span class="ident" id="5367563">Value</span><span class="op" id="5367568">,</span>&nbsp;<span class="ident" id="5367570">quoted</span>&nbsp;<span class="builtintype" id="5367577">bool</span><span class="op" id="5367581">)</span>&nbsp;<span class="op" id="5367583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367586">if</span>&nbsp;<span class="ident" id="5367589">v</span><span class="op" id="5367590">.</span><span class="ident" id="5367591">IsNil</span><span class="op" id="5367596">(</span><span class="op" id="5367597">)</span>&nbsp;<span class="op" id="5367599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367603">e</span><span class="op" id="5367604">.</span><span class="ident" id="5367605">WriteString</span><span class="op" id="5367616">(</span><span class="string" id="5367617">&#34;null&#34;</span><span class="op" id="5367623">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367638">e</span><span class="op" id="5367639">.</span><span class="ident" id="5367640">reflectValue</span><span class="op" id="5367652">(</span><span class="ident" id="5367653">v</span><span class="op" id="5367654">.</span><span class="ident" id="5367655">Elem</span><span class="op" id="5367659">(</span><span class="op" id="5367660">)</span><span class="op" id="5367661">)</span><br>
<span class="lineno"></span><span class="op" id="5367663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="5367666">func</span>&nbsp;<span class="ident" id="5367671">unsupportedTypeEncoder</span><span class="op" id="5367693">(</span><span class="ident" id="5367694">e</span>&nbsp;<span class="op" id="5367696">*</span><span class="ident" id="5367697">encodeState</span><span class="op" id="5367708">,</span>&nbsp;<span class="ident" id="5367710">v</span>&nbsp;<span class="ident" id="5367712">reflect</span><span class="op" id="5367719">.</span><span class="ident" id="5367720">Value</span><span class="op" id="5367725">,</span>&nbsp;<span class="ident" id="5367727">quoted</span>&nbsp;<span class="builtintype" id="5367734">bool</span><span class="op" id="5367738">)</span>&nbsp;<span class="op" id="5367740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367743">e</span><span class="op" id="5367744">.</span><span class="builtintype" id="5367745">error</span><span class="op" id="5367750">(</span><span class="op" id="5367751">&amp;</span><span class="ident" id="5367752">UnsupportedTypeError</span><span class="op" id="5367772">{</span><span class="ident" id="5367773">v</span><span class="op" id="5367774">.</span><span class="ident" id="5367775">Type</span><span class="op" id="5367779">(</span><span class="op" id="5367780">)</span><span class="op" id="5367781">}</span><span class="op" id="5367782">)</span><br>
<span class="lineno"></span><span class="op" id="5367784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5367787">type</span>&nbsp;<span class="ident" id="5367792">structEncoder</span>&nbsp;<span class="keyword" id="5367806">struct</span>&nbsp;<span class="op" id="5367813">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367816">fields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367826">[</span><span class="op" id="5367827">]</span><span class="ident" id="5367828">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367835">fieldEncs</span>&nbsp;<span class="op" id="5367845">[</span><span class="op" id="5367846">]</span><span class="ident" id="5367847">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5367859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5367862">func</span>&nbsp;<span class="op" id="5367867">(</span><span class="ident" id="5367868">se</span>&nbsp;<span class="op" id="5367871">*</span><span class="ident" id="5367872">structEncoder</span><span class="op" id="5367885">)</span>&nbsp;<span class="ident" id="5367887">encode</span><span class="op" id="5367893">(</span><span class="ident" id="5367894">e</span>&nbsp;<span class="op" id="5367896">*</span><span class="ident" id="5367897">encodeState</span><span class="op" id="5367908">,</span>&nbsp;<span class="ident" id="5367910">v</span>&nbsp;<span class="ident" id="5367912">reflect</span><span class="op" id="5367919">.</span><span class="ident" id="5367920">Value</span><span class="op" id="5367925">,</span>&nbsp;<span class="ident" id="5367927">quoted</span>&nbsp;<span class="builtintype" id="5367934">bool</span><span class="op" id="5367938">)</span>&nbsp;<span class="op" id="5367940">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367943">e</span><span class="op" id="5367944">.</span><span class="ident" id="5367945">WriteByte</span><span class="op" id="5367954">(</span><span class="string" id="5367955">&#39;{&#39;</span><span class="op" id="5367958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367961">first</span>&nbsp;<span class="op" id="5367967">:=</span>&nbsp;<span class="builtintype" id="5367970">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367976">for</span>&nbsp;<span class="ident" id="5367980">i</span><span class="op" id="5367981">,</span>&nbsp;<span class="ident" id="5367983">f</span>&nbsp;<span class="op" id="5367985">:=</span>&nbsp;<span class="keyword" id="5367988">range</span>&nbsp;<span class="ident" id="5367994">se</span><span class="op" id="5367996">.</span><span class="ident" id="5367997">fields</span>&nbsp;<span class="op" id="5368004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368008">fv</span>&nbsp;<span class="op" id="5368011">:=</span>&nbsp;<span class="ident" id="5368014">fieldByIndex</span><span class="op" id="5368026">(</span><span class="ident" id="5368027">v</span><span class="op" id="5368028">,</span>&nbsp;<span class="ident" id="5368030">f</span><span class="op" id="5368031">.</span><span class="ident" id="5368032">index</span><span class="op" id="5368037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368041">if</span>&nbsp;<span class="op" id="5368044">!</span><span class="ident" id="5368045">fv</span><span class="op" id="5368047">.</span><span class="ident" id="5368048">IsValid</span><span class="op" id="5368055">(</span><span class="op" id="5368056">)</span>&nbsp;<span class="op" id="5368058">||</span>&nbsp;<span class="ident" id="5368061">f</span><span class="op" id="5368062">.</span><span class="ident" id="5368063">omitEmpty</span>&nbsp;<span class="op" id="5368073">&amp;&amp;</span>&nbsp;<span class="ident" id="5368076">isEmptyValue</span><span class="op" id="5368088">(</span><span class="ident" id="5368089">fv</span><span class="op" id="5368091">)</span>&nbsp;<span class="op" id="5368093">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368113">if</span>&nbsp;<span class="ident" id="5368116">first</span>&nbsp;<span class="op" id="5368122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368127">first</span>&nbsp;<span class="op" id="5368133">=</span>&nbsp;<span class="builtintype" id="5368135">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368143">}</span>&nbsp;<span class="keyword" id="5368145">else</span>&nbsp;<span class="op" id="5368150">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368155">e</span><span class="op" id="5368156">.</span><span class="ident" id="5368157">WriteByte</span><span class="op" id="5368166">(</span><span class="string" id="5368167">&#39;,&#39;</span><span class="op" id="5368170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368178">e</span><span class="op" id="5368179">.</span><span class="builtintype" id="5368180">string</span><span class="op" id="5368186">(</span><span class="ident" id="5368187">f</span><span class="op" id="5368188">.</span><span class="ident" id="5368189">name</span><span class="op" id="5368193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368197">e</span><span class="op" id="5368198">.</span><span class="ident" id="5368199">WriteByte</span><span class="op" id="5368208">(</span><span class="string" id="5368209">&#39;:&#39;</span><span class="op" id="5368212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368216">se</span><span class="op" id="5368218">.</span><span class="ident" id="5368219">fieldEncs</span><span class="op" id="5368228">[</span><span class="ident" id="5368229">i</span><span class="op" id="5368230">]</span><span class="op" id="5368231">(</span><span class="ident" id="5368232">e</span><span class="op" id="5368233">,</span>&nbsp;<span class="ident" id="5368235">fv</span><span class="op" id="5368237">,</span>&nbsp;<span class="ident" id="5368239">f</span><span class="op" id="5368240">.</span><span class="ident" id="5368241">quoted</span><span class="op" id="5368247">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368253">e</span><span class="op" id="5368254">.</span><span class="ident" id="5368255">WriteByte</span><span class="op" id="5368264">(</span><span class="string" id="5368265">&#39;}&#39;</span><span class="op" id="5368268">)</span><br>
<span class="lineno"></span><span class="op" id="5368270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5368273">func</span>&nbsp;<span class="ident" id="5368278">newStructEncoder</span><span class="op" id="5368294">(</span><span class="ident" id="5368295">t</span>&nbsp;<span class="ident" id="5368297">reflect</span><span class="op" id="5368304">.</span><span class="ident" id="5368305">Type</span><span class="op" id="5368309">)</span>&nbsp;<span class="ident" id="5368311">encoderFunc</span>&nbsp;<span class="op" id="5368323">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368326">fields</span>&nbsp;<span class="op" id="5368333">:=</span>&nbsp;<span class="ident" id="5368336">cachedTypeFields</span><span class="op" id="5368352">(</span><span class="ident" id="5368353">t</span><span class="op" id="5368354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368357">se</span>&nbsp;<span class="op" id="5368360">:=</span>&nbsp;<span class="op" id="5368363">&amp;</span><span class="ident" id="5368364">structEncoder</span><span class="op" id="5368377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368381">fields</span><span class="op" id="5368387">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368392">fields</span><span class="op" id="5368398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368402">fieldEncs</span><span class="op" id="5368411">:</span>&nbsp;<span class="builtinfunc" id="5368413">make</span><span class="op" id="5368417">(</span><span class="op" id="5368418">[</span><span class="op" id="5368419">]</span><span class="ident" id="5368420">encoderFunc</span><span class="op" id="5368431">,</span>&nbsp;<span class="builtinfunc" id="5368433">len</span><span class="op" id="5368436">(</span><span class="ident" id="5368437">fields</span><span class="op" id="5368443">)</span><span class="op" id="5368444">)</span><span class="op" id="5368445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368448">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368451">for</span>&nbsp;<span class="ident" id="5368455">i</span><span class="op" id="5368456">,</span>&nbsp;<span class="ident" id="5368458">f</span>&nbsp;<span class="op" id="5368460">:=</span>&nbsp;<span class="keyword" id="5368463">range</span>&nbsp;<span class="ident" id="5368469">fields</span>&nbsp;<span class="op" id="5368476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368480">se</span><span class="op" id="5368482">.</span><span class="ident" id="5368483">fieldEncs</span><span class="op" id="5368492">[</span><span class="ident" id="5368493">i</span><span class="op" id="5368494">]</span>&nbsp;<span class="op" id="5368496">=</span>&nbsp;<span class="ident" id="5368498">typeEncoder</span><span class="op" id="5368509">(</span><span class="ident" id="5368510">typeByIndex</span><span class="op" id="5368521">(</span><span class="ident" id="5368522">t</span><span class="op" id="5368523">,</span>&nbsp;<span class="ident" id="5368525">f</span><span class="op" id="5368526">.</span><span class="ident" id="5368527">index</span><span class="op" id="5368532">)</span><span class="op" id="5368533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368539">return</span>&nbsp;<span class="ident" id="5368546">se</span><span class="op" id="5368548">.</span><span class="ident" id="5368549">encode</span><br>
<span class="lineno"></span><span class="op" id="5368556">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="5368559">type</span>&nbsp;<span class="ident" id="5368564">mapEncoder</span>&nbsp;<span class="keyword" id="5368575">struct</span>&nbsp;<span class="op" id="5368582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368585">elemEnc</span>&nbsp;<span class="ident" id="5368593">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5368605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="keyword" id="5368608">func</span>&nbsp;<span class="op" id="5368613">(</span><span class="ident" id="5368614">me</span>&nbsp;<span class="op" id="5368617">*</span><span class="ident" id="5368618">mapEncoder</span><span class="op" id="5368628">)</span>&nbsp;<span class="ident" id="5368630">encode</span><span class="op" id="5368636">(</span><span class="ident" id="5368637">e</span>&nbsp;<span class="op" id="5368639">*</span><span class="ident" id="5368640">encodeState</span><span class="op" id="5368651">,</span>&nbsp;<span class="ident" id="5368653">v</span>&nbsp;<span class="ident" id="5368655">reflect</span><span class="op" id="5368662">.</span><span class="ident" id="5368663">Value</span><span class="op" id="5368668">,</span>&nbsp;<span class="ident" id="5368670">_</span>&nbsp;<span class="builtintype" id="5368672">bool</span><span class="op" id="5368676">)</span>&nbsp;<span class="op" id="5368678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368681">if</span>&nbsp;<span class="ident" id="5368684">v</span><span class="op" id="5368685">.</span><span class="ident" id="5368686">IsNil</span><span class="op" id="5368691">(</span><span class="op" id="5368692">)</span>&nbsp;<span class="op" id="5368694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368698">e</span><span class="op" id="5368699">.</span><span class="ident" id="5368700">WriteString</span><span class="op" id="5368711">(</span><span class="string" id="5368712">&#34;null&#34;</span><span class="op" id="5368718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368722">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368730">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368733">e</span><span class="op" id="5368734">.</span><span class="ident" id="5368735">WriteByte</span><span class="op" id="5368744">(</span><span class="string" id="5368745">&#39;{&#39;</span><span class="op" id="5368748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368751">var</span>&nbsp;<span class="ident" id="5368755">sv</span>&nbsp;<span class="ident" id="5368758">stringValues</span>&nbsp;<span class="op" id="5368771">=</span>&nbsp;<span class="ident" id="5368773">v</span><span class="op" id="5368774">.</span><span class="ident" id="5368775">MapKeys</span><span class="op" id="5368782">(</span><span class="op" id="5368783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368786">sort</span><span class="op" id="5368790">.</span><span class="ident" id="5368791">Sort</span><span class="op" id="5368795">(</span><span class="ident" id="5368796">sv</span><span class="op" id="5368798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368801">for</span>&nbsp;<span class="ident" id="5368805">i</span><span class="op" id="5368806">,</span>&nbsp;<span class="ident" id="5368808">k</span>&nbsp;<span class="op" id="5368810">:=</span>&nbsp;<span class="keyword" id="5368813">range</span>&nbsp;<span class="ident" id="5368819">sv</span>&nbsp;<span class="op" id="5368822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368826">if</span>&nbsp;<span class="ident" id="5368829">i</span>&nbsp;<span class="op" id="5368831">&gt;</span>&nbsp;<span class="num" id="5368833">0</span>&nbsp;<span class="op" id="5368835">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368840">e</span><span class="op" id="5368841">.</span><span class="ident" id="5368842">WriteByte</span><span class="op" id="5368851">(</span><span class="string" id="5368852">&#39;,&#39;</span><span class="op" id="5368855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368863">e</span><span class="op" id="5368864">.</span><span class="builtintype" id="5368865">string</span><span class="op" id="5368871">(</span><span class="ident" id="5368872">k</span><span class="op" id="5368873">.</span><span class="ident" id="5368874">String</span><span class="op" id="5368880">(</span><span class="op" id="5368881">)</span><span class="op" id="5368882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368886">e</span><span class="op" id="5368887">.</span><span class="ident" id="5368888">WriteByte</span><span class="op" id="5368897">(</span><span class="string" id="5368898">&#39;:&#39;</span><span class="op" id="5368901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368905">me</span><span class="op" id="5368907">.</span><span class="ident" id="5368908">elemEnc</span><span class="op" id="5368915">(</span><span class="ident" id="5368916">e</span><span class="op" id="5368917">,</span>&nbsp;<span class="ident" id="5368919">v</span><span class="op" id="5368920">.</span><span class="ident" id="5368921">MapIndex</span><span class="op" id="5368929">(</span><span class="ident" id="5368930">k</span><span class="op" id="5368931">)</span><span class="op" id="5368932">,</span>&nbsp;<span class="builtintype" id="5368934">false</span><span class="op" id="5368939">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368945">e</span><span class="op" id="5368946">.</span><span class="ident" id="5368947">WriteByte</span><span class="op" id="5368956">(</span><span class="string" id="5368957">&#39;}&#39;</span><span class="op" id="5368960">)</span><br>
<span class="lineno"></span><span class="op" id="5368962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5368965">func</span>&nbsp;<span class="ident" id="5368970">newMapEncoder</span><span class="op" id="5368983">(</span><span class="ident" id="5368984">t</span>&nbsp;<span class="ident" id="5368986">reflect</span><span class="op" id="5368993">.</span><span class="ident" id="5368994">Type</span><span class="op" id="5368998">)</span>&nbsp;<span class="ident" id="5369000">encoderFunc</span>&nbsp;<span class="op" id="5369012">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369015">if</span>&nbsp;<span class="ident" id="5369018">t</span><span class="op" id="5369019">.</span><span class="ident" id="5369020">Key</span><span class="op" id="5369023">(</span><span class="op" id="5369024">)</span><span class="op" id="5369025">.</span><span class="ident" id="5369026">Kind</span><span class="op" id="5369030">(</span><span class="op" id="5369031">)</span>&nbsp;<span class="op" id="5369033">!=</span>&nbsp;<span class="ident" id="5369036">reflect</span><span class="op" id="5369043">.</span><span class="ident" id="5369044">String</span>&nbsp;<span class="op" id="5369051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369055">return</span>&nbsp;<span class="ident" id="5369062">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369089">me</span>&nbsp;<span class="op" id="5369092">:=</span>&nbsp;<span class="op" id="5369095">&amp;</span><span class="ident" id="5369096">mapEncoder</span><span class="op" id="5369106">{</span><span class="ident" id="5369107">typeEncoder</span><span class="op" id="5369118">(</span><span class="ident" id="5369119">t</span><span class="op" id="5369120">.</span><span class="ident" id="5369121">Elem</span><span class="op" id="5369125">(</span><span class="op" id="5369126">)</span><span class="op" id="5369127">)</span><span class="op" id="5369128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369131">return</span>&nbsp;<span class="ident" id="5369138">me</span><span class="op" id="5369140">.</span><span class="ident" id="5369141">encode</span><br>
<span class="lineno">630</span><span class="op" id="5369148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5369151">func</span>&nbsp;<span class="ident" id="5369156">encodeByteSlice</span><span class="op" id="5369171">(</span><span class="ident" id="5369172">e</span>&nbsp;<span class="op" id="5369174">*</span><span class="ident" id="5369175">encodeState</span><span class="op" id="5369186">,</span>&nbsp;<span class="ident" id="5369188">v</span>&nbsp;<span class="ident" id="5369190">reflect</span><span class="op" id="5369197">.</span><span class="ident" id="5369198">Value</span><span class="op" id="5369203">,</span>&nbsp;<span class="ident" id="5369205">_</span>&nbsp;<span class="builtintype" id="5369207">bool</span><span class="op" id="5369211">)</span>&nbsp;<span class="op" id="5369213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369216">if</span>&nbsp;<span class="ident" id="5369219">v</span><span class="op" id="5369220">.</span><span class="ident" id="5369221">IsNil</span><span class="op" id="5369226">(</span><span class="op" id="5369227">)</span>&nbsp;<span class="op" id="5369229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369233">e</span><span class="op" id="5369234">.</span><span class="ident" id="5369235">WriteString</span><span class="op" id="5369246">(</span><span class="string" id="5369247">&#34;null&#34;</span><span class="op" id="5369253">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369257">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369268">s</span>&nbsp;<span class="op" id="5369270">:=</span>&nbsp;<span class="ident" id="5369273">v</span><span class="op" id="5369274">.</span><span class="ident" id="5369275">Bytes</span><span class="op" id="5369280">(</span><span class="op" id="5369281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369284">e</span><span class="op" id="5369285">.</span><span class="ident" id="5369286">WriteByte</span><span class="op" id="5369295">(</span><span class="string" id="5369296">&#39;&#34;&#39;</span><span class="op" id="5369299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369302">if</span>&nbsp;<span class="builtinfunc" id="5369305">len</span><span class="op" id="5369308">(</span><span class="ident" id="5369309">s</span><span class="op" id="5369310">)</span>&nbsp;<span class="op" id="5369312">&lt;</span>&nbsp;<span class="num" id="5369314">1024</span>&nbsp;<span class="op" id="5369319">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369323">//&nbsp;for&nbsp;small&nbsp;buffers,&nbsp;using&nbsp;Encode&nbsp;directly&nbsp;is&nbsp;much&nbsp;faster.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369385">dst</span>&nbsp;<span class="op" id="5369389">:=</span>&nbsp;<span class="builtinfunc" id="5369392">make</span><span class="op" id="5369396">(</span><span class="op" id="5369397">[</span><span class="op" id="5369398">]</span><span class="builtintype" id="5369399">byte</span><span class="op" id="5369403">,</span>&nbsp;<span class="ident" id="5369405">base64</span><span class="op" id="5369411">.</span><span class="ident" id="5369412">StdEncoding</span><span class="op" id="5369423">.</span><span class="ident" id="5369424">EncodedLen</span><span class="op" id="5369434">(</span><span class="builtinfunc" id="5369435">len</span><span class="op" id="5369438">(</span><span class="ident" id="5369439">s</span><span class="op" id="5369440">)</span><span class="op" id="5369441">)</span><span class="op" id="5369442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369446">base64</span><span class="op" id="5369452">.</span><span class="ident" id="5369453">StdEncoding</span><span class="op" id="5369464">.</span><span class="ident" id="5369465">Encode</span><span class="op" id="5369471">(</span><span class="ident" id="5369472">dst</span><span class="op" id="5369475">,</span>&nbsp;<span class="ident" id="5369477">s</span><span class="op" id="5369478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369482">e</span><span class="op" id="5369483">.</span><span class="ident" id="5369484">Write</span><span class="op" id="5369489">(</span><span class="ident" id="5369490">dst</span><span class="op" id="5369493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369496">}</span>&nbsp;<span class="keyword" id="5369498">else</span>&nbsp;<span class="op" id="5369503">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369507">//&nbsp;for&nbsp;large&nbsp;buffers,&nbsp;avoid&nbsp;unnecessary&nbsp;extra&nbsp;temporary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369565">//&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369584">enc</span>&nbsp;<span class="op" id="5369588">:=</span>&nbsp;<span class="ident" id="5369591">base64</span><span class="op" id="5369597">.</span><span class="ident" id="5369598">NewEncoder</span><span class="op" id="5369608">(</span><span class="ident" id="5369609">base64</span><span class="op" id="5369615">.</span><span class="ident" id="5369616">StdEncoding</span><span class="op" id="5369627">,</span>&nbsp;<span class="ident" id="5369629">e</span><span class="op" id="5369630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369634">enc</span><span class="op" id="5369637">.</span><span class="ident" id="5369638">Write</span><span class="op" id="5369643">(</span><span class="ident" id="5369644">s</span><span class="op" id="5369645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369649">enc</span><span class="op" id="5369652">.</span><span class="ident" id="5369653">Close</span><span class="op" id="5369658">(</span><span class="op" id="5369659">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369665">e</span><span class="op" id="5369666">.</span><span class="ident" id="5369667">WriteByte</span><span class="op" id="5369676">(</span><span class="string" id="5369677">&#39;&#34;&#39;</span><span class="op" id="5369680">)</span><br>
<span class="lineno"></span><span class="op" id="5369682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5369685">//&nbsp;sliceEncoder&nbsp;just&nbsp;wraps&nbsp;an&nbsp;arrayEncoder,&nbsp;checking&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;value&nbsp;isn&#39;t&nbsp;nil.</span><br>
<span class="lineno">655</span><span class="keyword" id="5369772">type</span>&nbsp;<span class="ident" id="5369777">sliceEncoder</span>&nbsp;<span class="keyword" id="5369790">struct</span>&nbsp;<span class="op" id="5369797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369800">arrayEnc</span>&nbsp;<span class="ident" id="5369809">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5369821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5369824">func</span>&nbsp;<span class="op" id="5369829">(</span><span class="ident" id="5369830">se</span>&nbsp;<span class="op" id="5369833">*</span><span class="ident" id="5369834">sliceEncoder</span><span class="op" id="5369846">)</span>&nbsp;<span class="ident" id="5369848">encode</span><span class="op" id="5369854">(</span><span class="ident" id="5369855">e</span>&nbsp;<span class="op" id="5369857">*</span><span class="ident" id="5369858">encodeState</span><span class="op" id="5369869">,</span>&nbsp;<span class="ident" id="5369871">v</span>&nbsp;<span class="ident" id="5369873">reflect</span><span class="op" id="5369880">.</span><span class="ident" id="5369881">Value</span><span class="op" id="5369886">,</span>&nbsp;<span class="ident" id="5369888">_</span>&nbsp;<span class="builtintype" id="5369890">bool</span><span class="op" id="5369894">)</span>&nbsp;<span class="op" id="5369896">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369899">if</span>&nbsp;<span class="ident" id="5369902">v</span><span class="op" id="5369903">.</span><span class="ident" id="5369904">IsNil</span><span class="op" id="5369909">(</span><span class="op" id="5369910">)</span>&nbsp;<span class="op" id="5369912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369916">e</span><span class="op" id="5369917">.</span><span class="ident" id="5369918">WriteString</span><span class="op" id="5369929">(</span><span class="string" id="5369930">&#34;null&#34;</span><span class="op" id="5369936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369940">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369951">se</span><span class="op" id="5369953">.</span><span class="ident" id="5369954">arrayEnc</span><span class="op" id="5369962">(</span><span class="ident" id="5369963">e</span><span class="op" id="5369964">,</span>&nbsp;<span class="ident" id="5369966">v</span><span class="op" id="5369967">,</span>&nbsp;<span class="builtintype" id="5369969">false</span><span class="op" id="5369974">)</span><br>
<span class="lineno">665</span><span class="op" id="5369976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5369979">func</span>&nbsp;<span class="ident" id="5369984">newSliceEncoder</span><span class="op" id="5369999">(</span><span class="ident" id="5370000">t</span>&nbsp;<span class="ident" id="5370002">reflect</span><span class="op" id="5370009">.</span><span class="ident" id="5370010">Type</span><span class="op" id="5370014">)</span>&nbsp;<span class="ident" id="5370016">encoderFunc</span>&nbsp;<span class="op" id="5370028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370031">//&nbsp;Byte&nbsp;slices&nbsp;get&nbsp;special&nbsp;treatment;&nbsp;arrays&nbsp;don&#39;t.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370084">if</span>&nbsp;<span class="ident" id="5370087">t</span><span class="op" id="5370088">.</span><span class="ident" id="5370089">Elem</span><span class="op" id="5370093">(</span><span class="op" id="5370094">)</span><span class="op" id="5370095">.</span><span class="ident" id="5370096">Kind</span><span class="op" id="5370100">(</span><span class="op" id="5370101">)</span>&nbsp;<span class="op" id="5370103">==</span>&nbsp;<span class="ident" id="5370106">reflect</span><span class="op" id="5370113">.</span><span class="ident" id="5370114">Uint8</span>&nbsp;<span class="op" id="5370120">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370124">return</span>&nbsp;<span class="ident" id="5370131">encodeByteSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370151">enc</span>&nbsp;<span class="op" id="5370155">:=</span>&nbsp;<span class="op" id="5370158">&amp;</span><span class="ident" id="5370159">sliceEncoder</span><span class="op" id="5370171">{</span><span class="ident" id="5370172">newArrayEncoder</span><span class="op" id="5370187">(</span><span class="ident" id="5370188">t</span><span class="op" id="5370189">)</span><span class="op" id="5370190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370193">return</span>&nbsp;<span class="ident" id="5370200">enc</span><span class="op" id="5370203">.</span><span class="ident" id="5370204">encode</span><br>
<span class="lineno"></span><span class="op" id="5370211">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="5370214">type</span>&nbsp;<span class="ident" id="5370219">arrayEncoder</span>&nbsp;<span class="keyword" id="5370232">struct</span>&nbsp;<span class="op" id="5370239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370242">elemEnc</span>&nbsp;<span class="ident" id="5370250">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5370262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span><span class="keyword" id="5370265">func</span>&nbsp;<span class="op" id="5370270">(</span><span class="ident" id="5370271">ae</span>&nbsp;<span class="op" id="5370274">*</span><span class="ident" id="5370275">arrayEncoder</span><span class="op" id="5370287">)</span>&nbsp;<span class="ident" id="5370289">encode</span><span class="op" id="5370295">(</span><span class="ident" id="5370296">e</span>&nbsp;<span class="op" id="5370298">*</span><span class="ident" id="5370299">encodeState</span><span class="op" id="5370310">,</span>&nbsp;<span class="ident" id="5370312">v</span>&nbsp;<span class="ident" id="5370314">reflect</span><span class="op" id="5370321">.</span><span class="ident" id="5370322">Value</span><span class="op" id="5370327">,</span>&nbsp;<span class="ident" id="5370329">_</span>&nbsp;<span class="builtintype" id="5370331">bool</span><span class="op" id="5370335">)</span>&nbsp;<span class="op" id="5370337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370340">e</span><span class="op" id="5370341">.</span><span class="ident" id="5370342">WriteByte</span><span class="op" id="5370351">(</span><span class="string" id="5370352">&#39;[&#39;</span><span class="op" id="5370355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370358">n</span>&nbsp;<span class="op" id="5370360">:=</span>&nbsp;<span class="ident" id="5370363">v</span><span class="op" id="5370364">.</span><span class="ident" id="5370365">Len</span><span class="op" id="5370368">(</span><span class="op" id="5370369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370372">for</span>&nbsp;<span class="ident" id="5370376">i</span>&nbsp;<span class="op" id="5370378">:=</span>&nbsp;<span class="num" id="5370381">0</span><span class="op" id="5370382">;</span>&nbsp;<span class="ident" id="5370384">i</span>&nbsp;<span class="op" id="5370386">&lt;</span>&nbsp;<span class="ident" id="5370388">n</span><span class="op" id="5370389">;</span>&nbsp;<span class="ident" id="5370391">i</span><span class="op" id="5370392">++</span>&nbsp;<span class="op" id="5370395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370399">if</span>&nbsp;<span class="ident" id="5370402">i</span>&nbsp;<span class="op" id="5370404">&gt;</span>&nbsp;<span class="num" id="5370406">0</span>&nbsp;<span class="op" id="5370408">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370413">e</span><span class="op" id="5370414">.</span><span class="ident" id="5370415">WriteByte</span><span class="op" id="5370424">(</span><span class="string" id="5370425">&#39;,&#39;</span><span class="op" id="5370428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370436">ae</span><span class="op" id="5370438">.</span><span class="ident" id="5370439">elemEnc</span><span class="op" id="5370446">(</span><span class="ident" id="5370447">e</span><span class="op" id="5370448">,</span>&nbsp;<span class="ident" id="5370450">v</span><span class="op" id="5370451">.</span><span class="ident" id="5370452">Index</span><span class="op" id="5370457">(</span><span class="ident" id="5370458">i</span><span class="op" id="5370459">)</span><span class="op" id="5370460">,</span>&nbsp;<span class="builtintype" id="5370462">false</span><span class="op" id="5370467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370473">e</span><span class="op" id="5370474">.</span><span class="ident" id="5370475">WriteByte</span><span class="op" id="5370484">(</span><span class="string" id="5370485">&#39;]&#39;</span><span class="op" id="5370488">)</span><br>
<span class="lineno">690</span><span class="op" id="5370490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5370493">func</span>&nbsp;<span class="ident" id="5370498">newArrayEncoder</span><span class="op" id="5370513">(</span><span class="ident" id="5370514">t</span>&nbsp;<span class="ident" id="5370516">reflect</span><span class="op" id="5370523">.</span><span class="ident" id="5370524">Type</span><span class="op" id="5370528">)</span>&nbsp;<span class="ident" id="5370530">encoderFunc</span>&nbsp;<span class="op" id="5370542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370545">enc</span>&nbsp;<span class="op" id="5370549">:=</span>&nbsp;<span class="op" id="5370552">&amp;</span><span class="ident" id="5370553">arrayEncoder</span><span class="op" id="5370565">{</span><span class="ident" id="5370566">typeEncoder</span><span class="op" id="5370577">(</span><span class="ident" id="5370578">t</span><span class="op" id="5370579">.</span><span class="ident" id="5370580">Elem</span><span class="op" id="5370584">(</span><span class="op" id="5370585">)</span><span class="op" id="5370586">)</span><span class="op" id="5370587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370590">return</span>&nbsp;<span class="ident" id="5370597">enc</span><span class="op" id="5370600">.</span><span class="ident" id="5370601">encode</span><br>
<span class="lineno">695</span><span class="op" id="5370608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5370611">type</span>&nbsp;<span class="ident" id="5370616">ptrEncoder</span>&nbsp;<span class="keyword" id="5370627">struct</span>&nbsp;<span class="op" id="5370634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370637">elemEnc</span>&nbsp;<span class="ident" id="5370645">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5370657">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5370660">func</span>&nbsp;<span class="op" id="5370665">(</span><span class="ident" id="5370666">pe</span>&nbsp;<span class="op" id="5370669">*</span><span class="ident" id="5370670">ptrEncoder</span><span class="op" id="5370680">)</span>&nbsp;<span class="ident" id="5370682">encode</span><span class="op" id="5370688">(</span><span class="ident" id="5370689">e</span>&nbsp;<span class="op" id="5370691">*</span><span class="ident" id="5370692">encodeState</span><span class="op" id="5370703">,</span>&nbsp;<span class="ident" id="5370705">v</span>&nbsp;<span class="ident" id="5370707">reflect</span><span class="op" id="5370714">.</span><span class="ident" id="5370715">Value</span><span class="op" id="5370720">,</span>&nbsp;<span class="ident" id="5370722">quoted</span>&nbsp;<span class="builtintype" id="5370729">bool</span><span class="op" id="5370733">)</span>&nbsp;<span class="op" id="5370735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370738">if</span>&nbsp;<span class="ident" id="5370741">v</span><span class="op" id="5370742">.</span><span class="ident" id="5370743">IsNil</span><span class="op" id="5370748">(</span><span class="op" id="5370749">)</span>&nbsp;<span class="op" id="5370751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370755">e</span><span class="op" id="5370756">.</span><span class="ident" id="5370757">WriteString</span><span class="op" id="5370768">(</span><span class="string" id="5370769">&#34;null&#34;</span><span class="op" id="5370775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370779">return</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370790">pe</span><span class="op" id="5370792">.</span><span class="ident" id="5370793">elemEnc</span><span class="op" id="5370800">(</span><span class="ident" id="5370801">e</span><span class="op" id="5370802">,</span>&nbsp;<span class="ident" id="5370804">v</span><span class="op" id="5370805">.</span><span class="ident" id="5370806">Elem</span><span class="op" id="5370810">(</span><span class="op" id="5370811">)</span><span class="op" id="5370812">,</span>&nbsp;<span class="ident" id="5370814">quoted</span><span class="op" id="5370820">)</span><br>
<span class="lineno"></span><span class="op" id="5370822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5370825">func</span>&nbsp;<span class="ident" id="5370830">newPtrEncoder</span><span class="op" id="5370843">(</span><span class="ident" id="5370844">t</span>&nbsp;<span class="ident" id="5370846">reflect</span><span class="op" id="5370853">.</span><span class="ident" id="5370854">Type</span><span class="op" id="5370858">)</span>&nbsp;<span class="ident" id="5370860">encoderFunc</span>&nbsp;<span class="op" id="5370872">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370875">enc</span>&nbsp;<span class="op" id="5370879">:=</span>&nbsp;<span class="op" id="5370882">&amp;</span><span class="ident" id="5370883">ptrEncoder</span><span class="op" id="5370893">{</span><span class="ident" id="5370894">typeEncoder</span><span class="op" id="5370905">(</span><span class="ident" id="5370906">t</span><span class="op" id="5370907">.</span><span class="ident" id="5370908">Elem</span><span class="op" id="5370912">(</span><span class="op" id="5370913">)</span><span class="op" id="5370914">)</span><span class="op" id="5370915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370918">return</span>&nbsp;<span class="ident" id="5370925">enc</span><span class="op" id="5370928">.</span><span class="ident" id="5370929">encode</span><br>
<span class="lineno"></span><span class="op" id="5370936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5370939">type</span>&nbsp;<span class="ident" id="5370944">condAddrEncoder</span>&nbsp;<span class="keyword" id="5370960">struct</span>&nbsp;<span class="op" id="5370967">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370970">canAddrEnc</span><span class="op" id="5370980">,</span>&nbsp;<span class="ident" id="5370982">elseEnc</span>&nbsp;<span class="ident" id="5370990">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="5371002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5371005">func</span>&nbsp;<span class="op" id="5371010">(</span><span class="ident" id="5371011">ce</span>&nbsp;<span class="op" id="5371014">*</span><span class="ident" id="5371015">condAddrEncoder</span><span class="op" id="5371030">)</span>&nbsp;<span class="ident" id="5371032">encode</span><span class="op" id="5371038">(</span><span class="ident" id="5371039">e</span>&nbsp;<span class="op" id="5371041">*</span><span class="ident" id="5371042">encodeState</span><span class="op" id="5371053">,</span>&nbsp;<span class="ident" id="5371055">v</span>&nbsp;<span class="ident" id="5371057">reflect</span><span class="op" id="5371064">.</span><span class="ident" id="5371065">Value</span><span class="op" id="5371070">,</span>&nbsp;<span class="ident" id="5371072">quoted</span>&nbsp;<span class="builtintype" id="5371079">bool</span><span class="op" id="5371083">)</span>&nbsp;<span class="op" id="5371085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371088">if</span>&nbsp;<span class="ident" id="5371091">v</span><span class="op" id="5371092">.</span><span class="ident" id="5371093">CanAddr</span><span class="op" id="5371100">(</span><span class="op" id="5371101">)</span>&nbsp;<span class="op" id="5371103">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371107">ce</span><span class="op" id="5371109">.</span><span class="ident" id="5371110">canAddrEnc</span><span class="op" id="5371120">(</span><span class="ident" id="5371121">e</span><span class="op" id="5371122">,</span>&nbsp;<span class="ident" id="5371124">v</span><span class="op" id="5371125">,</span>&nbsp;<span class="ident" id="5371127">quoted</span><span class="op" id="5371133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371136">}</span>&nbsp;<span class="keyword" id="5371138">else</span>&nbsp;<span class="op" id="5371143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371147">ce</span><span class="op" id="5371149">.</span><span class="ident" id="5371150">elseEnc</span><span class="op" id="5371157">(</span><span class="ident" id="5371158">e</span><span class="op" id="5371159">,</span>&nbsp;<span class="ident" id="5371161">v</span><span class="op" id="5371162">,</span>&nbsp;<span class="ident" id="5371164">quoted</span><span class="op" id="5371170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371173">}</span><br>
<span class="lineno"></span><span class="op" id="5371175">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5371178">//&nbsp;newCondAddrEncoder&nbsp;returns&nbsp;an&nbsp;encoder&nbsp;that&nbsp;checks&nbsp;whether&nbsp;its&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5371249">//&nbsp;CanAddr&nbsp;and&nbsp;delegates&nbsp;to&nbsp;canAddrEnc&nbsp;if&nbsp;so,&nbsp;else&nbsp;to&nbsp;elseEnc.</span><br>
<span class="lineno"></span><span class="keyword" id="5371312">func</span>&nbsp;<span class="ident" id="5371317">newCondAddrEncoder</span><span class="op" id="5371335">(</span><span class="ident" id="5371336">canAddrEnc</span><span class="op" id="5371346">,</span>&nbsp;<span class="ident" id="5371348">elseEnc</span>&nbsp;<span class="ident" id="5371356">encoderFunc</span><span class="op" id="5371367">)</span>&nbsp;<span class="ident" id="5371369">encoderFunc</span>&nbsp;<span class="op" id="5371381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371384">enc</span>&nbsp;<span class="op" id="5371388">:=</span>&nbsp;<span class="op" id="5371391">&amp;</span><span class="ident" id="5371392">condAddrEncoder</span><span class="op" id="5371407">{</span><span class="ident" id="5371408">canAddrEnc</span><span class="op" id="5371418">:</span>&nbsp;<span class="ident" id="5371420">canAddrEnc</span><span class="op" id="5371430">,</span>&nbsp;<span class="ident" id="5371432">elseEnc</span><span class="op" id="5371439">:</span>&nbsp;<span class="ident" id="5371441">elseEnc</span><span class="op" id="5371448">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371451">return</span>&nbsp;<span class="ident" id="5371458">enc</span><span class="op" id="5371461">.</span><span class="ident" id="5371462">encode</span><br>
<span class="lineno"></span><span class="op" id="5371469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5371472">func</span>&nbsp;<span class="ident" id="5371477">isValidTag</span><span class="op" id="5371487">(</span><span class="ident" id="5371488">s</span>&nbsp;<span class="builtintype" id="5371490">string</span><span class="op" id="5371496">)</span>&nbsp;<span class="builtintype" id="5371498">bool</span>&nbsp;<span class="op" id="5371503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371506">if</span>&nbsp;<span class="ident" id="5371509">s</span>&nbsp;<span class="op" id="5371511">==</span>&nbsp;<span class="string" id="5371514">&#34;&#34;</span>&nbsp;<span class="op" id="5371517">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371521">return</span>&nbsp;<span class="builtintype" id="5371528">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371538">for</span>&nbsp;<span class="ident" id="5371542">_</span><span class="op" id="5371543">,</span>&nbsp;<span class="ident" id="5371545">c</span>&nbsp;<span class="op" id="5371547">:=</span>&nbsp;<span class="keyword" id="5371550">range</span>&nbsp;<span class="ident" id="5371556">s</span>&nbsp;<span class="op" id="5371558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371562">switch</span>&nbsp;<span class="op" id="5371569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371573">case</span>&nbsp;<span class="ident" id="5371578">strings</span><span class="op" id="5371585">.</span><span class="ident" id="5371586">ContainsRune</span><span class="op" id="5371598">(</span><span class="string" id="5371599">&#34;!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~&nbsp;&#34;</span><span class="op" id="5371628">,</span>&nbsp;<span class="ident" id="5371630">c</span><span class="op" id="5371631">)</span><span class="op" id="5371632">:</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371637">//&nbsp;Backslash&nbsp;and&nbsp;quote&nbsp;chars&nbsp;are&nbsp;reserved,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371687">//&nbsp;otherwise&nbsp;any&nbsp;punctuation&nbsp;chars&nbsp;are&nbsp;allowed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371737">//&nbsp;in&nbsp;a&nbsp;tag&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371757">default</span><span class="op" id="5371764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371769">if</span>&nbsp;<span class="op" id="5371772">!</span><span class="ident" id="5371773">unicode</span><span class="op" id="5371780">.</span><span class="ident" id="5371781">IsLetter</span><span class="op" id="5371789">(</span><span class="ident" id="5371790">c</span><span class="op" id="5371791">)</span>&nbsp;<span class="op" id="5371793">&amp;&amp;</span>&nbsp;<span class="op" id="5371796">!</span><span class="ident" id="5371797">unicode</span><span class="op" id="5371804">.</span><span class="ident" id="5371805">IsDigit</span><span class="op" id="5371812">(</span><span class="ident" id="5371813">c</span><span class="op" id="5371814">)</span>&nbsp;<span class="op" id="5371816">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371822">return</span>&nbsp;<span class="builtintype" id="5371829">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371848">return</span>&nbsp;<span class="builtintype" id="5371855">true</span><br>
<span class="lineno">750</span><span class="op" id="5371860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5371863">func</span>&nbsp;<span class="ident" id="5371868">fieldByIndex</span><span class="op" id="5371880">(</span><span class="ident" id="5371881">v</span>&nbsp;<span class="ident" id="5371883">reflect</span><span class="op" id="5371890">.</span><span class="ident" id="5371891">Value</span><span class="op" id="5371896">,</span>&nbsp;<span class="ident" id="5371898">index</span>&nbsp;<span class="op" id="5371904">[</span><span class="op" id="5371905">]</span><span class="builtintype" id="5371906">int</span><span class="op" id="5371909">)</span>&nbsp;<span class="ident" id="5371911">reflect</span><span class="op" id="5371918">.</span><span class="ident" id="5371919">Value</span>&nbsp;<span class="op" id="5371925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371928">for</span>&nbsp;<span class="ident" id="5371932">_</span><span class="op" id="5371933">,</span>&nbsp;<span class="ident" id="5371935">i</span>&nbsp;<span class="op" id="5371937">:=</span>&nbsp;<span class="keyword" id="5371940">range</span>&nbsp;<span class="ident" id="5371946">index</span>&nbsp;<span class="op" id="5371952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371956">if</span>&nbsp;<span class="ident" id="5371959">v</span><span class="op" id="5371960">.</span><span class="ident" id="5371961">Kind</span><span class="op" id="5371965">(</span><span class="op" id="5371966">)</span>&nbsp;<span class="op" id="5371968">==</span>&nbsp;<span class="ident" id="5371971">reflect</span><span class="op" id="5371978">.</span><span class="ident" id="5371979">Ptr</span>&nbsp;<span class="op" id="5371983">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371988">if</span>&nbsp;<span class="ident" id="5371991">v</span><span class="op" id="5371992">.</span><span class="ident" id="5371993">IsNil</span><span class="op" id="5371998">(</span><span class="op" id="5371999">)</span>&nbsp;<span class="op" id="5372001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372007">return</span>&nbsp;<span class="ident" id="5372014">reflect</span><span class="op" id="5372021">.</span><span class="ident" id="5372022">Value</span><span class="op" id="5372027">{</span><span class="op" id="5372028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372038">v</span>&nbsp;<span class="op" id="5372040">=</span>&nbsp;<span class="ident" id="5372042">v</span><span class="op" id="5372043">.</span><span class="ident" id="5372044">Elem</span><span class="op" id="5372048">(</span><span class="op" id="5372049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372053">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372057">v</span>&nbsp;<span class="op" id="5372059">=</span>&nbsp;<span class="ident" id="5372061">v</span><span class="op" id="5372062">.</span><span class="ident" id="5372063">Field</span><span class="op" id="5372068">(</span><span class="ident" id="5372069">i</span><span class="op" id="5372070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372076">return</span>&nbsp;<span class="ident" id="5372083">v</span><br>
<span class="lineno"></span><span class="op" id="5372085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span><span class="keyword" id="5372088">func</span>&nbsp;<span class="ident" id="5372093">typeByIndex</span><span class="op" id="5372104">(</span><span class="ident" id="5372105">t</span>&nbsp;<span class="ident" id="5372107">reflect</span><span class="op" id="5372114">.</span><span class="ident" id="5372115">Type</span><span class="op" id="5372119">,</span>&nbsp;<span class="ident" id="5372121">index</span>&nbsp;<span class="op" id="5372127">[</span><span class="op" id="5372128">]</span><span class="builtintype" id="5372129">int</span><span class="op" id="5372132">)</span>&nbsp;<span class="ident" id="5372134">reflect</span><span class="op" id="5372141">.</span><span class="ident" id="5372142">Type</span>&nbsp;<span class="op" id="5372147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372150">for</span>&nbsp;<span class="ident" id="5372154">_</span><span class="op" id="5372155">,</span>&nbsp;<span class="ident" id="5372157">i</span>&nbsp;<span class="op" id="5372159">:=</span>&nbsp;<span class="keyword" id="5372162">range</span>&nbsp;<span class="ident" id="5372168">index</span>&nbsp;<span class="op" id="5372174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372178">if</span>&nbsp;<span class="ident" id="5372181">t</span><span class="op" id="5372182">.</span><span class="ident" id="5372183">Kind</span><span class="op" id="5372187">(</span><span class="op" id="5372188">)</span>&nbsp;<span class="op" id="5372190">==</span>&nbsp;<span class="ident" id="5372193">reflect</span><span class="op" id="5372200">.</span><span class="ident" id="5372201">Ptr</span>&nbsp;<span class="op" id="5372205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372210">t</span>&nbsp;<span class="op" id="5372212">=</span>&nbsp;<span class="ident" id="5372214">t</span><span class="op" id="5372215">.</span><span class="ident" id="5372216">Elem</span><span class="op" id="5372220">(</span><span class="op" id="5372221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372225">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372229">t</span>&nbsp;<span class="op" id="5372231">=</span>&nbsp;<span class="ident" id="5372233">t</span><span class="op" id="5372234">.</span><span class="ident" id="5372235">Field</span><span class="op" id="5372240">(</span><span class="ident" id="5372241">i</span><span class="op" id="5372242">)</span><span class="op" id="5372243">.</span><span class="ident" id="5372244">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372253">return</span>&nbsp;<span class="ident" id="5372260">t</span><br>
<span class="lineno"></span><span class="op" id="5372262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">775</span><span class="comment" id="5372265">//&nbsp;stringValues&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;reflect.Value&nbsp;holding&nbsp;*reflect.StringValue.</span><br>
<span class="lineno"></span><span class="comment" id="5372339">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;methods&nbsp;to&nbsp;sort&nbsp;by&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5372387">type</span>&nbsp;<span class="ident" id="5372392">stringValues</span>&nbsp;<span class="op" id="5372405">[</span><span class="op" id="5372406">]</span><span class="ident" id="5372407">reflect</span><span class="op" id="5372414">.</span><span class="ident" id="5372415">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5372422">func</span>&nbsp;<span class="op" id="5372427">(</span><span class="ident" id="5372428">sv</span>&nbsp;<span class="ident" id="5372431">stringValues</span><span class="op" id="5372443">)</span>&nbsp;<span class="ident" id="5372445">Len</span><span class="op" id="5372448">(</span><span class="op" id="5372449">)</span>&nbsp;<span class="builtintype" id="5372451">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372465">{</span>&nbsp;<span class="keyword" id="5372467">return</span>&nbsp;<span class="builtinfunc" id="5372474">len</span><span class="op" id="5372477">(</span><span class="ident" id="5372478">sv</span><span class="op" id="5372480">)</span>&nbsp;<span class="op" id="5372482">}</span><br>
<span class="lineno">780</span><span class="keyword" id="5372484">func</span>&nbsp;<span class="op" id="5372489">(</span><span class="ident" id="5372490">sv</span>&nbsp;<span class="ident" id="5372493">stringValues</span><span class="op" id="5372505">)</span>&nbsp;<span class="ident" id="5372507">Swap</span><span class="op" id="5372511">(</span><span class="ident" id="5372512">i</span><span class="op" id="5372513">,</span>&nbsp;<span class="ident" id="5372515">j</span>&nbsp;<span class="builtintype" id="5372517">int</span><span class="op" id="5372520">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372527">{</span>&nbsp;<span class="ident" id="5372529">sv</span><span class="op" id="5372531">[</span><span class="ident" id="5372532">i</span><span class="op" id="5372533">]</span><span class="op" id="5372534">,</span>&nbsp;<span class="ident" id="5372536">sv</span><span class="op" id="5372538">[</span><span class="ident" id="5372539">j</span><span class="op" id="5372540">]</span>&nbsp;<span class="op" id="5372542">=</span>&nbsp;<span class="ident" id="5372544">sv</span><span class="op" id="5372546">[</span><span class="ident" id="5372547">j</span><span class="op" id="5372548">]</span><span class="op" id="5372549">,</span>&nbsp;<span class="ident" id="5372551">sv</span><span class="op" id="5372553">[</span><span class="ident" id="5372554">i</span><span class="op" id="5372555">]</span>&nbsp;<span class="op" id="5372557">}</span><br>
<span class="lineno"></span><span class="keyword" id="5372559">func</span>&nbsp;<span class="op" id="5372564">(</span><span class="ident" id="5372565">sv</span>&nbsp;<span class="ident" id="5372568">stringValues</span><span class="op" id="5372580">)</span>&nbsp;<span class="ident" id="5372582">Less</span><span class="op" id="5372586">(</span><span class="ident" id="5372587">i</span><span class="op" id="5372588">,</span>&nbsp;<span class="ident" id="5372590">j</span>&nbsp;<span class="builtintype" id="5372592">int</span><span class="op" id="5372595">)</span>&nbsp;<span class="builtintype" id="5372597">bool</span>&nbsp;<span class="op" id="5372602">{</span>&nbsp;<span class="keyword" id="5372604">return</span>&nbsp;<span class="ident" id="5372611">sv</span><span class="op" id="5372613">.</span><span class="ident" id="5372614">get</span><span class="op" id="5372617">(</span><span class="ident" id="5372618">i</span><span class="op" id="5372619">)</span>&nbsp;<span class="op" id="5372621">&lt;</span>&nbsp;<span class="ident" id="5372623">sv</span><span class="op" id="5372625">.</span><span class="ident" id="5372626">get</span><span class="op" id="5372629">(</span><span class="ident" id="5372630">j</span><span class="op" id="5372631">)</span>&nbsp;<span class="op" id="5372633">}</span><br>
<span class="lineno"></span><span class="keyword" id="5372635">func</span>&nbsp;<span class="op" id="5372640">(</span><span class="ident" id="5372641">sv</span>&nbsp;<span class="ident" id="5372644">stringValues</span><span class="op" id="5372656">)</span>&nbsp;<span class="ident" id="5372658">get</span><span class="op" id="5372661">(</span><span class="ident" id="5372662">i</span>&nbsp;<span class="builtintype" id="5372664">int</span><span class="op" id="5372667">)</span>&nbsp;<span class="builtintype" id="5372669">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5372678">{</span>&nbsp;<span class="keyword" id="5372680">return</span>&nbsp;<span class="ident" id="5372687">sv</span><span class="op" id="5372689">[</span><span class="ident" id="5372690">i</span><span class="op" id="5372691">]</span><span class="op" id="5372692">.</span><span class="ident" id="5372693">String</span><span class="op" id="5372699">(</span><span class="op" id="5372700">)</span>&nbsp;<span class="op" id="5372702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5372705">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;stringBytes&nbsp;below.</span><br>
<span class="lineno">785</span><span class="keyword" id="5372751">func</span>&nbsp;<span class="op" id="5372756">(</span><span class="ident" id="5372757">e</span>&nbsp;<span class="op" id="5372759">*</span><span class="ident" id="5372760">encodeState</span><span class="op" id="5372771">)</span>&nbsp;<span class="builtintype" id="5372773">string</span><span class="op" id="5372779">(</span><span class="ident" id="5372780">s</span>&nbsp;<span class="builtintype" id="5372782">string</span><span class="op" id="5372788">)</span>&nbsp;<span class="op" id="5372790">(</span><span class="builtintype" id="5372791">int</span><span class="op" id="5372794">,</span>&nbsp;<span class="builtintype" id="5372796">error</span><span class="op" id="5372801">)</span>&nbsp;<span class="op" id="5372803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372806">len0</span>&nbsp;<span class="op" id="5372811">:=</span>&nbsp;<span class="ident" id="5372814">e</span><span class="op" id="5372815">.</span><span class="ident" id="5372816">Len</span><span class="op" id="5372819">(</span><span class="op" id="5372820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372823">e</span><span class="op" id="5372824">.</span><span class="ident" id="5372825">WriteByte</span><span class="op" id="5372834">(</span><span class="string" id="5372835">&#39;&#34;&#39;</span><span class="op" id="5372838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372841">start</span>&nbsp;<span class="op" id="5372847">:=</span>&nbsp;<span class="num" id="5372850">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372853">for</span>&nbsp;<span class="ident" id="5372857">i</span>&nbsp;<span class="op" id="5372859">:=</span>&nbsp;<span class="num" id="5372862">0</span><span class="op" id="5372863">;</span>&nbsp;<span class="ident" id="5372865">i</span>&nbsp;<span class="op" id="5372867">&lt;</span>&nbsp;<span class="builtinfunc" id="5372869">len</span><span class="op" id="5372872">(</span><span class="ident" id="5372873">s</span><span class="op" id="5372874">)</span><span class="op" id="5372875">;</span>&nbsp;<span class="op" id="5372877">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372881">if</span>&nbsp;<span class="ident" id="5372884">b</span>&nbsp;<span class="op" id="5372886">:=</span>&nbsp;<span class="ident" id="5372889">s</span><span class="op" id="5372890">[</span><span class="ident" id="5372891">i</span><span class="op" id="5372892">]</span><span class="op" id="5372893">;</span>&nbsp;<span class="ident" id="5372895">b</span>&nbsp;<span class="op" id="5372897">&lt;</span>&nbsp;<span class="ident" id="5372899">utf8</span><span class="op" id="5372903">.</span><span class="ident" id="5372904">RuneSelf</span>&nbsp;<span class="op" id="5372913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372918">if</span>&nbsp;<span class="num" id="5372921">0x20</span>&nbsp;<span class="op" id="5372926">&lt;=</span>&nbsp;<span class="ident" id="5372929">b</span>&nbsp;<span class="op" id="5372931">&amp;&amp;</span>&nbsp;<span class="ident" id="5372934">b</span>&nbsp;<span class="op" id="5372936">!=</span>&nbsp;<span class="string" id="5372939">&#39;\\&#39;</span>&nbsp;<span class="op" id="5372944">&amp;&amp;</span>&nbsp;<span class="ident" id="5372947">b</span>&nbsp;<span class="op" id="5372949">!=</span>&nbsp;<span class="string" id="5372952">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5372956">&amp;&amp;</span>&nbsp;<span class="ident" id="5372959">b</span>&nbsp;<span class="op" id="5372961">!=</span>&nbsp;<span class="string" id="5372964">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5372968">&amp;&amp;</span>&nbsp;<span class="ident" id="5372971">b</span>&nbsp;<span class="op" id="5372973">!=</span>&nbsp;<span class="string" id="5372976">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5372980">&amp;&amp;</span>&nbsp;<span class="ident" id="5372983">b</span>&nbsp;<span class="op" id="5372985">!=</span>&nbsp;<span class="string" id="5372988">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5372992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372998">i</span><span class="op" id="5372999">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373006">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373018">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373023">if</span>&nbsp;<span class="ident" id="5373026">start</span>&nbsp;<span class="op" id="5373032">&lt;</span>&nbsp;<span class="ident" id="5373034">i</span>&nbsp;<span class="op" id="5373036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373042">e</span><span class="op" id="5373043">.</span><span class="ident" id="5373044">WriteString</span><span class="op" id="5373055">(</span><span class="ident" id="5373056">s</span><span class="op" id="5373057">[</span><span class="ident" id="5373058">start</span><span class="op" id="5373063">:</span><span class="ident" id="5373064">i</span><span class="op" id="5373065">]</span><span class="op" id="5373066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373076">switch</span>&nbsp;<span class="ident" id="5373083">b</span>&nbsp;<span class="op" id="5373085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373090">case</span>&nbsp;<span class="string" id="5373095">&#39;\\&#39;</span><span class="op" id="5373099">,</span>&nbsp;<span class="string" id="5373101">&#39;&#34;&#39;</span><span class="op" id="5373104">:</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373110">e</span><span class="op" id="5373111">.</span><span class="ident" id="5373112">WriteByte</span><span class="op" id="5373121">(</span><span class="string" id="5373122">&#39;\\&#39;</span><span class="op" id="5373126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373132">e</span><span class="op" id="5373133">.</span><span class="ident" id="5373134">WriteByte</span><span class="op" id="5373143">(</span><span class="ident" id="5373144">b</span><span class="op" id="5373145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373150">case</span>&nbsp;<span class="string" id="5373155">&#39;\n&#39;</span><span class="op" id="5373159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373165">e</span><span class="op" id="5373166">.</span><span class="ident" id="5373167">WriteByte</span><span class="op" id="5373176">(</span><span class="string" id="5373177">&#39;\\&#39;</span><span class="op" id="5373181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373187">e</span><span class="op" id="5373188">.</span><span class="ident" id="5373189">WriteByte</span><span class="op" id="5373198">(</span><span class="string" id="5373199">&#39;n&#39;</span><span class="op" id="5373202">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373207">case</span>&nbsp;<span class="string" id="5373212">&#39;\r&#39;</span><span class="op" id="5373216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373222">e</span><span class="op" id="5373223">.</span><span class="ident" id="5373224">WriteByte</span><span class="op" id="5373233">(</span><span class="string" id="5373234">&#39;\\&#39;</span><span class="op" id="5373238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373244">e</span><span class="op" id="5373245">.</span><span class="ident" id="5373246">WriteByte</span><span class="op" id="5373255">(</span><span class="string" id="5373256">&#39;r&#39;</span><span class="op" id="5373259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373264">case</span>&nbsp;<span class="string" id="5373269">&#39;\t&#39;</span><span class="op" id="5373273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373279">e</span><span class="op" id="5373280">.</span><span class="ident" id="5373281">WriteByte</span><span class="op" id="5373290">(</span><span class="string" id="5373291">&#39;\\&#39;</span><span class="op" id="5373295">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373301">e</span><span class="op" id="5373302">.</span><span class="ident" id="5373303">WriteByte</span><span class="op" id="5373312">(</span><span class="string" id="5373313">&#39;t&#39;</span><span class="op" id="5373316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373321">default</span><span class="op" id="5373328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373334">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373389">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373455">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373518">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373577">e</span><span class="op" id="5373578">.</span><span class="ident" id="5373579">WriteString</span><span class="op" id="5373590">(</span><span class="string" id="5373591">`\u00`</span><span class="op" id="5373597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373603">e</span><span class="op" id="5373604">.</span><span class="ident" id="5373605">WriteByte</span><span class="op" id="5373614">(</span><span class="ident" id="5373615">hex</span><span class="op" id="5373618">[</span><span class="ident" id="5373619">b</span><span class="op" id="5373620">&gt;&gt;</span><span class="num" id="5373622">4</span><span class="op" id="5373623">]</span><span class="op" id="5373624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373630">e</span><span class="op" id="5373631">.</span><span class="ident" id="5373632">WriteByte</span><span class="op" id="5373641">(</span><span class="ident" id="5373642">hex</span><span class="op" id="5373645">[</span><span class="ident" id="5373646">b</span><span class="op" id="5373647">&amp;</span><span class="num" id="5373648">0xF</span><span class="op" id="5373651">]</span><span class="op" id="5373652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373657">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373662">i</span><span class="op" id="5373663">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373669">start</span>&nbsp;<span class="op" id="5373675">=</span>&nbsp;<span class="ident" id="5373677">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373682">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373697">c</span><span class="op" id="5373698">,</span>&nbsp;<span class="ident" id="5373700">size</span>&nbsp;<span class="op" id="5373705">:=</span>&nbsp;<span class="ident" id="5373708">utf8</span><span class="op" id="5373712">.</span><span class="ident" id="5373713">DecodeRuneInString</span><span class="op" id="5373731">(</span><span class="ident" id="5373732">s</span><span class="op" id="5373733">[</span><span class="ident" id="5373734">i</span><span class="op" id="5373735">:</span><span class="op" id="5373736">]</span><span class="op" id="5373737">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373741">if</span>&nbsp;<span class="ident" id="5373744">c</span>&nbsp;<span class="op" id="5373746">==</span>&nbsp;<span class="ident" id="5373749">utf8</span><span class="op" id="5373753">.</span><span class="ident" id="5373754">RuneError</span>&nbsp;<span class="op" id="5373764">&amp;&amp;</span>&nbsp;<span class="ident" id="5373767">size</span>&nbsp;<span class="op" id="5373772">==</span>&nbsp;<span class="num" id="5373775">1</span>&nbsp;<span class="op" id="5373777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373782">if</span>&nbsp;<span class="ident" id="5373785">start</span>&nbsp;<span class="op" id="5373791">&lt;</span>&nbsp;<span class="ident" id="5373793">i</span>&nbsp;<span class="op" id="5373795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373801">e</span><span class="op" id="5373802">.</span><span class="ident" id="5373803">WriteString</span><span class="op" id="5373814">(</span><span class="ident" id="5373815">s</span><span class="op" id="5373816">[</span><span class="ident" id="5373817">start</span><span class="op" id="5373822">:</span><span class="ident" id="5373823">i</span><span class="op" id="5373824">]</span><span class="op" id="5373825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373835">e</span><span class="op" id="5373836">.</span><span class="ident" id="5373837">WriteString</span><span class="op" id="5373848">(</span><span class="string" id="5373849">`\ufffd`</span><span class="op" id="5373857">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373862">i</span>&nbsp;<span class="op" id="5373864">+=</span>&nbsp;<span class="ident" id="5373867">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373875">start</span>&nbsp;<span class="op" id="5373881">=</span>&nbsp;<span class="ident" id="5373883">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373888">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373903">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373934">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5373970">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5374035">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5374106">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5374169">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5374216">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374295">if</span>&nbsp;<span class="ident" id="5374298">c</span>&nbsp;<span class="op" id="5374300">==</span>&nbsp;<span class="string" id="5374303">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="5374312">||</span>&nbsp;<span class="ident" id="5374315">c</span>&nbsp;<span class="op" id="5374317">==</span>&nbsp;<span class="string" id="5374320">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="5374329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374334">if</span>&nbsp;<span class="ident" id="5374337">start</span>&nbsp;<span class="op" id="5374343">&lt;</span>&nbsp;<span class="ident" id="5374345">i</span>&nbsp;<span class="op" id="5374347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374353">e</span><span class="op" id="5374354">.</span><span class="ident" id="5374355">WriteString</span><span class="op" id="5374366">(</span><span class="ident" id="5374367">s</span><span class="op" id="5374368">[</span><span class="ident" id="5374369">start</span><span class="op" id="5374374">:</span><span class="ident" id="5374375">i</span><span class="op" id="5374376">]</span><span class="op" id="5374377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374382">}</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374387">e</span><span class="op" id="5374388">.</span><span class="ident" id="5374389">WriteString</span><span class="op" id="5374400">(</span><span class="string" id="5374401">`\u202`</span><span class="op" id="5374408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374413">e</span><span class="op" id="5374414">.</span><span class="ident" id="5374415">WriteByte</span><span class="op" id="5374424">(</span><span class="ident" id="5374425">hex</span><span class="op" id="5374428">[</span><span class="ident" id="5374429">c</span><span class="op" id="5374430">&amp;</span><span class="num" id="5374431">0xF</span><span class="op" id="5374434">]</span><span class="op" id="5374435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374440">i</span>&nbsp;<span class="op" id="5374442">+=</span>&nbsp;<span class="ident" id="5374445">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374453">start</span>&nbsp;<span class="op" id="5374459">=</span>&nbsp;<span class="ident" id="5374461">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374466">continue</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374481">i</span>&nbsp;<span class="op" id="5374483">+=</span>&nbsp;<span class="ident" id="5374486">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374495">if</span>&nbsp;<span class="ident" id="5374498">start</span>&nbsp;<span class="op" id="5374504">&lt;</span>&nbsp;<span class="builtinfunc" id="5374506">len</span><span class="op" id="5374509">(</span><span class="ident" id="5374510">s</span><span class="op" id="5374511">)</span>&nbsp;<span class="op" id="5374513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374517">e</span><span class="op" id="5374518">.</span><span class="ident" id="5374519">WriteString</span><span class="op" id="5374530">(</span><span class="ident" id="5374531">s</span><span class="op" id="5374532">[</span><span class="ident" id="5374533">start</span><span class="op" id="5374538">:</span><span class="op" id="5374539">]</span><span class="op" id="5374540">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374546">e</span><span class="op" id="5374547">.</span><span class="ident" id="5374548">WriteByte</span><span class="op" id="5374557">(</span><span class="string" id="5374558">&#39;&#34;&#39;</span><span class="op" id="5374561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374564">return</span>&nbsp;<span class="ident" id="5374571">e</span><span class="op" id="5374572">.</span><span class="ident" id="5374573">Len</span><span class="op" id="5374576">(</span><span class="op" id="5374577">)</span>&nbsp;<span class="op" id="5374579">-</span>&nbsp;<span class="ident" id="5374581">len0</span><span class="op" id="5374585">,</span>&nbsp;<span class="builtintype" id="5374587">nil</span><br>
<span class="lineno"></span><span class="op" id="5374591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span><span class="comment" id="5374594">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;string&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="5374635">func</span>&nbsp;<span class="op" id="5374640">(</span><span class="ident" id="5374641">e</span>&nbsp;<span class="op" id="5374643">*</span><span class="ident" id="5374644">encodeState</span><span class="op" id="5374655">)</span>&nbsp;<span class="ident" id="5374657">stringBytes</span><span class="op" id="5374668">(</span><span class="ident" id="5374669">s</span>&nbsp;<span class="op" id="5374671">[</span><span class="op" id="5374672">]</span><span class="builtintype" id="5374673">byte</span><span class="op" id="5374677">)</span>&nbsp;<span class="op" id="5374679">(</span><span class="builtintype" id="5374680">int</span><span class="op" id="5374683">,</span>&nbsp;<span class="builtintype" id="5374685">error</span><span class="op" id="5374690">)</span>&nbsp;<span class="op" id="5374692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374695">len0</span>&nbsp;<span class="op" id="5374700">:=</span>&nbsp;<span class="ident" id="5374703">e</span><span class="op" id="5374704">.</span><span class="ident" id="5374705">Len</span><span class="op" id="5374708">(</span><span class="op" id="5374709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374712">e</span><span class="op" id="5374713">.</span><span class="ident" id="5374714">WriteByte</span><span class="op" id="5374723">(</span><span class="string" id="5374724">&#39;&#34;&#39;</span><span class="op" id="5374727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374730">start</span>&nbsp;<span class="op" id="5374736">:=</span>&nbsp;<span class="num" id="5374739">0</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374742">for</span>&nbsp;<span class="ident" id="5374746">i</span>&nbsp;<span class="op" id="5374748">:=</span>&nbsp;<span class="num" id="5374751">0</span><span class="op" id="5374752">;</span>&nbsp;<span class="ident" id="5374754">i</span>&nbsp;<span class="op" id="5374756">&lt;</span>&nbsp;<span class="builtinfunc" id="5374758">len</span><span class="op" id="5374761">(</span><span class="ident" id="5374762">s</span><span class="op" id="5374763">)</span><span class="op" id="5374764">;</span>&nbsp;<span class="op" id="5374766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374770">if</span>&nbsp;<span class="ident" id="5374773">b</span>&nbsp;<span class="op" id="5374775">:=</span>&nbsp;<span class="ident" id="5374778">s</span><span class="op" id="5374779">[</span><span class="ident" id="5374780">i</span><span class="op" id="5374781">]</span><span class="op" id="5374782">;</span>&nbsp;<span class="ident" id="5374784">b</span>&nbsp;<span class="op" id="5374786">&lt;</span>&nbsp;<span class="ident" id="5374788">utf8</span><span class="op" id="5374792">.</span><span class="ident" id="5374793">RuneSelf</span>&nbsp;<span class="op" id="5374802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374807">if</span>&nbsp;<span class="num" id="5374810">0x20</span>&nbsp;<span class="op" id="5374815">&lt;=</span>&nbsp;<span class="ident" id="5374818">b</span>&nbsp;<span class="op" id="5374820">&amp;&amp;</span>&nbsp;<span class="ident" id="5374823">b</span>&nbsp;<span class="op" id="5374825">!=</span>&nbsp;<span class="string" id="5374828">&#39;\\&#39;</span>&nbsp;<span class="op" id="5374833">&amp;&amp;</span>&nbsp;<span class="ident" id="5374836">b</span>&nbsp;<span class="op" id="5374838">!=</span>&nbsp;<span class="string" id="5374841">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5374845">&amp;&amp;</span>&nbsp;<span class="ident" id="5374848">b</span>&nbsp;<span class="op" id="5374850">!=</span>&nbsp;<span class="string" id="5374853">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5374857">&amp;&amp;</span>&nbsp;<span class="ident" id="5374860">b</span>&nbsp;<span class="op" id="5374862">!=</span>&nbsp;<span class="string" id="5374865">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5374869">&amp;&amp;</span>&nbsp;<span class="ident" id="5374872">b</span>&nbsp;<span class="op" id="5374874">!=</span>&nbsp;<span class="string" id="5374877">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5374881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374887">i</span><span class="op" id="5374888">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374895">continue</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374912">if</span>&nbsp;<span class="ident" id="5374915">start</span>&nbsp;<span class="op" id="5374921">&lt;</span>&nbsp;<span class="ident" id="5374923">i</span>&nbsp;<span class="op" id="5374925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374931">e</span><span class="op" id="5374932">.</span><span class="ident" id="5374933">Write</span><span class="op" id="5374938">(</span><span class="ident" id="5374939">s</span><span class="op" id="5374940">[</span><span class="ident" id="5374941">start</span><span class="op" id="5374946">:</span><span class="ident" id="5374947">i</span><span class="op" id="5374948">]</span><span class="op" id="5374949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374959">switch</span>&nbsp;<span class="ident" id="5374966">b</span>&nbsp;<span class="op" id="5374968">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374973">case</span>&nbsp;<span class="string" id="5374978">&#39;\\&#39;</span><span class="op" id="5374982">,</span>&nbsp;<span class="string" id="5374984">&#39;&#34;&#39;</span><span class="op" id="5374987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374993">e</span><span class="op" id="5374994">.</span><span class="ident" id="5374995">WriteByte</span><span class="op" id="5375004">(</span><span class="string" id="5375005">&#39;\\&#39;</span><span class="op" id="5375009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375015">e</span><span class="op" id="5375016">.</span><span class="ident" id="5375017">WriteByte</span><span class="op" id="5375026">(</span><span class="ident" id="5375027">b</span><span class="op" id="5375028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375033">case</span>&nbsp;<span class="string" id="5375038">&#39;\n&#39;</span><span class="op" id="5375042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375048">e</span><span class="op" id="5375049">.</span><span class="ident" id="5375050">WriteByte</span><span class="op" id="5375059">(</span><span class="string" id="5375060">&#39;\\&#39;</span><span class="op" id="5375064">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375070">e</span><span class="op" id="5375071">.</span><span class="ident" id="5375072">WriteByte</span><span class="op" id="5375081">(</span><span class="string" id="5375082">&#39;n&#39;</span><span class="op" id="5375085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375090">case</span>&nbsp;<span class="string" id="5375095">&#39;\r&#39;</span><span class="op" id="5375099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375105">e</span><span class="op" id="5375106">.</span><span class="ident" id="5375107">WriteByte</span><span class="op" id="5375116">(</span><span class="string" id="5375117">&#39;\\&#39;</span><span class="op" id="5375121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375127">e</span><span class="op" id="5375128">.</span><span class="ident" id="5375129">WriteByte</span><span class="op" id="5375138">(</span><span class="string" id="5375139">&#39;r&#39;</span><span class="op" id="5375142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375147">case</span>&nbsp;<span class="string" id="5375152">&#39;\t&#39;</span><span class="op" id="5375156">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375162">e</span><span class="op" id="5375163">.</span><span class="ident" id="5375164">WriteByte</span><span class="op" id="5375173">(</span><span class="string" id="5375174">&#39;\\&#39;</span><span class="op" id="5375178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375184">e</span><span class="op" id="5375185">.</span><span class="ident" id="5375186">WriteByte</span><span class="op" id="5375195">(</span><span class="string" id="5375196">&#39;t&#39;</span><span class="op" id="5375199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375204">default</span><span class="op" id="5375211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375217">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375272">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375339">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375402">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375461">e</span><span class="op" id="5375462">.</span><span class="ident" id="5375463">WriteString</span><span class="op" id="5375474">(</span><span class="string" id="5375475">`\u00`</span><span class="op" id="5375481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375487">e</span><span class="op" id="5375488">.</span><span class="ident" id="5375489">WriteByte</span><span class="op" id="5375498">(</span><span class="ident" id="5375499">hex</span><span class="op" id="5375502">[</span><span class="ident" id="5375503">b</span><span class="op" id="5375504">&gt;&gt;</span><span class="num" id="5375506">4</span><span class="op" id="5375507">]</span><span class="op" id="5375508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375514">e</span><span class="op" id="5375515">.</span><span class="ident" id="5375516">WriteByte</span><span class="op" id="5375525">(</span><span class="ident" id="5375526">hex</span><span class="op" id="5375529">[</span><span class="ident" id="5375530">b</span><span class="op" id="5375531">&amp;</span><span class="num" id="5375532">0xF</span><span class="op" id="5375535">]</span><span class="op" id="5375536">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375546">i</span><span class="op" id="5375547">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375553">start</span>&nbsp;<span class="op" id="5375559">=</span>&nbsp;<span class="ident" id="5375561">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375566">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375577">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375581">c</span><span class="op" id="5375582">,</span>&nbsp;<span class="ident" id="5375584">size</span>&nbsp;<span class="op" id="5375589">:=</span>&nbsp;<span class="ident" id="5375592">utf8</span><span class="op" id="5375596">.</span><span class="ident" id="5375597">DecodeRune</span><span class="op" id="5375607">(</span><span class="ident" id="5375608">s</span><span class="op" id="5375609">[</span><span class="ident" id="5375610">i</span><span class="op" id="5375611">:</span><span class="op" id="5375612">]</span><span class="op" id="5375613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375617">if</span>&nbsp;<span class="ident" id="5375620">c</span>&nbsp;<span class="op" id="5375622">==</span>&nbsp;<span class="ident" id="5375625">utf8</span><span class="op" id="5375629">.</span><span class="ident" id="5375630">RuneError</span>&nbsp;<span class="op" id="5375640">&amp;&amp;</span>&nbsp;<span class="ident" id="5375643">size</span>&nbsp;<span class="op" id="5375648">==</span>&nbsp;<span class="num" id="5375651">1</span>&nbsp;<span class="op" id="5375653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375658">if</span>&nbsp;<span class="ident" id="5375661">start</span>&nbsp;<span class="op" id="5375667">&lt;</span>&nbsp;<span class="ident" id="5375669">i</span>&nbsp;<span class="op" id="5375671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375677">e</span><span class="op" id="5375678">.</span><span class="ident" id="5375679">Write</span><span class="op" id="5375684">(</span><span class="ident" id="5375685">s</span><span class="op" id="5375686">[</span><span class="ident" id="5375687">start</span><span class="op" id="5375692">:</span><span class="ident" id="5375693">i</span><span class="op" id="5375694">]</span><span class="op" id="5375695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375700">}</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375705">e</span><span class="op" id="5375706">.</span><span class="ident" id="5375707">WriteString</span><span class="op" id="5375718">(</span><span class="string" id="5375719">`\ufffd`</span><span class="op" id="5375727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375732">i</span>&nbsp;<span class="op" id="5375734">+=</span>&nbsp;<span class="ident" id="5375737">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375745">start</span>&nbsp;<span class="op" id="5375751">=</span>&nbsp;<span class="ident" id="5375753">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375758">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375769">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375773">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375804">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375840">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375905">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375976">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376039">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376086">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376165">if</span>&nbsp;<span class="ident" id="5376168">c</span>&nbsp;<span class="op" id="5376170">==</span>&nbsp;<span class="string" id="5376173">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="5376182">||</span>&nbsp;<span class="ident" id="5376185">c</span>&nbsp;<span class="op" id="5376187">==</span>&nbsp;<span class="string" id="5376190">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="5376199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376204">if</span>&nbsp;<span class="ident" id="5376207">start</span>&nbsp;<span class="op" id="5376213">&lt;</span>&nbsp;<span class="ident" id="5376215">i</span>&nbsp;<span class="op" id="5376217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376223">e</span><span class="op" id="5376224">.</span><span class="ident" id="5376225">Write</span><span class="op" id="5376230">(</span><span class="ident" id="5376231">s</span><span class="op" id="5376232">[</span><span class="ident" id="5376233">start</span><span class="op" id="5376238">:</span><span class="ident" id="5376239">i</span><span class="op" id="5376240">]</span><span class="op" id="5376241">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376251">e</span><span class="op" id="5376252">.</span><span class="ident" id="5376253">WriteString</span><span class="op" id="5376264">(</span><span class="string" id="5376265">`\u202`</span><span class="op" id="5376272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376277">e</span><span class="op" id="5376278">.</span><span class="ident" id="5376279">WriteByte</span><span class="op" id="5376288">(</span><span class="ident" id="5376289">hex</span><span class="op" id="5376292">[</span><span class="ident" id="5376293">c</span><span class="op" id="5376294">&amp;</span><span class="num" id="5376295">0xF</span><span class="op" id="5376298">]</span><span class="op" id="5376299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376304">i</span>&nbsp;<span class="op" id="5376306">+=</span>&nbsp;<span class="ident" id="5376309">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376317">start</span>&nbsp;<span class="op" id="5376323">=</span>&nbsp;<span class="ident" id="5376325">i</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376330">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376345">i</span>&nbsp;<span class="op" id="5376347">+=</span>&nbsp;<span class="ident" id="5376350">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376359">if</span>&nbsp;<span class="ident" id="5376362">start</span>&nbsp;<span class="op" id="5376368">&lt;</span>&nbsp;<span class="builtinfunc" id="5376370">len</span><span class="op" id="5376373">(</span><span class="ident" id="5376374">s</span><span class="op" id="5376375">)</span>&nbsp;<span class="op" id="5376377">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376381">e</span><span class="op" id="5376382">.</span><span class="ident" id="5376383">Write</span><span class="op" id="5376388">(</span><span class="ident" id="5376389">s</span><span class="op" id="5376390">[</span><span class="ident" id="5376391">start</span><span class="op" id="5376396">:</span><span class="op" id="5376397">]</span><span class="op" id="5376398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376404">e</span><span class="op" id="5376405">.</span><span class="ident" id="5376406">WriteByte</span><span class="op" id="5376415">(</span><span class="string" id="5376416">&#39;&#34;&#39;</span><span class="op" id="5376419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376422">return</span>&nbsp;<span class="ident" id="5376429">e</span><span class="op" id="5376430">.</span><span class="ident" id="5376431">Len</span><span class="op" id="5376434">(</span><span class="op" id="5376435">)</span>&nbsp;<span class="op" id="5376437">-</span>&nbsp;<span class="ident" id="5376439">len0</span><span class="op" id="5376443">,</span>&nbsp;<span class="builtintype" id="5376445">nil</span><br>
<span class="lineno"></span><span class="op" id="5376449">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="5376452">//&nbsp;A&nbsp;field&nbsp;represents&nbsp;a&nbsp;single&nbsp;field&nbsp;found&nbsp;in&nbsp;a&nbsp;struct.</span><br>
<span class="lineno"></span><span class="keyword" id="5376508">type</span>&nbsp;<span class="ident" id="5376513">field</span>&nbsp;<span class="keyword" id="5376519">struct</span>&nbsp;<span class="op" id="5376526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376529">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5376539">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376547">nameBytes</span>&nbsp;<span class="op" id="5376557">[</span><span class="op" id="5376558">]</span><span class="builtintype" id="5376559">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376580">//&nbsp;[]byte(name)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376597">equalFold</span>&nbsp;<span class="keyword" id="5376607">func</span><span class="op" id="5376611">(</span><span class="ident" id="5376612">s</span><span class="op" id="5376613">,</span>&nbsp;<span class="ident" id="5376615">t</span>&nbsp;<span class="op" id="5376617">[</span><span class="op" id="5376618">]</span><span class="builtintype" id="5376619">byte</span><span class="op" id="5376623">)</span>&nbsp;<span class="builtintype" id="5376625">bool</span>&nbsp;<span class="comment" id="5376630">//&nbsp;bytes.EqualFold&nbsp;or&nbsp;equivalent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376665">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5376675">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376681">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376691">[</span><span class="op" id="5376692">]</span><span class="builtintype" id="5376693">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376698">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376708">reflect</span><span class="op" id="5376715">.</span><span class="ident" id="5376716">Type</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376722">omitEmpty</span>&nbsp;<span class="builtintype" id="5376732">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376738">quoted</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5376748">bool</span><br>
<span class="lineno"></span><span class="op" id="5376753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5376756">func</span>&nbsp;<span class="ident" id="5376761">fillField</span><span class="op" id="5376770">(</span><span class="ident" id="5376771">f</span>&nbsp;<span class="ident" id="5376773">field</span><span class="op" id="5376778">)</span>&nbsp;<span class="ident" id="5376780">field</span>&nbsp;<span class="op" id="5376786">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376789">f</span><span class="op" id="5376790">.</span><span class="ident" id="5376791">nameBytes</span>&nbsp;<span class="op" id="5376801">=</span>&nbsp;<span class="op" id="5376803">[</span><span class="op" id="5376804">]</span><span class="builtintype" id="5376805">byte</span><span class="op" id="5376809">(</span><span class="ident" id="5376810">f</span><span class="op" id="5376811">.</span><span class="ident" id="5376812">name</span><span class="op" id="5376816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376819">f</span><span class="op" id="5376820">.</span><span class="ident" id="5376821">equalFold</span>&nbsp;<span class="op" id="5376831">=</span>&nbsp;<span class="ident" id="5376833">foldFunc</span><span class="op" id="5376841">(</span><span class="ident" id="5376842">f</span><span class="op" id="5376843">.</span><span class="ident" id="5376844">nameBytes</span><span class="op" id="5376853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376856">return</span>&nbsp;<span class="ident" id="5376863">f</span><br>
<span class="lineno"></span><span class="op" id="5376865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span><span class="comment" id="5376868">//&nbsp;byName&nbsp;sorts&nbsp;field&nbsp;by&nbsp;name,&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;depth,</span><br>
<span class="lineno"></span><span class="comment" id="5376925">//&nbsp;then&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;&#34;name&nbsp;came&nbsp;from&nbsp;json&nbsp;tag&#34;,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5376984">//&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="5377022">type</span>&nbsp;<span class="ident" id="5377027">byName</span>&nbsp;<span class="op" id="5377034">[</span><span class="op" id="5377035">]</span><span class="ident" id="5377036">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">960</span><span class="keyword" id="5377043">func</span>&nbsp;<span class="op" id="5377048">(</span><span class="ident" id="5377049">x</span>&nbsp;<span class="ident" id="5377051">byName</span><span class="op" id="5377057">)</span>&nbsp;<span class="ident" id="5377059">Len</span><span class="op" id="5377062">(</span><span class="op" id="5377063">)</span>&nbsp;<span class="builtintype" id="5377065">int</span>&nbsp;<span class="op" id="5377069">{</span>&nbsp;<span class="keyword" id="5377071">return</span>&nbsp;<span class="builtinfunc" id="5377078">len</span><span class="op" id="5377081">(</span><span class="ident" id="5377082">x</span><span class="op" id="5377083">)</span>&nbsp;<span class="op" id="5377085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5377088">func</span>&nbsp;<span class="op" id="5377093">(</span><span class="ident" id="5377094">x</span>&nbsp;<span class="ident" id="5377096">byName</span><span class="op" id="5377102">)</span>&nbsp;<span class="ident" id="5377104">Swap</span><span class="op" id="5377108">(</span><span class="ident" id="5377109">i</span><span class="op" id="5377110">,</span>&nbsp;<span class="ident" id="5377112">j</span>&nbsp;<span class="builtintype" id="5377114">int</span><span class="op" id="5377117">)</span>&nbsp;<span class="op" id="5377119">{</span>&nbsp;<span class="ident" id="5377121">x</span><span class="op" id="5377122">[</span><span class="ident" id="5377123">i</span><span class="op" id="5377124">]</span><span class="op" id="5377125">,</span>&nbsp;<span class="ident" id="5377127">x</span><span class="op" id="5377128">[</span><span class="ident" id="5377129">j</span><span class="op" id="5377130">]</span>&nbsp;<span class="op" id="5377132">=</span>&nbsp;<span class="ident" id="5377134">x</span><span class="op" id="5377135">[</span><span class="ident" id="5377136">j</span><span class="op" id="5377137">]</span><span class="op" id="5377138">,</span>&nbsp;<span class="ident" id="5377140">x</span><span class="op" id="5377141">[</span><span class="ident" id="5377142">i</span><span class="op" id="5377143">]</span>&nbsp;<span class="op" id="5377145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5377148">func</span>&nbsp;<span class="op" id="5377153">(</span><span class="ident" id="5377154">x</span>&nbsp;<span class="ident" id="5377156">byName</span><span class="op" id="5377162">)</span>&nbsp;<span class="ident" id="5377164">Less</span><span class="op" id="5377168">(</span><span class="ident" id="5377169">i</span><span class="op" id="5377170">,</span>&nbsp;<span class="ident" id="5377172">j</span>&nbsp;<span class="builtintype" id="5377174">int</span><span class="op" id="5377177">)</span>&nbsp;<span class="builtintype" id="5377179">bool</span>&nbsp;<span class="op" id="5377184">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377187">if</span>&nbsp;<span class="ident" id="5377190">x</span><span class="op" id="5377191">[</span><span class="ident" id="5377192">i</span><span class="op" id="5377193">]</span><span class="op" id="5377194">.</span><span class="ident" id="5377195">name</span>&nbsp;<span class="op" id="5377200">!=</span>&nbsp;<span class="ident" id="5377203">x</span><span class="op" id="5377204">[</span><span class="ident" id="5377205">j</span><span class="op" id="5377206">]</span><span class="op" id="5377207">.</span><span class="ident" id="5377208">name</span>&nbsp;<span class="op" id="5377213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377217">return</span>&nbsp;<span class="ident" id="5377224">x</span><span class="op" id="5377225">[</span><span class="ident" id="5377226">i</span><span class="op" id="5377227">]</span><span class="op" id="5377228">.</span><span class="ident" id="5377229">name</span>&nbsp;<span class="op" id="5377234">&lt;</span>&nbsp;<span class="ident" id="5377236">x</span><span class="op" id="5377237">[</span><span class="ident" id="5377238">j</span><span class="op" id="5377239">]</span><span class="op" id="5377240">.</span><span class="ident" id="5377241">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377250">if</span>&nbsp;<span class="builtinfunc" id="5377253">len</span><span class="op" id="5377256">(</span><span class="ident" id="5377257">x</span><span class="op" id="5377258">[</span><span class="ident" id="5377259">i</span><span class="op" id="5377260">]</span><span class="op" id="5377261">.</span><span class="ident" id="5377262">index</span><span class="op" id="5377267">)</span>&nbsp;<span class="op" id="5377269">!=</span>&nbsp;<span class="builtinfunc" id="5377272">len</span><span class="op" id="5377275">(</span><span class="ident" id="5377276">x</span><span class="op" id="5377277">[</span><span class="ident" id="5377278">j</span><span class="op" id="5377279">]</span><span class="op" id="5377280">.</span><span class="ident" id="5377281">index</span><span class="op" id="5377286">)</span>&nbsp;<span class="op" id="5377288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377292">return</span>&nbsp;<span class="builtinfunc" id="5377299">len</span><span class="op" id="5377302">(</span><span class="ident" id="5377303">x</span><span class="op" id="5377304">[</span><span class="ident" id="5377305">i</span><span class="op" id="5377306">]</span><span class="op" id="5377307">.</span><span class="ident" id="5377308">index</span><span class="op" id="5377313">)</span>&nbsp;<span class="op" id="5377315">&lt;</span>&nbsp;<span class="builtinfunc" id="5377317">len</span><span class="op" id="5377320">(</span><span class="ident" id="5377321">x</span><span class="op" id="5377322">[</span><span class="ident" id="5377323">j</span><span class="op" id="5377324">]</span><span class="op" id="5377325">.</span><span class="ident" id="5377326">index</span><span class="op" id="5377331">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377337">if</span>&nbsp;<span class="ident" id="5377340">x</span><span class="op" id="5377341">[</span><span class="ident" id="5377342">i</span><span class="op" id="5377343">]</span><span class="op" id="5377344">.</span><span class="ident" id="5377345">tag</span>&nbsp;<span class="op" id="5377349">!=</span>&nbsp;<span class="ident" id="5377352">x</span><span class="op" id="5377353">[</span><span class="ident" id="5377354">j</span><span class="op" id="5377355">]</span><span class="op" id="5377356">.</span><span class="ident" id="5377357">tag</span>&nbsp;<span class="op" id="5377361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377365">return</span>&nbsp;<span class="ident" id="5377372">x</span><span class="op" id="5377373">[</span><span class="ident" id="5377374">i</span><span class="op" id="5377375">]</span><span class="op" id="5377376">.</span><span class="ident" id="5377377">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377385">return</span>&nbsp;<span class="ident" id="5377392">byIndex</span><span class="op" id="5377399">(</span><span class="ident" id="5377400">x</span><span class="op" id="5377401">)</span><span class="op" id="5377402">.</span><span class="ident" id="5377403">Less</span><span class="op" id="5377407">(</span><span class="ident" id="5377408">i</span><span class="op" id="5377409">,</span>&nbsp;<span class="ident" id="5377411">j</span><span class="op" id="5377412">)</span><br>
<span class="lineno">975</span><span class="op" id="5377414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5377417">//&nbsp;byIndex&nbsp;sorts&nbsp;field&nbsp;by&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="5377459">type</span>&nbsp;<span class="ident" id="5377464">byIndex</span>&nbsp;<span class="op" id="5377472">[</span><span class="op" id="5377473">]</span><span class="ident" id="5377474">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span><span class="keyword" id="5377481">func</span>&nbsp;<span class="op" id="5377486">(</span><span class="ident" id="5377487">x</span>&nbsp;<span class="ident" id="5377489">byIndex</span><span class="op" id="5377496">)</span>&nbsp;<span class="ident" id="5377498">Len</span><span class="op" id="5377501">(</span><span class="op" id="5377502">)</span>&nbsp;<span class="builtintype" id="5377504">int</span>&nbsp;<span class="op" id="5377508">{</span>&nbsp;<span class="keyword" id="5377510">return</span>&nbsp;<span class="builtinfunc" id="5377517">len</span><span class="op" id="5377520">(</span><span class="ident" id="5377521">x</span><span class="op" id="5377522">)</span>&nbsp;<span class="op" id="5377524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5377527">func</span>&nbsp;<span class="op" id="5377532">(</span><span class="ident" id="5377533">x</span>&nbsp;<span class="ident" id="5377535">byIndex</span><span class="op" id="5377542">)</span>&nbsp;<span class="ident" id="5377544">Swap</span><span class="op" id="5377548">(</span><span class="ident" id="5377549">i</span><span class="op" id="5377550">,</span>&nbsp;<span class="ident" id="5377552">j</span>&nbsp;<span class="builtintype" id="5377554">int</span><span class="op" id="5377557">)</span>&nbsp;<span class="op" id="5377559">{</span>&nbsp;<span class="ident" id="5377561">x</span><span class="op" id="5377562">[</span><span class="ident" id="5377563">i</span><span class="op" id="5377564">]</span><span class="op" id="5377565">,</span>&nbsp;<span class="ident" id="5377567">x</span><span class="op" id="5377568">[</span><span class="ident" id="5377569">j</span><span class="op" id="5377570">]</span>&nbsp;<span class="op" id="5377572">=</span>&nbsp;<span class="ident" id="5377574">x</span><span class="op" id="5377575">[</span><span class="ident" id="5377576">j</span><span class="op" id="5377577">]</span><span class="op" id="5377578">,</span>&nbsp;<span class="ident" id="5377580">x</span><span class="op" id="5377581">[</span><span class="ident" id="5377582">i</span><span class="op" id="5377583">]</span>&nbsp;<span class="op" id="5377585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5377588">func</span>&nbsp;<span class="op" id="5377593">(</span><span class="ident" id="5377594">x</span>&nbsp;<span class="ident" id="5377596">byIndex</span><span class="op" id="5377603">)</span>&nbsp;<span class="ident" id="5377605">Less</span><span class="op" id="5377609">(</span><span class="ident" id="5377610">i</span><span class="op" id="5377611">,</span>&nbsp;<span class="ident" id="5377613">j</span>&nbsp;<span class="builtintype" id="5377615">int</span><span class="op" id="5377618">)</span>&nbsp;<span class="builtintype" id="5377620">bool</span>&nbsp;<span class="op" id="5377625">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377628">for</span>&nbsp;<span class="ident" id="5377632">k</span><span class="op" id="5377633">,</span>&nbsp;<span class="ident" id="5377635">xik</span>&nbsp;<span class="op" id="5377639">:=</span>&nbsp;<span class="keyword" id="5377642">range</span>&nbsp;<span class="ident" id="5377648">x</span><span class="op" id="5377649">[</span><span class="ident" id="5377650">i</span><span class="op" id="5377651">]</span><span class="op" id="5377652">.</span><span class="ident" id="5377653">index</span>&nbsp;<span class="op" id="5377659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377663">if</span>&nbsp;<span class="ident" id="5377666">k</span>&nbsp;<span class="op" id="5377668">&gt;=</span>&nbsp;<span class="builtinfunc" id="5377671">len</span><span class="op" id="5377674">(</span><span class="ident" id="5377675">x</span><span class="op" id="5377676">[</span><span class="ident" id="5377677">j</span><span class="op" id="5377678">]</span><span class="op" id="5377679">.</span><span class="ident" id="5377680">index</span><span class="op" id="5377685">)</span>&nbsp;<span class="op" id="5377687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377692">return</span>&nbsp;<span class="builtintype" id="5377699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377711">if</span>&nbsp;<span class="ident" id="5377714">xik</span>&nbsp;<span class="op" id="5377718">!=</span>&nbsp;<span class="ident" id="5377721">x</span><span class="op" id="5377722">[</span><span class="ident" id="5377723">j</span><span class="op" id="5377724">]</span><span class="op" id="5377725">.</span><span class="ident" id="5377726">index</span><span class="op" id="5377731">[</span><span class="ident" id="5377732">k</span><span class="op" id="5377733">]</span>&nbsp;<span class="op" id="5377735">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377740">return</span>&nbsp;<span class="ident" id="5377747">xik</span>&nbsp;<span class="op" id="5377751">&lt;</span>&nbsp;<span class="ident" id="5377753">x</span><span class="op" id="5377754">[</span><span class="ident" id="5377755">j</span><span class="op" id="5377756">]</span><span class="op" id="5377757">.</span><span class="ident" id="5377758">index</span><span class="op" id="5377763">[</span><span class="ident" id="5377764">k</span><span class="op" id="5377765">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377775">return</span>&nbsp;<span class="builtinfunc" id="5377782">len</span><span class="op" id="5377785">(</span><span class="ident" id="5377786">x</span><span class="op" id="5377787">[</span><span class="ident" id="5377788">i</span><span class="op" id="5377789">]</span><span class="op" id="5377790">.</span><span class="ident" id="5377791">index</span><span class="op" id="5377796">)</span>&nbsp;<span class="op" id="5377798">&lt;</span>&nbsp;<span class="builtinfunc" id="5377800">len</span><span class="op" id="5377803">(</span><span class="ident" id="5377804">x</span><span class="op" id="5377805">[</span><span class="ident" id="5377806">j</span><span class="op" id="5377807">]</span><span class="op" id="5377808">.</span><span class="ident" id="5377809">index</span><span class="op" id="5377814">)</span><br>
<span class="lineno"></span><span class="op" id="5377816">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="comment" id="5377819">//&nbsp;typeFields&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;fields&nbsp;that&nbsp;JSON&nbsp;should&nbsp;recognize&nbsp;for&nbsp;the&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5377905">//&nbsp;The&nbsp;algorithm&nbsp;is&nbsp;breadth-first&nbsp;search&nbsp;over&nbsp;the&nbsp;set&nbsp;of&nbsp;structs&nbsp;to&nbsp;include&nbsp;-&nbsp;the&nbsp;top&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="5377998">//&nbsp;and&nbsp;then&nbsp;any&nbsp;reachable&nbsp;anonymous&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="5378043">func</span>&nbsp;<span class="ident" id="5378048">typeFields</span><span class="op" id="5378058">(</span><span class="ident" id="5378059">t</span>&nbsp;<span class="ident" id="5378061">reflect</span><span class="op" id="5378068">.</span><span class="ident" id="5378069">Type</span><span class="op" id="5378073">)</span>&nbsp;<span class="op" id="5378075">[</span><span class="op" id="5378076">]</span><span class="ident" id="5378077">field</span>&nbsp;<span class="op" id="5378083">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378086">//&nbsp;Anonymous&nbsp;fields&nbsp;to&nbsp;explore&nbsp;at&nbsp;the&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378153">current</span>&nbsp;<span class="op" id="5378161">:=</span>&nbsp;<span class="op" id="5378164">[</span><span class="op" id="5378165">]</span><span class="ident" id="5378166">field</span><span class="op" id="5378171">{</span><span class="op" id="5378172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378175">next</span>&nbsp;<span class="op" id="5378180">:=</span>&nbsp;<span class="op" id="5378183">[</span><span class="op" id="5378184">]</span><span class="ident" id="5378185">field</span><span class="op" id="5378190">{</span><span class="op" id="5378191">{</span><span class="ident" id="5378192">typ</span><span class="op" id="5378195">:</span>&nbsp;<span class="ident" id="5378197">t</span><span class="op" id="5378198">}</span><span class="op" id="5378199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378203">//&nbsp;Count&nbsp;of&nbsp;queued&nbsp;names&nbsp;for&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378261">count</span>&nbsp;<span class="op" id="5378267">:=</span>&nbsp;<span class="keyword" id="5378270">map</span><span class="op" id="5378273">[</span><span class="ident" id="5378274">reflect</span><span class="op" id="5378281">.</span><span class="ident" id="5378282">Type</span><span class="op" id="5378286">]</span><span class="builtintype" id="5378287">int</span><span class="op" id="5378290">{</span><span class="op" id="5378291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378294">nextCount</span>&nbsp;<span class="op" id="5378304">:=</span>&nbsp;<span class="keyword" id="5378307">map</span><span class="op" id="5378310">[</span><span class="ident" id="5378311">reflect</span><span class="op" id="5378318">.</span><span class="ident" id="5378319">Type</span><span class="op" id="5378323">]</span><span class="builtintype" id="5378324">int</span><span class="op" id="5378327">{</span><span class="op" id="5378328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378332">//&nbsp;Types&nbsp;already&nbsp;visited&nbsp;at&nbsp;an&nbsp;earlier&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378379">visited</span>&nbsp;<span class="op" id="5378387">:=</span>&nbsp;<span class="keyword" id="5378390">map</span><span class="op" id="5378393">[</span><span class="ident" id="5378394">reflect</span><span class="op" id="5378401">.</span><span class="ident" id="5378402">Type</span><span class="op" id="5378406">]</span><span class="builtintype" id="5378407">bool</span><span class="op" id="5378411">{</span><span class="op" id="5378412">}</span><br>
<span class="lineno">1010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378416">//&nbsp;Fields&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378434">var</span>&nbsp;<span class="ident" id="5378438">fields</span>&nbsp;<span class="op" id="5378445">[</span><span class="op" id="5378446">]</span><span class="ident" id="5378447">field</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378455">for</span>&nbsp;<span class="builtinfunc" id="5378459">len</span><span class="op" id="5378462">(</span><span class="ident" id="5378463">next</span><span class="op" id="5378467">)</span>&nbsp;<span class="op" id="5378469">&gt;</span>&nbsp;<span class="num" id="5378471">0</span>&nbsp;<span class="op" id="5378473">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378477">current</span><span class="op" id="5378484">,</span>&nbsp;<span class="ident" id="5378486">next</span>&nbsp;<span class="op" id="5378491">=</span>&nbsp;<span class="ident" id="5378493">next</span><span class="op" id="5378497">,</span>&nbsp;<span class="ident" id="5378499">current</span><span class="op" id="5378506">[</span><span class="op" id="5378507">:</span><span class="num" id="5378508">0</span><span class="op" id="5378509">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378513">count</span><span class="op" id="5378518">,</span>&nbsp;<span class="ident" id="5378520">nextCount</span>&nbsp;<span class="op" id="5378530">=</span>&nbsp;<span class="ident" id="5378532">nextCount</span><span class="op" id="5378541">,</span>&nbsp;<span class="keyword" id="5378543">map</span><span class="op" id="5378546">[</span><span class="ident" id="5378547">reflect</span><span class="op" id="5378554">.</span><span class="ident" id="5378555">Type</span><span class="op" id="5378559">]</span><span class="builtintype" id="5378560">int</span><span class="op" id="5378563">{</span><span class="op" id="5378564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378569">for</span>&nbsp;<span class="ident" id="5378573">_</span><span class="op" id="5378574">,</span>&nbsp;<span class="ident" id="5378576">f</span>&nbsp;<span class="op" id="5378578">:=</span>&nbsp;<span class="keyword" id="5378581">range</span>&nbsp;<span class="ident" id="5378587">current</span>&nbsp;<span class="op" id="5378595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378600">if</span>&nbsp;<span class="ident" id="5378603">visited</span><span class="op" id="5378610">[</span><span class="ident" id="5378611">f</span><span class="op" id="5378612">.</span><span class="ident" id="5378613">typ</span><span class="op" id="5378616">]</span>&nbsp;<span class="op" id="5378618">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378624">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378641">visited</span><span class="op" id="5378648">[</span><span class="ident" id="5378649">f</span><span class="op" id="5378650">.</span><span class="ident" id="5378651">typ</span><span class="op" id="5378654">]</span>&nbsp;<span class="op" id="5378656">=</span>&nbsp;<span class="builtintype" id="5378658">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378667">//&nbsp;Scan&nbsp;f.typ&nbsp;for&nbsp;fields&nbsp;to&nbsp;include.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378707">for</span>&nbsp;<span class="ident" id="5378711">i</span>&nbsp;<span class="op" id="5378713">:=</span>&nbsp;<span class="num" id="5378716">0</span><span class="op" id="5378717">;</span>&nbsp;<span class="ident" id="5378719">i</span>&nbsp;<span class="op" id="5378721">&lt;</span>&nbsp;<span class="ident" id="5378723">f</span><span class="op" id="5378724">.</span><span class="ident" id="5378725">typ</span><span class="op" id="5378728">.</span><span class="ident" id="5378729">NumField</span><span class="op" id="5378737">(</span><span class="op" id="5378738">)</span><span class="op" id="5378739">;</span>&nbsp;<span class="ident" id="5378741">i</span><span class="op" id="5378742">++</span>&nbsp;<span class="op" id="5378745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378751">sf</span>&nbsp;<span class="op" id="5378754">:=</span>&nbsp;<span class="ident" id="5378757">f</span><span class="op" id="5378758">.</span><span class="ident" id="5378759">typ</span><span class="op" id="5378762">.</span><span class="ident" id="5378763">Field</span><span class="op" id="5378768">(</span><span class="ident" id="5378769">i</span><span class="op" id="5378770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378776">if</span>&nbsp;<span class="ident" id="5378779">sf</span><span class="op" id="5378781">.</span><span class="ident" id="5378782">PkgPath</span>&nbsp;<span class="op" id="5378790">!=</span>&nbsp;<span class="string" id="5378793">&#34;&#34;</span>&nbsp;<span class="op" id="5378796">{</span>&nbsp;<span class="comment" id="5378798">//&nbsp;unexported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378817">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378830">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378836">tag</span>&nbsp;<span class="op" id="5378840">:=</span>&nbsp;<span class="ident" id="5378843">sf</span><span class="op" id="5378845">.</span><span class="ident" id="5378846">Tag</span><span class="op" id="5378849">.</span><span class="ident" id="5378850">Get</span><span class="op" id="5378853">(</span><span class="string" id="5378854">&#34;json&#34;</span><span class="op" id="5378860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378866">if</span>&nbsp;<span class="ident" id="5378869">tag</span>&nbsp;<span class="op" id="5378873">==</span>&nbsp;<span class="string" id="5378876">&#34;-&#34;</span>&nbsp;<span class="op" id="5378880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378887">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378906">name</span><span class="op" id="5378910">,</span>&nbsp;<span class="ident" id="5378912">opts</span>&nbsp;<span class="op" id="5378917">:=</span>&nbsp;<span class="ident" id="5378920">parseTag</span><span class="op" id="5378928">(</span><span class="ident" id="5378929">tag</span><span class="op" id="5378932">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378938">if</span>&nbsp;<span class="op" id="5378941">!</span><span class="ident" id="5378942">isValidTag</span><span class="op" id="5378952">(</span><span class="ident" id="5378953">name</span><span class="op" id="5378957">)</span>&nbsp;<span class="op" id="5378959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378966">name</span>&nbsp;<span class="op" id="5378971">=</span>&nbsp;<span class="string" id="5378973">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378986">index</span>&nbsp;<span class="op" id="5378992">:=</span>&nbsp;<span class="builtinfunc" id="5378995">make</span><span class="op" id="5378999">(</span><span class="op" id="5379000">[</span><span class="op" id="5379001">]</span><span class="builtintype" id="5379002">int</span><span class="op" id="5379005">,</span>&nbsp;<span class="builtinfunc" id="5379007">len</span><span class="op" id="5379010">(</span><span class="ident" id="5379011">f</span><span class="op" id="5379012">.</span><span class="ident" id="5379013">index</span><span class="op" id="5379018">)</span><span class="op" id="5379019">+</span><span class="num" id="5379020">1</span><span class="op" id="5379021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5379027">copy</span><span class="op" id="5379031">(</span><span class="ident" id="5379032">index</span><span class="op" id="5379037">,</span>&nbsp;<span class="ident" id="5379039">f</span><span class="op" id="5379040">.</span><span class="ident" id="5379041">index</span><span class="op" id="5379046">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379052">index</span><span class="op" id="5379057">[</span><span class="builtinfunc" id="5379058">len</span><span class="op" id="5379061">(</span><span class="ident" id="5379062">f</span><span class="op" id="5379063">.</span><span class="ident" id="5379064">index</span><span class="op" id="5379069">)</span><span class="op" id="5379070">]</span>&nbsp;<span class="op" id="5379072">=</span>&nbsp;<span class="ident" id="5379074">i</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379081">ft</span>&nbsp;<span class="op" id="5379084">:=</span>&nbsp;<span class="ident" id="5379087">sf</span><span class="op" id="5379089">.</span><span class="ident" id="5379090">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379099">if</span>&nbsp;<span class="ident" id="5379102">ft</span><span class="op" id="5379104">.</span><span class="ident" id="5379105">Name</span><span class="op" id="5379109">(</span><span class="op" id="5379110">)</span>&nbsp;<span class="op" id="5379112">==</span>&nbsp;<span class="string" id="5379115">&#34;&#34;</span>&nbsp;<span class="op" id="5379118">&amp;&amp;</span>&nbsp;<span class="ident" id="5379121">ft</span><span class="op" id="5379123">.</span><span class="ident" id="5379124">Kind</span><span class="op" id="5379128">(</span><span class="op" id="5379129">)</span>&nbsp;<span class="op" id="5379131">==</span>&nbsp;<span class="ident" id="5379134">reflect</span><span class="op" id="5379141">.</span><span class="ident" id="5379142">Ptr</span>&nbsp;<span class="op" id="5379146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379153">//&nbsp;Follow&nbsp;pointer.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379177">ft</span>&nbsp;<span class="op" id="5379180">=</span>&nbsp;<span class="ident" id="5379182">ft</span><span class="op" id="5379184">.</span><span class="ident" id="5379185">Elem</span><span class="op" id="5379189">(</span><span class="op" id="5379190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379203">//&nbsp;Record&nbsp;found&nbsp;field&nbsp;and&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379249">if</span>&nbsp;<span class="ident" id="5379252">name</span>&nbsp;<span class="op" id="5379257">!=</span>&nbsp;<span class="string" id="5379260">&#34;&#34;</span>&nbsp;<span class="op" id="5379263">||</span>&nbsp;<span class="op" id="5379266">!</span><span class="ident" id="5379267">sf</span><span class="op" id="5379269">.</span><span class="ident" id="5379270">Anonymous</span>&nbsp;<span class="op" id="5379280">||</span>&nbsp;<span class="ident" id="5379283">ft</span><span class="op" id="5379285">.</span><span class="ident" id="5379286">Kind</span><span class="op" id="5379290">(</span><span class="op" id="5379291">)</span>&nbsp;<span class="op" id="5379293">!=</span>&nbsp;<span class="ident" id="5379296">reflect</span><span class="op" id="5379303">.</span><span class="ident" id="5379304">Struct</span>&nbsp;<span class="op" id="5379311">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379318">tagged</span>&nbsp;<span class="op" id="5379325">:=</span>&nbsp;<span class="ident" id="5379328">name</span>&nbsp;<span class="op" id="5379333">!=</span>&nbsp;<span class="string" id="5379336">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379344">if</span>&nbsp;<span class="ident" id="5379347">name</span>&nbsp;<span class="op" id="5379352">==</span>&nbsp;<span class="string" id="5379355">&#34;&#34;</span>&nbsp;<span class="op" id="5379358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379366">name</span>&nbsp;<span class="op" id="5379371">=</span>&nbsp;<span class="ident" id="5379373">sf</span><span class="op" id="5379375">.</span><span class="ident" id="5379376">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379393">fields</span>&nbsp;<span class="op" id="5379400">=</span>&nbsp;<span class="builtinfunc" id="5379402">append</span><span class="op" id="5379408">(</span><span class="ident" id="5379409">fields</span><span class="op" id="5379415">,</span>&nbsp;<span class="ident" id="5379417">fillField</span><span class="op" id="5379426">(</span><span class="ident" id="5379427">field</span><span class="op" id="5379432">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379440">name</span><span class="op" id="5379444">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379451">name</span><span class="op" id="5379455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379463">tag</span><span class="op" id="5379466">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379474">tagged</span><span class="op" id="5379480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379488">index</span><span class="op" id="5379493">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379499">index</span><span class="op" id="5379504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379512">typ</span><span class="op" id="5379515">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379523">ft</span><span class="op" id="5379525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379533">omitEmpty</span><span class="op" id="5379542">:</span>&nbsp;<span class="ident" id="5379544">opts</span><span class="op" id="5379548">.</span><span class="ident" id="5379549">Contains</span><span class="op" id="5379557">(</span><span class="string" id="5379558">&#34;omitempty&#34;</span><span class="op" id="5379569">)</span><span class="op" id="5379570">,</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379578">quoted</span><span class="op" id="5379584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379589">opts</span><span class="op" id="5379593">.</span><span class="ident" id="5379594">Contains</span><span class="op" id="5379602">(</span><span class="string" id="5379603">&#34;string&#34;</span><span class="op" id="5379611">)</span><span class="op" id="5379612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379619">}</span><span class="op" id="5379620">)</span><span class="op" id="5379621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379628">if</span>&nbsp;<span class="ident" id="5379631">count</span><span class="op" id="5379636">[</span><span class="ident" id="5379637">f</span><span class="op" id="5379638">.</span><span class="ident" id="5379639">typ</span><span class="op" id="5379642">]</span>&nbsp;<span class="op" id="5379644">&gt;</span>&nbsp;<span class="num" id="5379646">1</span>&nbsp;<span class="op" id="5379648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379656">//&nbsp;If&nbsp;there&nbsp;were&nbsp;multiple&nbsp;instances,&nbsp;add&nbsp;a&nbsp;second,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379713">//&nbsp;so&nbsp;that&nbsp;the&nbsp;annihilation&nbsp;code&nbsp;will&nbsp;see&nbsp;a&nbsp;duplicate.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379774">//&nbsp;It&nbsp;only&nbsp;cares&nbsp;about&nbsp;the&nbsp;distinction&nbsp;between&nbsp;1&nbsp;or&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379835">//&nbsp;so&nbsp;don&#39;t&nbsp;bother&nbsp;generating&nbsp;any&nbsp;more&nbsp;copies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379888">fields</span>&nbsp;<span class="op" id="5379895">=</span>&nbsp;<span class="builtinfunc" id="5379897">append</span><span class="op" id="5379903">(</span><span class="ident" id="5379904">fields</span><span class="op" id="5379910">,</span>&nbsp;<span class="ident" id="5379912">fields</span><span class="op" id="5379918">[</span><span class="builtinfunc" id="5379919">len</span><span class="op" id="5379922">(</span><span class="ident" id="5379923">fields</span><span class="op" id="5379929">)</span><span class="op" id="5379930">-</span><span class="num" id="5379931">1</span><span class="op" id="5379932">]</span><span class="op" id="5379933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379947">continue</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379967">//&nbsp;Record&nbsp;new&nbsp;anonymous&nbsp;struct&nbsp;to&nbsp;explore&nbsp;in&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380028">nextCount</span><span class="op" id="5380037">[</span><span class="ident" id="5380038">ft</span><span class="op" id="5380040">]</span><span class="op" id="5380041">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380048">if</span>&nbsp;<span class="ident" id="5380051">nextCount</span><span class="op" id="5380060">[</span><span class="ident" id="5380061">ft</span><span class="op" id="5380063">]</span>&nbsp;<span class="op" id="5380065">==</span>&nbsp;<span class="num" id="5380068">1</span>&nbsp;<span class="op" id="5380070">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380077">next</span>&nbsp;<span class="op" id="5380082">=</span>&nbsp;<span class="builtinfunc" id="5380084">append</span><span class="op" id="5380090">(</span><span class="ident" id="5380091">next</span><span class="op" id="5380095">,</span>&nbsp;<span class="ident" id="5380097">fillField</span><span class="op" id="5380106">(</span><span class="ident" id="5380107">field</span><span class="op" id="5380112">{</span><span class="ident" id="5380113">name</span><span class="op" id="5380117">:</span>&nbsp;<span class="ident" id="5380119">ft</span><span class="op" id="5380121">.</span><span class="ident" id="5380122">Name</span><span class="op" id="5380126">(</span><span class="op" id="5380127">)</span><span class="op" id="5380128">,</span>&nbsp;<span class="ident" id="5380130">index</span><span class="op" id="5380135">:</span>&nbsp;<span class="ident" id="5380137">index</span><span class="op" id="5380142">,</span>&nbsp;<span class="ident" id="5380144">typ</span><span class="op" id="5380147">:</span>&nbsp;<span class="ident" id="5380149">ft</span><span class="op" id="5380151">}</span><span class="op" id="5380152">)</span><span class="op" id="5380153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380171">}</span><br>
<span class="lineno">1080</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380175">sort</span><span class="op" id="5380179">.</span><span class="ident" id="5380180">Sort</span><span class="op" id="5380184">(</span><span class="ident" id="5380185">byName</span><span class="op" id="5380191">(</span><span class="ident" id="5380192">fields</span><span class="op" id="5380198">)</span><span class="op" id="5380199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380203">//&nbsp;Delete&nbsp;all&nbsp;fields&nbsp;that&nbsp;are&nbsp;hidden&nbsp;by&nbsp;the&nbsp;Go&nbsp;rules&nbsp;for&nbsp;embedded&nbsp;fields,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380278">//&nbsp;except&nbsp;that&nbsp;fields&nbsp;with&nbsp;JSON&nbsp;tags&nbsp;are&nbsp;promoted.</span><br>
<span class="lineno">1085</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380331">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;primary&nbsp;order&nbsp;of&nbsp;name,&nbsp;secondary&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380399">//&nbsp;of&nbsp;field&nbsp;index&nbsp;length.&nbsp;Loop&nbsp;over&nbsp;names;&nbsp;for&nbsp;each&nbsp;name,&nbsp;delete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380465">//&nbsp;hidden&nbsp;fields&nbsp;by&nbsp;choosing&nbsp;the&nbsp;one&nbsp;dominant&nbsp;field&nbsp;that&nbsp;survives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380533">out</span>&nbsp;<span class="op" id="5380537">:=</span>&nbsp;<span class="ident" id="5380540">fields</span><span class="op" id="5380546">[</span><span class="op" id="5380547">:</span><span class="num" id="5380548">0</span><span class="op" id="5380549">]</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380552">for</span>&nbsp;<span class="ident" id="5380556">advance</span><span class="op" id="5380563">,</span>&nbsp;<span class="ident" id="5380565">i</span>&nbsp;<span class="op" id="5380567">:=</span>&nbsp;<span class="num" id="5380570">0</span><span class="op" id="5380571">,</span>&nbsp;<span class="num" id="5380573">0</span><span class="op" id="5380574">;</span>&nbsp;<span class="ident" id="5380576">i</span>&nbsp;<span class="op" id="5380578">&lt;</span>&nbsp;<span class="builtinfunc" id="5380580">len</span><span class="op" id="5380583">(</span><span class="ident" id="5380584">fields</span><span class="op" id="5380590">)</span><span class="op" id="5380591">;</span>&nbsp;<span class="ident" id="5380593">i</span>&nbsp;<span class="op" id="5380595">+=</span>&nbsp;<span class="ident" id="5380598">advance</span>&nbsp;<span class="op" id="5380606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380610">//&nbsp;One&nbsp;iteration&nbsp;per&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380639">//&nbsp;Find&nbsp;the&nbsp;sequence&nbsp;of&nbsp;fields&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380707">fi</span>&nbsp;<span class="op" id="5380710">:=</span>&nbsp;<span class="ident" id="5380713">fields</span><span class="op" id="5380719">[</span><span class="ident" id="5380720">i</span><span class="op" id="5380721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380725">name</span>&nbsp;<span class="op" id="5380730">:=</span>&nbsp;<span class="ident" id="5380733">fi</span><span class="op" id="5380735">.</span><span class="ident" id="5380736">name</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380743">for</span>&nbsp;<span class="ident" id="5380747">advance</span>&nbsp;<span class="op" id="5380755">=</span>&nbsp;<span class="num" id="5380757">1</span><span class="op" id="5380758">;</span>&nbsp;<span class="ident" id="5380760">i</span><span class="op" id="5380761">+</span><span class="ident" id="5380762">advance</span>&nbsp;<span class="op" id="5380770">&lt;</span>&nbsp;<span class="builtinfunc" id="5380772">len</span><span class="op" id="5380775">(</span><span class="ident" id="5380776">fields</span><span class="op" id="5380782">)</span><span class="op" id="5380783">;</span>&nbsp;<span class="ident" id="5380785">advance</span><span class="op" id="5380792">++</span>&nbsp;<span class="op" id="5380795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380800">fj</span>&nbsp;<span class="op" id="5380803">:=</span>&nbsp;<span class="ident" id="5380806">fields</span><span class="op" id="5380812">[</span><span class="ident" id="5380813">i</span><span class="op" id="5380814">+</span><span class="ident" id="5380815">advance</span><span class="op" id="5380822">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380827">if</span>&nbsp;<span class="ident" id="5380830">fj</span><span class="op" id="5380832">.</span><span class="ident" id="5380833">name</span>&nbsp;<span class="op" id="5380838">!=</span>&nbsp;<span class="ident" id="5380841">name</span>&nbsp;<span class="op" id="5380846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380852">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380861">}</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380869">if</span>&nbsp;<span class="ident" id="5380872">advance</span>&nbsp;<span class="op" id="5380880">==</span>&nbsp;<span class="num" id="5380883">1</span>&nbsp;<span class="op" id="5380885">{</span>&nbsp;<span class="comment" id="5380887">//&nbsp;Only&nbsp;one&nbsp;field&nbsp;with&nbsp;this&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380923">out</span>&nbsp;<span class="op" id="5380927">=</span>&nbsp;<span class="builtinfunc" id="5380929">append</span><span class="op" id="5380935">(</span><span class="ident" id="5380936">out</span><span class="op" id="5380939">,</span>&nbsp;<span class="ident" id="5380941">fi</span><span class="op" id="5380943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380948">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380959">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380963">dominant</span><span class="op" id="5380971">,</span>&nbsp;<span class="ident" id="5380973">ok</span>&nbsp;<span class="op" id="5380976">:=</span>&nbsp;<span class="ident" id="5380979">dominantField</span><span class="op" id="5380992">(</span><span class="ident" id="5380993">fields</span><span class="op" id="5380999">[</span><span class="ident" id="5381000">i</span>&nbsp;<span class="op" id="5381002">:</span>&nbsp;<span class="ident" id="5381004">i</span><span class="op" id="5381005">+</span><span class="ident" id="5381006">advance</span><span class="op" id="5381013">]</span><span class="op" id="5381014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381018">if</span>&nbsp;<span class="ident" id="5381021">ok</span>&nbsp;<span class="op" id="5381024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381029">out</span>&nbsp;<span class="op" id="5381033">=</span>&nbsp;<span class="builtinfunc" id="5381035">append</span><span class="op" id="5381041">(</span><span class="ident" id="5381042">out</span><span class="op" id="5381045">,</span>&nbsp;<span class="ident" id="5381047">dominant</span><span class="op" id="5381055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381062">}</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381066">fields</span>&nbsp;<span class="op" id="5381073">=</span>&nbsp;<span class="ident" id="5381075">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381080">sort</span><span class="op" id="5381084">.</span><span class="ident" id="5381085">Sort</span><span class="op" id="5381089">(</span><span class="ident" id="5381090">byIndex</span><span class="op" id="5381097">(</span><span class="ident" id="5381098">fields</span><span class="op" id="5381104">)</span><span class="op" id="5381105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381109">return</span>&nbsp;<span class="ident" id="5381116">fields</span><br>
<span class="lineno">1115</span><span class="op" id="5381123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5381126">//&nbsp;dominantField&nbsp;looks&nbsp;through&nbsp;the&nbsp;fields,&nbsp;all&nbsp;of&nbsp;which&nbsp;are&nbsp;known&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5381195">//&nbsp;have&nbsp;the&nbsp;same&nbsp;name,&nbsp;to&nbsp;find&nbsp;the&nbsp;single&nbsp;field&nbsp;that&nbsp;dominates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5381262">//&nbsp;others&nbsp;using&nbsp;Go&#39;s&nbsp;embedding&nbsp;rules,&nbsp;modified&nbsp;by&nbsp;the&nbsp;presence&nbsp;of</span><br>
<span class="lineno">1120</span><span class="comment" id="5381328">//&nbsp;JSON&nbsp;tags.&nbsp;If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;top-level&nbsp;fields,&nbsp;the&nbsp;boolean</span><br>
<span class="lineno"></span><span class="comment" id="5381394">//&nbsp;will&nbsp;be&nbsp;false:&nbsp;This&nbsp;condition&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;Go&nbsp;and&nbsp;we&nbsp;skip&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5381461">//&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5381476">func</span>&nbsp;<span class="ident" id="5381481">dominantField</span><span class="op" id="5381494">(</span><span class="ident" id="5381495">fields</span>&nbsp;<span class="op" id="5381502">[</span><span class="op" id="5381503">]</span><span class="ident" id="5381504">field</span><span class="op" id="5381509">)</span>&nbsp;<span class="op" id="5381511">(</span><span class="ident" id="5381512">field</span><span class="op" id="5381517">,</span>&nbsp;<span class="builtintype" id="5381519">bool</span><span class="op" id="5381523">)</span>&nbsp;<span class="op" id="5381525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381528">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;increasing&nbsp;index-length&nbsp;order.&nbsp;The&nbsp;winner</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381599">//&nbsp;must&nbsp;therefore&nbsp;be&nbsp;one&nbsp;with&nbsp;the&nbsp;shortest&nbsp;index&nbsp;length.&nbsp;Drop&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381666">//&nbsp;longer&nbsp;entries,&nbsp;which&nbsp;is&nbsp;easy:&nbsp;just&nbsp;truncate&nbsp;the&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381726">length</span>&nbsp;<span class="op" id="5381733">:=</span>&nbsp;<span class="builtinfunc" id="5381736">len</span><span class="op" id="5381739">(</span><span class="ident" id="5381740">fields</span><span class="op" id="5381746">[</span><span class="num" id="5381747">0</span><span class="op" id="5381748">]</span><span class="op" id="5381749">.</span><span class="ident" id="5381750">index</span><span class="op" id="5381755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381758">tagged</span>&nbsp;<span class="op" id="5381765">:=</span>&nbsp;<span class="op" id="5381768">-</span><span class="num" id="5381769">1</span>&nbsp;<span class="comment" id="5381771">//&nbsp;Index&nbsp;of&nbsp;first&nbsp;tagged&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381804">for</span>&nbsp;<span class="ident" id="5381808">i</span><span class="op" id="5381809">,</span>&nbsp;<span class="ident" id="5381811">f</span>&nbsp;<span class="op" id="5381813">:=</span>&nbsp;<span class="keyword" id="5381816">range</span>&nbsp;<span class="ident" id="5381822">fields</span>&nbsp;<span class="op" id="5381829">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381833">if</span>&nbsp;<span class="builtinfunc" id="5381836">len</span><span class="op" id="5381839">(</span><span class="ident" id="5381840">f</span><span class="op" id="5381841">.</span><span class="ident" id="5381842">index</span><span class="op" id="5381847">)</span>&nbsp;<span class="op" id="5381849">&gt;</span>&nbsp;<span class="ident" id="5381851">length</span>&nbsp;<span class="op" id="5381858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381863">fields</span>&nbsp;<span class="op" id="5381870">=</span>&nbsp;<span class="ident" id="5381872">fields</span><span class="op" id="5381878">[</span><span class="op" id="5381879">:</span><span class="ident" id="5381880">i</span><span class="op" id="5381881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381886">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381898">if</span>&nbsp;<span class="ident" id="5381901">f</span><span class="op" id="5381902">.</span><span class="ident" id="5381903">tag</span>&nbsp;<span class="op" id="5381907">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381912">if</span>&nbsp;<span class="ident" id="5381915">tagged</span>&nbsp;<span class="op" id="5381922">&gt;=</span>&nbsp;<span class="num" id="5381925">0</span>&nbsp;<span class="op" id="5381927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381933">//&nbsp;Multiple&nbsp;tagged&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level:&nbsp;conflict.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381992">//&nbsp;Return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382016">return</span>&nbsp;<span class="ident" id="5382023">field</span><span class="op" id="5382028">{</span><span class="op" id="5382029">}</span><span class="op" id="5382030">,</span>&nbsp;<span class="builtintype" id="5382032">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382041">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382046">tagged</span>&nbsp;<span class="op" id="5382053">=</span>&nbsp;<span class="ident" id="5382055">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382065">if</span>&nbsp;<span class="ident" id="5382068">tagged</span>&nbsp;<span class="op" id="5382075">&gt;=</span>&nbsp;<span class="num" id="5382078">0</span>&nbsp;<span class="op" id="5382080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382084">return</span>&nbsp;<span class="ident" id="5382091">fields</span><span class="op" id="5382097">[</span><span class="ident" id="5382098">tagged</span><span class="op" id="5382104">]</span><span class="op" id="5382105">,</span>&nbsp;<span class="builtintype" id="5382107">true</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382116">//&nbsp;All&nbsp;remaining&nbsp;fields&nbsp;have&nbsp;the&nbsp;same&nbsp;length.&nbsp;If&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382189">//&nbsp;we&nbsp;have&nbsp;a&nbsp;conflict&nbsp;(two&nbsp;fields&nbsp;named&nbsp;&#34;X&#34;&nbsp;at&nbsp;the&nbsp;same&nbsp;level)&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382260">//&nbsp;return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382281">if</span>&nbsp;<span class="builtinfunc" id="5382284">len</span><span class="op" id="5382287">(</span><span class="ident" id="5382288">fields</span><span class="op" id="5382294">)</span>&nbsp;<span class="op" id="5382296">&gt;</span>&nbsp;<span class="num" id="5382298">1</span>&nbsp;<span class="op" id="5382300">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382304">return</span>&nbsp;<span class="ident" id="5382311">field</span><span class="op" id="5382316">{</span><span class="op" id="5382317">}</span><span class="op" id="5382318">,</span>&nbsp;<span class="builtintype" id="5382320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382330">return</span>&nbsp;<span class="ident" id="5382337">fields</span><span class="op" id="5382343">[</span><span class="num" id="5382344">0</span><span class="op" id="5382345">]</span><span class="op" id="5382346">,</span>&nbsp;<span class="builtintype" id="5382348">true</span><br>
<span class="lineno"></span><span class="op" id="5382353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1155</span><span class="keyword" id="5382356">var</span>&nbsp;<span class="ident" id="5382360">fieldCache</span>&nbsp;<span class="keyword" id="5382371">struct</span>&nbsp;<span class="op" id="5382378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382381">sync</span><span class="op" id="5382385">.</span><span class="ident" id="5382386">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382395">m</span>&nbsp;<span class="keyword" id="5382397">map</span><span class="op" id="5382400">[</span><span class="ident" id="5382401">reflect</span><span class="op" id="5382408">.</span><span class="ident" id="5382409">Type</span><span class="op" id="5382413">]</span><span class="op" id="5382414">[</span><span class="op" id="5382415">]</span><span class="ident" id="5382416">field</span><br>
<span class="lineno"></span><span class="op" id="5382422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="5382425">//&nbsp;cachedTypeFields&nbsp;is&nbsp;like&nbsp;typeFields&nbsp;but&nbsp;uses&nbsp;a&nbsp;cache&nbsp;to&nbsp;avoid&nbsp;repeated&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="5382505">func</span>&nbsp;<span class="ident" id="5382510">cachedTypeFields</span><span class="op" id="5382526">(</span><span class="ident" id="5382527">t</span>&nbsp;<span class="ident" id="5382529">reflect</span><span class="op" id="5382536">.</span><span class="ident" id="5382537">Type</span><span class="op" id="5382541">)</span>&nbsp;<span class="op" id="5382543">[</span><span class="op" id="5382544">]</span><span class="ident" id="5382545">field</span>&nbsp;<span class="op" id="5382551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382554">fieldCache</span><span class="op" id="5382564">.</span><span class="ident" id="5382565">RLock</span><span class="op" id="5382570">(</span><span class="op" id="5382571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382574">f</span>&nbsp;<span class="op" id="5382576">:=</span>&nbsp;<span class="ident" id="5382579">fieldCache</span><span class="op" id="5382589">.</span><span class="ident" id="5382590">m</span><span class="op" id="5382591">[</span><span class="ident" id="5382592">t</span><span class="op" id="5382593">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382596">fieldCache</span><span class="op" id="5382606">.</span><span class="ident" id="5382607">RUnlock</span><span class="op" id="5382614">(</span><span class="op" id="5382615">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382618">if</span>&nbsp;<span class="ident" id="5382621">f</span>&nbsp;<span class="op" id="5382623">!=</span>&nbsp;<span class="builtintype" id="5382626">nil</span>&nbsp;<span class="op" id="5382630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382634">return</span>&nbsp;<span class="ident" id="5382641">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382648">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382681">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382748">f</span>&nbsp;<span class="op" id="5382750">=</span>&nbsp;<span class="ident" id="5382752">typeFields</span><span class="op" id="5382762">(</span><span class="ident" id="5382763">t</span><span class="op" id="5382764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382767">if</span>&nbsp;<span class="ident" id="5382770">f</span>&nbsp;<span class="op" id="5382772">==</span>&nbsp;<span class="builtintype" id="5382775">nil</span>&nbsp;<span class="op" id="5382779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382783">f</span>&nbsp;<span class="op" id="5382785">=</span>&nbsp;<span class="op" id="5382787">[</span><span class="op" id="5382788">]</span><span class="ident" id="5382789">field</span><span class="op" id="5382794">{</span><span class="op" id="5382795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382798">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382802">fieldCache</span><span class="op" id="5382812">.</span><span class="ident" id="5382813">Lock</span><span class="op" id="5382817">(</span><span class="op" id="5382818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382821">if</span>&nbsp;<span class="ident" id="5382824">fieldCache</span><span class="op" id="5382834">.</span><span class="ident" id="5382835">m</span>&nbsp;<span class="op" id="5382837">==</span>&nbsp;<span class="builtintype" id="5382840">nil</span>&nbsp;<span class="op" id="5382844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382848">fieldCache</span><span class="op" id="5382858">.</span><span class="ident" id="5382859">m</span>&nbsp;<span class="op" id="5382861">=</span>&nbsp;<span class="keyword" id="5382863">map</span><span class="op" id="5382866">[</span><span class="ident" id="5382867">reflect</span><span class="op" id="5382874">.</span><span class="ident" id="5382875">Type</span><span class="op" id="5382879">]</span><span class="op" id="5382880">[</span><span class="op" id="5382881">]</span><span class="ident" id="5382882">field</span><span class="op" id="5382887">{</span><span class="op" id="5382888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382891">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382894">fieldCache</span><span class="op" id="5382904">.</span><span class="ident" id="5382905">m</span><span class="op" id="5382906">[</span><span class="ident" id="5382907">t</span><span class="op" id="5382908">]</span>&nbsp;<span class="op" id="5382910">=</span>&nbsp;<span class="ident" id="5382912">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382915">fieldCache</span><span class="op" id="5382925">.</span><span class="ident" id="5382926">Unlock</span><span class="op" id="5382932">(</span><span class="op" id="5382933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382936">return</span>&nbsp;<span class="ident" id="5382943">f</span><br>
<span class="lineno"></span><span class="op" id="5382945">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
