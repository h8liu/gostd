<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html" class="current">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4949972">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4950027">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4950081">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4950132">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="4950187">//</span><br>
<span class="lineno"></span><span class="comment" id="4950190">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="4950268">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="4950313">//</span><br>
<span class="lineno">10</span><span class="comment" id="4950316">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="4950394">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="4950473">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="4950549">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4950620">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="4950697">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4950769">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4950793">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4950872">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="4950904">//</span><br>
<span class="lineno">20</span><span class="comment" id="4950907">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="4950955">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="4951008">package</span>&nbsp;<span class="ident" id="4951016">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4951023">import</span>&nbsp;<span class="op" id="4951030">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4951033">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="4951047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951050">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="4951105">type</span>&nbsp;<span class="ident" id="4951110">Config</span>&nbsp;<span class="keyword" id="4951117">struct</span>&nbsp;<span class="op" id="4951124">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951127">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951141">color</span><span class="op" id="4951146">.</span><span class="ident" id="4951147">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951154">Width</span><span class="op" id="4951159">,</span>&nbsp;<span class="ident" id="4951161">Height</span>&nbsp;<span class="builtintype" id="4951168">int</span><br>
<span class="lineno"></span><span class="op" id="4951172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951175">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="4951254">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="4951264">type</span>&nbsp;<span class="ident" id="4951269">Image</span>&nbsp;<span class="keyword" id="4951275">interface</span>&nbsp;<span class="op" id="4951285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4951288">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951336">ColorModel</span><span class="op" id="4951346">(</span><span class="op" id="4951347">)</span>&nbsp;<span class="ident" id="4951349">color</span><span class="op" id="4951354">.</span><span class="ident" id="4951355">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4951362">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4951432">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951492">Bounds</span><span class="op" id="4951498">(</span><span class="op" id="4951499">)</span>&nbsp;<span class="ident" id="4951501">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4951512">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4951561">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4951642">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951714">At</span><span class="op" id="4951716">(</span><span class="ident" id="4951717">x</span><span class="op" id="4951718">,</span>&nbsp;<span class="ident" id="4951720">y</span>&nbsp;<span class="builtintype" id="4951722">int</span><span class="op" id="4951725">)</span>&nbsp;<span class="ident" id="4951727">color</span><span class="op" id="4951732">.</span><span class="ident" id="4951733">Color</span><br>
<span class="lineno"></span><span class="op" id="4951739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951742">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="4951817">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="4951895">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4951970">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4952046">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="4952060">type</span>&nbsp;<span class="ident" id="4952065">PalettedImage</span>&nbsp;<span class="keyword" id="4952079">interface</span>&nbsp;<span class="op" id="4952089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4952092">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4952159">ColorIndexAt</span><span class="op" id="4952171">(</span><span class="ident" id="4952172">x</span><span class="op" id="4952173">,</span>&nbsp;<span class="ident" id="4952175">y</span>&nbsp;<span class="builtintype" id="4952177">int</span><span class="op" id="4952180">)</span>&nbsp;<span class="builtintype" id="4952182">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4952189">Image</span><br>
<span class="lineno"></span><span class="op" id="4952195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4952198">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="4952271">type</span>&nbsp;<span class="ident" id="4952276">RGBA</span>&nbsp;<span class="keyword" id="4952281">struct</span>&nbsp;<span class="op" id="4952288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4952291">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4952359">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4952427">Pix</span>&nbsp;<span class="op" id="4952431">[</span><span class="op" id="4952432">]</span><span class="builtintype" id="4952433">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4952440">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4952516">Stride</span>&nbsp;<span class="builtintype" id="4952523">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4952528">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4952560">Rect</span>&nbsp;<span class="ident" id="4952565">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4952575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4952578">func</span>&nbsp;<span class="op" id="4952583">(</span><span class="ident" id="4952584">p</span>&nbsp;<span class="op" id="4952586">*</span><span class="ident" id="4952587">RGBA</span><span class="op" id="4952591">)</span>&nbsp;<span class="ident" id="4952593">ColorModel</span><span class="op" id="4952603">(</span><span class="op" id="4952604">)</span>&nbsp;<span class="ident" id="4952606">color</span><span class="op" id="4952611">.</span><span class="ident" id="4952612">Model</span>&nbsp;<span class="op" id="4952618">{</span>&nbsp;<span class="keyword" id="4952620">return</span>&nbsp;<span class="ident" id="4952627">color</span><span class="op" id="4952632">.</span><span class="ident" id="4952633">RGBAModel</span>&nbsp;<span class="op" id="4952643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952646">func</span>&nbsp;<span class="op" id="4952651">(</span><span class="ident" id="4952652">p</span>&nbsp;<span class="op" id="4952654">*</span><span class="ident" id="4952655">RGBA</span><span class="op" id="4952659">)</span>&nbsp;<span class="ident" id="4952661">Bounds</span><span class="op" id="4952667">(</span><span class="op" id="4952668">)</span>&nbsp;<span class="ident" id="4952670">Rectangle</span>&nbsp;<span class="op" id="4952680">{</span>&nbsp;<span class="keyword" id="4952682">return</span>&nbsp;<span class="ident" id="4952689">p</span><span class="op" id="4952690">.</span><span class="ident" id="4952691">Rect</span>&nbsp;<span class="op" id="4952696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952699">func</span>&nbsp;<span class="op" id="4952704">(</span><span class="ident" id="4952705">p</span>&nbsp;<span class="op" id="4952707">*</span><span class="ident" id="4952708">RGBA</span><span class="op" id="4952712">)</span>&nbsp;<span class="ident" id="4952714">At</span><span class="op" id="4952716">(</span><span class="ident" id="4952717">x</span><span class="op" id="4952718">,</span>&nbsp;<span class="ident" id="4952720">y</span>&nbsp;<span class="builtintype" id="4952722">int</span><span class="op" id="4952725">)</span>&nbsp;<span class="ident" id="4952727">color</span><span class="op" id="4952732">.</span><span class="ident" id="4952733">Color</span>&nbsp;<span class="op" id="4952739">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4952742">return</span>&nbsp;<span class="ident" id="4952749">p</span><span class="op" id="4952750">.</span><span class="ident" id="4952751">RGBAAt</span><span class="op" id="4952757">(</span><span class="ident" id="4952758">x</span><span class="op" id="4952759">,</span>&nbsp;<span class="ident" id="4952761">y</span><span class="op" id="4952762">)</span><br>
<span class="lineno"></span><span class="op" id="4952764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952767">func</span>&nbsp;<span class="op" id="4952772">(</span><span class="ident" id="4952773">p</span>&nbsp;<span class="op" id="4952775">*</span><span class="ident" id="4952776">RGBA</span><span class="op" id="4952780">)</span>&nbsp;<span class="ident" id="4952782">RGBAAt</span><span class="op" id="4952788">(</span><span class="ident" id="4952789">x</span><span class="op" id="4952790">,</span>&nbsp;<span class="ident" id="4952792">y</span>&nbsp;<span class="builtintype" id="4952794">int</span><span class="op" id="4952797">)</span>&nbsp;<span class="ident" id="4952799">color</span><span class="op" id="4952804">.</span><span class="ident" id="4952805">RGBA</span>&nbsp;<span class="op" id="4952810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4952813">if</span>&nbsp;<span class="op" id="4952816">!</span><span class="op" id="4952817">(</span><span class="ident" id="4952818">Point</span><span class="op" id="4952823">{</span><span class="ident" id="4952824">x</span><span class="op" id="4952825">,</span>&nbsp;<span class="ident" id="4952827">y</span><span class="op" id="4952828">}</span><span class="op" id="4952829">.</span><span class="ident" id="4952830">In</span><span class="op" id="4952832">(</span><span class="ident" id="4952833">p</span><span class="op" id="4952834">.</span><span class="ident" id="4952835">Rect</span><span class="op" id="4952839">)</span><span class="op" id="4952840">)</span>&nbsp;<span class="op" id="4952842">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4952846">return</span>&nbsp;<span class="ident" id="4952853">color</span><span class="op" id="4952858">.</span><span class="ident" id="4952859">RGBA</span><span class="op" id="4952863">{</span><span class="op" id="4952864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4952867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4952870">i</span>&nbsp;<span class="op" id="4952872">:=</span>&nbsp;<span class="ident" id="4952875">p</span><span class="op" id="4952876">.</span><span class="ident" id="4952877">PixOffset</span><span class="op" id="4952886">(</span><span class="ident" id="4952887">x</span><span class="op" id="4952888">,</span>&nbsp;<span class="ident" id="4952890">y</span><span class="op" id="4952891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4952894">return</span>&nbsp;<span class="ident" id="4952901">color</span><span class="op" id="4952906">.</span><span class="ident" id="4952907">RGBA</span><span class="op" id="4952911">{</span><span class="ident" id="4952912">p</span><span class="op" id="4952913">.</span><span class="ident" id="4952914">Pix</span><span class="op" id="4952917">[</span><span class="ident" id="4952918">i</span><span class="op" id="4952919">+</span><span class="num" id="4952920">0</span><span class="op" id="4952921">]</span><span class="op" id="4952922">,</span>&nbsp;<span class="ident" id="4952924">p</span><span class="op" id="4952925">.</span><span class="ident" id="4952926">Pix</span><span class="op" id="4952929">[</span><span class="ident" id="4952930">i</span><span class="op" id="4952931">+</span><span class="num" id="4952932">1</span><span class="op" id="4952933">]</span><span class="op" id="4952934">,</span>&nbsp;<span class="ident" id="4952936">p</span><span class="op" id="4952937">.</span><span class="ident" id="4952938">Pix</span><span class="op" id="4952941">[</span><span class="ident" id="4952942">i</span><span class="op" id="4952943">+</span><span class="num" id="4952944">2</span><span class="op" id="4952945">]</span><span class="op" id="4952946">,</span>&nbsp;<span class="ident" id="4952948">p</span><span class="op" id="4952949">.</span><span class="ident" id="4952950">Pix</span><span class="op" id="4952953">[</span><span class="ident" id="4952954">i</span><span class="op" id="4952955">+</span><span class="num" id="4952956">3</span><span class="op" id="4952957">]</span><span class="op" id="4952958">}</span><br>
<span class="lineno"></span><span class="op" id="4952960">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4952963">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4953042">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4953066">func</span>&nbsp;<span class="op" id="4953071">(</span><span class="ident" id="4953072">p</span>&nbsp;<span class="op" id="4953074">*</span><span class="ident" id="4953075">RGBA</span><span class="op" id="4953079">)</span>&nbsp;<span class="ident" id="4953081">PixOffset</span><span class="op" id="4953090">(</span><span class="ident" id="4953091">x</span><span class="op" id="4953092">,</span>&nbsp;<span class="ident" id="4953094">y</span>&nbsp;<span class="builtintype" id="4953096">int</span><span class="op" id="4953099">)</span>&nbsp;<span class="builtintype" id="4953101">int</span>&nbsp;<span class="op" id="4953105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4953108">return</span>&nbsp;<span class="op" id="4953115">(</span><span class="ident" id="4953116">y</span><span class="op" id="4953117">-</span><span class="ident" id="4953118">p</span><span class="op" id="4953119">.</span><span class="ident" id="4953120">Rect</span><span class="op" id="4953124">.</span><span class="ident" id="4953125">Min</span><span class="op" id="4953128">.</span><span class="ident" id="4953129">Y</span><span class="op" id="4953130">)</span><span class="op" id="4953131">*</span><span class="ident" id="4953132">p</span><span class="op" id="4953133">.</span><span class="ident" id="4953134">Stride</span>&nbsp;<span class="op" id="4953141">+</span>&nbsp;<span class="op" id="4953143">(</span><span class="ident" id="4953144">x</span><span class="op" id="4953145">-</span><span class="ident" id="4953146">p</span><span class="op" id="4953147">.</span><span class="ident" id="4953148">Rect</span><span class="op" id="4953152">.</span><span class="ident" id="4953153">Min</span><span class="op" id="4953156">.</span><span class="ident" id="4953157">X</span><span class="op" id="4953158">)</span><span class="op" id="4953159">*</span><span class="num" id="4953160">4</span><br>
<span class="lineno">90</span><span class="op" id="4953162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4953165">func</span>&nbsp;<span class="op" id="4953170">(</span><span class="ident" id="4953171">p</span>&nbsp;<span class="op" id="4953173">*</span><span class="ident" id="4953174">RGBA</span><span class="op" id="4953178">)</span>&nbsp;<span class="ident" id="4953180">Set</span><span class="op" id="4953183">(</span><span class="ident" id="4953184">x</span><span class="op" id="4953185">,</span>&nbsp;<span class="ident" id="4953187">y</span>&nbsp;<span class="builtintype" id="4953189">int</span><span class="op" id="4953192">,</span>&nbsp;<span class="ident" id="4953194">c</span>&nbsp;<span class="ident" id="4953196">color</span><span class="op" id="4953201">.</span><span class="ident" id="4953202">Color</span><span class="op" id="4953207">)</span>&nbsp;<span class="op" id="4953209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4953212">if</span>&nbsp;<span class="op" id="4953215">!</span><span class="op" id="4953216">(</span><span class="ident" id="4953217">Point</span><span class="op" id="4953222">{</span><span class="ident" id="4953223">x</span><span class="op" id="4953224">,</span>&nbsp;<span class="ident" id="4953226">y</span><span class="op" id="4953227">}</span><span class="op" id="4953228">.</span><span class="ident" id="4953229">In</span><span class="op" id="4953231">(</span><span class="ident" id="4953232">p</span><span class="op" id="4953233">.</span><span class="ident" id="4953234">Rect</span><span class="op" id="4953238">)</span><span class="op" id="4953239">)</span>&nbsp;<span class="op" id="4953241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4953245">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4953253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953256">i</span>&nbsp;<span class="op" id="4953258">:=</span>&nbsp;<span class="ident" id="4953261">p</span><span class="op" id="4953262">.</span><span class="ident" id="4953263">PixOffset</span><span class="op" id="4953272">(</span><span class="ident" id="4953273">x</span><span class="op" id="4953274">,</span>&nbsp;<span class="ident" id="4953276">y</span><span class="op" id="4953277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953280">c1</span>&nbsp;<span class="op" id="4953283">:=</span>&nbsp;<span class="ident" id="4953286">color</span><span class="op" id="4953291">.</span><span class="ident" id="4953292">RGBAModel</span><span class="op" id="4953301">.</span><span class="ident" id="4953302">Convert</span><span class="op" id="4953309">(</span><span class="ident" id="4953310">c</span><span class="op" id="4953311">)</span><span class="op" id="4953312">.</span><span class="op" id="4953313">(</span><span class="ident" id="4953314">color</span><span class="op" id="4953319">.</span><span class="ident" id="4953320">RGBA</span><span class="op" id="4953324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953327">p</span><span class="op" id="4953328">.</span><span class="ident" id="4953329">Pix</span><span class="op" id="4953332">[</span><span class="ident" id="4953333">i</span><span class="op" id="4953334">+</span><span class="num" id="4953335">0</span><span class="op" id="4953336">]</span>&nbsp;<span class="op" id="4953338">=</span>&nbsp;<span class="ident" id="4953340">c1</span><span class="op" id="4953342">.</span><span class="ident" id="4953343">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953346">p</span><span class="op" id="4953347">.</span><span class="ident" id="4953348">Pix</span><span class="op" id="4953351">[</span><span class="ident" id="4953352">i</span><span class="op" id="4953353">+</span><span class="num" id="4953354">1</span><span class="op" id="4953355">]</span>&nbsp;<span class="op" id="4953357">=</span>&nbsp;<span class="ident" id="4953359">c1</span><span class="op" id="4953361">.</span><span class="ident" id="4953362">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953365">p</span><span class="op" id="4953366">.</span><span class="ident" id="4953367">Pix</span><span class="op" id="4953370">[</span><span class="ident" id="4953371">i</span><span class="op" id="4953372">+</span><span class="num" id="4953373">2</span><span class="op" id="4953374">]</span>&nbsp;<span class="op" id="4953376">=</span>&nbsp;<span class="ident" id="4953378">c1</span><span class="op" id="4953380">.</span><span class="ident" id="4953381">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953384">p</span><span class="op" id="4953385">.</span><span class="ident" id="4953386">Pix</span><span class="op" id="4953389">[</span><span class="ident" id="4953390">i</span><span class="op" id="4953391">+</span><span class="num" id="4953392">3</span><span class="op" id="4953393">]</span>&nbsp;<span class="op" id="4953395">=</span>&nbsp;<span class="ident" id="4953397">c1</span><span class="op" id="4953399">.</span><span class="ident" id="4953400">A</span><br>
<span class="lineno"></span><span class="op" id="4953402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4953405">func</span>&nbsp;<span class="op" id="4953410">(</span><span class="ident" id="4953411">p</span>&nbsp;<span class="op" id="4953413">*</span><span class="ident" id="4953414">RGBA</span><span class="op" id="4953418">)</span>&nbsp;<span class="ident" id="4953420">SetRGBA</span><span class="op" id="4953427">(</span><span class="ident" id="4953428">x</span><span class="op" id="4953429">,</span>&nbsp;<span class="ident" id="4953431">y</span>&nbsp;<span class="builtintype" id="4953433">int</span><span class="op" id="4953436">,</span>&nbsp;<span class="ident" id="4953438">c</span>&nbsp;<span class="ident" id="4953440">color</span><span class="op" id="4953445">.</span><span class="ident" id="4953446">RGBA</span><span class="op" id="4953450">)</span>&nbsp;<span class="op" id="4953452">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4953455">if</span>&nbsp;<span class="op" id="4953458">!</span><span class="op" id="4953459">(</span><span class="ident" id="4953460">Point</span><span class="op" id="4953465">{</span><span class="ident" id="4953466">x</span><span class="op" id="4953467">,</span>&nbsp;<span class="ident" id="4953469">y</span><span class="op" id="4953470">}</span><span class="op" id="4953471">.</span><span class="ident" id="4953472">In</span><span class="op" id="4953474">(</span><span class="ident" id="4953475">p</span><span class="op" id="4953476">.</span><span class="ident" id="4953477">Rect</span><span class="op" id="4953481">)</span><span class="op" id="4953482">)</span>&nbsp;<span class="op" id="4953484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4953488">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4953496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953499">i</span>&nbsp;<span class="op" id="4953501">:=</span>&nbsp;<span class="ident" id="4953504">p</span><span class="op" id="4953505">.</span><span class="ident" id="4953506">PixOffset</span><span class="op" id="4953515">(</span><span class="ident" id="4953516">x</span><span class="op" id="4953517">,</span>&nbsp;<span class="ident" id="4953519">y</span><span class="op" id="4953520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953523">p</span><span class="op" id="4953524">.</span><span class="ident" id="4953525">Pix</span><span class="op" id="4953528">[</span><span class="ident" id="4953529">i</span><span class="op" id="4953530">+</span><span class="num" id="4953531">0</span><span class="op" id="4953532">]</span>&nbsp;<span class="op" id="4953534">=</span>&nbsp;<span class="ident" id="4953536">c</span><span class="op" id="4953537">.</span><span class="ident" id="4953538">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953541">p</span><span class="op" id="4953542">.</span><span class="ident" id="4953543">Pix</span><span class="op" id="4953546">[</span><span class="ident" id="4953547">i</span><span class="op" id="4953548">+</span><span class="num" id="4953549">1</span><span class="op" id="4953550">]</span>&nbsp;<span class="op" id="4953552">=</span>&nbsp;<span class="ident" id="4953554">c</span><span class="op" id="4953555">.</span><span class="ident" id="4953556">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953559">p</span><span class="op" id="4953560">.</span><span class="ident" id="4953561">Pix</span><span class="op" id="4953564">[</span><span class="ident" id="4953565">i</span><span class="op" id="4953566">+</span><span class="num" id="4953567">2</span><span class="op" id="4953568">]</span>&nbsp;<span class="op" id="4953570">=</span>&nbsp;<span class="ident" id="4953572">c</span><span class="op" id="4953573">.</span><span class="ident" id="4953574">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953577">p</span><span class="op" id="4953578">.</span><span class="ident" id="4953579">Pix</span><span class="op" id="4953582">[</span><span class="ident" id="4953583">i</span><span class="op" id="4953584">+</span><span class="num" id="4953585">3</span><span class="op" id="4953586">]</span>&nbsp;<span class="op" id="4953588">=</span>&nbsp;<span class="ident" id="4953590">c</span><span class="op" id="4953591">.</span><span class="ident" id="4953592">A</span><br>
<span class="lineno"></span><span class="op" id="4953594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4953597">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4953674">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4953746">func</span>&nbsp;<span class="op" id="4953751">(</span><span class="ident" id="4953752">p</span>&nbsp;<span class="op" id="4953754">*</span><span class="ident" id="4953755">RGBA</span><span class="op" id="4953759">)</span>&nbsp;<span class="ident" id="4953761">SubImage</span><span class="op" id="4953769">(</span><span class="ident" id="4953770">r</span>&nbsp;<span class="ident" id="4953772">Rectangle</span><span class="op" id="4953781">)</span>&nbsp;<span class="ident" id="4953783">Image</span>&nbsp;<span class="op" id="4953789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953792">r</span>&nbsp;<span class="op" id="4953794">=</span>&nbsp;<span class="ident" id="4953796">r</span><span class="op" id="4953797">.</span><span class="ident" id="4953798">Intersect</span><span class="op" id="4953807">(</span><span class="ident" id="4953808">p</span><span class="op" id="4953809">.</span><span class="ident" id="4953810">Rect</span><span class="op" id="4953814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4953817">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4953898">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4953980">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954030">if</span>&nbsp;<span class="ident" id="4954033">r</span><span class="op" id="4954034">.</span><span class="ident" id="4954035">Empty</span><span class="op" id="4954040">(</span><span class="op" id="4954041">)</span>&nbsp;<span class="op" id="4954043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954047">return</span>&nbsp;<span class="op" id="4954054">&amp;</span><span class="ident" id="4954055">RGBA</span><span class="op" id="4954059">{</span><span class="op" id="4954060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4954063">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954066">i</span>&nbsp;<span class="op" id="4954068">:=</span>&nbsp;<span class="ident" id="4954071">p</span><span class="op" id="4954072">.</span><span class="ident" id="4954073">PixOffset</span><span class="op" id="4954082">(</span><span class="ident" id="4954083">r</span><span class="op" id="4954084">.</span><span class="ident" id="4954085">Min</span><span class="op" id="4954088">.</span><span class="ident" id="4954089">X</span><span class="op" id="4954090">,</span>&nbsp;<span class="ident" id="4954092">r</span><span class="op" id="4954093">.</span><span class="ident" id="4954094">Min</span><span class="op" id="4954097">.</span><span class="ident" id="4954098">Y</span><span class="op" id="4954099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954102">return</span>&nbsp;<span class="op" id="4954109">&amp;</span><span class="ident" id="4954110">RGBA</span><span class="op" id="4954114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954118">Pix</span><span class="op" id="4954121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954126">p</span><span class="op" id="4954127">.</span><span class="ident" id="4954128">Pix</span><span class="op" id="4954131">[</span><span class="ident" id="4954132">i</span><span class="op" id="4954133">:</span><span class="op" id="4954134">]</span><span class="op" id="4954135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954139">Stride</span><span class="op" id="4954145">:</span>&nbsp;<span class="ident" id="4954147">p</span><span class="op" id="4954148">.</span><span class="ident" id="4954149">Stride</span><span class="op" id="4954155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954159">Rect</span><span class="op" id="4954163">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4954167">r</span><span class="op" id="4954168">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4954171">}</span><br>
<span class="lineno"></span><span class="op" id="4954173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4954176">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4954249">func</span>&nbsp;<span class="op" id="4954254">(</span><span class="ident" id="4954255">p</span>&nbsp;<span class="op" id="4954257">*</span><span class="ident" id="4954258">RGBA</span><span class="op" id="4954262">)</span>&nbsp;<span class="ident" id="4954264">Opaque</span><span class="op" id="4954270">(</span><span class="op" id="4954271">)</span>&nbsp;<span class="builtintype" id="4954273">bool</span>&nbsp;<span class="op" id="4954278">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954281">if</span>&nbsp;<span class="ident" id="4954284">p</span><span class="op" id="4954285">.</span><span class="ident" id="4954286">Rect</span><span class="op" id="4954290">.</span><span class="ident" id="4954291">Empty</span><span class="op" id="4954296">(</span><span class="op" id="4954297">)</span>&nbsp;<span class="op" id="4954299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954303">return</span>&nbsp;<span class="builtintype" id="4954310">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4954316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954319">i0</span><span class="op" id="4954321">,</span>&nbsp;<span class="ident" id="4954323">i1</span>&nbsp;<span class="op" id="4954326">:=</span>&nbsp;<span class="num" id="4954329">3</span><span class="op" id="4954330">,</span>&nbsp;<span class="ident" id="4954332">p</span><span class="op" id="4954333">.</span><span class="ident" id="4954334">Rect</span><span class="op" id="4954338">.</span><span class="ident" id="4954339">Dx</span><span class="op" id="4954341">(</span><span class="op" id="4954342">)</span><span class="op" id="4954343">*</span><span class="num" id="4954344">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954347">for</span>&nbsp;<span class="ident" id="4954351">y</span>&nbsp;<span class="op" id="4954353">:=</span>&nbsp;<span class="ident" id="4954356">p</span><span class="op" id="4954357">.</span><span class="ident" id="4954358">Rect</span><span class="op" id="4954362">.</span><span class="ident" id="4954363">Min</span><span class="op" id="4954366">.</span><span class="ident" id="4954367">Y</span><span class="op" id="4954368">;</span>&nbsp;<span class="ident" id="4954370">y</span>&nbsp;<span class="op" id="4954372">&lt;</span>&nbsp;<span class="ident" id="4954374">p</span><span class="op" id="4954375">.</span><span class="ident" id="4954376">Rect</span><span class="op" id="4954380">.</span><span class="ident" id="4954381">Max</span><span class="op" id="4954384">.</span><span class="ident" id="4954385">Y</span><span class="op" id="4954386">;</span>&nbsp;<span class="ident" id="4954388">y</span><span class="op" id="4954389">++</span>&nbsp;<span class="op" id="4954392">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954396">for</span>&nbsp;<span class="ident" id="4954400">i</span>&nbsp;<span class="op" id="4954402">:=</span>&nbsp;<span class="ident" id="4954405">i0</span><span class="op" id="4954407">;</span>&nbsp;<span class="ident" id="4954409">i</span>&nbsp;<span class="op" id="4954411">&lt;</span>&nbsp;<span class="ident" id="4954413">i1</span><span class="op" id="4954415">;</span>&nbsp;<span class="ident" id="4954417">i</span>&nbsp;<span class="op" id="4954419">+=</span>&nbsp;<span class="num" id="4954422">4</span>&nbsp;<span class="op" id="4954424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954429">if</span>&nbsp;<span class="ident" id="4954432">p</span><span class="op" id="4954433">.</span><span class="ident" id="4954434">Pix</span><span class="op" id="4954437">[</span><span class="ident" id="4954438">i</span><span class="op" id="4954439">]</span>&nbsp;<span class="op" id="4954441">!=</span>&nbsp;<span class="num" id="4954444">0xff</span>&nbsp;<span class="op" id="4954449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954455">return</span>&nbsp;<span class="builtintype" id="4954462">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4954471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4954475">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954479">i0</span>&nbsp;<span class="op" id="4954482">+=</span>&nbsp;<span class="ident" id="4954485">p</span><span class="op" id="4954486">.</span><span class="ident" id="4954487">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954496">i1</span>&nbsp;<span class="op" id="4954499">+=</span>&nbsp;<span class="ident" id="4954502">p</span><span class="op" id="4954503">.</span><span class="ident" id="4954504">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4954512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954515">return</span>&nbsp;<span class="builtintype" id="4954522">true</span><br>
<span class="lineno"></span><span class="op" id="4954527">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4954530">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4954583">func</span>&nbsp;<span class="ident" id="4954588">NewRGBA</span><span class="op" id="4954595">(</span><span class="ident" id="4954596">r</span>&nbsp;<span class="ident" id="4954598">Rectangle</span><span class="op" id="4954607">)</span>&nbsp;<span class="op" id="4954609">*</span><span class="ident" id="4954610">RGBA</span>&nbsp;<span class="op" id="4954615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954618">w</span><span class="op" id="4954619">,</span>&nbsp;<span class="ident" id="4954621">h</span>&nbsp;<span class="op" id="4954623">:=</span>&nbsp;<span class="ident" id="4954626">r</span><span class="op" id="4954627">.</span><span class="ident" id="4954628">Dx</span><span class="op" id="4954630">(</span><span class="op" id="4954631">)</span><span class="op" id="4954632">,</span>&nbsp;<span class="ident" id="4954634">r</span><span class="op" id="4954635">.</span><span class="ident" id="4954636">Dy</span><span class="op" id="4954638">(</span><span class="op" id="4954639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954642">buf</span>&nbsp;<span class="op" id="4954646">:=</span>&nbsp;<span class="builtinfunc" id="4954649">make</span><span class="op" id="4954653">(</span><span class="op" id="4954654">[</span><span class="op" id="4954655">]</span><span class="builtintype" id="4954656">uint8</span><span class="op" id="4954661">,</span>&nbsp;<span class="num" id="4954663">4</span><span class="op" id="4954664">*</span><span class="ident" id="4954665">w</span><span class="op" id="4954666">*</span><span class="ident" id="4954667">h</span><span class="op" id="4954668">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4954671">return</span>&nbsp;<span class="op" id="4954678">&amp;</span><span class="ident" id="4954679">RGBA</span><span class="op" id="4954683">{</span><span class="ident" id="4954684">buf</span><span class="op" id="4954687">,</span>&nbsp;<span class="num" id="4954689">4</span>&nbsp;<span class="op" id="4954691">*</span>&nbsp;<span class="ident" id="4954693">w</span><span class="op" id="4954694">,</span>&nbsp;<span class="ident" id="4954696">r</span><span class="op" id="4954697">}</span><br>
<span class="lineno"></span><span class="op" id="4954699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4954702">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4954779">type</span>&nbsp;<span class="ident" id="4954784">RGBA64</span>&nbsp;<span class="keyword" id="4954791">struct</span>&nbsp;<span class="op" id="4954798">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4954801">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4954891">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4954959">Pix</span>&nbsp;<span class="op" id="4954963">[</span><span class="op" id="4954964">]</span><span class="builtintype" id="4954965">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4954972">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4955048">Stride</span>&nbsp;<span class="builtintype" id="4955055">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4955060">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4955092">Rect</span>&nbsp;<span class="ident" id="4955097">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4955107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955110">func</span>&nbsp;<span class="op" id="4955115">(</span><span class="ident" id="4955116">p</span>&nbsp;<span class="op" id="4955118">*</span><span class="ident" id="4955119">RGBA64</span><span class="op" id="4955125">)</span>&nbsp;<span class="ident" id="4955127">ColorModel</span><span class="op" id="4955137">(</span><span class="op" id="4955138">)</span>&nbsp;<span class="ident" id="4955140">color</span><span class="op" id="4955145">.</span><span class="ident" id="4955146">Model</span>&nbsp;<span class="op" id="4955152">{</span>&nbsp;<span class="keyword" id="4955154">return</span>&nbsp;<span class="ident" id="4955161">color</span><span class="op" id="4955166">.</span><span class="ident" id="4955167">RGBA64Model</span>&nbsp;<span class="op" id="4955179">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4955182">func</span>&nbsp;<span class="op" id="4955187">(</span><span class="ident" id="4955188">p</span>&nbsp;<span class="op" id="4955190">*</span><span class="ident" id="4955191">RGBA64</span><span class="op" id="4955197">)</span>&nbsp;<span class="ident" id="4955199">Bounds</span><span class="op" id="4955205">(</span><span class="op" id="4955206">)</span>&nbsp;<span class="ident" id="4955208">Rectangle</span>&nbsp;<span class="op" id="4955218">{</span>&nbsp;<span class="keyword" id="4955220">return</span>&nbsp;<span class="ident" id="4955227">p</span><span class="op" id="4955228">.</span><span class="ident" id="4955229">Rect</span>&nbsp;<span class="op" id="4955234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955237">func</span>&nbsp;<span class="op" id="4955242">(</span><span class="ident" id="4955243">p</span>&nbsp;<span class="op" id="4955245">*</span><span class="ident" id="4955246">RGBA64</span><span class="op" id="4955252">)</span>&nbsp;<span class="ident" id="4955254">At</span><span class="op" id="4955256">(</span><span class="ident" id="4955257">x</span><span class="op" id="4955258">,</span>&nbsp;<span class="ident" id="4955260">y</span>&nbsp;<span class="builtintype" id="4955262">int</span><span class="op" id="4955265">)</span>&nbsp;<span class="ident" id="4955267">color</span><span class="op" id="4955272">.</span><span class="ident" id="4955273">Color</span>&nbsp;<span class="op" id="4955279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955282">return</span>&nbsp;<span class="ident" id="4955289">p</span><span class="op" id="4955290">.</span><span class="ident" id="4955291">RGBA64At</span><span class="op" id="4955299">(</span><span class="ident" id="4955300">x</span><span class="op" id="4955301">,</span>&nbsp;<span class="ident" id="4955303">y</span><span class="op" id="4955304">)</span><br>
<span class="lineno">175</span><span class="op" id="4955306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955309">func</span>&nbsp;<span class="op" id="4955314">(</span><span class="ident" id="4955315">p</span>&nbsp;<span class="op" id="4955317">*</span><span class="ident" id="4955318">RGBA64</span><span class="op" id="4955324">)</span>&nbsp;<span class="ident" id="4955326">RGBA64At</span><span class="op" id="4955334">(</span><span class="ident" id="4955335">x</span><span class="op" id="4955336">,</span>&nbsp;<span class="ident" id="4955338">y</span>&nbsp;<span class="builtintype" id="4955340">int</span><span class="op" id="4955343">)</span>&nbsp;<span class="ident" id="4955345">color</span><span class="op" id="4955350">.</span><span class="ident" id="4955351">RGBA64</span>&nbsp;<span class="op" id="4955358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955361">if</span>&nbsp;<span class="op" id="4955364">!</span><span class="op" id="4955365">(</span><span class="ident" id="4955366">Point</span><span class="op" id="4955371">{</span><span class="ident" id="4955372">x</span><span class="op" id="4955373">,</span>&nbsp;<span class="ident" id="4955375">y</span><span class="op" id="4955376">}</span><span class="op" id="4955377">.</span><span class="ident" id="4955378">In</span><span class="op" id="4955380">(</span><span class="ident" id="4955381">p</span><span class="op" id="4955382">.</span><span class="ident" id="4955383">Rect</span><span class="op" id="4955387">)</span><span class="op" id="4955388">)</span>&nbsp;<span class="op" id="4955390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955394">return</span>&nbsp;<span class="ident" id="4955401">color</span><span class="op" id="4955406">.</span><span class="ident" id="4955407">RGBA64</span><span class="op" id="4955413">{</span><span class="op" id="4955414">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4955417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4955420">i</span>&nbsp;<span class="op" id="4955422">:=</span>&nbsp;<span class="ident" id="4955425">p</span><span class="op" id="4955426">.</span><span class="ident" id="4955427">PixOffset</span><span class="op" id="4955436">(</span><span class="ident" id="4955437">x</span><span class="op" id="4955438">,</span>&nbsp;<span class="ident" id="4955440">y</span><span class="op" id="4955441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955444">return</span>&nbsp;<span class="ident" id="4955451">color</span><span class="op" id="4955456">.</span><span class="ident" id="4955457">RGBA64</span><span class="op" id="4955463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4955467">uint16</span><span class="op" id="4955473">(</span><span class="ident" id="4955474">p</span><span class="op" id="4955475">.</span><span class="ident" id="4955476">Pix</span><span class="op" id="4955479">[</span><span class="ident" id="4955480">i</span><span class="op" id="4955481">+</span><span class="num" id="4955482">0</span><span class="op" id="4955483">]</span><span class="op" id="4955484">)</span><span class="op" id="4955485">&lt;&lt;</span><span class="num" id="4955487">8</span>&nbsp;<span class="op" id="4955489">|</span>&nbsp;<span class="builtintype" id="4955491">uint16</span><span class="op" id="4955497">(</span><span class="ident" id="4955498">p</span><span class="op" id="4955499">.</span><span class="ident" id="4955500">Pix</span><span class="op" id="4955503">[</span><span class="ident" id="4955504">i</span><span class="op" id="4955505">+</span><span class="num" id="4955506">1</span><span class="op" id="4955507">]</span><span class="op" id="4955508">)</span><span class="op" id="4955509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4955513">uint16</span><span class="op" id="4955519">(</span><span class="ident" id="4955520">p</span><span class="op" id="4955521">.</span><span class="ident" id="4955522">Pix</span><span class="op" id="4955525">[</span><span class="ident" id="4955526">i</span><span class="op" id="4955527">+</span><span class="num" id="4955528">2</span><span class="op" id="4955529">]</span><span class="op" id="4955530">)</span><span class="op" id="4955531">&lt;&lt;</span><span class="num" id="4955533">8</span>&nbsp;<span class="op" id="4955535">|</span>&nbsp;<span class="builtintype" id="4955537">uint16</span><span class="op" id="4955543">(</span><span class="ident" id="4955544">p</span><span class="op" id="4955545">.</span><span class="ident" id="4955546">Pix</span><span class="op" id="4955549">[</span><span class="ident" id="4955550">i</span><span class="op" id="4955551">+</span><span class="num" id="4955552">3</span><span class="op" id="4955553">]</span><span class="op" id="4955554">)</span><span class="op" id="4955555">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4955559">uint16</span><span class="op" id="4955565">(</span><span class="ident" id="4955566">p</span><span class="op" id="4955567">.</span><span class="ident" id="4955568">Pix</span><span class="op" id="4955571">[</span><span class="ident" id="4955572">i</span><span class="op" id="4955573">+</span><span class="num" id="4955574">4</span><span class="op" id="4955575">]</span><span class="op" id="4955576">)</span><span class="op" id="4955577">&lt;&lt;</span><span class="num" id="4955579">8</span>&nbsp;<span class="op" id="4955581">|</span>&nbsp;<span class="builtintype" id="4955583">uint16</span><span class="op" id="4955589">(</span><span class="ident" id="4955590">p</span><span class="op" id="4955591">.</span><span class="ident" id="4955592">Pix</span><span class="op" id="4955595">[</span><span class="ident" id="4955596">i</span><span class="op" id="4955597">+</span><span class="num" id="4955598">5</span><span class="op" id="4955599">]</span><span class="op" id="4955600">)</span><span class="op" id="4955601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4955605">uint16</span><span class="op" id="4955611">(</span><span class="ident" id="4955612">p</span><span class="op" id="4955613">.</span><span class="ident" id="4955614">Pix</span><span class="op" id="4955617">[</span><span class="ident" id="4955618">i</span><span class="op" id="4955619">+</span><span class="num" id="4955620">6</span><span class="op" id="4955621">]</span><span class="op" id="4955622">)</span><span class="op" id="4955623">&lt;&lt;</span><span class="num" id="4955625">8</span>&nbsp;<span class="op" id="4955627">|</span>&nbsp;<span class="builtintype" id="4955629">uint16</span><span class="op" id="4955635">(</span><span class="ident" id="4955636">p</span><span class="op" id="4955637">.</span><span class="ident" id="4955638">Pix</span><span class="op" id="4955641">[</span><span class="ident" id="4955642">i</span><span class="op" id="4955643">+</span><span class="num" id="4955644">7</span><span class="op" id="4955645">]</span><span class="op" id="4955646">)</span><span class="op" id="4955647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4955650">}</span><br>
<span class="lineno"></span><span class="op" id="4955652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4955655">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4955734">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4955758">func</span>&nbsp;<span class="op" id="4955763">(</span><span class="ident" id="4955764">p</span>&nbsp;<span class="op" id="4955766">*</span><span class="ident" id="4955767">RGBA64</span><span class="op" id="4955773">)</span>&nbsp;<span class="ident" id="4955775">PixOffset</span><span class="op" id="4955784">(</span><span class="ident" id="4955785">x</span><span class="op" id="4955786">,</span>&nbsp;<span class="ident" id="4955788">y</span>&nbsp;<span class="builtintype" id="4955790">int</span><span class="op" id="4955793">)</span>&nbsp;<span class="builtintype" id="4955795">int</span>&nbsp;<span class="op" id="4955799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955802">return</span>&nbsp;<span class="op" id="4955809">(</span><span class="ident" id="4955810">y</span><span class="op" id="4955811">-</span><span class="ident" id="4955812">p</span><span class="op" id="4955813">.</span><span class="ident" id="4955814">Rect</span><span class="op" id="4955818">.</span><span class="ident" id="4955819">Min</span><span class="op" id="4955822">.</span><span class="ident" id="4955823">Y</span><span class="op" id="4955824">)</span><span class="op" id="4955825">*</span><span class="ident" id="4955826">p</span><span class="op" id="4955827">.</span><span class="ident" id="4955828">Stride</span>&nbsp;<span class="op" id="4955835">+</span>&nbsp;<span class="op" id="4955837">(</span><span class="ident" id="4955838">x</span><span class="op" id="4955839">-</span><span class="ident" id="4955840">p</span><span class="op" id="4955841">.</span><span class="ident" id="4955842">Rect</span><span class="op" id="4955846">.</span><span class="ident" id="4955847">Min</span><span class="op" id="4955850">.</span><span class="ident" id="4955851">X</span><span class="op" id="4955852">)</span><span class="op" id="4955853">*</span><span class="num" id="4955854">8</span><br>
<span class="lineno"></span><span class="op" id="4955856">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="4955859">func</span>&nbsp;<span class="op" id="4955864">(</span><span class="ident" id="4955865">p</span>&nbsp;<span class="op" id="4955867">*</span><span class="ident" id="4955868">RGBA64</span><span class="op" id="4955874">)</span>&nbsp;<span class="ident" id="4955876">Set</span><span class="op" id="4955879">(</span><span class="ident" id="4955880">x</span><span class="op" id="4955881">,</span>&nbsp;<span class="ident" id="4955883">y</span>&nbsp;<span class="builtintype" id="4955885">int</span><span class="op" id="4955888">,</span>&nbsp;<span class="ident" id="4955890">c</span>&nbsp;<span class="ident" id="4955892">color</span><span class="op" id="4955897">.</span><span class="ident" id="4955898">Color</span><span class="op" id="4955903">)</span>&nbsp;<span class="op" id="4955905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955908">if</span>&nbsp;<span class="op" id="4955911">!</span><span class="op" id="4955912">(</span><span class="ident" id="4955913">Point</span><span class="op" id="4955918">{</span><span class="ident" id="4955919">x</span><span class="op" id="4955920">,</span>&nbsp;<span class="ident" id="4955922">y</span><span class="op" id="4955923">}</span><span class="op" id="4955924">.</span><span class="ident" id="4955925">In</span><span class="op" id="4955927">(</span><span class="ident" id="4955928">p</span><span class="op" id="4955929">.</span><span class="ident" id="4955930">Rect</span><span class="op" id="4955934">)</span><span class="op" id="4955935">)</span>&nbsp;<span class="op" id="4955937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4955941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4955949">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4955952">i</span>&nbsp;<span class="op" id="4955954">:=</span>&nbsp;<span class="ident" id="4955957">p</span><span class="op" id="4955958">.</span><span class="ident" id="4955959">PixOffset</span><span class="op" id="4955968">(</span><span class="ident" id="4955969">x</span><span class="op" id="4955970">,</span>&nbsp;<span class="ident" id="4955972">y</span><span class="op" id="4955973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4955976">c1</span>&nbsp;<span class="op" id="4955979">:=</span>&nbsp;<span class="ident" id="4955982">color</span><span class="op" id="4955987">.</span><span class="ident" id="4955988">RGBA64Model</span><span class="op" id="4955999">.</span><span class="ident" id="4956000">Convert</span><span class="op" id="4956007">(</span><span class="ident" id="4956008">c</span><span class="op" id="4956009">)</span><span class="op" id="4956010">.</span><span class="op" id="4956011">(</span><span class="ident" id="4956012">color</span><span class="op" id="4956017">.</span><span class="ident" id="4956018">RGBA64</span><span class="op" id="4956024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956027">p</span><span class="op" id="4956028">.</span><span class="ident" id="4956029">Pix</span><span class="op" id="4956032">[</span><span class="ident" id="4956033">i</span><span class="op" id="4956034">+</span><span class="num" id="4956035">0</span><span class="op" id="4956036">]</span>&nbsp;<span class="op" id="4956038">=</span>&nbsp;<span class="builtintype" id="4956040">uint8</span><span class="op" id="4956045">(</span><span class="ident" id="4956046">c1</span><span class="op" id="4956048">.</span><span class="ident" id="4956049">R</span>&nbsp;<span class="op" id="4956051">&gt;&gt;</span>&nbsp;<span class="num" id="4956054">8</span><span class="op" id="4956055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956058">p</span><span class="op" id="4956059">.</span><span class="ident" id="4956060">Pix</span><span class="op" id="4956063">[</span><span class="ident" id="4956064">i</span><span class="op" id="4956065">+</span><span class="num" id="4956066">1</span><span class="op" id="4956067">]</span>&nbsp;<span class="op" id="4956069">=</span>&nbsp;<span class="builtintype" id="4956071">uint8</span><span class="op" id="4956076">(</span><span class="ident" id="4956077">c1</span><span class="op" id="4956079">.</span><span class="ident" id="4956080">R</span><span class="op" id="4956081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956084">p</span><span class="op" id="4956085">.</span><span class="ident" id="4956086">Pix</span><span class="op" id="4956089">[</span><span class="ident" id="4956090">i</span><span class="op" id="4956091">+</span><span class="num" id="4956092">2</span><span class="op" id="4956093">]</span>&nbsp;<span class="op" id="4956095">=</span>&nbsp;<span class="builtintype" id="4956097">uint8</span><span class="op" id="4956102">(</span><span class="ident" id="4956103">c1</span><span class="op" id="4956105">.</span><span class="ident" id="4956106">G</span>&nbsp;<span class="op" id="4956108">&gt;&gt;</span>&nbsp;<span class="num" id="4956111">8</span><span class="op" id="4956112">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956115">p</span><span class="op" id="4956116">.</span><span class="ident" id="4956117">Pix</span><span class="op" id="4956120">[</span><span class="ident" id="4956121">i</span><span class="op" id="4956122">+</span><span class="num" id="4956123">3</span><span class="op" id="4956124">]</span>&nbsp;<span class="op" id="4956126">=</span>&nbsp;<span class="builtintype" id="4956128">uint8</span><span class="op" id="4956133">(</span><span class="ident" id="4956134">c1</span><span class="op" id="4956136">.</span><span class="ident" id="4956137">G</span><span class="op" id="4956138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956141">p</span><span class="op" id="4956142">.</span><span class="ident" id="4956143">Pix</span><span class="op" id="4956146">[</span><span class="ident" id="4956147">i</span><span class="op" id="4956148">+</span><span class="num" id="4956149">4</span><span class="op" id="4956150">]</span>&nbsp;<span class="op" id="4956152">=</span>&nbsp;<span class="builtintype" id="4956154">uint8</span><span class="op" id="4956159">(</span><span class="ident" id="4956160">c1</span><span class="op" id="4956162">.</span><span class="ident" id="4956163">B</span>&nbsp;<span class="op" id="4956165">&gt;&gt;</span>&nbsp;<span class="num" id="4956168">8</span><span class="op" id="4956169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956172">p</span><span class="op" id="4956173">.</span><span class="ident" id="4956174">Pix</span><span class="op" id="4956177">[</span><span class="ident" id="4956178">i</span><span class="op" id="4956179">+</span><span class="num" id="4956180">5</span><span class="op" id="4956181">]</span>&nbsp;<span class="op" id="4956183">=</span>&nbsp;<span class="builtintype" id="4956185">uint8</span><span class="op" id="4956190">(</span><span class="ident" id="4956191">c1</span><span class="op" id="4956193">.</span><span class="ident" id="4956194">B</span><span class="op" id="4956195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956198">p</span><span class="op" id="4956199">.</span><span class="ident" id="4956200">Pix</span><span class="op" id="4956203">[</span><span class="ident" id="4956204">i</span><span class="op" id="4956205">+</span><span class="num" id="4956206">6</span><span class="op" id="4956207">]</span>&nbsp;<span class="op" id="4956209">=</span>&nbsp;<span class="builtintype" id="4956211">uint8</span><span class="op" id="4956216">(</span><span class="ident" id="4956217">c1</span><span class="op" id="4956219">.</span><span class="ident" id="4956220">A</span>&nbsp;<span class="op" id="4956222">&gt;&gt;</span>&nbsp;<span class="num" id="4956225">8</span><span class="op" id="4956226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956229">p</span><span class="op" id="4956230">.</span><span class="ident" id="4956231">Pix</span><span class="op" id="4956234">[</span><span class="ident" id="4956235">i</span><span class="op" id="4956236">+</span><span class="num" id="4956237">7</span><span class="op" id="4956238">]</span>&nbsp;<span class="op" id="4956240">=</span>&nbsp;<span class="builtintype" id="4956242">uint8</span><span class="op" id="4956247">(</span><span class="ident" id="4956248">c1</span><span class="op" id="4956250">.</span><span class="ident" id="4956251">A</span><span class="op" id="4956252">)</span><br>
<span class="lineno">210</span><span class="op" id="4956254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4956257">func</span>&nbsp;<span class="op" id="4956262">(</span><span class="ident" id="4956263">p</span>&nbsp;<span class="op" id="4956265">*</span><span class="ident" id="4956266">RGBA64</span><span class="op" id="4956272">)</span>&nbsp;<span class="ident" id="4956274">SetRGBA64</span><span class="op" id="4956283">(</span><span class="ident" id="4956284">x</span><span class="op" id="4956285">,</span>&nbsp;<span class="ident" id="4956287">y</span>&nbsp;<span class="builtintype" id="4956289">int</span><span class="op" id="4956292">,</span>&nbsp;<span class="ident" id="4956294">c</span>&nbsp;<span class="ident" id="4956296">color</span><span class="op" id="4956301">.</span><span class="ident" id="4956302">RGBA64</span><span class="op" id="4956308">)</span>&nbsp;<span class="op" id="4956310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4956313">if</span>&nbsp;<span class="op" id="4956316">!</span><span class="op" id="4956317">(</span><span class="ident" id="4956318">Point</span><span class="op" id="4956323">{</span><span class="ident" id="4956324">x</span><span class="op" id="4956325">,</span>&nbsp;<span class="ident" id="4956327">y</span><span class="op" id="4956328">}</span><span class="op" id="4956329">.</span><span class="ident" id="4956330">In</span><span class="op" id="4956332">(</span><span class="ident" id="4956333">p</span><span class="op" id="4956334">.</span><span class="ident" id="4956335">Rect</span><span class="op" id="4956339">)</span><span class="op" id="4956340">)</span>&nbsp;<span class="op" id="4956342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4956346">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4956354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956357">i</span>&nbsp;<span class="op" id="4956359">:=</span>&nbsp;<span class="ident" id="4956362">p</span><span class="op" id="4956363">.</span><span class="ident" id="4956364">PixOffset</span><span class="op" id="4956373">(</span><span class="ident" id="4956374">x</span><span class="op" id="4956375">,</span>&nbsp;<span class="ident" id="4956377">y</span><span class="op" id="4956378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956381">p</span><span class="op" id="4956382">.</span><span class="ident" id="4956383">Pix</span><span class="op" id="4956386">[</span><span class="ident" id="4956387">i</span><span class="op" id="4956388">+</span><span class="num" id="4956389">0</span><span class="op" id="4956390">]</span>&nbsp;<span class="op" id="4956392">=</span>&nbsp;<span class="builtintype" id="4956394">uint8</span><span class="op" id="4956399">(</span><span class="ident" id="4956400">c</span><span class="op" id="4956401">.</span><span class="ident" id="4956402">R</span>&nbsp;<span class="op" id="4956404">&gt;&gt;</span>&nbsp;<span class="num" id="4956407">8</span><span class="op" id="4956408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956411">p</span><span class="op" id="4956412">.</span><span class="ident" id="4956413">Pix</span><span class="op" id="4956416">[</span><span class="ident" id="4956417">i</span><span class="op" id="4956418">+</span><span class="num" id="4956419">1</span><span class="op" id="4956420">]</span>&nbsp;<span class="op" id="4956422">=</span>&nbsp;<span class="builtintype" id="4956424">uint8</span><span class="op" id="4956429">(</span><span class="ident" id="4956430">c</span><span class="op" id="4956431">.</span><span class="ident" id="4956432">R</span><span class="op" id="4956433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956436">p</span><span class="op" id="4956437">.</span><span class="ident" id="4956438">Pix</span><span class="op" id="4956441">[</span><span class="ident" id="4956442">i</span><span class="op" id="4956443">+</span><span class="num" id="4956444">2</span><span class="op" id="4956445">]</span>&nbsp;<span class="op" id="4956447">=</span>&nbsp;<span class="builtintype" id="4956449">uint8</span><span class="op" id="4956454">(</span><span class="ident" id="4956455">c</span><span class="op" id="4956456">.</span><span class="ident" id="4956457">G</span>&nbsp;<span class="op" id="4956459">&gt;&gt;</span>&nbsp;<span class="num" id="4956462">8</span><span class="op" id="4956463">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956466">p</span><span class="op" id="4956467">.</span><span class="ident" id="4956468">Pix</span><span class="op" id="4956471">[</span><span class="ident" id="4956472">i</span><span class="op" id="4956473">+</span><span class="num" id="4956474">3</span><span class="op" id="4956475">]</span>&nbsp;<span class="op" id="4956477">=</span>&nbsp;<span class="builtintype" id="4956479">uint8</span><span class="op" id="4956484">(</span><span class="ident" id="4956485">c</span><span class="op" id="4956486">.</span><span class="ident" id="4956487">G</span><span class="op" id="4956488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956491">p</span><span class="op" id="4956492">.</span><span class="ident" id="4956493">Pix</span><span class="op" id="4956496">[</span><span class="ident" id="4956497">i</span><span class="op" id="4956498">+</span><span class="num" id="4956499">4</span><span class="op" id="4956500">]</span>&nbsp;<span class="op" id="4956502">=</span>&nbsp;<span class="builtintype" id="4956504">uint8</span><span class="op" id="4956509">(</span><span class="ident" id="4956510">c</span><span class="op" id="4956511">.</span><span class="ident" id="4956512">B</span>&nbsp;<span class="op" id="4956514">&gt;&gt;</span>&nbsp;<span class="num" id="4956517">8</span><span class="op" id="4956518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956521">p</span><span class="op" id="4956522">.</span><span class="ident" id="4956523">Pix</span><span class="op" id="4956526">[</span><span class="ident" id="4956527">i</span><span class="op" id="4956528">+</span><span class="num" id="4956529">5</span><span class="op" id="4956530">]</span>&nbsp;<span class="op" id="4956532">=</span>&nbsp;<span class="builtintype" id="4956534">uint8</span><span class="op" id="4956539">(</span><span class="ident" id="4956540">c</span><span class="op" id="4956541">.</span><span class="ident" id="4956542">B</span><span class="op" id="4956543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956546">p</span><span class="op" id="4956547">.</span><span class="ident" id="4956548">Pix</span><span class="op" id="4956551">[</span><span class="ident" id="4956552">i</span><span class="op" id="4956553">+</span><span class="num" id="4956554">6</span><span class="op" id="4956555">]</span>&nbsp;<span class="op" id="4956557">=</span>&nbsp;<span class="builtintype" id="4956559">uint8</span><span class="op" id="4956564">(</span><span class="ident" id="4956565">c</span><span class="op" id="4956566">.</span><span class="ident" id="4956567">A</span>&nbsp;<span class="op" id="4956569">&gt;&gt;</span>&nbsp;<span class="num" id="4956572">8</span><span class="op" id="4956573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956576">p</span><span class="op" id="4956577">.</span><span class="ident" id="4956578">Pix</span><span class="op" id="4956581">[</span><span class="ident" id="4956582">i</span><span class="op" id="4956583">+</span><span class="num" id="4956584">7</span><span class="op" id="4956585">]</span>&nbsp;<span class="op" id="4956587">=</span>&nbsp;<span class="builtintype" id="4956589">uint8</span><span class="op" id="4956594">(</span><span class="ident" id="4956595">c</span><span class="op" id="4956596">.</span><span class="ident" id="4956597">A</span><span class="op" id="4956598">)</span><br>
<span class="lineno">225</span><span class="op" id="4956600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956603">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4956680">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4956752">func</span>&nbsp;<span class="op" id="4956757">(</span><span class="ident" id="4956758">p</span>&nbsp;<span class="op" id="4956760">*</span><span class="ident" id="4956761">RGBA64</span><span class="op" id="4956767">)</span>&nbsp;<span class="ident" id="4956769">SubImage</span><span class="op" id="4956777">(</span><span class="ident" id="4956778">r</span>&nbsp;<span class="ident" id="4956780">Rectangle</span><span class="op" id="4956789">)</span>&nbsp;<span class="ident" id="4956791">Image</span>&nbsp;<span class="op" id="4956797">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4956800">r</span>&nbsp;<span class="op" id="4956802">=</span>&nbsp;<span class="ident" id="4956804">r</span><span class="op" id="4956805">.</span><span class="ident" id="4956806">Intersect</span><span class="op" id="4956815">(</span><span class="ident" id="4956816">p</span><span class="op" id="4956817">.</span><span class="ident" id="4956818">Rect</span><span class="op" id="4956822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4956825">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4956906">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4956988">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957038">if</span>&nbsp;<span class="ident" id="4957041">r</span><span class="op" id="4957042">.</span><span class="ident" id="4957043">Empty</span><span class="op" id="4957048">(</span><span class="op" id="4957049">)</span>&nbsp;<span class="op" id="4957051">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957055">return</span>&nbsp;<span class="op" id="4957062">&amp;</span><span class="ident" id="4957063">RGBA64</span><span class="op" id="4957069">{</span><span class="op" id="4957070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4957073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957076">i</span>&nbsp;<span class="op" id="4957078">:=</span>&nbsp;<span class="ident" id="4957081">p</span><span class="op" id="4957082">.</span><span class="ident" id="4957083">PixOffset</span><span class="op" id="4957092">(</span><span class="ident" id="4957093">r</span><span class="op" id="4957094">.</span><span class="ident" id="4957095">Min</span><span class="op" id="4957098">.</span><span class="ident" id="4957099">X</span><span class="op" id="4957100">,</span>&nbsp;<span class="ident" id="4957102">r</span><span class="op" id="4957103">.</span><span class="ident" id="4957104">Min</span><span class="op" id="4957107">.</span><span class="ident" id="4957108">Y</span><span class="op" id="4957109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957112">return</span>&nbsp;<span class="op" id="4957119">&amp;</span><span class="ident" id="4957120">RGBA64</span><span class="op" id="4957126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957130">Pix</span><span class="op" id="4957133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957138">p</span><span class="op" id="4957139">.</span><span class="ident" id="4957140">Pix</span><span class="op" id="4957143">[</span><span class="ident" id="4957144">i</span><span class="op" id="4957145">:</span><span class="op" id="4957146">]</span><span class="op" id="4957147">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957151">Stride</span><span class="op" id="4957157">:</span>&nbsp;<span class="ident" id="4957159">p</span><span class="op" id="4957160">.</span><span class="ident" id="4957161">Stride</span><span class="op" id="4957167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957171">Rect</span><span class="op" id="4957175">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4957179">r</span><span class="op" id="4957180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4957183">}</span><br>
<span class="lineno"></span><span class="op" id="4957185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4957188">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4957261">func</span>&nbsp;<span class="op" id="4957266">(</span><span class="ident" id="4957267">p</span>&nbsp;<span class="op" id="4957269">*</span><span class="ident" id="4957270">RGBA64</span><span class="op" id="4957276">)</span>&nbsp;<span class="ident" id="4957278">Opaque</span><span class="op" id="4957284">(</span><span class="op" id="4957285">)</span>&nbsp;<span class="builtintype" id="4957287">bool</span>&nbsp;<span class="op" id="4957292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957295">if</span>&nbsp;<span class="ident" id="4957298">p</span><span class="op" id="4957299">.</span><span class="ident" id="4957300">Rect</span><span class="op" id="4957304">.</span><span class="ident" id="4957305">Empty</span><span class="op" id="4957310">(</span><span class="op" id="4957311">)</span>&nbsp;<span class="op" id="4957313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957317">return</span>&nbsp;<span class="builtintype" id="4957324">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4957330">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957333">i0</span><span class="op" id="4957335">,</span>&nbsp;<span class="ident" id="4957337">i1</span>&nbsp;<span class="op" id="4957340">:=</span>&nbsp;<span class="num" id="4957343">6</span><span class="op" id="4957344">,</span>&nbsp;<span class="ident" id="4957346">p</span><span class="op" id="4957347">.</span><span class="ident" id="4957348">Rect</span><span class="op" id="4957352">.</span><span class="ident" id="4957353">Dx</span><span class="op" id="4957355">(</span><span class="op" id="4957356">)</span><span class="op" id="4957357">*</span><span class="num" id="4957358">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957361">for</span>&nbsp;<span class="ident" id="4957365">y</span>&nbsp;<span class="op" id="4957367">:=</span>&nbsp;<span class="ident" id="4957370">p</span><span class="op" id="4957371">.</span><span class="ident" id="4957372">Rect</span><span class="op" id="4957376">.</span><span class="ident" id="4957377">Min</span><span class="op" id="4957380">.</span><span class="ident" id="4957381">Y</span><span class="op" id="4957382">;</span>&nbsp;<span class="ident" id="4957384">y</span>&nbsp;<span class="op" id="4957386">&lt;</span>&nbsp;<span class="ident" id="4957388">p</span><span class="op" id="4957389">.</span><span class="ident" id="4957390">Rect</span><span class="op" id="4957394">.</span><span class="ident" id="4957395">Max</span><span class="op" id="4957398">.</span><span class="ident" id="4957399">Y</span><span class="op" id="4957400">;</span>&nbsp;<span class="ident" id="4957402">y</span><span class="op" id="4957403">++</span>&nbsp;<span class="op" id="4957406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957410">for</span>&nbsp;<span class="ident" id="4957414">i</span>&nbsp;<span class="op" id="4957416">:=</span>&nbsp;<span class="ident" id="4957419">i0</span><span class="op" id="4957421">;</span>&nbsp;<span class="ident" id="4957423">i</span>&nbsp;<span class="op" id="4957425">&lt;</span>&nbsp;<span class="ident" id="4957427">i1</span><span class="op" id="4957429">;</span>&nbsp;<span class="ident" id="4957431">i</span>&nbsp;<span class="op" id="4957433">+=</span>&nbsp;<span class="num" id="4957436">8</span>&nbsp;<span class="op" id="4957438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957443">if</span>&nbsp;<span class="ident" id="4957446">p</span><span class="op" id="4957447">.</span><span class="ident" id="4957448">Pix</span><span class="op" id="4957451">[</span><span class="ident" id="4957452">i</span><span class="op" id="4957453">+</span><span class="num" id="4957454">0</span><span class="op" id="4957455">]</span>&nbsp;<span class="op" id="4957457">!=</span>&nbsp;<span class="num" id="4957460">0xff</span>&nbsp;<span class="op" id="4957465">||</span>&nbsp;<span class="ident" id="4957468">p</span><span class="op" id="4957469">.</span><span class="ident" id="4957470">Pix</span><span class="op" id="4957473">[</span><span class="ident" id="4957474">i</span><span class="op" id="4957475">+</span><span class="num" id="4957476">1</span><span class="op" id="4957477">]</span>&nbsp;<span class="op" id="4957479">!=</span>&nbsp;<span class="num" id="4957482">0xff</span>&nbsp;<span class="op" id="4957487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957493">return</span>&nbsp;<span class="builtintype" id="4957500">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4957509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4957513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957517">i0</span>&nbsp;<span class="op" id="4957520">+=</span>&nbsp;<span class="ident" id="4957523">p</span><span class="op" id="4957524">.</span><span class="ident" id="4957525">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957534">i1</span>&nbsp;<span class="op" id="4957537">+=</span>&nbsp;<span class="ident" id="4957540">p</span><span class="op" id="4957541">.</span><span class="ident" id="4957542">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4957550">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957553">return</span>&nbsp;<span class="builtintype" id="4957560">true</span><br>
<span class="lineno"></span><span class="op" id="4957565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4957568">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4957625">func</span>&nbsp;<span class="ident" id="4957630">NewRGBA64</span><span class="op" id="4957639">(</span><span class="ident" id="4957640">r</span>&nbsp;<span class="ident" id="4957642">Rectangle</span><span class="op" id="4957651">)</span>&nbsp;<span class="op" id="4957653">*</span><span class="ident" id="4957654">RGBA64</span>&nbsp;<span class="op" id="4957661">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957664">w</span><span class="op" id="4957665">,</span>&nbsp;<span class="ident" id="4957667">h</span>&nbsp;<span class="op" id="4957669">:=</span>&nbsp;<span class="ident" id="4957672">r</span><span class="op" id="4957673">.</span><span class="ident" id="4957674">Dx</span><span class="op" id="4957676">(</span><span class="op" id="4957677">)</span><span class="op" id="4957678">,</span>&nbsp;<span class="ident" id="4957680">r</span><span class="op" id="4957681">.</span><span class="ident" id="4957682">Dy</span><span class="op" id="4957684">(</span><span class="op" id="4957685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957688">pix</span>&nbsp;<span class="op" id="4957692">:=</span>&nbsp;<span class="builtinfunc" id="4957695">make</span><span class="op" id="4957699">(</span><span class="op" id="4957700">[</span><span class="op" id="4957701">]</span><span class="builtintype" id="4957702">uint8</span><span class="op" id="4957707">,</span>&nbsp;<span class="num" id="4957709">8</span><span class="op" id="4957710">*</span><span class="ident" id="4957711">w</span><span class="op" id="4957712">*</span><span class="ident" id="4957713">h</span><span class="op" id="4957714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4957717">return</span>&nbsp;<span class="op" id="4957724">&amp;</span><span class="ident" id="4957725">RGBA64</span><span class="op" id="4957731">{</span><span class="ident" id="4957732">pix</span><span class="op" id="4957735">,</span>&nbsp;<span class="num" id="4957737">8</span>&nbsp;<span class="op" id="4957739">*</span>&nbsp;<span class="ident" id="4957741">w</span><span class="op" id="4957742">,</span>&nbsp;<span class="ident" id="4957744">r</span><span class="op" id="4957745">}</span><br>
<span class="lineno"></span><span class="op" id="4957747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4957750">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4957825">type</span>&nbsp;<span class="ident" id="4957830">NRGBA</span>&nbsp;<span class="keyword" id="4957836">struct</span>&nbsp;<span class="op" id="4957843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4957846">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4957914">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4957982">Pix</span>&nbsp;<span class="op" id="4957986">[</span><span class="op" id="4957987">]</span><span class="builtintype" id="4957988">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4957995">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958071">Stride</span>&nbsp;<span class="builtintype" id="4958078">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4958083">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958115">Rect</span>&nbsp;<span class="ident" id="4958120">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4958130">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="4958133">func</span>&nbsp;<span class="op" id="4958138">(</span><span class="ident" id="4958139">p</span>&nbsp;<span class="op" id="4958141">*</span><span class="ident" id="4958142">NRGBA</span><span class="op" id="4958147">)</span>&nbsp;<span class="ident" id="4958149">ColorModel</span><span class="op" id="4958159">(</span><span class="op" id="4958160">)</span>&nbsp;<span class="ident" id="4958162">color</span><span class="op" id="4958167">.</span><span class="ident" id="4958168">Model</span>&nbsp;<span class="op" id="4958174">{</span>&nbsp;<span class="keyword" id="4958176">return</span>&nbsp;<span class="ident" id="4958183">color</span><span class="op" id="4958188">.</span><span class="ident" id="4958189">NRGBAModel</span>&nbsp;<span class="op" id="4958200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958203">func</span>&nbsp;<span class="op" id="4958208">(</span><span class="ident" id="4958209">p</span>&nbsp;<span class="op" id="4958211">*</span><span class="ident" id="4958212">NRGBA</span><span class="op" id="4958217">)</span>&nbsp;<span class="ident" id="4958219">Bounds</span><span class="op" id="4958225">(</span><span class="op" id="4958226">)</span>&nbsp;<span class="ident" id="4958228">Rectangle</span>&nbsp;<span class="op" id="4958238">{</span>&nbsp;<span class="keyword" id="4958240">return</span>&nbsp;<span class="ident" id="4958247">p</span><span class="op" id="4958248">.</span><span class="ident" id="4958249">Rect</span>&nbsp;<span class="op" id="4958254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4958257">func</span>&nbsp;<span class="op" id="4958262">(</span><span class="ident" id="4958263">p</span>&nbsp;<span class="op" id="4958265">*</span><span class="ident" id="4958266">NRGBA</span><span class="op" id="4958271">)</span>&nbsp;<span class="ident" id="4958273">At</span><span class="op" id="4958275">(</span><span class="ident" id="4958276">x</span><span class="op" id="4958277">,</span>&nbsp;<span class="ident" id="4958279">y</span>&nbsp;<span class="builtintype" id="4958281">int</span><span class="op" id="4958284">)</span>&nbsp;<span class="ident" id="4958286">color</span><span class="op" id="4958291">.</span><span class="ident" id="4958292">Color</span>&nbsp;<span class="op" id="4958298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958301">return</span>&nbsp;<span class="ident" id="4958308">p</span><span class="op" id="4958309">.</span><span class="ident" id="4958310">NRGBAAt</span><span class="op" id="4958317">(</span><span class="ident" id="4958318">x</span><span class="op" id="4958319">,</span>&nbsp;<span class="ident" id="4958321">y</span><span class="op" id="4958322">)</span><br>
<span class="lineno"></span><span class="op" id="4958324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958327">func</span>&nbsp;<span class="op" id="4958332">(</span><span class="ident" id="4958333">p</span>&nbsp;<span class="op" id="4958335">*</span><span class="ident" id="4958336">NRGBA</span><span class="op" id="4958341">)</span>&nbsp;<span class="ident" id="4958343">NRGBAAt</span><span class="op" id="4958350">(</span><span class="ident" id="4958351">x</span><span class="op" id="4958352">,</span>&nbsp;<span class="ident" id="4958354">y</span>&nbsp;<span class="builtintype" id="4958356">int</span><span class="op" id="4958359">)</span>&nbsp;<span class="ident" id="4958361">color</span><span class="op" id="4958366">.</span><span class="ident" id="4958367">NRGBA</span>&nbsp;<span class="op" id="4958373">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958376">if</span>&nbsp;<span class="op" id="4958379">!</span><span class="op" id="4958380">(</span><span class="ident" id="4958381">Point</span><span class="op" id="4958386">{</span><span class="ident" id="4958387">x</span><span class="op" id="4958388">,</span>&nbsp;<span class="ident" id="4958390">y</span><span class="op" id="4958391">}</span><span class="op" id="4958392">.</span><span class="ident" id="4958393">In</span><span class="op" id="4958395">(</span><span class="ident" id="4958396">p</span><span class="op" id="4958397">.</span><span class="ident" id="4958398">Rect</span><span class="op" id="4958402">)</span><span class="op" id="4958403">)</span>&nbsp;<span class="op" id="4958405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958409">return</span>&nbsp;<span class="ident" id="4958416">color</span><span class="op" id="4958421">.</span><span class="ident" id="4958422">NRGBA</span><span class="op" id="4958427">{</span><span class="op" id="4958428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4958431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958434">i</span>&nbsp;<span class="op" id="4958436">:=</span>&nbsp;<span class="ident" id="4958439">p</span><span class="op" id="4958440">.</span><span class="ident" id="4958441">PixOffset</span><span class="op" id="4958450">(</span><span class="ident" id="4958451">x</span><span class="op" id="4958452">,</span>&nbsp;<span class="ident" id="4958454">y</span><span class="op" id="4958455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958458">return</span>&nbsp;<span class="ident" id="4958465">color</span><span class="op" id="4958470">.</span><span class="ident" id="4958471">NRGBA</span><span class="op" id="4958476">{</span><span class="ident" id="4958477">p</span><span class="op" id="4958478">.</span><span class="ident" id="4958479">Pix</span><span class="op" id="4958482">[</span><span class="ident" id="4958483">i</span><span class="op" id="4958484">+</span><span class="num" id="4958485">0</span><span class="op" id="4958486">]</span><span class="op" id="4958487">,</span>&nbsp;<span class="ident" id="4958489">p</span><span class="op" id="4958490">.</span><span class="ident" id="4958491">Pix</span><span class="op" id="4958494">[</span><span class="ident" id="4958495">i</span><span class="op" id="4958496">+</span><span class="num" id="4958497">1</span><span class="op" id="4958498">]</span><span class="op" id="4958499">,</span>&nbsp;<span class="ident" id="4958501">p</span><span class="op" id="4958502">.</span><span class="ident" id="4958503">Pix</span><span class="op" id="4958506">[</span><span class="ident" id="4958507">i</span><span class="op" id="4958508">+</span><span class="num" id="4958509">2</span><span class="op" id="4958510">]</span><span class="op" id="4958511">,</span>&nbsp;<span class="ident" id="4958513">p</span><span class="op" id="4958514">.</span><span class="ident" id="4958515">Pix</span><span class="op" id="4958518">[</span><span class="ident" id="4958519">i</span><span class="op" id="4958520">+</span><span class="num" id="4958521">3</span><span class="op" id="4958522">]</span><span class="op" id="4958523">}</span><br>
<span class="lineno">295</span><span class="op" id="4958525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4958528">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4958607">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4958631">func</span>&nbsp;<span class="op" id="4958636">(</span><span class="ident" id="4958637">p</span>&nbsp;<span class="op" id="4958639">*</span><span class="ident" id="4958640">NRGBA</span><span class="op" id="4958645">)</span>&nbsp;<span class="ident" id="4958647">PixOffset</span><span class="op" id="4958656">(</span><span class="ident" id="4958657">x</span><span class="op" id="4958658">,</span>&nbsp;<span class="ident" id="4958660">y</span>&nbsp;<span class="builtintype" id="4958662">int</span><span class="op" id="4958665">)</span>&nbsp;<span class="builtintype" id="4958667">int</span>&nbsp;<span class="op" id="4958671">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958674">return</span>&nbsp;<span class="op" id="4958681">(</span><span class="ident" id="4958682">y</span><span class="op" id="4958683">-</span><span class="ident" id="4958684">p</span><span class="op" id="4958685">.</span><span class="ident" id="4958686">Rect</span><span class="op" id="4958690">.</span><span class="ident" id="4958691">Min</span><span class="op" id="4958694">.</span><span class="ident" id="4958695">Y</span><span class="op" id="4958696">)</span><span class="op" id="4958697">*</span><span class="ident" id="4958698">p</span><span class="op" id="4958699">.</span><span class="ident" id="4958700">Stride</span>&nbsp;<span class="op" id="4958707">+</span>&nbsp;<span class="op" id="4958709">(</span><span class="ident" id="4958710">x</span><span class="op" id="4958711">-</span><span class="ident" id="4958712">p</span><span class="op" id="4958713">.</span><span class="ident" id="4958714">Rect</span><span class="op" id="4958718">.</span><span class="ident" id="4958719">Min</span><span class="op" id="4958722">.</span><span class="ident" id="4958723">X</span><span class="op" id="4958724">)</span><span class="op" id="4958725">*</span><span class="num" id="4958726">4</span><br>
<span class="lineno"></span><span class="op" id="4958728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958731">func</span>&nbsp;<span class="op" id="4958736">(</span><span class="ident" id="4958737">p</span>&nbsp;<span class="op" id="4958739">*</span><span class="ident" id="4958740">NRGBA</span><span class="op" id="4958745">)</span>&nbsp;<span class="ident" id="4958747">Set</span><span class="op" id="4958750">(</span><span class="ident" id="4958751">x</span><span class="op" id="4958752">,</span>&nbsp;<span class="ident" id="4958754">y</span>&nbsp;<span class="builtintype" id="4958756">int</span><span class="op" id="4958759">,</span>&nbsp;<span class="ident" id="4958761">c</span>&nbsp;<span class="ident" id="4958763">color</span><span class="op" id="4958768">.</span><span class="ident" id="4958769">Color</span><span class="op" id="4958774">)</span>&nbsp;<span class="op" id="4958776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958779">if</span>&nbsp;<span class="op" id="4958782">!</span><span class="op" id="4958783">(</span><span class="ident" id="4958784">Point</span><span class="op" id="4958789">{</span><span class="ident" id="4958790">x</span><span class="op" id="4958791">,</span>&nbsp;<span class="ident" id="4958793">y</span><span class="op" id="4958794">}</span><span class="op" id="4958795">.</span><span class="ident" id="4958796">In</span><span class="op" id="4958798">(</span><span class="ident" id="4958799">p</span><span class="op" id="4958800">.</span><span class="ident" id="4958801">Rect</span><span class="op" id="4958805">)</span><span class="op" id="4958806">)</span>&nbsp;<span class="op" id="4958808">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958812">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4958820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958823">i</span>&nbsp;<span class="op" id="4958825">:=</span>&nbsp;<span class="ident" id="4958828">p</span><span class="op" id="4958829">.</span><span class="ident" id="4958830">PixOffset</span><span class="op" id="4958839">(</span><span class="ident" id="4958840">x</span><span class="op" id="4958841">,</span>&nbsp;<span class="ident" id="4958843">y</span><span class="op" id="4958844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958847">c1</span>&nbsp;<span class="op" id="4958850">:=</span>&nbsp;<span class="ident" id="4958853">color</span><span class="op" id="4958858">.</span><span class="ident" id="4958859">NRGBAModel</span><span class="op" id="4958869">.</span><span class="ident" id="4958870">Convert</span><span class="op" id="4958877">(</span><span class="ident" id="4958878">c</span><span class="op" id="4958879">)</span><span class="op" id="4958880">.</span><span class="op" id="4958881">(</span><span class="ident" id="4958882">color</span><span class="op" id="4958887">.</span><span class="ident" id="4958888">NRGBA</span><span class="op" id="4958893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958896">p</span><span class="op" id="4958897">.</span><span class="ident" id="4958898">Pix</span><span class="op" id="4958901">[</span><span class="ident" id="4958902">i</span><span class="op" id="4958903">+</span><span class="num" id="4958904">0</span><span class="op" id="4958905">]</span>&nbsp;<span class="op" id="4958907">=</span>&nbsp;<span class="ident" id="4958909">c1</span><span class="op" id="4958911">.</span><span class="ident" id="4958912">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958915">p</span><span class="op" id="4958916">.</span><span class="ident" id="4958917">Pix</span><span class="op" id="4958920">[</span><span class="ident" id="4958921">i</span><span class="op" id="4958922">+</span><span class="num" id="4958923">1</span><span class="op" id="4958924">]</span>&nbsp;<span class="op" id="4958926">=</span>&nbsp;<span class="ident" id="4958928">c1</span><span class="op" id="4958930">.</span><span class="ident" id="4958931">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958934">p</span><span class="op" id="4958935">.</span><span class="ident" id="4958936">Pix</span><span class="op" id="4958939">[</span><span class="ident" id="4958940">i</span><span class="op" id="4958941">+</span><span class="num" id="4958942">2</span><span class="op" id="4958943">]</span>&nbsp;<span class="op" id="4958945">=</span>&nbsp;<span class="ident" id="4958947">c1</span><span class="op" id="4958949">.</span><span class="ident" id="4958950">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958953">p</span><span class="op" id="4958954">.</span><span class="ident" id="4958955">Pix</span><span class="op" id="4958958">[</span><span class="ident" id="4958959">i</span><span class="op" id="4958960">+</span><span class="num" id="4958961">3</span><span class="op" id="4958962">]</span>&nbsp;<span class="op" id="4958964">=</span>&nbsp;<span class="ident" id="4958966">c1</span><span class="op" id="4958968">.</span><span class="ident" id="4958969">A</span><br>
<span class="lineno"></span><span class="op" id="4958971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="4958974">func</span>&nbsp;<span class="op" id="4958979">(</span><span class="ident" id="4958980">p</span>&nbsp;<span class="op" id="4958982">*</span><span class="ident" id="4958983">NRGBA</span><span class="op" id="4958988">)</span>&nbsp;<span class="ident" id="4958990">SetNRGBA</span><span class="op" id="4958998">(</span><span class="ident" id="4958999">x</span><span class="op" id="4959000">,</span>&nbsp;<span class="ident" id="4959002">y</span>&nbsp;<span class="builtintype" id="4959004">int</span><span class="op" id="4959007">,</span>&nbsp;<span class="ident" id="4959009">c</span>&nbsp;<span class="ident" id="4959011">color</span><span class="op" id="4959016">.</span><span class="ident" id="4959017">NRGBA</span><span class="op" id="4959022">)</span>&nbsp;<span class="op" id="4959024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959027">if</span>&nbsp;<span class="op" id="4959030">!</span><span class="op" id="4959031">(</span><span class="ident" id="4959032">Point</span><span class="op" id="4959037">{</span><span class="ident" id="4959038">x</span><span class="op" id="4959039">,</span>&nbsp;<span class="ident" id="4959041">y</span><span class="op" id="4959042">}</span><span class="op" id="4959043">.</span><span class="ident" id="4959044">In</span><span class="op" id="4959046">(</span><span class="ident" id="4959047">p</span><span class="op" id="4959048">.</span><span class="ident" id="4959049">Rect</span><span class="op" id="4959053">)</span><span class="op" id="4959054">)</span>&nbsp;<span class="op" id="4959056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959060">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959071">i</span>&nbsp;<span class="op" id="4959073">:=</span>&nbsp;<span class="ident" id="4959076">p</span><span class="op" id="4959077">.</span><span class="ident" id="4959078">PixOffset</span><span class="op" id="4959087">(</span><span class="ident" id="4959088">x</span><span class="op" id="4959089">,</span>&nbsp;<span class="ident" id="4959091">y</span><span class="op" id="4959092">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959095">p</span><span class="op" id="4959096">.</span><span class="ident" id="4959097">Pix</span><span class="op" id="4959100">[</span><span class="ident" id="4959101">i</span><span class="op" id="4959102">+</span><span class="num" id="4959103">0</span><span class="op" id="4959104">]</span>&nbsp;<span class="op" id="4959106">=</span>&nbsp;<span class="ident" id="4959108">c</span><span class="op" id="4959109">.</span><span class="ident" id="4959110">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959113">p</span><span class="op" id="4959114">.</span><span class="ident" id="4959115">Pix</span><span class="op" id="4959118">[</span><span class="ident" id="4959119">i</span><span class="op" id="4959120">+</span><span class="num" id="4959121">1</span><span class="op" id="4959122">]</span>&nbsp;<span class="op" id="4959124">=</span>&nbsp;<span class="ident" id="4959126">c</span><span class="op" id="4959127">.</span><span class="ident" id="4959128">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959131">p</span><span class="op" id="4959132">.</span><span class="ident" id="4959133">Pix</span><span class="op" id="4959136">[</span><span class="ident" id="4959137">i</span><span class="op" id="4959138">+</span><span class="num" id="4959139">2</span><span class="op" id="4959140">]</span>&nbsp;<span class="op" id="4959142">=</span>&nbsp;<span class="ident" id="4959144">c</span><span class="op" id="4959145">.</span><span class="ident" id="4959146">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959149">p</span><span class="op" id="4959150">.</span><span class="ident" id="4959151">Pix</span><span class="op" id="4959154">[</span><span class="ident" id="4959155">i</span><span class="op" id="4959156">+</span><span class="num" id="4959157">3</span><span class="op" id="4959158">]</span>&nbsp;<span class="op" id="4959160">=</span>&nbsp;<span class="ident" id="4959162">c</span><span class="op" id="4959163">.</span><span class="ident" id="4959164">A</span><br>
<span class="lineno"></span><span class="op" id="4959166">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4959169">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4959246">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4959318">func</span>&nbsp;<span class="op" id="4959323">(</span><span class="ident" id="4959324">p</span>&nbsp;<span class="op" id="4959326">*</span><span class="ident" id="4959327">NRGBA</span><span class="op" id="4959332">)</span>&nbsp;<span class="ident" id="4959334">SubImage</span><span class="op" id="4959342">(</span><span class="ident" id="4959343">r</span>&nbsp;<span class="ident" id="4959345">Rectangle</span><span class="op" id="4959354">)</span>&nbsp;<span class="ident" id="4959356">Image</span>&nbsp;<span class="op" id="4959362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959365">r</span>&nbsp;<span class="op" id="4959367">=</span>&nbsp;<span class="ident" id="4959369">r</span><span class="op" id="4959370">.</span><span class="ident" id="4959371">Intersect</span><span class="op" id="4959380">(</span><span class="ident" id="4959381">p</span><span class="op" id="4959382">.</span><span class="ident" id="4959383">Rect</span><span class="op" id="4959387">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4959390">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4959471">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4959553">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959603">if</span>&nbsp;<span class="ident" id="4959606">r</span><span class="op" id="4959607">.</span><span class="ident" id="4959608">Empty</span><span class="op" id="4959613">(</span><span class="op" id="4959614">)</span>&nbsp;<span class="op" id="4959616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959620">return</span>&nbsp;<span class="op" id="4959627">&amp;</span><span class="ident" id="4959628">NRGBA</span><span class="op" id="4959633">{</span><span class="op" id="4959634">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959640">i</span>&nbsp;<span class="op" id="4959642">:=</span>&nbsp;<span class="ident" id="4959645">p</span><span class="op" id="4959646">.</span><span class="ident" id="4959647">PixOffset</span><span class="op" id="4959656">(</span><span class="ident" id="4959657">r</span><span class="op" id="4959658">.</span><span class="ident" id="4959659">Min</span><span class="op" id="4959662">.</span><span class="ident" id="4959663">X</span><span class="op" id="4959664">,</span>&nbsp;<span class="ident" id="4959666">r</span><span class="op" id="4959667">.</span><span class="ident" id="4959668">Min</span><span class="op" id="4959671">.</span><span class="ident" id="4959672">Y</span><span class="op" id="4959673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959676">return</span>&nbsp;<span class="op" id="4959683">&amp;</span><span class="ident" id="4959684">NRGBA</span><span class="op" id="4959689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959693">Pix</span><span class="op" id="4959696">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959701">p</span><span class="op" id="4959702">.</span><span class="ident" id="4959703">Pix</span><span class="op" id="4959706">[</span><span class="ident" id="4959707">i</span><span class="op" id="4959708">:</span><span class="op" id="4959709">]</span><span class="op" id="4959710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959714">Stride</span><span class="op" id="4959720">:</span>&nbsp;<span class="ident" id="4959722">p</span><span class="op" id="4959723">.</span><span class="ident" id="4959724">Stride</span><span class="op" id="4959730">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959734">Rect</span><span class="op" id="4959738">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4959742">r</span><span class="op" id="4959743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959746">}</span><br>
<span class="lineno"></span><span class="op" id="4959748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4959751">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="4959824">func</span>&nbsp;<span class="op" id="4959829">(</span><span class="ident" id="4959830">p</span>&nbsp;<span class="op" id="4959832">*</span><span class="ident" id="4959833">NRGBA</span><span class="op" id="4959838">)</span>&nbsp;<span class="ident" id="4959840">Opaque</span><span class="op" id="4959846">(</span><span class="op" id="4959847">)</span>&nbsp;<span class="builtintype" id="4959849">bool</span>&nbsp;<span class="op" id="4959854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959857">if</span>&nbsp;<span class="ident" id="4959860">p</span><span class="op" id="4959861">.</span><span class="ident" id="4959862">Rect</span><span class="op" id="4959866">.</span><span class="ident" id="4959867">Empty</span><span class="op" id="4959872">(</span><span class="op" id="4959873">)</span>&nbsp;<span class="op" id="4959875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959879">return</span>&nbsp;<span class="builtintype" id="4959886">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4959895">i0</span><span class="op" id="4959897">,</span>&nbsp;<span class="ident" id="4959899">i1</span>&nbsp;<span class="op" id="4959902">:=</span>&nbsp;<span class="num" id="4959905">3</span><span class="op" id="4959906">,</span>&nbsp;<span class="ident" id="4959908">p</span><span class="op" id="4959909">.</span><span class="ident" id="4959910">Rect</span><span class="op" id="4959914">.</span><span class="ident" id="4959915">Dx</span><span class="op" id="4959917">(</span><span class="op" id="4959918">)</span><span class="op" id="4959919">*</span><span class="num" id="4959920">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959923">for</span>&nbsp;<span class="ident" id="4959927">y</span>&nbsp;<span class="op" id="4959929">:=</span>&nbsp;<span class="ident" id="4959932">p</span><span class="op" id="4959933">.</span><span class="ident" id="4959934">Rect</span><span class="op" id="4959938">.</span><span class="ident" id="4959939">Min</span><span class="op" id="4959942">.</span><span class="ident" id="4959943">Y</span><span class="op" id="4959944">;</span>&nbsp;<span class="ident" id="4959946">y</span>&nbsp;<span class="op" id="4959948">&lt;</span>&nbsp;<span class="ident" id="4959950">p</span><span class="op" id="4959951">.</span><span class="ident" id="4959952">Rect</span><span class="op" id="4959956">.</span><span class="ident" id="4959957">Max</span><span class="op" id="4959960">.</span><span class="ident" id="4959961">Y</span><span class="op" id="4959962">;</span>&nbsp;<span class="ident" id="4959964">y</span><span class="op" id="4959965">++</span>&nbsp;<span class="op" id="4959968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959972">for</span>&nbsp;<span class="ident" id="4959976">i</span>&nbsp;<span class="op" id="4959978">:=</span>&nbsp;<span class="ident" id="4959981">i0</span><span class="op" id="4959983">;</span>&nbsp;<span class="ident" id="4959985">i</span>&nbsp;<span class="op" id="4959987">&lt;</span>&nbsp;<span class="ident" id="4959989">i1</span><span class="op" id="4959991">;</span>&nbsp;<span class="ident" id="4959993">i</span>&nbsp;<span class="op" id="4959995">+=</span>&nbsp;<span class="num" id="4959998">4</span>&nbsp;<span class="op" id="4960000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960005">if</span>&nbsp;<span class="ident" id="4960008">p</span><span class="op" id="4960009">.</span><span class="ident" id="4960010">Pix</span><span class="op" id="4960013">[</span><span class="ident" id="4960014">i</span><span class="op" id="4960015">]</span>&nbsp;<span class="op" id="4960017">!=</span>&nbsp;<span class="num" id="4960020">0xff</span>&nbsp;<span class="op" id="4960025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960031">return</span>&nbsp;<span class="builtintype" id="4960038">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960047">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960055">i0</span>&nbsp;<span class="op" id="4960058">+=</span>&nbsp;<span class="ident" id="4960061">p</span><span class="op" id="4960062">.</span><span class="ident" id="4960063">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960072">i1</span>&nbsp;<span class="op" id="4960075">+=</span>&nbsp;<span class="ident" id="4960078">p</span><span class="op" id="4960079">.</span><span class="ident" id="4960080">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960091">return</span>&nbsp;<span class="builtintype" id="4960098">true</span><br>
<span class="lineno">360</span><span class="op" id="4960103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4960106">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4960161">func</span>&nbsp;<span class="ident" id="4960166">NewNRGBA</span><span class="op" id="4960174">(</span><span class="ident" id="4960175">r</span>&nbsp;<span class="ident" id="4960177">Rectangle</span><span class="op" id="4960186">)</span>&nbsp;<span class="op" id="4960188">*</span><span class="ident" id="4960189">NRGBA</span>&nbsp;<span class="op" id="4960195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960198">w</span><span class="op" id="4960199">,</span>&nbsp;<span class="ident" id="4960201">h</span>&nbsp;<span class="op" id="4960203">:=</span>&nbsp;<span class="ident" id="4960206">r</span><span class="op" id="4960207">.</span><span class="ident" id="4960208">Dx</span><span class="op" id="4960210">(</span><span class="op" id="4960211">)</span><span class="op" id="4960212">,</span>&nbsp;<span class="ident" id="4960214">r</span><span class="op" id="4960215">.</span><span class="ident" id="4960216">Dy</span><span class="op" id="4960218">(</span><span class="op" id="4960219">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960222">pix</span>&nbsp;<span class="op" id="4960226">:=</span>&nbsp;<span class="builtinfunc" id="4960229">make</span><span class="op" id="4960233">(</span><span class="op" id="4960234">[</span><span class="op" id="4960235">]</span><span class="builtintype" id="4960236">uint8</span><span class="op" id="4960241">,</span>&nbsp;<span class="num" id="4960243">4</span><span class="op" id="4960244">*</span><span class="ident" id="4960245">w</span><span class="op" id="4960246">*</span><span class="ident" id="4960247">h</span><span class="op" id="4960248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960251">return</span>&nbsp;<span class="op" id="4960258">&amp;</span><span class="ident" id="4960259">NRGBA</span><span class="op" id="4960264">{</span><span class="ident" id="4960265">pix</span><span class="op" id="4960268">,</span>&nbsp;<span class="num" id="4960270">4</span>&nbsp;<span class="op" id="4960272">*</span>&nbsp;<span class="ident" id="4960274">w</span><span class="op" id="4960275">,</span>&nbsp;<span class="ident" id="4960277">r</span><span class="op" id="4960278">}</span><br>
<span class="lineno"></span><span class="op" id="4960280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4960283">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="4960362">type</span>&nbsp;<span class="ident" id="4960367">NRGBA64</span>&nbsp;<span class="keyword" id="4960375">struct</span>&nbsp;<span class="op" id="4960382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960385">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960475">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960543">Pix</span>&nbsp;<span class="op" id="4960547">[</span><span class="op" id="4960548">]</span><span class="builtintype" id="4960549">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960556">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960632">Stride</span>&nbsp;<span class="builtintype" id="4960639">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960644">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960676">Rect</span>&nbsp;<span class="ident" id="4960681">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4960691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4960694">func</span>&nbsp;<span class="op" id="4960699">(</span><span class="ident" id="4960700">p</span>&nbsp;<span class="op" id="4960702">*</span><span class="ident" id="4960703">NRGBA64</span><span class="op" id="4960710">)</span>&nbsp;<span class="ident" id="4960712">ColorModel</span><span class="op" id="4960722">(</span><span class="op" id="4960723">)</span>&nbsp;<span class="ident" id="4960725">color</span><span class="op" id="4960730">.</span><span class="ident" id="4960731">Model</span>&nbsp;<span class="op" id="4960737">{</span>&nbsp;<span class="keyword" id="4960739">return</span>&nbsp;<span class="ident" id="4960746">color</span><span class="op" id="4960751">.</span><span class="ident" id="4960752">NRGBA64Model</span>&nbsp;<span class="op" id="4960765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4960768">func</span>&nbsp;<span class="op" id="4960773">(</span><span class="ident" id="4960774">p</span>&nbsp;<span class="op" id="4960776">*</span><span class="ident" id="4960777">NRGBA64</span><span class="op" id="4960784">)</span>&nbsp;<span class="ident" id="4960786">Bounds</span><span class="op" id="4960792">(</span><span class="op" id="4960793">)</span>&nbsp;<span class="ident" id="4960795">Rectangle</span>&nbsp;<span class="op" id="4960805">{</span>&nbsp;<span class="keyword" id="4960807">return</span>&nbsp;<span class="ident" id="4960814">p</span><span class="op" id="4960815">.</span><span class="ident" id="4960816">Rect</span>&nbsp;<span class="op" id="4960821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4960824">func</span>&nbsp;<span class="op" id="4960829">(</span><span class="ident" id="4960830">p</span>&nbsp;<span class="op" id="4960832">*</span><span class="ident" id="4960833">NRGBA64</span><span class="op" id="4960840">)</span>&nbsp;<span class="ident" id="4960842">At</span><span class="op" id="4960844">(</span><span class="ident" id="4960845">x</span><span class="op" id="4960846">,</span>&nbsp;<span class="ident" id="4960848">y</span>&nbsp;<span class="builtintype" id="4960850">int</span><span class="op" id="4960853">)</span>&nbsp;<span class="ident" id="4960855">color</span><span class="op" id="4960860">.</span><span class="ident" id="4960861">Color</span>&nbsp;<span class="op" id="4960867">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960870">return</span>&nbsp;<span class="ident" id="4960877">p</span><span class="op" id="4960878">.</span><span class="ident" id="4960879">NRGBA64At</span><span class="op" id="4960888">(</span><span class="ident" id="4960889">x</span><span class="op" id="4960890">,</span>&nbsp;<span class="ident" id="4960892">y</span><span class="op" id="4960893">)</span><br>
<span class="lineno"></span><span class="op" id="4960895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4960898">func</span>&nbsp;<span class="op" id="4960903">(</span><span class="ident" id="4960904">p</span>&nbsp;<span class="op" id="4960906">*</span><span class="ident" id="4960907">NRGBA64</span><span class="op" id="4960914">)</span>&nbsp;<span class="ident" id="4960916">NRGBA64At</span><span class="op" id="4960925">(</span><span class="ident" id="4960926">x</span><span class="op" id="4960927">,</span>&nbsp;<span class="ident" id="4960929">y</span>&nbsp;<span class="builtintype" id="4960931">int</span><span class="op" id="4960934">)</span>&nbsp;<span class="ident" id="4960936">color</span><span class="op" id="4960941">.</span><span class="ident" id="4960942">NRGBA64</span>&nbsp;<span class="op" id="4960950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960953">if</span>&nbsp;<span class="op" id="4960956">!</span><span class="op" id="4960957">(</span><span class="ident" id="4960958">Point</span><span class="op" id="4960963">{</span><span class="ident" id="4960964">x</span><span class="op" id="4960965">,</span>&nbsp;<span class="ident" id="4960967">y</span><span class="op" id="4960968">}</span><span class="op" id="4960969">.</span><span class="ident" id="4960970">In</span><span class="op" id="4960972">(</span><span class="ident" id="4960973">p</span><span class="op" id="4960974">.</span><span class="ident" id="4960975">Rect</span><span class="op" id="4960979">)</span><span class="op" id="4960980">)</span>&nbsp;<span class="op" id="4960982">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960986">return</span>&nbsp;<span class="ident" id="4960993">color</span><span class="op" id="4960998">.</span><span class="ident" id="4960999">NRGBA64</span><span class="op" id="4961006">{</span><span class="op" id="4961007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961013">i</span>&nbsp;<span class="op" id="4961015">:=</span>&nbsp;<span class="ident" id="4961018">p</span><span class="op" id="4961019">.</span><span class="ident" id="4961020">PixOffset</span><span class="op" id="4961029">(</span><span class="ident" id="4961030">x</span><span class="op" id="4961031">,</span>&nbsp;<span class="ident" id="4961033">y</span><span class="op" id="4961034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961037">return</span>&nbsp;<span class="ident" id="4961044">color</span><span class="op" id="4961049">.</span><span class="ident" id="4961050">NRGBA64</span><span class="op" id="4961057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4961061">uint16</span><span class="op" id="4961067">(</span><span class="ident" id="4961068">p</span><span class="op" id="4961069">.</span><span class="ident" id="4961070">Pix</span><span class="op" id="4961073">[</span><span class="ident" id="4961074">i</span><span class="op" id="4961075">+</span><span class="num" id="4961076">0</span><span class="op" id="4961077">]</span><span class="op" id="4961078">)</span><span class="op" id="4961079">&lt;&lt;</span><span class="num" id="4961081">8</span>&nbsp;<span class="op" id="4961083">|</span>&nbsp;<span class="builtintype" id="4961085">uint16</span><span class="op" id="4961091">(</span><span class="ident" id="4961092">p</span><span class="op" id="4961093">.</span><span class="ident" id="4961094">Pix</span><span class="op" id="4961097">[</span><span class="ident" id="4961098">i</span><span class="op" id="4961099">+</span><span class="num" id="4961100">1</span><span class="op" id="4961101">]</span><span class="op" id="4961102">)</span><span class="op" id="4961103">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4961107">uint16</span><span class="op" id="4961113">(</span><span class="ident" id="4961114">p</span><span class="op" id="4961115">.</span><span class="ident" id="4961116">Pix</span><span class="op" id="4961119">[</span><span class="ident" id="4961120">i</span><span class="op" id="4961121">+</span><span class="num" id="4961122">2</span><span class="op" id="4961123">]</span><span class="op" id="4961124">)</span><span class="op" id="4961125">&lt;&lt;</span><span class="num" id="4961127">8</span>&nbsp;<span class="op" id="4961129">|</span>&nbsp;<span class="builtintype" id="4961131">uint16</span><span class="op" id="4961137">(</span><span class="ident" id="4961138">p</span><span class="op" id="4961139">.</span><span class="ident" id="4961140">Pix</span><span class="op" id="4961143">[</span><span class="ident" id="4961144">i</span><span class="op" id="4961145">+</span><span class="num" id="4961146">3</span><span class="op" id="4961147">]</span><span class="op" id="4961148">)</span><span class="op" id="4961149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4961153">uint16</span><span class="op" id="4961159">(</span><span class="ident" id="4961160">p</span><span class="op" id="4961161">.</span><span class="ident" id="4961162">Pix</span><span class="op" id="4961165">[</span><span class="ident" id="4961166">i</span><span class="op" id="4961167">+</span><span class="num" id="4961168">4</span><span class="op" id="4961169">]</span><span class="op" id="4961170">)</span><span class="op" id="4961171">&lt;&lt;</span><span class="num" id="4961173">8</span>&nbsp;<span class="op" id="4961175">|</span>&nbsp;<span class="builtintype" id="4961177">uint16</span><span class="op" id="4961183">(</span><span class="ident" id="4961184">p</span><span class="op" id="4961185">.</span><span class="ident" id="4961186">Pix</span><span class="op" id="4961189">[</span><span class="ident" id="4961190">i</span><span class="op" id="4961191">+</span><span class="num" id="4961192">5</span><span class="op" id="4961193">]</span><span class="op" id="4961194">)</span><span class="op" id="4961195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4961199">uint16</span><span class="op" id="4961205">(</span><span class="ident" id="4961206">p</span><span class="op" id="4961207">.</span><span class="ident" id="4961208">Pix</span><span class="op" id="4961211">[</span><span class="ident" id="4961212">i</span><span class="op" id="4961213">+</span><span class="num" id="4961214">6</span><span class="op" id="4961215">]</span><span class="op" id="4961216">)</span><span class="op" id="4961217">&lt;&lt;</span><span class="num" id="4961219">8</span>&nbsp;<span class="op" id="4961221">|</span>&nbsp;<span class="builtintype" id="4961223">uint16</span><span class="op" id="4961229">(</span><span class="ident" id="4961230">p</span><span class="op" id="4961231">.</span><span class="ident" id="4961232">Pix</span><span class="op" id="4961235">[</span><span class="ident" id="4961236">i</span><span class="op" id="4961237">+</span><span class="num" id="4961238">7</span><span class="op" id="4961239">]</span><span class="op" id="4961240">)</span><span class="op" id="4961241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961244">}</span><br>
<span class="lineno"></span><span class="op" id="4961246">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="4961249">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4961328">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4961352">func</span>&nbsp;<span class="op" id="4961357">(</span><span class="ident" id="4961358">p</span>&nbsp;<span class="op" id="4961360">*</span><span class="ident" id="4961361">NRGBA64</span><span class="op" id="4961368">)</span>&nbsp;<span class="ident" id="4961370">PixOffset</span><span class="op" id="4961379">(</span><span class="ident" id="4961380">x</span><span class="op" id="4961381">,</span>&nbsp;<span class="ident" id="4961383">y</span>&nbsp;<span class="builtintype" id="4961385">int</span><span class="op" id="4961388">)</span>&nbsp;<span class="builtintype" id="4961390">int</span>&nbsp;<span class="op" id="4961394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961397">return</span>&nbsp;<span class="op" id="4961404">(</span><span class="ident" id="4961405">y</span><span class="op" id="4961406">-</span><span class="ident" id="4961407">p</span><span class="op" id="4961408">.</span><span class="ident" id="4961409">Rect</span><span class="op" id="4961413">.</span><span class="ident" id="4961414">Min</span><span class="op" id="4961417">.</span><span class="ident" id="4961418">Y</span><span class="op" id="4961419">)</span><span class="op" id="4961420">*</span><span class="ident" id="4961421">p</span><span class="op" id="4961422">.</span><span class="ident" id="4961423">Stride</span>&nbsp;<span class="op" id="4961430">+</span>&nbsp;<span class="op" id="4961432">(</span><span class="ident" id="4961433">x</span><span class="op" id="4961434">-</span><span class="ident" id="4961435">p</span><span class="op" id="4961436">.</span><span class="ident" id="4961437">Rect</span><span class="op" id="4961441">.</span><span class="ident" id="4961442">Min</span><span class="op" id="4961445">.</span><span class="ident" id="4961446">X</span><span class="op" id="4961447">)</span><span class="op" id="4961448">*</span><span class="num" id="4961449">8</span><br>
<span class="lineno">405</span><span class="op" id="4961451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4961454">func</span>&nbsp;<span class="op" id="4961459">(</span><span class="ident" id="4961460">p</span>&nbsp;<span class="op" id="4961462">*</span><span class="ident" id="4961463">NRGBA64</span><span class="op" id="4961470">)</span>&nbsp;<span class="ident" id="4961472">Set</span><span class="op" id="4961475">(</span><span class="ident" id="4961476">x</span><span class="op" id="4961477">,</span>&nbsp;<span class="ident" id="4961479">y</span>&nbsp;<span class="builtintype" id="4961481">int</span><span class="op" id="4961484">,</span>&nbsp;<span class="ident" id="4961486">c</span>&nbsp;<span class="ident" id="4961488">color</span><span class="op" id="4961493">.</span><span class="ident" id="4961494">Color</span><span class="op" id="4961499">)</span>&nbsp;<span class="op" id="4961501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961504">if</span>&nbsp;<span class="op" id="4961507">!</span><span class="op" id="4961508">(</span><span class="ident" id="4961509">Point</span><span class="op" id="4961514">{</span><span class="ident" id="4961515">x</span><span class="op" id="4961516">,</span>&nbsp;<span class="ident" id="4961518">y</span><span class="op" id="4961519">}</span><span class="op" id="4961520">.</span><span class="ident" id="4961521">In</span><span class="op" id="4961523">(</span><span class="ident" id="4961524">p</span><span class="op" id="4961525">.</span><span class="ident" id="4961526">Rect</span><span class="op" id="4961530">)</span><span class="op" id="4961531">)</span>&nbsp;<span class="op" id="4961533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961537">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961548">i</span>&nbsp;<span class="op" id="4961550">:=</span>&nbsp;<span class="ident" id="4961553">p</span><span class="op" id="4961554">.</span><span class="ident" id="4961555">PixOffset</span><span class="op" id="4961564">(</span><span class="ident" id="4961565">x</span><span class="op" id="4961566">,</span>&nbsp;<span class="ident" id="4961568">y</span><span class="op" id="4961569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961572">c1</span>&nbsp;<span class="op" id="4961575">:=</span>&nbsp;<span class="ident" id="4961578">color</span><span class="op" id="4961583">.</span><span class="ident" id="4961584">NRGBA64Model</span><span class="op" id="4961596">.</span><span class="ident" id="4961597">Convert</span><span class="op" id="4961604">(</span><span class="ident" id="4961605">c</span><span class="op" id="4961606">)</span><span class="op" id="4961607">.</span><span class="op" id="4961608">(</span><span class="ident" id="4961609">color</span><span class="op" id="4961614">.</span><span class="ident" id="4961615">NRGBA64</span><span class="op" id="4961622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961625">p</span><span class="op" id="4961626">.</span><span class="ident" id="4961627">Pix</span><span class="op" id="4961630">[</span><span class="ident" id="4961631">i</span><span class="op" id="4961632">+</span><span class="num" id="4961633">0</span><span class="op" id="4961634">]</span>&nbsp;<span class="op" id="4961636">=</span>&nbsp;<span class="builtintype" id="4961638">uint8</span><span class="op" id="4961643">(</span><span class="ident" id="4961644">c1</span><span class="op" id="4961646">.</span><span class="ident" id="4961647">R</span>&nbsp;<span class="op" id="4961649">&gt;&gt;</span>&nbsp;<span class="num" id="4961652">8</span><span class="op" id="4961653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961656">p</span><span class="op" id="4961657">.</span><span class="ident" id="4961658">Pix</span><span class="op" id="4961661">[</span><span class="ident" id="4961662">i</span><span class="op" id="4961663">+</span><span class="num" id="4961664">1</span><span class="op" id="4961665">]</span>&nbsp;<span class="op" id="4961667">=</span>&nbsp;<span class="builtintype" id="4961669">uint8</span><span class="op" id="4961674">(</span><span class="ident" id="4961675">c1</span><span class="op" id="4961677">.</span><span class="ident" id="4961678">R</span><span class="op" id="4961679">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961682">p</span><span class="op" id="4961683">.</span><span class="ident" id="4961684">Pix</span><span class="op" id="4961687">[</span><span class="ident" id="4961688">i</span><span class="op" id="4961689">+</span><span class="num" id="4961690">2</span><span class="op" id="4961691">]</span>&nbsp;<span class="op" id="4961693">=</span>&nbsp;<span class="builtintype" id="4961695">uint8</span><span class="op" id="4961700">(</span><span class="ident" id="4961701">c1</span><span class="op" id="4961703">.</span><span class="ident" id="4961704">G</span>&nbsp;<span class="op" id="4961706">&gt;&gt;</span>&nbsp;<span class="num" id="4961709">8</span><span class="op" id="4961710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961713">p</span><span class="op" id="4961714">.</span><span class="ident" id="4961715">Pix</span><span class="op" id="4961718">[</span><span class="ident" id="4961719">i</span><span class="op" id="4961720">+</span><span class="num" id="4961721">3</span><span class="op" id="4961722">]</span>&nbsp;<span class="op" id="4961724">=</span>&nbsp;<span class="builtintype" id="4961726">uint8</span><span class="op" id="4961731">(</span><span class="ident" id="4961732">c1</span><span class="op" id="4961734">.</span><span class="ident" id="4961735">G</span><span class="op" id="4961736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961739">p</span><span class="op" id="4961740">.</span><span class="ident" id="4961741">Pix</span><span class="op" id="4961744">[</span><span class="ident" id="4961745">i</span><span class="op" id="4961746">+</span><span class="num" id="4961747">4</span><span class="op" id="4961748">]</span>&nbsp;<span class="op" id="4961750">=</span>&nbsp;<span class="builtintype" id="4961752">uint8</span><span class="op" id="4961757">(</span><span class="ident" id="4961758">c1</span><span class="op" id="4961760">.</span><span class="ident" id="4961761">B</span>&nbsp;<span class="op" id="4961763">&gt;&gt;</span>&nbsp;<span class="num" id="4961766">8</span><span class="op" id="4961767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961770">p</span><span class="op" id="4961771">.</span><span class="ident" id="4961772">Pix</span><span class="op" id="4961775">[</span><span class="ident" id="4961776">i</span><span class="op" id="4961777">+</span><span class="num" id="4961778">5</span><span class="op" id="4961779">]</span>&nbsp;<span class="op" id="4961781">=</span>&nbsp;<span class="builtintype" id="4961783">uint8</span><span class="op" id="4961788">(</span><span class="ident" id="4961789">c1</span><span class="op" id="4961791">.</span><span class="ident" id="4961792">B</span><span class="op" id="4961793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961796">p</span><span class="op" id="4961797">.</span><span class="ident" id="4961798">Pix</span><span class="op" id="4961801">[</span><span class="ident" id="4961802">i</span><span class="op" id="4961803">+</span><span class="num" id="4961804">6</span><span class="op" id="4961805">]</span>&nbsp;<span class="op" id="4961807">=</span>&nbsp;<span class="builtintype" id="4961809">uint8</span><span class="op" id="4961814">(</span><span class="ident" id="4961815">c1</span><span class="op" id="4961817">.</span><span class="ident" id="4961818">A</span>&nbsp;<span class="op" id="4961820">&gt;&gt;</span>&nbsp;<span class="num" id="4961823">8</span><span class="op" id="4961824">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961827">p</span><span class="op" id="4961828">.</span><span class="ident" id="4961829">Pix</span><span class="op" id="4961832">[</span><span class="ident" id="4961833">i</span><span class="op" id="4961834">+</span><span class="num" id="4961835">7</span><span class="op" id="4961836">]</span>&nbsp;<span class="op" id="4961838">=</span>&nbsp;<span class="builtintype" id="4961840">uint8</span><span class="op" id="4961845">(</span><span class="ident" id="4961846">c1</span><span class="op" id="4961848">.</span><span class="ident" id="4961849">A</span><span class="op" id="4961850">)</span><br>
<span class="lineno"></span><span class="op" id="4961852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4961855">func</span>&nbsp;<span class="op" id="4961860">(</span><span class="ident" id="4961861">p</span>&nbsp;<span class="op" id="4961863">*</span><span class="ident" id="4961864">NRGBA64</span><span class="op" id="4961871">)</span>&nbsp;<span class="ident" id="4961873">SetNRGBA64</span><span class="op" id="4961883">(</span><span class="ident" id="4961884">x</span><span class="op" id="4961885">,</span>&nbsp;<span class="ident" id="4961887">y</span>&nbsp;<span class="builtintype" id="4961889">int</span><span class="op" id="4961892">,</span>&nbsp;<span class="ident" id="4961894">c</span>&nbsp;<span class="ident" id="4961896">color</span><span class="op" id="4961901">.</span><span class="ident" id="4961902">NRGBA64</span><span class="op" id="4961909">)</span>&nbsp;<span class="op" id="4961911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961914">if</span>&nbsp;<span class="op" id="4961917">!</span><span class="op" id="4961918">(</span><span class="ident" id="4961919">Point</span><span class="op" id="4961924">{</span><span class="ident" id="4961925">x</span><span class="op" id="4961926">,</span>&nbsp;<span class="ident" id="4961928">y</span><span class="op" id="4961929">}</span><span class="op" id="4961930">.</span><span class="ident" id="4961931">In</span><span class="op" id="4961933">(</span><span class="ident" id="4961934">p</span><span class="op" id="4961935">.</span><span class="ident" id="4961936">Rect</span><span class="op" id="4961940">)</span><span class="op" id="4961941">)</span>&nbsp;<span class="op" id="4961943">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961947">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961958">i</span>&nbsp;<span class="op" id="4961960">:=</span>&nbsp;<span class="ident" id="4961963">p</span><span class="op" id="4961964">.</span><span class="ident" id="4961965">PixOffset</span><span class="op" id="4961974">(</span><span class="ident" id="4961975">x</span><span class="op" id="4961976">,</span>&nbsp;<span class="ident" id="4961978">y</span><span class="op" id="4961979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961982">p</span><span class="op" id="4961983">.</span><span class="ident" id="4961984">Pix</span><span class="op" id="4961987">[</span><span class="ident" id="4961988">i</span><span class="op" id="4961989">+</span><span class="num" id="4961990">0</span><span class="op" id="4961991">]</span>&nbsp;<span class="op" id="4961993">=</span>&nbsp;<span class="builtintype" id="4961995">uint8</span><span class="op" id="4962000">(</span><span class="ident" id="4962001">c</span><span class="op" id="4962002">.</span><span class="ident" id="4962003">R</span>&nbsp;<span class="op" id="4962005">&gt;&gt;</span>&nbsp;<span class="num" id="4962008">8</span><span class="op" id="4962009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962012">p</span><span class="op" id="4962013">.</span><span class="ident" id="4962014">Pix</span><span class="op" id="4962017">[</span><span class="ident" id="4962018">i</span><span class="op" id="4962019">+</span><span class="num" id="4962020">1</span><span class="op" id="4962021">]</span>&nbsp;<span class="op" id="4962023">=</span>&nbsp;<span class="builtintype" id="4962025">uint8</span><span class="op" id="4962030">(</span><span class="ident" id="4962031">c</span><span class="op" id="4962032">.</span><span class="ident" id="4962033">R</span><span class="op" id="4962034">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962037">p</span><span class="op" id="4962038">.</span><span class="ident" id="4962039">Pix</span><span class="op" id="4962042">[</span><span class="ident" id="4962043">i</span><span class="op" id="4962044">+</span><span class="num" id="4962045">2</span><span class="op" id="4962046">]</span>&nbsp;<span class="op" id="4962048">=</span>&nbsp;<span class="builtintype" id="4962050">uint8</span><span class="op" id="4962055">(</span><span class="ident" id="4962056">c</span><span class="op" id="4962057">.</span><span class="ident" id="4962058">G</span>&nbsp;<span class="op" id="4962060">&gt;&gt;</span>&nbsp;<span class="num" id="4962063">8</span><span class="op" id="4962064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962067">p</span><span class="op" id="4962068">.</span><span class="ident" id="4962069">Pix</span><span class="op" id="4962072">[</span><span class="ident" id="4962073">i</span><span class="op" id="4962074">+</span><span class="num" id="4962075">3</span><span class="op" id="4962076">]</span>&nbsp;<span class="op" id="4962078">=</span>&nbsp;<span class="builtintype" id="4962080">uint8</span><span class="op" id="4962085">(</span><span class="ident" id="4962086">c</span><span class="op" id="4962087">.</span><span class="ident" id="4962088">G</span><span class="op" id="4962089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962092">p</span><span class="op" id="4962093">.</span><span class="ident" id="4962094">Pix</span><span class="op" id="4962097">[</span><span class="ident" id="4962098">i</span><span class="op" id="4962099">+</span><span class="num" id="4962100">4</span><span class="op" id="4962101">]</span>&nbsp;<span class="op" id="4962103">=</span>&nbsp;<span class="builtintype" id="4962105">uint8</span><span class="op" id="4962110">(</span><span class="ident" id="4962111">c</span><span class="op" id="4962112">.</span><span class="ident" id="4962113">B</span>&nbsp;<span class="op" id="4962115">&gt;&gt;</span>&nbsp;<span class="num" id="4962118">8</span><span class="op" id="4962119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962122">p</span><span class="op" id="4962123">.</span><span class="ident" id="4962124">Pix</span><span class="op" id="4962127">[</span><span class="ident" id="4962128">i</span><span class="op" id="4962129">+</span><span class="num" id="4962130">5</span><span class="op" id="4962131">]</span>&nbsp;<span class="op" id="4962133">=</span>&nbsp;<span class="builtintype" id="4962135">uint8</span><span class="op" id="4962140">(</span><span class="ident" id="4962141">c</span><span class="op" id="4962142">.</span><span class="ident" id="4962143">B</span><span class="op" id="4962144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962147">p</span><span class="op" id="4962148">.</span><span class="ident" id="4962149">Pix</span><span class="op" id="4962152">[</span><span class="ident" id="4962153">i</span><span class="op" id="4962154">+</span><span class="num" id="4962155">6</span><span class="op" id="4962156">]</span>&nbsp;<span class="op" id="4962158">=</span>&nbsp;<span class="builtintype" id="4962160">uint8</span><span class="op" id="4962165">(</span><span class="ident" id="4962166">c</span><span class="op" id="4962167">.</span><span class="ident" id="4962168">A</span>&nbsp;<span class="op" id="4962170">&gt;&gt;</span>&nbsp;<span class="num" id="4962173">8</span><span class="op" id="4962174">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962177">p</span><span class="op" id="4962178">.</span><span class="ident" id="4962179">Pix</span><span class="op" id="4962182">[</span><span class="ident" id="4962183">i</span><span class="op" id="4962184">+</span><span class="num" id="4962185">7</span><span class="op" id="4962186">]</span>&nbsp;<span class="op" id="4962188">=</span>&nbsp;<span class="builtintype" id="4962190">uint8</span><span class="op" id="4962195">(</span><span class="ident" id="4962196">c</span><span class="op" id="4962197">.</span><span class="ident" id="4962198">A</span><span class="op" id="4962199">)</span><br>
<span class="lineno"></span><span class="op" id="4962201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4962204">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4962281">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="4962353">func</span>&nbsp;<span class="op" id="4962358">(</span><span class="ident" id="4962359">p</span>&nbsp;<span class="op" id="4962361">*</span><span class="ident" id="4962362">NRGBA64</span><span class="op" id="4962369">)</span>&nbsp;<span class="ident" id="4962371">SubImage</span><span class="op" id="4962379">(</span><span class="ident" id="4962380">r</span>&nbsp;<span class="ident" id="4962382">Rectangle</span><span class="op" id="4962391">)</span>&nbsp;<span class="ident" id="4962393">Image</span>&nbsp;<span class="op" id="4962399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962402">r</span>&nbsp;<span class="op" id="4962404">=</span>&nbsp;<span class="ident" id="4962406">r</span><span class="op" id="4962407">.</span><span class="ident" id="4962408">Intersect</span><span class="op" id="4962417">(</span><span class="ident" id="4962418">p</span><span class="op" id="4962419">.</span><span class="ident" id="4962420">Rect</span><span class="op" id="4962424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962427">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962508">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962590">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962640">if</span>&nbsp;<span class="ident" id="4962643">r</span><span class="op" id="4962644">.</span><span class="ident" id="4962645">Empty</span><span class="op" id="4962650">(</span><span class="op" id="4962651">)</span>&nbsp;<span class="op" id="4962653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962657">return</span>&nbsp;<span class="op" id="4962664">&amp;</span><span class="ident" id="4962665">NRGBA64</span><span class="op" id="4962672">{</span><span class="op" id="4962673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962679">i</span>&nbsp;<span class="op" id="4962681">:=</span>&nbsp;<span class="ident" id="4962684">p</span><span class="op" id="4962685">.</span><span class="ident" id="4962686">PixOffset</span><span class="op" id="4962695">(</span><span class="ident" id="4962696">r</span><span class="op" id="4962697">.</span><span class="ident" id="4962698">Min</span><span class="op" id="4962701">.</span><span class="ident" id="4962702">X</span><span class="op" id="4962703">,</span>&nbsp;<span class="ident" id="4962705">r</span><span class="op" id="4962706">.</span><span class="ident" id="4962707">Min</span><span class="op" id="4962710">.</span><span class="ident" id="4962711">Y</span><span class="op" id="4962712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962715">return</span>&nbsp;<span class="op" id="4962722">&amp;</span><span class="ident" id="4962723">NRGBA64</span><span class="op" id="4962730">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962734">Pix</span><span class="op" id="4962737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962742">p</span><span class="op" id="4962743">.</span><span class="ident" id="4962744">Pix</span><span class="op" id="4962747">[</span><span class="ident" id="4962748">i</span><span class="op" id="4962749">:</span><span class="op" id="4962750">]</span><span class="op" id="4962751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962755">Stride</span><span class="op" id="4962761">:</span>&nbsp;<span class="ident" id="4962763">p</span><span class="op" id="4962764">.</span><span class="ident" id="4962765">Stride</span><span class="op" id="4962771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962775">Rect</span><span class="op" id="4962779">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4962783">r</span><span class="op" id="4962784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962787">}</span><br>
<span class="lineno"></span><span class="op" id="4962789">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="4962792">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4962865">func</span>&nbsp;<span class="op" id="4962870">(</span><span class="ident" id="4962871">p</span>&nbsp;<span class="op" id="4962873">*</span><span class="ident" id="4962874">NRGBA64</span><span class="op" id="4962881">)</span>&nbsp;<span class="ident" id="4962883">Opaque</span><span class="op" id="4962889">(</span><span class="op" id="4962890">)</span>&nbsp;<span class="builtintype" id="4962892">bool</span>&nbsp;<span class="op" id="4962897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962900">if</span>&nbsp;<span class="ident" id="4962903">p</span><span class="op" id="4962904">.</span><span class="ident" id="4962905">Rect</span><span class="op" id="4962909">.</span><span class="ident" id="4962910">Empty</span><span class="op" id="4962915">(</span><span class="op" id="4962916">)</span>&nbsp;<span class="op" id="4962918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962922">return</span>&nbsp;<span class="builtintype" id="4962929">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962938">i0</span><span class="op" id="4962940">,</span>&nbsp;<span class="ident" id="4962942">i1</span>&nbsp;<span class="op" id="4962945">:=</span>&nbsp;<span class="num" id="4962948">6</span><span class="op" id="4962949">,</span>&nbsp;<span class="ident" id="4962951">p</span><span class="op" id="4962952">.</span><span class="ident" id="4962953">Rect</span><span class="op" id="4962957">.</span><span class="ident" id="4962958">Dx</span><span class="op" id="4962960">(</span><span class="op" id="4962961">)</span><span class="op" id="4962962">*</span><span class="num" id="4962963">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962966">for</span>&nbsp;<span class="ident" id="4962970">y</span>&nbsp;<span class="op" id="4962972">:=</span>&nbsp;<span class="ident" id="4962975">p</span><span class="op" id="4962976">.</span><span class="ident" id="4962977">Rect</span><span class="op" id="4962981">.</span><span class="ident" id="4962982">Min</span><span class="op" id="4962985">.</span><span class="ident" id="4962986">Y</span><span class="op" id="4962987">;</span>&nbsp;<span class="ident" id="4962989">y</span>&nbsp;<span class="op" id="4962991">&lt;</span>&nbsp;<span class="ident" id="4962993">p</span><span class="op" id="4962994">.</span><span class="ident" id="4962995">Rect</span><span class="op" id="4962999">.</span><span class="ident" id="4963000">Max</span><span class="op" id="4963003">.</span><span class="ident" id="4963004">Y</span><span class="op" id="4963005">;</span>&nbsp;<span class="ident" id="4963007">y</span><span class="op" id="4963008">++</span>&nbsp;<span class="op" id="4963011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963015">for</span>&nbsp;<span class="ident" id="4963019">i</span>&nbsp;<span class="op" id="4963021">:=</span>&nbsp;<span class="ident" id="4963024">i0</span><span class="op" id="4963026">;</span>&nbsp;<span class="ident" id="4963028">i</span>&nbsp;<span class="op" id="4963030">&lt;</span>&nbsp;<span class="ident" id="4963032">i1</span><span class="op" id="4963034">;</span>&nbsp;<span class="ident" id="4963036">i</span>&nbsp;<span class="op" id="4963038">+=</span>&nbsp;<span class="num" id="4963041">8</span>&nbsp;<span class="op" id="4963043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963048">if</span>&nbsp;<span class="ident" id="4963051">p</span><span class="op" id="4963052">.</span><span class="ident" id="4963053">Pix</span><span class="op" id="4963056">[</span><span class="ident" id="4963057">i</span><span class="op" id="4963058">+</span><span class="num" id="4963059">0</span><span class="op" id="4963060">]</span>&nbsp;<span class="op" id="4963062">!=</span>&nbsp;<span class="num" id="4963065">0xff</span>&nbsp;<span class="op" id="4963070">||</span>&nbsp;<span class="ident" id="4963073">p</span><span class="op" id="4963074">.</span><span class="ident" id="4963075">Pix</span><span class="op" id="4963078">[</span><span class="ident" id="4963079">i</span><span class="op" id="4963080">+</span><span class="num" id="4963081">1</span><span class="op" id="4963082">]</span>&nbsp;<span class="op" id="4963084">!=</span>&nbsp;<span class="num" id="4963087">0xff</span>&nbsp;<span class="op" id="4963092">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963098">return</span>&nbsp;<span class="builtintype" id="4963105">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4963114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4963118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963122">i0</span>&nbsp;<span class="op" id="4963125">+=</span>&nbsp;<span class="ident" id="4963128">p</span><span class="op" id="4963129">.</span><span class="ident" id="4963130">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963139">i1</span>&nbsp;<span class="op" id="4963142">+=</span>&nbsp;<span class="ident" id="4963145">p</span><span class="op" id="4963146">.</span><span class="ident" id="4963147">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4963155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963158">return</span>&nbsp;<span class="builtintype" id="4963165">true</span><br>
<span class="lineno"></span><span class="op" id="4963170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4963173">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="4963232">func</span>&nbsp;<span class="ident" id="4963237">NewNRGBA64</span><span class="op" id="4963247">(</span><span class="ident" id="4963248">r</span>&nbsp;<span class="ident" id="4963250">Rectangle</span><span class="op" id="4963259">)</span>&nbsp;<span class="op" id="4963261">*</span><span class="ident" id="4963262">NRGBA64</span>&nbsp;<span class="op" id="4963270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963273">w</span><span class="op" id="4963274">,</span>&nbsp;<span class="ident" id="4963276">h</span>&nbsp;<span class="op" id="4963278">:=</span>&nbsp;<span class="ident" id="4963281">r</span><span class="op" id="4963282">.</span><span class="ident" id="4963283">Dx</span><span class="op" id="4963285">(</span><span class="op" id="4963286">)</span><span class="op" id="4963287">,</span>&nbsp;<span class="ident" id="4963289">r</span><span class="op" id="4963290">.</span><span class="ident" id="4963291">Dy</span><span class="op" id="4963293">(</span><span class="op" id="4963294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963297">pix</span>&nbsp;<span class="op" id="4963301">:=</span>&nbsp;<span class="builtinfunc" id="4963304">make</span><span class="op" id="4963308">(</span><span class="op" id="4963309">[</span><span class="op" id="4963310">]</span><span class="builtintype" id="4963311">uint8</span><span class="op" id="4963316">,</span>&nbsp;<span class="num" id="4963318">8</span><span class="op" id="4963319">*</span><span class="ident" id="4963320">w</span><span class="op" id="4963321">*</span><span class="ident" id="4963322">h</span><span class="op" id="4963323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963326">return</span>&nbsp;<span class="op" id="4963333">&amp;</span><span class="ident" id="4963334">NRGBA64</span><span class="op" id="4963341">{</span><span class="ident" id="4963342">pix</span><span class="op" id="4963345">,</span>&nbsp;<span class="num" id="4963347">8</span>&nbsp;<span class="op" id="4963349">*</span>&nbsp;<span class="ident" id="4963351">w</span><span class="op" id="4963352">,</span>&nbsp;<span class="ident" id="4963354">r</span><span class="op" id="4963355">}</span><br>
<span class="lineno"></span><span class="op" id="4963357">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4963360">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4963435">type</span>&nbsp;<span class="ident" id="4963440">Alpha</span>&nbsp;<span class="keyword" id="4963446">struct</span>&nbsp;<span class="op" id="4963453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4963456">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4963520">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963588">Pix</span>&nbsp;<span class="op" id="4963592">[</span><span class="op" id="4963593">]</span><span class="builtintype" id="4963594">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4963601">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963677">Stride</span>&nbsp;<span class="builtintype" id="4963684">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4963689">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963721">Rect</span>&nbsp;<span class="ident" id="4963726">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="4963736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4963739">func</span>&nbsp;<span class="op" id="4963744">(</span><span class="ident" id="4963745">p</span>&nbsp;<span class="op" id="4963747">*</span><span class="ident" id="4963748">Alpha</span><span class="op" id="4963753">)</span>&nbsp;<span class="ident" id="4963755">ColorModel</span><span class="op" id="4963765">(</span><span class="op" id="4963766">)</span>&nbsp;<span class="ident" id="4963768">color</span><span class="op" id="4963773">.</span><span class="ident" id="4963774">Model</span>&nbsp;<span class="op" id="4963780">{</span>&nbsp;<span class="keyword" id="4963782">return</span>&nbsp;<span class="ident" id="4963789">color</span><span class="op" id="4963794">.</span><span class="ident" id="4963795">AlphaModel</span>&nbsp;<span class="op" id="4963806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4963809">func</span>&nbsp;<span class="op" id="4963814">(</span><span class="ident" id="4963815">p</span>&nbsp;<span class="op" id="4963817">*</span><span class="ident" id="4963818">Alpha</span><span class="op" id="4963823">)</span>&nbsp;<span class="ident" id="4963825">Bounds</span><span class="op" id="4963831">(</span><span class="op" id="4963832">)</span>&nbsp;<span class="ident" id="4963834">Rectangle</span>&nbsp;<span class="op" id="4963844">{</span>&nbsp;<span class="keyword" id="4963846">return</span>&nbsp;<span class="ident" id="4963853">p</span><span class="op" id="4963854">.</span><span class="ident" id="4963855">Rect</span>&nbsp;<span class="op" id="4963860">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="4963863">func</span>&nbsp;<span class="op" id="4963868">(</span><span class="ident" id="4963869">p</span>&nbsp;<span class="op" id="4963871">*</span><span class="ident" id="4963872">Alpha</span><span class="op" id="4963877">)</span>&nbsp;<span class="ident" id="4963879">At</span><span class="op" id="4963881">(</span><span class="ident" id="4963882">x</span><span class="op" id="4963883">,</span>&nbsp;<span class="ident" id="4963885">y</span>&nbsp;<span class="builtintype" id="4963887">int</span><span class="op" id="4963890">)</span>&nbsp;<span class="ident" id="4963892">color</span><span class="op" id="4963897">.</span><span class="ident" id="4963898">Color</span>&nbsp;<span class="op" id="4963904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963907">return</span>&nbsp;<span class="ident" id="4963914">p</span><span class="op" id="4963915">.</span><span class="ident" id="4963916">AlphaAt</span><span class="op" id="4963923">(</span><span class="ident" id="4963924">x</span><span class="op" id="4963925">,</span>&nbsp;<span class="ident" id="4963927">y</span><span class="op" id="4963928">)</span><br>
<span class="lineno"></span><span class="op" id="4963930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4963933">func</span>&nbsp;<span class="op" id="4963938">(</span><span class="ident" id="4963939">p</span>&nbsp;<span class="op" id="4963941">*</span><span class="ident" id="4963942">Alpha</span><span class="op" id="4963947">)</span>&nbsp;<span class="ident" id="4963949">AlphaAt</span><span class="op" id="4963956">(</span><span class="ident" id="4963957">x</span><span class="op" id="4963958">,</span>&nbsp;<span class="ident" id="4963960">y</span>&nbsp;<span class="builtintype" id="4963962">int</span><span class="op" id="4963965">)</span>&nbsp;<span class="ident" id="4963967">color</span><span class="op" id="4963972">.</span><span class="ident" id="4963973">Alpha</span>&nbsp;<span class="op" id="4963979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963982">if</span>&nbsp;<span class="op" id="4963985">!</span><span class="op" id="4963986">(</span><span class="ident" id="4963987">Point</span><span class="op" id="4963992">{</span><span class="ident" id="4963993">x</span><span class="op" id="4963994">,</span>&nbsp;<span class="ident" id="4963996">y</span><span class="op" id="4963997">}</span><span class="op" id="4963998">.</span><span class="ident" id="4963999">In</span><span class="op" id="4964001">(</span><span class="ident" id="4964002">p</span><span class="op" id="4964003">.</span><span class="ident" id="4964004">Rect</span><span class="op" id="4964008">)</span><span class="op" id="4964009">)</span>&nbsp;<span class="op" id="4964011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964015">return</span>&nbsp;<span class="ident" id="4964022">color</span><span class="op" id="4964027">.</span><span class="ident" id="4964028">Alpha</span><span class="op" id="4964033">{</span><span class="op" id="4964034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4964040">i</span>&nbsp;<span class="op" id="4964042">:=</span>&nbsp;<span class="ident" id="4964045">p</span><span class="op" id="4964046">.</span><span class="ident" id="4964047">PixOffset</span><span class="op" id="4964056">(</span><span class="ident" id="4964057">x</span><span class="op" id="4964058">,</span>&nbsp;<span class="ident" id="4964060">y</span><span class="op" id="4964061">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964064">return</span>&nbsp;<span class="ident" id="4964071">color</span><span class="op" id="4964076">.</span><span class="ident" id="4964077">Alpha</span><span class="op" id="4964082">{</span><span class="ident" id="4964083">p</span><span class="op" id="4964084">.</span><span class="ident" id="4964085">Pix</span><span class="op" id="4964088">[</span><span class="ident" id="4964089">i</span><span class="op" id="4964090">]</span><span class="op" id="4964091">}</span><br>
<span class="lineno"></span><span class="op" id="4964093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4964096">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4964175">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="4964199">func</span>&nbsp;<span class="op" id="4964204">(</span><span class="ident" id="4964205">p</span>&nbsp;<span class="op" id="4964207">*</span><span class="ident" id="4964208">Alpha</span><span class="op" id="4964213">)</span>&nbsp;<span class="ident" id="4964215">PixOffset</span><span class="op" id="4964224">(</span><span class="ident" id="4964225">x</span><span class="op" id="4964226">,</span>&nbsp;<span class="ident" id="4964228">y</span>&nbsp;<span class="builtintype" id="4964230">int</span><span class="op" id="4964233">)</span>&nbsp;<span class="builtintype" id="4964235">int</span>&nbsp;<span class="op" id="4964239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964242">return</span>&nbsp;<span class="op" id="4964249">(</span><span class="ident" id="4964250">y</span><span class="op" id="4964251">-</span><span class="ident" id="4964252">p</span><span class="op" id="4964253">.</span><span class="ident" id="4964254">Rect</span><span class="op" id="4964258">.</span><span class="ident" id="4964259">Min</span><span class="op" id="4964262">.</span><span class="ident" id="4964263">Y</span><span class="op" id="4964264">)</span><span class="op" id="4964265">*</span><span class="ident" id="4964266">p</span><span class="op" id="4964267">.</span><span class="ident" id="4964268">Stride</span>&nbsp;<span class="op" id="4964275">+</span>&nbsp;<span class="op" id="4964277">(</span><span class="ident" id="4964278">x</span><span class="op" id="4964279">-</span><span class="ident" id="4964280">p</span><span class="op" id="4964281">.</span><span class="ident" id="4964282">Rect</span><span class="op" id="4964286">.</span><span class="ident" id="4964287">Min</span><span class="op" id="4964290">.</span><span class="ident" id="4964291">X</span><span class="op" id="4964292">)</span><span class="op" id="4964293">*</span><span class="num" id="4964294">1</span><br>
<span class="lineno"></span><span class="op" id="4964296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4964299">func</span>&nbsp;<span class="op" id="4964304">(</span><span class="ident" id="4964305">p</span>&nbsp;<span class="op" id="4964307">*</span><span class="ident" id="4964308">Alpha</span><span class="op" id="4964313">)</span>&nbsp;<span class="ident" id="4964315">Set</span><span class="op" id="4964318">(</span><span class="ident" id="4964319">x</span><span class="op" id="4964320">,</span>&nbsp;<span class="ident" id="4964322">y</span>&nbsp;<span class="builtintype" id="4964324">int</span><span class="op" id="4964327">,</span>&nbsp;<span class="ident" id="4964329">c</span>&nbsp;<span class="ident" id="4964331">color</span><span class="op" id="4964336">.</span><span class="ident" id="4964337">Color</span><span class="op" id="4964342">)</span>&nbsp;<span class="op" id="4964344">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964347">if</span>&nbsp;<span class="op" id="4964350">!</span><span class="op" id="4964351">(</span><span class="ident" id="4964352">Point</span><span class="op" id="4964357">{</span><span class="ident" id="4964358">x</span><span class="op" id="4964359">,</span>&nbsp;<span class="ident" id="4964361">y</span><span class="op" id="4964362">}</span><span class="op" id="4964363">.</span><span class="ident" id="4964364">In</span><span class="op" id="4964366">(</span><span class="ident" id="4964367">p</span><span class="op" id="4964368">.</span><span class="ident" id="4964369">Rect</span><span class="op" id="4964373">)</span><span class="op" id="4964374">)</span>&nbsp;<span class="op" id="4964376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964380">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4964391">i</span>&nbsp;<span class="op" id="4964393">:=</span>&nbsp;<span class="ident" id="4964396">p</span><span class="op" id="4964397">.</span><span class="ident" id="4964398">PixOffset</span><span class="op" id="4964407">(</span><span class="ident" id="4964408">x</span><span class="op" id="4964409">,</span>&nbsp;<span class="ident" id="4964411">y</span><span class="op" id="4964412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4964415">p</span><span class="op" id="4964416">.</span><span class="ident" id="4964417">Pix</span><span class="op" id="4964420">[</span><span class="ident" id="4964421">i</span><span class="op" id="4964422">]</span>&nbsp;<span class="op" id="4964424">=</span>&nbsp;<span class="ident" id="4964426">color</span><span class="op" id="4964431">.</span><span class="ident" id="4964432">AlphaModel</span><span class="op" id="4964442">.</span><span class="ident" id="4964443">Convert</span><span class="op" id="4964450">(</span><span class="ident" id="4964451">c</span><span class="op" id="4964452">)</span><span class="op" id="4964453">.</span><span class="op" id="4964454">(</span><span class="ident" id="4964455">color</span><span class="op" id="4964460">.</span><span class="ident" id="4964461">Alpha</span><span class="op" id="4964466">)</span><span class="op" id="4964467">.</span><span class="ident" id="4964468">A</span><br>
<span class="lineno">520</span><span class="op" id="4964470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4964473">func</span>&nbsp;<span class="op" id="4964478">(</span><span class="ident" id="4964479">p</span>&nbsp;<span class="op" id="4964481">*</span><span class="ident" id="4964482">Alpha</span><span class="op" id="4964487">)</span>&nbsp;<span class="ident" id="4964489">SetAlpha</span><span class="op" id="4964497">(</span><span class="ident" id="4964498">x</span><span class="op" id="4964499">,</span>&nbsp;<span class="ident" id="4964501">y</span>&nbsp;<span class="builtintype" id="4964503">int</span><span class="op" id="4964506">,</span>&nbsp;<span class="ident" id="4964508">c</span>&nbsp;<span class="ident" id="4964510">color</span><span class="op" id="4964515">.</span><span class="ident" id="4964516">Alpha</span><span class="op" id="4964521">)</span>&nbsp;<span class="op" id="4964523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964526">if</span>&nbsp;<span class="op" id="4964529">!</span><span class="op" id="4964530">(</span><span class="ident" id="4964531">Point</span><span class="op" id="4964536">{</span><span class="ident" id="4964537">x</span><span class="op" id="4964538">,</span>&nbsp;<span class="ident" id="4964540">y</span><span class="op" id="4964541">}</span><span class="op" id="4964542">.</span><span class="ident" id="4964543">In</span><span class="op" id="4964545">(</span><span class="ident" id="4964546">p</span><span class="op" id="4964547">.</span><span class="ident" id="4964548">Rect</span><span class="op" id="4964552">)</span><span class="op" id="4964553">)</span>&nbsp;<span class="op" id="4964555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4964559">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4964570">i</span>&nbsp;<span class="op" id="4964572">:=</span>&nbsp;<span class="ident" id="4964575">p</span><span class="op" id="4964576">.</span><span class="ident" id="4964577">PixOffset</span><span class="op" id="4964586">(</span><span class="ident" id="4964587">x</span><span class="op" id="4964588">,</span>&nbsp;<span class="ident" id="4964590">y</span><span class="op" id="4964591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4964594">p</span><span class="op" id="4964595">.</span><span class="ident" id="4964596">Pix</span><span class="op" id="4964599">[</span><span class="ident" id="4964600">i</span><span class="op" id="4964601">]</span>&nbsp;<span class="op" id="4964603">=</span>&nbsp;<span class="ident" id="4964605">c</span><span class="op" id="4964606">.</span><span class="ident" id="4964607">A</span><br>
<span class="lineno"></span><span class="op" id="4964609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4964612">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4964689">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4964761">func</span>&nbsp;<span class="op" id="4964766">(</span><span class="ident" id="4964767">p</span>&nbsp;<span class="op" id="4964769">*</span><span class="ident" id="4964770">Alpha</span><span class="op" id="4964775">)</span>&nbsp;<span class="ident" id="4964777">SubImage</span><span class="op" id="4964785">(</span><span class="ident" id="4964786">r</span>&nbsp;<span class="ident" id="4964788">Rectangle</span><span class="op" id="4964797">)</span>&nbsp;<span class="ident" id="4964799">Image</span>&nbsp;<span class="op" id="4964805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4964808">r</span>&nbsp;<span class="op" id="4964810">=</span>&nbsp;<span class="ident" id="4964812">r</span><span class="op" id="4964813">.</span><span class="ident" id="4964814">Intersect</span><span class="op" id="4964823">(</span><span class="ident" id="4964824">p</span><span class="op" id="4964825">.</span><span class="ident" id="4964826">Rect</span><span class="op" id="4964830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4964833">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4964914">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4964996">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965046">if</span>&nbsp;<span class="ident" id="4965049">r</span><span class="op" id="4965050">.</span><span class="ident" id="4965051">Empty</span><span class="op" id="4965056">(</span><span class="op" id="4965057">)</span>&nbsp;<span class="op" id="4965059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965063">return</span>&nbsp;<span class="op" id="4965070">&amp;</span><span class="ident" id="4965071">Alpha</span><span class="op" id="4965076">{</span><span class="op" id="4965077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965080">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965083">i</span>&nbsp;<span class="op" id="4965085">:=</span>&nbsp;<span class="ident" id="4965088">p</span><span class="op" id="4965089">.</span><span class="ident" id="4965090">PixOffset</span><span class="op" id="4965099">(</span><span class="ident" id="4965100">r</span><span class="op" id="4965101">.</span><span class="ident" id="4965102">Min</span><span class="op" id="4965105">.</span><span class="ident" id="4965106">X</span><span class="op" id="4965107">,</span>&nbsp;<span class="ident" id="4965109">r</span><span class="op" id="4965110">.</span><span class="ident" id="4965111">Min</span><span class="op" id="4965114">.</span><span class="ident" id="4965115">Y</span><span class="op" id="4965116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965119">return</span>&nbsp;<span class="op" id="4965126">&amp;</span><span class="ident" id="4965127">Alpha</span><span class="op" id="4965132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965136">Pix</span><span class="op" id="4965139">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965144">p</span><span class="op" id="4965145">.</span><span class="ident" id="4965146">Pix</span><span class="op" id="4965149">[</span><span class="ident" id="4965150">i</span><span class="op" id="4965151">:</span><span class="op" id="4965152">]</span><span class="op" id="4965153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965157">Stride</span><span class="op" id="4965163">:</span>&nbsp;<span class="ident" id="4965165">p</span><span class="op" id="4965166">.</span><span class="ident" id="4965167">Stride</span><span class="op" id="4965173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965177">Rect</span><span class="op" id="4965181">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4965185">r</span><span class="op" id="4965186">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965189">}</span><br>
<span class="lineno"></span><span class="op" id="4965191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4965194">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4965267">func</span>&nbsp;<span class="op" id="4965272">(</span><span class="ident" id="4965273">p</span>&nbsp;<span class="op" id="4965275">*</span><span class="ident" id="4965276">Alpha</span><span class="op" id="4965281">)</span>&nbsp;<span class="ident" id="4965283">Opaque</span><span class="op" id="4965289">(</span><span class="op" id="4965290">)</span>&nbsp;<span class="builtintype" id="4965292">bool</span>&nbsp;<span class="op" id="4965297">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965300">if</span>&nbsp;<span class="ident" id="4965303">p</span><span class="op" id="4965304">.</span><span class="ident" id="4965305">Rect</span><span class="op" id="4965309">.</span><span class="ident" id="4965310">Empty</span><span class="op" id="4965315">(</span><span class="op" id="4965316">)</span>&nbsp;<span class="op" id="4965318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965322">return</span>&nbsp;<span class="builtintype" id="4965329">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965338">i0</span><span class="op" id="4965340">,</span>&nbsp;<span class="ident" id="4965342">i1</span>&nbsp;<span class="op" id="4965345">:=</span>&nbsp;<span class="num" id="4965348">0</span><span class="op" id="4965349">,</span>&nbsp;<span class="ident" id="4965351">p</span><span class="op" id="4965352">.</span><span class="ident" id="4965353">Rect</span><span class="op" id="4965357">.</span><span class="ident" id="4965358">Dx</span><span class="op" id="4965360">(</span><span class="op" id="4965361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965364">for</span>&nbsp;<span class="ident" id="4965368">y</span>&nbsp;<span class="op" id="4965370">:=</span>&nbsp;<span class="ident" id="4965373">p</span><span class="op" id="4965374">.</span><span class="ident" id="4965375">Rect</span><span class="op" id="4965379">.</span><span class="ident" id="4965380">Min</span><span class="op" id="4965383">.</span><span class="ident" id="4965384">Y</span><span class="op" id="4965385">;</span>&nbsp;<span class="ident" id="4965387">y</span>&nbsp;<span class="op" id="4965389">&lt;</span>&nbsp;<span class="ident" id="4965391">p</span><span class="op" id="4965392">.</span><span class="ident" id="4965393">Rect</span><span class="op" id="4965397">.</span><span class="ident" id="4965398">Max</span><span class="op" id="4965401">.</span><span class="ident" id="4965402">Y</span><span class="op" id="4965403">;</span>&nbsp;<span class="ident" id="4965405">y</span><span class="op" id="4965406">++</span>&nbsp;<span class="op" id="4965409">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965413">for</span>&nbsp;<span class="ident" id="4965417">i</span>&nbsp;<span class="op" id="4965419">:=</span>&nbsp;<span class="ident" id="4965422">i0</span><span class="op" id="4965424">;</span>&nbsp;<span class="ident" id="4965426">i</span>&nbsp;<span class="op" id="4965428">&lt;</span>&nbsp;<span class="ident" id="4965430">i1</span><span class="op" id="4965432">;</span>&nbsp;<span class="ident" id="4965434">i</span><span class="op" id="4965435">++</span>&nbsp;<span class="op" id="4965438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965443">if</span>&nbsp;<span class="ident" id="4965446">p</span><span class="op" id="4965447">.</span><span class="ident" id="4965448">Pix</span><span class="op" id="4965451">[</span><span class="ident" id="4965452">i</span><span class="op" id="4965453">]</span>&nbsp;<span class="op" id="4965455">!=</span>&nbsp;<span class="num" id="4965458">0xff</span>&nbsp;<span class="op" id="4965463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965469">return</span>&nbsp;<span class="builtintype" id="4965476">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965489">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965493">i0</span>&nbsp;<span class="op" id="4965496">+=</span>&nbsp;<span class="ident" id="4965499">p</span><span class="op" id="4965500">.</span><span class="ident" id="4965501">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965510">i1</span>&nbsp;<span class="op" id="4965513">+=</span>&nbsp;<span class="ident" id="4965516">p</span><span class="op" id="4965517">.</span><span class="ident" id="4965518">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965529">return</span>&nbsp;<span class="builtintype" id="4965536">true</span><br>
<span class="lineno"></span><span class="op" id="4965541">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4965544">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4965599">func</span>&nbsp;<span class="ident" id="4965604">NewAlpha</span><span class="op" id="4965612">(</span><span class="ident" id="4965613">r</span>&nbsp;<span class="ident" id="4965615">Rectangle</span><span class="op" id="4965624">)</span>&nbsp;<span class="op" id="4965626">*</span><span class="ident" id="4965627">Alpha</span>&nbsp;<span class="op" id="4965633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965636">w</span><span class="op" id="4965637">,</span>&nbsp;<span class="ident" id="4965639">h</span>&nbsp;<span class="op" id="4965641">:=</span>&nbsp;<span class="ident" id="4965644">r</span><span class="op" id="4965645">.</span><span class="ident" id="4965646">Dx</span><span class="op" id="4965648">(</span><span class="op" id="4965649">)</span><span class="op" id="4965650">,</span>&nbsp;<span class="ident" id="4965652">r</span><span class="op" id="4965653">.</span><span class="ident" id="4965654">Dy</span><span class="op" id="4965656">(</span><span class="op" id="4965657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965660">pix</span>&nbsp;<span class="op" id="4965664">:=</span>&nbsp;<span class="builtinfunc" id="4965667">make</span><span class="op" id="4965671">(</span><span class="op" id="4965672">[</span><span class="op" id="4965673">]</span><span class="builtintype" id="4965674">uint8</span><span class="op" id="4965679">,</span>&nbsp;<span class="num" id="4965681">1</span><span class="op" id="4965682">*</span><span class="ident" id="4965683">w</span><span class="op" id="4965684">*</span><span class="ident" id="4965685">h</span><span class="op" id="4965686">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4965689">return</span>&nbsp;<span class="op" id="4965696">&amp;</span><span class="ident" id="4965697">Alpha</span><span class="op" id="4965702">{</span><span class="ident" id="4965703">pix</span><span class="op" id="4965706">,</span>&nbsp;<span class="num" id="4965708">1</span>&nbsp;<span class="op" id="4965710">*</span>&nbsp;<span class="ident" id="4965712">w</span><span class="op" id="4965713">,</span>&nbsp;<span class="ident" id="4965715">r</span><span class="op" id="4965716">}</span><br>
<span class="lineno"></span><span class="op" id="4965718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4965721">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4965800">type</span>&nbsp;<span class="ident" id="4965805">Alpha16</span>&nbsp;<span class="keyword" id="4965813">struct</span>&nbsp;<span class="op" id="4965820">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4965823">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4965908">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965976">Pix</span>&nbsp;<span class="op" id="4965980">[</span><span class="op" id="4965981">]</span><span class="builtintype" id="4965982">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4965989">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966065">Stride</span>&nbsp;<span class="builtintype" id="4966072">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4966077">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966109">Rect</span>&nbsp;<span class="ident" id="4966114">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4966124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4966127">func</span>&nbsp;<span class="op" id="4966132">(</span><span class="ident" id="4966133">p</span>&nbsp;<span class="op" id="4966135">*</span><span class="ident" id="4966136">Alpha16</span><span class="op" id="4966143">)</span>&nbsp;<span class="ident" id="4966145">ColorModel</span><span class="op" id="4966155">(</span><span class="op" id="4966156">)</span>&nbsp;<span class="ident" id="4966158">color</span><span class="op" id="4966163">.</span><span class="ident" id="4966164">Model</span>&nbsp;<span class="op" id="4966170">{</span>&nbsp;<span class="keyword" id="4966172">return</span>&nbsp;<span class="ident" id="4966179">color</span><span class="op" id="4966184">.</span><span class="ident" id="4966185">Alpha16Model</span>&nbsp;<span class="op" id="4966198">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="4966201">func</span>&nbsp;<span class="op" id="4966206">(</span><span class="ident" id="4966207">p</span>&nbsp;<span class="op" id="4966209">*</span><span class="ident" id="4966210">Alpha16</span><span class="op" id="4966217">)</span>&nbsp;<span class="ident" id="4966219">Bounds</span><span class="op" id="4966225">(</span><span class="op" id="4966226">)</span>&nbsp;<span class="ident" id="4966228">Rectangle</span>&nbsp;<span class="op" id="4966238">{</span>&nbsp;<span class="keyword" id="4966240">return</span>&nbsp;<span class="ident" id="4966247">p</span><span class="op" id="4966248">.</span><span class="ident" id="4966249">Rect</span>&nbsp;<span class="op" id="4966254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4966257">func</span>&nbsp;<span class="op" id="4966262">(</span><span class="ident" id="4966263">p</span>&nbsp;<span class="op" id="4966265">*</span><span class="ident" id="4966266">Alpha16</span><span class="op" id="4966273">)</span>&nbsp;<span class="ident" id="4966275">At</span><span class="op" id="4966277">(</span><span class="ident" id="4966278">x</span><span class="op" id="4966279">,</span>&nbsp;<span class="ident" id="4966281">y</span>&nbsp;<span class="builtintype" id="4966283">int</span><span class="op" id="4966286">)</span>&nbsp;<span class="ident" id="4966288">color</span><span class="op" id="4966293">.</span><span class="ident" id="4966294">Color</span>&nbsp;<span class="op" id="4966300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966303">return</span>&nbsp;<span class="ident" id="4966310">p</span><span class="op" id="4966311">.</span><span class="ident" id="4966312">Alpha16At</span><span class="op" id="4966321">(</span><span class="ident" id="4966322">x</span><span class="op" id="4966323">,</span>&nbsp;<span class="ident" id="4966325">y</span><span class="op" id="4966326">)</span><br>
<span class="lineno">590</span><span class="op" id="4966328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4966331">func</span>&nbsp;<span class="op" id="4966336">(</span><span class="ident" id="4966337">p</span>&nbsp;<span class="op" id="4966339">*</span><span class="ident" id="4966340">Alpha16</span><span class="op" id="4966347">)</span>&nbsp;<span class="ident" id="4966349">Alpha16At</span><span class="op" id="4966358">(</span><span class="ident" id="4966359">x</span><span class="op" id="4966360">,</span>&nbsp;<span class="ident" id="4966362">y</span>&nbsp;<span class="builtintype" id="4966364">int</span><span class="op" id="4966367">)</span>&nbsp;<span class="ident" id="4966369">color</span><span class="op" id="4966374">.</span><span class="ident" id="4966375">Alpha16</span>&nbsp;<span class="op" id="4966383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966386">if</span>&nbsp;<span class="op" id="4966389">!</span><span class="op" id="4966390">(</span><span class="ident" id="4966391">Point</span><span class="op" id="4966396">{</span><span class="ident" id="4966397">x</span><span class="op" id="4966398">,</span>&nbsp;<span class="ident" id="4966400">y</span><span class="op" id="4966401">}</span><span class="op" id="4966402">.</span><span class="ident" id="4966403">In</span><span class="op" id="4966405">(</span><span class="ident" id="4966406">p</span><span class="op" id="4966407">.</span><span class="ident" id="4966408">Rect</span><span class="op" id="4966412">)</span><span class="op" id="4966413">)</span>&nbsp;<span class="op" id="4966415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966419">return</span>&nbsp;<span class="ident" id="4966426">color</span><span class="op" id="4966431">.</span><span class="ident" id="4966432">Alpha16</span><span class="op" id="4966439">{</span><span class="op" id="4966440">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4966443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966446">i</span>&nbsp;<span class="op" id="4966448">:=</span>&nbsp;<span class="ident" id="4966451">p</span><span class="op" id="4966452">.</span><span class="ident" id="4966453">PixOffset</span><span class="op" id="4966462">(</span><span class="ident" id="4966463">x</span><span class="op" id="4966464">,</span>&nbsp;<span class="ident" id="4966466">y</span><span class="op" id="4966467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966470">return</span>&nbsp;<span class="ident" id="4966477">color</span><span class="op" id="4966482">.</span><span class="ident" id="4966483">Alpha16</span><span class="op" id="4966490">{</span><span class="builtintype" id="4966491">uint16</span><span class="op" id="4966497">(</span><span class="ident" id="4966498">p</span><span class="op" id="4966499">.</span><span class="ident" id="4966500">Pix</span><span class="op" id="4966503">[</span><span class="ident" id="4966504">i</span><span class="op" id="4966505">+</span><span class="num" id="4966506">0</span><span class="op" id="4966507">]</span><span class="op" id="4966508">)</span><span class="op" id="4966509">&lt;&lt;</span><span class="num" id="4966511">8</span>&nbsp;<span class="op" id="4966513">|</span>&nbsp;<span class="builtintype" id="4966515">uint16</span><span class="op" id="4966521">(</span><span class="ident" id="4966522">p</span><span class="op" id="4966523">.</span><span class="ident" id="4966524">Pix</span><span class="op" id="4966527">[</span><span class="ident" id="4966528">i</span><span class="op" id="4966529">+</span><span class="num" id="4966530">1</span><span class="op" id="4966531">]</span><span class="op" id="4966532">)</span><span class="op" id="4966533">}</span><br>
<span class="lineno"></span><span class="op" id="4966535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="4966538">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4966617">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4966641">func</span>&nbsp;<span class="op" id="4966646">(</span><span class="ident" id="4966647">p</span>&nbsp;<span class="op" id="4966649">*</span><span class="ident" id="4966650">Alpha16</span><span class="op" id="4966657">)</span>&nbsp;<span class="ident" id="4966659">PixOffset</span><span class="op" id="4966668">(</span><span class="ident" id="4966669">x</span><span class="op" id="4966670">,</span>&nbsp;<span class="ident" id="4966672">y</span>&nbsp;<span class="builtintype" id="4966674">int</span><span class="op" id="4966677">)</span>&nbsp;<span class="builtintype" id="4966679">int</span>&nbsp;<span class="op" id="4966683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966686">return</span>&nbsp;<span class="op" id="4966693">(</span><span class="ident" id="4966694">y</span><span class="op" id="4966695">-</span><span class="ident" id="4966696">p</span><span class="op" id="4966697">.</span><span class="ident" id="4966698">Rect</span><span class="op" id="4966702">.</span><span class="ident" id="4966703">Min</span><span class="op" id="4966706">.</span><span class="ident" id="4966707">Y</span><span class="op" id="4966708">)</span><span class="op" id="4966709">*</span><span class="ident" id="4966710">p</span><span class="op" id="4966711">.</span><span class="ident" id="4966712">Stride</span>&nbsp;<span class="op" id="4966719">+</span>&nbsp;<span class="op" id="4966721">(</span><span class="ident" id="4966722">x</span><span class="op" id="4966723">-</span><span class="ident" id="4966724">p</span><span class="op" id="4966725">.</span><span class="ident" id="4966726">Rect</span><span class="op" id="4966730">.</span><span class="ident" id="4966731">Min</span><span class="op" id="4966734">.</span><span class="ident" id="4966735">X</span><span class="op" id="4966736">)</span><span class="op" id="4966737">*</span><span class="num" id="4966738">2</span><br>
<span class="lineno"></span><span class="op" id="4966740">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="4966743">func</span>&nbsp;<span class="op" id="4966748">(</span><span class="ident" id="4966749">p</span>&nbsp;<span class="op" id="4966751">*</span><span class="ident" id="4966752">Alpha16</span><span class="op" id="4966759">)</span>&nbsp;<span class="ident" id="4966761">Set</span><span class="op" id="4966764">(</span><span class="ident" id="4966765">x</span><span class="op" id="4966766">,</span>&nbsp;<span class="ident" id="4966768">y</span>&nbsp;<span class="builtintype" id="4966770">int</span><span class="op" id="4966773">,</span>&nbsp;<span class="ident" id="4966775">c</span>&nbsp;<span class="ident" id="4966777">color</span><span class="op" id="4966782">.</span><span class="ident" id="4966783">Color</span><span class="op" id="4966788">)</span>&nbsp;<span class="op" id="4966790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966793">if</span>&nbsp;<span class="op" id="4966796">!</span><span class="op" id="4966797">(</span><span class="ident" id="4966798">Point</span><span class="op" id="4966803">{</span><span class="ident" id="4966804">x</span><span class="op" id="4966805">,</span>&nbsp;<span class="ident" id="4966807">y</span><span class="op" id="4966808">}</span><span class="op" id="4966809">.</span><span class="ident" id="4966810">In</span><span class="op" id="4966812">(</span><span class="ident" id="4966813">p</span><span class="op" id="4966814">.</span><span class="ident" id="4966815">Rect</span><span class="op" id="4966819">)</span><span class="op" id="4966820">)</span>&nbsp;<span class="op" id="4966822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4966826">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4966834">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966837">i</span>&nbsp;<span class="op" id="4966839">:=</span>&nbsp;<span class="ident" id="4966842">p</span><span class="op" id="4966843">.</span><span class="ident" id="4966844">PixOffset</span><span class="op" id="4966853">(</span><span class="ident" id="4966854">x</span><span class="op" id="4966855">,</span>&nbsp;<span class="ident" id="4966857">y</span><span class="op" id="4966858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966861">c1</span>&nbsp;<span class="op" id="4966864">:=</span>&nbsp;<span class="ident" id="4966867">color</span><span class="op" id="4966872">.</span><span class="ident" id="4966873">Alpha16Model</span><span class="op" id="4966885">.</span><span class="ident" id="4966886">Convert</span><span class="op" id="4966893">(</span><span class="ident" id="4966894">c</span><span class="op" id="4966895">)</span><span class="op" id="4966896">.</span><span class="op" id="4966897">(</span><span class="ident" id="4966898">color</span><span class="op" id="4966903">.</span><span class="ident" id="4966904">Alpha16</span><span class="op" id="4966911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966914">p</span><span class="op" id="4966915">.</span><span class="ident" id="4966916">Pix</span><span class="op" id="4966919">[</span><span class="ident" id="4966920">i</span><span class="op" id="4966921">+</span><span class="num" id="4966922">0</span><span class="op" id="4966923">]</span>&nbsp;<span class="op" id="4966925">=</span>&nbsp;<span class="builtintype" id="4966927">uint8</span><span class="op" id="4966932">(</span><span class="ident" id="4966933">c1</span><span class="op" id="4966935">.</span><span class="ident" id="4966936">A</span>&nbsp;<span class="op" id="4966938">&gt;&gt;</span>&nbsp;<span class="num" id="4966941">8</span><span class="op" id="4966942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4966945">p</span><span class="op" id="4966946">.</span><span class="ident" id="4966947">Pix</span><span class="op" id="4966950">[</span><span class="ident" id="4966951">i</span><span class="op" id="4966952">+</span><span class="num" id="4966953">1</span><span class="op" id="4966954">]</span>&nbsp;<span class="op" id="4966956">=</span>&nbsp;<span class="builtintype" id="4966958">uint8</span><span class="op" id="4966963">(</span><span class="ident" id="4966964">c1</span><span class="op" id="4966966">.</span><span class="ident" id="4966967">A</span><span class="op" id="4966968">)</span><br>
<span class="lineno"></span><span class="op" id="4966970">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4966973">func</span>&nbsp;<span class="op" id="4966978">(</span><span class="ident" id="4966979">p</span>&nbsp;<span class="op" id="4966981">*</span><span class="ident" id="4966982">Alpha16</span><span class="op" id="4966989">)</span>&nbsp;<span class="ident" id="4966991">SetAlpha16</span><span class="op" id="4967001">(</span><span class="ident" id="4967002">x</span><span class="op" id="4967003">,</span>&nbsp;<span class="ident" id="4967005">y</span>&nbsp;<span class="builtintype" id="4967007">int</span><span class="op" id="4967010">,</span>&nbsp;<span class="ident" id="4967012">c</span>&nbsp;<span class="ident" id="4967014">color</span><span class="op" id="4967019">.</span><span class="ident" id="4967020">Alpha16</span><span class="op" id="4967027">)</span>&nbsp;<span class="op" id="4967029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967032">if</span>&nbsp;<span class="op" id="4967035">!</span><span class="op" id="4967036">(</span><span class="ident" id="4967037">Point</span><span class="op" id="4967042">{</span><span class="ident" id="4967043">x</span><span class="op" id="4967044">,</span>&nbsp;<span class="ident" id="4967046">y</span><span class="op" id="4967047">}</span><span class="op" id="4967048">.</span><span class="ident" id="4967049">In</span><span class="op" id="4967051">(</span><span class="ident" id="4967052">p</span><span class="op" id="4967053">.</span><span class="ident" id="4967054">Rect</span><span class="op" id="4967058">)</span><span class="op" id="4967059">)</span>&nbsp;<span class="op" id="4967061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967065">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4967073">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967076">i</span>&nbsp;<span class="op" id="4967078">:=</span>&nbsp;<span class="ident" id="4967081">p</span><span class="op" id="4967082">.</span><span class="ident" id="4967083">PixOffset</span><span class="op" id="4967092">(</span><span class="ident" id="4967093">x</span><span class="op" id="4967094">,</span>&nbsp;<span class="ident" id="4967096">y</span><span class="op" id="4967097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967100">p</span><span class="op" id="4967101">.</span><span class="ident" id="4967102">Pix</span><span class="op" id="4967105">[</span><span class="ident" id="4967106">i</span><span class="op" id="4967107">+</span><span class="num" id="4967108">0</span><span class="op" id="4967109">]</span>&nbsp;<span class="op" id="4967111">=</span>&nbsp;<span class="builtintype" id="4967113">uint8</span><span class="op" id="4967118">(</span><span class="ident" id="4967119">c</span><span class="op" id="4967120">.</span><span class="ident" id="4967121">A</span>&nbsp;<span class="op" id="4967123">&gt;&gt;</span>&nbsp;<span class="num" id="4967126">8</span><span class="op" id="4967127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967130">p</span><span class="op" id="4967131">.</span><span class="ident" id="4967132">Pix</span><span class="op" id="4967135">[</span><span class="ident" id="4967136">i</span><span class="op" id="4967137">+</span><span class="num" id="4967138">1</span><span class="op" id="4967139">]</span>&nbsp;<span class="op" id="4967141">=</span>&nbsp;<span class="builtintype" id="4967143">uint8</span><span class="op" id="4967148">(</span><span class="ident" id="4967149">c</span><span class="op" id="4967150">.</span><span class="ident" id="4967151">A</span><span class="op" id="4967152">)</span><br>
<span class="lineno"></span><span class="op" id="4967154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4967157">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4967234">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4967306">func</span>&nbsp;<span class="op" id="4967311">(</span><span class="ident" id="4967312">p</span>&nbsp;<span class="op" id="4967314">*</span><span class="ident" id="4967315">Alpha16</span><span class="op" id="4967322">)</span>&nbsp;<span class="ident" id="4967324">SubImage</span><span class="op" id="4967332">(</span><span class="ident" id="4967333">r</span>&nbsp;<span class="ident" id="4967335">Rectangle</span><span class="op" id="4967344">)</span>&nbsp;<span class="ident" id="4967346">Image</span>&nbsp;<span class="op" id="4967352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967355">r</span>&nbsp;<span class="op" id="4967357">=</span>&nbsp;<span class="ident" id="4967359">r</span><span class="op" id="4967360">.</span><span class="ident" id="4967361">Intersect</span><span class="op" id="4967370">(</span><span class="ident" id="4967371">p</span><span class="op" id="4967372">.</span><span class="ident" id="4967373">Rect</span><span class="op" id="4967377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4967380">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4967461">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4967543">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967593">if</span>&nbsp;<span class="ident" id="4967596">r</span><span class="op" id="4967597">.</span><span class="ident" id="4967598">Empty</span><span class="op" id="4967603">(</span><span class="op" id="4967604">)</span>&nbsp;<span class="op" id="4967606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967610">return</span>&nbsp;<span class="op" id="4967617">&amp;</span><span class="ident" id="4967618">Alpha16</span><span class="op" id="4967625">{</span><span class="op" id="4967626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4967629">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967632">i</span>&nbsp;<span class="op" id="4967634">:=</span>&nbsp;<span class="ident" id="4967637">p</span><span class="op" id="4967638">.</span><span class="ident" id="4967639">PixOffset</span><span class="op" id="4967648">(</span><span class="ident" id="4967649">r</span><span class="op" id="4967650">.</span><span class="ident" id="4967651">Min</span><span class="op" id="4967654">.</span><span class="ident" id="4967655">X</span><span class="op" id="4967656">,</span>&nbsp;<span class="ident" id="4967658">r</span><span class="op" id="4967659">.</span><span class="ident" id="4967660">Min</span><span class="op" id="4967663">.</span><span class="ident" id="4967664">Y</span><span class="op" id="4967665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967668">return</span>&nbsp;<span class="op" id="4967675">&amp;</span><span class="ident" id="4967676">Alpha16</span><span class="op" id="4967683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967687">Pix</span><span class="op" id="4967690">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967695">p</span><span class="op" id="4967696">.</span><span class="ident" id="4967697">Pix</span><span class="op" id="4967700">[</span><span class="ident" id="4967701">i</span><span class="op" id="4967702">:</span><span class="op" id="4967703">]</span><span class="op" id="4967704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967708">Stride</span><span class="op" id="4967714">:</span>&nbsp;<span class="ident" id="4967716">p</span><span class="op" id="4967717">.</span><span class="ident" id="4967718">Stride</span><span class="op" id="4967724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967728">Rect</span><span class="op" id="4967732">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4967736">r</span><span class="op" id="4967737">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4967740">}</span><br>
<span class="lineno"></span><span class="op" id="4967742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4967745">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4967818">func</span>&nbsp;<span class="op" id="4967823">(</span><span class="ident" id="4967824">p</span>&nbsp;<span class="op" id="4967826">*</span><span class="ident" id="4967827">Alpha16</span><span class="op" id="4967834">)</span>&nbsp;<span class="ident" id="4967836">Opaque</span><span class="op" id="4967842">(</span><span class="op" id="4967843">)</span>&nbsp;<span class="builtintype" id="4967845">bool</span>&nbsp;<span class="op" id="4967850">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967853">if</span>&nbsp;<span class="ident" id="4967856">p</span><span class="op" id="4967857">.</span><span class="ident" id="4967858">Rect</span><span class="op" id="4967862">.</span><span class="ident" id="4967863">Empty</span><span class="op" id="4967868">(</span><span class="op" id="4967869">)</span>&nbsp;<span class="op" id="4967871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967875">return</span>&nbsp;<span class="builtintype" id="4967882">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4967888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4967891">i0</span><span class="op" id="4967893">,</span>&nbsp;<span class="ident" id="4967895">i1</span>&nbsp;<span class="op" id="4967898">:=</span>&nbsp;<span class="num" id="4967901">0</span><span class="op" id="4967902">,</span>&nbsp;<span class="ident" id="4967904">p</span><span class="op" id="4967905">.</span><span class="ident" id="4967906">Rect</span><span class="op" id="4967910">.</span><span class="ident" id="4967911">Dx</span><span class="op" id="4967913">(</span><span class="op" id="4967914">)</span><span class="op" id="4967915">*</span><span class="num" id="4967916">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967919">for</span>&nbsp;<span class="ident" id="4967923">y</span>&nbsp;<span class="op" id="4967925">:=</span>&nbsp;<span class="ident" id="4967928">p</span><span class="op" id="4967929">.</span><span class="ident" id="4967930">Rect</span><span class="op" id="4967934">.</span><span class="ident" id="4967935">Min</span><span class="op" id="4967938">.</span><span class="ident" id="4967939">Y</span><span class="op" id="4967940">;</span>&nbsp;<span class="ident" id="4967942">y</span>&nbsp;<span class="op" id="4967944">&lt;</span>&nbsp;<span class="ident" id="4967946">p</span><span class="op" id="4967947">.</span><span class="ident" id="4967948">Rect</span><span class="op" id="4967952">.</span><span class="ident" id="4967953">Max</span><span class="op" id="4967956">.</span><span class="ident" id="4967957">Y</span><span class="op" id="4967958">;</span>&nbsp;<span class="ident" id="4967960">y</span><span class="op" id="4967961">++</span>&nbsp;<span class="op" id="4967964">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4967968">for</span>&nbsp;<span class="ident" id="4967972">i</span>&nbsp;<span class="op" id="4967974">:=</span>&nbsp;<span class="ident" id="4967977">i0</span><span class="op" id="4967979">;</span>&nbsp;<span class="ident" id="4967981">i</span>&nbsp;<span class="op" id="4967983">&lt;</span>&nbsp;<span class="ident" id="4967985">i1</span><span class="op" id="4967987">;</span>&nbsp;<span class="ident" id="4967989">i</span>&nbsp;<span class="op" id="4967991">+=</span>&nbsp;<span class="num" id="4967994">2</span>&nbsp;<span class="op" id="4967996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968001">if</span>&nbsp;<span class="ident" id="4968004">p</span><span class="op" id="4968005">.</span><span class="ident" id="4968006">Pix</span><span class="op" id="4968009">[</span><span class="ident" id="4968010">i</span><span class="op" id="4968011">+</span><span class="num" id="4968012">0</span><span class="op" id="4968013">]</span>&nbsp;<span class="op" id="4968015">!=</span>&nbsp;<span class="num" id="4968018">0xff</span>&nbsp;<span class="op" id="4968023">||</span>&nbsp;<span class="ident" id="4968026">p</span><span class="op" id="4968027">.</span><span class="ident" id="4968028">Pix</span><span class="op" id="4968031">[</span><span class="ident" id="4968032">i</span><span class="op" id="4968033">+</span><span class="num" id="4968034">1</span><span class="op" id="4968035">]</span>&nbsp;<span class="op" id="4968037">!=</span>&nbsp;<span class="num" id="4968040">0xff</span>&nbsp;<span class="op" id="4968045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968051">return</span>&nbsp;<span class="builtintype" id="4968058">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4968067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4968071">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968075">i0</span>&nbsp;<span class="op" id="4968078">+=</span>&nbsp;<span class="ident" id="4968081">p</span><span class="op" id="4968082">.</span><span class="ident" id="4968083">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968092">i1</span>&nbsp;<span class="op" id="4968095">+=</span>&nbsp;<span class="ident" id="4968098">p</span><span class="op" id="4968099">.</span><span class="ident" id="4968100">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4968108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968111">return</span>&nbsp;<span class="builtintype" id="4968118">true</span><br>
<span class="lineno"></span><span class="op" id="4968123">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="4968126">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4968185">func</span>&nbsp;<span class="ident" id="4968190">NewAlpha16</span><span class="op" id="4968200">(</span><span class="ident" id="4968201">r</span>&nbsp;<span class="ident" id="4968203">Rectangle</span><span class="op" id="4968212">)</span>&nbsp;<span class="op" id="4968214">*</span><span class="ident" id="4968215">Alpha16</span>&nbsp;<span class="op" id="4968223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968226">w</span><span class="op" id="4968227">,</span>&nbsp;<span class="ident" id="4968229">h</span>&nbsp;<span class="op" id="4968231">:=</span>&nbsp;<span class="ident" id="4968234">r</span><span class="op" id="4968235">.</span><span class="ident" id="4968236">Dx</span><span class="op" id="4968238">(</span><span class="op" id="4968239">)</span><span class="op" id="4968240">,</span>&nbsp;<span class="ident" id="4968242">r</span><span class="op" id="4968243">.</span><span class="ident" id="4968244">Dy</span><span class="op" id="4968246">(</span><span class="op" id="4968247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968250">pix</span>&nbsp;<span class="op" id="4968254">:=</span>&nbsp;<span class="builtinfunc" id="4968257">make</span><span class="op" id="4968261">(</span><span class="op" id="4968262">[</span><span class="op" id="4968263">]</span><span class="builtintype" id="4968264">uint8</span><span class="op" id="4968269">,</span>&nbsp;<span class="num" id="4968271">2</span><span class="op" id="4968272">*</span><span class="ident" id="4968273">w</span><span class="op" id="4968274">*</span><span class="ident" id="4968275">h</span><span class="op" id="4968276">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968279">return</span>&nbsp;<span class="op" id="4968286">&amp;</span><span class="ident" id="4968287">Alpha16</span><span class="op" id="4968294">{</span><span class="ident" id="4968295">pix</span><span class="op" id="4968298">,</span>&nbsp;<span class="num" id="4968300">2</span>&nbsp;<span class="op" id="4968302">*</span>&nbsp;<span class="ident" id="4968304">w</span><span class="op" id="4968305">,</span>&nbsp;<span class="ident" id="4968307">r</span><span class="op" id="4968308">}</span><br>
<span class="lineno"></span><span class="op" id="4968310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4968313">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4968386">type</span>&nbsp;<span class="ident" id="4968391">Gray</span>&nbsp;<span class="keyword" id="4968396">struct</span>&nbsp;<span class="op" id="4968403">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4968406">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4968469">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968537">Pix</span>&nbsp;<span class="op" id="4968541">[</span><span class="op" id="4968542">]</span><span class="builtintype" id="4968543">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4968550">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968626">Stride</span>&nbsp;<span class="builtintype" id="4968633">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4968638">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968670">Rect</span>&nbsp;<span class="ident" id="4968675">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4968685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968688">func</span>&nbsp;<span class="op" id="4968693">(</span><span class="ident" id="4968694">p</span>&nbsp;<span class="op" id="4968696">*</span><span class="ident" id="4968697">Gray</span><span class="op" id="4968701">)</span>&nbsp;<span class="ident" id="4968703">ColorModel</span><span class="op" id="4968713">(</span><span class="op" id="4968714">)</span>&nbsp;<span class="ident" id="4968716">color</span><span class="op" id="4968721">.</span><span class="ident" id="4968722">Model</span>&nbsp;<span class="op" id="4968728">{</span>&nbsp;<span class="keyword" id="4968730">return</span>&nbsp;<span class="ident" id="4968737">color</span><span class="op" id="4968742">.</span><span class="ident" id="4968743">GrayModel</span>&nbsp;<span class="op" id="4968753">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="4968756">func</span>&nbsp;<span class="op" id="4968761">(</span><span class="ident" id="4968762">p</span>&nbsp;<span class="op" id="4968764">*</span><span class="ident" id="4968765">Gray</span><span class="op" id="4968769">)</span>&nbsp;<span class="ident" id="4968771">Bounds</span><span class="op" id="4968777">(</span><span class="op" id="4968778">)</span>&nbsp;<span class="ident" id="4968780">Rectangle</span>&nbsp;<span class="op" id="4968790">{</span>&nbsp;<span class="keyword" id="4968792">return</span>&nbsp;<span class="ident" id="4968799">p</span><span class="op" id="4968800">.</span><span class="ident" id="4968801">Rect</span>&nbsp;<span class="op" id="4968806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968809">func</span>&nbsp;<span class="op" id="4968814">(</span><span class="ident" id="4968815">p</span>&nbsp;<span class="op" id="4968817">*</span><span class="ident" id="4968818">Gray</span><span class="op" id="4968822">)</span>&nbsp;<span class="ident" id="4968824">At</span><span class="op" id="4968826">(</span><span class="ident" id="4968827">x</span><span class="op" id="4968828">,</span>&nbsp;<span class="ident" id="4968830">y</span>&nbsp;<span class="builtintype" id="4968832">int</span><span class="op" id="4968835">)</span>&nbsp;<span class="ident" id="4968837">color</span><span class="op" id="4968842">.</span><span class="ident" id="4968843">Color</span>&nbsp;<span class="op" id="4968849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968852">return</span>&nbsp;<span class="ident" id="4968859">p</span><span class="op" id="4968860">.</span><span class="ident" id="4968861">GrayAt</span><span class="op" id="4968867">(</span><span class="ident" id="4968868">x</span><span class="op" id="4968869">,</span>&nbsp;<span class="ident" id="4968871">y</span><span class="op" id="4968872">)</span><br>
<span class="lineno">685</span><span class="op" id="4968874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968877">func</span>&nbsp;<span class="op" id="4968882">(</span><span class="ident" id="4968883">p</span>&nbsp;<span class="op" id="4968885">*</span><span class="ident" id="4968886">Gray</span><span class="op" id="4968890">)</span>&nbsp;<span class="ident" id="4968892">GrayAt</span><span class="op" id="4968898">(</span><span class="ident" id="4968899">x</span><span class="op" id="4968900">,</span>&nbsp;<span class="ident" id="4968902">y</span>&nbsp;<span class="builtintype" id="4968904">int</span><span class="op" id="4968907">)</span>&nbsp;<span class="ident" id="4968909">color</span><span class="op" id="4968914">.</span><span class="ident" id="4968915">Gray</span>&nbsp;<span class="op" id="4968920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968923">if</span>&nbsp;<span class="op" id="4968926">!</span><span class="op" id="4968927">(</span><span class="ident" id="4968928">Point</span><span class="op" id="4968933">{</span><span class="ident" id="4968934">x</span><span class="op" id="4968935">,</span>&nbsp;<span class="ident" id="4968937">y</span><span class="op" id="4968938">}</span><span class="op" id="4968939">.</span><span class="ident" id="4968940">In</span><span class="op" id="4968942">(</span><span class="ident" id="4968943">p</span><span class="op" id="4968944">.</span><span class="ident" id="4968945">Rect</span><span class="op" id="4968949">)</span><span class="op" id="4968950">)</span>&nbsp;<span class="op" id="4968952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4968956">return</span>&nbsp;<span class="ident" id="4968963">color</span><span class="op" id="4968968">.</span><span class="ident" id="4968969">Gray</span><span class="op" id="4968973">{</span><span class="op" id="4968974">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4968977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4968980">i</span>&nbsp;<span class="op" id="4968982">:=</span>&nbsp;<span class="ident" id="4968985">p</span><span class="op" id="4968986">.</span><span class="ident" id="4968987">PixOffset</span><span class="op" id="4968996">(</span><span class="ident" id="4968997">x</span><span class="op" id="4968998">,</span>&nbsp;<span class="ident" id="4969000">y</span><span class="op" id="4969001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969004">return</span>&nbsp;<span class="ident" id="4969011">color</span><span class="op" id="4969016">.</span><span class="ident" id="4969017">Gray</span><span class="op" id="4969021">{</span><span class="ident" id="4969022">p</span><span class="op" id="4969023">.</span><span class="ident" id="4969024">Pix</span><span class="op" id="4969027">[</span><span class="ident" id="4969028">i</span><span class="op" id="4969029">]</span><span class="op" id="4969030">}</span><br>
<span class="lineno"></span><span class="op" id="4969032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="4969035">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4969114">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4969138">func</span>&nbsp;<span class="op" id="4969143">(</span><span class="ident" id="4969144">p</span>&nbsp;<span class="op" id="4969146">*</span><span class="ident" id="4969147">Gray</span><span class="op" id="4969151">)</span>&nbsp;<span class="ident" id="4969153">PixOffset</span><span class="op" id="4969162">(</span><span class="ident" id="4969163">x</span><span class="op" id="4969164">,</span>&nbsp;<span class="ident" id="4969166">y</span>&nbsp;<span class="builtintype" id="4969168">int</span><span class="op" id="4969171">)</span>&nbsp;<span class="builtintype" id="4969173">int</span>&nbsp;<span class="op" id="4969177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969180">return</span>&nbsp;<span class="op" id="4969187">(</span><span class="ident" id="4969188">y</span><span class="op" id="4969189">-</span><span class="ident" id="4969190">p</span><span class="op" id="4969191">.</span><span class="ident" id="4969192">Rect</span><span class="op" id="4969196">.</span><span class="ident" id="4969197">Min</span><span class="op" id="4969200">.</span><span class="ident" id="4969201">Y</span><span class="op" id="4969202">)</span><span class="op" id="4969203">*</span><span class="ident" id="4969204">p</span><span class="op" id="4969205">.</span><span class="ident" id="4969206">Stride</span>&nbsp;<span class="op" id="4969213">+</span>&nbsp;<span class="op" id="4969215">(</span><span class="ident" id="4969216">x</span><span class="op" id="4969217">-</span><span class="ident" id="4969218">p</span><span class="op" id="4969219">.</span><span class="ident" id="4969220">Rect</span><span class="op" id="4969224">.</span><span class="ident" id="4969225">Min</span><span class="op" id="4969228">.</span><span class="ident" id="4969229">X</span><span class="op" id="4969230">)</span><span class="op" id="4969231">*</span><span class="num" id="4969232">1</span><br>
<span class="lineno"></span><span class="op" id="4969234">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="4969237">func</span>&nbsp;<span class="op" id="4969242">(</span><span class="ident" id="4969243">p</span>&nbsp;<span class="op" id="4969245">*</span><span class="ident" id="4969246">Gray</span><span class="op" id="4969250">)</span>&nbsp;<span class="ident" id="4969252">Set</span><span class="op" id="4969255">(</span><span class="ident" id="4969256">x</span><span class="op" id="4969257">,</span>&nbsp;<span class="ident" id="4969259">y</span>&nbsp;<span class="builtintype" id="4969261">int</span><span class="op" id="4969264">,</span>&nbsp;<span class="ident" id="4969266">c</span>&nbsp;<span class="ident" id="4969268">color</span><span class="op" id="4969273">.</span><span class="ident" id="4969274">Color</span><span class="op" id="4969279">)</span>&nbsp;<span class="op" id="4969281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969284">if</span>&nbsp;<span class="op" id="4969287">!</span><span class="op" id="4969288">(</span><span class="ident" id="4969289">Point</span><span class="op" id="4969294">{</span><span class="ident" id="4969295">x</span><span class="op" id="4969296">,</span>&nbsp;<span class="ident" id="4969298">y</span><span class="op" id="4969299">}</span><span class="op" id="4969300">.</span><span class="ident" id="4969301">In</span><span class="op" id="4969303">(</span><span class="ident" id="4969304">p</span><span class="op" id="4969305">.</span><span class="ident" id="4969306">Rect</span><span class="op" id="4969310">)</span><span class="op" id="4969311">)</span>&nbsp;<span class="op" id="4969313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969317">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4969325">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4969328">i</span>&nbsp;<span class="op" id="4969330">:=</span>&nbsp;<span class="ident" id="4969333">p</span><span class="op" id="4969334">.</span><span class="ident" id="4969335">PixOffset</span><span class="op" id="4969344">(</span><span class="ident" id="4969345">x</span><span class="op" id="4969346">,</span>&nbsp;<span class="ident" id="4969348">y</span><span class="op" id="4969349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4969352">p</span><span class="op" id="4969353">.</span><span class="ident" id="4969354">Pix</span><span class="op" id="4969357">[</span><span class="ident" id="4969358">i</span><span class="op" id="4969359">]</span>&nbsp;<span class="op" id="4969361">=</span>&nbsp;<span class="ident" id="4969363">color</span><span class="op" id="4969368">.</span><span class="ident" id="4969369">GrayModel</span><span class="op" id="4969378">.</span><span class="ident" id="4969379">Convert</span><span class="op" id="4969386">(</span><span class="ident" id="4969387">c</span><span class="op" id="4969388">)</span><span class="op" id="4969389">.</span><span class="op" id="4969390">(</span><span class="ident" id="4969391">color</span><span class="op" id="4969396">.</span><span class="ident" id="4969397">Gray</span><span class="op" id="4969401">)</span><span class="op" id="4969402">.</span><span class="ident" id="4969403">Y</span><br>
<span class="lineno"></span><span class="op" id="4969405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4969408">func</span>&nbsp;<span class="op" id="4969413">(</span><span class="ident" id="4969414">p</span>&nbsp;<span class="op" id="4969416">*</span><span class="ident" id="4969417">Gray</span><span class="op" id="4969421">)</span>&nbsp;<span class="ident" id="4969423">SetGray</span><span class="op" id="4969430">(</span><span class="ident" id="4969431">x</span><span class="op" id="4969432">,</span>&nbsp;<span class="ident" id="4969434">y</span>&nbsp;<span class="builtintype" id="4969436">int</span><span class="op" id="4969439">,</span>&nbsp;<span class="ident" id="4969441">c</span>&nbsp;<span class="ident" id="4969443">color</span><span class="op" id="4969448">.</span><span class="ident" id="4969449">Gray</span><span class="op" id="4969453">)</span>&nbsp;<span class="op" id="4969455">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969458">if</span>&nbsp;<span class="op" id="4969461">!</span><span class="op" id="4969462">(</span><span class="ident" id="4969463">Point</span><span class="op" id="4969468">{</span><span class="ident" id="4969469">x</span><span class="op" id="4969470">,</span>&nbsp;<span class="ident" id="4969472">y</span><span class="op" id="4969473">}</span><span class="op" id="4969474">.</span><span class="ident" id="4969475">In</span><span class="op" id="4969477">(</span><span class="ident" id="4969478">p</span><span class="op" id="4969479">.</span><span class="ident" id="4969480">Rect</span><span class="op" id="4969484">)</span><span class="op" id="4969485">)</span>&nbsp;<span class="op" id="4969487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4969499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4969502">i</span>&nbsp;<span class="op" id="4969504">:=</span>&nbsp;<span class="ident" id="4969507">p</span><span class="op" id="4969508">.</span><span class="ident" id="4969509">PixOffset</span><span class="op" id="4969518">(</span><span class="ident" id="4969519">x</span><span class="op" id="4969520">,</span>&nbsp;<span class="ident" id="4969522">y</span><span class="op" id="4969523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4969526">p</span><span class="op" id="4969527">.</span><span class="ident" id="4969528">Pix</span><span class="op" id="4969531">[</span><span class="ident" id="4969532">i</span><span class="op" id="4969533">]</span>&nbsp;<span class="op" id="4969535">=</span>&nbsp;<span class="ident" id="4969537">c</span><span class="op" id="4969538">.</span><span class="ident" id="4969539">Y</span><br>
<span class="lineno">715</span><span class="op" id="4969541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4969544">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4969621">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4969693">func</span>&nbsp;<span class="op" id="4969698">(</span><span class="ident" id="4969699">p</span>&nbsp;<span class="op" id="4969701">*</span><span class="ident" id="4969702">Gray</span><span class="op" id="4969706">)</span>&nbsp;<span class="ident" id="4969708">SubImage</span><span class="op" id="4969716">(</span><span class="ident" id="4969717">r</span>&nbsp;<span class="ident" id="4969719">Rectangle</span><span class="op" id="4969728">)</span>&nbsp;<span class="ident" id="4969730">Image</span>&nbsp;<span class="op" id="4969736">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4969739">r</span>&nbsp;<span class="op" id="4969741">=</span>&nbsp;<span class="ident" id="4969743">r</span><span class="op" id="4969744">.</span><span class="ident" id="4969745">Intersect</span><span class="op" id="4969754">(</span><span class="ident" id="4969755">p</span><span class="op" id="4969756">.</span><span class="ident" id="4969757">Rect</span><span class="op" id="4969761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4969764">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4969845">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4969927">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969977">if</span>&nbsp;<span class="ident" id="4969980">r</span><span class="op" id="4969981">.</span><span class="ident" id="4969982">Empty</span><span class="op" id="4969987">(</span><span class="op" id="4969988">)</span>&nbsp;<span class="op" id="4969990">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4969994">return</span>&nbsp;<span class="op" id="4970001">&amp;</span><span class="ident" id="4970002">Gray</span><span class="op" id="4970006">{</span><span class="op" id="4970007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4970010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970013">i</span>&nbsp;<span class="op" id="4970015">:=</span>&nbsp;<span class="ident" id="4970018">p</span><span class="op" id="4970019">.</span><span class="ident" id="4970020">PixOffset</span><span class="op" id="4970029">(</span><span class="ident" id="4970030">r</span><span class="op" id="4970031">.</span><span class="ident" id="4970032">Min</span><span class="op" id="4970035">.</span><span class="ident" id="4970036">X</span><span class="op" id="4970037">,</span>&nbsp;<span class="ident" id="4970039">r</span><span class="op" id="4970040">.</span><span class="ident" id="4970041">Min</span><span class="op" id="4970044">.</span><span class="ident" id="4970045">Y</span><span class="op" id="4970046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4970049">return</span>&nbsp;<span class="op" id="4970056">&amp;</span><span class="ident" id="4970057">Gray</span><span class="op" id="4970061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970065">Pix</span><span class="op" id="4970068">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970073">p</span><span class="op" id="4970074">.</span><span class="ident" id="4970075">Pix</span><span class="op" id="4970078">[</span><span class="ident" id="4970079">i</span><span class="op" id="4970080">:</span><span class="op" id="4970081">]</span><span class="op" id="4970082">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970086">Stride</span><span class="op" id="4970092">:</span>&nbsp;<span class="ident" id="4970094">p</span><span class="op" id="4970095">.</span><span class="ident" id="4970096">Stride</span><span class="op" id="4970102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970106">Rect</span><span class="op" id="4970110">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4970114">r</span><span class="op" id="4970115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4970118">}</span><br>
<span class="lineno"></span><span class="op" id="4970120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="4970123">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4970196">func</span>&nbsp;<span class="op" id="4970201">(</span><span class="ident" id="4970202">p</span>&nbsp;<span class="op" id="4970204">*</span><span class="ident" id="4970205">Gray</span><span class="op" id="4970209">)</span>&nbsp;<span class="ident" id="4970211">Opaque</span><span class="op" id="4970217">(</span><span class="op" id="4970218">)</span>&nbsp;<span class="builtintype" id="4970220">bool</span>&nbsp;<span class="op" id="4970225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4970228">return</span>&nbsp;<span class="builtintype" id="4970235">true</span><br>
<span class="lineno"></span><span class="op" id="4970240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="4970243">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4970296">func</span>&nbsp;<span class="ident" id="4970301">NewGray</span><span class="op" id="4970308">(</span><span class="ident" id="4970309">r</span>&nbsp;<span class="ident" id="4970311">Rectangle</span><span class="op" id="4970320">)</span>&nbsp;<span class="op" id="4970322">*</span><span class="ident" id="4970323">Gray</span>&nbsp;<span class="op" id="4970328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970331">w</span><span class="op" id="4970332">,</span>&nbsp;<span class="ident" id="4970334">h</span>&nbsp;<span class="op" id="4970336">:=</span>&nbsp;<span class="ident" id="4970339">r</span><span class="op" id="4970340">.</span><span class="ident" id="4970341">Dx</span><span class="op" id="4970343">(</span><span class="op" id="4970344">)</span><span class="op" id="4970345">,</span>&nbsp;<span class="ident" id="4970347">r</span><span class="op" id="4970348">.</span><span class="ident" id="4970349">Dy</span><span class="op" id="4970351">(</span><span class="op" id="4970352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970355">pix</span>&nbsp;<span class="op" id="4970359">:=</span>&nbsp;<span class="builtinfunc" id="4970362">make</span><span class="op" id="4970366">(</span><span class="op" id="4970367">[</span><span class="op" id="4970368">]</span><span class="builtintype" id="4970369">uint8</span><span class="op" id="4970374">,</span>&nbsp;<span class="num" id="4970376">1</span><span class="op" id="4970377">*</span><span class="ident" id="4970378">w</span><span class="op" id="4970379">*</span><span class="ident" id="4970380">h</span><span class="op" id="4970381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4970384">return</span>&nbsp;<span class="op" id="4970391">&amp;</span><span class="ident" id="4970392">Gray</span><span class="op" id="4970396">{</span><span class="ident" id="4970397">pix</span><span class="op" id="4970400">,</span>&nbsp;<span class="num" id="4970402">1</span>&nbsp;<span class="op" id="4970404">*</span>&nbsp;<span class="ident" id="4970406">w</span><span class="op" id="4970407">,</span>&nbsp;<span class="ident" id="4970409">r</span><span class="op" id="4970410">}</span><br>
<span class="lineno">745</span><span class="op" id="4970412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4970415">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4970492">type</span>&nbsp;<span class="ident" id="4970497">Gray16</span>&nbsp;<span class="keyword" id="4970504">struct</span>&nbsp;<span class="op" id="4970511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4970514">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4970598">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970666">Pix</span>&nbsp;<span class="op" id="4970670">[</span><span class="op" id="4970671">]</span><span class="builtintype" id="4970672">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4970679">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970755">Stride</span>&nbsp;<span class="builtintype" id="4970762">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4970767">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4970799">Rect</span>&nbsp;<span class="ident" id="4970804">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4970814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4970817">func</span>&nbsp;<span class="op" id="4970822">(</span><span class="ident" id="4970823">p</span>&nbsp;<span class="op" id="4970825">*</span><span class="ident" id="4970826">Gray16</span><span class="op" id="4970832">)</span>&nbsp;<span class="ident" id="4970834">ColorModel</span><span class="op" id="4970844">(</span><span class="op" id="4970845">)</span>&nbsp;<span class="ident" id="4970847">color</span><span class="op" id="4970852">.</span><span class="ident" id="4970853">Model</span>&nbsp;<span class="op" id="4970859">{</span>&nbsp;<span class="keyword" id="4970861">return</span>&nbsp;<span class="ident" id="4970868">color</span><span class="op" id="4970873">.</span><span class="ident" id="4970874">Gray16Model</span>&nbsp;<span class="op" id="4970886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="4970889">func</span>&nbsp;<span class="op" id="4970894">(</span><span class="ident" id="4970895">p</span>&nbsp;<span class="op" id="4970897">*</span><span class="ident" id="4970898">Gray16</span><span class="op" id="4970904">)</span>&nbsp;<span class="ident" id="4970906">Bounds</span><span class="op" id="4970912">(</span><span class="op" id="4970913">)</span>&nbsp;<span class="ident" id="4970915">Rectangle</span>&nbsp;<span class="op" id="4970925">{</span>&nbsp;<span class="keyword" id="4970927">return</span>&nbsp;<span class="ident" id="4970934">p</span><span class="op" id="4970935">.</span><span class="ident" id="4970936">Rect</span>&nbsp;<span class="op" id="4970941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4970944">func</span>&nbsp;<span class="op" id="4970949">(</span><span class="ident" id="4970950">p</span>&nbsp;<span class="op" id="4970952">*</span><span class="ident" id="4970953">Gray16</span><span class="op" id="4970959">)</span>&nbsp;<span class="ident" id="4970961">At</span><span class="op" id="4970963">(</span><span class="ident" id="4970964">x</span><span class="op" id="4970965">,</span>&nbsp;<span class="ident" id="4970967">y</span>&nbsp;<span class="builtintype" id="4970969">int</span><span class="op" id="4970972">)</span>&nbsp;<span class="ident" id="4970974">color</span><span class="op" id="4970979">.</span><span class="ident" id="4970980">Color</span>&nbsp;<span class="op" id="4970986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4970989">return</span>&nbsp;<span class="ident" id="4970996">p</span><span class="op" id="4970997">.</span><span class="ident" id="4970998">Gray16At</span><span class="op" id="4971006">(</span><span class="ident" id="4971007">x</span><span class="op" id="4971008">,</span>&nbsp;<span class="ident" id="4971010">y</span><span class="op" id="4971011">)</span><br>
<span class="lineno"></span><span class="op" id="4971013">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="4971016">func</span>&nbsp;<span class="op" id="4971021">(</span><span class="ident" id="4971022">p</span>&nbsp;<span class="op" id="4971024">*</span><span class="ident" id="4971025">Gray16</span><span class="op" id="4971031">)</span>&nbsp;<span class="ident" id="4971033">Gray16At</span><span class="op" id="4971041">(</span><span class="ident" id="4971042">x</span><span class="op" id="4971043">,</span>&nbsp;<span class="ident" id="4971045">y</span>&nbsp;<span class="builtintype" id="4971047">int</span><span class="op" id="4971050">)</span>&nbsp;<span class="ident" id="4971052">color</span><span class="op" id="4971057">.</span><span class="ident" id="4971058">Gray16</span>&nbsp;<span class="op" id="4971065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971068">if</span>&nbsp;<span class="op" id="4971071">!</span><span class="op" id="4971072">(</span><span class="ident" id="4971073">Point</span><span class="op" id="4971078">{</span><span class="ident" id="4971079">x</span><span class="op" id="4971080">,</span>&nbsp;<span class="ident" id="4971082">y</span><span class="op" id="4971083">}</span><span class="op" id="4971084">.</span><span class="ident" id="4971085">In</span><span class="op" id="4971087">(</span><span class="ident" id="4971088">p</span><span class="op" id="4971089">.</span><span class="ident" id="4971090">Rect</span><span class="op" id="4971094">)</span><span class="op" id="4971095">)</span>&nbsp;<span class="op" id="4971097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971101">return</span>&nbsp;<span class="ident" id="4971108">color</span><span class="op" id="4971113">.</span><span class="ident" id="4971114">Gray16</span><span class="op" id="4971120">{</span><span class="op" id="4971121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4971124">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971127">i</span>&nbsp;<span class="op" id="4971129">:=</span>&nbsp;<span class="ident" id="4971132">p</span><span class="op" id="4971133">.</span><span class="ident" id="4971134">PixOffset</span><span class="op" id="4971143">(</span><span class="ident" id="4971144">x</span><span class="op" id="4971145">,</span>&nbsp;<span class="ident" id="4971147">y</span><span class="op" id="4971148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971151">return</span>&nbsp;<span class="ident" id="4971158">color</span><span class="op" id="4971163">.</span><span class="ident" id="4971164">Gray16</span><span class="op" id="4971170">{</span><span class="builtintype" id="4971171">uint16</span><span class="op" id="4971177">(</span><span class="ident" id="4971178">p</span><span class="op" id="4971179">.</span><span class="ident" id="4971180">Pix</span><span class="op" id="4971183">[</span><span class="ident" id="4971184">i</span><span class="op" id="4971185">+</span><span class="num" id="4971186">0</span><span class="op" id="4971187">]</span><span class="op" id="4971188">)</span><span class="op" id="4971189">&lt;&lt;</span><span class="num" id="4971191">8</span>&nbsp;<span class="op" id="4971193">|</span>&nbsp;<span class="builtintype" id="4971195">uint16</span><span class="op" id="4971201">(</span><span class="ident" id="4971202">p</span><span class="op" id="4971203">.</span><span class="ident" id="4971204">Pix</span><span class="op" id="4971207">[</span><span class="ident" id="4971208">i</span><span class="op" id="4971209">+</span><span class="num" id="4971210">1</span><span class="op" id="4971211">]</span><span class="op" id="4971212">)</span><span class="op" id="4971213">}</span><br>
<span class="lineno"></span><span class="op" id="4971215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971218">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="4971297">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4971321">func</span>&nbsp;<span class="op" id="4971326">(</span><span class="ident" id="4971327">p</span>&nbsp;<span class="op" id="4971329">*</span><span class="ident" id="4971330">Gray16</span><span class="op" id="4971336">)</span>&nbsp;<span class="ident" id="4971338">PixOffset</span><span class="op" id="4971347">(</span><span class="ident" id="4971348">x</span><span class="op" id="4971349">,</span>&nbsp;<span class="ident" id="4971351">y</span>&nbsp;<span class="builtintype" id="4971353">int</span><span class="op" id="4971356">)</span>&nbsp;<span class="builtintype" id="4971358">int</span>&nbsp;<span class="op" id="4971362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971365">return</span>&nbsp;<span class="op" id="4971372">(</span><span class="ident" id="4971373">y</span><span class="op" id="4971374">-</span><span class="ident" id="4971375">p</span><span class="op" id="4971376">.</span><span class="ident" id="4971377">Rect</span><span class="op" id="4971381">.</span><span class="ident" id="4971382">Min</span><span class="op" id="4971385">.</span><span class="ident" id="4971386">Y</span><span class="op" id="4971387">)</span><span class="op" id="4971388">*</span><span class="ident" id="4971389">p</span><span class="op" id="4971390">.</span><span class="ident" id="4971391">Stride</span>&nbsp;<span class="op" id="4971398">+</span>&nbsp;<span class="op" id="4971400">(</span><span class="ident" id="4971401">x</span><span class="op" id="4971402">-</span><span class="ident" id="4971403">p</span><span class="op" id="4971404">.</span><span class="ident" id="4971405">Rect</span><span class="op" id="4971409">.</span><span class="ident" id="4971410">Min</span><span class="op" id="4971413">.</span><span class="ident" id="4971414">X</span><span class="op" id="4971415">)</span><span class="op" id="4971416">*</span><span class="num" id="4971417">2</span><br>
<span class="lineno"></span><span class="op" id="4971419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="4971422">func</span>&nbsp;<span class="op" id="4971427">(</span><span class="ident" id="4971428">p</span>&nbsp;<span class="op" id="4971430">*</span><span class="ident" id="4971431">Gray16</span><span class="op" id="4971437">)</span>&nbsp;<span class="ident" id="4971439">Set</span><span class="op" id="4971442">(</span><span class="ident" id="4971443">x</span><span class="op" id="4971444">,</span>&nbsp;<span class="ident" id="4971446">y</span>&nbsp;<span class="builtintype" id="4971448">int</span><span class="op" id="4971451">,</span>&nbsp;<span class="ident" id="4971453">c</span>&nbsp;<span class="ident" id="4971455">color</span><span class="op" id="4971460">.</span><span class="ident" id="4971461">Color</span><span class="op" id="4971466">)</span>&nbsp;<span class="op" id="4971468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971471">if</span>&nbsp;<span class="op" id="4971474">!</span><span class="op" id="4971475">(</span><span class="ident" id="4971476">Point</span><span class="op" id="4971481">{</span><span class="ident" id="4971482">x</span><span class="op" id="4971483">,</span>&nbsp;<span class="ident" id="4971485">y</span><span class="op" id="4971486">}</span><span class="op" id="4971487">.</span><span class="ident" id="4971488">In</span><span class="op" id="4971490">(</span><span class="ident" id="4971491">p</span><span class="op" id="4971492">.</span><span class="ident" id="4971493">Rect</span><span class="op" id="4971497">)</span><span class="op" id="4971498">)</span>&nbsp;<span class="op" id="4971500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971504">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4971512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971515">i</span>&nbsp;<span class="op" id="4971517">:=</span>&nbsp;<span class="ident" id="4971520">p</span><span class="op" id="4971521">.</span><span class="ident" id="4971522">PixOffset</span><span class="op" id="4971531">(</span><span class="ident" id="4971532">x</span><span class="op" id="4971533">,</span>&nbsp;<span class="ident" id="4971535">y</span><span class="op" id="4971536">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971539">c1</span>&nbsp;<span class="op" id="4971542">:=</span>&nbsp;<span class="ident" id="4971545">color</span><span class="op" id="4971550">.</span><span class="ident" id="4971551">Gray16Model</span><span class="op" id="4971562">.</span><span class="ident" id="4971563">Convert</span><span class="op" id="4971570">(</span><span class="ident" id="4971571">c</span><span class="op" id="4971572">)</span><span class="op" id="4971573">.</span><span class="op" id="4971574">(</span><span class="ident" id="4971575">color</span><span class="op" id="4971580">.</span><span class="ident" id="4971581">Gray16</span><span class="op" id="4971587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971590">p</span><span class="op" id="4971591">.</span><span class="ident" id="4971592">Pix</span><span class="op" id="4971595">[</span><span class="ident" id="4971596">i</span><span class="op" id="4971597">+</span><span class="num" id="4971598">0</span><span class="op" id="4971599">]</span>&nbsp;<span class="op" id="4971601">=</span>&nbsp;<span class="builtintype" id="4971603">uint8</span><span class="op" id="4971608">(</span><span class="ident" id="4971609">c1</span><span class="op" id="4971611">.</span><span class="ident" id="4971612">Y</span>&nbsp;<span class="op" id="4971614">&gt;&gt;</span>&nbsp;<span class="num" id="4971617">8</span><span class="op" id="4971618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971621">p</span><span class="op" id="4971622">.</span><span class="ident" id="4971623">Pix</span><span class="op" id="4971626">[</span><span class="ident" id="4971627">i</span><span class="op" id="4971628">+</span><span class="num" id="4971629">1</span><span class="op" id="4971630">]</span>&nbsp;<span class="op" id="4971632">=</span>&nbsp;<span class="builtintype" id="4971634">uint8</span><span class="op" id="4971639">(</span><span class="ident" id="4971640">c1</span><span class="op" id="4971642">.</span><span class="ident" id="4971643">Y</span><span class="op" id="4971644">)</span><br>
<span class="lineno"></span><span class="op" id="4971646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="4971649">func</span>&nbsp;<span class="op" id="4971654">(</span><span class="ident" id="4971655">p</span>&nbsp;<span class="op" id="4971657">*</span><span class="ident" id="4971658">Gray16</span><span class="op" id="4971664">)</span>&nbsp;<span class="ident" id="4971666">SetGray16</span><span class="op" id="4971675">(</span><span class="ident" id="4971676">x</span><span class="op" id="4971677">,</span>&nbsp;<span class="ident" id="4971679">y</span>&nbsp;<span class="builtintype" id="4971681">int</span><span class="op" id="4971684">,</span>&nbsp;<span class="ident" id="4971686">c</span>&nbsp;<span class="ident" id="4971688">color</span><span class="op" id="4971693">.</span><span class="ident" id="4971694">Gray16</span><span class="op" id="4971700">)</span>&nbsp;<span class="op" id="4971702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971705">if</span>&nbsp;<span class="op" id="4971708">!</span><span class="op" id="4971709">(</span><span class="ident" id="4971710">Point</span><span class="op" id="4971715">{</span><span class="ident" id="4971716">x</span><span class="op" id="4971717">,</span>&nbsp;<span class="ident" id="4971719">y</span><span class="op" id="4971720">}</span><span class="op" id="4971721">.</span><span class="ident" id="4971722">In</span><span class="op" id="4971724">(</span><span class="ident" id="4971725">p</span><span class="op" id="4971726">.</span><span class="ident" id="4971727">Rect</span><span class="op" id="4971731">)</span><span class="op" id="4971732">)</span>&nbsp;<span class="op" id="4971734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4971738">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4971746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971749">i</span>&nbsp;<span class="op" id="4971751">:=</span>&nbsp;<span class="ident" id="4971754">p</span><span class="op" id="4971755">.</span><span class="ident" id="4971756">PixOffset</span><span class="op" id="4971765">(</span><span class="ident" id="4971766">x</span><span class="op" id="4971767">,</span>&nbsp;<span class="ident" id="4971769">y</span><span class="op" id="4971770">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971773">p</span><span class="op" id="4971774">.</span><span class="ident" id="4971775">Pix</span><span class="op" id="4971778">[</span><span class="ident" id="4971779">i</span><span class="op" id="4971780">+</span><span class="num" id="4971781">0</span><span class="op" id="4971782">]</span>&nbsp;<span class="op" id="4971784">=</span>&nbsp;<span class="builtintype" id="4971786">uint8</span><span class="op" id="4971791">(</span><span class="ident" id="4971792">c</span><span class="op" id="4971793">.</span><span class="ident" id="4971794">Y</span>&nbsp;<span class="op" id="4971796">&gt;&gt;</span>&nbsp;<span class="num" id="4971799">8</span><span class="op" id="4971800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4971803">p</span><span class="op" id="4971804">.</span><span class="ident" id="4971805">Pix</span><span class="op" id="4971808">[</span><span class="ident" id="4971809">i</span><span class="op" id="4971810">+</span><span class="num" id="4971811">1</span><span class="op" id="4971812">]</span>&nbsp;<span class="op" id="4971814">=</span>&nbsp;<span class="builtintype" id="4971816">uint8</span><span class="op" id="4971821">(</span><span class="ident" id="4971822">c</span><span class="op" id="4971823">.</span><span class="ident" id="4971824">Y</span><span class="op" id="4971825">)</span><br>
<span class="lineno"></span><span class="op" id="4971827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971830">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="4971907">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4971979">func</span>&nbsp;<span class="op" id="4971984">(</span><span class="ident" id="4971985">p</span>&nbsp;<span class="op" id="4971987">*</span><span class="ident" id="4971988">Gray16</span><span class="op" id="4971994">)</span>&nbsp;<span class="ident" id="4971996">SubImage</span><span class="op" id="4972004">(</span><span class="ident" id="4972005">r</span>&nbsp;<span class="ident" id="4972007">Rectangle</span><span class="op" id="4972016">)</span>&nbsp;<span class="ident" id="4972018">Image</span>&nbsp;<span class="op" id="4972024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972027">r</span>&nbsp;<span class="op" id="4972029">=</span>&nbsp;<span class="ident" id="4972031">r</span><span class="op" id="4972032">.</span><span class="ident" id="4972033">Intersect</span><span class="op" id="4972042">(</span><span class="ident" id="4972043">p</span><span class="op" id="4972044">.</span><span class="ident" id="4972045">Rect</span><span class="op" id="4972049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4972052">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4972133">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4972215">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4972265">if</span>&nbsp;<span class="ident" id="4972268">r</span><span class="op" id="4972269">.</span><span class="ident" id="4972270">Empty</span><span class="op" id="4972275">(</span><span class="op" id="4972276">)</span>&nbsp;<span class="op" id="4972278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4972282">return</span>&nbsp;<span class="op" id="4972289">&amp;</span><span class="ident" id="4972290">Gray16</span><span class="op" id="4972296">{</span><span class="op" id="4972297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4972300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972303">i</span>&nbsp;<span class="op" id="4972305">:=</span>&nbsp;<span class="ident" id="4972308">p</span><span class="op" id="4972309">.</span><span class="ident" id="4972310">PixOffset</span><span class="op" id="4972319">(</span><span class="ident" id="4972320">r</span><span class="op" id="4972321">.</span><span class="ident" id="4972322">Min</span><span class="op" id="4972325">.</span><span class="ident" id="4972326">X</span><span class="op" id="4972327">,</span>&nbsp;<span class="ident" id="4972329">r</span><span class="op" id="4972330">.</span><span class="ident" id="4972331">Min</span><span class="op" id="4972334">.</span><span class="ident" id="4972335">Y</span><span class="op" id="4972336">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4972339">return</span>&nbsp;<span class="op" id="4972346">&amp;</span><span class="ident" id="4972347">Gray16</span><span class="op" id="4972353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972357">Pix</span><span class="op" id="4972360">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972365">p</span><span class="op" id="4972366">.</span><span class="ident" id="4972367">Pix</span><span class="op" id="4972370">[</span><span class="ident" id="4972371">i</span><span class="op" id="4972372">:</span><span class="op" id="4972373">]</span><span class="op" id="4972374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972378">Stride</span><span class="op" id="4972384">:</span>&nbsp;<span class="ident" id="4972386">p</span><span class="op" id="4972387">.</span><span class="ident" id="4972388">Stride</span><span class="op" id="4972394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972398">Rect</span><span class="op" id="4972402">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4972406">r</span><span class="op" id="4972407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4972410">}</span><br>
<span class="lineno">815</span><span class="op" id="4972412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972415">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4972488">func</span>&nbsp;<span class="op" id="4972493">(</span><span class="ident" id="4972494">p</span>&nbsp;<span class="op" id="4972496">*</span><span class="ident" id="4972497">Gray16</span><span class="op" id="4972503">)</span>&nbsp;<span class="ident" id="4972505">Opaque</span><span class="op" id="4972511">(</span><span class="op" id="4972512">)</span>&nbsp;<span class="builtintype" id="4972514">bool</span>&nbsp;<span class="op" id="4972519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4972522">return</span>&nbsp;<span class="builtintype" id="4972529">true</span><br>
<span class="lineno">820</span><span class="op" id="4972534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972537">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4972594">func</span>&nbsp;<span class="ident" id="4972599">NewGray16</span><span class="op" id="4972608">(</span><span class="ident" id="4972609">r</span>&nbsp;<span class="ident" id="4972611">Rectangle</span><span class="op" id="4972620">)</span>&nbsp;<span class="op" id="4972622">*</span><span class="ident" id="4972623">Gray16</span>&nbsp;<span class="op" id="4972630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972633">w</span><span class="op" id="4972634">,</span>&nbsp;<span class="ident" id="4972636">h</span>&nbsp;<span class="op" id="4972638">:=</span>&nbsp;<span class="ident" id="4972641">r</span><span class="op" id="4972642">.</span><span class="ident" id="4972643">Dx</span><span class="op" id="4972645">(</span><span class="op" id="4972646">)</span><span class="op" id="4972647">,</span>&nbsp;<span class="ident" id="4972649">r</span><span class="op" id="4972650">.</span><span class="ident" id="4972651">Dy</span><span class="op" id="4972653">(</span><span class="op" id="4972654">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972657">pix</span>&nbsp;<span class="op" id="4972661">:=</span>&nbsp;<span class="builtinfunc" id="4972664">make</span><span class="op" id="4972668">(</span><span class="op" id="4972669">[</span><span class="op" id="4972670">]</span><span class="builtintype" id="4972671">uint8</span><span class="op" id="4972676">,</span>&nbsp;<span class="num" id="4972678">2</span><span class="op" id="4972679">*</span><span class="ident" id="4972680">w</span><span class="op" id="4972681">*</span><span class="ident" id="4972682">h</span><span class="op" id="4972683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4972686">return</span>&nbsp;<span class="op" id="4972693">&amp;</span><span class="ident" id="4972694">Gray16</span><span class="op" id="4972700">{</span><span class="ident" id="4972701">pix</span><span class="op" id="4972704">,</span>&nbsp;<span class="num" id="4972706">2</span>&nbsp;<span class="op" id="4972708">*</span>&nbsp;<span class="ident" id="4972710">w</span><span class="op" id="4972711">,</span>&nbsp;<span class="ident" id="4972713">r</span><span class="op" id="4972714">}</span><br>
<span class="lineno"></span><span class="op" id="4972716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972719">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="4972792">type</span>&nbsp;<span class="ident" id="4972797">Paletted</span>&nbsp;<span class="keyword" id="4972806">struct</span>&nbsp;<span class="op" id="4972813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4972816">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4972883">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4972951">Pix</span>&nbsp;<span class="op" id="4972955">[</span><span class="op" id="4972956">]</span><span class="builtintype" id="4972957">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4972964">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973040">Stride</span>&nbsp;<span class="builtintype" id="4973047">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4973052">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973084">Rect</span>&nbsp;<span class="ident" id="4973089">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4973100">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973136">Palette</span>&nbsp;<span class="ident" id="4973144">color</span><span class="op" id="4973149">.</span><span class="ident" id="4973150">Palette</span><br>
<span class="lineno">840</span><span class="op" id="4973158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4973161">func</span>&nbsp;<span class="op" id="4973166">(</span><span class="ident" id="4973167">p</span>&nbsp;<span class="op" id="4973169">*</span><span class="ident" id="4973170">Paletted</span><span class="op" id="4973178">)</span>&nbsp;<span class="ident" id="4973180">ColorModel</span><span class="op" id="4973190">(</span><span class="op" id="4973191">)</span>&nbsp;<span class="ident" id="4973193">color</span><span class="op" id="4973198">.</span><span class="ident" id="4973199">Model</span>&nbsp;<span class="op" id="4973205">{</span>&nbsp;<span class="keyword" id="4973207">return</span>&nbsp;<span class="ident" id="4973214">p</span><span class="op" id="4973215">.</span><span class="ident" id="4973216">Palette</span>&nbsp;<span class="op" id="4973224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4973227">func</span>&nbsp;<span class="op" id="4973232">(</span><span class="ident" id="4973233">p</span>&nbsp;<span class="op" id="4973235">*</span><span class="ident" id="4973236">Paletted</span><span class="op" id="4973244">)</span>&nbsp;<span class="ident" id="4973246">Bounds</span><span class="op" id="4973252">(</span><span class="op" id="4973253">)</span>&nbsp;<span class="ident" id="4973255">Rectangle</span>&nbsp;<span class="op" id="4973265">{</span>&nbsp;<span class="keyword" id="4973267">return</span>&nbsp;<span class="ident" id="4973274">p</span><span class="op" id="4973275">.</span><span class="ident" id="4973276">Rect</span>&nbsp;<span class="op" id="4973281">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="4973284">func</span>&nbsp;<span class="op" id="4973289">(</span><span class="ident" id="4973290">p</span>&nbsp;<span class="op" id="4973292">*</span><span class="ident" id="4973293">Paletted</span><span class="op" id="4973301">)</span>&nbsp;<span class="ident" id="4973303">At</span><span class="op" id="4973305">(</span><span class="ident" id="4973306">x</span><span class="op" id="4973307">,</span>&nbsp;<span class="ident" id="4973309">y</span>&nbsp;<span class="builtintype" id="4973311">int</span><span class="op" id="4973314">)</span>&nbsp;<span class="ident" id="4973316">color</span><span class="op" id="4973321">.</span><span class="ident" id="4973322">Color</span>&nbsp;<span class="op" id="4973328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973331">if</span>&nbsp;<span class="builtinfunc" id="4973334">len</span><span class="op" id="4973337">(</span><span class="ident" id="4973338">p</span><span class="op" id="4973339">.</span><span class="ident" id="4973340">Palette</span><span class="op" id="4973347">)</span>&nbsp;<span class="op" id="4973349">==</span>&nbsp;<span class="num" id="4973352">0</span>&nbsp;<span class="op" id="4973354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973358">return</span>&nbsp;<span class="builtintype" id="4973365">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4973370">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973373">if</span>&nbsp;<span class="op" id="4973376">!</span><span class="op" id="4973377">(</span><span class="ident" id="4973378">Point</span><span class="op" id="4973383">{</span><span class="ident" id="4973384">x</span><span class="op" id="4973385">,</span>&nbsp;<span class="ident" id="4973387">y</span><span class="op" id="4973388">}</span><span class="op" id="4973389">.</span><span class="ident" id="4973390">In</span><span class="op" id="4973392">(</span><span class="ident" id="4973393">p</span><span class="op" id="4973394">.</span><span class="ident" id="4973395">Rect</span><span class="op" id="4973399">)</span><span class="op" id="4973400">)</span>&nbsp;<span class="op" id="4973402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973406">return</span>&nbsp;<span class="ident" id="4973413">p</span><span class="op" id="4973414">.</span><span class="ident" id="4973415">Palette</span><span class="op" id="4973422">[</span><span class="num" id="4973423">0</span><span class="op" id="4973424">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4973427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973430">i</span>&nbsp;<span class="op" id="4973432">:=</span>&nbsp;<span class="ident" id="4973435">p</span><span class="op" id="4973436">.</span><span class="ident" id="4973437">PixOffset</span><span class="op" id="4973446">(</span><span class="ident" id="4973447">x</span><span class="op" id="4973448">,</span>&nbsp;<span class="ident" id="4973450">y</span><span class="op" id="4973451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973454">return</span>&nbsp;<span class="ident" id="4973461">p</span><span class="op" id="4973462">.</span><span class="ident" id="4973463">Palette</span><span class="op" id="4973470">[</span><span class="ident" id="4973471">p</span><span class="op" id="4973472">.</span><span class="ident" id="4973473">Pix</span><span class="op" id="4973476">[</span><span class="ident" id="4973477">i</span><span class="op" id="4973478">]</span><span class="op" id="4973479">]</span><br>
<span class="lineno">855</span><span class="op" id="4973481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4973484">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4973563">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4973587">func</span>&nbsp;<span class="op" id="4973592">(</span><span class="ident" id="4973593">p</span>&nbsp;<span class="op" id="4973595">*</span><span class="ident" id="4973596">Paletted</span><span class="op" id="4973604">)</span>&nbsp;<span class="ident" id="4973606">PixOffset</span><span class="op" id="4973615">(</span><span class="ident" id="4973616">x</span><span class="op" id="4973617">,</span>&nbsp;<span class="ident" id="4973619">y</span>&nbsp;<span class="builtintype" id="4973621">int</span><span class="op" id="4973624">)</span>&nbsp;<span class="builtintype" id="4973626">int</span>&nbsp;<span class="op" id="4973630">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973633">return</span>&nbsp;<span class="op" id="4973640">(</span><span class="ident" id="4973641">y</span><span class="op" id="4973642">-</span><span class="ident" id="4973643">p</span><span class="op" id="4973644">.</span><span class="ident" id="4973645">Rect</span><span class="op" id="4973649">.</span><span class="ident" id="4973650">Min</span><span class="op" id="4973653">.</span><span class="ident" id="4973654">Y</span><span class="op" id="4973655">)</span><span class="op" id="4973656">*</span><span class="ident" id="4973657">p</span><span class="op" id="4973658">.</span><span class="ident" id="4973659">Stride</span>&nbsp;<span class="op" id="4973666">+</span>&nbsp;<span class="op" id="4973668">(</span><span class="ident" id="4973669">x</span><span class="op" id="4973670">-</span><span class="ident" id="4973671">p</span><span class="op" id="4973672">.</span><span class="ident" id="4973673">Rect</span><span class="op" id="4973677">.</span><span class="ident" id="4973678">Min</span><span class="op" id="4973681">.</span><span class="ident" id="4973682">X</span><span class="op" id="4973683">)</span><span class="op" id="4973684">*</span><span class="num" id="4973685">1</span><br>
<span class="lineno"></span><span class="op" id="4973687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4973690">func</span>&nbsp;<span class="op" id="4973695">(</span><span class="ident" id="4973696">p</span>&nbsp;<span class="op" id="4973698">*</span><span class="ident" id="4973699">Paletted</span><span class="op" id="4973707">)</span>&nbsp;<span class="ident" id="4973709">Set</span><span class="op" id="4973712">(</span><span class="ident" id="4973713">x</span><span class="op" id="4973714">,</span>&nbsp;<span class="ident" id="4973716">y</span>&nbsp;<span class="builtintype" id="4973718">int</span><span class="op" id="4973721">,</span>&nbsp;<span class="ident" id="4973723">c</span>&nbsp;<span class="ident" id="4973725">color</span><span class="op" id="4973730">.</span><span class="ident" id="4973731">Color</span><span class="op" id="4973736">)</span>&nbsp;<span class="op" id="4973738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973741">if</span>&nbsp;<span class="op" id="4973744">!</span><span class="op" id="4973745">(</span><span class="ident" id="4973746">Point</span><span class="op" id="4973751">{</span><span class="ident" id="4973752">x</span><span class="op" id="4973753">,</span>&nbsp;<span class="ident" id="4973755">y</span><span class="op" id="4973756">}</span><span class="op" id="4973757">.</span><span class="ident" id="4973758">In</span><span class="op" id="4973760">(</span><span class="ident" id="4973761">p</span><span class="op" id="4973762">.</span><span class="ident" id="4973763">Rect</span><span class="op" id="4973767">)</span><span class="op" id="4973768">)</span>&nbsp;<span class="op" id="4973770">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973774">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4973782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973785">i</span>&nbsp;<span class="op" id="4973787">:=</span>&nbsp;<span class="ident" id="4973790">p</span><span class="op" id="4973791">.</span><span class="ident" id="4973792">PixOffset</span><span class="op" id="4973801">(</span><span class="ident" id="4973802">x</span><span class="op" id="4973803">,</span>&nbsp;<span class="ident" id="4973805">y</span><span class="op" id="4973806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973809">p</span><span class="op" id="4973810">.</span><span class="ident" id="4973811">Pix</span><span class="op" id="4973814">[</span><span class="ident" id="4973815">i</span><span class="op" id="4973816">]</span>&nbsp;<span class="op" id="4973818">=</span>&nbsp;<span class="builtintype" id="4973820">uint8</span><span class="op" id="4973825">(</span><span class="ident" id="4973826">p</span><span class="op" id="4973827">.</span><span class="ident" id="4973828">Palette</span><span class="op" id="4973835">.</span><span class="ident" id="4973836">Index</span><span class="op" id="4973841">(</span><span class="ident" id="4973842">c</span><span class="op" id="4973843">)</span><span class="op" id="4973844">)</span><br>
<span class="lineno"></span><span class="op" id="4973846">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="4973849">func</span>&nbsp;<span class="op" id="4973854">(</span><span class="ident" id="4973855">p</span>&nbsp;<span class="op" id="4973857">*</span><span class="ident" id="4973858">Paletted</span><span class="op" id="4973866">)</span>&nbsp;<span class="ident" id="4973868">ColorIndexAt</span><span class="op" id="4973880">(</span><span class="ident" id="4973881">x</span><span class="op" id="4973882">,</span>&nbsp;<span class="ident" id="4973884">y</span>&nbsp;<span class="builtintype" id="4973886">int</span><span class="op" id="4973889">)</span>&nbsp;<span class="builtintype" id="4973891">uint8</span>&nbsp;<span class="op" id="4973897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973900">if</span>&nbsp;<span class="op" id="4973903">!</span><span class="op" id="4973904">(</span><span class="ident" id="4973905">Point</span><span class="op" id="4973910">{</span><span class="ident" id="4973911">x</span><span class="op" id="4973912">,</span>&nbsp;<span class="ident" id="4973914">y</span><span class="op" id="4973915">}</span><span class="op" id="4973916">.</span><span class="ident" id="4973917">In</span><span class="op" id="4973919">(</span><span class="ident" id="4973920">p</span><span class="op" id="4973921">.</span><span class="ident" id="4973922">Rect</span><span class="op" id="4973926">)</span><span class="op" id="4973927">)</span>&nbsp;<span class="op" id="4973929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973933">return</span>&nbsp;<span class="num" id="4973940">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4973943">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4973946">i</span>&nbsp;<span class="op" id="4973948">:=</span>&nbsp;<span class="ident" id="4973951">p</span><span class="op" id="4973952">.</span><span class="ident" id="4973953">PixOffset</span><span class="op" id="4973962">(</span><span class="ident" id="4973963">x</span><span class="op" id="4973964">,</span>&nbsp;<span class="ident" id="4973966">y</span><span class="op" id="4973967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4973970">return</span>&nbsp;<span class="ident" id="4973977">p</span><span class="op" id="4973978">.</span><span class="ident" id="4973979">Pix</span><span class="op" id="4973982">[</span><span class="ident" id="4973983">i</span><span class="op" id="4973984">]</span><br>
<span class="lineno"></span><span class="op" id="4973986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4973989">func</span>&nbsp;<span class="op" id="4973994">(</span><span class="ident" id="4973995">p</span>&nbsp;<span class="op" id="4973997">*</span><span class="ident" id="4973998">Paletted</span><span class="op" id="4974006">)</span>&nbsp;<span class="ident" id="4974008">SetColorIndex</span><span class="op" id="4974021">(</span><span class="ident" id="4974022">x</span><span class="op" id="4974023">,</span>&nbsp;<span class="ident" id="4974025">y</span>&nbsp;<span class="builtintype" id="4974027">int</span><span class="op" id="4974030">,</span>&nbsp;<span class="ident" id="4974032">index</span>&nbsp;<span class="builtintype" id="4974038">uint8</span><span class="op" id="4974043">)</span>&nbsp;<span class="op" id="4974045">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974048">if</span>&nbsp;<span class="op" id="4974051">!</span><span class="op" id="4974052">(</span><span class="ident" id="4974053">Point</span><span class="op" id="4974058">{</span><span class="ident" id="4974059">x</span><span class="op" id="4974060">,</span>&nbsp;<span class="ident" id="4974062">y</span><span class="op" id="4974063">}</span><span class="op" id="4974064">.</span><span class="ident" id="4974065">In</span><span class="op" id="4974067">(</span><span class="ident" id="4974068">p</span><span class="op" id="4974069">.</span><span class="ident" id="4974070">Rect</span><span class="op" id="4974074">)</span><span class="op" id="4974075">)</span>&nbsp;<span class="op" id="4974077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974081">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4974089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974092">i</span>&nbsp;<span class="op" id="4974094">:=</span>&nbsp;<span class="ident" id="4974097">p</span><span class="op" id="4974098">.</span><span class="ident" id="4974099">PixOffset</span><span class="op" id="4974108">(</span><span class="ident" id="4974109">x</span><span class="op" id="4974110">,</span>&nbsp;<span class="ident" id="4974112">y</span><span class="op" id="4974113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974116">p</span><span class="op" id="4974117">.</span><span class="ident" id="4974118">Pix</span><span class="op" id="4974121">[</span><span class="ident" id="4974122">i</span><span class="op" id="4974123">]</span>&nbsp;<span class="op" id="4974125">=</span>&nbsp;<span class="ident" id="4974127">index</span><br>
<span class="lineno">885</span><span class="op" id="4974133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4974136">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4974213">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4974285">func</span>&nbsp;<span class="op" id="4974290">(</span><span class="ident" id="4974291">p</span>&nbsp;<span class="op" id="4974293">*</span><span class="ident" id="4974294">Paletted</span><span class="op" id="4974302">)</span>&nbsp;<span class="ident" id="4974304">SubImage</span><span class="op" id="4974312">(</span><span class="ident" id="4974313">r</span>&nbsp;<span class="ident" id="4974315">Rectangle</span><span class="op" id="4974324">)</span>&nbsp;<span class="ident" id="4974326">Image</span>&nbsp;<span class="op" id="4974332">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974335">r</span>&nbsp;<span class="op" id="4974337">=</span>&nbsp;<span class="ident" id="4974339">r</span><span class="op" id="4974340">.</span><span class="ident" id="4974341">Intersect</span><span class="op" id="4974350">(</span><span class="ident" id="4974351">p</span><span class="op" id="4974352">.</span><span class="ident" id="4974353">Rect</span><span class="op" id="4974357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4974360">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4974441">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4974523">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974573">if</span>&nbsp;<span class="ident" id="4974576">r</span><span class="op" id="4974577">.</span><span class="ident" id="4974578">Empty</span><span class="op" id="4974583">(</span><span class="op" id="4974584">)</span>&nbsp;<span class="op" id="4974586">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974590">return</span>&nbsp;<span class="op" id="4974597">&amp;</span><span class="ident" id="4974598">Paletted</span><span class="op" id="4974606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974611">Palette</span><span class="op" id="4974618">:</span>&nbsp;<span class="ident" id="4974620">p</span><span class="op" id="4974621">.</span><span class="ident" id="4974622">Palette</span><span class="op" id="4974629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4974633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4974636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974639">i</span>&nbsp;<span class="op" id="4974641">:=</span>&nbsp;<span class="ident" id="4974644">p</span><span class="op" id="4974645">.</span><span class="ident" id="4974646">PixOffset</span><span class="op" id="4974655">(</span><span class="ident" id="4974656">r</span><span class="op" id="4974657">.</span><span class="ident" id="4974658">Min</span><span class="op" id="4974661">.</span><span class="ident" id="4974662">X</span><span class="op" id="4974663">,</span>&nbsp;<span class="ident" id="4974665">r</span><span class="op" id="4974666">.</span><span class="ident" id="4974667">Min</span><span class="op" id="4974670">.</span><span class="ident" id="4974671">Y</span><span class="op" id="4974672">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974675">return</span>&nbsp;<span class="op" id="4974682">&amp;</span><span class="ident" id="4974683">Paletted</span><span class="op" id="4974691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974695">Pix</span><span class="op" id="4974698">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974704">p</span><span class="op" id="4974705">.</span><span class="ident" id="4974706">Pix</span><span class="op" id="4974709">[</span><span class="ident" id="4974710">i</span><span class="op" id="4974711">:</span><span class="op" id="4974712">]</span><span class="op" id="4974713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974717">Stride</span><span class="op" id="4974723">:</span>&nbsp;&nbsp;<span class="ident" id="4974726">p</span><span class="op" id="4974727">.</span><span class="ident" id="4974728">Stride</span><span class="op" id="4974734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974738">Rect</span><span class="op" id="4974742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974747">p</span><span class="op" id="4974748">.</span><span class="ident" id="4974749">Rect</span><span class="op" id="4974753">.</span><span class="ident" id="4974754">Intersect</span><span class="op" id="4974763">(</span><span class="ident" id="4974764">r</span><span class="op" id="4974765">)</span><span class="op" id="4974766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974770">Palette</span><span class="op" id="4974777">:</span>&nbsp;<span class="ident" id="4974779">p</span><span class="op" id="4974780">.</span><span class="ident" id="4974781">Palette</span><span class="op" id="4974788">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4974791">}</span><br>
<span class="lineno"></span><span class="op" id="4974793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4974796">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4974869">func</span>&nbsp;<span class="op" id="4974874">(</span><span class="ident" id="4974875">p</span>&nbsp;<span class="op" id="4974877">*</span><span class="ident" id="4974878">Paletted</span><span class="op" id="4974886">)</span>&nbsp;<span class="ident" id="4974888">Opaque</span><span class="op" id="4974894">(</span><span class="op" id="4974895">)</span>&nbsp;<span class="builtintype" id="4974897">bool</span>&nbsp;<span class="op" id="4974902">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974905">var</span>&nbsp;<span class="ident" id="4974909">present</span>&nbsp;<span class="op" id="4974917">[</span><span class="num" id="4974918">256</span><span class="op" id="4974921">]</span><span class="builtintype" id="4974922">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4974928">i0</span><span class="op" id="4974930">,</span>&nbsp;<span class="ident" id="4974932">i1</span>&nbsp;<span class="op" id="4974935">:=</span>&nbsp;<span class="num" id="4974938">0</span><span class="op" id="4974939">,</span>&nbsp;<span class="ident" id="4974941">p</span><span class="op" id="4974942">.</span><span class="ident" id="4974943">Rect</span><span class="op" id="4974947">.</span><span class="ident" id="4974948">Dx</span><span class="op" id="4974950">(</span><span class="op" id="4974951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4974954">for</span>&nbsp;<span class="ident" id="4974958">y</span>&nbsp;<span class="op" id="4974960">:=</span>&nbsp;<span class="ident" id="4974963">p</span><span class="op" id="4974964">.</span><span class="ident" id="4974965">Rect</span><span class="op" id="4974969">.</span><span class="ident" id="4974970">Min</span><span class="op" id="4974973">.</span><span class="ident" id="4974974">Y</span><span class="op" id="4974975">;</span>&nbsp;<span class="ident" id="4974977">y</span>&nbsp;<span class="op" id="4974979">&lt;</span>&nbsp;<span class="ident" id="4974981">p</span><span class="op" id="4974982">.</span><span class="ident" id="4974983">Rect</span><span class="op" id="4974987">.</span><span class="ident" id="4974988">Max</span><span class="op" id="4974991">.</span><span class="ident" id="4974992">Y</span><span class="op" id="4974993">;</span>&nbsp;<span class="ident" id="4974995">y</span><span class="op" id="4974996">++</span>&nbsp;<span class="op" id="4974999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975003">for</span>&nbsp;<span class="ident" id="4975007">_</span><span class="op" id="4975008">,</span>&nbsp;<span class="ident" id="4975010">c</span>&nbsp;<span class="op" id="4975012">:=</span>&nbsp;<span class="keyword" id="4975015">range</span>&nbsp;<span class="ident" id="4975021">p</span><span class="op" id="4975022">.</span><span class="ident" id="4975023">Pix</span><span class="op" id="4975026">[</span><span class="ident" id="4975027">i0</span><span class="op" id="4975029">:</span><span class="ident" id="4975030">i1</span><span class="op" id="4975032">]</span>&nbsp;<span class="op" id="4975034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975039">present</span><span class="op" id="4975046">[</span><span class="ident" id="4975047">c</span><span class="op" id="4975048">]</span>&nbsp;<span class="op" id="4975050">=</span>&nbsp;<span class="builtintype" id="4975052">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4975059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975063">i0</span>&nbsp;<span class="op" id="4975066">+=</span>&nbsp;<span class="ident" id="4975069">p</span><span class="op" id="4975070">.</span><span class="ident" id="4975071">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975080">i1</span>&nbsp;<span class="op" id="4975083">+=</span>&nbsp;<span class="ident" id="4975086">p</span><span class="op" id="4975087">.</span><span class="ident" id="4975088">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4975096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975099">for</span>&nbsp;<span class="ident" id="4975103">i</span><span class="op" id="4975104">,</span>&nbsp;<span class="ident" id="4975106">c</span>&nbsp;<span class="op" id="4975108">:=</span>&nbsp;<span class="keyword" id="4975111">range</span>&nbsp;<span class="ident" id="4975117">p</span><span class="op" id="4975118">.</span><span class="ident" id="4975119">Palette</span>&nbsp;<span class="op" id="4975127">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975131">if</span>&nbsp;<span class="op" id="4975134">!</span><span class="ident" id="4975135">present</span><span class="op" id="4975142">[</span><span class="ident" id="4975143">i</span><span class="op" id="4975144">]</span>&nbsp;<span class="op" id="4975146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975151">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4975162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975166">_</span><span class="op" id="4975167">,</span>&nbsp;<span class="ident" id="4975169">_</span><span class="op" id="4975170">,</span>&nbsp;<span class="ident" id="4975172">_</span><span class="op" id="4975173">,</span>&nbsp;<span class="ident" id="4975175">a</span>&nbsp;<span class="op" id="4975177">:=</span>&nbsp;<span class="ident" id="4975180">c</span><span class="op" id="4975181">.</span><span class="ident" id="4975182">RGBA</span><span class="op" id="4975186">(</span><span class="op" id="4975187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975191">if</span>&nbsp;<span class="ident" id="4975194">a</span>&nbsp;<span class="op" id="4975196">!=</span>&nbsp;<span class="num" id="4975199">0xffff</span>&nbsp;<span class="op" id="4975206">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975211">return</span>&nbsp;<span class="builtintype" id="4975218">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4975226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4975229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975232">return</span>&nbsp;<span class="builtintype" id="4975239">true</span><br>
<span class="lineno"></span><span class="op" id="4975244">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="4975247">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="4975327">func</span>&nbsp;<span class="ident" id="4975332">NewPaletted</span><span class="op" id="4975343">(</span><span class="ident" id="4975344">r</span>&nbsp;<span class="ident" id="4975346">Rectangle</span><span class="op" id="4975355">,</span>&nbsp;<span class="ident" id="4975357">p</span>&nbsp;<span class="ident" id="4975359">color</span><span class="op" id="4975364">.</span><span class="ident" id="4975365">Palette</span><span class="op" id="4975372">)</span>&nbsp;<span class="op" id="4975374">*</span><span class="ident" id="4975375">Paletted</span>&nbsp;<span class="op" id="4975384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975387">w</span><span class="op" id="4975388">,</span>&nbsp;<span class="ident" id="4975390">h</span>&nbsp;<span class="op" id="4975392">:=</span>&nbsp;<span class="ident" id="4975395">r</span><span class="op" id="4975396">.</span><span class="ident" id="4975397">Dx</span><span class="op" id="4975399">(</span><span class="op" id="4975400">)</span><span class="op" id="4975401">,</span>&nbsp;<span class="ident" id="4975403">r</span><span class="op" id="4975404">.</span><span class="ident" id="4975405">Dy</span><span class="op" id="4975407">(</span><span class="op" id="4975408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975411">pix</span>&nbsp;<span class="op" id="4975415">:=</span>&nbsp;<span class="builtinfunc" id="4975418">make</span><span class="op" id="4975422">(</span><span class="op" id="4975423">[</span><span class="op" id="4975424">]</span><span class="builtintype" id="4975425">uint8</span><span class="op" id="4975430">,</span>&nbsp;<span class="num" id="4975432">1</span><span class="op" id="4975433">*</span><span class="ident" id="4975434">w</span><span class="op" id="4975435">*</span><span class="ident" id="4975436">h</span><span class="op" id="4975437">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975440">return</span>&nbsp;<span class="op" id="4975447">&amp;</span><span class="ident" id="4975448">Paletted</span><span class="op" id="4975456">{</span><span class="ident" id="4975457">pix</span><span class="op" id="4975460">,</span>&nbsp;<span class="num" id="4975462">1</span>&nbsp;<span class="op" id="4975464">*</span>&nbsp;<span class="ident" id="4975466">w</span><span class="op" id="4975467">,</span>&nbsp;<span class="ident" id="4975469">r</span><span class="op" id="4975470">,</span>&nbsp;<span class="ident" id="4975472">p</span><span class="op" id="4975473">}</span><br>
<span class="lineno"></span><span class="op" id="4975475">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
