<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html" class="current">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5702852">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5702908">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5702962">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5703013">package</span>&nbsp;<span class="ident" id="5703021">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5703026">import</span>&nbsp;<span class="op" id="5703033">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5703036">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5703043">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5703054">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5703065">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5703072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5703075">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="5703139">type</span>&nbsp;<span class="ident" id="5703144">typeInfo</span>&nbsp;<span class="keyword" id="5703153">struct</span>&nbsp;<span class="op" id="5703160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703163">xmlname</span>&nbsp;<span class="op" id="5703171">*</span><span class="ident" id="5703172">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703183">fields</span>&nbsp;&nbsp;<span class="op" id="5703191">[</span><span class="op" id="5703192">]</span><span class="ident" id="5703193">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="5703203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5703206">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5703279">type</span>&nbsp;<span class="ident" id="5703284">fieldInfo</span>&nbsp;<span class="keyword" id="5703294">struct</span>&nbsp;<span class="op" id="5703301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703304">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5703312">[</span><span class="op" id="5703313">]</span><span class="builtintype" id="5703314">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703319">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5703327">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703335">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5703343">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703351">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5703359">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703371">parents</span>&nbsp;<span class="op" id="5703379">[</span><span class="op" id="5703380">]</span><span class="builtintype" id="5703381">string</span><br>
<span class="lineno"></span><span class="op" id="5703388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5703391">type</span>&nbsp;<span class="ident" id="5703396">fieldFlags</span>&nbsp;<span class="builtintype" id="5703407">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5703412">const</span>&nbsp;<span class="op" id="5703418">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703421">fElement</span>&nbsp;<span class="ident" id="5703430">fieldFlags</span>&nbsp;<span class="op" id="5703441">=</span>&nbsp;<span class="num" id="5703443">1</span>&nbsp;<span class="op" id="5703445">&lt;&lt;</span>&nbsp;<span class="ident" id="5703448">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703454">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703461">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703472">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703483">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703493">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703500">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703513">fMode</span>&nbsp;<span class="op" id="5703519">=</span>&nbsp;<span class="ident" id="5703521">fElement</span>&nbsp;<span class="op" id="5703530">|</span>&nbsp;<span class="ident" id="5703532">fAttr</span>&nbsp;<span class="op" id="5703538">|</span>&nbsp;<span class="ident" id="5703540">fCharData</span>&nbsp;<span class="op" id="5703550">|</span>&nbsp;<span class="ident" id="5703552">fInnerXml</span>&nbsp;<span class="op" id="5703562">|</span>&nbsp;<span class="ident" id="5703564">fComment</span>&nbsp;<span class="op" id="5703573">|</span>&nbsp;<span class="ident" id="5703575">fAny</span><br>
<span class="lineno"></span><span class="op" id="5703580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5703583">var</span>&nbsp;<span class="ident" id="5703587">tinfoMap</span>&nbsp;<span class="op" id="5703596">=</span>&nbsp;<span class="builtinfunc" id="5703598">make</span><span class="op" id="5703602">(</span><span class="keyword" id="5703603">map</span><span class="op" id="5703606">[</span><span class="ident" id="5703607">reflect</span><span class="op" id="5703614">.</span><span class="ident" id="5703615">Type</span><span class="op" id="5703619">]</span><span class="op" id="5703620">*</span><span class="ident" id="5703621">typeInfo</span><span class="op" id="5703629">)</span><br>
<span class="lineno">45</span><span class="keyword" id="5703631">var</span>&nbsp;<span class="ident" id="5703635">tinfoLock</span>&nbsp;<span class="ident" id="5703645">sync</span><span class="op" id="5703649">.</span><span class="ident" id="5703650">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5703659">var</span>&nbsp;<span class="ident" id="5703663">nameType</span>&nbsp;<span class="op" id="5703672">=</span>&nbsp;<span class="ident" id="5703674">reflect</span><span class="op" id="5703681">.</span><span class="ident" id="5703682">TypeOf</span><span class="op" id="5703688">(</span><span class="ident" id="5703689">Name</span><span class="op" id="5703693">{</span><span class="op" id="5703694">}</span><span class="op" id="5703695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5703698">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="5703767">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="5703809">func</span>&nbsp;<span class="ident" id="5703814">getTypeInfo</span><span class="op" id="5703825">(</span><span class="ident" id="5703826">typ</span>&nbsp;<span class="ident" id="5703830">reflect</span><span class="op" id="5703837">.</span><span class="ident" id="5703838">Type</span><span class="op" id="5703842">)</span>&nbsp;<span class="op" id="5703844">(</span><span class="op" id="5703845">*</span><span class="ident" id="5703846">typeInfo</span><span class="op" id="5703854">,</span>&nbsp;<span class="builtintype" id="5703856">error</span><span class="op" id="5703861">)</span>&nbsp;<span class="op" id="5703863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703866">tinfoLock</span><span class="op" id="5703875">.</span><span class="ident" id="5703876">RLock</span><span class="op" id="5703881">(</span><span class="op" id="5703882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703885">tinfo</span><span class="op" id="5703890">,</span>&nbsp;<span class="ident" id="5703892">ok</span>&nbsp;<span class="op" id="5703895">:=</span>&nbsp;<span class="ident" id="5703898">tinfoMap</span><span class="op" id="5703906">[</span><span class="ident" id="5703907">typ</span><span class="op" id="5703910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703913">tinfoLock</span><span class="op" id="5703922">.</span><span class="ident" id="5703923">RUnlock</span><span class="op" id="5703930">(</span><span class="op" id="5703931">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5703934">if</span>&nbsp;<span class="ident" id="5703937">ok</span>&nbsp;<span class="op" id="5703940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5703944">return</span>&nbsp;<span class="ident" id="5703951">tinfo</span><span class="op" id="5703956">,</span>&nbsp;<span class="builtintype" id="5703958">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5703963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5703966">tinfo</span>&nbsp;<span class="op" id="5703972">=</span>&nbsp;<span class="op" id="5703974">&amp;</span><span class="ident" id="5703975">typeInfo</span><span class="op" id="5703983">{</span><span class="op" id="5703984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5703987">if</span>&nbsp;<span class="ident" id="5703990">typ</span><span class="op" id="5703993">.</span><span class="ident" id="5703994">Kind</span><span class="op" id="5703998">(</span><span class="op" id="5703999">)</span>&nbsp;<span class="op" id="5704001">==</span>&nbsp;<span class="ident" id="5704004">reflect</span><span class="op" id="5704011">.</span><span class="ident" id="5704012">Struct</span>&nbsp;<span class="op" id="5704019">&amp;&amp;</span>&nbsp;<span class="ident" id="5704022">typ</span>&nbsp;<span class="op" id="5704026">!=</span>&nbsp;<span class="ident" id="5704029">nameType</span>&nbsp;<span class="op" id="5704038">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704042">n</span>&nbsp;<span class="op" id="5704044">:=</span>&nbsp;<span class="ident" id="5704047">typ</span><span class="op" id="5704050">.</span><span class="ident" id="5704051">NumField</span><span class="op" id="5704059">(</span><span class="op" id="5704060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704064">for</span>&nbsp;<span class="ident" id="5704068">i</span>&nbsp;<span class="op" id="5704070">:=</span>&nbsp;<span class="num" id="5704073">0</span><span class="op" id="5704074">;</span>&nbsp;<span class="ident" id="5704076">i</span>&nbsp;<span class="op" id="5704078">&lt;</span>&nbsp;<span class="ident" id="5704080">n</span><span class="op" id="5704081">;</span>&nbsp;<span class="ident" id="5704083">i</span><span class="op" id="5704084">++</span>&nbsp;<span class="op" id="5704087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704092">f</span>&nbsp;<span class="op" id="5704094">:=</span>&nbsp;<span class="ident" id="5704097">typ</span><span class="op" id="5704100">.</span><span class="ident" id="5704101">Field</span><span class="op" id="5704106">(</span><span class="ident" id="5704107">i</span><span class="op" id="5704108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704113">if</span>&nbsp;<span class="ident" id="5704116">f</span><span class="op" id="5704117">.</span><span class="ident" id="5704118">PkgPath</span>&nbsp;<span class="op" id="5704126">!=</span>&nbsp;<span class="string" id="5704129">&#34;&#34;</span>&nbsp;<span class="op" id="5704132">||</span>&nbsp;<span class="ident" id="5704135">f</span><span class="op" id="5704136">.</span><span class="ident" id="5704137">Tag</span><span class="op" id="5704140">.</span><span class="ident" id="5704141">Get</span><span class="op" id="5704144">(</span><span class="string" id="5704145">&#34;xml&#34;</span><span class="op" id="5704150">)</span>&nbsp;<span class="op" id="5704152">==</span>&nbsp;<span class="string" id="5704155">&#34;-&#34;</span>&nbsp;<span class="op" id="5704159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704165">continue</span>&nbsp;<span class="comment" id="5704174">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5704200">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704246">if</span>&nbsp;<span class="ident" id="5704249">f</span><span class="op" id="5704250">.</span><span class="ident" id="5704251">Anonymous</span>&nbsp;<span class="op" id="5704261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704267">t</span>&nbsp;<span class="op" id="5704269">:=</span>&nbsp;<span class="ident" id="5704272">f</span><span class="op" id="5704273">.</span><span class="ident" id="5704274">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704283">if</span>&nbsp;<span class="ident" id="5704286">t</span><span class="op" id="5704287">.</span><span class="ident" id="5704288">Kind</span><span class="op" id="5704292">(</span><span class="op" id="5704293">)</span>&nbsp;<span class="op" id="5704295">==</span>&nbsp;<span class="ident" id="5704298">reflect</span><span class="op" id="5704305">.</span><span class="ident" id="5704306">Ptr</span>&nbsp;<span class="op" id="5704310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704317">t</span>&nbsp;<span class="op" id="5704319">=</span>&nbsp;<span class="ident" id="5704321">t</span><span class="op" id="5704322">.</span><span class="ident" id="5704323">Elem</span><span class="op" id="5704327">(</span><span class="op" id="5704328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704340">if</span>&nbsp;<span class="ident" id="5704343">t</span><span class="op" id="5704344">.</span><span class="ident" id="5704345">Kind</span><span class="op" id="5704349">(</span><span class="op" id="5704350">)</span>&nbsp;<span class="op" id="5704352">==</span>&nbsp;<span class="ident" id="5704355">reflect</span><span class="op" id="5704362">.</span><span class="ident" id="5704363">Struct</span>&nbsp;<span class="op" id="5704370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704377">inner</span><span class="op" id="5704382">,</span>&nbsp;<span class="ident" id="5704384">err</span>&nbsp;<span class="op" id="5704388">:=</span>&nbsp;<span class="ident" id="5704391">getTypeInfo</span><span class="op" id="5704402">(</span><span class="ident" id="5704403">t</span><span class="op" id="5704404">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704411">if</span>&nbsp;<span class="ident" id="5704414">err</span>&nbsp;<span class="op" id="5704418">!=</span>&nbsp;<span class="builtintype" id="5704421">nil</span>&nbsp;<span class="op" id="5704425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704433">return</span>&nbsp;<span class="builtintype" id="5704440">nil</span><span class="op" id="5704443">,</span>&nbsp;<span class="ident" id="5704445">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704461">if</span>&nbsp;<span class="ident" id="5704464">tinfo</span><span class="op" id="5704469">.</span><span class="ident" id="5704470">xmlname</span>&nbsp;<span class="op" id="5704478">==</span>&nbsp;<span class="builtintype" id="5704481">nil</span>&nbsp;<span class="op" id="5704485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704493">tinfo</span><span class="op" id="5704498">.</span><span class="ident" id="5704499">xmlname</span>&nbsp;<span class="op" id="5704507">=</span>&nbsp;<span class="ident" id="5704509">inner</span><span class="op" id="5704514">.</span><span class="ident" id="5704515">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704535">for</span>&nbsp;<span class="ident" id="5704539">_</span><span class="op" id="5704540">,</span>&nbsp;<span class="ident" id="5704542">finfo</span>&nbsp;<span class="op" id="5704548">:=</span>&nbsp;<span class="keyword" id="5704551">range</span>&nbsp;<span class="ident" id="5704557">inner</span><span class="op" id="5704562">.</span><span class="ident" id="5704563">fields</span>&nbsp;<span class="op" id="5704570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704578">finfo</span><span class="op" id="5704583">.</span><span class="ident" id="5704584">idx</span>&nbsp;<span class="op" id="5704588">=</span>&nbsp;<span class="builtinfunc" id="5704590">append</span><span class="op" id="5704596">(</span><span class="op" id="5704597">[</span><span class="op" id="5704598">]</span><span class="builtintype" id="5704599">int</span><span class="op" id="5704602">{</span><span class="ident" id="5704603">i</span><span class="op" id="5704604">}</span><span class="op" id="5704605">,</span>&nbsp;<span class="ident" id="5704607">finfo</span><span class="op" id="5704612">.</span><span class="ident" id="5704613">idx</span><span class="op" id="5704616">...</span><span class="op" id="5704619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704627">if</span>&nbsp;<span class="ident" id="5704630">err</span>&nbsp;<span class="op" id="5704634">:=</span>&nbsp;<span class="ident" id="5704637">addFieldInfo</span><span class="op" id="5704649">(</span><span class="ident" id="5704650">typ</span><span class="op" id="5704653">,</span>&nbsp;<span class="ident" id="5704655">tinfo</span><span class="op" id="5704660">,</span>&nbsp;<span class="op" id="5704662">&amp;</span><span class="ident" id="5704663">finfo</span><span class="op" id="5704668">)</span><span class="op" id="5704669">;</span>&nbsp;<span class="ident" id="5704671">err</span>&nbsp;<span class="op" id="5704675">!=</span>&nbsp;<span class="builtintype" id="5704678">nil</span>&nbsp;<span class="op" id="5704682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704691">return</span>&nbsp;<span class="builtintype" id="5704698">nil</span><span class="op" id="5704701">,</span>&nbsp;<span class="ident" id="5704703">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704727">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704745">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704751">finfo</span><span class="op" id="5704756">,</span>&nbsp;<span class="ident" id="5704758">err</span>&nbsp;<span class="op" id="5704762">:=</span>&nbsp;<span class="ident" id="5704765">structFieldInfo</span><span class="op" id="5704780">(</span><span class="ident" id="5704781">typ</span><span class="op" id="5704784">,</span>&nbsp;<span class="op" id="5704786">&amp;</span><span class="ident" id="5704787">f</span><span class="op" id="5704788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704793">if</span>&nbsp;<span class="ident" id="5704796">err</span>&nbsp;<span class="op" id="5704800">!=</span>&nbsp;<span class="builtintype" id="5704803">nil</span>&nbsp;<span class="op" id="5704807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704813">return</span>&nbsp;<span class="builtintype" id="5704820">nil</span><span class="op" id="5704823">,</span>&nbsp;<span class="ident" id="5704825">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704832">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704838">if</span>&nbsp;<span class="ident" id="5704841">f</span><span class="op" id="5704842">.</span><span class="ident" id="5704843">Name</span>&nbsp;<span class="op" id="5704848">==</span>&nbsp;<span class="string" id="5704851">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5704861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5704867">tinfo</span><span class="op" id="5704872">.</span><span class="ident" id="5704873">xmlname</span>&nbsp;<span class="op" id="5704881">=</span>&nbsp;<span class="ident" id="5704883">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704893">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5704905">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5704911">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5704973">if</span>&nbsp;<span class="ident" id="5704976">err</span>&nbsp;<span class="op" id="5704980">:=</span>&nbsp;<span class="ident" id="5704983">addFieldInfo</span><span class="op" id="5704995">(</span><span class="ident" id="5704996">typ</span><span class="op" id="5704999">,</span>&nbsp;<span class="ident" id="5705001">tinfo</span><span class="op" id="5705006">,</span>&nbsp;<span class="ident" id="5705008">finfo</span><span class="op" id="5705013">)</span><span class="op" id="5705014">;</span>&nbsp;<span class="ident" id="5705016">err</span>&nbsp;<span class="op" id="5705020">!=</span>&nbsp;<span class="builtintype" id="5705023">nil</span>&nbsp;<span class="op" id="5705027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705033">return</span>&nbsp;<span class="builtintype" id="5705040">nil</span><span class="op" id="5705043">,</span>&nbsp;<span class="ident" id="5705045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705052">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705062">tinfoLock</span><span class="op" id="5705071">.</span><span class="ident" id="5705072">Lock</span><span class="op" id="5705076">(</span><span class="op" id="5705077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705080">tinfoMap</span><span class="op" id="5705088">[</span><span class="ident" id="5705089">typ</span><span class="op" id="5705092">]</span>&nbsp;<span class="op" id="5705094">=</span>&nbsp;<span class="ident" id="5705096">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705103">tinfoLock</span><span class="op" id="5705112">.</span><span class="ident" id="5705113">Unlock</span><span class="op" id="5705119">(</span><span class="op" id="5705120">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705123">return</span>&nbsp;<span class="ident" id="5705130">tinfo</span><span class="op" id="5705135">,</span>&nbsp;<span class="builtintype" id="5705137">nil</span><br>
<span class="lineno"></span><span class="op" id="5705141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5705144">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5705201">func</span>&nbsp;<span class="ident" id="5705206">structFieldInfo</span><span class="op" id="5705221">(</span><span class="ident" id="5705222">typ</span>&nbsp;<span class="ident" id="5705226">reflect</span><span class="op" id="5705233">.</span><span class="ident" id="5705234">Type</span><span class="op" id="5705238">,</span>&nbsp;<span class="ident" id="5705240">f</span>&nbsp;<span class="op" id="5705242">*</span><span class="ident" id="5705243">reflect</span><span class="op" id="5705250">.</span><span class="ident" id="5705251">StructField</span><span class="op" id="5705262">)</span>&nbsp;<span class="op" id="5705264">(</span><span class="op" id="5705265">*</span><span class="ident" id="5705266">fieldInfo</span><span class="op" id="5705275">,</span>&nbsp;<span class="builtintype" id="5705277">error</span><span class="op" id="5705282">)</span>&nbsp;<span class="op" id="5705284">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705287">finfo</span>&nbsp;<span class="op" id="5705293">:=</span>&nbsp;<span class="op" id="5705296">&amp;</span><span class="ident" id="5705297">fieldInfo</span><span class="op" id="5705306">{</span><span class="ident" id="5705307">idx</span><span class="op" id="5705310">:</span>&nbsp;<span class="ident" id="5705312">f</span><span class="op" id="5705313">.</span><span class="ident" id="5705314">Index</span><span class="op" id="5705319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5705323">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705378">tag</span>&nbsp;<span class="op" id="5705382">:=</span>&nbsp;<span class="ident" id="5705385">f</span><span class="op" id="5705386">.</span><span class="ident" id="5705387">Tag</span><span class="op" id="5705390">.</span><span class="ident" id="5705391">Get</span><span class="op" id="5705394">(</span><span class="string" id="5705395">&#34;xml&#34;</span><span class="op" id="5705400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705403">if</span>&nbsp;<span class="ident" id="5705406">i</span>&nbsp;<span class="op" id="5705408">:=</span>&nbsp;<span class="ident" id="5705411">strings</span><span class="op" id="5705418">.</span><span class="ident" id="5705419">Index</span><span class="op" id="5705424">(</span><span class="ident" id="5705425">tag</span><span class="op" id="5705428">,</span>&nbsp;<span class="string" id="5705430">&#34;&nbsp;&#34;</span><span class="op" id="5705433">)</span><span class="op" id="5705434">;</span>&nbsp;<span class="ident" id="5705436">i</span>&nbsp;<span class="op" id="5705438">&gt;=</span>&nbsp;<span class="num" id="5705441">0</span>&nbsp;<span class="op" id="5705443">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705447">finfo</span><span class="op" id="5705452">.</span><span class="ident" id="5705453">xmlns</span><span class="op" id="5705458">,</span>&nbsp;<span class="ident" id="5705460">tag</span>&nbsp;<span class="op" id="5705464">=</span>&nbsp;<span class="ident" id="5705466">tag</span><span class="op" id="5705469">[</span><span class="op" id="5705470">:</span><span class="ident" id="5705471">i</span><span class="op" id="5705472">]</span><span class="op" id="5705473">,</span>&nbsp;<span class="ident" id="5705475">tag</span><span class="op" id="5705478">[</span><span class="ident" id="5705479">i</span><span class="op" id="5705480">+</span><span class="num" id="5705481">1</span><span class="op" id="5705482">:</span><span class="op" id="5705483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5705490">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705507">tokens</span>&nbsp;<span class="op" id="5705514">:=</span>&nbsp;<span class="ident" id="5705517">strings</span><span class="op" id="5705524">.</span><span class="ident" id="5705525">Split</span><span class="op" id="5705530">(</span><span class="ident" id="5705531">tag</span><span class="op" id="5705534">,</span>&nbsp;<span class="string" id="5705536">&#34;,&#34;</span><span class="op" id="5705539">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705542">if</span>&nbsp;<span class="builtinfunc" id="5705545">len</span><span class="op" id="5705548">(</span><span class="ident" id="5705549">tokens</span><span class="op" id="5705555">)</span>&nbsp;<span class="op" id="5705557">==</span>&nbsp;<span class="num" id="5705560">1</span>&nbsp;<span class="op" id="5705562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705566">finfo</span><span class="op" id="5705571">.</span><span class="ident" id="5705572">flags</span>&nbsp;<span class="op" id="5705578">=</span>&nbsp;<span class="ident" id="5705580">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705590">}</span>&nbsp;<span class="keyword" id="5705592">else</span>&nbsp;<span class="op" id="5705597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705601">tag</span>&nbsp;<span class="op" id="5705605">=</span>&nbsp;<span class="ident" id="5705607">tokens</span><span class="op" id="5705613">[</span><span class="num" id="5705614">0</span><span class="op" id="5705615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705619">for</span>&nbsp;<span class="ident" id="5705623">_</span><span class="op" id="5705624">,</span>&nbsp;<span class="ident" id="5705626">flag</span>&nbsp;<span class="op" id="5705631">:=</span>&nbsp;<span class="keyword" id="5705634">range</span>&nbsp;<span class="ident" id="5705640">tokens</span><span class="op" id="5705646">[</span><span class="num" id="5705647">1</span><span class="op" id="5705648">:</span><span class="op" id="5705649">]</span>&nbsp;<span class="op" id="5705651">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705656">switch</span>&nbsp;<span class="ident" id="5705663">flag</span>&nbsp;<span class="op" id="5705668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705673">case</span>&nbsp;<span class="string" id="5705678">&#34;attr&#34;</span><span class="op" id="5705684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705690">finfo</span><span class="op" id="5705695">.</span><span class="ident" id="5705696">flags</span>&nbsp;<span class="op" id="5705702">|=</span>&nbsp;<span class="ident" id="5705705">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705714">case</span>&nbsp;<span class="string" id="5705719">&#34;chardata&#34;</span><span class="op" id="5705729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705735">finfo</span><span class="op" id="5705740">.</span><span class="ident" id="5705741">flags</span>&nbsp;<span class="op" id="5705747">|=</span>&nbsp;<span class="ident" id="5705750">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705763">case</span>&nbsp;<span class="string" id="5705768">&#34;innerxml&#34;</span><span class="op" id="5705778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705784">finfo</span><span class="op" id="5705789">.</span><span class="ident" id="5705790">flags</span>&nbsp;<span class="op" id="5705796">|=</span>&nbsp;<span class="ident" id="5705799">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705812">case</span>&nbsp;<span class="string" id="5705817">&#34;comment&#34;</span><span class="op" id="5705826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705832">finfo</span><span class="op" id="5705837">.</span><span class="ident" id="5705838">flags</span>&nbsp;<span class="op" id="5705844">|=</span>&nbsp;<span class="ident" id="5705847">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705859">case</span>&nbsp;<span class="string" id="5705864">&#34;any&#34;</span><span class="op" id="5705869">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705875">finfo</span><span class="op" id="5705880">.</span><span class="ident" id="5705881">flags</span>&nbsp;<span class="op" id="5705887">|=</span>&nbsp;<span class="ident" id="5705890">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5705898">case</span>&nbsp;<span class="string" id="5705903">&#34;omitempty&#34;</span><span class="op" id="5705914">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705920">finfo</span><span class="op" id="5705925">.</span><span class="ident" id="5705926">flags</span>&nbsp;<span class="op" id="5705932">|=</span>&nbsp;<span class="ident" id="5705935">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5705953">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5705958">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5705988">valid</span>&nbsp;<span class="op" id="5705994">:=</span>&nbsp;<span class="builtintype" id="5705997">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706004">switch</span>&nbsp;<span class="ident" id="5706011">mode</span>&nbsp;<span class="op" id="5706016">:=</span>&nbsp;<span class="ident" id="5706019">finfo</span><span class="op" id="5706024">.</span><span class="ident" id="5706025">flags</span>&nbsp;<span class="op" id="5706031">&amp;</span>&nbsp;<span class="ident" id="5706033">fMode</span><span class="op" id="5706038">;</span>&nbsp;<span class="ident" id="5706040">mode</span>&nbsp;<span class="op" id="5706045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706049">case</span>&nbsp;<span class="num" id="5706054">0</span><span class="op" id="5706055">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706060">finfo</span><span class="op" id="5706065">.</span><span class="ident" id="5706066">flags</span>&nbsp;<span class="op" id="5706072">|=</span>&nbsp;<span class="ident" id="5706075">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706086">case</span>&nbsp;<span class="ident" id="5706091">fAttr</span><span class="op" id="5706096">,</span>&nbsp;<span class="ident" id="5706098">fCharData</span><span class="op" id="5706107">,</span>&nbsp;<span class="ident" id="5706109">fInnerXml</span><span class="op" id="5706118">,</span>&nbsp;<span class="ident" id="5706120">fComment</span><span class="op" id="5706128">,</span>&nbsp;<span class="ident" id="5706130">fAny</span><span class="op" id="5706134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706139">if</span>&nbsp;<span class="ident" id="5706142">f</span><span class="op" id="5706143">.</span><span class="ident" id="5706144">Name</span>&nbsp;<span class="op" id="5706149">==</span>&nbsp;<span class="string" id="5706152">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5706162">||</span>&nbsp;<span class="ident" id="5706165">tag</span>&nbsp;<span class="op" id="5706169">!=</span>&nbsp;<span class="string" id="5706172">&#34;&#34;</span>&nbsp;<span class="op" id="5706175">&amp;&amp;</span>&nbsp;<span class="ident" id="5706178">mode</span>&nbsp;<span class="op" id="5706183">!=</span>&nbsp;<span class="ident" id="5706186">fAttr</span>&nbsp;<span class="op" id="5706192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706198">valid</span>&nbsp;<span class="op" id="5706204">=</span>&nbsp;<span class="builtintype" id="5706206">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706215">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706219">default</span><span class="op" id="5706226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5706231">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706292">valid</span>&nbsp;<span class="op" id="5706298">=</span>&nbsp;<span class="builtintype" id="5706300">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706312">if</span>&nbsp;<span class="ident" id="5706315">finfo</span><span class="op" id="5706320">.</span><span class="ident" id="5706321">flags</span><span class="op" id="5706326">&amp;</span><span class="ident" id="5706327">fMode</span>&nbsp;<span class="op" id="5706333">==</span>&nbsp;<span class="ident" id="5706336">fAny</span>&nbsp;<span class="op" id="5706341">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706346">finfo</span><span class="op" id="5706351">.</span><span class="ident" id="5706352">flags</span>&nbsp;<span class="op" id="5706358">|=</span>&nbsp;<span class="ident" id="5706361">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706376">if</span>&nbsp;<span class="ident" id="5706379">finfo</span><span class="op" id="5706384">.</span><span class="ident" id="5706385">flags</span><span class="op" id="5706390">&amp;</span><span class="ident" id="5706391">fOmitEmpty</span>&nbsp;<span class="op" id="5706402">!=</span>&nbsp;<span class="num" id="5706405">0</span>&nbsp;<span class="op" id="5706407">&amp;&amp;</span>&nbsp;<span class="ident" id="5706410">finfo</span><span class="op" id="5706415">.</span><span class="ident" id="5706416">flags</span><span class="op" id="5706421">&amp;</span><span class="op" id="5706422">(</span><span class="ident" id="5706423">fElement</span><span class="op" id="5706431">|</span><span class="ident" id="5706432">fAttr</span><span class="op" id="5706437">)</span>&nbsp;<span class="op" id="5706439">==</span>&nbsp;<span class="num" id="5706442">0</span>&nbsp;<span class="op" id="5706444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706449">valid</span>&nbsp;<span class="op" id="5706455">=</span>&nbsp;<span class="builtintype" id="5706457">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706465">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706469">if</span>&nbsp;<span class="op" id="5706472">!</span><span class="ident" id="5706473">valid</span>&nbsp;<span class="op" id="5706479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706484">return</span>&nbsp;<span class="builtintype" id="5706491">nil</span><span class="op" id="5706494">,</span>&nbsp;<span class="ident" id="5706496">fmt</span><span class="op" id="5706499">.</span><span class="ident" id="5706500">Errorf</span><span class="op" id="5706506">(</span><span class="string" id="5706507">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5706552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706558">f</span><span class="op" id="5706559">.</span><span class="ident" id="5706560">Name</span><span class="op" id="5706564">,</span>&nbsp;<span class="ident" id="5706566">typ</span><span class="op" id="5706569">,</span>&nbsp;<span class="ident" id="5706571">f</span><span class="op" id="5706572">.</span><span class="ident" id="5706573">Tag</span><span class="op" id="5706576">.</span><span class="ident" id="5706577">Get</span><span class="op" id="5706580">(</span><span class="string" id="5706581">&#34;xml&#34;</span><span class="op" id="5706586">)</span><span class="op" id="5706587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706594">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5706598">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706646">if</span>&nbsp;<span class="ident" id="5706649">finfo</span><span class="op" id="5706654">.</span><span class="ident" id="5706655">xmlns</span>&nbsp;<span class="op" id="5706661">!=</span>&nbsp;<span class="string" id="5706664">&#34;&#34;</span>&nbsp;<span class="op" id="5706667">&amp;&amp;</span>&nbsp;<span class="ident" id="5706670">tag</span>&nbsp;<span class="op" id="5706674">==</span>&nbsp;<span class="string" id="5706677">&#34;&#34;</span>&nbsp;<span class="op" id="5706680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706684">return</span>&nbsp;<span class="builtintype" id="5706691">nil</span><span class="op" id="5706694">,</span>&nbsp;<span class="ident" id="5706696">fmt</span><span class="op" id="5706699">.</span><span class="ident" id="5706700">Errorf</span><span class="op" id="5706706">(</span><span class="string" id="5706707">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5706763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706768">f</span><span class="op" id="5706769">.</span><span class="ident" id="5706770">Name</span><span class="op" id="5706774">,</span>&nbsp;<span class="ident" id="5706776">typ</span><span class="op" id="5706779">,</span>&nbsp;<span class="ident" id="5706781">f</span><span class="op" id="5706782">.</span><span class="ident" id="5706783">Tag</span><span class="op" id="5706786">.</span><span class="ident" id="5706787">Get</span><span class="op" id="5706790">(</span><span class="string" id="5706791">&#34;xml&#34;</span><span class="op" id="5706796">)</span><span class="op" id="5706797">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5706800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5706804">if</span>&nbsp;<span class="ident" id="5706807">f</span><span class="op" id="5706808">.</span><span class="ident" id="5706809">Name</span>&nbsp;<span class="op" id="5706814">==</span>&nbsp;<span class="string" id="5706817">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5706827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5706831">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5706890">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5706950">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5706992">finfo</span><span class="op" id="5706997">.</span><span class="ident" id="5706998">name</span>&nbsp;<span class="op" id="5707003">=</span>&nbsp;<span class="ident" id="5707005">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707011">return</span>&nbsp;<span class="ident" id="5707018">finfo</span><span class="op" id="5707023">,</span>&nbsp;<span class="builtintype" id="5707025">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707034">if</span>&nbsp;<span class="ident" id="5707037">tag</span>&nbsp;<span class="op" id="5707041">==</span>&nbsp;<span class="string" id="5707044">&#34;&#34;</span>&nbsp;<span class="op" id="5707047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707051">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707109">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707169">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707199">if</span>&nbsp;<span class="ident" id="5707202">xmlname</span>&nbsp;<span class="op" id="5707210">:=</span>&nbsp;<span class="ident" id="5707213">lookupXMLName</span><span class="op" id="5707226">(</span><span class="ident" id="5707227">f</span><span class="op" id="5707228">.</span><span class="ident" id="5707229">Type</span><span class="op" id="5707233">)</span><span class="op" id="5707234">;</span>&nbsp;<span class="ident" id="5707236">xmlname</span>&nbsp;<span class="op" id="5707244">!=</span>&nbsp;<span class="builtintype" id="5707247">nil</span>&nbsp;<span class="op" id="5707251">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5707256">finfo</span><span class="op" id="5707261">.</span><span class="ident" id="5707262">xmlns</span><span class="op" id="5707267">,</span>&nbsp;<span class="ident" id="5707269">finfo</span><span class="op" id="5707274">.</span><span class="ident" id="5707275">name</span>&nbsp;<span class="op" id="5707280">=</span>&nbsp;<span class="ident" id="5707282">xmlname</span><span class="op" id="5707289">.</span><span class="ident" id="5707290">xmlns</span><span class="op" id="5707295">,</span>&nbsp;<span class="ident" id="5707297">xmlname</span><span class="op" id="5707304">.</span><span class="ident" id="5707305">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707312">}</span>&nbsp;<span class="keyword" id="5707314">else</span>&nbsp;<span class="op" id="5707319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5707324">finfo</span><span class="op" id="5707329">.</span><span class="ident" id="5707330">name</span>&nbsp;<span class="op" id="5707335">=</span>&nbsp;<span class="ident" id="5707337">f</span><span class="op" id="5707338">.</span><span class="ident" id="5707339">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707350">return</span>&nbsp;<span class="ident" id="5707357">finfo</span><span class="op" id="5707362">,</span>&nbsp;<span class="builtintype" id="5707364">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707373">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5707409">parents</span>&nbsp;<span class="op" id="5707417">:=</span>&nbsp;<span class="ident" id="5707420">strings</span><span class="op" id="5707427">.</span><span class="ident" id="5707428">Split</span><span class="op" id="5707433">(</span><span class="ident" id="5707434">tag</span><span class="op" id="5707437">,</span>&nbsp;<span class="string" id="5707439">&#34;&gt;&#34;</span><span class="op" id="5707442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707445">if</span>&nbsp;<span class="ident" id="5707448">parents</span><span class="op" id="5707455">[</span><span class="num" id="5707456">0</span><span class="op" id="5707457">]</span>&nbsp;<span class="op" id="5707459">==</span>&nbsp;<span class="string" id="5707462">&#34;&#34;</span>&nbsp;<span class="op" id="5707465">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5707469">parents</span><span class="op" id="5707476">[</span><span class="num" id="5707477">0</span><span class="op" id="5707478">]</span>&nbsp;<span class="op" id="5707480">=</span>&nbsp;<span class="ident" id="5707482">f</span><span class="op" id="5707483">.</span><span class="ident" id="5707484">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707493">if</span>&nbsp;<span class="ident" id="5707496">parents</span><span class="op" id="5707503">[</span><span class="builtinfunc" id="5707504">len</span><span class="op" id="5707507">(</span><span class="ident" id="5707508">parents</span><span class="op" id="5707515">)</span><span class="op" id="5707516">-</span><span class="num" id="5707517">1</span><span class="op" id="5707518">]</span>&nbsp;<span class="op" id="5707520">==</span>&nbsp;<span class="string" id="5707523">&#34;&#34;</span>&nbsp;<span class="op" id="5707526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707530">return</span>&nbsp;<span class="builtintype" id="5707537">nil</span><span class="op" id="5707540">,</span>&nbsp;<span class="ident" id="5707542">fmt</span><span class="op" id="5707545">.</span><span class="ident" id="5707546">Errorf</span><span class="op" id="5707552">(</span><span class="string" id="5707553">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5707595">,</span>&nbsp;<span class="ident" id="5707597">f</span><span class="op" id="5707598">.</span><span class="ident" id="5707599">Name</span><span class="op" id="5707603">,</span>&nbsp;<span class="ident" id="5707605">typ</span><span class="op" id="5707608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707611">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5707614">finfo</span><span class="op" id="5707619">.</span><span class="ident" id="5707620">name</span>&nbsp;<span class="op" id="5707625">=</span>&nbsp;<span class="ident" id="5707627">parents</span><span class="op" id="5707634">[</span><span class="builtinfunc" id="5707635">len</span><span class="op" id="5707638">(</span><span class="ident" id="5707639">parents</span><span class="op" id="5707646">)</span><span class="op" id="5707647">-</span><span class="num" id="5707648">1</span><span class="op" id="5707649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707652">if</span>&nbsp;<span class="builtinfunc" id="5707655">len</span><span class="op" id="5707658">(</span><span class="ident" id="5707659">parents</span><span class="op" id="5707666">)</span>&nbsp;<span class="op" id="5707668">&gt;</span>&nbsp;<span class="num" id="5707670">1</span>&nbsp;<span class="op" id="5707672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707676">if</span>&nbsp;<span class="op" id="5707679">(</span><span class="ident" id="5707680">finfo</span><span class="op" id="5707685">.</span><span class="ident" id="5707686">flags</span>&nbsp;<span class="op" id="5707692">&amp;</span>&nbsp;<span class="ident" id="5707694">fElement</span><span class="op" id="5707702">)</span>&nbsp;<span class="op" id="5707704">==</span>&nbsp;<span class="num" id="5707707">0</span>&nbsp;<span class="op" id="5707709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5707714">return</span>&nbsp;<span class="builtintype" id="5707721">nil</span><span class="op" id="5707724">,</span>&nbsp;<span class="ident" id="5707726">fmt</span><span class="op" id="5707729">.</span><span class="ident" id="5707730">Errorf</span><span class="op" id="5707736">(</span><span class="string" id="5707737">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="5707775">,</span>&nbsp;<span class="ident" id="5707777">tag</span><span class="op" id="5707780">,</span>&nbsp;<span class="ident" id="5707782">strings</span><span class="op" id="5707789">.</span><span class="ident" id="5707790">Join</span><span class="op" id="5707794">(</span><span class="ident" id="5707795">tokens</span><span class="op" id="5707801">[</span><span class="num" id="5707802">1</span><span class="op" id="5707803">:</span><span class="op" id="5707804">]</span><span class="op" id="5707805">,</span>&nbsp;<span class="string" id="5707807">&#34;,&#34;</span><span class="op" id="5707810">)</span><span class="op" id="5707811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707815">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5707819">finfo</span><span class="op" id="5707824">.</span><span class="ident" id="5707825">parents</span>&nbsp;<span class="op" id="5707833">=</span>&nbsp;<span class="ident" id="5707835">parents</span><span class="op" id="5707842">[</span><span class="op" id="5707843">:</span><span class="builtinfunc" id="5707844">len</span><span class="op" id="5707847">(</span><span class="ident" id="5707848">parents</span><span class="op" id="5707855">)</span><span class="op" id="5707856">-</span><span class="num" id="5707857">1</span><span class="op" id="5707858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5707861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707865">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707930">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5707993">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708033">if</span>&nbsp;<span class="ident" id="5708036">finfo</span><span class="op" id="5708041">.</span><span class="ident" id="5708042">flags</span><span class="op" id="5708047">&amp;</span><span class="ident" id="5708048">fElement</span>&nbsp;<span class="op" id="5708057">!=</span>&nbsp;<span class="num" id="5708060">0</span>&nbsp;<span class="op" id="5708062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5708066">ftyp</span>&nbsp;<span class="op" id="5708071">:=</span>&nbsp;<span class="ident" id="5708074">f</span><span class="op" id="5708075">.</span><span class="ident" id="5708076">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5708083">xmlname</span>&nbsp;<span class="op" id="5708091">:=</span>&nbsp;<span class="ident" id="5708094">lookupXMLName</span><span class="op" id="5708107">(</span><span class="ident" id="5708108">ftyp</span><span class="op" id="5708112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708116">if</span>&nbsp;<span class="ident" id="5708119">xmlname</span>&nbsp;<span class="op" id="5708127">!=</span>&nbsp;<span class="builtintype" id="5708130">nil</span>&nbsp;<span class="op" id="5708134">&amp;&amp;</span>&nbsp;<span class="ident" id="5708137">xmlname</span><span class="op" id="5708144">.</span><span class="ident" id="5708145">name</span>&nbsp;<span class="op" id="5708150">!=</span>&nbsp;<span class="ident" id="5708153">finfo</span><span class="op" id="5708158">.</span><span class="ident" id="5708159">name</span>&nbsp;<span class="op" id="5708164">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708169">return</span>&nbsp;<span class="builtintype" id="5708176">nil</span><span class="op" id="5708179">,</span>&nbsp;<span class="ident" id="5708181">fmt</span><span class="op" id="5708184">.</span><span class="ident" id="5708185">Errorf</span><span class="op" id="5708191">(</span><span class="string" id="5708192">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="5708259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5708265">finfo</span><span class="op" id="5708270">.</span><span class="ident" id="5708271">name</span><span class="op" id="5708275">,</span>&nbsp;<span class="ident" id="5708277">typ</span><span class="op" id="5708280">,</span>&nbsp;<span class="ident" id="5708282">f</span><span class="op" id="5708283">.</span><span class="ident" id="5708284">Name</span><span class="op" id="5708288">,</span>&nbsp;<span class="ident" id="5708290">xmlname</span><span class="op" id="5708297">.</span><span class="ident" id="5708298">name</span><span class="op" id="5708302">,</span>&nbsp;<span class="ident" id="5708304">ftyp</span><span class="op" id="5708308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708318">return</span>&nbsp;<span class="ident" id="5708325">finfo</span><span class="op" id="5708330">,</span>&nbsp;<span class="builtintype" id="5708332">nil</span><br>
<span class="lineno">225</span><span class="op" id="5708336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5708339">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5708402">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="5708464">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="5708483">func</span>&nbsp;<span class="ident" id="5708488">lookupXMLName</span><span class="op" id="5708501">(</span><span class="ident" id="5708502">typ</span>&nbsp;<span class="ident" id="5708506">reflect</span><span class="op" id="5708513">.</span><span class="ident" id="5708514">Type</span><span class="op" id="5708518">)</span>&nbsp;<span class="op" id="5708520">(</span><span class="ident" id="5708521">xmlname</span>&nbsp;<span class="op" id="5708529">*</span><span class="ident" id="5708530">fieldInfo</span><span class="op" id="5708539">)</span>&nbsp;<span class="op" id="5708541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708544">for</span>&nbsp;<span class="ident" id="5708548">typ</span><span class="op" id="5708551">.</span><span class="ident" id="5708552">Kind</span><span class="op" id="5708556">(</span><span class="op" id="5708557">)</span>&nbsp;<span class="op" id="5708559">==</span>&nbsp;<span class="ident" id="5708562">reflect</span><span class="op" id="5708569">.</span><span class="ident" id="5708570">Ptr</span>&nbsp;<span class="op" id="5708574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5708578">typ</span>&nbsp;<span class="op" id="5708582">=</span>&nbsp;<span class="ident" id="5708584">typ</span><span class="op" id="5708587">.</span><span class="ident" id="5708588">Elem</span><span class="op" id="5708592">(</span><span class="op" id="5708593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708599">if</span>&nbsp;<span class="ident" id="5708602">typ</span><span class="op" id="5708605">.</span><span class="ident" id="5708606">Kind</span><span class="op" id="5708610">(</span><span class="op" id="5708611">)</span>&nbsp;<span class="op" id="5708613">!=</span>&nbsp;<span class="ident" id="5708616">reflect</span><span class="op" id="5708623">.</span><span class="ident" id="5708624">Struct</span>&nbsp;<span class="op" id="5708631">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708635">return</span>&nbsp;<span class="builtintype" id="5708642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708650">for</span>&nbsp;<span class="ident" id="5708654">i</span><span class="op" id="5708655">,</span>&nbsp;<span class="ident" id="5708657">n</span>&nbsp;<span class="op" id="5708659">:=</span>&nbsp;<span class="num" id="5708662">0</span><span class="op" id="5708663">,</span>&nbsp;<span class="ident" id="5708665">typ</span><span class="op" id="5708668">.</span><span class="ident" id="5708669">NumField</span><span class="op" id="5708677">(</span><span class="op" id="5708678">)</span><span class="op" id="5708679">;</span>&nbsp;<span class="ident" id="5708681">i</span>&nbsp;<span class="op" id="5708683">&lt;</span>&nbsp;<span class="ident" id="5708685">n</span><span class="op" id="5708686">;</span>&nbsp;<span class="ident" id="5708688">i</span><span class="op" id="5708689">++</span>&nbsp;<span class="op" id="5708692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5708696">f</span>&nbsp;<span class="op" id="5708698">:=</span>&nbsp;<span class="ident" id="5708701">typ</span><span class="op" id="5708704">.</span><span class="ident" id="5708705">Field</span><span class="op" id="5708710">(</span><span class="ident" id="5708711">i</span><span class="op" id="5708712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708716">if</span>&nbsp;<span class="ident" id="5708719">f</span><span class="op" id="5708720">.</span><span class="ident" id="5708721">Name</span>&nbsp;<span class="op" id="5708726">!=</span>&nbsp;<span class="string" id="5708729">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5708739">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708744">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5708759">finfo</span><span class="op" id="5708764">,</span>&nbsp;<span class="ident" id="5708766">err</span>&nbsp;<span class="op" id="5708770">:=</span>&nbsp;<span class="ident" id="5708773">structFieldInfo</span><span class="op" id="5708788">(</span><span class="ident" id="5708789">typ</span><span class="op" id="5708792">,</span>&nbsp;<span class="op" id="5708794">&amp;</span><span class="ident" id="5708795">f</span><span class="op" id="5708796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708800">if</span>&nbsp;<span class="ident" id="5708803">finfo</span><span class="op" id="5708808">.</span><span class="ident" id="5708809">name</span>&nbsp;<span class="op" id="5708814">!=</span>&nbsp;<span class="string" id="5708817">&#34;&#34;</span>&nbsp;<span class="op" id="5708820">&amp;&amp;</span>&nbsp;<span class="ident" id="5708823">err</span>&nbsp;<span class="op" id="5708827">==</span>&nbsp;<span class="builtintype" id="5708830">nil</span>&nbsp;<span class="op" id="5708834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708839">return</span>&nbsp;<span class="ident" id="5708846">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5708858">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5708912">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708962">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5708969">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5708972">return</span>&nbsp;<span class="builtintype" id="5708979">nil</span><br>
<span class="lineno"></span><span class="op" id="5708983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5708986">func</span>&nbsp;<span class="ident" id="5708991">min</span><span class="op" id="5708994">(</span><span class="ident" id="5708995">a</span><span class="op" id="5708996">,</span>&nbsp;<span class="ident" id="5708998">b</span>&nbsp;<span class="builtintype" id="5709000">int</span><span class="op" id="5709003">)</span>&nbsp;<span class="builtintype" id="5709005">int</span>&nbsp;<span class="op" id="5709009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709012">if</span>&nbsp;<span class="ident" id="5709015">a</span>&nbsp;<span class="op" id="5709017">&lt;=</span>&nbsp;<span class="ident" id="5709020">b</span>&nbsp;<span class="op" id="5709022">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709026">return</span>&nbsp;<span class="ident" id="5709033">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5709036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709039">return</span>&nbsp;<span class="ident" id="5709046">b</span><br>
<span class="lineno"></span><span class="op" id="5709048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5709051">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5709110">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="5709177">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="5709247">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="5709293">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="5709358">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="5709427">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5709492">func</span>&nbsp;<span class="ident" id="5709497">addFieldInfo</span><span class="op" id="5709509">(</span><span class="ident" id="5709510">typ</span>&nbsp;<span class="ident" id="5709514">reflect</span><span class="op" id="5709521">.</span><span class="ident" id="5709522">Type</span><span class="op" id="5709526">,</span>&nbsp;<span class="ident" id="5709528">tinfo</span>&nbsp;<span class="op" id="5709534">*</span><span class="ident" id="5709535">typeInfo</span><span class="op" id="5709543">,</span>&nbsp;<span class="ident" id="5709545">newf</span>&nbsp;<span class="op" id="5709550">*</span><span class="ident" id="5709551">fieldInfo</span><span class="op" id="5709560">)</span>&nbsp;<span class="builtintype" id="5709562">error</span>&nbsp;<span class="op" id="5709568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709571">var</span>&nbsp;<span class="ident" id="5709575">conflicts</span>&nbsp;<span class="op" id="5709585">[</span><span class="op" id="5709586">]</span><span class="builtintype" id="5709587">int</span><br>
<span class="lineno"></span><span class="ident" id="5709591">Loop</span><span class="op" id="5709595">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5709598">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709665">for</span>&nbsp;<span class="ident" id="5709669">i</span>&nbsp;<span class="op" id="5709671">:=</span>&nbsp;<span class="keyword" id="5709674">range</span>&nbsp;<span class="ident" id="5709680">tinfo</span><span class="op" id="5709685">.</span><span class="ident" id="5709686">fields</span>&nbsp;<span class="op" id="5709693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5709697">oldf</span>&nbsp;<span class="op" id="5709702">:=</span>&nbsp;<span class="op" id="5709705">&amp;</span><span class="ident" id="5709706">tinfo</span><span class="op" id="5709711">.</span><span class="ident" id="5709712">fields</span><span class="op" id="5709718">[</span><span class="ident" id="5709719">i</span><span class="op" id="5709720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709724">if</span>&nbsp;<span class="ident" id="5709727">oldf</span><span class="op" id="5709731">.</span><span class="ident" id="5709732">flags</span><span class="op" id="5709737">&amp;</span><span class="ident" id="5709738">fMode</span>&nbsp;<span class="op" id="5709744">!=</span>&nbsp;<span class="ident" id="5709747">newf</span><span class="op" id="5709751">.</span><span class="ident" id="5709752">flags</span><span class="op" id="5709757">&amp;</span><span class="ident" id="5709758">fMode</span>&nbsp;<span class="op" id="5709764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709769">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5709780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709784">if</span>&nbsp;<span class="ident" id="5709787">oldf</span><span class="op" id="5709791">.</span><span class="ident" id="5709792">xmlns</span>&nbsp;<span class="op" id="5709798">!=</span>&nbsp;<span class="string" id="5709801">&#34;&#34;</span>&nbsp;<span class="op" id="5709804">&amp;&amp;</span>&nbsp;<span class="ident" id="5709807">newf</span><span class="op" id="5709811">.</span><span class="ident" id="5709812">xmlns</span>&nbsp;<span class="op" id="5709818">!=</span>&nbsp;<span class="string" id="5709821">&#34;&#34;</span>&nbsp;<span class="op" id="5709824">&amp;&amp;</span>&nbsp;<span class="ident" id="5709827">oldf</span><span class="op" id="5709831">.</span><span class="ident" id="5709832">xmlns</span>&nbsp;<span class="op" id="5709838">!=</span>&nbsp;<span class="ident" id="5709841">newf</span><span class="op" id="5709845">.</span><span class="ident" id="5709846">xmlns</span>&nbsp;<span class="op" id="5709852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709857">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5709868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5709872">minl</span>&nbsp;<span class="op" id="5709877">:=</span>&nbsp;<span class="ident" id="5709880">min</span><span class="op" id="5709883">(</span><span class="builtinfunc" id="5709884">len</span><span class="op" id="5709887">(</span><span class="ident" id="5709888">newf</span><span class="op" id="5709892">.</span><span class="ident" id="5709893">parents</span><span class="op" id="5709900">)</span><span class="op" id="5709901">,</span>&nbsp;<span class="builtinfunc" id="5709903">len</span><span class="op" id="5709906">(</span><span class="ident" id="5709907">oldf</span><span class="op" id="5709911">.</span><span class="ident" id="5709912">parents</span><span class="op" id="5709919">)</span><span class="op" id="5709920">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709924">for</span>&nbsp;<span class="ident" id="5709928">p</span>&nbsp;<span class="op" id="5709930">:=</span>&nbsp;<span class="num" id="5709933">0</span><span class="op" id="5709934">;</span>&nbsp;<span class="ident" id="5709936">p</span>&nbsp;<span class="op" id="5709938">&lt;</span>&nbsp;<span class="ident" id="5709940">minl</span><span class="op" id="5709944">;</span>&nbsp;<span class="ident" id="5709946">p</span><span class="op" id="5709947">++</span>&nbsp;<span class="op" id="5709950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709955">if</span>&nbsp;<span class="ident" id="5709958">oldf</span><span class="op" id="5709962">.</span><span class="ident" id="5709963">parents</span><span class="op" id="5709970">[</span><span class="ident" id="5709971">p</span><span class="op" id="5709972">]</span>&nbsp;<span class="op" id="5709974">!=</span>&nbsp;<span class="ident" id="5709977">newf</span><span class="op" id="5709981">.</span><span class="ident" id="5709982">parents</span><span class="op" id="5709989">[</span><span class="ident" id="5709990">p</span><span class="op" id="5709991">]</span>&nbsp;<span class="op" id="5709993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5709999">continue</span>&nbsp;<span class="ident" id="5710008">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710020">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710024">if</span>&nbsp;<span class="builtinfunc" id="5710027">len</span><span class="op" id="5710030">(</span><span class="ident" id="5710031">oldf</span><span class="op" id="5710035">.</span><span class="ident" id="5710036">parents</span><span class="op" id="5710043">)</span>&nbsp;<span class="op" id="5710045">&gt;</span>&nbsp;<span class="builtinfunc" id="5710047">len</span><span class="op" id="5710050">(</span><span class="ident" id="5710051">newf</span><span class="op" id="5710055">.</span><span class="ident" id="5710056">parents</span><span class="op" id="5710063">)</span>&nbsp;<span class="op" id="5710065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710070">if</span>&nbsp;<span class="ident" id="5710073">oldf</span><span class="op" id="5710077">.</span><span class="ident" id="5710078">parents</span><span class="op" id="5710085">[</span><span class="builtinfunc" id="5710086">len</span><span class="op" id="5710089">(</span><span class="ident" id="5710090">newf</span><span class="op" id="5710094">.</span><span class="ident" id="5710095">parents</span><span class="op" id="5710102">)</span><span class="op" id="5710103">]</span>&nbsp;<span class="op" id="5710105">==</span>&nbsp;<span class="ident" id="5710108">newf</span><span class="op" id="5710112">.</span><span class="ident" id="5710113">name</span>&nbsp;<span class="op" id="5710118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710124">conflicts</span>&nbsp;<span class="op" id="5710134">=</span>&nbsp;<span class="builtinfunc" id="5710136">append</span><span class="op" id="5710142">(</span><span class="ident" id="5710143">conflicts</span><span class="op" id="5710152">,</span>&nbsp;<span class="ident" id="5710154">i</span><span class="op" id="5710155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710164">}</span>&nbsp;<span class="keyword" id="5710166">else</span>&nbsp;<span class="keyword" id="5710171">if</span>&nbsp;<span class="builtinfunc" id="5710174">len</span><span class="op" id="5710177">(</span><span class="ident" id="5710178">oldf</span><span class="op" id="5710182">.</span><span class="ident" id="5710183">parents</span><span class="op" id="5710190">)</span>&nbsp;<span class="op" id="5710192">&lt;</span>&nbsp;<span class="builtinfunc" id="5710194">len</span><span class="op" id="5710197">(</span><span class="ident" id="5710198">newf</span><span class="op" id="5710202">.</span><span class="ident" id="5710203">parents</span><span class="op" id="5710210">)</span>&nbsp;<span class="op" id="5710212">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710217">if</span>&nbsp;<span class="ident" id="5710220">newf</span><span class="op" id="5710224">.</span><span class="ident" id="5710225">parents</span><span class="op" id="5710232">[</span><span class="builtinfunc" id="5710233">len</span><span class="op" id="5710236">(</span><span class="ident" id="5710237">oldf</span><span class="op" id="5710241">.</span><span class="ident" id="5710242">parents</span><span class="op" id="5710249">)</span><span class="op" id="5710250">]</span>&nbsp;<span class="op" id="5710252">==</span>&nbsp;<span class="ident" id="5710255">oldf</span><span class="op" id="5710259">.</span><span class="ident" id="5710260">name</span>&nbsp;<span class="op" id="5710265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710271">conflicts</span>&nbsp;<span class="op" id="5710281">=</span>&nbsp;<span class="builtinfunc" id="5710283">append</span><span class="op" id="5710289">(</span><span class="ident" id="5710290">conflicts</span><span class="op" id="5710299">,</span>&nbsp;<span class="ident" id="5710301">i</span><span class="op" id="5710302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710311">}</span>&nbsp;<span class="keyword" id="5710313">else</span>&nbsp;<span class="op" id="5710318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710323">if</span>&nbsp;<span class="ident" id="5710326">newf</span><span class="op" id="5710330">.</span><span class="ident" id="5710331">name</span>&nbsp;<span class="op" id="5710336">==</span>&nbsp;<span class="ident" id="5710339">oldf</span><span class="op" id="5710343">.</span><span class="ident" id="5710344">name</span>&nbsp;<span class="op" id="5710349">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710355">conflicts</span>&nbsp;<span class="op" id="5710365">=</span>&nbsp;<span class="builtinfunc" id="5710367">append</span><span class="op" id="5710373">(</span><span class="ident" id="5710374">conflicts</span><span class="op" id="5710383">,</span>&nbsp;<span class="ident" id="5710385">i</span><span class="op" id="5710386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5710401">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710454">if</span>&nbsp;<span class="ident" id="5710457">conflicts</span>&nbsp;<span class="op" id="5710467">==</span>&nbsp;<span class="builtintype" id="5710470">nil</span>&nbsp;<span class="op" id="5710474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710478">tinfo</span><span class="op" id="5710483">.</span><span class="ident" id="5710484">fields</span>&nbsp;<span class="op" id="5710491">=</span>&nbsp;<span class="builtinfunc" id="5710493">append</span><span class="op" id="5710499">(</span><span class="ident" id="5710500">tinfo</span><span class="op" id="5710505">.</span><span class="ident" id="5710506">fields</span><span class="op" id="5710512">,</span>&nbsp;<span class="op" id="5710514">*</span><span class="ident" id="5710515">newf</span><span class="op" id="5710519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710523">return</span>&nbsp;<span class="builtintype" id="5710530">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5710539">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5710595">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710650">for</span>&nbsp;<span class="ident" id="5710654">_</span><span class="op" id="5710655">,</span>&nbsp;<span class="ident" id="5710657">i</span>&nbsp;<span class="op" id="5710659">:=</span>&nbsp;<span class="keyword" id="5710662">range</span>&nbsp;<span class="ident" id="5710668">conflicts</span>&nbsp;<span class="op" id="5710678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710682">if</span>&nbsp;<span class="builtinfunc" id="5710685">len</span><span class="op" id="5710688">(</span><span class="ident" id="5710689">tinfo</span><span class="op" id="5710694">.</span><span class="ident" id="5710695">fields</span><span class="op" id="5710701">[</span><span class="ident" id="5710702">i</span><span class="op" id="5710703">]</span><span class="op" id="5710704">.</span><span class="ident" id="5710705">idx</span><span class="op" id="5710708">)</span>&nbsp;<span class="op" id="5710710">&lt;</span>&nbsp;<span class="builtinfunc" id="5710712">len</span><span class="op" id="5710715">(</span><span class="ident" id="5710716">newf</span><span class="op" id="5710720">.</span><span class="ident" id="5710721">idx</span><span class="op" id="5710724">)</span>&nbsp;<span class="op" id="5710726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710731">return</span>&nbsp;<span class="builtintype" id="5710738">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5710747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5710751">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710824">for</span>&nbsp;<span class="ident" id="5710828">_</span><span class="op" id="5710829">,</span>&nbsp;<span class="ident" id="5710831">i</span>&nbsp;<span class="op" id="5710833">:=</span>&nbsp;<span class="keyword" id="5710836">range</span>&nbsp;<span class="ident" id="5710842">conflicts</span>&nbsp;<span class="op" id="5710852">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710856">oldf</span>&nbsp;<span class="op" id="5710861">:=</span>&nbsp;<span class="op" id="5710864">&amp;</span><span class="ident" id="5710865">tinfo</span><span class="op" id="5710870">.</span><span class="ident" id="5710871">fields</span><span class="op" id="5710877">[</span><span class="ident" id="5710878">i</span><span class="op" id="5710879">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710883">if</span>&nbsp;<span class="builtinfunc" id="5710886">len</span><span class="op" id="5710889">(</span><span class="ident" id="5710890">oldf</span><span class="op" id="5710894">.</span><span class="ident" id="5710895">idx</span><span class="op" id="5710898">)</span>&nbsp;<span class="op" id="5710900">==</span>&nbsp;<span class="builtinfunc" id="5710903">len</span><span class="op" id="5710906">(</span><span class="ident" id="5710907">newf</span><span class="op" id="5710911">.</span><span class="ident" id="5710912">idx</span><span class="op" id="5710915">)</span>&nbsp;<span class="op" id="5710917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710922">f1</span>&nbsp;<span class="op" id="5710925">:=</span>&nbsp;<span class="ident" id="5710928">typ</span><span class="op" id="5710931">.</span><span class="ident" id="5710932">FieldByIndex</span><span class="op" id="5710944">(</span><span class="ident" id="5710945">oldf</span><span class="op" id="5710949">.</span><span class="ident" id="5710950">idx</span><span class="op" id="5710953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5710958">f2</span>&nbsp;<span class="op" id="5710961">:=</span>&nbsp;<span class="ident" id="5710964">typ</span><span class="op" id="5710967">.</span><span class="ident" id="5710968">FieldByIndex</span><span class="op" id="5710980">(</span><span class="ident" id="5710981">newf</span><span class="op" id="5710985">.</span><span class="ident" id="5710986">idx</span><span class="op" id="5710989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5710994">return</span>&nbsp;<span class="op" id="5711001">&amp;</span><span class="ident" id="5711002">TagPathError</span><span class="op" id="5711014">{</span><span class="ident" id="5711015">typ</span><span class="op" id="5711018">,</span>&nbsp;<span class="ident" id="5711020">f1</span><span class="op" id="5711022">.</span><span class="ident" id="5711023">Name</span><span class="op" id="5711027">,</span>&nbsp;<span class="ident" id="5711029">f1</span><span class="op" id="5711031">.</span><span class="ident" id="5711032">Tag</span><span class="op" id="5711035">.</span><span class="ident" id="5711036">Get</span><span class="op" id="5711039">(</span><span class="string" id="5711040">&#34;xml&#34;</span><span class="op" id="5711045">)</span><span class="op" id="5711046">,</span>&nbsp;<span class="ident" id="5711048">f2</span><span class="op" id="5711050">.</span><span class="ident" id="5711051">Name</span><span class="op" id="5711055">,</span>&nbsp;<span class="ident" id="5711057">f2</span><span class="op" id="5711059">.</span><span class="ident" id="5711060">Tag</span><span class="op" id="5711063">.</span><span class="ident" id="5711064">Get</span><span class="op" id="5711067">(</span><span class="string" id="5711068">&#34;xml&#34;</span><span class="op" id="5711073">)</span><span class="op" id="5711074">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5711078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5711081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5711085">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5711155">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5711225">for</span>&nbsp;<span class="ident" id="5711229">c</span>&nbsp;<span class="op" id="5711231">:=</span>&nbsp;<span class="builtinfunc" id="5711234">len</span><span class="op" id="5711237">(</span><span class="ident" id="5711238">conflicts</span><span class="op" id="5711247">)</span>&nbsp;<span class="op" id="5711249">-</span>&nbsp;<span class="num" id="5711251">1</span><span class="op" id="5711252">;</span>&nbsp;<span class="ident" id="5711254">c</span>&nbsp;<span class="op" id="5711256">&gt;=</span>&nbsp;<span class="num" id="5711259">0</span><span class="op" id="5711260">;</span>&nbsp;<span class="ident" id="5711262">c</span><span class="op" id="5711263">--</span>&nbsp;<span class="op" id="5711266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711270">i</span>&nbsp;<span class="op" id="5711272">:=</span>&nbsp;<span class="ident" id="5711275">conflicts</span><span class="op" id="5711284">[</span><span class="ident" id="5711285">c</span><span class="op" id="5711286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5711290">copy</span><span class="op" id="5711294">(</span><span class="ident" id="5711295">tinfo</span><span class="op" id="5711300">.</span><span class="ident" id="5711301">fields</span><span class="op" id="5711307">[</span><span class="ident" id="5711308">i</span><span class="op" id="5711309">:</span><span class="op" id="5711310">]</span><span class="op" id="5711311">,</span>&nbsp;<span class="ident" id="5711313">tinfo</span><span class="op" id="5711318">.</span><span class="ident" id="5711319">fields</span><span class="op" id="5711325">[</span><span class="ident" id="5711326">i</span><span class="op" id="5711327">+</span><span class="num" id="5711328">1</span><span class="op" id="5711329">:</span><span class="op" id="5711330">]</span><span class="op" id="5711331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711335">tinfo</span><span class="op" id="5711340">.</span><span class="ident" id="5711341">fields</span>&nbsp;<span class="op" id="5711348">=</span>&nbsp;<span class="ident" id="5711350">tinfo</span><span class="op" id="5711355">.</span><span class="ident" id="5711356">fields</span><span class="op" id="5711362">[</span><span class="op" id="5711363">:</span><span class="builtinfunc" id="5711364">len</span><span class="op" id="5711367">(</span><span class="ident" id="5711368">tinfo</span><span class="op" id="5711373">.</span><span class="ident" id="5711374">fields</span><span class="op" id="5711380">)</span><span class="op" id="5711381">-</span><span class="num" id="5711382">1</span><span class="op" id="5711383">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5711386">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711389">tinfo</span><span class="op" id="5711394">.</span><span class="ident" id="5711395">fields</span>&nbsp;<span class="op" id="5711402">=</span>&nbsp;<span class="builtinfunc" id="5711404">append</span><span class="op" id="5711410">(</span><span class="ident" id="5711411">tinfo</span><span class="op" id="5711416">.</span><span class="ident" id="5711417">fields</span><span class="op" id="5711423">,</span>&nbsp;<span class="op" id="5711425">*</span><span class="ident" id="5711426">newf</span><span class="op" id="5711430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5711433">return</span>&nbsp;<span class="builtintype" id="5711440">nil</span><br>
<span class="lineno"></span><span class="op" id="5711444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5711447">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="5711514">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="5711573">type</span>&nbsp;<span class="ident" id="5711578">TagPathError</span>&nbsp;<span class="keyword" id="5711591">struct</span>&nbsp;<span class="op" id="5711598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711601">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711614">reflect</span><span class="op" id="5711621">.</span><span class="ident" id="5711622">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711628">Field1</span><span class="op" id="5711634">,</span>&nbsp;<span class="ident" id="5711636">Tag1</span>&nbsp;<span class="builtintype" id="5711641">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5711649">Field2</span><span class="op" id="5711655">,</span>&nbsp;<span class="ident" id="5711657">Tag2</span>&nbsp;<span class="builtintype" id="5711662">string</span><br>
<span class="lineno">340</span><span class="op" id="5711669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5711672">func</span>&nbsp;<span class="op" id="5711677">(</span><span class="ident" id="5711678">e</span>&nbsp;<span class="op" id="5711680">*</span><span class="ident" id="5711681">TagPathError</span><span class="op" id="5711693">)</span>&nbsp;<span class="ident" id="5711695">Error</span><span class="op" id="5711700">(</span><span class="op" id="5711701">)</span>&nbsp;<span class="builtintype" id="5711703">string</span>&nbsp;<span class="op" id="5711710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5711713">return</span>&nbsp;<span class="ident" id="5711720">fmt</span><span class="op" id="5711723">.</span><span class="ident" id="5711724">Sprintf</span><span class="op" id="5711731">(</span><span class="string" id="5711732">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="5711793">,</span>&nbsp;<span class="ident" id="5711795">e</span><span class="op" id="5711796">.</span><span class="ident" id="5711797">Struct</span><span class="op" id="5711803">,</span>&nbsp;<span class="ident" id="5711805">e</span><span class="op" id="5711806">.</span><span class="ident" id="5711807">Field1</span><span class="op" id="5711813">,</span>&nbsp;<span class="ident" id="5711815">e</span><span class="op" id="5711816">.</span><span class="ident" id="5711817">Tag1</span><span class="op" id="5711821">,</span>&nbsp;<span class="ident" id="5711823">e</span><span class="op" id="5711824">.</span><span class="ident" id="5711825">Field2</span><span class="op" id="5711831">,</span>&nbsp;<span class="ident" id="5711833">e</span><span class="op" id="5711834">.</span><span class="ident" id="5711835">Tag2</span><span class="op" id="5711839">)</span><br>
<span class="lineno"></span><span class="op" id="5711841">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5711844">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="5711901">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="5711966">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5712009">func</span>&nbsp;<span class="op" id="5712014">(</span><span class="ident" id="5712015">finfo</span>&nbsp;<span class="op" id="5712021">*</span><span class="ident" id="5712022">fieldInfo</span><span class="op" id="5712031">)</span>&nbsp;<span class="ident" id="5712033">value</span><span class="op" id="5712038">(</span><span class="ident" id="5712039">v</span>&nbsp;<span class="ident" id="5712041">reflect</span><span class="op" id="5712048">.</span><span class="ident" id="5712049">Value</span><span class="op" id="5712054">)</span>&nbsp;<span class="ident" id="5712056">reflect</span><span class="op" id="5712063">.</span><span class="ident" id="5712064">Value</span>&nbsp;<span class="op" id="5712070">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5712073">for</span>&nbsp;<span class="ident" id="5712077">i</span><span class="op" id="5712078">,</span>&nbsp;<span class="ident" id="5712080">x</span>&nbsp;<span class="op" id="5712082">:=</span>&nbsp;<span class="keyword" id="5712085">range</span>&nbsp;<span class="ident" id="5712091">finfo</span><span class="op" id="5712096">.</span><span class="ident" id="5712097">idx</span>&nbsp;<span class="op" id="5712101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5712105">if</span>&nbsp;<span class="ident" id="5712108">i</span>&nbsp;<span class="op" id="5712110">&gt;</span>&nbsp;<span class="num" id="5712112">0</span>&nbsp;<span class="op" id="5712114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5712119">t</span>&nbsp;<span class="op" id="5712121">:=</span>&nbsp;<span class="ident" id="5712124">v</span><span class="op" id="5712125">.</span><span class="ident" id="5712126">Type</span><span class="op" id="5712130">(</span><span class="op" id="5712131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5712136">if</span>&nbsp;<span class="ident" id="5712139">t</span><span class="op" id="5712140">.</span><span class="ident" id="5712141">Kind</span><span class="op" id="5712145">(</span><span class="op" id="5712146">)</span>&nbsp;<span class="op" id="5712148">==</span>&nbsp;<span class="ident" id="5712151">reflect</span><span class="op" id="5712158">.</span><span class="ident" id="5712159">Ptr</span>&nbsp;<span class="op" id="5712163">&amp;&amp;</span>&nbsp;<span class="ident" id="5712166">t</span><span class="op" id="5712167">.</span><span class="ident" id="5712168">Elem</span><span class="op" id="5712172">(</span><span class="op" id="5712173">)</span><span class="op" id="5712174">.</span><span class="ident" id="5712175">Kind</span><span class="op" id="5712179">(</span><span class="op" id="5712180">)</span>&nbsp;<span class="op" id="5712182">==</span>&nbsp;<span class="ident" id="5712185">reflect</span><span class="op" id="5712192">.</span><span class="ident" id="5712193">Struct</span>&nbsp;<span class="op" id="5712200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5712206">if</span>&nbsp;<span class="ident" id="5712209">v</span><span class="op" id="5712210">.</span><span class="ident" id="5712211">IsNil</span><span class="op" id="5712216">(</span><span class="op" id="5712217">)</span>&nbsp;<span class="op" id="5712219">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5712226">v</span><span class="op" id="5712227">.</span><span class="ident" id="5712228">Set</span><span class="op" id="5712231">(</span><span class="ident" id="5712232">reflect</span><span class="op" id="5712239">.</span><span class="ident" id="5712240">New</span><span class="op" id="5712243">(</span><span class="ident" id="5712244">v</span><span class="op" id="5712245">.</span><span class="ident" id="5712246">Type</span><span class="op" id="5712250">(</span><span class="op" id="5712251">)</span><span class="op" id="5712252">.</span><span class="ident" id="5712253">Elem</span><span class="op" id="5712257">(</span><span class="op" id="5712258">)</span><span class="op" id="5712259">)</span><span class="op" id="5712260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5712266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5712272">v</span>&nbsp;<span class="op" id="5712274">=</span>&nbsp;<span class="ident" id="5712276">v</span><span class="op" id="5712277">.</span><span class="ident" id="5712278">Elem</span><span class="op" id="5712282">(</span><span class="op" id="5712283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5712288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5712292">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5712296">v</span>&nbsp;<span class="op" id="5712298">=</span>&nbsp;<span class="ident" id="5712300">v</span><span class="op" id="5712301">.</span><span class="ident" id="5712302">Field</span><span class="op" id="5712307">(</span><span class="ident" id="5712308">x</span><span class="op" id="5712309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5712312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5712315">return</span>&nbsp;<span class="ident" id="5712322">v</span><br>
<span class="lineno"></span><span class="op" id="5712324">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
