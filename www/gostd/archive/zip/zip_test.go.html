<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7016181">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7016236">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7016290">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7016341">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016390">package</span>&nbsp;<span class="ident" id="7016398">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7016403">import</span>&nbsp;<span class="op" id="7016410">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016413">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016422">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016429">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016437">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016443">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016456">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016464">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016475">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7016486">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7016493">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7016496">func</span>&nbsp;<span class="ident" id="7016501">TestOver65kFiles</span><span class="op" id="7016517">(</span><span class="ident" id="7016518">t</span>&nbsp;<span class="op" id="7016520">*</span><span class="ident" id="7016521">testing</span><span class="op" id="7016528">.</span><span class="ident" id="7016529">T</span><span class="op" id="7016530">)</span>&nbsp;<span class="op" id="7016532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016535">buf</span>&nbsp;<span class="op" id="7016539">:=</span>&nbsp;<span class="builtinfunc" id="7016542">new</span><span class="op" id="7016545">(</span><span class="ident" id="7016546">bytes</span><span class="op" id="7016551">.</span><span class="ident" id="7016552">Buffer</span><span class="op" id="7016558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016561">w</span>&nbsp;<span class="op" id="7016563">:=</span>&nbsp;<span class="ident" id="7016566">NewWriter</span><span class="op" id="7016575">(</span><span class="ident" id="7016576">buf</span><span class="op" id="7016579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7016582">const</span>&nbsp;<span class="ident" id="7016588">nFiles</span>&nbsp;<span class="op" id="7016595">=</span>&nbsp;<span class="op" id="7016597">(</span><span class="num" id="7016598">1</span>&nbsp;<span class="op" id="7016600">&lt;&lt;</span>&nbsp;<span class="num" id="7016603">16</span><span class="op" id="7016605">)</span>&nbsp;<span class="op" id="7016607">+</span>&nbsp;<span class="num" id="7016609">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7016613">for</span>&nbsp;<span class="ident" id="7016617">i</span>&nbsp;<span class="op" id="7016619">:=</span>&nbsp;<span class="num" id="7016622">0</span><span class="op" id="7016623">;</span>&nbsp;<span class="ident" id="7016625">i</span>&nbsp;<span class="op" id="7016627">&lt;</span>&nbsp;<span class="ident" id="7016629">nFiles</span><span class="op" id="7016635">;</span>&nbsp;<span class="ident" id="7016637">i</span><span class="op" id="7016638">++</span>&nbsp;<span class="op" id="7016641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016645">_</span><span class="op" id="7016646">,</span>&nbsp;<span class="ident" id="7016648">err</span>&nbsp;<span class="op" id="7016652">:=</span>&nbsp;<span class="ident" id="7016655">w</span><span class="op" id="7016656">.</span><span class="ident" id="7016657">CreateHeader</span><span class="op" id="7016669">(</span><span class="op" id="7016670">&amp;</span><span class="ident" id="7016671">FileHeader</span><span class="op" id="7016681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016686">Name</span><span class="op" id="7016690">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7016694">fmt</span><span class="op" id="7016697">.</span><span class="ident" id="7016698">Sprintf</span><span class="op" id="7016705">(</span><span class="string" id="7016706">&#34;%d.dat&#34;</span><span class="op" id="7016714">,</span>&nbsp;<span class="ident" id="7016716">i</span><span class="op" id="7016717">)</span><span class="op" id="7016718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016723">Method</span><span class="op" id="7016729">:</span>&nbsp;<span class="ident" id="7016731">Store</span><span class="op" id="7016736">,</span>&nbsp;<span class="comment" id="7016738">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7016775">}</span><span class="op" id="7016776">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7016780">if</span>&nbsp;<span class="ident" id="7016783">err</span>&nbsp;<span class="op" id="7016787">!=</span>&nbsp;<span class="ident" id="7016790">nil</span>&nbsp;<span class="op" id="7016794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016799">t</span><span class="op" id="7016800">.</span><span class="ident" id="7016801">Fatalf</span><span class="op" id="7016807">(</span><span class="string" id="7016808">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7016830">,</span>&nbsp;<span class="ident" id="7016832">i</span><span class="op" id="7016833">,</span>&nbsp;<span class="ident" id="7016835">err</span><span class="op" id="7016838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7016842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7016845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7016848">if</span>&nbsp;<span class="ident" id="7016851">err</span>&nbsp;<span class="op" id="7016855">:=</span>&nbsp;<span class="ident" id="7016858">w</span><span class="op" id="7016859">.</span><span class="ident" id="7016860">Close</span><span class="op" id="7016865">(</span><span class="op" id="7016866">)</span><span class="op" id="7016867">;</span>&nbsp;<span class="ident" id="7016869">err</span>&nbsp;<span class="op" id="7016873">!=</span>&nbsp;<span class="ident" id="7016876">nil</span>&nbsp;<span class="op" id="7016880">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016884">t</span><span class="op" id="7016885">.</span><span class="ident" id="7016886">Fatalf</span><span class="op" id="7016892">(</span><span class="string" id="7016893">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7016911">,</span>&nbsp;<span class="ident" id="7016913">err</span><span class="op" id="7016916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7016919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016922">s</span>&nbsp;<span class="op" id="7016924">:=</span>&nbsp;<span class="ident" id="7016927">buf</span><span class="op" id="7016930">.</span><span class="ident" id="7016931">String</span><span class="op" id="7016937">(</span><span class="op" id="7016938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7016941">zr</span><span class="op" id="7016943">,</span>&nbsp;<span class="ident" id="7016945">err</span>&nbsp;<span class="op" id="7016949">:=</span>&nbsp;<span class="ident" id="7016952">NewReader</span><span class="op" id="7016961">(</span><span class="ident" id="7016962">strings</span><span class="op" id="7016969">.</span><span class="ident" id="7016970">NewReader</span><span class="op" id="7016979">(</span><span class="ident" id="7016980">s</span><span class="op" id="7016981">)</span><span class="op" id="7016982">,</span>&nbsp;<span class="ident" id="7016984">int64</span><span class="op" id="7016989">(</span><span class="builtinfunc" id="7016990">len</span><span class="op" id="7016993">(</span><span class="ident" id="7016994">s</span><span class="op" id="7016995">)</span><span class="op" id="7016996">)</span><span class="op" id="7016997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017000">if</span>&nbsp;<span class="ident" id="7017003">err</span>&nbsp;<span class="op" id="7017007">!=</span>&nbsp;<span class="ident" id="7017010">nil</span>&nbsp;<span class="op" id="7017014">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017018">t</span><span class="op" id="7017019">.</span><span class="ident" id="7017020">Fatalf</span><span class="op" id="7017026">(</span><span class="string" id="7017027">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7017042">,</span>&nbsp;<span class="ident" id="7017044">err</span><span class="op" id="7017047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017053">if</span>&nbsp;<span class="ident" id="7017056">got</span>&nbsp;<span class="op" id="7017060">:=</span>&nbsp;<span class="builtinfunc" id="7017063">len</span><span class="op" id="7017066">(</span><span class="ident" id="7017067">zr</span><span class="op" id="7017069">.</span><span class="ident" id="7017070">File</span><span class="op" id="7017074">)</span><span class="op" id="7017075">;</span>&nbsp;<span class="ident" id="7017077">got</span>&nbsp;<span class="op" id="7017081">!=</span>&nbsp;<span class="ident" id="7017084">nFiles</span>&nbsp;<span class="op" id="7017091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017095">t</span><span class="op" id="7017096">.</span><span class="ident" id="7017097">Fatalf</span><span class="op" id="7017103">(</span><span class="string" id="7017104">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7017137">,</span>&nbsp;<span class="ident" id="7017139">got</span><span class="op" id="7017142">,</span>&nbsp;<span class="ident" id="7017144">nFiles</span><span class="op" id="7017150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017153">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017156">for</span>&nbsp;<span class="ident" id="7017160">i</span>&nbsp;<span class="op" id="7017162">:=</span>&nbsp;<span class="num" id="7017165">0</span><span class="op" id="7017166">;</span>&nbsp;<span class="ident" id="7017168">i</span>&nbsp;<span class="op" id="7017170">&lt;</span>&nbsp;<span class="ident" id="7017172">nFiles</span><span class="op" id="7017178">;</span>&nbsp;<span class="ident" id="7017180">i</span><span class="op" id="7017181">++</span>&nbsp;<span class="op" id="7017184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017188">want</span>&nbsp;<span class="op" id="7017193">:=</span>&nbsp;<span class="ident" id="7017196">fmt</span><span class="op" id="7017199">.</span><span class="ident" id="7017200">Sprintf</span><span class="op" id="7017207">(</span><span class="string" id="7017208">&#34;%d.dat&#34;</span><span class="op" id="7017216">,</span>&nbsp;<span class="ident" id="7017218">i</span><span class="op" id="7017219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017223">if</span>&nbsp;<span class="ident" id="7017226">zr</span><span class="op" id="7017228">.</span><span class="ident" id="7017229">File</span><span class="op" id="7017233">[</span><span class="ident" id="7017234">i</span><span class="op" id="7017235">]</span><span class="op" id="7017236">.</span><span class="ident" id="7017237">Name</span>&nbsp;<span class="op" id="7017242">!=</span>&nbsp;<span class="ident" id="7017245">want</span>&nbsp;<span class="op" id="7017250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017255">t</span><span class="op" id="7017256">.</span><span class="ident" id="7017257">Fatalf</span><span class="op" id="7017263">(</span><span class="string" id="7017264">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7017288">,</span>&nbsp;<span class="ident" id="7017290">i</span><span class="op" id="7017291">,</span>&nbsp;<span class="ident" id="7017293">zr</span><span class="op" id="7017295">.</span><span class="ident" id="7017296">File</span><span class="op" id="7017300">[</span><span class="ident" id="7017301">i</span><span class="op" id="7017302">]</span><span class="op" id="7017303">.</span><span class="ident" id="7017304">Name</span><span class="op" id="7017308">,</span>&nbsp;<span class="ident" id="7017310">want</span><span class="op" id="7017314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017318">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017321">}</span><br>
<span class="lineno"></span><span class="op" id="7017323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017326">func</span>&nbsp;<span class="ident" id="7017331">TestModTime</span><span class="op" id="7017342">(</span><span class="ident" id="7017343">t</span>&nbsp;<span class="op" id="7017345">*</span><span class="ident" id="7017346">testing</span><span class="op" id="7017353">.</span><span class="ident" id="7017354">T</span><span class="op" id="7017355">)</span>&nbsp;<span class="op" id="7017357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017360">var</span>&nbsp;<span class="ident" id="7017364">testTime</span>&nbsp;<span class="op" id="7017373">=</span>&nbsp;<span class="ident" id="7017375">time</span><span class="op" id="7017379">.</span><span class="ident" id="7017380">Date</span><span class="op" id="7017384">(</span><span class="num" id="7017385">2009</span><span class="op" id="7017389">,</span>&nbsp;<span class="ident" id="7017391">time</span><span class="op" id="7017395">.</span><span class="ident" id="7017396">November</span><span class="op" id="7017404">,</span>&nbsp;<span class="num" id="7017406">10</span><span class="op" id="7017408">,</span>&nbsp;<span class="num" id="7017410">23</span><span class="op" id="7017412">,</span>&nbsp;<span class="num" id="7017414">45</span><span class="op" id="7017416">,</span>&nbsp;<span class="num" id="7017418">58</span><span class="op" id="7017420">,</span>&nbsp;<span class="num" id="7017422">0</span><span class="op" id="7017423">,</span>&nbsp;<span class="ident" id="7017425">time</span><span class="op" id="7017429">.</span><span class="ident" id="7017430">UTC</span><span class="op" id="7017433">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017436">fh</span>&nbsp;<span class="op" id="7017439">:=</span>&nbsp;<span class="builtinfunc" id="7017442">new</span><span class="op" id="7017445">(</span><span class="ident" id="7017446">FileHeader</span><span class="op" id="7017456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017459">fh</span><span class="op" id="7017461">.</span><span class="ident" id="7017462">SetModTime</span><span class="op" id="7017472">(</span><span class="ident" id="7017473">testTime</span><span class="op" id="7017481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017484">outTime</span>&nbsp;<span class="op" id="7017492">:=</span>&nbsp;<span class="ident" id="7017495">fh</span><span class="op" id="7017497">.</span><span class="ident" id="7017498">ModTime</span><span class="op" id="7017505">(</span><span class="op" id="7017506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017509">if</span>&nbsp;<span class="op" id="7017512">!</span><span class="ident" id="7017513">outTime</span><span class="op" id="7017520">.</span><span class="ident" id="7017521">Equal</span><span class="op" id="7017526">(</span><span class="ident" id="7017527">testTime</span><span class="op" id="7017535">)</span>&nbsp;<span class="op" id="7017537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017541">t</span><span class="op" id="7017542">.</span><span class="ident" id="7017543">Errorf</span><span class="op" id="7017549">(</span><span class="string" id="7017550">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7017586">,</span>&nbsp;<span class="ident" id="7017588">outTime</span><span class="op" id="7017595">,</span>&nbsp;<span class="ident" id="7017597">testTime</span><span class="op" id="7017605">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017608">}</span><br>
<span class="lineno"></span><span class="op" id="7017610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017613">func</span>&nbsp;<span class="ident" id="7017618">testHeaderRoundTrip</span><span class="op" id="7017637">(</span><span class="ident" id="7017638">fh</span>&nbsp;<span class="op" id="7017641">*</span><span class="ident" id="7017642">FileHeader</span><span class="op" id="7017652">,</span>&nbsp;<span class="ident" id="7017654">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7017675">uint32</span><span class="op" id="7017681">,</span>&nbsp;<span class="ident" id="7017683">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7017706">uint64</span><span class="op" id="7017712">,</span>&nbsp;<span class="ident" id="7017714">t</span>&nbsp;<span class="op" id="7017716">*</span><span class="ident" id="7017717">testing</span><span class="op" id="7017724">.</span><span class="ident" id="7017725">T</span><span class="op" id="7017726">)</span>&nbsp;<span class="op" id="7017728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017731">fi</span>&nbsp;<span class="op" id="7017734">:=</span>&nbsp;<span class="ident" id="7017737">fh</span><span class="op" id="7017739">.</span><span class="ident" id="7017740">FileInfo</span><span class="op" id="7017748">(</span><span class="op" id="7017749">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017752">fh2</span><span class="op" id="7017755">,</span>&nbsp;<span class="ident" id="7017757">err</span>&nbsp;<span class="op" id="7017761">:=</span>&nbsp;<span class="ident" id="7017764">FileInfoHeader</span><span class="op" id="7017778">(</span><span class="ident" id="7017779">fi</span><span class="op" id="7017781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017784">if</span>&nbsp;<span class="ident" id="7017787">err</span>&nbsp;<span class="op" id="7017791">!=</span>&nbsp;<span class="ident" id="7017794">nil</span>&nbsp;<span class="op" id="7017798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017802">t</span><span class="op" id="7017803">.</span><span class="ident" id="7017804">Fatal</span><span class="op" id="7017809">(</span><span class="ident" id="7017810">err</span><span class="op" id="7017813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017819">if</span>&nbsp;<span class="ident" id="7017822">got</span><span class="op" id="7017825">,</span>&nbsp;<span class="ident" id="7017827">want</span>&nbsp;<span class="op" id="7017832">:=</span>&nbsp;<span class="ident" id="7017835">fh2</span><span class="op" id="7017838">.</span><span class="ident" id="7017839">Name</span><span class="op" id="7017843">,</span>&nbsp;<span class="ident" id="7017845">fh</span><span class="op" id="7017847">.</span><span class="ident" id="7017848">Name</span><span class="op" id="7017852">;</span>&nbsp;<span class="ident" id="7017854">got</span>&nbsp;<span class="op" id="7017858">!=</span>&nbsp;<span class="ident" id="7017861">want</span>&nbsp;<span class="op" id="7017866">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017870">t</span><span class="op" id="7017871">.</span><span class="ident" id="7017872">Errorf</span><span class="op" id="7017878">(</span><span class="string" id="7017879">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7017904">,</span>&nbsp;<span class="ident" id="7017906">got</span><span class="op" id="7017909">,</span>&nbsp;<span class="ident" id="7017911">want</span><span class="op" id="7017915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017921">if</span>&nbsp;<span class="ident" id="7017924">got</span><span class="op" id="7017927">,</span>&nbsp;<span class="ident" id="7017929">want</span>&nbsp;<span class="op" id="7017934">:=</span>&nbsp;<span class="ident" id="7017937">fh2</span><span class="op" id="7017940">.</span><span class="ident" id="7017941">UncompressedSize</span><span class="op" id="7017957">,</span>&nbsp;<span class="ident" id="7017959">wantUncompressedSize</span><span class="op" id="7017979">;</span>&nbsp;<span class="ident" id="7017981">got</span>&nbsp;<span class="op" id="7017985">!=</span>&nbsp;<span class="ident" id="7017988">want</span>&nbsp;<span class="op" id="7017993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017997">t</span><span class="op" id="7017998">.</span><span class="ident" id="7017999">Errorf</span><span class="op" id="7018005">(</span><span class="string" id="7018006">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7018043">,</span>&nbsp;<span class="ident" id="7018045">got</span><span class="op" id="7018048">,</span>&nbsp;<span class="ident" id="7018050">want</span><span class="op" id="7018054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018057">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018060">if</span>&nbsp;<span class="ident" id="7018063">got</span><span class="op" id="7018066">,</span>&nbsp;<span class="ident" id="7018068">want</span>&nbsp;<span class="op" id="7018073">:=</span>&nbsp;<span class="ident" id="7018076">fh2</span><span class="op" id="7018079">.</span><span class="ident" id="7018080">UncompressedSize64</span><span class="op" id="7018098">,</span>&nbsp;<span class="ident" id="7018100">wantUncompressedSize64</span><span class="op" id="7018122">;</span>&nbsp;<span class="ident" id="7018124">got</span>&nbsp;<span class="op" id="7018128">!=</span>&nbsp;<span class="ident" id="7018131">want</span>&nbsp;<span class="op" id="7018136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018140">t</span><span class="op" id="7018141">.</span><span class="ident" id="7018142">Errorf</span><span class="op" id="7018148">(</span><span class="string" id="7018149">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7018188">,</span>&nbsp;<span class="ident" id="7018190">got</span><span class="op" id="7018193">,</span>&nbsp;<span class="ident" id="7018195">want</span><span class="op" id="7018199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018205">if</span>&nbsp;<span class="ident" id="7018208">got</span><span class="op" id="7018211">,</span>&nbsp;<span class="ident" id="7018213">want</span>&nbsp;<span class="op" id="7018218">:=</span>&nbsp;<span class="ident" id="7018221">fh2</span><span class="op" id="7018224">.</span><span class="ident" id="7018225">ModifiedTime</span><span class="op" id="7018237">,</span>&nbsp;<span class="ident" id="7018239">fh</span><span class="op" id="7018241">.</span><span class="ident" id="7018242">ModifiedTime</span><span class="op" id="7018254">;</span>&nbsp;<span class="ident" id="7018256">got</span>&nbsp;<span class="op" id="7018260">!=</span>&nbsp;<span class="ident" id="7018263">want</span>&nbsp;<span class="op" id="7018268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018272">t</span><span class="op" id="7018273">.</span><span class="ident" id="7018274">Errorf</span><span class="op" id="7018280">(</span><span class="string" id="7018281">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7018314">,</span>&nbsp;<span class="ident" id="7018316">got</span><span class="op" id="7018319">,</span>&nbsp;<span class="ident" id="7018321">want</span><span class="op" id="7018325">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018331">if</span>&nbsp;<span class="ident" id="7018334">got</span><span class="op" id="7018337">,</span>&nbsp;<span class="ident" id="7018339">want</span>&nbsp;<span class="op" id="7018344">:=</span>&nbsp;<span class="ident" id="7018347">fh2</span><span class="op" id="7018350">.</span><span class="ident" id="7018351">ModifiedDate</span><span class="op" id="7018363">,</span>&nbsp;<span class="ident" id="7018365">fh</span><span class="op" id="7018367">.</span><span class="ident" id="7018368">ModifiedDate</span><span class="op" id="7018380">;</span>&nbsp;<span class="ident" id="7018382">got</span>&nbsp;<span class="op" id="7018386">!=</span>&nbsp;<span class="ident" id="7018389">want</span>&nbsp;<span class="op" id="7018394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018398">t</span><span class="op" id="7018399">.</span><span class="ident" id="7018400">Errorf</span><span class="op" id="7018406">(</span><span class="string" id="7018407">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7018440">,</span>&nbsp;<span class="ident" id="7018442">got</span><span class="op" id="7018445">,</span>&nbsp;<span class="ident" id="7018447">want</span><span class="op" id="7018451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018458">if</span>&nbsp;<span class="ident" id="7018461">sysfh</span><span class="op" id="7018466">,</span>&nbsp;<span class="ident" id="7018468">ok</span>&nbsp;<span class="op" id="7018471">:=</span>&nbsp;<span class="ident" id="7018474">fi</span><span class="op" id="7018476">.</span><span class="ident" id="7018477">Sys</span><span class="op" id="7018480">(</span><span class="op" id="7018481">)</span><span class="op" id="7018482">.</span><span class="op" id="7018483">(</span><span class="op" id="7018484">*</span><span class="ident" id="7018485">FileHeader</span><span class="op" id="7018495">)</span><span class="op" id="7018496">;</span>&nbsp;<span class="op" id="7018498">!</span><span class="ident" id="7018499">ok</span>&nbsp;<span class="op" id="7018502">&amp;&amp;</span>&nbsp;<span class="ident" id="7018505">sysfh</span>&nbsp;<span class="op" id="7018511">!=</span>&nbsp;<span class="ident" id="7018514">fh</span>&nbsp;<span class="op" id="7018517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018521">t</span><span class="op" id="7018522">.</span><span class="ident" id="7018523">Errorf</span><span class="op" id="7018529">(</span><span class="string" id="7018530">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7018570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018573">}</span><br>
<span class="lineno"></span><span class="op" id="7018575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7018578">func</span>&nbsp;<span class="ident" id="7018583">TestFileHeaderRoundTrip</span><span class="op" id="7018606">(</span><span class="ident" id="7018607">t</span>&nbsp;<span class="op" id="7018609">*</span><span class="ident" id="7018610">testing</span><span class="op" id="7018617">.</span><span class="ident" id="7018618">T</span><span class="op" id="7018619">)</span>&nbsp;<span class="op" id="7018621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018624">fh</span>&nbsp;<span class="op" id="7018627">:=</span>&nbsp;<span class="op" id="7018630">&amp;</span><span class="ident" id="7018631">FileHeader</span><span class="op" id="7018641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018645">Name</span><span class="op" id="7018649">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7018663">&#34;foo.txt&#34;</span><span class="op" id="7018672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018676">UncompressedSize</span><span class="op" id="7018692">:</span>&nbsp;<span class="num" id="7018694">987654321</span><span class="op" id="7018703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018707">ModifiedTime</span><span class="op" id="7018719">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7018725">1234</span><span class="op" id="7018729">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018733">ModifiedDate</span><span class="op" id="7018745">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7018751">5678</span><span class="op" id="7018755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018761">testHeaderRoundTrip</span><span class="op" id="7018780">(</span><span class="ident" id="7018781">fh</span><span class="op" id="7018783">,</span>&nbsp;<span class="ident" id="7018785">fh</span><span class="op" id="7018787">.</span><span class="ident" id="7018788">UncompressedSize</span><span class="op" id="7018804">,</span>&nbsp;<span class="ident" id="7018806">uint64</span><span class="op" id="7018812">(</span><span class="ident" id="7018813">fh</span><span class="op" id="7018815">.</span><span class="ident" id="7018816">UncompressedSize</span><span class="op" id="7018832">)</span><span class="op" id="7018833">,</span>&nbsp;<span class="ident" id="7018835">t</span><span class="op" id="7018836">)</span><br>
<span class="lineno"></span><span class="op" id="7018838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7018841">func</span>&nbsp;<span class="ident" id="7018846">TestFileHeaderRoundTrip64</span><span class="op" id="7018871">(</span><span class="ident" id="7018872">t</span>&nbsp;<span class="op" id="7018874">*</span><span class="ident" id="7018875">testing</span><span class="op" id="7018882">.</span><span class="ident" id="7018883">T</span><span class="op" id="7018884">)</span>&nbsp;<span class="op" id="7018886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018889">fh</span>&nbsp;<span class="op" id="7018892">:=</span>&nbsp;<span class="op" id="7018895">&amp;</span><span class="ident" id="7018896">FileHeader</span><span class="op" id="7018906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018910">Name</span><span class="op" id="7018914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7018930">&#34;foo.txt&#34;</span><span class="op" id="7018939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018943">UncompressedSize64</span><span class="op" id="7018961">:</span>&nbsp;<span class="num" id="7018963">9876543210</span><span class="op" id="7018973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018977">ModifiedTime</span><span class="op" id="7018989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7018997">1234</span><span class="op" id="7019001">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019005">ModifiedDate</span><span class="op" id="7019017">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7019025">5678</span><span class="op" id="7019029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019035">testHeaderRoundTrip</span><span class="op" id="7019054">(</span><span class="ident" id="7019055">fh</span><span class="op" id="7019057">,</span>&nbsp;<span class="ident" id="7019059">uint32max</span><span class="op" id="7019068">,</span>&nbsp;<span class="ident" id="7019070">fh</span><span class="op" id="7019072">.</span><span class="ident" id="7019073">UncompressedSize64</span><span class="op" id="7019091">,</span>&nbsp;<span class="ident" id="7019093">t</span><span class="op" id="7019094">)</span><br>
<span class="lineno"></span><span class="op" id="7019096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7019099">type</span>&nbsp;<span class="ident" id="7019104">repeatedByte</span>&nbsp;<span class="keyword" id="7019117">struct</span>&nbsp;<span class="op" id="7019124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019127">off</span>&nbsp;<span class="ident" id="7019131">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019138">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7019142">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019148">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7019152">int64</span><br>
<span class="lineno"></span><span class="op" id="7019158">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7019161">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7019211">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7019279">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7019312">type</span>&nbsp;<span class="ident" id="7019317">rleBuffer</span>&nbsp;<span class="keyword" id="7019327">struct</span>&nbsp;<span class="op" id="7019334">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019337">buf</span>&nbsp;<span class="op" id="7019341">[</span><span class="op" id="7019342">]</span><span class="ident" id="7019343">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7019356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7019359">func</span>&nbsp;<span class="op" id="7019364">(</span><span class="ident" id="7019365">r</span>&nbsp;<span class="op" id="7019367">*</span><span class="ident" id="7019368">rleBuffer</span><span class="op" id="7019377">)</span>&nbsp;<span class="ident" id="7019379">Size</span><span class="op" id="7019383">(</span><span class="op" id="7019384">)</span>&nbsp;<span class="ident" id="7019386">int64</span>&nbsp;<span class="op" id="7019392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019395">if</span>&nbsp;<span class="builtinfunc" id="7019398">len</span><span class="op" id="7019401">(</span><span class="ident" id="7019402">r</span><span class="op" id="7019403">.</span><span class="ident" id="7019404">buf</span><span class="op" id="7019407">)</span>&nbsp;<span class="op" id="7019409">==</span>&nbsp;<span class="num" id="7019412">0</span>&nbsp;<span class="op" id="7019414">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019418">return</span>&nbsp;<span class="num" id="7019425">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019431">last</span>&nbsp;<span class="op" id="7019436">:=</span>&nbsp;<span class="op" id="7019439">&amp;</span><span class="ident" id="7019440">r</span><span class="op" id="7019441">.</span><span class="ident" id="7019442">buf</span><span class="op" id="7019445">[</span><span class="builtinfunc" id="7019446">len</span><span class="op" id="7019449">(</span><span class="ident" id="7019450">r</span><span class="op" id="7019451">.</span><span class="ident" id="7019452">buf</span><span class="op" id="7019455">)</span><span class="op" id="7019456">-</span><span class="num" id="7019457">1</span><span class="op" id="7019458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019461">return</span>&nbsp;<span class="ident" id="7019468">last</span><span class="op" id="7019472">.</span><span class="ident" id="7019473">off</span>&nbsp;<span class="op" id="7019477">+</span>&nbsp;<span class="ident" id="7019479">last</span><span class="op" id="7019483">.</span><span class="ident" id="7019484">n</span><br>
<span class="lineno"></span><span class="op" id="7019486">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7019489">func</span>&nbsp;<span class="op" id="7019494">(</span><span class="ident" id="7019495">r</span>&nbsp;<span class="op" id="7019497">*</span><span class="ident" id="7019498">rleBuffer</span><span class="op" id="7019507">)</span>&nbsp;<span class="ident" id="7019509">Write</span><span class="op" id="7019514">(</span><span class="ident" id="7019515">p</span>&nbsp;<span class="op" id="7019517">[</span><span class="op" id="7019518">]</span><span class="builtintype" id="7019519">byte</span><span class="op" id="7019523">)</span>&nbsp;<span class="op" id="7019525">(</span><span class="ident" id="7019526">n</span>&nbsp;<span class="builtintype" id="7019528">int</span><span class="op" id="7019531">,</span>&nbsp;<span class="ident" id="7019533">err</span>&nbsp;<span class="builtintype" id="7019537">error</span><span class="op" id="7019542">)</span>&nbsp;<span class="op" id="7019544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019547">var</span>&nbsp;<span class="ident" id="7019551">rp</span>&nbsp;<span class="op" id="7019554">*</span><span class="ident" id="7019555">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019569">if</span>&nbsp;<span class="builtinfunc" id="7019572">len</span><span class="op" id="7019575">(</span><span class="ident" id="7019576">r</span><span class="op" id="7019577">.</span><span class="ident" id="7019578">buf</span><span class="op" id="7019581">)</span>&nbsp;<span class="op" id="7019583">&gt;</span>&nbsp;<span class="num" id="7019585">0</span>&nbsp;<span class="op" id="7019587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019591">rp</span>&nbsp;<span class="op" id="7019594">=</span>&nbsp;<span class="op" id="7019596">&amp;</span><span class="ident" id="7019597">r</span><span class="op" id="7019598">.</span><span class="ident" id="7019599">buf</span><span class="op" id="7019602">[</span><span class="builtinfunc" id="7019603">len</span><span class="op" id="7019606">(</span><span class="ident" id="7019607">r</span><span class="op" id="7019608">.</span><span class="ident" id="7019609">buf</span><span class="op" id="7019612">)</span><span class="op" id="7019613">-</span><span class="num" id="7019614">1</span><span class="op" id="7019615">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7019619">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019676">if</span>&nbsp;<span class="ident" id="7019679">lastByte</span>&nbsp;<span class="op" id="7019688">:=</span>&nbsp;<span class="ident" id="7019691">rp</span><span class="op" id="7019693">.</span><span class="ident" id="7019694">b</span><span class="op" id="7019695">;</span>&nbsp;<span class="builtinfunc" id="7019697">len</span><span class="op" id="7019700">(</span><span class="ident" id="7019701">p</span><span class="op" id="7019702">)</span>&nbsp;<span class="op" id="7019704">&gt;</span>&nbsp;<span class="num" id="7019706">0</span>&nbsp;<span class="op" id="7019708">&amp;&amp;</span>&nbsp;<span class="ident" id="7019711">p</span><span class="op" id="7019712">[</span><span class="num" id="7019713">0</span><span class="op" id="7019714">]</span>&nbsp;<span class="op" id="7019716">==</span>&nbsp;<span class="ident" id="7019719">lastByte</span>&nbsp;<span class="op" id="7019728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019733">all</span>&nbsp;<span class="op" id="7019737">:=</span>&nbsp;<span class="builtintype" id="7019740">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019748">for</span>&nbsp;<span class="ident" id="7019752">_</span><span class="op" id="7019753">,</span>&nbsp;<span class="ident" id="7019755">b</span>&nbsp;<span class="op" id="7019757">:=</span>&nbsp;<span class="keyword" id="7019760">range</span>&nbsp;<span class="ident" id="7019766">p</span>&nbsp;<span class="op" id="7019768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019774">if</span>&nbsp;<span class="ident" id="7019777">b</span>&nbsp;<span class="op" id="7019779">!=</span>&nbsp;<span class="ident" id="7019782">lastByte</span>&nbsp;<span class="op" id="7019791">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019798">all</span>&nbsp;<span class="op" id="7019802">=</span>&nbsp;<span class="builtintype" id="7019804">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019815">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019835">if</span>&nbsp;<span class="ident" id="7019838">all</span>&nbsp;<span class="op" id="7019842">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019848">rp</span><span class="op" id="7019850">.</span><span class="ident" id="7019851">n</span>&nbsp;<span class="op" id="7019853">+=</span>&nbsp;<span class="ident" id="7019856">int64</span><span class="op" id="7019861">(</span><span class="builtinfunc" id="7019862">len</span><span class="op" id="7019865">(</span><span class="ident" id="7019866">p</span><span class="op" id="7019867">)</span><span class="op" id="7019868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019874">return</span>&nbsp;<span class="builtinfunc" id="7019881">len</span><span class="op" id="7019884">(</span><span class="ident" id="7019885">p</span><span class="op" id="7019886">)</span><span class="op" id="7019887">,</span>&nbsp;<span class="ident" id="7019889">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019903">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019907">for</span>&nbsp;<span class="ident" id="7019911">_</span><span class="op" id="7019912">,</span>&nbsp;<span class="ident" id="7019914">b</span>&nbsp;<span class="op" id="7019916">:=</span>&nbsp;<span class="keyword" id="7019919">range</span>&nbsp;<span class="ident" id="7019925">p</span>&nbsp;<span class="op" id="7019927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019931">if</span>&nbsp;<span class="ident" id="7019934">rp</span>&nbsp;<span class="op" id="7019937">==</span>&nbsp;<span class="ident" id="7019940">nil</span>&nbsp;<span class="op" id="7019944">||</span>&nbsp;<span class="ident" id="7019947">rp</span><span class="op" id="7019949">.</span><span class="ident" id="7019950">b</span>&nbsp;<span class="op" id="7019952">!=</span>&nbsp;<span class="ident" id="7019955">b</span>&nbsp;<span class="op" id="7019957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019962">r</span><span class="op" id="7019963">.</span><span class="ident" id="7019964">buf</span>&nbsp;<span class="op" id="7019968">=</span>&nbsp;<span class="builtinfunc" id="7019970">append</span><span class="op" id="7019976">(</span><span class="ident" id="7019977">r</span><span class="op" id="7019978">.</span><span class="ident" id="7019979">buf</span><span class="op" id="7019982">,</span>&nbsp;<span class="ident" id="7019984">repeatedByte</span><span class="op" id="7019996">{</span><span class="ident" id="7019997">r</span><span class="op" id="7019998">.</span><span class="ident" id="7019999">Size</span><span class="op" id="7020003">(</span><span class="op" id="7020004">)</span><span class="op" id="7020005">,</span>&nbsp;<span class="ident" id="7020007">b</span><span class="op" id="7020008">,</span>&nbsp;<span class="num" id="7020010">1</span><span class="op" id="7020011">}</span><span class="op" id="7020012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020017">rp</span>&nbsp;<span class="op" id="7020020">=</span>&nbsp;<span class="op" id="7020022">&amp;</span><span class="ident" id="7020023">r</span><span class="op" id="7020024">.</span><span class="ident" id="7020025">buf</span><span class="op" id="7020028">[</span><span class="builtinfunc" id="7020029">len</span><span class="op" id="7020032">(</span><span class="ident" id="7020033">r</span><span class="op" id="7020034">.</span><span class="ident" id="7020035">buf</span><span class="op" id="7020038">)</span><span class="op" id="7020039">-</span><span class="num" id="7020040">1</span><span class="op" id="7020041">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020045">}</span>&nbsp;<span class="keyword" id="7020047">else</span>&nbsp;<span class="op" id="7020052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020057">rp</span><span class="op" id="7020059">.</span><span class="ident" id="7020060">n</span><span class="op" id="7020061">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020072">return</span>&nbsp;<span class="builtinfunc" id="7020079">len</span><span class="op" id="7020082">(</span><span class="ident" id="7020083">p</span><span class="op" id="7020084">)</span><span class="op" id="7020085">,</span>&nbsp;<span class="ident" id="7020087">nil</span><br>
<span class="lineno">160</span><span class="op" id="7020091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020094">func</span>&nbsp;<span class="op" id="7020099">(</span><span class="ident" id="7020100">r</span>&nbsp;<span class="op" id="7020102">*</span><span class="ident" id="7020103">rleBuffer</span><span class="op" id="7020112">)</span>&nbsp;<span class="ident" id="7020114">ReadAt</span><span class="op" id="7020120">(</span><span class="ident" id="7020121">p</span>&nbsp;<span class="op" id="7020123">[</span><span class="op" id="7020124">]</span><span class="builtintype" id="7020125">byte</span><span class="op" id="7020129">,</span>&nbsp;<span class="ident" id="7020131">off</span>&nbsp;<span class="ident" id="7020135">int64</span><span class="op" id="7020140">)</span>&nbsp;<span class="op" id="7020142">(</span><span class="ident" id="7020143">n</span>&nbsp;<span class="builtintype" id="7020145">int</span><span class="op" id="7020148">,</span>&nbsp;<span class="ident" id="7020150">err</span>&nbsp;<span class="builtintype" id="7020154">error</span><span class="op" id="7020159">)</span>&nbsp;<span class="op" id="7020161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020164">if</span>&nbsp;<span class="builtinfunc" id="7020167">len</span><span class="op" id="7020170">(</span><span class="ident" id="7020171">p</span><span class="op" id="7020172">)</span>&nbsp;<span class="op" id="7020174">==</span>&nbsp;<span class="num" id="7020177">0</span>&nbsp;<span class="op" id="7020179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020183">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020194">skipParts</span>&nbsp;<span class="op" id="7020204">:=</span>&nbsp;<span class="ident" id="7020207">sort</span><span class="op" id="7020211">.</span><span class="ident" id="7020212">Search</span><span class="op" id="7020218">(</span><span class="builtinfunc" id="7020219">len</span><span class="op" id="7020222">(</span><span class="ident" id="7020223">r</span><span class="op" id="7020224">.</span><span class="ident" id="7020225">buf</span><span class="op" id="7020228">)</span><span class="op" id="7020229">,</span>&nbsp;<span class="keyword" id="7020231">func</span><span class="op" id="7020235">(</span><span class="ident" id="7020236">i</span>&nbsp;<span class="builtintype" id="7020238">int</span><span class="op" id="7020241">)</span>&nbsp;<span class="builtintype" id="7020243">bool</span>&nbsp;<span class="op" id="7020248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020252">part</span>&nbsp;<span class="op" id="7020257">:=</span>&nbsp;<span class="op" id="7020260">&amp;</span><span class="ident" id="7020261">r</span><span class="op" id="7020262">.</span><span class="ident" id="7020263">buf</span><span class="op" id="7020266">[</span><span class="ident" id="7020267">i</span><span class="op" id="7020268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020272">return</span>&nbsp;<span class="ident" id="7020279">part</span><span class="op" id="7020283">.</span><span class="ident" id="7020284">off</span><span class="op" id="7020287">+</span><span class="ident" id="7020288">part</span><span class="op" id="7020292">.</span><span class="ident" id="7020293">n</span>&nbsp;<span class="op" id="7020295">&gt;</span>&nbsp;<span class="ident" id="7020297">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020302">}</span><span class="op" id="7020303">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020306">parts</span>&nbsp;<span class="op" id="7020312">:=</span>&nbsp;<span class="ident" id="7020315">r</span><span class="op" id="7020316">.</span><span class="ident" id="7020317">buf</span><span class="op" id="7020320">[</span><span class="ident" id="7020321">skipParts</span><span class="op" id="7020330">:</span><span class="op" id="7020331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020334">if</span>&nbsp;<span class="builtinfunc" id="7020337">len</span><span class="op" id="7020340">(</span><span class="ident" id="7020341">parts</span><span class="op" id="7020346">)</span>&nbsp;<span class="op" id="7020348">&gt;</span>&nbsp;<span class="num" id="7020350">0</span>&nbsp;<span class="op" id="7020352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020356">skipBytes</span>&nbsp;<span class="op" id="7020366">:=</span>&nbsp;<span class="ident" id="7020369">off</span>&nbsp;<span class="op" id="7020373">-</span>&nbsp;<span class="ident" id="7020375">parts</span><span class="op" id="7020380">[</span><span class="num" id="7020381">0</span><span class="op" id="7020382">]</span><span class="op" id="7020383">.</span><span class="ident" id="7020384">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020390">for</span>&nbsp;<span class="builtinfunc" id="7020394">len</span><span class="op" id="7020397">(</span><span class="ident" id="7020398">parts</span><span class="op" id="7020403">)</span>&nbsp;<span class="op" id="7020405">&gt;</span>&nbsp;<span class="num" id="7020407">0</span>&nbsp;<span class="op" id="7020409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020414">part</span>&nbsp;<span class="op" id="7020419">:=</span>&nbsp;<span class="ident" id="7020422">parts</span><span class="op" id="7020427">[</span><span class="num" id="7020428">0</span><span class="op" id="7020429">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020434">for</span>&nbsp;<span class="ident" id="7020438">i</span>&nbsp;<span class="op" id="7020440">:=</span>&nbsp;<span class="ident" id="7020443">skipBytes</span><span class="op" id="7020452">;</span>&nbsp;<span class="ident" id="7020454">i</span>&nbsp;<span class="op" id="7020456">&lt;</span>&nbsp;<span class="ident" id="7020458">part</span><span class="op" id="7020462">.</span><span class="ident" id="7020463">n</span><span class="op" id="7020464">;</span>&nbsp;<span class="ident" id="7020466">i</span><span class="op" id="7020467">++</span>&nbsp;<span class="op" id="7020470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020476">if</span>&nbsp;<span class="ident" id="7020479">n</span>&nbsp;<span class="op" id="7020481">==</span>&nbsp;<span class="builtinfunc" id="7020484">len</span><span class="op" id="7020487">(</span><span class="ident" id="7020488">p</span><span class="op" id="7020489">)</span>&nbsp;<span class="op" id="7020491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020498">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020515">p</span><span class="op" id="7020516">[</span><span class="ident" id="7020517">n</span><span class="op" id="7020518">]</span>&nbsp;<span class="op" id="7020520">=</span>&nbsp;<span class="ident" id="7020522">part</span><span class="op" id="7020526">.</span><span class="ident" id="7020527">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020533">n</span><span class="op" id="7020534">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020545">parts</span>&nbsp;<span class="op" id="7020551">=</span>&nbsp;<span class="ident" id="7020553">parts</span><span class="op" id="7020558">[</span><span class="num" id="7020559">1</span><span class="op" id="7020560">:</span><span class="op" id="7020561">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020566">skipBytes</span>&nbsp;<span class="op" id="7020576">=</span>&nbsp;<span class="num" id="7020578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020582">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020588">if</span>&nbsp;<span class="ident" id="7020591">n</span>&nbsp;<span class="op" id="7020593">!=</span>&nbsp;<span class="builtinfunc" id="7020596">len</span><span class="op" id="7020599">(</span><span class="ident" id="7020600">p</span><span class="op" id="7020601">)</span>&nbsp;<span class="op" id="7020603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020607">err</span>&nbsp;<span class="op" id="7020611">=</span>&nbsp;<span class="ident" id="7020613">io</span><span class="op" id="7020615">.</span><span class="ident" id="7020616">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020637">return</span><br>
<span class="lineno">190</span><span class="op" id="7020644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7020647">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7020733">func</span>&nbsp;<span class="ident" id="7020738">TestRLEBuffer</span><span class="op" id="7020751">(</span><span class="ident" id="7020752">t</span>&nbsp;<span class="op" id="7020754">*</span><span class="ident" id="7020755">testing</span><span class="op" id="7020762">.</span><span class="ident" id="7020763">T</span><span class="op" id="7020764">)</span>&nbsp;<span class="op" id="7020766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020769">b</span>&nbsp;<span class="op" id="7020771">:=</span>&nbsp;<span class="builtinfunc" id="7020774">new</span><span class="op" id="7020777">(</span><span class="ident" id="7020778">rleBuffer</span><span class="op" id="7020787">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020790">var</span>&nbsp;<span class="ident" id="7020794">all</span>&nbsp;<span class="op" id="7020798">[</span><span class="op" id="7020799">]</span><span class="builtintype" id="7020800">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020806">writes</span>&nbsp;<span class="op" id="7020813">:=</span>&nbsp;<span class="op" id="7020816">[</span><span class="op" id="7020817">]</span><span class="builtintype" id="7020818">string</span><span class="op" id="7020824">{</span><span class="string" id="7020825">&#34;abcdeee&#34;</span><span class="op" id="7020834">,</span>&nbsp;<span class="string" id="7020836">&#34;eeeeeee&#34;</span><span class="op" id="7020845">,</span>&nbsp;<span class="string" id="7020847">&#34;eeeefghaaiii&#34;</span><span class="op" id="7020861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020864">for</span>&nbsp;<span class="ident" id="7020868">_</span><span class="op" id="7020869">,</span>&nbsp;<span class="ident" id="7020871">w</span>&nbsp;<span class="op" id="7020873">:=</span>&nbsp;<span class="keyword" id="7020876">range</span>&nbsp;<span class="ident" id="7020882">writes</span>&nbsp;<span class="op" id="7020889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020893">b</span><span class="op" id="7020894">.</span><span class="ident" id="7020895">Write</span><span class="op" id="7020900">(</span><span class="op" id="7020901">[</span><span class="op" id="7020902">]</span><span class="builtintype" id="7020903">byte</span><span class="op" id="7020907">(</span><span class="ident" id="7020908">w</span><span class="op" id="7020909">)</span><span class="op" id="7020910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020914">all</span>&nbsp;<span class="op" id="7020918">=</span>&nbsp;<span class="builtinfunc" id="7020920">append</span><span class="op" id="7020926">(</span><span class="ident" id="7020927">all</span><span class="op" id="7020930">,</span>&nbsp;<span class="ident" id="7020932">w</span><span class="op" id="7020933">...</span><span class="op" id="7020936">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020942">if</span>&nbsp;<span class="builtinfunc" id="7020945">len</span><span class="op" id="7020948">(</span><span class="ident" id="7020949">b</span><span class="op" id="7020950">.</span><span class="ident" id="7020951">buf</span><span class="op" id="7020954">)</span>&nbsp;<span class="op" id="7020956">!=</span>&nbsp;<span class="num" id="7020959">10</span>&nbsp;<span class="op" id="7020962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020966">t</span><span class="op" id="7020967">.</span><span class="ident" id="7020968">Fatalf</span><span class="op" id="7020974">(</span><span class="string" id="7020975">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7021001">,</span>&nbsp;<span class="builtinfunc" id="7021003">len</span><span class="op" id="7021006">(</span><span class="ident" id="7021007">b</span><span class="op" id="7021008">.</span><span class="ident" id="7021009">buf</span><span class="op" id="7021012">)</span><span class="op" id="7021013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021020">for</span>&nbsp;<span class="ident" id="7021024">i</span>&nbsp;<span class="op" id="7021026">:=</span>&nbsp;<span class="num" id="7021029">0</span><span class="op" id="7021030">;</span>&nbsp;<span class="ident" id="7021032">i</span>&nbsp;<span class="op" id="7021034">&lt;</span>&nbsp;<span class="builtinfunc" id="7021036">len</span><span class="op" id="7021039">(</span><span class="ident" id="7021040">all</span><span class="op" id="7021043">)</span><span class="op" id="7021044">;</span>&nbsp;<span class="ident" id="7021046">i</span><span class="op" id="7021047">++</span>&nbsp;<span class="op" id="7021050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021054">for</span>&nbsp;<span class="ident" id="7021058">j</span>&nbsp;<span class="op" id="7021060">:=</span>&nbsp;<span class="num" id="7021063">0</span><span class="op" id="7021064">;</span>&nbsp;<span class="ident" id="7021066">j</span>&nbsp;<span class="op" id="7021068">&lt;</span>&nbsp;<span class="builtinfunc" id="7021070">len</span><span class="op" id="7021073">(</span><span class="ident" id="7021074">all</span><span class="op" id="7021077">)</span><span class="op" id="7021078">-</span><span class="ident" id="7021079">i</span><span class="op" id="7021080">;</span>&nbsp;<span class="ident" id="7021082">j</span><span class="op" id="7021083">++</span>&nbsp;<span class="op" id="7021086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021091">buf</span>&nbsp;<span class="op" id="7021095">:=</span>&nbsp;<span class="builtinfunc" id="7021098">make</span><span class="op" id="7021102">(</span><span class="op" id="7021103">[</span><span class="op" id="7021104">]</span><span class="builtintype" id="7021105">byte</span><span class="op" id="7021109">,</span>&nbsp;<span class="ident" id="7021111">j</span><span class="op" id="7021112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021117">n</span><span class="op" id="7021118">,</span>&nbsp;<span class="ident" id="7021120">err</span>&nbsp;<span class="op" id="7021124">:=</span>&nbsp;<span class="ident" id="7021127">b</span><span class="op" id="7021128">.</span><span class="ident" id="7021129">ReadAt</span><span class="op" id="7021135">(</span><span class="ident" id="7021136">buf</span><span class="op" id="7021139">,</span>&nbsp;<span class="ident" id="7021141">int64</span><span class="op" id="7021146">(</span><span class="ident" id="7021147">i</span><span class="op" id="7021148">)</span><span class="op" id="7021149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021154">if</span>&nbsp;<span class="ident" id="7021157">err</span>&nbsp;<span class="op" id="7021161">!=</span>&nbsp;<span class="ident" id="7021164">nil</span>&nbsp;<span class="op" id="7021168">||</span>&nbsp;<span class="ident" id="7021171">n</span>&nbsp;<span class="op" id="7021173">!=</span>&nbsp;<span class="builtinfunc" id="7021176">len</span><span class="op" id="7021179">(</span><span class="ident" id="7021180">buf</span><span class="op" id="7021183">)</span>&nbsp;<span class="op" id="7021185">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021191">t</span><span class="op" id="7021192">.</span><span class="ident" id="7021193">Errorf</span><span class="op" id="7021199">(</span><span class="string" id="7021200">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7021239">,</span>&nbsp;<span class="ident" id="7021241">i</span><span class="op" id="7021242">,</span>&nbsp;<span class="ident" id="7021244">j</span><span class="op" id="7021245">,</span>&nbsp;<span class="ident" id="7021247">n</span><span class="op" id="7021248">,</span>&nbsp;<span class="ident" id="7021250">err</span><span class="op" id="7021253">,</span>&nbsp;<span class="builtinfunc" id="7021255">len</span><span class="op" id="7021258">(</span><span class="ident" id="7021259">buf</span><span class="op" id="7021262">)</span><span class="op" id="7021263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021273">if</span>&nbsp;<span class="op" id="7021276">!</span><span class="ident" id="7021277">bytes</span><span class="op" id="7021282">.</span><span class="ident" id="7021283">Equal</span><span class="op" id="7021288">(</span><span class="ident" id="7021289">buf</span><span class="op" id="7021292">,</span>&nbsp;<span class="ident" id="7021294">all</span><span class="op" id="7021297">[</span><span class="ident" id="7021298">i</span><span class="op" id="7021299">:</span><span class="ident" id="7021300">i</span><span class="op" id="7021301">+</span><span class="ident" id="7021302">j</span><span class="op" id="7021303">]</span><span class="op" id="7021304">)</span>&nbsp;<span class="op" id="7021306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021312">t</span><span class="op" id="7021313">.</span><span class="ident" id="7021314">Errorf</span><span class="op" id="7021320">(</span><span class="string" id="7021321">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7021351">,</span>&nbsp;<span class="ident" id="7021353">i</span><span class="op" id="7021354">,</span>&nbsp;<span class="ident" id="7021356">j</span><span class="op" id="7021357">,</span>&nbsp;<span class="ident" id="7021359">buf</span><span class="op" id="7021362">,</span>&nbsp;<span class="ident" id="7021364">all</span><span class="op" id="7021367">[</span><span class="ident" id="7021368">i</span><span class="op" id="7021369">:</span><span class="ident" id="7021370">i</span><span class="op" id="7021371">+</span><span class="ident" id="7021372">j</span><span class="op" id="7021373">]</span><span class="op" id="7021374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021379">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021386">}</span><br>
<span class="lineno"></span><span class="op" id="7021388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7021391">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7021446">type</span>&nbsp;<span class="ident" id="7021451">fakeHash32</span>&nbsp;<span class="keyword" id="7021462">struct</span>&nbsp;<span class="op" id="7021469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021472">hash</span><span class="op" id="7021476">.</span><span class="ident" id="7021477">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7021484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021487">func</span>&nbsp;<span class="op" id="7021492">(</span><span class="ident" id="7021493">fakeHash32</span><span class="op" id="7021503">)</span>&nbsp;<span class="ident" id="7021505">Write</span><span class="op" id="7021510">(</span><span class="ident" id="7021511">p</span>&nbsp;<span class="op" id="7021513">[</span><span class="op" id="7021514">]</span><span class="builtintype" id="7021515">byte</span><span class="op" id="7021519">)</span>&nbsp;<span class="op" id="7021521">(</span><span class="builtintype" id="7021522">int</span><span class="op" id="7021525">,</span>&nbsp;<span class="builtintype" id="7021527">error</span><span class="op" id="7021532">)</span>&nbsp;<span class="op" id="7021534">{</span>&nbsp;<span class="keyword" id="7021536">return</span>&nbsp;<span class="builtinfunc" id="7021543">len</span><span class="op" id="7021546">(</span><span class="ident" id="7021547">p</span><span class="op" id="7021548">)</span><span class="op" id="7021549">,</span>&nbsp;<span class="ident" id="7021551">nil</span>&nbsp;<span class="op" id="7021555">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7021557">func</span>&nbsp;<span class="op" id="7021562">(</span><span class="ident" id="7021563">fakeHash32</span><span class="op" id="7021573">)</span>&nbsp;<span class="ident" id="7021575">Sum32</span><span class="op" id="7021580">(</span><span class="op" id="7021581">)</span>&nbsp;<span class="builtintype" id="7021583">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7021604">{</span>&nbsp;<span class="keyword" id="7021606">return</span>&nbsp;<span class="num" id="7021613">0</span>&nbsp;<span class="op" id="7021615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021618">func</span>&nbsp;<span class="ident" id="7021623">TestZip64</span><span class="op" id="7021632">(</span><span class="ident" id="7021633">t</span>&nbsp;<span class="op" id="7021635">*</span><span class="ident" id="7021636">testing</span><span class="op" id="7021643">.</span><span class="ident" id="7021644">T</span><span class="op" id="7021645">)</span>&nbsp;<span class="op" id="7021647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021650">if</span>&nbsp;<span class="ident" id="7021653">testing</span><span class="op" id="7021660">.</span><span class="ident" id="7021661">Short</span><span class="op" id="7021666">(</span><span class="op" id="7021667">)</span>&nbsp;<span class="op" id="7021669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021673">t</span><span class="op" id="7021674">.</span><span class="ident" id="7021675">Skip</span><span class="op" id="7021679">(</span><span class="string" id="7021680">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7021701">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021707">const</span>&nbsp;<span class="ident" id="7021713">size</span>&nbsp;<span class="op" id="7021718">=</span>&nbsp;<span class="num" id="7021720">1</span>&nbsp;<span class="op" id="7021722">&lt;&lt;</span>&nbsp;<span class="num" id="7021725">32</span>&nbsp;<span class="comment" id="7021728">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021756">testZip64</span><span class="op" id="7021765">(</span><span class="ident" id="7021766">t</span><span class="op" id="7021767">,</span>&nbsp;<span class="ident" id="7021769">size</span><span class="op" id="7021773">)</span><br>
<span class="lineno"></span><span class="op" id="7021775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7021778">func</span>&nbsp;<span class="ident" id="7021783">testZip64</span><span class="op" id="7021792">(</span><span class="ident" id="7021793">t</span>&nbsp;<span class="ident" id="7021795">testing</span><span class="op" id="7021802">.</span><span class="ident" id="7021803">TB</span><span class="op" id="7021805">,</span>&nbsp;<span class="ident" id="7021807">size</span>&nbsp;<span class="ident" id="7021812">int64</span><span class="op" id="7021817">)</span>&nbsp;<span class="op" id="7021819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021822">const</span>&nbsp;<span class="ident" id="7021828">chunkSize</span>&nbsp;<span class="op" id="7021838">=</span>&nbsp;<span class="num" id="7021840">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021846">chunks</span>&nbsp;<span class="op" id="7021853">:=</span>&nbsp;<span class="builtintype" id="7021856">int</span><span class="op" id="7021859">(</span><span class="ident" id="7021860">size</span>&nbsp;<span class="op" id="7021865">/</span>&nbsp;<span class="ident" id="7021867">chunkSize</span><span class="op" id="7021876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7021879">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021927">buf</span>&nbsp;<span class="op" id="7021931">:=</span>&nbsp;<span class="builtinfunc" id="7021934">new</span><span class="op" id="7021937">(</span><span class="ident" id="7021938">rleBuffer</span><span class="op" id="7021947">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021950">w</span>&nbsp;<span class="op" id="7021952">:=</span>&nbsp;<span class="ident" id="7021955">NewWriter</span><span class="op" id="7021964">(</span><span class="ident" id="7021965">buf</span><span class="op" id="7021968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021971">f</span><span class="op" id="7021972">,</span>&nbsp;<span class="ident" id="7021974">err</span>&nbsp;<span class="op" id="7021978">:=</span>&nbsp;<span class="ident" id="7021981">w</span><span class="op" id="7021982">.</span><span class="ident" id="7021983">CreateHeader</span><span class="op" id="7021995">(</span><span class="op" id="7021996">&amp;</span><span class="ident" id="7021997">FileHeader</span><span class="op" id="7022007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022011">Name</span><span class="op" id="7022015">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7022019">&#34;huge.txt&#34;</span><span class="op" id="7022029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022033">Method</span><span class="op" id="7022039">:</span>&nbsp;<span class="ident" id="7022041">Store</span><span class="op" id="7022046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022049">}</span><span class="op" id="7022050">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022053">if</span>&nbsp;<span class="ident" id="7022056">err</span>&nbsp;<span class="op" id="7022060">!=</span>&nbsp;<span class="ident" id="7022063">nil</span>&nbsp;<span class="op" id="7022067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022071">t</span><span class="op" id="7022072">.</span><span class="ident" id="7022073">Fatal</span><span class="op" id="7022078">(</span><span class="ident" id="7022079">err</span><span class="op" id="7022082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022088">f</span><span class="op" id="7022089">.</span><span class="op" id="7022090">(</span><span class="op" id="7022091">*</span><span class="ident" id="7022092">fileWriter</span><span class="op" id="7022102">)</span><span class="op" id="7022103">.</span><span class="ident" id="7022104">crc32</span>&nbsp;<span class="op" id="7022110">=</span>&nbsp;<span class="ident" id="7022112">fakeHash32</span><span class="op" id="7022122">{</span><span class="op" id="7022123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022126">chunk</span>&nbsp;<span class="op" id="7022132">:=</span>&nbsp;<span class="builtinfunc" id="7022135">make</span><span class="op" id="7022139">(</span><span class="op" id="7022140">[</span><span class="op" id="7022141">]</span><span class="builtintype" id="7022142">byte</span><span class="op" id="7022146">,</span>&nbsp;<span class="ident" id="7022148">chunkSize</span><span class="op" id="7022157">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022160">for</span>&nbsp;<span class="ident" id="7022164">i</span>&nbsp;<span class="op" id="7022166">:=</span>&nbsp;<span class="keyword" id="7022169">range</span>&nbsp;<span class="ident" id="7022175">chunk</span>&nbsp;<span class="op" id="7022181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022185">chunk</span><span class="op" id="7022190">[</span><span class="ident" id="7022191">i</span><span class="op" id="7022192">]</span>&nbsp;<span class="op" id="7022194">=</span>&nbsp;<span class="string" id="7022196">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022204">for</span>&nbsp;<span class="ident" id="7022208">i</span>&nbsp;<span class="op" id="7022210">:=</span>&nbsp;<span class="num" id="7022213">0</span><span class="op" id="7022214">;</span>&nbsp;<span class="ident" id="7022216">i</span>&nbsp;<span class="op" id="7022218">&lt;</span>&nbsp;<span class="ident" id="7022220">chunks</span><span class="op" id="7022226">;</span>&nbsp;<span class="ident" id="7022228">i</span><span class="op" id="7022229">++</span>&nbsp;<span class="op" id="7022232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022236">_</span><span class="op" id="7022237">,</span>&nbsp;<span class="ident" id="7022239">err</span>&nbsp;<span class="op" id="7022243">:=</span>&nbsp;<span class="ident" id="7022246">f</span><span class="op" id="7022247">.</span><span class="ident" id="7022248">Write</span><span class="op" id="7022253">(</span><span class="ident" id="7022254">chunk</span><span class="op" id="7022259">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022263">if</span>&nbsp;<span class="ident" id="7022266">err</span>&nbsp;<span class="op" id="7022270">!=</span>&nbsp;<span class="ident" id="7022273">nil</span>&nbsp;<span class="op" id="7022277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022282">t</span><span class="op" id="7022283">.</span><span class="ident" id="7022284">Fatal</span><span class="op" id="7022289">(</span><span class="string" id="7022290">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7022304">,</span>&nbsp;<span class="ident" id="7022306">err</span><span class="op" id="7022309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022319">end</span>&nbsp;<span class="op" id="7022323">:=</span>&nbsp;<span class="op" id="7022326">[</span><span class="op" id="7022327">]</span><span class="builtintype" id="7022328">byte</span><span class="op" id="7022332">(</span><span class="string" id="7022333">&#34;END\n&#34;</span><span class="op" id="7022340">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022343">_</span><span class="op" id="7022344">,</span>&nbsp;<span class="ident" id="7022346">err</span>&nbsp;<span class="op" id="7022350">=</span>&nbsp;<span class="ident" id="7022352">f</span><span class="op" id="7022353">.</span><span class="ident" id="7022354">Write</span><span class="op" id="7022359">(</span><span class="ident" id="7022360">end</span><span class="op" id="7022363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022366">if</span>&nbsp;<span class="ident" id="7022369">err</span>&nbsp;<span class="op" id="7022373">!=</span>&nbsp;<span class="ident" id="7022376">nil</span>&nbsp;<span class="op" id="7022380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022384">t</span><span class="op" id="7022385">.</span><span class="ident" id="7022386">Fatal</span><span class="op" id="7022391">(</span><span class="string" id="7022392">&#34;write&nbsp;end:&#34;</span><span class="op" id="7022404">,</span>&nbsp;<span class="ident" id="7022406">err</span><span class="op" id="7022409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022415">if</span>&nbsp;<span class="ident" id="7022418">err</span>&nbsp;<span class="op" id="7022422">:=</span>&nbsp;<span class="ident" id="7022425">w</span><span class="op" id="7022426">.</span><span class="ident" id="7022427">Close</span><span class="op" id="7022432">(</span><span class="op" id="7022433">)</span><span class="op" id="7022434">;</span>&nbsp;<span class="ident" id="7022436">err</span>&nbsp;<span class="op" id="7022440">!=</span>&nbsp;<span class="ident" id="7022443">nil</span>&nbsp;<span class="op" id="7022447">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022451">t</span><span class="op" id="7022452">.</span><span class="ident" id="7022453">Fatal</span><span class="op" id="7022458">(</span><span class="ident" id="7022459">err</span><span class="op" id="7022462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022469">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022531">r</span><span class="op" id="7022532">,</span>&nbsp;<span class="ident" id="7022534">err</span>&nbsp;<span class="op" id="7022538">:=</span>&nbsp;<span class="ident" id="7022541">NewReader</span><span class="op" id="7022550">(</span><span class="ident" id="7022551">buf</span><span class="op" id="7022554">,</span>&nbsp;<span class="ident" id="7022556">int64</span><span class="op" id="7022561">(</span><span class="ident" id="7022562">buf</span><span class="op" id="7022565">.</span><span class="ident" id="7022566">Size</span><span class="op" id="7022570">(</span><span class="op" id="7022571">)</span><span class="op" id="7022572">)</span><span class="op" id="7022573">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022576">if</span>&nbsp;<span class="ident" id="7022579">err</span>&nbsp;<span class="op" id="7022583">!=</span>&nbsp;<span class="ident" id="7022586">nil</span>&nbsp;<span class="op" id="7022590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022594">t</span><span class="op" id="7022595">.</span><span class="ident" id="7022596">Fatal</span><span class="op" id="7022601">(</span><span class="string" id="7022602">&#34;reader:&#34;</span><span class="op" id="7022611">,</span>&nbsp;<span class="ident" id="7022613">err</span><span class="op" id="7022616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022622">f0</span>&nbsp;<span class="op" id="7022625">:=</span>&nbsp;<span class="ident" id="7022628">r</span><span class="op" id="7022629">.</span><span class="ident" id="7022630">File</span><span class="op" id="7022634">[</span><span class="num" id="7022635">0</span><span class="op" id="7022636">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022639">rc</span><span class="op" id="7022641">,</span>&nbsp;<span class="ident" id="7022643">err</span>&nbsp;<span class="op" id="7022647">:=</span>&nbsp;<span class="ident" id="7022650">f0</span><span class="op" id="7022652">.</span><span class="ident" id="7022653">Open</span><span class="op" id="7022657">(</span><span class="op" id="7022658">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022661">if</span>&nbsp;<span class="ident" id="7022664">err</span>&nbsp;<span class="op" id="7022668">!=</span>&nbsp;<span class="ident" id="7022671">nil</span>&nbsp;<span class="op" id="7022675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022679">t</span><span class="op" id="7022680">.</span><span class="ident" id="7022681">Fatal</span><span class="op" id="7022686">(</span><span class="string" id="7022687">&#34;opening:&#34;</span><span class="op" id="7022697">,</span>&nbsp;<span class="ident" id="7022699">err</span><span class="op" id="7022702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022708">rc</span><span class="op" id="7022710">.</span><span class="op" id="7022711">(</span><span class="op" id="7022712">*</span><span class="ident" id="7022713">checksumReader</span><span class="op" id="7022727">)</span><span class="op" id="7022728">.</span><span class="ident" id="7022729">hash</span>&nbsp;<span class="op" id="7022734">=</span>&nbsp;<span class="ident" id="7022736">fakeHash32</span><span class="op" id="7022746">{</span><span class="op" id="7022747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022750">for</span>&nbsp;<span class="ident" id="7022754">i</span>&nbsp;<span class="op" id="7022756">:=</span>&nbsp;<span class="num" id="7022759">0</span><span class="op" id="7022760">;</span>&nbsp;<span class="ident" id="7022762">i</span>&nbsp;<span class="op" id="7022764">&lt;</span>&nbsp;<span class="ident" id="7022766">chunks</span><span class="op" id="7022772">;</span>&nbsp;<span class="ident" id="7022774">i</span><span class="op" id="7022775">++</span>&nbsp;<span class="op" id="7022778">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022782">_</span><span class="op" id="7022783">,</span>&nbsp;<span class="ident" id="7022785">err</span>&nbsp;<span class="op" id="7022789">:=</span>&nbsp;<span class="ident" id="7022792">io</span><span class="op" id="7022794">.</span><span class="ident" id="7022795">ReadFull</span><span class="op" id="7022803">(</span><span class="ident" id="7022804">rc</span><span class="op" id="7022806">,</span>&nbsp;<span class="ident" id="7022808">chunk</span><span class="op" id="7022813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022817">if</span>&nbsp;<span class="ident" id="7022820">err</span>&nbsp;<span class="op" id="7022824">!=</span>&nbsp;<span class="ident" id="7022827">nil</span>&nbsp;<span class="op" id="7022831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022836">t</span><span class="op" id="7022837">.</span><span class="ident" id="7022838">Fatal</span><span class="op" id="7022843">(</span><span class="string" id="7022844">&#34;read:&#34;</span><span class="op" id="7022851">,</span>&nbsp;<span class="ident" id="7022853">err</span><span class="op" id="7022856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022863">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022866">gotEnd</span><span class="op" id="7022872">,</span>&nbsp;<span class="ident" id="7022874">err</span>&nbsp;<span class="op" id="7022878">:=</span>&nbsp;<span class="ident" id="7022881">ioutil</span><span class="op" id="7022887">.</span><span class="ident" id="7022888">ReadAll</span><span class="op" id="7022895">(</span><span class="ident" id="7022896">rc</span><span class="op" id="7022898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022901">if</span>&nbsp;<span class="ident" id="7022904">err</span>&nbsp;<span class="op" id="7022908">!=</span>&nbsp;<span class="ident" id="7022911">nil</span>&nbsp;<span class="op" id="7022915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022919">t</span><span class="op" id="7022920">.</span><span class="ident" id="7022921">Fatal</span><span class="op" id="7022926">(</span><span class="string" id="7022927">&#34;read&nbsp;end:&#34;</span><span class="op" id="7022938">,</span>&nbsp;<span class="ident" id="7022940">err</span><span class="op" id="7022943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022949">if</span>&nbsp;<span class="op" id="7022952">!</span><span class="ident" id="7022953">bytes</span><span class="op" id="7022958">.</span><span class="ident" id="7022959">Equal</span><span class="op" id="7022964">(</span><span class="ident" id="7022965">gotEnd</span><span class="op" id="7022971">,</span>&nbsp;<span class="ident" id="7022973">end</span><span class="op" id="7022976">)</span>&nbsp;<span class="op" id="7022978">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022982">t</span><span class="op" id="7022983">.</span><span class="ident" id="7022984">Errorf</span><span class="op" id="7022990">(</span><span class="string" id="7022991">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7023025">,</span>&nbsp;<span class="ident" id="7023027">gotEnd</span><span class="op" id="7023033">,</span>&nbsp;<span class="ident" id="7023035">end</span><span class="op" id="7023038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023044">err</span>&nbsp;<span class="op" id="7023048">=</span>&nbsp;<span class="ident" id="7023050">rc</span><span class="op" id="7023052">.</span><span class="ident" id="7023053">Close</span><span class="op" id="7023058">(</span><span class="op" id="7023059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023062">if</span>&nbsp;<span class="ident" id="7023065">err</span>&nbsp;<span class="op" id="7023069">!=</span>&nbsp;<span class="ident" id="7023072">nil</span>&nbsp;<span class="op" id="7023076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023080">t</span><span class="op" id="7023081">.</span><span class="ident" id="7023082">Fatal</span><span class="op" id="7023087">(</span><span class="string" id="7023088">&#34;closing:&#34;</span><span class="op" id="7023098">,</span>&nbsp;<span class="ident" id="7023100">err</span><span class="op" id="7023103">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023109">if</span>&nbsp;<span class="ident" id="7023112">size</span>&nbsp;<span class="op" id="7023117">==</span>&nbsp;<span class="num" id="7023120">1</span><span class="op" id="7023121">&lt;&lt;</span><span class="num" id="7023123">32</span>&nbsp;<span class="op" id="7023126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023130">if</span>&nbsp;<span class="ident" id="7023133">got</span><span class="op" id="7023136">,</span>&nbsp;<span class="ident" id="7023138">want</span>&nbsp;<span class="op" id="7023143">:=</span>&nbsp;<span class="ident" id="7023146">f0</span><span class="op" id="7023148">.</span><span class="ident" id="7023149">UncompressedSize</span><span class="op" id="7023165">,</span>&nbsp;<span class="builtintype" id="7023167">uint32</span><span class="op" id="7023173">(</span><span class="ident" id="7023174">uint32max</span><span class="op" id="7023183">)</span><span class="op" id="7023184">;</span>&nbsp;<span class="ident" id="7023186">got</span>&nbsp;<span class="op" id="7023190">!=</span>&nbsp;<span class="ident" id="7023193">want</span>&nbsp;<span class="op" id="7023198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023203">t</span><span class="op" id="7023204">.</span><span class="ident" id="7023205">Errorf</span><span class="op" id="7023211">(</span><span class="string" id="7023212">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7023242">,</span>&nbsp;<span class="ident" id="7023244">got</span><span class="op" id="7023247">,</span>&nbsp;<span class="ident" id="7023249">want</span><span class="op" id="7023253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023257">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023264">if</span>&nbsp;<span class="ident" id="7023267">got</span><span class="op" id="7023270">,</span>&nbsp;<span class="ident" id="7023272">want</span>&nbsp;<span class="op" id="7023277">:=</span>&nbsp;<span class="ident" id="7023280">f0</span><span class="op" id="7023282">.</span><span class="ident" id="7023283">UncompressedSize64</span><span class="op" id="7023301">,</span>&nbsp;<span class="ident" id="7023303">uint64</span><span class="op" id="7023309">(</span><span class="ident" id="7023310">size</span><span class="op" id="7023314">)</span><span class="op" id="7023315">+</span><span class="ident" id="7023316">uint64</span><span class="op" id="7023322">(</span><span class="builtinfunc" id="7023323">len</span><span class="op" id="7023326">(</span><span class="ident" id="7023327">end</span><span class="op" id="7023330">)</span><span class="op" id="7023331">)</span><span class="op" id="7023332">;</span>&nbsp;<span class="ident" id="7023334">got</span>&nbsp;<span class="op" id="7023338">!=</span>&nbsp;<span class="ident" id="7023341">want</span>&nbsp;<span class="op" id="7023346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023350">t</span><span class="op" id="7023351">.</span><span class="ident" id="7023352">Errorf</span><span class="op" id="7023358">(</span><span class="string" id="7023359">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7023391">,</span>&nbsp;<span class="ident" id="7023393">got</span><span class="op" id="7023396">,</span>&nbsp;<span class="ident" id="7023398">want</span><span class="op" id="7023402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023405">}</span><br>
<span class="lineno">305</span><span class="op" id="7023407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7023410">func</span>&nbsp;<span class="ident" id="7023415">testInvalidHeader</span><span class="op" id="7023432">(</span><span class="ident" id="7023433">h</span>&nbsp;<span class="op" id="7023435">*</span><span class="ident" id="7023436">FileHeader</span><span class="op" id="7023446">,</span>&nbsp;<span class="ident" id="7023448">t</span>&nbsp;<span class="op" id="7023450">*</span><span class="ident" id="7023451">testing</span><span class="op" id="7023458">.</span><span class="ident" id="7023459">T</span><span class="op" id="7023460">)</span>&nbsp;<span class="op" id="7023462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023465">var</span>&nbsp;<span class="ident" id="7023469">buf</span>&nbsp;<span class="ident" id="7023473">bytes</span><span class="op" id="7023478">.</span><span class="ident" id="7023479">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023487">z</span>&nbsp;<span class="op" id="7023489">:=</span>&nbsp;<span class="ident" id="7023492">NewWriter</span><span class="op" id="7023501">(</span><span class="op" id="7023502">&amp;</span><span class="ident" id="7023503">buf</span><span class="op" id="7023506">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023510">f</span><span class="op" id="7023511">,</span>&nbsp;<span class="ident" id="7023513">err</span>&nbsp;<span class="op" id="7023517">:=</span>&nbsp;<span class="ident" id="7023520">z</span><span class="op" id="7023521">.</span><span class="ident" id="7023522">CreateHeader</span><span class="op" id="7023534">(</span><span class="ident" id="7023535">h</span><span class="op" id="7023536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023539">if</span>&nbsp;<span class="ident" id="7023542">err</span>&nbsp;<span class="op" id="7023546">!=</span>&nbsp;<span class="ident" id="7023549">nil</span>&nbsp;<span class="op" id="7023553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023557">t</span><span class="op" id="7023558">.</span><span class="ident" id="7023559">Fatalf</span><span class="op" id="7023565">(</span><span class="string" id="7023566">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7023593">,</span>&nbsp;<span class="ident" id="7023595">err</span><span class="op" id="7023598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023601">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023604">if</span>&nbsp;<span class="ident" id="7023607">_</span><span class="op" id="7023608">,</span>&nbsp;<span class="ident" id="7023610">err</span>&nbsp;<span class="op" id="7023614">:=</span>&nbsp;<span class="ident" id="7023617">f</span><span class="op" id="7023618">.</span><span class="ident" id="7023619">Write</span><span class="op" id="7023624">(</span><span class="op" id="7023625">[</span><span class="op" id="7023626">]</span><span class="builtintype" id="7023627">byte</span><span class="op" id="7023631">(</span><span class="string" id="7023632">&#34;hi&#34;</span><span class="op" id="7023636">)</span><span class="op" id="7023637">)</span><span class="op" id="7023638">;</span>&nbsp;<span class="ident" id="7023640">err</span>&nbsp;<span class="op" id="7023644">!=</span>&nbsp;<span class="ident" id="7023647">nil</span>&nbsp;<span class="op" id="7023651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023655">t</span><span class="op" id="7023656">.</span><span class="ident" id="7023657">Fatalf</span><span class="op" id="7023663">(</span><span class="string" id="7023664">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7023691">,</span>&nbsp;<span class="ident" id="7023693">err</span><span class="op" id="7023696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023702">if</span>&nbsp;<span class="ident" id="7023705">err</span>&nbsp;<span class="op" id="7023709">:=</span>&nbsp;<span class="ident" id="7023712">z</span><span class="op" id="7023713">.</span><span class="ident" id="7023714">Close</span><span class="op" id="7023719">(</span><span class="op" id="7023720">)</span><span class="op" id="7023721">;</span>&nbsp;<span class="ident" id="7023723">err</span>&nbsp;<span class="op" id="7023727">!=</span>&nbsp;<span class="ident" id="7023730">nil</span>&nbsp;<span class="op" id="7023734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023738">t</span><span class="op" id="7023739">.</span><span class="ident" id="7023740">Fatalf</span><span class="op" id="7023746">(</span><span class="string" id="7023747">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7023777">,</span>&nbsp;<span class="ident" id="7023779">err</span><span class="op" id="7023782">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023789">b</span>&nbsp;<span class="op" id="7023791">:=</span>&nbsp;<span class="ident" id="7023794">buf</span><span class="op" id="7023797">.</span><span class="ident" id="7023798">Bytes</span><span class="op" id="7023803">(</span><span class="op" id="7023804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023807">if</span>&nbsp;<span class="ident" id="7023810">_</span><span class="op" id="7023811">,</span>&nbsp;<span class="ident" id="7023813">err</span>&nbsp;<span class="op" id="7023817">=</span>&nbsp;<span class="ident" id="7023819">NewReader</span><span class="op" id="7023828">(</span><span class="ident" id="7023829">bytes</span><span class="op" id="7023834">.</span><span class="ident" id="7023835">NewReader</span><span class="op" id="7023844">(</span><span class="ident" id="7023845">b</span><span class="op" id="7023846">)</span><span class="op" id="7023847">,</span>&nbsp;<span class="ident" id="7023849">int64</span><span class="op" id="7023854">(</span><span class="builtinfunc" id="7023855">len</span><span class="op" id="7023858">(</span><span class="ident" id="7023859">b</span><span class="op" id="7023860">)</span><span class="op" id="7023861">)</span><span class="op" id="7023862">)</span><span class="op" id="7023863">;</span>&nbsp;<span class="ident" id="7023865">err</span>&nbsp;<span class="op" id="7023869">!=</span>&nbsp;<span class="ident" id="7023872">ErrFormat</span>&nbsp;<span class="op" id="7023882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023886">t</span><span class="op" id="7023887">.</span><span class="ident" id="7023888">Fatalf</span><span class="op" id="7023894">(</span><span class="string" id="7023895">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7023923">,</span>&nbsp;<span class="ident" id="7023925">err</span><span class="op" id="7023928">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7023931">}</span><br>
<span class="lineno"></span><span class="op" id="7023933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7023936">func</span>&nbsp;<span class="ident" id="7023941">testValidHeader</span><span class="op" id="7023956">(</span><span class="ident" id="7023957">h</span>&nbsp;<span class="op" id="7023959">*</span><span class="ident" id="7023960">FileHeader</span><span class="op" id="7023970">,</span>&nbsp;<span class="ident" id="7023972">t</span>&nbsp;<span class="op" id="7023974">*</span><span class="ident" id="7023975">testing</span><span class="op" id="7023982">.</span><span class="ident" id="7023983">T</span><span class="op" id="7023984">)</span>&nbsp;<span class="op" id="7023986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023989">var</span>&nbsp;<span class="ident" id="7023993">buf</span>&nbsp;<span class="ident" id="7023997">bytes</span><span class="op" id="7024002">.</span><span class="ident" id="7024003">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024011">z</span>&nbsp;<span class="op" id="7024013">:=</span>&nbsp;<span class="ident" id="7024016">NewWriter</span><span class="op" id="7024025">(</span><span class="op" id="7024026">&amp;</span><span class="ident" id="7024027">buf</span><span class="op" id="7024030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024034">f</span><span class="op" id="7024035">,</span>&nbsp;<span class="ident" id="7024037">err</span>&nbsp;<span class="op" id="7024041">:=</span>&nbsp;<span class="ident" id="7024044">z</span><span class="op" id="7024045">.</span><span class="ident" id="7024046">CreateHeader</span><span class="op" id="7024058">(</span><span class="ident" id="7024059">h</span><span class="op" id="7024060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024063">if</span>&nbsp;<span class="ident" id="7024066">err</span>&nbsp;<span class="op" id="7024070">!=</span>&nbsp;<span class="ident" id="7024073">nil</span>&nbsp;<span class="op" id="7024077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024081">t</span><span class="op" id="7024082">.</span><span class="ident" id="7024083">Fatalf</span><span class="op" id="7024089">(</span><span class="string" id="7024090">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7024117">,</span>&nbsp;<span class="ident" id="7024119">err</span><span class="op" id="7024122">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024128">if</span>&nbsp;<span class="ident" id="7024131">_</span><span class="op" id="7024132">,</span>&nbsp;<span class="ident" id="7024134">err</span>&nbsp;<span class="op" id="7024138">:=</span>&nbsp;<span class="ident" id="7024141">f</span><span class="op" id="7024142">.</span><span class="ident" id="7024143">Write</span><span class="op" id="7024148">(</span><span class="op" id="7024149">[</span><span class="op" id="7024150">]</span><span class="builtintype" id="7024151">byte</span><span class="op" id="7024155">(</span><span class="string" id="7024156">&#34;hi&#34;</span><span class="op" id="7024160">)</span><span class="op" id="7024161">)</span><span class="op" id="7024162">;</span>&nbsp;<span class="ident" id="7024164">err</span>&nbsp;<span class="op" id="7024168">!=</span>&nbsp;<span class="ident" id="7024171">nil</span>&nbsp;<span class="op" id="7024175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024179">t</span><span class="op" id="7024180">.</span><span class="ident" id="7024181">Fatalf</span><span class="op" id="7024187">(</span><span class="string" id="7024188">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7024215">,</span>&nbsp;<span class="ident" id="7024217">err</span><span class="op" id="7024220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024226">if</span>&nbsp;<span class="ident" id="7024229">err</span>&nbsp;<span class="op" id="7024233">:=</span>&nbsp;<span class="ident" id="7024236">z</span><span class="op" id="7024237">.</span><span class="ident" id="7024238">Close</span><span class="op" id="7024243">(</span><span class="op" id="7024244">)</span><span class="op" id="7024245">;</span>&nbsp;<span class="ident" id="7024247">err</span>&nbsp;<span class="op" id="7024251">!=</span>&nbsp;<span class="ident" id="7024254">nil</span>&nbsp;<span class="op" id="7024258">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024262">t</span><span class="op" id="7024263">.</span><span class="ident" id="7024264">Fatalf</span><span class="op" id="7024270">(</span><span class="string" id="7024271">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7024301">,</span>&nbsp;<span class="ident" id="7024303">err</span><span class="op" id="7024306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024313">b</span>&nbsp;<span class="op" id="7024315">:=</span>&nbsp;<span class="ident" id="7024318">buf</span><span class="op" id="7024321">.</span><span class="ident" id="7024322">Bytes</span><span class="op" id="7024327">(</span><span class="op" id="7024328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024331">if</span>&nbsp;<span class="ident" id="7024334">_</span><span class="op" id="7024335">,</span>&nbsp;<span class="ident" id="7024337">err</span>&nbsp;<span class="op" id="7024341">=</span>&nbsp;<span class="ident" id="7024343">NewReader</span><span class="op" id="7024352">(</span><span class="ident" id="7024353">bytes</span><span class="op" id="7024358">.</span><span class="ident" id="7024359">NewReader</span><span class="op" id="7024368">(</span><span class="ident" id="7024369">b</span><span class="op" id="7024370">)</span><span class="op" id="7024371">,</span>&nbsp;<span class="ident" id="7024373">int64</span><span class="op" id="7024378">(</span><span class="builtinfunc" id="7024379">len</span><span class="op" id="7024382">(</span><span class="ident" id="7024383">b</span><span class="op" id="7024384">)</span><span class="op" id="7024385">)</span><span class="op" id="7024386">)</span><span class="op" id="7024387">;</span>&nbsp;<span class="ident" id="7024389">err</span>&nbsp;<span class="op" id="7024393">!=</span>&nbsp;<span class="ident" id="7024396">nil</span>&nbsp;<span class="op" id="7024400">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024404">t</span><span class="op" id="7024405">.</span><span class="ident" id="7024406">Fatalf</span><span class="op" id="7024412">(</span><span class="string" id="7024413">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7024435">,</span>&nbsp;<span class="ident" id="7024437">err</span><span class="op" id="7024440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024443">}</span><br>
<span class="lineno"></span><span class="op" id="7024445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7024448">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7024463">func</span>&nbsp;<span class="ident" id="7024468">TestHeaderInvalidTagAndSize</span><span class="op" id="7024495">(</span><span class="ident" id="7024496">t</span>&nbsp;<span class="op" id="7024498">*</span><span class="ident" id="7024499">testing</span><span class="op" id="7024506">.</span><span class="ident" id="7024507">T</span><span class="op" id="7024508">)</span>&nbsp;<span class="op" id="7024510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024513">const</span>&nbsp;<span class="ident" id="7024519">timeFormat</span>&nbsp;<span class="op" id="7024530">=</span>&nbsp;<span class="string" id="7024532">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024560">ts</span>&nbsp;<span class="op" id="7024563">:=</span>&nbsp;<span class="ident" id="7024566">time</span><span class="op" id="7024570">.</span><span class="ident" id="7024571">Now</span><span class="op" id="7024574">(</span><span class="op" id="7024575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024578">filename</span>&nbsp;<span class="op" id="7024587">:=</span>&nbsp;<span class="ident" id="7024590">ts</span><span class="op" id="7024592">.</span><span class="ident" id="7024593">Format</span><span class="op" id="7024599">(</span><span class="ident" id="7024600">timeFormat</span><span class="op" id="7024610">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024614">h</span>&nbsp;<span class="op" id="7024616">:=</span>&nbsp;<span class="ident" id="7024619">FileHeader</span><span class="op" id="7024629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024633">Name</span><span class="op" id="7024637">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7024641">filename</span><span class="op" id="7024649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024653">Method</span><span class="op" id="7024659">:</span>&nbsp;<span class="ident" id="7024661">Deflate</span><span class="op" id="7024668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024672">Extra</span><span class="op" id="7024677">:</span>&nbsp;&nbsp;<span class="op" id="7024680">[</span><span class="op" id="7024681">]</span><span class="builtintype" id="7024682">byte</span><span class="op" id="7024686">(</span><span class="ident" id="7024687">ts</span><span class="op" id="7024689">.</span><span class="ident" id="7024690">Format</span><span class="op" id="7024696">(</span><span class="ident" id="7024697">time</span><span class="op" id="7024701">.</span><span class="ident" id="7024702">RFC3339Nano</span><span class="op" id="7024713">)</span><span class="op" id="7024714">)</span><span class="op" id="7024715">,</span>&nbsp;<span class="comment" id="7024717">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024744">h</span><span class="op" id="7024745">.</span><span class="ident" id="7024746">SetModTime</span><span class="op" id="7024756">(</span><span class="ident" id="7024757">ts</span><span class="op" id="7024759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024763">testInvalidHeader</span><span class="op" id="7024780">(</span><span class="op" id="7024781">&amp;</span><span class="ident" id="7024782">h</span><span class="op" id="7024783">,</span>&nbsp;<span class="ident" id="7024785">t</span><span class="op" id="7024786">)</span><br>
<span class="lineno"></span><span class="op" id="7024788">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7024791">func</span>&nbsp;<span class="ident" id="7024796">TestHeaderTooShort</span><span class="op" id="7024814">(</span><span class="ident" id="7024815">t</span>&nbsp;<span class="op" id="7024817">*</span><span class="ident" id="7024818">testing</span><span class="op" id="7024825">.</span><span class="ident" id="7024826">T</span><span class="op" id="7024827">)</span>&nbsp;<span class="op" id="7024829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024832">h</span>&nbsp;<span class="op" id="7024834">:=</span>&nbsp;<span class="ident" id="7024837">FileHeader</span><span class="op" id="7024847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024851">Name</span><span class="op" id="7024855">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7024859">&#34;foo.txt&#34;</span><span class="op" id="7024868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024872">Method</span><span class="op" id="7024878">:</span>&nbsp;<span class="ident" id="7024880">Deflate</span><span class="op" id="7024887">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024891">Extra</span><span class="op" id="7024896">:</span>&nbsp;&nbsp;<span class="op" id="7024899">[</span><span class="op" id="7024900">]</span><span class="builtintype" id="7024901">byte</span><span class="op" id="7024905">{</span><span class="ident" id="7024906">zip64ExtraId</span><span class="op" id="7024918">}</span><span class="op" id="7024919">,</span>&nbsp;<span class="comment" id="7024921">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024941">testInvalidHeader</span><span class="op" id="7024958">(</span><span class="op" id="7024959">&amp;</span><span class="ident" id="7024960">h</span><span class="op" id="7024961">,</span>&nbsp;<span class="ident" id="7024963">t</span><span class="op" id="7024964">)</span><br>
<span class="lineno"></span><span class="op" id="7024966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7024969">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7025025">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7025052">func</span>&nbsp;<span class="ident" id="7025057">TestZeroLengthHeader</span><span class="op" id="7025077">(</span><span class="ident" id="7025078">t</span>&nbsp;<span class="op" id="7025080">*</span><span class="ident" id="7025081">testing</span><span class="op" id="7025088">.</span><span class="ident" id="7025089">T</span><span class="op" id="7025090">)</span>&nbsp;<span class="op" id="7025092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025095">h</span>&nbsp;<span class="op" id="7025097">:=</span>&nbsp;<span class="ident" id="7025100">FileHeader</span><span class="op" id="7025110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025114">Name</span><span class="op" id="7025118">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7025122">&#34;extadata.txt&#34;</span><span class="op" id="7025136">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025140">Method</span><span class="op" id="7025146">:</span>&nbsp;<span class="ident" id="7025148">Deflate</span><span class="op" id="7025155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025159">Extra</span><span class="op" id="7025164">:</span>&nbsp;<span class="op" id="7025166">[</span><span class="op" id="7025167">]</span><span class="builtintype" id="7025168">byte</span><span class="op" id="7025172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7025177">85</span><span class="op" id="7025179">,</span>&nbsp;<span class="num" id="7025181">84</span><span class="op" id="7025183">,</span>&nbsp;<span class="num" id="7025185">5</span><span class="op" id="7025186">,</span>&nbsp;<span class="num" id="7025188">0</span><span class="op" id="7025189">,</span>&nbsp;<span class="num" id="7025191">3</span><span class="op" id="7025192">,</span>&nbsp;<span class="num" id="7025194">154</span><span class="op" id="7025197">,</span>&nbsp;<span class="num" id="7025199">144</span><span class="op" id="7025202">,</span>&nbsp;<span class="num" id="7025204">195</span><span class="op" id="7025207">,</span>&nbsp;<span class="num" id="7025209">77</span><span class="op" id="7025211">,</span>&nbsp;<span class="comment" id="7025213">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7025236">85</span><span class="op" id="7025238">,</span>&nbsp;<span class="num" id="7025240">120</span><span class="op" id="7025243">,</span>&nbsp;<span class="num" id="7025245">0</span><span class="op" id="7025246">,</span>&nbsp;<span class="num" id="7025248">0</span><span class="op" id="7025249">,</span>&nbsp;<span class="comment" id="7025251">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025273">}</span><span class="op" id="7025274">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025280">testValidHeader</span><span class="op" id="7025295">(</span><span class="op" id="7025296">&amp;</span><span class="ident" id="7025297">h</span><span class="op" id="7025298">,</span>&nbsp;<span class="ident" id="7025300">t</span><span class="op" id="7025301">)</span><br>
<span class="lineno"></span><span class="op" id="7025303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7025306">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7025376">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7025447">func</span>&nbsp;<span class="ident" id="7025452">BenchmarkZip64Test</span><span class="op" id="7025470">(</span><span class="ident" id="7025471">b</span>&nbsp;<span class="op" id="7025473">*</span><span class="ident" id="7025474">testing</span><span class="op" id="7025481">.</span><span class="ident" id="7025482">B</span><span class="op" id="7025483">)</span>&nbsp;<span class="op" id="7025485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025488">for</span>&nbsp;<span class="ident" id="7025492">i</span>&nbsp;<span class="op" id="7025494">:=</span>&nbsp;<span class="num" id="7025497">0</span><span class="op" id="7025498">;</span>&nbsp;<span class="ident" id="7025500">i</span>&nbsp;<span class="op" id="7025502">&lt;</span>&nbsp;<span class="ident" id="7025504">b</span><span class="op" id="7025505">.</span><span class="ident" id="7025506">N</span><span class="op" id="7025507">;</span>&nbsp;<span class="ident" id="7025509">i</span><span class="op" id="7025510">++</span>&nbsp;<span class="op" id="7025513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025517">testZip64</span><span class="op" id="7025526">(</span><span class="ident" id="7025527">b</span><span class="op" id="7025528">,</span>&nbsp;<span class="num" id="7025530">1</span><span class="op" id="7025531">&lt;&lt;</span><span class="num" id="7025533">26</span><span class="op" id="7025535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025538">}</span><br>
<span class="lineno">395</span><span class="op" id="7025540">}</span>
</div>
</body>
</html>
