<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html" class="current">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6810674">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6810729">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6810783">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6810834">package</span>&nbsp;<span class="ident" id="6810842">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6810855">import</span>&nbsp;<span class="op" id="6810862">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6810865">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6810874">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6810887">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6810897">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6810905">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6810916">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6810926">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6810929">type</span>&nbsp;<span class="ident" id="6810934">testCase</span>&nbsp;<span class="keyword" id="6810943">struct</span>&nbsp;<span class="op" id="6810950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6810953">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6810962">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6810971">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6810993">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6811002">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6811011">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811031">patterns</span>&nbsp;<span class="op" id="6811040">[</span><span class="op" id="6811041">]</span><span class="builtintype" id="6811042">string</span>&nbsp;<span class="comment" id="6811049">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="6811071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6811074">var</span>&nbsp;<span class="ident" id="6811078">testCases</span>&nbsp;<span class="op" id="6811088">=</span>&nbsp;<span class="op" id="6811090">[</span><span class="op" id="6811091">]</span><span class="ident" id="6811092">testCase</span><span class="op" id="6811100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811107">&#34;empty&nbsp;string&#34;</span><span class="op" id="6811121">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811125">&#34;&#34;</span><span class="op" id="6811127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811131">[</span><span class="op" id="6811132">]</span><span class="builtintype" id="6811133">string</span><span class="op" id="6811139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811144">&#34;&#34;</span><span class="op" id="6811146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811151">&#34;foo&#34;</span><span class="op" id="6811156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811161">&#34;(foo)&#34;</span><span class="op" id="6811168">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811173">&#34;.*&#34;</span><span class="op" id="6811177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811182">&#34;a*&#34;</span><span class="op" id="6811186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811190">}</span><span class="op" id="6811191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811194">}</span><span class="op" id="6811195">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811203">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="6811212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811216">&#34;aaaaaaaaaa&#34;</span><span class="op" id="6811228">,</span>&nbsp;<span class="comment" id="6811230">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811242">[</span><span class="op" id="6811243">]</span><span class="builtintype" id="6811244">string</span><span class="op" id="6811250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811255">&#34;&#34;</span><span class="op" id="6811257">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811262">&#34;a&#34;</span><span class="op" id="6811265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811270">&#34;aa&#34;</span><span class="op" id="6811274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811279">&#34;aaa&#34;</span><span class="op" id="6811284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811289">&#34;aaaa&#34;</span><span class="op" id="6811295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811300">&#34;aaaaa&#34;</span><span class="op" id="6811307">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811312">&#34;aaaaaa&#34;</span><span class="op" id="6811320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811325">&#34;aaaaaaa&#34;</span><span class="op" id="6811334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811339">&#34;aaaaaaaa&#34;</span><span class="op" id="6811349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811354">&#34;aaaaaaaaa&#34;</span><span class="op" id="6811365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811370">&#34;aaaaaaaaaa&#34;</span><span class="op" id="6811382">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811387">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="6811400">,</span>&nbsp;<span class="comment" id="6811402">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811415">&#34;.&#34;</span><span class="op" id="6811418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811423">&#34;.*&#34;</span><span class="op" id="6811427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811432">&#34;a+&#34;</span><span class="op" id="6811436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811441">&#34;aa+&#34;</span><span class="op" id="6811446">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811451">&#34;aaaa[b]?&#34;</span><span class="op" id="6811461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811466">&#34;aaa*&#34;</span><span class="op" id="6811472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811476">}</span><span class="op" id="6811477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811480">}</span><span class="op" id="6811481">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811489">&#34;abc&#34;</span><span class="op" id="6811494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811498">&#34;abc&#34;</span><span class="op" id="6811503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811507">[</span><span class="op" id="6811508">]</span><span class="builtintype" id="6811509">string</span><span class="op" id="6811515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811520">&#34;a&#34;</span><span class="op" id="6811523">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811528">&#34;b&#34;</span><span class="op" id="6811531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811536">&#34;c&#34;</span><span class="op" id="6811539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811544">&#34;ab&#34;</span><span class="op" id="6811548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811553">&#34;bc&#34;</span><span class="op" id="6811557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811562">&#34;abc&#34;</span><span class="op" id="6811567">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811572">&#34;a.c&#34;</span><span class="op" id="6811577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811582">&#34;a(b|c)&#34;</span><span class="op" id="6811590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811595">&#34;abc?&#34;</span><span class="op" id="6811601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811605">}</span><span class="op" id="6811606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811609">}</span><span class="op" id="6811610">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811618">&#34;barbara*3&#34;</span><span class="op" id="6811629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811633">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="6811656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811660">[</span><span class="op" id="6811661">]</span><span class="builtintype" id="6811662">string</span><span class="op" id="6811668">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811673">&#34;a&#34;</span><span class="op" id="6811676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811681">&#34;bar&#34;</span><span class="op" id="6811686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811691">&#34;rab&#34;</span><span class="op" id="6811696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811701">&#34;arab&#34;</span><span class="op" id="6811707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811712">&#34;barbar&#34;</span><span class="op" id="6811720">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811725">&#34;bara?bar&#34;</span><span class="op" id="6811735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811739">}</span><span class="op" id="6811740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811743">}</span><span class="op" id="6811744">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811748">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811752">&#34;typing&nbsp;drill&#34;</span><span class="op" id="6811766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811770">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="6811841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811845">[</span><span class="op" id="6811846">]</span><span class="builtintype" id="6811847">string</span><span class="op" id="6811853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811858">&#34;Now&#34;</span><span class="op" id="6811863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811868">&#34;the&nbsp;time&#34;</span><span class="op" id="6811878">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811883">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="6811900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811905">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="6811963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6811968">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="6811984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811988">}</span><span class="op" id="6811989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811992">}</span><span class="op" id="6811993">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6812001">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="6812019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6812023">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="6812068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812072">[</span><span class="op" id="6812073">]</span><span class="builtintype" id="6812074">string</span><span class="op" id="6812080">{</span><span class="op" id="6812081">}</span><span class="op" id="6812082">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812085">}</span><span class="op" id="6812086">,</span><br>
<span class="lineno"></span><span class="op" id="6812088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6812091">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="6812160">func</span>&nbsp;<span class="ident" id="6812165">find</span><span class="op" id="6812169">(</span><span class="ident" id="6812170">src</span><span class="op" id="6812173">,</span>&nbsp;<span class="ident" id="6812175">s</span>&nbsp;<span class="builtintype" id="6812177">string</span><span class="op" id="6812183">,</span>&nbsp;<span class="ident" id="6812185">n</span>&nbsp;<span class="builtintype" id="6812187">int</span><span class="op" id="6812190">)</span>&nbsp;<span class="op" id="6812192">[</span><span class="op" id="6812193">]</span><span class="builtintype" id="6812194">int</span>&nbsp;<span class="op" id="6812198">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812201">var</span>&nbsp;<span class="ident" id="6812205">res</span>&nbsp;<span class="op" id="6812209">[</span><span class="op" id="6812210">]</span><span class="builtintype" id="6812211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812216">if</span>&nbsp;<span class="ident" id="6812219">s</span>&nbsp;<span class="op" id="6812221">!=</span>&nbsp;<span class="string" id="6812224">&#34;&#34;</span>&nbsp;<span class="op" id="6812227">&amp;&amp;</span>&nbsp;<span class="ident" id="6812230">n</span>&nbsp;<span class="op" id="6812232">!=</span>&nbsp;<span class="num" id="6812235">0</span>&nbsp;<span class="op" id="6812237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6812241">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812285">for</span>&nbsp;<span class="ident" id="6812289">i</span>&nbsp;<span class="op" id="6812291">:=</span>&nbsp;<span class="op" id="6812294">-</span><span class="num" id="6812295">1</span><span class="op" id="6812296">;</span>&nbsp;<span class="ident" id="6812298">n</span>&nbsp;<span class="op" id="6812300">&lt;</span>&nbsp;<span class="num" id="6812302">0</span>&nbsp;<span class="op" id="6812304">||</span>&nbsp;<span class="builtinfunc" id="6812307">len</span><span class="op" id="6812310">(</span><span class="ident" id="6812311">res</span><span class="op" id="6812314">)</span>&nbsp;<span class="op" id="6812316">&lt;</span>&nbsp;<span class="ident" id="6812318">n</span><span class="op" id="6812319">;</span>&nbsp;<span class="op" id="6812321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812326">j</span>&nbsp;<span class="op" id="6812328">:=</span>&nbsp;<span class="ident" id="6812331">strings</span><span class="op" id="6812338">.</span><span class="ident" id="6812339">Index</span><span class="op" id="6812344">(</span><span class="ident" id="6812345">src</span><span class="op" id="6812348">[</span><span class="ident" id="6812349">i</span><span class="op" id="6812350">+</span><span class="num" id="6812351">1</span><span class="op" id="6812352">:</span><span class="op" id="6812353">]</span><span class="op" id="6812354">,</span>&nbsp;<span class="ident" id="6812356">s</span><span class="op" id="6812357">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812362">if</span>&nbsp;<span class="ident" id="6812365">j</span>&nbsp;<span class="op" id="6812367">&lt;</span>&nbsp;<span class="num" id="6812369">0</span>&nbsp;<span class="op" id="6812371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812377">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812391">i</span>&nbsp;<span class="op" id="6812393">+=</span>&nbsp;<span class="ident" id="6812396">j</span>&nbsp;<span class="op" id="6812398">+</span>&nbsp;<span class="num" id="6812400">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812405">res</span>&nbsp;<span class="op" id="6812409">=</span>&nbsp;<span class="builtinfunc" id="6812411">append</span><span class="op" id="6812417">(</span><span class="ident" id="6812418">res</span><span class="op" id="6812421">,</span>&nbsp;<span class="ident" id="6812423">i</span><span class="op" id="6812424">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812434">return</span>&nbsp;<span class="ident" id="6812441">res</span><br>
<span class="lineno"></span><span class="op" id="6812445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6812448">func</span>&nbsp;<span class="ident" id="6812453">testLookup</span><span class="op" id="6812463">(</span><span class="ident" id="6812464">t</span>&nbsp;<span class="op" id="6812466">*</span><span class="ident" id="6812467">testing</span><span class="op" id="6812474">.</span><span class="ident" id="6812475">T</span><span class="op" id="6812476">,</span>&nbsp;<span class="ident" id="6812478">tc</span>&nbsp;<span class="op" id="6812481">*</span><span class="ident" id="6812482">testCase</span><span class="op" id="6812490">,</span>&nbsp;<span class="ident" id="6812492">x</span>&nbsp;<span class="op" id="6812494">*</span><span class="ident" id="6812495">Index</span><span class="op" id="6812500">,</span>&nbsp;<span class="ident" id="6812502">s</span>&nbsp;<span class="builtintype" id="6812504">string</span><span class="op" id="6812510">,</span>&nbsp;<span class="ident" id="6812512">n</span>&nbsp;<span class="builtintype" id="6812514">int</span><span class="op" id="6812517">)</span>&nbsp;<span class="op" id="6812519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812522">res</span>&nbsp;<span class="op" id="6812526">:=</span>&nbsp;<span class="ident" id="6812529">x</span><span class="op" id="6812530">.</span><span class="ident" id="6812531">Lookup</span><span class="op" id="6812537">(</span><span class="op" id="6812538">[</span><span class="op" id="6812539">]</span><span class="builtintype" id="6812540">byte</span><span class="op" id="6812544">(</span><span class="ident" id="6812545">s</span><span class="op" id="6812546">)</span><span class="op" id="6812547">,</span>&nbsp;<span class="ident" id="6812549">n</span><span class="op" id="6812550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812553">exp</span>&nbsp;<span class="op" id="6812557">:=</span>&nbsp;<span class="ident" id="6812560">find</span><span class="op" id="6812564">(</span><span class="ident" id="6812565">tc</span><span class="op" id="6812567">.</span><span class="ident" id="6812568">source</span><span class="op" id="6812574">,</span>&nbsp;<span class="ident" id="6812576">s</span><span class="op" id="6812577">,</span>&nbsp;<span class="ident" id="6812579">n</span><span class="op" id="6812580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6812584">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812617">if</span>&nbsp;<span class="builtinfunc" id="6812620">len</span><span class="op" id="6812623">(</span><span class="ident" id="6812624">res</span><span class="op" id="6812627">)</span>&nbsp;<span class="op" id="6812629">!=</span>&nbsp;<span class="builtinfunc" id="6812632">len</span><span class="op" id="6812635">(</span><span class="ident" id="6812636">exp</span><span class="op" id="6812639">)</span>&nbsp;<span class="op" id="6812641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812645">t</span><span class="op" id="6812646">.</span><span class="ident" id="6812647">Errorf</span><span class="op" id="6812653">(</span><span class="string" id="6812654">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6812712">,</span>&nbsp;<span class="ident" id="6812714">tc</span><span class="op" id="6812716">.</span><span class="ident" id="6812717">name</span><span class="op" id="6812721">,</span>&nbsp;<span class="ident" id="6812723">s</span><span class="op" id="6812724">,</span>&nbsp;<span class="ident" id="6812726">n</span><span class="op" id="6812727">,</span>&nbsp;<span class="builtinfunc" id="6812729">len</span><span class="op" id="6812732">(</span><span class="ident" id="6812733">exp</span><span class="op" id="6812736">)</span><span class="op" id="6812737">,</span>&nbsp;<span class="builtinfunc" id="6812739">len</span><span class="op" id="6812742">(</span><span class="ident" id="6812743">res</span><span class="op" id="6812746">)</span><span class="op" id="6812747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6812754">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6812830">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6812906">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6812982">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6813047">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813129">sort</span><span class="op" id="6813133">.</span><span class="ident" id="6813134">Ints</span><span class="op" id="6813138">(</span><span class="ident" id="6813139">res</span><span class="op" id="6813142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813145">for</span>&nbsp;<span class="ident" id="6813149">i</span><span class="op" id="6813150">,</span>&nbsp;<span class="ident" id="6813152">r</span>&nbsp;<span class="op" id="6813154">:=</span>&nbsp;<span class="keyword" id="6813157">range</span>&nbsp;<span class="ident" id="6813163">res</span>&nbsp;<span class="op" id="6813167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813171">if</span>&nbsp;<span class="ident" id="6813174">r</span>&nbsp;<span class="op" id="6813176">&lt;</span>&nbsp;<span class="num" id="6813178">0</span>&nbsp;<span class="op" id="6813180">||</span>&nbsp;<span class="builtinfunc" id="6813183">len</span><span class="op" id="6813186">(</span><span class="ident" id="6813187">tc</span><span class="op" id="6813189">.</span><span class="ident" id="6813190">source</span><span class="op" id="6813196">)</span>&nbsp;<span class="op" id="6813198">&lt;=</span>&nbsp;<span class="ident" id="6813201">r</span>&nbsp;<span class="op" id="6813203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813208">t</span><span class="op" id="6813209">.</span><span class="ident" id="6813210">Errorf</span><span class="op" id="6813216">(</span><span class="string" id="6813217">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="6813288">,</span>&nbsp;<span class="ident" id="6813290">tc</span><span class="op" id="6813292">.</span><span class="ident" id="6813293">name</span><span class="op" id="6813297">,</span>&nbsp;<span class="ident" id="6813299">s</span><span class="op" id="6813300">,</span>&nbsp;<span class="ident" id="6813302">i</span><span class="op" id="6813303">,</span>&nbsp;<span class="ident" id="6813305">n</span><span class="op" id="6813306">,</span>&nbsp;<span class="ident" id="6813308">r</span><span class="op" id="6813309">,</span>&nbsp;<span class="builtinfunc" id="6813311">len</span><span class="op" id="6813314">(</span><span class="ident" id="6813315">tc</span><span class="op" id="6813317">.</span><span class="ident" id="6813318">source</span><span class="op" id="6813324">)</span><span class="op" id="6813325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813329">}</span>&nbsp;<span class="keyword" id="6813331">else</span>&nbsp;<span class="keyword" id="6813336">if</span>&nbsp;<span class="op" id="6813339">!</span><span class="ident" id="6813340">strings</span><span class="op" id="6813347">.</span><span class="ident" id="6813348">HasPrefix</span><span class="op" id="6813357">(</span><span class="ident" id="6813358">tc</span><span class="op" id="6813360">.</span><span class="ident" id="6813361">source</span><span class="op" id="6813367">[</span><span class="ident" id="6813368">r</span><span class="op" id="6813369">:</span><span class="op" id="6813370">]</span><span class="op" id="6813371">,</span>&nbsp;<span class="ident" id="6813373">s</span><span class="op" id="6813374">)</span>&nbsp;<span class="op" id="6813376">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813381">t</span><span class="op" id="6813382">.</span><span class="ident" id="6813383">Errorf</span><span class="op" id="6813389">(</span><span class="string" id="6813390">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="6813452">,</span>&nbsp;<span class="ident" id="6813454">tc</span><span class="op" id="6813456">.</span><span class="ident" id="6813457">name</span><span class="op" id="6813461">,</span>&nbsp;<span class="ident" id="6813463">s</span><span class="op" id="6813464">,</span>&nbsp;<span class="ident" id="6813466">i</span><span class="op" id="6813467">,</span>&nbsp;<span class="ident" id="6813469">n</span><span class="op" id="6813470">,</span>&nbsp;<span class="ident" id="6813472">r</span><span class="op" id="6813473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813481">if</span>&nbsp;<span class="ident" id="6813484">i</span>&nbsp;<span class="op" id="6813486">&gt;</span>&nbsp;<span class="num" id="6813488">0</span>&nbsp;<span class="op" id="6813490">&amp;&amp;</span>&nbsp;<span class="ident" id="6813493">res</span><span class="op" id="6813496">[</span><span class="ident" id="6813497">i</span><span class="op" id="6813498">-</span><span class="num" id="6813499">1</span><span class="op" id="6813500">]</span>&nbsp;<span class="op" id="6813502">==</span>&nbsp;<span class="ident" id="6813505">r</span>&nbsp;<span class="op" id="6813507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813512">t</span><span class="op" id="6813513">.</span><span class="ident" id="6813514">Errorf</span><span class="op" id="6813520">(</span><span class="string" id="6813521">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="6813587">,</span>&nbsp;<span class="ident" id="6813589">tc</span><span class="op" id="6813591">.</span><span class="ident" id="6813592">name</span><span class="op" id="6813596">,</span>&nbsp;<span class="ident" id="6813598">s</span><span class="op" id="6813599">,</span>&nbsp;<span class="ident" id="6813601">i</span><span class="op" id="6813602">,</span>&nbsp;<span class="ident" id="6813604">n</span><span class="op" id="6813605">,</span>&nbsp;<span class="ident" id="6813607">r</span><span class="op" id="6813608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813612">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813619">if</span>&nbsp;<span class="ident" id="6813622">n</span>&nbsp;<span class="op" id="6813624">&lt;</span>&nbsp;<span class="num" id="6813626">0</span>&nbsp;<span class="op" id="6813628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6813632">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813693">for</span>&nbsp;<span class="ident" id="6813697">i</span><span class="op" id="6813698">,</span>&nbsp;<span class="ident" id="6813700">r</span>&nbsp;<span class="op" id="6813702">:=</span>&nbsp;<span class="keyword" id="6813705">range</span>&nbsp;<span class="ident" id="6813711">res</span>&nbsp;<span class="op" id="6813715">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813720">e</span>&nbsp;<span class="op" id="6813722">:=</span>&nbsp;<span class="ident" id="6813725">exp</span><span class="op" id="6813728">[</span><span class="ident" id="6813729">i</span><span class="op" id="6813730">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813735">if</span>&nbsp;<span class="ident" id="6813738">r</span>&nbsp;<span class="op" id="6813740">!=</span>&nbsp;<span class="ident" id="6813743">e</span>&nbsp;<span class="op" id="6813745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813751">t</span><span class="op" id="6813752">.</span><span class="ident" id="6813753">Errorf</span><span class="op" id="6813759">(</span><span class="string" id="6813760">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6813818">,</span>&nbsp;<span class="ident" id="6813820">tc</span><span class="op" id="6813822">.</span><span class="ident" id="6813823">name</span><span class="op" id="6813827">,</span>&nbsp;<span class="ident" id="6813829">s</span><span class="op" id="6813830">,</span>&nbsp;<span class="ident" id="6813832">i</span><span class="op" id="6813833">,</span>&nbsp;<span class="ident" id="6813835">e</span><span class="op" id="6813836">,</span>&nbsp;<span class="ident" id="6813838">r</span><span class="op" id="6813839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813848">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813851">}</span><br>
<span class="lineno"></span><span class="op" id="6813853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6813856">func</span>&nbsp;<span class="ident" id="6813861">testFindAllIndex</span><span class="op" id="6813877">(</span><span class="ident" id="6813878">t</span>&nbsp;<span class="op" id="6813880">*</span><span class="ident" id="6813881">testing</span><span class="op" id="6813888">.</span><span class="ident" id="6813889">T</span><span class="op" id="6813890">,</span>&nbsp;<span class="ident" id="6813892">tc</span>&nbsp;<span class="op" id="6813895">*</span><span class="ident" id="6813896">testCase</span><span class="op" id="6813904">,</span>&nbsp;<span class="ident" id="6813906">x</span>&nbsp;<span class="op" id="6813908">*</span><span class="ident" id="6813909">Index</span><span class="op" id="6813914">,</span>&nbsp;<span class="ident" id="6813916">rx</span>&nbsp;<span class="op" id="6813919">*</span><span class="ident" id="6813920">regexp</span><span class="op" id="6813926">.</span><span class="ident" id="6813927">Regexp</span><span class="op" id="6813933">,</span>&nbsp;<span class="ident" id="6813935">n</span>&nbsp;<span class="builtintype" id="6813937">int</span><span class="op" id="6813940">)</span>&nbsp;<span class="op" id="6813942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813945">res</span>&nbsp;<span class="op" id="6813949">:=</span>&nbsp;<span class="ident" id="6813952">x</span><span class="op" id="6813953">.</span><span class="ident" id="6813954">FindAllIndex</span><span class="op" id="6813966">(</span><span class="ident" id="6813967">rx</span><span class="op" id="6813969">,</span>&nbsp;<span class="ident" id="6813971">n</span><span class="op" id="6813972">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813975">exp</span>&nbsp;<span class="op" id="6813979">:=</span>&nbsp;<span class="ident" id="6813982">rx</span><span class="op" id="6813984">.</span><span class="ident" id="6813985">FindAllStringIndex</span><span class="op" id="6814003">(</span><span class="ident" id="6814004">tc</span><span class="op" id="6814006">.</span><span class="ident" id="6814007">source</span><span class="op" id="6814013">,</span>&nbsp;<span class="ident" id="6814015">n</span><span class="op" id="6814016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814020">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814053">if</span>&nbsp;<span class="builtinfunc" id="6814056">len</span><span class="op" id="6814059">(</span><span class="ident" id="6814060">res</span><span class="op" id="6814063">)</span>&nbsp;<span class="op" id="6814065">!=</span>&nbsp;<span class="builtinfunc" id="6814068">len</span><span class="op" id="6814071">(</span><span class="ident" id="6814072">exp</span><span class="op" id="6814075">)</span>&nbsp;<span class="op" id="6814077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814081">t</span><span class="op" id="6814082">.</span><span class="ident" id="6814083">Errorf</span><span class="op" id="6814089">(</span><span class="string" id="6814090">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6814154">,</span>&nbsp;<span class="ident" id="6814156">tc</span><span class="op" id="6814158">.</span><span class="ident" id="6814159">name</span><span class="op" id="6814163">,</span>&nbsp;<span class="ident" id="6814165">rx</span><span class="op" id="6814167">,</span>&nbsp;<span class="ident" id="6814169">n</span><span class="op" id="6814170">,</span>&nbsp;<span class="builtinfunc" id="6814172">len</span><span class="op" id="6814175">(</span><span class="ident" id="6814176">exp</span><span class="op" id="6814179">)</span><span class="op" id="6814180">,</span>&nbsp;<span class="builtinfunc" id="6814182">len</span><span class="op" id="6814185">(</span><span class="ident" id="6814186">res</span><span class="op" id="6814189">)</span><span class="op" id="6814190">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814197">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814273">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814351">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814429">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814494">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814573">for</span>&nbsp;<span class="ident" id="6814577">i</span><span class="op" id="6814578">,</span>&nbsp;<span class="ident" id="6814580">r</span>&nbsp;<span class="op" id="6814582">:=</span>&nbsp;<span class="keyword" id="6814585">range</span>&nbsp;<span class="ident" id="6814591">res</span>&nbsp;<span class="op" id="6814595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814599">if</span>&nbsp;<span class="ident" id="6814602">r</span><span class="op" id="6814603">[</span><span class="num" id="6814604">0</span><span class="op" id="6814605">]</span>&nbsp;<span class="op" id="6814607">&lt;</span>&nbsp;<span class="num" id="6814609">0</span>&nbsp;<span class="op" id="6814611">||</span>&nbsp;<span class="ident" id="6814614">r</span><span class="op" id="6814615">[</span><span class="num" id="6814616">0</span><span class="op" id="6814617">]</span>&nbsp;<span class="op" id="6814619">&gt;</span>&nbsp;<span class="ident" id="6814621">r</span><span class="op" id="6814622">[</span><span class="num" id="6814623">1</span><span class="op" id="6814624">]</span>&nbsp;<span class="op" id="6814626">||</span>&nbsp;<span class="builtinfunc" id="6814629">len</span><span class="op" id="6814632">(</span><span class="ident" id="6814633">tc</span><span class="op" id="6814635">.</span><span class="ident" id="6814636">source</span><span class="op" id="6814642">)</span>&nbsp;<span class="op" id="6814644">&lt;</span>&nbsp;<span class="ident" id="6814646">r</span><span class="op" id="6814647">[</span><span class="num" id="6814648">1</span><span class="op" id="6814649">]</span>&nbsp;<span class="op" id="6814651">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814656">t</span><span class="op" id="6814657">.</span><span class="ident" id="6814658">Errorf</span><span class="op" id="6814664">(</span><span class="string" id="6814665">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="6814736">,</span>&nbsp;<span class="ident" id="6814738">tc</span><span class="op" id="6814740">.</span><span class="ident" id="6814741">name</span><span class="op" id="6814745">,</span>&nbsp;<span class="ident" id="6814747">rx</span><span class="op" id="6814749">,</span>&nbsp;<span class="ident" id="6814751">i</span><span class="op" id="6814752">,</span>&nbsp;<span class="ident" id="6814754">n</span><span class="op" id="6814755">,</span>&nbsp;<span class="ident" id="6814757">r</span><span class="op" id="6814758">[</span><span class="num" id="6814759">0</span><span class="op" id="6814760">]</span><span class="op" id="6814761">,</span>&nbsp;<span class="ident" id="6814763">r</span><span class="op" id="6814764">[</span><span class="num" id="6814765">1</span><span class="op" id="6814766">]</span><span class="op" id="6814767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814771">}</span>&nbsp;<span class="keyword" id="6814773">else</span>&nbsp;<span class="keyword" id="6814778">if</span>&nbsp;<span class="op" id="6814781">!</span><span class="ident" id="6814782">rx</span><span class="op" id="6814784">.</span><span class="ident" id="6814785">MatchString</span><span class="op" id="6814796">(</span><span class="ident" id="6814797">tc</span><span class="op" id="6814799">.</span><span class="ident" id="6814800">source</span><span class="op" id="6814806">[</span><span class="ident" id="6814807">r</span><span class="op" id="6814808">[</span><span class="num" id="6814809">0</span><span class="op" id="6814810">]</span><span class="op" id="6814811">:</span><span class="ident" id="6814812">r</span><span class="op" id="6814813">[</span><span class="num" id="6814814">1</span><span class="op" id="6814815">]</span><span class="op" id="6814816">]</span><span class="op" id="6814817">)</span>&nbsp;<span class="op" id="6814819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814824">t</span><span class="op" id="6814825">.</span><span class="ident" id="6814826">Errorf</span><span class="op" id="6814832">(</span><span class="string" id="6814833">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="6814901">,</span>&nbsp;<span class="ident" id="6814903">tc</span><span class="op" id="6814905">.</span><span class="ident" id="6814906">name</span><span class="op" id="6814910">,</span>&nbsp;<span class="ident" id="6814912">rx</span><span class="op" id="6814914">,</span>&nbsp;<span class="ident" id="6814916">i</span><span class="op" id="6814917">,</span>&nbsp;<span class="ident" id="6814919">n</span><span class="op" id="6814920">,</span>&nbsp;<span class="ident" id="6814922">r</span><span class="op" id="6814923">[</span><span class="num" id="6814924">0</span><span class="op" id="6814925">]</span><span class="op" id="6814926">,</span>&nbsp;<span class="ident" id="6814928">r</span><span class="op" id="6814929">[</span><span class="num" id="6814930">1</span><span class="op" id="6814931">]</span><span class="op" id="6814932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814939">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814943">if</span>&nbsp;<span class="ident" id="6814946">n</span>&nbsp;<span class="op" id="6814948">&lt;</span>&nbsp;<span class="num" id="6814950">0</span>&nbsp;<span class="op" id="6814952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814956">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815017">for</span>&nbsp;<span class="ident" id="6815021">i</span><span class="op" id="6815022">,</span>&nbsp;<span class="ident" id="6815024">r</span>&nbsp;<span class="op" id="6815026">:=</span>&nbsp;<span class="keyword" id="6815029">range</span>&nbsp;<span class="ident" id="6815035">res</span>&nbsp;<span class="op" id="6815039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815044">e</span>&nbsp;<span class="op" id="6815046">:=</span>&nbsp;<span class="ident" id="6815049">exp</span><span class="op" id="6815052">[</span><span class="ident" id="6815053">i</span><span class="op" id="6815054">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815059">if</span>&nbsp;<span class="ident" id="6815062">r</span><span class="op" id="6815063">[</span><span class="num" id="6815064">0</span><span class="op" id="6815065">]</span>&nbsp;<span class="op" id="6815067">!=</span>&nbsp;<span class="ident" id="6815070">e</span><span class="op" id="6815071">[</span><span class="num" id="6815072">0</span><span class="op" id="6815073">]</span>&nbsp;<span class="op" id="6815075">||</span>&nbsp;<span class="ident" id="6815078">r</span><span class="op" id="6815079">[</span><span class="num" id="6815080">1</span><span class="op" id="6815081">]</span>&nbsp;<span class="op" id="6815083">!=</span>&nbsp;<span class="ident" id="6815086">e</span><span class="op" id="6815087">[</span><span class="num" id="6815088">1</span><span class="op" id="6815089">]</span>&nbsp;<span class="op" id="6815091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815097">t</span><span class="op" id="6815098">.</span><span class="ident" id="6815099">Errorf</span><span class="op" id="6815105">(</span><span class="string" id="6815106">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="6815182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815189">tc</span><span class="op" id="6815191">.</span><span class="ident" id="6815192">name</span><span class="op" id="6815196">,</span>&nbsp;<span class="ident" id="6815198">rx</span><span class="op" id="6815200">,</span>&nbsp;<span class="ident" id="6815202">i</span><span class="op" id="6815203">,</span>&nbsp;<span class="ident" id="6815205">e</span><span class="op" id="6815206">[</span><span class="num" id="6815207">0</span><span class="op" id="6815208">]</span><span class="op" id="6815209">,</span>&nbsp;<span class="ident" id="6815211">e</span><span class="op" id="6815212">[</span><span class="num" id="6815213">1</span><span class="op" id="6815214">]</span><span class="op" id="6815215">,</span>&nbsp;<span class="ident" id="6815217">r</span><span class="op" id="6815218">[</span><span class="num" id="6815219">0</span><span class="op" id="6815220">]</span><span class="op" id="6815221">,</span>&nbsp;<span class="ident" id="6815223">r</span><span class="op" id="6815224">[</span><span class="num" id="6815225">1</span><span class="op" id="6815226">]</span><span class="op" id="6815227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815236">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815239">}</span><br>
<span class="lineno"></span><span class="op" id="6815241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6815244">func</span>&nbsp;<span class="ident" id="6815249">testLookups</span><span class="op" id="6815260">(</span><span class="ident" id="6815261">t</span>&nbsp;<span class="op" id="6815263">*</span><span class="ident" id="6815264">testing</span><span class="op" id="6815271">.</span><span class="ident" id="6815272">T</span><span class="op" id="6815273">,</span>&nbsp;<span class="ident" id="6815275">tc</span>&nbsp;<span class="op" id="6815278">*</span><span class="ident" id="6815279">testCase</span><span class="op" id="6815287">,</span>&nbsp;<span class="ident" id="6815289">x</span>&nbsp;<span class="op" id="6815291">*</span><span class="ident" id="6815292">Index</span><span class="op" id="6815297">,</span>&nbsp;<span class="ident" id="6815299">n</span>&nbsp;<span class="builtintype" id="6815301">int</span><span class="op" id="6815304">)</span>&nbsp;<span class="op" id="6815306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815309">for</span>&nbsp;<span class="ident" id="6815313">_</span><span class="op" id="6815314">,</span>&nbsp;<span class="ident" id="6815316">pat</span>&nbsp;<span class="op" id="6815320">:=</span>&nbsp;<span class="keyword" id="6815323">range</span>&nbsp;<span class="ident" id="6815329">tc</span><span class="op" id="6815331">.</span><span class="ident" id="6815332">patterns</span>&nbsp;<span class="op" id="6815341">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815345">testLookup</span><span class="op" id="6815355">(</span><span class="ident" id="6815356">t</span><span class="op" id="6815357">,</span>&nbsp;<span class="ident" id="6815359">tc</span><span class="op" id="6815361">,</span>&nbsp;<span class="ident" id="6815363">x</span><span class="op" id="6815364">,</span>&nbsp;<span class="ident" id="6815366">pat</span><span class="op" id="6815369">,</span>&nbsp;<span class="ident" id="6815371">n</span><span class="op" id="6815372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815376">if</span>&nbsp;<span class="ident" id="6815379">rx</span><span class="op" id="6815381">,</span>&nbsp;<span class="ident" id="6815383">err</span>&nbsp;<span class="op" id="6815387">:=</span>&nbsp;<span class="ident" id="6815390">regexp</span><span class="op" id="6815396">.</span><span class="ident" id="6815397">Compile</span><span class="op" id="6815404">(</span><span class="ident" id="6815405">pat</span><span class="op" id="6815408">)</span><span class="op" id="6815409">;</span>&nbsp;<span class="ident" id="6815411">err</span>&nbsp;<span class="op" id="6815415">==</span>&nbsp;<span class="ident" id="6815418">nil</span>&nbsp;<span class="op" id="6815422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815427">testFindAllIndex</span><span class="op" id="6815443">(</span><span class="ident" id="6815444">t</span><span class="op" id="6815445">,</span>&nbsp;<span class="ident" id="6815447">tc</span><span class="op" id="6815449">,</span>&nbsp;<span class="ident" id="6815451">x</span><span class="op" id="6815452">,</span>&nbsp;<span class="ident" id="6815454">rx</span><span class="op" id="6815456">,</span>&nbsp;<span class="ident" id="6815458">n</span><span class="op" id="6815459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815466">}</span><br>
<span class="lineno">205</span><span class="op" id="6815468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6815471">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="6815515">type</span>&nbsp;<span class="ident" id="6815520">index</span>&nbsp;<span class="ident" id="6815526">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="6815533">func</span>&nbsp;<span class="op" id="6815538">(</span><span class="ident" id="6815539">x</span>&nbsp;<span class="op" id="6815541">*</span><span class="ident" id="6815542">index</span><span class="op" id="6815547">)</span>&nbsp;<span class="ident" id="6815549">Len</span><span class="op" id="6815552">(</span><span class="op" id="6815553">)</span>&nbsp;<span class="builtintype" id="6815555">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815569">{</span>&nbsp;<span class="keyword" id="6815571">return</span>&nbsp;<span class="builtinfunc" id="6815578">len</span><span class="op" id="6815581">(</span><span class="ident" id="6815582">x</span><span class="op" id="6815583">.</span><span class="ident" id="6815584">sa</span><span class="op" id="6815586">)</span>&nbsp;<span class="op" id="6815588">}</span><br>
<span class="lineno"></span><span class="keyword" id="6815590">func</span>&nbsp;<span class="op" id="6815595">(</span><span class="ident" id="6815596">x</span>&nbsp;<span class="op" id="6815598">*</span><span class="ident" id="6815599">index</span><span class="op" id="6815604">)</span>&nbsp;<span class="ident" id="6815606">Less</span><span class="op" id="6815610">(</span><span class="ident" id="6815611">i</span><span class="op" id="6815612">,</span>&nbsp;<span class="ident" id="6815614">j</span>&nbsp;<span class="builtintype" id="6815616">int</span><span class="op" id="6815619">)</span>&nbsp;<span class="builtintype" id="6815621">bool</span>&nbsp;<span class="op" id="6815626">{</span>&nbsp;<span class="keyword" id="6815628">return</span>&nbsp;<span class="ident" id="6815635">bytes</span><span class="op" id="6815640">.</span><span class="ident" id="6815641">Compare</span><span class="op" id="6815648">(</span><span class="ident" id="6815649">x</span><span class="op" id="6815650">.</span><span class="ident" id="6815651">at</span><span class="op" id="6815653">(</span><span class="ident" id="6815654">i</span><span class="op" id="6815655">)</span><span class="op" id="6815656">,</span>&nbsp;<span class="ident" id="6815658">x</span><span class="op" id="6815659">.</span><span class="ident" id="6815660">at</span><span class="op" id="6815662">(</span><span class="ident" id="6815663">j</span><span class="op" id="6815664">)</span><span class="op" id="6815665">)</span>&nbsp;<span class="op" id="6815667">&lt;</span>&nbsp;<span class="num" id="6815669">0</span>&nbsp;<span class="op" id="6815671">}</span><br>
<span class="lineno"></span><span class="keyword" id="6815673">func</span>&nbsp;<span class="op" id="6815678">(</span><span class="ident" id="6815679">x</span>&nbsp;<span class="op" id="6815681">*</span><span class="ident" id="6815682">index</span><span class="op" id="6815687">)</span>&nbsp;<span class="ident" id="6815689">Swap</span><span class="op" id="6815693">(</span><span class="ident" id="6815694">i</span><span class="op" id="6815695">,</span>&nbsp;<span class="ident" id="6815697">j</span>&nbsp;<span class="builtintype" id="6815699">int</span><span class="op" id="6815702">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815709">{</span>&nbsp;<span class="ident" id="6815711">x</span><span class="op" id="6815712">.</span><span class="ident" id="6815713">sa</span><span class="op" id="6815715">[</span><span class="ident" id="6815716">i</span><span class="op" id="6815717">]</span><span class="op" id="6815718">,</span>&nbsp;<span class="ident" id="6815720">x</span><span class="op" id="6815721">.</span><span class="ident" id="6815722">sa</span><span class="op" id="6815724">[</span><span class="ident" id="6815725">j</span><span class="op" id="6815726">]</span>&nbsp;<span class="op" id="6815728">=</span>&nbsp;<span class="ident" id="6815730">x</span><span class="op" id="6815731">.</span><span class="ident" id="6815732">sa</span><span class="op" id="6815734">[</span><span class="ident" id="6815735">j</span><span class="op" id="6815736">]</span><span class="op" id="6815737">,</span>&nbsp;<span class="ident" id="6815739">x</span><span class="op" id="6815740">.</span><span class="ident" id="6815741">sa</span><span class="op" id="6815743">[</span><span class="ident" id="6815744">i</span><span class="op" id="6815745">]</span>&nbsp;<span class="op" id="6815747">}</span><br>
<span class="lineno"></span><span class="keyword" id="6815749">func</span>&nbsp;<span class="op" id="6815754">(</span><span class="ident" id="6815755">a</span>&nbsp;<span class="op" id="6815757">*</span><span class="ident" id="6815758">index</span><span class="op" id="6815763">)</span>&nbsp;<span class="ident" id="6815765">at</span><span class="op" id="6815767">(</span><span class="ident" id="6815768">i</span>&nbsp;<span class="builtintype" id="6815770">int</span><span class="op" id="6815773">)</span>&nbsp;<span class="op" id="6815775">[</span><span class="op" id="6815776">]</span><span class="builtintype" id="6815777">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815785">{</span>&nbsp;<span class="keyword" id="6815787">return</span>&nbsp;<span class="ident" id="6815794">a</span><span class="op" id="6815795">.</span><span class="ident" id="6815796">data</span><span class="op" id="6815800">[</span><span class="ident" id="6815801">a</span><span class="op" id="6815802">.</span><span class="ident" id="6815803">sa</span><span class="op" id="6815805">[</span><span class="ident" id="6815806">i</span><span class="op" id="6815807">]</span><span class="op" id="6815808">:</span><span class="op" id="6815809">]</span>&nbsp;<span class="op" id="6815811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6815814">func</span>&nbsp;<span class="ident" id="6815819">testConstruction</span><span class="op" id="6815835">(</span><span class="ident" id="6815836">t</span>&nbsp;<span class="op" id="6815838">*</span><span class="ident" id="6815839">testing</span><span class="op" id="6815846">.</span><span class="ident" id="6815847">T</span><span class="op" id="6815848">,</span>&nbsp;<span class="ident" id="6815850">tc</span>&nbsp;<span class="op" id="6815853">*</span><span class="ident" id="6815854">testCase</span><span class="op" id="6815862">,</span>&nbsp;<span class="ident" id="6815864">x</span>&nbsp;<span class="op" id="6815866">*</span><span class="ident" id="6815867">Index</span><span class="op" id="6815872">)</span>&nbsp;<span class="op" id="6815874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815877">if</span>&nbsp;<span class="op" id="6815880">!</span><span class="ident" id="6815881">sort</span><span class="op" id="6815885">.</span><span class="ident" id="6815886">IsSorted</span><span class="op" id="6815894">(</span><span class="op" id="6815895">(</span><span class="op" id="6815896">*</span><span class="ident" id="6815897">index</span><span class="op" id="6815902">)</span><span class="op" id="6815903">(</span><span class="ident" id="6815904">x</span><span class="op" id="6815905">)</span><span class="op" id="6815906">)</span>&nbsp;<span class="op" id="6815908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815912">t</span><span class="op" id="6815913">.</span><span class="ident" id="6815914">Errorf</span><span class="op" id="6815920">(</span><span class="string" id="6815921">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="6815949">,</span>&nbsp;<span class="ident" id="6815951">tc</span><span class="op" id="6815953">.</span><span class="ident" id="6815954">name</span><span class="op" id="6815958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815961">}</span><br>
<span class="lineno"></span><span class="op" id="6815963">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6815966">func</span>&nbsp;<span class="ident" id="6815971">equal</span><span class="op" id="6815976">(</span><span class="ident" id="6815977">x</span><span class="op" id="6815978">,</span>&nbsp;<span class="ident" id="6815980">y</span>&nbsp;<span class="op" id="6815982">*</span><span class="ident" id="6815983">Index</span><span class="op" id="6815988">)</span>&nbsp;<span class="builtintype" id="6815990">bool</span>&nbsp;<span class="op" id="6815995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815998">if</span>&nbsp;<span class="op" id="6816001">!</span><span class="ident" id="6816002">bytes</span><span class="op" id="6816007">.</span><span class="ident" id="6816008">Equal</span><span class="op" id="6816013">(</span><span class="ident" id="6816014">x</span><span class="op" id="6816015">.</span><span class="ident" id="6816016">data</span><span class="op" id="6816020">,</span>&nbsp;<span class="ident" id="6816022">y</span><span class="op" id="6816023">.</span><span class="ident" id="6816024">data</span><span class="op" id="6816028">)</span>&nbsp;<span class="op" id="6816030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816034">return</span>&nbsp;<span class="builtintype" id="6816041">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816048">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816051">for</span>&nbsp;<span class="ident" id="6816055">i</span><span class="op" id="6816056">,</span>&nbsp;<span class="ident" id="6816058">j</span>&nbsp;<span class="op" id="6816060">:=</span>&nbsp;<span class="keyword" id="6816063">range</span>&nbsp;<span class="ident" id="6816069">x</span><span class="op" id="6816070">.</span><span class="ident" id="6816071">sa</span>&nbsp;<span class="op" id="6816074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816078">if</span>&nbsp;<span class="ident" id="6816081">j</span>&nbsp;<span class="op" id="6816083">!=</span>&nbsp;<span class="ident" id="6816086">y</span><span class="op" id="6816087">.</span><span class="ident" id="6816088">sa</span><span class="op" id="6816090">[</span><span class="ident" id="6816091">i</span><span class="op" id="6816092">]</span>&nbsp;<span class="op" id="6816094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816099">return</span>&nbsp;<span class="builtintype" id="6816106">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816117">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816120">return</span>&nbsp;<span class="builtintype" id="6816127">true</span><br>
<span class="lineno"></span><span class="op" id="6816132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6816135">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="6816172">func</span>&nbsp;<span class="ident" id="6816177">testSaveRestore</span><span class="op" id="6816192">(</span><span class="ident" id="6816193">t</span>&nbsp;<span class="op" id="6816195">*</span><span class="ident" id="6816196">testing</span><span class="op" id="6816203">.</span><span class="ident" id="6816204">T</span><span class="op" id="6816205">,</span>&nbsp;<span class="ident" id="6816207">tc</span>&nbsp;<span class="op" id="6816210">*</span><span class="ident" id="6816211">testCase</span><span class="op" id="6816219">,</span>&nbsp;<span class="ident" id="6816221">x</span>&nbsp;<span class="op" id="6816223">*</span><span class="ident" id="6816224">Index</span><span class="op" id="6816229">)</span>&nbsp;<span class="builtintype" id="6816231">int</span>&nbsp;<span class="op" id="6816235">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816238">var</span>&nbsp;<span class="ident" id="6816242">buf</span>&nbsp;<span class="ident" id="6816246">bytes</span><span class="op" id="6816251">.</span><span class="ident" id="6816252">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816260">if</span>&nbsp;<span class="ident" id="6816263">err</span>&nbsp;<span class="op" id="6816267">:=</span>&nbsp;<span class="ident" id="6816270">x</span><span class="op" id="6816271">.</span><span class="ident" id="6816272">Write</span><span class="op" id="6816277">(</span><span class="op" id="6816278">&amp;</span><span class="ident" id="6816279">buf</span><span class="op" id="6816282">)</span><span class="op" id="6816283">;</span>&nbsp;<span class="ident" id="6816285">err</span>&nbsp;<span class="op" id="6816289">!=</span>&nbsp;<span class="ident" id="6816292">nil</span>&nbsp;<span class="op" id="6816296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816300">t</span><span class="op" id="6816301">.</span><span class="ident" id="6816302">Errorf</span><span class="op" id="6816308">(</span><span class="string" id="6816309">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="6816339">,</span>&nbsp;<span class="ident" id="6816341">tc</span><span class="op" id="6816343">.</span><span class="ident" id="6816344">name</span><span class="op" id="6816348">,</span>&nbsp;<span class="ident" id="6816350">err</span><span class="op" id="6816353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816359">size</span>&nbsp;<span class="op" id="6816364">:=</span>&nbsp;<span class="ident" id="6816367">buf</span><span class="op" id="6816370">.</span><span class="ident" id="6816371">Len</span><span class="op" id="6816374">(</span><span class="op" id="6816375">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816378">var</span>&nbsp;<span class="ident" id="6816382">y</span>&nbsp;<span class="ident" id="6816384">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816391">if</span>&nbsp;<span class="ident" id="6816394">err</span>&nbsp;<span class="op" id="6816398">:=</span>&nbsp;<span class="ident" id="6816401">y</span><span class="op" id="6816402">.</span><span class="ident" id="6816403">Read</span><span class="op" id="6816407">(</span><span class="op" id="6816408">&amp;</span><span class="ident" id="6816409">buf</span><span class="op" id="6816412">)</span><span class="op" id="6816413">;</span>&nbsp;<span class="ident" id="6816415">err</span>&nbsp;<span class="op" id="6816419">!=</span>&nbsp;<span class="ident" id="6816422">nil</span>&nbsp;<span class="op" id="6816426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816430">t</span><span class="op" id="6816431">.</span><span class="ident" id="6816432">Errorf</span><span class="op" id="6816438">(</span><span class="string" id="6816439">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="6816469">,</span>&nbsp;<span class="ident" id="6816471">tc</span><span class="op" id="6816473">.</span><span class="ident" id="6816474">name</span><span class="op" id="6816478">,</span>&nbsp;<span class="ident" id="6816480">err</span><span class="op" id="6816483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816489">if</span>&nbsp;<span class="op" id="6816492">!</span><span class="ident" id="6816493">equal</span><span class="op" id="6816498">(</span><span class="ident" id="6816499">x</span><span class="op" id="6816500">,</span>&nbsp;<span class="op" id="6816502">&amp;</span><span class="ident" id="6816503">y</span><span class="op" id="6816504">)</span>&nbsp;<span class="op" id="6816506">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816510">t</span><span class="op" id="6816511">.</span><span class="ident" id="6816512">Errorf</span><span class="op" id="6816518">(</span><span class="string" id="6816519">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="6816564">,</span>&nbsp;<span class="ident" id="6816566">tc</span><span class="op" id="6816568">.</span><span class="ident" id="6816569">name</span><span class="op" id="6816573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816579">return</span>&nbsp;<span class="ident" id="6816586">size</span><br>
<span class="lineno"></span><span class="op" id="6816591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6816594">func</span>&nbsp;<span class="ident" id="6816599">TestIndex</span><span class="op" id="6816608">(</span><span class="ident" id="6816609">t</span>&nbsp;<span class="op" id="6816611">*</span><span class="ident" id="6816612">testing</span><span class="op" id="6816619">.</span><span class="ident" id="6816620">T</span><span class="op" id="6816621">)</span>&nbsp;<span class="op" id="6816623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816626">for</span>&nbsp;<span class="ident" id="6816630">_</span><span class="op" id="6816631">,</span>&nbsp;<span class="ident" id="6816633">tc</span>&nbsp;<span class="op" id="6816636">:=</span>&nbsp;<span class="keyword" id="6816639">range</span>&nbsp;<span class="ident" id="6816645">testCases</span>&nbsp;<span class="op" id="6816655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816659">x</span>&nbsp;<span class="op" id="6816661">:=</span>&nbsp;<span class="ident" id="6816664">New</span><span class="op" id="6816667">(</span><span class="op" id="6816668">[</span><span class="op" id="6816669">]</span><span class="builtintype" id="6816670">byte</span><span class="op" id="6816674">(</span><span class="ident" id="6816675">tc</span><span class="op" id="6816677">.</span><span class="ident" id="6816678">source</span><span class="op" id="6816684">)</span><span class="op" id="6816685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816689">testConstruction</span><span class="op" id="6816705">(</span><span class="ident" id="6816706">t</span><span class="op" id="6816707">,</span>&nbsp;<span class="op" id="6816709">&amp;</span><span class="ident" id="6816710">tc</span><span class="op" id="6816712">,</span>&nbsp;<span class="ident" id="6816714">x</span><span class="op" id="6816715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816719">testSaveRestore</span><span class="op" id="6816734">(</span><span class="ident" id="6816735">t</span><span class="op" id="6816736">,</span>&nbsp;<span class="op" id="6816738">&amp;</span><span class="ident" id="6816739">tc</span><span class="op" id="6816741">,</span>&nbsp;<span class="ident" id="6816743">x</span><span class="op" id="6816744">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816748">testLookups</span><span class="op" id="6816759">(</span><span class="ident" id="6816760">t</span><span class="op" id="6816761">,</span>&nbsp;<span class="op" id="6816763">&amp;</span><span class="ident" id="6816764">tc</span><span class="op" id="6816766">,</span>&nbsp;<span class="ident" id="6816768">x</span><span class="op" id="6816769">,</span>&nbsp;<span class="num" id="6816771">0</span><span class="op" id="6816772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816776">testLookups</span><span class="op" id="6816787">(</span><span class="ident" id="6816788">t</span><span class="op" id="6816789">,</span>&nbsp;<span class="op" id="6816791">&amp;</span><span class="ident" id="6816792">tc</span><span class="op" id="6816794">,</span>&nbsp;<span class="ident" id="6816796">x</span><span class="op" id="6816797">,</span>&nbsp;<span class="num" id="6816799">1</span><span class="op" id="6816800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816804">testLookups</span><span class="op" id="6816815">(</span><span class="ident" id="6816816">t</span><span class="op" id="6816817">,</span>&nbsp;<span class="op" id="6816819">&amp;</span><span class="ident" id="6816820">tc</span><span class="op" id="6816822">,</span>&nbsp;<span class="ident" id="6816824">x</span><span class="op" id="6816825">,</span>&nbsp;<span class="num" id="6816827">10</span><span class="op" id="6816829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816833">testLookups</span><span class="op" id="6816844">(</span><span class="ident" id="6816845">t</span><span class="op" id="6816846">,</span>&nbsp;<span class="op" id="6816848">&amp;</span><span class="ident" id="6816849">tc</span><span class="op" id="6816851">,</span>&nbsp;<span class="ident" id="6816853">x</span><span class="op" id="6816854">,</span>&nbsp;<span class="num" id="6816856">2e9</span><span class="op" id="6816859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816863">testLookups</span><span class="op" id="6816874">(</span><span class="ident" id="6816875">t</span><span class="op" id="6816876">,</span>&nbsp;<span class="op" id="6816878">&amp;</span><span class="ident" id="6816879">tc</span><span class="op" id="6816881">,</span>&nbsp;<span class="ident" id="6816883">x</span><span class="op" id="6816884">,</span>&nbsp;<span class="op" id="6816886">-</span><span class="num" id="6816887">1</span><span class="op" id="6816888">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816891">}</span><br>
<span class="lineno"></span><span class="op" id="6816893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6816896">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="6816975">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="6817049">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="6817111">func</span>&nbsp;<span class="ident" id="6817116">benchmarkNew</span><span class="op" id="6817128">(</span><span class="ident" id="6817129">b</span>&nbsp;<span class="op" id="6817131">*</span><span class="ident" id="6817132">testing</span><span class="op" id="6817139">.</span><span class="ident" id="6817140">B</span><span class="op" id="6817141">,</span>&nbsp;<span class="ident" id="6817143">random</span>&nbsp;<span class="builtintype" id="6817150">bool</span><span class="op" id="6817154">)</span>&nbsp;<span class="op" id="6817156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817159">b</span><span class="op" id="6817160">.</span><span class="ident" id="6817161">StopTimer</span><span class="op" id="6817170">(</span><span class="op" id="6817171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817174">data</span>&nbsp;<span class="op" id="6817179">:=</span>&nbsp;<span class="builtinfunc" id="6817182">make</span><span class="op" id="6817186">(</span><span class="op" id="6817187">[</span><span class="op" id="6817188">]</span><span class="builtintype" id="6817189">byte</span><span class="op" id="6817193">,</span>&nbsp;<span class="num" id="6817195">1e6</span><span class="op" id="6817198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817201">if</span>&nbsp;<span class="ident" id="6817204">random</span>&nbsp;<span class="op" id="6817211">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817215">for</span>&nbsp;<span class="ident" id="6817219">i</span>&nbsp;<span class="op" id="6817221">:=</span>&nbsp;<span class="keyword" id="6817224">range</span>&nbsp;<span class="ident" id="6817230">data</span>&nbsp;<span class="op" id="6817235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817240">data</span><span class="op" id="6817244">[</span><span class="ident" id="6817245">i</span><span class="op" id="6817246">]</span>&nbsp;<span class="op" id="6817248">=</span>&nbsp;<span class="builtintype" id="6817250">byte</span><span class="op" id="6817254">(</span><span class="ident" id="6817255">rand</span><span class="op" id="6817259">.</span><span class="ident" id="6817260">Intn</span><span class="op" id="6817264">(</span><span class="num" id="6817265">256</span><span class="op" id="6817268">)</span><span class="op" id="6817269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817279">b</span><span class="op" id="6817280">.</span><span class="ident" id="6817281">StartTimer</span><span class="op" id="6817291">(</span><span class="op" id="6817292">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817295">for</span>&nbsp;<span class="ident" id="6817299">i</span>&nbsp;<span class="op" id="6817301">:=</span>&nbsp;<span class="num" id="6817304">0</span><span class="op" id="6817305">;</span>&nbsp;<span class="ident" id="6817307">i</span>&nbsp;<span class="op" id="6817309">&lt;</span>&nbsp;<span class="ident" id="6817311">b</span><span class="op" id="6817312">.</span><span class="ident" id="6817313">N</span><span class="op" id="6817314">;</span>&nbsp;<span class="ident" id="6817316">i</span><span class="op" id="6817317">++</span>&nbsp;<span class="op" id="6817320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817324">New</span><span class="op" id="6817327">(</span><span class="ident" id="6817328">data</span><span class="op" id="6817332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817335">}</span><br>
<span class="lineno"></span><span class="op" id="6817337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6817340">func</span>&nbsp;<span class="ident" id="6817345">BenchmarkNewIndexRandom</span><span class="op" id="6817368">(</span><span class="ident" id="6817369">b</span>&nbsp;<span class="op" id="6817371">*</span><span class="ident" id="6817372">testing</span><span class="op" id="6817379">.</span><span class="ident" id="6817380">B</span><span class="op" id="6817381">)</span>&nbsp;<span class="op" id="6817383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817386">benchmarkNew</span><span class="op" id="6817398">(</span><span class="ident" id="6817399">b</span><span class="op" id="6817400">,</span>&nbsp;<span class="builtintype" id="6817402">true</span><span class="op" id="6817406">)</span><br>
<span class="lineno"></span><span class="op" id="6817408">}</span><br>
<span class="lineno"></span><span class="keyword" id="6817410">func</span>&nbsp;<span class="ident" id="6817415">BenchmarkNewIndexRepeat</span><span class="op" id="6817438">(</span><span class="ident" id="6817439">b</span>&nbsp;<span class="op" id="6817441">*</span><span class="ident" id="6817442">testing</span><span class="op" id="6817449">.</span><span class="ident" id="6817450">B</span><span class="op" id="6817451">)</span>&nbsp;<span class="op" id="6817453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817456">benchmarkNew</span><span class="op" id="6817468">(</span><span class="ident" id="6817469">b</span><span class="op" id="6817470">,</span>&nbsp;<span class="builtintype" id="6817472">false</span><span class="op" id="6817477">)</span><br>
<span class="lineno">285</span><span class="op" id="6817479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6817482">func</span>&nbsp;<span class="ident" id="6817487">BenchmarkSaveRestore</span><span class="op" id="6817507">(</span><span class="ident" id="6817508">b</span>&nbsp;<span class="op" id="6817510">*</span><span class="ident" id="6817511">testing</span><span class="op" id="6817518">.</span><span class="ident" id="6817519">B</span><span class="op" id="6817520">)</span>&nbsp;<span class="op" id="6817522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817525">b</span><span class="op" id="6817526">.</span><span class="ident" id="6817527">StopTimer</span><span class="op" id="6817536">(</span><span class="op" id="6817537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817540">r</span>&nbsp;<span class="op" id="6817542">:=</span>&nbsp;<span class="ident" id="6817545">rand</span><span class="op" id="6817549">.</span><span class="ident" id="6817550">New</span><span class="op" id="6817553">(</span><span class="ident" id="6817554">rand</span><span class="op" id="6817558">.</span><span class="ident" id="6817559">NewSource</span><span class="op" id="6817568">(</span><span class="num" id="6817569">0x5a77a1</span><span class="op" id="6817577">)</span><span class="op" id="6817578">)</span>&nbsp;<span class="comment" id="6817580">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817615">data</span>&nbsp;<span class="op" id="6817620">:=</span>&nbsp;<span class="builtinfunc" id="6817623">make</span><span class="op" id="6817627">(</span><span class="op" id="6817628">[</span><span class="op" id="6817629">]</span><span class="builtintype" id="6817630">byte</span><span class="op" id="6817634">,</span>&nbsp;<span class="num" id="6817636">1</span><span class="op" id="6817637">&lt;&lt;</span><span class="num" id="6817639">20</span><span class="op" id="6817641">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817655">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817680">for</span>&nbsp;<span class="ident" id="6817684">i</span>&nbsp;<span class="op" id="6817686">:=</span>&nbsp;<span class="keyword" id="6817689">range</span>&nbsp;<span class="ident" id="6817695">data</span>&nbsp;<span class="op" id="6817700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817704">data</span><span class="op" id="6817708">[</span><span class="ident" id="6817709">i</span><span class="op" id="6817710">]</span>&nbsp;<span class="op" id="6817712">=</span>&nbsp;<span class="builtintype" id="6817714">byte</span><span class="op" id="6817718">(</span><span class="ident" id="6817719">r</span><span class="op" id="6817720">.</span><span class="ident" id="6817721">Intn</span><span class="op" id="6817725">(</span><span class="num" id="6817726">256</span><span class="op" id="6817729">)</span><span class="op" id="6817730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817736">x</span>&nbsp;<span class="op" id="6817738">:=</span>&nbsp;<span class="ident" id="6817741">New</span><span class="op" id="6817744">(</span><span class="ident" id="6817745">data</span><span class="op" id="6817749">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817752">size</span>&nbsp;<span class="op" id="6817757">:=</span>&nbsp;<span class="ident" id="6817760">testSaveRestore</span><span class="op" id="6817775">(</span><span class="ident" id="6817776">nil</span><span class="op" id="6817779">,</span>&nbsp;<span class="ident" id="6817781">nil</span><span class="op" id="6817784">,</span>&nbsp;<span class="ident" id="6817786">x</span><span class="op" id="6817787">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817795">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817818">buf</span>&nbsp;<span class="op" id="6817822">:=</span>&nbsp;<span class="ident" id="6817825">bytes</span><span class="op" id="6817830">.</span><span class="ident" id="6817831">NewBuffer</span><span class="op" id="6817840">(</span><span class="builtinfunc" id="6817841">make</span><span class="op" id="6817845">(</span><span class="op" id="6817846">[</span><span class="op" id="6817847">]</span><span class="builtintype" id="6817848">byte</span><span class="op" id="6817852">,</span>&nbsp;<span class="ident" id="6817854">size</span><span class="op" id="6817858">)</span><span class="op" id="6817859">)</span>&nbsp;<span class="comment" id="6817861">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817879">b</span><span class="op" id="6817880">.</span><span class="ident" id="6817881">SetBytes</span><span class="op" id="6817889">(</span><span class="ident" id="6817890">int64</span><span class="op" id="6817895">(</span><span class="ident" id="6817896">size</span><span class="op" id="6817900">)</span><span class="op" id="6817901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817904">b</span><span class="op" id="6817905">.</span><span class="ident" id="6817906">StartTimer</span><span class="op" id="6817916">(</span><span class="op" id="6817917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817920">for</span>&nbsp;<span class="ident" id="6817924">i</span>&nbsp;<span class="op" id="6817926">:=</span>&nbsp;<span class="num" id="6817929">0</span><span class="op" id="6817930">;</span>&nbsp;<span class="ident" id="6817932">i</span>&nbsp;<span class="op" id="6817934">&lt;</span>&nbsp;<span class="ident" id="6817936">b</span><span class="op" id="6817937">.</span><span class="ident" id="6817938">N</span><span class="op" id="6817939">;</span>&nbsp;<span class="ident" id="6817941">i</span><span class="op" id="6817942">++</span>&nbsp;<span class="op" id="6817945">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817949">x</span><span class="op" id="6817950">.</span><span class="ident" id="6817951">Write</span><span class="op" id="6817956">(</span><span class="ident" id="6817957">buf</span><span class="op" id="6817960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817964">var</span>&nbsp;<span class="ident" id="6817968">y</span>&nbsp;<span class="ident" id="6817970">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817978">y</span><span class="op" id="6817979">.</span><span class="ident" id="6817980">Read</span><span class="op" id="6817984">(</span><span class="ident" id="6817985">buf</span><span class="op" id="6817988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817991">}</span><br>
<span class="lineno"></span><span class="op" id="6817993">}</span>
</div>
</body>
</html>
