<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html" class="current">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3257925">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3257981">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3258035">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3258086">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3258164">package</span>&nbsp;<span class="ident" id="3258172">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3258177">import</span>&nbsp;<span class="op" id="3258184">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3258187">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3258193">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3258199">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3258210">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3258217">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3258220">//&nbsp;BUG(rsc):&nbsp;On&nbsp;OpenBSD,&nbsp;listening&nbsp;on&nbsp;the&nbsp;&#34;tcp&#34;&nbsp;network&nbsp;does&nbsp;not&nbsp;listen&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3258296">//&nbsp;both&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections.&nbsp;This&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;IPv4&nbsp;traffic</span><br>
<span class="lineno"></span><span class="comment" id="3258373">//&nbsp;will&nbsp;not&nbsp;be&nbsp;routed&nbsp;to&nbsp;an&nbsp;IPv6&nbsp;socket&nbsp;-&nbsp;two&nbsp;separate&nbsp;sockets&nbsp;are&nbsp;required</span><br>
<span class="lineno"></span><span class="comment" id="3258449">//&nbsp;if&nbsp;both&nbsp;AFs&nbsp;are&nbsp;to&nbsp;be&nbsp;supported.&nbsp;See&nbsp;inet6(4)&nbsp;on&nbsp;OpenBSD&nbsp;for&nbsp;details.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3258523">func</span>&nbsp;<span class="ident" id="3258528">sockaddrToTCP</span><span class="op" id="3258541">(</span><span class="ident" id="3258542">sa</span>&nbsp;<span class="ident" id="3258545">syscall</span><span class="op" id="3258552">.</span><span class="ident" id="3258553">Sockaddr</span><span class="op" id="3258561">)</span>&nbsp;<span class="ident" id="3258563">Addr</span>&nbsp;<span class="op" id="3258568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258571">switch</span>&nbsp;<span class="ident" id="3258578">sa</span>&nbsp;<span class="op" id="3258581">:=</span>&nbsp;<span class="ident" id="3258584">sa</span><span class="op" id="3258586">.</span><span class="op" id="3258587">(</span><span class="keyword" id="3258588">type</span><span class="op" id="3258592">)</span>&nbsp;<span class="op" id="3258594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258597">case</span>&nbsp;<span class="op" id="3258602">*</span><span class="ident" id="3258603">syscall</span><span class="op" id="3258610">.</span><span class="ident" id="3258611">SockaddrInet4</span><span class="op" id="3258624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258628">return</span>&nbsp;<span class="op" id="3258635">&amp;</span><span class="ident" id="3258636">TCPAddr</span><span class="op" id="3258643">{</span><span class="ident" id="3258644">IP</span><span class="op" id="3258646">:</span>&nbsp;<span class="ident" id="3258648">sa</span><span class="op" id="3258650">.</span><span class="ident" id="3258651">Addr</span><span class="op" id="3258655">[</span><span class="num" id="3258656">0</span><span class="op" id="3258657">:</span><span class="op" id="3258658">]</span><span class="op" id="3258659">,</span>&nbsp;<span class="ident" id="3258661">Port</span><span class="op" id="3258665">:</span>&nbsp;<span class="ident" id="3258667">sa</span><span class="op" id="3258669">.</span><span class="ident" id="3258670">Port</span><span class="op" id="3258674">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258677">case</span>&nbsp;<span class="op" id="3258682">*</span><span class="ident" id="3258683">syscall</span><span class="op" id="3258690">.</span><span class="ident" id="3258691">SockaddrInet6</span><span class="op" id="3258704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258708">return</span>&nbsp;<span class="op" id="3258715">&amp;</span><span class="ident" id="3258716">TCPAddr</span><span class="op" id="3258723">{</span><span class="ident" id="3258724">IP</span><span class="op" id="3258726">:</span>&nbsp;<span class="ident" id="3258728">sa</span><span class="op" id="3258730">.</span><span class="ident" id="3258731">Addr</span><span class="op" id="3258735">[</span><span class="num" id="3258736">0</span><span class="op" id="3258737">:</span><span class="op" id="3258738">]</span><span class="op" id="3258739">,</span>&nbsp;<span class="ident" id="3258741">Port</span><span class="op" id="3258745">:</span>&nbsp;<span class="ident" id="3258747">sa</span><span class="op" id="3258749">.</span><span class="ident" id="3258750">Port</span><span class="op" id="3258754">,</span>&nbsp;<span class="ident" id="3258756">Zone</span><span class="op" id="3258760">:</span>&nbsp;<span class="ident" id="3258762">zoneToString</span><span class="op" id="3258774">(</span><span class="builtintype" id="3258775">int</span><span class="op" id="3258778">(</span><span class="ident" id="3258779">sa</span><span class="op" id="3258781">.</span><span class="ident" id="3258782">ZoneId</span><span class="op" id="3258788">)</span><span class="op" id="3258789">)</span><span class="op" id="3258790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258796">return</span>&nbsp;<span class="ident" id="3258803">nil</span><br>
<span class="lineno"></span><span class="op" id="3258807">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="3258810">func</span>&nbsp;<span class="op" id="3258815">(</span><span class="ident" id="3258816">a</span>&nbsp;<span class="op" id="3258818">*</span><span class="ident" id="3258819">TCPAddr</span><span class="op" id="3258826">)</span>&nbsp;<span class="ident" id="3258828">family</span><span class="op" id="3258834">(</span><span class="op" id="3258835">)</span>&nbsp;<span class="builtintype" id="3258837">int</span>&nbsp;<span class="op" id="3258841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258844">if</span>&nbsp;<span class="ident" id="3258847">a</span>&nbsp;<span class="op" id="3258849">==</span>&nbsp;<span class="ident" id="3258852">nil</span>&nbsp;<span class="op" id="3258856">||</span>&nbsp;<span class="builtinfunc" id="3258859">len</span><span class="op" id="3258862">(</span><span class="ident" id="3258863">a</span><span class="op" id="3258864">.</span><span class="ident" id="3258865">IP</span><span class="op" id="3258867">)</span>&nbsp;<span class="op" id="3258869">&lt;=</span>&nbsp;<span class="ident" id="3258872">IPv4len</span>&nbsp;<span class="op" id="3258880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258884">return</span>&nbsp;<span class="ident" id="3258891">syscall</span><span class="op" id="3258898">.</span><span class="ident" id="3258899">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258908">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258911">if</span>&nbsp;<span class="ident" id="3258914">a</span><span class="op" id="3258915">.</span><span class="ident" id="3258916">IP</span><span class="op" id="3258918">.</span><span class="ident" id="3258919">To4</span><span class="op" id="3258922">(</span><span class="op" id="3258923">)</span>&nbsp;<span class="op" id="3258925">!=</span>&nbsp;<span class="ident" id="3258928">nil</span>&nbsp;<span class="op" id="3258932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258936">return</span>&nbsp;<span class="ident" id="3258943">syscall</span><span class="op" id="3258950">.</span><span class="ident" id="3258951">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258963">return</span>&nbsp;<span class="ident" id="3258970">syscall</span><span class="op" id="3258977">.</span><span class="ident" id="3258978">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3258987">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3258990">func</span>&nbsp;<span class="op" id="3258995">(</span><span class="ident" id="3258996">a</span>&nbsp;<span class="op" id="3258998">*</span><span class="ident" id="3258999">TCPAddr</span><span class="op" id="3259006">)</span>&nbsp;<span class="ident" id="3259008">isWildcard</span><span class="op" id="3259018">(</span><span class="op" id="3259019">)</span>&nbsp;<span class="builtintype" id="3259021">bool</span>&nbsp;<span class="op" id="3259026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259029">if</span>&nbsp;<span class="ident" id="3259032">a</span>&nbsp;<span class="op" id="3259034">==</span>&nbsp;<span class="ident" id="3259037">nil</span>&nbsp;<span class="op" id="3259041">||</span>&nbsp;<span class="ident" id="3259044">a</span><span class="op" id="3259045">.</span><span class="ident" id="3259046">IP</span>&nbsp;<span class="op" id="3259049">==</span>&nbsp;<span class="ident" id="3259052">nil</span>&nbsp;<span class="op" id="3259056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259060">return</span>&nbsp;<span class="builtintype" id="3259067">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3259073">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259076">return</span>&nbsp;<span class="ident" id="3259083">a</span><span class="op" id="3259084">.</span><span class="ident" id="3259085">IP</span><span class="op" id="3259087">.</span><span class="ident" id="3259088">IsUnspecified</span><span class="op" id="3259101">(</span><span class="op" id="3259102">)</span><br>
<span class="lineno"></span><span class="op" id="3259104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3259107">func</span>&nbsp;<span class="op" id="3259112">(</span><span class="ident" id="3259113">a</span>&nbsp;<span class="op" id="3259115">*</span><span class="ident" id="3259116">TCPAddr</span><span class="op" id="3259123">)</span>&nbsp;<span class="ident" id="3259125">sockaddr</span><span class="op" id="3259133">(</span><span class="ident" id="3259134">family</span>&nbsp;<span class="builtintype" id="3259141">int</span><span class="op" id="3259144">)</span>&nbsp;<span class="op" id="3259146">(</span><span class="ident" id="3259147">syscall</span><span class="op" id="3259154">.</span><span class="ident" id="3259155">Sockaddr</span><span class="op" id="3259163">,</span>&nbsp;<span class="builtintype" id="3259165">error</span><span class="op" id="3259170">)</span>&nbsp;<span class="op" id="3259172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259175">if</span>&nbsp;<span class="ident" id="3259178">a</span>&nbsp;<span class="op" id="3259180">==</span>&nbsp;<span class="ident" id="3259183">nil</span>&nbsp;<span class="op" id="3259187">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259191">return</span>&nbsp;<span class="ident" id="3259198">nil</span><span class="op" id="3259201">,</span>&nbsp;<span class="ident" id="3259203">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3259208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259211">return</span>&nbsp;<span class="ident" id="3259218">ipToSockaddr</span><span class="op" id="3259230">(</span><span class="ident" id="3259231">family</span><span class="op" id="3259237">,</span>&nbsp;<span class="ident" id="3259239">a</span><span class="op" id="3259240">.</span><span class="ident" id="3259241">IP</span><span class="op" id="3259243">,</span>&nbsp;<span class="ident" id="3259245">a</span><span class="op" id="3259246">.</span><span class="ident" id="3259247">Port</span><span class="op" id="3259251">,</span>&nbsp;<span class="ident" id="3259253">a</span><span class="op" id="3259254">.</span><span class="ident" id="3259255">Zone</span><span class="op" id="3259259">)</span><br>
<span class="lineno"></span><span class="op" id="3259261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3259264">//&nbsp;TCPConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;TCP&nbsp;network</span><br>
<span class="lineno"></span><span class="comment" id="3259334">//&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3259350">type</span>&nbsp;<span class="ident" id="3259355">TCPConn</span>&nbsp;<span class="keyword" id="3259363">struct</span>&nbsp;<span class="op" id="3259370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259373">conn</span><br>
<span class="lineno"></span><span class="op" id="3259378">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3259381">func</span>&nbsp;<span class="ident" id="3259386">newTCPConn</span><span class="op" id="3259396">(</span><span class="ident" id="3259397">fd</span>&nbsp;<span class="op" id="3259400">*</span><span class="ident" id="3259401">netFD</span><span class="op" id="3259406">)</span>&nbsp;<span class="op" id="3259408">*</span><span class="ident" id="3259409">TCPConn</span>&nbsp;<span class="op" id="3259417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259420">c</span>&nbsp;<span class="op" id="3259422">:=</span>&nbsp;<span class="op" id="3259425">&amp;</span><span class="ident" id="3259426">TCPConn</span><span class="op" id="3259433">{</span><span class="ident" id="3259434">conn</span><span class="op" id="3259438">{</span><span class="ident" id="3259439">fd</span><span class="op" id="3259441">}</span><span class="op" id="3259442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259445">c</span><span class="op" id="3259446">.</span><span class="ident" id="3259447">SetNoDelay</span><span class="op" id="3259457">(</span><span class="builtintype" id="3259458">true</span><span class="op" id="3259462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259465">return</span>&nbsp;<span class="ident" id="3259472">c</span><br>
<span class="lineno">65</span><span class="op" id="3259474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3259477">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;io.ReaderFrom&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3259535">func</span>&nbsp;<span class="op" id="3259540">(</span><span class="ident" id="3259541">c</span>&nbsp;<span class="op" id="3259543">*</span><span class="ident" id="3259544">TCPConn</span><span class="op" id="3259551">)</span>&nbsp;<span class="ident" id="3259553">ReadFrom</span><span class="op" id="3259561">(</span><span class="ident" id="3259562">r</span>&nbsp;<span class="ident" id="3259564">io</span><span class="op" id="3259566">.</span><span class="ident" id="3259567">Reader</span><span class="op" id="3259573">)</span>&nbsp;<span class="op" id="3259575">(</span><span class="ident" id="3259576">int64</span><span class="op" id="3259581">,</span>&nbsp;<span class="builtintype" id="3259583">error</span><span class="op" id="3259588">)</span>&nbsp;<span class="op" id="3259590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259593">if</span>&nbsp;<span class="ident" id="3259596">n</span><span class="op" id="3259597">,</span>&nbsp;<span class="ident" id="3259599">err</span><span class="op" id="3259602">,</span>&nbsp;<span class="ident" id="3259604">handled</span>&nbsp;<span class="op" id="3259612">:=</span>&nbsp;<span class="ident" id="3259615">sendFile</span><span class="op" id="3259623">(</span><span class="ident" id="3259624">c</span><span class="op" id="3259625">.</span><span class="ident" id="3259626">fd</span><span class="op" id="3259628">,</span>&nbsp;<span class="ident" id="3259630">r</span><span class="op" id="3259631">)</span><span class="op" id="3259632">;</span>&nbsp;<span class="ident" id="3259634">handled</span>&nbsp;<span class="op" id="3259642">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259646">return</span>&nbsp;<span class="ident" id="3259653">n</span><span class="op" id="3259654">,</span>&nbsp;<span class="ident" id="3259656">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3259661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259664">return</span>&nbsp;<span class="ident" id="3259671">genericReadFrom</span><span class="op" id="3259686">(</span><span class="ident" id="3259687">c</span><span class="op" id="3259688">,</span>&nbsp;<span class="ident" id="3259690">r</span><span class="op" id="3259691">)</span><br>
<span class="lineno"></span><span class="op" id="3259693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3259696">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3259760">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3259799">func</span>&nbsp;<span class="op" id="3259804">(</span><span class="ident" id="3259805">c</span>&nbsp;<span class="op" id="3259807">*</span><span class="ident" id="3259808">TCPConn</span><span class="op" id="3259815">)</span>&nbsp;<span class="ident" id="3259817">CloseRead</span><span class="op" id="3259826">(</span><span class="op" id="3259827">)</span>&nbsp;<span class="builtintype" id="3259829">error</span>&nbsp;<span class="op" id="3259835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259838">if</span>&nbsp;<span class="op" id="3259841">!</span><span class="ident" id="3259842">c</span><span class="op" id="3259843">.</span><span class="ident" id="3259844">ok</span><span class="op" id="3259846">(</span><span class="op" id="3259847">)</span>&nbsp;<span class="op" id="3259849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259853">return</span>&nbsp;<span class="ident" id="3259860">syscall</span><span class="op" id="3259867">.</span><span class="ident" id="3259868">EINVAL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3259876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259879">return</span>&nbsp;<span class="ident" id="3259886">c</span><span class="op" id="3259887">.</span><span class="ident" id="3259888">fd</span><span class="op" id="3259890">.</span><span class="ident" id="3259891">closeRead</span><span class="op" id="3259900">(</span><span class="op" id="3259901">)</span><br>
<span class="lineno"></span><span class="op" id="3259903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3259906">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno">85</span><span class="comment" id="3259971">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3260010">func</span>&nbsp;<span class="op" id="3260015">(</span><span class="ident" id="3260016">c</span>&nbsp;<span class="op" id="3260018">*</span><span class="ident" id="3260019">TCPConn</span><span class="op" id="3260026">)</span>&nbsp;<span class="ident" id="3260028">CloseWrite</span><span class="op" id="3260038">(</span><span class="op" id="3260039">)</span>&nbsp;<span class="builtintype" id="3260041">error</span>&nbsp;<span class="op" id="3260047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260050">if</span>&nbsp;<span class="op" id="3260053">!</span><span class="ident" id="3260054">c</span><span class="op" id="3260055">.</span><span class="ident" id="3260056">ok</span><span class="op" id="3260058">(</span><span class="op" id="3260059">)</span>&nbsp;<span class="op" id="3260061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260065">return</span>&nbsp;<span class="ident" id="3260072">syscall</span><span class="op" id="3260079">.</span><span class="ident" id="3260080">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260088">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260091">return</span>&nbsp;<span class="ident" id="3260098">c</span><span class="op" id="3260099">.</span><span class="ident" id="3260100">fd</span><span class="op" id="3260102">.</span><span class="ident" id="3260103">closeWrite</span><span class="op" id="3260113">(</span><span class="op" id="3260114">)</span><br>
<span class="lineno"></span><span class="op" id="3260116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3260119">//&nbsp;SetLinger&nbsp;sets&nbsp;the&nbsp;behavior&nbsp;of&nbsp;Close&nbsp;on&nbsp;a&nbsp;connection&nbsp;which&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="3260187">//&nbsp;has&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;sent&nbsp;or&nbsp;to&nbsp;be&nbsp;acknowledged.</span><br>
<span class="lineno">95</span><span class="comment" id="3260241">//</span><br>
<span class="lineno"></span><span class="comment" id="3260244">//&nbsp;If&nbsp;sec&nbsp;&lt;&nbsp;0&nbsp;(the&nbsp;default),&nbsp;the&nbsp;operating&nbsp;system&nbsp;finishes&nbsp;sending&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3260315">//&nbsp;data&nbsp;in&nbsp;the&nbsp;background.</span><br>
<span class="lineno"></span><span class="comment" id="3260342">//</span><br>
<span class="lineno"></span><span class="comment" id="3260345">//&nbsp;If&nbsp;sec&nbsp;==&nbsp;0,&nbsp;the&nbsp;operating&nbsp;system&nbsp;discards&nbsp;any&nbsp;unsent&nbsp;or</span><br>
<span class="lineno">100</span><span class="comment" id="3260405">//&nbsp;unacknowledged&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3260429">//</span><br>
<span class="lineno"></span><span class="comment" id="3260432">//&nbsp;If&nbsp;sec&nbsp;&gt;&nbsp;0,&nbsp;the&nbsp;data&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;background&nbsp;as&nbsp;with&nbsp;sec&nbsp;&lt;&nbsp;0.&nbsp;On</span><br>
<span class="lineno"></span><span class="comment" id="3260502">//&nbsp;some&nbsp;operating&nbsp;systems&nbsp;after&nbsp;sec&nbsp;seconds&nbsp;have&nbsp;elapsed&nbsp;any&nbsp;remaining</span><br>
<span class="lineno"></span><span class="comment" id="3260573">//&nbsp;unsent&nbsp;data&nbsp;may&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">105</span><span class="keyword" id="3260606">func</span>&nbsp;<span class="op" id="3260611">(</span><span class="ident" id="3260612">c</span>&nbsp;<span class="op" id="3260614">*</span><span class="ident" id="3260615">TCPConn</span><span class="op" id="3260622">)</span>&nbsp;<span class="ident" id="3260624">SetLinger</span><span class="op" id="3260633">(</span><span class="ident" id="3260634">sec</span>&nbsp;<span class="builtintype" id="3260638">int</span><span class="op" id="3260641">)</span>&nbsp;<span class="builtintype" id="3260643">error</span>&nbsp;<span class="op" id="3260649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260652">if</span>&nbsp;<span class="op" id="3260655">!</span><span class="ident" id="3260656">c</span><span class="op" id="3260657">.</span><span class="ident" id="3260658">ok</span><span class="op" id="3260660">(</span><span class="op" id="3260661">)</span>&nbsp;<span class="op" id="3260663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260667">return</span>&nbsp;<span class="ident" id="3260674">syscall</span><span class="op" id="3260681">.</span><span class="ident" id="3260682">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260693">return</span>&nbsp;<span class="ident" id="3260700">setLinger</span><span class="op" id="3260709">(</span><span class="ident" id="3260710">c</span><span class="op" id="3260711">.</span><span class="ident" id="3260712">fd</span><span class="op" id="3260714">,</span>&nbsp;<span class="ident" id="3260716">sec</span><span class="op" id="3260719">)</span><br>
<span class="lineno">110</span><span class="op" id="3260721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3260724">//&nbsp;SetKeepAlive&nbsp;sets&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;send</span><br>
<span class="lineno"></span><span class="comment" id="3260786">//&nbsp;keepalive&nbsp;messages&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3260827">func</span>&nbsp;<span class="op" id="3260832">(</span><span class="ident" id="3260833">c</span>&nbsp;<span class="op" id="3260835">*</span><span class="ident" id="3260836">TCPConn</span><span class="op" id="3260843">)</span>&nbsp;<span class="ident" id="3260845">SetKeepAlive</span><span class="op" id="3260857">(</span><span class="ident" id="3260858">keepalive</span>&nbsp;<span class="builtintype" id="3260868">bool</span><span class="op" id="3260872">)</span>&nbsp;<span class="builtintype" id="3260874">error</span>&nbsp;<span class="op" id="3260880">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260883">if</span>&nbsp;<span class="op" id="3260886">!</span><span class="ident" id="3260887">c</span><span class="op" id="3260888">.</span><span class="ident" id="3260889">ok</span><span class="op" id="3260891">(</span><span class="op" id="3260892">)</span>&nbsp;<span class="op" id="3260894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260898">return</span>&nbsp;<span class="ident" id="3260905">syscall</span><span class="op" id="3260912">.</span><span class="ident" id="3260913">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260924">return</span>&nbsp;<span class="ident" id="3260931">setKeepAlive</span><span class="op" id="3260943">(</span><span class="ident" id="3260944">c</span><span class="op" id="3260945">.</span><span class="ident" id="3260946">fd</span><span class="op" id="3260948">,</span>&nbsp;<span class="ident" id="3260950">keepalive</span><span class="op" id="3260959">)</span><br>
<span class="lineno"></span><span class="op" id="3260961">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3260964">//&nbsp;SetKeepAlivePeriod&nbsp;sets&nbsp;period&nbsp;between&nbsp;keep&nbsp;alives.</span><br>
<span class="lineno"></span><span class="keyword" id="3261019">func</span>&nbsp;<span class="op" id="3261024">(</span><span class="ident" id="3261025">c</span>&nbsp;<span class="op" id="3261027">*</span><span class="ident" id="3261028">TCPConn</span><span class="op" id="3261035">)</span>&nbsp;<span class="ident" id="3261037">SetKeepAlivePeriod</span><span class="op" id="3261055">(</span><span class="ident" id="3261056">d</span>&nbsp;<span class="ident" id="3261058">time</span><span class="op" id="3261062">.</span><span class="ident" id="3261063">Duration</span><span class="op" id="3261071">)</span>&nbsp;<span class="builtintype" id="3261073">error</span>&nbsp;<span class="op" id="3261079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261082">if</span>&nbsp;<span class="op" id="3261085">!</span><span class="ident" id="3261086">c</span><span class="op" id="3261087">.</span><span class="ident" id="3261088">ok</span><span class="op" id="3261090">(</span><span class="op" id="3261091">)</span>&nbsp;<span class="op" id="3261093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261097">return</span>&nbsp;<span class="ident" id="3261104">syscall</span><span class="op" id="3261111">.</span><span class="ident" id="3261112">EINVAL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261123">return</span>&nbsp;<span class="ident" id="3261130">setKeepAlivePeriod</span><span class="op" id="3261148">(</span><span class="ident" id="3261149">c</span><span class="op" id="3261150">.</span><span class="ident" id="3261151">fd</span><span class="op" id="3261153">,</span>&nbsp;<span class="ident" id="3261155">d</span><span class="op" id="3261156">)</span><br>
<span class="lineno"></span><span class="op" id="3261158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3261161">//&nbsp;SetNoDelay&nbsp;controls&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;delay</span><br>
<span class="lineno">130</span><span class="comment" id="3261226">//&nbsp;packet&nbsp;transmission&nbsp;in&nbsp;hopes&nbsp;of&nbsp;sending&nbsp;fewer&nbsp;packets&nbsp;(Nagle&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3261292">//&nbsp;algorithm).&nbsp;&nbsp;The&nbsp;default&nbsp;is&nbsp;true&nbsp;(no&nbsp;delay),&nbsp;meaning&nbsp;that&nbsp;data&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3261361">//&nbsp;sent&nbsp;as&nbsp;soon&nbsp;as&nbsp;possible&nbsp;after&nbsp;a&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="3261404">func</span>&nbsp;<span class="op" id="3261409">(</span><span class="ident" id="3261410">c</span>&nbsp;<span class="op" id="3261412">*</span><span class="ident" id="3261413">TCPConn</span><span class="op" id="3261420">)</span>&nbsp;<span class="ident" id="3261422">SetNoDelay</span><span class="op" id="3261432">(</span><span class="ident" id="3261433">noDelay</span>&nbsp;<span class="builtintype" id="3261441">bool</span><span class="op" id="3261445">)</span>&nbsp;<span class="builtintype" id="3261447">error</span>&nbsp;<span class="op" id="3261453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261456">if</span>&nbsp;<span class="op" id="3261459">!</span><span class="ident" id="3261460">c</span><span class="op" id="3261461">.</span><span class="ident" id="3261462">ok</span><span class="op" id="3261464">(</span><span class="op" id="3261465">)</span>&nbsp;<span class="op" id="3261467">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261471">return</span>&nbsp;<span class="ident" id="3261478">syscall</span><span class="op" id="3261485">.</span><span class="ident" id="3261486">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261497">return</span>&nbsp;<span class="ident" id="3261504">setNoDelay</span><span class="op" id="3261514">(</span><span class="ident" id="3261515">c</span><span class="op" id="3261516">.</span><span class="ident" id="3261517">fd</span><span class="op" id="3261519">,</span>&nbsp;<span class="ident" id="3261521">noDelay</span><span class="op" id="3261528">)</span><br>
<span class="lineno"></span><span class="op" id="3261530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3261533">//&nbsp;DialTCP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3261601">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3261672">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3261721">func</span>&nbsp;<span class="ident" id="3261726">DialTCP</span><span class="op" id="3261733">(</span><span class="ident" id="3261734">net</span>&nbsp;<span class="builtintype" id="3261738">string</span><span class="op" id="3261744">,</span>&nbsp;<span class="ident" id="3261746">laddr</span><span class="op" id="3261751">,</span>&nbsp;<span class="ident" id="3261753">raddr</span>&nbsp;<span class="op" id="3261759">*</span><span class="ident" id="3261760">TCPAddr</span><span class="op" id="3261767">)</span>&nbsp;<span class="op" id="3261769">(</span><span class="op" id="3261770">*</span><span class="ident" id="3261771">TCPConn</span><span class="op" id="3261778">,</span>&nbsp;<span class="builtintype" id="3261780">error</span><span class="op" id="3261785">)</span>&nbsp;<span class="op" id="3261787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261790">switch</span>&nbsp;<span class="ident" id="3261797">net</span>&nbsp;<span class="op" id="3261801">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261804">case</span>&nbsp;<span class="string" id="3261809">&#34;tcp&#34;</span><span class="op" id="3261814">,</span>&nbsp;<span class="string" id="3261816">&#34;tcp4&#34;</span><span class="op" id="3261822">,</span>&nbsp;<span class="string" id="3261824">&#34;tcp6&#34;</span><span class="op" id="3261830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261833">default</span><span class="op" id="3261840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261844">return</span>&nbsp;<span class="ident" id="3261851">nil</span><span class="op" id="3261854">,</span>&nbsp;<span class="op" id="3261856">&amp;</span><span class="ident" id="3261857">OpError</span><span class="op" id="3261864">{</span><span class="ident" id="3261865">Op</span><span class="op" id="3261867">:</span>&nbsp;<span class="string" id="3261869">&#34;dial&#34;</span><span class="op" id="3261875">,</span>&nbsp;<span class="ident" id="3261877">Net</span><span class="op" id="3261880">:</span>&nbsp;<span class="ident" id="3261882">net</span><span class="op" id="3261885">,</span>&nbsp;<span class="ident" id="3261887">Addr</span><span class="op" id="3261891">:</span>&nbsp;<span class="ident" id="3261893">raddr</span><span class="op" id="3261898">,</span>&nbsp;<span class="ident" id="3261900">Err</span><span class="op" id="3261903">:</span>&nbsp;<span class="ident" id="3261905">UnknownNetworkError</span><span class="op" id="3261924">(</span><span class="ident" id="3261925">net</span><span class="op" id="3261928">)</span><span class="op" id="3261929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261935">if</span>&nbsp;<span class="ident" id="3261938">raddr</span>&nbsp;<span class="op" id="3261944">==</span>&nbsp;<span class="ident" id="3261947">nil</span>&nbsp;<span class="op" id="3261951">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261955">return</span>&nbsp;<span class="ident" id="3261962">nil</span><span class="op" id="3261965">,</span>&nbsp;<span class="op" id="3261967">&amp;</span><span class="ident" id="3261968">OpError</span><span class="op" id="3261975">{</span><span class="ident" id="3261976">Op</span><span class="op" id="3261978">:</span>&nbsp;<span class="string" id="3261980">&#34;dial&#34;</span><span class="op" id="3261986">,</span>&nbsp;<span class="ident" id="3261988">Net</span><span class="op" id="3261991">:</span>&nbsp;<span class="ident" id="3261993">net</span><span class="op" id="3261996">,</span>&nbsp;<span class="ident" id="3261998">Addr</span><span class="op" id="3262002">:</span>&nbsp;<span class="ident" id="3262004">nil</span><span class="op" id="3262007">,</span>&nbsp;<span class="ident" id="3262009">Err</span><span class="op" id="3262012">:</span>&nbsp;<span class="ident" id="3262014">errMissingAddress</span><span class="op" id="3262031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262037">return</span>&nbsp;<span class="ident" id="3262044">dialTCP</span><span class="op" id="3262051">(</span><span class="ident" id="3262052">net</span><span class="op" id="3262055">,</span>&nbsp;<span class="ident" id="3262057">laddr</span><span class="op" id="3262062">,</span>&nbsp;<span class="ident" id="3262064">raddr</span><span class="op" id="3262069">,</span>&nbsp;<span class="ident" id="3262071">noDeadline</span><span class="op" id="3262081">)</span><br>
<span class="lineno"></span><span class="op" id="3262083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="3262086">func</span>&nbsp;<span class="ident" id="3262091">dialTCP</span><span class="op" id="3262098">(</span><span class="ident" id="3262099">net</span>&nbsp;<span class="builtintype" id="3262103">string</span><span class="op" id="3262109">,</span>&nbsp;<span class="ident" id="3262111">laddr</span><span class="op" id="3262116">,</span>&nbsp;<span class="ident" id="3262118">raddr</span>&nbsp;<span class="op" id="3262124">*</span><span class="ident" id="3262125">TCPAddr</span><span class="op" id="3262132">,</span>&nbsp;<span class="ident" id="3262134">deadline</span>&nbsp;<span class="ident" id="3262143">time</span><span class="op" id="3262147">.</span><span class="ident" id="3262148">Time</span><span class="op" id="3262152">)</span>&nbsp;<span class="op" id="3262154">(</span><span class="op" id="3262155">*</span><span class="ident" id="3262156">TCPConn</span><span class="op" id="3262163">,</span>&nbsp;<span class="builtintype" id="3262165">error</span><span class="op" id="3262170">)</span>&nbsp;<span class="op" id="3262172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262175">fd</span><span class="op" id="3262177">,</span>&nbsp;<span class="ident" id="3262179">err</span>&nbsp;<span class="op" id="3262183">:=</span>&nbsp;<span class="ident" id="3262186">internetSocket</span><span class="op" id="3262200">(</span><span class="ident" id="3262201">net</span><span class="op" id="3262204">,</span>&nbsp;<span class="ident" id="3262206">laddr</span><span class="op" id="3262211">,</span>&nbsp;<span class="ident" id="3262213">raddr</span><span class="op" id="3262218">,</span>&nbsp;<span class="ident" id="3262220">deadline</span><span class="op" id="3262228">,</span>&nbsp;<span class="ident" id="3262230">syscall</span><span class="op" id="3262237">.</span><span class="ident" id="3262238">SOCK_STREAM</span><span class="op" id="3262249">,</span>&nbsp;<span class="num" id="3262251">0</span><span class="op" id="3262252">,</span>&nbsp;<span class="string" id="3262254">&#34;dial&#34;</span><span class="op" id="3262260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262264">//&nbsp;TCP&nbsp;has&nbsp;a&nbsp;rarely&nbsp;used&nbsp;mechanism&nbsp;called&nbsp;a&nbsp;&#39;simultaneous&nbsp;connection&#39;&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262338">//&nbsp;which&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr1,&nbsp;addr2)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine&nbsp;at&nbsp;addr1&nbsp;can</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262406">//&nbsp;connect&nbsp;to&nbsp;a&nbsp;simultaneous&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr2,&nbsp;addr1)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262481">//&nbsp;at&nbsp;addr2,&nbsp;without&nbsp;either&nbsp;machine&nbsp;executing&nbsp;Listen.&nbsp;&nbsp;If&nbsp;laddr&nbsp;==&nbsp;nil,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262554">//&nbsp;it&nbsp;means&nbsp;we&nbsp;want&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate&nbsp;originating&nbsp;local</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262627">//&nbsp;address.&nbsp;&nbsp;Some&nbsp;Linux&nbsp;kernels&nbsp;cycle&nbsp;blindly&nbsp;through&nbsp;a&nbsp;fixed&nbsp;range&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262699">//&nbsp;local&nbsp;ports,&nbsp;regardless&nbsp;of&nbsp;destination&nbsp;port.&nbsp;&nbsp;If&nbsp;a&nbsp;kernel&nbsp;happens&nbsp;to</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262772">//&nbsp;pick&nbsp;local&nbsp;port&nbsp;50001&nbsp;as&nbsp;the&nbsp;source&nbsp;for&nbsp;a&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;&#34;,&nbsp;&#34;localhost:50001&#34;),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262854">//&nbsp;then&nbsp;the&nbsp;Dial&nbsp;will&nbsp;succeed,&nbsp;having&nbsp;simultaneously&nbsp;connected&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3262929">//&nbsp;This&nbsp;can&nbsp;only&nbsp;happen&nbsp;when&nbsp;we&nbsp;are&nbsp;letting&nbsp;the&nbsp;kernel&nbsp;pick&nbsp;a&nbsp;port&nbsp;(laddr&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263012">//&nbsp;and&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;listener&nbsp;for&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263075">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;argue&nbsp;this&nbsp;is&nbsp;anything&nbsp;other&nbsp;than&nbsp;a&nbsp;kernel&nbsp;bug.&nbsp;&nbsp;If&nbsp;we</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263147">//&nbsp;see&nbsp;this&nbsp;happen,&nbsp;rather&nbsp;than&nbsp;expose&nbsp;the&nbsp;buggy&nbsp;effect&nbsp;to&nbsp;users,&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263217">//&nbsp;close&nbsp;the&nbsp;fd&nbsp;and&nbsp;try&nbsp;again.&nbsp;&nbsp;If&nbsp;it&nbsp;happens&nbsp;twice&nbsp;more,&nbsp;we&nbsp;relent&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263290">//&nbsp;use&nbsp;the&nbsp;result.&nbsp;&nbsp;See&nbsp;also:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263321">//&nbsp;&nbsp;&nbsp;&nbsphttp://golang.org/issue/2690</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263354">//&nbsp;&nbsp;&nbsp;&nbsphttp://stackoverflow.com/questions/4949858/</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263402">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263406">//&nbsp;The&nbsp;opposite&nbsp;can&nbsp;also&nbsp;happen:&nbsp;if&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263484">//&nbsp;originating&nbsp;local&nbsp;address,&nbsp;sometimes&nbsp;it&nbsp;picks&nbsp;one&nbsp;that&nbsp;is&nbsp;already&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263562">//&nbsp;So&nbsp;if&nbsp;the&nbsp;error&nbsp;is&nbsp;EADDRNOTAVAIL,&nbsp;we&nbsp;have&nbsp;to&nbsp;try&nbsp;again&nbsp;too,&nbsp;just&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263635">//&nbsp;a&nbsp;different&nbsp;reason.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263659">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3263663">//&nbsp;The&nbsp;kernel&nbsp;socket&nbsp;code&nbsp;is&nbsp;no&nbsp;doubt&nbsp;enjoying&nbsp;watching&nbsp;us&nbsp;squirm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3263731">for</span>&nbsp;<span class="ident" id="3263735">i</span>&nbsp;<span class="op" id="3263737">:=</span>&nbsp;<span class="num" id="3263740">0</span><span class="op" id="3263741">;</span>&nbsp;<span class="ident" id="3263743">i</span>&nbsp;<span class="op" id="3263745">&lt;</span>&nbsp;<span class="num" id="3263747">2</span>&nbsp;<span class="op" id="3263749">&amp;&amp;</span>&nbsp;<span class="op" id="3263752">(</span><span class="ident" id="3263753">laddr</span>&nbsp;<span class="op" id="3263759">==</span>&nbsp;<span class="ident" id="3263762">nil</span>&nbsp;<span class="op" id="3263766">||</span>&nbsp;<span class="ident" id="3263769">laddr</span><span class="op" id="3263774">.</span><span class="ident" id="3263775">Port</span>&nbsp;<span class="op" id="3263780">==</span>&nbsp;<span class="num" id="3263783">0</span><span class="op" id="3263784">)</span>&nbsp;<span class="op" id="3263786">&amp;&amp;</span>&nbsp;<span class="op" id="3263789">(</span><span class="ident" id="3263790">selfConnect</span><span class="op" id="3263801">(</span><span class="ident" id="3263802">fd</span><span class="op" id="3263804">,</span>&nbsp;<span class="ident" id="3263806">err</span><span class="op" id="3263809">)</span>&nbsp;<span class="op" id="3263811">||</span>&nbsp;<span class="ident" id="3263814">spuriousENOTAVAIL</span><span class="op" id="3263831">(</span><span class="ident" id="3263832">err</span><span class="op" id="3263835">)</span><span class="op" id="3263836">)</span><span class="op" id="3263837">;</span>&nbsp;<span class="ident" id="3263839">i</span><span class="op" id="3263840">++</span>&nbsp;<span class="op" id="3263843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3263847">if</span>&nbsp;<span class="ident" id="3263850">err</span>&nbsp;<span class="op" id="3263854">==</span>&nbsp;<span class="ident" id="3263857">nil</span>&nbsp;<span class="op" id="3263861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263866">fd</span><span class="op" id="3263868">.</span><span class="ident" id="3263869">Close</span><span class="op" id="3263874">(</span><span class="op" id="3263875">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3263879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3263883">fd</span><span class="op" id="3263885">,</span>&nbsp;<span class="ident" id="3263887">err</span>&nbsp;<span class="op" id="3263891">=</span>&nbsp;<span class="ident" id="3263893">internetSocket</span><span class="op" id="3263907">(</span><span class="ident" id="3263908">net</span><span class="op" id="3263911">,</span>&nbsp;<span class="ident" id="3263913">laddr</span><span class="op" id="3263918">,</span>&nbsp;<span class="ident" id="3263920">raddr</span><span class="op" id="3263925">,</span>&nbsp;<span class="ident" id="3263927">deadline</span><span class="op" id="3263935">,</span>&nbsp;<span class="ident" id="3263937">syscall</span><span class="op" id="3263944">.</span><span class="ident" id="3263945">SOCK_STREAM</span><span class="op" id="3263956">,</span>&nbsp;<span class="num" id="3263958">0</span><span class="op" id="3263959">,</span>&nbsp;<span class="string" id="3263961">&#34;dial&#34;</span><span class="op" id="3263967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3263970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3263974">if</span>&nbsp;<span class="ident" id="3263977">err</span>&nbsp;<span class="op" id="3263981">!=</span>&nbsp;<span class="ident" id="3263984">nil</span>&nbsp;<span class="op" id="3263988">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3263992">return</span>&nbsp;<span class="ident" id="3263999">nil</span><span class="op" id="3264002">,</span>&nbsp;<span class="op" id="3264004">&amp;</span><span class="ident" id="3264005">OpError</span><span class="op" id="3264012">{</span><span class="ident" id="3264013">Op</span><span class="op" id="3264015">:</span>&nbsp;<span class="string" id="3264017">&#34;dial&#34;</span><span class="op" id="3264023">,</span>&nbsp;<span class="ident" id="3264025">Net</span><span class="op" id="3264028">:</span>&nbsp;<span class="ident" id="3264030">net</span><span class="op" id="3264033">,</span>&nbsp;<span class="ident" id="3264035">Addr</span><span class="op" id="3264039">:</span>&nbsp;<span class="ident" id="3264041">raddr</span><span class="op" id="3264046">,</span>&nbsp;<span class="ident" id="3264048">Err</span><span class="op" id="3264051">:</span>&nbsp;<span class="ident" id="3264053">err</span><span class="op" id="3264056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3264059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264062">return</span>&nbsp;<span class="ident" id="3264069">newTCPConn</span><span class="op" id="3264079">(</span><span class="ident" id="3264080">fd</span><span class="op" id="3264082">)</span><span class="op" id="3264083">,</span>&nbsp;<span class="ident" id="3264085">nil</span><br>
<span class="lineno"></span><span class="op" id="3264089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="3264092">func</span>&nbsp;<span class="ident" id="3264097">selfConnect</span><span class="op" id="3264108">(</span><span class="ident" id="3264109">fd</span>&nbsp;<span class="op" id="3264112">*</span><span class="ident" id="3264113">netFD</span><span class="op" id="3264118">,</span>&nbsp;<span class="ident" id="3264120">err</span>&nbsp;<span class="builtintype" id="3264124">error</span><span class="op" id="3264129">)</span>&nbsp;<span class="builtintype" id="3264131">bool</span>&nbsp;<span class="op" id="3264136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264139">//&nbsp;If&nbsp;the&nbsp;connect&nbsp;failed,&nbsp;we&nbsp;clearly&nbsp;didn&#39;t&nbsp;connect&nbsp;to&nbsp;ourselves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264206">if</span>&nbsp;<span class="ident" id="3264209">err</span>&nbsp;<span class="op" id="3264213">!=</span>&nbsp;<span class="ident" id="3264216">nil</span>&nbsp;<span class="op" id="3264220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264224">return</span>&nbsp;<span class="builtintype" id="3264231">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3264238">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264242">//&nbsp;The&nbsp;socket&nbsp;constructor&nbsp;can&nbsp;return&nbsp;an&nbsp;fd&nbsp;with&nbsp;raddr&nbsp;nil&nbsp;under&nbsp;certain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264315">//&nbsp;unknown&nbsp;conditions.&nbsp;The&nbsp;errors&nbsp;in&nbsp;the&nbsp;calls&nbsp;there&nbsp;to&nbsp;Getpeername</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264384">//&nbsp;are&nbsp;discarded,&nbsp;but&nbsp;we&nbsp;can&#39;t&nbsp;catch&nbsp;the&nbsp;problem&nbsp;there&nbsp;because&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264454">//&nbsp;calls&nbsp;are&nbsp;sometimes&nbsp;legally&nbsp;erroneous&nbsp;with&nbsp;a&nbsp;&#34;socket&nbsp;not&nbsp;connected&#34;.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264527">//&nbsp;Since&nbsp;this&nbsp;code&nbsp;(selfConnect)&nbsp;is&nbsp;already&nbsp;trying&nbsp;to&nbsp;work&nbsp;around</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264594">//&nbsp;a&nbsp;problem,&nbsp;we&nbsp;make&nbsp;sure&nbsp;if&nbsp;this&nbsp;happens&nbsp;we&nbsp;recognize&nbsp;trouble&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264663">//&nbsp;ask&nbsp;the&nbsp;DialTCP&nbsp;routine&nbsp;to&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3264705">//&nbsp;TODO:&nbsp;try&nbsp;to&nbsp;understand&nbsp;what&#39;s&nbsp;really&nbsp;going&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264757">if</span>&nbsp;<span class="ident" id="3264760">fd</span><span class="op" id="3264762">.</span><span class="ident" id="3264763">laddr</span>&nbsp;<span class="op" id="3264769">==</span>&nbsp;<span class="ident" id="3264772">nil</span>&nbsp;<span class="op" id="3264776">||</span>&nbsp;<span class="ident" id="3264779">fd</span><span class="op" id="3264781">.</span><span class="ident" id="3264782">raddr</span>&nbsp;<span class="op" id="3264788">==</span>&nbsp;<span class="ident" id="3264791">nil</span>&nbsp;<span class="op" id="3264795">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264799">return</span>&nbsp;<span class="builtintype" id="3264806">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3264812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3264815">l</span>&nbsp;<span class="op" id="3264817">:=</span>&nbsp;<span class="ident" id="3264820">fd</span><span class="op" id="3264822">.</span><span class="ident" id="3264823">laddr</span><span class="op" id="3264828">.</span><span class="op" id="3264829">(</span><span class="op" id="3264830">*</span><span class="ident" id="3264831">TCPAddr</span><span class="op" id="3264838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3264841">r</span>&nbsp;<span class="op" id="3264843">:=</span>&nbsp;<span class="ident" id="3264846">fd</span><span class="op" id="3264848">.</span><span class="ident" id="3264849">raddr</span><span class="op" id="3264854">.</span><span class="op" id="3264855">(</span><span class="op" id="3264856">*</span><span class="ident" id="3264857">TCPAddr</span><span class="op" id="3264864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264867">return</span>&nbsp;<span class="ident" id="3264874">l</span><span class="op" id="3264875">.</span><span class="ident" id="3264876">Port</span>&nbsp;<span class="op" id="3264881">==</span>&nbsp;<span class="ident" id="3264884">r</span><span class="op" id="3264885">.</span><span class="ident" id="3264886">Port</span>&nbsp;<span class="op" id="3264891">&amp;&amp;</span>&nbsp;<span class="ident" id="3264894">l</span><span class="op" id="3264895">.</span><span class="ident" id="3264896">IP</span><span class="op" id="3264898">.</span><span class="ident" id="3264899">Equal</span><span class="op" id="3264904">(</span><span class="ident" id="3264905">r</span><span class="op" id="3264906">.</span><span class="ident" id="3264907">IP</span><span class="op" id="3264909">)</span><br>
<span class="lineno">215</span><span class="op" id="3264911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3264914">func</span>&nbsp;<span class="ident" id="3264919">spuriousENOTAVAIL</span><span class="op" id="3264936">(</span><span class="ident" id="3264937">err</span>&nbsp;<span class="builtintype" id="3264941">error</span><span class="op" id="3264946">)</span>&nbsp;<span class="builtintype" id="3264948">bool</span>&nbsp;<span class="op" id="3264953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3264956">e</span><span class="op" id="3264957">,</span>&nbsp;<span class="ident" id="3264959">ok</span>&nbsp;<span class="op" id="3264962">:=</span>&nbsp;<span class="ident" id="3264965">err</span><span class="op" id="3264968">.</span><span class="op" id="3264969">(</span><span class="op" id="3264970">*</span><span class="ident" id="3264971">OpError</span><span class="op" id="3264978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3264981">return</span>&nbsp;<span class="ident" id="3264988">ok</span>&nbsp;<span class="op" id="3264991">&amp;&amp;</span>&nbsp;<span class="ident" id="3264994">e</span><span class="op" id="3264995">.</span><span class="ident" id="3264996">Err</span>&nbsp;<span class="op" id="3265000">==</span>&nbsp;<span class="ident" id="3265003">syscall</span><span class="op" id="3265010">.</span><span class="ident" id="3265011">EADDRNOTAVAIL</span><br>
<span class="lineno">220</span><span class="op" id="3265025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3265028">//&nbsp;TCPListener&nbsp;is&nbsp;a&nbsp;TCP&nbsp;network&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="3265096">//&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;TCP.</span><br>
<span class="lineno"></span><span class="keyword" id="3265155">type</span>&nbsp;<span class="ident" id="3265160">TCPListener</span>&nbsp;<span class="keyword" id="3265172">struct</span>&nbsp;<span class="op" id="3265179">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3265182">fd</span>&nbsp;<span class="op" id="3265185">*</span><span class="ident" id="3265186">netFD</span><br>
<span class="lineno"></span><span class="op" id="3265192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3265195">//&nbsp;AcceptTCP&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3265259">//&nbsp;connection.</span><br>
<span class="lineno">230</span><span class="keyword" id="3265274">func</span>&nbsp;<span class="op" id="3265279">(</span><span class="ident" id="3265280">l</span>&nbsp;<span class="op" id="3265282">*</span><span class="ident" id="3265283">TCPListener</span><span class="op" id="3265294">)</span>&nbsp;<span class="ident" id="3265296">AcceptTCP</span><span class="op" id="3265305">(</span><span class="op" id="3265306">)</span>&nbsp;<span class="op" id="3265308">(</span><span class="op" id="3265309">*</span><span class="ident" id="3265310">TCPConn</span><span class="op" id="3265317">,</span>&nbsp;<span class="builtintype" id="3265319">error</span><span class="op" id="3265324">)</span>&nbsp;<span class="op" id="3265326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265329">if</span>&nbsp;<span class="ident" id="3265332">l</span>&nbsp;<span class="op" id="3265334">==</span>&nbsp;<span class="ident" id="3265337">nil</span>&nbsp;<span class="op" id="3265341">||</span>&nbsp;<span class="ident" id="3265344">l</span><span class="op" id="3265345">.</span><span class="ident" id="3265346">fd</span>&nbsp;<span class="op" id="3265349">==</span>&nbsp;<span class="ident" id="3265352">nil</span>&nbsp;<span class="op" id="3265356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265360">return</span>&nbsp;<span class="ident" id="3265367">nil</span><span class="op" id="3265370">,</span>&nbsp;<span class="ident" id="3265372">syscall</span><span class="op" id="3265379">.</span><span class="ident" id="3265380">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3265388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3265391">fd</span><span class="op" id="3265393">,</span>&nbsp;<span class="ident" id="3265395">err</span>&nbsp;<span class="op" id="3265399">:=</span>&nbsp;<span class="ident" id="3265402">l</span><span class="op" id="3265403">.</span><span class="ident" id="3265404">fd</span><span class="op" id="3265406">.</span><span class="ident" id="3265407">accept</span><span class="op" id="3265413">(</span><span class="op" id="3265414">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265417">if</span>&nbsp;<span class="ident" id="3265420">err</span>&nbsp;<span class="op" id="3265424">!=</span>&nbsp;<span class="ident" id="3265427">nil</span>&nbsp;<span class="op" id="3265431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265435">return</span>&nbsp;<span class="ident" id="3265442">nil</span><span class="op" id="3265445">,</span>&nbsp;<span class="ident" id="3265447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3265452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265455">return</span>&nbsp;<span class="ident" id="3265462">newTCPConn</span><span class="op" id="3265472">(</span><span class="ident" id="3265473">fd</span><span class="op" id="3265475">)</span><span class="op" id="3265476">,</span>&nbsp;<span class="ident" id="3265478">nil</span><br>
<span class="lineno"></span><span class="op" id="3265482">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3265485">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3265554">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3265609">func</span>&nbsp;<span class="op" id="3265614">(</span><span class="ident" id="3265615">l</span>&nbsp;<span class="op" id="3265617">*</span><span class="ident" id="3265618">TCPListener</span><span class="op" id="3265629">)</span>&nbsp;<span class="ident" id="3265631">Accept</span><span class="op" id="3265637">(</span><span class="op" id="3265638">)</span>&nbsp;<span class="op" id="3265640">(</span><span class="ident" id="3265641">Conn</span><span class="op" id="3265645">,</span>&nbsp;<span class="builtintype" id="3265647">error</span><span class="op" id="3265652">)</span>&nbsp;<span class="op" id="3265654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3265657">c</span><span class="op" id="3265658">,</span>&nbsp;<span class="ident" id="3265660">err</span>&nbsp;<span class="op" id="3265664">:=</span>&nbsp;<span class="ident" id="3265667">l</span><span class="op" id="3265668">.</span><span class="ident" id="3265669">AcceptTCP</span><span class="op" id="3265678">(</span><span class="op" id="3265679">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265682">if</span>&nbsp;<span class="ident" id="3265685">err</span>&nbsp;<span class="op" id="3265689">!=</span>&nbsp;<span class="ident" id="3265692">nil</span>&nbsp;<span class="op" id="3265696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265700">return</span>&nbsp;<span class="ident" id="3265707">nil</span><span class="op" id="3265710">,</span>&nbsp;<span class="ident" id="3265712">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3265717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265720">return</span>&nbsp;<span class="ident" id="3265727">c</span><span class="op" id="3265728">,</span>&nbsp;<span class="ident" id="3265730">nil</span><br>
<span class="lineno"></span><span class="op" id="3265734">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="3265737">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3265782">//&nbsp;Already&nbsp;Accepted&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3265830">func</span>&nbsp;<span class="op" id="3265835">(</span><span class="ident" id="3265836">l</span>&nbsp;<span class="op" id="3265838">*</span><span class="ident" id="3265839">TCPListener</span><span class="op" id="3265850">)</span>&nbsp;<span class="ident" id="3265852">Close</span><span class="op" id="3265857">(</span><span class="op" id="3265858">)</span>&nbsp;<span class="builtintype" id="3265860">error</span>&nbsp;<span class="op" id="3265866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265869">if</span>&nbsp;<span class="ident" id="3265872">l</span>&nbsp;<span class="op" id="3265874">==</span>&nbsp;<span class="ident" id="3265877">nil</span>&nbsp;<span class="op" id="3265881">||</span>&nbsp;<span class="ident" id="3265884">l</span><span class="op" id="3265885">.</span><span class="ident" id="3265886">fd</span>&nbsp;<span class="op" id="3265889">==</span>&nbsp;<span class="ident" id="3265892">nil</span>&nbsp;<span class="op" id="3265896">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265900">return</span>&nbsp;<span class="ident" id="3265907">syscall</span><span class="op" id="3265914">.</span><span class="ident" id="3265915">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3265923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3265926">return</span>&nbsp;<span class="ident" id="3265933">l</span><span class="op" id="3265934">.</span><span class="ident" id="3265935">fd</span><span class="op" id="3265937">.</span><span class="ident" id="3265938">Close</span><span class="op" id="3265943">(</span><span class="op" id="3265944">)</span><br>
<span class="lineno"></span><span class="op" id="3265946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3265949">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address,&nbsp;a&nbsp;*TCPAddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3266009">func</span>&nbsp;<span class="op" id="3266014">(</span><span class="ident" id="3266015">l</span>&nbsp;<span class="op" id="3266017">*</span><span class="ident" id="3266018">TCPListener</span><span class="op" id="3266029">)</span>&nbsp;<span class="ident" id="3266031">Addr</span><span class="op" id="3266035">(</span><span class="op" id="3266036">)</span>&nbsp;<span class="ident" id="3266038">Addr</span>&nbsp;<span class="op" id="3266043">{</span>&nbsp;<span class="keyword" id="3266045">return</span>&nbsp;<span class="ident" id="3266052">l</span><span class="op" id="3266053">.</span><span class="ident" id="3266054">fd</span><span class="op" id="3266056">.</span><span class="ident" id="3266057">laddr</span>&nbsp;<span class="op" id="3266063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3266066">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3266129">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno">265</span><span class="keyword" id="3266173">func</span>&nbsp;<span class="op" id="3266178">(</span><span class="ident" id="3266179">l</span>&nbsp;<span class="op" id="3266181">*</span><span class="ident" id="3266182">TCPListener</span><span class="op" id="3266193">)</span>&nbsp;<span class="ident" id="3266195">SetDeadline</span><span class="op" id="3266206">(</span><span class="ident" id="3266207">t</span>&nbsp;<span class="ident" id="3266209">time</span><span class="op" id="3266213">.</span><span class="ident" id="3266214">Time</span><span class="op" id="3266218">)</span>&nbsp;<span class="builtintype" id="3266220">error</span>&nbsp;<span class="op" id="3266226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3266229">if</span>&nbsp;<span class="ident" id="3266232">l</span>&nbsp;<span class="op" id="3266234">==</span>&nbsp;<span class="ident" id="3266237">nil</span>&nbsp;<span class="op" id="3266241">||</span>&nbsp;<span class="ident" id="3266244">l</span><span class="op" id="3266245">.</span><span class="ident" id="3266246">fd</span>&nbsp;<span class="op" id="3266249">==</span>&nbsp;<span class="ident" id="3266252">nil</span>&nbsp;<span class="op" id="3266256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3266260">return</span>&nbsp;<span class="ident" id="3266267">syscall</span><span class="op" id="3266274">.</span><span class="ident" id="3266275">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3266283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3266286">return</span>&nbsp;<span class="ident" id="3266293">l</span><span class="op" id="3266294">.</span><span class="ident" id="3266295">fd</span><span class="op" id="3266297">.</span><span class="ident" id="3266298">setDeadline</span><span class="op" id="3266309">(</span><span class="ident" id="3266310">t</span><span class="op" id="3266311">)</span><br>
<span class="lineno">270</span><span class="op" id="3266313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3266316">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3266382">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3266452">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">275</span><span class="comment" id="3266517">//</span><br>
<span class="lineno"></span><span class="comment" id="3266520">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3266584">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3266650">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3266714">func</span>&nbsp;<span class="op" id="3266719">(</span><span class="ident" id="3266720">l</span>&nbsp;<span class="op" id="3266722">*</span><span class="ident" id="3266723">TCPListener</span><span class="op" id="3266734">)</span>&nbsp;<span class="ident" id="3266736">File</span><span class="op" id="3266740">(</span><span class="op" id="3266741">)</span>&nbsp;<span class="op" id="3266743">(</span><span class="ident" id="3266744">f</span>&nbsp;<span class="op" id="3266746">*</span><span class="ident" id="3266747">os</span><span class="op" id="3266749">.</span><span class="ident" id="3266750">File</span><span class="op" id="3266754">,</span>&nbsp;<span class="ident" id="3266756">err</span>&nbsp;<span class="builtintype" id="3266760">error</span><span class="op" id="3266765">)</span>&nbsp;<span class="op" id="3266767">{</span>&nbsp;<span class="keyword" id="3266769">return</span>&nbsp;<span class="ident" id="3266776">l</span><span class="op" id="3266777">.</span><span class="ident" id="3266778">fd</span><span class="op" id="3266780">.</span><span class="ident" id="3266781">dup</span><span class="op" id="3266784">(</span><span class="op" id="3266785">)</span>&nbsp;<span class="op" id="3266787">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3266790">//&nbsp;ListenTCP&nbsp;announces&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3266856">//&nbsp;listener.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3266924">//&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenTCP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.&nbsp;&nbsp;The&nbsp;caller&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3266995">//&nbsp;use&nbsp;the&nbsp;Addr&nbsp;method&nbsp;of&nbsp;TCPListener&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;chosen&nbsp;address.</span><br>
<span class="lineno">285</span><span class="keyword" id="3267065">func</span>&nbsp;<span class="ident" id="3267070">ListenTCP</span><span class="op" id="3267079">(</span><span class="ident" id="3267080">net</span>&nbsp;<span class="builtintype" id="3267084">string</span><span class="op" id="3267090">,</span>&nbsp;<span class="ident" id="3267092">laddr</span>&nbsp;<span class="op" id="3267098">*</span><span class="ident" id="3267099">TCPAddr</span><span class="op" id="3267106">)</span>&nbsp;<span class="op" id="3267108">(</span><span class="op" id="3267109">*</span><span class="ident" id="3267110">TCPListener</span><span class="op" id="3267121">,</span>&nbsp;<span class="builtintype" id="3267123">error</span><span class="op" id="3267128">)</span>&nbsp;<span class="op" id="3267130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267133">switch</span>&nbsp;<span class="ident" id="3267140">net</span>&nbsp;<span class="op" id="3267144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267147">case</span>&nbsp;<span class="string" id="3267152">&#34;tcp&#34;</span><span class="op" id="3267157">,</span>&nbsp;<span class="string" id="3267159">&#34;tcp4&#34;</span><span class="op" id="3267165">,</span>&nbsp;<span class="string" id="3267167">&#34;tcp6&#34;</span><span class="op" id="3267173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267176">default</span><span class="op" id="3267183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267187">return</span>&nbsp;<span class="ident" id="3267194">nil</span><span class="op" id="3267197">,</span>&nbsp;<span class="op" id="3267199">&amp;</span><span class="ident" id="3267200">OpError</span><span class="op" id="3267207">{</span><span class="ident" id="3267208">Op</span><span class="op" id="3267210">:</span>&nbsp;<span class="string" id="3267212">&#34;listen&#34;</span><span class="op" id="3267220">,</span>&nbsp;<span class="ident" id="3267222">Net</span><span class="op" id="3267225">:</span>&nbsp;<span class="ident" id="3267227">net</span><span class="op" id="3267230">,</span>&nbsp;<span class="ident" id="3267232">Addr</span><span class="op" id="3267236">:</span>&nbsp;<span class="ident" id="3267238">laddr</span><span class="op" id="3267243">,</span>&nbsp;<span class="ident" id="3267245">Err</span><span class="op" id="3267248">:</span>&nbsp;<span class="ident" id="3267250">UnknownNetworkError</span><span class="op" id="3267269">(</span><span class="ident" id="3267270">net</span><span class="op" id="3267273">)</span><span class="op" id="3267274">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3267277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267280">if</span>&nbsp;<span class="ident" id="3267283">laddr</span>&nbsp;<span class="op" id="3267289">==</span>&nbsp;<span class="ident" id="3267292">nil</span>&nbsp;<span class="op" id="3267296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3267300">laddr</span>&nbsp;<span class="op" id="3267306">=</span>&nbsp;<span class="op" id="3267308">&amp;</span><span class="ident" id="3267309">TCPAddr</span><span class="op" id="3267316">{</span><span class="op" id="3267317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3267320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3267323">fd</span><span class="op" id="3267325">,</span>&nbsp;<span class="ident" id="3267327">err</span>&nbsp;<span class="op" id="3267331">:=</span>&nbsp;<span class="ident" id="3267334">internetSocket</span><span class="op" id="3267348">(</span><span class="ident" id="3267349">net</span><span class="op" id="3267352">,</span>&nbsp;<span class="ident" id="3267354">laddr</span><span class="op" id="3267359">,</span>&nbsp;<span class="ident" id="3267361">nil</span><span class="op" id="3267364">,</span>&nbsp;<span class="ident" id="3267366">noDeadline</span><span class="op" id="3267376">,</span>&nbsp;<span class="ident" id="3267378">syscall</span><span class="op" id="3267385">.</span><span class="ident" id="3267386">SOCK_STREAM</span><span class="op" id="3267397">,</span>&nbsp;<span class="num" id="3267399">0</span><span class="op" id="3267400">,</span>&nbsp;<span class="string" id="3267402">&#34;listen&#34;</span><span class="op" id="3267410">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267413">if</span>&nbsp;<span class="ident" id="3267416">err</span>&nbsp;<span class="op" id="3267420">!=</span>&nbsp;<span class="ident" id="3267423">nil</span>&nbsp;<span class="op" id="3267427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267431">return</span>&nbsp;<span class="ident" id="3267438">nil</span><span class="op" id="3267441">,</span>&nbsp;<span class="op" id="3267443">&amp;</span><span class="ident" id="3267444">OpError</span><span class="op" id="3267451">{</span><span class="ident" id="3267452">Op</span><span class="op" id="3267454">:</span>&nbsp;<span class="string" id="3267456">&#34;listen&#34;</span><span class="op" id="3267464">,</span>&nbsp;<span class="ident" id="3267466">Net</span><span class="op" id="3267469">:</span>&nbsp;<span class="ident" id="3267471">net</span><span class="op" id="3267474">,</span>&nbsp;<span class="ident" id="3267476">Addr</span><span class="op" id="3267480">:</span>&nbsp;<span class="ident" id="3267482">laddr</span><span class="op" id="3267487">,</span>&nbsp;<span class="ident" id="3267489">Err</span><span class="op" id="3267492">:</span>&nbsp;<span class="ident" id="3267494">err</span><span class="op" id="3267497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3267500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3267503">return</span>&nbsp;<span class="op" id="3267510">&amp;</span><span class="ident" id="3267511">TCPListener</span><span class="op" id="3267522">{</span><span class="ident" id="3267523">fd</span><span class="op" id="3267525">}</span><span class="op" id="3267526">,</span>&nbsp;<span class="ident" id="3267528">nil</span><br>
<span class="lineno"></span><span class="op" id="3267532">}</span>
</div>
</body>
</html>
