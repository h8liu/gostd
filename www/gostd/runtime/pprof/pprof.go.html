<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/pprof</h2>
<ul>
<li><a href="/gostd/runtime/pprof/mprof_test.go.html">mprof_test.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof.go.html">pprof.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof_test.go.html">pprof_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6016266">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6016322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6016376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6016427">//&nbsp;Package&nbsp;pprof&nbsp;writes&nbsp;runtime&nbsp;profiling&nbsp;data&nbsp;in&nbsp;the&nbsp;format&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="6016497">//&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="6016533">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6016574">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="keyword" id="6016621">package</span>&nbsp;<span class="ident" id="6016629">pprof</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="6016636">import</span>&nbsp;<span class="op" id="6016643">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016646">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016655">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016664">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016671">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016677">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016688">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016696">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016707">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016715">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span><span class="op" id="6016732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6016735">//&nbsp;BUG(rsc):&nbsp;Profiles&nbsp;are&nbsp;incomplete&nbsp;and&nbsp;inaccurate&nbsp;on&nbsp;NetBSD&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span><span class="comment" id="6016807">//&nbsp;See&nbsp;http://golang.org/issue/6047&nbsp;for&nbsp;details.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6016857">//&nbsp;A&nbsp;Profile&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;stack&nbsp;traces&nbsp;showing&nbsp;the&nbsp;call&nbsp;sequences</span><br>
<span class="lineno"></span><span class="comment" id="6016929">//&nbsp;that&nbsp;led&nbsp;to&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;event,&nbsp;such&nbsp;as&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="6016997">//&nbsp;Packages&nbsp;can&nbsp;create&nbsp;and&nbsp;maintain&nbsp;their&nbsp;own&nbsp;profiles;&nbsp;the&nbsp;most&nbsp;common</span><br>
<span class="lineno"></span><span class="comment" id="6017069">//&nbsp;use&nbsp;is&nbsp;for&nbsp;tracking&nbsp;resources&nbsp;that&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;closed,&nbsp;such&nbsp;as&nbsp;files</span><br>
<span class="lineno">30</span><span class="comment" id="6017148">//&nbsp;or&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="comment" id="6017175">//</span><br>
<span class="lineno"></span><span class="comment" id="6017178">//&nbsp;A&nbsp;Profile&#39;s&nbsp;methods&nbsp;can&nbsp;be&nbsp;called&nbsp;from&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="6017256">//</span><br>
<span class="lineno"></span><span class="comment" id="6017259">//&nbsp;Each&nbsp;Profile&nbsp;has&nbsp;a&nbsp;unique&nbsp;name.&nbsp;&nbsp;A&nbsp;few&nbsp;profiles&nbsp;are&nbsp;predefined:</span><br>
<span class="lineno">35</span><span class="comment" id="6017326">//</span><br>
<span class="lineno"></span><span class="comment" id="6017329">//&nbsp;&nbsp;&nbsp;&nbspgoroutine&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;current&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6017386">//&nbsp;&nbsp;&nbsp;&nbspheap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;sampling&nbsp;of&nbsp;all&nbsp;heap&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="6017439">//&nbsp;&nbsp;&nbsp;&nbspthreadcreate&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;the&nbsp;creation&nbsp;of&nbsp;new&nbsp;OS&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="6017513">//&nbsp;&nbsp;&nbsp;&nbspblock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;blocking&nbsp;on&nbsp;synchronization&nbsp;primitives</span><br>
<span class="lineno">40</span><span class="comment" id="6017595">//</span><br>
<span class="lineno"></span><span class="comment" id="6017598">//&nbsp;These&nbsp;predefined&nbsp;profiles&nbsp;maintain&nbsp;themselves&nbsp;and&nbsp;panic&nbsp;on&nbsp;an&nbsp;explicit</span><br>
<span class="lineno"></span><span class="comment" id="6017672">//&nbsp;Add&nbsp;or&nbsp;Remove&nbsp;method&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="6017702">//</span><br>
<span class="lineno"></span><span class="comment" id="6017705">//&nbsp;The&nbsp;CPU&nbsp;profile&nbsp;is&nbsp;not&nbsp;available&nbsp;as&nbsp;a&nbsp;Profile.&nbsp;&nbsp;It&nbsp;has&nbsp;a&nbsp;special&nbsp;API,</span><br>
<span class="lineno">45</span><span class="comment" id="6017778">//&nbsp;the&nbsp;StartCPUProfile&nbsp;and&nbsp;StopCPUProfile&nbsp;functions,&nbsp;because&nbsp;it&nbsp;streams</span><br>
<span class="lineno"></span><span class="comment" id="6017850">//&nbsp;output&nbsp;to&nbsp;a&nbsp;writer&nbsp;during&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="6017890">//</span><br>
<span class="lineno"></span><span class="keyword" id="6017893">type</span>&nbsp;<span class="ident" id="6017898">Profile</span>&nbsp;<span class="keyword" id="6017906">struct</span>&nbsp;<span class="op" id="6017913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017916">name</span>&nbsp;&nbsp;<span class="builtintype" id="6017922">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017930">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017936">sync</span><span class="op" id="6017940">.</span><span class="ident" id="6017941">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017948">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6017954">map</span><span class="op" id="6017957">[</span><span class="keyword" id="6017958">interface</span><span class="op" id="6017967">{</span><span class="op" id="6017968">}</span><span class="op" id="6017969">]</span><span class="op" id="6017970">[</span><span class="op" id="6017971">]</span><span class="builtintype" id="6017972">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017981">count</span>&nbsp;<span class="keyword" id="6017987">func</span><span class="op" id="6017991">(</span><span class="op" id="6017992">)</span>&nbsp;<span class="builtintype" id="6017994">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017999">write</span>&nbsp;<span class="keyword" id="6018005">func</span><span class="op" id="6018009">(</span><span class="ident" id="6018010">io</span><span class="op" id="6018012">.</span><span class="ident" id="6018013">Writer</span><span class="op" id="6018019">,</span>&nbsp;<span class="builtintype" id="6018021">int</span><span class="op" id="6018024">)</span>&nbsp;<span class="builtintype" id="6018026">error</span><br>
<span class="lineno"></span><span class="op" id="6018032">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="6018035">//&nbsp;profiles&nbsp;records&nbsp;all&nbsp;registered&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="6018080">var</span>&nbsp;<span class="ident" id="6018084">profiles</span>&nbsp;<span class="keyword" id="6018093">struct</span>&nbsp;<span class="op" id="6018100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018103">mu</span>&nbsp;<span class="ident" id="6018106">sync</span><span class="op" id="6018110">.</span><span class="ident" id="6018111">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018118">m</span>&nbsp;&nbsp;<span class="keyword" id="6018121">map</span><span class="op" id="6018124">[</span><span class="builtintype" id="6018125">string</span><span class="op" id="6018131">]</span><span class="op" id="6018132">*</span><span class="ident" id="6018133">Profile</span><br>
<span class="lineno">60</span><span class="op" id="6018141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6018144">var</span>&nbsp;<span class="ident" id="6018148">goroutineProfile</span>&nbsp;<span class="op" id="6018165">=</span>&nbsp;<span class="op" id="6018167">&amp;</span><span class="ident" id="6018168">Profile</span><span class="op" id="6018175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018178">name</span><span class="op" id="6018182">:</span>&nbsp;&nbsp;<span class="string" id="6018185">&#34;goroutine&#34;</span><span class="op" id="6018196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018199">count</span><span class="op" id="6018204">:</span>&nbsp;<span class="ident" id="6018206">countGoroutine</span><span class="op" id="6018220">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018223">write</span><span class="op" id="6018228">:</span>&nbsp;<span class="ident" id="6018230">writeGoroutine</span><span class="op" id="6018244">,</span><br>
<span class="lineno"></span><span class="op" id="6018246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6018249">var</span>&nbsp;<span class="ident" id="6018253">threadcreateProfile</span>&nbsp;<span class="op" id="6018273">=</span>&nbsp;<span class="op" id="6018275">&amp;</span><span class="ident" id="6018276">Profile</span><span class="op" id="6018283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018286">name</span><span class="op" id="6018290">:</span>&nbsp;&nbsp;<span class="string" id="6018293">&#34;threadcreate&#34;</span><span class="op" id="6018307">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018310">count</span><span class="op" id="6018315">:</span>&nbsp;<span class="ident" id="6018317">countThreadCreate</span><span class="op" id="6018334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018337">write</span><span class="op" id="6018342">:</span>&nbsp;<span class="ident" id="6018344">writeThreadCreate</span><span class="op" id="6018361">,</span><br>
<span class="lineno"></span><span class="op" id="6018363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6018366">var</span>&nbsp;<span class="ident" id="6018370">heapProfile</span>&nbsp;<span class="op" id="6018382">=</span>&nbsp;<span class="op" id="6018384">&amp;</span><span class="ident" id="6018385">Profile</span><span class="op" id="6018392">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018395">name</span><span class="op" id="6018399">:</span>&nbsp;&nbsp;<span class="string" id="6018402">&#34;heap&#34;</span><span class="op" id="6018408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018411">count</span><span class="op" id="6018416">:</span>&nbsp;<span class="ident" id="6018418">countHeap</span><span class="op" id="6018427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018430">write</span><span class="op" id="6018435">:</span>&nbsp;<span class="ident" id="6018437">writeHeap</span><span class="op" id="6018446">,</span><br>
<span class="lineno"></span><span class="op" id="6018448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6018451">var</span>&nbsp;<span class="ident" id="6018455">blockProfile</span>&nbsp;<span class="op" id="6018468">=</span>&nbsp;<span class="op" id="6018470">&amp;</span><span class="ident" id="6018471">Profile</span><span class="op" id="6018478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018481">name</span><span class="op" id="6018485">:</span>&nbsp;&nbsp;<span class="string" id="6018488">&#34;block&#34;</span><span class="op" id="6018495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018498">count</span><span class="op" id="6018503">:</span>&nbsp;<span class="ident" id="6018505">countBlock</span><span class="op" id="6018515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018518">write</span><span class="op" id="6018523">:</span>&nbsp;<span class="ident" id="6018525">writeBlock</span><span class="op" id="6018535">,</span><br>
<span class="lineno"></span><span class="op" id="6018537">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6018540">func</span>&nbsp;<span class="ident" id="6018545">lockProfiles</span><span class="op" id="6018557">(</span><span class="op" id="6018558">)</span>&nbsp;<span class="op" id="6018560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018563">profiles</span><span class="op" id="6018571">.</span><span class="ident" id="6018572">mu</span><span class="op" id="6018574">.</span><span class="ident" id="6018575">Lock</span><span class="op" id="6018579">(</span><span class="op" id="6018580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018583">if</span>&nbsp;<span class="ident" id="6018586">profiles</span><span class="op" id="6018594">.</span><span class="ident" id="6018595">m</span>&nbsp;<span class="op" id="6018597">==</span>&nbsp;<span class="ident" id="6018600">nil</span>&nbsp;<span class="op" id="6018604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018608">//&nbsp;Initial&nbsp;built-in&nbsp;profiles.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018640">profiles</span><span class="op" id="6018648">.</span><span class="ident" id="6018649">m</span>&nbsp;<span class="op" id="6018651">=</span>&nbsp;<span class="keyword" id="6018653">map</span><span class="op" id="6018656">[</span><span class="builtintype" id="6018657">string</span><span class="op" id="6018663">]</span><span class="op" id="6018664">*</span><span class="ident" id="6018665">Profile</span><span class="op" id="6018672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6018677">&#34;goroutine&#34;</span><span class="op" id="6018688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018693">goroutineProfile</span><span class="op" id="6018709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6018714">&#34;threadcreate&#34;</span><span class="op" id="6018728">:</span>&nbsp;<span class="ident" id="6018730">threadcreateProfile</span><span class="op" id="6018749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6018754">&#34;heap&#34;</span><span class="op" id="6018760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018770">heapProfile</span><span class="op" id="6018781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6018786">&#34;block&#34;</span><span class="op" id="6018793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018802">blockProfile</span><span class="op" id="6018814">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018821">}</span><br>
<span class="lineno"></span><span class="op" id="6018823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6018826">func</span>&nbsp;<span class="ident" id="6018831">unlockProfiles</span><span class="op" id="6018845">(</span><span class="op" id="6018846">)</span>&nbsp;<span class="op" id="6018848">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018851">profiles</span><span class="op" id="6018859">.</span><span class="ident" id="6018860">mu</span><span class="op" id="6018862">.</span><span class="ident" id="6018863">Unlock</span><span class="op" id="6018869">(</span><span class="op" id="6018870">)</span><br>
<span class="lineno"></span><span class="op" id="6018872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6018875">//&nbsp;NewProfile&nbsp;creates&nbsp;a&nbsp;new&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="6018932">//&nbsp;If&nbsp;a&nbsp;profile&nbsp;with&nbsp;that&nbsp;name&nbsp;already&nbsp;exists,&nbsp;NewProfile&nbsp;panics.</span><br>
<span class="lineno">105</span><span class="comment" id="6018998">//&nbsp;The&nbsp;convention&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;&#39;import/path.&#39;&nbsp;prefix&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6019060">//&nbsp;separate&nbsp;name&nbsp;spaces&nbsp;for&nbsp;each&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6019102">func</span>&nbsp;<span class="ident" id="6019107">NewProfile</span><span class="op" id="6019117">(</span><span class="ident" id="6019118">name</span>&nbsp;<span class="builtintype" id="6019123">string</span><span class="op" id="6019129">)</span>&nbsp;<span class="op" id="6019131">*</span><span class="ident" id="6019132">Profile</span>&nbsp;<span class="op" id="6019140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019143">lockProfiles</span><span class="op" id="6019155">(</span><span class="op" id="6019156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019159">defer</span>&nbsp;<span class="ident" id="6019165">unlockProfiles</span><span class="op" id="6019179">(</span><span class="op" id="6019180">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019183">if</span>&nbsp;<span class="ident" id="6019186">name</span>&nbsp;<span class="op" id="6019191">==</span>&nbsp;<span class="string" id="6019194">&#34;&#34;</span>&nbsp;<span class="op" id="6019197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6019201">panic</span><span class="op" id="6019206">(</span><span class="string" id="6019207">&#34;pprof:&nbsp;NewProfile&nbsp;with&nbsp;empty&nbsp;name&#34;</span><span class="op" id="6019242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019248">if</span>&nbsp;<span class="ident" id="6019251">profiles</span><span class="op" id="6019259">.</span><span class="ident" id="6019260">m</span><span class="op" id="6019261">[</span><span class="ident" id="6019262">name</span><span class="op" id="6019266">]</span>&nbsp;<span class="op" id="6019268">!=</span>&nbsp;<span class="ident" id="6019271">nil</span>&nbsp;<span class="op" id="6019275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6019279">panic</span><span class="op" id="6019284">(</span><span class="string" id="6019285">&#34;pprof:&nbsp;NewProfile&nbsp;name&nbsp;already&nbsp;in&nbsp;use:&nbsp;&#34;</span>&nbsp;<span class="op" id="6019327">+</span>&nbsp;<span class="ident" id="6019329">name</span><span class="op" id="6019333">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019339">p</span>&nbsp;<span class="op" id="6019341">:=</span>&nbsp;<span class="op" id="6019344">&amp;</span><span class="ident" id="6019345">Profile</span><span class="op" id="6019352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019356">name</span><span class="op" id="6019360">:</span>&nbsp;<span class="ident" id="6019362">name</span><span class="op" id="6019366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019370">m</span><span class="op" id="6019371">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019376">map</span><span class="op" id="6019379">[</span><span class="keyword" id="6019380">interface</span><span class="op" id="6019389">{</span><span class="op" id="6019390">}</span><span class="op" id="6019391">]</span><span class="op" id="6019392">[</span><span class="op" id="6019393">]</span><span class="builtintype" id="6019394">uintptr</span><span class="op" id="6019401">{</span><span class="op" id="6019402">}</span><span class="op" id="6019403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019406">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019409">profiles</span><span class="op" id="6019417">.</span><span class="ident" id="6019418">m</span><span class="op" id="6019419">[</span><span class="ident" id="6019420">name</span><span class="op" id="6019424">]</span>&nbsp;<span class="op" id="6019426">=</span>&nbsp;<span class="ident" id="6019428">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019431">return</span>&nbsp;<span class="ident" id="6019438">p</span><br>
<span class="lineno"></span><span class="op" id="6019440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6019443">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name,&nbsp;or&nbsp;nil&nbsp;if&nbsp;no&nbsp;such&nbsp;profile&nbsp;exists.</span><br>
<span class="lineno">125</span><span class="keyword" id="6019528">func</span>&nbsp;<span class="ident" id="6019533">Lookup</span><span class="op" id="6019539">(</span><span class="ident" id="6019540">name</span>&nbsp;<span class="builtintype" id="6019545">string</span><span class="op" id="6019551">)</span>&nbsp;<span class="op" id="6019553">*</span><span class="ident" id="6019554">Profile</span>&nbsp;<span class="op" id="6019562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019565">lockProfiles</span><span class="op" id="6019577">(</span><span class="op" id="6019578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019581">defer</span>&nbsp;<span class="ident" id="6019587">unlockProfiles</span><span class="op" id="6019601">(</span><span class="op" id="6019602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019605">return</span>&nbsp;<span class="ident" id="6019612">profiles</span><span class="op" id="6019620">.</span><span class="ident" id="6019621">m</span><span class="op" id="6019622">[</span><span class="ident" id="6019623">name</span><span class="op" id="6019627">]</span><br>
<span class="lineno"></span><span class="op" id="6019629">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="6019632">//&nbsp;Profiles&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;the&nbsp;known&nbsp;profiles,&nbsp;sorted&nbsp;by&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="6019703">func</span>&nbsp;<span class="ident" id="6019708">Profiles</span><span class="op" id="6019716">(</span><span class="op" id="6019717">)</span>&nbsp;<span class="op" id="6019719">[</span><span class="op" id="6019720">]</span><span class="op" id="6019721">*</span><span class="ident" id="6019722">Profile</span>&nbsp;<span class="op" id="6019730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019733">lockProfiles</span><span class="op" id="6019745">(</span><span class="op" id="6019746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019749">defer</span>&nbsp;<span class="ident" id="6019755">unlockProfiles</span><span class="op" id="6019769">(</span><span class="op" id="6019770">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019774">var</span>&nbsp;<span class="ident" id="6019778">all</span>&nbsp;<span class="op" id="6019782">[</span><span class="op" id="6019783">]</span><span class="op" id="6019784">*</span><span class="ident" id="6019785">Profile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019794">for</span>&nbsp;<span class="ident" id="6019798">_</span><span class="op" id="6019799">,</span>&nbsp;<span class="ident" id="6019801">p</span>&nbsp;<span class="op" id="6019803">:=</span>&nbsp;<span class="keyword" id="6019806">range</span>&nbsp;<span class="ident" id="6019812">profiles</span><span class="op" id="6019820">.</span><span class="ident" id="6019821">m</span>&nbsp;<span class="op" id="6019823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019827">all</span>&nbsp;<span class="op" id="6019831">=</span>&nbsp;<span class="builtinfunc" id="6019833">append</span><span class="op" id="6019839">(</span><span class="ident" id="6019840">all</span><span class="op" id="6019843">,</span>&nbsp;<span class="ident" id="6019845">p</span><span class="op" id="6019846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019849">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019853">sort</span><span class="op" id="6019857">.</span><span class="ident" id="6019858">Sort</span><span class="op" id="6019862">(</span><span class="ident" id="6019863">byName</span><span class="op" id="6019869">(</span><span class="ident" id="6019870">all</span><span class="op" id="6019873">)</span><span class="op" id="6019874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019877">return</span>&nbsp;<span class="ident" id="6019884">all</span><br>
<span class="lineno"></span><span class="op" id="6019888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6019891">type</span>&nbsp;<span class="ident" id="6019896">byName</span>&nbsp;<span class="op" id="6019903">[</span><span class="op" id="6019904">]</span><span class="op" id="6019905">*</span><span class="ident" id="6019906">Profile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6019915">func</span>&nbsp;<span class="op" id="6019920">(</span><span class="ident" id="6019921">x</span>&nbsp;<span class="ident" id="6019923">byName</span><span class="op" id="6019929">)</span>&nbsp;<span class="ident" id="6019931">Len</span><span class="op" id="6019934">(</span><span class="op" id="6019935">)</span>&nbsp;<span class="builtintype" id="6019937">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019951">{</span>&nbsp;<span class="keyword" id="6019953">return</span>&nbsp;<span class="builtinfunc" id="6019960">len</span><span class="op" id="6019963">(</span><span class="ident" id="6019964">x</span><span class="op" id="6019965">)</span>&nbsp;<span class="op" id="6019967">}</span><br>
<span class="lineno"></span><span class="keyword" id="6019969">func</span>&nbsp;<span class="op" id="6019974">(</span><span class="ident" id="6019975">x</span>&nbsp;<span class="ident" id="6019977">byName</span><span class="op" id="6019983">)</span>&nbsp;<span class="ident" id="6019985">Swap</span><span class="op" id="6019989">(</span><span class="ident" id="6019990">i</span><span class="op" id="6019991">,</span>&nbsp;<span class="ident" id="6019993">j</span>&nbsp;<span class="builtintype" id="6019995">int</span><span class="op" id="6019998">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6020005">{</span>&nbsp;<span class="ident" id="6020007">x</span><span class="op" id="6020008">[</span><span class="ident" id="6020009">i</span><span class="op" id="6020010">]</span><span class="op" id="6020011">,</span>&nbsp;<span class="ident" id="6020013">x</span><span class="op" id="6020014">[</span><span class="ident" id="6020015">j</span><span class="op" id="6020016">]</span>&nbsp;<span class="op" id="6020018">=</span>&nbsp;<span class="ident" id="6020020">x</span><span class="op" id="6020021">[</span><span class="ident" id="6020022">j</span><span class="op" id="6020023">]</span><span class="op" id="6020024">,</span>&nbsp;<span class="ident" id="6020026">x</span><span class="op" id="6020027">[</span><span class="ident" id="6020028">i</span><span class="op" id="6020029">]</span>&nbsp;<span class="op" id="6020031">}</span><br>
<span class="lineno"></span><span class="keyword" id="6020033">func</span>&nbsp;<span class="op" id="6020038">(</span><span class="ident" id="6020039">x</span>&nbsp;<span class="ident" id="6020041">byName</span><span class="op" id="6020047">)</span>&nbsp;<span class="ident" id="6020049">Less</span><span class="op" id="6020053">(</span><span class="ident" id="6020054">i</span><span class="op" id="6020055">,</span>&nbsp;<span class="ident" id="6020057">j</span>&nbsp;<span class="builtintype" id="6020059">int</span><span class="op" id="6020062">)</span>&nbsp;<span class="builtintype" id="6020064">bool</span>&nbsp;<span class="op" id="6020069">{</span>&nbsp;<span class="keyword" id="6020071">return</span>&nbsp;<span class="ident" id="6020078">x</span><span class="op" id="6020079">[</span><span class="ident" id="6020080">i</span><span class="op" id="6020081">]</span><span class="op" id="6020082">.</span><span class="ident" id="6020083">name</span>&nbsp;<span class="op" id="6020088">&lt;</span>&nbsp;<span class="ident" id="6020090">x</span><span class="op" id="6020091">[</span><span class="ident" id="6020092">j</span><span class="op" id="6020093">]</span><span class="op" id="6020094">.</span><span class="ident" id="6020095">name</span>&nbsp;<span class="op" id="6020100">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="6020103">//&nbsp;Name&nbsp;returns&nbsp;this&nbsp;profile&#39;s&nbsp;name,&nbsp;which&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;Lookup&nbsp;to&nbsp;reobtain&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="6020195">func</span>&nbsp;<span class="op" id="6020200">(</span><span class="ident" id="6020201">p</span>&nbsp;<span class="op" id="6020203">*</span><span class="ident" id="6020204">Profile</span><span class="op" id="6020211">)</span>&nbsp;<span class="ident" id="6020213">Name</span><span class="op" id="6020217">(</span><span class="op" id="6020218">)</span>&nbsp;<span class="builtintype" id="6020220">string</span>&nbsp;<span class="op" id="6020227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020230">return</span>&nbsp;<span class="ident" id="6020237">p</span><span class="op" id="6020238">.</span><span class="ident" id="6020239">name</span><br>
<span class="lineno"></span><span class="op" id="6020244">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="6020247">//&nbsp;Count&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;execution&nbsp;stacks&nbsp;currently&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="6020321">func</span>&nbsp;<span class="op" id="6020326">(</span><span class="ident" id="6020327">p</span>&nbsp;<span class="op" id="6020329">*</span><span class="ident" id="6020330">Profile</span><span class="op" id="6020337">)</span>&nbsp;<span class="ident" id="6020339">Count</span><span class="op" id="6020344">(</span><span class="op" id="6020345">)</span>&nbsp;<span class="builtintype" id="6020347">int</span>&nbsp;<span class="op" id="6020351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020354">p</span><span class="op" id="6020355">.</span><span class="ident" id="6020356">mu</span><span class="op" id="6020358">.</span><span class="ident" id="6020359">Lock</span><span class="op" id="6020363">(</span><span class="op" id="6020364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020367">defer</span>&nbsp;<span class="ident" id="6020373">p</span><span class="op" id="6020374">.</span><span class="ident" id="6020375">mu</span><span class="op" id="6020377">.</span><span class="ident" id="6020378">Unlock</span><span class="op" id="6020384">(</span><span class="op" id="6020385">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020388">if</span>&nbsp;<span class="ident" id="6020391">p</span><span class="op" id="6020392">.</span><span class="ident" id="6020393">count</span>&nbsp;<span class="op" id="6020399">!=</span>&nbsp;<span class="ident" id="6020402">nil</span>&nbsp;<span class="op" id="6020406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020410">return</span>&nbsp;<span class="ident" id="6020417">p</span><span class="op" id="6020418">.</span><span class="ident" id="6020419">count</span><span class="op" id="6020424">(</span><span class="op" id="6020425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020431">return</span>&nbsp;<span class="builtinfunc" id="6020438">len</span><span class="op" id="6020441">(</span><span class="ident" id="6020442">p</span><span class="op" id="6020443">.</span><span class="ident" id="6020444">m</span><span class="op" id="6020445">)</span><br>
<span class="lineno"></span><span class="op" id="6020447">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="6020450">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;current&nbsp;execution&nbsp;stack&nbsp;to&nbsp;the&nbsp;profile,&nbsp;associated&nbsp;with&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="6020529">//&nbsp;Add&nbsp;stores&nbsp;value&nbsp;in&nbsp;an&nbsp;internal&nbsp;map,&nbsp;so&nbsp;value&nbsp;must&nbsp;be&nbsp;suitable&nbsp;for&nbsp;use&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="6020606">//&nbsp;a&nbsp;map&nbsp;key&nbsp;and&nbsp;will&nbsp;not&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="6020677">//&nbsp;call&nbsp;to&nbsp;Remove.&nbsp;&nbsp;Add&nbsp;panics&nbsp;if&nbsp;the&nbsp;profile&nbsp;already&nbsp;contains&nbsp;a&nbsp;stack&nbsp;for&nbsp;value.</span><br>
<span class="lineno">170</span><span class="comment" id="6020759">//</span><br>
<span class="lineno"></span><span class="comment" id="6020762">//&nbsp;The&nbsp;skip&nbsp;parameter&nbsp;has&nbsp;the&nbsp;same&nbsp;meaning&nbsp;as&nbsp;runtime.Caller&#39;s&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="6020830">//&nbsp;and&nbsp;controls&nbsp;where&nbsp;the&nbsp;stack&nbsp;trace&nbsp;begins.&nbsp;&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6020903">//&nbsp;trace&nbsp;in&nbsp;the&nbsp;function&nbsp;calling&nbsp;Add.&nbsp;&nbsp;For&nbsp;example,&nbsp;given&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="6020966">//&nbsp;execution&nbsp;stack:</span><br>
<span class="lineno">175</span><span class="comment" id="6020986">//</span><br>
<span class="lineno"></span><span class="comment" id="6020989">//&nbsp;&nbsp;&nbsp;&nbspAdd</span><br>
<span class="lineno"></span><span class="comment" id="6020996">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;rpc.NewClient</span><br>
<span class="lineno"></span><span class="comment" id="6021025">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;mypkg.Run</span><br>
<span class="lineno"></span><span class="comment" id="6021050">//&nbsp;&nbsp;&nbsp;&nbspcalled&nbsp;from&nbsp;main.main</span><br>
<span class="lineno">180</span><span class="comment" id="6021075">//</span><br>
<span class="lineno"></span><span class="comment" id="6021078">//&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;Add&nbsp;inside&nbsp;rpc.NewClient.</span><br>
<span class="lineno"></span><span class="comment" id="6021160">//&nbsp;Passing&nbsp;skip=1&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;NewClient&nbsp;inside&nbsp;mypkg.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6021244">//</span><br>
<span class="lineno"></span><span class="keyword" id="6021247">func</span>&nbsp;<span class="op" id="6021252">(</span><span class="ident" id="6021253">p</span>&nbsp;<span class="op" id="6021255">*</span><span class="ident" id="6021256">Profile</span><span class="op" id="6021263">)</span>&nbsp;<span class="ident" id="6021265">Add</span><span class="op" id="6021268">(</span><span class="ident" id="6021269">value</span>&nbsp;<span class="keyword" id="6021275">interface</span><span class="op" id="6021284">{</span><span class="op" id="6021285">}</span><span class="op" id="6021286">,</span>&nbsp;<span class="ident" id="6021288">skip</span>&nbsp;<span class="builtintype" id="6021293">int</span><span class="op" id="6021296">)</span>&nbsp;<span class="op" id="6021298">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021301">if</span>&nbsp;<span class="ident" id="6021304">p</span><span class="op" id="6021305">.</span><span class="ident" id="6021306">name</span>&nbsp;<span class="op" id="6021311">==</span>&nbsp;<span class="string" id="6021314">&#34;&#34;</span>&nbsp;<span class="op" id="6021317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6021321">panic</span><span class="op" id="6021326">(</span><span class="string" id="6021327">&#34;pprof:&nbsp;use&nbsp;of&nbsp;uninitialized&nbsp;Profile&#34;</span><span class="op" id="6021364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021370">if</span>&nbsp;<span class="ident" id="6021373">p</span><span class="op" id="6021374">.</span><span class="ident" id="6021375">write</span>&nbsp;<span class="op" id="6021381">!=</span>&nbsp;<span class="ident" id="6021384">nil</span>&nbsp;<span class="op" id="6021388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6021392">panic</span><span class="op" id="6021397">(</span><span class="string" id="6021398">&#34;pprof:&nbsp;Add&nbsp;called&nbsp;on&nbsp;built-in&nbsp;Profile&nbsp;&#34;</span>&nbsp;<span class="op" id="6021439">+</span>&nbsp;<span class="ident" id="6021441">p</span><span class="op" id="6021442">.</span><span class="ident" id="6021443">name</span><span class="op" id="6021447">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021454">stk</span>&nbsp;<span class="op" id="6021458">:=</span>&nbsp;<span class="builtinfunc" id="6021461">make</span><span class="op" id="6021465">(</span><span class="op" id="6021466">[</span><span class="op" id="6021467">]</span><span class="builtintype" id="6021468">uintptr</span><span class="op" id="6021475">,</span>&nbsp;<span class="num" id="6021477">32</span><span class="op" id="6021479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021482">n</span>&nbsp;<span class="op" id="6021484">:=</span>&nbsp;<span class="ident" id="6021487">runtime</span><span class="op" id="6021494">.</span><span class="ident" id="6021495">Callers</span><span class="op" id="6021502">(</span><span class="ident" id="6021503">skip</span><span class="op" id="6021507">+</span><span class="num" id="6021508">1</span><span class="op" id="6021509">,</span>&nbsp;<span class="ident" id="6021511">stk</span><span class="op" id="6021514">[</span><span class="op" id="6021515">:</span><span class="op" id="6021516">]</span><span class="op" id="6021517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021521">p</span><span class="op" id="6021522">.</span><span class="ident" id="6021523">mu</span><span class="op" id="6021525">.</span><span class="ident" id="6021526">Lock</span><span class="op" id="6021530">(</span><span class="op" id="6021531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021534">defer</span>&nbsp;<span class="ident" id="6021540">p</span><span class="op" id="6021541">.</span><span class="ident" id="6021542">mu</span><span class="op" id="6021544">.</span><span class="ident" id="6021545">Unlock</span><span class="op" id="6021551">(</span><span class="op" id="6021552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021555">if</span>&nbsp;<span class="ident" id="6021558">p</span><span class="op" id="6021559">.</span><span class="ident" id="6021560">m</span><span class="op" id="6021561">[</span><span class="ident" id="6021562">value</span><span class="op" id="6021567">]</span>&nbsp;<span class="op" id="6021569">!=</span>&nbsp;<span class="ident" id="6021572">nil</span>&nbsp;<span class="op" id="6021576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6021580">panic</span><span class="op" id="6021585">(</span><span class="string" id="6021586">&#34;pprof:&nbsp;Profile.Add&nbsp;of&nbsp;duplicate&nbsp;value&#34;</span><span class="op" id="6021625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021628">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021631">p</span><span class="op" id="6021632">.</span><span class="ident" id="6021633">m</span><span class="op" id="6021634">[</span><span class="ident" id="6021635">value</span><span class="op" id="6021640">]</span>&nbsp;<span class="op" id="6021642">=</span>&nbsp;<span class="ident" id="6021644">stk</span><span class="op" id="6021647">[</span><span class="op" id="6021648">:</span><span class="ident" id="6021649">n</span><span class="op" id="6021650">]</span><br>
<span class="lineno"></span><span class="op" id="6021652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6021655">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;execution&nbsp;stack&nbsp;associated&nbsp;with&nbsp;value&nbsp;from&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="6021733">//&nbsp;It&nbsp;is&nbsp;a&nbsp;no-op&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno">205</span><span class="keyword" id="6021786">func</span>&nbsp;<span class="op" id="6021791">(</span><span class="ident" id="6021792">p</span>&nbsp;<span class="op" id="6021794">*</span><span class="ident" id="6021795">Profile</span><span class="op" id="6021802">)</span>&nbsp;<span class="ident" id="6021804">Remove</span><span class="op" id="6021810">(</span><span class="ident" id="6021811">value</span>&nbsp;<span class="keyword" id="6021817">interface</span><span class="op" id="6021826">{</span><span class="op" id="6021827">}</span><span class="op" id="6021828">)</span>&nbsp;<span class="op" id="6021830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021833">p</span><span class="op" id="6021834">.</span><span class="ident" id="6021835">mu</span><span class="op" id="6021837">.</span><span class="ident" id="6021838">Lock</span><span class="op" id="6021842">(</span><span class="op" id="6021843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021846">defer</span>&nbsp;<span class="ident" id="6021852">p</span><span class="op" id="6021853">.</span><span class="ident" id="6021854">mu</span><span class="op" id="6021856">.</span><span class="ident" id="6021857">Unlock</span><span class="op" id="6021863">(</span><span class="op" id="6021864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6021867">delete</span><span class="op" id="6021873">(</span><span class="ident" id="6021874">p</span><span class="op" id="6021875">.</span><span class="ident" id="6021876">m</span><span class="op" id="6021877">,</span>&nbsp;<span class="ident" id="6021879">value</span><span class="op" id="6021884">)</span><br>
<span class="lineno"></span><span class="op" id="6021886">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="comment" id="6021889">//&nbsp;WriteTo&nbsp;writes&nbsp;a&nbsp;pprof-formatted&nbsp;snapshot&nbsp;of&nbsp;the&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="6021955">//&nbsp;If&nbsp;a&nbsp;write&nbsp;to&nbsp;w&nbsp;returns&nbsp;an&nbsp;error,&nbsp;WriteTo&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="6022020">//&nbsp;Otherwise,&nbsp;WriteTo&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="6022055">//</span><br>
<span class="lineno">215</span><span class="comment" id="6022058">//&nbsp;The&nbsp;debug&nbsp;parameter&nbsp;enables&nbsp;additional&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6022108">//&nbsp;Passing&nbsp;debug=0&nbsp;prints&nbsp;only&nbsp;the&nbsp;hexadecimal&nbsp;addresses&nbsp;that&nbsp;pprof&nbsp;needs.</span><br>
<span class="lineno"></span><span class="comment" id="6022183">//&nbsp;Passing&nbsp;debug=1&nbsp;adds&nbsp;comments&nbsp;translating&nbsp;addresses&nbsp;to&nbsp;function&nbsp;names</span><br>
<span class="lineno"></span><span class="comment" id="6022256">//&nbsp;and&nbsp;line&nbsp;numbers,&nbsp;so&nbsp;that&nbsp;a&nbsp;programmer&nbsp;can&nbsp;read&nbsp;the&nbsp;profile&nbsp;without&nbsp;tools.</span><br>
<span class="lineno"></span><span class="comment" id="6022334">//</span><br>
<span class="lineno">220</span><span class="comment" id="6022337">//&nbsp;The&nbsp;predefined&nbsp;profiles&nbsp;may&nbsp;assign&nbsp;meaning&nbsp;to&nbsp;other&nbsp;debug&nbsp;values;</span><br>
<span class="lineno"></span><span class="comment" id="6022406">//&nbsp;for&nbsp;example,&nbsp;when&nbsp;printing&nbsp;the&nbsp;&#34;goroutine&#34;&nbsp;profile,&nbsp;debug=2&nbsp;means&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6022478">//&nbsp;print&nbsp;the&nbsp;goroutine&nbsp;stacks&nbsp;in&nbsp;the&nbsp;same&nbsp;form&nbsp;that&nbsp;a&nbsp;Go&nbsp;program&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="6022548">//&nbsp;when&nbsp;dying&nbsp;due&nbsp;to&nbsp;an&nbsp;unrecovered&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="6022591">func</span>&nbsp;<span class="op" id="6022596">(</span><span class="ident" id="6022597">p</span>&nbsp;<span class="op" id="6022599">*</span><span class="ident" id="6022600">Profile</span><span class="op" id="6022607">)</span>&nbsp;<span class="ident" id="6022609">WriteTo</span><span class="op" id="6022616">(</span><span class="ident" id="6022617">w</span>&nbsp;<span class="ident" id="6022619">io</span><span class="op" id="6022621">.</span><span class="ident" id="6022622">Writer</span><span class="op" id="6022628">,</span>&nbsp;<span class="ident" id="6022630">debug</span>&nbsp;<span class="builtintype" id="6022636">int</span><span class="op" id="6022639">)</span>&nbsp;<span class="builtintype" id="6022641">error</span>&nbsp;<span class="op" id="6022647">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022650">if</span>&nbsp;<span class="ident" id="6022653">p</span><span class="op" id="6022654">.</span><span class="ident" id="6022655">name</span>&nbsp;<span class="op" id="6022660">==</span>&nbsp;<span class="string" id="6022663">&#34;&#34;</span>&nbsp;<span class="op" id="6022666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6022670">panic</span><span class="op" id="6022675">(</span><span class="string" id="6022676">&#34;pprof:&nbsp;use&nbsp;of&nbsp;zero&nbsp;Profile&#34;</span><span class="op" id="6022704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022710">if</span>&nbsp;<span class="ident" id="6022713">p</span><span class="op" id="6022714">.</span><span class="ident" id="6022715">write</span>&nbsp;<span class="op" id="6022721">!=</span>&nbsp;<span class="ident" id="6022724">nil</span>&nbsp;<span class="op" id="6022728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022732">return</span>&nbsp;<span class="ident" id="6022739">p</span><span class="op" id="6022740">.</span><span class="ident" id="6022741">write</span><span class="op" id="6022746">(</span><span class="ident" id="6022747">w</span><span class="op" id="6022748">,</span>&nbsp;<span class="ident" id="6022750">debug</span><span class="op" id="6022755">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022762">//&nbsp;Obtain&nbsp;consistent&nbsp;snapshot&nbsp;under&nbsp;lock;&nbsp;then&nbsp;process&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022832">var</span>&nbsp;<span class="ident" id="6022836">all</span>&nbsp;<span class="op" id="6022840">[</span><span class="op" id="6022841">]</span><span class="op" id="6022842">[</span><span class="op" id="6022843">]</span><span class="builtintype" id="6022844">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022853">p</span><span class="op" id="6022854">.</span><span class="ident" id="6022855">mu</span><span class="op" id="6022857">.</span><span class="ident" id="6022858">Lock</span><span class="op" id="6022862">(</span><span class="op" id="6022863">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022866">for</span>&nbsp;<span class="ident" id="6022870">_</span><span class="op" id="6022871">,</span>&nbsp;<span class="ident" id="6022873">stk</span>&nbsp;<span class="op" id="6022877">:=</span>&nbsp;<span class="keyword" id="6022880">range</span>&nbsp;<span class="ident" id="6022886">p</span><span class="op" id="6022887">.</span><span class="ident" id="6022888">m</span>&nbsp;<span class="op" id="6022890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022894">all</span>&nbsp;<span class="op" id="6022898">=</span>&nbsp;<span class="builtinfunc" id="6022900">append</span><span class="op" id="6022906">(</span><span class="ident" id="6022907">all</span><span class="op" id="6022910">,</span>&nbsp;<span class="ident" id="6022912">stk</span><span class="op" id="6022915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022921">p</span><span class="op" id="6022922">.</span><span class="ident" id="6022923">mu</span><span class="op" id="6022925">.</span><span class="ident" id="6022926">Unlock</span><span class="op" id="6022932">(</span><span class="op" id="6022933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022937">//&nbsp;Map&nbsp;order&nbsp;is&nbsp;non-deterministic;&nbsp;make&nbsp;output&nbsp;deterministic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023000">sort</span><span class="op" id="6023004">.</span><span class="ident" id="6023005">Sort</span><span class="op" id="6023009">(</span><span class="ident" id="6023010">stackProfile</span><span class="op" id="6023022">(</span><span class="ident" id="6023023">all</span><span class="op" id="6023026">)</span><span class="op" id="6023027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023031">return</span>&nbsp;<span class="ident" id="6023038">printCountProfile</span><span class="op" id="6023055">(</span><span class="ident" id="6023056">w</span><span class="op" id="6023057">,</span>&nbsp;<span class="ident" id="6023059">debug</span><span class="op" id="6023064">,</span>&nbsp;<span class="ident" id="6023066">p</span><span class="op" id="6023067">.</span><span class="ident" id="6023068">name</span><span class="op" id="6023072">,</span>&nbsp;<span class="ident" id="6023074">stackProfile</span><span class="op" id="6023086">(</span><span class="ident" id="6023087">all</span><span class="op" id="6023090">)</span><span class="op" id="6023091">)</span><br>
<span class="lineno"></span><span class="op" id="6023093">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="6023096">type</span>&nbsp;<span class="ident" id="6023101">stackProfile</span>&nbsp;<span class="op" id="6023114">[</span><span class="op" id="6023115">]</span><span class="op" id="6023116">[</span><span class="op" id="6023117">]</span><span class="builtintype" id="6023118">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6023127">func</span>&nbsp;<span class="op" id="6023132">(</span><span class="ident" id="6023133">x</span>&nbsp;<span class="ident" id="6023135">stackProfile</span><span class="op" id="6023147">)</span>&nbsp;<span class="ident" id="6023149">Len</span><span class="op" id="6023152">(</span><span class="op" id="6023153">)</span>&nbsp;<span class="builtintype" id="6023155">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023172">{</span>&nbsp;<span class="keyword" id="6023174">return</span>&nbsp;<span class="builtinfunc" id="6023181">len</span><span class="op" id="6023184">(</span><span class="ident" id="6023185">x</span><span class="op" id="6023186">)</span>&nbsp;<span class="op" id="6023188">}</span><br>
<span class="lineno"></span><span class="keyword" id="6023190">func</span>&nbsp;<span class="op" id="6023195">(</span><span class="ident" id="6023196">x</span>&nbsp;<span class="ident" id="6023198">stackProfile</span><span class="op" id="6023210">)</span>&nbsp;<span class="ident" id="6023212">Stack</span><span class="op" id="6023217">(</span><span class="ident" id="6023218">i</span>&nbsp;<span class="builtintype" id="6023220">int</span><span class="op" id="6023223">)</span>&nbsp;<span class="op" id="6023225">[</span><span class="op" id="6023226">]</span><span class="builtintype" id="6023227">uintptr</span>&nbsp;<span class="op" id="6023235">{</span>&nbsp;<span class="keyword" id="6023237">return</span>&nbsp;<span class="ident" id="6023244">x</span><span class="op" id="6023245">[</span><span class="ident" id="6023246">i</span><span class="op" id="6023247">]</span>&nbsp;<span class="op" id="6023249">}</span><br>
<span class="lineno">250</span><span class="keyword" id="6023251">func</span>&nbsp;<span class="op" id="6023256">(</span><span class="ident" id="6023257">x</span>&nbsp;<span class="ident" id="6023259">stackProfile</span><span class="op" id="6023271">)</span>&nbsp;<span class="ident" id="6023273">Swap</span><span class="op" id="6023277">(</span><span class="ident" id="6023278">i</span><span class="op" id="6023279">,</span>&nbsp;<span class="ident" id="6023281">j</span>&nbsp;<span class="builtintype" id="6023283">int</span><span class="op" id="6023286">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023296">{</span>&nbsp;<span class="ident" id="6023298">x</span><span class="op" id="6023299">[</span><span class="ident" id="6023300">i</span><span class="op" id="6023301">]</span><span class="op" id="6023302">,</span>&nbsp;<span class="ident" id="6023304">x</span><span class="op" id="6023305">[</span><span class="ident" id="6023306">j</span><span class="op" id="6023307">]</span>&nbsp;<span class="op" id="6023309">=</span>&nbsp;<span class="ident" id="6023311">x</span><span class="op" id="6023312">[</span><span class="ident" id="6023313">j</span><span class="op" id="6023314">]</span><span class="op" id="6023315">,</span>&nbsp;<span class="ident" id="6023317">x</span><span class="op" id="6023318">[</span><span class="ident" id="6023319">i</span><span class="op" id="6023320">]</span>&nbsp;<span class="op" id="6023322">}</span><br>
<span class="lineno"></span><span class="keyword" id="6023324">func</span>&nbsp;<span class="op" id="6023329">(</span><span class="ident" id="6023330">x</span>&nbsp;<span class="ident" id="6023332">stackProfile</span><span class="op" id="6023344">)</span>&nbsp;<span class="ident" id="6023346">Less</span><span class="op" id="6023350">(</span><span class="ident" id="6023351">i</span><span class="op" id="6023352">,</span>&nbsp;<span class="ident" id="6023354">j</span>&nbsp;<span class="builtintype" id="6023356">int</span><span class="op" id="6023359">)</span>&nbsp;<span class="builtintype" id="6023361">bool</span>&nbsp;<span class="op" id="6023366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023369">t</span><span class="op" id="6023370">,</span>&nbsp;<span class="ident" id="6023372">u</span>&nbsp;<span class="op" id="6023374">:=</span>&nbsp;<span class="ident" id="6023377">x</span><span class="op" id="6023378">[</span><span class="ident" id="6023379">i</span><span class="op" id="6023380">]</span><span class="op" id="6023381">,</span>&nbsp;<span class="ident" id="6023383">x</span><span class="op" id="6023384">[</span><span class="ident" id="6023385">j</span><span class="op" id="6023386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023389">for</span>&nbsp;<span class="ident" id="6023393">k</span>&nbsp;<span class="op" id="6023395">:=</span>&nbsp;<span class="num" id="6023398">0</span><span class="op" id="6023399">;</span>&nbsp;<span class="ident" id="6023401">k</span>&nbsp;<span class="op" id="6023403">&lt;</span>&nbsp;<span class="builtinfunc" id="6023405">len</span><span class="op" id="6023408">(</span><span class="ident" id="6023409">t</span><span class="op" id="6023410">)</span>&nbsp;<span class="op" id="6023412">&amp;&amp;</span>&nbsp;<span class="ident" id="6023415">k</span>&nbsp;<span class="op" id="6023417">&lt;</span>&nbsp;<span class="builtinfunc" id="6023419">len</span><span class="op" id="6023422">(</span><span class="ident" id="6023423">u</span><span class="op" id="6023424">)</span><span class="op" id="6023425">;</span>&nbsp;<span class="ident" id="6023427">k</span><span class="op" id="6023428">++</span>&nbsp;<span class="op" id="6023431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023435">if</span>&nbsp;<span class="ident" id="6023438">t</span><span class="op" id="6023439">[</span><span class="ident" id="6023440">k</span><span class="op" id="6023441">]</span>&nbsp;<span class="op" id="6023443">!=</span>&nbsp;<span class="ident" id="6023446">u</span><span class="op" id="6023447">[</span><span class="ident" id="6023448">k</span><span class="op" id="6023449">]</span>&nbsp;<span class="op" id="6023451">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023456">return</span>&nbsp;<span class="ident" id="6023463">t</span><span class="op" id="6023464">[</span><span class="ident" id="6023465">k</span><span class="op" id="6023466">]</span>&nbsp;<span class="op" id="6023468">&lt;</span>&nbsp;<span class="ident" id="6023470">u</span><span class="op" id="6023471">[</span><span class="ident" id="6023472">k</span><span class="op" id="6023473">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023483">return</span>&nbsp;<span class="builtinfunc" id="6023490">len</span><span class="op" id="6023493">(</span><span class="ident" id="6023494">t</span><span class="op" id="6023495">)</span>&nbsp;<span class="op" id="6023497">&lt;</span>&nbsp;<span class="builtinfunc" id="6023499">len</span><span class="op" id="6023502">(</span><span class="ident" id="6023503">u</span><span class="op" id="6023504">)</span><br>
<span class="lineno"></span><span class="op" id="6023506">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="6023509">//&nbsp;A&nbsp;countProfile&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;stack&nbsp;traces&nbsp;to&nbsp;be&nbsp;printed&nbsp;as&nbsp;counts</span><br>
<span class="lineno"></span><span class="comment" id="6023576">//&nbsp;grouped&nbsp;by&nbsp;stack&nbsp;trace.&nbsp;&nbsp;There&nbsp;are&nbsp;multiple&nbsp;implementations:</span><br>
<span class="lineno"></span><span class="comment" id="6023640">//&nbsp;all&nbsp;that&nbsp;matters&nbsp;is&nbsp;that&nbsp;we&nbsp;can&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;traces&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6023710">//&nbsp;and&nbsp;obtain&nbsp;each&nbsp;trace&nbsp;in&nbsp;turn.</span><br>
<span class="lineno">265</span><span class="keyword" id="6023744">type</span>&nbsp;<span class="ident" id="6023749">countProfile</span>&nbsp;<span class="keyword" id="6023762">interface</span>&nbsp;<span class="op" id="6023772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023775">Len</span><span class="op" id="6023778">(</span><span class="op" id="6023779">)</span>&nbsp;<span class="builtintype" id="6023781">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023786">Stack</span><span class="op" id="6023791">(</span><span class="ident" id="6023792">i</span>&nbsp;<span class="builtintype" id="6023794">int</span><span class="op" id="6023797">)</span>&nbsp;<span class="op" id="6023799">[</span><span class="op" id="6023800">]</span><span class="builtintype" id="6023801">uintptr</span><br>
<span class="lineno"></span><span class="op" id="6023809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6023812">//&nbsp;printCountProfile&nbsp;prints&nbsp;a&nbsp;countProfile&nbsp;at&nbsp;the&nbsp;specified&nbsp;debug&nbsp;level.</span><br>
<span class="lineno"></span><span class="keyword" id="6023885">func</span>&nbsp;<span class="ident" id="6023890">printCountProfile</span><span class="op" id="6023907">(</span><span class="ident" id="6023908">w</span>&nbsp;<span class="ident" id="6023910">io</span><span class="op" id="6023912">.</span><span class="ident" id="6023913">Writer</span><span class="op" id="6023919">,</span>&nbsp;<span class="ident" id="6023921">debug</span>&nbsp;<span class="builtintype" id="6023927">int</span><span class="op" id="6023930">,</span>&nbsp;<span class="ident" id="6023932">name</span>&nbsp;<span class="builtintype" id="6023937">string</span><span class="op" id="6023943">,</span>&nbsp;<span class="ident" id="6023945">p</span>&nbsp;<span class="ident" id="6023947">countProfile</span><span class="op" id="6023959">)</span>&nbsp;<span class="builtintype" id="6023961">error</span>&nbsp;<span class="op" id="6023967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023970">b</span>&nbsp;<span class="op" id="6023972">:=</span>&nbsp;<span class="ident" id="6023975">bufio</span><span class="op" id="6023980">.</span><span class="ident" id="6023981">NewWriter</span><span class="op" id="6023990">(</span><span class="ident" id="6023991">w</span><span class="op" id="6023992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023995">var</span>&nbsp;<span class="ident" id="6023999">tw</span>&nbsp;<span class="op" id="6024002">*</span><span class="ident" id="6024003">tabwriter</span><span class="op" id="6024012">.</span><span class="ident" id="6024013">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024021">w</span>&nbsp;<span class="op" id="6024023">=</span>&nbsp;<span class="ident" id="6024025">b</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024028">if</span>&nbsp;<span class="ident" id="6024031">debug</span>&nbsp;<span class="op" id="6024037">&gt;</span>&nbsp;<span class="num" id="6024039">0</span>&nbsp;<span class="op" id="6024041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024045">tw</span>&nbsp;<span class="op" id="6024048">=</span>&nbsp;<span class="ident" id="6024050">tabwriter</span><span class="op" id="6024059">.</span><span class="ident" id="6024060">NewWriter</span><span class="op" id="6024069">(</span><span class="ident" id="6024070">w</span><span class="op" id="6024071">,</span>&nbsp;<span class="num" id="6024073">1</span><span class="op" id="6024074">,</span>&nbsp;<span class="num" id="6024076">8</span><span class="op" id="6024077">,</span>&nbsp;<span class="num" id="6024079">1</span><span class="op" id="6024080">,</span>&nbsp;<span class="string" id="6024082">&#39;\t&#39;</span><span class="op" id="6024086">,</span>&nbsp;<span class="num" id="6024088">0</span><span class="op" id="6024089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024093">w</span>&nbsp;<span class="op" id="6024095">=</span>&nbsp;<span class="ident" id="6024097">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024105">fmt</span><span class="op" id="6024108">.</span><span class="ident" id="6024109">Fprintf</span><span class="op" id="6024116">(</span><span class="ident" id="6024117">w</span><span class="op" id="6024118">,</span>&nbsp;<span class="string" id="6024120">&#34;%s&nbsp;profile:&nbsp;total&nbsp;%d\n&#34;</span><span class="op" id="6024144">,</span>&nbsp;<span class="ident" id="6024146">name</span><span class="op" id="6024150">,</span>&nbsp;<span class="ident" id="6024152">p</span><span class="op" id="6024153">.</span><span class="ident" id="6024154">Len</span><span class="op" id="6024157">(</span><span class="op" id="6024158">)</span><span class="op" id="6024159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024163">//&nbsp;Build&nbsp;count&nbsp;of&nbsp;each&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024194">var</span>&nbsp;<span class="ident" id="6024198">buf</span>&nbsp;<span class="ident" id="6024202">bytes</span><span class="op" id="6024207">.</span><span class="ident" id="6024208">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024216">key</span>&nbsp;<span class="op" id="6024220">:=</span>&nbsp;<span class="keyword" id="6024223">func</span><span class="op" id="6024227">(</span><span class="ident" id="6024228">stk</span>&nbsp;<span class="op" id="6024232">[</span><span class="op" id="6024233">]</span><span class="builtintype" id="6024234">uintptr</span><span class="op" id="6024241">)</span>&nbsp;<span class="builtintype" id="6024243">string</span>&nbsp;<span class="op" id="6024250">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024254">buf</span><span class="op" id="6024257">.</span><span class="ident" id="6024258">Reset</span><span class="op" id="6024263">(</span><span class="op" id="6024264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024268">fmt</span><span class="op" id="6024271">.</span><span class="ident" id="6024272">Fprintf</span><span class="op" id="6024279">(</span><span class="op" id="6024280">&amp;</span><span class="ident" id="6024281">buf</span><span class="op" id="6024284">,</span>&nbsp;<span class="string" id="6024286">&#34;@&#34;</span><span class="op" id="6024289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024293">for</span>&nbsp;<span class="ident" id="6024297">_</span><span class="op" id="6024298">,</span>&nbsp;<span class="ident" id="6024300">pc</span>&nbsp;<span class="op" id="6024303">:=</span>&nbsp;<span class="keyword" id="6024306">range</span>&nbsp;<span class="ident" id="6024312">stk</span>&nbsp;<span class="op" id="6024316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024321">fmt</span><span class="op" id="6024324">.</span><span class="ident" id="6024325">Fprintf</span><span class="op" id="6024332">(</span><span class="op" id="6024333">&amp;</span><span class="ident" id="6024334">buf</span><span class="op" id="6024337">,</span>&nbsp;<span class="string" id="6024339">&#34;&nbsp;%#x&#34;</span><span class="op" id="6024345">,</span>&nbsp;<span class="ident" id="6024347">pc</span><span class="op" id="6024349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024353">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024357">return</span>&nbsp;<span class="ident" id="6024364">buf</span><span class="op" id="6024367">.</span><span class="ident" id="6024368">String</span><span class="op" id="6024374">(</span><span class="op" id="6024375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024381">m</span>&nbsp;<span class="op" id="6024383">:=</span>&nbsp;<span class="keyword" id="6024386">map</span><span class="op" id="6024389">[</span><span class="builtintype" id="6024390">string</span><span class="op" id="6024396">]</span><span class="builtintype" id="6024397">int</span><span class="op" id="6024400">{</span><span class="op" id="6024401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024404">n</span>&nbsp;<span class="op" id="6024406">:=</span>&nbsp;<span class="ident" id="6024409">p</span><span class="op" id="6024410">.</span><span class="ident" id="6024411">Len</span><span class="op" id="6024414">(</span><span class="op" id="6024415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024418">for</span>&nbsp;<span class="ident" id="6024422">i</span>&nbsp;<span class="op" id="6024424">:=</span>&nbsp;<span class="num" id="6024427">0</span><span class="op" id="6024428">;</span>&nbsp;<span class="ident" id="6024430">i</span>&nbsp;<span class="op" id="6024432">&lt;</span>&nbsp;<span class="ident" id="6024434">n</span><span class="op" id="6024435">;</span>&nbsp;<span class="ident" id="6024437">i</span><span class="op" id="6024438">++</span>&nbsp;<span class="op" id="6024441">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024445">m</span><span class="op" id="6024446">[</span><span class="ident" id="6024447">key</span><span class="op" id="6024450">(</span><span class="ident" id="6024451">p</span><span class="op" id="6024452">.</span><span class="ident" id="6024453">Stack</span><span class="op" id="6024458">(</span><span class="ident" id="6024459">i</span><span class="op" id="6024460">)</span><span class="op" id="6024461">)</span><span class="op" id="6024462">]</span><span class="op" id="6024463">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024471">//&nbsp;Print&nbsp;stacks,&nbsp;listing&nbsp;count&nbsp;on&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;a&nbsp;unique&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024542">for</span>&nbsp;<span class="ident" id="6024546">i</span>&nbsp;<span class="op" id="6024548">:=</span>&nbsp;<span class="num" id="6024551">0</span><span class="op" id="6024552">;</span>&nbsp;<span class="ident" id="6024554">i</span>&nbsp;<span class="op" id="6024556">&lt;</span>&nbsp;<span class="ident" id="6024558">n</span><span class="op" id="6024559">;</span>&nbsp;<span class="ident" id="6024561">i</span><span class="op" id="6024562">++</span>&nbsp;<span class="op" id="6024565">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024569">stk</span>&nbsp;<span class="op" id="6024573">:=</span>&nbsp;<span class="ident" id="6024576">p</span><span class="op" id="6024577">.</span><span class="ident" id="6024578">Stack</span><span class="op" id="6024583">(</span><span class="ident" id="6024584">i</span><span class="op" id="6024585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024589">s</span>&nbsp;<span class="op" id="6024591">:=</span>&nbsp;<span class="ident" id="6024594">key</span><span class="op" id="6024597">(</span><span class="ident" id="6024598">stk</span><span class="op" id="6024601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024605">if</span>&nbsp;<span class="ident" id="6024608">count</span>&nbsp;<span class="op" id="6024614">:=</span>&nbsp;<span class="ident" id="6024617">m</span><span class="op" id="6024618">[</span><span class="ident" id="6024619">s</span><span class="op" id="6024620">]</span><span class="op" id="6024621">;</span>&nbsp;<span class="ident" id="6024623">count</span>&nbsp;<span class="op" id="6024629">!=</span>&nbsp;<span class="num" id="6024632">0</span>&nbsp;<span class="op" id="6024634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024639">fmt</span><span class="op" id="6024642">.</span><span class="ident" id="6024643">Fprintf</span><span class="op" id="6024650">(</span><span class="ident" id="6024651">w</span><span class="op" id="6024652">,</span>&nbsp;<span class="string" id="6024654">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6024663">,</span>&nbsp;<span class="ident" id="6024665">count</span><span class="op" id="6024670">,</span>&nbsp;<span class="ident" id="6024672">s</span><span class="op" id="6024673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024678">if</span>&nbsp;<span class="ident" id="6024681">debug</span>&nbsp;<span class="op" id="6024687">&gt;</span>&nbsp;<span class="num" id="6024689">0</span>&nbsp;<span class="op" id="6024691">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024697">printStackRecord</span><span class="op" id="6024713">(</span><span class="ident" id="6024714">w</span><span class="op" id="6024715">,</span>&nbsp;<span class="ident" id="6024717">stk</span><span class="op" id="6024720">,</span>&nbsp;<span class="builtintype" id="6024722">false</span><span class="op" id="6024727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6024737">delete</span><span class="op" id="6024743">(</span><span class="ident" id="6024744">m</span><span class="op" id="6024745">,</span>&nbsp;<span class="ident" id="6024747">s</span><span class="op" id="6024748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024755">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024759">if</span>&nbsp;<span class="ident" id="6024762">tw</span>&nbsp;<span class="op" id="6024765">!=</span>&nbsp;<span class="ident" id="6024768">nil</span>&nbsp;<span class="op" id="6024772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024776">tw</span><span class="op" id="6024778">.</span><span class="ident" id="6024779">Flush</span><span class="op" id="6024784">(</span><span class="op" id="6024785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024791">return</span>&nbsp;<span class="ident" id="6024798">b</span><span class="op" id="6024799">.</span><span class="ident" id="6024800">Flush</span><span class="op" id="6024805">(</span><span class="op" id="6024806">)</span><br>
<span class="lineno">315</span><span class="op" id="6024808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6024811">//&nbsp;printStackRecord&nbsp;prints&nbsp;the&nbsp;function&nbsp;+&nbsp;source&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="6024877">//&nbsp;for&nbsp;a&nbsp;single&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span><span class="keyword" id="6024906">func</span>&nbsp;<span class="ident" id="6024911">printStackRecord</span><span class="op" id="6024927">(</span><span class="ident" id="6024928">w</span>&nbsp;<span class="ident" id="6024930">io</span><span class="op" id="6024932">.</span><span class="ident" id="6024933">Writer</span><span class="op" id="6024939">,</span>&nbsp;<span class="ident" id="6024941">stk</span>&nbsp;<span class="op" id="6024945">[</span><span class="op" id="6024946">]</span><span class="builtintype" id="6024947">uintptr</span><span class="op" id="6024954">,</span>&nbsp;<span class="ident" id="6024956">allFrames</span>&nbsp;<span class="builtintype" id="6024966">bool</span><span class="op" id="6024970">)</span>&nbsp;<span class="op" id="6024972">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024975">show</span>&nbsp;<span class="op" id="6024980">:=</span>&nbsp;<span class="ident" id="6024983">allFrames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024994">wasPanic</span>&nbsp;<span class="op" id="6025003">:=</span>&nbsp;<span class="builtintype" id="6025006">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025013">for</span>&nbsp;<span class="ident" id="6025017">i</span><span class="op" id="6025018">,</span>&nbsp;<span class="ident" id="6025020">pc</span>&nbsp;<span class="op" id="6025023">:=</span>&nbsp;<span class="keyword" id="6025026">range</span>&nbsp;<span class="ident" id="6025032">stk</span>&nbsp;<span class="op" id="6025036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025040">f</span>&nbsp;<span class="op" id="6025042">:=</span>&nbsp;<span class="ident" id="6025045">runtime</span><span class="op" id="6025052">.</span><span class="ident" id="6025053">FuncForPC</span><span class="op" id="6025062">(</span><span class="ident" id="6025063">pc</span><span class="op" id="6025065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025069">if</span>&nbsp;<span class="ident" id="6025072">f</span>&nbsp;<span class="op" id="6025074">==</span>&nbsp;<span class="ident" id="6025077">nil</span>&nbsp;<span class="op" id="6025081">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025086">show</span>&nbsp;<span class="op" id="6025091">=</span>&nbsp;<span class="builtintype" id="6025093">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025101">fmt</span><span class="op" id="6025104">.</span><span class="ident" id="6025105">Fprintf</span><span class="op" id="6025112">(</span><span class="ident" id="6025113">w</span><span class="op" id="6025114">,</span>&nbsp;<span class="string" id="6025116">&#34;#\t%#x\n&#34;</span><span class="op" id="6025126">,</span>&nbsp;<span class="ident" id="6025128">pc</span><span class="op" id="6025130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025135">wasPanic</span>&nbsp;<span class="op" id="6025144">=</span>&nbsp;<span class="builtintype" id="6025146">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025154">}</span>&nbsp;<span class="keyword" id="6025156">else</span>&nbsp;<span class="op" id="6025161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025166">tracepc</span>&nbsp;<span class="op" id="6025174">:=</span>&nbsp;<span class="ident" id="6025177">pc</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025183">//&nbsp;Back&nbsp;up&nbsp;to&nbsp;call&nbsp;instruction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025218">if</span>&nbsp;<span class="ident" id="6025221">i</span>&nbsp;<span class="op" id="6025223">&gt;</span>&nbsp;<span class="num" id="6025225">0</span>&nbsp;<span class="op" id="6025227">&amp;&amp;</span>&nbsp;<span class="ident" id="6025230">pc</span>&nbsp;<span class="op" id="6025233">&gt;</span>&nbsp;<span class="ident" id="6025235">f</span><span class="op" id="6025236">.</span><span class="ident" id="6025237">Entry</span><span class="op" id="6025242">(</span><span class="op" id="6025243">)</span>&nbsp;<span class="op" id="6025245">&amp;&amp;</span>&nbsp;<span class="op" id="6025248">!</span><span class="ident" id="6025249">wasPanic</span>&nbsp;<span class="op" id="6025258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025264">if</span>&nbsp;<span class="ident" id="6025267">runtime</span><span class="op" id="6025274">.</span><span class="ident" id="6025275">GOARCH</span>&nbsp;<span class="op" id="6025282">==</span>&nbsp;<span class="string" id="6025285">&#34;386&#34;</span>&nbsp;<span class="op" id="6025291">||</span>&nbsp;<span class="ident" id="6025294">runtime</span><span class="op" id="6025301">.</span><span class="ident" id="6025302">GOARCH</span>&nbsp;<span class="op" id="6025309">==</span>&nbsp;<span class="string" id="6025312">&#34;amd64&#34;</span>&nbsp;<span class="op" id="6025320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025327">tracepc</span><span class="op" id="6025334">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025341">}</span>&nbsp;<span class="keyword" id="6025343">else</span>&nbsp;<span class="op" id="6025348">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025355">tracepc</span>&nbsp;<span class="op" id="6025363">-=</span>&nbsp;<span class="num" id="6025366">4</span>&nbsp;<span class="comment" id="6025368">//&nbsp;arm,&nbsp;etc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025394">file</span><span class="op" id="6025398">,</span>&nbsp;<span class="ident" id="6025400">line</span>&nbsp;<span class="op" id="6025405">:=</span>&nbsp;<span class="ident" id="6025408">f</span><span class="op" id="6025409">.</span><span class="ident" id="6025410">FileLine</span><span class="op" id="6025418">(</span><span class="ident" id="6025419">tracepc</span><span class="op" id="6025426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025431">name</span>&nbsp;<span class="op" id="6025436">:=</span>&nbsp;<span class="ident" id="6025439">f</span><span class="op" id="6025440">.</span><span class="ident" id="6025441">Name</span><span class="op" id="6025445">(</span><span class="op" id="6025446">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025451">//&nbsp;Hide&nbsp;runtime.goexit&nbsp;and&nbsp;any&nbsp;runtime&nbsp;functions&nbsp;at&nbsp;the&nbsp;beginning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025521">//&nbsp;This&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;allocation&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025572">wasPanic</span>&nbsp;<span class="op" id="6025581">=</span>&nbsp;<span class="ident" id="6025583">name</span>&nbsp;<span class="op" id="6025588">==</span>&nbsp;<span class="string" id="6025591">&#34;runtime.panic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025610">if</span>&nbsp;<span class="ident" id="6025613">name</span>&nbsp;<span class="op" id="6025618">==</span>&nbsp;<span class="string" id="6025621">&#34;runtime.goexit&#34;</span>&nbsp;<span class="op" id="6025638">||</span>&nbsp;<span class="op" id="6025641">!</span><span class="ident" id="6025642">show</span>&nbsp;<span class="op" id="6025647">&amp;&amp;</span>&nbsp;<span class="ident" id="6025650">strings</span><span class="op" id="6025657">.</span><span class="ident" id="6025658">HasPrefix</span><span class="op" id="6025667">(</span><span class="ident" id="6025668">name</span><span class="op" id="6025672">,</span>&nbsp;<span class="string" id="6025674">&#34;runtime.&#34;</span><span class="op" id="6025684">)</span>&nbsp;<span class="op" id="6025686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025692">continue</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025709">show</span>&nbsp;<span class="op" id="6025714">=</span>&nbsp;<span class="builtintype" id="6025716">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025724">fmt</span><span class="op" id="6025727">.</span><span class="ident" id="6025728">Fprintf</span><span class="op" id="6025735">(</span><span class="ident" id="6025736">w</span><span class="op" id="6025737">,</span>&nbsp;<span class="string" id="6025739">&#34;#\t%#x\t%s+%#x\t%s:%d\n&#34;</span><span class="op" id="6025764">,</span>&nbsp;<span class="ident" id="6025766">pc</span><span class="op" id="6025768">,</span>&nbsp;<span class="ident" id="6025770">name</span><span class="op" id="6025774">,</span>&nbsp;<span class="ident" id="6025776">pc</span><span class="op" id="6025778">-</span><span class="ident" id="6025779">f</span><span class="op" id="6025780">.</span><span class="ident" id="6025781">Entry</span><span class="op" id="6025786">(</span><span class="op" id="6025787">)</span><span class="op" id="6025788">,</span>&nbsp;<span class="ident" id="6025790">file</span><span class="op" id="6025794">,</span>&nbsp;<span class="ident" id="6025796">line</span><span class="op" id="6025800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025807">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025810">if</span>&nbsp;<span class="op" id="6025813">!</span><span class="ident" id="6025814">show</span>&nbsp;<span class="op" id="6025819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025823">//&nbsp;We&nbsp;didn&#39;t&nbsp;print&nbsp;anything;&nbsp;do&nbsp;it&nbsp;again,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025867">//&nbsp;and&nbsp;this&nbsp;time&nbsp;include&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025913">printStackRecord</span><span class="op" id="6025929">(</span><span class="ident" id="6025930">w</span><span class="op" id="6025931">,</span>&nbsp;<span class="ident" id="6025933">stk</span><span class="op" id="6025936">,</span>&nbsp;<span class="builtintype" id="6025938">true</span><span class="op" id="6025942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025946">return</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025957">fmt</span><span class="op" id="6025960">.</span><span class="ident" id="6025961">Fprintf</span><span class="op" id="6025968">(</span><span class="ident" id="6025969">w</span><span class="op" id="6025970">,</span>&nbsp;<span class="string" id="6025972">&#34;\n&#34;</span><span class="op" id="6025976">)</span><br>
<span class="lineno"></span><span class="op" id="6025978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6025981">//&nbsp;Interface&nbsp;to&nbsp;system&nbsp;profiles.</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="6026015">type</span>&nbsp;<span class="ident" id="6026020">byInUseBytes</span>&nbsp;<span class="op" id="6026033">[</span><span class="op" id="6026034">]</span><span class="ident" id="6026035">runtime</span><span class="op" id="6026042">.</span><span class="ident" id="6026043">MemProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6026061">func</span>&nbsp;<span class="op" id="6026066">(</span><span class="ident" id="6026067">x</span>&nbsp;<span class="ident" id="6026069">byInUseBytes</span><span class="op" id="6026081">)</span>&nbsp;<span class="ident" id="6026083">Len</span><span class="op" id="6026086">(</span><span class="op" id="6026087">)</span>&nbsp;<span class="builtintype" id="6026089">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6026103">{</span>&nbsp;<span class="keyword" id="6026105">return</span>&nbsp;<span class="builtinfunc" id="6026112">len</span><span class="op" id="6026115">(</span><span class="ident" id="6026116">x</span><span class="op" id="6026117">)</span>&nbsp;<span class="op" id="6026119">}</span><br>
<span class="lineno"></span><span class="keyword" id="6026121">func</span>&nbsp;<span class="op" id="6026126">(</span><span class="ident" id="6026127">x</span>&nbsp;<span class="ident" id="6026129">byInUseBytes</span><span class="op" id="6026141">)</span>&nbsp;<span class="ident" id="6026143">Swap</span><span class="op" id="6026147">(</span><span class="ident" id="6026148">i</span><span class="op" id="6026149">,</span>&nbsp;<span class="ident" id="6026151">j</span>&nbsp;<span class="builtintype" id="6026153">int</span><span class="op" id="6026156">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6026163">{</span>&nbsp;<span class="ident" id="6026165">x</span><span class="op" id="6026166">[</span><span class="ident" id="6026167">i</span><span class="op" id="6026168">]</span><span class="op" id="6026169">,</span>&nbsp;<span class="ident" id="6026171">x</span><span class="op" id="6026172">[</span><span class="ident" id="6026173">j</span><span class="op" id="6026174">]</span>&nbsp;<span class="op" id="6026176">=</span>&nbsp;<span class="ident" id="6026178">x</span><span class="op" id="6026179">[</span><span class="ident" id="6026180">j</span><span class="op" id="6026181">]</span><span class="op" id="6026182">,</span>&nbsp;<span class="ident" id="6026184">x</span><span class="op" id="6026185">[</span><span class="ident" id="6026186">i</span><span class="op" id="6026187">]</span>&nbsp;<span class="op" id="6026189">}</span><br>
<span class="lineno">365</span><span class="keyword" id="6026191">func</span>&nbsp;<span class="op" id="6026196">(</span><span class="ident" id="6026197">x</span>&nbsp;<span class="ident" id="6026199">byInUseBytes</span><span class="op" id="6026211">)</span>&nbsp;<span class="ident" id="6026213">Less</span><span class="op" id="6026217">(</span><span class="ident" id="6026218">i</span><span class="op" id="6026219">,</span>&nbsp;<span class="ident" id="6026221">j</span>&nbsp;<span class="builtintype" id="6026223">int</span><span class="op" id="6026226">)</span>&nbsp;<span class="builtintype" id="6026228">bool</span>&nbsp;<span class="op" id="6026233">{</span>&nbsp;<span class="keyword" id="6026235">return</span>&nbsp;<span class="ident" id="6026242">x</span><span class="op" id="6026243">[</span><span class="ident" id="6026244">i</span><span class="op" id="6026245">]</span><span class="op" id="6026246">.</span><span class="ident" id="6026247">InUseBytes</span><span class="op" id="6026257">(</span><span class="op" id="6026258">)</span>&nbsp;<span class="op" id="6026260">&gt;</span>&nbsp;<span class="ident" id="6026262">x</span><span class="op" id="6026263">[</span><span class="ident" id="6026264">j</span><span class="op" id="6026265">]</span><span class="op" id="6026266">.</span><span class="ident" id="6026267">InUseBytes</span><span class="op" id="6026277">(</span><span class="op" id="6026278">)</span>&nbsp;<span class="op" id="6026280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026283">//&nbsp;WriteHeapProfile&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Lookup(&#34;heap&#34;).WriteTo(w,&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="6026350">//&nbsp;It&nbsp;is&nbsp;preserved&nbsp;for&nbsp;backwards&nbsp;compatibility.</span><br>
<span class="lineno"></span><span class="keyword" id="6026398">func</span>&nbsp;<span class="ident" id="6026403">WriteHeapProfile</span><span class="op" id="6026419">(</span><span class="ident" id="6026420">w</span>&nbsp;<span class="ident" id="6026422">io</span><span class="op" id="6026424">.</span><span class="ident" id="6026425">Writer</span><span class="op" id="6026431">)</span>&nbsp;<span class="builtintype" id="6026433">error</span>&nbsp;<span class="op" id="6026439">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026442">return</span>&nbsp;<span class="ident" id="6026449">writeHeap</span><span class="op" id="6026458">(</span><span class="ident" id="6026459">w</span><span class="op" id="6026460">,</span>&nbsp;<span class="num" id="6026462">0</span><span class="op" id="6026463">)</span><br>
<span class="lineno"></span><span class="op" id="6026465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026468">//&nbsp;countHeap&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;heap&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="6026532">func</span>&nbsp;<span class="ident" id="6026537">countHeap</span><span class="op" id="6026546">(</span><span class="op" id="6026547">)</span>&nbsp;<span class="builtintype" id="6026549">int</span>&nbsp;<span class="op" id="6026553">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026556">n</span><span class="op" id="6026557">,</span>&nbsp;<span class="ident" id="6026559">_</span>&nbsp;<span class="op" id="6026561">:=</span>&nbsp;<span class="ident" id="6026564">runtime</span><span class="op" id="6026571">.</span><span class="ident" id="6026572">MemProfile</span><span class="op" id="6026582">(</span><span class="ident" id="6026583">nil</span><span class="op" id="6026586">,</span>&nbsp;<span class="builtintype" id="6026588">true</span><span class="op" id="6026592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026595">return</span>&nbsp;<span class="ident" id="6026602">n</span><br>
<span class="lineno"></span><span class="op" id="6026604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026607">//&nbsp;writeHeap&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;heap&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno">380</span><span class="keyword" id="6026666">func</span>&nbsp;<span class="ident" id="6026671">writeHeap</span><span class="op" id="6026680">(</span><span class="ident" id="6026681">w</span>&nbsp;<span class="ident" id="6026683">io</span><span class="op" id="6026685">.</span><span class="ident" id="6026686">Writer</span><span class="op" id="6026692">,</span>&nbsp;<span class="ident" id="6026694">debug</span>&nbsp;<span class="builtintype" id="6026700">int</span><span class="op" id="6026703">)</span>&nbsp;<span class="builtintype" id="6026705">error</span>&nbsp;<span class="op" id="6026711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026714">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(MemProfile(nil,&nbsp;true)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026779">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026829">//&nbsp;There&#39;s&nbsp;a&nbsp;racemore&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026886">//&nbsp;the&nbsp;two&nbsp;callsso&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026949">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026995">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027062">var</span>&nbsp;<span class="ident" id="6027066">p</span>&nbsp;<span class="op" id="6027068">[</span><span class="op" id="6027069">]</span><span class="ident" id="6027070">runtime</span><span class="op" id="6027077">.</span><span class="ident" id="6027078">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027096">n</span><span class="op" id="6027097">,</span>&nbsp;<span class="ident" id="6027099">ok</span>&nbsp;<span class="op" id="6027102">:=</span>&nbsp;<span class="ident" id="6027105">runtime</span><span class="op" id="6027112">.</span><span class="ident" id="6027113">MemProfile</span><span class="op" id="6027123">(</span><span class="ident" id="6027124">nil</span><span class="op" id="6027127">,</span>&nbsp;<span class="builtintype" id="6027129">true</span><span class="op" id="6027133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027136">for</span>&nbsp;<span class="op" id="6027140">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027144">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027194">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027242">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;MemProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027277">p</span>&nbsp;<span class="op" id="6027279">=</span>&nbsp;<span class="builtinfunc" id="6027281">make</span><span class="op" id="6027285">(</span><span class="op" id="6027286">[</span><span class="op" id="6027287">]</span><span class="ident" id="6027288">runtime</span><span class="op" id="6027295">.</span><span class="ident" id="6027296">MemProfileRecord</span><span class="op" id="6027312">,</span>&nbsp;<span class="ident" id="6027314">n</span><span class="op" id="6027315">+</span><span class="num" id="6027316">50</span><span class="op" id="6027318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027322">n</span><span class="op" id="6027323">,</span>&nbsp;<span class="ident" id="6027325">ok</span>&nbsp;<span class="op" id="6027328">=</span>&nbsp;<span class="ident" id="6027330">runtime</span><span class="op" id="6027337">.</span><span class="ident" id="6027338">MemProfile</span><span class="op" id="6027348">(</span><span class="ident" id="6027349">p</span><span class="op" id="6027350">,</span>&nbsp;<span class="builtintype" id="6027352">true</span><span class="op" id="6027356">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027360">if</span>&nbsp;<span class="ident" id="6027363">ok</span>&nbsp;<span class="op" id="6027366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027371">p</span>&nbsp;<span class="op" id="6027373">=</span>&nbsp;<span class="ident" id="6027375">p</span><span class="op" id="6027376">[</span><span class="num" id="6027377">0</span><span class="op" id="6027378">:</span><span class="ident" id="6027379">n</span><span class="op" id="6027380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027385">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027397">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027430">sort</span><span class="op" id="6027434">.</span><span class="ident" id="6027435">Sort</span><span class="op" id="6027439">(</span><span class="ident" id="6027440">byInUseBytes</span><span class="op" id="6027452">(</span><span class="ident" id="6027453">p</span><span class="op" id="6027454">)</span><span class="op" id="6027455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027459">b</span>&nbsp;<span class="op" id="6027461">:=</span>&nbsp;<span class="ident" id="6027464">bufio</span><span class="op" id="6027469">.</span><span class="ident" id="6027470">NewWriter</span><span class="op" id="6027479">(</span><span class="ident" id="6027480">w</span><span class="op" id="6027481">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027484">var</span>&nbsp;<span class="ident" id="6027488">tw</span>&nbsp;<span class="op" id="6027491">*</span><span class="ident" id="6027492">tabwriter</span><span class="op" id="6027501">.</span><span class="ident" id="6027502">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027510">w</span>&nbsp;<span class="op" id="6027512">=</span>&nbsp;<span class="ident" id="6027514">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027517">if</span>&nbsp;<span class="ident" id="6027520">debug</span>&nbsp;<span class="op" id="6027526">&gt;</span>&nbsp;<span class="num" id="6027528">0</span>&nbsp;<span class="op" id="6027530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027534">tw</span>&nbsp;<span class="op" id="6027537">=</span>&nbsp;<span class="ident" id="6027539">tabwriter</span><span class="op" id="6027548">.</span><span class="ident" id="6027549">NewWriter</span><span class="op" id="6027558">(</span><span class="ident" id="6027559">w</span><span class="op" id="6027560">,</span>&nbsp;<span class="num" id="6027562">1</span><span class="op" id="6027563">,</span>&nbsp;<span class="num" id="6027565">8</span><span class="op" id="6027566">,</span>&nbsp;<span class="num" id="6027568">1</span><span class="op" id="6027569">,</span>&nbsp;<span class="string" id="6027571">&#39;\t&#39;</span><span class="op" id="6027575">,</span>&nbsp;<span class="num" id="6027577">0</span><span class="op" id="6027578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027582">w</span>&nbsp;<span class="op" id="6027584">=</span>&nbsp;<span class="ident" id="6027586">tw</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027594">var</span>&nbsp;<span class="ident" id="6027598">total</span>&nbsp;<span class="ident" id="6027604">runtime</span><span class="op" id="6027611">.</span><span class="ident" id="6027612">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027630">for</span>&nbsp;<span class="ident" id="6027634">i</span>&nbsp;<span class="op" id="6027636">:=</span>&nbsp;<span class="keyword" id="6027639">range</span>&nbsp;<span class="ident" id="6027645">p</span>&nbsp;<span class="op" id="6027647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027651">r</span>&nbsp;<span class="op" id="6027653">:=</span>&nbsp;<span class="op" id="6027656">&amp;</span><span class="ident" id="6027657">p</span><span class="op" id="6027658">[</span><span class="ident" id="6027659">i</span><span class="op" id="6027660">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027664">total</span><span class="op" id="6027669">.</span><span class="ident" id="6027670">AllocBytes</span>&nbsp;<span class="op" id="6027681">+=</span>&nbsp;<span class="ident" id="6027684">r</span><span class="op" id="6027685">.</span><span class="ident" id="6027686">AllocBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027699">total</span><span class="op" id="6027704">.</span><span class="ident" id="6027705">AllocObjects</span>&nbsp;<span class="op" id="6027718">+=</span>&nbsp;<span class="ident" id="6027721">r</span><span class="op" id="6027722">.</span><span class="ident" id="6027723">AllocObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027738">total</span><span class="op" id="6027743">.</span><span class="ident" id="6027744">FreeBytes</span>&nbsp;<span class="op" id="6027754">+=</span>&nbsp;<span class="ident" id="6027757">r</span><span class="op" id="6027758">.</span><span class="ident" id="6027759">FreeBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027771">total</span><span class="op" id="6027776">.</span><span class="ident" id="6027777">FreeObjects</span>&nbsp;<span class="op" id="6027789">+=</span>&nbsp;<span class="ident" id="6027792">r</span><span class="op" id="6027793">.</span><span class="ident" id="6027794">FreeObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027807">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027811">//&nbsp;Technically&nbsp;the&nbsp;rate&nbsp;is&nbsp;MemProfileRate&nbsp;not&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027876">//&nbsp;but&nbsp;early&nbsp;versions&nbsp;of&nbsp;the&nbsp;C++&nbsp;heap&nbsp;profiler&nbsp;reported&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027951">//&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;pprof&nbsp;has&nbsp;come&nbsp;to&nbsp;expect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027996">fmt</span><span class="op" id="6027999">.</span><span class="ident" id="6028000">Fprintf</span><span class="op" id="6028007">(</span><span class="ident" id="6028008">w</span><span class="op" id="6028009">,</span>&nbsp;<span class="string" id="6028011">&#34;heap&nbsp;profile:&nbsp;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&nbsp;heap/%d\n&#34;</span><span class="op" id="6028054">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028058">total</span><span class="op" id="6028063">.</span><span class="ident" id="6028064">InUseObjects</span><span class="op" id="6028076">(</span><span class="op" id="6028077">)</span><span class="op" id="6028078">,</span>&nbsp;<span class="ident" id="6028080">total</span><span class="op" id="6028085">.</span><span class="ident" id="6028086">InUseBytes</span><span class="op" id="6028096">(</span><span class="op" id="6028097">)</span><span class="op" id="6028098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028102">total</span><span class="op" id="6028107">.</span><span class="ident" id="6028108">AllocObjects</span><span class="op" id="6028120">,</span>&nbsp;<span class="ident" id="6028122">total</span><span class="op" id="6028127">.</span><span class="ident" id="6028128">AllocBytes</span><span class="op" id="6028138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6028142">2</span><span class="op" id="6028143">*</span><span class="ident" id="6028144">runtime</span><span class="op" id="6028151">.</span><span class="ident" id="6028152">MemProfileRate</span><span class="op" id="6028166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028170">for</span>&nbsp;<span class="ident" id="6028174">i</span>&nbsp;<span class="op" id="6028176">:=</span>&nbsp;<span class="keyword" id="6028179">range</span>&nbsp;<span class="ident" id="6028185">p</span>&nbsp;<span class="op" id="6028187">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028191">r</span>&nbsp;<span class="op" id="6028193">:=</span>&nbsp;<span class="op" id="6028196">&amp;</span><span class="ident" id="6028197">p</span><span class="op" id="6028198">[</span><span class="ident" id="6028199">i</span><span class="op" id="6028200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028204">fmt</span><span class="op" id="6028207">.</span><span class="ident" id="6028208">Fprintf</span><span class="op" id="6028215">(</span><span class="ident" id="6028216">w</span><span class="op" id="6028217">,</span>&nbsp;<span class="string" id="6028219">&#34;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&#34;</span><span class="op" id="6028238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028243">r</span><span class="op" id="6028244">.</span><span class="ident" id="6028245">InUseObjects</span><span class="op" id="6028257">(</span><span class="op" id="6028258">)</span><span class="op" id="6028259">,</span>&nbsp;<span class="ident" id="6028261">r</span><span class="op" id="6028262">.</span><span class="ident" id="6028263">InUseBytes</span><span class="op" id="6028273">(</span><span class="op" id="6028274">)</span><span class="op" id="6028275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028280">r</span><span class="op" id="6028281">.</span><span class="ident" id="6028282">AllocObjects</span><span class="op" id="6028294">,</span>&nbsp;<span class="ident" id="6028296">r</span><span class="op" id="6028297">.</span><span class="ident" id="6028298">AllocBytes</span><span class="op" id="6028308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028312">for</span>&nbsp;<span class="ident" id="6028316">_</span><span class="op" id="6028317">,</span>&nbsp;<span class="ident" id="6028319">pc</span>&nbsp;<span class="op" id="6028322">:=</span>&nbsp;<span class="keyword" id="6028325">range</span>&nbsp;<span class="ident" id="6028331">r</span><span class="op" id="6028332">.</span><span class="ident" id="6028333">Stack</span><span class="op" id="6028338">(</span><span class="op" id="6028339">)</span>&nbsp;<span class="op" id="6028341">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028346">fmt</span><span class="op" id="6028349">.</span><span class="ident" id="6028350">Fprintf</span><span class="op" id="6028357">(</span><span class="ident" id="6028358">w</span><span class="op" id="6028359">,</span>&nbsp;<span class="string" id="6028361">&#34;&nbsp;%#x&#34;</span><span class="op" id="6028367">,</span>&nbsp;<span class="ident" id="6028369">pc</span><span class="op" id="6028371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028379">fmt</span><span class="op" id="6028382">.</span><span class="ident" id="6028383">Fprintf</span><span class="op" id="6028390">(</span><span class="ident" id="6028391">w</span><span class="op" id="6028392">,</span>&nbsp;<span class="string" id="6028394">&#34;\n&#34;</span><span class="op" id="6028398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028402">if</span>&nbsp;<span class="ident" id="6028405">debug</span>&nbsp;<span class="op" id="6028411">&gt;</span>&nbsp;<span class="num" id="6028413">0</span>&nbsp;<span class="op" id="6028415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028420">printStackRecord</span><span class="op" id="6028436">(</span><span class="ident" id="6028437">w</span><span class="op" id="6028438">,</span>&nbsp;<span class="ident" id="6028440">r</span><span class="op" id="6028441">.</span><span class="ident" id="6028442">Stack</span><span class="op" id="6028447">(</span><span class="op" id="6028448">)</span><span class="op" id="6028449">,</span>&nbsp;<span class="builtintype" id="6028451">false</span><span class="op" id="6028456">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028467">//&nbsp;Print&nbsp;memstats&nbsp;information&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028503">//&nbsp;Pprof&nbsp;will&nbsp;ignore,&nbsp;but&nbsp;useful&nbsp;for&nbsp;people</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028548">if</span>&nbsp;<span class="ident" id="6028551">debug</span>&nbsp;<span class="op" id="6028557">&gt;</span>&nbsp;<span class="num" id="6028559">0</span>&nbsp;<span class="op" id="6028561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028565">s</span>&nbsp;<span class="op" id="6028567">:=</span>&nbsp;<span class="builtinfunc" id="6028570">new</span><span class="op" id="6028573">(</span><span class="ident" id="6028574">runtime</span><span class="op" id="6028581">.</span><span class="ident" id="6028582">MemStats</span><span class="op" id="6028590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028594">runtime</span><span class="op" id="6028601">.</span><span class="ident" id="6028602">ReadMemStats</span><span class="op" id="6028614">(</span><span class="ident" id="6028615">s</span><span class="op" id="6028616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028620">fmt</span><span class="op" id="6028623">.</span><span class="ident" id="6028624">Fprintf</span><span class="op" id="6028631">(</span><span class="ident" id="6028632">w</span><span class="op" id="6028633">,</span>&nbsp;<span class="string" id="6028635">&#34;\n#&nbsp;runtime.MemStats\n&#34;</span><span class="op" id="6028659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028663">fmt</span><span class="op" id="6028666">.</span><span class="ident" id="6028667">Fprintf</span><span class="op" id="6028674">(</span><span class="ident" id="6028675">w</span><span class="op" id="6028676">,</span>&nbsp;<span class="string" id="6028678">&#34;#&nbsp;Alloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028694">,</span>&nbsp;<span class="ident" id="6028696">s</span><span class="op" id="6028697">.</span><span class="ident" id="6028698">Alloc</span><span class="op" id="6028703">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028707">fmt</span><span class="op" id="6028710">.</span><span class="ident" id="6028711">Fprintf</span><span class="op" id="6028718">(</span><span class="ident" id="6028719">w</span><span class="op" id="6028720">,</span>&nbsp;<span class="string" id="6028722">&#34;#&nbsp;TotalAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028743">,</span>&nbsp;<span class="ident" id="6028745">s</span><span class="op" id="6028746">.</span><span class="ident" id="6028747">TotalAlloc</span><span class="op" id="6028757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028761">fmt</span><span class="op" id="6028764">.</span><span class="ident" id="6028765">Fprintf</span><span class="op" id="6028772">(</span><span class="ident" id="6028773">w</span><span class="op" id="6028774">,</span>&nbsp;<span class="string" id="6028776">&#34;#&nbsp;Sys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028790">,</span>&nbsp;<span class="ident" id="6028792">s</span><span class="op" id="6028793">.</span><span class="ident" id="6028794">Sys</span><span class="op" id="6028797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028801">fmt</span><span class="op" id="6028804">.</span><span class="ident" id="6028805">Fprintf</span><span class="op" id="6028812">(</span><span class="ident" id="6028813">w</span><span class="op" id="6028814">,</span>&nbsp;<span class="string" id="6028816">&#34;#&nbsp;Lookups&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028834">,</span>&nbsp;<span class="ident" id="6028836">s</span><span class="op" id="6028837">.</span><span class="ident" id="6028838">Lookups</span><span class="op" id="6028845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028849">fmt</span><span class="op" id="6028852">.</span><span class="ident" id="6028853">Fprintf</span><span class="op" id="6028860">(</span><span class="ident" id="6028861">w</span><span class="op" id="6028862">,</span>&nbsp;<span class="string" id="6028864">&#34;#&nbsp;Mallocs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028882">,</span>&nbsp;<span class="ident" id="6028884">s</span><span class="op" id="6028885">.</span><span class="ident" id="6028886">Mallocs</span><span class="op" id="6028893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028897">fmt</span><span class="op" id="6028900">.</span><span class="ident" id="6028901">Fprintf</span><span class="op" id="6028908">(</span><span class="ident" id="6028909">w</span><span class="op" id="6028910">,</span>&nbsp;<span class="string" id="6028912">&#34;#&nbsp;Frees&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028928">,</span>&nbsp;<span class="ident" id="6028930">s</span><span class="op" id="6028931">.</span><span class="ident" id="6028932">Frees</span><span class="op" id="6028937">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028942">fmt</span><span class="op" id="6028945">.</span><span class="ident" id="6028946">Fprintf</span><span class="op" id="6028953">(</span><span class="ident" id="6028954">w</span><span class="op" id="6028955">,</span>&nbsp;<span class="string" id="6028957">&#34;#&nbsp;HeapAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6028977">,</span>&nbsp;<span class="ident" id="6028979">s</span><span class="op" id="6028980">.</span><span class="ident" id="6028981">HeapAlloc</span><span class="op" id="6028990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028994">fmt</span><span class="op" id="6028997">.</span><span class="ident" id="6028998">Fprintf</span><span class="op" id="6029005">(</span><span class="ident" id="6029006">w</span><span class="op" id="6029007">,</span>&nbsp;<span class="string" id="6029009">&#34;#&nbsp;HeapSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029027">,</span>&nbsp;<span class="ident" id="6029029">s</span><span class="op" id="6029030">.</span><span class="ident" id="6029031">HeapSys</span><span class="op" id="6029038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029042">fmt</span><span class="op" id="6029045">.</span><span class="ident" id="6029046">Fprintf</span><span class="op" id="6029053">(</span><span class="ident" id="6029054">w</span><span class="op" id="6029055">,</span>&nbsp;<span class="string" id="6029057">&#34;#&nbsp;HeapIdle&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029076">,</span>&nbsp;<span class="ident" id="6029078">s</span><span class="op" id="6029079">.</span><span class="ident" id="6029080">HeapIdle</span><span class="op" id="6029088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029092">fmt</span><span class="op" id="6029095">.</span><span class="ident" id="6029096">Fprintf</span><span class="op" id="6029103">(</span><span class="ident" id="6029104">w</span><span class="op" id="6029105">,</span>&nbsp;<span class="string" id="6029107">&#34;#&nbsp;HeapInuse&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029127">,</span>&nbsp;<span class="ident" id="6029129">s</span><span class="op" id="6029130">.</span><span class="ident" id="6029131">HeapInuse</span><span class="op" id="6029140">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029144">fmt</span><span class="op" id="6029147">.</span><span class="ident" id="6029148">Fprintf</span><span class="op" id="6029155">(</span><span class="ident" id="6029156">w</span><span class="op" id="6029157">,</span>&nbsp;<span class="string" id="6029159">&#34;#&nbsp;HeapReleased&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029182">,</span>&nbsp;<span class="ident" id="6029184">s</span><span class="op" id="6029185">.</span><span class="ident" id="6029186">HeapReleased</span><span class="op" id="6029198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029202">fmt</span><span class="op" id="6029205">.</span><span class="ident" id="6029206">Fprintf</span><span class="op" id="6029213">(</span><span class="ident" id="6029214">w</span><span class="op" id="6029215">,</span>&nbsp;<span class="string" id="6029217">&#34;#&nbsp;HeapObjects&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029239">,</span>&nbsp;<span class="ident" id="6029241">s</span><span class="op" id="6029242">.</span><span class="ident" id="6029243">HeapObjects</span><span class="op" id="6029254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029259">fmt</span><span class="op" id="6029262">.</span><span class="ident" id="6029263">Fprintf</span><span class="op" id="6029270">(</span><span class="ident" id="6029271">w</span><span class="op" id="6029272">,</span>&nbsp;<span class="string" id="6029274">&#34;#&nbsp;Stack&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="6029295">,</span>&nbsp;<span class="ident" id="6029297">s</span><span class="op" id="6029298">.</span><span class="ident" id="6029299">StackInuse</span><span class="op" id="6029309">,</span>&nbsp;<span class="ident" id="6029311">s</span><span class="op" id="6029312">.</span><span class="ident" id="6029313">StackSys</span><span class="op" id="6029321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029325">fmt</span><span class="op" id="6029328">.</span><span class="ident" id="6029329">Fprintf</span><span class="op" id="6029336">(</span><span class="ident" id="6029337">w</span><span class="op" id="6029338">,</span>&nbsp;<span class="string" id="6029340">&#34;#&nbsp;MSpan&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="6029361">,</span>&nbsp;<span class="ident" id="6029363">s</span><span class="op" id="6029364">.</span><span class="ident" id="6029365">MSpanInuse</span><span class="op" id="6029375">,</span>&nbsp;<span class="ident" id="6029377">s</span><span class="op" id="6029378">.</span><span class="ident" id="6029379">MSpanSys</span><span class="op" id="6029387">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029391">fmt</span><span class="op" id="6029394">.</span><span class="ident" id="6029395">Fprintf</span><span class="op" id="6029402">(</span><span class="ident" id="6029403">w</span><span class="op" id="6029404">,</span>&nbsp;<span class="string" id="6029406">&#34;#&nbsp;MCache&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="6029428">,</span>&nbsp;<span class="ident" id="6029430">s</span><span class="op" id="6029431">.</span><span class="ident" id="6029432">MCacheInuse</span><span class="op" id="6029443">,</span>&nbsp;<span class="ident" id="6029445">s</span><span class="op" id="6029446">.</span><span class="ident" id="6029447">MCacheSys</span><span class="op" id="6029456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029460">fmt</span><span class="op" id="6029463">.</span><span class="ident" id="6029464">Fprintf</span><span class="op" id="6029471">(</span><span class="ident" id="6029472">w</span><span class="op" id="6029473">,</span>&nbsp;<span class="string" id="6029475">&#34;#&nbsp;BuckHashSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029497">,</span>&nbsp;<span class="ident" id="6029499">s</span><span class="op" id="6029500">.</span><span class="ident" id="6029501">BuckHashSys</span><span class="op" id="6029512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029517">fmt</span><span class="op" id="6029520">.</span><span class="ident" id="6029521">Fprintf</span><span class="op" id="6029528">(</span><span class="ident" id="6029529">w</span><span class="op" id="6029530">,</span>&nbsp;<span class="string" id="6029532">&#34;#&nbsp;NextGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029549">,</span>&nbsp;<span class="ident" id="6029551">s</span><span class="op" id="6029552">.</span><span class="ident" id="6029553">NextGC</span><span class="op" id="6029559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029563">fmt</span><span class="op" id="6029566">.</span><span class="ident" id="6029567">Fprintf</span><span class="op" id="6029574">(</span><span class="ident" id="6029575">w</span><span class="op" id="6029576">,</span>&nbsp;<span class="string" id="6029578">&#34;#&nbsp;PauseNs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029596">,</span>&nbsp;<span class="ident" id="6029598">s</span><span class="op" id="6029599">.</span><span class="ident" id="6029600">PauseNs</span><span class="op" id="6029607">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029611">fmt</span><span class="op" id="6029614">.</span><span class="ident" id="6029615">Fprintf</span><span class="op" id="6029622">(</span><span class="ident" id="6029623">w</span><span class="op" id="6029624">,</span>&nbsp;<span class="string" id="6029626">&#34;#&nbsp;NumGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="6029642">,</span>&nbsp;<span class="ident" id="6029644">s</span><span class="op" id="6029645">.</span><span class="ident" id="6029646">NumGC</span><span class="op" id="6029651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029655">fmt</span><span class="op" id="6029658">.</span><span class="ident" id="6029659">Fprintf</span><span class="op" id="6029666">(</span><span class="ident" id="6029667">w</span><span class="op" id="6029668">,</span>&nbsp;<span class="string" id="6029670">&#34;#&nbsp;EnableGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="6029689">,</span>&nbsp;<span class="ident" id="6029691">s</span><span class="op" id="6029692">.</span><span class="ident" id="6029693">EnableGC</span><span class="op" id="6029701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029705">fmt</span><span class="op" id="6029708">.</span><span class="ident" id="6029709">Fprintf</span><span class="op" id="6029716">(</span><span class="ident" id="6029717">w</span><span class="op" id="6029718">,</span>&nbsp;<span class="string" id="6029720">&#34;#&nbsp;DebugGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="6029738">,</span>&nbsp;<span class="ident" id="6029740">s</span><span class="op" id="6029741">.</span><span class="ident" id="6029742">DebugGC</span><span class="op" id="6029749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029756">if</span>&nbsp;<span class="ident" id="6029759">tw</span>&nbsp;<span class="op" id="6029762">!=</span>&nbsp;<span class="ident" id="6029765">nil</span>&nbsp;<span class="op" id="6029769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029773">tw</span><span class="op" id="6029775">.</span><span class="ident" id="6029776">Flush</span><span class="op" id="6029781">(</span><span class="op" id="6029782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029788">return</span>&nbsp;<span class="ident" id="6029795">b</span><span class="op" id="6029796">.</span><span class="ident" id="6029797">Flush</span><span class="op" id="6029802">(</span><span class="op" id="6029803">)</span><br>
<span class="lineno"></span><span class="op" id="6029805">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="6029808">//&nbsp;countThreadCreate&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;current&nbsp;ThreadCreateProfile.</span><br>
<span class="lineno"></span><span class="keyword" id="6029882">func</span>&nbsp;<span class="ident" id="6029887">countThreadCreate</span><span class="op" id="6029904">(</span><span class="op" id="6029905">)</span>&nbsp;<span class="builtintype" id="6029907">int</span>&nbsp;<span class="op" id="6029911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029914">n</span><span class="op" id="6029915">,</span>&nbsp;<span class="ident" id="6029917">_</span>&nbsp;<span class="op" id="6029919">:=</span>&nbsp;<span class="ident" id="6029922">runtime</span><span class="op" id="6029929">.</span><span class="ident" id="6029930">ThreadCreateProfile</span><span class="op" id="6029949">(</span><span class="ident" id="6029950">nil</span><span class="op" id="6029953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029956">return</span>&nbsp;<span class="ident" id="6029963">n</span><br>
<span class="lineno">485</span><span class="op" id="6029965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6029968">//&nbsp;writeThreadCreate&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;ThreadCreateProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6030042">func</span>&nbsp;<span class="ident" id="6030047">writeThreadCreate</span><span class="op" id="6030064">(</span><span class="ident" id="6030065">w</span>&nbsp;<span class="ident" id="6030067">io</span><span class="op" id="6030069">.</span><span class="ident" id="6030070">Writer</span><span class="op" id="6030076">,</span>&nbsp;<span class="ident" id="6030078">debug</span>&nbsp;<span class="builtintype" id="6030084">int</span><span class="op" id="6030087">)</span>&nbsp;<span class="builtintype" id="6030089">error</span>&nbsp;<span class="op" id="6030095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030098">return</span>&nbsp;<span class="ident" id="6030105">writeRuntimeProfile</span><span class="op" id="6030124">(</span><span class="ident" id="6030125">w</span><span class="op" id="6030126">,</span>&nbsp;<span class="ident" id="6030128">debug</span><span class="op" id="6030133">,</span>&nbsp;<span class="string" id="6030135">&#34;threadcreate&#34;</span><span class="op" id="6030149">,</span>&nbsp;<span class="ident" id="6030151">runtime</span><span class="op" id="6030158">.</span><span class="ident" id="6030159">ThreadCreateProfile</span><span class="op" id="6030178">)</span><br>
<span class="lineno">490</span><span class="op" id="6030180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6030183">//&nbsp;countGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6030235">func</span>&nbsp;<span class="ident" id="6030240">countGoroutine</span><span class="op" id="6030254">(</span><span class="op" id="6030255">)</span>&nbsp;<span class="builtintype" id="6030257">int</span>&nbsp;<span class="op" id="6030261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030264">return</span>&nbsp;<span class="ident" id="6030271">runtime</span><span class="op" id="6030278">.</span><span class="ident" id="6030279">NumGoroutine</span><span class="op" id="6030291">(</span><span class="op" id="6030292">)</span><br>
<span class="lineno">495</span><span class="op" id="6030294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6030297">//&nbsp;writeGoroutine&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;GoroutineProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6030365">func</span>&nbsp;<span class="ident" id="6030370">writeGoroutine</span><span class="op" id="6030384">(</span><span class="ident" id="6030385">w</span>&nbsp;<span class="ident" id="6030387">io</span><span class="op" id="6030389">.</span><span class="ident" id="6030390">Writer</span><span class="op" id="6030396">,</span>&nbsp;<span class="ident" id="6030398">debug</span>&nbsp;<span class="builtintype" id="6030404">int</span><span class="op" id="6030407">)</span>&nbsp;<span class="builtintype" id="6030409">error</span>&nbsp;<span class="op" id="6030415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030418">if</span>&nbsp;<span class="ident" id="6030421">debug</span>&nbsp;<span class="op" id="6030427">&gt;=</span>&nbsp;<span class="num" id="6030430">2</span>&nbsp;<span class="op" id="6030432">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030436">return</span>&nbsp;<span class="ident" id="6030443">writeGoroutineStacks</span><span class="op" id="6030463">(</span><span class="ident" id="6030464">w</span><span class="op" id="6030465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030471">return</span>&nbsp;<span class="ident" id="6030478">writeRuntimeProfile</span><span class="op" id="6030497">(</span><span class="ident" id="6030498">w</span><span class="op" id="6030499">,</span>&nbsp;<span class="ident" id="6030501">debug</span><span class="op" id="6030506">,</span>&nbsp;<span class="string" id="6030508">&#34;goroutine&#34;</span><span class="op" id="6030519">,</span>&nbsp;<span class="ident" id="6030521">runtime</span><span class="op" id="6030528">.</span><span class="ident" id="6030529">GoroutineProfile</span><span class="op" id="6030545">)</span><br>
<span class="lineno"></span><span class="op" id="6030547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="6030550">func</span>&nbsp;<span class="ident" id="6030555">writeGoroutineStacks</span><span class="op" id="6030575">(</span><span class="ident" id="6030576">w</span>&nbsp;<span class="ident" id="6030578">io</span><span class="op" id="6030580">.</span><span class="ident" id="6030581">Writer</span><span class="op" id="6030587">)</span>&nbsp;<span class="builtintype" id="6030589">error</span>&nbsp;<span class="op" id="6030595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030598">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;big&nbsp;the&nbsp;buffer&nbsp;needs&nbsp;to&nbsp;be&nbsp;to&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030658">//&nbsp;all&nbsp;the&nbsp;goroutines.&nbsp;&nbsp;Start&nbsp;with&nbsp;1&nbsp;MB&nbsp;and&nbsp;try&nbsp;a&nbsp;few&nbsp;times,&nbsp;doubling&nbsp;each&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030740">//&nbsp;Give&nbsp;up&nbsp;and&nbsp;use&nbsp;a&nbsp;truncated&nbsp;trace&nbsp;if&nbsp;64&nbsp;MB&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030802">buf</span>&nbsp;<span class="op" id="6030806">:=</span>&nbsp;<span class="builtinfunc" id="6030809">make</span><span class="op" id="6030813">(</span><span class="op" id="6030814">[</span><span class="op" id="6030815">]</span><span class="builtintype" id="6030816">byte</span><span class="op" id="6030820">,</span>&nbsp;<span class="num" id="6030822">1</span><span class="op" id="6030823">&lt;&lt;</span><span class="num" id="6030825">20</span><span class="op" id="6030827">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030830">for</span>&nbsp;<span class="ident" id="6030834">i</span>&nbsp;<span class="op" id="6030836">:=</span>&nbsp;<span class="num" id="6030839">0</span><span class="op" id="6030840">;</span>&nbsp;<span class="op" id="6030842">;</span>&nbsp;<span class="ident" id="6030844">i</span><span class="op" id="6030845">++</span>&nbsp;<span class="op" id="6030848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030852">n</span>&nbsp;<span class="op" id="6030854">:=</span>&nbsp;<span class="ident" id="6030857">runtime</span><span class="op" id="6030864">.</span><span class="ident" id="6030865">Stack</span><span class="op" id="6030870">(</span><span class="ident" id="6030871">buf</span><span class="op" id="6030874">,</span>&nbsp;<span class="builtintype" id="6030876">true</span><span class="op" id="6030880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030884">if</span>&nbsp;<span class="ident" id="6030887">n</span>&nbsp;<span class="op" id="6030889">&lt;</span>&nbsp;<span class="builtinfunc" id="6030891">len</span><span class="op" id="6030894">(</span><span class="ident" id="6030895">buf</span><span class="op" id="6030898">)</span>&nbsp;<span class="op" id="6030900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030905">buf</span>&nbsp;<span class="op" id="6030909">=</span>&nbsp;<span class="ident" id="6030911">buf</span><span class="op" id="6030914">[</span><span class="op" id="6030915">:</span><span class="ident" id="6030916">n</span><span class="op" id="6030917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030922">break</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030934">if</span>&nbsp;<span class="builtinfunc" id="6030937">len</span><span class="op" id="6030940">(</span><span class="ident" id="6030941">buf</span><span class="op" id="6030944">)</span>&nbsp;<span class="op" id="6030946">&gt;=</span>&nbsp;<span class="num" id="6030949">64</span><span class="op" id="6030951">&lt;&lt;</span><span class="num" id="6030953">20</span>&nbsp;<span class="op" id="6030956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030961">//&nbsp;Filled&nbsp;64&nbsp;MB&nbsp;-&nbsp;stop&nbsp;there.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030994">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031002">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031006">buf</span>&nbsp;<span class="op" id="6031010">=</span>&nbsp;<span class="builtinfunc" id="6031012">make</span><span class="op" id="6031016">(</span><span class="op" id="6031017">[</span><span class="op" id="6031018">]</span><span class="builtintype" id="6031019">byte</span><span class="op" id="6031023">,</span>&nbsp;<span class="num" id="6031025">2</span><span class="op" id="6031026">*</span><span class="builtinfunc" id="6031027">len</span><span class="op" id="6031030">(</span><span class="ident" id="6031031">buf</span><span class="op" id="6031034">)</span><span class="op" id="6031035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031041">_</span><span class="op" id="6031042">,</span>&nbsp;<span class="ident" id="6031044">err</span>&nbsp;<span class="op" id="6031048">:=</span>&nbsp;<span class="ident" id="6031051">w</span><span class="op" id="6031052">.</span><span class="ident" id="6031053">Write</span><span class="op" id="6031058">(</span><span class="ident" id="6031059">buf</span><span class="op" id="6031062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031065">return</span>&nbsp;<span class="ident" id="6031072">err</span><br>
<span class="lineno"></span><span class="op" id="6031076">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="keyword" id="6031079">func</span>&nbsp;<span class="ident" id="6031084">writeRuntimeProfile</span><span class="op" id="6031103">(</span><span class="ident" id="6031104">w</span>&nbsp;<span class="ident" id="6031106">io</span><span class="op" id="6031108">.</span><span class="ident" id="6031109">Writer</span><span class="op" id="6031115">,</span>&nbsp;<span class="ident" id="6031117">debug</span>&nbsp;<span class="builtintype" id="6031123">int</span><span class="op" id="6031126">,</span>&nbsp;<span class="ident" id="6031128">name</span>&nbsp;<span class="builtintype" id="6031133">string</span><span class="op" id="6031139">,</span>&nbsp;<span class="ident" id="6031141">fetch</span>&nbsp;<span class="keyword" id="6031147">func</span><span class="op" id="6031151">(</span><span class="op" id="6031152">[</span><span class="op" id="6031153">]</span><span class="ident" id="6031154">runtime</span><span class="op" id="6031161">.</span><span class="ident" id="6031162">StackRecord</span><span class="op" id="6031173">)</span>&nbsp;<span class="op" id="6031175">(</span><span class="builtintype" id="6031176">int</span><span class="op" id="6031179">,</span>&nbsp;<span class="builtintype" id="6031181">bool</span><span class="op" id="6031185">)</span><span class="op" id="6031186">)</span>&nbsp;<span class="builtintype" id="6031188">error</span>&nbsp;<span class="op" id="6031194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031197">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(fetch(nil)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031251">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031301">//&nbsp;There&#39;s&nbsp;a&nbsp;racemore&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031358">//&nbsp;the&nbsp;two&nbsp;callsso&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031421">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031467">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031534">var</span>&nbsp;<span class="ident" id="6031538">p</span>&nbsp;<span class="op" id="6031540">[</span><span class="op" id="6031541">]</span><span class="ident" id="6031542">runtime</span><span class="op" id="6031549">.</span><span class="ident" id="6031550">StackRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031563">n</span><span class="op" id="6031564">,</span>&nbsp;<span class="ident" id="6031566">ok</span>&nbsp;<span class="op" id="6031569">:=</span>&nbsp;<span class="ident" id="6031572">fetch</span><span class="op" id="6031577">(</span><span class="ident" id="6031578">nil</span><span class="op" id="6031581">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031584">for</span>&nbsp;<span class="op" id="6031588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031592">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031642">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031690">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;ThreadProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031728">p</span>&nbsp;<span class="op" id="6031730">=</span>&nbsp;<span class="builtinfunc" id="6031732">make</span><span class="op" id="6031736">(</span><span class="op" id="6031737">[</span><span class="op" id="6031738">]</span><span class="ident" id="6031739">runtime</span><span class="op" id="6031746">.</span><span class="ident" id="6031747">StackRecord</span><span class="op" id="6031758">,</span>&nbsp;<span class="ident" id="6031760">n</span><span class="op" id="6031761">+</span><span class="num" id="6031762">10</span><span class="op" id="6031764">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031768">n</span><span class="op" id="6031769">,</span>&nbsp;<span class="ident" id="6031771">ok</span>&nbsp;<span class="op" id="6031774">=</span>&nbsp;<span class="ident" id="6031776">fetch</span><span class="op" id="6031781">(</span><span class="ident" id="6031782">p</span><span class="op" id="6031783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031787">if</span>&nbsp;<span class="ident" id="6031790">ok</span>&nbsp;<span class="op" id="6031793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031798">p</span>&nbsp;<span class="op" id="6031800">=</span>&nbsp;<span class="ident" id="6031802">p</span><span class="op" id="6031803">[</span><span class="num" id="6031804">0</span><span class="op" id="6031805">:</span><span class="ident" id="6031806">n</span><span class="op" id="6031807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031812">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031820">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031824">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031857">return</span>&nbsp;<span class="ident" id="6031864">printCountProfile</span><span class="op" id="6031881">(</span><span class="ident" id="6031882">w</span><span class="op" id="6031883">,</span>&nbsp;<span class="ident" id="6031885">debug</span><span class="op" id="6031890">,</span>&nbsp;<span class="ident" id="6031892">name</span><span class="op" id="6031896">,</span>&nbsp;<span class="ident" id="6031898">runtimeProfile</span><span class="op" id="6031912">(</span><span class="ident" id="6031913">p</span><span class="op" id="6031914">)</span><span class="op" id="6031915">)</span><br>
<span class="lineno"></span><span class="op" id="6031917">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="6031920">type</span>&nbsp;<span class="ident" id="6031925">runtimeProfile</span>&nbsp;<span class="op" id="6031940">[</span><span class="op" id="6031941">]</span><span class="ident" id="6031942">runtime</span><span class="op" id="6031949">.</span><span class="ident" id="6031950">StackRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6031963">func</span>&nbsp;<span class="op" id="6031968">(</span><span class="ident" id="6031969">p</span>&nbsp;<span class="ident" id="6031971">runtimeProfile</span><span class="op" id="6031985">)</span>&nbsp;<span class="ident" id="6031987">Len</span><span class="op" id="6031990">(</span><span class="op" id="6031991">)</span>&nbsp;<span class="builtintype" id="6031993">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6032010">{</span>&nbsp;<span class="keyword" id="6032012">return</span>&nbsp;<span class="builtinfunc" id="6032019">len</span><span class="op" id="6032022">(</span><span class="ident" id="6032023">p</span><span class="op" id="6032024">)</span>&nbsp;<span class="op" id="6032026">}</span><br>
<span class="lineno"></span><span class="keyword" id="6032028">func</span>&nbsp;<span class="op" id="6032033">(</span><span class="ident" id="6032034">p</span>&nbsp;<span class="ident" id="6032036">runtimeProfile</span><span class="op" id="6032050">)</span>&nbsp;<span class="ident" id="6032052">Stack</span><span class="op" id="6032057">(</span><span class="ident" id="6032058">i</span>&nbsp;<span class="builtintype" id="6032060">int</span><span class="op" id="6032063">)</span>&nbsp;<span class="op" id="6032065">[</span><span class="op" id="6032066">]</span><span class="builtintype" id="6032067">uintptr</span>&nbsp;<span class="op" id="6032075">{</span>&nbsp;<span class="keyword" id="6032077">return</span>&nbsp;<span class="ident" id="6032084">p</span><span class="op" id="6032085">[</span><span class="ident" id="6032086">i</span><span class="op" id="6032087">]</span><span class="op" id="6032088">.</span><span class="ident" id="6032089">Stack</span><span class="op" id="6032094">(</span><span class="op" id="6032095">)</span>&nbsp;<span class="op" id="6032097">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="6032100">var</span>&nbsp;<span class="ident" id="6032104">cpu</span>&nbsp;<span class="keyword" id="6032108">struct</span>&nbsp;<span class="op" id="6032115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032118">sync</span><span class="op" id="6032122">.</span><span class="ident" id="6032123">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032130">profiling</span>&nbsp;<span class="builtintype" id="6032140">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032146">done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6032156">chan</span>&nbsp;<span class="builtintype" id="6032161">bool</span><br>
<span class="lineno">560</span><span class="op" id="6032166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6032169">//&nbsp;StartCPUProfile&nbsp;enables&nbsp;CPU&nbsp;profiling&nbsp;for&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="6032235">//&nbsp;While&nbsp;profiling,&nbsp;the&nbsp;profile&nbsp;will&nbsp;be&nbsp;buffered&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="6032302">//&nbsp;StartCPUProfile&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;profiling&nbsp;is&nbsp;already&nbsp;enabled.</span><br>
<span class="lineno">565</span><span class="keyword" id="6032371">func</span>&nbsp;<span class="ident" id="6032376">StartCPUProfile</span><span class="op" id="6032391">(</span><span class="ident" id="6032392">w</span>&nbsp;<span class="ident" id="6032394">io</span><span class="op" id="6032396">.</span><span class="ident" id="6032397">Writer</span><span class="op" id="6032403">)</span>&nbsp;<span class="builtintype" id="6032405">error</span>&nbsp;<span class="op" id="6032411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032414">//&nbsp;The&nbsp;runtime&nbsp;routines&nbsp;allow&nbsp;a&nbsp;variable&nbsp;profiling&nbsp;rate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032472">//&nbsp;but&nbsp;in&nbsp;practice&nbsp;operating&nbsp;systems&nbsp;cannot&nbsp;trigger&nbsp;signals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032533">//&nbsp;at&nbsp;more&nbsp;than&nbsp;about&nbsp;500&nbsp;Hz,&nbsp;and&nbsp;our&nbsp;processing&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032590">//&nbsp;signal&nbsp;is&nbsp;not&nbsp;cheap&nbsp;(mostly&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032648">//&nbsp;100&nbsp;Hz&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;choice:&nbsp;it&nbsp;is&nbsp;frequent&nbsp;enough&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032708">//&nbsp;produce&nbsp;useful&nbsp;data,&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bog&nbsp;down&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032765">//&nbsp;system,&nbsp;and&nbsp;a&nbsp;nice&nbsp;round&nbsp;number&nbsp;to&nbsp;make&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032820">//&nbsp;convert&nbsp;sample&nbsp;counts&nbsp;to&nbsp;seconds.&nbsp;&nbsp;Instead&nbsp;of&nbsp;requiring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032880">//&nbsp;each&nbsp;client&nbsp;to&nbsp;specify&nbsp;the&nbsp;frequency,&nbsp;we&nbsp;hard&nbsp;code&nbsp;it.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032939">const</span>&nbsp;<span class="ident" id="6032945">hz</span>&nbsp;<span class="op" id="6032948">=</span>&nbsp;<span class="num" id="6032950">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032956">cpu</span><span class="op" id="6032959">.</span><span class="ident" id="6032960">Lock</span><span class="op" id="6032964">(</span><span class="op" id="6032965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032968">defer</span>&nbsp;<span class="ident" id="6032974">cpu</span><span class="op" id="6032977">.</span><span class="ident" id="6032978">Unlock</span><span class="op" id="6032984">(</span><span class="op" id="6032985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032988">if</span>&nbsp;<span class="ident" id="6032991">cpu</span><span class="op" id="6032994">.</span><span class="ident" id="6032995">done</span>&nbsp;<span class="op" id="6033000">==</span>&nbsp;<span class="ident" id="6033003">nil</span>&nbsp;<span class="op" id="6033007">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033011">cpu</span><span class="op" id="6033014">.</span><span class="ident" id="6033015">done</span>&nbsp;<span class="op" id="6033020">=</span>&nbsp;<span class="builtinfunc" id="6033022">make</span><span class="op" id="6033026">(</span><span class="keyword" id="6033027">chan</span>&nbsp;<span class="builtintype" id="6033032">bool</span><span class="op" id="6033036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033042">//&nbsp;Double-check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033060">if</span>&nbsp;<span class="ident" id="6033063">cpu</span><span class="op" id="6033066">.</span><span class="ident" id="6033067">profiling</span>&nbsp;<span class="op" id="6033077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033081">return</span>&nbsp;<span class="ident" id="6033088">fmt</span><span class="op" id="6033091">.</span><span class="ident" id="6033092">Errorf</span><span class="op" id="6033098">(</span><span class="string" id="6033099">&#34;cpu&nbsp;profiling&nbsp;already&nbsp;in&nbsp;use&#34;</span><span class="op" id="6033129">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033135">cpu</span><span class="op" id="6033138">.</span><span class="ident" id="6033139">profiling</span>&nbsp;<span class="op" id="6033149">=</span>&nbsp;<span class="builtintype" id="6033151">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033157">runtime</span><span class="op" id="6033164">.</span><span class="ident" id="6033165">SetCPUProfileRate</span><span class="op" id="6033182">(</span><span class="ident" id="6033183">hz</span><span class="op" id="6033185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033188">go</span>&nbsp;<span class="ident" id="6033191">profileWriter</span><span class="op" id="6033204">(</span><span class="ident" id="6033205">w</span><span class="op" id="6033206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033209">return</span>&nbsp;<span class="ident" id="6033216">nil</span><br>
<span class="lineno">590</span><span class="op" id="6033220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6033223">func</span>&nbsp;<span class="ident" id="6033228">profileWriter</span><span class="op" id="6033241">(</span><span class="ident" id="6033242">w</span>&nbsp;<span class="ident" id="6033244">io</span><span class="op" id="6033246">.</span><span class="ident" id="6033247">Writer</span><span class="op" id="6033253">)</span>&nbsp;<span class="op" id="6033255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033258">for</span>&nbsp;<span class="op" id="6033262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033266">data</span>&nbsp;<span class="op" id="6033271">:=</span>&nbsp;<span class="ident" id="6033274">runtime</span><span class="op" id="6033281">.</span><span class="ident" id="6033282">CPUProfile</span><span class="op" id="6033292">(</span><span class="op" id="6033293">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033297">if</span>&nbsp;<span class="ident" id="6033300">data</span>&nbsp;<span class="op" id="6033305">==</span>&nbsp;<span class="ident" id="6033308">nil</span>&nbsp;<span class="op" id="6033312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033317">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033329">w</span><span class="op" id="6033330">.</span><span class="ident" id="6033331">Write</span><span class="op" id="6033336">(</span><span class="ident" id="6033337">data</span><span class="op" id="6033341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033344">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033347">cpu</span><span class="op" id="6033350">.</span><span class="ident" id="6033351">done</span>&nbsp;<span class="op" id="6033356">&lt;-</span>&nbsp;<span class="builtintype" id="6033359">true</span><br>
<span class="lineno"></span><span class="op" id="6033364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6033367">//&nbsp;StopCPUProfile&nbsp;stops&nbsp;the&nbsp;current&nbsp;CPU&nbsp;profile,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="6033424">//&nbsp;StopCPUProfile&nbsp;only&nbsp;returns&nbsp;after&nbsp;all&nbsp;the&nbsp;writes&nbsp;for&nbsp;the</span><br>
<span class="lineno">605</span><span class="comment" id="6033484">//&nbsp;profile&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="6033511">func</span>&nbsp;<span class="ident" id="6033516">StopCPUProfile</span><span class="op" id="6033530">(</span><span class="op" id="6033531">)</span>&nbsp;<span class="op" id="6033533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033536">cpu</span><span class="op" id="6033539">.</span><span class="ident" id="6033540">Lock</span><span class="op" id="6033544">(</span><span class="op" id="6033545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033548">defer</span>&nbsp;<span class="ident" id="6033554">cpu</span><span class="op" id="6033557">.</span><span class="ident" id="6033558">Unlock</span><span class="op" id="6033564">(</span><span class="op" id="6033565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033569">if</span>&nbsp;<span class="op" id="6033572">!</span><span class="ident" id="6033573">cpu</span><span class="op" id="6033576">.</span><span class="ident" id="6033577">profiling</span>&nbsp;<span class="op" id="6033587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033591">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033602">cpu</span><span class="op" id="6033605">.</span><span class="ident" id="6033606">profiling</span>&nbsp;<span class="op" id="6033616">=</span>&nbsp;<span class="builtintype" id="6033618">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033625">runtime</span><span class="op" id="6033632">.</span><span class="ident" id="6033633">SetCPUProfileRate</span><span class="op" id="6033650">(</span><span class="num" id="6033651">0</span><span class="op" id="6033652">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033655">&lt;-</span><span class="ident" id="6033657">cpu</span><span class="op" id="6033660">.</span><span class="ident" id="6033661">done</span><br>
<span class="lineno"></span><span class="op" id="6033666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6033669">type</span>&nbsp;<span class="ident" id="6033674">byCycles</span>&nbsp;<span class="op" id="6033683">[</span><span class="op" id="6033684">]</span><span class="ident" id="6033685">runtime</span><span class="op" id="6033692">.</span><span class="ident" id="6033693">BlockProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="6033713">func</span>&nbsp;<span class="op" id="6033718">(</span><span class="ident" id="6033719">x</span>&nbsp;<span class="ident" id="6033721">byCycles</span><span class="op" id="6033729">)</span>&nbsp;<span class="ident" id="6033731">Len</span><span class="op" id="6033734">(</span><span class="op" id="6033735">)</span>&nbsp;<span class="builtintype" id="6033737">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033751">{</span>&nbsp;<span class="keyword" id="6033753">return</span>&nbsp;<span class="builtinfunc" id="6033760">len</span><span class="op" id="6033763">(</span><span class="ident" id="6033764">x</span><span class="op" id="6033765">)</span>&nbsp;<span class="op" id="6033767">}</span><br>
<span class="lineno"></span><span class="keyword" id="6033769">func</span>&nbsp;<span class="op" id="6033774">(</span><span class="ident" id="6033775">x</span>&nbsp;<span class="ident" id="6033777">byCycles</span><span class="op" id="6033785">)</span>&nbsp;<span class="ident" id="6033787">Swap</span><span class="op" id="6033791">(</span><span class="ident" id="6033792">i</span><span class="op" id="6033793">,</span>&nbsp;<span class="ident" id="6033795">j</span>&nbsp;<span class="builtintype" id="6033797">int</span><span class="op" id="6033800">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6033807">{</span>&nbsp;<span class="ident" id="6033809">x</span><span class="op" id="6033810">[</span><span class="ident" id="6033811">i</span><span class="op" id="6033812">]</span><span class="op" id="6033813">,</span>&nbsp;<span class="ident" id="6033815">x</span><span class="op" id="6033816">[</span><span class="ident" id="6033817">j</span><span class="op" id="6033818">]</span>&nbsp;<span class="op" id="6033820">=</span>&nbsp;<span class="ident" id="6033822">x</span><span class="op" id="6033823">[</span><span class="ident" id="6033824">j</span><span class="op" id="6033825">]</span><span class="op" id="6033826">,</span>&nbsp;<span class="ident" id="6033828">x</span><span class="op" id="6033829">[</span><span class="ident" id="6033830">i</span><span class="op" id="6033831">]</span>&nbsp;<span class="op" id="6033833">}</span><br>
<span class="lineno"></span><span class="keyword" id="6033835">func</span>&nbsp;<span class="op" id="6033840">(</span><span class="ident" id="6033841">x</span>&nbsp;<span class="ident" id="6033843">byCycles</span><span class="op" id="6033851">)</span>&nbsp;<span class="ident" id="6033853">Less</span><span class="op" id="6033857">(</span><span class="ident" id="6033858">i</span><span class="op" id="6033859">,</span>&nbsp;<span class="ident" id="6033861">j</span>&nbsp;<span class="builtintype" id="6033863">int</span><span class="op" id="6033866">)</span>&nbsp;<span class="builtintype" id="6033868">bool</span>&nbsp;<span class="op" id="6033873">{</span>&nbsp;<span class="keyword" id="6033875">return</span>&nbsp;<span class="ident" id="6033882">x</span><span class="op" id="6033883">[</span><span class="ident" id="6033884">i</span><span class="op" id="6033885">]</span><span class="op" id="6033886">.</span><span class="ident" id="6033887">Cycles</span>&nbsp;<span class="op" id="6033894">&gt;</span>&nbsp;<span class="ident" id="6033896">x</span><span class="op" id="6033897">[</span><span class="ident" id="6033898">j</span><span class="op" id="6033899">]</span><span class="op" id="6033900">.</span><span class="ident" id="6033901">Cycles</span>&nbsp;<span class="op" id="6033908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6033911">//&nbsp;countBlock&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno">625</span><span class="keyword" id="6033980">func</span>&nbsp;<span class="ident" id="6033985">countBlock</span><span class="op" id="6033995">(</span><span class="op" id="6033996">)</span>&nbsp;<span class="builtintype" id="6033998">int</span>&nbsp;<span class="op" id="6034002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034005">n</span><span class="op" id="6034006">,</span>&nbsp;<span class="ident" id="6034008">_</span>&nbsp;<span class="op" id="6034010">:=</span>&nbsp;<span class="ident" id="6034013">runtime</span><span class="op" id="6034020">.</span><span class="ident" id="6034021">BlockProfile</span><span class="op" id="6034033">(</span><span class="ident" id="6034034">nil</span><span class="op" id="6034037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034040">return</span>&nbsp;<span class="ident" id="6034047">n</span><br>
<span class="lineno"></span><span class="op" id="6034049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="comment" id="6034052">//&nbsp;writeBlock&nbsp;writes&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6034108">func</span>&nbsp;<span class="ident" id="6034113">writeBlock</span><span class="op" id="6034123">(</span><span class="ident" id="6034124">w</span>&nbsp;<span class="ident" id="6034126">io</span><span class="op" id="6034128">.</span><span class="ident" id="6034129">Writer</span><span class="op" id="6034135">,</span>&nbsp;<span class="ident" id="6034137">debug</span>&nbsp;<span class="builtintype" id="6034143">int</span><span class="op" id="6034146">)</span>&nbsp;<span class="builtintype" id="6034148">error</span>&nbsp;<span class="op" id="6034154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034157">var</span>&nbsp;<span class="ident" id="6034161">p</span>&nbsp;<span class="op" id="6034163">[</span><span class="op" id="6034164">]</span><span class="ident" id="6034165">runtime</span><span class="op" id="6034172">.</span><span class="ident" id="6034173">BlockProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034193">n</span><span class="op" id="6034194">,</span>&nbsp;<span class="ident" id="6034196">ok</span>&nbsp;<span class="op" id="6034199">:=</span>&nbsp;<span class="ident" id="6034202">runtime</span><span class="op" id="6034209">.</span><span class="ident" id="6034210">BlockProfile</span><span class="op" id="6034222">(</span><span class="ident" id="6034223">nil</span><span class="op" id="6034226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034229">for</span>&nbsp;<span class="op" id="6034233">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034237">p</span>&nbsp;<span class="op" id="6034239">=</span>&nbsp;<span class="builtinfunc" id="6034241">make</span><span class="op" id="6034245">(</span><span class="op" id="6034246">[</span><span class="op" id="6034247">]</span><span class="ident" id="6034248">runtime</span><span class="op" id="6034255">.</span><span class="ident" id="6034256">BlockProfileRecord</span><span class="op" id="6034274">,</span>&nbsp;<span class="ident" id="6034276">n</span><span class="op" id="6034277">+</span><span class="num" id="6034278">50</span><span class="op" id="6034280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034284">n</span><span class="op" id="6034285">,</span>&nbsp;<span class="ident" id="6034287">ok</span>&nbsp;<span class="op" id="6034290">=</span>&nbsp;<span class="ident" id="6034292">runtime</span><span class="op" id="6034299">.</span><span class="ident" id="6034300">BlockProfile</span><span class="op" id="6034312">(</span><span class="ident" id="6034313">p</span><span class="op" id="6034314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034318">if</span>&nbsp;<span class="ident" id="6034321">ok</span>&nbsp;<span class="op" id="6034324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034329">p</span>&nbsp;<span class="op" id="6034331">=</span>&nbsp;<span class="ident" id="6034333">p</span><span class="op" id="6034334">[</span><span class="op" id="6034335">:</span><span class="ident" id="6034336">n</span><span class="op" id="6034337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034342">break</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034357">sort</span><span class="op" id="6034361">.</span><span class="ident" id="6034362">Sort</span><span class="op" id="6034366">(</span><span class="ident" id="6034367">byCycles</span><span class="op" id="6034375">(</span><span class="ident" id="6034376">p</span><span class="op" id="6034377">)</span><span class="op" id="6034378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034382">b</span>&nbsp;<span class="op" id="6034384">:=</span>&nbsp;<span class="ident" id="6034387">bufio</span><span class="op" id="6034392">.</span><span class="ident" id="6034393">NewWriter</span><span class="op" id="6034402">(</span><span class="ident" id="6034403">w</span><span class="op" id="6034404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034407">var</span>&nbsp;<span class="ident" id="6034411">tw</span>&nbsp;<span class="op" id="6034414">*</span><span class="ident" id="6034415">tabwriter</span><span class="op" id="6034424">.</span><span class="ident" id="6034425">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034433">w</span>&nbsp;<span class="op" id="6034435">=</span>&nbsp;<span class="ident" id="6034437">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034440">if</span>&nbsp;<span class="ident" id="6034443">debug</span>&nbsp;<span class="op" id="6034449">&gt;</span>&nbsp;<span class="num" id="6034451">0</span>&nbsp;<span class="op" id="6034453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034457">tw</span>&nbsp;<span class="op" id="6034460">=</span>&nbsp;<span class="ident" id="6034462">tabwriter</span><span class="op" id="6034471">.</span><span class="ident" id="6034472">NewWriter</span><span class="op" id="6034481">(</span><span class="ident" id="6034482">w</span><span class="op" id="6034483">,</span>&nbsp;<span class="num" id="6034485">1</span><span class="op" id="6034486">,</span>&nbsp;<span class="num" id="6034488">8</span><span class="op" id="6034489">,</span>&nbsp;<span class="num" id="6034491">1</span><span class="op" id="6034492">,</span>&nbsp;<span class="string" id="6034494">&#39;\t&#39;</span><span class="op" id="6034498">,</span>&nbsp;<span class="num" id="6034500">0</span><span class="op" id="6034501">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034505">w</span>&nbsp;<span class="op" id="6034507">=</span>&nbsp;<span class="ident" id="6034509">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034517">fmt</span><span class="op" id="6034520">.</span><span class="ident" id="6034521">Fprintf</span><span class="op" id="6034528">(</span><span class="ident" id="6034529">w</span><span class="op" id="6034530">,</span>&nbsp;<span class="string" id="6034532">&#34;---&nbsp;contention:\n&#34;</span><span class="op" id="6034551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034554">fmt</span><span class="op" id="6034557">.</span><span class="ident" id="6034558">Fprintf</span><span class="op" id="6034565">(</span><span class="ident" id="6034566">w</span><span class="op" id="6034567">,</span>&nbsp;<span class="string" id="6034569">&#34;cycles/second=%v\n&#34;</span><span class="op" id="6034589">,</span>&nbsp;<span class="ident" id="6034591">runtime_cyclesPerSecond</span><span class="op" id="6034614">(</span><span class="op" id="6034615">)</span><span class="op" id="6034616">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034619">for</span>&nbsp;<span class="ident" id="6034623">i</span>&nbsp;<span class="op" id="6034625">:=</span>&nbsp;<span class="keyword" id="6034628">range</span>&nbsp;<span class="ident" id="6034634">p</span>&nbsp;<span class="op" id="6034636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034640">r</span>&nbsp;<span class="op" id="6034642">:=</span>&nbsp;<span class="op" id="6034645">&amp;</span><span class="ident" id="6034646">p</span><span class="op" id="6034647">[</span><span class="ident" id="6034648">i</span><span class="op" id="6034649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034653">fmt</span><span class="op" id="6034656">.</span><span class="ident" id="6034657">Fprintf</span><span class="op" id="6034664">(</span><span class="ident" id="6034665">w</span><span class="op" id="6034666">,</span>&nbsp;<span class="string" id="6034668">&#34;%v&nbsp;%v&nbsp;@&#34;</span><span class="op" id="6034677">,</span>&nbsp;<span class="ident" id="6034679">r</span><span class="op" id="6034680">.</span><span class="ident" id="6034681">Cycles</span><span class="op" id="6034687">,</span>&nbsp;<span class="ident" id="6034689">r</span><span class="op" id="6034690">.</span><span class="ident" id="6034691">Count</span><span class="op" id="6034696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034700">for</span>&nbsp;<span class="ident" id="6034704">_</span><span class="op" id="6034705">,</span>&nbsp;<span class="ident" id="6034707">pc</span>&nbsp;<span class="op" id="6034710">:=</span>&nbsp;<span class="keyword" id="6034713">range</span>&nbsp;<span class="ident" id="6034719">r</span><span class="op" id="6034720">.</span><span class="ident" id="6034721">Stack</span><span class="op" id="6034726">(</span><span class="op" id="6034727">)</span>&nbsp;<span class="op" id="6034729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034734">fmt</span><span class="op" id="6034737">.</span><span class="ident" id="6034738">Fprintf</span><span class="op" id="6034745">(</span><span class="ident" id="6034746">w</span><span class="op" id="6034747">,</span>&nbsp;<span class="string" id="6034749">&#34;&nbsp;%#x&#34;</span><span class="op" id="6034755">,</span>&nbsp;<span class="ident" id="6034757">pc</span><span class="op" id="6034759">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034767">fmt</span><span class="op" id="6034770">.</span><span class="ident" id="6034771">Fprint</span><span class="op" id="6034777">(</span><span class="ident" id="6034778">w</span><span class="op" id="6034779">,</span>&nbsp;<span class="string" id="6034781">&#34;\n&#34;</span><span class="op" id="6034785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034789">if</span>&nbsp;<span class="ident" id="6034792">debug</span>&nbsp;<span class="op" id="6034798">&gt;</span>&nbsp;<span class="num" id="6034800">0</span>&nbsp;<span class="op" id="6034802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034807">printStackRecord</span><span class="op" id="6034823">(</span><span class="ident" id="6034824">w</span><span class="op" id="6034825">,</span>&nbsp;<span class="ident" id="6034827">r</span><span class="op" id="6034828">.</span><span class="ident" id="6034829">Stack</span><span class="op" id="6034834">(</span><span class="op" id="6034835">)</span><span class="op" id="6034836">,</span>&nbsp;<span class="builtintype" id="6034838">true</span><span class="op" id="6034842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034846">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034853">if</span>&nbsp;<span class="ident" id="6034856">tw</span>&nbsp;<span class="op" id="6034859">!=</span>&nbsp;<span class="ident" id="6034862">nil</span>&nbsp;<span class="op" id="6034866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034870">tw</span><span class="op" id="6034872">.</span><span class="ident" id="6034873">Flush</span><span class="op" id="6034878">(</span><span class="op" id="6034879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034882">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034885">return</span>&nbsp;<span class="ident" id="6034892">b</span><span class="op" id="6034893">.</span><span class="ident" id="6034894">Flush</span><span class="op" id="6034899">(</span><span class="op" id="6034900">)</span><br>
<span class="lineno"></span><span class="op" id="6034902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6034905">func</span>&nbsp;<span class="ident" id="6034910">runtime_cyclesPerSecond</span><span class="op" id="6034933">(</span><span class="op" id="6034934">)</span>&nbsp;<span class="ident" id="6034936">int64</span>
</div>
</body>
</html>
