<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8497374">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8497429">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8497483">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8497534">package</span>&nbsp;<span class="ident" id="8497542">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8497547">import</span>&nbsp;<span class="op" id="8497554">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8497557">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8497564">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8497570">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8497583">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8497594">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8497605">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8497612">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8497615">func</span>&nbsp;<span class="ident" id="8497620">isTimeout</span><span class="op" id="8497629">(</span><span class="ident" id="8497630">err</span>&nbsp;<span class="builtintype" id="8497634">error</span><span class="op" id="8497639">)</span>&nbsp;<span class="builtintype" id="8497641">bool</span>&nbsp;<span class="op" id="8497646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497649">e</span><span class="op" id="8497650">,</span>&nbsp;<span class="ident" id="8497652">ok</span>&nbsp;<span class="op" id="8497655">:=</span>&nbsp;<span class="ident" id="8497658">err</span><span class="op" id="8497661">.</span><span class="op" id="8497662">(</span><span class="ident" id="8497663">Error</span><span class="op" id="8497668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8497671">return</span>&nbsp;<span class="ident" id="8497678">ok</span>&nbsp;<span class="op" id="8497681">&amp;&amp;</span>&nbsp;<span class="ident" id="8497684">e</span><span class="op" id="8497685">.</span><span class="ident" id="8497686">Timeout</span><span class="op" id="8497693">(</span><span class="op" id="8497694">)</span><br>
<span class="lineno"></span><span class="op" id="8497696">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8497699">type</span>&nbsp;<span class="ident" id="8497704">copyRes</span>&nbsp;<span class="keyword" id="8497712">struct</span>&nbsp;<span class="op" id="8497719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497722">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8497726">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497733">err</span>&nbsp;<span class="builtintype" id="8497737">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497744">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8497748">time</span><span class="op" id="8497752">.</span><span class="ident" id="8497753">Duration</span><br>
<span class="lineno">25</span><span class="op" id="8497762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8497765">func</span>&nbsp;<span class="ident" id="8497770">TestAcceptTimeout</span><span class="op" id="8497787">(</span><span class="ident" id="8497788">t</span>&nbsp;<span class="op" id="8497790">*</span><span class="ident" id="8497791">testing</span><span class="op" id="8497798">.</span><span class="ident" id="8497799">T</span><span class="op" id="8497800">)</span>&nbsp;<span class="op" id="8497802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8497805">switch</span>&nbsp;<span class="ident" id="8497812">runtime</span><span class="op" id="8497819">.</span><span class="ident" id="8497820">GOOS</span>&nbsp;<span class="op" id="8497825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8497828">case</span>&nbsp;<span class="string" id="8497833">&#34;plan9&#34;</span><span class="op" id="8497840">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497844">t</span><span class="op" id="8497845">.</span><span class="ident" id="8497846">Skipf</span><span class="op" id="8497851">(</span><span class="string" id="8497852">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8497873">,</span>&nbsp;<span class="ident" id="8497875">runtime</span><span class="op" id="8497882">.</span><span class="ident" id="8497883">GOOS</span><span class="op" id="8497887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8497890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497894">ln</span>&nbsp;<span class="op" id="8497897">:=</span>&nbsp;<span class="ident" id="8497900">newLocalListener</span><span class="op" id="8497916">(</span><span class="ident" id="8497917">t</span><span class="op" id="8497918">)</span><span class="op" id="8497919">.</span><span class="op" id="8497920">(</span><span class="op" id="8497921">*</span><span class="ident" id="8497922">TCPListener</span><span class="op" id="8497933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8497936">defer</span>&nbsp;<span class="ident" id="8497942">ln</span><span class="op" id="8497944">.</span><span class="ident" id="8497945">Close</span><span class="op" id="8497950">(</span><span class="op" id="8497951">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8497954">ln</span><span class="op" id="8497956">.</span><span class="ident" id="8497957">SetDeadline</span><span class="op" id="8497968">(</span><span class="ident" id="8497969">time</span><span class="op" id="8497973">.</span><span class="ident" id="8497974">Now</span><span class="op" id="8497977">(</span><span class="op" id="8497978">)</span><span class="op" id="8497979">.</span><span class="ident" id="8497980">Add</span><span class="op" id="8497983">(</span><span class="op" id="8497984">-</span><span class="num" id="8497985">1</span>&nbsp;<span class="op" id="8497987">*</span>&nbsp;<span class="ident" id="8497989">time</span><span class="op" id="8497993">.</span><span class="ident" id="8497994">Second</span><span class="op" id="8498000">)</span><span class="op" id="8498001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498004">if</span>&nbsp;<span class="ident" id="8498007">_</span><span class="op" id="8498008">,</span>&nbsp;<span class="ident" id="8498010">err</span>&nbsp;<span class="op" id="8498014">:=</span>&nbsp;<span class="ident" id="8498017">ln</span><span class="op" id="8498019">.</span><span class="ident" id="8498020">Accept</span><span class="op" id="8498026">(</span><span class="op" id="8498027">)</span><span class="op" id="8498028">;</span>&nbsp;<span class="op" id="8498030">!</span><span class="ident" id="8498031">isTimeout</span><span class="op" id="8498040">(</span><span class="ident" id="8498041">err</span><span class="op" id="8498044">)</span>&nbsp;<span class="op" id="8498046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498050">t</span><span class="op" id="8498051">.</span><span class="ident" id="8498052">Fatalf</span><span class="op" id="8498058">(</span><span class="string" id="8498059">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8498092">,</span>&nbsp;<span class="ident" id="8498094">errTimeout</span><span class="op" id="8498104">,</span>&nbsp;<span class="ident" id="8498106">err</span><span class="op" id="8498109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498115">if</span>&nbsp;<span class="ident" id="8498118">_</span><span class="op" id="8498119">,</span>&nbsp;<span class="ident" id="8498121">err</span>&nbsp;<span class="op" id="8498125">:=</span>&nbsp;<span class="ident" id="8498128">ln</span><span class="op" id="8498130">.</span><span class="ident" id="8498131">Accept</span><span class="op" id="8498137">(</span><span class="op" id="8498138">)</span><span class="op" id="8498139">;</span>&nbsp;<span class="op" id="8498141">!</span><span class="ident" id="8498142">isTimeout</span><span class="op" id="8498151">(</span><span class="ident" id="8498152">err</span><span class="op" id="8498155">)</span>&nbsp;<span class="op" id="8498157">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498161">t</span><span class="op" id="8498162">.</span><span class="ident" id="8498163">Fatalf</span><span class="op" id="8498169">(</span><span class="string" id="8498170">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8498203">,</span>&nbsp;<span class="ident" id="8498205">errTimeout</span><span class="op" id="8498215">,</span>&nbsp;<span class="ident" id="8498217">err</span><span class="op" id="8498220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498226">ln</span><span class="op" id="8498228">.</span><span class="ident" id="8498229">SetDeadline</span><span class="op" id="8498240">(</span><span class="ident" id="8498241">time</span><span class="op" id="8498245">.</span><span class="ident" id="8498246">Now</span><span class="op" id="8498249">(</span><span class="op" id="8498250">)</span><span class="op" id="8498251">.</span><span class="ident" id="8498252">Add</span><span class="op" id="8498255">(</span><span class="num" id="8498256">100</span>&nbsp;<span class="op" id="8498260">*</span>&nbsp;<span class="ident" id="8498262">time</span><span class="op" id="8498266">.</span><span class="ident" id="8498267">Millisecond</span><span class="op" id="8498278">)</span><span class="op" id="8498279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498282">if</span>&nbsp;<span class="ident" id="8498285">_</span><span class="op" id="8498286">,</span>&nbsp;<span class="ident" id="8498288">err</span>&nbsp;<span class="op" id="8498292">:=</span>&nbsp;<span class="ident" id="8498295">ln</span><span class="op" id="8498297">.</span><span class="ident" id="8498298">Accept</span><span class="op" id="8498304">(</span><span class="op" id="8498305">)</span><span class="op" id="8498306">;</span>&nbsp;<span class="op" id="8498308">!</span><span class="ident" id="8498309">isTimeout</span><span class="op" id="8498318">(</span><span class="ident" id="8498319">err</span><span class="op" id="8498322">)</span>&nbsp;<span class="op" id="8498324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498328">t</span><span class="op" id="8498329">.</span><span class="ident" id="8498330">Fatalf</span><span class="op" id="8498336">(</span><span class="string" id="8498337">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8498370">,</span>&nbsp;<span class="ident" id="8498372">errTimeout</span><span class="op" id="8498382">,</span>&nbsp;<span class="ident" id="8498384">err</span><span class="op" id="8498387">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498393">if</span>&nbsp;<span class="ident" id="8498396">_</span><span class="op" id="8498397">,</span>&nbsp;<span class="ident" id="8498399">err</span>&nbsp;<span class="op" id="8498403">:=</span>&nbsp;<span class="ident" id="8498406">ln</span><span class="op" id="8498408">.</span><span class="ident" id="8498409">Accept</span><span class="op" id="8498415">(</span><span class="op" id="8498416">)</span><span class="op" id="8498417">;</span>&nbsp;<span class="op" id="8498419">!</span><span class="ident" id="8498420">isTimeout</span><span class="op" id="8498429">(</span><span class="ident" id="8498430">err</span><span class="op" id="8498433">)</span>&nbsp;<span class="op" id="8498435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498439">t</span><span class="op" id="8498440">.</span><span class="ident" id="8498441">Fatalf</span><span class="op" id="8498447">(</span><span class="string" id="8498448">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8498481">,</span>&nbsp;<span class="ident" id="8498483">errTimeout</span><span class="op" id="8498493">,</span>&nbsp;<span class="ident" id="8498495">err</span><span class="op" id="8498498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498504">ln</span><span class="op" id="8498506">.</span><span class="ident" id="8498507">SetDeadline</span><span class="op" id="8498518">(</span><span class="ident" id="8498519">noDeadline</span><span class="op" id="8498529">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498532">errc</span>&nbsp;<span class="op" id="8498537">:=</span>&nbsp;<span class="builtinfunc" id="8498540">make</span><span class="op" id="8498544">(</span><span class="keyword" id="8498545">chan</span>&nbsp;<span class="builtintype" id="8498550">error</span><span class="op" id="8498555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498558">go</span>&nbsp;<span class="keyword" id="8498561">func</span><span class="op" id="8498565">(</span><span class="op" id="8498566">)</span>&nbsp;<span class="op" id="8498568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498572">_</span><span class="op" id="8498573">,</span>&nbsp;<span class="ident" id="8498575">err</span>&nbsp;<span class="op" id="8498579">:=</span>&nbsp;<span class="ident" id="8498582">ln</span><span class="op" id="8498584">.</span><span class="ident" id="8498585">Accept</span><span class="op" id="8498591">(</span><span class="op" id="8498592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498596">errc</span>&nbsp;<span class="op" id="8498601">&lt;-</span>&nbsp;<span class="ident" id="8498604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498609">}</span><span class="op" id="8498610">(</span><span class="op" id="8498611">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498614">time</span><span class="op" id="8498618">.</span><span class="ident" id="8498619">Sleep</span><span class="op" id="8498624">(</span><span class="num" id="8498625">100</span>&nbsp;<span class="op" id="8498629">*</span>&nbsp;<span class="ident" id="8498631">time</span><span class="op" id="8498635">.</span><span class="ident" id="8498636">Millisecond</span><span class="op" id="8498647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498650">select</span>&nbsp;<span class="op" id="8498657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498660">case</span>&nbsp;<span class="ident" id="8498665">err</span>&nbsp;<span class="op" id="8498669">:=</span>&nbsp;<span class="op" id="8498672">&lt;-</span><span class="ident" id="8498674">errc</span><span class="op" id="8498678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498682">t</span><span class="op" id="8498683">.</span><span class="ident" id="8498684">Fatalf</span><span class="op" id="8498690">(</span><span class="string" id="8498691">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8498751">,</span>&nbsp;<span class="ident" id="8498753">err</span><span class="op" id="8498756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498759">default</span><span class="op" id="8498766">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498772">ln</span><span class="op" id="8498774">.</span><span class="ident" id="8498775">Close</span><span class="op" id="8498780">(</span><span class="op" id="8498781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498784">switch</span>&nbsp;<span class="ident" id="8498791">nerr</span>&nbsp;<span class="op" id="8498796">:=</span>&nbsp;<span class="op" id="8498799">&lt;-</span><span class="ident" id="8498801">errc</span><span class="op" id="8498805">;</span>&nbsp;<span class="ident" id="8498807">err</span>&nbsp;<span class="op" id="8498811">:=</span>&nbsp;<span class="ident" id="8498814">nerr</span><span class="op" id="8498818">.</span><span class="op" id="8498819">(</span><span class="keyword" id="8498820">type</span><span class="op" id="8498824">)</span>&nbsp;<span class="op" id="8498826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498829">case</span>&nbsp;<span class="op" id="8498834">*</span><span class="ident" id="8498835">OpError</span><span class="op" id="8498842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498846">if</span>&nbsp;<span class="ident" id="8498849">err</span><span class="op" id="8498852">.</span><span class="ident" id="8498853">Err</span>&nbsp;<span class="op" id="8498857">!=</span>&nbsp;<span class="ident" id="8498860">errClosing</span>&nbsp;<span class="op" id="8498871">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498876">t</span><span class="op" id="8498877">.</span><span class="ident" id="8498878">Fatalf</span><span class="op" id="8498884">(</span><span class="string" id="8498885">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8498918">,</span>&nbsp;<span class="ident" id="8498920">errClosing</span><span class="op" id="8498930">,</span>&nbsp;<span class="ident" id="8498932">err</span><span class="op" id="8498935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8498939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498942">default</span><span class="op" id="8498949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498953">if</span>&nbsp;<span class="ident" id="8498956">err</span>&nbsp;<span class="op" id="8498960">!=</span>&nbsp;<span class="ident" id="8498963">errClosing</span>&nbsp;<span class="op" id="8498974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8498979">t</span><span class="op" id="8498980">.</span><span class="ident" id="8498981">Fatalf</span><span class="op" id="8498987">(</span><span class="string" id="8498988">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8499021">,</span>&nbsp;<span class="ident" id="8499023">errClosing</span><span class="op" id="8499033">,</span>&nbsp;<span class="ident" id="8499035">err</span><span class="op" id="8499038">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499045">}</span><br>
<span class="lineno"></span><span class="op" id="8499047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8499050">func</span>&nbsp;<span class="ident" id="8499055">TestReadTimeout</span><span class="op" id="8499070">(</span><span class="ident" id="8499071">t</span>&nbsp;<span class="op" id="8499073">*</span><span class="ident" id="8499074">testing</span><span class="op" id="8499081">.</span><span class="ident" id="8499082">T</span><span class="op" id="8499083">)</span>&nbsp;<span class="op" id="8499085">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499088">switch</span>&nbsp;<span class="ident" id="8499095">runtime</span><span class="op" id="8499102">.</span><span class="ident" id="8499103">GOOS</span>&nbsp;<span class="op" id="8499108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499111">case</span>&nbsp;<span class="string" id="8499116">&#34;plan9&#34;</span><span class="op" id="8499123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499127">t</span><span class="op" id="8499128">.</span><span class="ident" id="8499129">Skipf</span><span class="op" id="8499134">(</span><span class="string" id="8499135">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8499156">,</span>&nbsp;<span class="ident" id="8499158">runtime</span><span class="op" id="8499165">.</span><span class="ident" id="8499166">GOOS</span><span class="op" id="8499170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499177">ln</span>&nbsp;<span class="op" id="8499180">:=</span>&nbsp;<span class="ident" id="8499183">newLocalListener</span><span class="op" id="8499199">(</span><span class="ident" id="8499200">t</span><span class="op" id="8499201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499204">defer</span>&nbsp;<span class="ident" id="8499210">ln</span><span class="op" id="8499212">.</span><span class="ident" id="8499213">Close</span><span class="op" id="8499218">(</span><span class="op" id="8499219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499222">c</span><span class="op" id="8499223">,</span>&nbsp;<span class="ident" id="8499225">err</span>&nbsp;<span class="op" id="8499229">:=</span>&nbsp;<span class="ident" id="8499232">DialTCP</span><span class="op" id="8499239">(</span><span class="string" id="8499240">&#34;tcp&#34;</span><span class="op" id="8499245">,</span>&nbsp;<span class="ident" id="8499247">nil</span><span class="op" id="8499250">,</span>&nbsp;<span class="ident" id="8499252">ln</span><span class="op" id="8499254">.</span><span class="ident" id="8499255">Addr</span><span class="op" id="8499259">(</span><span class="op" id="8499260">)</span><span class="op" id="8499261">.</span><span class="op" id="8499262">(</span><span class="op" id="8499263">*</span><span class="ident" id="8499264">TCPAddr</span><span class="op" id="8499271">)</span><span class="op" id="8499272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499275">if</span>&nbsp;<span class="ident" id="8499278">err</span>&nbsp;<span class="op" id="8499282">!=</span>&nbsp;<span class="ident" id="8499285">nil</span>&nbsp;<span class="op" id="8499289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499293">t</span><span class="op" id="8499294">.</span><span class="ident" id="8499295">Fatalf</span><span class="op" id="8499301">(</span><span class="string" id="8499302">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8499315">,</span>&nbsp;<span class="ident" id="8499317">err</span><span class="op" id="8499320">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499326">defer</span>&nbsp;<span class="ident" id="8499332">c</span><span class="op" id="8499333">.</span><span class="ident" id="8499334">Close</span><span class="op" id="8499339">(</span><span class="op" id="8499340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499343">c</span><span class="op" id="8499344">.</span><span class="ident" id="8499345">SetDeadline</span><span class="op" id="8499356">(</span><span class="ident" id="8499357">time</span><span class="op" id="8499361">.</span><span class="ident" id="8499362">Now</span><span class="op" id="8499365">(</span><span class="op" id="8499366">)</span><span class="op" id="8499367">.</span><span class="ident" id="8499368">Add</span><span class="op" id="8499371">(</span><span class="ident" id="8499372">time</span><span class="op" id="8499376">.</span><span class="ident" id="8499377">Hour</span><span class="op" id="8499381">)</span><span class="op" id="8499382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499385">c</span><span class="op" id="8499386">.</span><span class="ident" id="8499387">SetReadDeadline</span><span class="op" id="8499402">(</span><span class="ident" id="8499403">time</span><span class="op" id="8499407">.</span><span class="ident" id="8499408">Now</span><span class="op" id="8499411">(</span><span class="op" id="8499412">)</span><span class="op" id="8499413">.</span><span class="ident" id="8499414">Add</span><span class="op" id="8499417">(</span><span class="op" id="8499418">-</span><span class="num" id="8499419">1</span>&nbsp;<span class="op" id="8499421">*</span>&nbsp;<span class="ident" id="8499423">time</span><span class="op" id="8499427">.</span><span class="ident" id="8499428">Second</span><span class="op" id="8499434">)</span><span class="op" id="8499435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499438">buf</span>&nbsp;<span class="op" id="8499442">:=</span>&nbsp;<span class="builtinfunc" id="8499445">make</span><span class="op" id="8499449">(</span><span class="op" id="8499450">[</span><span class="op" id="8499451">]</span><span class="builtintype" id="8499452">byte</span><span class="op" id="8499456">,</span>&nbsp;<span class="num" id="8499458">1</span><span class="op" id="8499459">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499462">if</span>&nbsp;<span class="ident" id="8499465">_</span><span class="op" id="8499466">,</span>&nbsp;<span class="ident" id="8499468">err</span>&nbsp;<span class="op" id="8499472">=</span>&nbsp;<span class="ident" id="8499474">c</span><span class="op" id="8499475">.</span><span class="ident" id="8499476">Read</span><span class="op" id="8499480">(</span><span class="ident" id="8499481">buf</span><span class="op" id="8499484">)</span><span class="op" id="8499485">;</span>&nbsp;<span class="op" id="8499487">!</span><span class="ident" id="8499488">isTimeout</span><span class="op" id="8499497">(</span><span class="ident" id="8499498">err</span><span class="op" id="8499501">)</span>&nbsp;<span class="op" id="8499503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499507">t</span><span class="op" id="8499508">.</span><span class="ident" id="8499509">Fatalf</span><span class="op" id="8499515">(</span><span class="string" id="8499516">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8499547">,</span>&nbsp;<span class="ident" id="8499549">errTimeout</span><span class="op" id="8499559">,</span>&nbsp;<span class="ident" id="8499561">err</span><span class="op" id="8499564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499570">if</span>&nbsp;<span class="ident" id="8499573">_</span><span class="op" id="8499574">,</span>&nbsp;<span class="ident" id="8499576">err</span>&nbsp;<span class="op" id="8499580">=</span>&nbsp;<span class="ident" id="8499582">c</span><span class="op" id="8499583">.</span><span class="ident" id="8499584">Read</span><span class="op" id="8499588">(</span><span class="ident" id="8499589">buf</span><span class="op" id="8499592">)</span><span class="op" id="8499593">;</span>&nbsp;<span class="op" id="8499595">!</span><span class="ident" id="8499596">isTimeout</span><span class="op" id="8499605">(</span><span class="ident" id="8499606">err</span><span class="op" id="8499609">)</span>&nbsp;<span class="op" id="8499611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499615">t</span><span class="op" id="8499616">.</span><span class="ident" id="8499617">Fatalf</span><span class="op" id="8499623">(</span><span class="string" id="8499624">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8499655">,</span>&nbsp;<span class="ident" id="8499657">errTimeout</span><span class="op" id="8499667">,</span>&nbsp;<span class="ident" id="8499669">err</span><span class="op" id="8499672">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499678">c</span><span class="op" id="8499679">.</span><span class="ident" id="8499680">SetDeadline</span><span class="op" id="8499691">(</span><span class="ident" id="8499692">time</span><span class="op" id="8499696">.</span><span class="ident" id="8499697">Now</span><span class="op" id="8499700">(</span><span class="op" id="8499701">)</span><span class="op" id="8499702">.</span><span class="ident" id="8499703">Add</span><span class="op" id="8499706">(</span><span class="num" id="8499707">100</span>&nbsp;<span class="op" id="8499711">*</span>&nbsp;<span class="ident" id="8499713">time</span><span class="op" id="8499717">.</span><span class="ident" id="8499718">Millisecond</span><span class="op" id="8499729">)</span><span class="op" id="8499730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499733">if</span>&nbsp;<span class="ident" id="8499736">_</span><span class="op" id="8499737">,</span>&nbsp;<span class="ident" id="8499739">err</span>&nbsp;<span class="op" id="8499743">=</span>&nbsp;<span class="ident" id="8499745">c</span><span class="op" id="8499746">.</span><span class="ident" id="8499747">Read</span><span class="op" id="8499751">(</span><span class="ident" id="8499752">buf</span><span class="op" id="8499755">)</span><span class="op" id="8499756">;</span>&nbsp;<span class="op" id="8499758">!</span><span class="ident" id="8499759">isTimeout</span><span class="op" id="8499768">(</span><span class="ident" id="8499769">err</span><span class="op" id="8499772">)</span>&nbsp;<span class="op" id="8499774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499778">t</span><span class="op" id="8499779">.</span><span class="ident" id="8499780">Fatalf</span><span class="op" id="8499786">(</span><span class="string" id="8499787">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8499818">,</span>&nbsp;<span class="ident" id="8499820">errTimeout</span><span class="op" id="8499830">,</span>&nbsp;<span class="ident" id="8499832">err</span><span class="op" id="8499835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499838">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499841">if</span>&nbsp;<span class="ident" id="8499844">_</span><span class="op" id="8499845">,</span>&nbsp;<span class="ident" id="8499847">err</span>&nbsp;<span class="op" id="8499851">=</span>&nbsp;<span class="ident" id="8499853">c</span><span class="op" id="8499854">.</span><span class="ident" id="8499855">Read</span><span class="op" id="8499859">(</span><span class="ident" id="8499860">buf</span><span class="op" id="8499863">)</span><span class="op" id="8499864">;</span>&nbsp;<span class="op" id="8499866">!</span><span class="ident" id="8499867">isTimeout</span><span class="op" id="8499876">(</span><span class="ident" id="8499877">err</span><span class="op" id="8499880">)</span>&nbsp;<span class="op" id="8499882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499886">t</span><span class="op" id="8499887">.</span><span class="ident" id="8499888">Fatalf</span><span class="op" id="8499894">(</span><span class="string" id="8499895">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8499926">,</span>&nbsp;<span class="ident" id="8499928">errTimeout</span><span class="op" id="8499938">,</span>&nbsp;<span class="ident" id="8499940">err</span><span class="op" id="8499943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499949">c</span><span class="op" id="8499950">.</span><span class="ident" id="8499951">SetReadDeadline</span><span class="op" id="8499966">(</span><span class="ident" id="8499967">noDeadline</span><span class="op" id="8499977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499980">c</span><span class="op" id="8499981">.</span><span class="ident" id="8499982">SetWriteDeadline</span><span class="op" id="8499998">(</span><span class="ident" id="8499999">time</span><span class="op" id="8500003">.</span><span class="ident" id="8500004">Now</span><span class="op" id="8500007">(</span><span class="op" id="8500008">)</span><span class="op" id="8500009">.</span><span class="ident" id="8500010">Add</span><span class="op" id="8500013">(</span><span class="op" id="8500014">-</span><span class="num" id="8500015">1</span>&nbsp;<span class="op" id="8500017">*</span>&nbsp;<span class="ident" id="8500019">time</span><span class="op" id="8500023">.</span><span class="ident" id="8500024">Second</span><span class="op" id="8500030">)</span><span class="op" id="8500031">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500034">errc</span>&nbsp;<span class="op" id="8500039">:=</span>&nbsp;<span class="builtinfunc" id="8500042">make</span><span class="op" id="8500046">(</span><span class="keyword" id="8500047">chan</span>&nbsp;<span class="builtintype" id="8500052">error</span><span class="op" id="8500057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500060">go</span>&nbsp;<span class="keyword" id="8500063">func</span><span class="op" id="8500067">(</span><span class="op" id="8500068">)</span>&nbsp;<span class="op" id="8500070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500074">_</span><span class="op" id="8500075">,</span>&nbsp;<span class="ident" id="8500077">err</span>&nbsp;<span class="op" id="8500081">:=</span>&nbsp;<span class="ident" id="8500084">c</span><span class="op" id="8500085">.</span><span class="ident" id="8500086">Read</span><span class="op" id="8500090">(</span><span class="ident" id="8500091">buf</span><span class="op" id="8500094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500098">errc</span>&nbsp;<span class="op" id="8500103">&lt;-</span>&nbsp;<span class="ident" id="8500106">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500111">}</span><span class="op" id="8500112">(</span><span class="op" id="8500113">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500116">time</span><span class="op" id="8500120">.</span><span class="ident" id="8500121">Sleep</span><span class="op" id="8500126">(</span><span class="num" id="8500127">100</span>&nbsp;<span class="op" id="8500131">*</span>&nbsp;<span class="ident" id="8500133">time</span><span class="op" id="8500137">.</span><span class="ident" id="8500138">Millisecond</span><span class="op" id="8500149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500152">select</span>&nbsp;<span class="op" id="8500159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500162">case</span>&nbsp;<span class="ident" id="8500167">err</span>&nbsp;<span class="op" id="8500171">:=</span>&nbsp;<span class="op" id="8500174">&lt;-</span><span class="ident" id="8500176">errc</span><span class="op" id="8500180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500184">t</span><span class="op" id="8500185">.</span><span class="ident" id="8500186">Fatalf</span><span class="op" id="8500192">(</span><span class="string" id="8500193">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8500251">,</span>&nbsp;<span class="ident" id="8500253">err</span><span class="op" id="8500256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500259">default</span><span class="op" id="8500266">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500272">c</span><span class="op" id="8500273">.</span><span class="ident" id="8500274">Close</span><span class="op" id="8500279">(</span><span class="op" id="8500280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500283">switch</span>&nbsp;<span class="ident" id="8500290">nerr</span>&nbsp;<span class="op" id="8500295">:=</span>&nbsp;<span class="op" id="8500298">&lt;-</span><span class="ident" id="8500300">errc</span><span class="op" id="8500304">;</span>&nbsp;<span class="ident" id="8500306">err</span>&nbsp;<span class="op" id="8500310">:=</span>&nbsp;<span class="ident" id="8500313">nerr</span><span class="op" id="8500317">.</span><span class="op" id="8500318">(</span><span class="keyword" id="8500319">type</span><span class="op" id="8500323">)</span>&nbsp;<span class="op" id="8500325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500328">case</span>&nbsp;<span class="op" id="8500333">*</span><span class="ident" id="8500334">OpError</span><span class="op" id="8500341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500345">if</span>&nbsp;<span class="ident" id="8500348">err</span><span class="op" id="8500351">.</span><span class="ident" id="8500352">Err</span>&nbsp;<span class="op" id="8500356">!=</span>&nbsp;<span class="ident" id="8500359">errClosing</span>&nbsp;<span class="op" id="8500370">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500375">t</span><span class="op" id="8500376">.</span><span class="ident" id="8500377">Fatalf</span><span class="op" id="8500383">(</span><span class="string" id="8500384">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8500415">,</span>&nbsp;<span class="ident" id="8500417">errClosing</span><span class="op" id="8500427">,</span>&nbsp;<span class="ident" id="8500429">err</span><span class="op" id="8500432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500439">default</span><span class="op" id="8500446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500450">if</span>&nbsp;<span class="ident" id="8500453">err</span>&nbsp;<span class="op" id="8500457">==</span>&nbsp;<span class="ident" id="8500460">io</span><span class="op" id="8500462">.</span><span class="ident" id="8500463">EOF</span>&nbsp;<span class="op" id="8500467">&amp;&amp;</span>&nbsp;<span class="ident" id="8500470">runtime</span><span class="op" id="8500477">.</span><span class="ident" id="8500478">GOOS</span>&nbsp;<span class="op" id="8500483">==</span>&nbsp;<span class="string" id="8500486">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8500493">{</span>&nbsp;<span class="comment" id="8500495">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500537">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500549">if</span>&nbsp;<span class="ident" id="8500552">err</span>&nbsp;<span class="op" id="8500556">!=</span>&nbsp;<span class="ident" id="8500559">errClosing</span>&nbsp;<span class="op" id="8500570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500575">t</span><span class="op" id="8500576">.</span><span class="ident" id="8500577">Fatalf</span><span class="op" id="8500583">(</span><span class="string" id="8500584">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8500615">,</span>&nbsp;<span class="ident" id="8500617">errClosing</span><span class="op" id="8500627">,</span>&nbsp;<span class="ident" id="8500629">err</span><span class="op" id="8500632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500639">}</span><br>
<span class="lineno">130</span><span class="op" id="8500641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500644">func</span>&nbsp;<span class="ident" id="8500649">TestWriteTimeout</span><span class="op" id="8500665">(</span><span class="ident" id="8500666">t</span>&nbsp;<span class="op" id="8500668">*</span><span class="ident" id="8500669">testing</span><span class="op" id="8500676">.</span><span class="ident" id="8500677">T</span><span class="op" id="8500678">)</span>&nbsp;<span class="op" id="8500680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500683">switch</span>&nbsp;<span class="ident" id="8500690">runtime</span><span class="op" id="8500697">.</span><span class="ident" id="8500698">GOOS</span>&nbsp;<span class="op" id="8500703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500706">case</span>&nbsp;<span class="string" id="8500711">&#34;plan9&#34;</span><span class="op" id="8500718">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500722">t</span><span class="op" id="8500723">.</span><span class="ident" id="8500724">Skipf</span><span class="op" id="8500729">(</span><span class="string" id="8500730">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8500751">,</span>&nbsp;<span class="ident" id="8500753">runtime</span><span class="op" id="8500760">.</span><span class="ident" id="8500761">GOOS</span><span class="op" id="8500765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500772">ln</span>&nbsp;<span class="op" id="8500775">:=</span>&nbsp;<span class="ident" id="8500778">newLocalListener</span><span class="op" id="8500794">(</span><span class="ident" id="8500795">t</span><span class="op" id="8500796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500799">defer</span>&nbsp;<span class="ident" id="8500805">ln</span><span class="op" id="8500807">.</span><span class="ident" id="8500808">Close</span><span class="op" id="8500813">(</span><span class="op" id="8500814">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500817">c</span><span class="op" id="8500818">,</span>&nbsp;<span class="ident" id="8500820">err</span>&nbsp;<span class="op" id="8500824">:=</span>&nbsp;<span class="ident" id="8500827">DialTCP</span><span class="op" id="8500834">(</span><span class="string" id="8500835">&#34;tcp&#34;</span><span class="op" id="8500840">,</span>&nbsp;<span class="ident" id="8500842">nil</span><span class="op" id="8500845">,</span>&nbsp;<span class="ident" id="8500847">ln</span><span class="op" id="8500849">.</span><span class="ident" id="8500850">Addr</span><span class="op" id="8500854">(</span><span class="op" id="8500855">)</span><span class="op" id="8500856">.</span><span class="op" id="8500857">(</span><span class="op" id="8500858">*</span><span class="ident" id="8500859">TCPAddr</span><span class="op" id="8500866">)</span><span class="op" id="8500867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500870">if</span>&nbsp;<span class="ident" id="8500873">err</span>&nbsp;<span class="op" id="8500877">!=</span>&nbsp;<span class="ident" id="8500880">nil</span>&nbsp;<span class="op" id="8500884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500888">t</span><span class="op" id="8500889">.</span><span class="ident" id="8500890">Fatalf</span><span class="op" id="8500896">(</span><span class="string" id="8500897">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8500910">,</span>&nbsp;<span class="ident" id="8500912">err</span><span class="op" id="8500915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500921">defer</span>&nbsp;<span class="ident" id="8500927">c</span><span class="op" id="8500928">.</span><span class="ident" id="8500929">Close</span><span class="op" id="8500934">(</span><span class="op" id="8500935">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500938">c</span><span class="op" id="8500939">.</span><span class="ident" id="8500940">SetDeadline</span><span class="op" id="8500951">(</span><span class="ident" id="8500952">time</span><span class="op" id="8500956">.</span><span class="ident" id="8500957">Now</span><span class="op" id="8500960">(</span><span class="op" id="8500961">)</span><span class="op" id="8500962">.</span><span class="ident" id="8500963">Add</span><span class="op" id="8500966">(</span><span class="ident" id="8500967">time</span><span class="op" id="8500971">.</span><span class="ident" id="8500972">Hour</span><span class="op" id="8500976">)</span><span class="op" id="8500977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500980">c</span><span class="op" id="8500981">.</span><span class="ident" id="8500982">SetWriteDeadline</span><span class="op" id="8500998">(</span><span class="ident" id="8500999">time</span><span class="op" id="8501003">.</span><span class="ident" id="8501004">Now</span><span class="op" id="8501007">(</span><span class="op" id="8501008">)</span><span class="op" id="8501009">.</span><span class="ident" id="8501010">Add</span><span class="op" id="8501013">(</span><span class="op" id="8501014">-</span><span class="num" id="8501015">1</span>&nbsp;<span class="op" id="8501017">*</span>&nbsp;<span class="ident" id="8501019">time</span><span class="op" id="8501023">.</span><span class="ident" id="8501024">Second</span><span class="op" id="8501030">)</span><span class="op" id="8501031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501034">buf</span>&nbsp;<span class="op" id="8501038">:=</span>&nbsp;<span class="builtinfunc" id="8501041">make</span><span class="op" id="8501045">(</span><span class="op" id="8501046">[</span><span class="op" id="8501047">]</span><span class="builtintype" id="8501048">byte</span><span class="op" id="8501052">,</span>&nbsp;<span class="num" id="8501054">4096</span><span class="op" id="8501058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501061">writeUntilTimeout</span>&nbsp;<span class="op" id="8501079">:=</span>&nbsp;<span class="keyword" id="8501082">func</span><span class="op" id="8501086">(</span><span class="op" id="8501087">)</span>&nbsp;<span class="op" id="8501089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501093">for</span>&nbsp;<span class="op" id="8501097">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501102">_</span><span class="op" id="8501103">,</span>&nbsp;<span class="ident" id="8501105">err</span>&nbsp;<span class="op" id="8501109">:=</span>&nbsp;<span class="ident" id="8501112">c</span><span class="op" id="8501113">.</span><span class="ident" id="8501114">Write</span><span class="op" id="8501119">(</span><span class="ident" id="8501120">buf</span><span class="op" id="8501123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501128">if</span>&nbsp;<span class="ident" id="8501131">err</span>&nbsp;<span class="op" id="8501135">!=</span>&nbsp;<span class="ident" id="8501138">nil</span>&nbsp;<span class="op" id="8501142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501148">if</span>&nbsp;<span class="ident" id="8501151">isTimeout</span><span class="op" id="8501160">(</span><span class="ident" id="8501161">err</span><span class="op" id="8501164">)</span>&nbsp;<span class="op" id="8501166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501184">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501190">t</span><span class="op" id="8501191">.</span><span class="ident" id="8501192">Fatalf</span><span class="op" id="8501198">(</span><span class="string" id="8501199">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8501231">,</span>&nbsp;<span class="ident" id="8501233">errTimeout</span><span class="op" id="8501243">,</span>&nbsp;<span class="ident" id="8501245">err</span><span class="op" id="8501248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501263">writeUntilTimeout</span><span class="op" id="8501280">(</span><span class="op" id="8501281">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501284">c</span><span class="op" id="8501285">.</span><span class="ident" id="8501286">SetDeadline</span><span class="op" id="8501297">(</span><span class="ident" id="8501298">time</span><span class="op" id="8501302">.</span><span class="ident" id="8501303">Now</span><span class="op" id="8501306">(</span><span class="op" id="8501307">)</span><span class="op" id="8501308">.</span><span class="ident" id="8501309">Add</span><span class="op" id="8501312">(</span><span class="num" id="8501313">10</span>&nbsp;<span class="op" id="8501316">*</span>&nbsp;<span class="ident" id="8501318">time</span><span class="op" id="8501322">.</span><span class="ident" id="8501323">Millisecond</span><span class="op" id="8501334">)</span><span class="op" id="8501335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501338">writeUntilTimeout</span><span class="op" id="8501355">(</span><span class="op" id="8501356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501359">writeUntilTimeout</span><span class="op" id="8501376">(</span><span class="op" id="8501377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501380">c</span><span class="op" id="8501381">.</span><span class="ident" id="8501382">SetWriteDeadline</span><span class="op" id="8501398">(</span><span class="ident" id="8501399">noDeadline</span><span class="op" id="8501409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501412">c</span><span class="op" id="8501413">.</span><span class="ident" id="8501414">SetReadDeadline</span><span class="op" id="8501429">(</span><span class="ident" id="8501430">time</span><span class="op" id="8501434">.</span><span class="ident" id="8501435">Now</span><span class="op" id="8501438">(</span><span class="op" id="8501439">)</span><span class="op" id="8501440">.</span><span class="ident" id="8501441">Add</span><span class="op" id="8501444">(</span><span class="op" id="8501445">-</span><span class="num" id="8501446">1</span>&nbsp;<span class="op" id="8501448">*</span>&nbsp;<span class="ident" id="8501450">time</span><span class="op" id="8501454">.</span><span class="ident" id="8501455">Second</span><span class="op" id="8501461">)</span><span class="op" id="8501462">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501465">errc</span>&nbsp;<span class="op" id="8501470">:=</span>&nbsp;<span class="builtinfunc" id="8501473">make</span><span class="op" id="8501477">(</span><span class="keyword" id="8501478">chan</span>&nbsp;<span class="builtintype" id="8501483">error</span><span class="op" id="8501488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501491">go</span>&nbsp;<span class="keyword" id="8501494">func</span><span class="op" id="8501498">(</span><span class="op" id="8501499">)</span>&nbsp;<span class="op" id="8501501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501505">for</span>&nbsp;<span class="op" id="8501509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501514">_</span><span class="op" id="8501515">,</span>&nbsp;<span class="ident" id="8501517">err</span>&nbsp;<span class="op" id="8501521">:=</span>&nbsp;<span class="ident" id="8501524">c</span><span class="op" id="8501525">.</span><span class="ident" id="8501526">Write</span><span class="op" id="8501531">(</span><span class="ident" id="8501532">buf</span><span class="op" id="8501535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501540">if</span>&nbsp;<span class="ident" id="8501543">err</span>&nbsp;<span class="op" id="8501547">!=</span>&nbsp;<span class="ident" id="8501550">nil</span>&nbsp;<span class="op" id="8501554">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501560">errc</span>&nbsp;<span class="op" id="8501565">&lt;-</span>&nbsp;<span class="ident" id="8501568">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501582">}</span><span class="op" id="8501583">(</span><span class="op" id="8501584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501587">time</span><span class="op" id="8501591">.</span><span class="ident" id="8501592">Sleep</span><span class="op" id="8501597">(</span><span class="num" id="8501598">100</span>&nbsp;<span class="op" id="8501602">*</span>&nbsp;<span class="ident" id="8501604">time</span><span class="op" id="8501608">.</span><span class="ident" id="8501609">Millisecond</span><span class="op" id="8501620">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501623">select</span>&nbsp;<span class="op" id="8501630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501633">case</span>&nbsp;<span class="ident" id="8501638">err</span>&nbsp;<span class="op" id="8501642">:=</span>&nbsp;<span class="op" id="8501645">&lt;-</span><span class="ident" id="8501647">errc</span><span class="op" id="8501651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501655">t</span><span class="op" id="8501656">.</span><span class="ident" id="8501657">Fatalf</span><span class="op" id="8501663">(</span><span class="string" id="8501664">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8501723">,</span>&nbsp;<span class="ident" id="8501725">err</span><span class="op" id="8501728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501731">default</span><span class="op" id="8501738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501741">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501744">c</span><span class="op" id="8501745">.</span><span class="ident" id="8501746">Close</span><span class="op" id="8501751">(</span><span class="op" id="8501752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501755">switch</span>&nbsp;<span class="ident" id="8501762">nerr</span>&nbsp;<span class="op" id="8501767">:=</span>&nbsp;<span class="op" id="8501770">&lt;-</span><span class="ident" id="8501772">errc</span><span class="op" id="8501776">;</span>&nbsp;<span class="ident" id="8501778">err</span>&nbsp;<span class="op" id="8501782">:=</span>&nbsp;<span class="ident" id="8501785">nerr</span><span class="op" id="8501789">.</span><span class="op" id="8501790">(</span><span class="keyword" id="8501791">type</span><span class="op" id="8501795">)</span>&nbsp;<span class="op" id="8501797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501800">case</span>&nbsp;<span class="op" id="8501805">*</span><span class="ident" id="8501806">OpError</span><span class="op" id="8501813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501817">if</span>&nbsp;<span class="ident" id="8501820">err</span><span class="op" id="8501823">.</span><span class="ident" id="8501824">Err</span>&nbsp;<span class="op" id="8501828">!=</span>&nbsp;<span class="ident" id="8501831">errClosing</span>&nbsp;<span class="op" id="8501842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501847">t</span><span class="op" id="8501848">.</span><span class="ident" id="8501849">Fatalf</span><span class="op" id="8501855">(</span><span class="string" id="8501856">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8501888">,</span>&nbsp;<span class="ident" id="8501890">errClosing</span><span class="op" id="8501900">,</span>&nbsp;<span class="ident" id="8501902">err</span><span class="op" id="8501905">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501912">default</span><span class="op" id="8501919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501923">if</span>&nbsp;<span class="ident" id="8501926">err</span>&nbsp;<span class="op" id="8501930">!=</span>&nbsp;<span class="ident" id="8501933">errClosing</span>&nbsp;<span class="op" id="8501944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501949">t</span><span class="op" id="8501950">.</span><span class="ident" id="8501951">Fatalf</span><span class="op" id="8501957">(</span><span class="string" id="8501958">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8501990">,</span>&nbsp;<span class="ident" id="8501992">errClosing</span><span class="op" id="8502002">,</span>&nbsp;<span class="ident" id="8502004">err</span><span class="op" id="8502007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502011">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502014">}</span><br>
<span class="lineno"></span><span class="op" id="8502016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8502019">func</span>&nbsp;<span class="ident" id="8502024">testTimeout</span><span class="op" id="8502035">(</span><span class="ident" id="8502036">t</span>&nbsp;<span class="op" id="8502038">*</span><span class="ident" id="8502039">testing</span><span class="op" id="8502046">.</span><span class="ident" id="8502047">T</span><span class="op" id="8502048">,</span>&nbsp;<span class="ident" id="8502050">net</span><span class="op" id="8502053">,</span>&nbsp;<span class="ident" id="8502055">addr</span>&nbsp;<span class="builtintype" id="8502060">string</span><span class="op" id="8502066">,</span>&nbsp;<span class="ident" id="8502068">readFrom</span>&nbsp;<span class="builtintype" id="8502077">bool</span><span class="op" id="8502081">)</span>&nbsp;<span class="op" id="8502083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502086">c</span><span class="op" id="8502087">,</span>&nbsp;<span class="ident" id="8502089">err</span>&nbsp;<span class="op" id="8502093">:=</span>&nbsp;<span class="ident" id="8502096">Dial</span><span class="op" id="8502100">(</span><span class="ident" id="8502101">net</span><span class="op" id="8502104">,</span>&nbsp;<span class="ident" id="8502106">addr</span><span class="op" id="8502110">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502113">if</span>&nbsp;<span class="ident" id="8502116">err</span>&nbsp;<span class="op" id="8502120">!=</span>&nbsp;<span class="ident" id="8502123">nil</span>&nbsp;<span class="op" id="8502127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502131">t</span><span class="op" id="8502132">.</span><span class="ident" id="8502133">Errorf</span><span class="op" id="8502139">(</span><span class="string" id="8502140">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8502165">,</span>&nbsp;<span class="ident" id="8502167">net</span><span class="op" id="8502170">,</span>&nbsp;<span class="ident" id="8502172">addr</span><span class="op" id="8502176">,</span>&nbsp;<span class="ident" id="8502178">err</span><span class="op" id="8502181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502185">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502196">defer</span>&nbsp;<span class="ident" id="8502202">c</span><span class="op" id="8502203">.</span><span class="ident" id="8502204">Close</span><span class="op" id="8502209">(</span><span class="op" id="8502210">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502213">what</span>&nbsp;<span class="op" id="8502218">:=</span>&nbsp;<span class="string" id="8502221">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502229">if</span>&nbsp;<span class="ident" id="8502232">readFrom</span>&nbsp;<span class="op" id="8502241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502245">what</span>&nbsp;<span class="op" id="8502250">=</span>&nbsp;<span class="string" id="8502252">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502268">errc</span>&nbsp;<span class="op" id="8502273">:=</span>&nbsp;<span class="builtinfunc" id="8502276">make</span><span class="op" id="8502280">(</span><span class="keyword" id="8502281">chan</span>&nbsp;<span class="builtintype" id="8502286">error</span><span class="op" id="8502291">,</span>&nbsp;<span class="num" id="8502293">1</span><span class="op" id="8502294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502297">go</span>&nbsp;<span class="keyword" id="8502300">func</span><span class="op" id="8502304">(</span><span class="op" id="8502305">)</span>&nbsp;<span class="op" id="8502307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502311">t0</span>&nbsp;<span class="op" id="8502314">:=</span>&nbsp;<span class="ident" id="8502317">time</span><span class="op" id="8502321">.</span><span class="ident" id="8502322">Now</span><span class="op" id="8502325">(</span><span class="op" id="8502326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502330">c</span><span class="op" id="8502331">.</span><span class="ident" id="8502332">SetReadDeadline</span><span class="op" id="8502347">(</span><span class="ident" id="8502348">time</span><span class="op" id="8502352">.</span><span class="ident" id="8502353">Now</span><span class="op" id="8502356">(</span><span class="op" id="8502357">)</span><span class="op" id="8502358">.</span><span class="ident" id="8502359">Add</span><span class="op" id="8502362">(</span><span class="num" id="8502363">100</span>&nbsp;<span class="op" id="8502367">*</span>&nbsp;<span class="ident" id="8502369">time</span><span class="op" id="8502373">.</span><span class="ident" id="8502374">Millisecond</span><span class="op" id="8502385">)</span><span class="op" id="8502386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502390">var</span>&nbsp;<span class="ident" id="8502394">b</span>&nbsp;<span class="op" id="8502396">[</span><span class="num" id="8502397">100</span><span class="op" id="8502400">]</span><span class="builtintype" id="8502401">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502408">var</span>&nbsp;<span class="ident" id="8502412">n</span>&nbsp;<span class="builtintype" id="8502414">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502420">var</span>&nbsp;<span class="ident" id="8502424">err</span>&nbsp;<span class="builtintype" id="8502428">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502436">if</span>&nbsp;<span class="ident" id="8502439">readFrom</span>&nbsp;<span class="op" id="8502448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502453">n</span><span class="op" id="8502454">,</span>&nbsp;<span class="ident" id="8502456">_</span><span class="op" id="8502457">,</span>&nbsp;<span class="ident" id="8502459">err</span>&nbsp;<span class="op" id="8502463">=</span>&nbsp;<span class="ident" id="8502465">c</span><span class="op" id="8502466">.</span><span class="op" id="8502467">(</span><span class="ident" id="8502468">PacketConn</span><span class="op" id="8502478">)</span><span class="op" id="8502479">.</span><span class="ident" id="8502480">ReadFrom</span><span class="op" id="8502488">(</span><span class="ident" id="8502489">b</span><span class="op" id="8502490">[</span><span class="num" id="8502491">0</span><span class="op" id="8502492">:</span><span class="op" id="8502493">]</span><span class="op" id="8502494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502498">}</span>&nbsp;<span class="keyword" id="8502500">else</span>&nbsp;<span class="op" id="8502505">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502510">n</span><span class="op" id="8502511">,</span>&nbsp;<span class="ident" id="8502513">err</span>&nbsp;<span class="op" id="8502517">=</span>&nbsp;<span class="ident" id="8502519">c</span><span class="op" id="8502520">.</span><span class="ident" id="8502521">Read</span><span class="op" id="8502525">(</span><span class="ident" id="8502526">b</span><span class="op" id="8502527">[</span><span class="num" id="8502528">0</span><span class="op" id="8502529">:</span><span class="op" id="8502530">]</span><span class="op" id="8502531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502539">t1</span>&nbsp;<span class="op" id="8502542">:=</span>&nbsp;<span class="ident" id="8502545">time</span><span class="op" id="8502549">.</span><span class="ident" id="8502550">Now</span><span class="op" id="8502553">(</span><span class="op" id="8502554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502558">if</span>&nbsp;<span class="ident" id="8502561">n</span>&nbsp;<span class="op" id="8502563">!=</span>&nbsp;<span class="num" id="8502566">0</span>&nbsp;<span class="op" id="8502568">||</span>&nbsp;<span class="ident" id="8502571">err</span>&nbsp;<span class="op" id="8502575">==</span>&nbsp;<span class="ident" id="8502578">nil</span>&nbsp;<span class="op" id="8502582">||</span>&nbsp;<span class="op" id="8502585">!</span><span class="ident" id="8502586">err</span><span class="op" id="8502589">.</span><span class="op" id="8502590">(</span><span class="ident" id="8502591">Error</span><span class="op" id="8502596">)</span><span class="op" id="8502597">.</span><span class="ident" id="8502598">Timeout</span><span class="op" id="8502605">(</span><span class="op" id="8502606">)</span>&nbsp;<span class="op" id="8502608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502613">errc</span>&nbsp;<span class="op" id="8502618">&lt;-</span>&nbsp;<span class="ident" id="8502621">fmt</span><span class="op" id="8502624">.</span><span class="ident" id="8502625">Errorf</span><span class="op" id="8502631">(</span><span class="string" id="8502632">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8502678">,</span>&nbsp;<span class="ident" id="8502680">what</span><span class="op" id="8502684">,</span>&nbsp;<span class="ident" id="8502686">net</span><span class="op" id="8502689">,</span>&nbsp;<span class="ident" id="8502691">addr</span><span class="op" id="8502695">,</span>&nbsp;<span class="ident" id="8502697">n</span><span class="op" id="8502698">,</span>&nbsp;<span class="ident" id="8502700">err</span><span class="op" id="8502703">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502721">if</span>&nbsp;<span class="ident" id="8502724">dt</span>&nbsp;<span class="op" id="8502727">:=</span>&nbsp;<span class="ident" id="8502730">t1</span><span class="op" id="8502732">.</span><span class="ident" id="8502733">Sub</span><span class="op" id="8502736">(</span><span class="ident" id="8502737">t0</span><span class="op" id="8502739">)</span><span class="op" id="8502740">;</span>&nbsp;<span class="ident" id="8502742">dt</span>&nbsp;<span class="op" id="8502745">&lt;</span>&nbsp;<span class="num" id="8502747">50</span><span class="op" id="8502749">*</span><span class="ident" id="8502750">time</span><span class="op" id="8502754">.</span><span class="ident" id="8502755">Millisecond</span>&nbsp;<span class="op" id="8502767">||</span>&nbsp;<span class="op" id="8502770">!</span><span class="ident" id="8502771">testing</span><span class="op" id="8502778">.</span><span class="ident" id="8502779">Short</span><span class="op" id="8502784">(</span><span class="op" id="8502785">)</span>&nbsp;<span class="op" id="8502787">&amp;&amp;</span>&nbsp;<span class="ident" id="8502790">dt</span>&nbsp;<span class="op" id="8502793">&gt;</span>&nbsp;<span class="num" id="8502795">250</span><span class="op" id="8502798">*</span><span class="ident" id="8502799">time</span><span class="op" id="8502803">.</span><span class="ident" id="8502804">Millisecond</span>&nbsp;<span class="op" id="8502816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502821">errc</span>&nbsp;<span class="op" id="8502826">&lt;-</span>&nbsp;<span class="ident" id="8502829">fmt</span><span class="op" id="8502832">.</span><span class="ident" id="8502833">Errorf</span><span class="op" id="8502839">(</span><span class="string" id="8502840">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8502875">,</span>&nbsp;<span class="ident" id="8502877">what</span><span class="op" id="8502881">,</span>&nbsp;<span class="ident" id="8502883">net</span><span class="op" id="8502886">,</span>&nbsp;<span class="ident" id="8502888">addr</span><span class="op" id="8502892">,</span>&nbsp;<span class="ident" id="8502894">dt</span><span class="op" id="8502896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502901">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502914">errc</span>&nbsp;<span class="op" id="8502919">&lt;-</span>&nbsp;<span class="ident" id="8502922">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502927">}</span><span class="op" id="8502928">(</span><span class="op" id="8502929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502932">select</span>&nbsp;<span class="op" id="8502939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502942">case</span>&nbsp;<span class="ident" id="8502947">err</span>&nbsp;<span class="op" id="8502951">:=</span>&nbsp;<span class="op" id="8502954">&lt;-</span><span class="ident" id="8502956">errc</span><span class="op" id="8502960">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502964">if</span>&nbsp;<span class="ident" id="8502967">err</span>&nbsp;<span class="op" id="8502971">!=</span>&nbsp;<span class="ident" id="8502974">nil</span>&nbsp;<span class="op" id="8502978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502983">t</span><span class="op" id="8502984">.</span><span class="ident" id="8502985">Error</span><span class="op" id="8502990">(</span><span class="ident" id="8502991">err</span><span class="op" id="8502994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503001">case</span>&nbsp;<span class="op" id="8503006">&lt;-</span><span class="ident" id="8503008">time</span><span class="op" id="8503012">.</span><span class="ident" id="8503013">After</span><span class="op" id="8503018">(</span><span class="num" id="8503019">1</span>&nbsp;<span class="op" id="8503021">*</span>&nbsp;<span class="ident" id="8503023">time</span><span class="op" id="8503027">.</span><span class="ident" id="8503028">Second</span><span class="op" id="8503034">)</span><span class="op" id="8503035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503039">t</span><span class="op" id="8503040">.</span><span class="ident" id="8503041">Errorf</span><span class="op" id="8503047">(</span><span class="string" id="8503048">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8503094">,</span>&nbsp;<span class="ident" id="8503096">what</span><span class="op" id="8503100">,</span>&nbsp;<span class="ident" id="8503102">net</span><span class="op" id="8503105">,</span>&nbsp;<span class="ident" id="8503107">addr</span><span class="op" id="8503111">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503114">}</span><br>
<span class="lineno"></span><span class="op" id="8503116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8503119">func</span>&nbsp;<span class="ident" id="8503124">TestTimeoutUDP</span><span class="op" id="8503138">(</span><span class="ident" id="8503139">t</span>&nbsp;<span class="op" id="8503141">*</span><span class="ident" id="8503142">testing</span><span class="op" id="8503149">.</span><span class="ident" id="8503150">T</span><span class="op" id="8503151">)</span>&nbsp;<span class="op" id="8503153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503156">switch</span>&nbsp;<span class="ident" id="8503163">runtime</span><span class="op" id="8503170">.</span><span class="ident" id="8503171">GOOS</span>&nbsp;<span class="op" id="8503176">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503179">case</span>&nbsp;<span class="string" id="8503184">&#34;plan9&#34;</span><span class="op" id="8503191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503195">t</span><span class="op" id="8503196">.</span><span class="ident" id="8503197">Skipf</span><span class="op" id="8503202">(</span><span class="string" id="8503203">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8503224">,</span>&nbsp;<span class="ident" id="8503226">runtime</span><span class="op" id="8503233">.</span><span class="ident" id="8503234">GOOS</span><span class="op" id="8503238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8503245">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503288">listening</span>&nbsp;<span class="op" id="8503298">:=</span>&nbsp;<span class="builtinfunc" id="8503301">make</span><span class="op" id="8503305">(</span><span class="keyword" id="8503306">chan</span>&nbsp;<span class="builtintype" id="8503311">string</span><span class="op" id="8503317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503320">done</span>&nbsp;<span class="op" id="8503325">:=</span>&nbsp;<span class="builtinfunc" id="8503328">make</span><span class="op" id="8503332">(</span><span class="keyword" id="8503333">chan</span>&nbsp;<span class="builtintype" id="8503338">int</span><span class="op" id="8503341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503344">go</span>&nbsp;<span class="ident" id="8503347">runDatagramPacketConnServer</span><span class="op" id="8503374">(</span><span class="ident" id="8503375">t</span><span class="op" id="8503376">,</span>&nbsp;<span class="string" id="8503378">&#34;udp&#34;</span><span class="op" id="8503383">,</span>&nbsp;<span class="string" id="8503385">&#34;127.0.0.1:0&#34;</span><span class="op" id="8503398">,</span>&nbsp;<span class="ident" id="8503400">listening</span><span class="op" id="8503409">,</span>&nbsp;<span class="ident" id="8503411">done</span><span class="op" id="8503415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503418">addr</span>&nbsp;<span class="op" id="8503423">:=</span>&nbsp;<span class="op" id="8503426">&lt;-</span><span class="ident" id="8503428">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503440">testTimeout</span><span class="op" id="8503451">(</span><span class="ident" id="8503452">t</span><span class="op" id="8503453">,</span>&nbsp;<span class="string" id="8503455">&#34;udp&#34;</span><span class="op" id="8503460">,</span>&nbsp;<span class="ident" id="8503462">addr</span><span class="op" id="8503466">,</span>&nbsp;<span class="builtintype" id="8503468">false</span><span class="op" id="8503473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503476">testTimeout</span><span class="op" id="8503487">(</span><span class="ident" id="8503488">t</span><span class="op" id="8503489">,</span>&nbsp;<span class="string" id="8503491">&#34;udp&#34;</span><span class="op" id="8503496">,</span>&nbsp;<span class="ident" id="8503498">addr</span><span class="op" id="8503502">,</span>&nbsp;<span class="builtintype" id="8503504">true</span><span class="op" id="8503508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503511">&lt;-</span><span class="ident" id="8503513">done</span><br>
<span class="lineno"></span><span class="op" id="8503518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="8503521">func</span>&nbsp;<span class="ident" id="8503526">TestTimeoutTCP</span><span class="op" id="8503540">(</span><span class="ident" id="8503541">t</span>&nbsp;<span class="op" id="8503543">*</span><span class="ident" id="8503544">testing</span><span class="op" id="8503551">.</span><span class="ident" id="8503552">T</span><span class="op" id="8503553">)</span>&nbsp;<span class="op" id="8503555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503558">switch</span>&nbsp;<span class="ident" id="8503565">runtime</span><span class="op" id="8503572">.</span><span class="ident" id="8503573">GOOS</span>&nbsp;<span class="op" id="8503578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503581">case</span>&nbsp;<span class="string" id="8503586">&#34;plan9&#34;</span><span class="op" id="8503593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503597">t</span><span class="op" id="8503598">.</span><span class="ident" id="8503599">Skipf</span><span class="op" id="8503604">(</span><span class="string" id="8503605">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8503626">,</span>&nbsp;<span class="ident" id="8503628">runtime</span><span class="op" id="8503635">.</span><span class="ident" id="8503636">GOOS</span><span class="op" id="8503640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503643">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8503647">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503690">listening</span>&nbsp;<span class="op" id="8503700">:=</span>&nbsp;<span class="builtinfunc" id="8503703">make</span><span class="op" id="8503707">(</span><span class="keyword" id="8503708">chan</span>&nbsp;<span class="builtintype" id="8503713">string</span><span class="op" id="8503719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503722">done</span>&nbsp;<span class="op" id="8503727">:=</span>&nbsp;<span class="builtinfunc" id="8503730">make</span><span class="op" id="8503734">(</span><span class="keyword" id="8503735">chan</span>&nbsp;<span class="builtintype" id="8503740">int</span><span class="op" id="8503743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503746">go</span>&nbsp;<span class="ident" id="8503749">runStreamConnServer</span><span class="op" id="8503768">(</span><span class="ident" id="8503769">t</span><span class="op" id="8503770">,</span>&nbsp;<span class="string" id="8503772">&#34;tcp&#34;</span><span class="op" id="8503777">,</span>&nbsp;<span class="string" id="8503779">&#34;127.0.0.1:0&#34;</span><span class="op" id="8503792">,</span>&nbsp;<span class="ident" id="8503794">listening</span><span class="op" id="8503803">,</span>&nbsp;<span class="ident" id="8503805">done</span><span class="op" id="8503809">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503812">addr</span>&nbsp;<span class="op" id="8503817">:=</span>&nbsp;<span class="op" id="8503820">&lt;-</span><span class="ident" id="8503822">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503834">testTimeout</span><span class="op" id="8503845">(</span><span class="ident" id="8503846">t</span><span class="op" id="8503847">,</span>&nbsp;<span class="string" id="8503849">&#34;tcp&#34;</span><span class="op" id="8503854">,</span>&nbsp;<span class="ident" id="8503856">addr</span><span class="op" id="8503860">,</span>&nbsp;<span class="builtintype" id="8503862">false</span><span class="op" id="8503867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8503870">&lt;-</span><span class="ident" id="8503872">done</span><br>
<span class="lineno"></span><span class="op" id="8503877">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8503880">func</span>&nbsp;<span class="ident" id="8503885">TestDeadlineReset</span><span class="op" id="8503902">(</span><span class="ident" id="8503903">t</span>&nbsp;<span class="op" id="8503905">*</span><span class="ident" id="8503906">testing</span><span class="op" id="8503913">.</span><span class="ident" id="8503914">T</span><span class="op" id="8503915">)</span>&nbsp;<span class="op" id="8503917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503920">switch</span>&nbsp;<span class="ident" id="8503927">runtime</span><span class="op" id="8503934">.</span><span class="ident" id="8503935">GOOS</span>&nbsp;<span class="op" id="8503940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8503943">case</span>&nbsp;<span class="string" id="8503948">&#34;plan9&#34;</span><span class="op" id="8503955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503959">t</span><span class="op" id="8503960">.</span><span class="ident" id="8503961">Skipf</span><span class="op" id="8503966">(</span><span class="string" id="8503967">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8503988">,</span>&nbsp;<span class="ident" id="8503990">runtime</span><span class="op" id="8503997">.</span><span class="ident" id="8503998">GOOS</span><span class="op" id="8504002">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504008">ln</span><span class="op" id="8504010">,</span>&nbsp;<span class="ident" id="8504012">err</span>&nbsp;<span class="op" id="8504016">:=</span>&nbsp;<span class="ident" id="8504019">Listen</span><span class="op" id="8504025">(</span><span class="string" id="8504026">&#34;tcp&#34;</span><span class="op" id="8504031">,</span>&nbsp;<span class="string" id="8504033">&#34;127.0.0.1:0&#34;</span><span class="op" id="8504046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504049">if</span>&nbsp;<span class="ident" id="8504052">err</span>&nbsp;<span class="op" id="8504056">!=</span>&nbsp;<span class="ident" id="8504059">nil</span>&nbsp;<span class="op" id="8504063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504067">t</span><span class="op" id="8504068">.</span><span class="ident" id="8504069">Fatal</span><span class="op" id="8504074">(</span><span class="ident" id="8504075">err</span><span class="op" id="8504078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504081">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504084">defer</span>&nbsp;<span class="ident" id="8504090">ln</span><span class="op" id="8504092">.</span><span class="ident" id="8504093">Close</span><span class="op" id="8504098">(</span><span class="op" id="8504099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504102">tl</span>&nbsp;<span class="op" id="8504105">:=</span>&nbsp;<span class="ident" id="8504108">ln</span><span class="op" id="8504110">.</span><span class="op" id="8504111">(</span><span class="op" id="8504112">*</span><span class="ident" id="8504113">TCPListener</span><span class="op" id="8504124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504127">tl</span><span class="op" id="8504129">.</span><span class="ident" id="8504130">SetDeadline</span><span class="op" id="8504141">(</span><span class="ident" id="8504142">time</span><span class="op" id="8504146">.</span><span class="ident" id="8504147">Now</span><span class="op" id="8504150">(</span><span class="op" id="8504151">)</span><span class="op" id="8504152">.</span><span class="ident" id="8504153">Add</span><span class="op" id="8504156">(</span><span class="num" id="8504157">1</span>&nbsp;<span class="op" id="8504159">*</span>&nbsp;<span class="ident" id="8504161">time</span><span class="op" id="8504165">.</span><span class="ident" id="8504166">Minute</span><span class="op" id="8504172">)</span><span class="op" id="8504173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504176">tl</span><span class="op" id="8504178">.</span><span class="ident" id="8504179">SetDeadline</span><span class="op" id="8504190">(</span><span class="ident" id="8504191">noDeadline</span><span class="op" id="8504201">)</span>&nbsp;<span class="comment" id="8504203">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504216">errc</span>&nbsp;<span class="op" id="8504221">:=</span>&nbsp;<span class="builtinfunc" id="8504224">make</span><span class="op" id="8504228">(</span><span class="keyword" id="8504229">chan</span>&nbsp;<span class="builtintype" id="8504234">error</span><span class="op" id="8504239">,</span>&nbsp;<span class="num" id="8504241">1</span><span class="op" id="8504242">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504245">go</span>&nbsp;<span class="keyword" id="8504248">func</span><span class="op" id="8504252">(</span><span class="op" id="8504253">)</span>&nbsp;<span class="op" id="8504255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504259">_</span><span class="op" id="8504260">,</span>&nbsp;<span class="ident" id="8504262">err</span>&nbsp;<span class="op" id="8504266">:=</span>&nbsp;<span class="ident" id="8504269">ln</span><span class="op" id="8504271">.</span><span class="ident" id="8504272">Accept</span><span class="op" id="8504278">(</span><span class="op" id="8504279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504283">errc</span>&nbsp;<span class="op" id="8504288">&lt;-</span>&nbsp;<span class="ident" id="8504291">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504296">}</span><span class="op" id="8504297">(</span><span class="op" id="8504298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504301">select</span>&nbsp;<span class="op" id="8504308">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504311">case</span>&nbsp;<span class="op" id="8504316">&lt;-</span><span class="ident" id="8504318">time</span><span class="op" id="8504322">.</span><span class="ident" id="8504323">After</span><span class="op" id="8504328">(</span><span class="num" id="8504329">50</span>&nbsp;<span class="op" id="8504332">*</span>&nbsp;<span class="ident" id="8504334">time</span><span class="op" id="8504338">.</span><span class="ident" id="8504339">Millisecond</span><span class="op" id="8504350">)</span><span class="op" id="8504351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8504355">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504365">case</span>&nbsp;<span class="ident" id="8504370">err</span>&nbsp;<span class="op" id="8504374">:=</span>&nbsp;<span class="op" id="8504377">&lt;-</span><span class="ident" id="8504379">errc</span><span class="op" id="8504383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8504387">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8504429">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504451">t</span><span class="op" id="8504452">.</span><span class="ident" id="8504453">Errorf</span><span class="op" id="8504459">(</span><span class="string" id="8504460">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="8504499">,</span>&nbsp;<span class="ident" id="8504501">err</span><span class="op" id="8504504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504507">}</span><br>
<span class="lineno"></span><span class="op" id="8504509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8504512">func</span>&nbsp;<span class="ident" id="8504517">TestTimeoutAccept</span><span class="op" id="8504534">(</span><span class="ident" id="8504535">t</span>&nbsp;<span class="op" id="8504537">*</span><span class="ident" id="8504538">testing</span><span class="op" id="8504545">.</span><span class="ident" id="8504546">T</span><span class="op" id="8504547">)</span>&nbsp;<span class="op" id="8504549">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504552">switch</span>&nbsp;<span class="ident" id="8504559">runtime</span><span class="op" id="8504566">.</span><span class="ident" id="8504567">GOOS</span>&nbsp;<span class="op" id="8504572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504575">case</span>&nbsp;<span class="string" id="8504580">&#34;plan9&#34;</span><span class="op" id="8504587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504591">t</span><span class="op" id="8504592">.</span><span class="ident" id="8504593">Skipf</span><span class="op" id="8504598">(</span><span class="string" id="8504599">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8504620">,</span>&nbsp;<span class="ident" id="8504622">runtime</span><span class="op" id="8504629">.</span><span class="ident" id="8504630">GOOS</span><span class="op" id="8504634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504640">ln</span><span class="op" id="8504642">,</span>&nbsp;<span class="ident" id="8504644">err</span>&nbsp;<span class="op" id="8504648">:=</span>&nbsp;<span class="ident" id="8504651">Listen</span><span class="op" id="8504657">(</span><span class="string" id="8504658">&#34;tcp&#34;</span><span class="op" id="8504663">,</span>&nbsp;<span class="string" id="8504665">&#34;127.0.0.1:0&#34;</span><span class="op" id="8504678">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504681">if</span>&nbsp;<span class="ident" id="8504684">err</span>&nbsp;<span class="op" id="8504688">!=</span>&nbsp;<span class="ident" id="8504691">nil</span>&nbsp;<span class="op" id="8504695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504699">t</span><span class="op" id="8504700">.</span><span class="ident" id="8504701">Fatal</span><span class="op" id="8504706">(</span><span class="ident" id="8504707">err</span><span class="op" id="8504710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504716">defer</span>&nbsp;<span class="ident" id="8504722">ln</span><span class="op" id="8504724">.</span><span class="ident" id="8504725">Close</span><span class="op" id="8504730">(</span><span class="op" id="8504731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504734">tl</span>&nbsp;<span class="op" id="8504737">:=</span>&nbsp;<span class="ident" id="8504740">ln</span><span class="op" id="8504742">.</span><span class="op" id="8504743">(</span><span class="op" id="8504744">*</span><span class="ident" id="8504745">TCPListener</span><span class="op" id="8504756">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504759">tl</span><span class="op" id="8504761">.</span><span class="ident" id="8504762">SetDeadline</span><span class="op" id="8504773">(</span><span class="ident" id="8504774">time</span><span class="op" id="8504778">.</span><span class="ident" id="8504779">Now</span><span class="op" id="8504782">(</span><span class="op" id="8504783">)</span><span class="op" id="8504784">.</span><span class="ident" id="8504785">Add</span><span class="op" id="8504788">(</span><span class="num" id="8504789">100</span>&nbsp;<span class="op" id="8504793">*</span>&nbsp;<span class="ident" id="8504795">time</span><span class="op" id="8504799">.</span><span class="ident" id="8504800">Millisecond</span><span class="op" id="8504811">)</span><span class="op" id="8504812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504815">errc</span>&nbsp;<span class="op" id="8504820">:=</span>&nbsp;<span class="builtinfunc" id="8504823">make</span><span class="op" id="8504827">(</span><span class="keyword" id="8504828">chan</span>&nbsp;<span class="builtintype" id="8504833">error</span><span class="op" id="8504838">,</span>&nbsp;<span class="num" id="8504840">1</span><span class="op" id="8504841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504844">go</span>&nbsp;<span class="keyword" id="8504847">func</span><span class="op" id="8504851">(</span><span class="op" id="8504852">)</span>&nbsp;<span class="op" id="8504854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504858">_</span><span class="op" id="8504859">,</span>&nbsp;<span class="ident" id="8504861">err</span>&nbsp;<span class="op" id="8504865">:=</span>&nbsp;<span class="ident" id="8504868">ln</span><span class="op" id="8504870">.</span><span class="ident" id="8504871">Accept</span><span class="op" id="8504877">(</span><span class="op" id="8504878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504882">errc</span>&nbsp;<span class="op" id="8504887">&lt;-</span>&nbsp;<span class="ident" id="8504890">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504895">}</span><span class="op" id="8504896">(</span><span class="op" id="8504897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504900">select</span>&nbsp;<span class="op" id="8504907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8504910">case</span>&nbsp;<span class="op" id="8504915">&lt;-</span><span class="ident" id="8504917">time</span><span class="op" id="8504921">.</span><span class="ident" id="8504922">After</span><span class="op" id="8504927">(</span><span class="num" id="8504928">1</span>&nbsp;<span class="op" id="8504930">*</span>&nbsp;<span class="ident" id="8504932">time</span><span class="op" id="8504936">.</span><span class="ident" id="8504937">Second</span><span class="op" id="8504943">)</span><span class="op" id="8504944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8504948">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504989">t</span><span class="op" id="8504990">.</span><span class="ident" id="8504991">Errorf</span><span class="op" id="8504997">(</span><span class="string" id="8504998">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="8505040">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505043">case</span>&nbsp;<span class="op" id="8505048">&lt;-</span><span class="ident" id="8505050">errc</span><span class="op" id="8505054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8505058">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505068">}</span><br>
<span class="lineno"></span><span class="op" id="8505070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8505073">func</span>&nbsp;<span class="ident" id="8505078">TestReadWriteDeadline</span><span class="op" id="8505099">(</span><span class="ident" id="8505100">t</span>&nbsp;<span class="op" id="8505102">*</span><span class="ident" id="8505103">testing</span><span class="op" id="8505110">.</span><span class="ident" id="8505111">T</span><span class="op" id="8505112">)</span>&nbsp;<span class="op" id="8505114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505117">switch</span>&nbsp;<span class="ident" id="8505124">runtime</span><span class="op" id="8505131">.</span><span class="ident" id="8505132">GOOS</span>&nbsp;<span class="op" id="8505137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505140">case</span>&nbsp;<span class="string" id="8505145">&#34;plan9&#34;</span><span class="op" id="8505152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505156">t</span><span class="op" id="8505157">.</span><span class="ident" id="8505158">Skipf</span><span class="op" id="8505163">(</span><span class="string" id="8505164">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8505185">,</span>&nbsp;<span class="ident" id="8505187">runtime</span><span class="op" id="8505194">.</span><span class="ident" id="8505195">GOOS</span><span class="op" id="8505199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505202">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505206">const</span>&nbsp;<span class="op" id="8505212">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505216">readTimeout</span>&nbsp;&nbsp;<span class="op" id="8505229">=</span>&nbsp;<span class="num" id="8505231">50</span>&nbsp;<span class="op" id="8505234">*</span>&nbsp;<span class="ident" id="8505236">time</span><span class="op" id="8505240">.</span><span class="ident" id="8505241">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505255">writeTimeout</span>&nbsp;<span class="op" id="8505268">=</span>&nbsp;<span class="num" id="8505270">250</span>&nbsp;<span class="op" id="8505274">*</span>&nbsp;<span class="ident" id="8505276">time</span><span class="op" id="8505280">.</span><span class="ident" id="8505281">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505294">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505297">checkTimeout</span>&nbsp;<span class="op" id="8505310">:=</span>&nbsp;<span class="keyword" id="8505313">func</span><span class="op" id="8505317">(</span><span class="ident" id="8505318">command</span>&nbsp;<span class="builtintype" id="8505326">string</span><span class="op" id="8505332">,</span>&nbsp;<span class="ident" id="8505334">start</span>&nbsp;<span class="ident" id="8505340">time</span><span class="op" id="8505344">.</span><span class="ident" id="8505345">Time</span><span class="op" id="8505349">,</span>&nbsp;<span class="ident" id="8505351">should</span>&nbsp;<span class="ident" id="8505358">time</span><span class="op" id="8505362">.</span><span class="ident" id="8505363">Duration</span><span class="op" id="8505371">)</span>&nbsp;<span class="op" id="8505373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505377">is</span>&nbsp;<span class="op" id="8505380">:=</span>&nbsp;<span class="ident" id="8505383">time</span><span class="op" id="8505387">.</span><span class="ident" id="8505388">Now</span><span class="op" id="8505391">(</span><span class="op" id="8505392">)</span><span class="op" id="8505393">.</span><span class="ident" id="8505394">Sub</span><span class="op" id="8505397">(</span><span class="ident" id="8505398">start</span><span class="op" id="8505403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505407">d</span>&nbsp;<span class="op" id="8505409">:=</span>&nbsp;<span class="ident" id="8505412">is</span>&nbsp;<span class="op" id="8505415">-</span>&nbsp;<span class="ident" id="8505417">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505426">if</span>&nbsp;<span class="ident" id="8505429">d</span>&nbsp;<span class="op" id="8505431">&lt;</span>&nbsp;<span class="op" id="8505433">-</span><span class="num" id="8505434">30</span><span class="op" id="8505436">*</span><span class="ident" id="8505437">time</span><span class="op" id="8505441">.</span><span class="ident" id="8505442">Millisecond</span>&nbsp;<span class="op" id="8505454">||</span>&nbsp;<span class="op" id="8505457">!</span><span class="ident" id="8505458">testing</span><span class="op" id="8505465">.</span><span class="ident" id="8505466">Short</span><span class="op" id="8505471">(</span><span class="op" id="8505472">)</span>&nbsp;<span class="op" id="8505474">&amp;&amp;</span>&nbsp;<span class="num" id="8505477">150</span><span class="op" id="8505480">*</span><span class="ident" id="8505481">time</span><span class="op" id="8505485">.</span><span class="ident" id="8505486">Millisecond</span>&nbsp;<span class="op" id="8505498">&lt;</span>&nbsp;<span class="ident" id="8505500">d</span>&nbsp;<span class="op" id="8505502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505507">t</span><span class="op" id="8505508">.</span><span class="ident" id="8505509">Errorf</span><span class="op" id="8505515">(</span><span class="string" id="8505516">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="8505559">,</span>&nbsp;<span class="ident" id="8505561">command</span><span class="op" id="8505568">,</span>&nbsp;<span class="ident" id="8505570">is</span><span class="op" id="8505572">,</span>&nbsp;<span class="ident" id="8505574">should</span><span class="op" id="8505580">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505591">ln</span><span class="op" id="8505593">,</span>&nbsp;<span class="ident" id="8505595">err</span>&nbsp;<span class="op" id="8505599">:=</span>&nbsp;<span class="ident" id="8505602">Listen</span><span class="op" id="8505608">(</span><span class="string" id="8505609">&#34;tcp&#34;</span><span class="op" id="8505614">,</span>&nbsp;<span class="string" id="8505616">&#34;127.0.0.1:0&#34;</span><span class="op" id="8505629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505632">if</span>&nbsp;<span class="ident" id="8505635">err</span>&nbsp;<span class="op" id="8505639">!=</span>&nbsp;<span class="ident" id="8505642">nil</span>&nbsp;<span class="op" id="8505646">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505650">t</span><span class="op" id="8505651">.</span><span class="ident" id="8505652">Fatalf</span><span class="op" id="8505658">(</span><span class="string" id="8505659">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8505680">,</span>&nbsp;<span class="ident" id="8505682">err</span><span class="op" id="8505685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505691">defer</span>&nbsp;<span class="ident" id="8505697">ln</span><span class="op" id="8505699">.</span><span class="ident" id="8505700">Close</span><span class="op" id="8505705">(</span><span class="op" id="8505706">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505710">lnquit</span>&nbsp;<span class="op" id="8505717">:=</span>&nbsp;<span class="builtinfunc" id="8505720">make</span><span class="op" id="8505724">(</span><span class="keyword" id="8505725">chan</span>&nbsp;<span class="builtintype" id="8505730">bool</span><span class="op" id="8505734">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505738">go</span>&nbsp;<span class="keyword" id="8505741">func</span><span class="op" id="8505745">(</span><span class="op" id="8505746">)</span>&nbsp;<span class="op" id="8505748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505752">c</span><span class="op" id="8505753">,</span>&nbsp;<span class="ident" id="8505755">err</span>&nbsp;<span class="op" id="8505759">:=</span>&nbsp;<span class="ident" id="8505762">ln</span><span class="op" id="8505764">.</span><span class="ident" id="8505765">Accept</span><span class="op" id="8505771">(</span><span class="op" id="8505772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505776">if</span>&nbsp;<span class="ident" id="8505779">err</span>&nbsp;<span class="op" id="8505783">!=</span>&nbsp;<span class="ident" id="8505786">nil</span>&nbsp;<span class="op" id="8505790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505795">t</span><span class="op" id="8505796">.</span><span class="ident" id="8505797">Errorf</span><span class="op" id="8505803">(</span><span class="string" id="8505804">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8505816">,</span>&nbsp;<span class="ident" id="8505818">err</span><span class="op" id="8505821">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505826">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505839">defer</span>&nbsp;<span class="ident" id="8505845">c</span><span class="op" id="8505846">.</span><span class="ident" id="8505847">Close</span><span class="op" id="8505852">(</span><span class="op" id="8505853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505857">lnquit</span>&nbsp;<span class="op" id="8505864">&lt;-</span>&nbsp;<span class="builtintype" id="8505867">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505873">}</span><span class="op" id="8505874">(</span><span class="op" id="8505875">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505879">c</span><span class="op" id="8505880">,</span>&nbsp;<span class="ident" id="8505882">err</span>&nbsp;<span class="op" id="8505886">:=</span>&nbsp;<span class="ident" id="8505889">Dial</span><span class="op" id="8505893">(</span><span class="string" id="8505894">&#34;tcp&#34;</span><span class="op" id="8505899">,</span>&nbsp;<span class="ident" id="8505901">ln</span><span class="op" id="8505903">.</span><span class="ident" id="8505904">Addr</span><span class="op" id="8505908">(</span><span class="op" id="8505909">)</span><span class="op" id="8505910">.</span><span class="ident" id="8505911">String</span><span class="op" id="8505917">(</span><span class="op" id="8505918">)</span><span class="op" id="8505919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505922">if</span>&nbsp;<span class="ident" id="8505925">err</span>&nbsp;<span class="op" id="8505929">!=</span>&nbsp;<span class="ident" id="8505932">nil</span>&nbsp;<span class="op" id="8505936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505940">t</span><span class="op" id="8505941">.</span><span class="ident" id="8505942">Fatalf</span><span class="op" id="8505948">(</span><span class="string" id="8505949">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8505959">,</span>&nbsp;<span class="ident" id="8505961">err</span><span class="op" id="8505964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505967">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8505970">defer</span>&nbsp;<span class="ident" id="8505976">c</span><span class="op" id="8505977">.</span><span class="ident" id="8505978">Close</span><span class="op" id="8505983">(</span><span class="op" id="8505984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505988">start</span>&nbsp;<span class="op" id="8505994">:=</span>&nbsp;<span class="ident" id="8505997">time</span><span class="op" id="8506001">.</span><span class="ident" id="8506002">Now</span><span class="op" id="8506005">(</span><span class="op" id="8506006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506009">err</span>&nbsp;<span class="op" id="8506013">=</span>&nbsp;<span class="ident" id="8506015">c</span><span class="op" id="8506016">.</span><span class="ident" id="8506017">SetReadDeadline</span><span class="op" id="8506032">(</span><span class="ident" id="8506033">start</span><span class="op" id="8506038">.</span><span class="ident" id="8506039">Add</span><span class="op" id="8506042">(</span><span class="ident" id="8506043">readTimeout</span><span class="op" id="8506054">)</span><span class="op" id="8506055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506058">if</span>&nbsp;<span class="ident" id="8506061">err</span>&nbsp;<span class="op" id="8506065">!=</span>&nbsp;<span class="ident" id="8506068">nil</span>&nbsp;<span class="op" id="8506072">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506076">t</span><span class="op" id="8506077">.</span><span class="ident" id="8506078">Fatalf</span><span class="op" id="8506084">(</span><span class="string" id="8506085">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="8506106">,</span>&nbsp;<span class="ident" id="8506108">err</span><span class="op" id="8506111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506117">err</span>&nbsp;<span class="op" id="8506121">=</span>&nbsp;<span class="ident" id="8506123">c</span><span class="op" id="8506124">.</span><span class="ident" id="8506125">SetWriteDeadline</span><span class="op" id="8506141">(</span><span class="ident" id="8506142">start</span><span class="op" id="8506147">.</span><span class="ident" id="8506148">Add</span><span class="op" id="8506151">(</span><span class="ident" id="8506152">writeTimeout</span><span class="op" id="8506164">)</span><span class="op" id="8506165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506168">if</span>&nbsp;<span class="ident" id="8506171">err</span>&nbsp;<span class="op" id="8506175">!=</span>&nbsp;<span class="ident" id="8506178">nil</span>&nbsp;<span class="op" id="8506182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506186">t</span><span class="op" id="8506187">.</span><span class="ident" id="8506188">Fatalf</span><span class="op" id="8506194">(</span><span class="string" id="8506195">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="8506217">,</span>&nbsp;<span class="ident" id="8506219">err</span><span class="op" id="8506222">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506229">quit</span>&nbsp;<span class="op" id="8506234">:=</span>&nbsp;<span class="builtinfunc" id="8506237">make</span><span class="op" id="8506241">(</span><span class="keyword" id="8506242">chan</span>&nbsp;<span class="builtintype" id="8506247">bool</span><span class="op" id="8506251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506255">go</span>&nbsp;<span class="keyword" id="8506258">func</span><span class="op" id="8506262">(</span><span class="op" id="8506263">)</span>&nbsp;<span class="op" id="8506265">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506269">var</span>&nbsp;<span class="ident" id="8506273">buf</span>&nbsp;<span class="op" id="8506277">[</span><span class="num" id="8506278">10</span><span class="op" id="8506280">]</span><span class="builtintype" id="8506281">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506288">_</span><span class="op" id="8506289">,</span>&nbsp;<span class="ident" id="8506291">err</span>&nbsp;<span class="op" id="8506295">:=</span>&nbsp;<span class="ident" id="8506298">c</span><span class="op" id="8506299">.</span><span class="ident" id="8506300">Read</span><span class="op" id="8506304">(</span><span class="ident" id="8506305">buf</span><span class="op" id="8506308">[</span><span class="op" id="8506309">:</span><span class="op" id="8506310">]</span><span class="op" id="8506311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506315">if</span>&nbsp;<span class="ident" id="8506318">err</span>&nbsp;<span class="op" id="8506322">==</span>&nbsp;<span class="ident" id="8506325">nil</span>&nbsp;<span class="op" id="8506329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506334">t</span><span class="op" id="8506335">.</span><span class="ident" id="8506336">Errorf</span><span class="op" id="8506342">(</span><span class="string" id="8506343">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="8506368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506372">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506376">checkTimeout</span><span class="op" id="8506388">(</span><span class="string" id="8506389">&#34;Read&#34;</span><span class="op" id="8506395">,</span>&nbsp;<span class="ident" id="8506397">start</span><span class="op" id="8506402">,</span>&nbsp;<span class="ident" id="8506404">readTimeout</span><span class="op" id="8506415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506419">quit</span>&nbsp;<span class="op" id="8506424">&lt;-</span>&nbsp;<span class="builtintype" id="8506427">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506433">}</span><span class="op" id="8506434">(</span><span class="op" id="8506435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506439">go</span>&nbsp;<span class="keyword" id="8506442">func</span><span class="op" id="8506446">(</span><span class="op" id="8506447">)</span>&nbsp;<span class="op" id="8506449">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506453">var</span>&nbsp;<span class="ident" id="8506457">buf</span>&nbsp;<span class="op" id="8506461">[</span><span class="num" id="8506462">10000</span><span class="op" id="8506467">]</span><span class="builtintype" id="8506468">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506475">for</span>&nbsp;<span class="op" id="8506479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506484">_</span><span class="op" id="8506485">,</span>&nbsp;<span class="ident" id="8506487">err</span>&nbsp;<span class="op" id="8506491">:=</span>&nbsp;<span class="ident" id="8506494">c</span><span class="op" id="8506495">.</span><span class="ident" id="8506496">Write</span><span class="op" id="8506501">(</span><span class="ident" id="8506502">buf</span><span class="op" id="8506505">[</span><span class="op" id="8506506">:</span><span class="op" id="8506507">]</span><span class="op" id="8506508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506513">if</span>&nbsp;<span class="ident" id="8506516">err</span>&nbsp;<span class="op" id="8506520">!=</span>&nbsp;<span class="ident" id="8506523">nil</span>&nbsp;<span class="op" id="8506527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506533">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506550">checkTimeout</span><span class="op" id="8506562">(</span><span class="string" id="8506563">&#34;Write&#34;</span><span class="op" id="8506570">,</span>&nbsp;<span class="ident" id="8506572">start</span><span class="op" id="8506577">,</span>&nbsp;<span class="ident" id="8506579">writeTimeout</span><span class="op" id="8506591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506595">quit</span>&nbsp;<span class="op" id="8506600">&lt;-</span>&nbsp;<span class="builtintype" id="8506603">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506609">}</span><span class="op" id="8506610">(</span><span class="op" id="8506611">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506615">&lt;-</span><span class="ident" id="8506617">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506623">&lt;-</span><span class="ident" id="8506625">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506631">&lt;-</span><span class="ident" id="8506633">lnquit</span><br>
<span class="lineno"></span><span class="op" id="8506640">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="8506643">type</span>&nbsp;<span class="ident" id="8506648">neverEnding</span>&nbsp;<span class="builtintype" id="8506660">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8506666">func</span>&nbsp;<span class="op" id="8506671">(</span><span class="ident" id="8506672">b</span>&nbsp;<span class="ident" id="8506674">neverEnding</span><span class="op" id="8506685">)</span>&nbsp;<span class="ident" id="8506687">Read</span><span class="op" id="8506691">(</span><span class="ident" id="8506692">p</span>&nbsp;<span class="op" id="8506694">[</span><span class="op" id="8506695">]</span><span class="builtintype" id="8506696">byte</span><span class="op" id="8506700">)</span>&nbsp;<span class="op" id="8506702">(</span><span class="ident" id="8506703">n</span>&nbsp;<span class="builtintype" id="8506705">int</span><span class="op" id="8506708">,</span>&nbsp;<span class="ident" id="8506710">err</span>&nbsp;<span class="builtintype" id="8506714">error</span><span class="op" id="8506719">)</span>&nbsp;<span class="op" id="8506721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506724">for</span>&nbsp;<span class="ident" id="8506728">i</span>&nbsp;<span class="op" id="8506730">:=</span>&nbsp;<span class="keyword" id="8506733">range</span>&nbsp;<span class="ident" id="8506739">p</span>&nbsp;<span class="op" id="8506741">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506745">p</span><span class="op" id="8506746">[</span><span class="ident" id="8506747">i</span><span class="op" id="8506748">]</span>&nbsp;<span class="op" id="8506750">=</span>&nbsp;<span class="builtintype" id="8506752">byte</span><span class="op" id="8506756">(</span><span class="ident" id="8506757">b</span><span class="op" id="8506758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8506761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506764">return</span>&nbsp;<span class="builtinfunc" id="8506771">len</span><span class="op" id="8506774">(</span><span class="ident" id="8506775">p</span><span class="op" id="8506776">)</span><span class="op" id="8506777">,</span>&nbsp;<span class="ident" id="8506779">nil</span><br>
<span class="lineno"></span><span class="op" id="8506783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="8506786">func</span>&nbsp;<span class="ident" id="8506791">TestVariousDeadlines1Proc</span><span class="op" id="8506816">(</span><span class="ident" id="8506817">t</span>&nbsp;<span class="op" id="8506819">*</span><span class="ident" id="8506820">testing</span><span class="op" id="8506827">.</span><span class="ident" id="8506828">T</span><span class="op" id="8506829">)</span>&nbsp;<span class="op" id="8506831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506834">testVariousDeadlines</span><span class="op" id="8506854">(</span><span class="ident" id="8506855">t</span><span class="op" id="8506856">,</span>&nbsp;<span class="num" id="8506858">1</span><span class="op" id="8506859">)</span><br>
<span class="lineno"></span><span class="op" id="8506861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8506864">func</span>&nbsp;<span class="ident" id="8506869">TestVariousDeadlines4Proc</span><span class="op" id="8506894">(</span><span class="ident" id="8506895">t</span>&nbsp;<span class="op" id="8506897">*</span><span class="ident" id="8506898">testing</span><span class="op" id="8506905">.</span><span class="ident" id="8506906">T</span><span class="op" id="8506907">)</span>&nbsp;<span class="op" id="8506909">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8506912">testVariousDeadlines</span><span class="op" id="8506932">(</span><span class="ident" id="8506933">t</span><span class="op" id="8506934">,</span>&nbsp;<span class="num" id="8506936">4</span><span class="op" id="8506937">)</span><br>
<span class="lineno"></span><span class="op" id="8506939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8506942">func</span>&nbsp;<span class="ident" id="8506947">testVariousDeadlines</span><span class="op" id="8506967">(</span><span class="ident" id="8506968">t</span>&nbsp;<span class="op" id="8506970">*</span><span class="ident" id="8506971">testing</span><span class="op" id="8506978">.</span><span class="ident" id="8506979">T</span><span class="op" id="8506980">,</span>&nbsp;<span class="ident" id="8506982">maxProcs</span>&nbsp;<span class="builtintype" id="8506991">int</span><span class="op" id="8506994">)</span>&nbsp;<span class="op" id="8506996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8506999">switch</span>&nbsp;<span class="ident" id="8507006">runtime</span><span class="op" id="8507013">.</span><span class="ident" id="8507014">GOOS</span>&nbsp;<span class="op" id="8507019">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507022">case</span>&nbsp;<span class="string" id="8507027">&#34;plan9&#34;</span><span class="op" id="8507034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507038">t</span><span class="op" id="8507039">.</span><span class="ident" id="8507040">Skipf</span><span class="op" id="8507045">(</span><span class="string" id="8507046">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8507067">,</span>&nbsp;<span class="ident" id="8507069">runtime</span><span class="op" id="8507076">.</span><span class="ident" id="8507077">GOOS</span><span class="op" id="8507081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507088">defer</span>&nbsp;<span class="ident" id="8507094">runtime</span><span class="op" id="8507101">.</span><span class="ident" id="8507102">GOMAXPROCS</span><span class="op" id="8507112">(</span><span class="ident" id="8507113">runtime</span><span class="op" id="8507120">.</span><span class="ident" id="8507121">GOMAXPROCS</span><span class="op" id="8507131">(</span><span class="ident" id="8507132">maxProcs</span><span class="op" id="8507140">)</span><span class="op" id="8507141">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507144">ln</span>&nbsp;<span class="op" id="8507147">:=</span>&nbsp;<span class="ident" id="8507150">newLocalListener</span><span class="op" id="8507166">(</span><span class="ident" id="8507167">t</span><span class="op" id="8507168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507171">defer</span>&nbsp;<span class="ident" id="8507177">ln</span><span class="op" id="8507179">.</span><span class="ident" id="8507180">Close</span><span class="op" id="8507185">(</span><span class="op" id="8507186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507189">acceptc</span>&nbsp;<span class="op" id="8507197">:=</span>&nbsp;<span class="builtinfunc" id="8507200">make</span><span class="op" id="8507204">(</span><span class="keyword" id="8507205">chan</span>&nbsp;<span class="builtintype" id="8507210">error</span><span class="op" id="8507215">,</span>&nbsp;<span class="num" id="8507217">1</span><span class="op" id="8507218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8507222">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8507292">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507315">servec</span>&nbsp;<span class="op" id="8507322">:=</span>&nbsp;<span class="builtinfunc" id="8507325">make</span><span class="op" id="8507329">(</span><span class="keyword" id="8507330">chan</span>&nbsp;<span class="ident" id="8507335">copyRes</span><span class="op" id="8507342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507345">go</span>&nbsp;<span class="keyword" id="8507348">func</span><span class="op" id="8507352">(</span><span class="op" id="8507353">)</span>&nbsp;<span class="op" id="8507355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507359">for</span>&nbsp;<span class="op" id="8507363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507368">c</span><span class="op" id="8507369">,</span>&nbsp;<span class="ident" id="8507371">err</span>&nbsp;<span class="op" id="8507375">:=</span>&nbsp;<span class="ident" id="8507378">ln</span><span class="op" id="8507380">.</span><span class="ident" id="8507381">Accept</span><span class="op" id="8507387">(</span><span class="op" id="8507388">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507393">if</span>&nbsp;<span class="ident" id="8507396">err</span>&nbsp;<span class="op" id="8507400">!=</span>&nbsp;<span class="ident" id="8507403">nil</span>&nbsp;<span class="op" id="8507407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507413">acceptc</span>&nbsp;<span class="op" id="8507421">&lt;-</span>&nbsp;<span class="ident" id="8507424">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507447">go</span>&nbsp;<span class="keyword" id="8507450">func</span><span class="op" id="8507454">(</span><span class="op" id="8507455">)</span>&nbsp;<span class="op" id="8507457">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507463">t0</span>&nbsp;<span class="op" id="8507466">:=</span>&nbsp;<span class="ident" id="8507469">time</span><span class="op" id="8507473">.</span><span class="ident" id="8507474">Now</span><span class="op" id="8507477">(</span><span class="op" id="8507478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507484">n</span><span class="op" id="8507485">,</span>&nbsp;<span class="ident" id="8507487">err</span>&nbsp;<span class="op" id="8507491">:=</span>&nbsp;<span class="ident" id="8507494">io</span><span class="op" id="8507496">.</span><span class="ident" id="8507497">Copy</span><span class="op" id="8507501">(</span><span class="ident" id="8507502">c</span><span class="op" id="8507503">,</span>&nbsp;<span class="ident" id="8507505">neverEnding</span><span class="op" id="8507516">(</span><span class="string" id="8507517">&#39;a&#39;</span><span class="op" id="8507520">)</span><span class="op" id="8507521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507527">d</span>&nbsp;<span class="op" id="8507529">:=</span>&nbsp;<span class="ident" id="8507532">time</span><span class="op" id="8507536">.</span><span class="ident" id="8507537">Since</span><span class="op" id="8507542">(</span><span class="ident" id="8507543">t0</span><span class="op" id="8507545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507551">c</span><span class="op" id="8507552">.</span><span class="ident" id="8507553">Close</span><span class="op" id="8507558">(</span><span class="op" id="8507559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507565">servec</span>&nbsp;<span class="op" id="8507572">&lt;-</span>&nbsp;<span class="ident" id="8507575">copyRes</span><span class="op" id="8507582">{</span><span class="ident" id="8507583">n</span><span class="op" id="8507584">,</span>&nbsp;<span class="ident" id="8507586">err</span><span class="op" id="8507589">,</span>&nbsp;<span class="ident" id="8507591">d</span><span class="op" id="8507592">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507597">}</span><span class="op" id="8507598">(</span><span class="op" id="8507599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507606">}</span><span class="op" id="8507607">(</span><span class="op" id="8507608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507612">for</span>&nbsp;<span class="ident" id="8507616">_</span><span class="op" id="8507617">,</span>&nbsp;<span class="ident" id="8507619">timeout</span>&nbsp;<span class="op" id="8507627">:=</span>&nbsp;<span class="keyword" id="8507630">range</span>&nbsp;<span class="op" id="8507636">[</span><span class="op" id="8507637">]</span><span class="ident" id="8507638">time</span><span class="op" id="8507642">.</span><span class="ident" id="8507643">Duration</span><span class="op" id="8507651">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507655">1</span>&nbsp;<span class="op" id="8507657">*</span>&nbsp;<span class="ident" id="8507659">time</span><span class="op" id="8507663">.</span><span class="ident" id="8507664">Nanosecond</span><span class="op" id="8507674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507678">2</span>&nbsp;<span class="op" id="8507680">*</span>&nbsp;<span class="ident" id="8507682">time</span><span class="op" id="8507686">.</span><span class="ident" id="8507687">Nanosecond</span><span class="op" id="8507697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507701">5</span>&nbsp;<span class="op" id="8507703">*</span>&nbsp;<span class="ident" id="8507705">time</span><span class="op" id="8507709">.</span><span class="ident" id="8507710">Nanosecond</span><span class="op" id="8507720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507724">50</span>&nbsp;<span class="op" id="8507727">*</span>&nbsp;<span class="ident" id="8507729">time</span><span class="op" id="8507733">.</span><span class="ident" id="8507734">Nanosecond</span><span class="op" id="8507744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507748">100</span>&nbsp;<span class="op" id="8507752">*</span>&nbsp;<span class="ident" id="8507754">time</span><span class="op" id="8507758">.</span><span class="ident" id="8507759">Nanosecond</span><span class="op" id="8507769">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507773">200</span>&nbsp;<span class="op" id="8507777">*</span>&nbsp;<span class="ident" id="8507779">time</span><span class="op" id="8507783">.</span><span class="ident" id="8507784">Nanosecond</span><span class="op" id="8507794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507798">500</span>&nbsp;<span class="op" id="8507802">*</span>&nbsp;<span class="ident" id="8507804">time</span><span class="op" id="8507808">.</span><span class="ident" id="8507809">Nanosecond</span><span class="op" id="8507819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507823">750</span>&nbsp;<span class="op" id="8507827">*</span>&nbsp;<span class="ident" id="8507829">time</span><span class="op" id="8507833">.</span><span class="ident" id="8507834">Nanosecond</span><span class="op" id="8507844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507848">1</span>&nbsp;<span class="op" id="8507850">*</span>&nbsp;<span class="ident" id="8507852">time</span><span class="op" id="8507856">.</span><span class="ident" id="8507857">Microsecond</span><span class="op" id="8507868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507872">5</span>&nbsp;<span class="op" id="8507874">*</span>&nbsp;<span class="ident" id="8507876">time</span><span class="op" id="8507880">.</span><span class="ident" id="8507881">Microsecond</span><span class="op" id="8507892">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507896">25</span>&nbsp;<span class="op" id="8507899">*</span>&nbsp;<span class="ident" id="8507901">time</span><span class="op" id="8507905">.</span><span class="ident" id="8507906">Microsecond</span><span class="op" id="8507917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507921">250</span>&nbsp;<span class="op" id="8507925">*</span>&nbsp;<span class="ident" id="8507927">time</span><span class="op" id="8507931">.</span><span class="ident" id="8507932">Microsecond</span><span class="op" id="8507943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507947">500</span>&nbsp;<span class="op" id="8507951">*</span>&nbsp;<span class="ident" id="8507953">time</span><span class="op" id="8507957">.</span><span class="ident" id="8507958">Microsecond</span><span class="op" id="8507969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507973">1</span>&nbsp;<span class="op" id="8507975">*</span>&nbsp;<span class="ident" id="8507977">time</span><span class="op" id="8507981">.</span><span class="ident" id="8507982">Millisecond</span><span class="op" id="8507993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8507997">5</span>&nbsp;<span class="op" id="8507999">*</span>&nbsp;<span class="ident" id="8508001">time</span><span class="op" id="8508005">.</span><span class="ident" id="8508006">Millisecond</span><span class="op" id="8508017">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8508021">100</span>&nbsp;<span class="op" id="8508025">*</span>&nbsp;<span class="ident" id="8508027">time</span><span class="op" id="8508031">.</span><span class="ident" id="8508032">Millisecond</span><span class="op" id="8508043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8508047">250</span>&nbsp;<span class="op" id="8508051">*</span>&nbsp;<span class="ident" id="8508053">time</span><span class="op" id="8508057">.</span><span class="ident" id="8508058">Millisecond</span><span class="op" id="8508069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8508073">500</span>&nbsp;<span class="op" id="8508077">*</span>&nbsp;<span class="ident" id="8508079">time</span><span class="op" id="8508083">.</span><span class="ident" id="8508084">Millisecond</span><span class="op" id="8508095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8508099">1</span>&nbsp;<span class="op" id="8508101">*</span>&nbsp;<span class="ident" id="8508103">time</span><span class="op" id="8508107">.</span><span class="ident" id="8508108">Second</span><span class="op" id="8508114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508117">}</span>&nbsp;<span class="op" id="8508119">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508123">numRuns</span>&nbsp;<span class="op" id="8508131">:=</span>&nbsp;<span class="num" id="8508134">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508138">if</span>&nbsp;<span class="ident" id="8508141">testing</span><span class="op" id="8508148">.</span><span class="ident" id="8508149">Short</span><span class="op" id="8508154">(</span><span class="op" id="8508155">)</span>&nbsp;<span class="op" id="8508157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508162">numRuns</span>&nbsp;<span class="op" id="8508170">=</span>&nbsp;<span class="num" id="8508172">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508177">if</span>&nbsp;<span class="ident" id="8508180">timeout</span>&nbsp;<span class="op" id="8508188">&gt;</span>&nbsp;<span class="num" id="8508190">500</span><span class="op" id="8508193">*</span><span class="ident" id="8508194">time</span><span class="op" id="8508198">.</span><span class="ident" id="8508199">Microsecond</span>&nbsp;<span class="op" id="8508211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508217">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508237">for</span>&nbsp;<span class="ident" id="8508241">run</span>&nbsp;<span class="op" id="8508245">:=</span>&nbsp;<span class="num" id="8508248">0</span><span class="op" id="8508249">;</span>&nbsp;<span class="ident" id="8508251">run</span>&nbsp;<span class="op" id="8508255">&lt;</span>&nbsp;<span class="ident" id="8508257">numRuns</span><span class="op" id="8508264">;</span>&nbsp;<span class="ident" id="8508266">run</span><span class="op" id="8508269">++</span>&nbsp;<span class="op" id="8508272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508277">name</span>&nbsp;<span class="op" id="8508282">:=</span>&nbsp;<span class="ident" id="8508285">fmt</span><span class="op" id="8508288">.</span><span class="ident" id="8508289">Sprintf</span><span class="op" id="8508296">(</span><span class="string" id="8508297">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="8508311">,</span>&nbsp;<span class="ident" id="8508313">timeout</span><span class="op" id="8508320">,</span>&nbsp;<span class="ident" id="8508322">run</span><span class="op" id="8508325">+</span><span class="num" id="8508326">1</span><span class="op" id="8508327">,</span>&nbsp;<span class="ident" id="8508329">numRuns</span><span class="op" id="8508336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508341">t</span><span class="op" id="8508342">.</span><span class="ident" id="8508343">Log</span><span class="op" id="8508346">(</span><span class="ident" id="8508347">name</span><span class="op" id="8508351">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508357">c</span><span class="op" id="8508358">,</span>&nbsp;<span class="ident" id="8508360">err</span>&nbsp;<span class="op" id="8508364">:=</span>&nbsp;<span class="ident" id="8508367">Dial</span><span class="op" id="8508371">(</span><span class="string" id="8508372">&#34;tcp&#34;</span><span class="op" id="8508377">,</span>&nbsp;<span class="ident" id="8508379">ln</span><span class="op" id="8508381">.</span><span class="ident" id="8508382">Addr</span><span class="op" id="8508386">(</span><span class="op" id="8508387">)</span><span class="op" id="8508388">.</span><span class="ident" id="8508389">String</span><span class="op" id="8508395">(</span><span class="op" id="8508396">)</span><span class="op" id="8508397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508402">if</span>&nbsp;<span class="ident" id="8508405">err</span>&nbsp;<span class="op" id="8508409">!=</span>&nbsp;<span class="ident" id="8508412">nil</span>&nbsp;<span class="op" id="8508416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508422">t</span><span class="op" id="8508423">.</span><span class="ident" id="8508424">Fatalf</span><span class="op" id="8508430">(</span><span class="string" id="8508431">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8508441">,</span>&nbsp;<span class="ident" id="8508443">err</span><span class="op" id="8508446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508451">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508456">clientc</span>&nbsp;<span class="op" id="8508464">:=</span>&nbsp;<span class="builtinfunc" id="8508467">make</span><span class="op" id="8508471">(</span><span class="keyword" id="8508472">chan</span>&nbsp;<span class="ident" id="8508477">copyRes</span><span class="op" id="8508484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508489">go</span>&nbsp;<span class="keyword" id="8508492">func</span><span class="op" id="8508496">(</span><span class="op" id="8508497">)</span>&nbsp;<span class="op" id="8508499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508505">t0</span>&nbsp;<span class="op" id="8508508">:=</span>&nbsp;<span class="ident" id="8508511">time</span><span class="op" id="8508515">.</span><span class="ident" id="8508516">Now</span><span class="op" id="8508519">(</span><span class="op" id="8508520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508526">c</span><span class="op" id="8508527">.</span><span class="ident" id="8508528">SetDeadline</span><span class="op" id="8508539">(</span><span class="ident" id="8508540">t0</span><span class="op" id="8508542">.</span><span class="ident" id="8508543">Add</span><span class="op" id="8508546">(</span><span class="ident" id="8508547">timeout</span><span class="op" id="8508554">)</span><span class="op" id="8508555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508561">n</span><span class="op" id="8508562">,</span>&nbsp;<span class="ident" id="8508564">err</span>&nbsp;<span class="op" id="8508568">:=</span>&nbsp;<span class="ident" id="8508571">io</span><span class="op" id="8508573">.</span><span class="ident" id="8508574">Copy</span><span class="op" id="8508578">(</span><span class="ident" id="8508579">ioutil</span><span class="op" id="8508585">.</span><span class="ident" id="8508586">Discard</span><span class="op" id="8508593">,</span>&nbsp;<span class="ident" id="8508595">c</span><span class="op" id="8508596">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508602">d</span>&nbsp;<span class="op" id="8508604">:=</span>&nbsp;<span class="ident" id="8508607">time</span><span class="op" id="8508611">.</span><span class="ident" id="8508612">Since</span><span class="op" id="8508617">(</span><span class="ident" id="8508618">t0</span><span class="op" id="8508620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508626">c</span><span class="op" id="8508627">.</span><span class="ident" id="8508628">Close</span><span class="op" id="8508633">(</span><span class="op" id="8508634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508640">clientc</span>&nbsp;<span class="op" id="8508648">&lt;-</span>&nbsp;<span class="ident" id="8508651">copyRes</span><span class="op" id="8508658">{</span><span class="ident" id="8508659">n</span><span class="op" id="8508660">,</span>&nbsp;<span class="ident" id="8508662">err</span><span class="op" id="8508665">,</span>&nbsp;<span class="ident" id="8508667">d</span><span class="op" id="8508668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508673">}</span><span class="op" id="8508674">(</span><span class="op" id="8508675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508681">tooLong</span>&nbsp;<span class="op" id="8508689">:=</span>&nbsp;<span class="num" id="8508692">5</span>&nbsp;<span class="op" id="8508694">*</span>&nbsp;<span class="ident" id="8508696">time</span><span class="op" id="8508700">.</span><span class="ident" id="8508701">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508711">select</span>&nbsp;<span class="op" id="8508718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508723">case</span>&nbsp;<span class="ident" id="8508728">res</span>&nbsp;<span class="op" id="8508732">:=</span>&nbsp;<span class="op" id="8508735">&lt;-</span><span class="ident" id="8508737">clientc</span><span class="op" id="8508744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508750">if</span>&nbsp;<span class="ident" id="8508753">isTimeout</span><span class="op" id="8508762">(</span><span class="ident" id="8508763">res</span><span class="op" id="8508766">.</span><span class="ident" id="8508767">err</span><span class="op" id="8508770">)</span>&nbsp;<span class="op" id="8508772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508779">t</span><span class="op" id="8508780">.</span><span class="ident" id="8508781">Logf</span><span class="op" id="8508785">(</span><span class="string" id="8508786">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8508842">,</span>&nbsp;<span class="ident" id="8508844">name</span><span class="op" id="8508848">,</span>&nbsp;<span class="ident" id="8508850">res</span><span class="op" id="8508853">.</span><span class="ident" id="8508854">d</span><span class="op" id="8508855">,</span>&nbsp;<span class="ident" id="8508857">res</span><span class="op" id="8508860">.</span><span class="ident" id="8508861">n</span><span class="op" id="8508862">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508868">}</span>&nbsp;<span class="keyword" id="8508870">else</span>&nbsp;<span class="op" id="8508875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508882">t</span><span class="op" id="8508883">.</span><span class="ident" id="8508884">Fatalf</span><span class="op" id="8508890">(</span><span class="string" id="8508891">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="8508936">,</span>&nbsp;<span class="ident" id="8508938">name</span><span class="op" id="8508942">,</span>&nbsp;<span class="ident" id="8508944">res</span><span class="op" id="8508947">.</span><span class="ident" id="8508948">n</span><span class="op" id="8508949">,</span>&nbsp;<span class="ident" id="8508951">res</span><span class="op" id="8508954">.</span><span class="ident" id="8508955">err</span><span class="op" id="8508958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508969">case</span>&nbsp;<span class="op" id="8508974">&lt;-</span><span class="ident" id="8508976">time</span><span class="op" id="8508980">.</span><span class="ident" id="8508981">After</span><span class="op" id="8508986">(</span><span class="ident" id="8508987">tooLong</span><span class="op" id="8508994">)</span><span class="op" id="8508995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509001">t</span><span class="op" id="8509002">.</span><span class="ident" id="8509003">Fatalf</span><span class="op" id="8509009">(</span><span class="string" id="8509010">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="8509075">,</span>&nbsp;<span class="ident" id="8509077">name</span><span class="op" id="8509081">,</span>&nbsp;<span class="ident" id="8509083">tooLong</span><span class="op" id="8509090">,</span>&nbsp;<span class="ident" id="8509092">timeout</span><span class="op" id="8509099">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509110">select</span>&nbsp;<span class="op" id="8509117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509122">case</span>&nbsp;<span class="ident" id="8509127">res</span>&nbsp;<span class="op" id="8509131">:=</span>&nbsp;<span class="op" id="8509134">&lt;-</span><span class="ident" id="8509136">servec</span><span class="op" id="8509142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509148">t</span><span class="op" id="8509149">.</span><span class="ident" id="8509150">Logf</span><span class="op" id="8509154">(</span><span class="string" id="8509155">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="8509190">,</span>&nbsp;<span class="ident" id="8509192">name</span><span class="op" id="8509196">,</span>&nbsp;<span class="ident" id="8509198">res</span><span class="op" id="8509201">.</span><span class="ident" id="8509202">d</span><span class="op" id="8509203">,</span>&nbsp;<span class="ident" id="8509205">res</span><span class="op" id="8509208">.</span><span class="ident" id="8509209">n</span><span class="op" id="8509210">,</span>&nbsp;<span class="ident" id="8509212">res</span><span class="op" id="8509215">.</span><span class="ident" id="8509216">err</span><span class="op" id="8509219">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509224">case</span>&nbsp;<span class="ident" id="8509229">err</span>&nbsp;<span class="op" id="8509233">:=</span>&nbsp;<span class="op" id="8509236">&lt;-</span><span class="ident" id="8509238">acceptc</span><span class="op" id="8509245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509251">t</span><span class="op" id="8509252">.</span><span class="ident" id="8509253">Fatalf</span><span class="op" id="8509259">(</span><span class="string" id="8509260">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="8509288">,</span>&nbsp;<span class="ident" id="8509290">name</span><span class="op" id="8509294">,</span>&nbsp;<span class="ident" id="8509296">err</span><span class="op" id="8509299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509304">case</span>&nbsp;<span class="op" id="8509309">&lt;-</span><span class="ident" id="8509311">time</span><span class="op" id="8509315">.</span><span class="ident" id="8509316">After</span><span class="op" id="8509321">(</span><span class="ident" id="8509322">tooLong</span><span class="op" id="8509329">)</span><span class="op" id="8509330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509336">t</span><span class="op" id="8509337">.</span><span class="ident" id="8509338">Fatalf</span><span class="op" id="8509344">(</span><span class="string" id="8509345">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="8509399">,</span>&nbsp;<span class="ident" id="8509401">name</span><span class="op" id="8509405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509410">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509417">}</span><br>
<span class="lineno"></span><span class="op" id="8509419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8509422">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="8509492">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="8509529">func</span>&nbsp;<span class="ident" id="8509534">TestReadDeadlineDataAvailable</span><span class="op" id="8509563">(</span><span class="ident" id="8509564">t</span>&nbsp;<span class="op" id="8509566">*</span><span class="ident" id="8509567">testing</span><span class="op" id="8509574">.</span><span class="ident" id="8509575">T</span><span class="op" id="8509576">)</span>&nbsp;<span class="op" id="8509578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509581">switch</span>&nbsp;<span class="ident" id="8509588">runtime</span><span class="op" id="8509595">.</span><span class="ident" id="8509596">GOOS</span>&nbsp;<span class="op" id="8509601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509604">case</span>&nbsp;<span class="string" id="8509609">&#34;plan9&#34;</span><span class="op" id="8509616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509620">t</span><span class="op" id="8509621">.</span><span class="ident" id="8509622">Skipf</span><span class="op" id="8509627">(</span><span class="string" id="8509628">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8509649">,</span>&nbsp;<span class="ident" id="8509651">runtime</span><span class="op" id="8509658">.</span><span class="ident" id="8509659">GOOS</span><span class="op" id="8509663">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509670">ln</span>&nbsp;<span class="op" id="8509673">:=</span>&nbsp;<span class="ident" id="8509676">newLocalListener</span><span class="op" id="8509692">(</span><span class="ident" id="8509693">t</span><span class="op" id="8509694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509697">defer</span>&nbsp;<span class="ident" id="8509703">ln</span><span class="op" id="8509705">.</span><span class="ident" id="8509706">Close</span><span class="op" id="8509711">(</span><span class="op" id="8509712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509716">servec</span>&nbsp;<span class="op" id="8509723">:=</span>&nbsp;<span class="builtinfunc" id="8509726">make</span><span class="op" id="8509730">(</span><span class="keyword" id="8509731">chan</span>&nbsp;<span class="ident" id="8509736">copyRes</span><span class="op" id="8509743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509746">const</span>&nbsp;<span class="ident" id="8509752">msg</span>&nbsp;<span class="op" id="8509756">=</span>&nbsp;<span class="string" id="8509758">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509818">go</span>&nbsp;<span class="keyword" id="8509821">func</span><span class="op" id="8509825">(</span><span class="op" id="8509826">)</span>&nbsp;<span class="op" id="8509828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509832">c</span><span class="op" id="8509833">,</span>&nbsp;<span class="ident" id="8509835">err</span>&nbsp;<span class="op" id="8509839">:=</span>&nbsp;<span class="ident" id="8509842">ln</span><span class="op" id="8509844">.</span><span class="ident" id="8509845">Accept</span><span class="op" id="8509851">(</span><span class="op" id="8509852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509856">if</span>&nbsp;<span class="ident" id="8509859">err</span>&nbsp;<span class="op" id="8509863">!=</span>&nbsp;<span class="ident" id="8509866">nil</span>&nbsp;<span class="op" id="8509870">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509875">t</span><span class="op" id="8509876">.</span><span class="ident" id="8509877">Errorf</span><span class="op" id="8509883">(</span><span class="string" id="8509884">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8509896">,</span>&nbsp;<span class="ident" id="8509898">err</span><span class="op" id="8509901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509906">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509919">defer</span>&nbsp;<span class="ident" id="8509925">c</span><span class="op" id="8509926">.</span><span class="ident" id="8509927">Close</span><span class="op" id="8509932">(</span><span class="op" id="8509933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509937">n</span><span class="op" id="8509938">,</span>&nbsp;<span class="ident" id="8509940">err</span>&nbsp;<span class="op" id="8509944">:=</span>&nbsp;<span class="ident" id="8509947">c</span><span class="op" id="8509948">.</span><span class="ident" id="8509949">Write</span><span class="op" id="8509954">(</span><span class="op" id="8509955">[</span><span class="op" id="8509956">]</span><span class="builtintype" id="8509957">byte</span><span class="op" id="8509961">(</span><span class="ident" id="8509962">msg</span><span class="op" id="8509965">)</span><span class="op" id="8509966">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509970">servec</span>&nbsp;<span class="op" id="8509977">&lt;-</span>&nbsp;<span class="ident" id="8509980">copyRes</span><span class="op" id="8509987">{</span><span class="ident" id="8509988">n</span><span class="op" id="8509989">:</span>&nbsp;<span class="ident" id="8509991">int64</span><span class="op" id="8509996">(</span><span class="ident" id="8509997">n</span><span class="op" id="8509998">)</span><span class="op" id="8509999">,</span>&nbsp;<span class="ident" id="8510001">err</span><span class="op" id="8510004">:</span>&nbsp;<span class="ident" id="8510006">err</span><span class="op" id="8510009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510012">}</span><span class="op" id="8510013">(</span><span class="op" id="8510014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510018">c</span><span class="op" id="8510019">,</span>&nbsp;<span class="ident" id="8510021">err</span>&nbsp;<span class="op" id="8510025">:=</span>&nbsp;<span class="ident" id="8510028">Dial</span><span class="op" id="8510032">(</span><span class="string" id="8510033">&#34;tcp&#34;</span><span class="op" id="8510038">,</span>&nbsp;<span class="ident" id="8510040">ln</span><span class="op" id="8510042">.</span><span class="ident" id="8510043">Addr</span><span class="op" id="8510047">(</span><span class="op" id="8510048">)</span><span class="op" id="8510049">.</span><span class="ident" id="8510050">String</span><span class="op" id="8510056">(</span><span class="op" id="8510057">)</span><span class="op" id="8510058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510061">if</span>&nbsp;<span class="ident" id="8510064">err</span>&nbsp;<span class="op" id="8510068">!=</span>&nbsp;<span class="ident" id="8510071">nil</span>&nbsp;<span class="op" id="8510075">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510079">t</span><span class="op" id="8510080">.</span><span class="ident" id="8510081">Fatalf</span><span class="op" id="8510087">(</span><span class="string" id="8510088">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8510098">,</span>&nbsp;<span class="ident" id="8510100">err</span><span class="op" id="8510103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510109">defer</span>&nbsp;<span class="ident" id="8510115">c</span><span class="op" id="8510116">.</span><span class="ident" id="8510117">Close</span><span class="op" id="8510122">(</span><span class="op" id="8510123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510126">if</span>&nbsp;<span class="ident" id="8510129">res</span>&nbsp;<span class="op" id="8510133">:=</span>&nbsp;<span class="op" id="8510136">&lt;-</span><span class="ident" id="8510138">servec</span><span class="op" id="8510144">;</span>&nbsp;<span class="ident" id="8510146">res</span><span class="op" id="8510149">.</span><span class="ident" id="8510150">err</span>&nbsp;<span class="op" id="8510154">!=</span>&nbsp;<span class="ident" id="8510157">nil</span>&nbsp;<span class="op" id="8510161">||</span>&nbsp;<span class="ident" id="8510164">res</span><span class="op" id="8510167">.</span><span class="ident" id="8510168">n</span>&nbsp;<span class="op" id="8510170">!=</span>&nbsp;<span class="ident" id="8510173">int64</span><span class="op" id="8510178">(</span><span class="builtinfunc" id="8510179">len</span><span class="op" id="8510182">(</span><span class="ident" id="8510183">msg</span><span class="op" id="8510186">)</span><span class="op" id="8510187">)</span>&nbsp;<span class="op" id="8510189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510193">t</span><span class="op" id="8510194">.</span><span class="ident" id="8510195">Fatalf</span><span class="op" id="8510201">(</span><span class="string" id="8510202">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="8510261">,</span>&nbsp;<span class="ident" id="8510263">res</span><span class="op" id="8510266">.</span><span class="ident" id="8510267">n</span><span class="op" id="8510268">,</span>&nbsp;<span class="ident" id="8510270">res</span><span class="op" id="8510273">.</span><span class="ident" id="8510274">err</span><span class="op" id="8510277">,</span>&nbsp;<span class="builtinfunc" id="8510279">len</span><span class="op" id="8510282">(</span><span class="ident" id="8510283">msg</span><span class="op" id="8510286">)</span><span class="op" id="8510287">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510293">c</span><span class="op" id="8510294">.</span><span class="ident" id="8510295">SetReadDeadline</span><span class="op" id="8510310">(</span><span class="ident" id="8510311">time</span><span class="op" id="8510315">.</span><span class="ident" id="8510316">Now</span><span class="op" id="8510319">(</span><span class="op" id="8510320">)</span><span class="op" id="8510321">.</span><span class="ident" id="8510322">Add</span><span class="op" id="8510325">(</span><span class="op" id="8510326">-</span><span class="num" id="8510327">5</span>&nbsp;<span class="op" id="8510329">*</span>&nbsp;<span class="ident" id="8510331">time</span><span class="op" id="8510335">.</span><span class="ident" id="8510336">Second</span><span class="op" id="8510342">)</span><span class="op" id="8510343">)</span>&nbsp;<span class="comment" id="8510345">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510362">buf</span>&nbsp;<span class="op" id="8510366">:=</span>&nbsp;<span class="builtinfunc" id="8510369">make</span><span class="op" id="8510373">(</span><span class="op" id="8510374">[</span><span class="op" id="8510375">]</span><span class="builtintype" id="8510376">byte</span><span class="op" id="8510380">,</span>&nbsp;<span class="builtinfunc" id="8510382">len</span><span class="op" id="8510385">(</span><span class="ident" id="8510386">msg</span><span class="op" id="8510389">)</span><span class="op" id="8510390">/</span><span class="num" id="8510391">2</span><span class="op" id="8510392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510395">n</span><span class="op" id="8510396">,</span>&nbsp;<span class="ident" id="8510398">err</span>&nbsp;<span class="op" id="8510402">:=</span>&nbsp;<span class="ident" id="8510405">c</span><span class="op" id="8510406">.</span><span class="ident" id="8510407">Read</span><span class="op" id="8510411">(</span><span class="ident" id="8510412">buf</span><span class="op" id="8510415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510418">if</span>&nbsp;<span class="ident" id="8510421">n</span>&nbsp;<span class="op" id="8510423">&gt;</span>&nbsp;<span class="num" id="8510425">0</span>&nbsp;<span class="op" id="8510427">||</span>&nbsp;<span class="op" id="8510430">!</span><span class="ident" id="8510431">isTimeout</span><span class="op" id="8510440">(</span><span class="ident" id="8510441">err</span><span class="op" id="8510444">)</span>&nbsp;<span class="op" id="8510446">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510450">t</span><span class="op" id="8510451">.</span><span class="ident" id="8510452">Fatalf</span><span class="op" id="8510458">(</span><span class="string" id="8510459">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="8510506">,</span>&nbsp;<span class="ident" id="8510508">n</span><span class="op" id="8510509">,</span>&nbsp;<span class="ident" id="8510511">buf</span><span class="op" id="8510514">[</span><span class="op" id="8510515">:</span><span class="ident" id="8510516">n</span><span class="op" id="8510517">]</span><span class="op" id="8510518">,</span>&nbsp;<span class="ident" id="8510520">err</span><span class="op" id="8510523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510526">}</span><br>
<span class="lineno"></span><span class="op" id="8510528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8510531">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="8510605">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="8510652">func</span>&nbsp;<span class="ident" id="8510657">TestWriteDeadlineBufferAvailable</span><span class="op" id="8510689">(</span><span class="ident" id="8510690">t</span>&nbsp;<span class="op" id="8510692">*</span><span class="ident" id="8510693">testing</span><span class="op" id="8510700">.</span><span class="ident" id="8510701">T</span><span class="op" id="8510702">)</span>&nbsp;<span class="op" id="8510704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510707">switch</span>&nbsp;<span class="ident" id="8510714">runtime</span><span class="op" id="8510721">.</span><span class="ident" id="8510722">GOOS</span>&nbsp;<span class="op" id="8510727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510730">case</span>&nbsp;<span class="string" id="8510735">&#34;plan9&#34;</span><span class="op" id="8510742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510746">t</span><span class="op" id="8510747">.</span><span class="ident" id="8510748">Skipf</span><span class="op" id="8510753">(</span><span class="string" id="8510754">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8510775">,</span>&nbsp;<span class="ident" id="8510777">runtime</span><span class="op" id="8510784">.</span><span class="ident" id="8510785">GOOS</span><span class="op" id="8510789">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510796">ln</span>&nbsp;<span class="op" id="8510799">:=</span>&nbsp;<span class="ident" id="8510802">newLocalListener</span><span class="op" id="8510818">(</span><span class="ident" id="8510819">t</span><span class="op" id="8510820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510823">defer</span>&nbsp;<span class="ident" id="8510829">ln</span><span class="op" id="8510831">.</span><span class="ident" id="8510832">Close</span><span class="op" id="8510837">(</span><span class="op" id="8510838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510842">servec</span>&nbsp;<span class="op" id="8510849">:=</span>&nbsp;<span class="builtinfunc" id="8510852">make</span><span class="op" id="8510856">(</span><span class="keyword" id="8510857">chan</span>&nbsp;<span class="ident" id="8510862">copyRes</span><span class="op" id="8510869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510872">go</span>&nbsp;<span class="keyword" id="8510875">func</span><span class="op" id="8510879">(</span><span class="op" id="8510880">)</span>&nbsp;<span class="op" id="8510882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510886">c</span><span class="op" id="8510887">,</span>&nbsp;<span class="ident" id="8510889">err</span>&nbsp;<span class="op" id="8510893">:=</span>&nbsp;<span class="ident" id="8510896">ln</span><span class="op" id="8510898">.</span><span class="ident" id="8510899">Accept</span><span class="op" id="8510905">(</span><span class="op" id="8510906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510910">if</span>&nbsp;<span class="ident" id="8510913">err</span>&nbsp;<span class="op" id="8510917">!=</span>&nbsp;<span class="ident" id="8510920">nil</span>&nbsp;<span class="op" id="8510924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510929">t</span><span class="op" id="8510930">.</span><span class="ident" id="8510931">Errorf</span><span class="op" id="8510937">(</span><span class="string" id="8510938">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8510950">,</span>&nbsp;<span class="ident" id="8510952">err</span><span class="op" id="8510955">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510960">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510973">defer</span>&nbsp;<span class="ident" id="8510979">c</span><span class="op" id="8510980">.</span><span class="ident" id="8510981">Close</span><span class="op" id="8510986">(</span><span class="op" id="8510987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510991">c</span><span class="op" id="8510992">.</span><span class="ident" id="8510993">SetWriteDeadline</span><span class="op" id="8511009">(</span><span class="ident" id="8511010">time</span><span class="op" id="8511014">.</span><span class="ident" id="8511015">Now</span><span class="op" id="8511018">(</span><span class="op" id="8511019">)</span><span class="op" id="8511020">.</span><span class="ident" id="8511021">Add</span><span class="op" id="8511024">(</span><span class="op" id="8511025">-</span><span class="num" id="8511026">5</span>&nbsp;<span class="op" id="8511028">*</span>&nbsp;<span class="ident" id="8511030">time</span><span class="op" id="8511034">.</span><span class="ident" id="8511035">Second</span><span class="op" id="8511041">)</span><span class="op" id="8511042">)</span>&nbsp;<span class="comment" id="8511044">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511061">n</span><span class="op" id="8511062">,</span>&nbsp;<span class="ident" id="8511064">err</span>&nbsp;<span class="op" id="8511068">:=</span>&nbsp;<span class="ident" id="8511071">c</span><span class="op" id="8511072">.</span><span class="ident" id="8511073">Write</span><span class="op" id="8511078">(</span><span class="op" id="8511079">[</span><span class="op" id="8511080">]</span><span class="builtintype" id="8511081">byte</span><span class="op" id="8511085">{</span><span class="string" id="8511086">&#39;x&#39;</span><span class="op" id="8511089">}</span><span class="op" id="8511090">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511094">servec</span>&nbsp;<span class="op" id="8511101">&lt;-</span>&nbsp;<span class="ident" id="8511104">copyRes</span><span class="op" id="8511111">{</span><span class="ident" id="8511112">n</span><span class="op" id="8511113">:</span>&nbsp;<span class="ident" id="8511115">int64</span><span class="op" id="8511120">(</span><span class="ident" id="8511121">n</span><span class="op" id="8511122">)</span><span class="op" id="8511123">,</span>&nbsp;<span class="ident" id="8511125">err</span><span class="op" id="8511128">:</span>&nbsp;<span class="ident" id="8511130">err</span><span class="op" id="8511133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511136">}</span><span class="op" id="8511137">(</span><span class="op" id="8511138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511142">c</span><span class="op" id="8511143">,</span>&nbsp;<span class="ident" id="8511145">err</span>&nbsp;<span class="op" id="8511149">:=</span>&nbsp;<span class="ident" id="8511152">Dial</span><span class="op" id="8511156">(</span><span class="string" id="8511157">&#34;tcp&#34;</span><span class="op" id="8511162">,</span>&nbsp;<span class="ident" id="8511164">ln</span><span class="op" id="8511166">.</span><span class="ident" id="8511167">Addr</span><span class="op" id="8511171">(</span><span class="op" id="8511172">)</span><span class="op" id="8511173">.</span><span class="ident" id="8511174">String</span><span class="op" id="8511180">(</span><span class="op" id="8511181">)</span><span class="op" id="8511182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511185">if</span>&nbsp;<span class="ident" id="8511188">err</span>&nbsp;<span class="op" id="8511192">!=</span>&nbsp;<span class="ident" id="8511195">nil</span>&nbsp;<span class="op" id="8511199">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511203">t</span><span class="op" id="8511204">.</span><span class="ident" id="8511205">Fatalf</span><span class="op" id="8511211">(</span><span class="string" id="8511212">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8511222">,</span>&nbsp;<span class="ident" id="8511224">err</span><span class="op" id="8511227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511233">defer</span>&nbsp;<span class="ident" id="8511239">c</span><span class="op" id="8511240">.</span><span class="ident" id="8511241">Close</span><span class="op" id="8511246">(</span><span class="op" id="8511247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511250">res</span>&nbsp;<span class="op" id="8511254">:=</span>&nbsp;<span class="op" id="8511257">&lt;-</span><span class="ident" id="8511259">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511267">if</span>&nbsp;<span class="ident" id="8511270">res</span><span class="op" id="8511273">.</span><span class="ident" id="8511274">n</span>&nbsp;<span class="op" id="8511276">!=</span>&nbsp;<span class="num" id="8511279">0</span>&nbsp;<span class="op" id="8511281">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511285">t</span><span class="op" id="8511286">.</span><span class="ident" id="8511287">Errorf</span><span class="op" id="8511293">(</span><span class="string" id="8511294">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8511314">,</span>&nbsp;<span class="ident" id="8511316">res</span><span class="op" id="8511319">.</span><span class="ident" id="8511320">n</span><span class="op" id="8511321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511327">if</span>&nbsp;<span class="op" id="8511330">!</span><span class="ident" id="8511331">isTimeout</span><span class="op" id="8511340">(</span><span class="ident" id="8511341">res</span><span class="op" id="8511344">.</span><span class="ident" id="8511345">err</span><span class="op" id="8511348">)</span>&nbsp;<span class="op" id="8511350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511354">t</span><span class="op" id="8511355">.</span><span class="ident" id="8511356">Errorf</span><span class="op" id="8511362">(</span><span class="string" id="8511363">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8511395">,</span>&nbsp;<span class="ident" id="8511397">res</span><span class="op" id="8511400">.</span><span class="ident" id="8511401">err</span><span class="op" id="8511404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511407">}</span><br>
<span class="lineno">600</span><span class="op" id="8511409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8511412">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="8511492">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="8511538">func</span>&nbsp;<span class="ident" id="8511543">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="8511580">(</span><span class="ident" id="8511581">t</span>&nbsp;<span class="op" id="8511583">*</span><span class="ident" id="8511584">testing</span><span class="op" id="8511591">.</span><span class="ident" id="8511592">T</span><span class="op" id="8511593">)</span>&nbsp;<span class="op" id="8511595">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511598">switch</span>&nbsp;<span class="ident" id="8511605">runtime</span><span class="op" id="8511612">.</span><span class="ident" id="8511613">GOOS</span>&nbsp;<span class="op" id="8511618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511621">case</span>&nbsp;<span class="string" id="8511626">&#34;plan9&#34;</span><span class="op" id="8511633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511637">t</span><span class="op" id="8511638">.</span><span class="ident" id="8511639">Skipf</span><span class="op" id="8511644">(</span><span class="string" id="8511645">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8511666">,</span>&nbsp;<span class="ident" id="8511668">runtime</span><span class="op" id="8511675">.</span><span class="ident" id="8511676">GOOS</span><span class="op" id="8511680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511687">ln</span>&nbsp;<span class="op" id="8511690">:=</span>&nbsp;<span class="ident" id="8511693">newLocalListener</span><span class="op" id="8511709">(</span><span class="ident" id="8511710">t</span><span class="op" id="8511711">)</span><span class="op" id="8511712">.</span><span class="op" id="8511713">(</span><span class="op" id="8511714">*</span><span class="ident" id="8511715">TCPListener</span><span class="op" id="8511726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511729">defer</span>&nbsp;<span class="ident" id="8511735">ln</span><span class="op" id="8511737">.</span><span class="ident" id="8511738">Close</span><span class="op" id="8511743">(</span><span class="op" id="8511744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511748">go</span>&nbsp;<span class="keyword" id="8511751">func</span><span class="op" id="8511755">(</span><span class="op" id="8511756">)</span>&nbsp;<span class="op" id="8511758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511762">c</span><span class="op" id="8511763">,</span>&nbsp;<span class="ident" id="8511765">err</span>&nbsp;<span class="op" id="8511769">:=</span>&nbsp;<span class="ident" id="8511772">Dial</span><span class="op" id="8511776">(</span><span class="string" id="8511777">&#34;tcp&#34;</span><span class="op" id="8511782">,</span>&nbsp;<span class="ident" id="8511784">ln</span><span class="op" id="8511786">.</span><span class="ident" id="8511787">Addr</span><span class="op" id="8511791">(</span><span class="op" id="8511792">)</span><span class="op" id="8511793">.</span><span class="ident" id="8511794">String</span><span class="op" id="8511800">(</span><span class="op" id="8511801">)</span><span class="op" id="8511802">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511806">if</span>&nbsp;<span class="ident" id="8511809">err</span>&nbsp;<span class="op" id="8511813">!=</span>&nbsp;<span class="ident" id="8511816">nil</span>&nbsp;<span class="op" id="8511820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511825">t</span><span class="op" id="8511826">.</span><span class="ident" id="8511827">Errorf</span><span class="op" id="8511833">(</span><span class="string" id="8511834">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8511844">,</span>&nbsp;<span class="ident" id="8511846">err</span><span class="op" id="8511849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511854">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511867">defer</span>&nbsp;<span class="ident" id="8511873">c</span><span class="op" id="8511874">.</span><span class="ident" id="8511875">Close</span><span class="op" id="8511880">(</span><span class="op" id="8511881">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511885">var</span>&nbsp;<span class="ident" id="8511889">buf</span>&nbsp;<span class="op" id="8511893">[</span><span class="num" id="8511894">1</span><span class="op" id="8511895">]</span><span class="builtintype" id="8511896">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511903">c</span><span class="op" id="8511904">.</span><span class="ident" id="8511905">Read</span><span class="op" id="8511909">(</span><span class="ident" id="8511910">buf</span><span class="op" id="8511913">[</span><span class="op" id="8511914">:</span><span class="op" id="8511915">]</span><span class="op" id="8511916">)</span>&nbsp;<span class="comment" id="8511918">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511971">}</span><span class="op" id="8511972">(</span><span class="op" id="8511973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511976">time</span><span class="op" id="8511980">.</span><span class="ident" id="8511981">Sleep</span><span class="op" id="8511986">(</span><span class="num" id="8511987">10</span>&nbsp;<span class="op" id="8511990">*</span>&nbsp;<span class="ident" id="8511992">time</span><span class="op" id="8511996">.</span><span class="ident" id="8511997">Millisecond</span><span class="op" id="8512008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512011">ln</span><span class="op" id="8512013">.</span><span class="ident" id="8512014">SetDeadline</span><span class="op" id="8512025">(</span><span class="ident" id="8512026">time</span><span class="op" id="8512030">.</span><span class="ident" id="8512031">Now</span><span class="op" id="8512034">(</span><span class="op" id="8512035">)</span><span class="op" id="8512036">.</span><span class="ident" id="8512037">Add</span><span class="op" id="8512040">(</span><span class="op" id="8512041">-</span><span class="num" id="8512042">5</span>&nbsp;<span class="op" id="8512044">*</span>&nbsp;<span class="ident" id="8512046">time</span><span class="op" id="8512050">.</span><span class="ident" id="8512051">Second</span><span class="op" id="8512057">)</span><span class="op" id="8512058">)</span>&nbsp;<span class="comment" id="8512060">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512076">c</span><span class="op" id="8512077">,</span>&nbsp;<span class="ident" id="8512079">err</span>&nbsp;<span class="op" id="8512083">:=</span>&nbsp;<span class="ident" id="8512086">ln</span><span class="op" id="8512088">.</span><span class="ident" id="8512089">Accept</span><span class="op" id="8512095">(</span><span class="op" id="8512096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512099">if</span>&nbsp;<span class="ident" id="8512102">err</span>&nbsp;<span class="op" id="8512106">==</span>&nbsp;<span class="ident" id="8512109">nil</span>&nbsp;<span class="op" id="8512113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512117">defer</span>&nbsp;<span class="ident" id="8512123">c</span><span class="op" id="8512124">.</span><span class="ident" id="8512125">Close</span><span class="op" id="8512130">(</span><span class="op" id="8512131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512137">if</span>&nbsp;<span class="op" id="8512140">!</span><span class="ident" id="8512141">isTimeout</span><span class="op" id="8512150">(</span><span class="ident" id="8512151">err</span><span class="op" id="8512154">)</span>&nbsp;<span class="op" id="8512156">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512160">t</span><span class="op" id="8512161">.</span><span class="ident" id="8512162">Fatalf</span><span class="op" id="8512168">(</span><span class="string" id="8512169">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8512199">,</span>&nbsp;<span class="ident" id="8512201">err</span><span class="op" id="8512204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512207">}</span><br>
<span class="lineno"></span><span class="op" id="8512209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8512212">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="8512284">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="8512338">func</span>&nbsp;<span class="ident" id="8512343">TestConnectDeadlineInThePast</span><span class="op" id="8512371">(</span><span class="ident" id="8512372">t</span>&nbsp;<span class="op" id="8512374">*</span><span class="ident" id="8512375">testing</span><span class="op" id="8512382">.</span><span class="ident" id="8512383">T</span><span class="op" id="8512384">)</span>&nbsp;<span class="op" id="8512386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512389">switch</span>&nbsp;<span class="ident" id="8512396">runtime</span><span class="op" id="8512403">.</span><span class="ident" id="8512404">GOOS</span>&nbsp;<span class="op" id="8512409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512412">case</span>&nbsp;<span class="string" id="8512417">&#34;plan9&#34;</span><span class="op" id="8512424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512428">t</span><span class="op" id="8512429">.</span><span class="ident" id="8512430">Skipf</span><span class="op" id="8512435">(</span><span class="string" id="8512436">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8512457">,</span>&nbsp;<span class="ident" id="8512459">runtime</span><span class="op" id="8512466">.</span><span class="ident" id="8512467">GOOS</span><span class="op" id="8512471">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512478">ln</span>&nbsp;<span class="op" id="8512481">:=</span>&nbsp;<span class="ident" id="8512484">newLocalListener</span><span class="op" id="8512500">(</span><span class="ident" id="8512501">t</span><span class="op" id="8512502">)</span><span class="op" id="8512503">.</span><span class="op" id="8512504">(</span><span class="op" id="8512505">*</span><span class="ident" id="8512506">TCPListener</span><span class="op" id="8512517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512520">defer</span>&nbsp;<span class="ident" id="8512526">ln</span><span class="op" id="8512528">.</span><span class="ident" id="8512529">Close</span><span class="op" id="8512534">(</span><span class="op" id="8512535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512539">go</span>&nbsp;<span class="keyword" id="8512542">func</span><span class="op" id="8512546">(</span><span class="op" id="8512547">)</span>&nbsp;<span class="op" id="8512549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512553">c</span><span class="op" id="8512554">,</span>&nbsp;<span class="ident" id="8512556">err</span>&nbsp;<span class="op" id="8512560">:=</span>&nbsp;<span class="ident" id="8512563">ln</span><span class="op" id="8512565">.</span><span class="ident" id="8512566">Accept</span><span class="op" id="8512572">(</span><span class="op" id="8512573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512577">if</span>&nbsp;<span class="ident" id="8512580">err</span>&nbsp;<span class="op" id="8512584">==</span>&nbsp;<span class="ident" id="8512587">nil</span>&nbsp;<span class="op" id="8512591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512596">defer</span>&nbsp;<span class="ident" id="8512602">c</span><span class="op" id="8512603">.</span><span class="ident" id="8512604">Close</span><span class="op" id="8512609">(</span><span class="op" id="8512610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512614">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512617">}</span><span class="op" id="8512618">(</span><span class="op" id="8512619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512622">time</span><span class="op" id="8512626">.</span><span class="ident" id="8512627">Sleep</span><span class="op" id="8512632">(</span><span class="num" id="8512633">10</span>&nbsp;<span class="op" id="8512636">*</span>&nbsp;<span class="ident" id="8512638">time</span><span class="op" id="8512642">.</span><span class="ident" id="8512643">Millisecond</span><span class="op" id="8512654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512657">c</span><span class="op" id="8512658">,</span>&nbsp;<span class="ident" id="8512660">err</span>&nbsp;<span class="op" id="8512664">:=</span>&nbsp;<span class="ident" id="8512667">DialTimeout</span><span class="op" id="8512678">(</span><span class="string" id="8512679">&#34;tcp&#34;</span><span class="op" id="8512684">,</span>&nbsp;<span class="ident" id="8512686">ln</span><span class="op" id="8512688">.</span><span class="ident" id="8512689">Addr</span><span class="op" id="8512693">(</span><span class="op" id="8512694">)</span><span class="op" id="8512695">.</span><span class="ident" id="8512696">String</span><span class="op" id="8512702">(</span><span class="op" id="8512703">)</span><span class="op" id="8512704">,</span>&nbsp;<span class="op" id="8512706">-</span><span class="num" id="8512707">5</span><span class="op" id="8512708">*</span><span class="ident" id="8512709">time</span><span class="op" id="8512713">.</span><span class="ident" id="8512714">Second</span><span class="op" id="8512720">)</span>&nbsp;<span class="comment" id="8512722">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512738">if</span>&nbsp;<span class="ident" id="8512741">err</span>&nbsp;<span class="op" id="8512745">==</span>&nbsp;<span class="ident" id="8512748">nil</span>&nbsp;<span class="op" id="8512752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512756">defer</span>&nbsp;<span class="ident" id="8512762">c</span><span class="op" id="8512763">.</span><span class="ident" id="8512764">Close</span><span class="op" id="8512769">(</span><span class="op" id="8512770">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8512776">if</span>&nbsp;<span class="op" id="8512779">!</span><span class="ident" id="8512780">isTimeout</span><span class="op" id="8512789">(</span><span class="ident" id="8512790">err</span><span class="op" id="8512793">)</span>&nbsp;<span class="op" id="8512795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8512799">t</span><span class="op" id="8512800">.</span><span class="ident" id="8512801">Fatalf</span><span class="op" id="8512807">(</span><span class="string" id="8512808">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8512843">,</span>&nbsp;<span class="ident" id="8512845">err</span><span class="op" id="8512848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8512851">}</span><br>
<span class="lineno"></span><span class="op" id="8512853">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="8512856">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="8512918">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="8512960">func</span>&nbsp;<span class="ident" id="8512965">TestProlongTimeout</span><span class="op" id="8512983">(</span><span class="ident" id="8512984">t</span>&nbsp;<span class="op" id="8512986">*</span><span class="ident" id="8512987">testing</span><span class="op" id="8512994">.</span><span class="ident" id="8512995">T</span><span class="op" id="8512996">)</span>&nbsp;<span class="op" id="8512998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513001">switch</span>&nbsp;<span class="ident" id="8513008">runtime</span><span class="op" id="8513015">.</span><span class="ident" id="8513016">GOOS</span>&nbsp;<span class="op" id="8513021">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513024">case</span>&nbsp;<span class="string" id="8513029">&#34;plan9&#34;</span><span class="op" id="8513036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513040">t</span><span class="op" id="8513041">.</span><span class="ident" id="8513042">Skipf</span><span class="op" id="8513047">(</span><span class="string" id="8513048">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8513069">,</span>&nbsp;<span class="ident" id="8513071">runtime</span><span class="op" id="8513078">.</span><span class="ident" id="8513079">GOOS</span><span class="op" id="8513083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513090">ln</span>&nbsp;<span class="op" id="8513093">:=</span>&nbsp;<span class="ident" id="8513096">newLocalListener</span><span class="op" id="8513112">(</span><span class="ident" id="8513113">t</span><span class="op" id="8513114">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513117">defer</span>&nbsp;<span class="ident" id="8513123">ln</span><span class="op" id="8513125">.</span><span class="ident" id="8513126">Close</span><span class="op" id="8513131">(</span><span class="op" id="8513132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513135">connected</span>&nbsp;<span class="op" id="8513145">:=</span>&nbsp;<span class="builtinfunc" id="8513148">make</span><span class="op" id="8513152">(</span><span class="keyword" id="8513153">chan</span>&nbsp;<span class="builtintype" id="8513158">bool</span><span class="op" id="8513162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513165">go</span>&nbsp;<span class="keyword" id="8513168">func</span><span class="op" id="8513172">(</span><span class="op" id="8513173">)</span>&nbsp;<span class="op" id="8513175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513179">s</span><span class="op" id="8513180">,</span>&nbsp;<span class="ident" id="8513182">err</span>&nbsp;<span class="op" id="8513186">:=</span>&nbsp;<span class="ident" id="8513189">ln</span><span class="op" id="8513191">.</span><span class="ident" id="8513192">Accept</span><span class="op" id="8513198">(</span><span class="op" id="8513199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513203">connected</span>&nbsp;<span class="op" id="8513213">&lt;-</span>&nbsp;<span class="builtintype" id="8513216">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513223">if</span>&nbsp;<span class="ident" id="8513226">err</span>&nbsp;<span class="op" id="8513230">!=</span>&nbsp;<span class="ident" id="8513233">nil</span>&nbsp;<span class="op" id="8513237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513242">t</span><span class="op" id="8513243">.</span><span class="ident" id="8513244">Errorf</span><span class="op" id="8513250">(</span><span class="string" id="8513251">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="8513266">,</span>&nbsp;<span class="ident" id="8513268">err</span><span class="op" id="8513271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513276">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513289">defer</span>&nbsp;<span class="ident" id="8513295">s</span><span class="op" id="8513296">.</span><span class="ident" id="8513297">Close</span><span class="op" id="8513302">(</span><span class="op" id="8513303">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513307">s</span><span class="op" id="8513308">.</span><span class="ident" id="8513309">SetDeadline</span><span class="op" id="8513320">(</span><span class="ident" id="8513321">time</span><span class="op" id="8513325">.</span><span class="ident" id="8513326">Now</span><span class="op" id="8513329">(</span><span class="op" id="8513330">)</span><span class="op" id="8513331">.</span><span class="ident" id="8513332">Add</span><span class="op" id="8513335">(</span><span class="ident" id="8513336">time</span><span class="op" id="8513340">.</span><span class="ident" id="8513341">Hour</span><span class="op" id="8513345">)</span><span class="op" id="8513346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513350">go</span>&nbsp;<span class="keyword" id="8513353">func</span><span class="op" id="8513357">(</span><span class="op" id="8513358">)</span>&nbsp;<span class="op" id="8513360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513365">var</span>&nbsp;<span class="ident" id="8513369">buf</span>&nbsp;<span class="op" id="8513373">[</span><span class="num" id="8513374">4096</span><span class="op" id="8513378">]</span><span class="builtintype" id="8513379">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513387">for</span>&nbsp;<span class="op" id="8513391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513397">_</span><span class="op" id="8513398">,</span>&nbsp;<span class="ident" id="8513400">err</span>&nbsp;<span class="op" id="8513404">:=</span>&nbsp;<span class="ident" id="8513407">s</span><span class="op" id="8513408">.</span><span class="ident" id="8513409">Write</span><span class="op" id="8513414">(</span><span class="ident" id="8513415">buf</span><span class="op" id="8513418">[</span><span class="op" id="8513419">:</span><span class="op" id="8513420">]</span><span class="op" id="8513421">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513427">if</span>&nbsp;<span class="ident" id="8513430">err</span>&nbsp;<span class="op" id="8513434">!=</span>&nbsp;<span class="ident" id="8513437">nil</span>&nbsp;<span class="op" id="8513441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513448">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513464">s</span><span class="op" id="8513465">.</span><span class="ident" id="8513466">SetDeadline</span><span class="op" id="8513477">(</span><span class="ident" id="8513478">time</span><span class="op" id="8513482">.</span><span class="ident" id="8513483">Now</span><span class="op" id="8513486">(</span><span class="op" id="8513487">)</span><span class="op" id="8513488">.</span><span class="ident" id="8513489">Add</span><span class="op" id="8513492">(</span><span class="ident" id="8513493">time</span><span class="op" id="8513497">.</span><span class="ident" id="8513498">Hour</span><span class="op" id="8513502">)</span><span class="op" id="8513503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513508">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513512">}</span><span class="op" id="8513513">(</span><span class="op" id="8513514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513518">buf</span>&nbsp;<span class="op" id="8513522">:=</span>&nbsp;<span class="builtinfunc" id="8513525">make</span><span class="op" id="8513529">(</span><span class="op" id="8513530">[</span><span class="op" id="8513531">]</span><span class="builtintype" id="8513532">byte</span><span class="op" id="8513536">,</span>&nbsp;<span class="num" id="8513538">1</span><span class="op" id="8513539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513543">for</span>&nbsp;<span class="op" id="8513547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513552">_</span><span class="op" id="8513553">,</span>&nbsp;<span class="ident" id="8513555">err</span>&nbsp;<span class="op" id="8513559">:=</span>&nbsp;<span class="ident" id="8513562">s</span><span class="op" id="8513563">.</span><span class="ident" id="8513564">Read</span><span class="op" id="8513568">(</span><span class="ident" id="8513569">buf</span><span class="op" id="8513572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513577">if</span>&nbsp;<span class="ident" id="8513580">err</span>&nbsp;<span class="op" id="8513584">!=</span>&nbsp;<span class="ident" id="8513587">nil</span>&nbsp;<span class="op" id="8513591">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513597">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513611">s</span><span class="op" id="8513612">.</span><span class="ident" id="8513613">SetDeadline</span><span class="op" id="8513624">(</span><span class="ident" id="8513625">time</span><span class="op" id="8513629">.</span><span class="ident" id="8513630">Now</span><span class="op" id="8513633">(</span><span class="op" id="8513634">)</span><span class="op" id="8513635">.</span><span class="ident" id="8513636">Add</span><span class="op" id="8513639">(</span><span class="ident" id="8513640">time</span><span class="op" id="8513644">.</span><span class="ident" id="8513645">Hour</span><span class="op" id="8513649">)</span><span class="op" id="8513650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513657">}</span><span class="op" id="8513658">(</span><span class="op" id="8513659">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513662">c</span><span class="op" id="8513663">,</span>&nbsp;<span class="ident" id="8513665">err</span>&nbsp;<span class="op" id="8513669">:=</span>&nbsp;<span class="ident" id="8513672">Dial</span><span class="op" id="8513676">(</span><span class="string" id="8513677">&#34;tcp&#34;</span><span class="op" id="8513682">,</span>&nbsp;<span class="ident" id="8513684">ln</span><span class="op" id="8513686">.</span><span class="ident" id="8513687">Addr</span><span class="op" id="8513691">(</span><span class="op" id="8513692">)</span><span class="op" id="8513693">.</span><span class="ident" id="8513694">String</span><span class="op" id="8513700">(</span><span class="op" id="8513701">)</span><span class="op" id="8513702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513705">if</span>&nbsp;<span class="ident" id="8513708">err</span>&nbsp;<span class="op" id="8513712">!=</span>&nbsp;<span class="ident" id="8513715">nil</span>&nbsp;<span class="op" id="8513719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513723">t</span><span class="op" id="8513724">.</span><span class="ident" id="8513725">Fatalf</span><span class="op" id="8513731">(</span><span class="string" id="8513732">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="8513745">,</span>&nbsp;<span class="ident" id="8513747">err</span><span class="op" id="8513750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513756">defer</span>&nbsp;<span class="ident" id="8513762">c</span><span class="op" id="8513763">.</span><span class="ident" id="8513764">Close</span><span class="op" id="8513769">(</span><span class="op" id="8513770">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513773">&lt;-</span><span class="ident" id="8513775">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513786">for</span>&nbsp;<span class="ident" id="8513790">i</span>&nbsp;<span class="op" id="8513792">:=</span>&nbsp;<span class="num" id="8513795">0</span><span class="op" id="8513796">;</span>&nbsp;<span class="ident" id="8513798">i</span>&nbsp;<span class="op" id="8513800">&lt;</span>&nbsp;<span class="num" id="8513802">1024</span><span class="op" id="8513806">;</span>&nbsp;<span class="ident" id="8513808">i</span><span class="op" id="8513809">++</span>&nbsp;<span class="op" id="8513812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513816">var</span>&nbsp;<span class="ident" id="8513820">buf</span>&nbsp;<span class="op" id="8513824">[</span><span class="num" id="8513825">1</span><span class="op" id="8513826">]</span><span class="builtintype" id="8513827">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513834">c</span><span class="op" id="8513835">.</span><span class="ident" id="8513836">Write</span><span class="op" id="8513841">(</span><span class="ident" id="8513842">buf</span><span class="op" id="8513845">[</span><span class="op" id="8513846">:</span><span class="op" id="8513847">]</span><span class="op" id="8513848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513851">}</span><br>
<span class="lineno">710</span><span class="op" id="8513853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8513856">func</span>&nbsp;<span class="ident" id="8513861">TestDeadlineRace</span><span class="op" id="8513877">(</span><span class="ident" id="8513878">t</span>&nbsp;<span class="op" id="8513880">*</span><span class="ident" id="8513881">testing</span><span class="op" id="8513888">.</span><span class="ident" id="8513889">T</span><span class="op" id="8513890">)</span>&nbsp;<span class="op" id="8513892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513895">switch</span>&nbsp;<span class="ident" id="8513902">runtime</span><span class="op" id="8513909">.</span><span class="ident" id="8513910">GOOS</span>&nbsp;<span class="op" id="8513915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8513918">case</span>&nbsp;<span class="string" id="8513923">&#34;nacl&#34;</span><span class="op" id="8513929">,</span>&nbsp;<span class="string" id="8513931">&#34;plan9&#34;</span><span class="op" id="8513938">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513942">t</span><span class="op" id="8513943">.</span><span class="ident" id="8513944">Skipf</span><span class="op" id="8513949">(</span><span class="string" id="8513950">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8513971">,</span>&nbsp;<span class="ident" id="8513973">runtime</span><span class="op" id="8513980">.</span><span class="ident" id="8513981">GOOS</span><span class="op" id="8513985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8513988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8513992">N</span>&nbsp;<span class="op" id="8513994">:=</span>&nbsp;<span class="num" id="8513997">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514003">if</span>&nbsp;<span class="ident" id="8514006">testing</span><span class="op" id="8514013">.</span><span class="ident" id="8514014">Short</span><span class="op" id="8514019">(</span><span class="op" id="8514020">)</span>&nbsp;<span class="op" id="8514022">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514026">N</span>&nbsp;<span class="op" id="8514028">=</span>&nbsp;<span class="num" id="8514030">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514037">defer</span>&nbsp;<span class="ident" id="8514043">runtime</span><span class="op" id="8514050">.</span><span class="ident" id="8514051">GOMAXPROCS</span><span class="op" id="8514061">(</span><span class="ident" id="8514062">runtime</span><span class="op" id="8514069">.</span><span class="ident" id="8514070">GOMAXPROCS</span><span class="op" id="8514080">(</span><span class="num" id="8514081">4</span><span class="op" id="8514082">)</span><span class="op" id="8514083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514086">ln</span>&nbsp;<span class="op" id="8514089">:=</span>&nbsp;<span class="ident" id="8514092">newLocalListener</span><span class="op" id="8514108">(</span><span class="ident" id="8514109">t</span><span class="op" id="8514110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514113">defer</span>&nbsp;<span class="ident" id="8514119">ln</span><span class="op" id="8514121">.</span><span class="ident" id="8514122">Close</span><span class="op" id="8514127">(</span><span class="op" id="8514128">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514131">c</span><span class="op" id="8514132">,</span>&nbsp;<span class="ident" id="8514134">err</span>&nbsp;<span class="op" id="8514138">:=</span>&nbsp;<span class="ident" id="8514141">Dial</span><span class="op" id="8514145">(</span><span class="string" id="8514146">&#34;tcp&#34;</span><span class="op" id="8514151">,</span>&nbsp;<span class="ident" id="8514153">ln</span><span class="op" id="8514155">.</span><span class="ident" id="8514156">Addr</span><span class="op" id="8514160">(</span><span class="op" id="8514161">)</span><span class="op" id="8514162">.</span><span class="ident" id="8514163">String</span><span class="op" id="8514169">(</span><span class="op" id="8514170">)</span><span class="op" id="8514171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514174">if</span>&nbsp;<span class="ident" id="8514177">err</span>&nbsp;<span class="op" id="8514181">!=</span>&nbsp;<span class="ident" id="8514184">nil</span>&nbsp;<span class="op" id="8514188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514192">t</span><span class="op" id="8514193">.</span><span class="ident" id="8514194">Fatalf</span><span class="op" id="8514200">(</span><span class="string" id="8514201">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8514211">,</span>&nbsp;<span class="ident" id="8514213">err</span><span class="op" id="8514216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514222">defer</span>&nbsp;<span class="ident" id="8514228">c</span><span class="op" id="8514229">.</span><span class="ident" id="8514230">Close</span><span class="op" id="8514235">(</span><span class="op" id="8514236">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514239">done</span>&nbsp;<span class="op" id="8514244">:=</span>&nbsp;<span class="builtinfunc" id="8514247">make</span><span class="op" id="8514251">(</span><span class="keyword" id="8514252">chan</span>&nbsp;<span class="builtintype" id="8514257">bool</span><span class="op" id="8514261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514264">go</span>&nbsp;<span class="keyword" id="8514267">func</span><span class="op" id="8514271">(</span><span class="op" id="8514272">)</span>&nbsp;<span class="op" id="8514274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514278">t</span>&nbsp;<span class="op" id="8514280">:=</span>&nbsp;<span class="ident" id="8514283">time</span><span class="op" id="8514287">.</span><span class="ident" id="8514288">NewTicker</span><span class="op" id="8514297">(</span><span class="num" id="8514298">2</span>&nbsp;<span class="op" id="8514300">*</span>&nbsp;<span class="ident" id="8514302">time</span><span class="op" id="8514306">.</span><span class="ident" id="8514307">Microsecond</span><span class="op" id="8514318">)</span><span class="op" id="8514319">.</span><span class="ident" id="8514320">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514324">for</span>&nbsp;<span class="ident" id="8514328">i</span>&nbsp;<span class="op" id="8514330">:=</span>&nbsp;<span class="num" id="8514333">0</span><span class="op" id="8514334">;</span>&nbsp;<span class="ident" id="8514336">i</span>&nbsp;<span class="op" id="8514338">&lt;</span>&nbsp;<span class="ident" id="8514340">N</span><span class="op" id="8514341">;</span>&nbsp;<span class="ident" id="8514343">i</span><span class="op" id="8514344">++</span>&nbsp;<span class="op" id="8514347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514352">if</span>&nbsp;<span class="ident" id="8514355">err</span>&nbsp;<span class="op" id="8514359">:=</span>&nbsp;<span class="ident" id="8514362">c</span><span class="op" id="8514363">.</span><span class="ident" id="8514364">SetDeadline</span><span class="op" id="8514375">(</span><span class="ident" id="8514376">time</span><span class="op" id="8514380">.</span><span class="ident" id="8514381">Now</span><span class="op" id="8514384">(</span><span class="op" id="8514385">)</span><span class="op" id="8514386">.</span><span class="ident" id="8514387">Add</span><span class="op" id="8514390">(</span><span class="num" id="8514391">2</span>&nbsp;<span class="op" id="8514393">*</span>&nbsp;<span class="ident" id="8514395">time</span><span class="op" id="8514399">.</span><span class="ident" id="8514400">Microsecond</span><span class="op" id="8514411">)</span><span class="op" id="8514412">)</span><span class="op" id="8514413">;</span>&nbsp;<span class="ident" id="8514415">err</span>&nbsp;<span class="op" id="8514419">!=</span>&nbsp;<span class="ident" id="8514422">nil</span>&nbsp;<span class="op" id="8514426">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514432">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514446">&lt;-</span><span class="ident" id="8514448">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514456">done</span>&nbsp;<span class="op" id="8514461">&lt;-</span>&nbsp;<span class="builtintype" id="8514464">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514470">}</span><span class="op" id="8514471">(</span><span class="op" id="8514472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514475">var</span>&nbsp;<span class="ident" id="8514479">buf</span>&nbsp;<span class="op" id="8514483">[</span><span class="num" id="8514484">1</span><span class="op" id="8514485">]</span><span class="builtintype" id="8514486">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8514492">for</span>&nbsp;<span class="ident" id="8514496">i</span>&nbsp;<span class="op" id="8514498">:=</span>&nbsp;<span class="num" id="8514501">0</span><span class="op" id="8514502">;</span>&nbsp;<span class="ident" id="8514504">i</span>&nbsp;<span class="op" id="8514506">&lt;</span>&nbsp;<span class="ident" id="8514508">N</span><span class="op" id="8514509">;</span>&nbsp;<span class="ident" id="8514511">i</span><span class="op" id="8514512">++</span>&nbsp;<span class="op" id="8514515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514519">c</span><span class="op" id="8514520">.</span><span class="ident" id="8514521">Read</span><span class="op" id="8514525">(</span><span class="ident" id="8514526">buf</span><span class="op" id="8514529">[</span><span class="op" id="8514530">:</span><span class="op" id="8514531">]</span><span class="op" id="8514532">)</span>&nbsp;<span class="comment" id="8514534">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514569">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8514572">c</span><span class="op" id="8514573">.</span><span class="ident" id="8514574">Close</span><span class="op" id="8514579">(</span><span class="op" id="8514580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8514583">&lt;-</span><span class="ident" id="8514585">done</span><br>
<span class="lineno"></span><span class="op" id="8514590">}</span>
</div>
</body>
</html>
