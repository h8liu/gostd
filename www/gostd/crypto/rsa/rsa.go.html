<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3709735">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3709790">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3709844">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3709895">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="3709960">package</span>&nbsp;<span class="ident" id="3709968">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3709973">import</span>&nbsp;<span class="op" id="3709980">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3709983">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3709993">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3710008">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3710025">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3710035">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3710043">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3710049">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3710060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3710063">var</span>&nbsp;<span class="ident" id="3710067">bigZero</span>&nbsp;<span class="op" id="3710075">=</span>&nbsp;<span class="ident" id="3710077">big</span><span class="op" id="3710080">.</span><span class="ident" id="3710081">NewInt</span><span class="op" id="3710087">(</span><span class="num" id="3710088">0</span><span class="op" id="3710089">)</span><br>
<span class="lineno"></span><span class="keyword" id="3710091">var</span>&nbsp;<span class="ident" id="3710095">bigOne</span>&nbsp;<span class="op" id="3710102">=</span>&nbsp;<span class="ident" id="3710104">big</span><span class="op" id="3710107">.</span><span class="ident" id="3710108">NewInt</span><span class="op" id="3710114">(</span><span class="num" id="3710115">1</span><span class="op" id="3710116">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3710119">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3710176">type</span>&nbsp;<span class="ident" id="3710181">PublicKey</span>&nbsp;<span class="keyword" id="3710191">struct</span>&nbsp;<span class="op" id="3710198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710201">N</span>&nbsp;<span class="op" id="3710203">*</span><span class="ident" id="3710204">big</span><span class="op" id="3710207">.</span><span class="ident" id="3710208">Int</span>&nbsp;<span class="comment" id="3710212">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710224">E</span>&nbsp;<span class="builtintype" id="3710226">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710235">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="3710254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3710257">var</span>&nbsp;<span class="op" id="3710261">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710264">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3710287">=</span>&nbsp;<span class="ident" id="3710289">errors</span><span class="op" id="3710295">.</span><span class="ident" id="3710296">New</span><span class="op" id="3710299">(</span><span class="string" id="3710300">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="3710336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710339">errPublicExponentSmall</span>&nbsp;<span class="op" id="3710362">=</span>&nbsp;<span class="ident" id="3710364">errors</span><span class="op" id="3710370">.</span><span class="ident" id="3710371">New</span><span class="op" id="3710374">(</span><span class="string" id="3710375">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="3710414">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710417">errPublicExponentLarge</span>&nbsp;<span class="op" id="3710440">=</span>&nbsp;<span class="ident" id="3710442">errors</span><span class="op" id="3710448">.</span><span class="ident" id="3710449">New</span><span class="op" id="3710452">(</span><span class="string" id="3710453">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="3710492">)</span><br>
<span class="lineno"></span><span class="op" id="3710494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3710497">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3710556">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="3710616">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="3710671">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="3710705">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="3710760">func</span>&nbsp;<span class="ident" id="3710765">checkPub</span><span class="op" id="3710773">(</span><span class="ident" id="3710774">pub</span>&nbsp;<span class="op" id="3710778">*</span><span class="ident" id="3710779">PublicKey</span><span class="op" id="3710788">)</span>&nbsp;<span class="builtintype" id="3710790">error</span>&nbsp;<span class="op" id="3710796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710799">if</span>&nbsp;<span class="ident" id="3710802">pub</span><span class="op" id="3710805">.</span><span class="ident" id="3710806">N</span>&nbsp;<span class="op" id="3710808">==</span>&nbsp;<span class="ident" id="3710811">nil</span>&nbsp;<span class="op" id="3710815">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710819">return</span>&nbsp;<span class="ident" id="3710826">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710847">if</span>&nbsp;<span class="ident" id="3710850">pub</span><span class="op" id="3710853">.</span><span class="ident" id="3710854">E</span>&nbsp;<span class="op" id="3710856">&lt;</span>&nbsp;<span class="num" id="3710858">2</span>&nbsp;<span class="op" id="3710860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710864">return</span>&nbsp;<span class="ident" id="3710871">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710895">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710898">if</span>&nbsp;<span class="ident" id="3710901">pub</span><span class="op" id="3710904">.</span><span class="ident" id="3710905">E</span>&nbsp;<span class="op" id="3710907">&gt;</span>&nbsp;<span class="num" id="3710909">1</span><span class="op" id="3710910">&lt;&lt;</span><span class="num" id="3710912">31</span><span class="op" id="3710914">-</span><span class="num" id="3710915">1</span>&nbsp;<span class="op" id="3710917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710921">return</span>&nbsp;<span class="ident" id="3710928">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710955">return</span>&nbsp;<span class="ident" id="3710962">nil</span><br>
<span class="lineno"></span><span class="op" id="3710966">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3710969">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="3711007">type</span>&nbsp;<span class="ident" id="3711012">PrivateKey</span>&nbsp;<span class="keyword" id="3711023">struct</span>&nbsp;<span class="op" id="3711030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711033">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3711054">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711071">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711081">*</span><span class="ident" id="3711082">big</span><span class="op" id="3711085">.</span><span class="ident" id="3711086">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3711092">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711113">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711123">[</span><span class="op" id="3711124">]</span><span class="op" id="3711125">*</span><span class="ident" id="3711126">big</span><span class="op" id="3711129">.</span><span class="ident" id="3711130">Int</span>&nbsp;<span class="comment" id="3711134">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3711178">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3711244">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711274">Precomputed</span>&nbsp;<span class="ident" id="3711286">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="3711304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711307">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="3711363">func</span>&nbsp;<span class="op" id="3711368">(</span><span class="ident" id="3711369">priv</span>&nbsp;<span class="op" id="3711374">*</span><span class="ident" id="3711375">PrivateKey</span><span class="op" id="3711385">)</span>&nbsp;<span class="ident" id="3711387">Public</span><span class="op" id="3711393">(</span><span class="op" id="3711394">)</span>&nbsp;<span class="ident" id="3711396">crypto</span><span class="op" id="3711402">.</span><span class="ident" id="3711403">PublicKey</span>&nbsp;<span class="op" id="3711413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711416">return</span>&nbsp;<span class="op" id="3711423">&amp;</span><span class="ident" id="3711424">priv</span><span class="op" id="3711428">.</span><span class="ident" id="3711429">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="3711439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711442">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3711514">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3711593">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="3711671">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="3711748">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="3711778">func</span>&nbsp;<span class="op" id="3711783">(</span><span class="ident" id="3711784">priv</span>&nbsp;<span class="op" id="3711789">*</span><span class="ident" id="3711790">PrivateKey</span><span class="op" id="3711800">)</span>&nbsp;<span class="ident" id="3711802">Sign</span><span class="op" id="3711806">(</span><span class="ident" id="3711807">rand</span>&nbsp;<span class="ident" id="3711812">io</span><span class="op" id="3711814">.</span><span class="ident" id="3711815">Reader</span><span class="op" id="3711821">,</span>&nbsp;<span class="ident" id="3711823">msg</span>&nbsp;<span class="op" id="3711827">[</span><span class="op" id="3711828">]</span><span class="builtintype" id="3711829">byte</span><span class="op" id="3711833">,</span>&nbsp;<span class="ident" id="3711835">opts</span>&nbsp;<span class="ident" id="3711840">crypto</span><span class="op" id="3711846">.</span><span class="ident" id="3711847">SignerOpts</span><span class="op" id="3711857">)</span>&nbsp;<span class="op" id="3711859">(</span><span class="op" id="3711860">[</span><span class="op" id="3711861">]</span><span class="builtintype" id="3711862">byte</span><span class="op" id="3711866">,</span>&nbsp;<span class="builtintype" id="3711868">error</span><span class="op" id="3711873">)</span>&nbsp;<span class="op" id="3711875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711878">if</span>&nbsp;<span class="ident" id="3711881">pssOpts</span><span class="op" id="3711888">,</span>&nbsp;<span class="ident" id="3711890">ok</span>&nbsp;<span class="op" id="3711893">:=</span>&nbsp;<span class="ident" id="3711896">opts</span><span class="op" id="3711900">.</span><span class="op" id="3711901">(</span><span class="op" id="3711902">*</span><span class="ident" id="3711903">PSSOptions</span><span class="op" id="3711913">)</span><span class="op" id="3711914">;</span>&nbsp;<span class="ident" id="3711916">ok</span>&nbsp;<span class="op" id="3711919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711923">return</span>&nbsp;<span class="ident" id="3711930">SignPSS</span><span class="op" id="3711937">(</span><span class="ident" id="3711938">rand</span><span class="op" id="3711942">,</span>&nbsp;<span class="ident" id="3711944">priv</span><span class="op" id="3711948">,</span>&nbsp;<span class="ident" id="3711950">pssOpts</span><span class="op" id="3711957">.</span><span class="ident" id="3711958">Hash</span><span class="op" id="3711962">,</span>&nbsp;<span class="ident" id="3711964">msg</span><span class="op" id="3711967">,</span>&nbsp;<span class="ident" id="3711969">pssOpts</span><span class="op" id="3711976">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711983">return</span>&nbsp;<span class="ident" id="3711990">SignPKCS1v15</span><span class="op" id="3712002">(</span><span class="ident" id="3712003">rand</span><span class="op" id="3712007">,</span>&nbsp;<span class="ident" id="3712009">priv</span><span class="op" id="3712013">,</span>&nbsp;<span class="ident" id="3712015">opts</span><span class="op" id="3712019">.</span><span class="ident" id="3712020">HashFunc</span><span class="op" id="3712028">(</span><span class="op" id="3712029">)</span><span class="op" id="3712030">,</span>&nbsp;<span class="ident" id="3712032">msg</span><span class="op" id="3712035">)</span><br>
<span class="lineno"></span><span class="op" id="3712037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3712040">type</span>&nbsp;<span class="ident" id="3712045">PrecomputedValues</span>&nbsp;<span class="keyword" id="3712063">struct</span>&nbsp;<span class="op" id="3712070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712073">Dp</span><span class="op" id="3712075">,</span>&nbsp;<span class="ident" id="3712077">Dq</span>&nbsp;<span class="op" id="3712080">*</span><span class="ident" id="3712081">big</span><span class="op" id="3712084">.</span><span class="ident" id="3712085">Int</span>&nbsp;<span class="comment" id="3712089">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712118">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3712125">*</span><span class="ident" id="3712126">big</span><span class="op" id="3712129">.</span><span class="ident" id="3712130">Int</span>&nbsp;<span class="comment" id="3712134">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712150">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712216">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712285">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712348">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712383">CRTValues</span>&nbsp;<span class="op" id="3712393">[</span><span class="op" id="3712394">]</span><span class="ident" id="3712395">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="3712404">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="3712407">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3712478">type</span>&nbsp;<span class="ident" id="3712483">CRTValue</span>&nbsp;<span class="keyword" id="3712492">struct</span>&nbsp;<span class="op" id="3712499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712502">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3712508">*</span><span class="ident" id="3712509">big</span><span class="op" id="3712512">.</span><span class="ident" id="3712513">Int</span>&nbsp;<span class="comment" id="3712517">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712538">Coeff</span>&nbsp;<span class="op" id="3712544">*</span><span class="ident" id="3712545">big</span><span class="op" id="3712548">.</span><span class="ident" id="3712549">Int</span>&nbsp;<span class="comment" id="3712553">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712583">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712589">*</span><span class="ident" id="3712590">big</span><span class="op" id="3712593">.</span><span class="ident" id="3712594">Int</span>&nbsp;<span class="comment" id="3712598">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="3712648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712651">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3712704">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="3712782">func</span>&nbsp;<span class="op" id="3712787">(</span><span class="ident" id="3712788">priv</span>&nbsp;<span class="op" id="3712793">*</span><span class="ident" id="3712794">PrivateKey</span><span class="op" id="3712804">)</span>&nbsp;<span class="ident" id="3712806">Validate</span><span class="op" id="3712814">(</span><span class="op" id="3712815">)</span>&nbsp;<span class="builtintype" id="3712817">error</span>&nbsp;<span class="op" id="3712823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712826">if</span>&nbsp;<span class="ident" id="3712829">err</span>&nbsp;<span class="op" id="3712833">:=</span>&nbsp;<span class="ident" id="3712836">checkPub</span><span class="op" id="3712844">(</span><span class="op" id="3712845">&amp;</span><span class="ident" id="3712846">priv</span><span class="op" id="3712850">.</span><span class="ident" id="3712851">PublicKey</span><span class="op" id="3712860">)</span><span class="op" id="3712861">;</span>&nbsp;<span class="ident" id="3712863">err</span>&nbsp;<span class="op" id="3712867">!=</span>&nbsp;<span class="ident" id="3712870">nil</span>&nbsp;<span class="op" id="3712874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712878">return</span>&nbsp;<span class="ident" id="3712885">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712894">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712965">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713027">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713097">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713164">for</span>&nbsp;<span class="ident" id="3713168">_</span><span class="op" id="3713169">,</span>&nbsp;<span class="ident" id="3713171">prime</span>&nbsp;<span class="op" id="3713177">:=</span>&nbsp;<span class="keyword" id="3713180">range</span>&nbsp;<span class="ident" id="3713186">priv</span><span class="op" id="3713190">.</span><span class="ident" id="3713191">Primes</span>&nbsp;<span class="op" id="3713198">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713202">if</span>&nbsp;<span class="op" id="3713205">!</span><span class="ident" id="3713206">prime</span><span class="op" id="3713211">.</span><span class="ident" id="3713212">ProbablyPrime</span><span class="op" id="3713225">(</span><span class="num" id="3713226">20</span><span class="op" id="3713228">)</span>&nbsp;<span class="op" id="3713230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713235">return</span>&nbsp;<span class="ident" id="3713242">errors</span><span class="op" id="3713248">.</span><span class="ident" id="3713249">New</span><span class="op" id="3713252">(</span><span class="string" id="3713253">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="3713292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713303">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713333">modulus</span>&nbsp;<span class="op" id="3713341">:=</span>&nbsp;<span class="builtinfunc" id="3713344">new</span><span class="op" id="3713347">(</span><span class="ident" id="3713348">big</span><span class="op" id="3713351">.</span><span class="ident" id="3713352">Int</span><span class="op" id="3713355">)</span><span class="op" id="3713356">.</span><span class="ident" id="3713357">Set</span><span class="op" id="3713360">(</span><span class="ident" id="3713361">bigOne</span><span class="op" id="3713367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713370">for</span>&nbsp;<span class="ident" id="3713374">_</span><span class="op" id="3713375">,</span>&nbsp;<span class="ident" id="3713377">prime</span>&nbsp;<span class="op" id="3713383">:=</span>&nbsp;<span class="keyword" id="3713386">range</span>&nbsp;<span class="ident" id="3713392">priv</span><span class="op" id="3713396">.</span><span class="ident" id="3713397">Primes</span>&nbsp;<span class="op" id="3713404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713408">modulus</span><span class="op" id="3713415">.</span><span class="ident" id="3713416">Mul</span><span class="op" id="3713419">(</span><span class="ident" id="3713420">modulus</span><span class="op" id="3713427">,</span>&nbsp;<span class="ident" id="3713429">prime</span><span class="op" id="3713434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713437">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713440">if</span>&nbsp;<span class="ident" id="3713443">modulus</span><span class="op" id="3713450">.</span><span class="ident" id="3713451">Cmp</span><span class="op" id="3713454">(</span><span class="ident" id="3713455">priv</span><span class="op" id="3713459">.</span><span class="ident" id="3713460">N</span><span class="op" id="3713461">)</span>&nbsp;<span class="op" id="3713463">!=</span>&nbsp;<span class="num" id="3713466">0</span>&nbsp;<span class="op" id="3713468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713472">return</span>&nbsp;<span class="ident" id="3713479">errors</span><span class="op" id="3713485">.</span><span class="ident" id="3713486">New</span><span class="op" id="3713489">(</span><span class="string" id="3713490">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="3713519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713526">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713575">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713648">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713710">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713789">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713859">congruence</span>&nbsp;<span class="op" id="3713870">:=</span>&nbsp;<span class="builtinfunc" id="3713873">new</span><span class="op" id="3713876">(</span><span class="ident" id="3713877">big</span><span class="op" id="3713880">.</span><span class="ident" id="3713881">Int</span><span class="op" id="3713884">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713887">de</span>&nbsp;<span class="op" id="3713890">:=</span>&nbsp;<span class="builtinfunc" id="3713893">new</span><span class="op" id="3713896">(</span><span class="ident" id="3713897">big</span><span class="op" id="3713900">.</span><span class="ident" id="3713901">Int</span><span class="op" id="3713904">)</span><span class="op" id="3713905">.</span><span class="ident" id="3713906">SetInt64</span><span class="op" id="3713914">(</span><span class="ident" id="3713915">int64</span><span class="op" id="3713920">(</span><span class="ident" id="3713921">priv</span><span class="op" id="3713925">.</span><span class="ident" id="3713926">E</span><span class="op" id="3713927">)</span><span class="op" id="3713928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713931">de</span><span class="op" id="3713933">.</span><span class="ident" id="3713934">Mul</span><span class="op" id="3713937">(</span><span class="ident" id="3713938">de</span><span class="op" id="3713940">,</span>&nbsp;<span class="ident" id="3713942">priv</span><span class="op" id="3713946">.</span><span class="ident" id="3713947">D</span><span class="op" id="3713948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713951">for</span>&nbsp;<span class="ident" id="3713955">_</span><span class="op" id="3713956">,</span>&nbsp;<span class="ident" id="3713958">prime</span>&nbsp;<span class="op" id="3713964">:=</span>&nbsp;<span class="keyword" id="3713967">range</span>&nbsp;<span class="ident" id="3713973">priv</span><span class="op" id="3713977">.</span><span class="ident" id="3713978">Primes</span>&nbsp;<span class="op" id="3713985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713989">pminus1</span>&nbsp;<span class="op" id="3713997">:=</span>&nbsp;<span class="builtinfunc" id="3714000">new</span><span class="op" id="3714003">(</span><span class="ident" id="3714004">big</span><span class="op" id="3714007">.</span><span class="ident" id="3714008">Int</span><span class="op" id="3714011">)</span><span class="op" id="3714012">.</span><span class="ident" id="3714013">Sub</span><span class="op" id="3714016">(</span><span class="ident" id="3714017">prime</span><span class="op" id="3714022">,</span>&nbsp;<span class="ident" id="3714024">bigOne</span><span class="op" id="3714030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714034">congruence</span><span class="op" id="3714044">.</span><span class="ident" id="3714045">Mod</span><span class="op" id="3714048">(</span><span class="ident" id="3714049">de</span><span class="op" id="3714051">,</span>&nbsp;<span class="ident" id="3714053">pminus1</span><span class="op" id="3714060">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714064">if</span>&nbsp;<span class="ident" id="3714067">congruence</span><span class="op" id="3714077">.</span><span class="ident" id="3714078">Cmp</span><span class="op" id="3714081">(</span><span class="ident" id="3714082">bigOne</span><span class="op" id="3714088">)</span>&nbsp;<span class="op" id="3714090">!=</span>&nbsp;<span class="num" id="3714093">0</span>&nbsp;<span class="op" id="3714095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714100">return</span>&nbsp;<span class="ident" id="3714107">errors</span><span class="op" id="3714113">.</span><span class="ident" id="3714114">New</span><span class="op" id="3714117">(</span><span class="string" id="3714118">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="3714149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714159">return</span>&nbsp;<span class="ident" id="3714166">nil</span><br>
<span class="lineno">140</span><span class="op" id="3714170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714173">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3714245">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="3714304">func</span>&nbsp;<span class="ident" id="3714309">GenerateKey</span><span class="op" id="3714320">(</span><span class="ident" id="3714321">random</span>&nbsp;<span class="ident" id="3714328">io</span><span class="op" id="3714330">.</span><span class="ident" id="3714331">Reader</span><span class="op" id="3714337">,</span>&nbsp;<span class="ident" id="3714339">bits</span>&nbsp;<span class="builtintype" id="3714344">int</span><span class="op" id="3714347">)</span>&nbsp;<span class="op" id="3714349">(</span><span class="ident" id="3714350">priv</span>&nbsp;<span class="op" id="3714355">*</span><span class="ident" id="3714356">PrivateKey</span><span class="op" id="3714366">,</span>&nbsp;<span class="ident" id="3714368">err</span>&nbsp;<span class="builtintype" id="3714372">error</span><span class="op" id="3714377">)</span>&nbsp;<span class="op" id="3714379">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714382">return</span>&nbsp;<span class="ident" id="3714389">GenerateMultiPrimeKey</span><span class="op" id="3714410">(</span><span class="ident" id="3714411">random</span><span class="op" id="3714417">,</span>&nbsp;<span class="num" id="3714419">2</span><span class="op" id="3714420">,</span>&nbsp;<span class="ident" id="3714422">bits</span><span class="op" id="3714426">)</span><br>
<span class="lineno"></span><span class="op" id="3714428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714431">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="3714509">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="3714587">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="3714663">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="3714742">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="3714819">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3714828">//</span><br>
<span class="lineno">155</span><span class="comment" id="3714831">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="3714902">//</span><br>
<span class="lineno"></span><span class="comment" id="3714905">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="3714946">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3715020">func</span>&nbsp;<span class="ident" id="3715025">GenerateMultiPrimeKey</span><span class="op" id="3715046">(</span><span class="ident" id="3715047">random</span>&nbsp;<span class="ident" id="3715054">io</span><span class="op" id="3715056">.</span><span class="ident" id="3715057">Reader</span><span class="op" id="3715063">,</span>&nbsp;<span class="ident" id="3715065">nprimes</span>&nbsp;<span class="builtintype" id="3715073">int</span><span class="op" id="3715076">,</span>&nbsp;<span class="ident" id="3715078">bits</span>&nbsp;<span class="builtintype" id="3715083">int</span><span class="op" id="3715086">)</span>&nbsp;<span class="op" id="3715088">(</span><span class="ident" id="3715089">priv</span>&nbsp;<span class="op" id="3715094">*</span><span class="ident" id="3715095">PrivateKey</span><span class="op" id="3715105">,</span>&nbsp;<span class="ident" id="3715107">err</span>&nbsp;<span class="builtintype" id="3715111">error</span><span class="op" id="3715116">)</span>&nbsp;<span class="op" id="3715118">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715121">priv</span>&nbsp;<span class="op" id="3715126">=</span>&nbsp;<span class="builtinfunc" id="3715128">new</span><span class="op" id="3715131">(</span><span class="ident" id="3715132">PrivateKey</span><span class="op" id="3715142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715145">priv</span><span class="op" id="3715149">.</span><span class="ident" id="3715150">E</span>&nbsp;<span class="op" id="3715152">=</span>&nbsp;<span class="num" id="3715154">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715162">if</span>&nbsp;<span class="ident" id="3715165">nprimes</span>&nbsp;<span class="op" id="3715173">&lt;</span>&nbsp;<span class="num" id="3715175">2</span>&nbsp;<span class="op" id="3715177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715181">return</span>&nbsp;<span class="ident" id="3715188">nil</span><span class="op" id="3715191">,</span>&nbsp;<span class="ident" id="3715193">errors</span><span class="op" id="3715199">.</span><span class="ident" id="3715200">New</span><span class="op" id="3715203">(</span><span class="string" id="3715204">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="3715261">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715268">primes</span>&nbsp;<span class="op" id="3715275">:=</span>&nbsp;<span class="builtinfunc" id="3715278">make</span><span class="op" id="3715282">(</span><span class="op" id="3715283">[</span><span class="op" id="3715284">]</span><span class="op" id="3715285">*</span><span class="ident" id="3715286">big</span><span class="op" id="3715289">.</span><span class="ident" id="3715290">Int</span><span class="op" id="3715293">,</span>&nbsp;<span class="ident" id="3715295">nprimes</span><span class="op" id="3715302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3715305">NextSetOfPrimes</span><span class="op" id="3715320">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715323">for</span>&nbsp;<span class="op" id="3715327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715331">todo</span>&nbsp;<span class="op" id="3715336">:=</span>&nbsp;<span class="ident" id="3715339">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715346">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715406">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715440">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715491">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715516">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715540">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715608">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715613">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715677">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715748">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715813">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715842">if</span>&nbsp;<span class="ident" id="3715845">nprimes</span>&nbsp;<span class="op" id="3715853">&gt;=</span>&nbsp;<span class="num" id="3715856">7</span>&nbsp;<span class="op" id="3715858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715863">todo</span>&nbsp;<span class="op" id="3715868">+=</span>&nbsp;<span class="op" id="3715871">(</span><span class="ident" id="3715872">nprimes</span>&nbsp;<span class="op" id="3715880">-</span>&nbsp;<span class="num" id="3715882">2</span><span class="op" id="3715883">)</span>&nbsp;<span class="op" id="3715885">/</span>&nbsp;<span class="num" id="3715887">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715895">for</span>&nbsp;<span class="ident" id="3715899">i</span>&nbsp;<span class="op" id="3715901">:=</span>&nbsp;<span class="num" id="3715904">0</span><span class="op" id="3715905">;</span>&nbsp;<span class="ident" id="3715907">i</span>&nbsp;<span class="op" id="3715909">&lt;</span>&nbsp;<span class="ident" id="3715911">nprimes</span><span class="op" id="3715918">;</span>&nbsp;<span class="ident" id="3715920">i</span><span class="op" id="3715921">++</span>&nbsp;<span class="op" id="3715924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715929">primes</span><span class="op" id="3715935">[</span><span class="ident" id="3715936">i</span><span class="op" id="3715937">]</span><span class="op" id="3715938">,</span>&nbsp;<span class="ident" id="3715940">err</span>&nbsp;<span class="op" id="3715944">=</span>&nbsp;<span class="ident" id="3715946">rand</span><span class="op" id="3715950">.</span><span class="ident" id="3715951">Prime</span><span class="op" id="3715956">(</span><span class="ident" id="3715957">random</span><span class="op" id="3715963">,</span>&nbsp;<span class="ident" id="3715965">todo</span><span class="op" id="3715969">/</span><span class="op" id="3715970">(</span><span class="ident" id="3715971">nprimes</span><span class="op" id="3715978">-</span><span class="ident" id="3715979">i</span><span class="op" id="3715980">)</span><span class="op" id="3715981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715986">if</span>&nbsp;<span class="ident" id="3715989">err</span>&nbsp;<span class="op" id="3715993">!=</span>&nbsp;<span class="ident" id="3715996">nil</span>&nbsp;<span class="op" id="3716000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716006">return</span>&nbsp;<span class="ident" id="3716013">nil</span><span class="op" id="3716016">,</span>&nbsp;<span class="ident" id="3716018">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716030">todo</span>&nbsp;<span class="op" id="3716035">-=</span>&nbsp;<span class="ident" id="3716038">primes</span><span class="op" id="3716044">[</span><span class="ident" id="3716045">i</span><span class="op" id="3716046">]</span><span class="op" id="3716047">.</span><span class="ident" id="3716048">BitLen</span><span class="op" id="3716054">(</span><span class="op" id="3716055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3716064">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716112">for</span>&nbsp;<span class="ident" id="3716116">i</span><span class="op" id="3716117">,</span>&nbsp;<span class="ident" id="3716119">prime</span>&nbsp;<span class="op" id="3716125">:=</span>&nbsp;<span class="keyword" id="3716128">range</span>&nbsp;<span class="ident" id="3716134">primes</span>&nbsp;<span class="op" id="3716141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716146">for</span>&nbsp;<span class="ident" id="3716150">j</span>&nbsp;<span class="op" id="3716152">:=</span>&nbsp;<span class="num" id="3716155">0</span><span class="op" id="3716156">;</span>&nbsp;<span class="ident" id="3716158">j</span>&nbsp;<span class="op" id="3716160">&lt;</span>&nbsp;<span class="ident" id="3716162">i</span><span class="op" id="3716163">;</span>&nbsp;<span class="ident" id="3716165">j</span><span class="op" id="3716166">++</span>&nbsp;<span class="op" id="3716169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716175">if</span>&nbsp;<span class="ident" id="3716178">prime</span><span class="op" id="3716183">.</span><span class="ident" id="3716184">Cmp</span><span class="op" id="3716187">(</span><span class="ident" id="3716188">primes</span><span class="op" id="3716194">[</span><span class="ident" id="3716195">j</span><span class="op" id="3716196">]</span><span class="op" id="3716197">)</span>&nbsp;<span class="op" id="3716199">==</span>&nbsp;<span class="num" id="3716202">0</span>&nbsp;<span class="op" id="3716204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716211">continue</span>&nbsp;<span class="ident" id="3716220">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716240">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716254">n</span>&nbsp;<span class="op" id="3716256">:=</span>&nbsp;<span class="builtinfunc" id="3716259">new</span><span class="op" id="3716262">(</span><span class="ident" id="3716263">big</span><span class="op" id="3716266">.</span><span class="ident" id="3716267">Int</span><span class="op" id="3716270">)</span><span class="op" id="3716271">.</span><span class="ident" id="3716272">Set</span><span class="op" id="3716275">(</span><span class="ident" id="3716276">bigOne</span><span class="op" id="3716282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716286">totient</span>&nbsp;<span class="op" id="3716294">:=</span>&nbsp;<span class="builtinfunc" id="3716297">new</span><span class="op" id="3716300">(</span><span class="ident" id="3716301">big</span><span class="op" id="3716304">.</span><span class="ident" id="3716305">Int</span><span class="op" id="3716308">)</span><span class="op" id="3716309">.</span><span class="ident" id="3716310">Set</span><span class="op" id="3716313">(</span><span class="ident" id="3716314">bigOne</span><span class="op" id="3716320">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716324">pminus1</span>&nbsp;<span class="op" id="3716332">:=</span>&nbsp;<span class="builtinfunc" id="3716335">new</span><span class="op" id="3716338">(</span><span class="ident" id="3716339">big</span><span class="op" id="3716342">.</span><span class="ident" id="3716343">Int</span><span class="op" id="3716346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716350">for</span>&nbsp;<span class="ident" id="3716354">_</span><span class="op" id="3716355">,</span>&nbsp;<span class="ident" id="3716357">prime</span>&nbsp;<span class="op" id="3716363">:=</span>&nbsp;<span class="keyword" id="3716366">range</span>&nbsp;<span class="ident" id="3716372">primes</span>&nbsp;<span class="op" id="3716379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716384">n</span><span class="op" id="3716385">.</span><span class="ident" id="3716386">Mul</span><span class="op" id="3716389">(</span><span class="ident" id="3716390">n</span><span class="op" id="3716391">,</span>&nbsp;<span class="ident" id="3716393">prime</span><span class="op" id="3716398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716403">pminus1</span><span class="op" id="3716410">.</span><span class="ident" id="3716411">Sub</span><span class="op" id="3716414">(</span><span class="ident" id="3716415">prime</span><span class="op" id="3716420">,</span>&nbsp;<span class="ident" id="3716422">bigOne</span><span class="op" id="3716428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716433">totient</span><span class="op" id="3716440">.</span><span class="ident" id="3716441">Mul</span><span class="op" id="3716444">(</span><span class="ident" id="3716445">totient</span><span class="op" id="3716452">,</span>&nbsp;<span class="ident" id="3716454">pminus1</span><span class="op" id="3716461">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716469">if</span>&nbsp;<span class="ident" id="3716472">n</span><span class="op" id="3716473">.</span><span class="ident" id="3716474">BitLen</span><span class="op" id="3716480">(</span><span class="op" id="3716481">)</span>&nbsp;<span class="op" id="3716483">!=</span>&nbsp;<span class="ident" id="3716486">bits</span>&nbsp;<span class="op" id="3716491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3716496">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3716552">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3716613">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716669">continue</span>&nbsp;<span class="ident" id="3716678">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716701">g</span>&nbsp;<span class="op" id="3716703">:=</span>&nbsp;<span class="builtinfunc" id="3716706">new</span><span class="op" id="3716709">(</span><span class="ident" id="3716710">big</span><span class="op" id="3716713">.</span><span class="ident" id="3716714">Int</span><span class="op" id="3716717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716721">priv</span><span class="op" id="3716725">.</span><span class="ident" id="3716726">D</span>&nbsp;<span class="op" id="3716728">=</span>&nbsp;<span class="builtinfunc" id="3716730">new</span><span class="op" id="3716733">(</span><span class="ident" id="3716734">big</span><span class="op" id="3716737">.</span><span class="ident" id="3716738">Int</span><span class="op" id="3716741">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716745">y</span>&nbsp;<span class="op" id="3716747">:=</span>&nbsp;<span class="builtinfunc" id="3716750">new</span><span class="op" id="3716753">(</span><span class="ident" id="3716754">big</span><span class="op" id="3716757">.</span><span class="ident" id="3716758">Int</span><span class="op" id="3716761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716765">e</span>&nbsp;<span class="op" id="3716767">:=</span>&nbsp;<span class="ident" id="3716770">big</span><span class="op" id="3716773">.</span><span class="ident" id="3716774">NewInt</span><span class="op" id="3716780">(</span><span class="ident" id="3716781">int64</span><span class="op" id="3716786">(</span><span class="ident" id="3716787">priv</span><span class="op" id="3716791">.</span><span class="ident" id="3716792">E</span><span class="op" id="3716793">)</span><span class="op" id="3716794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716798">g</span><span class="op" id="3716799">.</span><span class="ident" id="3716800">GCD</span><span class="op" id="3716803">(</span><span class="ident" id="3716804">priv</span><span class="op" id="3716808">.</span><span class="ident" id="3716809">D</span><span class="op" id="3716810">,</span>&nbsp;<span class="ident" id="3716812">y</span><span class="op" id="3716813">,</span>&nbsp;<span class="ident" id="3716815">e</span><span class="op" id="3716816">,</span>&nbsp;<span class="ident" id="3716818">totient</span><span class="op" id="3716825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716830">if</span>&nbsp;<span class="ident" id="3716833">g</span><span class="op" id="3716834">.</span><span class="ident" id="3716835">Cmp</span><span class="op" id="3716838">(</span><span class="ident" id="3716839">bigOne</span><span class="op" id="3716845">)</span>&nbsp;<span class="op" id="3716847">==</span>&nbsp;<span class="num" id="3716850">0</span>&nbsp;<span class="op" id="3716852">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716857">if</span>&nbsp;<span class="ident" id="3716860">priv</span><span class="op" id="3716864">.</span><span class="ident" id="3716865">D</span><span class="op" id="3716866">.</span><span class="ident" id="3716867">Sign</span><span class="op" id="3716871">(</span><span class="op" id="3716872">)</span>&nbsp;<span class="op" id="3716874">&lt;</span>&nbsp;<span class="num" id="3716876">0</span>&nbsp;<span class="op" id="3716878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716884">priv</span><span class="op" id="3716888">.</span><span class="ident" id="3716889">D</span><span class="op" id="3716890">.</span><span class="ident" id="3716891">Add</span><span class="op" id="3716894">(</span><span class="ident" id="3716895">priv</span><span class="op" id="3716899">.</span><span class="ident" id="3716900">D</span><span class="op" id="3716901">,</span>&nbsp;<span class="ident" id="3716903">totient</span><span class="op" id="3716910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716920">priv</span><span class="op" id="3716924">.</span><span class="ident" id="3716925">Primes</span>&nbsp;<span class="op" id="3716932">=</span>&nbsp;<span class="ident" id="3716934">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716944">priv</span><span class="op" id="3716948">.</span><span class="ident" id="3716949">N</span>&nbsp;<span class="op" id="3716951">=</span>&nbsp;<span class="ident" id="3716953">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716959">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716974">priv</span><span class="op" id="3716978">.</span><span class="ident" id="3716979">Precompute</span><span class="op" id="3716989">(</span><span class="op" id="3716990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716993">return</span><br>
<span class="lineno"></span><span class="op" id="3717000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3717003">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="3717061">func</span>&nbsp;<span class="ident" id="3717066">incCounter</span><span class="op" id="3717076">(</span><span class="ident" id="3717077">c</span>&nbsp;<span class="op" id="3717079">*</span><span class="op" id="3717080">[</span><span class="num" id="3717081">4</span><span class="op" id="3717082">]</span><span class="builtintype" id="3717083">byte</span><span class="op" id="3717087">)</span>&nbsp;<span class="op" id="3717089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717092">if</span>&nbsp;<span class="ident" id="3717095">c</span><span class="op" id="3717096">[</span><span class="num" id="3717097">3</span><span class="op" id="3717098">]</span><span class="op" id="3717099">++</span><span class="op" id="3717101">;</span>&nbsp;<span class="ident" id="3717103">c</span><span class="op" id="3717104">[</span><span class="num" id="3717105">3</span><span class="op" id="3717106">]</span>&nbsp;<span class="op" id="3717108">!=</span>&nbsp;<span class="num" id="3717111">0</span>&nbsp;<span class="op" id="3717113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717128">if</span>&nbsp;<span class="ident" id="3717131">c</span><span class="op" id="3717132">[</span><span class="num" id="3717133">2</span><span class="op" id="3717134">]</span><span class="op" id="3717135">++</span><span class="op" id="3717137">;</span>&nbsp;<span class="ident" id="3717139">c</span><span class="op" id="3717140">[</span><span class="num" id="3717141">2</span><span class="op" id="3717142">]</span>&nbsp;<span class="op" id="3717144">!=</span>&nbsp;<span class="num" id="3717147">0</span>&nbsp;<span class="op" id="3717149">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717153">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717164">if</span>&nbsp;<span class="ident" id="3717167">c</span><span class="op" id="3717168">[</span><span class="num" id="3717169">1</span><span class="op" id="3717170">]</span><span class="op" id="3717171">++</span><span class="op" id="3717173">;</span>&nbsp;<span class="ident" id="3717175">c</span><span class="op" id="3717176">[</span><span class="num" id="3717177">1</span><span class="op" id="3717178">]</span>&nbsp;<span class="op" id="3717180">!=</span>&nbsp;<span class="num" id="3717183">0</span>&nbsp;<span class="op" id="3717185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717189">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717197">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717200">c</span><span class="op" id="3717201">[</span><span class="num" id="3717202">0</span><span class="op" id="3717203">]</span><span class="op" id="3717204">++</span><br>
<span class="lineno"></span><span class="op" id="3717207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3717210">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3717289">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="3717318">func</span>&nbsp;<span class="ident" id="3717323">mgf1XOR</span><span class="op" id="3717330">(</span><span class="ident" id="3717331">out</span>&nbsp;<span class="op" id="3717335">[</span><span class="op" id="3717336">]</span><span class="builtintype" id="3717337">byte</span><span class="op" id="3717341">,</span>&nbsp;<span class="ident" id="3717343">hash</span>&nbsp;<span class="ident" id="3717348">hash</span><span class="op" id="3717352">.</span><span class="ident" id="3717353">Hash</span><span class="op" id="3717357">,</span>&nbsp;<span class="ident" id="3717359">seed</span>&nbsp;<span class="op" id="3717364">[</span><span class="op" id="3717365">]</span><span class="builtintype" id="3717366">byte</span><span class="op" id="3717370">)</span>&nbsp;<span class="op" id="3717372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717375">var</span>&nbsp;<span class="ident" id="3717379">counter</span>&nbsp;<span class="op" id="3717387">[</span><span class="num" id="3717388">4</span><span class="op" id="3717389">]</span><span class="builtintype" id="3717390">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717396">var</span>&nbsp;<span class="ident" id="3717400">digest</span>&nbsp;<span class="op" id="3717407">[</span><span class="op" id="3717408">]</span><span class="builtintype" id="3717409">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717416">done</span>&nbsp;<span class="op" id="3717421">:=</span>&nbsp;<span class="num" id="3717424">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717427">for</span>&nbsp;<span class="ident" id="3717431">done</span>&nbsp;<span class="op" id="3717436">&lt;</span>&nbsp;<span class="builtinfunc" id="3717438">len</span><span class="op" id="3717441">(</span><span class="ident" id="3717442">out</span><span class="op" id="3717445">)</span>&nbsp;<span class="op" id="3717447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717451">hash</span><span class="op" id="3717455">.</span><span class="ident" id="3717456">Write</span><span class="op" id="3717461">(</span><span class="ident" id="3717462">seed</span><span class="op" id="3717466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717470">hash</span><span class="op" id="3717474">.</span><span class="ident" id="3717475">Write</span><span class="op" id="3717480">(</span><span class="ident" id="3717481">counter</span><span class="op" id="3717488">[</span><span class="num" id="3717489">0</span><span class="op" id="3717490">:</span><span class="num" id="3717491">4</span><span class="op" id="3717492">]</span><span class="op" id="3717493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717497">digest</span>&nbsp;<span class="op" id="3717504">=</span>&nbsp;<span class="ident" id="3717506">hash</span><span class="op" id="3717510">.</span><span class="ident" id="3717511">Sum</span><span class="op" id="3717514">(</span><span class="ident" id="3717515">digest</span><span class="op" id="3717521">[</span><span class="op" id="3717522">:</span><span class="num" id="3717523">0</span><span class="op" id="3717524">]</span><span class="op" id="3717525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717529">hash</span><span class="op" id="3717533">.</span><span class="ident" id="3717534">Reset</span><span class="op" id="3717539">(</span><span class="op" id="3717540">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717545">for</span>&nbsp;<span class="ident" id="3717549">i</span>&nbsp;<span class="op" id="3717551">:=</span>&nbsp;<span class="num" id="3717554">0</span><span class="op" id="3717555">;</span>&nbsp;<span class="ident" id="3717557">i</span>&nbsp;<span class="op" id="3717559">&lt;</span>&nbsp;<span class="builtinfunc" id="3717561">len</span><span class="op" id="3717564">(</span><span class="ident" id="3717565">digest</span><span class="op" id="3717571">)</span>&nbsp;<span class="op" id="3717573">&amp;&amp;</span>&nbsp;<span class="ident" id="3717576">done</span>&nbsp;<span class="op" id="3717581">&lt;</span>&nbsp;<span class="builtinfunc" id="3717583">len</span><span class="op" id="3717586">(</span><span class="ident" id="3717587">out</span><span class="op" id="3717590">)</span><span class="op" id="3717591">;</span>&nbsp;<span class="ident" id="3717593">i</span><span class="op" id="3717594">++</span>&nbsp;<span class="op" id="3717597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717602">out</span><span class="op" id="3717605">[</span><span class="ident" id="3717606">done</span><span class="op" id="3717610">]</span>&nbsp;<span class="op" id="3717612">^=</span>&nbsp;<span class="ident" id="3717615">digest</span><span class="op" id="3717621">[</span><span class="ident" id="3717622">i</span><span class="op" id="3717623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717628">done</span><span class="op" id="3717632">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717637">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717641">incCounter</span><span class="op" id="3717651">(</span><span class="op" id="3717652">&amp;</span><span class="ident" id="3717653">counter</span><span class="op" id="3717660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717663">}</span><br>
<span class="lineno"></span><span class="op" id="3717665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3717668">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="3717747">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3717792">var</span>&nbsp;<span class="ident" id="3717796">ErrMessageTooLong</span>&nbsp;<span class="op" id="3717814">=</span>&nbsp;<span class="ident" id="3717816">errors</span><span class="op" id="3717822">.</span><span class="ident" id="3717823">New</span><span class="op" id="3717826">(</span><span class="string" id="3717827">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="3717881">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3717884">func</span>&nbsp;<span class="ident" id="3717889">encrypt</span><span class="op" id="3717896">(</span><span class="ident" id="3717897">c</span>&nbsp;<span class="op" id="3717899">*</span><span class="ident" id="3717900">big</span><span class="op" id="3717903">.</span><span class="ident" id="3717904">Int</span><span class="op" id="3717907">,</span>&nbsp;<span class="ident" id="3717909">pub</span>&nbsp;<span class="op" id="3717913">*</span><span class="ident" id="3717914">PublicKey</span><span class="op" id="3717923">,</span>&nbsp;<span class="ident" id="3717925">m</span>&nbsp;<span class="op" id="3717927">*</span><span class="ident" id="3717928">big</span><span class="op" id="3717931">.</span><span class="ident" id="3717932">Int</span><span class="op" id="3717935">)</span>&nbsp;<span class="op" id="3717937">*</span><span class="ident" id="3717938">big</span><span class="op" id="3717941">.</span><span class="ident" id="3717942">Int</span>&nbsp;<span class="op" id="3717946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717949">e</span>&nbsp;<span class="op" id="3717951">:=</span>&nbsp;<span class="ident" id="3717954">big</span><span class="op" id="3717957">.</span><span class="ident" id="3717958">NewInt</span><span class="op" id="3717964">(</span><span class="ident" id="3717965">int64</span><span class="op" id="3717970">(</span><span class="ident" id="3717971">pub</span><span class="op" id="3717974">.</span><span class="ident" id="3717975">E</span><span class="op" id="3717976">)</span><span class="op" id="3717977">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717980">c</span><span class="op" id="3717981">.</span><span class="ident" id="3717982">Exp</span><span class="op" id="3717985">(</span><span class="ident" id="3717986">m</span><span class="op" id="3717987">,</span>&nbsp;<span class="ident" id="3717989">e</span><span class="op" id="3717990">,</span>&nbsp;<span class="ident" id="3717992">pub</span><span class="op" id="3717995">.</span><span class="ident" id="3717996">N</span><span class="op" id="3717997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718000">return</span>&nbsp;<span class="ident" id="3718007">c</span><br>
<span class="lineno"></span><span class="op" id="3718009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3718012">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="3718069">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="3718145">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3718178">func</span>&nbsp;<span class="ident" id="3718183">EncryptOAEP</span><span class="op" id="3718194">(</span><span class="ident" id="3718195">hash</span>&nbsp;<span class="ident" id="3718200">hash</span><span class="op" id="3718204">.</span><span class="ident" id="3718205">Hash</span><span class="op" id="3718209">,</span>&nbsp;<span class="ident" id="3718211">random</span>&nbsp;<span class="ident" id="3718218">io</span><span class="op" id="3718220">.</span><span class="ident" id="3718221">Reader</span><span class="op" id="3718227">,</span>&nbsp;<span class="ident" id="3718229">pub</span>&nbsp;<span class="op" id="3718233">*</span><span class="ident" id="3718234">PublicKey</span><span class="op" id="3718243">,</span>&nbsp;<span class="ident" id="3718245">msg</span>&nbsp;<span class="op" id="3718249">[</span><span class="op" id="3718250">]</span><span class="builtintype" id="3718251">byte</span><span class="op" id="3718255">,</span>&nbsp;<span class="ident" id="3718257">label</span>&nbsp;<span class="op" id="3718263">[</span><span class="op" id="3718264">]</span><span class="builtintype" id="3718265">byte</span><span class="op" id="3718269">)</span>&nbsp;<span class="op" id="3718271">(</span><span class="ident" id="3718272">out</span>&nbsp;<span class="op" id="3718276">[</span><span class="op" id="3718277">]</span><span class="builtintype" id="3718278">byte</span><span class="op" id="3718282">,</span>&nbsp;<span class="ident" id="3718284">err</span>&nbsp;<span class="builtintype" id="3718288">error</span><span class="op" id="3718293">)</span>&nbsp;<span class="op" id="3718295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718298">if</span>&nbsp;<span class="ident" id="3718301">err</span>&nbsp;<span class="op" id="3718305">:=</span>&nbsp;<span class="ident" id="3718308">checkPub</span><span class="op" id="3718316">(</span><span class="ident" id="3718317">pub</span><span class="op" id="3718320">)</span><span class="op" id="3718321">;</span>&nbsp;<span class="ident" id="3718323">err</span>&nbsp;<span class="op" id="3718327">!=</span>&nbsp;<span class="ident" id="3718330">nil</span>&nbsp;<span class="op" id="3718334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718338">return</span>&nbsp;<span class="ident" id="3718345">nil</span><span class="op" id="3718348">,</span>&nbsp;<span class="ident" id="3718350">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718358">hash</span><span class="op" id="3718362">.</span><span class="ident" id="3718363">Reset</span><span class="op" id="3718368">(</span><span class="op" id="3718369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718372">k</span>&nbsp;<span class="op" id="3718374">:=</span>&nbsp;<span class="op" id="3718377">(</span><span class="ident" id="3718378">pub</span><span class="op" id="3718381">.</span><span class="ident" id="3718382">N</span><span class="op" id="3718383">.</span><span class="ident" id="3718384">BitLen</span><span class="op" id="3718390">(</span><span class="op" id="3718391">)</span>&nbsp;<span class="op" id="3718393">+</span>&nbsp;<span class="num" id="3718395">7</span><span class="op" id="3718396">)</span>&nbsp;<span class="op" id="3718398">/</span>&nbsp;<span class="num" id="3718400">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718403">if</span>&nbsp;<span class="builtinfunc" id="3718406">len</span><span class="op" id="3718409">(</span><span class="ident" id="3718410">msg</span><span class="op" id="3718413">)</span>&nbsp;<span class="op" id="3718415">&gt;</span>&nbsp;<span class="ident" id="3718417">k</span><span class="op" id="3718418">-</span><span class="num" id="3718419">2</span><span class="op" id="3718420">*</span><span class="ident" id="3718421">hash</span><span class="op" id="3718425">.</span><span class="ident" id="3718426">Size</span><span class="op" id="3718430">(</span><span class="op" id="3718431">)</span><span class="op" id="3718432">-</span><span class="num" id="3718433">2</span>&nbsp;<span class="op" id="3718435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718439">err</span>&nbsp;<span class="op" id="3718443">=</span>&nbsp;<span class="ident" id="3718445">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718465">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718477">hash</span><span class="op" id="3718481">.</span><span class="ident" id="3718482">Write</span><span class="op" id="3718487">(</span><span class="ident" id="3718488">label</span><span class="op" id="3718493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718496">lHash</span>&nbsp;<span class="op" id="3718502">:=</span>&nbsp;<span class="ident" id="3718505">hash</span><span class="op" id="3718509">.</span><span class="ident" id="3718510">Sum</span><span class="op" id="3718513">(</span><span class="ident" id="3718514">nil</span><span class="op" id="3718517">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718520">hash</span><span class="op" id="3718524">.</span><span class="ident" id="3718525">Reset</span><span class="op" id="3718530">(</span><span class="op" id="3718531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718535">em</span>&nbsp;<span class="op" id="3718538">:=</span>&nbsp;<span class="builtinfunc" id="3718541">make</span><span class="op" id="3718545">(</span><span class="op" id="3718546">[</span><span class="op" id="3718547">]</span><span class="builtintype" id="3718548">byte</span><span class="op" id="3718552">,</span>&nbsp;<span class="ident" id="3718554">k</span><span class="op" id="3718555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718558">seed</span>&nbsp;<span class="op" id="3718563">:=</span>&nbsp;<span class="ident" id="3718566">em</span><span class="op" id="3718568">[</span><span class="num" id="3718569">1</span>&nbsp;<span class="op" id="3718571">:</span>&nbsp;<span class="num" id="3718573">1</span><span class="op" id="3718574">+</span><span class="ident" id="3718575">hash</span><span class="op" id="3718579">.</span><span class="ident" id="3718580">Size</span><span class="op" id="3718584">(</span><span class="op" id="3718585">)</span><span class="op" id="3718586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718589">db</span>&nbsp;<span class="op" id="3718592">:=</span>&nbsp;<span class="ident" id="3718595">em</span><span class="op" id="3718597">[</span><span class="num" id="3718598">1</span><span class="op" id="3718599">+</span><span class="ident" id="3718600">hash</span><span class="op" id="3718604">.</span><span class="ident" id="3718605">Size</span><span class="op" id="3718609">(</span><span class="op" id="3718610">)</span><span class="op" id="3718611">:</span><span class="op" id="3718612">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3718616">copy</span><span class="op" id="3718620">(</span><span class="ident" id="3718621">db</span><span class="op" id="3718623">[</span><span class="num" id="3718624">0</span><span class="op" id="3718625">:</span><span class="ident" id="3718626">hash</span><span class="op" id="3718630">.</span><span class="ident" id="3718631">Size</span><span class="op" id="3718635">(</span><span class="op" id="3718636">)</span><span class="op" id="3718637">]</span><span class="op" id="3718638">,</span>&nbsp;<span class="ident" id="3718640">lHash</span><span class="op" id="3718645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718648">db</span><span class="op" id="3718650">[</span><span class="builtinfunc" id="3718651">len</span><span class="op" id="3718654">(</span><span class="ident" id="3718655">db</span><span class="op" id="3718657">)</span><span class="op" id="3718658">-</span><span class="builtinfunc" id="3718659">len</span><span class="op" id="3718662">(</span><span class="ident" id="3718663">msg</span><span class="op" id="3718666">)</span><span class="op" id="3718667">-</span><span class="num" id="3718668">1</span><span class="op" id="3718669">]</span>&nbsp;<span class="op" id="3718671">=</span>&nbsp;<span class="num" id="3718673">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3718676">copy</span><span class="op" id="3718680">(</span><span class="ident" id="3718681">db</span><span class="op" id="3718683">[</span><span class="builtinfunc" id="3718684">len</span><span class="op" id="3718687">(</span><span class="ident" id="3718688">db</span><span class="op" id="3718690">)</span><span class="op" id="3718691">-</span><span class="builtinfunc" id="3718692">len</span><span class="op" id="3718695">(</span><span class="ident" id="3718696">msg</span><span class="op" id="3718699">)</span><span class="op" id="3718700">:</span><span class="op" id="3718701">]</span><span class="op" id="3718702">,</span>&nbsp;<span class="ident" id="3718704">msg</span><span class="op" id="3718707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718711">_</span><span class="op" id="3718712">,</span>&nbsp;<span class="ident" id="3718714">err</span>&nbsp;<span class="op" id="3718718">=</span>&nbsp;<span class="ident" id="3718720">io</span><span class="op" id="3718722">.</span><span class="ident" id="3718723">ReadFull</span><span class="op" id="3718731">(</span><span class="ident" id="3718732">random</span><span class="op" id="3718738">,</span>&nbsp;<span class="ident" id="3718740">seed</span><span class="op" id="3718744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718747">if</span>&nbsp;<span class="ident" id="3718750">err</span>&nbsp;<span class="op" id="3718754">!=</span>&nbsp;<span class="ident" id="3718757">nil</span>&nbsp;<span class="op" id="3718761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718765">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718777">mgf1XOR</span><span class="op" id="3718784">(</span><span class="ident" id="3718785">db</span><span class="op" id="3718787">,</span>&nbsp;<span class="ident" id="3718789">hash</span><span class="op" id="3718793">,</span>&nbsp;<span class="ident" id="3718795">seed</span><span class="op" id="3718799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718802">mgf1XOR</span><span class="op" id="3718809">(</span><span class="ident" id="3718810">seed</span><span class="op" id="3718814">,</span>&nbsp;<span class="ident" id="3718816">hash</span><span class="op" id="3718820">,</span>&nbsp;<span class="ident" id="3718822">db</span><span class="op" id="3718824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718828">m</span>&nbsp;<span class="op" id="3718830">:=</span>&nbsp;<span class="builtinfunc" id="3718833">new</span><span class="op" id="3718836">(</span><span class="ident" id="3718837">big</span><span class="op" id="3718840">.</span><span class="ident" id="3718841">Int</span><span class="op" id="3718844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718847">m</span><span class="op" id="3718848">.</span><span class="ident" id="3718849">SetBytes</span><span class="op" id="3718857">(</span><span class="ident" id="3718858">em</span><span class="op" id="3718860">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718863">c</span>&nbsp;<span class="op" id="3718865">:=</span>&nbsp;<span class="ident" id="3718868">encrypt</span><span class="op" id="3718875">(</span><span class="builtinfunc" id="3718876">new</span><span class="op" id="3718879">(</span><span class="ident" id="3718880">big</span><span class="op" id="3718883">.</span><span class="ident" id="3718884">Int</span><span class="op" id="3718887">)</span><span class="op" id="3718888">,</span>&nbsp;<span class="ident" id="3718890">pub</span><span class="op" id="3718893">,</span>&nbsp;<span class="ident" id="3718895">m</span><span class="op" id="3718896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718899">out</span>&nbsp;<span class="op" id="3718903">=</span>&nbsp;<span class="ident" id="3718905">c</span><span class="op" id="3718906">.</span><span class="ident" id="3718907">Bytes</span><span class="op" id="3718912">(</span><span class="op" id="3718913">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718917">if</span>&nbsp;<span class="builtinfunc" id="3718920">len</span><span class="op" id="3718923">(</span><span class="ident" id="3718924">out</span><span class="op" id="3718927">)</span>&nbsp;<span class="op" id="3718929">&lt;</span>&nbsp;<span class="ident" id="3718931">k</span>&nbsp;<span class="op" id="3718933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718937">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719002">t</span>&nbsp;<span class="op" id="3719004">:=</span>&nbsp;<span class="builtinfunc" id="3719007">make</span><span class="op" id="3719011">(</span><span class="op" id="3719012">[</span><span class="op" id="3719013">]</span><span class="builtintype" id="3719014">byte</span><span class="op" id="3719018">,</span>&nbsp;<span class="ident" id="3719020">k</span><span class="op" id="3719021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3719025">copy</span><span class="op" id="3719029">(</span><span class="ident" id="3719030">t</span><span class="op" id="3719031">[</span><span class="ident" id="3719032">k</span><span class="op" id="3719033">-</span><span class="builtinfunc" id="3719034">len</span><span class="op" id="3719037">(</span><span class="ident" id="3719038">out</span><span class="op" id="3719041">)</span><span class="op" id="3719042">:</span><span class="op" id="3719043">]</span><span class="op" id="3719044">,</span>&nbsp;<span class="ident" id="3719046">out</span><span class="op" id="3719049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719053">out</span>&nbsp;<span class="op" id="3719057">=</span>&nbsp;<span class="ident" id="3719059">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719066">return</span><br>
<span class="lineno"></span><span class="op" id="3719073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719076">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="3719136">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="3719191">var</span>&nbsp;<span class="ident" id="3719195">ErrDecryption</span>&nbsp;<span class="op" id="3719209">=</span>&nbsp;<span class="ident" id="3719211">errors</span><span class="op" id="3719217">.</span><span class="ident" id="3719218">New</span><span class="op" id="3719221">(</span><span class="string" id="3719222">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="3719252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719255">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="3719318">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="3719373">var</span>&nbsp;<span class="ident" id="3719377">ErrVerification</span>&nbsp;<span class="op" id="3719393">=</span>&nbsp;<span class="ident" id="3719395">errors</span><span class="op" id="3719401">.</span><span class="ident" id="3719402">New</span><span class="op" id="3719405">(</span><span class="string" id="3719406">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="3719438">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="3719441">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="3719521">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="3719597">func</span>&nbsp;<span class="ident" id="3719602">modInverse</span><span class="op" id="3719612">(</span><span class="ident" id="3719613">a</span><span class="op" id="3719614">,</span>&nbsp;<span class="ident" id="3719616">n</span>&nbsp;<span class="op" id="3719618">*</span><span class="ident" id="3719619">big</span><span class="op" id="3719622">.</span><span class="ident" id="3719623">Int</span><span class="op" id="3719626">)</span>&nbsp;<span class="op" id="3719628">(</span><span class="ident" id="3719629">ia</span>&nbsp;<span class="op" id="3719632">*</span><span class="ident" id="3719633">big</span><span class="op" id="3719636">.</span><span class="ident" id="3719637">Int</span><span class="op" id="3719640">,</span>&nbsp;<span class="ident" id="3719642">ok</span>&nbsp;<span class="builtintype" id="3719645">bool</span><span class="op" id="3719649">)</span>&nbsp;<span class="op" id="3719651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719654">g</span>&nbsp;<span class="op" id="3719656">:=</span>&nbsp;<span class="builtinfunc" id="3719659">new</span><span class="op" id="3719662">(</span><span class="ident" id="3719663">big</span><span class="op" id="3719666">.</span><span class="ident" id="3719667">Int</span><span class="op" id="3719670">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719673">x</span>&nbsp;<span class="op" id="3719675">:=</span>&nbsp;<span class="builtinfunc" id="3719678">new</span><span class="op" id="3719681">(</span><span class="ident" id="3719682">big</span><span class="op" id="3719685">.</span><span class="ident" id="3719686">Int</span><span class="op" id="3719689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719692">y</span>&nbsp;<span class="op" id="3719694">:=</span>&nbsp;<span class="builtinfunc" id="3719697">new</span><span class="op" id="3719700">(</span><span class="ident" id="3719701">big</span><span class="op" id="3719704">.</span><span class="ident" id="3719705">Int</span><span class="op" id="3719708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719711">g</span><span class="op" id="3719712">.</span><span class="ident" id="3719713">GCD</span><span class="op" id="3719716">(</span><span class="ident" id="3719717">x</span><span class="op" id="3719718">,</span>&nbsp;<span class="ident" id="3719720">y</span><span class="op" id="3719721">,</span>&nbsp;<span class="ident" id="3719723">a</span><span class="op" id="3719724">,</span>&nbsp;<span class="ident" id="3719726">n</span><span class="op" id="3719727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719730">if</span>&nbsp;<span class="ident" id="3719733">g</span><span class="op" id="3719734">.</span><span class="ident" id="3719735">Cmp</span><span class="op" id="3719738">(</span><span class="ident" id="3719739">bigOne</span><span class="op" id="3719745">)</span>&nbsp;<span class="op" id="3719747">!=</span>&nbsp;<span class="num" id="3719750">0</span>&nbsp;<span class="op" id="3719752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719756">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719822">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719888">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719951">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719963">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719971">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719975">if</span>&nbsp;<span class="ident" id="3719978">x</span><span class="op" id="3719979">.</span><span class="ident" id="3719980">Cmp</span><span class="op" id="3719983">(</span><span class="ident" id="3719984">bigOne</span><span class="op" id="3719990">)</span>&nbsp;<span class="op" id="3719992">&lt;</span>&nbsp;<span class="num" id="3719994">0</span>&nbsp;<span class="op" id="3719996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3720000">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3720065">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720095">x</span><span class="op" id="3720096">.</span><span class="ident" id="3720097">Add</span><span class="op" id="3720100">(</span><span class="ident" id="3720101">x</span><span class="op" id="3720102">,</span>&nbsp;<span class="ident" id="3720104">n</span><span class="op" id="3720105">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720112">return</span>&nbsp;<span class="ident" id="3720119">x</span><span class="op" id="3720120">,</span>&nbsp;<span class="builtintype" id="3720122">true</span><br>
<span class="lineno"></span><span class="op" id="3720127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3720130">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="3720208">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="3720226">func</span>&nbsp;<span class="op" id="3720231">(</span><span class="ident" id="3720232">priv</span>&nbsp;<span class="op" id="3720237">*</span><span class="ident" id="3720238">PrivateKey</span><span class="op" id="3720248">)</span>&nbsp;<span class="ident" id="3720250">Precompute</span><span class="op" id="3720260">(</span><span class="op" id="3720261">)</span>&nbsp;<span class="op" id="3720263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720266">if</span>&nbsp;<span class="ident" id="3720269">priv</span><span class="op" id="3720273">.</span><span class="ident" id="3720274">Precomputed</span><span class="op" id="3720285">.</span><span class="ident" id="3720286">Dp</span>&nbsp;<span class="op" id="3720289">!=</span>&nbsp;<span class="ident" id="3720292">nil</span>&nbsp;<span class="op" id="3720296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720300">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720312">priv</span><span class="op" id="3720316">.</span><span class="ident" id="3720317">Precomputed</span><span class="op" id="3720328">.</span><span class="ident" id="3720329">Dp</span>&nbsp;<span class="op" id="3720332">=</span>&nbsp;<span class="builtinfunc" id="3720334">new</span><span class="op" id="3720337">(</span><span class="ident" id="3720338">big</span><span class="op" id="3720341">.</span><span class="ident" id="3720342">Int</span><span class="op" id="3720345">)</span><span class="op" id="3720346">.</span><span class="ident" id="3720347">Sub</span><span class="op" id="3720350">(</span><span class="ident" id="3720351">priv</span><span class="op" id="3720355">.</span><span class="ident" id="3720356">Primes</span><span class="op" id="3720362">[</span><span class="num" id="3720363">0</span><span class="op" id="3720364">]</span><span class="op" id="3720365">,</span>&nbsp;<span class="ident" id="3720367">bigOne</span><span class="op" id="3720373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720376">priv</span><span class="op" id="3720380">.</span><span class="ident" id="3720381">Precomputed</span><span class="op" id="3720392">.</span><span class="ident" id="3720393">Dp</span><span class="op" id="3720395">.</span><span class="ident" id="3720396">Mod</span><span class="op" id="3720399">(</span><span class="ident" id="3720400">priv</span><span class="op" id="3720404">.</span><span class="ident" id="3720405">D</span><span class="op" id="3720406">,</span>&nbsp;<span class="ident" id="3720408">priv</span><span class="op" id="3720412">.</span><span class="ident" id="3720413">Precomputed</span><span class="op" id="3720424">.</span><span class="ident" id="3720425">Dp</span><span class="op" id="3720427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720431">priv</span><span class="op" id="3720435">.</span><span class="ident" id="3720436">Precomputed</span><span class="op" id="3720447">.</span><span class="ident" id="3720448">Dq</span>&nbsp;<span class="op" id="3720451">=</span>&nbsp;<span class="builtinfunc" id="3720453">new</span><span class="op" id="3720456">(</span><span class="ident" id="3720457">big</span><span class="op" id="3720460">.</span><span class="ident" id="3720461">Int</span><span class="op" id="3720464">)</span><span class="op" id="3720465">.</span><span class="ident" id="3720466">Sub</span><span class="op" id="3720469">(</span><span class="ident" id="3720470">priv</span><span class="op" id="3720474">.</span><span class="ident" id="3720475">Primes</span><span class="op" id="3720481">[</span><span class="num" id="3720482">1</span><span class="op" id="3720483">]</span><span class="op" id="3720484">,</span>&nbsp;<span class="ident" id="3720486">bigOne</span><span class="op" id="3720492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720495">priv</span><span class="op" id="3720499">.</span><span class="ident" id="3720500">Precomputed</span><span class="op" id="3720511">.</span><span class="ident" id="3720512">Dq</span><span class="op" id="3720514">.</span><span class="ident" id="3720515">Mod</span><span class="op" id="3720518">(</span><span class="ident" id="3720519">priv</span><span class="op" id="3720523">.</span><span class="ident" id="3720524">D</span><span class="op" id="3720525">,</span>&nbsp;<span class="ident" id="3720527">priv</span><span class="op" id="3720531">.</span><span class="ident" id="3720532">Precomputed</span><span class="op" id="3720543">.</span><span class="ident" id="3720544">Dq</span><span class="op" id="3720546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720550">priv</span><span class="op" id="3720554">.</span><span class="ident" id="3720555">Precomputed</span><span class="op" id="3720566">.</span><span class="ident" id="3720567">Qinv</span>&nbsp;<span class="op" id="3720572">=</span>&nbsp;<span class="builtinfunc" id="3720574">new</span><span class="op" id="3720577">(</span><span class="ident" id="3720578">big</span><span class="op" id="3720581">.</span><span class="ident" id="3720582">Int</span><span class="op" id="3720585">)</span><span class="op" id="3720586">.</span><span class="ident" id="3720587">ModInverse</span><span class="op" id="3720597">(</span><span class="ident" id="3720598">priv</span><span class="op" id="3720602">.</span><span class="ident" id="3720603">Primes</span><span class="op" id="3720609">[</span><span class="num" id="3720610">1</span><span class="op" id="3720611">]</span><span class="op" id="3720612">,</span>&nbsp;<span class="ident" id="3720614">priv</span><span class="op" id="3720618">.</span><span class="ident" id="3720619">Primes</span><span class="op" id="3720625">[</span><span class="num" id="3720626">0</span><span class="op" id="3720627">]</span><span class="op" id="3720628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720632">r</span>&nbsp;<span class="op" id="3720634">:=</span>&nbsp;<span class="builtinfunc" id="3720637">new</span><span class="op" id="3720640">(</span><span class="ident" id="3720641">big</span><span class="op" id="3720644">.</span><span class="ident" id="3720645">Int</span><span class="op" id="3720648">)</span><span class="op" id="3720649">.</span><span class="ident" id="3720650">Mul</span><span class="op" id="3720653">(</span><span class="ident" id="3720654">priv</span><span class="op" id="3720658">.</span><span class="ident" id="3720659">Primes</span><span class="op" id="3720665">[</span><span class="num" id="3720666">0</span><span class="op" id="3720667">]</span><span class="op" id="3720668">,</span>&nbsp;<span class="ident" id="3720670">priv</span><span class="op" id="3720674">.</span><span class="ident" id="3720675">Primes</span><span class="op" id="3720681">[</span><span class="num" id="3720682">1</span><span class="op" id="3720683">]</span><span class="op" id="3720684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720687">priv</span><span class="op" id="3720691">.</span><span class="ident" id="3720692">Precomputed</span><span class="op" id="3720703">.</span><span class="ident" id="3720704">CRTValues</span>&nbsp;<span class="op" id="3720714">=</span>&nbsp;<span class="builtinfunc" id="3720716">make</span><span class="op" id="3720720">(</span><span class="op" id="3720721">[</span><span class="op" id="3720722">]</span><span class="ident" id="3720723">CRTValue</span><span class="op" id="3720731">,</span>&nbsp;<span class="builtinfunc" id="3720733">len</span><span class="op" id="3720736">(</span><span class="ident" id="3720737">priv</span><span class="op" id="3720741">.</span><span class="ident" id="3720742">Primes</span><span class="op" id="3720748">)</span><span class="op" id="3720749">-</span><span class="num" id="3720750">2</span><span class="op" id="3720751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720754">for</span>&nbsp;<span class="ident" id="3720758">i</span>&nbsp;<span class="op" id="3720760">:=</span>&nbsp;<span class="num" id="3720763">2</span><span class="op" id="3720764">;</span>&nbsp;<span class="ident" id="3720766">i</span>&nbsp;<span class="op" id="3720768">&lt;</span>&nbsp;<span class="builtinfunc" id="3720770">len</span><span class="op" id="3720773">(</span><span class="ident" id="3720774">priv</span><span class="op" id="3720778">.</span><span class="ident" id="3720779">Primes</span><span class="op" id="3720785">)</span><span class="op" id="3720786">;</span>&nbsp;<span class="ident" id="3720788">i</span><span class="op" id="3720789">++</span>&nbsp;<span class="op" id="3720792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720796">prime</span>&nbsp;<span class="op" id="3720802">:=</span>&nbsp;<span class="ident" id="3720805">priv</span><span class="op" id="3720809">.</span><span class="ident" id="3720810">Primes</span><span class="op" id="3720816">[</span><span class="ident" id="3720817">i</span><span class="op" id="3720818">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720822">values</span>&nbsp;<span class="op" id="3720829">:=</span>&nbsp;<span class="op" id="3720832">&amp;</span><span class="ident" id="3720833">priv</span><span class="op" id="3720837">.</span><span class="ident" id="3720838">Precomputed</span><span class="op" id="3720849">.</span><span class="ident" id="3720850">CRTValues</span><span class="op" id="3720859">[</span><span class="ident" id="3720860">i</span><span class="op" id="3720861">-</span><span class="num" id="3720862">2</span><span class="op" id="3720863">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720868">values</span><span class="op" id="3720874">.</span><span class="ident" id="3720875">Exp</span>&nbsp;<span class="op" id="3720879">=</span>&nbsp;<span class="builtinfunc" id="3720881">new</span><span class="op" id="3720884">(</span><span class="ident" id="3720885">big</span><span class="op" id="3720888">.</span><span class="ident" id="3720889">Int</span><span class="op" id="3720892">)</span><span class="op" id="3720893">.</span><span class="ident" id="3720894">Sub</span><span class="op" id="3720897">(</span><span class="ident" id="3720898">prime</span><span class="op" id="3720903">,</span>&nbsp;<span class="ident" id="3720905">bigOne</span><span class="op" id="3720911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720915">values</span><span class="op" id="3720921">.</span><span class="ident" id="3720922">Exp</span><span class="op" id="3720925">.</span><span class="ident" id="3720926">Mod</span><span class="op" id="3720929">(</span><span class="ident" id="3720930">priv</span><span class="op" id="3720934">.</span><span class="ident" id="3720935">D</span><span class="op" id="3720936">,</span>&nbsp;<span class="ident" id="3720938">values</span><span class="op" id="3720944">.</span><span class="ident" id="3720945">Exp</span><span class="op" id="3720948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720953">values</span><span class="op" id="3720959">.</span><span class="ident" id="3720960">R</span>&nbsp;<span class="op" id="3720962">=</span>&nbsp;<span class="builtinfunc" id="3720964">new</span><span class="op" id="3720967">(</span><span class="ident" id="3720968">big</span><span class="op" id="3720971">.</span><span class="ident" id="3720972">Int</span><span class="op" id="3720975">)</span><span class="op" id="3720976">.</span><span class="ident" id="3720977">Set</span><span class="op" id="3720980">(</span><span class="ident" id="3720981">r</span><span class="op" id="3720982">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720986">values</span><span class="op" id="3720992">.</span><span class="ident" id="3720993">Coeff</span>&nbsp;<span class="op" id="3720999">=</span>&nbsp;<span class="builtinfunc" id="3721001">new</span><span class="op" id="3721004">(</span><span class="ident" id="3721005">big</span><span class="op" id="3721008">.</span><span class="ident" id="3721009">Int</span><span class="op" id="3721012">)</span><span class="op" id="3721013">.</span><span class="ident" id="3721014">ModInverse</span><span class="op" id="3721024">(</span><span class="ident" id="3721025">r</span><span class="op" id="3721026">,</span>&nbsp;<span class="ident" id="3721028">prime</span><span class="op" id="3721033">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721038">r</span><span class="op" id="3721039">.</span><span class="ident" id="3721040">Mul</span><span class="op" id="3721043">(</span><span class="ident" id="3721044">r</span><span class="op" id="3721045">,</span>&nbsp;<span class="ident" id="3721047">prime</span><span class="op" id="3721052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721055">}</span><br>
<span class="lineno"></span><span class="op" id="3721057">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="3721060">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3721138">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3721187">func</span>&nbsp;<span class="ident" id="3721192">decrypt</span><span class="op" id="3721199">(</span><span class="ident" id="3721200">random</span>&nbsp;<span class="ident" id="3721207">io</span><span class="op" id="3721209">.</span><span class="ident" id="3721210">Reader</span><span class="op" id="3721216">,</span>&nbsp;<span class="ident" id="3721218">priv</span>&nbsp;<span class="op" id="3721223">*</span><span class="ident" id="3721224">PrivateKey</span><span class="op" id="3721234">,</span>&nbsp;<span class="ident" id="3721236">c</span>&nbsp;<span class="op" id="3721238">*</span><span class="ident" id="3721239">big</span><span class="op" id="3721242">.</span><span class="ident" id="3721243">Int</span><span class="op" id="3721246">)</span>&nbsp;<span class="op" id="3721248">(</span><span class="ident" id="3721249">m</span>&nbsp;<span class="op" id="3721251">*</span><span class="ident" id="3721252">big</span><span class="op" id="3721255">.</span><span class="ident" id="3721256">Int</span><span class="op" id="3721259">,</span>&nbsp;<span class="ident" id="3721261">err</span>&nbsp;<span class="builtintype" id="3721265">error</span><span class="op" id="3721270">)</span>&nbsp;<span class="op" id="3721272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721275">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721327">if</span>&nbsp;<span class="ident" id="3721330">c</span><span class="op" id="3721331">.</span><span class="ident" id="3721332">Cmp</span><span class="op" id="3721335">(</span><span class="ident" id="3721336">priv</span><span class="op" id="3721340">.</span><span class="ident" id="3721341">N</span><span class="op" id="3721342">)</span>&nbsp;<span class="op" id="3721344">&gt;</span>&nbsp;<span class="num" id="3721346">0</span>&nbsp;<span class="op" id="3721348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721352">err</span>&nbsp;<span class="op" id="3721356">=</span>&nbsp;<span class="ident" id="3721358">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721386">var</span>&nbsp;<span class="ident" id="3721390">ir</span>&nbsp;<span class="op" id="3721393">*</span><span class="ident" id="3721394">big</span><span class="op" id="3721397">.</span><span class="ident" id="3721398">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721403">if</span>&nbsp;<span class="ident" id="3721406">random</span>&nbsp;<span class="op" id="3721413">!=</span>&nbsp;<span class="ident" id="3721416">nil</span>&nbsp;<span class="op" id="3721420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721424">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721487">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721551">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721615">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721672">var</span>&nbsp;<span class="ident" id="3721676">r</span>&nbsp;<span class="op" id="3721678">*</span><span class="ident" id="3721679">big</span><span class="op" id="3721682">.</span><span class="ident" id="3721683">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721690">for</span>&nbsp;<span class="op" id="3721694">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721699">r</span><span class="op" id="3721700">,</span>&nbsp;<span class="ident" id="3721702">err</span>&nbsp;<span class="op" id="3721706">=</span>&nbsp;<span class="ident" id="3721708">rand</span><span class="op" id="3721712">.</span><span class="ident" id="3721713">Int</span><span class="op" id="3721716">(</span><span class="ident" id="3721717">random</span><span class="op" id="3721723">,</span>&nbsp;<span class="ident" id="3721725">priv</span><span class="op" id="3721729">.</span><span class="ident" id="3721730">N</span><span class="op" id="3721731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721736">if</span>&nbsp;<span class="ident" id="3721739">err</span>&nbsp;<span class="op" id="3721743">!=</span>&nbsp;<span class="ident" id="3721746">nil</span>&nbsp;<span class="op" id="3721750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721756">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721771">if</span>&nbsp;<span class="ident" id="3721774">r</span><span class="op" id="3721775">.</span><span class="ident" id="3721776">Cmp</span><span class="op" id="3721779">(</span><span class="ident" id="3721780">bigZero</span><span class="op" id="3721787">)</span>&nbsp;<span class="op" id="3721789">==</span>&nbsp;<span class="num" id="3721792">0</span>&nbsp;<span class="op" id="3721794">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721800">r</span>&nbsp;<span class="op" id="3721802">=</span>&nbsp;<span class="ident" id="3721804">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721819">var</span>&nbsp;<span class="ident" id="3721823">ok</span>&nbsp;<span class="builtintype" id="3721826">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721834">ir</span><span class="op" id="3721836">,</span>&nbsp;<span class="ident" id="3721838">ok</span>&nbsp;<span class="op" id="3721841">=</span>&nbsp;<span class="ident" id="3721843">modInverse</span><span class="op" id="3721853">(</span><span class="ident" id="3721854">r</span><span class="op" id="3721855">,</span>&nbsp;<span class="ident" id="3721857">priv</span><span class="op" id="3721861">.</span><span class="ident" id="3721862">N</span><span class="op" id="3721863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721868">if</span>&nbsp;<span class="ident" id="3721871">ok</span>&nbsp;<span class="op" id="3721874">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721880">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721897">bigE</span>&nbsp;<span class="op" id="3721902">:=</span>&nbsp;<span class="ident" id="3721905">big</span><span class="op" id="3721908">.</span><span class="ident" id="3721909">NewInt</span><span class="op" id="3721915">(</span><span class="ident" id="3721916">int64</span><span class="op" id="3721921">(</span><span class="ident" id="3721922">priv</span><span class="op" id="3721926">.</span><span class="ident" id="3721927">E</span><span class="op" id="3721928">)</span><span class="op" id="3721929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721933">rpowe</span>&nbsp;<span class="op" id="3721939">:=</span>&nbsp;<span class="builtinfunc" id="3721942">new</span><span class="op" id="3721945">(</span><span class="ident" id="3721946">big</span><span class="op" id="3721949">.</span><span class="ident" id="3721950">Int</span><span class="op" id="3721953">)</span><span class="op" id="3721954">.</span><span class="ident" id="3721955">Exp</span><span class="op" id="3721958">(</span><span class="ident" id="3721959">r</span><span class="op" id="3721960">,</span>&nbsp;<span class="ident" id="3721962">bigE</span><span class="op" id="3721966">,</span>&nbsp;<span class="ident" id="3721968">priv</span><span class="op" id="3721972">.</span><span class="ident" id="3721973">N</span><span class="op" id="3721974">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721978">cCopy</span>&nbsp;<span class="op" id="3721984">:=</span>&nbsp;<span class="builtinfunc" id="3721987">new</span><span class="op" id="3721990">(</span><span class="ident" id="3721991">big</span><span class="op" id="3721994">.</span><span class="ident" id="3721995">Int</span><span class="op" id="3721998">)</span><span class="op" id="3721999">.</span><span class="ident" id="3722000">Set</span><span class="op" id="3722003">(</span><span class="ident" id="3722004">c</span><span class="op" id="3722005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722009">cCopy</span><span class="op" id="3722014">.</span><span class="ident" id="3722015">Mul</span><span class="op" id="3722018">(</span><span class="ident" id="3722019">cCopy</span><span class="op" id="3722024">,</span>&nbsp;<span class="ident" id="3722026">rpowe</span><span class="op" id="3722031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722035">cCopy</span><span class="op" id="3722040">.</span><span class="ident" id="3722041">Mod</span><span class="op" id="3722044">(</span><span class="ident" id="3722045">cCopy</span><span class="op" id="3722050">,</span>&nbsp;<span class="ident" id="3722052">priv</span><span class="op" id="3722056">.</span><span class="ident" id="3722057">N</span><span class="op" id="3722058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722062">c</span>&nbsp;<span class="op" id="3722064">=</span>&nbsp;<span class="ident" id="3722066">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722073">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722077">if</span>&nbsp;<span class="ident" id="3722080">priv</span><span class="op" id="3722084">.</span><span class="ident" id="3722085">Precomputed</span><span class="op" id="3722096">.</span><span class="ident" id="3722097">Dp</span>&nbsp;<span class="op" id="3722100">==</span>&nbsp;<span class="ident" id="3722103">nil</span>&nbsp;<span class="op" id="3722107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722111">m</span>&nbsp;<span class="op" id="3722113">=</span>&nbsp;<span class="builtinfunc" id="3722115">new</span><span class="op" id="3722118">(</span><span class="ident" id="3722119">big</span><span class="op" id="3722122">.</span><span class="ident" id="3722123">Int</span><span class="op" id="3722126">)</span><span class="op" id="3722127">.</span><span class="ident" id="3722128">Exp</span><span class="op" id="3722131">(</span><span class="ident" id="3722132">c</span><span class="op" id="3722133">,</span>&nbsp;<span class="ident" id="3722135">priv</span><span class="op" id="3722139">.</span><span class="ident" id="3722140">D</span><span class="op" id="3722141">,</span>&nbsp;<span class="ident" id="3722143">priv</span><span class="op" id="3722147">.</span><span class="ident" id="3722148">N</span><span class="op" id="3722149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722152">}</span>&nbsp;<span class="keyword" id="3722154">else</span>&nbsp;<span class="op" id="3722159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722163">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722221">m</span>&nbsp;<span class="op" id="3722223">=</span>&nbsp;<span class="builtinfunc" id="3722225">new</span><span class="op" id="3722228">(</span><span class="ident" id="3722229">big</span><span class="op" id="3722232">.</span><span class="ident" id="3722233">Int</span><span class="op" id="3722236">)</span><span class="op" id="3722237">.</span><span class="ident" id="3722238">Exp</span><span class="op" id="3722241">(</span><span class="ident" id="3722242">c</span><span class="op" id="3722243">,</span>&nbsp;<span class="ident" id="3722245">priv</span><span class="op" id="3722249">.</span><span class="ident" id="3722250">Precomputed</span><span class="op" id="3722261">.</span><span class="ident" id="3722262">Dp</span><span class="op" id="3722264">,</span>&nbsp;<span class="ident" id="3722266">priv</span><span class="op" id="3722270">.</span><span class="ident" id="3722271">Primes</span><span class="op" id="3722277">[</span><span class="num" id="3722278">0</span><span class="op" id="3722279">]</span><span class="op" id="3722280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722284">m2</span>&nbsp;<span class="op" id="3722287">:=</span>&nbsp;<span class="builtinfunc" id="3722290">new</span><span class="op" id="3722293">(</span><span class="ident" id="3722294">big</span><span class="op" id="3722297">.</span><span class="ident" id="3722298">Int</span><span class="op" id="3722301">)</span><span class="op" id="3722302">.</span><span class="ident" id="3722303">Exp</span><span class="op" id="3722306">(</span><span class="ident" id="3722307">c</span><span class="op" id="3722308">,</span>&nbsp;<span class="ident" id="3722310">priv</span><span class="op" id="3722314">.</span><span class="ident" id="3722315">Precomputed</span><span class="op" id="3722326">.</span><span class="ident" id="3722327">Dq</span><span class="op" id="3722329">,</span>&nbsp;<span class="ident" id="3722331">priv</span><span class="op" id="3722335">.</span><span class="ident" id="3722336">Primes</span><span class="op" id="3722342">[</span><span class="num" id="3722343">1</span><span class="op" id="3722344">]</span><span class="op" id="3722345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722349">m</span><span class="op" id="3722350">.</span><span class="ident" id="3722351">Sub</span><span class="op" id="3722354">(</span><span class="ident" id="3722355">m</span><span class="op" id="3722356">,</span>&nbsp;<span class="ident" id="3722358">m2</span><span class="op" id="3722360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722364">if</span>&nbsp;<span class="ident" id="3722367">m</span><span class="op" id="3722368">.</span><span class="ident" id="3722369">Sign</span><span class="op" id="3722373">(</span><span class="op" id="3722374">)</span>&nbsp;<span class="op" id="3722376">&lt;</span>&nbsp;<span class="num" id="3722378">0</span>&nbsp;<span class="op" id="3722380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722385">m</span><span class="op" id="3722386">.</span><span class="ident" id="3722387">Add</span><span class="op" id="3722390">(</span><span class="ident" id="3722391">m</span><span class="op" id="3722392">,</span>&nbsp;<span class="ident" id="3722394">priv</span><span class="op" id="3722398">.</span><span class="ident" id="3722399">Primes</span><span class="op" id="3722405">[</span><span class="num" id="3722406">0</span><span class="op" id="3722407">]</span><span class="op" id="3722408">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722416">m</span><span class="op" id="3722417">.</span><span class="ident" id="3722418">Mul</span><span class="op" id="3722421">(</span><span class="ident" id="3722422">m</span><span class="op" id="3722423">,</span>&nbsp;<span class="ident" id="3722425">priv</span><span class="op" id="3722429">.</span><span class="ident" id="3722430">Precomputed</span><span class="op" id="3722441">.</span><span class="ident" id="3722442">Qinv</span><span class="op" id="3722446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722450">m</span><span class="op" id="3722451">.</span><span class="ident" id="3722452">Mod</span><span class="op" id="3722455">(</span><span class="ident" id="3722456">m</span><span class="op" id="3722457">,</span>&nbsp;<span class="ident" id="3722459">priv</span><span class="op" id="3722463">.</span><span class="ident" id="3722464">Primes</span><span class="op" id="3722470">[</span><span class="num" id="3722471">0</span><span class="op" id="3722472">]</span><span class="op" id="3722473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722477">m</span><span class="op" id="3722478">.</span><span class="ident" id="3722479">Mul</span><span class="op" id="3722482">(</span><span class="ident" id="3722483">m</span><span class="op" id="3722484">,</span>&nbsp;<span class="ident" id="3722486">priv</span><span class="op" id="3722490">.</span><span class="ident" id="3722491">Primes</span><span class="op" id="3722497">[</span><span class="num" id="3722498">1</span><span class="op" id="3722499">]</span><span class="op" id="3722500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722504">m</span><span class="op" id="3722505">.</span><span class="ident" id="3722506">Add</span><span class="op" id="3722509">(</span><span class="ident" id="3722510">m</span><span class="op" id="3722511">,</span>&nbsp;<span class="ident" id="3722513">m2</span><span class="op" id="3722515">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722520">for</span>&nbsp;<span class="ident" id="3722524">i</span><span class="op" id="3722525">,</span>&nbsp;<span class="ident" id="3722527">values</span>&nbsp;<span class="op" id="3722534">:=</span>&nbsp;<span class="keyword" id="3722537">range</span>&nbsp;<span class="ident" id="3722543">priv</span><span class="op" id="3722547">.</span><span class="ident" id="3722548">Precomputed</span><span class="op" id="3722559">.</span><span class="ident" id="3722560">CRTValues</span>&nbsp;<span class="op" id="3722570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722575">prime</span>&nbsp;<span class="op" id="3722581">:=</span>&nbsp;<span class="ident" id="3722584">priv</span><span class="op" id="3722588">.</span><span class="ident" id="3722589">Primes</span><span class="op" id="3722595">[</span><span class="num" id="3722596">2</span><span class="op" id="3722597">+</span><span class="ident" id="3722598">i</span><span class="op" id="3722599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722604">m2</span><span class="op" id="3722606">.</span><span class="ident" id="3722607">Exp</span><span class="op" id="3722610">(</span><span class="ident" id="3722611">c</span><span class="op" id="3722612">,</span>&nbsp;<span class="ident" id="3722614">values</span><span class="op" id="3722620">.</span><span class="ident" id="3722621">Exp</span><span class="op" id="3722624">,</span>&nbsp;<span class="ident" id="3722626">prime</span><span class="op" id="3722631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722636">m2</span><span class="op" id="3722638">.</span><span class="ident" id="3722639">Sub</span><span class="op" id="3722642">(</span><span class="ident" id="3722643">m2</span><span class="op" id="3722645">,</span>&nbsp;<span class="ident" id="3722647">m</span><span class="op" id="3722648">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722653">m2</span><span class="op" id="3722655">.</span><span class="ident" id="3722656">Mul</span><span class="op" id="3722659">(</span><span class="ident" id="3722660">m2</span><span class="op" id="3722662">,</span>&nbsp;<span class="ident" id="3722664">values</span><span class="op" id="3722670">.</span><span class="ident" id="3722671">Coeff</span><span class="op" id="3722676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722681">m2</span><span class="op" id="3722683">.</span><span class="ident" id="3722684">Mod</span><span class="op" id="3722687">(</span><span class="ident" id="3722688">m2</span><span class="op" id="3722690">,</span>&nbsp;<span class="ident" id="3722692">prime</span><span class="op" id="3722697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722702">if</span>&nbsp;<span class="ident" id="3722705">m2</span><span class="op" id="3722707">.</span><span class="ident" id="3722708">Sign</span><span class="op" id="3722712">(</span><span class="op" id="3722713">)</span>&nbsp;<span class="op" id="3722715">&lt;</span>&nbsp;<span class="num" id="3722717">0</span>&nbsp;<span class="op" id="3722719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722725">m2</span><span class="op" id="3722727">.</span><span class="ident" id="3722728">Add</span><span class="op" id="3722731">(</span><span class="ident" id="3722732">m2</span><span class="op" id="3722734">,</span>&nbsp;<span class="ident" id="3722736">prime</span><span class="op" id="3722741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722746">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722751">m2</span><span class="op" id="3722753">.</span><span class="ident" id="3722754">Mul</span><span class="op" id="3722757">(</span><span class="ident" id="3722758">m2</span><span class="op" id="3722760">,</span>&nbsp;<span class="ident" id="3722762">values</span><span class="op" id="3722768">.</span><span class="ident" id="3722769">R</span><span class="op" id="3722770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722775">m</span><span class="op" id="3722776">.</span><span class="ident" id="3722777">Add</span><span class="op" id="3722780">(</span><span class="ident" id="3722781">m</span><span class="op" id="3722782">,</span>&nbsp;<span class="ident" id="3722784">m2</span><span class="op" id="3722786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722797">if</span>&nbsp;<span class="ident" id="3722800">ir</span>&nbsp;<span class="op" id="3722803">!=</span>&nbsp;<span class="ident" id="3722806">nil</span>&nbsp;<span class="op" id="3722810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722814">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722828">m</span><span class="op" id="3722829">.</span><span class="ident" id="3722830">Mul</span><span class="op" id="3722833">(</span><span class="ident" id="3722834">m</span><span class="op" id="3722835">,</span>&nbsp;<span class="ident" id="3722837">ir</span><span class="op" id="3722839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722843">m</span><span class="op" id="3722844">.</span><span class="ident" id="3722845">Mod</span><span class="op" id="3722848">(</span><span class="ident" id="3722849">m</span><span class="op" id="3722850">,</span>&nbsp;<span class="ident" id="3722852">priv</span><span class="op" id="3722856">.</span><span class="ident" id="3722857">N</span><span class="op" id="3722858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722861">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722865">return</span><br>
<span class="lineno"></span><span class="op" id="3722872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3722875">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="3722926">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="3723015">func</span>&nbsp;<span class="ident" id="3723020">DecryptOAEP</span><span class="op" id="3723031">(</span><span class="ident" id="3723032">hash</span>&nbsp;<span class="ident" id="3723037">hash</span><span class="op" id="3723041">.</span><span class="ident" id="3723042">Hash</span><span class="op" id="3723046">,</span>&nbsp;<span class="ident" id="3723048">random</span>&nbsp;<span class="ident" id="3723055">io</span><span class="op" id="3723057">.</span><span class="ident" id="3723058">Reader</span><span class="op" id="3723064">,</span>&nbsp;<span class="ident" id="3723066">priv</span>&nbsp;<span class="op" id="3723071">*</span><span class="ident" id="3723072">PrivateKey</span><span class="op" id="3723082">,</span>&nbsp;<span class="ident" id="3723084">ciphertext</span>&nbsp;<span class="op" id="3723095">[</span><span class="op" id="3723096">]</span><span class="builtintype" id="3723097">byte</span><span class="op" id="3723101">,</span>&nbsp;<span class="ident" id="3723103">label</span>&nbsp;<span class="op" id="3723109">[</span><span class="op" id="3723110">]</span><span class="builtintype" id="3723111">byte</span><span class="op" id="3723115">)</span>&nbsp;<span class="op" id="3723117">(</span><span class="ident" id="3723118">msg</span>&nbsp;<span class="op" id="3723122">[</span><span class="op" id="3723123">]</span><span class="builtintype" id="3723124">byte</span><span class="op" id="3723128">,</span>&nbsp;<span class="ident" id="3723130">err</span>&nbsp;<span class="builtintype" id="3723134">error</span><span class="op" id="3723139">)</span>&nbsp;<span class="op" id="3723141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723144">if</span>&nbsp;<span class="ident" id="3723147">err</span>&nbsp;<span class="op" id="3723151">:=</span>&nbsp;<span class="ident" id="3723154">checkPub</span><span class="op" id="3723162">(</span><span class="op" id="3723163">&amp;</span><span class="ident" id="3723164">priv</span><span class="op" id="3723168">.</span><span class="ident" id="3723169">PublicKey</span><span class="op" id="3723178">)</span><span class="op" id="3723179">;</span>&nbsp;<span class="ident" id="3723181">err</span>&nbsp;<span class="op" id="3723185">!=</span>&nbsp;<span class="ident" id="3723188">nil</span>&nbsp;<span class="op" id="3723192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723196">return</span>&nbsp;<span class="ident" id="3723203">nil</span><span class="op" id="3723206">,</span>&nbsp;<span class="ident" id="3723208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723213">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723216">k</span>&nbsp;<span class="op" id="3723218">:=</span>&nbsp;<span class="op" id="3723221">(</span><span class="ident" id="3723222">priv</span><span class="op" id="3723226">.</span><span class="ident" id="3723227">N</span><span class="op" id="3723228">.</span><span class="ident" id="3723229">BitLen</span><span class="op" id="3723235">(</span><span class="op" id="3723236">)</span>&nbsp;<span class="op" id="3723238">+</span>&nbsp;<span class="num" id="3723240">7</span><span class="op" id="3723241">)</span>&nbsp;<span class="op" id="3723243">/</span>&nbsp;<span class="num" id="3723245">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723248">if</span>&nbsp;<span class="builtinfunc" id="3723251">len</span><span class="op" id="3723254">(</span><span class="ident" id="3723255">ciphertext</span><span class="op" id="3723265">)</span>&nbsp;<span class="op" id="3723267">&gt;</span>&nbsp;<span class="ident" id="3723269">k</span>&nbsp;<span class="op" id="3723271">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723276">k</span>&nbsp;<span class="op" id="3723278">&lt;</span>&nbsp;<span class="ident" id="3723280">hash</span><span class="op" id="3723284">.</span><span class="ident" id="3723285">Size</span><span class="op" id="3723289">(</span><span class="op" id="3723290">)</span><span class="op" id="3723291">*</span><span class="num" id="3723292">2</span><span class="op" id="3723293">+</span><span class="num" id="3723294">2</span>&nbsp;<span class="op" id="3723296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723300">err</span>&nbsp;<span class="op" id="3723304">=</span>&nbsp;<span class="ident" id="3723306">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723322">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723334">c</span>&nbsp;<span class="op" id="3723336">:=</span>&nbsp;<span class="builtinfunc" id="3723339">new</span><span class="op" id="3723342">(</span><span class="ident" id="3723343">big</span><span class="op" id="3723346">.</span><span class="ident" id="3723347">Int</span><span class="op" id="3723350">)</span><span class="op" id="3723351">.</span><span class="ident" id="3723352">SetBytes</span><span class="op" id="3723360">(</span><span class="ident" id="3723361">ciphertext</span><span class="op" id="3723371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723375">m</span><span class="op" id="3723376">,</span>&nbsp;<span class="ident" id="3723378">err</span>&nbsp;<span class="op" id="3723382">:=</span>&nbsp;<span class="ident" id="3723385">decrypt</span><span class="op" id="3723392">(</span><span class="ident" id="3723393">random</span><span class="op" id="3723399">,</span>&nbsp;<span class="ident" id="3723401">priv</span><span class="op" id="3723405">,</span>&nbsp;<span class="ident" id="3723407">c</span><span class="op" id="3723408">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723411">if</span>&nbsp;<span class="ident" id="3723414">err</span>&nbsp;<span class="op" id="3723418">!=</span>&nbsp;<span class="ident" id="3723421">nil</span>&nbsp;<span class="op" id="3723425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723429">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723441">hash</span><span class="op" id="3723445">.</span><span class="ident" id="3723446">Write</span><span class="op" id="3723451">(</span><span class="ident" id="3723452">label</span><span class="op" id="3723457">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723460">lHash</span>&nbsp;<span class="op" id="3723466">:=</span>&nbsp;<span class="ident" id="3723469">hash</span><span class="op" id="3723473">.</span><span class="ident" id="3723474">Sum</span><span class="op" id="3723477">(</span><span class="ident" id="3723478">nil</span><span class="op" id="3723481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723484">hash</span><span class="op" id="3723488">.</span><span class="ident" id="3723489">Reset</span><span class="op" id="3723494">(</span><span class="op" id="3723495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723499">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723559">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723632">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723701">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723769">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723795">em</span>&nbsp;<span class="op" id="3723798">:=</span>&nbsp;<span class="ident" id="3723801">leftPad</span><span class="op" id="3723808">(</span><span class="ident" id="3723809">m</span><span class="op" id="3723810">.</span><span class="ident" id="3723811">Bytes</span><span class="op" id="3723816">(</span><span class="op" id="3723817">)</span><span class="op" id="3723818">,</span>&nbsp;<span class="ident" id="3723820">k</span><span class="op" id="3723821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723825">firstByteIsZero</span>&nbsp;<span class="op" id="3723841">:=</span>&nbsp;<span class="ident" id="3723844">subtle</span><span class="op" id="3723850">.</span><span class="ident" id="3723851">ConstantTimeByteEq</span><span class="op" id="3723869">(</span><span class="ident" id="3723870">em</span><span class="op" id="3723872">[</span><span class="num" id="3723873">0</span><span class="op" id="3723874">]</span><span class="op" id="3723875">,</span>&nbsp;<span class="num" id="3723877">0</span><span class="op" id="3723878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723882">seed</span>&nbsp;<span class="op" id="3723887">:=</span>&nbsp;<span class="ident" id="3723890">em</span><span class="op" id="3723892">[</span><span class="num" id="3723893">1</span>&nbsp;<span class="op" id="3723895">:</span>&nbsp;<span class="ident" id="3723897">hash</span><span class="op" id="3723901">.</span><span class="ident" id="3723902">Size</span><span class="op" id="3723906">(</span><span class="op" id="3723907">)</span><span class="op" id="3723908">+</span><span class="num" id="3723909">1</span><span class="op" id="3723910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723913">db</span>&nbsp;<span class="op" id="3723916">:=</span>&nbsp;<span class="ident" id="3723919">em</span><span class="op" id="3723921">[</span><span class="ident" id="3723922">hash</span><span class="op" id="3723926">.</span><span class="ident" id="3723927">Size</span><span class="op" id="3723931">(</span><span class="op" id="3723932">)</span><span class="op" id="3723933">+</span><span class="num" id="3723934">1</span><span class="op" id="3723935">:</span><span class="op" id="3723936">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723940">mgf1XOR</span><span class="op" id="3723947">(</span><span class="ident" id="3723948">seed</span><span class="op" id="3723952">,</span>&nbsp;<span class="ident" id="3723954">hash</span><span class="op" id="3723958">,</span>&nbsp;<span class="ident" id="3723960">db</span><span class="op" id="3723962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723965">mgf1XOR</span><span class="op" id="3723972">(</span><span class="ident" id="3723973">db</span><span class="op" id="3723975">,</span>&nbsp;<span class="ident" id="3723977">hash</span><span class="op" id="3723981">,</span>&nbsp;<span class="ident" id="3723983">seed</span><span class="op" id="3723987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723991">lHash2</span>&nbsp;<span class="op" id="3723998">:=</span>&nbsp;<span class="ident" id="3724001">db</span><span class="op" id="3724003">[</span><span class="num" id="3724004">0</span><span class="op" id="3724005">:</span><span class="ident" id="3724006">hash</span><span class="op" id="3724010">.</span><span class="ident" id="3724011">Size</span><span class="op" id="3724015">(</span><span class="op" id="3724016">)</span><span class="op" id="3724017">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724021">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724094">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724165">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724233">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724289">lHash2Good</span>&nbsp;<span class="op" id="3724300">:=</span>&nbsp;<span class="ident" id="3724303">subtle</span><span class="op" id="3724309">.</span><span class="ident" id="3724310">ConstantTimeCompare</span><span class="op" id="3724329">(</span><span class="ident" id="3724330">lHash</span><span class="op" id="3724335">,</span>&nbsp;<span class="ident" id="3724337">lHash2</span><span class="op" id="3724343">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724347">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724418">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724456">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724519">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724566">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724627">var</span>&nbsp;<span class="ident" id="3724631">lookingForIndex</span><span class="op" id="3724646">,</span>&nbsp;<span class="ident" id="3724648">index</span><span class="op" id="3724653">,</span>&nbsp;<span class="ident" id="3724655">invalid</span>&nbsp;<span class="builtintype" id="3724663">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724668">lookingForIndex</span>&nbsp;<span class="op" id="3724684">=</span>&nbsp;<span class="num" id="3724686">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724689">rest</span>&nbsp;<span class="op" id="3724694">:=</span>&nbsp;<span class="ident" id="3724697">db</span><span class="op" id="3724699">[</span><span class="ident" id="3724700">hash</span><span class="op" id="3724704">.</span><span class="ident" id="3724705">Size</span><span class="op" id="3724709">(</span><span class="op" id="3724710">)</span><span class="op" id="3724711">:</span><span class="op" id="3724712">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724716">for</span>&nbsp;<span class="ident" id="3724720">i</span>&nbsp;<span class="op" id="3724722">:=</span>&nbsp;<span class="num" id="3724725">0</span><span class="op" id="3724726">;</span>&nbsp;<span class="ident" id="3724728">i</span>&nbsp;<span class="op" id="3724730">&lt;</span>&nbsp;<span class="builtinfunc" id="3724732">len</span><span class="op" id="3724735">(</span><span class="ident" id="3724736">rest</span><span class="op" id="3724740">)</span><span class="op" id="3724741">;</span>&nbsp;<span class="ident" id="3724743">i</span><span class="op" id="3724744">++</span>&nbsp;<span class="op" id="3724747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724751">equals0</span>&nbsp;<span class="op" id="3724759">:=</span>&nbsp;<span class="ident" id="3724762">subtle</span><span class="op" id="3724768">.</span><span class="ident" id="3724769">ConstantTimeByteEq</span><span class="op" id="3724787">(</span><span class="ident" id="3724788">rest</span><span class="op" id="3724792">[</span><span class="ident" id="3724793">i</span><span class="op" id="3724794">]</span><span class="op" id="3724795">,</span>&nbsp;<span class="num" id="3724797">0</span><span class="op" id="3724798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724802">equals1</span>&nbsp;<span class="op" id="3724810">:=</span>&nbsp;<span class="ident" id="3724813">subtle</span><span class="op" id="3724819">.</span><span class="ident" id="3724820">ConstantTimeByteEq</span><span class="op" id="3724838">(</span><span class="ident" id="3724839">rest</span><span class="op" id="3724843">[</span><span class="ident" id="3724844">i</span><span class="op" id="3724845">]</span><span class="op" id="3724846">,</span>&nbsp;<span class="num" id="3724848">1</span><span class="op" id="3724849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724853">index</span>&nbsp;<span class="op" id="3724859">=</span>&nbsp;<span class="ident" id="3724861">subtle</span><span class="op" id="3724867">.</span><span class="ident" id="3724868">ConstantTimeSelect</span><span class="op" id="3724886">(</span><span class="ident" id="3724887">lookingForIndex</span><span class="op" id="3724902">&amp;</span><span class="ident" id="3724903">equals1</span><span class="op" id="3724910">,</span>&nbsp;<span class="ident" id="3724912">i</span><span class="op" id="3724913">,</span>&nbsp;<span class="ident" id="3724915">index</span><span class="op" id="3724920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724924">lookingForIndex</span>&nbsp;<span class="op" id="3724940">=</span>&nbsp;<span class="ident" id="3724942">subtle</span><span class="op" id="3724948">.</span><span class="ident" id="3724949">ConstantTimeSelect</span><span class="op" id="3724967">(</span><span class="ident" id="3724968">equals1</span><span class="op" id="3724975">,</span>&nbsp;<span class="num" id="3724977">0</span><span class="op" id="3724978">,</span>&nbsp;<span class="ident" id="3724980">lookingForIndex</span><span class="op" id="3724995">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724999">invalid</span>&nbsp;<span class="op" id="3725007">=</span>&nbsp;<span class="ident" id="3725009">subtle</span><span class="op" id="3725015">.</span><span class="ident" id="3725016">ConstantTimeSelect</span><span class="op" id="3725034">(</span><span class="ident" id="3725035">lookingForIndex</span><span class="op" id="3725050">&amp;^</span><span class="ident" id="3725052">equals0</span><span class="op" id="3725059">,</span>&nbsp;<span class="num" id="3725061">1</span><span class="op" id="3725062">,</span>&nbsp;<span class="ident" id="3725064">invalid</span><span class="op" id="3725071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725078">if</span>&nbsp;<span class="ident" id="3725081">firstByteIsZero</span><span class="op" id="3725096">&amp;</span><span class="ident" id="3725097">lHash2Good</span><span class="op" id="3725107">&amp;^</span><span class="ident" id="3725109">invalid</span><span class="op" id="3725116">&amp;^</span><span class="ident" id="3725118">lookingForIndex</span>&nbsp;<span class="op" id="3725134">!=</span>&nbsp;<span class="num" id="3725137">1</span>&nbsp;<span class="op" id="3725139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725143">err</span>&nbsp;<span class="op" id="3725147">=</span>&nbsp;<span class="ident" id="3725149">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725165">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725177">msg</span>&nbsp;<span class="op" id="3725181">=</span>&nbsp;<span class="ident" id="3725183">rest</span><span class="op" id="3725187">[</span><span class="ident" id="3725188">index</span><span class="op" id="3725193">+</span><span class="num" id="3725194">1</span><span class="op" id="3725195">:</span><span class="op" id="3725196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725199">return</span><br>
<span class="lineno">545</span><span class="op" id="3725206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3725209">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="3725288">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="3725317">func</span>&nbsp;<span class="ident" id="3725322">leftPad</span><span class="op" id="3725329">(</span><span class="ident" id="3725330">input</span>&nbsp;<span class="op" id="3725336">[</span><span class="op" id="3725337">]</span><span class="builtintype" id="3725338">byte</span><span class="op" id="3725342">,</span>&nbsp;<span class="ident" id="3725344">size</span>&nbsp;<span class="builtintype" id="3725349">int</span><span class="op" id="3725352">)</span>&nbsp;<span class="op" id="3725354">(</span><span class="ident" id="3725355">out</span>&nbsp;<span class="op" id="3725359">[</span><span class="op" id="3725360">]</span><span class="builtintype" id="3725361">byte</span><span class="op" id="3725365">)</span>&nbsp;<span class="op" id="3725367">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725370">n</span>&nbsp;<span class="op" id="3725372">:=</span>&nbsp;<span class="builtinfunc" id="3725375">len</span><span class="op" id="3725378">(</span><span class="ident" id="3725379">input</span><span class="op" id="3725384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725387">if</span>&nbsp;<span class="ident" id="3725390">n</span>&nbsp;<span class="op" id="3725392">&gt;</span>&nbsp;<span class="ident" id="3725394">size</span>&nbsp;<span class="op" id="3725399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725403">n</span>&nbsp;<span class="op" id="3725405">=</span>&nbsp;<span class="ident" id="3725407">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725416">out</span>&nbsp;<span class="op" id="3725420">=</span>&nbsp;<span class="builtinfunc" id="3725422">make</span><span class="op" id="3725426">(</span><span class="op" id="3725427">[</span><span class="op" id="3725428">]</span><span class="builtintype" id="3725429">byte</span><span class="op" id="3725433">,</span>&nbsp;<span class="ident" id="3725435">size</span><span class="op" id="3725439">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3725442">copy</span><span class="op" id="3725446">(</span><span class="ident" id="3725447">out</span><span class="op" id="3725450">[</span><span class="builtinfunc" id="3725451">len</span><span class="op" id="3725454">(</span><span class="ident" id="3725455">out</span><span class="op" id="3725458">)</span><span class="op" id="3725459">-</span><span class="ident" id="3725460">n</span><span class="op" id="3725461">:</span><span class="op" id="3725462">]</span><span class="op" id="3725463">,</span>&nbsp;<span class="ident" id="3725465">input</span><span class="op" id="3725470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725473">return</span><br>
<span class="lineno"></span><span class="op" id="3725480">}</span>
</div>
</body>
</html>
