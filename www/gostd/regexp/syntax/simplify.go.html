<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2301782">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2301838">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2301892">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2301943">package</span>&nbsp;<span class="ident" id="2301951">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2301959">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="2302037">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="2302117">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="2302194">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="2302265">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="2302339">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="2302406">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="2302474">func</span>&nbsp;<span class="op" id="2302479">(</span><span class="ident" id="2302480">re</span>&nbsp;<span class="op" id="2302483">*</span><span class="ident" id="2302484">Regexp</span><span class="op" id="2302490">)</span>&nbsp;<span class="ident" id="2302492">Simplify</span><span class="op" id="2302500">(</span><span class="op" id="2302501">)</span>&nbsp;<span class="op" id="2302503">*</span><span class="ident" id="2302504">Regexp</span>&nbsp;<span class="op" id="2302511">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302514">if</span>&nbsp;<span class="ident" id="2302517">re</span>&nbsp;<span class="op" id="2302520">==</span>&nbsp;<span class="ident" id="2302523">nil</span>&nbsp;<span class="op" id="2302527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302531">return</span>&nbsp;<span class="ident" id="2302538">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302546">switch</span>&nbsp;<span class="ident" id="2302553">re</span><span class="op" id="2302555">.</span><span class="ident" id="2302556">Op</span>&nbsp;<span class="op" id="2302559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302562">case</span>&nbsp;<span class="ident" id="2302567">OpCapture</span><span class="op" id="2302576">,</span>&nbsp;<span class="ident" id="2302578">OpConcat</span><span class="op" id="2302586">,</span>&nbsp;<span class="ident" id="2302588">OpAlternate</span><span class="op" id="2302599">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302603">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302667">nre</span>&nbsp;<span class="op" id="2302671">:=</span>&nbsp;<span class="ident" id="2302674">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302679">for</span>&nbsp;<span class="ident" id="2302683">i</span><span class="op" id="2302684">,</span>&nbsp;<span class="ident" id="2302686">sub</span>&nbsp;<span class="op" id="2302690">:=</span>&nbsp;<span class="keyword" id="2302693">range</span>&nbsp;<span class="ident" id="2302699">re</span><span class="op" id="2302701">.</span><span class="ident" id="2302702">Sub</span>&nbsp;<span class="op" id="2302706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302711">nsub</span>&nbsp;<span class="op" id="2302716">:=</span>&nbsp;<span class="ident" id="2302719">sub</span><span class="op" id="2302722">.</span><span class="ident" id="2302723">Simplify</span><span class="op" id="2302731">(</span><span class="op" id="2302732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302737">if</span>&nbsp;<span class="ident" id="2302740">nre</span>&nbsp;<span class="op" id="2302744">==</span>&nbsp;<span class="ident" id="2302747">re</span>&nbsp;<span class="op" id="2302750">&amp;&amp;</span>&nbsp;<span class="ident" id="2302753">nsub</span>&nbsp;<span class="op" id="2302758">!=</span>&nbsp;<span class="ident" id="2302761">sub</span>&nbsp;<span class="op" id="2302765">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302771">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302792">nre</span>&nbsp;<span class="op" id="2302796">=</span>&nbsp;<span class="builtinfunc" id="2302798">new</span><span class="op" id="2302801">(</span><span class="ident" id="2302802">Regexp</span><span class="op" id="2302808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302814">*</span><span class="ident" id="2302815">nre</span>&nbsp;<span class="op" id="2302819">=</span>&nbsp;<span class="op" id="2302821">*</span><span class="ident" id="2302822">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302829">nre</span><span class="op" id="2302832">.</span><span class="ident" id="2302833">Rune</span>&nbsp;<span class="op" id="2302838">=</span>&nbsp;<span class="ident" id="2302840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302848">nre</span><span class="op" id="2302851">.</span><span class="ident" id="2302852">Sub</span>&nbsp;<span class="op" id="2302856">=</span>&nbsp;<span class="builtinfunc" id="2302858">append</span><span class="op" id="2302864">(</span><span class="ident" id="2302865">nre</span><span class="op" id="2302868">.</span><span class="ident" id="2302869">Sub0</span><span class="op" id="2302873">[</span><span class="op" id="2302874">:</span><span class="num" id="2302875">0</span><span class="op" id="2302876">]</span><span class="op" id="2302877">,</span>&nbsp;<span class="ident" id="2302879">re</span><span class="op" id="2302881">.</span><span class="ident" id="2302882">Sub</span><span class="op" id="2302885">[</span><span class="op" id="2302886">:</span><span class="ident" id="2302887">i</span><span class="op" id="2302888">]</span><span class="op" id="2302889">...</span><span class="op" id="2302892">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302902">if</span>&nbsp;<span class="ident" id="2302905">nre</span>&nbsp;<span class="op" id="2302909">!=</span>&nbsp;<span class="ident" id="2302912">re</span>&nbsp;<span class="op" id="2302915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302921">nre</span><span class="op" id="2302924">.</span><span class="ident" id="2302925">Sub</span>&nbsp;<span class="op" id="2302929">=</span>&nbsp;<span class="builtinfunc" id="2302931">append</span><span class="op" id="2302937">(</span><span class="ident" id="2302938">nre</span><span class="op" id="2302941">.</span><span class="ident" id="2302942">Sub</span><span class="op" id="2302945">,</span>&nbsp;<span class="ident" id="2302947">nsub</span><span class="op" id="2302951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302960">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302964">return</span>&nbsp;<span class="ident" id="2302971">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302977">case</span>&nbsp;<span class="ident" id="2302982">OpStar</span><span class="op" id="2302988">,</span>&nbsp;<span class="ident" id="2302990">OpPlus</span><span class="op" id="2302996">,</span>&nbsp;<span class="ident" id="2302998">OpQuest</span><span class="op" id="2303005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303009">sub</span>&nbsp;<span class="op" id="2303013">:=</span>&nbsp;<span class="ident" id="2303016">re</span><span class="op" id="2303018">.</span><span class="ident" id="2303019">Sub</span><span class="op" id="2303022">[</span><span class="num" id="2303023">0</span><span class="op" id="2303024">]</span><span class="op" id="2303025">.</span><span class="ident" id="2303026">Simplify</span><span class="op" id="2303034">(</span><span class="op" id="2303035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303039">return</span>&nbsp;<span class="ident" id="2303046">simplify1</span><span class="op" id="2303055">(</span><span class="ident" id="2303056">re</span><span class="op" id="2303058">.</span><span class="ident" id="2303059">Op</span><span class="op" id="2303061">,</span>&nbsp;<span class="ident" id="2303063">re</span><span class="op" id="2303065">.</span><span class="ident" id="2303066">Flags</span><span class="op" id="2303071">,</span>&nbsp;<span class="ident" id="2303073">sub</span><span class="op" id="2303076">,</span>&nbsp;<span class="ident" id="2303078">re</span><span class="op" id="2303080">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303084">case</span>&nbsp;<span class="ident" id="2303089">OpRepeat</span><span class="op" id="2303097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303101">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303158">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303200">if</span>&nbsp;<span class="ident" id="2303203">re</span><span class="op" id="2303205">.</span><span class="ident" id="2303206">Min</span>&nbsp;<span class="op" id="2303210">==</span>&nbsp;<span class="num" id="2303213">0</span>&nbsp;<span class="op" id="2303215">&amp;&amp;</span>&nbsp;<span class="ident" id="2303218">re</span><span class="op" id="2303220">.</span><span class="ident" id="2303221">Max</span>&nbsp;<span class="op" id="2303225">==</span>&nbsp;<span class="num" id="2303228">0</span>&nbsp;<span class="op" id="2303230">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303235">return</span>&nbsp;<span class="op" id="2303242">&amp;</span><span class="ident" id="2303243">Regexp</span><span class="op" id="2303249">{</span><span class="ident" id="2303250">Op</span><span class="op" id="2303252">:</span>&nbsp;<span class="ident" id="2303254">OpEmptyMatch</span><span class="op" id="2303266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303275">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303296">sub</span>&nbsp;<span class="op" id="2303300">:=</span>&nbsp;<span class="ident" id="2303303">re</span><span class="op" id="2303305">.</span><span class="ident" id="2303306">Sub</span><span class="op" id="2303309">[</span><span class="num" id="2303310">0</span><span class="op" id="2303311">]</span><span class="op" id="2303312">.</span><span class="ident" id="2303313">Simplify</span><span class="op" id="2303321">(</span><span class="op" id="2303322">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303327">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303369">if</span>&nbsp;<span class="ident" id="2303372">re</span><span class="op" id="2303374">.</span><span class="ident" id="2303375">Max</span>&nbsp;<span class="op" id="2303379">==</span>&nbsp;<span class="op" id="2303382">-</span><span class="num" id="2303383">1</span>&nbsp;<span class="op" id="2303385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303390">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303423">if</span>&nbsp;<span class="ident" id="2303426">re</span><span class="op" id="2303428">.</span><span class="ident" id="2303429">Min</span>&nbsp;<span class="op" id="2303433">==</span>&nbsp;<span class="num" id="2303436">0</span>&nbsp;<span class="op" id="2303438">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303444">return</span>&nbsp;<span class="ident" id="2303451">simplify1</span><span class="op" id="2303460">(</span><span class="ident" id="2303461">OpStar</span><span class="op" id="2303467">,</span>&nbsp;<span class="ident" id="2303469">re</span><span class="op" id="2303471">.</span><span class="ident" id="2303472">Flags</span><span class="op" id="2303477">,</span>&nbsp;<span class="ident" id="2303479">sub</span><span class="op" id="2303482">,</span>&nbsp;<span class="ident" id="2303484">nil</span><span class="op" id="2303487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303498">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303531">if</span>&nbsp;<span class="ident" id="2303534">re</span><span class="op" id="2303536">.</span><span class="ident" id="2303537">Min</span>&nbsp;<span class="op" id="2303541">==</span>&nbsp;<span class="num" id="2303544">1</span>&nbsp;<span class="op" id="2303546">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303552">return</span>&nbsp;<span class="ident" id="2303559">simplify1</span><span class="op" id="2303568">(</span><span class="ident" id="2303569">OpPlus</span><span class="op" id="2303575">,</span>&nbsp;<span class="ident" id="2303577">re</span><span class="op" id="2303579">.</span><span class="ident" id="2303580">Flags</span><span class="op" id="2303585">,</span>&nbsp;<span class="ident" id="2303587">sub</span><span class="op" id="2303590">,</span>&nbsp;<span class="ident" id="2303592">nil</span><span class="op" id="2303595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303606">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303642">nre</span>&nbsp;<span class="op" id="2303646">:=</span>&nbsp;<span class="op" id="2303649">&amp;</span><span class="ident" id="2303650">Regexp</span><span class="op" id="2303656">{</span><span class="ident" id="2303657">Op</span><span class="op" id="2303659">:</span>&nbsp;<span class="ident" id="2303661">OpConcat</span><span class="op" id="2303669">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303674">nre</span><span class="op" id="2303677">.</span><span class="ident" id="2303678">Sub</span>&nbsp;<span class="op" id="2303682">=</span>&nbsp;<span class="ident" id="2303684">nre</span><span class="op" id="2303687">.</span><span class="ident" id="2303688">Sub0</span><span class="op" id="2303692">[</span><span class="op" id="2303693">:</span><span class="num" id="2303694">0</span><span class="op" id="2303695">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303700">for</span>&nbsp;<span class="ident" id="2303704">i</span>&nbsp;<span class="op" id="2303706">:=</span>&nbsp;<span class="num" id="2303709">0</span><span class="op" id="2303710">;</span>&nbsp;<span class="ident" id="2303712">i</span>&nbsp;<span class="op" id="2303714">&lt;</span>&nbsp;<span class="ident" id="2303716">re</span><span class="op" id="2303718">.</span><span class="ident" id="2303719">Min</span><span class="op" id="2303722">-</span><span class="num" id="2303723">1</span><span class="op" id="2303724">;</span>&nbsp;<span class="ident" id="2303726">i</span><span class="op" id="2303727">++</span>&nbsp;<span class="op" id="2303730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303736">nre</span><span class="op" id="2303739">.</span><span class="ident" id="2303740">Sub</span>&nbsp;<span class="op" id="2303744">=</span>&nbsp;<span class="builtinfunc" id="2303746">append</span><span class="op" id="2303752">(</span><span class="ident" id="2303753">nre</span><span class="op" id="2303756">.</span><span class="ident" id="2303757">Sub</span><span class="op" id="2303760">,</span>&nbsp;<span class="ident" id="2303762">sub</span><span class="op" id="2303765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303775">nre</span><span class="op" id="2303778">.</span><span class="ident" id="2303779">Sub</span>&nbsp;<span class="op" id="2303783">=</span>&nbsp;<span class="builtinfunc" id="2303785">append</span><span class="op" id="2303791">(</span><span class="ident" id="2303792">nre</span><span class="op" id="2303795">.</span><span class="ident" id="2303796">Sub</span><span class="op" id="2303799">,</span>&nbsp;<span class="ident" id="2303801">simplify1</span><span class="op" id="2303810">(</span><span class="ident" id="2303811">OpPlus</span><span class="op" id="2303817">,</span>&nbsp;<span class="ident" id="2303819">re</span><span class="op" id="2303821">.</span><span class="ident" id="2303822">Flags</span><span class="op" id="2303827">,</span>&nbsp;<span class="ident" id="2303829">sub</span><span class="op" id="2303832">,</span>&nbsp;<span class="ident" id="2303834">nil</span><span class="op" id="2303837">)</span><span class="op" id="2303838">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303843">return</span>&nbsp;<span class="ident" id="2303850">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303861">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303900">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303935">if</span>&nbsp;<span class="ident" id="2303938">re</span><span class="op" id="2303940">.</span><span class="ident" id="2303941">Min</span>&nbsp;<span class="op" id="2303945">==</span>&nbsp;<span class="num" id="2303948">1</span>&nbsp;<span class="op" id="2303950">&amp;&amp;</span>&nbsp;<span class="ident" id="2303953">re</span><span class="op" id="2303955">.</span><span class="ident" id="2303956">Max</span>&nbsp;<span class="op" id="2303960">==</span>&nbsp;<span class="num" id="2303963">1</span>&nbsp;<span class="op" id="2303965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303970">return</span>&nbsp;<span class="ident" id="2303977">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303988">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304053">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304119">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304157">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304188">var</span>&nbsp;<span class="ident" id="2304192">prefix</span>&nbsp;<span class="op" id="2304199">*</span><span class="ident" id="2304200">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304209">if</span>&nbsp;<span class="ident" id="2304212">re</span><span class="op" id="2304214">.</span><span class="ident" id="2304215">Min</span>&nbsp;<span class="op" id="2304219">&gt;</span>&nbsp;<span class="num" id="2304221">0</span>&nbsp;<span class="op" id="2304223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304228">prefix</span>&nbsp;<span class="op" id="2304235">=</span>&nbsp;<span class="op" id="2304237">&amp;</span><span class="ident" id="2304238">Regexp</span><span class="op" id="2304244">{</span><span class="ident" id="2304245">Op</span><span class="op" id="2304247">:</span>&nbsp;<span class="ident" id="2304249">OpConcat</span><span class="op" id="2304257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304262">prefix</span><span class="op" id="2304268">.</span><span class="ident" id="2304269">Sub</span>&nbsp;<span class="op" id="2304273">=</span>&nbsp;<span class="ident" id="2304275">prefix</span><span class="op" id="2304281">.</span><span class="ident" id="2304282">Sub0</span><span class="op" id="2304286">[</span><span class="op" id="2304287">:</span><span class="num" id="2304288">0</span><span class="op" id="2304289">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304294">for</span>&nbsp;<span class="ident" id="2304298">i</span>&nbsp;<span class="op" id="2304300">:=</span>&nbsp;<span class="num" id="2304303">0</span><span class="op" id="2304304">;</span>&nbsp;<span class="ident" id="2304306">i</span>&nbsp;<span class="op" id="2304308">&lt;</span>&nbsp;<span class="ident" id="2304310">re</span><span class="op" id="2304312">.</span><span class="ident" id="2304313">Min</span><span class="op" id="2304316">;</span>&nbsp;<span class="ident" id="2304318">i</span><span class="op" id="2304319">++</span>&nbsp;<span class="op" id="2304322">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304328">prefix</span><span class="op" id="2304334">.</span><span class="ident" id="2304335">Sub</span>&nbsp;<span class="op" id="2304339">=</span>&nbsp;<span class="builtinfunc" id="2304341">append</span><span class="op" id="2304347">(</span><span class="ident" id="2304348">prefix</span><span class="op" id="2304354">.</span><span class="ident" id="2304355">Sub</span><span class="op" id="2304358">,</span>&nbsp;<span class="ident" id="2304360">sub</span><span class="op" id="2304363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304377">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304420">if</span>&nbsp;<span class="ident" id="2304423">re</span><span class="op" id="2304425">.</span><span class="ident" id="2304426">Max</span>&nbsp;<span class="op" id="2304430">&gt;</span>&nbsp;<span class="ident" id="2304432">re</span><span class="op" id="2304434">.</span><span class="ident" id="2304435">Min</span>&nbsp;<span class="op" id="2304439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304444">suffix</span>&nbsp;<span class="op" id="2304451">:=</span>&nbsp;<span class="ident" id="2304454">simplify1</span><span class="op" id="2304463">(</span><span class="ident" id="2304464">OpQuest</span><span class="op" id="2304471">,</span>&nbsp;<span class="ident" id="2304473">re</span><span class="op" id="2304475">.</span><span class="ident" id="2304476">Flags</span><span class="op" id="2304481">,</span>&nbsp;<span class="ident" id="2304483">sub</span><span class="op" id="2304486">,</span>&nbsp;<span class="ident" id="2304488">nil</span><span class="op" id="2304491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304496">for</span>&nbsp;<span class="ident" id="2304500">i</span>&nbsp;<span class="op" id="2304502">:=</span>&nbsp;<span class="ident" id="2304505">re</span><span class="op" id="2304507">.</span><span class="ident" id="2304508">Min</span>&nbsp;<span class="op" id="2304512">+</span>&nbsp;<span class="num" id="2304514">1</span><span class="op" id="2304515">;</span>&nbsp;<span class="ident" id="2304517">i</span>&nbsp;<span class="op" id="2304519">&lt;</span>&nbsp;<span class="ident" id="2304521">re</span><span class="op" id="2304523">.</span><span class="ident" id="2304524">Max</span><span class="op" id="2304527">;</span>&nbsp;<span class="ident" id="2304529">i</span><span class="op" id="2304530">++</span>&nbsp;<span class="op" id="2304533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304539">nre2</span>&nbsp;<span class="op" id="2304544">:=</span>&nbsp;<span class="op" id="2304547">&amp;</span><span class="ident" id="2304548">Regexp</span><span class="op" id="2304554">{</span><span class="ident" id="2304555">Op</span><span class="op" id="2304557">:</span>&nbsp;<span class="ident" id="2304559">OpConcat</span><span class="op" id="2304567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304573">nre2</span><span class="op" id="2304577">.</span><span class="ident" id="2304578">Sub</span>&nbsp;<span class="op" id="2304582">=</span>&nbsp;<span class="builtinfunc" id="2304584">append</span><span class="op" id="2304590">(</span><span class="ident" id="2304591">nre2</span><span class="op" id="2304595">.</span><span class="ident" id="2304596">Sub0</span><span class="op" id="2304600">[</span><span class="op" id="2304601">:</span><span class="num" id="2304602">0</span><span class="op" id="2304603">]</span><span class="op" id="2304604">,</span>&nbsp;<span class="ident" id="2304606">sub</span><span class="op" id="2304609">,</span>&nbsp;<span class="ident" id="2304611">suffix</span><span class="op" id="2304617">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304623">suffix</span>&nbsp;<span class="op" id="2304630">=</span>&nbsp;<span class="ident" id="2304632">simplify1</span><span class="op" id="2304641">(</span><span class="ident" id="2304642">OpQuest</span><span class="op" id="2304649">,</span>&nbsp;<span class="ident" id="2304651">re</span><span class="op" id="2304653">.</span><span class="ident" id="2304654">Flags</span><span class="op" id="2304659">,</span>&nbsp;<span class="ident" id="2304661">nre2</span><span class="op" id="2304665">,</span>&nbsp;<span class="ident" id="2304667">nil</span><span class="op" id="2304670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304680">if</span>&nbsp;<span class="ident" id="2304683">prefix</span>&nbsp;<span class="op" id="2304690">==</span>&nbsp;<span class="ident" id="2304693">nil</span>&nbsp;<span class="op" id="2304697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304703">return</span>&nbsp;<span class="ident" id="2304710">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304720">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304725">prefix</span><span class="op" id="2304731">.</span><span class="ident" id="2304732">Sub</span>&nbsp;<span class="op" id="2304736">=</span>&nbsp;<span class="builtinfunc" id="2304738">append</span><span class="op" id="2304744">(</span><span class="ident" id="2304745">prefix</span><span class="op" id="2304751">.</span><span class="ident" id="2304752">Sub</span><span class="op" id="2304755">,</span>&nbsp;<span class="ident" id="2304757">suffix</span><span class="op" id="2304763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304771">if</span>&nbsp;<span class="ident" id="2304774">prefix</span>&nbsp;<span class="op" id="2304781">!=</span>&nbsp;<span class="ident" id="2304784">nil</span>&nbsp;<span class="op" id="2304788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304793">return</span>&nbsp;<span class="ident" id="2304800">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304809">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304814">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304873">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304906">return</span>&nbsp;<span class="op" id="2304913">&amp;</span><span class="ident" id="2304914">Regexp</span><span class="op" id="2304920">{</span><span class="ident" id="2304921">Op</span><span class="op" id="2304923">:</span>&nbsp;<span class="ident" id="2304925">OpNoMatch</span><span class="op" id="2304934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304937">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304941">return</span>&nbsp;<span class="ident" id="2304948">re</span><br>
<span class="lineno"></span><span class="op" id="2304951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2304954">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="2305009">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="2305073">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2305090">//</span><br>
<span class="lineno"></span><span class="comment" id="2305093">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="2305137">//</span><br>
<span class="lineno">125</span><span class="comment" id="2305140">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2305196">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="2305255">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="2305317">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2305340">//</span><br>
<span class="lineno">130</span><span class="comment" id="2305343">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="2305411">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="2305469">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="2305532">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="2305556">func</span>&nbsp;<span class="ident" id="2305561">simplify1</span><span class="op" id="2305570">(</span><span class="ident" id="2305571">op</span>&nbsp;<span class="ident" id="2305574">Op</span><span class="op" id="2305576">,</span>&nbsp;<span class="ident" id="2305578">flags</span>&nbsp;<span class="ident" id="2305584">Flags</span><span class="op" id="2305589">,</span>&nbsp;<span class="ident" id="2305591">sub</span><span class="op" id="2305594">,</span>&nbsp;<span class="ident" id="2305596">re</span>&nbsp;<span class="op" id="2305599">*</span><span class="ident" id="2305600">Regexp</span><span class="op" id="2305606">)</span>&nbsp;<span class="op" id="2305608">*</span><span class="ident" id="2305609">Regexp</span>&nbsp;<span class="op" id="2305616">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305619">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305672">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305719">if</span>&nbsp;<span class="ident" id="2305722">sub</span><span class="op" id="2305725">.</span><span class="ident" id="2305726">Op</span>&nbsp;<span class="op" id="2305729">==</span>&nbsp;<span class="ident" id="2305732">OpEmptyMatch</span>&nbsp;<span class="op" id="2305745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305749">return</span>&nbsp;<span class="ident" id="2305756">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305761">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305764">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305817">if</span>&nbsp;<span class="ident" id="2305820">op</span>&nbsp;<span class="op" id="2305823">==</span>&nbsp;<span class="ident" id="2305826">sub</span><span class="op" id="2305829">.</span><span class="ident" id="2305830">Op</span>&nbsp;<span class="op" id="2305833">&amp;&amp;</span>&nbsp;<span class="ident" id="2305836">flags</span><span class="op" id="2305841">&amp;</span><span class="ident" id="2305842">NonGreedy</span>&nbsp;<span class="op" id="2305852">==</span>&nbsp;<span class="ident" id="2305855">sub</span><span class="op" id="2305858">.</span><span class="ident" id="2305859">Flags</span><span class="op" id="2305864">&amp;</span><span class="ident" id="2305865">NonGreedy</span>&nbsp;<span class="op" id="2305875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305879">return</span>&nbsp;<span class="ident" id="2305886">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305894">if</span>&nbsp;<span class="ident" id="2305897">re</span>&nbsp;<span class="op" id="2305900">!=</span>&nbsp;<span class="ident" id="2305903">nil</span>&nbsp;<span class="op" id="2305907">&amp;&amp;</span>&nbsp;<span class="ident" id="2305910">re</span><span class="op" id="2305912">.</span><span class="ident" id="2305913">Op</span>&nbsp;<span class="op" id="2305916">==</span>&nbsp;<span class="ident" id="2305919">op</span>&nbsp;<span class="op" id="2305922">&amp;&amp;</span>&nbsp;<span class="ident" id="2305925">re</span><span class="op" id="2305927">.</span><span class="ident" id="2305928">Flags</span><span class="op" id="2305933">&amp;</span><span class="ident" id="2305934">NonGreedy</span>&nbsp;<span class="op" id="2305944">==</span>&nbsp;<span class="ident" id="2305947">flags</span><span class="op" id="2305952">&amp;</span><span class="ident" id="2305953">NonGreedy</span>&nbsp;<span class="op" id="2305963">&amp;&amp;</span>&nbsp;<span class="ident" id="2305966">sub</span>&nbsp;<span class="op" id="2305970">==</span>&nbsp;<span class="ident" id="2305973">re</span><span class="op" id="2305975">.</span><span class="ident" id="2305976">Sub</span><span class="op" id="2305979">[</span><span class="num" id="2305980">0</span><span class="op" id="2305981">]</span>&nbsp;<span class="op" id="2305983">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305987">return</span>&nbsp;<span class="ident" id="2305994">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306002">re</span>&nbsp;<span class="op" id="2306005">=</span>&nbsp;<span class="op" id="2306007">&amp;</span><span class="ident" id="2306008">Regexp</span><span class="op" id="2306014">{</span><span class="ident" id="2306015">Op</span><span class="op" id="2306017">:</span>&nbsp;<span class="ident" id="2306019">op</span><span class="op" id="2306021">,</span>&nbsp;<span class="ident" id="2306023">Flags</span><span class="op" id="2306028">:</span>&nbsp;<span class="ident" id="2306030">flags</span><span class="op" id="2306035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306038">re</span><span class="op" id="2306040">.</span><span class="ident" id="2306041">Sub</span>&nbsp;<span class="op" id="2306045">=</span>&nbsp;<span class="builtinfunc" id="2306047">append</span><span class="op" id="2306053">(</span><span class="ident" id="2306054">re</span><span class="op" id="2306056">.</span><span class="ident" id="2306057">Sub0</span><span class="op" id="2306061">[</span><span class="op" id="2306062">:</span><span class="num" id="2306063">0</span><span class="op" id="2306064">]</span><span class="op" id="2306065">,</span>&nbsp;<span class="ident" id="2306067">sub</span><span class="op" id="2306070">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306073">return</span>&nbsp;<span class="ident" id="2306080">re</span><br>
<span class="lineno"></span><span class="op" id="2306083">}</span>
</div>
</body>
</html>
