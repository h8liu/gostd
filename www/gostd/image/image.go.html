<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4933587">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4933642">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4933696">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4933747">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="4933802">//</span><br>
<span class="lineno"></span><span class="comment" id="4933805">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="4933883">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="4933928">//</span><br>
<span class="lineno">10</span><span class="comment" id="4933931">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="4934009">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="4934088">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="4934164">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4934235">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="4934312">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4934384">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4934408">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4934487">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="4934519">//</span><br>
<span class="lineno">20</span><span class="comment" id="4934522">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="4934570">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="4934623">package</span>&nbsp;<span class="ident" id="4934631">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4934638">import</span>&nbsp;<span class="op" id="4934645">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4934648">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="4934662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4934665">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="4934720">type</span>&nbsp;<span class="ident" id="4934725">Config</span>&nbsp;<span class="keyword" id="4934732">struct</span>&nbsp;<span class="op" id="4934739">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4934742">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934756">color</span><span class="op" id="4934761">.</span><span class="ident" id="4934762">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4934769">Width</span><span class="op" id="4934774">,</span>&nbsp;<span class="ident" id="4934776">Height</span>&nbsp;<span class="builtintype" id="4934783">int</span><br>
<span class="lineno"></span><span class="op" id="4934787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4934790">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="4934869">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="4934879">type</span>&nbsp;<span class="ident" id="4934884">Image</span>&nbsp;<span class="keyword" id="4934890">interface</span>&nbsp;<span class="op" id="4934900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4934903">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4934951">ColorModel</span><span class="op" id="4934961">(</span><span class="op" id="4934962">)</span>&nbsp;<span class="ident" id="4934964">color</span><span class="op" id="4934969">.</span><span class="ident" id="4934970">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4934977">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935047">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4935107">Bounds</span><span class="op" id="4935113">(</span><span class="op" id="4935114">)</span>&nbsp;<span class="ident" id="4935116">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935127">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935176">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935257">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4935329">At</span><span class="op" id="4935331">(</span><span class="ident" id="4935332">x</span><span class="op" id="4935333">,</span>&nbsp;<span class="ident" id="4935335">y</span>&nbsp;<span class="builtintype" id="4935337">int</span><span class="op" id="4935340">)</span>&nbsp;<span class="ident" id="4935342">color</span><span class="op" id="4935347">.</span><span class="ident" id="4935348">Color</span><br>
<span class="lineno"></span><span class="op" id="4935354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4935357">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="4935432">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="4935510">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4935585">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4935661">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="4935675">type</span>&nbsp;<span class="ident" id="4935680">PalettedImage</span>&nbsp;<span class="keyword" id="4935694">interface</span>&nbsp;<span class="op" id="4935704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935707">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4935774">ColorIndexAt</span><span class="op" id="4935786">(</span><span class="ident" id="4935787">x</span><span class="op" id="4935788">,</span>&nbsp;<span class="ident" id="4935790">y</span>&nbsp;<span class="builtintype" id="4935792">int</span><span class="op" id="4935795">)</span>&nbsp;<span class="builtintype" id="4935797">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4935804">Image</span><br>
<span class="lineno"></span><span class="op" id="4935810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4935813">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="4935886">type</span>&nbsp;<span class="ident" id="4935891">RGBA</span>&nbsp;<span class="keyword" id="4935896">struct</span>&nbsp;<span class="op" id="4935903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935906">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4935974">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936042">Pix</span>&nbsp;<span class="op" id="4936046">[</span><span class="op" id="4936047">]</span><span class="builtintype" id="4936048">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4936055">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936131">Stride</span>&nbsp;<span class="builtintype" id="4936138">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4936143">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936175">Rect</span>&nbsp;<span class="ident" id="4936180">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4936190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4936193">func</span>&nbsp;<span class="op" id="4936198">(</span><span class="ident" id="4936199">p</span>&nbsp;<span class="op" id="4936201">*</span><span class="ident" id="4936202">RGBA</span><span class="op" id="4936206">)</span>&nbsp;<span class="ident" id="4936208">ColorModel</span><span class="op" id="4936218">(</span><span class="op" id="4936219">)</span>&nbsp;<span class="ident" id="4936221">color</span><span class="op" id="4936226">.</span><span class="ident" id="4936227">Model</span>&nbsp;<span class="op" id="4936233">{</span>&nbsp;<span class="keyword" id="4936235">return</span>&nbsp;<span class="ident" id="4936242">color</span><span class="op" id="4936247">.</span><span class="ident" id="4936248">RGBAModel</span>&nbsp;<span class="op" id="4936258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4936261">func</span>&nbsp;<span class="op" id="4936266">(</span><span class="ident" id="4936267">p</span>&nbsp;<span class="op" id="4936269">*</span><span class="ident" id="4936270">RGBA</span><span class="op" id="4936274">)</span>&nbsp;<span class="ident" id="4936276">Bounds</span><span class="op" id="4936282">(</span><span class="op" id="4936283">)</span>&nbsp;<span class="ident" id="4936285">Rectangle</span>&nbsp;<span class="op" id="4936295">{</span>&nbsp;<span class="keyword" id="4936297">return</span>&nbsp;<span class="ident" id="4936304">p</span><span class="op" id="4936305">.</span><span class="ident" id="4936306">Rect</span>&nbsp;<span class="op" id="4936311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4936314">func</span>&nbsp;<span class="op" id="4936319">(</span><span class="ident" id="4936320">p</span>&nbsp;<span class="op" id="4936322">*</span><span class="ident" id="4936323">RGBA</span><span class="op" id="4936327">)</span>&nbsp;<span class="ident" id="4936329">At</span><span class="op" id="4936331">(</span><span class="ident" id="4936332">x</span><span class="op" id="4936333">,</span>&nbsp;<span class="ident" id="4936335">y</span>&nbsp;<span class="builtintype" id="4936337">int</span><span class="op" id="4936340">)</span>&nbsp;<span class="ident" id="4936342">color</span><span class="op" id="4936347">.</span><span class="ident" id="4936348">Color</span>&nbsp;<span class="op" id="4936354">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936357">return</span>&nbsp;<span class="ident" id="4936364">p</span><span class="op" id="4936365">.</span><span class="ident" id="4936366">RGBAAt</span><span class="op" id="4936372">(</span><span class="ident" id="4936373">x</span><span class="op" id="4936374">,</span>&nbsp;<span class="ident" id="4936376">y</span><span class="op" id="4936377">)</span><br>
<span class="lineno"></span><span class="op" id="4936379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4936382">func</span>&nbsp;<span class="op" id="4936387">(</span><span class="ident" id="4936388">p</span>&nbsp;<span class="op" id="4936390">*</span><span class="ident" id="4936391">RGBA</span><span class="op" id="4936395">)</span>&nbsp;<span class="ident" id="4936397">RGBAAt</span><span class="op" id="4936403">(</span><span class="ident" id="4936404">x</span><span class="op" id="4936405">,</span>&nbsp;<span class="ident" id="4936407">y</span>&nbsp;<span class="builtintype" id="4936409">int</span><span class="op" id="4936412">)</span>&nbsp;<span class="ident" id="4936414">color</span><span class="op" id="4936419">.</span><span class="ident" id="4936420">RGBA</span>&nbsp;<span class="op" id="4936425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936428">if</span>&nbsp;<span class="op" id="4936431">!</span><span class="op" id="4936432">(</span><span class="ident" id="4936433">Point</span><span class="op" id="4936438">{</span><span class="ident" id="4936439">x</span><span class="op" id="4936440">,</span>&nbsp;<span class="ident" id="4936442">y</span><span class="op" id="4936443">}</span><span class="op" id="4936444">.</span><span class="ident" id="4936445">In</span><span class="op" id="4936447">(</span><span class="ident" id="4936448">p</span><span class="op" id="4936449">.</span><span class="ident" id="4936450">Rect</span><span class="op" id="4936454">)</span><span class="op" id="4936455">)</span>&nbsp;<span class="op" id="4936457">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936461">return</span>&nbsp;<span class="ident" id="4936468">color</span><span class="op" id="4936473">.</span><span class="ident" id="4936474">RGBA</span><span class="op" id="4936478">{</span><span class="op" id="4936479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4936482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936485">i</span>&nbsp;<span class="op" id="4936487">:=</span>&nbsp;<span class="ident" id="4936490">p</span><span class="op" id="4936491">.</span><span class="ident" id="4936492">PixOffset</span><span class="op" id="4936501">(</span><span class="ident" id="4936502">x</span><span class="op" id="4936503">,</span>&nbsp;<span class="ident" id="4936505">y</span><span class="op" id="4936506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936509">return</span>&nbsp;<span class="ident" id="4936516">color</span><span class="op" id="4936521">.</span><span class="ident" id="4936522">RGBA</span><span class="op" id="4936526">{</span><span class="ident" id="4936527">p</span><span class="op" id="4936528">.</span><span class="ident" id="4936529">Pix</span><span class="op" id="4936532">[</span><span class="ident" id="4936533">i</span><span class="op" id="4936534">+</span><span class="num" id="4936535">0</span><span class="op" id="4936536">]</span><span class="op" id="4936537">,</span>&nbsp;<span class="ident" id="4936539">p</span><span class="op" id="4936540">.</span><span class="ident" id="4936541">Pix</span><span class="op" id="4936544">[</span><span class="ident" id="4936545">i</span><span class="op" id="4936546">+</span><span class="num" id="4936547">1</span><span class="op" id="4936548">]</span><span class="op" id="4936549">,</span>&nbsp;<span class="ident" id="4936551">p</span><span class="op" id="4936552">.</span><span class="ident" id="4936553">Pix</span><span class="op" id="4936556">[</span><span class="ident" id="4936557">i</span><span class="op" id="4936558">+</span><span class="num" id="4936559">2</span><span class="op" id="4936560">]</span><span class="op" id="4936561">,</span>&nbsp;<span class="ident" id="4936563">p</span><span class="op" id="4936564">.</span><span class="ident" id="4936565">Pix</span><span class="op" id="4936568">[</span><span class="ident" id="4936569">i</span><span class="op" id="4936570">+</span><span class="num" id="4936571">3</span><span class="op" id="4936572">]</span><span class="op" id="4936573">}</span><br>
<span class="lineno"></span><span class="op" id="4936575">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4936578">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4936657">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4936681">func</span>&nbsp;<span class="op" id="4936686">(</span><span class="ident" id="4936687">p</span>&nbsp;<span class="op" id="4936689">*</span><span class="ident" id="4936690">RGBA</span><span class="op" id="4936694">)</span>&nbsp;<span class="ident" id="4936696">PixOffset</span><span class="op" id="4936705">(</span><span class="ident" id="4936706">x</span><span class="op" id="4936707">,</span>&nbsp;<span class="ident" id="4936709">y</span>&nbsp;<span class="builtintype" id="4936711">int</span><span class="op" id="4936714">)</span>&nbsp;<span class="builtintype" id="4936716">int</span>&nbsp;<span class="op" id="4936720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936723">return</span>&nbsp;<span class="op" id="4936730">(</span><span class="ident" id="4936731">y</span><span class="op" id="4936732">-</span><span class="ident" id="4936733">p</span><span class="op" id="4936734">.</span><span class="ident" id="4936735">Rect</span><span class="op" id="4936739">.</span><span class="ident" id="4936740">Min</span><span class="op" id="4936743">.</span><span class="ident" id="4936744">Y</span><span class="op" id="4936745">)</span><span class="op" id="4936746">*</span><span class="ident" id="4936747">p</span><span class="op" id="4936748">.</span><span class="ident" id="4936749">Stride</span>&nbsp;<span class="op" id="4936756">+</span>&nbsp;<span class="op" id="4936758">(</span><span class="ident" id="4936759">x</span><span class="op" id="4936760">-</span><span class="ident" id="4936761">p</span><span class="op" id="4936762">.</span><span class="ident" id="4936763">Rect</span><span class="op" id="4936767">.</span><span class="ident" id="4936768">Min</span><span class="op" id="4936771">.</span><span class="ident" id="4936772">X</span><span class="op" id="4936773">)</span><span class="op" id="4936774">*</span><span class="num" id="4936775">4</span><br>
<span class="lineno">90</span><span class="op" id="4936777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4936780">func</span>&nbsp;<span class="op" id="4936785">(</span><span class="ident" id="4936786">p</span>&nbsp;<span class="op" id="4936788">*</span><span class="ident" id="4936789">RGBA</span><span class="op" id="4936793">)</span>&nbsp;<span class="ident" id="4936795">Set</span><span class="op" id="4936798">(</span><span class="ident" id="4936799">x</span><span class="op" id="4936800">,</span>&nbsp;<span class="ident" id="4936802">y</span>&nbsp;<span class="builtintype" id="4936804">int</span><span class="op" id="4936807">,</span>&nbsp;<span class="ident" id="4936809">c</span>&nbsp;<span class="ident" id="4936811">color</span><span class="op" id="4936816">.</span><span class="ident" id="4936817">Color</span><span class="op" id="4936822">)</span>&nbsp;<span class="op" id="4936824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936827">if</span>&nbsp;<span class="op" id="4936830">!</span><span class="op" id="4936831">(</span><span class="ident" id="4936832">Point</span><span class="op" id="4936837">{</span><span class="ident" id="4936838">x</span><span class="op" id="4936839">,</span>&nbsp;<span class="ident" id="4936841">y</span><span class="op" id="4936842">}</span><span class="op" id="4936843">.</span><span class="ident" id="4936844">In</span><span class="op" id="4936846">(</span><span class="ident" id="4936847">p</span><span class="op" id="4936848">.</span><span class="ident" id="4936849">Rect</span><span class="op" id="4936853">)</span><span class="op" id="4936854">)</span>&nbsp;<span class="op" id="4936856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4936860">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4936868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936871">i</span>&nbsp;<span class="op" id="4936873">:=</span>&nbsp;<span class="ident" id="4936876">p</span><span class="op" id="4936877">.</span><span class="ident" id="4936878">PixOffset</span><span class="op" id="4936887">(</span><span class="ident" id="4936888">x</span><span class="op" id="4936889">,</span>&nbsp;<span class="ident" id="4936891">y</span><span class="op" id="4936892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936895">c1</span>&nbsp;<span class="op" id="4936898">:=</span>&nbsp;<span class="ident" id="4936901">color</span><span class="op" id="4936906">.</span><span class="ident" id="4936907">RGBAModel</span><span class="op" id="4936916">.</span><span class="ident" id="4936917">Convert</span><span class="op" id="4936924">(</span><span class="ident" id="4936925">c</span><span class="op" id="4936926">)</span><span class="op" id="4936927">.</span><span class="op" id="4936928">(</span><span class="ident" id="4936929">color</span><span class="op" id="4936934">.</span><span class="ident" id="4936935">RGBA</span><span class="op" id="4936939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936942">p</span><span class="op" id="4936943">.</span><span class="ident" id="4936944">Pix</span><span class="op" id="4936947">[</span><span class="ident" id="4936948">i</span><span class="op" id="4936949">+</span><span class="num" id="4936950">0</span><span class="op" id="4936951">]</span>&nbsp;<span class="op" id="4936953">=</span>&nbsp;<span class="ident" id="4936955">c1</span><span class="op" id="4936957">.</span><span class="ident" id="4936958">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936961">p</span><span class="op" id="4936962">.</span><span class="ident" id="4936963">Pix</span><span class="op" id="4936966">[</span><span class="ident" id="4936967">i</span><span class="op" id="4936968">+</span><span class="num" id="4936969">1</span><span class="op" id="4936970">]</span>&nbsp;<span class="op" id="4936972">=</span>&nbsp;<span class="ident" id="4936974">c1</span><span class="op" id="4936976">.</span><span class="ident" id="4936977">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936980">p</span><span class="op" id="4936981">.</span><span class="ident" id="4936982">Pix</span><span class="op" id="4936985">[</span><span class="ident" id="4936986">i</span><span class="op" id="4936987">+</span><span class="num" id="4936988">2</span><span class="op" id="4936989">]</span>&nbsp;<span class="op" id="4936991">=</span>&nbsp;<span class="ident" id="4936993">c1</span><span class="op" id="4936995">.</span><span class="ident" id="4936996">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4936999">p</span><span class="op" id="4937000">.</span><span class="ident" id="4937001">Pix</span><span class="op" id="4937004">[</span><span class="ident" id="4937005">i</span><span class="op" id="4937006">+</span><span class="num" id="4937007">3</span><span class="op" id="4937008">]</span>&nbsp;<span class="op" id="4937010">=</span>&nbsp;<span class="ident" id="4937012">c1</span><span class="op" id="4937014">.</span><span class="ident" id="4937015">A</span><br>
<span class="lineno"></span><span class="op" id="4937017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4937020">func</span>&nbsp;<span class="op" id="4937025">(</span><span class="ident" id="4937026">p</span>&nbsp;<span class="op" id="4937028">*</span><span class="ident" id="4937029">RGBA</span><span class="op" id="4937033">)</span>&nbsp;<span class="ident" id="4937035">SetRGBA</span><span class="op" id="4937042">(</span><span class="ident" id="4937043">x</span><span class="op" id="4937044">,</span>&nbsp;<span class="ident" id="4937046">y</span>&nbsp;<span class="builtintype" id="4937048">int</span><span class="op" id="4937051">,</span>&nbsp;<span class="ident" id="4937053">c</span>&nbsp;<span class="ident" id="4937055">color</span><span class="op" id="4937060">.</span><span class="ident" id="4937061">RGBA</span><span class="op" id="4937065">)</span>&nbsp;<span class="op" id="4937067">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937070">if</span>&nbsp;<span class="op" id="4937073">!</span><span class="op" id="4937074">(</span><span class="ident" id="4937075">Point</span><span class="op" id="4937080">{</span><span class="ident" id="4937081">x</span><span class="op" id="4937082">,</span>&nbsp;<span class="ident" id="4937084">y</span><span class="op" id="4937085">}</span><span class="op" id="4937086">.</span><span class="ident" id="4937087">In</span><span class="op" id="4937089">(</span><span class="ident" id="4937090">p</span><span class="op" id="4937091">.</span><span class="ident" id="4937092">Rect</span><span class="op" id="4937096">)</span><span class="op" id="4937097">)</span>&nbsp;<span class="op" id="4937099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937103">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4937111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937114">i</span>&nbsp;<span class="op" id="4937116">:=</span>&nbsp;<span class="ident" id="4937119">p</span><span class="op" id="4937120">.</span><span class="ident" id="4937121">PixOffset</span><span class="op" id="4937130">(</span><span class="ident" id="4937131">x</span><span class="op" id="4937132">,</span>&nbsp;<span class="ident" id="4937134">y</span><span class="op" id="4937135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937138">p</span><span class="op" id="4937139">.</span><span class="ident" id="4937140">Pix</span><span class="op" id="4937143">[</span><span class="ident" id="4937144">i</span><span class="op" id="4937145">+</span><span class="num" id="4937146">0</span><span class="op" id="4937147">]</span>&nbsp;<span class="op" id="4937149">=</span>&nbsp;<span class="ident" id="4937151">c</span><span class="op" id="4937152">.</span><span class="ident" id="4937153">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937156">p</span><span class="op" id="4937157">.</span><span class="ident" id="4937158">Pix</span><span class="op" id="4937161">[</span><span class="ident" id="4937162">i</span><span class="op" id="4937163">+</span><span class="num" id="4937164">1</span><span class="op" id="4937165">]</span>&nbsp;<span class="op" id="4937167">=</span>&nbsp;<span class="ident" id="4937169">c</span><span class="op" id="4937170">.</span><span class="ident" id="4937171">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937174">p</span><span class="op" id="4937175">.</span><span class="ident" id="4937176">Pix</span><span class="op" id="4937179">[</span><span class="ident" id="4937180">i</span><span class="op" id="4937181">+</span><span class="num" id="4937182">2</span><span class="op" id="4937183">]</span>&nbsp;<span class="op" id="4937185">=</span>&nbsp;<span class="ident" id="4937187">c</span><span class="op" id="4937188">.</span><span class="ident" id="4937189">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937192">p</span><span class="op" id="4937193">.</span><span class="ident" id="4937194">Pix</span><span class="op" id="4937197">[</span><span class="ident" id="4937198">i</span><span class="op" id="4937199">+</span><span class="num" id="4937200">3</span><span class="op" id="4937201">]</span>&nbsp;<span class="op" id="4937203">=</span>&nbsp;<span class="ident" id="4937205">c</span><span class="op" id="4937206">.</span><span class="ident" id="4937207">A</span><br>
<span class="lineno"></span><span class="op" id="4937209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4937212">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4937289">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4937361">func</span>&nbsp;<span class="op" id="4937366">(</span><span class="ident" id="4937367">p</span>&nbsp;<span class="op" id="4937369">*</span><span class="ident" id="4937370">RGBA</span><span class="op" id="4937374">)</span>&nbsp;<span class="ident" id="4937376">SubImage</span><span class="op" id="4937384">(</span><span class="ident" id="4937385">r</span>&nbsp;<span class="ident" id="4937387">Rectangle</span><span class="op" id="4937396">)</span>&nbsp;<span class="ident" id="4937398">Image</span>&nbsp;<span class="op" id="4937404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937407">r</span>&nbsp;<span class="op" id="4937409">=</span>&nbsp;<span class="ident" id="4937411">r</span><span class="op" id="4937412">.</span><span class="ident" id="4937413">Intersect</span><span class="op" id="4937422">(</span><span class="ident" id="4937423">p</span><span class="op" id="4937424">.</span><span class="ident" id="4937425">Rect</span><span class="op" id="4937429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4937432">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4937513">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4937595">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937645">if</span>&nbsp;<span class="ident" id="4937648">r</span><span class="op" id="4937649">.</span><span class="ident" id="4937650">Empty</span><span class="op" id="4937655">(</span><span class="op" id="4937656">)</span>&nbsp;<span class="op" id="4937658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937662">return</span>&nbsp;<span class="op" id="4937669">&amp;</span><span class="ident" id="4937670">RGBA</span><span class="op" id="4937674">{</span><span class="op" id="4937675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4937678">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937681">i</span>&nbsp;<span class="op" id="4937683">:=</span>&nbsp;<span class="ident" id="4937686">p</span><span class="op" id="4937687">.</span><span class="ident" id="4937688">PixOffset</span><span class="op" id="4937697">(</span><span class="ident" id="4937698">r</span><span class="op" id="4937699">.</span><span class="ident" id="4937700">Min</span><span class="op" id="4937703">.</span><span class="ident" id="4937704">X</span><span class="op" id="4937705">,</span>&nbsp;<span class="ident" id="4937707">r</span><span class="op" id="4937708">.</span><span class="ident" id="4937709">Min</span><span class="op" id="4937712">.</span><span class="ident" id="4937713">Y</span><span class="op" id="4937714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937717">return</span>&nbsp;<span class="op" id="4937724">&amp;</span><span class="ident" id="4937725">RGBA</span><span class="op" id="4937729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937733">Pix</span><span class="op" id="4937736">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937741">p</span><span class="op" id="4937742">.</span><span class="ident" id="4937743">Pix</span><span class="op" id="4937746">[</span><span class="ident" id="4937747">i</span><span class="op" id="4937748">:</span><span class="op" id="4937749">]</span><span class="op" id="4937750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937754">Stride</span><span class="op" id="4937760">:</span>&nbsp;<span class="ident" id="4937762">p</span><span class="op" id="4937763">.</span><span class="ident" id="4937764">Stride</span><span class="op" id="4937770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937774">Rect</span><span class="op" id="4937778">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4937782">r</span><span class="op" id="4937783">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4937786">}</span><br>
<span class="lineno"></span><span class="op" id="4937788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4937791">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4937864">func</span>&nbsp;<span class="op" id="4937869">(</span><span class="ident" id="4937870">p</span>&nbsp;<span class="op" id="4937872">*</span><span class="ident" id="4937873">RGBA</span><span class="op" id="4937877">)</span>&nbsp;<span class="ident" id="4937879">Opaque</span><span class="op" id="4937885">(</span><span class="op" id="4937886">)</span>&nbsp;<span class="builtintype" id="4937888">bool</span>&nbsp;<span class="op" id="4937893">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937896">if</span>&nbsp;<span class="ident" id="4937899">p</span><span class="op" id="4937900">.</span><span class="ident" id="4937901">Rect</span><span class="op" id="4937905">.</span><span class="ident" id="4937906">Empty</span><span class="op" id="4937911">(</span><span class="op" id="4937912">)</span>&nbsp;<span class="op" id="4937914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937918">return</span>&nbsp;<span class="builtintype" id="4937925">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4937931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4937934">i0</span><span class="op" id="4937936">,</span>&nbsp;<span class="ident" id="4937938">i1</span>&nbsp;<span class="op" id="4937941">:=</span>&nbsp;<span class="num" id="4937944">3</span><span class="op" id="4937945">,</span>&nbsp;<span class="ident" id="4937947">p</span><span class="op" id="4937948">.</span><span class="ident" id="4937949">Rect</span><span class="op" id="4937953">.</span><span class="ident" id="4937954">Dx</span><span class="op" id="4937956">(</span><span class="op" id="4937957">)</span><span class="op" id="4937958">*</span><span class="num" id="4937959">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4937962">for</span>&nbsp;<span class="ident" id="4937966">y</span>&nbsp;<span class="op" id="4937968">:=</span>&nbsp;<span class="ident" id="4937971">p</span><span class="op" id="4937972">.</span><span class="ident" id="4937973">Rect</span><span class="op" id="4937977">.</span><span class="ident" id="4937978">Min</span><span class="op" id="4937981">.</span><span class="ident" id="4937982">Y</span><span class="op" id="4937983">;</span>&nbsp;<span class="ident" id="4937985">y</span>&nbsp;<span class="op" id="4937987">&lt;</span>&nbsp;<span class="ident" id="4937989">p</span><span class="op" id="4937990">.</span><span class="ident" id="4937991">Rect</span><span class="op" id="4937995">.</span><span class="ident" id="4937996">Max</span><span class="op" id="4937999">.</span><span class="ident" id="4938000">Y</span><span class="op" id="4938001">;</span>&nbsp;<span class="ident" id="4938003">y</span><span class="op" id="4938004">++</span>&nbsp;<span class="op" id="4938007">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938011">for</span>&nbsp;<span class="ident" id="4938015">i</span>&nbsp;<span class="op" id="4938017">:=</span>&nbsp;<span class="ident" id="4938020">i0</span><span class="op" id="4938022">;</span>&nbsp;<span class="ident" id="4938024">i</span>&nbsp;<span class="op" id="4938026">&lt;</span>&nbsp;<span class="ident" id="4938028">i1</span><span class="op" id="4938030">;</span>&nbsp;<span class="ident" id="4938032">i</span>&nbsp;<span class="op" id="4938034">+=</span>&nbsp;<span class="num" id="4938037">4</span>&nbsp;<span class="op" id="4938039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938044">if</span>&nbsp;<span class="ident" id="4938047">p</span><span class="op" id="4938048">.</span><span class="ident" id="4938049">Pix</span><span class="op" id="4938052">[</span><span class="ident" id="4938053">i</span><span class="op" id="4938054">]</span>&nbsp;<span class="op" id="4938056">!=</span>&nbsp;<span class="num" id="4938059">0xff</span>&nbsp;<span class="op" id="4938064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938070">return</span>&nbsp;<span class="builtintype" id="4938077">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4938086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4938090">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938094">i0</span>&nbsp;<span class="op" id="4938097">+=</span>&nbsp;<span class="ident" id="4938100">p</span><span class="op" id="4938101">.</span><span class="ident" id="4938102">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938111">i1</span>&nbsp;<span class="op" id="4938114">+=</span>&nbsp;<span class="ident" id="4938117">p</span><span class="op" id="4938118">.</span><span class="ident" id="4938119">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4938127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938130">return</span>&nbsp;<span class="builtintype" id="4938137">true</span><br>
<span class="lineno"></span><span class="op" id="4938142">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4938145">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4938198">func</span>&nbsp;<span class="ident" id="4938203">NewRGBA</span><span class="op" id="4938210">(</span><span class="ident" id="4938211">r</span>&nbsp;<span class="ident" id="4938213">Rectangle</span><span class="op" id="4938222">)</span>&nbsp;<span class="op" id="4938224">*</span><span class="ident" id="4938225">RGBA</span>&nbsp;<span class="op" id="4938230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938233">w</span><span class="op" id="4938234">,</span>&nbsp;<span class="ident" id="4938236">h</span>&nbsp;<span class="op" id="4938238">:=</span>&nbsp;<span class="ident" id="4938241">r</span><span class="op" id="4938242">.</span><span class="ident" id="4938243">Dx</span><span class="op" id="4938245">(</span><span class="op" id="4938246">)</span><span class="op" id="4938247">,</span>&nbsp;<span class="ident" id="4938249">r</span><span class="op" id="4938250">.</span><span class="ident" id="4938251">Dy</span><span class="op" id="4938253">(</span><span class="op" id="4938254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938257">buf</span>&nbsp;<span class="op" id="4938261">:=</span>&nbsp;<span class="builtinfunc" id="4938264">make</span><span class="op" id="4938268">(</span><span class="op" id="4938269">[</span><span class="op" id="4938270">]</span><span class="builtintype" id="4938271">uint8</span><span class="op" id="4938276">,</span>&nbsp;<span class="num" id="4938278">4</span><span class="op" id="4938279">*</span><span class="ident" id="4938280">w</span><span class="op" id="4938281">*</span><span class="ident" id="4938282">h</span><span class="op" id="4938283">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938286">return</span>&nbsp;<span class="op" id="4938293">&amp;</span><span class="ident" id="4938294">RGBA</span><span class="op" id="4938298">{</span><span class="ident" id="4938299">buf</span><span class="op" id="4938302">,</span>&nbsp;<span class="num" id="4938304">4</span>&nbsp;<span class="op" id="4938306">*</span>&nbsp;<span class="ident" id="4938308">w</span><span class="op" id="4938309">,</span>&nbsp;<span class="ident" id="4938311">r</span><span class="op" id="4938312">}</span><br>
<span class="lineno"></span><span class="op" id="4938314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4938317">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4938394">type</span>&nbsp;<span class="ident" id="4938399">RGBA64</span>&nbsp;<span class="keyword" id="4938406">struct</span>&nbsp;<span class="op" id="4938413">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4938416">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4938506">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938574">Pix</span>&nbsp;<span class="op" id="4938578">[</span><span class="op" id="4938579">]</span><span class="builtintype" id="4938580">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4938587">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938663">Stride</span>&nbsp;<span class="builtintype" id="4938670">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4938675">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4938707">Rect</span>&nbsp;<span class="ident" id="4938712">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4938722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4938725">func</span>&nbsp;<span class="op" id="4938730">(</span><span class="ident" id="4938731">p</span>&nbsp;<span class="op" id="4938733">*</span><span class="ident" id="4938734">RGBA64</span><span class="op" id="4938740">)</span>&nbsp;<span class="ident" id="4938742">ColorModel</span><span class="op" id="4938752">(</span><span class="op" id="4938753">)</span>&nbsp;<span class="ident" id="4938755">color</span><span class="op" id="4938760">.</span><span class="ident" id="4938761">Model</span>&nbsp;<span class="op" id="4938767">{</span>&nbsp;<span class="keyword" id="4938769">return</span>&nbsp;<span class="ident" id="4938776">color</span><span class="op" id="4938781">.</span><span class="ident" id="4938782">RGBA64Model</span>&nbsp;<span class="op" id="4938794">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4938797">func</span>&nbsp;<span class="op" id="4938802">(</span><span class="ident" id="4938803">p</span>&nbsp;<span class="op" id="4938805">*</span><span class="ident" id="4938806">RGBA64</span><span class="op" id="4938812">)</span>&nbsp;<span class="ident" id="4938814">Bounds</span><span class="op" id="4938820">(</span><span class="op" id="4938821">)</span>&nbsp;<span class="ident" id="4938823">Rectangle</span>&nbsp;<span class="op" id="4938833">{</span>&nbsp;<span class="keyword" id="4938835">return</span>&nbsp;<span class="ident" id="4938842">p</span><span class="op" id="4938843">.</span><span class="ident" id="4938844">Rect</span>&nbsp;<span class="op" id="4938849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4938852">func</span>&nbsp;<span class="op" id="4938857">(</span><span class="ident" id="4938858">p</span>&nbsp;<span class="op" id="4938860">*</span><span class="ident" id="4938861">RGBA64</span><span class="op" id="4938867">)</span>&nbsp;<span class="ident" id="4938869">At</span><span class="op" id="4938871">(</span><span class="ident" id="4938872">x</span><span class="op" id="4938873">,</span>&nbsp;<span class="ident" id="4938875">y</span>&nbsp;<span class="builtintype" id="4938877">int</span><span class="op" id="4938880">)</span>&nbsp;<span class="ident" id="4938882">color</span><span class="op" id="4938887">.</span><span class="ident" id="4938888">Color</span>&nbsp;<span class="op" id="4938894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938897">return</span>&nbsp;<span class="ident" id="4938904">p</span><span class="op" id="4938905">.</span><span class="ident" id="4938906">RGBA64At</span><span class="op" id="4938914">(</span><span class="ident" id="4938915">x</span><span class="op" id="4938916">,</span>&nbsp;<span class="ident" id="4938918">y</span><span class="op" id="4938919">)</span><br>
<span class="lineno">175</span><span class="op" id="4938921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4938924">func</span>&nbsp;<span class="op" id="4938929">(</span><span class="ident" id="4938930">p</span>&nbsp;<span class="op" id="4938932">*</span><span class="ident" id="4938933">RGBA64</span><span class="op" id="4938939">)</span>&nbsp;<span class="ident" id="4938941">RGBA64At</span><span class="op" id="4938949">(</span><span class="ident" id="4938950">x</span><span class="op" id="4938951">,</span>&nbsp;<span class="ident" id="4938953">y</span>&nbsp;<span class="builtintype" id="4938955">int</span><span class="op" id="4938958">)</span>&nbsp;<span class="ident" id="4938960">color</span><span class="op" id="4938965">.</span><span class="ident" id="4938966">RGBA64</span>&nbsp;<span class="op" id="4938973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4938976">if</span>&nbsp;<span class="op" id="4938979">!</span><span class="op" id="4938980">(</span><span class="ident" id="4938981">Point</span><span class="op" id="4938986">{</span><span class="ident" id="4938987">x</span><span class="op" id="4938988">,</span>&nbsp;<span class="ident" id="4938990">y</span><span class="op" id="4938991">}</span><span class="op" id="4938992">.</span><span class="ident" id="4938993">In</span><span class="op" id="4938995">(</span><span class="ident" id="4938996">p</span><span class="op" id="4938997">.</span><span class="ident" id="4938998">Rect</span><span class="op" id="4939002">)</span><span class="op" id="4939003">)</span>&nbsp;<span class="op" id="4939005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939009">return</span>&nbsp;<span class="ident" id="4939016">color</span><span class="op" id="4939021">.</span><span class="ident" id="4939022">RGBA64</span><span class="op" id="4939028">{</span><span class="op" id="4939029">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4939032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939035">i</span>&nbsp;<span class="op" id="4939037">:=</span>&nbsp;<span class="ident" id="4939040">p</span><span class="op" id="4939041">.</span><span class="ident" id="4939042">PixOffset</span><span class="op" id="4939051">(</span><span class="ident" id="4939052">x</span><span class="op" id="4939053">,</span>&nbsp;<span class="ident" id="4939055">y</span><span class="op" id="4939056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939059">return</span>&nbsp;<span class="ident" id="4939066">color</span><span class="op" id="4939071">.</span><span class="ident" id="4939072">RGBA64</span><span class="op" id="4939078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4939082">uint16</span><span class="op" id="4939088">(</span><span class="ident" id="4939089">p</span><span class="op" id="4939090">.</span><span class="ident" id="4939091">Pix</span><span class="op" id="4939094">[</span><span class="ident" id="4939095">i</span><span class="op" id="4939096">+</span><span class="num" id="4939097">0</span><span class="op" id="4939098">]</span><span class="op" id="4939099">)</span><span class="op" id="4939100">&lt;&lt;</span><span class="num" id="4939102">8</span>&nbsp;<span class="op" id="4939104">|</span>&nbsp;<span class="builtintype" id="4939106">uint16</span><span class="op" id="4939112">(</span><span class="ident" id="4939113">p</span><span class="op" id="4939114">.</span><span class="ident" id="4939115">Pix</span><span class="op" id="4939118">[</span><span class="ident" id="4939119">i</span><span class="op" id="4939120">+</span><span class="num" id="4939121">1</span><span class="op" id="4939122">]</span><span class="op" id="4939123">)</span><span class="op" id="4939124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4939128">uint16</span><span class="op" id="4939134">(</span><span class="ident" id="4939135">p</span><span class="op" id="4939136">.</span><span class="ident" id="4939137">Pix</span><span class="op" id="4939140">[</span><span class="ident" id="4939141">i</span><span class="op" id="4939142">+</span><span class="num" id="4939143">2</span><span class="op" id="4939144">]</span><span class="op" id="4939145">)</span><span class="op" id="4939146">&lt;&lt;</span><span class="num" id="4939148">8</span>&nbsp;<span class="op" id="4939150">|</span>&nbsp;<span class="builtintype" id="4939152">uint16</span><span class="op" id="4939158">(</span><span class="ident" id="4939159">p</span><span class="op" id="4939160">.</span><span class="ident" id="4939161">Pix</span><span class="op" id="4939164">[</span><span class="ident" id="4939165">i</span><span class="op" id="4939166">+</span><span class="num" id="4939167">3</span><span class="op" id="4939168">]</span><span class="op" id="4939169">)</span><span class="op" id="4939170">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4939174">uint16</span><span class="op" id="4939180">(</span><span class="ident" id="4939181">p</span><span class="op" id="4939182">.</span><span class="ident" id="4939183">Pix</span><span class="op" id="4939186">[</span><span class="ident" id="4939187">i</span><span class="op" id="4939188">+</span><span class="num" id="4939189">4</span><span class="op" id="4939190">]</span><span class="op" id="4939191">)</span><span class="op" id="4939192">&lt;&lt;</span><span class="num" id="4939194">8</span>&nbsp;<span class="op" id="4939196">|</span>&nbsp;<span class="builtintype" id="4939198">uint16</span><span class="op" id="4939204">(</span><span class="ident" id="4939205">p</span><span class="op" id="4939206">.</span><span class="ident" id="4939207">Pix</span><span class="op" id="4939210">[</span><span class="ident" id="4939211">i</span><span class="op" id="4939212">+</span><span class="num" id="4939213">5</span><span class="op" id="4939214">]</span><span class="op" id="4939215">)</span><span class="op" id="4939216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4939220">uint16</span><span class="op" id="4939226">(</span><span class="ident" id="4939227">p</span><span class="op" id="4939228">.</span><span class="ident" id="4939229">Pix</span><span class="op" id="4939232">[</span><span class="ident" id="4939233">i</span><span class="op" id="4939234">+</span><span class="num" id="4939235">6</span><span class="op" id="4939236">]</span><span class="op" id="4939237">)</span><span class="op" id="4939238">&lt;&lt;</span><span class="num" id="4939240">8</span>&nbsp;<span class="op" id="4939242">|</span>&nbsp;<span class="builtintype" id="4939244">uint16</span><span class="op" id="4939250">(</span><span class="ident" id="4939251">p</span><span class="op" id="4939252">.</span><span class="ident" id="4939253">Pix</span><span class="op" id="4939256">[</span><span class="ident" id="4939257">i</span><span class="op" id="4939258">+</span><span class="num" id="4939259">7</span><span class="op" id="4939260">]</span><span class="op" id="4939261">)</span><span class="op" id="4939262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4939265">}</span><br>
<span class="lineno"></span><span class="op" id="4939267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4939270">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4939349">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4939373">func</span>&nbsp;<span class="op" id="4939378">(</span><span class="ident" id="4939379">p</span>&nbsp;<span class="op" id="4939381">*</span><span class="ident" id="4939382">RGBA64</span><span class="op" id="4939388">)</span>&nbsp;<span class="ident" id="4939390">PixOffset</span><span class="op" id="4939399">(</span><span class="ident" id="4939400">x</span><span class="op" id="4939401">,</span>&nbsp;<span class="ident" id="4939403">y</span>&nbsp;<span class="builtintype" id="4939405">int</span><span class="op" id="4939408">)</span>&nbsp;<span class="builtintype" id="4939410">int</span>&nbsp;<span class="op" id="4939414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939417">return</span>&nbsp;<span class="op" id="4939424">(</span><span class="ident" id="4939425">y</span><span class="op" id="4939426">-</span><span class="ident" id="4939427">p</span><span class="op" id="4939428">.</span><span class="ident" id="4939429">Rect</span><span class="op" id="4939433">.</span><span class="ident" id="4939434">Min</span><span class="op" id="4939437">.</span><span class="ident" id="4939438">Y</span><span class="op" id="4939439">)</span><span class="op" id="4939440">*</span><span class="ident" id="4939441">p</span><span class="op" id="4939442">.</span><span class="ident" id="4939443">Stride</span>&nbsp;<span class="op" id="4939450">+</span>&nbsp;<span class="op" id="4939452">(</span><span class="ident" id="4939453">x</span><span class="op" id="4939454">-</span><span class="ident" id="4939455">p</span><span class="op" id="4939456">.</span><span class="ident" id="4939457">Rect</span><span class="op" id="4939461">.</span><span class="ident" id="4939462">Min</span><span class="op" id="4939465">.</span><span class="ident" id="4939466">X</span><span class="op" id="4939467">)</span><span class="op" id="4939468">*</span><span class="num" id="4939469">8</span><br>
<span class="lineno"></span><span class="op" id="4939471">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="4939474">func</span>&nbsp;<span class="op" id="4939479">(</span><span class="ident" id="4939480">p</span>&nbsp;<span class="op" id="4939482">*</span><span class="ident" id="4939483">RGBA64</span><span class="op" id="4939489">)</span>&nbsp;<span class="ident" id="4939491">Set</span><span class="op" id="4939494">(</span><span class="ident" id="4939495">x</span><span class="op" id="4939496">,</span>&nbsp;<span class="ident" id="4939498">y</span>&nbsp;<span class="builtintype" id="4939500">int</span><span class="op" id="4939503">,</span>&nbsp;<span class="ident" id="4939505">c</span>&nbsp;<span class="ident" id="4939507">color</span><span class="op" id="4939512">.</span><span class="ident" id="4939513">Color</span><span class="op" id="4939518">)</span>&nbsp;<span class="op" id="4939520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939523">if</span>&nbsp;<span class="op" id="4939526">!</span><span class="op" id="4939527">(</span><span class="ident" id="4939528">Point</span><span class="op" id="4939533">{</span><span class="ident" id="4939534">x</span><span class="op" id="4939535">,</span>&nbsp;<span class="ident" id="4939537">y</span><span class="op" id="4939538">}</span><span class="op" id="4939539">.</span><span class="ident" id="4939540">In</span><span class="op" id="4939542">(</span><span class="ident" id="4939543">p</span><span class="op" id="4939544">.</span><span class="ident" id="4939545">Rect</span><span class="op" id="4939549">)</span><span class="op" id="4939550">)</span>&nbsp;<span class="op" id="4939552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939556">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4939564">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939567">i</span>&nbsp;<span class="op" id="4939569">:=</span>&nbsp;<span class="ident" id="4939572">p</span><span class="op" id="4939573">.</span><span class="ident" id="4939574">PixOffset</span><span class="op" id="4939583">(</span><span class="ident" id="4939584">x</span><span class="op" id="4939585">,</span>&nbsp;<span class="ident" id="4939587">y</span><span class="op" id="4939588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939591">c1</span>&nbsp;<span class="op" id="4939594">:=</span>&nbsp;<span class="ident" id="4939597">color</span><span class="op" id="4939602">.</span><span class="ident" id="4939603">RGBA64Model</span><span class="op" id="4939614">.</span><span class="ident" id="4939615">Convert</span><span class="op" id="4939622">(</span><span class="ident" id="4939623">c</span><span class="op" id="4939624">)</span><span class="op" id="4939625">.</span><span class="op" id="4939626">(</span><span class="ident" id="4939627">color</span><span class="op" id="4939632">.</span><span class="ident" id="4939633">RGBA64</span><span class="op" id="4939639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939642">p</span><span class="op" id="4939643">.</span><span class="ident" id="4939644">Pix</span><span class="op" id="4939647">[</span><span class="ident" id="4939648">i</span><span class="op" id="4939649">+</span><span class="num" id="4939650">0</span><span class="op" id="4939651">]</span>&nbsp;<span class="op" id="4939653">=</span>&nbsp;<span class="builtintype" id="4939655">uint8</span><span class="op" id="4939660">(</span><span class="ident" id="4939661">c1</span><span class="op" id="4939663">.</span><span class="ident" id="4939664">R</span>&nbsp;<span class="op" id="4939666">&gt;&gt;</span>&nbsp;<span class="num" id="4939669">8</span><span class="op" id="4939670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939673">p</span><span class="op" id="4939674">.</span><span class="ident" id="4939675">Pix</span><span class="op" id="4939678">[</span><span class="ident" id="4939679">i</span><span class="op" id="4939680">+</span><span class="num" id="4939681">1</span><span class="op" id="4939682">]</span>&nbsp;<span class="op" id="4939684">=</span>&nbsp;<span class="builtintype" id="4939686">uint8</span><span class="op" id="4939691">(</span><span class="ident" id="4939692">c1</span><span class="op" id="4939694">.</span><span class="ident" id="4939695">R</span><span class="op" id="4939696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939699">p</span><span class="op" id="4939700">.</span><span class="ident" id="4939701">Pix</span><span class="op" id="4939704">[</span><span class="ident" id="4939705">i</span><span class="op" id="4939706">+</span><span class="num" id="4939707">2</span><span class="op" id="4939708">]</span>&nbsp;<span class="op" id="4939710">=</span>&nbsp;<span class="builtintype" id="4939712">uint8</span><span class="op" id="4939717">(</span><span class="ident" id="4939718">c1</span><span class="op" id="4939720">.</span><span class="ident" id="4939721">G</span>&nbsp;<span class="op" id="4939723">&gt;&gt;</span>&nbsp;<span class="num" id="4939726">8</span><span class="op" id="4939727">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939730">p</span><span class="op" id="4939731">.</span><span class="ident" id="4939732">Pix</span><span class="op" id="4939735">[</span><span class="ident" id="4939736">i</span><span class="op" id="4939737">+</span><span class="num" id="4939738">3</span><span class="op" id="4939739">]</span>&nbsp;<span class="op" id="4939741">=</span>&nbsp;<span class="builtintype" id="4939743">uint8</span><span class="op" id="4939748">(</span><span class="ident" id="4939749">c1</span><span class="op" id="4939751">.</span><span class="ident" id="4939752">G</span><span class="op" id="4939753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939756">p</span><span class="op" id="4939757">.</span><span class="ident" id="4939758">Pix</span><span class="op" id="4939761">[</span><span class="ident" id="4939762">i</span><span class="op" id="4939763">+</span><span class="num" id="4939764">4</span><span class="op" id="4939765">]</span>&nbsp;<span class="op" id="4939767">=</span>&nbsp;<span class="builtintype" id="4939769">uint8</span><span class="op" id="4939774">(</span><span class="ident" id="4939775">c1</span><span class="op" id="4939777">.</span><span class="ident" id="4939778">B</span>&nbsp;<span class="op" id="4939780">&gt;&gt;</span>&nbsp;<span class="num" id="4939783">8</span><span class="op" id="4939784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939787">p</span><span class="op" id="4939788">.</span><span class="ident" id="4939789">Pix</span><span class="op" id="4939792">[</span><span class="ident" id="4939793">i</span><span class="op" id="4939794">+</span><span class="num" id="4939795">5</span><span class="op" id="4939796">]</span>&nbsp;<span class="op" id="4939798">=</span>&nbsp;<span class="builtintype" id="4939800">uint8</span><span class="op" id="4939805">(</span><span class="ident" id="4939806">c1</span><span class="op" id="4939808">.</span><span class="ident" id="4939809">B</span><span class="op" id="4939810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939813">p</span><span class="op" id="4939814">.</span><span class="ident" id="4939815">Pix</span><span class="op" id="4939818">[</span><span class="ident" id="4939819">i</span><span class="op" id="4939820">+</span><span class="num" id="4939821">6</span><span class="op" id="4939822">]</span>&nbsp;<span class="op" id="4939824">=</span>&nbsp;<span class="builtintype" id="4939826">uint8</span><span class="op" id="4939831">(</span><span class="ident" id="4939832">c1</span><span class="op" id="4939834">.</span><span class="ident" id="4939835">A</span>&nbsp;<span class="op" id="4939837">&gt;&gt;</span>&nbsp;<span class="num" id="4939840">8</span><span class="op" id="4939841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939844">p</span><span class="op" id="4939845">.</span><span class="ident" id="4939846">Pix</span><span class="op" id="4939849">[</span><span class="ident" id="4939850">i</span><span class="op" id="4939851">+</span><span class="num" id="4939852">7</span><span class="op" id="4939853">]</span>&nbsp;<span class="op" id="4939855">=</span>&nbsp;<span class="builtintype" id="4939857">uint8</span><span class="op" id="4939862">(</span><span class="ident" id="4939863">c1</span><span class="op" id="4939865">.</span><span class="ident" id="4939866">A</span><span class="op" id="4939867">)</span><br>
<span class="lineno">210</span><span class="op" id="4939869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939872">func</span>&nbsp;<span class="op" id="4939877">(</span><span class="ident" id="4939878">p</span>&nbsp;<span class="op" id="4939880">*</span><span class="ident" id="4939881">RGBA64</span><span class="op" id="4939887">)</span>&nbsp;<span class="ident" id="4939889">SetRGBA64</span><span class="op" id="4939898">(</span><span class="ident" id="4939899">x</span><span class="op" id="4939900">,</span>&nbsp;<span class="ident" id="4939902">y</span>&nbsp;<span class="builtintype" id="4939904">int</span><span class="op" id="4939907">,</span>&nbsp;<span class="ident" id="4939909">c</span>&nbsp;<span class="ident" id="4939911">color</span><span class="op" id="4939916">.</span><span class="ident" id="4939917">RGBA64</span><span class="op" id="4939923">)</span>&nbsp;<span class="op" id="4939925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939928">if</span>&nbsp;<span class="op" id="4939931">!</span><span class="op" id="4939932">(</span><span class="ident" id="4939933">Point</span><span class="op" id="4939938">{</span><span class="ident" id="4939939">x</span><span class="op" id="4939940">,</span>&nbsp;<span class="ident" id="4939942">y</span><span class="op" id="4939943">}</span><span class="op" id="4939944">.</span><span class="ident" id="4939945">In</span><span class="op" id="4939947">(</span><span class="ident" id="4939948">p</span><span class="op" id="4939949">.</span><span class="ident" id="4939950">Rect</span><span class="op" id="4939954">)</span><span class="op" id="4939955">)</span>&nbsp;<span class="op" id="4939957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4939961">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4939969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939972">i</span>&nbsp;<span class="op" id="4939974">:=</span>&nbsp;<span class="ident" id="4939977">p</span><span class="op" id="4939978">.</span><span class="ident" id="4939979">PixOffset</span><span class="op" id="4939988">(</span><span class="ident" id="4939989">x</span><span class="op" id="4939990">,</span>&nbsp;<span class="ident" id="4939992">y</span><span class="op" id="4939993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4939996">p</span><span class="op" id="4939997">.</span><span class="ident" id="4939998">Pix</span><span class="op" id="4940001">[</span><span class="ident" id="4940002">i</span><span class="op" id="4940003">+</span><span class="num" id="4940004">0</span><span class="op" id="4940005">]</span>&nbsp;<span class="op" id="4940007">=</span>&nbsp;<span class="builtintype" id="4940009">uint8</span><span class="op" id="4940014">(</span><span class="ident" id="4940015">c</span><span class="op" id="4940016">.</span><span class="ident" id="4940017">R</span>&nbsp;<span class="op" id="4940019">&gt;&gt;</span>&nbsp;<span class="num" id="4940022">8</span><span class="op" id="4940023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940026">p</span><span class="op" id="4940027">.</span><span class="ident" id="4940028">Pix</span><span class="op" id="4940031">[</span><span class="ident" id="4940032">i</span><span class="op" id="4940033">+</span><span class="num" id="4940034">1</span><span class="op" id="4940035">]</span>&nbsp;<span class="op" id="4940037">=</span>&nbsp;<span class="builtintype" id="4940039">uint8</span><span class="op" id="4940044">(</span><span class="ident" id="4940045">c</span><span class="op" id="4940046">.</span><span class="ident" id="4940047">R</span><span class="op" id="4940048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940051">p</span><span class="op" id="4940052">.</span><span class="ident" id="4940053">Pix</span><span class="op" id="4940056">[</span><span class="ident" id="4940057">i</span><span class="op" id="4940058">+</span><span class="num" id="4940059">2</span><span class="op" id="4940060">]</span>&nbsp;<span class="op" id="4940062">=</span>&nbsp;<span class="builtintype" id="4940064">uint8</span><span class="op" id="4940069">(</span><span class="ident" id="4940070">c</span><span class="op" id="4940071">.</span><span class="ident" id="4940072">G</span>&nbsp;<span class="op" id="4940074">&gt;&gt;</span>&nbsp;<span class="num" id="4940077">8</span><span class="op" id="4940078">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940081">p</span><span class="op" id="4940082">.</span><span class="ident" id="4940083">Pix</span><span class="op" id="4940086">[</span><span class="ident" id="4940087">i</span><span class="op" id="4940088">+</span><span class="num" id="4940089">3</span><span class="op" id="4940090">]</span>&nbsp;<span class="op" id="4940092">=</span>&nbsp;<span class="builtintype" id="4940094">uint8</span><span class="op" id="4940099">(</span><span class="ident" id="4940100">c</span><span class="op" id="4940101">.</span><span class="ident" id="4940102">G</span><span class="op" id="4940103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940106">p</span><span class="op" id="4940107">.</span><span class="ident" id="4940108">Pix</span><span class="op" id="4940111">[</span><span class="ident" id="4940112">i</span><span class="op" id="4940113">+</span><span class="num" id="4940114">4</span><span class="op" id="4940115">]</span>&nbsp;<span class="op" id="4940117">=</span>&nbsp;<span class="builtintype" id="4940119">uint8</span><span class="op" id="4940124">(</span><span class="ident" id="4940125">c</span><span class="op" id="4940126">.</span><span class="ident" id="4940127">B</span>&nbsp;<span class="op" id="4940129">&gt;&gt;</span>&nbsp;<span class="num" id="4940132">8</span><span class="op" id="4940133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940136">p</span><span class="op" id="4940137">.</span><span class="ident" id="4940138">Pix</span><span class="op" id="4940141">[</span><span class="ident" id="4940142">i</span><span class="op" id="4940143">+</span><span class="num" id="4940144">5</span><span class="op" id="4940145">]</span>&nbsp;<span class="op" id="4940147">=</span>&nbsp;<span class="builtintype" id="4940149">uint8</span><span class="op" id="4940154">(</span><span class="ident" id="4940155">c</span><span class="op" id="4940156">.</span><span class="ident" id="4940157">B</span><span class="op" id="4940158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940161">p</span><span class="op" id="4940162">.</span><span class="ident" id="4940163">Pix</span><span class="op" id="4940166">[</span><span class="ident" id="4940167">i</span><span class="op" id="4940168">+</span><span class="num" id="4940169">6</span><span class="op" id="4940170">]</span>&nbsp;<span class="op" id="4940172">=</span>&nbsp;<span class="builtintype" id="4940174">uint8</span><span class="op" id="4940179">(</span><span class="ident" id="4940180">c</span><span class="op" id="4940181">.</span><span class="ident" id="4940182">A</span>&nbsp;<span class="op" id="4940184">&gt;&gt;</span>&nbsp;<span class="num" id="4940187">8</span><span class="op" id="4940188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940191">p</span><span class="op" id="4940192">.</span><span class="ident" id="4940193">Pix</span><span class="op" id="4940196">[</span><span class="ident" id="4940197">i</span><span class="op" id="4940198">+</span><span class="num" id="4940199">7</span><span class="op" id="4940200">]</span>&nbsp;<span class="op" id="4940202">=</span>&nbsp;<span class="builtintype" id="4940204">uint8</span><span class="op" id="4940209">(</span><span class="ident" id="4940210">c</span><span class="op" id="4940211">.</span><span class="ident" id="4940212">A</span><span class="op" id="4940213">)</span><br>
<span class="lineno">225</span><span class="op" id="4940215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4940218">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4940295">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4940367">func</span>&nbsp;<span class="op" id="4940372">(</span><span class="ident" id="4940373">p</span>&nbsp;<span class="op" id="4940375">*</span><span class="ident" id="4940376">RGBA64</span><span class="op" id="4940382">)</span>&nbsp;<span class="ident" id="4940384">SubImage</span><span class="op" id="4940392">(</span><span class="ident" id="4940393">r</span>&nbsp;<span class="ident" id="4940395">Rectangle</span><span class="op" id="4940404">)</span>&nbsp;<span class="ident" id="4940406">Image</span>&nbsp;<span class="op" id="4940412">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940415">r</span>&nbsp;<span class="op" id="4940417">=</span>&nbsp;<span class="ident" id="4940419">r</span><span class="op" id="4940420">.</span><span class="ident" id="4940421">Intersect</span><span class="op" id="4940430">(</span><span class="ident" id="4940431">p</span><span class="op" id="4940432">.</span><span class="ident" id="4940433">Rect</span><span class="op" id="4940437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4940440">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4940521">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4940603">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940653">if</span>&nbsp;<span class="ident" id="4940656">r</span><span class="op" id="4940657">.</span><span class="ident" id="4940658">Empty</span><span class="op" id="4940663">(</span><span class="op" id="4940664">)</span>&nbsp;<span class="op" id="4940666">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940670">return</span>&nbsp;<span class="op" id="4940677">&amp;</span><span class="ident" id="4940678">RGBA64</span><span class="op" id="4940684">{</span><span class="op" id="4940685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940691">i</span>&nbsp;<span class="op" id="4940693">:=</span>&nbsp;<span class="ident" id="4940696">p</span><span class="op" id="4940697">.</span><span class="ident" id="4940698">PixOffset</span><span class="op" id="4940707">(</span><span class="ident" id="4940708">r</span><span class="op" id="4940709">.</span><span class="ident" id="4940710">Min</span><span class="op" id="4940713">.</span><span class="ident" id="4940714">X</span><span class="op" id="4940715">,</span>&nbsp;<span class="ident" id="4940717">r</span><span class="op" id="4940718">.</span><span class="ident" id="4940719">Min</span><span class="op" id="4940722">.</span><span class="ident" id="4940723">Y</span><span class="op" id="4940724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940727">return</span>&nbsp;<span class="op" id="4940734">&amp;</span><span class="ident" id="4940735">RGBA64</span><span class="op" id="4940741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940745">Pix</span><span class="op" id="4940748">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940753">p</span><span class="op" id="4940754">.</span><span class="ident" id="4940755">Pix</span><span class="op" id="4940758">[</span><span class="ident" id="4940759">i</span><span class="op" id="4940760">:</span><span class="op" id="4940761">]</span><span class="op" id="4940762">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940766">Stride</span><span class="op" id="4940772">:</span>&nbsp;<span class="ident" id="4940774">p</span><span class="op" id="4940775">.</span><span class="ident" id="4940776">Stride</span><span class="op" id="4940782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940786">Rect</span><span class="op" id="4940790">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4940794">r</span><span class="op" id="4940795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940798">}</span><br>
<span class="lineno"></span><span class="op" id="4940800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4940803">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4940876">func</span>&nbsp;<span class="op" id="4940881">(</span><span class="ident" id="4940882">p</span>&nbsp;<span class="op" id="4940884">*</span><span class="ident" id="4940885">RGBA64</span><span class="op" id="4940891">)</span>&nbsp;<span class="ident" id="4940893">Opaque</span><span class="op" id="4940899">(</span><span class="op" id="4940900">)</span>&nbsp;<span class="builtintype" id="4940902">bool</span>&nbsp;<span class="op" id="4940907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940910">if</span>&nbsp;<span class="ident" id="4940913">p</span><span class="op" id="4940914">.</span><span class="ident" id="4940915">Rect</span><span class="op" id="4940919">.</span><span class="ident" id="4940920">Empty</span><span class="op" id="4940925">(</span><span class="op" id="4940926">)</span>&nbsp;<span class="op" id="4940928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940932">return</span>&nbsp;<span class="builtintype" id="4940939">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4940945">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4940948">i0</span><span class="op" id="4940950">,</span>&nbsp;<span class="ident" id="4940952">i1</span>&nbsp;<span class="op" id="4940955">:=</span>&nbsp;<span class="num" id="4940958">6</span><span class="op" id="4940959">,</span>&nbsp;<span class="ident" id="4940961">p</span><span class="op" id="4940962">.</span><span class="ident" id="4940963">Rect</span><span class="op" id="4940967">.</span><span class="ident" id="4940968">Dx</span><span class="op" id="4940970">(</span><span class="op" id="4940971">)</span><span class="op" id="4940972">*</span><span class="num" id="4940973">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4940976">for</span>&nbsp;<span class="ident" id="4940980">y</span>&nbsp;<span class="op" id="4940982">:=</span>&nbsp;<span class="ident" id="4940985">p</span><span class="op" id="4940986">.</span><span class="ident" id="4940987">Rect</span><span class="op" id="4940991">.</span><span class="ident" id="4940992">Min</span><span class="op" id="4940995">.</span><span class="ident" id="4940996">Y</span><span class="op" id="4940997">;</span>&nbsp;<span class="ident" id="4940999">y</span>&nbsp;<span class="op" id="4941001">&lt;</span>&nbsp;<span class="ident" id="4941003">p</span><span class="op" id="4941004">.</span><span class="ident" id="4941005">Rect</span><span class="op" id="4941009">.</span><span class="ident" id="4941010">Max</span><span class="op" id="4941013">.</span><span class="ident" id="4941014">Y</span><span class="op" id="4941015">;</span>&nbsp;<span class="ident" id="4941017">y</span><span class="op" id="4941018">++</span>&nbsp;<span class="op" id="4941021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941025">for</span>&nbsp;<span class="ident" id="4941029">i</span>&nbsp;<span class="op" id="4941031">:=</span>&nbsp;<span class="ident" id="4941034">i0</span><span class="op" id="4941036">;</span>&nbsp;<span class="ident" id="4941038">i</span>&nbsp;<span class="op" id="4941040">&lt;</span>&nbsp;<span class="ident" id="4941042">i1</span><span class="op" id="4941044">;</span>&nbsp;<span class="ident" id="4941046">i</span>&nbsp;<span class="op" id="4941048">+=</span>&nbsp;<span class="num" id="4941051">8</span>&nbsp;<span class="op" id="4941053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941058">if</span>&nbsp;<span class="ident" id="4941061">p</span><span class="op" id="4941062">.</span><span class="ident" id="4941063">Pix</span><span class="op" id="4941066">[</span><span class="ident" id="4941067">i</span><span class="op" id="4941068">+</span><span class="num" id="4941069">0</span><span class="op" id="4941070">]</span>&nbsp;<span class="op" id="4941072">!=</span>&nbsp;<span class="num" id="4941075">0xff</span>&nbsp;<span class="op" id="4941080">||</span>&nbsp;<span class="ident" id="4941083">p</span><span class="op" id="4941084">.</span><span class="ident" id="4941085">Pix</span><span class="op" id="4941088">[</span><span class="ident" id="4941089">i</span><span class="op" id="4941090">+</span><span class="num" id="4941091">1</span><span class="op" id="4941092">]</span>&nbsp;<span class="op" id="4941094">!=</span>&nbsp;<span class="num" id="4941097">0xff</span>&nbsp;<span class="op" id="4941102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941108">return</span>&nbsp;<span class="builtintype" id="4941115">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941132">i0</span>&nbsp;<span class="op" id="4941135">+=</span>&nbsp;<span class="ident" id="4941138">p</span><span class="op" id="4941139">.</span><span class="ident" id="4941140">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941149">i1</span>&nbsp;<span class="op" id="4941152">+=</span>&nbsp;<span class="ident" id="4941155">p</span><span class="op" id="4941156">.</span><span class="ident" id="4941157">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4941165">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941168">return</span>&nbsp;<span class="builtintype" id="4941175">true</span><br>
<span class="lineno"></span><span class="op" id="4941180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4941183">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4941240">func</span>&nbsp;<span class="ident" id="4941245">NewRGBA64</span><span class="op" id="4941254">(</span><span class="ident" id="4941255">r</span>&nbsp;<span class="ident" id="4941257">Rectangle</span><span class="op" id="4941266">)</span>&nbsp;<span class="op" id="4941268">*</span><span class="ident" id="4941269">RGBA64</span>&nbsp;<span class="op" id="4941276">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941279">w</span><span class="op" id="4941280">,</span>&nbsp;<span class="ident" id="4941282">h</span>&nbsp;<span class="op" id="4941284">:=</span>&nbsp;<span class="ident" id="4941287">r</span><span class="op" id="4941288">.</span><span class="ident" id="4941289">Dx</span><span class="op" id="4941291">(</span><span class="op" id="4941292">)</span><span class="op" id="4941293">,</span>&nbsp;<span class="ident" id="4941295">r</span><span class="op" id="4941296">.</span><span class="ident" id="4941297">Dy</span><span class="op" id="4941299">(</span><span class="op" id="4941300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941303">pix</span>&nbsp;<span class="op" id="4941307">:=</span>&nbsp;<span class="builtinfunc" id="4941310">make</span><span class="op" id="4941314">(</span><span class="op" id="4941315">[</span><span class="op" id="4941316">]</span><span class="builtintype" id="4941317">uint8</span><span class="op" id="4941322">,</span>&nbsp;<span class="num" id="4941324">8</span><span class="op" id="4941325">*</span><span class="ident" id="4941326">w</span><span class="op" id="4941327">*</span><span class="ident" id="4941328">h</span><span class="op" id="4941329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941332">return</span>&nbsp;<span class="op" id="4941339">&amp;</span><span class="ident" id="4941340">RGBA64</span><span class="op" id="4941346">{</span><span class="ident" id="4941347">pix</span><span class="op" id="4941350">,</span>&nbsp;<span class="num" id="4941352">8</span>&nbsp;<span class="op" id="4941354">*</span>&nbsp;<span class="ident" id="4941356">w</span><span class="op" id="4941357">,</span>&nbsp;<span class="ident" id="4941359">r</span><span class="op" id="4941360">}</span><br>
<span class="lineno"></span><span class="op" id="4941362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4941365">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4941440">type</span>&nbsp;<span class="ident" id="4941445">NRGBA</span>&nbsp;<span class="keyword" id="4941451">struct</span>&nbsp;<span class="op" id="4941458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4941461">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4941529">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941597">Pix</span>&nbsp;<span class="op" id="4941601">[</span><span class="op" id="4941602">]</span><span class="builtintype" id="4941603">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4941610">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941686">Stride</span>&nbsp;<span class="builtintype" id="4941693">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4941698">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4941730">Rect</span>&nbsp;<span class="ident" id="4941735">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4941745">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="4941748">func</span>&nbsp;<span class="op" id="4941753">(</span><span class="ident" id="4941754">p</span>&nbsp;<span class="op" id="4941756">*</span><span class="ident" id="4941757">NRGBA</span><span class="op" id="4941762">)</span>&nbsp;<span class="ident" id="4941764">ColorModel</span><span class="op" id="4941774">(</span><span class="op" id="4941775">)</span>&nbsp;<span class="ident" id="4941777">color</span><span class="op" id="4941782">.</span><span class="ident" id="4941783">Model</span>&nbsp;<span class="op" id="4941789">{</span>&nbsp;<span class="keyword" id="4941791">return</span>&nbsp;<span class="ident" id="4941798">color</span><span class="op" id="4941803">.</span><span class="ident" id="4941804">NRGBAModel</span>&nbsp;<span class="op" id="4941815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4941818">func</span>&nbsp;<span class="op" id="4941823">(</span><span class="ident" id="4941824">p</span>&nbsp;<span class="op" id="4941826">*</span><span class="ident" id="4941827">NRGBA</span><span class="op" id="4941832">)</span>&nbsp;<span class="ident" id="4941834">Bounds</span><span class="op" id="4941840">(</span><span class="op" id="4941841">)</span>&nbsp;<span class="ident" id="4941843">Rectangle</span>&nbsp;<span class="op" id="4941853">{</span>&nbsp;<span class="keyword" id="4941855">return</span>&nbsp;<span class="ident" id="4941862">p</span><span class="op" id="4941863">.</span><span class="ident" id="4941864">Rect</span>&nbsp;<span class="op" id="4941869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4941872">func</span>&nbsp;<span class="op" id="4941877">(</span><span class="ident" id="4941878">p</span>&nbsp;<span class="op" id="4941880">*</span><span class="ident" id="4941881">NRGBA</span><span class="op" id="4941886">)</span>&nbsp;<span class="ident" id="4941888">At</span><span class="op" id="4941890">(</span><span class="ident" id="4941891">x</span><span class="op" id="4941892">,</span>&nbsp;<span class="ident" id="4941894">y</span>&nbsp;<span class="builtintype" id="4941896">int</span><span class="op" id="4941899">)</span>&nbsp;<span class="ident" id="4941901">color</span><span class="op" id="4941906">.</span><span class="ident" id="4941907">Color</span>&nbsp;<span class="op" id="4941913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941916">return</span>&nbsp;<span class="ident" id="4941923">p</span><span class="op" id="4941924">.</span><span class="ident" id="4941925">NRGBAAt</span><span class="op" id="4941932">(</span><span class="ident" id="4941933">x</span><span class="op" id="4941934">,</span>&nbsp;<span class="ident" id="4941936">y</span><span class="op" id="4941937">)</span><br>
<span class="lineno"></span><span class="op" id="4941939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4941942">func</span>&nbsp;<span class="op" id="4941947">(</span><span class="ident" id="4941948">p</span>&nbsp;<span class="op" id="4941950">*</span><span class="ident" id="4941951">NRGBA</span><span class="op" id="4941956">)</span>&nbsp;<span class="ident" id="4941958">NRGBAAt</span><span class="op" id="4941965">(</span><span class="ident" id="4941966">x</span><span class="op" id="4941967">,</span>&nbsp;<span class="ident" id="4941969">y</span>&nbsp;<span class="builtintype" id="4941971">int</span><span class="op" id="4941974">)</span>&nbsp;<span class="ident" id="4941976">color</span><span class="op" id="4941981">.</span><span class="ident" id="4941982">NRGBA</span>&nbsp;<span class="op" id="4941988">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4941991">if</span>&nbsp;<span class="op" id="4941994">!</span><span class="op" id="4941995">(</span><span class="ident" id="4941996">Point</span><span class="op" id="4942001">{</span><span class="ident" id="4942002">x</span><span class="op" id="4942003">,</span>&nbsp;<span class="ident" id="4942005">y</span><span class="op" id="4942006">}</span><span class="op" id="4942007">.</span><span class="ident" id="4942008">In</span><span class="op" id="4942010">(</span><span class="ident" id="4942011">p</span><span class="op" id="4942012">.</span><span class="ident" id="4942013">Rect</span><span class="op" id="4942017">)</span><span class="op" id="4942018">)</span>&nbsp;<span class="op" id="4942020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942024">return</span>&nbsp;<span class="ident" id="4942031">color</span><span class="op" id="4942036">.</span><span class="ident" id="4942037">NRGBA</span><span class="op" id="4942042">{</span><span class="op" id="4942043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942049">i</span>&nbsp;<span class="op" id="4942051">:=</span>&nbsp;<span class="ident" id="4942054">p</span><span class="op" id="4942055">.</span><span class="ident" id="4942056">PixOffset</span><span class="op" id="4942065">(</span><span class="ident" id="4942066">x</span><span class="op" id="4942067">,</span>&nbsp;<span class="ident" id="4942069">y</span><span class="op" id="4942070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942073">return</span>&nbsp;<span class="ident" id="4942080">color</span><span class="op" id="4942085">.</span><span class="ident" id="4942086">NRGBA</span><span class="op" id="4942091">{</span><span class="ident" id="4942092">p</span><span class="op" id="4942093">.</span><span class="ident" id="4942094">Pix</span><span class="op" id="4942097">[</span><span class="ident" id="4942098">i</span><span class="op" id="4942099">+</span><span class="num" id="4942100">0</span><span class="op" id="4942101">]</span><span class="op" id="4942102">,</span>&nbsp;<span class="ident" id="4942104">p</span><span class="op" id="4942105">.</span><span class="ident" id="4942106">Pix</span><span class="op" id="4942109">[</span><span class="ident" id="4942110">i</span><span class="op" id="4942111">+</span><span class="num" id="4942112">1</span><span class="op" id="4942113">]</span><span class="op" id="4942114">,</span>&nbsp;<span class="ident" id="4942116">p</span><span class="op" id="4942117">.</span><span class="ident" id="4942118">Pix</span><span class="op" id="4942121">[</span><span class="ident" id="4942122">i</span><span class="op" id="4942123">+</span><span class="num" id="4942124">2</span><span class="op" id="4942125">]</span><span class="op" id="4942126">,</span>&nbsp;<span class="ident" id="4942128">p</span><span class="op" id="4942129">.</span><span class="ident" id="4942130">Pix</span><span class="op" id="4942133">[</span><span class="ident" id="4942134">i</span><span class="op" id="4942135">+</span><span class="num" id="4942136">3</span><span class="op" id="4942137">]</span><span class="op" id="4942138">}</span><br>
<span class="lineno">295</span><span class="op" id="4942140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4942143">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4942222">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4942246">func</span>&nbsp;<span class="op" id="4942251">(</span><span class="ident" id="4942252">p</span>&nbsp;<span class="op" id="4942254">*</span><span class="ident" id="4942255">NRGBA</span><span class="op" id="4942260">)</span>&nbsp;<span class="ident" id="4942262">PixOffset</span><span class="op" id="4942271">(</span><span class="ident" id="4942272">x</span><span class="op" id="4942273">,</span>&nbsp;<span class="ident" id="4942275">y</span>&nbsp;<span class="builtintype" id="4942277">int</span><span class="op" id="4942280">)</span>&nbsp;<span class="builtintype" id="4942282">int</span>&nbsp;<span class="op" id="4942286">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942289">return</span>&nbsp;<span class="op" id="4942296">(</span><span class="ident" id="4942297">y</span><span class="op" id="4942298">-</span><span class="ident" id="4942299">p</span><span class="op" id="4942300">.</span><span class="ident" id="4942301">Rect</span><span class="op" id="4942305">.</span><span class="ident" id="4942306">Min</span><span class="op" id="4942309">.</span><span class="ident" id="4942310">Y</span><span class="op" id="4942311">)</span><span class="op" id="4942312">*</span><span class="ident" id="4942313">p</span><span class="op" id="4942314">.</span><span class="ident" id="4942315">Stride</span>&nbsp;<span class="op" id="4942322">+</span>&nbsp;<span class="op" id="4942324">(</span><span class="ident" id="4942325">x</span><span class="op" id="4942326">-</span><span class="ident" id="4942327">p</span><span class="op" id="4942328">.</span><span class="ident" id="4942329">Rect</span><span class="op" id="4942333">.</span><span class="ident" id="4942334">Min</span><span class="op" id="4942337">.</span><span class="ident" id="4942338">X</span><span class="op" id="4942339">)</span><span class="op" id="4942340">*</span><span class="num" id="4942341">4</span><br>
<span class="lineno"></span><span class="op" id="4942343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4942346">func</span>&nbsp;<span class="op" id="4942351">(</span><span class="ident" id="4942352">p</span>&nbsp;<span class="op" id="4942354">*</span><span class="ident" id="4942355">NRGBA</span><span class="op" id="4942360">)</span>&nbsp;<span class="ident" id="4942362">Set</span><span class="op" id="4942365">(</span><span class="ident" id="4942366">x</span><span class="op" id="4942367">,</span>&nbsp;<span class="ident" id="4942369">y</span>&nbsp;<span class="builtintype" id="4942371">int</span><span class="op" id="4942374">,</span>&nbsp;<span class="ident" id="4942376">c</span>&nbsp;<span class="ident" id="4942378">color</span><span class="op" id="4942383">.</span><span class="ident" id="4942384">Color</span><span class="op" id="4942389">)</span>&nbsp;<span class="op" id="4942391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942394">if</span>&nbsp;<span class="op" id="4942397">!</span><span class="op" id="4942398">(</span><span class="ident" id="4942399">Point</span><span class="op" id="4942404">{</span><span class="ident" id="4942405">x</span><span class="op" id="4942406">,</span>&nbsp;<span class="ident" id="4942408">y</span><span class="op" id="4942409">}</span><span class="op" id="4942410">.</span><span class="ident" id="4942411">In</span><span class="op" id="4942413">(</span><span class="ident" id="4942414">p</span><span class="op" id="4942415">.</span><span class="ident" id="4942416">Rect</span><span class="op" id="4942420">)</span><span class="op" id="4942421">)</span>&nbsp;<span class="op" id="4942423">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942438">i</span>&nbsp;<span class="op" id="4942440">:=</span>&nbsp;<span class="ident" id="4942443">p</span><span class="op" id="4942444">.</span><span class="ident" id="4942445">PixOffset</span><span class="op" id="4942454">(</span><span class="ident" id="4942455">x</span><span class="op" id="4942456">,</span>&nbsp;<span class="ident" id="4942458">y</span><span class="op" id="4942459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942462">c1</span>&nbsp;<span class="op" id="4942465">:=</span>&nbsp;<span class="ident" id="4942468">color</span><span class="op" id="4942473">.</span><span class="ident" id="4942474">NRGBAModel</span><span class="op" id="4942484">.</span><span class="ident" id="4942485">Convert</span><span class="op" id="4942492">(</span><span class="ident" id="4942493">c</span><span class="op" id="4942494">)</span><span class="op" id="4942495">.</span><span class="op" id="4942496">(</span><span class="ident" id="4942497">color</span><span class="op" id="4942502">.</span><span class="ident" id="4942503">NRGBA</span><span class="op" id="4942508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942511">p</span><span class="op" id="4942512">.</span><span class="ident" id="4942513">Pix</span><span class="op" id="4942516">[</span><span class="ident" id="4942517">i</span><span class="op" id="4942518">+</span><span class="num" id="4942519">0</span><span class="op" id="4942520">]</span>&nbsp;<span class="op" id="4942522">=</span>&nbsp;<span class="ident" id="4942524">c1</span><span class="op" id="4942526">.</span><span class="ident" id="4942527">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942530">p</span><span class="op" id="4942531">.</span><span class="ident" id="4942532">Pix</span><span class="op" id="4942535">[</span><span class="ident" id="4942536">i</span><span class="op" id="4942537">+</span><span class="num" id="4942538">1</span><span class="op" id="4942539">]</span>&nbsp;<span class="op" id="4942541">=</span>&nbsp;<span class="ident" id="4942543">c1</span><span class="op" id="4942545">.</span><span class="ident" id="4942546">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942549">p</span><span class="op" id="4942550">.</span><span class="ident" id="4942551">Pix</span><span class="op" id="4942554">[</span><span class="ident" id="4942555">i</span><span class="op" id="4942556">+</span><span class="num" id="4942557">2</span><span class="op" id="4942558">]</span>&nbsp;<span class="op" id="4942560">=</span>&nbsp;<span class="ident" id="4942562">c1</span><span class="op" id="4942564">.</span><span class="ident" id="4942565">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942568">p</span><span class="op" id="4942569">.</span><span class="ident" id="4942570">Pix</span><span class="op" id="4942573">[</span><span class="ident" id="4942574">i</span><span class="op" id="4942575">+</span><span class="num" id="4942576">3</span><span class="op" id="4942577">]</span>&nbsp;<span class="op" id="4942579">=</span>&nbsp;<span class="ident" id="4942581">c1</span><span class="op" id="4942583">.</span><span class="ident" id="4942584">A</span><br>
<span class="lineno"></span><span class="op" id="4942586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="4942589">func</span>&nbsp;<span class="op" id="4942594">(</span><span class="ident" id="4942595">p</span>&nbsp;<span class="op" id="4942597">*</span><span class="ident" id="4942598">NRGBA</span><span class="op" id="4942603">)</span>&nbsp;<span class="ident" id="4942605">SetNRGBA</span><span class="op" id="4942613">(</span><span class="ident" id="4942614">x</span><span class="op" id="4942615">,</span>&nbsp;<span class="ident" id="4942617">y</span>&nbsp;<span class="builtintype" id="4942619">int</span><span class="op" id="4942622">,</span>&nbsp;<span class="ident" id="4942624">c</span>&nbsp;<span class="ident" id="4942626">color</span><span class="op" id="4942631">.</span><span class="ident" id="4942632">NRGBA</span><span class="op" id="4942637">)</span>&nbsp;<span class="op" id="4942639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942642">if</span>&nbsp;<span class="op" id="4942645">!</span><span class="op" id="4942646">(</span><span class="ident" id="4942647">Point</span><span class="op" id="4942652">{</span><span class="ident" id="4942653">x</span><span class="op" id="4942654">,</span>&nbsp;<span class="ident" id="4942656">y</span><span class="op" id="4942657">}</span><span class="op" id="4942658">.</span><span class="ident" id="4942659">In</span><span class="op" id="4942661">(</span><span class="ident" id="4942662">p</span><span class="op" id="4942663">.</span><span class="ident" id="4942664">Rect</span><span class="op" id="4942668">)</span><span class="op" id="4942669">)</span>&nbsp;<span class="op" id="4942671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4942675">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4942683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942686">i</span>&nbsp;<span class="op" id="4942688">:=</span>&nbsp;<span class="ident" id="4942691">p</span><span class="op" id="4942692">.</span><span class="ident" id="4942693">PixOffset</span><span class="op" id="4942702">(</span><span class="ident" id="4942703">x</span><span class="op" id="4942704">,</span>&nbsp;<span class="ident" id="4942706">y</span><span class="op" id="4942707">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942710">p</span><span class="op" id="4942711">.</span><span class="ident" id="4942712">Pix</span><span class="op" id="4942715">[</span><span class="ident" id="4942716">i</span><span class="op" id="4942717">+</span><span class="num" id="4942718">0</span><span class="op" id="4942719">]</span>&nbsp;<span class="op" id="4942721">=</span>&nbsp;<span class="ident" id="4942723">c</span><span class="op" id="4942724">.</span><span class="ident" id="4942725">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942728">p</span><span class="op" id="4942729">.</span><span class="ident" id="4942730">Pix</span><span class="op" id="4942733">[</span><span class="ident" id="4942734">i</span><span class="op" id="4942735">+</span><span class="num" id="4942736">1</span><span class="op" id="4942737">]</span>&nbsp;<span class="op" id="4942739">=</span>&nbsp;<span class="ident" id="4942741">c</span><span class="op" id="4942742">.</span><span class="ident" id="4942743">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942746">p</span><span class="op" id="4942747">.</span><span class="ident" id="4942748">Pix</span><span class="op" id="4942751">[</span><span class="ident" id="4942752">i</span><span class="op" id="4942753">+</span><span class="num" id="4942754">2</span><span class="op" id="4942755">]</span>&nbsp;<span class="op" id="4942757">=</span>&nbsp;<span class="ident" id="4942759">c</span><span class="op" id="4942760">.</span><span class="ident" id="4942761">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942764">p</span><span class="op" id="4942765">.</span><span class="ident" id="4942766">Pix</span><span class="op" id="4942769">[</span><span class="ident" id="4942770">i</span><span class="op" id="4942771">+</span><span class="num" id="4942772">3</span><span class="op" id="4942773">]</span>&nbsp;<span class="op" id="4942775">=</span>&nbsp;<span class="ident" id="4942777">c</span><span class="op" id="4942778">.</span><span class="ident" id="4942779">A</span><br>
<span class="lineno"></span><span class="op" id="4942781">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4942784">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4942861">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4942933">func</span>&nbsp;<span class="op" id="4942938">(</span><span class="ident" id="4942939">p</span>&nbsp;<span class="op" id="4942941">*</span><span class="ident" id="4942942">NRGBA</span><span class="op" id="4942947">)</span>&nbsp;<span class="ident" id="4942949">SubImage</span><span class="op" id="4942957">(</span><span class="ident" id="4942958">r</span>&nbsp;<span class="ident" id="4942960">Rectangle</span><span class="op" id="4942969">)</span>&nbsp;<span class="ident" id="4942971">Image</span>&nbsp;<span class="op" id="4942977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4942980">r</span>&nbsp;<span class="op" id="4942982">=</span>&nbsp;<span class="ident" id="4942984">r</span><span class="op" id="4942985">.</span><span class="ident" id="4942986">Intersect</span><span class="op" id="4942995">(</span><span class="ident" id="4942996">p</span><span class="op" id="4942997">.</span><span class="ident" id="4942998">Rect</span><span class="op" id="4943002">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4943005">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4943086">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4943168">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943218">if</span>&nbsp;<span class="ident" id="4943221">r</span><span class="op" id="4943222">.</span><span class="ident" id="4943223">Empty</span><span class="op" id="4943228">(</span><span class="op" id="4943229">)</span>&nbsp;<span class="op" id="4943231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943235">return</span>&nbsp;<span class="op" id="4943242">&amp;</span><span class="ident" id="4943243">NRGBA</span><span class="op" id="4943248">{</span><span class="op" id="4943249">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943255">i</span>&nbsp;<span class="op" id="4943257">:=</span>&nbsp;<span class="ident" id="4943260">p</span><span class="op" id="4943261">.</span><span class="ident" id="4943262">PixOffset</span><span class="op" id="4943271">(</span><span class="ident" id="4943272">r</span><span class="op" id="4943273">.</span><span class="ident" id="4943274">Min</span><span class="op" id="4943277">.</span><span class="ident" id="4943278">X</span><span class="op" id="4943279">,</span>&nbsp;<span class="ident" id="4943281">r</span><span class="op" id="4943282">.</span><span class="ident" id="4943283">Min</span><span class="op" id="4943286">.</span><span class="ident" id="4943287">Y</span><span class="op" id="4943288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943291">return</span>&nbsp;<span class="op" id="4943298">&amp;</span><span class="ident" id="4943299">NRGBA</span><span class="op" id="4943304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943308">Pix</span><span class="op" id="4943311">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943316">p</span><span class="op" id="4943317">.</span><span class="ident" id="4943318">Pix</span><span class="op" id="4943321">[</span><span class="ident" id="4943322">i</span><span class="op" id="4943323">:</span><span class="op" id="4943324">]</span><span class="op" id="4943325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943329">Stride</span><span class="op" id="4943335">:</span>&nbsp;<span class="ident" id="4943337">p</span><span class="op" id="4943338">.</span><span class="ident" id="4943339">Stride</span><span class="op" id="4943345">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943349">Rect</span><span class="op" id="4943353">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4943357">r</span><span class="op" id="4943358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943361">}</span><br>
<span class="lineno"></span><span class="op" id="4943363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4943366">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="4943439">func</span>&nbsp;<span class="op" id="4943444">(</span><span class="ident" id="4943445">p</span>&nbsp;<span class="op" id="4943447">*</span><span class="ident" id="4943448">NRGBA</span><span class="op" id="4943453">)</span>&nbsp;<span class="ident" id="4943455">Opaque</span><span class="op" id="4943461">(</span><span class="op" id="4943462">)</span>&nbsp;<span class="builtintype" id="4943464">bool</span>&nbsp;<span class="op" id="4943469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943472">if</span>&nbsp;<span class="ident" id="4943475">p</span><span class="op" id="4943476">.</span><span class="ident" id="4943477">Rect</span><span class="op" id="4943481">.</span><span class="ident" id="4943482">Empty</span><span class="op" id="4943487">(</span><span class="op" id="4943488">)</span>&nbsp;<span class="op" id="4943490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943494">return</span>&nbsp;<span class="builtintype" id="4943501">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943510">i0</span><span class="op" id="4943512">,</span>&nbsp;<span class="ident" id="4943514">i1</span>&nbsp;<span class="op" id="4943517">:=</span>&nbsp;<span class="num" id="4943520">3</span><span class="op" id="4943521">,</span>&nbsp;<span class="ident" id="4943523">p</span><span class="op" id="4943524">.</span><span class="ident" id="4943525">Rect</span><span class="op" id="4943529">.</span><span class="ident" id="4943530">Dx</span><span class="op" id="4943532">(</span><span class="op" id="4943533">)</span><span class="op" id="4943534">*</span><span class="num" id="4943535">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943538">for</span>&nbsp;<span class="ident" id="4943542">y</span>&nbsp;<span class="op" id="4943544">:=</span>&nbsp;<span class="ident" id="4943547">p</span><span class="op" id="4943548">.</span><span class="ident" id="4943549">Rect</span><span class="op" id="4943553">.</span><span class="ident" id="4943554">Min</span><span class="op" id="4943557">.</span><span class="ident" id="4943558">Y</span><span class="op" id="4943559">;</span>&nbsp;<span class="ident" id="4943561">y</span>&nbsp;<span class="op" id="4943563">&lt;</span>&nbsp;<span class="ident" id="4943565">p</span><span class="op" id="4943566">.</span><span class="ident" id="4943567">Rect</span><span class="op" id="4943571">.</span><span class="ident" id="4943572">Max</span><span class="op" id="4943575">.</span><span class="ident" id="4943576">Y</span><span class="op" id="4943577">;</span>&nbsp;<span class="ident" id="4943579">y</span><span class="op" id="4943580">++</span>&nbsp;<span class="op" id="4943583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943587">for</span>&nbsp;<span class="ident" id="4943591">i</span>&nbsp;<span class="op" id="4943593">:=</span>&nbsp;<span class="ident" id="4943596">i0</span><span class="op" id="4943598">;</span>&nbsp;<span class="ident" id="4943600">i</span>&nbsp;<span class="op" id="4943602">&lt;</span>&nbsp;<span class="ident" id="4943604">i1</span><span class="op" id="4943606">;</span>&nbsp;<span class="ident" id="4943608">i</span>&nbsp;<span class="op" id="4943610">+=</span>&nbsp;<span class="num" id="4943613">4</span>&nbsp;<span class="op" id="4943615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943620">if</span>&nbsp;<span class="ident" id="4943623">p</span><span class="op" id="4943624">.</span><span class="ident" id="4943625">Pix</span><span class="op" id="4943628">[</span><span class="ident" id="4943629">i</span><span class="op" id="4943630">]</span>&nbsp;<span class="op" id="4943632">!=</span>&nbsp;<span class="num" id="4943635">0xff</span>&nbsp;<span class="op" id="4943640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943646">return</span>&nbsp;<span class="builtintype" id="4943653">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943662">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943670">i0</span>&nbsp;<span class="op" id="4943673">+=</span>&nbsp;<span class="ident" id="4943676">p</span><span class="op" id="4943677">.</span><span class="ident" id="4943678">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943687">i1</span>&nbsp;<span class="op" id="4943690">+=</span>&nbsp;<span class="ident" id="4943693">p</span><span class="op" id="4943694">.</span><span class="ident" id="4943695">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4943703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943706">return</span>&nbsp;<span class="builtintype" id="4943713">true</span><br>
<span class="lineno">360</span><span class="op" id="4943718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4943721">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4943776">func</span>&nbsp;<span class="ident" id="4943781">NewNRGBA</span><span class="op" id="4943789">(</span><span class="ident" id="4943790">r</span>&nbsp;<span class="ident" id="4943792">Rectangle</span><span class="op" id="4943801">)</span>&nbsp;<span class="op" id="4943803">*</span><span class="ident" id="4943804">NRGBA</span>&nbsp;<span class="op" id="4943810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943813">w</span><span class="op" id="4943814">,</span>&nbsp;<span class="ident" id="4943816">h</span>&nbsp;<span class="op" id="4943818">:=</span>&nbsp;<span class="ident" id="4943821">r</span><span class="op" id="4943822">.</span><span class="ident" id="4943823">Dx</span><span class="op" id="4943825">(</span><span class="op" id="4943826">)</span><span class="op" id="4943827">,</span>&nbsp;<span class="ident" id="4943829">r</span><span class="op" id="4943830">.</span><span class="ident" id="4943831">Dy</span><span class="op" id="4943833">(</span><span class="op" id="4943834">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4943837">pix</span>&nbsp;<span class="op" id="4943841">:=</span>&nbsp;<span class="builtinfunc" id="4943844">make</span><span class="op" id="4943848">(</span><span class="op" id="4943849">[</span><span class="op" id="4943850">]</span><span class="builtintype" id="4943851">uint8</span><span class="op" id="4943856">,</span>&nbsp;<span class="num" id="4943858">4</span><span class="op" id="4943859">*</span><span class="ident" id="4943860">w</span><span class="op" id="4943861">*</span><span class="ident" id="4943862">h</span><span class="op" id="4943863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4943866">return</span>&nbsp;<span class="op" id="4943873">&amp;</span><span class="ident" id="4943874">NRGBA</span><span class="op" id="4943879">{</span><span class="ident" id="4943880">pix</span><span class="op" id="4943883">,</span>&nbsp;<span class="num" id="4943885">4</span>&nbsp;<span class="op" id="4943887">*</span>&nbsp;<span class="ident" id="4943889">w</span><span class="op" id="4943890">,</span>&nbsp;<span class="ident" id="4943892">r</span><span class="op" id="4943893">}</span><br>
<span class="lineno"></span><span class="op" id="4943895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4943898">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="4943977">type</span>&nbsp;<span class="ident" id="4943982">NRGBA64</span>&nbsp;<span class="keyword" id="4943990">struct</span>&nbsp;<span class="op" id="4943997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4944000">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4944090">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944158">Pix</span>&nbsp;<span class="op" id="4944162">[</span><span class="op" id="4944163">]</span><span class="builtintype" id="4944164">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4944171">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944247">Stride</span>&nbsp;<span class="builtintype" id="4944254">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4944259">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944291">Rect</span>&nbsp;<span class="ident" id="4944296">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4944306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4944309">func</span>&nbsp;<span class="op" id="4944314">(</span><span class="ident" id="4944315">p</span>&nbsp;<span class="op" id="4944317">*</span><span class="ident" id="4944318">NRGBA64</span><span class="op" id="4944325">)</span>&nbsp;<span class="ident" id="4944327">ColorModel</span><span class="op" id="4944337">(</span><span class="op" id="4944338">)</span>&nbsp;<span class="ident" id="4944340">color</span><span class="op" id="4944345">.</span><span class="ident" id="4944346">Model</span>&nbsp;<span class="op" id="4944352">{</span>&nbsp;<span class="keyword" id="4944354">return</span>&nbsp;<span class="ident" id="4944361">color</span><span class="op" id="4944366">.</span><span class="ident" id="4944367">NRGBA64Model</span>&nbsp;<span class="op" id="4944380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4944383">func</span>&nbsp;<span class="op" id="4944388">(</span><span class="ident" id="4944389">p</span>&nbsp;<span class="op" id="4944391">*</span><span class="ident" id="4944392">NRGBA64</span><span class="op" id="4944399">)</span>&nbsp;<span class="ident" id="4944401">Bounds</span><span class="op" id="4944407">(</span><span class="op" id="4944408">)</span>&nbsp;<span class="ident" id="4944410">Rectangle</span>&nbsp;<span class="op" id="4944420">{</span>&nbsp;<span class="keyword" id="4944422">return</span>&nbsp;<span class="ident" id="4944429">p</span><span class="op" id="4944430">.</span><span class="ident" id="4944431">Rect</span>&nbsp;<span class="op" id="4944436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4944439">func</span>&nbsp;<span class="op" id="4944444">(</span><span class="ident" id="4944445">p</span>&nbsp;<span class="op" id="4944447">*</span><span class="ident" id="4944448">NRGBA64</span><span class="op" id="4944455">)</span>&nbsp;<span class="ident" id="4944457">At</span><span class="op" id="4944459">(</span><span class="ident" id="4944460">x</span><span class="op" id="4944461">,</span>&nbsp;<span class="ident" id="4944463">y</span>&nbsp;<span class="builtintype" id="4944465">int</span><span class="op" id="4944468">)</span>&nbsp;<span class="ident" id="4944470">color</span><span class="op" id="4944475">.</span><span class="ident" id="4944476">Color</span>&nbsp;<span class="op" id="4944482">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944485">return</span>&nbsp;<span class="ident" id="4944492">p</span><span class="op" id="4944493">.</span><span class="ident" id="4944494">NRGBA64At</span><span class="op" id="4944503">(</span><span class="ident" id="4944504">x</span><span class="op" id="4944505">,</span>&nbsp;<span class="ident" id="4944507">y</span><span class="op" id="4944508">)</span><br>
<span class="lineno"></span><span class="op" id="4944510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4944513">func</span>&nbsp;<span class="op" id="4944518">(</span><span class="ident" id="4944519">p</span>&nbsp;<span class="op" id="4944521">*</span><span class="ident" id="4944522">NRGBA64</span><span class="op" id="4944529">)</span>&nbsp;<span class="ident" id="4944531">NRGBA64At</span><span class="op" id="4944540">(</span><span class="ident" id="4944541">x</span><span class="op" id="4944542">,</span>&nbsp;<span class="ident" id="4944544">y</span>&nbsp;<span class="builtintype" id="4944546">int</span><span class="op" id="4944549">)</span>&nbsp;<span class="ident" id="4944551">color</span><span class="op" id="4944556">.</span><span class="ident" id="4944557">NRGBA64</span>&nbsp;<span class="op" id="4944565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944568">if</span>&nbsp;<span class="op" id="4944571">!</span><span class="op" id="4944572">(</span><span class="ident" id="4944573">Point</span><span class="op" id="4944578">{</span><span class="ident" id="4944579">x</span><span class="op" id="4944580">,</span>&nbsp;<span class="ident" id="4944582">y</span><span class="op" id="4944583">}</span><span class="op" id="4944584">.</span><span class="ident" id="4944585">In</span><span class="op" id="4944587">(</span><span class="ident" id="4944588">p</span><span class="op" id="4944589">.</span><span class="ident" id="4944590">Rect</span><span class="op" id="4944594">)</span><span class="op" id="4944595">)</span>&nbsp;<span class="op" id="4944597">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944601">return</span>&nbsp;<span class="ident" id="4944608">color</span><span class="op" id="4944613">.</span><span class="ident" id="4944614">NRGBA64</span><span class="op" id="4944621">{</span><span class="op" id="4944622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4944625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4944628">i</span>&nbsp;<span class="op" id="4944630">:=</span>&nbsp;<span class="ident" id="4944633">p</span><span class="op" id="4944634">.</span><span class="ident" id="4944635">PixOffset</span><span class="op" id="4944644">(</span><span class="ident" id="4944645">x</span><span class="op" id="4944646">,</span>&nbsp;<span class="ident" id="4944648">y</span><span class="op" id="4944649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4944652">return</span>&nbsp;<span class="ident" id="4944659">color</span><span class="op" id="4944664">.</span><span class="ident" id="4944665">NRGBA64</span><span class="op" id="4944672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4944676">uint16</span><span class="op" id="4944682">(</span><span class="ident" id="4944683">p</span><span class="op" id="4944684">.</span><span class="ident" id="4944685">Pix</span><span class="op" id="4944688">[</span><span class="ident" id="4944689">i</span><span class="op" id="4944690">+</span><span class="num" id="4944691">0</span><span class="op" id="4944692">]</span><span class="op" id="4944693">)</span><span class="op" id="4944694">&lt;&lt;</span><span class="num" id="4944696">8</span>&nbsp;<span class="op" id="4944698">|</span>&nbsp;<span class="builtintype" id="4944700">uint16</span><span class="op" id="4944706">(</span><span class="ident" id="4944707">p</span><span class="op" id="4944708">.</span><span class="ident" id="4944709">Pix</span><span class="op" id="4944712">[</span><span class="ident" id="4944713">i</span><span class="op" id="4944714">+</span><span class="num" id="4944715">1</span><span class="op" id="4944716">]</span><span class="op" id="4944717">)</span><span class="op" id="4944718">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4944722">uint16</span><span class="op" id="4944728">(</span><span class="ident" id="4944729">p</span><span class="op" id="4944730">.</span><span class="ident" id="4944731">Pix</span><span class="op" id="4944734">[</span><span class="ident" id="4944735">i</span><span class="op" id="4944736">+</span><span class="num" id="4944737">2</span><span class="op" id="4944738">]</span><span class="op" id="4944739">)</span><span class="op" id="4944740">&lt;&lt;</span><span class="num" id="4944742">8</span>&nbsp;<span class="op" id="4944744">|</span>&nbsp;<span class="builtintype" id="4944746">uint16</span><span class="op" id="4944752">(</span><span class="ident" id="4944753">p</span><span class="op" id="4944754">.</span><span class="ident" id="4944755">Pix</span><span class="op" id="4944758">[</span><span class="ident" id="4944759">i</span><span class="op" id="4944760">+</span><span class="num" id="4944761">3</span><span class="op" id="4944762">]</span><span class="op" id="4944763">)</span><span class="op" id="4944764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4944768">uint16</span><span class="op" id="4944774">(</span><span class="ident" id="4944775">p</span><span class="op" id="4944776">.</span><span class="ident" id="4944777">Pix</span><span class="op" id="4944780">[</span><span class="ident" id="4944781">i</span><span class="op" id="4944782">+</span><span class="num" id="4944783">4</span><span class="op" id="4944784">]</span><span class="op" id="4944785">)</span><span class="op" id="4944786">&lt;&lt;</span><span class="num" id="4944788">8</span>&nbsp;<span class="op" id="4944790">|</span>&nbsp;<span class="builtintype" id="4944792">uint16</span><span class="op" id="4944798">(</span><span class="ident" id="4944799">p</span><span class="op" id="4944800">.</span><span class="ident" id="4944801">Pix</span><span class="op" id="4944804">[</span><span class="ident" id="4944805">i</span><span class="op" id="4944806">+</span><span class="num" id="4944807">5</span><span class="op" id="4944808">]</span><span class="op" id="4944809">)</span><span class="op" id="4944810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4944814">uint16</span><span class="op" id="4944820">(</span><span class="ident" id="4944821">p</span><span class="op" id="4944822">.</span><span class="ident" id="4944823">Pix</span><span class="op" id="4944826">[</span><span class="ident" id="4944827">i</span><span class="op" id="4944828">+</span><span class="num" id="4944829">6</span><span class="op" id="4944830">]</span><span class="op" id="4944831">)</span><span class="op" id="4944832">&lt;&lt;</span><span class="num" id="4944834">8</span>&nbsp;<span class="op" id="4944836">|</span>&nbsp;<span class="builtintype" id="4944838">uint16</span><span class="op" id="4944844">(</span><span class="ident" id="4944845">p</span><span class="op" id="4944846">.</span><span class="ident" id="4944847">Pix</span><span class="op" id="4944850">[</span><span class="ident" id="4944851">i</span><span class="op" id="4944852">+</span><span class="num" id="4944853">7</span><span class="op" id="4944854">]</span><span class="op" id="4944855">)</span><span class="op" id="4944856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4944859">}</span><br>
<span class="lineno"></span><span class="op" id="4944861">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="4944864">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4944943">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4944967">func</span>&nbsp;<span class="op" id="4944972">(</span><span class="ident" id="4944973">p</span>&nbsp;<span class="op" id="4944975">*</span><span class="ident" id="4944976">NRGBA64</span><span class="op" id="4944983">)</span>&nbsp;<span class="ident" id="4944985">PixOffset</span><span class="op" id="4944994">(</span><span class="ident" id="4944995">x</span><span class="op" id="4944996">,</span>&nbsp;<span class="ident" id="4944998">y</span>&nbsp;<span class="builtintype" id="4945000">int</span><span class="op" id="4945003">)</span>&nbsp;<span class="builtintype" id="4945005">int</span>&nbsp;<span class="op" id="4945009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945012">return</span>&nbsp;<span class="op" id="4945019">(</span><span class="ident" id="4945020">y</span><span class="op" id="4945021">-</span><span class="ident" id="4945022">p</span><span class="op" id="4945023">.</span><span class="ident" id="4945024">Rect</span><span class="op" id="4945028">.</span><span class="ident" id="4945029">Min</span><span class="op" id="4945032">.</span><span class="ident" id="4945033">Y</span><span class="op" id="4945034">)</span><span class="op" id="4945035">*</span><span class="ident" id="4945036">p</span><span class="op" id="4945037">.</span><span class="ident" id="4945038">Stride</span>&nbsp;<span class="op" id="4945045">+</span>&nbsp;<span class="op" id="4945047">(</span><span class="ident" id="4945048">x</span><span class="op" id="4945049">-</span><span class="ident" id="4945050">p</span><span class="op" id="4945051">.</span><span class="ident" id="4945052">Rect</span><span class="op" id="4945056">.</span><span class="ident" id="4945057">Min</span><span class="op" id="4945060">.</span><span class="ident" id="4945061">X</span><span class="op" id="4945062">)</span><span class="op" id="4945063">*</span><span class="num" id="4945064">8</span><br>
<span class="lineno">405</span><span class="op" id="4945066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4945069">func</span>&nbsp;<span class="op" id="4945074">(</span><span class="ident" id="4945075">p</span>&nbsp;<span class="op" id="4945077">*</span><span class="ident" id="4945078">NRGBA64</span><span class="op" id="4945085">)</span>&nbsp;<span class="ident" id="4945087">Set</span><span class="op" id="4945090">(</span><span class="ident" id="4945091">x</span><span class="op" id="4945092">,</span>&nbsp;<span class="ident" id="4945094">y</span>&nbsp;<span class="builtintype" id="4945096">int</span><span class="op" id="4945099">,</span>&nbsp;<span class="ident" id="4945101">c</span>&nbsp;<span class="ident" id="4945103">color</span><span class="op" id="4945108">.</span><span class="ident" id="4945109">Color</span><span class="op" id="4945114">)</span>&nbsp;<span class="op" id="4945116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945119">if</span>&nbsp;<span class="op" id="4945122">!</span><span class="op" id="4945123">(</span><span class="ident" id="4945124">Point</span><span class="op" id="4945129">{</span><span class="ident" id="4945130">x</span><span class="op" id="4945131">,</span>&nbsp;<span class="ident" id="4945133">y</span><span class="op" id="4945134">}</span><span class="op" id="4945135">.</span><span class="ident" id="4945136">In</span><span class="op" id="4945138">(</span><span class="ident" id="4945139">p</span><span class="op" id="4945140">.</span><span class="ident" id="4945141">Rect</span><span class="op" id="4945145">)</span><span class="op" id="4945146">)</span>&nbsp;<span class="op" id="4945148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945152">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4945160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945163">i</span>&nbsp;<span class="op" id="4945165">:=</span>&nbsp;<span class="ident" id="4945168">p</span><span class="op" id="4945169">.</span><span class="ident" id="4945170">PixOffset</span><span class="op" id="4945179">(</span><span class="ident" id="4945180">x</span><span class="op" id="4945181">,</span>&nbsp;<span class="ident" id="4945183">y</span><span class="op" id="4945184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945187">c1</span>&nbsp;<span class="op" id="4945190">:=</span>&nbsp;<span class="ident" id="4945193">color</span><span class="op" id="4945198">.</span><span class="ident" id="4945199">NRGBA64Model</span><span class="op" id="4945211">.</span><span class="ident" id="4945212">Convert</span><span class="op" id="4945219">(</span><span class="ident" id="4945220">c</span><span class="op" id="4945221">)</span><span class="op" id="4945222">.</span><span class="op" id="4945223">(</span><span class="ident" id="4945224">color</span><span class="op" id="4945229">.</span><span class="ident" id="4945230">NRGBA64</span><span class="op" id="4945237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945240">p</span><span class="op" id="4945241">.</span><span class="ident" id="4945242">Pix</span><span class="op" id="4945245">[</span><span class="ident" id="4945246">i</span><span class="op" id="4945247">+</span><span class="num" id="4945248">0</span><span class="op" id="4945249">]</span>&nbsp;<span class="op" id="4945251">=</span>&nbsp;<span class="builtintype" id="4945253">uint8</span><span class="op" id="4945258">(</span><span class="ident" id="4945259">c1</span><span class="op" id="4945261">.</span><span class="ident" id="4945262">R</span>&nbsp;<span class="op" id="4945264">&gt;&gt;</span>&nbsp;<span class="num" id="4945267">8</span><span class="op" id="4945268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945271">p</span><span class="op" id="4945272">.</span><span class="ident" id="4945273">Pix</span><span class="op" id="4945276">[</span><span class="ident" id="4945277">i</span><span class="op" id="4945278">+</span><span class="num" id="4945279">1</span><span class="op" id="4945280">]</span>&nbsp;<span class="op" id="4945282">=</span>&nbsp;<span class="builtintype" id="4945284">uint8</span><span class="op" id="4945289">(</span><span class="ident" id="4945290">c1</span><span class="op" id="4945292">.</span><span class="ident" id="4945293">R</span><span class="op" id="4945294">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945297">p</span><span class="op" id="4945298">.</span><span class="ident" id="4945299">Pix</span><span class="op" id="4945302">[</span><span class="ident" id="4945303">i</span><span class="op" id="4945304">+</span><span class="num" id="4945305">2</span><span class="op" id="4945306">]</span>&nbsp;<span class="op" id="4945308">=</span>&nbsp;<span class="builtintype" id="4945310">uint8</span><span class="op" id="4945315">(</span><span class="ident" id="4945316">c1</span><span class="op" id="4945318">.</span><span class="ident" id="4945319">G</span>&nbsp;<span class="op" id="4945321">&gt;&gt;</span>&nbsp;<span class="num" id="4945324">8</span><span class="op" id="4945325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945328">p</span><span class="op" id="4945329">.</span><span class="ident" id="4945330">Pix</span><span class="op" id="4945333">[</span><span class="ident" id="4945334">i</span><span class="op" id="4945335">+</span><span class="num" id="4945336">3</span><span class="op" id="4945337">]</span>&nbsp;<span class="op" id="4945339">=</span>&nbsp;<span class="builtintype" id="4945341">uint8</span><span class="op" id="4945346">(</span><span class="ident" id="4945347">c1</span><span class="op" id="4945349">.</span><span class="ident" id="4945350">G</span><span class="op" id="4945351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945354">p</span><span class="op" id="4945355">.</span><span class="ident" id="4945356">Pix</span><span class="op" id="4945359">[</span><span class="ident" id="4945360">i</span><span class="op" id="4945361">+</span><span class="num" id="4945362">4</span><span class="op" id="4945363">]</span>&nbsp;<span class="op" id="4945365">=</span>&nbsp;<span class="builtintype" id="4945367">uint8</span><span class="op" id="4945372">(</span><span class="ident" id="4945373">c1</span><span class="op" id="4945375">.</span><span class="ident" id="4945376">B</span>&nbsp;<span class="op" id="4945378">&gt;&gt;</span>&nbsp;<span class="num" id="4945381">8</span><span class="op" id="4945382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945385">p</span><span class="op" id="4945386">.</span><span class="ident" id="4945387">Pix</span><span class="op" id="4945390">[</span><span class="ident" id="4945391">i</span><span class="op" id="4945392">+</span><span class="num" id="4945393">5</span><span class="op" id="4945394">]</span>&nbsp;<span class="op" id="4945396">=</span>&nbsp;<span class="builtintype" id="4945398">uint8</span><span class="op" id="4945403">(</span><span class="ident" id="4945404">c1</span><span class="op" id="4945406">.</span><span class="ident" id="4945407">B</span><span class="op" id="4945408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945411">p</span><span class="op" id="4945412">.</span><span class="ident" id="4945413">Pix</span><span class="op" id="4945416">[</span><span class="ident" id="4945417">i</span><span class="op" id="4945418">+</span><span class="num" id="4945419">6</span><span class="op" id="4945420">]</span>&nbsp;<span class="op" id="4945422">=</span>&nbsp;<span class="builtintype" id="4945424">uint8</span><span class="op" id="4945429">(</span><span class="ident" id="4945430">c1</span><span class="op" id="4945432">.</span><span class="ident" id="4945433">A</span>&nbsp;<span class="op" id="4945435">&gt;&gt;</span>&nbsp;<span class="num" id="4945438">8</span><span class="op" id="4945439">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945442">p</span><span class="op" id="4945443">.</span><span class="ident" id="4945444">Pix</span><span class="op" id="4945447">[</span><span class="ident" id="4945448">i</span><span class="op" id="4945449">+</span><span class="num" id="4945450">7</span><span class="op" id="4945451">]</span>&nbsp;<span class="op" id="4945453">=</span>&nbsp;<span class="builtintype" id="4945455">uint8</span><span class="op" id="4945460">(</span><span class="ident" id="4945461">c1</span><span class="op" id="4945463">.</span><span class="ident" id="4945464">A</span><span class="op" id="4945465">)</span><br>
<span class="lineno"></span><span class="op" id="4945467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4945470">func</span>&nbsp;<span class="op" id="4945475">(</span><span class="ident" id="4945476">p</span>&nbsp;<span class="op" id="4945478">*</span><span class="ident" id="4945479">NRGBA64</span><span class="op" id="4945486">)</span>&nbsp;<span class="ident" id="4945488">SetNRGBA64</span><span class="op" id="4945498">(</span><span class="ident" id="4945499">x</span><span class="op" id="4945500">,</span>&nbsp;<span class="ident" id="4945502">y</span>&nbsp;<span class="builtintype" id="4945504">int</span><span class="op" id="4945507">,</span>&nbsp;<span class="ident" id="4945509">c</span>&nbsp;<span class="ident" id="4945511">color</span><span class="op" id="4945516">.</span><span class="ident" id="4945517">NRGBA64</span><span class="op" id="4945524">)</span>&nbsp;<span class="op" id="4945526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945529">if</span>&nbsp;<span class="op" id="4945532">!</span><span class="op" id="4945533">(</span><span class="ident" id="4945534">Point</span><span class="op" id="4945539">{</span><span class="ident" id="4945540">x</span><span class="op" id="4945541">,</span>&nbsp;<span class="ident" id="4945543">y</span><span class="op" id="4945544">}</span><span class="op" id="4945545">.</span><span class="ident" id="4945546">In</span><span class="op" id="4945548">(</span><span class="ident" id="4945549">p</span><span class="op" id="4945550">.</span><span class="ident" id="4945551">Rect</span><span class="op" id="4945555">)</span><span class="op" id="4945556">)</span>&nbsp;<span class="op" id="4945558">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4945562">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4945570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945573">i</span>&nbsp;<span class="op" id="4945575">:=</span>&nbsp;<span class="ident" id="4945578">p</span><span class="op" id="4945579">.</span><span class="ident" id="4945580">PixOffset</span><span class="op" id="4945589">(</span><span class="ident" id="4945590">x</span><span class="op" id="4945591">,</span>&nbsp;<span class="ident" id="4945593">y</span><span class="op" id="4945594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945597">p</span><span class="op" id="4945598">.</span><span class="ident" id="4945599">Pix</span><span class="op" id="4945602">[</span><span class="ident" id="4945603">i</span><span class="op" id="4945604">+</span><span class="num" id="4945605">0</span><span class="op" id="4945606">]</span>&nbsp;<span class="op" id="4945608">=</span>&nbsp;<span class="builtintype" id="4945610">uint8</span><span class="op" id="4945615">(</span><span class="ident" id="4945616">c</span><span class="op" id="4945617">.</span><span class="ident" id="4945618">R</span>&nbsp;<span class="op" id="4945620">&gt;&gt;</span>&nbsp;<span class="num" id="4945623">8</span><span class="op" id="4945624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945627">p</span><span class="op" id="4945628">.</span><span class="ident" id="4945629">Pix</span><span class="op" id="4945632">[</span><span class="ident" id="4945633">i</span><span class="op" id="4945634">+</span><span class="num" id="4945635">1</span><span class="op" id="4945636">]</span>&nbsp;<span class="op" id="4945638">=</span>&nbsp;<span class="builtintype" id="4945640">uint8</span><span class="op" id="4945645">(</span><span class="ident" id="4945646">c</span><span class="op" id="4945647">.</span><span class="ident" id="4945648">R</span><span class="op" id="4945649">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945652">p</span><span class="op" id="4945653">.</span><span class="ident" id="4945654">Pix</span><span class="op" id="4945657">[</span><span class="ident" id="4945658">i</span><span class="op" id="4945659">+</span><span class="num" id="4945660">2</span><span class="op" id="4945661">]</span>&nbsp;<span class="op" id="4945663">=</span>&nbsp;<span class="builtintype" id="4945665">uint8</span><span class="op" id="4945670">(</span><span class="ident" id="4945671">c</span><span class="op" id="4945672">.</span><span class="ident" id="4945673">G</span>&nbsp;<span class="op" id="4945675">&gt;&gt;</span>&nbsp;<span class="num" id="4945678">8</span><span class="op" id="4945679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945682">p</span><span class="op" id="4945683">.</span><span class="ident" id="4945684">Pix</span><span class="op" id="4945687">[</span><span class="ident" id="4945688">i</span><span class="op" id="4945689">+</span><span class="num" id="4945690">3</span><span class="op" id="4945691">]</span>&nbsp;<span class="op" id="4945693">=</span>&nbsp;<span class="builtintype" id="4945695">uint8</span><span class="op" id="4945700">(</span><span class="ident" id="4945701">c</span><span class="op" id="4945702">.</span><span class="ident" id="4945703">G</span><span class="op" id="4945704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945707">p</span><span class="op" id="4945708">.</span><span class="ident" id="4945709">Pix</span><span class="op" id="4945712">[</span><span class="ident" id="4945713">i</span><span class="op" id="4945714">+</span><span class="num" id="4945715">4</span><span class="op" id="4945716">]</span>&nbsp;<span class="op" id="4945718">=</span>&nbsp;<span class="builtintype" id="4945720">uint8</span><span class="op" id="4945725">(</span><span class="ident" id="4945726">c</span><span class="op" id="4945727">.</span><span class="ident" id="4945728">B</span>&nbsp;<span class="op" id="4945730">&gt;&gt;</span>&nbsp;<span class="num" id="4945733">8</span><span class="op" id="4945734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945737">p</span><span class="op" id="4945738">.</span><span class="ident" id="4945739">Pix</span><span class="op" id="4945742">[</span><span class="ident" id="4945743">i</span><span class="op" id="4945744">+</span><span class="num" id="4945745">5</span><span class="op" id="4945746">]</span>&nbsp;<span class="op" id="4945748">=</span>&nbsp;<span class="builtintype" id="4945750">uint8</span><span class="op" id="4945755">(</span><span class="ident" id="4945756">c</span><span class="op" id="4945757">.</span><span class="ident" id="4945758">B</span><span class="op" id="4945759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945762">p</span><span class="op" id="4945763">.</span><span class="ident" id="4945764">Pix</span><span class="op" id="4945767">[</span><span class="ident" id="4945768">i</span><span class="op" id="4945769">+</span><span class="num" id="4945770">6</span><span class="op" id="4945771">]</span>&nbsp;<span class="op" id="4945773">=</span>&nbsp;<span class="builtintype" id="4945775">uint8</span><span class="op" id="4945780">(</span><span class="ident" id="4945781">c</span><span class="op" id="4945782">.</span><span class="ident" id="4945783">A</span>&nbsp;<span class="op" id="4945785">&gt;&gt;</span>&nbsp;<span class="num" id="4945788">8</span><span class="op" id="4945789">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945792">p</span><span class="op" id="4945793">.</span><span class="ident" id="4945794">Pix</span><span class="op" id="4945797">[</span><span class="ident" id="4945798">i</span><span class="op" id="4945799">+</span><span class="num" id="4945800">7</span><span class="op" id="4945801">]</span>&nbsp;<span class="op" id="4945803">=</span>&nbsp;<span class="builtintype" id="4945805">uint8</span><span class="op" id="4945810">(</span><span class="ident" id="4945811">c</span><span class="op" id="4945812">.</span><span class="ident" id="4945813">A</span><span class="op" id="4945814">)</span><br>
<span class="lineno"></span><span class="op" id="4945816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4945819">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4945896">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="4945968">func</span>&nbsp;<span class="op" id="4945973">(</span><span class="ident" id="4945974">p</span>&nbsp;<span class="op" id="4945976">*</span><span class="ident" id="4945977">NRGBA64</span><span class="op" id="4945984">)</span>&nbsp;<span class="ident" id="4945986">SubImage</span><span class="op" id="4945994">(</span><span class="ident" id="4945995">r</span>&nbsp;<span class="ident" id="4945997">Rectangle</span><span class="op" id="4946006">)</span>&nbsp;<span class="ident" id="4946008">Image</span>&nbsp;<span class="op" id="4946014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946017">r</span>&nbsp;<span class="op" id="4946019">=</span>&nbsp;<span class="ident" id="4946021">r</span><span class="op" id="4946022">.</span><span class="ident" id="4946023">Intersect</span><span class="op" id="4946032">(</span><span class="ident" id="4946033">p</span><span class="op" id="4946034">.</span><span class="ident" id="4946035">Rect</span><span class="op" id="4946039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4946042">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4946123">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4946205">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946255">if</span>&nbsp;<span class="ident" id="4946258">r</span><span class="op" id="4946259">.</span><span class="ident" id="4946260">Empty</span><span class="op" id="4946265">(</span><span class="op" id="4946266">)</span>&nbsp;<span class="op" id="4946268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946272">return</span>&nbsp;<span class="op" id="4946279">&amp;</span><span class="ident" id="4946280">NRGBA64</span><span class="op" id="4946287">{</span><span class="op" id="4946288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946294">i</span>&nbsp;<span class="op" id="4946296">:=</span>&nbsp;<span class="ident" id="4946299">p</span><span class="op" id="4946300">.</span><span class="ident" id="4946301">PixOffset</span><span class="op" id="4946310">(</span><span class="ident" id="4946311">r</span><span class="op" id="4946312">.</span><span class="ident" id="4946313">Min</span><span class="op" id="4946316">.</span><span class="ident" id="4946317">X</span><span class="op" id="4946318">,</span>&nbsp;<span class="ident" id="4946320">r</span><span class="op" id="4946321">.</span><span class="ident" id="4946322">Min</span><span class="op" id="4946325">.</span><span class="ident" id="4946326">Y</span><span class="op" id="4946327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946330">return</span>&nbsp;<span class="op" id="4946337">&amp;</span><span class="ident" id="4946338">NRGBA64</span><span class="op" id="4946345">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946349">Pix</span><span class="op" id="4946352">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946357">p</span><span class="op" id="4946358">.</span><span class="ident" id="4946359">Pix</span><span class="op" id="4946362">[</span><span class="ident" id="4946363">i</span><span class="op" id="4946364">:</span><span class="op" id="4946365">]</span><span class="op" id="4946366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946370">Stride</span><span class="op" id="4946376">:</span>&nbsp;<span class="ident" id="4946378">p</span><span class="op" id="4946379">.</span><span class="ident" id="4946380">Stride</span><span class="op" id="4946386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946390">Rect</span><span class="op" id="4946394">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4946398">r</span><span class="op" id="4946399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946402">}</span><br>
<span class="lineno"></span><span class="op" id="4946404">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="4946407">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4946480">func</span>&nbsp;<span class="op" id="4946485">(</span><span class="ident" id="4946486">p</span>&nbsp;<span class="op" id="4946488">*</span><span class="ident" id="4946489">NRGBA64</span><span class="op" id="4946496">)</span>&nbsp;<span class="ident" id="4946498">Opaque</span><span class="op" id="4946504">(</span><span class="op" id="4946505">)</span>&nbsp;<span class="builtintype" id="4946507">bool</span>&nbsp;<span class="op" id="4946512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946515">if</span>&nbsp;<span class="ident" id="4946518">p</span><span class="op" id="4946519">.</span><span class="ident" id="4946520">Rect</span><span class="op" id="4946524">.</span><span class="ident" id="4946525">Empty</span><span class="op" id="4946530">(</span><span class="op" id="4946531">)</span>&nbsp;<span class="op" id="4946533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946537">return</span>&nbsp;<span class="builtintype" id="4946544">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946553">i0</span><span class="op" id="4946555">,</span>&nbsp;<span class="ident" id="4946557">i1</span>&nbsp;<span class="op" id="4946560">:=</span>&nbsp;<span class="num" id="4946563">6</span><span class="op" id="4946564">,</span>&nbsp;<span class="ident" id="4946566">p</span><span class="op" id="4946567">.</span><span class="ident" id="4946568">Rect</span><span class="op" id="4946572">.</span><span class="ident" id="4946573">Dx</span><span class="op" id="4946575">(</span><span class="op" id="4946576">)</span><span class="op" id="4946577">*</span><span class="num" id="4946578">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946581">for</span>&nbsp;<span class="ident" id="4946585">y</span>&nbsp;<span class="op" id="4946587">:=</span>&nbsp;<span class="ident" id="4946590">p</span><span class="op" id="4946591">.</span><span class="ident" id="4946592">Rect</span><span class="op" id="4946596">.</span><span class="ident" id="4946597">Min</span><span class="op" id="4946600">.</span><span class="ident" id="4946601">Y</span><span class="op" id="4946602">;</span>&nbsp;<span class="ident" id="4946604">y</span>&nbsp;<span class="op" id="4946606">&lt;</span>&nbsp;<span class="ident" id="4946608">p</span><span class="op" id="4946609">.</span><span class="ident" id="4946610">Rect</span><span class="op" id="4946614">.</span><span class="ident" id="4946615">Max</span><span class="op" id="4946618">.</span><span class="ident" id="4946619">Y</span><span class="op" id="4946620">;</span>&nbsp;<span class="ident" id="4946622">y</span><span class="op" id="4946623">++</span>&nbsp;<span class="op" id="4946626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946630">for</span>&nbsp;<span class="ident" id="4946634">i</span>&nbsp;<span class="op" id="4946636">:=</span>&nbsp;<span class="ident" id="4946639">i0</span><span class="op" id="4946641">;</span>&nbsp;<span class="ident" id="4946643">i</span>&nbsp;<span class="op" id="4946645">&lt;</span>&nbsp;<span class="ident" id="4946647">i1</span><span class="op" id="4946649">;</span>&nbsp;<span class="ident" id="4946651">i</span>&nbsp;<span class="op" id="4946653">+=</span>&nbsp;<span class="num" id="4946656">8</span>&nbsp;<span class="op" id="4946658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946663">if</span>&nbsp;<span class="ident" id="4946666">p</span><span class="op" id="4946667">.</span><span class="ident" id="4946668">Pix</span><span class="op" id="4946671">[</span><span class="ident" id="4946672">i</span><span class="op" id="4946673">+</span><span class="num" id="4946674">0</span><span class="op" id="4946675">]</span>&nbsp;<span class="op" id="4946677">!=</span>&nbsp;<span class="num" id="4946680">0xff</span>&nbsp;<span class="op" id="4946685">||</span>&nbsp;<span class="ident" id="4946688">p</span><span class="op" id="4946689">.</span><span class="ident" id="4946690">Pix</span><span class="op" id="4946693">[</span><span class="ident" id="4946694">i</span><span class="op" id="4946695">+</span><span class="num" id="4946696">1</span><span class="op" id="4946697">]</span>&nbsp;<span class="op" id="4946699">!=</span>&nbsp;<span class="num" id="4946702">0xff</span>&nbsp;<span class="op" id="4946707">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946713">return</span>&nbsp;<span class="builtintype" id="4946720">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946737">i0</span>&nbsp;<span class="op" id="4946740">+=</span>&nbsp;<span class="ident" id="4946743">p</span><span class="op" id="4946744">.</span><span class="ident" id="4946745">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946754">i1</span>&nbsp;<span class="op" id="4946757">+=</span>&nbsp;<span class="ident" id="4946760">p</span><span class="op" id="4946761">.</span><span class="ident" id="4946762">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946773">return</span>&nbsp;<span class="builtintype" id="4946780">true</span><br>
<span class="lineno"></span><span class="op" id="4946785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4946788">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="4946847">func</span>&nbsp;<span class="ident" id="4946852">NewNRGBA64</span><span class="op" id="4946862">(</span><span class="ident" id="4946863">r</span>&nbsp;<span class="ident" id="4946865">Rectangle</span><span class="op" id="4946874">)</span>&nbsp;<span class="op" id="4946876">*</span><span class="ident" id="4946877">NRGBA64</span>&nbsp;<span class="op" id="4946885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946888">w</span><span class="op" id="4946889">,</span>&nbsp;<span class="ident" id="4946891">h</span>&nbsp;<span class="op" id="4946893">:=</span>&nbsp;<span class="ident" id="4946896">r</span><span class="op" id="4946897">.</span><span class="ident" id="4946898">Dx</span><span class="op" id="4946900">(</span><span class="op" id="4946901">)</span><span class="op" id="4946902">,</span>&nbsp;<span class="ident" id="4946904">r</span><span class="op" id="4946905">.</span><span class="ident" id="4946906">Dy</span><span class="op" id="4946908">(</span><span class="op" id="4946909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946912">pix</span>&nbsp;<span class="op" id="4946916">:=</span>&nbsp;<span class="builtinfunc" id="4946919">make</span><span class="op" id="4946923">(</span><span class="op" id="4946924">[</span><span class="op" id="4946925">]</span><span class="builtintype" id="4946926">uint8</span><span class="op" id="4946931">,</span>&nbsp;<span class="num" id="4946933">8</span><span class="op" id="4946934">*</span><span class="ident" id="4946935">w</span><span class="op" id="4946936">*</span><span class="ident" id="4946937">h</span><span class="op" id="4946938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946941">return</span>&nbsp;<span class="op" id="4946948">&amp;</span><span class="ident" id="4946949">NRGBA64</span><span class="op" id="4946956">{</span><span class="ident" id="4946957">pix</span><span class="op" id="4946960">,</span>&nbsp;<span class="num" id="4946962">8</span>&nbsp;<span class="op" id="4946964">*</span>&nbsp;<span class="ident" id="4946966">w</span><span class="op" id="4946967">,</span>&nbsp;<span class="ident" id="4946969">r</span><span class="op" id="4946970">}</span><br>
<span class="lineno"></span><span class="op" id="4946972">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4946975">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4947050">type</span>&nbsp;<span class="ident" id="4947055">Alpha</span>&nbsp;<span class="keyword" id="4947061">struct</span>&nbsp;<span class="op" id="4947068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947071">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947135">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947203">Pix</span>&nbsp;<span class="op" id="4947207">[</span><span class="op" id="4947208">]</span><span class="builtintype" id="4947209">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947216">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947292">Stride</span>&nbsp;<span class="builtintype" id="4947299">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947304">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947336">Rect</span>&nbsp;<span class="ident" id="4947341">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="4947351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4947354">func</span>&nbsp;<span class="op" id="4947359">(</span><span class="ident" id="4947360">p</span>&nbsp;<span class="op" id="4947362">*</span><span class="ident" id="4947363">Alpha</span><span class="op" id="4947368">)</span>&nbsp;<span class="ident" id="4947370">ColorModel</span><span class="op" id="4947380">(</span><span class="op" id="4947381">)</span>&nbsp;<span class="ident" id="4947383">color</span><span class="op" id="4947388">.</span><span class="ident" id="4947389">Model</span>&nbsp;<span class="op" id="4947395">{</span>&nbsp;<span class="keyword" id="4947397">return</span>&nbsp;<span class="ident" id="4947404">color</span><span class="op" id="4947409">.</span><span class="ident" id="4947410">AlphaModel</span>&nbsp;<span class="op" id="4947421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4947424">func</span>&nbsp;<span class="op" id="4947429">(</span><span class="ident" id="4947430">p</span>&nbsp;<span class="op" id="4947432">*</span><span class="ident" id="4947433">Alpha</span><span class="op" id="4947438">)</span>&nbsp;<span class="ident" id="4947440">Bounds</span><span class="op" id="4947446">(</span><span class="op" id="4947447">)</span>&nbsp;<span class="ident" id="4947449">Rectangle</span>&nbsp;<span class="op" id="4947459">{</span>&nbsp;<span class="keyword" id="4947461">return</span>&nbsp;<span class="ident" id="4947468">p</span><span class="op" id="4947469">.</span><span class="ident" id="4947470">Rect</span>&nbsp;<span class="op" id="4947475">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="4947478">func</span>&nbsp;<span class="op" id="4947483">(</span><span class="ident" id="4947484">p</span>&nbsp;<span class="op" id="4947486">*</span><span class="ident" id="4947487">Alpha</span><span class="op" id="4947492">)</span>&nbsp;<span class="ident" id="4947494">At</span><span class="op" id="4947496">(</span><span class="ident" id="4947497">x</span><span class="op" id="4947498">,</span>&nbsp;<span class="ident" id="4947500">y</span>&nbsp;<span class="builtintype" id="4947502">int</span><span class="op" id="4947505">)</span>&nbsp;<span class="ident" id="4947507">color</span><span class="op" id="4947512">.</span><span class="ident" id="4947513">Color</span>&nbsp;<span class="op" id="4947519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947522">return</span>&nbsp;<span class="ident" id="4947529">p</span><span class="op" id="4947530">.</span><span class="ident" id="4947531">AlphaAt</span><span class="op" id="4947538">(</span><span class="ident" id="4947539">x</span><span class="op" id="4947540">,</span>&nbsp;<span class="ident" id="4947542">y</span><span class="op" id="4947543">)</span><br>
<span class="lineno"></span><span class="op" id="4947545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4947548">func</span>&nbsp;<span class="op" id="4947553">(</span><span class="ident" id="4947554">p</span>&nbsp;<span class="op" id="4947556">*</span><span class="ident" id="4947557">Alpha</span><span class="op" id="4947562">)</span>&nbsp;<span class="ident" id="4947564">AlphaAt</span><span class="op" id="4947571">(</span><span class="ident" id="4947572">x</span><span class="op" id="4947573">,</span>&nbsp;<span class="ident" id="4947575">y</span>&nbsp;<span class="builtintype" id="4947577">int</span><span class="op" id="4947580">)</span>&nbsp;<span class="ident" id="4947582">color</span><span class="op" id="4947587">.</span><span class="ident" id="4947588">Alpha</span>&nbsp;<span class="op" id="4947594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947597">if</span>&nbsp;<span class="op" id="4947600">!</span><span class="op" id="4947601">(</span><span class="ident" id="4947602">Point</span><span class="op" id="4947607">{</span><span class="ident" id="4947608">x</span><span class="op" id="4947609">,</span>&nbsp;<span class="ident" id="4947611">y</span><span class="op" id="4947612">}</span><span class="op" id="4947613">.</span><span class="ident" id="4947614">In</span><span class="op" id="4947616">(</span><span class="ident" id="4947617">p</span><span class="op" id="4947618">.</span><span class="ident" id="4947619">Rect</span><span class="op" id="4947623">)</span><span class="op" id="4947624">)</span>&nbsp;<span class="op" id="4947626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947630">return</span>&nbsp;<span class="ident" id="4947637">color</span><span class="op" id="4947642">.</span><span class="ident" id="4947643">Alpha</span><span class="op" id="4947648">{</span><span class="op" id="4947649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947655">i</span>&nbsp;<span class="op" id="4947657">:=</span>&nbsp;<span class="ident" id="4947660">p</span><span class="op" id="4947661">.</span><span class="ident" id="4947662">PixOffset</span><span class="op" id="4947671">(</span><span class="ident" id="4947672">x</span><span class="op" id="4947673">,</span>&nbsp;<span class="ident" id="4947675">y</span><span class="op" id="4947676">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947679">return</span>&nbsp;<span class="ident" id="4947686">color</span><span class="op" id="4947691">.</span><span class="ident" id="4947692">Alpha</span><span class="op" id="4947697">{</span><span class="ident" id="4947698">p</span><span class="op" id="4947699">.</span><span class="ident" id="4947700">Pix</span><span class="op" id="4947703">[</span><span class="ident" id="4947704">i</span><span class="op" id="4947705">]</span><span class="op" id="4947706">}</span><br>
<span class="lineno"></span><span class="op" id="4947708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4947711">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4947790">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="4947814">func</span>&nbsp;<span class="op" id="4947819">(</span><span class="ident" id="4947820">p</span>&nbsp;<span class="op" id="4947822">*</span><span class="ident" id="4947823">Alpha</span><span class="op" id="4947828">)</span>&nbsp;<span class="ident" id="4947830">PixOffset</span><span class="op" id="4947839">(</span><span class="ident" id="4947840">x</span><span class="op" id="4947841">,</span>&nbsp;<span class="ident" id="4947843">y</span>&nbsp;<span class="builtintype" id="4947845">int</span><span class="op" id="4947848">)</span>&nbsp;<span class="builtintype" id="4947850">int</span>&nbsp;<span class="op" id="4947854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947857">return</span>&nbsp;<span class="op" id="4947864">(</span><span class="ident" id="4947865">y</span><span class="op" id="4947866">-</span><span class="ident" id="4947867">p</span><span class="op" id="4947868">.</span><span class="ident" id="4947869">Rect</span><span class="op" id="4947873">.</span><span class="ident" id="4947874">Min</span><span class="op" id="4947877">.</span><span class="ident" id="4947878">Y</span><span class="op" id="4947879">)</span><span class="op" id="4947880">*</span><span class="ident" id="4947881">p</span><span class="op" id="4947882">.</span><span class="ident" id="4947883">Stride</span>&nbsp;<span class="op" id="4947890">+</span>&nbsp;<span class="op" id="4947892">(</span><span class="ident" id="4947893">x</span><span class="op" id="4947894">-</span><span class="ident" id="4947895">p</span><span class="op" id="4947896">.</span><span class="ident" id="4947897">Rect</span><span class="op" id="4947901">.</span><span class="ident" id="4947902">Min</span><span class="op" id="4947905">.</span><span class="ident" id="4947906">X</span><span class="op" id="4947907">)</span><span class="op" id="4947908">*</span><span class="num" id="4947909">1</span><br>
<span class="lineno"></span><span class="op" id="4947911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4947914">func</span>&nbsp;<span class="op" id="4947919">(</span><span class="ident" id="4947920">p</span>&nbsp;<span class="op" id="4947922">*</span><span class="ident" id="4947923">Alpha</span><span class="op" id="4947928">)</span>&nbsp;<span class="ident" id="4947930">Set</span><span class="op" id="4947933">(</span><span class="ident" id="4947934">x</span><span class="op" id="4947935">,</span>&nbsp;<span class="ident" id="4947937">y</span>&nbsp;<span class="builtintype" id="4947939">int</span><span class="op" id="4947942">,</span>&nbsp;<span class="ident" id="4947944">c</span>&nbsp;<span class="ident" id="4947946">color</span><span class="op" id="4947951">.</span><span class="ident" id="4947952">Color</span><span class="op" id="4947957">)</span>&nbsp;<span class="op" id="4947959">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947962">if</span>&nbsp;<span class="op" id="4947965">!</span><span class="op" id="4947966">(</span><span class="ident" id="4947967">Point</span><span class="op" id="4947972">{</span><span class="ident" id="4947973">x</span><span class="op" id="4947974">,</span>&nbsp;<span class="ident" id="4947976">y</span><span class="op" id="4947977">}</span><span class="op" id="4947978">.</span><span class="ident" id="4947979">In</span><span class="op" id="4947981">(</span><span class="ident" id="4947982">p</span><span class="op" id="4947983">.</span><span class="ident" id="4947984">Rect</span><span class="op" id="4947988">)</span><span class="op" id="4947989">)</span>&nbsp;<span class="op" id="4947991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947995">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948006">i</span>&nbsp;<span class="op" id="4948008">:=</span>&nbsp;<span class="ident" id="4948011">p</span><span class="op" id="4948012">.</span><span class="ident" id="4948013">PixOffset</span><span class="op" id="4948022">(</span><span class="ident" id="4948023">x</span><span class="op" id="4948024">,</span>&nbsp;<span class="ident" id="4948026">y</span><span class="op" id="4948027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948030">p</span><span class="op" id="4948031">.</span><span class="ident" id="4948032">Pix</span><span class="op" id="4948035">[</span><span class="ident" id="4948036">i</span><span class="op" id="4948037">]</span>&nbsp;<span class="op" id="4948039">=</span>&nbsp;<span class="ident" id="4948041">color</span><span class="op" id="4948046">.</span><span class="ident" id="4948047">AlphaModel</span><span class="op" id="4948057">.</span><span class="ident" id="4948058">Convert</span><span class="op" id="4948065">(</span><span class="ident" id="4948066">c</span><span class="op" id="4948067">)</span><span class="op" id="4948068">.</span><span class="op" id="4948069">(</span><span class="ident" id="4948070">color</span><span class="op" id="4948075">.</span><span class="ident" id="4948076">Alpha</span><span class="op" id="4948081">)</span><span class="op" id="4948082">.</span><span class="ident" id="4948083">A</span><br>
<span class="lineno">520</span><span class="op" id="4948085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4948088">func</span>&nbsp;<span class="op" id="4948093">(</span><span class="ident" id="4948094">p</span>&nbsp;<span class="op" id="4948096">*</span><span class="ident" id="4948097">Alpha</span><span class="op" id="4948102">)</span>&nbsp;<span class="ident" id="4948104">SetAlpha</span><span class="op" id="4948112">(</span><span class="ident" id="4948113">x</span><span class="op" id="4948114">,</span>&nbsp;<span class="ident" id="4948116">y</span>&nbsp;<span class="builtintype" id="4948118">int</span><span class="op" id="4948121">,</span>&nbsp;<span class="ident" id="4948123">c</span>&nbsp;<span class="ident" id="4948125">color</span><span class="op" id="4948130">.</span><span class="ident" id="4948131">Alpha</span><span class="op" id="4948136">)</span>&nbsp;<span class="op" id="4948138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948141">if</span>&nbsp;<span class="op" id="4948144">!</span><span class="op" id="4948145">(</span><span class="ident" id="4948146">Point</span><span class="op" id="4948151">{</span><span class="ident" id="4948152">x</span><span class="op" id="4948153">,</span>&nbsp;<span class="ident" id="4948155">y</span><span class="op" id="4948156">}</span><span class="op" id="4948157">.</span><span class="ident" id="4948158">In</span><span class="op" id="4948160">(</span><span class="ident" id="4948161">p</span><span class="op" id="4948162">.</span><span class="ident" id="4948163">Rect</span><span class="op" id="4948167">)</span><span class="op" id="4948168">)</span>&nbsp;<span class="op" id="4948170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948174">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948185">i</span>&nbsp;<span class="op" id="4948187">:=</span>&nbsp;<span class="ident" id="4948190">p</span><span class="op" id="4948191">.</span><span class="ident" id="4948192">PixOffset</span><span class="op" id="4948201">(</span><span class="ident" id="4948202">x</span><span class="op" id="4948203">,</span>&nbsp;<span class="ident" id="4948205">y</span><span class="op" id="4948206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948209">p</span><span class="op" id="4948210">.</span><span class="ident" id="4948211">Pix</span><span class="op" id="4948214">[</span><span class="ident" id="4948215">i</span><span class="op" id="4948216">]</span>&nbsp;<span class="op" id="4948218">=</span>&nbsp;<span class="ident" id="4948220">c</span><span class="op" id="4948221">.</span><span class="ident" id="4948222">A</span><br>
<span class="lineno"></span><span class="op" id="4948224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4948227">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4948304">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4948376">func</span>&nbsp;<span class="op" id="4948381">(</span><span class="ident" id="4948382">p</span>&nbsp;<span class="op" id="4948384">*</span><span class="ident" id="4948385">Alpha</span><span class="op" id="4948390">)</span>&nbsp;<span class="ident" id="4948392">SubImage</span><span class="op" id="4948400">(</span><span class="ident" id="4948401">r</span>&nbsp;<span class="ident" id="4948403">Rectangle</span><span class="op" id="4948412">)</span>&nbsp;<span class="ident" id="4948414">Image</span>&nbsp;<span class="op" id="4948420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948423">r</span>&nbsp;<span class="op" id="4948425">=</span>&nbsp;<span class="ident" id="4948427">r</span><span class="op" id="4948428">.</span><span class="ident" id="4948429">Intersect</span><span class="op" id="4948438">(</span><span class="ident" id="4948439">p</span><span class="op" id="4948440">.</span><span class="ident" id="4948441">Rect</span><span class="op" id="4948445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948448">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948529">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948611">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948661">if</span>&nbsp;<span class="ident" id="4948664">r</span><span class="op" id="4948665">.</span><span class="ident" id="4948666">Empty</span><span class="op" id="4948671">(</span><span class="op" id="4948672">)</span>&nbsp;<span class="op" id="4948674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948678">return</span>&nbsp;<span class="op" id="4948685">&amp;</span><span class="ident" id="4948686">Alpha</span><span class="op" id="4948691">{</span><span class="op" id="4948692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948695">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948698">i</span>&nbsp;<span class="op" id="4948700">:=</span>&nbsp;<span class="ident" id="4948703">p</span><span class="op" id="4948704">.</span><span class="ident" id="4948705">PixOffset</span><span class="op" id="4948714">(</span><span class="ident" id="4948715">r</span><span class="op" id="4948716">.</span><span class="ident" id="4948717">Min</span><span class="op" id="4948720">.</span><span class="ident" id="4948721">X</span><span class="op" id="4948722">,</span>&nbsp;<span class="ident" id="4948724">r</span><span class="op" id="4948725">.</span><span class="ident" id="4948726">Min</span><span class="op" id="4948729">.</span><span class="ident" id="4948730">Y</span><span class="op" id="4948731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948734">return</span>&nbsp;<span class="op" id="4948741">&amp;</span><span class="ident" id="4948742">Alpha</span><span class="op" id="4948747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948751">Pix</span><span class="op" id="4948754">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4948759">p</span><span class="op" id="4948760">.</span><span class="ident" id="4948761">Pix</span><span class="op" id="4948764">[</span><span class="ident" id="4948765">i</span><span class="op" id="4948766">:</span><span class="op" id="4948767">]</span><span class="op" id="4948768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948772">Stride</span><span class="op" id="4948778">:</span>&nbsp;<span class="ident" id="4948780">p</span><span class="op" id="4948781">.</span><span class="ident" id="4948782">Stride</span><span class="op" id="4948788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948792">Rect</span><span class="op" id="4948796">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4948800">r</span><span class="op" id="4948801">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948804">}</span><br>
<span class="lineno"></span><span class="op" id="4948806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4948809">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4948882">func</span>&nbsp;<span class="op" id="4948887">(</span><span class="ident" id="4948888">p</span>&nbsp;<span class="op" id="4948890">*</span><span class="ident" id="4948891">Alpha</span><span class="op" id="4948896">)</span>&nbsp;<span class="ident" id="4948898">Opaque</span><span class="op" id="4948904">(</span><span class="op" id="4948905">)</span>&nbsp;<span class="builtintype" id="4948907">bool</span>&nbsp;<span class="op" id="4948912">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948915">if</span>&nbsp;<span class="ident" id="4948918">p</span><span class="op" id="4948919">.</span><span class="ident" id="4948920">Rect</span><span class="op" id="4948924">.</span><span class="ident" id="4948925">Empty</span><span class="op" id="4948930">(</span><span class="op" id="4948931">)</span>&nbsp;<span class="op" id="4948933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948937">return</span>&nbsp;<span class="builtintype" id="4948944">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948953">i0</span><span class="op" id="4948955">,</span>&nbsp;<span class="ident" id="4948957">i1</span>&nbsp;<span class="op" id="4948960">:=</span>&nbsp;<span class="num" id="4948963">0</span><span class="op" id="4948964">,</span>&nbsp;<span class="ident" id="4948966">p</span><span class="op" id="4948967">.</span><span class="ident" id="4948968">Rect</span><span class="op" id="4948972">.</span><span class="ident" id="4948973">Dx</span><span class="op" id="4948975">(</span><span class="op" id="4948976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948979">for</span>&nbsp;<span class="ident" id="4948983">y</span>&nbsp;<span class="op" id="4948985">:=</span>&nbsp;<span class="ident" id="4948988">p</span><span class="op" id="4948989">.</span><span class="ident" id="4948990">Rect</span><span class="op" id="4948994">.</span><span class="ident" id="4948995">Min</span><span class="op" id="4948998">.</span><span class="ident" id="4948999">Y</span><span class="op" id="4949000">;</span>&nbsp;<span class="ident" id="4949002">y</span>&nbsp;<span class="op" id="4949004">&lt;</span>&nbsp;<span class="ident" id="4949006">p</span><span class="op" id="4949007">.</span><span class="ident" id="4949008">Rect</span><span class="op" id="4949012">.</span><span class="ident" id="4949013">Max</span><span class="op" id="4949016">.</span><span class="ident" id="4949017">Y</span><span class="op" id="4949018">;</span>&nbsp;<span class="ident" id="4949020">y</span><span class="op" id="4949021">++</span>&nbsp;<span class="op" id="4949024">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949028">for</span>&nbsp;<span class="ident" id="4949032">i</span>&nbsp;<span class="op" id="4949034">:=</span>&nbsp;<span class="ident" id="4949037">i0</span><span class="op" id="4949039">;</span>&nbsp;<span class="ident" id="4949041">i</span>&nbsp;<span class="op" id="4949043">&lt;</span>&nbsp;<span class="ident" id="4949045">i1</span><span class="op" id="4949047">;</span>&nbsp;<span class="ident" id="4949049">i</span><span class="op" id="4949050">++</span>&nbsp;<span class="op" id="4949053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949058">if</span>&nbsp;<span class="ident" id="4949061">p</span><span class="op" id="4949062">.</span><span class="ident" id="4949063">Pix</span><span class="op" id="4949066">[</span><span class="ident" id="4949067">i</span><span class="op" id="4949068">]</span>&nbsp;<span class="op" id="4949070">!=</span>&nbsp;<span class="num" id="4949073">0xff</span>&nbsp;<span class="op" id="4949078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949084">return</span>&nbsp;<span class="builtintype" id="4949091">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949104">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949108">i0</span>&nbsp;<span class="op" id="4949111">+=</span>&nbsp;<span class="ident" id="4949114">p</span><span class="op" id="4949115">.</span><span class="ident" id="4949116">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949125">i1</span>&nbsp;<span class="op" id="4949128">+=</span>&nbsp;<span class="ident" id="4949131">p</span><span class="op" id="4949132">.</span><span class="ident" id="4949133">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949144">return</span>&nbsp;<span class="builtintype" id="4949151">true</span><br>
<span class="lineno"></span><span class="op" id="4949156">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4949159">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4949214">func</span>&nbsp;<span class="ident" id="4949219">NewAlpha</span><span class="op" id="4949227">(</span><span class="ident" id="4949228">r</span>&nbsp;<span class="ident" id="4949230">Rectangle</span><span class="op" id="4949239">)</span>&nbsp;<span class="op" id="4949241">*</span><span class="ident" id="4949242">Alpha</span>&nbsp;<span class="op" id="4949248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949251">w</span><span class="op" id="4949252">,</span>&nbsp;<span class="ident" id="4949254">h</span>&nbsp;<span class="op" id="4949256">:=</span>&nbsp;<span class="ident" id="4949259">r</span><span class="op" id="4949260">.</span><span class="ident" id="4949261">Dx</span><span class="op" id="4949263">(</span><span class="op" id="4949264">)</span><span class="op" id="4949265">,</span>&nbsp;<span class="ident" id="4949267">r</span><span class="op" id="4949268">.</span><span class="ident" id="4949269">Dy</span><span class="op" id="4949271">(</span><span class="op" id="4949272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949275">pix</span>&nbsp;<span class="op" id="4949279">:=</span>&nbsp;<span class="builtinfunc" id="4949282">make</span><span class="op" id="4949286">(</span><span class="op" id="4949287">[</span><span class="op" id="4949288">]</span><span class="builtintype" id="4949289">uint8</span><span class="op" id="4949294">,</span>&nbsp;<span class="num" id="4949296">1</span><span class="op" id="4949297">*</span><span class="ident" id="4949298">w</span><span class="op" id="4949299">*</span><span class="ident" id="4949300">h</span><span class="op" id="4949301">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949304">return</span>&nbsp;<span class="op" id="4949311">&amp;</span><span class="ident" id="4949312">Alpha</span><span class="op" id="4949317">{</span><span class="ident" id="4949318">pix</span><span class="op" id="4949321">,</span>&nbsp;<span class="num" id="4949323">1</span>&nbsp;<span class="op" id="4949325">*</span>&nbsp;<span class="ident" id="4949327">w</span><span class="op" id="4949328">,</span>&nbsp;<span class="ident" id="4949330">r</span><span class="op" id="4949331">}</span><br>
<span class="lineno"></span><span class="op" id="4949333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4949336">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4949415">type</span>&nbsp;<span class="ident" id="4949420">Alpha16</span>&nbsp;<span class="keyword" id="4949428">struct</span>&nbsp;<span class="op" id="4949435">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4949438">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4949523">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949591">Pix</span>&nbsp;<span class="op" id="4949595">[</span><span class="op" id="4949596">]</span><span class="builtintype" id="4949597">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4949604">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949680">Stride</span>&nbsp;<span class="builtintype" id="4949687">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4949692">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949724">Rect</span>&nbsp;<span class="ident" id="4949729">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4949739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4949742">func</span>&nbsp;<span class="op" id="4949747">(</span><span class="ident" id="4949748">p</span>&nbsp;<span class="op" id="4949750">*</span><span class="ident" id="4949751">Alpha16</span><span class="op" id="4949758">)</span>&nbsp;<span class="ident" id="4949760">ColorModel</span><span class="op" id="4949770">(</span><span class="op" id="4949771">)</span>&nbsp;<span class="ident" id="4949773">color</span><span class="op" id="4949778">.</span><span class="ident" id="4949779">Model</span>&nbsp;<span class="op" id="4949785">{</span>&nbsp;<span class="keyword" id="4949787">return</span>&nbsp;<span class="ident" id="4949794">color</span><span class="op" id="4949799">.</span><span class="ident" id="4949800">Alpha16Model</span>&nbsp;<span class="op" id="4949813">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="4949816">func</span>&nbsp;<span class="op" id="4949821">(</span><span class="ident" id="4949822">p</span>&nbsp;<span class="op" id="4949824">*</span><span class="ident" id="4949825">Alpha16</span><span class="op" id="4949832">)</span>&nbsp;<span class="ident" id="4949834">Bounds</span><span class="op" id="4949840">(</span><span class="op" id="4949841">)</span>&nbsp;<span class="ident" id="4949843">Rectangle</span>&nbsp;<span class="op" id="4949853">{</span>&nbsp;<span class="keyword" id="4949855">return</span>&nbsp;<span class="ident" id="4949862">p</span><span class="op" id="4949863">.</span><span class="ident" id="4949864">Rect</span>&nbsp;<span class="op" id="4949869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4949872">func</span>&nbsp;<span class="op" id="4949877">(</span><span class="ident" id="4949878">p</span>&nbsp;<span class="op" id="4949880">*</span><span class="ident" id="4949881">Alpha16</span><span class="op" id="4949888">)</span>&nbsp;<span class="ident" id="4949890">At</span><span class="op" id="4949892">(</span><span class="ident" id="4949893">x</span><span class="op" id="4949894">,</span>&nbsp;<span class="ident" id="4949896">y</span>&nbsp;<span class="builtintype" id="4949898">int</span><span class="op" id="4949901">)</span>&nbsp;<span class="ident" id="4949903">color</span><span class="op" id="4949908">.</span><span class="ident" id="4949909">Color</span>&nbsp;<span class="op" id="4949915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949918">return</span>&nbsp;<span class="ident" id="4949925">p</span><span class="op" id="4949926">.</span><span class="ident" id="4949927">Alpha16At</span><span class="op" id="4949936">(</span><span class="ident" id="4949937">x</span><span class="op" id="4949938">,</span>&nbsp;<span class="ident" id="4949940">y</span><span class="op" id="4949941">)</span><br>
<span class="lineno">590</span><span class="op" id="4949943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4949946">func</span>&nbsp;<span class="op" id="4949951">(</span><span class="ident" id="4949952">p</span>&nbsp;<span class="op" id="4949954">*</span><span class="ident" id="4949955">Alpha16</span><span class="op" id="4949962">)</span>&nbsp;<span class="ident" id="4949964">Alpha16At</span><span class="op" id="4949973">(</span><span class="ident" id="4949974">x</span><span class="op" id="4949975">,</span>&nbsp;<span class="ident" id="4949977">y</span>&nbsp;<span class="builtintype" id="4949979">int</span><span class="op" id="4949982">)</span>&nbsp;<span class="ident" id="4949984">color</span><span class="op" id="4949989">.</span><span class="ident" id="4949990">Alpha16</span>&nbsp;<span class="op" id="4949998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950001">if</span>&nbsp;<span class="op" id="4950004">!</span><span class="op" id="4950005">(</span><span class="ident" id="4950006">Point</span><span class="op" id="4950011">{</span><span class="ident" id="4950012">x</span><span class="op" id="4950013">,</span>&nbsp;<span class="ident" id="4950015">y</span><span class="op" id="4950016">}</span><span class="op" id="4950017">.</span><span class="ident" id="4950018">In</span><span class="op" id="4950020">(</span><span class="ident" id="4950021">p</span><span class="op" id="4950022">.</span><span class="ident" id="4950023">Rect</span><span class="op" id="4950027">)</span><span class="op" id="4950028">)</span>&nbsp;<span class="op" id="4950030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950034">return</span>&nbsp;<span class="ident" id="4950041">color</span><span class="op" id="4950046">.</span><span class="ident" id="4950047">Alpha16</span><span class="op" id="4950054">{</span><span class="op" id="4950055">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950061">i</span>&nbsp;<span class="op" id="4950063">:=</span>&nbsp;<span class="ident" id="4950066">p</span><span class="op" id="4950067">.</span><span class="ident" id="4950068">PixOffset</span><span class="op" id="4950077">(</span><span class="ident" id="4950078">x</span><span class="op" id="4950079">,</span>&nbsp;<span class="ident" id="4950081">y</span><span class="op" id="4950082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950085">return</span>&nbsp;<span class="ident" id="4950092">color</span><span class="op" id="4950097">.</span><span class="ident" id="4950098">Alpha16</span><span class="op" id="4950105">{</span><span class="builtintype" id="4950106">uint16</span><span class="op" id="4950112">(</span><span class="ident" id="4950113">p</span><span class="op" id="4950114">.</span><span class="ident" id="4950115">Pix</span><span class="op" id="4950118">[</span><span class="ident" id="4950119">i</span><span class="op" id="4950120">+</span><span class="num" id="4950121">0</span><span class="op" id="4950122">]</span><span class="op" id="4950123">)</span><span class="op" id="4950124">&lt;&lt;</span><span class="num" id="4950126">8</span>&nbsp;<span class="op" id="4950128">|</span>&nbsp;<span class="builtintype" id="4950130">uint16</span><span class="op" id="4950136">(</span><span class="ident" id="4950137">p</span><span class="op" id="4950138">.</span><span class="ident" id="4950139">Pix</span><span class="op" id="4950142">[</span><span class="ident" id="4950143">i</span><span class="op" id="4950144">+</span><span class="num" id="4950145">1</span><span class="op" id="4950146">]</span><span class="op" id="4950147">)</span><span class="op" id="4950148">}</span><br>
<span class="lineno"></span><span class="op" id="4950150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="4950153">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4950232">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4950256">func</span>&nbsp;<span class="op" id="4950261">(</span><span class="ident" id="4950262">p</span>&nbsp;<span class="op" id="4950264">*</span><span class="ident" id="4950265">Alpha16</span><span class="op" id="4950272">)</span>&nbsp;<span class="ident" id="4950274">PixOffset</span><span class="op" id="4950283">(</span><span class="ident" id="4950284">x</span><span class="op" id="4950285">,</span>&nbsp;<span class="ident" id="4950287">y</span>&nbsp;<span class="builtintype" id="4950289">int</span><span class="op" id="4950292">)</span>&nbsp;<span class="builtintype" id="4950294">int</span>&nbsp;<span class="op" id="4950298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950301">return</span>&nbsp;<span class="op" id="4950308">(</span><span class="ident" id="4950309">y</span><span class="op" id="4950310">-</span><span class="ident" id="4950311">p</span><span class="op" id="4950312">.</span><span class="ident" id="4950313">Rect</span><span class="op" id="4950317">.</span><span class="ident" id="4950318">Min</span><span class="op" id="4950321">.</span><span class="ident" id="4950322">Y</span><span class="op" id="4950323">)</span><span class="op" id="4950324">*</span><span class="ident" id="4950325">p</span><span class="op" id="4950326">.</span><span class="ident" id="4950327">Stride</span>&nbsp;<span class="op" id="4950334">+</span>&nbsp;<span class="op" id="4950336">(</span><span class="ident" id="4950337">x</span><span class="op" id="4950338">-</span><span class="ident" id="4950339">p</span><span class="op" id="4950340">.</span><span class="ident" id="4950341">Rect</span><span class="op" id="4950345">.</span><span class="ident" id="4950346">Min</span><span class="op" id="4950349">.</span><span class="ident" id="4950350">X</span><span class="op" id="4950351">)</span><span class="op" id="4950352">*</span><span class="num" id="4950353">2</span><br>
<span class="lineno"></span><span class="op" id="4950355">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="4950358">func</span>&nbsp;<span class="op" id="4950363">(</span><span class="ident" id="4950364">p</span>&nbsp;<span class="op" id="4950366">*</span><span class="ident" id="4950367">Alpha16</span><span class="op" id="4950374">)</span>&nbsp;<span class="ident" id="4950376">Set</span><span class="op" id="4950379">(</span><span class="ident" id="4950380">x</span><span class="op" id="4950381">,</span>&nbsp;<span class="ident" id="4950383">y</span>&nbsp;<span class="builtintype" id="4950385">int</span><span class="op" id="4950388">,</span>&nbsp;<span class="ident" id="4950390">c</span>&nbsp;<span class="ident" id="4950392">color</span><span class="op" id="4950397">.</span><span class="ident" id="4950398">Color</span><span class="op" id="4950403">)</span>&nbsp;<span class="op" id="4950405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950408">if</span>&nbsp;<span class="op" id="4950411">!</span><span class="op" id="4950412">(</span><span class="ident" id="4950413">Point</span><span class="op" id="4950418">{</span><span class="ident" id="4950419">x</span><span class="op" id="4950420">,</span>&nbsp;<span class="ident" id="4950422">y</span><span class="op" id="4950423">}</span><span class="op" id="4950424">.</span><span class="ident" id="4950425">In</span><span class="op" id="4950427">(</span><span class="ident" id="4950428">p</span><span class="op" id="4950429">.</span><span class="ident" id="4950430">Rect</span><span class="op" id="4950434">)</span><span class="op" id="4950435">)</span>&nbsp;<span class="op" id="4950437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950441">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950449">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950452">i</span>&nbsp;<span class="op" id="4950454">:=</span>&nbsp;<span class="ident" id="4950457">p</span><span class="op" id="4950458">.</span><span class="ident" id="4950459">PixOffset</span><span class="op" id="4950468">(</span><span class="ident" id="4950469">x</span><span class="op" id="4950470">,</span>&nbsp;<span class="ident" id="4950472">y</span><span class="op" id="4950473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950476">c1</span>&nbsp;<span class="op" id="4950479">:=</span>&nbsp;<span class="ident" id="4950482">color</span><span class="op" id="4950487">.</span><span class="ident" id="4950488">Alpha16Model</span><span class="op" id="4950500">.</span><span class="ident" id="4950501">Convert</span><span class="op" id="4950508">(</span><span class="ident" id="4950509">c</span><span class="op" id="4950510">)</span><span class="op" id="4950511">.</span><span class="op" id="4950512">(</span><span class="ident" id="4950513">color</span><span class="op" id="4950518">.</span><span class="ident" id="4950519">Alpha16</span><span class="op" id="4950526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950529">p</span><span class="op" id="4950530">.</span><span class="ident" id="4950531">Pix</span><span class="op" id="4950534">[</span><span class="ident" id="4950535">i</span><span class="op" id="4950536">+</span><span class="num" id="4950537">0</span><span class="op" id="4950538">]</span>&nbsp;<span class="op" id="4950540">=</span>&nbsp;<span class="builtintype" id="4950542">uint8</span><span class="op" id="4950547">(</span><span class="ident" id="4950548">c1</span><span class="op" id="4950550">.</span><span class="ident" id="4950551">A</span>&nbsp;<span class="op" id="4950553">&gt;&gt;</span>&nbsp;<span class="num" id="4950556">8</span><span class="op" id="4950557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950560">p</span><span class="op" id="4950561">.</span><span class="ident" id="4950562">Pix</span><span class="op" id="4950565">[</span><span class="ident" id="4950566">i</span><span class="op" id="4950567">+</span><span class="num" id="4950568">1</span><span class="op" id="4950569">]</span>&nbsp;<span class="op" id="4950571">=</span>&nbsp;<span class="builtintype" id="4950573">uint8</span><span class="op" id="4950578">(</span><span class="ident" id="4950579">c1</span><span class="op" id="4950581">.</span><span class="ident" id="4950582">A</span><span class="op" id="4950583">)</span><br>
<span class="lineno"></span><span class="op" id="4950585">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4950588">func</span>&nbsp;<span class="op" id="4950593">(</span><span class="ident" id="4950594">p</span>&nbsp;<span class="op" id="4950596">*</span><span class="ident" id="4950597">Alpha16</span><span class="op" id="4950604">)</span>&nbsp;<span class="ident" id="4950606">SetAlpha16</span><span class="op" id="4950616">(</span><span class="ident" id="4950617">x</span><span class="op" id="4950618">,</span>&nbsp;<span class="ident" id="4950620">y</span>&nbsp;<span class="builtintype" id="4950622">int</span><span class="op" id="4950625">,</span>&nbsp;<span class="ident" id="4950627">c</span>&nbsp;<span class="ident" id="4950629">color</span><span class="op" id="4950634">.</span><span class="ident" id="4950635">Alpha16</span><span class="op" id="4950642">)</span>&nbsp;<span class="op" id="4950644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950647">if</span>&nbsp;<span class="op" id="4950650">!</span><span class="op" id="4950651">(</span><span class="ident" id="4950652">Point</span><span class="op" id="4950657">{</span><span class="ident" id="4950658">x</span><span class="op" id="4950659">,</span>&nbsp;<span class="ident" id="4950661">y</span><span class="op" id="4950662">}</span><span class="op" id="4950663">.</span><span class="ident" id="4950664">In</span><span class="op" id="4950666">(</span><span class="ident" id="4950667">p</span><span class="op" id="4950668">.</span><span class="ident" id="4950669">Rect</span><span class="op" id="4950673">)</span><span class="op" id="4950674">)</span>&nbsp;<span class="op" id="4950676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950688">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950691">i</span>&nbsp;<span class="op" id="4950693">:=</span>&nbsp;<span class="ident" id="4950696">p</span><span class="op" id="4950697">.</span><span class="ident" id="4950698">PixOffset</span><span class="op" id="4950707">(</span><span class="ident" id="4950708">x</span><span class="op" id="4950709">,</span>&nbsp;<span class="ident" id="4950711">y</span><span class="op" id="4950712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950715">p</span><span class="op" id="4950716">.</span><span class="ident" id="4950717">Pix</span><span class="op" id="4950720">[</span><span class="ident" id="4950721">i</span><span class="op" id="4950722">+</span><span class="num" id="4950723">0</span><span class="op" id="4950724">]</span>&nbsp;<span class="op" id="4950726">=</span>&nbsp;<span class="builtintype" id="4950728">uint8</span><span class="op" id="4950733">(</span><span class="ident" id="4950734">c</span><span class="op" id="4950735">.</span><span class="ident" id="4950736">A</span>&nbsp;<span class="op" id="4950738">&gt;&gt;</span>&nbsp;<span class="num" id="4950741">8</span><span class="op" id="4950742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950745">p</span><span class="op" id="4950746">.</span><span class="ident" id="4950747">Pix</span><span class="op" id="4950750">[</span><span class="ident" id="4950751">i</span><span class="op" id="4950752">+</span><span class="num" id="4950753">1</span><span class="op" id="4950754">]</span>&nbsp;<span class="op" id="4950756">=</span>&nbsp;<span class="builtintype" id="4950758">uint8</span><span class="op" id="4950763">(</span><span class="ident" id="4950764">c</span><span class="op" id="4950765">.</span><span class="ident" id="4950766">A</span><span class="op" id="4950767">)</span><br>
<span class="lineno"></span><span class="op" id="4950769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4950772">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4950849">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4950921">func</span>&nbsp;<span class="op" id="4950926">(</span><span class="ident" id="4950927">p</span>&nbsp;<span class="op" id="4950929">*</span><span class="ident" id="4950930">Alpha16</span><span class="op" id="4950937">)</span>&nbsp;<span class="ident" id="4950939">SubImage</span><span class="op" id="4950947">(</span><span class="ident" id="4950948">r</span>&nbsp;<span class="ident" id="4950950">Rectangle</span><span class="op" id="4950959">)</span>&nbsp;<span class="ident" id="4950961">Image</span>&nbsp;<span class="op" id="4950967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950970">r</span>&nbsp;<span class="op" id="4950972">=</span>&nbsp;<span class="ident" id="4950974">r</span><span class="op" id="4950975">.</span><span class="ident" id="4950976">Intersect</span><span class="op" id="4950985">(</span><span class="ident" id="4950986">p</span><span class="op" id="4950987">.</span><span class="ident" id="4950988">Rect</span><span class="op" id="4950992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4950995">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951076">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951158">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951208">if</span>&nbsp;<span class="ident" id="4951211">r</span><span class="op" id="4951212">.</span><span class="ident" id="4951213">Empty</span><span class="op" id="4951218">(</span><span class="op" id="4951219">)</span>&nbsp;<span class="op" id="4951221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951225">return</span>&nbsp;<span class="op" id="4951232">&amp;</span><span class="ident" id="4951233">Alpha16</span><span class="op" id="4951240">{</span><span class="op" id="4951241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951244">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951247">i</span>&nbsp;<span class="op" id="4951249">:=</span>&nbsp;<span class="ident" id="4951252">p</span><span class="op" id="4951253">.</span><span class="ident" id="4951254">PixOffset</span><span class="op" id="4951263">(</span><span class="ident" id="4951264">r</span><span class="op" id="4951265">.</span><span class="ident" id="4951266">Min</span><span class="op" id="4951269">.</span><span class="ident" id="4951270">X</span><span class="op" id="4951271">,</span>&nbsp;<span class="ident" id="4951273">r</span><span class="op" id="4951274">.</span><span class="ident" id="4951275">Min</span><span class="op" id="4951278">.</span><span class="ident" id="4951279">Y</span><span class="op" id="4951280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951283">return</span>&nbsp;<span class="op" id="4951290">&amp;</span><span class="ident" id="4951291">Alpha16</span><span class="op" id="4951298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951302">Pix</span><span class="op" id="4951305">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4951310">p</span><span class="op" id="4951311">.</span><span class="ident" id="4951312">Pix</span><span class="op" id="4951315">[</span><span class="ident" id="4951316">i</span><span class="op" id="4951317">:</span><span class="op" id="4951318">]</span><span class="op" id="4951319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951323">Stride</span><span class="op" id="4951329">:</span>&nbsp;<span class="ident" id="4951331">p</span><span class="op" id="4951332">.</span><span class="ident" id="4951333">Stride</span><span class="op" id="4951339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951343">Rect</span><span class="op" id="4951347">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4951351">r</span><span class="op" id="4951352">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951355">}</span><br>
<span class="lineno"></span><span class="op" id="4951357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951360">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4951433">func</span>&nbsp;<span class="op" id="4951438">(</span><span class="ident" id="4951439">p</span>&nbsp;<span class="op" id="4951441">*</span><span class="ident" id="4951442">Alpha16</span><span class="op" id="4951449">)</span>&nbsp;<span class="ident" id="4951451">Opaque</span><span class="op" id="4951457">(</span><span class="op" id="4951458">)</span>&nbsp;<span class="builtintype" id="4951460">bool</span>&nbsp;<span class="op" id="4951465">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951468">if</span>&nbsp;<span class="ident" id="4951471">p</span><span class="op" id="4951472">.</span><span class="ident" id="4951473">Rect</span><span class="op" id="4951477">.</span><span class="ident" id="4951478">Empty</span><span class="op" id="4951483">(</span><span class="op" id="4951484">)</span>&nbsp;<span class="op" id="4951486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951490">return</span>&nbsp;<span class="builtintype" id="4951497">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951506">i0</span><span class="op" id="4951508">,</span>&nbsp;<span class="ident" id="4951510">i1</span>&nbsp;<span class="op" id="4951513">:=</span>&nbsp;<span class="num" id="4951516">0</span><span class="op" id="4951517">,</span>&nbsp;<span class="ident" id="4951519">p</span><span class="op" id="4951520">.</span><span class="ident" id="4951521">Rect</span><span class="op" id="4951525">.</span><span class="ident" id="4951526">Dx</span><span class="op" id="4951528">(</span><span class="op" id="4951529">)</span><span class="op" id="4951530">*</span><span class="num" id="4951531">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951534">for</span>&nbsp;<span class="ident" id="4951538">y</span>&nbsp;<span class="op" id="4951540">:=</span>&nbsp;<span class="ident" id="4951543">p</span><span class="op" id="4951544">.</span><span class="ident" id="4951545">Rect</span><span class="op" id="4951549">.</span><span class="ident" id="4951550">Min</span><span class="op" id="4951553">.</span><span class="ident" id="4951554">Y</span><span class="op" id="4951555">;</span>&nbsp;<span class="ident" id="4951557">y</span>&nbsp;<span class="op" id="4951559">&lt;</span>&nbsp;<span class="ident" id="4951561">p</span><span class="op" id="4951562">.</span><span class="ident" id="4951563">Rect</span><span class="op" id="4951567">.</span><span class="ident" id="4951568">Max</span><span class="op" id="4951571">.</span><span class="ident" id="4951572">Y</span><span class="op" id="4951573">;</span>&nbsp;<span class="ident" id="4951575">y</span><span class="op" id="4951576">++</span>&nbsp;<span class="op" id="4951579">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951583">for</span>&nbsp;<span class="ident" id="4951587">i</span>&nbsp;<span class="op" id="4951589">:=</span>&nbsp;<span class="ident" id="4951592">i0</span><span class="op" id="4951594">;</span>&nbsp;<span class="ident" id="4951596">i</span>&nbsp;<span class="op" id="4951598">&lt;</span>&nbsp;<span class="ident" id="4951600">i1</span><span class="op" id="4951602">;</span>&nbsp;<span class="ident" id="4951604">i</span>&nbsp;<span class="op" id="4951606">+=</span>&nbsp;<span class="num" id="4951609">2</span>&nbsp;<span class="op" id="4951611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951616">if</span>&nbsp;<span class="ident" id="4951619">p</span><span class="op" id="4951620">.</span><span class="ident" id="4951621">Pix</span><span class="op" id="4951624">[</span><span class="ident" id="4951625">i</span><span class="op" id="4951626">+</span><span class="num" id="4951627">0</span><span class="op" id="4951628">]</span>&nbsp;<span class="op" id="4951630">!=</span>&nbsp;<span class="num" id="4951633">0xff</span>&nbsp;<span class="op" id="4951638">||</span>&nbsp;<span class="ident" id="4951641">p</span><span class="op" id="4951642">.</span><span class="ident" id="4951643">Pix</span><span class="op" id="4951646">[</span><span class="ident" id="4951647">i</span><span class="op" id="4951648">+</span><span class="num" id="4951649">1</span><span class="op" id="4951650">]</span>&nbsp;<span class="op" id="4951652">!=</span>&nbsp;<span class="num" id="4951655">0xff</span>&nbsp;<span class="op" id="4951660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951666">return</span>&nbsp;<span class="builtintype" id="4951673">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951686">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951690">i0</span>&nbsp;<span class="op" id="4951693">+=</span>&nbsp;<span class="ident" id="4951696">p</span><span class="op" id="4951697">.</span><span class="ident" id="4951698">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951707">i1</span>&nbsp;<span class="op" id="4951710">+=</span>&nbsp;<span class="ident" id="4951713">p</span><span class="op" id="4951714">.</span><span class="ident" id="4951715">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951726">return</span>&nbsp;<span class="builtintype" id="4951733">true</span><br>
<span class="lineno"></span><span class="op" id="4951738">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="4951741">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4951800">func</span>&nbsp;<span class="ident" id="4951805">NewAlpha16</span><span class="op" id="4951815">(</span><span class="ident" id="4951816">r</span>&nbsp;<span class="ident" id="4951818">Rectangle</span><span class="op" id="4951827">)</span>&nbsp;<span class="op" id="4951829">*</span><span class="ident" id="4951830">Alpha16</span>&nbsp;<span class="op" id="4951838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951841">w</span><span class="op" id="4951842">,</span>&nbsp;<span class="ident" id="4951844">h</span>&nbsp;<span class="op" id="4951846">:=</span>&nbsp;<span class="ident" id="4951849">r</span><span class="op" id="4951850">.</span><span class="ident" id="4951851">Dx</span><span class="op" id="4951853">(</span><span class="op" id="4951854">)</span><span class="op" id="4951855">,</span>&nbsp;<span class="ident" id="4951857">r</span><span class="op" id="4951858">.</span><span class="ident" id="4951859">Dy</span><span class="op" id="4951861">(</span><span class="op" id="4951862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951865">pix</span>&nbsp;<span class="op" id="4951869">:=</span>&nbsp;<span class="builtinfunc" id="4951872">make</span><span class="op" id="4951876">(</span><span class="op" id="4951877">[</span><span class="op" id="4951878">]</span><span class="builtintype" id="4951879">uint8</span><span class="op" id="4951884">,</span>&nbsp;<span class="num" id="4951886">2</span><span class="op" id="4951887">*</span><span class="ident" id="4951888">w</span><span class="op" id="4951889">*</span><span class="ident" id="4951890">h</span><span class="op" id="4951891">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951894">return</span>&nbsp;<span class="op" id="4951901">&amp;</span><span class="ident" id="4951902">Alpha16</span><span class="op" id="4951909">{</span><span class="ident" id="4951910">pix</span><span class="op" id="4951913">,</span>&nbsp;<span class="num" id="4951915">2</span>&nbsp;<span class="op" id="4951917">*</span>&nbsp;<span class="ident" id="4951919">w</span><span class="op" id="4951920">,</span>&nbsp;<span class="ident" id="4951922">r</span><span class="op" id="4951923">}</span><br>
<span class="lineno"></span><span class="op" id="4951925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951928">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4952001">type</span>&nbsp;<span class="ident" id="4952006">Gray</span>&nbsp;<span class="keyword" id="4952011">struct</span>&nbsp;<span class="op" id="4952018">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952021">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952084">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952152">Pix</span>&nbsp;<span class="op" id="4952156">[</span><span class="op" id="4952157">]</span><span class="builtintype" id="4952158">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952165">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952241">Stride</span>&nbsp;<span class="builtintype" id="4952248">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952253">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952285">Rect</span>&nbsp;<span class="ident" id="4952290">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4952300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952303">func</span>&nbsp;<span class="op" id="4952308">(</span><span class="ident" id="4952309">p</span>&nbsp;<span class="op" id="4952311">*</span><span class="ident" id="4952312">Gray</span><span class="op" id="4952316">)</span>&nbsp;<span class="ident" id="4952318">ColorModel</span><span class="op" id="4952328">(</span><span class="op" id="4952329">)</span>&nbsp;<span class="ident" id="4952331">color</span><span class="op" id="4952336">.</span><span class="ident" id="4952337">Model</span>&nbsp;<span class="op" id="4952343">{</span>&nbsp;<span class="keyword" id="4952345">return</span>&nbsp;<span class="ident" id="4952352">color</span><span class="op" id="4952357">.</span><span class="ident" id="4952358">GrayModel</span>&nbsp;<span class="op" id="4952368">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="4952371">func</span>&nbsp;<span class="op" id="4952376">(</span><span class="ident" id="4952377">p</span>&nbsp;<span class="op" id="4952379">*</span><span class="ident" id="4952380">Gray</span><span class="op" id="4952384">)</span>&nbsp;<span class="ident" id="4952386">Bounds</span><span class="op" id="4952392">(</span><span class="op" id="4952393">)</span>&nbsp;<span class="ident" id="4952395">Rectangle</span>&nbsp;<span class="op" id="4952405">{</span>&nbsp;<span class="keyword" id="4952407">return</span>&nbsp;<span class="ident" id="4952414">p</span><span class="op" id="4952415">.</span><span class="ident" id="4952416">Rect</span>&nbsp;<span class="op" id="4952421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952424">func</span>&nbsp;<span class="op" id="4952429">(</span><span class="ident" id="4952430">p</span>&nbsp;<span class="op" id="4952432">*</span><span class="ident" id="4952433">Gray</span><span class="op" id="4952437">)</span>&nbsp;<span class="ident" id="4952439">At</span><span class="op" id="4952441">(</span><span class="ident" id="4952442">x</span><span class="op" id="4952443">,</span>&nbsp;<span class="ident" id="4952445">y</span>&nbsp;<span class="builtintype" id="4952447">int</span><span class="op" id="4952450">)</span>&nbsp;<span class="ident" id="4952452">color</span><span class="op" id="4952457">.</span><span class="ident" id="4952458">Color</span>&nbsp;<span class="op" id="4952464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952467">return</span>&nbsp;<span class="ident" id="4952474">p</span><span class="op" id="4952475">.</span><span class="ident" id="4952476">GrayAt</span><span class="op" id="4952482">(</span><span class="ident" id="4952483">x</span><span class="op" id="4952484">,</span>&nbsp;<span class="ident" id="4952486">y</span><span class="op" id="4952487">)</span><br>
<span class="lineno">685</span><span class="op" id="4952489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952492">func</span>&nbsp;<span class="op" id="4952497">(</span><span class="ident" id="4952498">p</span>&nbsp;<span class="op" id="4952500">*</span><span class="ident" id="4952501">Gray</span><span class="op" id="4952505">)</span>&nbsp;<span class="ident" id="4952507">GrayAt</span><span class="op" id="4952513">(</span><span class="ident" id="4952514">x</span><span class="op" id="4952515">,</span>&nbsp;<span class="ident" id="4952517">y</span>&nbsp;<span class="builtintype" id="4952519">int</span><span class="op" id="4952522">)</span>&nbsp;<span class="ident" id="4952524">color</span><span class="op" id="4952529">.</span><span class="ident" id="4952530">Gray</span>&nbsp;<span class="op" id="4952535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952538">if</span>&nbsp;<span class="op" id="4952541">!</span><span class="op" id="4952542">(</span><span class="ident" id="4952543">Point</span><span class="op" id="4952548">{</span><span class="ident" id="4952549">x</span><span class="op" id="4952550">,</span>&nbsp;<span class="ident" id="4952552">y</span><span class="op" id="4952553">}</span><span class="op" id="4952554">.</span><span class="ident" id="4952555">In</span><span class="op" id="4952557">(</span><span class="ident" id="4952558">p</span><span class="op" id="4952559">.</span><span class="ident" id="4952560">Rect</span><span class="op" id="4952564">)</span><span class="op" id="4952565">)</span>&nbsp;<span class="op" id="4952567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952571">return</span>&nbsp;<span class="ident" id="4952578">color</span><span class="op" id="4952583">.</span><span class="ident" id="4952584">Gray</span><span class="op" id="4952588">{</span><span class="op" id="4952589">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952595">i</span>&nbsp;<span class="op" id="4952597">:=</span>&nbsp;<span class="ident" id="4952600">p</span><span class="op" id="4952601">.</span><span class="ident" id="4952602">PixOffset</span><span class="op" id="4952611">(</span><span class="ident" id="4952612">x</span><span class="op" id="4952613">,</span>&nbsp;<span class="ident" id="4952615">y</span><span class="op" id="4952616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952619">return</span>&nbsp;<span class="ident" id="4952626">color</span><span class="op" id="4952631">.</span><span class="ident" id="4952632">Gray</span><span class="op" id="4952636">{</span><span class="ident" id="4952637">p</span><span class="op" id="4952638">.</span><span class="ident" id="4952639">Pix</span><span class="op" id="4952642">[</span><span class="ident" id="4952643">i</span><span class="op" id="4952644">]</span><span class="op" id="4952645">}</span><br>
<span class="lineno"></span><span class="op" id="4952647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="4952650">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4952729">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4952753">func</span>&nbsp;<span class="op" id="4952758">(</span><span class="ident" id="4952759">p</span>&nbsp;<span class="op" id="4952761">*</span><span class="ident" id="4952762">Gray</span><span class="op" id="4952766">)</span>&nbsp;<span class="ident" id="4952768">PixOffset</span><span class="op" id="4952777">(</span><span class="ident" id="4952778">x</span><span class="op" id="4952779">,</span>&nbsp;<span class="ident" id="4952781">y</span>&nbsp;<span class="builtintype" id="4952783">int</span><span class="op" id="4952786">)</span>&nbsp;<span class="builtintype" id="4952788">int</span>&nbsp;<span class="op" id="4952792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952795">return</span>&nbsp;<span class="op" id="4952802">(</span><span class="ident" id="4952803">y</span><span class="op" id="4952804">-</span><span class="ident" id="4952805">p</span><span class="op" id="4952806">.</span><span class="ident" id="4952807">Rect</span><span class="op" id="4952811">.</span><span class="ident" id="4952812">Min</span><span class="op" id="4952815">.</span><span class="ident" id="4952816">Y</span><span class="op" id="4952817">)</span><span class="op" id="4952818">*</span><span class="ident" id="4952819">p</span><span class="op" id="4952820">.</span><span class="ident" id="4952821">Stride</span>&nbsp;<span class="op" id="4952828">+</span>&nbsp;<span class="op" id="4952830">(</span><span class="ident" id="4952831">x</span><span class="op" id="4952832">-</span><span class="ident" id="4952833">p</span><span class="op" id="4952834">.</span><span class="ident" id="4952835">Rect</span><span class="op" id="4952839">.</span><span class="ident" id="4952840">Min</span><span class="op" id="4952843">.</span><span class="ident" id="4952844">X</span><span class="op" id="4952845">)</span><span class="op" id="4952846">*</span><span class="num" id="4952847">1</span><br>
<span class="lineno"></span><span class="op" id="4952849">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="4952852">func</span>&nbsp;<span class="op" id="4952857">(</span><span class="ident" id="4952858">p</span>&nbsp;<span class="op" id="4952860">*</span><span class="ident" id="4952861">Gray</span><span class="op" id="4952865">)</span>&nbsp;<span class="ident" id="4952867">Set</span><span class="op" id="4952870">(</span><span class="ident" id="4952871">x</span><span class="op" id="4952872">,</span>&nbsp;<span class="ident" id="4952874">y</span>&nbsp;<span class="builtintype" id="4952876">int</span><span class="op" id="4952879">,</span>&nbsp;<span class="ident" id="4952881">c</span>&nbsp;<span class="ident" id="4952883">color</span><span class="op" id="4952888">.</span><span class="ident" id="4952889">Color</span><span class="op" id="4952894">)</span>&nbsp;<span class="op" id="4952896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952899">if</span>&nbsp;<span class="op" id="4952902">!</span><span class="op" id="4952903">(</span><span class="ident" id="4952904">Point</span><span class="op" id="4952909">{</span><span class="ident" id="4952910">x</span><span class="op" id="4952911">,</span>&nbsp;<span class="ident" id="4952913">y</span><span class="op" id="4952914">}</span><span class="op" id="4952915">.</span><span class="ident" id="4952916">In</span><span class="op" id="4952918">(</span><span class="ident" id="4952919">p</span><span class="op" id="4952920">.</span><span class="ident" id="4952921">Rect</span><span class="op" id="4952925">)</span><span class="op" id="4952926">)</span>&nbsp;<span class="op" id="4952928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952932">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952940">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952943">i</span>&nbsp;<span class="op" id="4952945">:=</span>&nbsp;<span class="ident" id="4952948">p</span><span class="op" id="4952949">.</span><span class="ident" id="4952950">PixOffset</span><span class="op" id="4952959">(</span><span class="ident" id="4952960">x</span><span class="op" id="4952961">,</span>&nbsp;<span class="ident" id="4952963">y</span><span class="op" id="4952964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952967">p</span><span class="op" id="4952968">.</span><span class="ident" id="4952969">Pix</span><span class="op" id="4952972">[</span><span class="ident" id="4952973">i</span><span class="op" id="4952974">]</span>&nbsp;<span class="op" id="4952976">=</span>&nbsp;<span class="ident" id="4952978">color</span><span class="op" id="4952983">.</span><span class="ident" id="4952984">GrayModel</span><span class="op" id="4952993">.</span><span class="ident" id="4952994">Convert</span><span class="op" id="4953001">(</span><span class="ident" id="4953002">c</span><span class="op" id="4953003">)</span><span class="op" id="4953004">.</span><span class="op" id="4953005">(</span><span class="ident" id="4953006">color</span><span class="op" id="4953011">.</span><span class="ident" id="4953012">Gray</span><span class="op" id="4953016">)</span><span class="op" id="4953017">.</span><span class="ident" id="4953018">Y</span><br>
<span class="lineno"></span><span class="op" id="4953020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4953023">func</span>&nbsp;<span class="op" id="4953028">(</span><span class="ident" id="4953029">p</span>&nbsp;<span class="op" id="4953031">*</span><span class="ident" id="4953032">Gray</span><span class="op" id="4953036">)</span>&nbsp;<span class="ident" id="4953038">SetGray</span><span class="op" id="4953045">(</span><span class="ident" id="4953046">x</span><span class="op" id="4953047">,</span>&nbsp;<span class="ident" id="4953049">y</span>&nbsp;<span class="builtintype" id="4953051">int</span><span class="op" id="4953054">,</span>&nbsp;<span class="ident" id="4953056">c</span>&nbsp;<span class="ident" id="4953058">color</span><span class="op" id="4953063">.</span><span class="ident" id="4953064">Gray</span><span class="op" id="4953068">)</span>&nbsp;<span class="op" id="4953070">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953073">if</span>&nbsp;<span class="op" id="4953076">!</span><span class="op" id="4953077">(</span><span class="ident" id="4953078">Point</span><span class="op" id="4953083">{</span><span class="ident" id="4953084">x</span><span class="op" id="4953085">,</span>&nbsp;<span class="ident" id="4953087">y</span><span class="op" id="4953088">}</span><span class="op" id="4953089">.</span><span class="ident" id="4953090">In</span><span class="op" id="4953092">(</span><span class="ident" id="4953093">p</span><span class="op" id="4953094">.</span><span class="ident" id="4953095">Rect</span><span class="op" id="4953099">)</span><span class="op" id="4953100">)</span>&nbsp;<span class="op" id="4953102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953106">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953117">i</span>&nbsp;<span class="op" id="4953119">:=</span>&nbsp;<span class="ident" id="4953122">p</span><span class="op" id="4953123">.</span><span class="ident" id="4953124">PixOffset</span><span class="op" id="4953133">(</span><span class="ident" id="4953134">x</span><span class="op" id="4953135">,</span>&nbsp;<span class="ident" id="4953137">y</span><span class="op" id="4953138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953141">p</span><span class="op" id="4953142">.</span><span class="ident" id="4953143">Pix</span><span class="op" id="4953146">[</span><span class="ident" id="4953147">i</span><span class="op" id="4953148">]</span>&nbsp;<span class="op" id="4953150">=</span>&nbsp;<span class="ident" id="4953152">c</span><span class="op" id="4953153">.</span><span class="ident" id="4953154">Y</span><br>
<span class="lineno">715</span><span class="op" id="4953156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4953159">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4953236">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4953308">func</span>&nbsp;<span class="op" id="4953313">(</span><span class="ident" id="4953314">p</span>&nbsp;<span class="op" id="4953316">*</span><span class="ident" id="4953317">Gray</span><span class="op" id="4953321">)</span>&nbsp;<span class="ident" id="4953323">SubImage</span><span class="op" id="4953331">(</span><span class="ident" id="4953332">r</span>&nbsp;<span class="ident" id="4953334">Rectangle</span><span class="op" id="4953343">)</span>&nbsp;<span class="ident" id="4953345">Image</span>&nbsp;<span class="op" id="4953351">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953354">r</span>&nbsp;<span class="op" id="4953356">=</span>&nbsp;<span class="ident" id="4953358">r</span><span class="op" id="4953359">.</span><span class="ident" id="4953360">Intersect</span><span class="op" id="4953369">(</span><span class="ident" id="4953370">p</span><span class="op" id="4953371">.</span><span class="ident" id="4953372">Rect</span><span class="op" id="4953376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953379">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953460">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953542">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953592">if</span>&nbsp;<span class="ident" id="4953595">r</span><span class="op" id="4953596">.</span><span class="ident" id="4953597">Empty</span><span class="op" id="4953602">(</span><span class="op" id="4953603">)</span>&nbsp;<span class="op" id="4953605">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953609">return</span>&nbsp;<span class="op" id="4953616">&amp;</span><span class="ident" id="4953617">Gray</span><span class="op" id="4953621">{</span><span class="op" id="4953622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953628">i</span>&nbsp;<span class="op" id="4953630">:=</span>&nbsp;<span class="ident" id="4953633">p</span><span class="op" id="4953634">.</span><span class="ident" id="4953635">PixOffset</span><span class="op" id="4953644">(</span><span class="ident" id="4953645">r</span><span class="op" id="4953646">.</span><span class="ident" id="4953647">Min</span><span class="op" id="4953650">.</span><span class="ident" id="4953651">X</span><span class="op" id="4953652">,</span>&nbsp;<span class="ident" id="4953654">r</span><span class="op" id="4953655">.</span><span class="ident" id="4953656">Min</span><span class="op" id="4953659">.</span><span class="ident" id="4953660">Y</span><span class="op" id="4953661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953664">return</span>&nbsp;<span class="op" id="4953671">&amp;</span><span class="ident" id="4953672">Gray</span><span class="op" id="4953676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953680">Pix</span><span class="op" id="4953683">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4953688">p</span><span class="op" id="4953689">.</span><span class="ident" id="4953690">Pix</span><span class="op" id="4953693">[</span><span class="ident" id="4953694">i</span><span class="op" id="4953695">:</span><span class="op" id="4953696">]</span><span class="op" id="4953697">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953701">Stride</span><span class="op" id="4953707">:</span>&nbsp;<span class="ident" id="4953709">p</span><span class="op" id="4953710">.</span><span class="ident" id="4953711">Stride</span><span class="op" id="4953717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953721">Rect</span><span class="op" id="4953725">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4953729">r</span><span class="op" id="4953730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953733">}</span><br>
<span class="lineno"></span><span class="op" id="4953735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="4953738">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4953811">func</span>&nbsp;<span class="op" id="4953816">(</span><span class="ident" id="4953817">p</span>&nbsp;<span class="op" id="4953819">*</span><span class="ident" id="4953820">Gray</span><span class="op" id="4953824">)</span>&nbsp;<span class="ident" id="4953826">Opaque</span><span class="op" id="4953832">(</span><span class="op" id="4953833">)</span>&nbsp;<span class="builtintype" id="4953835">bool</span>&nbsp;<span class="op" id="4953840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953843">return</span>&nbsp;<span class="builtintype" id="4953850">true</span><br>
<span class="lineno"></span><span class="op" id="4953855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="4953858">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4953911">func</span>&nbsp;<span class="ident" id="4953916">NewGray</span><span class="op" id="4953923">(</span><span class="ident" id="4953924">r</span>&nbsp;<span class="ident" id="4953926">Rectangle</span><span class="op" id="4953935">)</span>&nbsp;<span class="op" id="4953937">*</span><span class="ident" id="4953938">Gray</span>&nbsp;<span class="op" id="4953943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953946">w</span><span class="op" id="4953947">,</span>&nbsp;<span class="ident" id="4953949">h</span>&nbsp;<span class="op" id="4953951">:=</span>&nbsp;<span class="ident" id="4953954">r</span><span class="op" id="4953955">.</span><span class="ident" id="4953956">Dx</span><span class="op" id="4953958">(</span><span class="op" id="4953959">)</span><span class="op" id="4953960">,</span>&nbsp;<span class="ident" id="4953962">r</span><span class="op" id="4953963">.</span><span class="ident" id="4953964">Dy</span><span class="op" id="4953966">(</span><span class="op" id="4953967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953970">pix</span>&nbsp;<span class="op" id="4953974">:=</span>&nbsp;<span class="builtinfunc" id="4953977">make</span><span class="op" id="4953981">(</span><span class="op" id="4953982">[</span><span class="op" id="4953983">]</span><span class="builtintype" id="4953984">uint8</span><span class="op" id="4953989">,</span>&nbsp;<span class="num" id="4953991">1</span><span class="op" id="4953992">*</span><span class="ident" id="4953993">w</span><span class="op" id="4953994">*</span><span class="ident" id="4953995">h</span><span class="op" id="4953996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953999">return</span>&nbsp;<span class="op" id="4954006">&amp;</span><span class="ident" id="4954007">Gray</span><span class="op" id="4954011">{</span><span class="ident" id="4954012">pix</span><span class="op" id="4954015">,</span>&nbsp;<span class="num" id="4954017">1</span>&nbsp;<span class="op" id="4954019">*</span>&nbsp;<span class="ident" id="4954021">w</span><span class="op" id="4954022">,</span>&nbsp;<span class="ident" id="4954024">r</span><span class="op" id="4954025">}</span><br>
<span class="lineno">745</span><span class="op" id="4954027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4954030">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4954107">type</span>&nbsp;<span class="ident" id="4954112">Gray16</span>&nbsp;<span class="keyword" id="4954119">struct</span>&nbsp;<span class="op" id="4954126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954129">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954213">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954281">Pix</span>&nbsp;<span class="op" id="4954285">[</span><span class="op" id="4954286">]</span><span class="builtintype" id="4954287">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954294">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954370">Stride</span>&nbsp;<span class="builtintype" id="4954377">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954382">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954414">Rect</span>&nbsp;<span class="ident" id="4954419">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4954429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4954432">func</span>&nbsp;<span class="op" id="4954437">(</span><span class="ident" id="4954438">p</span>&nbsp;<span class="op" id="4954440">*</span><span class="ident" id="4954441">Gray16</span><span class="op" id="4954447">)</span>&nbsp;<span class="ident" id="4954449">ColorModel</span><span class="op" id="4954459">(</span><span class="op" id="4954460">)</span>&nbsp;<span class="ident" id="4954462">color</span><span class="op" id="4954467">.</span><span class="ident" id="4954468">Model</span>&nbsp;<span class="op" id="4954474">{</span>&nbsp;<span class="keyword" id="4954476">return</span>&nbsp;<span class="ident" id="4954483">color</span><span class="op" id="4954488">.</span><span class="ident" id="4954489">Gray16Model</span>&nbsp;<span class="op" id="4954501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="4954504">func</span>&nbsp;<span class="op" id="4954509">(</span><span class="ident" id="4954510">p</span>&nbsp;<span class="op" id="4954512">*</span><span class="ident" id="4954513">Gray16</span><span class="op" id="4954519">)</span>&nbsp;<span class="ident" id="4954521">Bounds</span><span class="op" id="4954527">(</span><span class="op" id="4954528">)</span>&nbsp;<span class="ident" id="4954530">Rectangle</span>&nbsp;<span class="op" id="4954540">{</span>&nbsp;<span class="keyword" id="4954542">return</span>&nbsp;<span class="ident" id="4954549">p</span><span class="op" id="4954550">.</span><span class="ident" id="4954551">Rect</span>&nbsp;<span class="op" id="4954556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4954559">func</span>&nbsp;<span class="op" id="4954564">(</span><span class="ident" id="4954565">p</span>&nbsp;<span class="op" id="4954567">*</span><span class="ident" id="4954568">Gray16</span><span class="op" id="4954574">)</span>&nbsp;<span class="ident" id="4954576">At</span><span class="op" id="4954578">(</span><span class="ident" id="4954579">x</span><span class="op" id="4954580">,</span>&nbsp;<span class="ident" id="4954582">y</span>&nbsp;<span class="builtintype" id="4954584">int</span><span class="op" id="4954587">)</span>&nbsp;<span class="ident" id="4954589">color</span><span class="op" id="4954594">.</span><span class="ident" id="4954595">Color</span>&nbsp;<span class="op" id="4954601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954604">return</span>&nbsp;<span class="ident" id="4954611">p</span><span class="op" id="4954612">.</span><span class="ident" id="4954613">Gray16At</span><span class="op" id="4954621">(</span><span class="ident" id="4954622">x</span><span class="op" id="4954623">,</span>&nbsp;<span class="ident" id="4954625">y</span><span class="op" id="4954626">)</span><br>
<span class="lineno"></span><span class="op" id="4954628">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="4954631">func</span>&nbsp;<span class="op" id="4954636">(</span><span class="ident" id="4954637">p</span>&nbsp;<span class="op" id="4954639">*</span><span class="ident" id="4954640">Gray16</span><span class="op" id="4954646">)</span>&nbsp;<span class="ident" id="4954648">Gray16At</span><span class="op" id="4954656">(</span><span class="ident" id="4954657">x</span><span class="op" id="4954658">,</span>&nbsp;<span class="ident" id="4954660">y</span>&nbsp;<span class="builtintype" id="4954662">int</span><span class="op" id="4954665">)</span>&nbsp;<span class="ident" id="4954667">color</span><span class="op" id="4954672">.</span><span class="ident" id="4954673">Gray16</span>&nbsp;<span class="op" id="4954680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954683">if</span>&nbsp;<span class="op" id="4954686">!</span><span class="op" id="4954687">(</span><span class="ident" id="4954688">Point</span><span class="op" id="4954693">{</span><span class="ident" id="4954694">x</span><span class="op" id="4954695">,</span>&nbsp;<span class="ident" id="4954697">y</span><span class="op" id="4954698">}</span><span class="op" id="4954699">.</span><span class="ident" id="4954700">In</span><span class="op" id="4954702">(</span><span class="ident" id="4954703">p</span><span class="op" id="4954704">.</span><span class="ident" id="4954705">Rect</span><span class="op" id="4954709">)</span><span class="op" id="4954710">)</span>&nbsp;<span class="op" id="4954712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954716">return</span>&nbsp;<span class="ident" id="4954723">color</span><span class="op" id="4954728">.</span><span class="ident" id="4954729">Gray16</span><span class="op" id="4954735">{</span><span class="op" id="4954736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954739">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954742">i</span>&nbsp;<span class="op" id="4954744">:=</span>&nbsp;<span class="ident" id="4954747">p</span><span class="op" id="4954748">.</span><span class="ident" id="4954749">PixOffset</span><span class="op" id="4954758">(</span><span class="ident" id="4954759">x</span><span class="op" id="4954760">,</span>&nbsp;<span class="ident" id="4954762">y</span><span class="op" id="4954763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954766">return</span>&nbsp;<span class="ident" id="4954773">color</span><span class="op" id="4954778">.</span><span class="ident" id="4954779">Gray16</span><span class="op" id="4954785">{</span><span class="builtintype" id="4954786">uint16</span><span class="op" id="4954792">(</span><span class="ident" id="4954793">p</span><span class="op" id="4954794">.</span><span class="ident" id="4954795">Pix</span><span class="op" id="4954798">[</span><span class="ident" id="4954799">i</span><span class="op" id="4954800">+</span><span class="num" id="4954801">0</span><span class="op" id="4954802">]</span><span class="op" id="4954803">)</span><span class="op" id="4954804">&lt;&lt;</span><span class="num" id="4954806">8</span>&nbsp;<span class="op" id="4954808">|</span>&nbsp;<span class="builtintype" id="4954810">uint16</span><span class="op" id="4954816">(</span><span class="ident" id="4954817">p</span><span class="op" id="4954818">.</span><span class="ident" id="4954819">Pix</span><span class="op" id="4954822">[</span><span class="ident" id="4954823">i</span><span class="op" id="4954824">+</span><span class="num" id="4954825">1</span><span class="op" id="4954826">]</span><span class="op" id="4954827">)</span><span class="op" id="4954828">}</span><br>
<span class="lineno"></span><span class="op" id="4954830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4954833">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="4954912">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4954936">func</span>&nbsp;<span class="op" id="4954941">(</span><span class="ident" id="4954942">p</span>&nbsp;<span class="op" id="4954944">*</span><span class="ident" id="4954945">Gray16</span><span class="op" id="4954951">)</span>&nbsp;<span class="ident" id="4954953">PixOffset</span><span class="op" id="4954962">(</span><span class="ident" id="4954963">x</span><span class="op" id="4954964">,</span>&nbsp;<span class="ident" id="4954966">y</span>&nbsp;<span class="builtintype" id="4954968">int</span><span class="op" id="4954971">)</span>&nbsp;<span class="builtintype" id="4954973">int</span>&nbsp;<span class="op" id="4954977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954980">return</span>&nbsp;<span class="op" id="4954987">(</span><span class="ident" id="4954988">y</span><span class="op" id="4954989">-</span><span class="ident" id="4954990">p</span><span class="op" id="4954991">.</span><span class="ident" id="4954992">Rect</span><span class="op" id="4954996">.</span><span class="ident" id="4954997">Min</span><span class="op" id="4955000">.</span><span class="ident" id="4955001">Y</span><span class="op" id="4955002">)</span><span class="op" id="4955003">*</span><span class="ident" id="4955004">p</span><span class="op" id="4955005">.</span><span class="ident" id="4955006">Stride</span>&nbsp;<span class="op" id="4955013">+</span>&nbsp;<span class="op" id="4955015">(</span><span class="ident" id="4955016">x</span><span class="op" id="4955017">-</span><span class="ident" id="4955018">p</span><span class="op" id="4955019">.</span><span class="ident" id="4955020">Rect</span><span class="op" id="4955024">.</span><span class="ident" id="4955025">Min</span><span class="op" id="4955028">.</span><span class="ident" id="4955029">X</span><span class="op" id="4955030">)</span><span class="op" id="4955031">*</span><span class="num" id="4955032">2</span><br>
<span class="lineno"></span><span class="op" id="4955034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="4955037">func</span>&nbsp;<span class="op" id="4955042">(</span><span class="ident" id="4955043">p</span>&nbsp;<span class="op" id="4955045">*</span><span class="ident" id="4955046">Gray16</span><span class="op" id="4955052">)</span>&nbsp;<span class="ident" id="4955054">Set</span><span class="op" id="4955057">(</span><span class="ident" id="4955058">x</span><span class="op" id="4955059">,</span>&nbsp;<span class="ident" id="4955061">y</span>&nbsp;<span class="builtintype" id="4955063">int</span><span class="op" id="4955066">,</span>&nbsp;<span class="ident" id="4955068">c</span>&nbsp;<span class="ident" id="4955070">color</span><span class="op" id="4955075">.</span><span class="ident" id="4955076">Color</span><span class="op" id="4955081">)</span>&nbsp;<span class="op" id="4955083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955086">if</span>&nbsp;<span class="op" id="4955089">!</span><span class="op" id="4955090">(</span><span class="ident" id="4955091">Point</span><span class="op" id="4955096">{</span><span class="ident" id="4955097">x</span><span class="op" id="4955098">,</span>&nbsp;<span class="ident" id="4955100">y</span><span class="op" id="4955101">}</span><span class="op" id="4955102">.</span><span class="ident" id="4955103">In</span><span class="op" id="4955105">(</span><span class="ident" id="4955106">p</span><span class="op" id="4955107">.</span><span class="ident" id="4955108">Rect</span><span class="op" id="4955112">)</span><span class="op" id="4955113">)</span>&nbsp;<span class="op" id="4955115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955130">i</span>&nbsp;<span class="op" id="4955132">:=</span>&nbsp;<span class="ident" id="4955135">p</span><span class="op" id="4955136">.</span><span class="ident" id="4955137">PixOffset</span><span class="op" id="4955146">(</span><span class="ident" id="4955147">x</span><span class="op" id="4955148">,</span>&nbsp;<span class="ident" id="4955150">y</span><span class="op" id="4955151">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955154">c1</span>&nbsp;<span class="op" id="4955157">:=</span>&nbsp;<span class="ident" id="4955160">color</span><span class="op" id="4955165">.</span><span class="ident" id="4955166">Gray16Model</span><span class="op" id="4955177">.</span><span class="ident" id="4955178">Convert</span><span class="op" id="4955185">(</span><span class="ident" id="4955186">c</span><span class="op" id="4955187">)</span><span class="op" id="4955188">.</span><span class="op" id="4955189">(</span><span class="ident" id="4955190">color</span><span class="op" id="4955195">.</span><span class="ident" id="4955196">Gray16</span><span class="op" id="4955202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955205">p</span><span class="op" id="4955206">.</span><span class="ident" id="4955207">Pix</span><span class="op" id="4955210">[</span><span class="ident" id="4955211">i</span><span class="op" id="4955212">+</span><span class="num" id="4955213">0</span><span class="op" id="4955214">]</span>&nbsp;<span class="op" id="4955216">=</span>&nbsp;<span class="builtintype" id="4955218">uint8</span><span class="op" id="4955223">(</span><span class="ident" id="4955224">c1</span><span class="op" id="4955226">.</span><span class="ident" id="4955227">Y</span>&nbsp;<span class="op" id="4955229">&gt;&gt;</span>&nbsp;<span class="num" id="4955232">8</span><span class="op" id="4955233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955236">p</span><span class="op" id="4955237">.</span><span class="ident" id="4955238">Pix</span><span class="op" id="4955241">[</span><span class="ident" id="4955242">i</span><span class="op" id="4955243">+</span><span class="num" id="4955244">1</span><span class="op" id="4955245">]</span>&nbsp;<span class="op" id="4955247">=</span>&nbsp;<span class="builtintype" id="4955249">uint8</span><span class="op" id="4955254">(</span><span class="ident" id="4955255">c1</span><span class="op" id="4955257">.</span><span class="ident" id="4955258">Y</span><span class="op" id="4955259">)</span><br>
<span class="lineno"></span><span class="op" id="4955261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="4955264">func</span>&nbsp;<span class="op" id="4955269">(</span><span class="ident" id="4955270">p</span>&nbsp;<span class="op" id="4955272">*</span><span class="ident" id="4955273">Gray16</span><span class="op" id="4955279">)</span>&nbsp;<span class="ident" id="4955281">SetGray16</span><span class="op" id="4955290">(</span><span class="ident" id="4955291">x</span><span class="op" id="4955292">,</span>&nbsp;<span class="ident" id="4955294">y</span>&nbsp;<span class="builtintype" id="4955296">int</span><span class="op" id="4955299">,</span>&nbsp;<span class="ident" id="4955301">c</span>&nbsp;<span class="ident" id="4955303">color</span><span class="op" id="4955308">.</span><span class="ident" id="4955309">Gray16</span><span class="op" id="4955315">)</span>&nbsp;<span class="op" id="4955317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955320">if</span>&nbsp;<span class="op" id="4955323">!</span><span class="op" id="4955324">(</span><span class="ident" id="4955325">Point</span><span class="op" id="4955330">{</span><span class="ident" id="4955331">x</span><span class="op" id="4955332">,</span>&nbsp;<span class="ident" id="4955334">y</span><span class="op" id="4955335">}</span><span class="op" id="4955336">.</span><span class="ident" id="4955337">In</span><span class="op" id="4955339">(</span><span class="ident" id="4955340">p</span><span class="op" id="4955341">.</span><span class="ident" id="4955342">Rect</span><span class="op" id="4955346">)</span><span class="op" id="4955347">)</span>&nbsp;<span class="op" id="4955349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955353">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955364">i</span>&nbsp;<span class="op" id="4955366">:=</span>&nbsp;<span class="ident" id="4955369">p</span><span class="op" id="4955370">.</span><span class="ident" id="4955371">PixOffset</span><span class="op" id="4955380">(</span><span class="ident" id="4955381">x</span><span class="op" id="4955382">,</span>&nbsp;<span class="ident" id="4955384">y</span><span class="op" id="4955385">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955388">p</span><span class="op" id="4955389">.</span><span class="ident" id="4955390">Pix</span><span class="op" id="4955393">[</span><span class="ident" id="4955394">i</span><span class="op" id="4955395">+</span><span class="num" id="4955396">0</span><span class="op" id="4955397">]</span>&nbsp;<span class="op" id="4955399">=</span>&nbsp;<span class="builtintype" id="4955401">uint8</span><span class="op" id="4955406">(</span><span class="ident" id="4955407">c</span><span class="op" id="4955408">.</span><span class="ident" id="4955409">Y</span>&nbsp;<span class="op" id="4955411">&gt;&gt;</span>&nbsp;<span class="num" id="4955414">8</span><span class="op" id="4955415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955418">p</span><span class="op" id="4955419">.</span><span class="ident" id="4955420">Pix</span><span class="op" id="4955423">[</span><span class="ident" id="4955424">i</span><span class="op" id="4955425">+</span><span class="num" id="4955426">1</span><span class="op" id="4955427">]</span>&nbsp;<span class="op" id="4955429">=</span>&nbsp;<span class="builtintype" id="4955431">uint8</span><span class="op" id="4955436">(</span><span class="ident" id="4955437">c</span><span class="op" id="4955438">.</span><span class="ident" id="4955439">Y</span><span class="op" id="4955440">)</span><br>
<span class="lineno"></span><span class="op" id="4955442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4955445">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="4955522">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4955594">func</span>&nbsp;<span class="op" id="4955599">(</span><span class="ident" id="4955600">p</span>&nbsp;<span class="op" id="4955602">*</span><span class="ident" id="4955603">Gray16</span><span class="op" id="4955609">)</span>&nbsp;<span class="ident" id="4955611">SubImage</span><span class="op" id="4955619">(</span><span class="ident" id="4955620">r</span>&nbsp;<span class="ident" id="4955622">Rectangle</span><span class="op" id="4955631">)</span>&nbsp;<span class="ident" id="4955633">Image</span>&nbsp;<span class="op" id="4955639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955642">r</span>&nbsp;<span class="op" id="4955644">=</span>&nbsp;<span class="ident" id="4955646">r</span><span class="op" id="4955647">.</span><span class="ident" id="4955648">Intersect</span><span class="op" id="4955657">(</span><span class="ident" id="4955658">p</span><span class="op" id="4955659">.</span><span class="ident" id="4955660">Rect</span><span class="op" id="4955664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4955667">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4955748">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4955830">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955880">if</span>&nbsp;<span class="ident" id="4955883">r</span><span class="op" id="4955884">.</span><span class="ident" id="4955885">Empty</span><span class="op" id="4955890">(</span><span class="op" id="4955891">)</span>&nbsp;<span class="op" id="4955893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955897">return</span>&nbsp;<span class="op" id="4955904">&amp;</span><span class="ident" id="4955905">Gray16</span><span class="op" id="4955911">{</span><span class="op" id="4955912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955918">i</span>&nbsp;<span class="op" id="4955920">:=</span>&nbsp;<span class="ident" id="4955923">p</span><span class="op" id="4955924">.</span><span class="ident" id="4955925">PixOffset</span><span class="op" id="4955934">(</span><span class="ident" id="4955935">r</span><span class="op" id="4955936">.</span><span class="ident" id="4955937">Min</span><span class="op" id="4955940">.</span><span class="ident" id="4955941">X</span><span class="op" id="4955942">,</span>&nbsp;<span class="ident" id="4955944">r</span><span class="op" id="4955945">.</span><span class="ident" id="4955946">Min</span><span class="op" id="4955949">.</span><span class="ident" id="4955950">Y</span><span class="op" id="4955951">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955954">return</span>&nbsp;<span class="op" id="4955961">&amp;</span><span class="ident" id="4955962">Gray16</span><span class="op" id="4955968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955972">Pix</span><span class="op" id="4955975">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4955980">p</span><span class="op" id="4955981">.</span><span class="ident" id="4955982">Pix</span><span class="op" id="4955985">[</span><span class="ident" id="4955986">i</span><span class="op" id="4955987">:</span><span class="op" id="4955988">]</span><span class="op" id="4955989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955993">Stride</span><span class="op" id="4955999">:</span>&nbsp;<span class="ident" id="4956001">p</span><span class="op" id="4956002">.</span><span class="ident" id="4956003">Stride</span><span class="op" id="4956009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956013">Rect</span><span class="op" id="4956017">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4956021">r</span><span class="op" id="4956022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956025">}</span><br>
<span class="lineno">815</span><span class="op" id="4956027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956030">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4956103">func</span>&nbsp;<span class="op" id="4956108">(</span><span class="ident" id="4956109">p</span>&nbsp;<span class="op" id="4956111">*</span><span class="ident" id="4956112">Gray16</span><span class="op" id="4956118">)</span>&nbsp;<span class="ident" id="4956120">Opaque</span><span class="op" id="4956126">(</span><span class="op" id="4956127">)</span>&nbsp;<span class="builtintype" id="4956129">bool</span>&nbsp;<span class="op" id="4956134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956137">return</span>&nbsp;<span class="builtintype" id="4956144">true</span><br>
<span class="lineno">820</span><span class="op" id="4956149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956152">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4956209">func</span>&nbsp;<span class="ident" id="4956214">NewGray16</span><span class="op" id="4956223">(</span><span class="ident" id="4956224">r</span>&nbsp;<span class="ident" id="4956226">Rectangle</span><span class="op" id="4956235">)</span>&nbsp;<span class="op" id="4956237">*</span><span class="ident" id="4956238">Gray16</span>&nbsp;<span class="op" id="4956245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956248">w</span><span class="op" id="4956249">,</span>&nbsp;<span class="ident" id="4956251">h</span>&nbsp;<span class="op" id="4956253">:=</span>&nbsp;<span class="ident" id="4956256">r</span><span class="op" id="4956257">.</span><span class="ident" id="4956258">Dx</span><span class="op" id="4956260">(</span><span class="op" id="4956261">)</span><span class="op" id="4956262">,</span>&nbsp;<span class="ident" id="4956264">r</span><span class="op" id="4956265">.</span><span class="ident" id="4956266">Dy</span><span class="op" id="4956268">(</span><span class="op" id="4956269">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956272">pix</span>&nbsp;<span class="op" id="4956276">:=</span>&nbsp;<span class="builtinfunc" id="4956279">make</span><span class="op" id="4956283">(</span><span class="op" id="4956284">[</span><span class="op" id="4956285">]</span><span class="builtintype" id="4956286">uint8</span><span class="op" id="4956291">,</span>&nbsp;<span class="num" id="4956293">2</span><span class="op" id="4956294">*</span><span class="ident" id="4956295">w</span><span class="op" id="4956296">*</span><span class="ident" id="4956297">h</span><span class="op" id="4956298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956301">return</span>&nbsp;<span class="op" id="4956308">&amp;</span><span class="ident" id="4956309">Gray16</span><span class="op" id="4956315">{</span><span class="ident" id="4956316">pix</span><span class="op" id="4956319">,</span>&nbsp;<span class="num" id="4956321">2</span>&nbsp;<span class="op" id="4956323">*</span>&nbsp;<span class="ident" id="4956325">w</span><span class="op" id="4956326">,</span>&nbsp;<span class="ident" id="4956328">r</span><span class="op" id="4956329">}</span><br>
<span class="lineno"></span><span class="op" id="4956331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956334">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="4956407">type</span>&nbsp;<span class="ident" id="4956412">Paletted</span>&nbsp;<span class="keyword" id="4956421">struct</span>&nbsp;<span class="op" id="4956428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956431">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956498">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956566">Pix</span>&nbsp;<span class="op" id="4956570">[</span><span class="op" id="4956571">]</span><span class="builtintype" id="4956572">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956579">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956655">Stride</span>&nbsp;<span class="builtintype" id="4956662">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956667">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956699">Rect</span>&nbsp;<span class="ident" id="4956704">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956715">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956751">Palette</span>&nbsp;<span class="ident" id="4956759">color</span><span class="op" id="4956764">.</span><span class="ident" id="4956765">Palette</span><br>
<span class="lineno">840</span><span class="op" id="4956773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4956776">func</span>&nbsp;<span class="op" id="4956781">(</span><span class="ident" id="4956782">p</span>&nbsp;<span class="op" id="4956784">*</span><span class="ident" id="4956785">Paletted</span><span class="op" id="4956793">)</span>&nbsp;<span class="ident" id="4956795">ColorModel</span><span class="op" id="4956805">(</span><span class="op" id="4956806">)</span>&nbsp;<span class="ident" id="4956808">color</span><span class="op" id="4956813">.</span><span class="ident" id="4956814">Model</span>&nbsp;<span class="op" id="4956820">{</span>&nbsp;<span class="keyword" id="4956822">return</span>&nbsp;<span class="ident" id="4956829">p</span><span class="op" id="4956830">.</span><span class="ident" id="4956831">Palette</span>&nbsp;<span class="op" id="4956839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4956842">func</span>&nbsp;<span class="op" id="4956847">(</span><span class="ident" id="4956848">p</span>&nbsp;<span class="op" id="4956850">*</span><span class="ident" id="4956851">Paletted</span><span class="op" id="4956859">)</span>&nbsp;<span class="ident" id="4956861">Bounds</span><span class="op" id="4956867">(</span><span class="op" id="4956868">)</span>&nbsp;<span class="ident" id="4956870">Rectangle</span>&nbsp;<span class="op" id="4956880">{</span>&nbsp;<span class="keyword" id="4956882">return</span>&nbsp;<span class="ident" id="4956889">p</span><span class="op" id="4956890">.</span><span class="ident" id="4956891">Rect</span>&nbsp;<span class="op" id="4956896">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="4956899">func</span>&nbsp;<span class="op" id="4956904">(</span><span class="ident" id="4956905">p</span>&nbsp;<span class="op" id="4956907">*</span><span class="ident" id="4956908">Paletted</span><span class="op" id="4956916">)</span>&nbsp;<span class="ident" id="4956918">At</span><span class="op" id="4956920">(</span><span class="ident" id="4956921">x</span><span class="op" id="4956922">,</span>&nbsp;<span class="ident" id="4956924">y</span>&nbsp;<span class="builtintype" id="4956926">int</span><span class="op" id="4956929">)</span>&nbsp;<span class="ident" id="4956931">color</span><span class="op" id="4956936">.</span><span class="ident" id="4956937">Color</span>&nbsp;<span class="op" id="4956943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956946">if</span>&nbsp;<span class="builtinfunc" id="4956949">len</span><span class="op" id="4956952">(</span><span class="ident" id="4956953">p</span><span class="op" id="4956954">.</span><span class="ident" id="4956955">Palette</span><span class="op" id="4956962">)</span>&nbsp;<span class="op" id="4956964">==</span>&nbsp;<span class="num" id="4956967">0</span>&nbsp;<span class="op" id="4956969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956973">return</span>&nbsp;<span class="ident" id="4956980">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956985">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956988">if</span>&nbsp;<span class="op" id="4956991">!</span><span class="op" id="4956992">(</span><span class="ident" id="4956993">Point</span><span class="op" id="4956998">{</span><span class="ident" id="4956999">x</span><span class="op" id="4957000">,</span>&nbsp;<span class="ident" id="4957002">y</span><span class="op" id="4957003">}</span><span class="op" id="4957004">.</span><span class="ident" id="4957005">In</span><span class="op" id="4957007">(</span><span class="ident" id="4957008">p</span><span class="op" id="4957009">.</span><span class="ident" id="4957010">Rect</span><span class="op" id="4957014">)</span><span class="op" id="4957015">)</span>&nbsp;<span class="op" id="4957017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957021">return</span>&nbsp;<span class="ident" id="4957028">p</span><span class="op" id="4957029">.</span><span class="ident" id="4957030">Palette</span><span class="op" id="4957037">[</span><span class="num" id="4957038">0</span><span class="op" id="4957039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957045">i</span>&nbsp;<span class="op" id="4957047">:=</span>&nbsp;<span class="ident" id="4957050">p</span><span class="op" id="4957051">.</span><span class="ident" id="4957052">PixOffset</span><span class="op" id="4957061">(</span><span class="ident" id="4957062">x</span><span class="op" id="4957063">,</span>&nbsp;<span class="ident" id="4957065">y</span><span class="op" id="4957066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957069">return</span>&nbsp;<span class="ident" id="4957076">p</span><span class="op" id="4957077">.</span><span class="ident" id="4957078">Palette</span><span class="op" id="4957085">[</span><span class="ident" id="4957086">p</span><span class="op" id="4957087">.</span><span class="ident" id="4957088">Pix</span><span class="op" id="4957091">[</span><span class="ident" id="4957092">i</span><span class="op" id="4957093">]</span><span class="op" id="4957094">]</span><br>
<span class="lineno">855</span><span class="op" id="4957096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4957099">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4957178">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4957202">func</span>&nbsp;<span class="op" id="4957207">(</span><span class="ident" id="4957208">p</span>&nbsp;<span class="op" id="4957210">*</span><span class="ident" id="4957211">Paletted</span><span class="op" id="4957219">)</span>&nbsp;<span class="ident" id="4957221">PixOffset</span><span class="op" id="4957230">(</span><span class="ident" id="4957231">x</span><span class="op" id="4957232">,</span>&nbsp;<span class="ident" id="4957234">y</span>&nbsp;<span class="builtintype" id="4957236">int</span><span class="op" id="4957239">)</span>&nbsp;<span class="builtintype" id="4957241">int</span>&nbsp;<span class="op" id="4957245">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957248">return</span>&nbsp;<span class="op" id="4957255">(</span><span class="ident" id="4957256">y</span><span class="op" id="4957257">-</span><span class="ident" id="4957258">p</span><span class="op" id="4957259">.</span><span class="ident" id="4957260">Rect</span><span class="op" id="4957264">.</span><span class="ident" id="4957265">Min</span><span class="op" id="4957268">.</span><span class="ident" id="4957269">Y</span><span class="op" id="4957270">)</span><span class="op" id="4957271">*</span><span class="ident" id="4957272">p</span><span class="op" id="4957273">.</span><span class="ident" id="4957274">Stride</span>&nbsp;<span class="op" id="4957281">+</span>&nbsp;<span class="op" id="4957283">(</span><span class="ident" id="4957284">x</span><span class="op" id="4957285">-</span><span class="ident" id="4957286">p</span><span class="op" id="4957287">.</span><span class="ident" id="4957288">Rect</span><span class="op" id="4957292">.</span><span class="ident" id="4957293">Min</span><span class="op" id="4957296">.</span><span class="ident" id="4957297">X</span><span class="op" id="4957298">)</span><span class="op" id="4957299">*</span><span class="num" id="4957300">1</span><br>
<span class="lineno"></span><span class="op" id="4957302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957305">func</span>&nbsp;<span class="op" id="4957310">(</span><span class="ident" id="4957311">p</span>&nbsp;<span class="op" id="4957313">*</span><span class="ident" id="4957314">Paletted</span><span class="op" id="4957322">)</span>&nbsp;<span class="ident" id="4957324">Set</span><span class="op" id="4957327">(</span><span class="ident" id="4957328">x</span><span class="op" id="4957329">,</span>&nbsp;<span class="ident" id="4957331">y</span>&nbsp;<span class="builtintype" id="4957333">int</span><span class="op" id="4957336">,</span>&nbsp;<span class="ident" id="4957338">c</span>&nbsp;<span class="ident" id="4957340">color</span><span class="op" id="4957345">.</span><span class="ident" id="4957346">Color</span><span class="op" id="4957351">)</span>&nbsp;<span class="op" id="4957353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957356">if</span>&nbsp;<span class="op" id="4957359">!</span><span class="op" id="4957360">(</span><span class="ident" id="4957361">Point</span><span class="op" id="4957366">{</span><span class="ident" id="4957367">x</span><span class="op" id="4957368">,</span>&nbsp;<span class="ident" id="4957370">y</span><span class="op" id="4957371">}</span><span class="op" id="4957372">.</span><span class="ident" id="4957373">In</span><span class="op" id="4957375">(</span><span class="ident" id="4957376">p</span><span class="op" id="4957377">.</span><span class="ident" id="4957378">Rect</span><span class="op" id="4957382">)</span><span class="op" id="4957383">)</span>&nbsp;<span class="op" id="4957385">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957400">i</span>&nbsp;<span class="op" id="4957402">:=</span>&nbsp;<span class="ident" id="4957405">p</span><span class="op" id="4957406">.</span><span class="ident" id="4957407">PixOffset</span><span class="op" id="4957416">(</span><span class="ident" id="4957417">x</span><span class="op" id="4957418">,</span>&nbsp;<span class="ident" id="4957420">y</span><span class="op" id="4957421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957424">p</span><span class="op" id="4957425">.</span><span class="ident" id="4957426">Pix</span><span class="op" id="4957429">[</span><span class="ident" id="4957430">i</span><span class="op" id="4957431">]</span>&nbsp;<span class="op" id="4957433">=</span>&nbsp;<span class="builtintype" id="4957435">uint8</span><span class="op" id="4957440">(</span><span class="ident" id="4957441">p</span><span class="op" id="4957442">.</span><span class="ident" id="4957443">Palette</span><span class="op" id="4957450">.</span><span class="ident" id="4957451">Index</span><span class="op" id="4957456">(</span><span class="ident" id="4957457">c</span><span class="op" id="4957458">)</span><span class="op" id="4957459">)</span><br>
<span class="lineno"></span><span class="op" id="4957461">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="4957464">func</span>&nbsp;<span class="op" id="4957469">(</span><span class="ident" id="4957470">p</span>&nbsp;<span class="op" id="4957472">*</span><span class="ident" id="4957473">Paletted</span><span class="op" id="4957481">)</span>&nbsp;<span class="ident" id="4957483">ColorIndexAt</span><span class="op" id="4957495">(</span><span class="ident" id="4957496">x</span><span class="op" id="4957497">,</span>&nbsp;<span class="ident" id="4957499">y</span>&nbsp;<span class="builtintype" id="4957501">int</span><span class="op" id="4957504">)</span>&nbsp;<span class="builtintype" id="4957506">uint8</span>&nbsp;<span class="op" id="4957512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957515">if</span>&nbsp;<span class="op" id="4957518">!</span><span class="op" id="4957519">(</span><span class="ident" id="4957520">Point</span><span class="op" id="4957525">{</span><span class="ident" id="4957526">x</span><span class="op" id="4957527">,</span>&nbsp;<span class="ident" id="4957529">y</span><span class="op" id="4957530">}</span><span class="op" id="4957531">.</span><span class="ident" id="4957532">In</span><span class="op" id="4957534">(</span><span class="ident" id="4957535">p</span><span class="op" id="4957536">.</span><span class="ident" id="4957537">Rect</span><span class="op" id="4957541">)</span><span class="op" id="4957542">)</span>&nbsp;<span class="op" id="4957544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957548">return</span>&nbsp;<span class="num" id="4957555">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957558">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957561">i</span>&nbsp;<span class="op" id="4957563">:=</span>&nbsp;<span class="ident" id="4957566">p</span><span class="op" id="4957567">.</span><span class="ident" id="4957568">PixOffset</span><span class="op" id="4957577">(</span><span class="ident" id="4957578">x</span><span class="op" id="4957579">,</span>&nbsp;<span class="ident" id="4957581">y</span><span class="op" id="4957582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957585">return</span>&nbsp;<span class="ident" id="4957592">p</span><span class="op" id="4957593">.</span><span class="ident" id="4957594">Pix</span><span class="op" id="4957597">[</span><span class="ident" id="4957598">i</span><span class="op" id="4957599">]</span><br>
<span class="lineno"></span><span class="op" id="4957601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957604">func</span>&nbsp;<span class="op" id="4957609">(</span><span class="ident" id="4957610">p</span>&nbsp;<span class="op" id="4957612">*</span><span class="ident" id="4957613">Paletted</span><span class="op" id="4957621">)</span>&nbsp;<span class="ident" id="4957623">SetColorIndex</span><span class="op" id="4957636">(</span><span class="ident" id="4957637">x</span><span class="op" id="4957638">,</span>&nbsp;<span class="ident" id="4957640">y</span>&nbsp;<span class="builtintype" id="4957642">int</span><span class="op" id="4957645">,</span>&nbsp;<span class="ident" id="4957647">index</span>&nbsp;<span class="builtintype" id="4957653">uint8</span><span class="op" id="4957658">)</span>&nbsp;<span class="op" id="4957660">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957663">if</span>&nbsp;<span class="op" id="4957666">!</span><span class="op" id="4957667">(</span><span class="ident" id="4957668">Point</span><span class="op" id="4957673">{</span><span class="ident" id="4957674">x</span><span class="op" id="4957675">,</span>&nbsp;<span class="ident" id="4957677">y</span><span class="op" id="4957678">}</span><span class="op" id="4957679">.</span><span class="ident" id="4957680">In</span><span class="op" id="4957682">(</span><span class="ident" id="4957683">p</span><span class="op" id="4957684">.</span><span class="ident" id="4957685">Rect</span><span class="op" id="4957689">)</span><span class="op" id="4957690">)</span>&nbsp;<span class="op" id="4957692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957707">i</span>&nbsp;<span class="op" id="4957709">:=</span>&nbsp;<span class="ident" id="4957712">p</span><span class="op" id="4957713">.</span><span class="ident" id="4957714">PixOffset</span><span class="op" id="4957723">(</span><span class="ident" id="4957724">x</span><span class="op" id="4957725">,</span>&nbsp;<span class="ident" id="4957727">y</span><span class="op" id="4957728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957731">p</span><span class="op" id="4957732">.</span><span class="ident" id="4957733">Pix</span><span class="op" id="4957736">[</span><span class="ident" id="4957737">i</span><span class="op" id="4957738">]</span>&nbsp;<span class="op" id="4957740">=</span>&nbsp;<span class="ident" id="4957742">index</span><br>
<span class="lineno">885</span><span class="op" id="4957748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4957751">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4957828">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4957900">func</span>&nbsp;<span class="op" id="4957905">(</span><span class="ident" id="4957906">p</span>&nbsp;<span class="op" id="4957908">*</span><span class="ident" id="4957909">Paletted</span><span class="op" id="4957917">)</span>&nbsp;<span class="ident" id="4957919">SubImage</span><span class="op" id="4957927">(</span><span class="ident" id="4957928">r</span>&nbsp;<span class="ident" id="4957930">Rectangle</span><span class="op" id="4957939">)</span>&nbsp;<span class="ident" id="4957941">Image</span>&nbsp;<span class="op" id="4957947">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957950">r</span>&nbsp;<span class="op" id="4957952">=</span>&nbsp;<span class="ident" id="4957954">r</span><span class="op" id="4957955">.</span><span class="ident" id="4957956">Intersect</span><span class="op" id="4957965">(</span><span class="ident" id="4957966">p</span><span class="op" id="4957967">.</span><span class="ident" id="4957968">Rect</span><span class="op" id="4957972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4957975">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958056">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958138">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958188">if</span>&nbsp;<span class="ident" id="4958191">r</span><span class="op" id="4958192">.</span><span class="ident" id="4958193">Empty</span><span class="op" id="4958198">(</span><span class="op" id="4958199">)</span>&nbsp;<span class="op" id="4958201">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958205">return</span>&nbsp;<span class="op" id="4958212">&amp;</span><span class="ident" id="4958213">Paletted</span><span class="op" id="4958221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958226">Palette</span><span class="op" id="4958233">:</span>&nbsp;<span class="ident" id="4958235">p</span><span class="op" id="4958236">.</span><span class="ident" id="4958237">Palette</span><span class="op" id="4958244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958254">i</span>&nbsp;<span class="op" id="4958256">:=</span>&nbsp;<span class="ident" id="4958259">p</span><span class="op" id="4958260">.</span><span class="ident" id="4958261">PixOffset</span><span class="op" id="4958270">(</span><span class="ident" id="4958271">r</span><span class="op" id="4958272">.</span><span class="ident" id="4958273">Min</span><span class="op" id="4958276">.</span><span class="ident" id="4958277">X</span><span class="op" id="4958278">,</span>&nbsp;<span class="ident" id="4958280">r</span><span class="op" id="4958281">.</span><span class="ident" id="4958282">Min</span><span class="op" id="4958285">.</span><span class="ident" id="4958286">Y</span><span class="op" id="4958287">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958290">return</span>&nbsp;<span class="op" id="4958297">&amp;</span><span class="ident" id="4958298">Paletted</span><span class="op" id="4958306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958310">Pix</span><span class="op" id="4958313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958319">p</span><span class="op" id="4958320">.</span><span class="ident" id="4958321">Pix</span><span class="op" id="4958324">[</span><span class="ident" id="4958325">i</span><span class="op" id="4958326">:</span><span class="op" id="4958327">]</span><span class="op" id="4958328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958332">Stride</span><span class="op" id="4958338">:</span>&nbsp;&nbsp;<span class="ident" id="4958341">p</span><span class="op" id="4958342">.</span><span class="ident" id="4958343">Stride</span><span class="op" id="4958349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958353">Rect</span><span class="op" id="4958357">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958362">p</span><span class="op" id="4958363">.</span><span class="ident" id="4958364">Rect</span><span class="op" id="4958368">.</span><span class="ident" id="4958369">Intersect</span><span class="op" id="4958378">(</span><span class="ident" id="4958379">r</span><span class="op" id="4958380">)</span><span class="op" id="4958381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958385">Palette</span><span class="op" id="4958392">:</span>&nbsp;<span class="ident" id="4958394">p</span><span class="op" id="4958395">.</span><span class="ident" id="4958396">Palette</span><span class="op" id="4958403">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958406">}</span><br>
<span class="lineno"></span><span class="op" id="4958408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4958411">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4958484">func</span>&nbsp;<span class="op" id="4958489">(</span><span class="ident" id="4958490">p</span>&nbsp;<span class="op" id="4958492">*</span><span class="ident" id="4958493">Paletted</span><span class="op" id="4958501">)</span>&nbsp;<span class="ident" id="4958503">Opaque</span><span class="op" id="4958509">(</span><span class="op" id="4958510">)</span>&nbsp;<span class="builtintype" id="4958512">bool</span>&nbsp;<span class="op" id="4958517">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958520">var</span>&nbsp;<span class="ident" id="4958524">present</span>&nbsp;<span class="op" id="4958532">[</span><span class="num" id="4958533">256</span><span class="op" id="4958536">]</span><span class="builtintype" id="4958537">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958543">i0</span><span class="op" id="4958545">,</span>&nbsp;<span class="ident" id="4958547">i1</span>&nbsp;<span class="op" id="4958550">:=</span>&nbsp;<span class="num" id="4958553">0</span><span class="op" id="4958554">,</span>&nbsp;<span class="ident" id="4958556">p</span><span class="op" id="4958557">.</span><span class="ident" id="4958558">Rect</span><span class="op" id="4958562">.</span><span class="ident" id="4958563">Dx</span><span class="op" id="4958565">(</span><span class="op" id="4958566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958569">for</span>&nbsp;<span class="ident" id="4958573">y</span>&nbsp;<span class="op" id="4958575">:=</span>&nbsp;<span class="ident" id="4958578">p</span><span class="op" id="4958579">.</span><span class="ident" id="4958580">Rect</span><span class="op" id="4958584">.</span><span class="ident" id="4958585">Min</span><span class="op" id="4958588">.</span><span class="ident" id="4958589">Y</span><span class="op" id="4958590">;</span>&nbsp;<span class="ident" id="4958592">y</span>&nbsp;<span class="op" id="4958594">&lt;</span>&nbsp;<span class="ident" id="4958596">p</span><span class="op" id="4958597">.</span><span class="ident" id="4958598">Rect</span><span class="op" id="4958602">.</span><span class="ident" id="4958603">Max</span><span class="op" id="4958606">.</span><span class="ident" id="4958607">Y</span><span class="op" id="4958608">;</span>&nbsp;<span class="ident" id="4958610">y</span><span class="op" id="4958611">++</span>&nbsp;<span class="op" id="4958614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958618">for</span>&nbsp;<span class="ident" id="4958622">_</span><span class="op" id="4958623">,</span>&nbsp;<span class="ident" id="4958625">c</span>&nbsp;<span class="op" id="4958627">:=</span>&nbsp;<span class="keyword" id="4958630">range</span>&nbsp;<span class="ident" id="4958636">p</span><span class="op" id="4958637">.</span><span class="ident" id="4958638">Pix</span><span class="op" id="4958641">[</span><span class="ident" id="4958642">i0</span><span class="op" id="4958644">:</span><span class="ident" id="4958645">i1</span><span class="op" id="4958647">]</span>&nbsp;<span class="op" id="4958649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958654">present</span><span class="op" id="4958661">[</span><span class="ident" id="4958662">c</span><span class="op" id="4958663">]</span>&nbsp;<span class="op" id="4958665">=</span>&nbsp;<span class="builtintype" id="4958667">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958678">i0</span>&nbsp;<span class="op" id="4958681">+=</span>&nbsp;<span class="ident" id="4958684">p</span><span class="op" id="4958685">.</span><span class="ident" id="4958686">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958695">i1</span>&nbsp;<span class="op" id="4958698">+=</span>&nbsp;<span class="ident" id="4958701">p</span><span class="op" id="4958702">.</span><span class="ident" id="4958703">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958714">for</span>&nbsp;<span class="ident" id="4958718">i</span><span class="op" id="4958719">,</span>&nbsp;<span class="ident" id="4958721">c</span>&nbsp;<span class="op" id="4958723">:=</span>&nbsp;<span class="keyword" id="4958726">range</span>&nbsp;<span class="ident" id="4958732">p</span><span class="op" id="4958733">.</span><span class="ident" id="4958734">Palette</span>&nbsp;<span class="op" id="4958742">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958746">if</span>&nbsp;<span class="op" id="4958749">!</span><span class="ident" id="4958750">present</span><span class="op" id="4958757">[</span><span class="ident" id="4958758">i</span><span class="op" id="4958759">]</span>&nbsp;<span class="op" id="4958761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958766">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958781">_</span><span class="op" id="4958782">,</span>&nbsp;<span class="ident" id="4958784">_</span><span class="op" id="4958785">,</span>&nbsp;<span class="ident" id="4958787">_</span><span class="op" id="4958788">,</span>&nbsp;<span class="ident" id="4958790">a</span>&nbsp;<span class="op" id="4958792">:=</span>&nbsp;<span class="ident" id="4958795">c</span><span class="op" id="4958796">.</span><span class="ident" id="4958797">RGBA</span><span class="op" id="4958801">(</span><span class="op" id="4958802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958806">if</span>&nbsp;<span class="ident" id="4958809">a</span>&nbsp;<span class="op" id="4958811">!=</span>&nbsp;<span class="num" id="4958814">0xffff</span>&nbsp;<span class="op" id="4958821">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958826">return</span>&nbsp;<span class="builtintype" id="4958833">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958847">return</span>&nbsp;<span class="builtintype" id="4958854">true</span><br>
<span class="lineno"></span><span class="op" id="4958859">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="4958862">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="4958942">func</span>&nbsp;<span class="ident" id="4958947">NewPaletted</span><span class="op" id="4958958">(</span><span class="ident" id="4958959">r</span>&nbsp;<span class="ident" id="4958961">Rectangle</span><span class="op" id="4958970">,</span>&nbsp;<span class="ident" id="4958972">p</span>&nbsp;<span class="ident" id="4958974">color</span><span class="op" id="4958979">.</span><span class="ident" id="4958980">Palette</span><span class="op" id="4958987">)</span>&nbsp;<span class="op" id="4958989">*</span><span class="ident" id="4958990">Paletted</span>&nbsp;<span class="op" id="4958999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959002">w</span><span class="op" id="4959003">,</span>&nbsp;<span class="ident" id="4959005">h</span>&nbsp;<span class="op" id="4959007">:=</span>&nbsp;<span class="ident" id="4959010">r</span><span class="op" id="4959011">.</span><span class="ident" id="4959012">Dx</span><span class="op" id="4959014">(</span><span class="op" id="4959015">)</span><span class="op" id="4959016">,</span>&nbsp;<span class="ident" id="4959018">r</span><span class="op" id="4959019">.</span><span class="ident" id="4959020">Dy</span><span class="op" id="4959022">(</span><span class="op" id="4959023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959026">pix</span>&nbsp;<span class="op" id="4959030">:=</span>&nbsp;<span class="builtinfunc" id="4959033">make</span><span class="op" id="4959037">(</span><span class="op" id="4959038">[</span><span class="op" id="4959039">]</span><span class="builtintype" id="4959040">uint8</span><span class="op" id="4959045">,</span>&nbsp;<span class="num" id="4959047">1</span><span class="op" id="4959048">*</span><span class="ident" id="4959049">w</span><span class="op" id="4959050">*</span><span class="ident" id="4959051">h</span><span class="op" id="4959052">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959055">return</span>&nbsp;<span class="op" id="4959062">&amp;</span><span class="ident" id="4959063">Paletted</span><span class="op" id="4959071">{</span><span class="ident" id="4959072">pix</span><span class="op" id="4959075">,</span>&nbsp;<span class="num" id="4959077">1</span>&nbsp;<span class="op" id="4959079">*</span>&nbsp;<span class="ident" id="4959081">w</span><span class="op" id="4959082">,</span>&nbsp;<span class="ident" id="4959084">r</span><span class="op" id="4959085">,</span>&nbsp;<span class="ident" id="4959087">p</span><span class="op" id="4959088">}</span><br>
<span class="lineno"></span><span class="op" id="4959090">}</span>
</div>
</body>
</html>
