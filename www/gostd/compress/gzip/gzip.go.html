<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4540505">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4540560">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4540614">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4540665">package</span>&nbsp;<span class="ident" id="4540673">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4540679">import</span>&nbsp;<span class="op" id="4540686">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4540689">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4540707">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4540717">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4540724">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4540732">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4540746">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4540751">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4540754">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4540834">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4540900">const</span>&nbsp;<span class="op" id="4540906">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540909">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540928">=</span>&nbsp;<span class="ident" id="4540930">flate</span><span class="op" id="4540935">.</span><span class="ident" id="4540936">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540951">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540970">=</span>&nbsp;<span class="ident" id="4540972">flate</span><span class="op" id="4540977">.</span><span class="ident" id="4540978">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540989">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541008">=</span>&nbsp;<span class="ident" id="4541010">flate</span><span class="op" id="4541015">.</span><span class="ident" id="4541016">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541033">DefaultCompression</span>&nbsp;<span class="op" id="4541052">=</span>&nbsp;<span class="ident" id="4541054">flate</span><span class="op" id="4541059">.</span><span class="ident" id="4541060">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4541079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4541082">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4541116">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4541171">type</span>&nbsp;<span class="ident" id="4541176">Writer</span>&nbsp;<span class="keyword" id="4541183">struct</span>&nbsp;<span class="op" id="4541190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541193">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541201">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541213">io</span><span class="op" id="4541215">.</span><span class="ident" id="4541216">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541224">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4541236">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541241">wroteHeader</span>&nbsp;<span class="builtintype" id="4541253">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541259">compressor</span>&nbsp;&nbsp;<span class="op" id="4541271">*</span><span class="ident" id="4541272">flate</span><span class="op" id="4541277">.</span><span class="ident" id="4541278">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541286">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541298">hash</span><span class="op" id="4541302">.</span><span class="ident" id="4541303">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541311">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4541323">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541331">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4541343">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541349">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541361">[</span><span class="num" id="4541362">10</span><span class="op" id="4541364">]</span><span class="builtintype" id="4541365">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4541371">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4541383">error</span><br>
<span class="lineno"></span><span class="op" id="4541389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4541392">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4541427">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4541493">//</span><br>
<span class="lineno"></span><span class="comment" id="4541496">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4541577">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4541632">//</span><br>
<span class="lineno"></span><span class="comment" id="4541635">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4541709">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4541785">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4541863">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4541942">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4541961">func</span>&nbsp;<span class="ident" id="4541966">NewWriter</span><span class="op" id="4541975">(</span><span class="ident" id="4541976">w</span>&nbsp;<span class="ident" id="4541978">io</span><span class="op" id="4541980">.</span><span class="ident" id="4541981">Writer</span><span class="op" id="4541987">)</span>&nbsp;<span class="op" id="4541989">*</span><span class="ident" id="4541990">Writer</span>&nbsp;<span class="op" id="4541997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542000">z</span><span class="op" id="4542001">,</span>&nbsp;<span class="ident" id="4542003">_</span>&nbsp;<span class="op" id="4542005">:=</span>&nbsp;<span class="ident" id="4542008">NewWriterLevel</span><span class="op" id="4542022">(</span><span class="ident" id="4542023">w</span><span class="op" id="4542024">,</span>&nbsp;<span class="ident" id="4542026">DefaultCompression</span><span class="op" id="4542044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4542047">return</span>&nbsp;<span class="ident" id="4542054">z</span><br>
<span class="lineno"></span><span class="op" id="4542056">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4542059">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4542139">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4542174">//</span><br>
<span class="lineno"></span><span class="comment" id="4542177">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4542251">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4542327">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4542374">func</span>&nbsp;<span class="ident" id="4542379">NewWriterLevel</span><span class="op" id="4542393">(</span><span class="ident" id="4542394">w</span>&nbsp;<span class="ident" id="4542396">io</span><span class="op" id="4542398">.</span><span class="ident" id="4542399">Writer</span><span class="op" id="4542405">,</span>&nbsp;<span class="ident" id="4542407">level</span>&nbsp;<span class="builtintype" id="4542413">int</span><span class="op" id="4542416">)</span>&nbsp;<span class="op" id="4542418">(</span><span class="op" id="4542419">*</span><span class="ident" id="4542420">Writer</span><span class="op" id="4542426">,</span>&nbsp;<span class="builtintype" id="4542428">error</span><span class="op" id="4542433">)</span>&nbsp;<span class="op" id="4542435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4542438">if</span>&nbsp;<span class="ident" id="4542441">level</span>&nbsp;<span class="op" id="4542447">&lt;</span>&nbsp;<span class="ident" id="4542449">DefaultCompression</span>&nbsp;<span class="op" id="4542468">||</span>&nbsp;<span class="ident" id="4542471">level</span>&nbsp;<span class="op" id="4542477">&gt;</span>&nbsp;<span class="ident" id="4542479">BestCompression</span>&nbsp;<span class="op" id="4542495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4542499">return</span>&nbsp;<span class="ident" id="4542506">nil</span><span class="op" id="4542509">,</span>&nbsp;<span class="ident" id="4542511">fmt</span><span class="op" id="4542514">.</span><span class="ident" id="4542515">Errorf</span><span class="op" id="4542521">(</span><span class="string" id="4542522">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4542559">,</span>&nbsp;<span class="ident" id="4542561">level</span><span class="op" id="4542566">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542572">z</span>&nbsp;<span class="op" id="4542574">:=</span>&nbsp;<span class="builtinfunc" id="4542577">new</span><span class="op" id="4542580">(</span><span class="ident" id="4542581">Writer</span><span class="op" id="4542587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542590">z</span><span class="op" id="4542591">.</span><span class="ident" id="4542592">init</span><span class="op" id="4542596">(</span><span class="ident" id="4542597">w</span><span class="op" id="4542598">,</span>&nbsp;<span class="ident" id="4542600">level</span><span class="op" id="4542605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4542608">return</span>&nbsp;<span class="ident" id="4542615">z</span><span class="op" id="4542616">,</span>&nbsp;<span class="ident" id="4542618">nil</span><br>
<span class="lineno"></span><span class="op" id="4542622">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4542625">func</span>&nbsp;<span class="op" id="4542630">(</span><span class="ident" id="4542631">z</span>&nbsp;<span class="op" id="4542633">*</span><span class="ident" id="4542634">Writer</span><span class="op" id="4542640">)</span>&nbsp;<span class="ident" id="4542642">init</span><span class="op" id="4542646">(</span><span class="ident" id="4542647">w</span>&nbsp;<span class="ident" id="4542649">io</span><span class="op" id="4542651">.</span><span class="ident" id="4542652">Writer</span><span class="op" id="4542658">,</span>&nbsp;<span class="ident" id="4542660">level</span>&nbsp;<span class="builtintype" id="4542666">int</span><span class="op" id="4542669">)</span>&nbsp;<span class="op" id="4542671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542674">digest</span>&nbsp;<span class="op" id="4542681">:=</span>&nbsp;<span class="ident" id="4542684">z</span><span class="op" id="4542685">.</span><span class="ident" id="4542686">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4542694">if</span>&nbsp;<span class="ident" id="4542697">digest</span>&nbsp;<span class="op" id="4542704">!=</span>&nbsp;<span class="ident" id="4542707">nil</span>&nbsp;<span class="op" id="4542711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542715">digest</span><span class="op" id="4542721">.</span><span class="ident" id="4542722">Reset</span><span class="op" id="4542727">(</span><span class="op" id="4542728">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542731">}</span>&nbsp;<span class="keyword" id="4542733">else</span>&nbsp;<span class="op" id="4542738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542742">digest</span>&nbsp;<span class="op" id="4542749">=</span>&nbsp;<span class="ident" id="4542751">crc32</span><span class="op" id="4542756">.</span><span class="ident" id="4542757">NewIEEE</span><span class="op" id="4542764">(</span><span class="op" id="4542765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542771">compressor</span>&nbsp;<span class="op" id="4542782">:=</span>&nbsp;<span class="ident" id="4542785">z</span><span class="op" id="4542786">.</span><span class="ident" id="4542787">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4542799">if</span>&nbsp;<span class="ident" id="4542802">compressor</span>&nbsp;<span class="op" id="4542813">!=</span>&nbsp;<span class="ident" id="4542816">nil</span>&nbsp;<span class="op" id="4542820">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542824">compressor</span><span class="op" id="4542834">.</span><span class="ident" id="4542835">Reset</span><span class="op" id="4542840">(</span><span class="ident" id="4542841">w</span><span class="op" id="4542842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542848">*</span><span class="ident" id="4542849">z</span>&nbsp;<span class="op" id="4542851">=</span>&nbsp;<span class="ident" id="4542853">Writer</span><span class="op" id="4542859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542863">Header</span><span class="op" id="4542869">:</span>&nbsp;<span class="ident" id="4542871">Header</span><span class="op" id="4542877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542882">OS</span><span class="op" id="4542884">:</span>&nbsp;<span class="num" id="4542886">255</span><span class="op" id="4542889">,</span>&nbsp;<span class="comment" id="4542891">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542904">}</span><span class="op" id="4542905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542909">w</span><span class="op" id="4542910">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542921">w</span><span class="op" id="4542922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542926">level</span><span class="op" id="4542931">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542938">level</span><span class="op" id="4542943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542947">digest</span><span class="op" id="4542953">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542959">digest</span><span class="op" id="4542965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4542969">compressor</span><span class="op" id="4542979">:</span>&nbsp;<span class="ident" id="4542981">compressor</span><span class="op" id="4542991">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4542994">}</span><br>
<span class="lineno"></span><span class="op" id="4542996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4542999">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4543069">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4543139">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4543206">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4543231">func</span>&nbsp;<span class="op" id="4543236">(</span><span class="ident" id="4543237">z</span>&nbsp;<span class="op" id="4543239">*</span><span class="ident" id="4543240">Writer</span><span class="op" id="4543246">)</span>&nbsp;<span class="ident" id="4543248">Reset</span><span class="op" id="4543253">(</span><span class="ident" id="4543254">w</span>&nbsp;<span class="ident" id="4543256">io</span><span class="op" id="4543258">.</span><span class="ident" id="4543259">Writer</span><span class="op" id="4543265">)</span>&nbsp;<span class="op" id="4543267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543270">z</span><span class="op" id="4543271">.</span><span class="ident" id="4543272">init</span><span class="op" id="4543276">(</span><span class="ident" id="4543277">w</span><span class="op" id="4543278">,</span>&nbsp;<span class="ident" id="4543280">z</span><span class="op" id="4543281">.</span><span class="ident" id="4543282">level</span><span class="op" id="4543287">)</span><br>
<span class="lineno"></span><span class="op" id="4543289">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4543292">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4543353">func</span>&nbsp;<span class="ident" id="4543358">put2</span><span class="op" id="4543362">(</span><span class="ident" id="4543363">p</span>&nbsp;<span class="op" id="4543365">[</span><span class="op" id="4543366">]</span><span class="builtintype" id="4543367">byte</span><span class="op" id="4543371">,</span>&nbsp;<span class="ident" id="4543373">v</span>&nbsp;<span class="builtintype" id="4543375">uint16</span><span class="op" id="4543381">)</span>&nbsp;<span class="op" id="4543383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543386">p</span><span class="op" id="4543387">[</span><span class="num" id="4543388">0</span><span class="op" id="4543389">]</span>&nbsp;<span class="op" id="4543391">=</span>&nbsp;<span class="builtintype" id="4543393">uint8</span><span class="op" id="4543398">(</span><span class="ident" id="4543399">v</span>&nbsp;<span class="op" id="4543401">&gt;&gt;</span>&nbsp;<span class="num" id="4543404">0</span><span class="op" id="4543405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543408">p</span><span class="op" id="4543409">[</span><span class="num" id="4543410">1</span><span class="op" id="4543411">]</span>&nbsp;<span class="op" id="4543413">=</span>&nbsp;<span class="builtintype" id="4543415">uint8</span><span class="op" id="4543420">(</span><span class="ident" id="4543421">v</span>&nbsp;<span class="op" id="4543423">&gt;&gt;</span>&nbsp;<span class="num" id="4543426">8</span><span class="op" id="4543427">)</span><br>
<span class="lineno">105</span><span class="op" id="4543429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4543432">func</span>&nbsp;<span class="ident" id="4543437">put4</span><span class="op" id="4543441">(</span><span class="ident" id="4543442">p</span>&nbsp;<span class="op" id="4543444">[</span><span class="op" id="4543445">]</span><span class="builtintype" id="4543446">byte</span><span class="op" id="4543450">,</span>&nbsp;<span class="ident" id="4543452">v</span>&nbsp;<span class="builtintype" id="4543454">uint32</span><span class="op" id="4543460">)</span>&nbsp;<span class="op" id="4543462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543465">p</span><span class="op" id="4543466">[</span><span class="num" id="4543467">0</span><span class="op" id="4543468">]</span>&nbsp;<span class="op" id="4543470">=</span>&nbsp;<span class="builtintype" id="4543472">uint8</span><span class="op" id="4543477">(</span><span class="ident" id="4543478">v</span>&nbsp;<span class="op" id="4543480">&gt;&gt;</span>&nbsp;<span class="num" id="4543483">0</span><span class="op" id="4543484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543487">p</span><span class="op" id="4543488">[</span><span class="num" id="4543489">1</span><span class="op" id="4543490">]</span>&nbsp;<span class="op" id="4543492">=</span>&nbsp;<span class="builtintype" id="4543494">uint8</span><span class="op" id="4543499">(</span><span class="ident" id="4543500">v</span>&nbsp;<span class="op" id="4543502">&gt;&gt;</span>&nbsp;<span class="num" id="4543505">8</span><span class="op" id="4543506">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543509">p</span><span class="op" id="4543510">[</span><span class="num" id="4543511">2</span><span class="op" id="4543512">]</span>&nbsp;<span class="op" id="4543514">=</span>&nbsp;<span class="builtintype" id="4543516">uint8</span><span class="op" id="4543521">(</span><span class="ident" id="4543522">v</span>&nbsp;<span class="op" id="4543524">&gt;&gt;</span>&nbsp;<span class="num" id="4543527">16</span><span class="op" id="4543529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543532">p</span><span class="op" id="4543533">[</span><span class="num" id="4543534">3</span><span class="op" id="4543535">]</span>&nbsp;<span class="op" id="4543537">=</span>&nbsp;<span class="builtintype" id="4543539">uint8</span><span class="op" id="4543544">(</span><span class="ident" id="4543545">v</span>&nbsp;<span class="op" id="4543547">&gt;&gt;</span>&nbsp;<span class="num" id="4543550">24</span><span class="op" id="4543552">)</span><br>
<span class="lineno"></span><span class="op" id="4543554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4543557">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4543615">func</span>&nbsp;<span class="op" id="4543620">(</span><span class="ident" id="4543621">z</span>&nbsp;<span class="op" id="4543623">*</span><span class="ident" id="4543624">Writer</span><span class="op" id="4543630">)</span>&nbsp;<span class="ident" id="4543632">writeBytes</span><span class="op" id="4543642">(</span><span class="ident" id="4543643">b</span>&nbsp;<span class="op" id="4543645">[</span><span class="op" id="4543646">]</span><span class="builtintype" id="4543647">byte</span><span class="op" id="4543651">)</span>&nbsp;<span class="builtintype" id="4543653">error</span>&nbsp;<span class="op" id="4543659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4543662">if</span>&nbsp;<span class="builtinfunc" id="4543665">len</span><span class="op" id="4543668">(</span><span class="ident" id="4543669">b</span><span class="op" id="4543670">)</span>&nbsp;<span class="op" id="4543672">&gt;</span>&nbsp;<span class="num" id="4543674">0xffff</span>&nbsp;<span class="op" id="4543681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4543685">return</span>&nbsp;<span class="ident" id="4543692">errors</span><span class="op" id="4543698">.</span><span class="ident" id="4543699">New</span><span class="op" id="4543702">(</span><span class="string" id="4543703">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4543740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4543743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543746">put2</span><span class="op" id="4543750">(</span><span class="ident" id="4543751">z</span><span class="op" id="4543752">.</span><span class="ident" id="4543753">buf</span><span class="op" id="4543756">[</span><span class="num" id="4543757">0</span><span class="op" id="4543758">:</span><span class="num" id="4543759">2</span><span class="op" id="4543760">]</span><span class="op" id="4543761">,</span>&nbsp;<span class="builtintype" id="4543763">uint16</span><span class="op" id="4543769">(</span><span class="builtinfunc" id="4543770">len</span><span class="op" id="4543773">(</span><span class="ident" id="4543774">b</span><span class="op" id="4543775">)</span><span class="op" id="4543776">)</span><span class="op" id="4543777">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543780">_</span><span class="op" id="4543781">,</span>&nbsp;<span class="ident" id="4543783">err</span>&nbsp;<span class="op" id="4543787">:=</span>&nbsp;<span class="ident" id="4543790">z</span><span class="op" id="4543791">.</span><span class="ident" id="4543792">w</span><span class="op" id="4543793">.</span><span class="ident" id="4543794">Write</span><span class="op" id="4543799">(</span><span class="ident" id="4543800">z</span><span class="op" id="4543801">.</span><span class="ident" id="4543802">buf</span><span class="op" id="4543805">[</span><span class="num" id="4543806">0</span><span class="op" id="4543807">:</span><span class="num" id="4543808">2</span><span class="op" id="4543809">]</span><span class="op" id="4543810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4543813">if</span>&nbsp;<span class="ident" id="4543816">err</span>&nbsp;<span class="op" id="4543820">!=</span>&nbsp;<span class="ident" id="4543823">nil</span>&nbsp;<span class="op" id="4543827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4543831">return</span>&nbsp;<span class="ident" id="4543838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4543843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543846">_</span><span class="op" id="4543847">,</span>&nbsp;<span class="ident" id="4543849">err</span>&nbsp;<span class="op" id="4543853">=</span>&nbsp;<span class="ident" id="4543855">z</span><span class="op" id="4543856">.</span><span class="ident" id="4543857">w</span><span class="op" id="4543858">.</span><span class="ident" id="4543859">Write</span><span class="op" id="4543864">(</span><span class="ident" id="4543865">b</span><span class="op" id="4543866">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4543869">return</span>&nbsp;<span class="ident" id="4543876">err</span><br>
<span class="lineno"></span><span class="op" id="4543880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4543883">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4543947">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4544030">func</span>&nbsp;<span class="op" id="4544035">(</span><span class="ident" id="4544036">z</span>&nbsp;<span class="op" id="4544038">*</span><span class="ident" id="4544039">Writer</span><span class="op" id="4544045">)</span>&nbsp;<span class="ident" id="4544047">writeString</span><span class="op" id="4544058">(</span><span class="ident" id="4544059">s</span>&nbsp;<span class="builtintype" id="4544061">string</span><span class="op" id="4544067">)</span>&nbsp;<span class="op" id="4544069">(</span><span class="ident" id="4544070">err</span>&nbsp;<span class="builtintype" id="4544074">error</span><span class="op" id="4544079">)</span>&nbsp;<span class="op" id="4544081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4544084">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544161">needconv</span>&nbsp;<span class="op" id="4544170">:=</span>&nbsp;<span class="builtintype" id="4544173">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544180">for</span>&nbsp;<span class="ident" id="4544184">_</span><span class="op" id="4544185">,</span>&nbsp;<span class="ident" id="4544187">v</span>&nbsp;<span class="op" id="4544189">:=</span>&nbsp;<span class="keyword" id="4544192">range</span>&nbsp;<span class="ident" id="4544198">s</span>&nbsp;<span class="op" id="4544200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544204">if</span>&nbsp;<span class="ident" id="4544207">v</span>&nbsp;<span class="op" id="4544209">==</span>&nbsp;<span class="num" id="4544212">0</span>&nbsp;<span class="op" id="4544214">||</span>&nbsp;<span class="ident" id="4544217">v</span>&nbsp;<span class="op" id="4544219">&gt;</span>&nbsp;<span class="num" id="4544221">0xff</span>&nbsp;<span class="op" id="4544226">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544231">return</span>&nbsp;<span class="ident" id="4544238">errors</span><span class="op" id="4544244">.</span><span class="ident" id="4544245">New</span><span class="op" id="4544248">(</span><span class="string" id="4544249">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4544288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544296">if</span>&nbsp;<span class="ident" id="4544299">v</span>&nbsp;<span class="op" id="4544301">&gt;</span>&nbsp;<span class="num" id="4544303">0x7f</span>&nbsp;<span class="op" id="4544308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544313">needconv</span>&nbsp;<span class="op" id="4544322">=</span>&nbsp;<span class="builtintype" id="4544324">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544331">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544337">if</span>&nbsp;<span class="ident" id="4544340">needconv</span>&nbsp;<span class="op" id="4544349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544353">b</span>&nbsp;<span class="op" id="4544355">:=</span>&nbsp;<span class="builtinfunc" id="4544358">make</span><span class="op" id="4544362">(</span><span class="op" id="4544363">[</span><span class="op" id="4544364">]</span><span class="builtintype" id="4544365">byte</span><span class="op" id="4544369">,</span>&nbsp;<span class="num" id="4544371">0</span><span class="op" id="4544372">,</span>&nbsp;<span class="builtinfunc" id="4544374">len</span><span class="op" id="4544377">(</span><span class="ident" id="4544378">s</span><span class="op" id="4544379">)</span><span class="op" id="4544380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544384">for</span>&nbsp;<span class="ident" id="4544388">_</span><span class="op" id="4544389">,</span>&nbsp;<span class="ident" id="4544391">v</span>&nbsp;<span class="op" id="4544393">:=</span>&nbsp;<span class="keyword" id="4544396">range</span>&nbsp;<span class="ident" id="4544402">s</span>&nbsp;<span class="op" id="4544404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544409">b</span>&nbsp;<span class="op" id="4544411">=</span>&nbsp;<span class="builtinfunc" id="4544413">append</span><span class="op" id="4544419">(</span><span class="ident" id="4544420">b</span><span class="op" id="4544421">,</span>&nbsp;<span class="builtintype" id="4544423">byte</span><span class="op" id="4544427">(</span><span class="ident" id="4544428">v</span><span class="op" id="4544429">)</span><span class="op" id="4544430">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544438">_</span><span class="op" id="4544439">,</span>&nbsp;<span class="ident" id="4544441">err</span>&nbsp;<span class="op" id="4544445">=</span>&nbsp;<span class="ident" id="4544447">z</span><span class="op" id="4544448">.</span><span class="ident" id="4544449">w</span><span class="op" id="4544450">.</span><span class="ident" id="4544451">Write</span><span class="op" id="4544456">(</span><span class="ident" id="4544457">b</span><span class="op" id="4544458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544461">}</span>&nbsp;<span class="keyword" id="4544463">else</span>&nbsp;<span class="op" id="4544468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544472">_</span><span class="op" id="4544473">,</span>&nbsp;<span class="ident" id="4544475">err</span>&nbsp;<span class="op" id="4544479">=</span>&nbsp;<span class="ident" id="4544481">io</span><span class="op" id="4544483">.</span><span class="ident" id="4544484">WriteString</span><span class="op" id="4544495">(</span><span class="ident" id="4544496">z</span><span class="op" id="4544497">.</span><span class="ident" id="4544498">w</span><span class="op" id="4544499">,</span>&nbsp;<span class="ident" id="4544501">s</span><span class="op" id="4544502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544505">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544508">if</span>&nbsp;<span class="ident" id="4544511">err</span>&nbsp;<span class="op" id="4544515">!=</span>&nbsp;<span class="ident" id="4544518">nil</span>&nbsp;<span class="op" id="4544522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544526">return</span>&nbsp;<span class="ident" id="4544533">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4544541">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544578">z</span><span class="op" id="4544579">.</span><span class="ident" id="4544580">buf</span><span class="op" id="4544583">[</span><span class="num" id="4544584">0</span><span class="op" id="4544585">]</span>&nbsp;<span class="op" id="4544587">=</span>&nbsp;<span class="num" id="4544589">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544592">_</span><span class="op" id="4544593">,</span>&nbsp;<span class="ident" id="4544595">err</span>&nbsp;<span class="op" id="4544599">=</span>&nbsp;<span class="ident" id="4544601">z</span><span class="op" id="4544602">.</span><span class="ident" id="4544603">w</span><span class="op" id="4544604">.</span><span class="ident" id="4544605">Write</span><span class="op" id="4544610">(</span><span class="ident" id="4544611">z</span><span class="op" id="4544612">.</span><span class="ident" id="4544613">buf</span><span class="op" id="4544616">[</span><span class="num" id="4544617">0</span><span class="op" id="4544618">:</span><span class="num" id="4544619">1</span><span class="op" id="4544620">]</span><span class="op" id="4544621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544624">return</span>&nbsp;<span class="ident" id="4544631">err</span><br>
<span class="lineno"></span><span class="op" id="4544635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4544638">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4544710">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4544786">func</span>&nbsp;<span class="op" id="4544791">(</span><span class="ident" id="4544792">z</span>&nbsp;<span class="op" id="4544794">*</span><span class="ident" id="4544795">Writer</span><span class="op" id="4544801">)</span>&nbsp;<span class="ident" id="4544803">Write</span><span class="op" id="4544808">(</span><span class="ident" id="4544809">p</span>&nbsp;<span class="op" id="4544811">[</span><span class="op" id="4544812">]</span><span class="builtintype" id="4544813">byte</span><span class="op" id="4544817">)</span>&nbsp;<span class="op" id="4544819">(</span><span class="builtintype" id="4544820">int</span><span class="op" id="4544823">,</span>&nbsp;<span class="builtintype" id="4544825">error</span><span class="op" id="4544830">)</span>&nbsp;<span class="op" id="4544832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544835">if</span>&nbsp;<span class="ident" id="4544838">z</span><span class="op" id="4544839">.</span><span class="ident" id="4544840">err</span>&nbsp;<span class="op" id="4544844">!=</span>&nbsp;<span class="ident" id="4544847">nil</span>&nbsp;<span class="op" id="4544851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544855">return</span>&nbsp;<span class="num" id="4544862">0</span><span class="op" id="4544863">,</span>&nbsp;<span class="ident" id="4544865">z</span><span class="op" id="4544866">.</span><span class="ident" id="4544867">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544872">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544875">var</span>&nbsp;<span class="ident" id="4544879">n</span>&nbsp;<span class="builtintype" id="4544881">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4544886">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544920">if</span>&nbsp;<span class="op" id="4544923">!</span><span class="ident" id="4544924">z</span><span class="op" id="4544925">.</span><span class="ident" id="4544926">wroteHeader</span>&nbsp;<span class="op" id="4544938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544942">z</span><span class="op" id="4544943">.</span><span class="ident" id="4544944">wroteHeader</span>&nbsp;<span class="op" id="4544956">=</span>&nbsp;<span class="builtintype" id="4544958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544965">z</span><span class="op" id="4544966">.</span><span class="ident" id="4544967">buf</span><span class="op" id="4544970">[</span><span class="num" id="4544971">0</span><span class="op" id="4544972">]</span>&nbsp;<span class="op" id="4544974">=</span>&nbsp;<span class="ident" id="4544976">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544986">z</span><span class="op" id="4544987">.</span><span class="ident" id="4544988">buf</span><span class="op" id="4544991">[</span><span class="num" id="4544992">1</span><span class="op" id="4544993">]</span>&nbsp;<span class="op" id="4544995">=</span>&nbsp;<span class="ident" id="4544997">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545007">z</span><span class="op" id="4545008">.</span><span class="ident" id="4545009">buf</span><span class="op" id="4545012">[</span><span class="num" id="4545013">2</span><span class="op" id="4545014">]</span>&nbsp;<span class="op" id="4545016">=</span>&nbsp;<span class="ident" id="4545018">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545032">z</span><span class="op" id="4545033">.</span><span class="ident" id="4545034">buf</span><span class="op" id="4545037">[</span><span class="num" id="4545038">3</span><span class="op" id="4545039">]</span>&nbsp;<span class="op" id="4545041">=</span>&nbsp;<span class="num" id="4545043">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545047">if</span>&nbsp;<span class="ident" id="4545050">z</span><span class="op" id="4545051">.</span><span class="ident" id="4545052">Extra</span>&nbsp;<span class="op" id="4545058">!=</span>&nbsp;<span class="ident" id="4545061">nil</span>&nbsp;<span class="op" id="4545065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545070">z</span><span class="op" id="4545071">.</span><span class="ident" id="4545072">buf</span><span class="op" id="4545075">[</span><span class="num" id="4545076">3</span><span class="op" id="4545077">]</span>&nbsp;<span class="op" id="4545079">|=</span>&nbsp;<span class="num" id="4545082">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545093">if</span>&nbsp;<span class="ident" id="4545096">z</span><span class="op" id="4545097">.</span><span class="ident" id="4545098">Name</span>&nbsp;<span class="op" id="4545103">!=</span>&nbsp;<span class="string" id="4545106">&#34;&#34;</span>&nbsp;<span class="op" id="4545109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545114">z</span><span class="op" id="4545115">.</span><span class="ident" id="4545116">buf</span><span class="op" id="4545119">[</span><span class="num" id="4545120">3</span><span class="op" id="4545121">]</span>&nbsp;<span class="op" id="4545123">|=</span>&nbsp;<span class="num" id="4545126">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545137">if</span>&nbsp;<span class="ident" id="4545140">z</span><span class="op" id="4545141">.</span><span class="ident" id="4545142">Comment</span>&nbsp;<span class="op" id="4545150">!=</span>&nbsp;<span class="string" id="4545153">&#34;&#34;</span>&nbsp;<span class="op" id="4545156">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545161">z</span><span class="op" id="4545162">.</span><span class="ident" id="4545163">buf</span><span class="op" id="4545166">[</span><span class="num" id="4545167">3</span><span class="op" id="4545168">]</span>&nbsp;<span class="op" id="4545170">|=</span>&nbsp;<span class="num" id="4545173">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545184">put4</span><span class="op" id="4545188">(</span><span class="ident" id="4545189">z</span><span class="op" id="4545190">.</span><span class="ident" id="4545191">buf</span><span class="op" id="4545194">[</span><span class="num" id="4545195">4</span><span class="op" id="4545196">:</span><span class="num" id="4545197">8</span><span class="op" id="4545198">]</span><span class="op" id="4545199">,</span>&nbsp;<span class="builtintype" id="4545201">uint32</span><span class="op" id="4545207">(</span><span class="ident" id="4545208">z</span><span class="op" id="4545209">.</span><span class="ident" id="4545210">ModTime</span><span class="op" id="4545217">.</span><span class="ident" id="4545218">Unix</span><span class="op" id="4545222">(</span><span class="op" id="4545223">)</span><span class="op" id="4545224">)</span><span class="op" id="4545225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545229">if</span>&nbsp;<span class="ident" id="4545232">z</span><span class="op" id="4545233">.</span><span class="ident" id="4545234">level</span>&nbsp;<span class="op" id="4545240">==</span>&nbsp;<span class="ident" id="4545243">BestCompression</span>&nbsp;<span class="op" id="4545259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545264">z</span><span class="op" id="4545265">.</span><span class="ident" id="4545266">buf</span><span class="op" id="4545269">[</span><span class="num" id="4545270">8</span><span class="op" id="4545271">]</span>&nbsp;<span class="op" id="4545273">=</span>&nbsp;<span class="num" id="4545275">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545279">}</span>&nbsp;<span class="keyword" id="4545281">else</span>&nbsp;<span class="keyword" id="4545286">if</span>&nbsp;<span class="ident" id="4545289">z</span><span class="op" id="4545290">.</span><span class="ident" id="4545291">level</span>&nbsp;<span class="op" id="4545297">==</span>&nbsp;<span class="ident" id="4545300">BestSpeed</span>&nbsp;<span class="op" id="4545310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545315">z</span><span class="op" id="4545316">.</span><span class="ident" id="4545317">buf</span><span class="op" id="4545320">[</span><span class="num" id="4545321">8</span><span class="op" id="4545322">]</span>&nbsp;<span class="op" id="4545324">=</span>&nbsp;<span class="num" id="4545326">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545330">}</span>&nbsp;<span class="keyword" id="4545332">else</span>&nbsp;<span class="op" id="4545337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545342">z</span><span class="op" id="4545343">.</span><span class="ident" id="4545344">buf</span><span class="op" id="4545347">[</span><span class="num" id="4545348">8</span><span class="op" id="4545349">]</span>&nbsp;<span class="op" id="4545351">=</span>&nbsp;<span class="num" id="4545353">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545357">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545361">z</span><span class="op" id="4545362">.</span><span class="ident" id="4545363">buf</span><span class="op" id="4545366">[</span><span class="num" id="4545367">9</span><span class="op" id="4545368">]</span>&nbsp;<span class="op" id="4545370">=</span>&nbsp;<span class="ident" id="4545372">z</span><span class="op" id="4545373">.</span><span class="ident" id="4545374">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545379">n</span><span class="op" id="4545380">,</span>&nbsp;<span class="ident" id="4545382">z</span><span class="op" id="4545383">.</span><span class="ident" id="4545384">err</span>&nbsp;<span class="op" id="4545388">=</span>&nbsp;<span class="ident" id="4545390">z</span><span class="op" id="4545391">.</span><span class="ident" id="4545392">w</span><span class="op" id="4545393">.</span><span class="ident" id="4545394">Write</span><span class="op" id="4545399">(</span><span class="ident" id="4545400">z</span><span class="op" id="4545401">.</span><span class="ident" id="4545402">buf</span><span class="op" id="4545405">[</span><span class="num" id="4545406">0</span><span class="op" id="4545407">:</span><span class="num" id="4545408">10</span><span class="op" id="4545410">]</span><span class="op" id="4545411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545415">if</span>&nbsp;<span class="ident" id="4545418">z</span><span class="op" id="4545419">.</span><span class="ident" id="4545420">err</span>&nbsp;<span class="op" id="4545424">!=</span>&nbsp;<span class="ident" id="4545427">nil</span>&nbsp;<span class="op" id="4545431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545436">return</span>&nbsp;<span class="ident" id="4545443">n</span><span class="op" id="4545444">,</span>&nbsp;<span class="ident" id="4545446">z</span><span class="op" id="4545447">.</span><span class="ident" id="4545448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545454">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545458">if</span>&nbsp;<span class="ident" id="4545461">z</span><span class="op" id="4545462">.</span><span class="ident" id="4545463">Extra</span>&nbsp;<span class="op" id="4545469">!=</span>&nbsp;<span class="ident" id="4545472">nil</span>&nbsp;<span class="op" id="4545476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545481">z</span><span class="op" id="4545482">.</span><span class="ident" id="4545483">err</span>&nbsp;<span class="op" id="4545487">=</span>&nbsp;<span class="ident" id="4545489">z</span><span class="op" id="4545490">.</span><span class="ident" id="4545491">writeBytes</span><span class="op" id="4545501">(</span><span class="ident" id="4545502">z</span><span class="op" id="4545503">.</span><span class="ident" id="4545504">Extra</span><span class="op" id="4545509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545514">if</span>&nbsp;<span class="ident" id="4545517">z</span><span class="op" id="4545518">.</span><span class="ident" id="4545519">err</span>&nbsp;<span class="op" id="4545523">!=</span>&nbsp;<span class="ident" id="4545526">nil</span>&nbsp;<span class="op" id="4545530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545536">return</span>&nbsp;<span class="ident" id="4545543">n</span><span class="op" id="4545544">,</span>&nbsp;<span class="ident" id="4545546">z</span><span class="op" id="4545547">.</span><span class="ident" id="4545548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545555">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545563">if</span>&nbsp;<span class="ident" id="4545566">z</span><span class="op" id="4545567">.</span><span class="ident" id="4545568">Name</span>&nbsp;<span class="op" id="4545573">!=</span>&nbsp;<span class="string" id="4545576">&#34;&#34;</span>&nbsp;<span class="op" id="4545579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545584">z</span><span class="op" id="4545585">.</span><span class="ident" id="4545586">err</span>&nbsp;<span class="op" id="4545590">=</span>&nbsp;<span class="ident" id="4545592">z</span><span class="op" id="4545593">.</span><span class="ident" id="4545594">writeString</span><span class="op" id="4545605">(</span><span class="ident" id="4545606">z</span><span class="op" id="4545607">.</span><span class="ident" id="4545608">Name</span><span class="op" id="4545612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545617">if</span>&nbsp;<span class="ident" id="4545620">z</span><span class="op" id="4545621">.</span><span class="ident" id="4545622">err</span>&nbsp;<span class="op" id="4545626">!=</span>&nbsp;<span class="ident" id="4545629">nil</span>&nbsp;<span class="op" id="4545633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545639">return</span>&nbsp;<span class="ident" id="4545646">n</span><span class="op" id="4545647">,</span>&nbsp;<span class="ident" id="4545649">z</span><span class="op" id="4545650">.</span><span class="ident" id="4545651">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545666">if</span>&nbsp;<span class="ident" id="4545669">z</span><span class="op" id="4545670">.</span><span class="ident" id="4545671">Comment</span>&nbsp;<span class="op" id="4545679">!=</span>&nbsp;<span class="string" id="4545682">&#34;&#34;</span>&nbsp;<span class="op" id="4545685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545690">z</span><span class="op" id="4545691">.</span><span class="ident" id="4545692">err</span>&nbsp;<span class="op" id="4545696">=</span>&nbsp;<span class="ident" id="4545698">z</span><span class="op" id="4545699">.</span><span class="ident" id="4545700">writeString</span><span class="op" id="4545711">(</span><span class="ident" id="4545712">z</span><span class="op" id="4545713">.</span><span class="ident" id="4545714">Comment</span><span class="op" id="4545721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545726">if</span>&nbsp;<span class="ident" id="4545729">z</span><span class="op" id="4545730">.</span><span class="ident" id="4545731">err</span>&nbsp;<span class="op" id="4545735">!=</span>&nbsp;<span class="ident" id="4545738">nil</span>&nbsp;<span class="op" id="4545742">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545748">return</span>&nbsp;<span class="ident" id="4545755">n</span><span class="op" id="4545756">,</span>&nbsp;<span class="ident" id="4545758">z</span><span class="op" id="4545759">.</span><span class="ident" id="4545760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545775">if</span>&nbsp;<span class="ident" id="4545778">z</span><span class="op" id="4545779">.</span><span class="ident" id="4545780">compressor</span>&nbsp;<span class="op" id="4545791">==</span>&nbsp;<span class="ident" id="4545794">nil</span>&nbsp;<span class="op" id="4545798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545803">z</span><span class="op" id="4545804">.</span><span class="ident" id="4545805">compressor</span><span class="op" id="4545815">,</span>&nbsp;<span class="ident" id="4545817">_</span>&nbsp;<span class="op" id="4545819">=</span>&nbsp;<span class="ident" id="4545821">flate</span><span class="op" id="4545826">.</span><span class="ident" id="4545827">NewWriter</span><span class="op" id="4545836">(</span><span class="ident" id="4545837">z</span><span class="op" id="4545838">.</span><span class="ident" id="4545839">w</span><span class="op" id="4545840">,</span>&nbsp;<span class="ident" id="4545842">z</span><span class="op" id="4545843">.</span><span class="ident" id="4545844">level</span><span class="op" id="4545849">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545859">z</span><span class="op" id="4545860">.</span><span class="ident" id="4545861">size</span>&nbsp;<span class="op" id="4545866">+=</span>&nbsp;<span class="builtintype" id="4545869">uint32</span><span class="op" id="4545875">(</span><span class="builtinfunc" id="4545876">len</span><span class="op" id="4545879">(</span><span class="ident" id="4545880">p</span><span class="op" id="4545881">)</span><span class="op" id="4545882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545885">z</span><span class="op" id="4545886">.</span><span class="ident" id="4545887">digest</span><span class="op" id="4545893">.</span><span class="ident" id="4545894">Write</span><span class="op" id="4545899">(</span><span class="ident" id="4545900">p</span><span class="op" id="4545901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545904">n</span><span class="op" id="4545905">,</span>&nbsp;<span class="ident" id="4545907">z</span><span class="op" id="4545908">.</span><span class="ident" id="4545909">err</span>&nbsp;<span class="op" id="4545913">=</span>&nbsp;<span class="ident" id="4545915">z</span><span class="op" id="4545916">.</span><span class="ident" id="4545917">compressor</span><span class="op" id="4545927">.</span><span class="ident" id="4545928">Write</span><span class="op" id="4545933">(</span><span class="ident" id="4545934">p</span><span class="op" id="4545935">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545938">return</span>&nbsp;<span class="ident" id="4545945">n</span><span class="op" id="4545946">,</span>&nbsp;<span class="ident" id="4545948">z</span><span class="op" id="4545949">.</span><span class="ident" id="4545950">err</span><br>
<span class="lineno"></span><span class="op" id="4545954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4545957">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4546028">//</span><br>
<span class="lineno">225</span><span class="comment" id="4546031">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4546102">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4546173">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4546238">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4546292">//</span><br>
<span class="lineno">230</span><span class="comment" id="4546295">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4546375">func</span>&nbsp;<span class="op" id="4546380">(</span><span class="ident" id="4546381">z</span>&nbsp;<span class="op" id="4546383">*</span><span class="ident" id="4546384">Writer</span><span class="op" id="4546390">)</span>&nbsp;<span class="ident" id="4546392">Flush</span><span class="op" id="4546397">(</span><span class="op" id="4546398">)</span>&nbsp;<span class="builtintype" id="4546400">error</span>&nbsp;<span class="op" id="4546406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546409">if</span>&nbsp;<span class="ident" id="4546412">z</span><span class="op" id="4546413">.</span><span class="ident" id="4546414">err</span>&nbsp;<span class="op" id="4546418">!=</span>&nbsp;<span class="ident" id="4546421">nil</span>&nbsp;<span class="op" id="4546425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546429">return</span>&nbsp;<span class="ident" id="4546436">z</span><span class="op" id="4546437">.</span><span class="ident" id="4546438">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546443">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546446">if</span>&nbsp;<span class="ident" id="4546449">z</span><span class="op" id="4546450">.</span><span class="ident" id="4546451">closed</span>&nbsp;<span class="op" id="4546458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546462">return</span>&nbsp;<span class="ident" id="4546469">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546477">if</span>&nbsp;<span class="op" id="4546480">!</span><span class="ident" id="4546481">z</span><span class="op" id="4546482">.</span><span class="ident" id="4546483">wroteHeader</span>&nbsp;<span class="op" id="4546495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546499">z</span><span class="op" id="4546500">.</span><span class="ident" id="4546501">Write</span><span class="op" id="4546506">(</span><span class="ident" id="4546507">nil</span><span class="op" id="4546510">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546514">if</span>&nbsp;<span class="ident" id="4546517">z</span><span class="op" id="4546518">.</span><span class="ident" id="4546519">err</span>&nbsp;<span class="op" id="4546523">!=</span>&nbsp;<span class="ident" id="4546526">nil</span>&nbsp;<span class="op" id="4546530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546535">return</span>&nbsp;<span class="ident" id="4546542">z</span><span class="op" id="4546543">.</span><span class="ident" id="4546544">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546556">z</span><span class="op" id="4546557">.</span><span class="ident" id="4546558">err</span>&nbsp;<span class="op" id="4546562">=</span>&nbsp;<span class="ident" id="4546564">z</span><span class="op" id="4546565">.</span><span class="ident" id="4546566">compressor</span><span class="op" id="4546576">.</span><span class="ident" id="4546577">Flush</span><span class="op" id="4546582">(</span><span class="op" id="4546583">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546586">return</span>&nbsp;<span class="ident" id="4546593">z</span><span class="op" id="4546594">.</span><span class="ident" id="4546595">err</span><br>
<span class="lineno"></span><span class="op" id="4546599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4546602">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4546676">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4546735">func</span>&nbsp;<span class="op" id="4546740">(</span><span class="ident" id="4546741">z</span>&nbsp;<span class="op" id="4546743">*</span><span class="ident" id="4546744">Writer</span><span class="op" id="4546750">)</span>&nbsp;<span class="ident" id="4546752">Close</span><span class="op" id="4546757">(</span><span class="op" id="4546758">)</span>&nbsp;<span class="builtintype" id="4546760">error</span>&nbsp;<span class="op" id="4546766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546769">if</span>&nbsp;<span class="ident" id="4546772">z</span><span class="op" id="4546773">.</span><span class="ident" id="4546774">err</span>&nbsp;<span class="op" id="4546778">!=</span>&nbsp;<span class="ident" id="4546781">nil</span>&nbsp;<span class="op" id="4546785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546789">return</span>&nbsp;<span class="ident" id="4546796">z</span><span class="op" id="4546797">.</span><span class="ident" id="4546798">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546806">if</span>&nbsp;<span class="ident" id="4546809">z</span><span class="op" id="4546810">.</span><span class="ident" id="4546811">closed</span>&nbsp;<span class="op" id="4546818">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546822">return</span>&nbsp;<span class="ident" id="4546829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546837">z</span><span class="op" id="4546838">.</span><span class="ident" id="4546839">closed</span>&nbsp;<span class="op" id="4546846">=</span>&nbsp;<span class="builtintype" id="4546848">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546854">if</span>&nbsp;<span class="op" id="4546857">!</span><span class="ident" id="4546858">z</span><span class="op" id="4546859">.</span><span class="ident" id="4546860">wroteHeader</span>&nbsp;<span class="op" id="4546872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546876">z</span><span class="op" id="4546877">.</span><span class="ident" id="4546878">Write</span><span class="op" id="4546883">(</span><span class="ident" id="4546884">nil</span><span class="op" id="4546887">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546891">if</span>&nbsp;<span class="ident" id="4546894">z</span><span class="op" id="4546895">.</span><span class="ident" id="4546896">err</span>&nbsp;<span class="op" id="4546900">!=</span>&nbsp;<span class="ident" id="4546903">nil</span>&nbsp;<span class="op" id="4546907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546912">return</span>&nbsp;<span class="ident" id="4546919">z</span><span class="op" id="4546920">.</span><span class="ident" id="4546921">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546933">z</span><span class="op" id="4546934">.</span><span class="ident" id="4546935">err</span>&nbsp;<span class="op" id="4546939">=</span>&nbsp;<span class="ident" id="4546941">z</span><span class="op" id="4546942">.</span><span class="ident" id="4546943">compressor</span><span class="op" id="4546953">.</span><span class="ident" id="4546954">Close</span><span class="op" id="4546959">(</span><span class="op" id="4546960">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546963">if</span>&nbsp;<span class="ident" id="4546966">z</span><span class="op" id="4546967">.</span><span class="ident" id="4546968">err</span>&nbsp;<span class="op" id="4546972">!=</span>&nbsp;<span class="ident" id="4546975">nil</span>&nbsp;<span class="op" id="4546979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546983">return</span>&nbsp;<span class="ident" id="4546990">z</span><span class="op" id="4546991">.</span><span class="ident" id="4546992">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547000">put4</span><span class="op" id="4547004">(</span><span class="ident" id="4547005">z</span><span class="op" id="4547006">.</span><span class="ident" id="4547007">buf</span><span class="op" id="4547010">[</span><span class="num" id="4547011">0</span><span class="op" id="4547012">:</span><span class="num" id="4547013">4</span><span class="op" id="4547014">]</span><span class="op" id="4547015">,</span>&nbsp;<span class="ident" id="4547017">z</span><span class="op" id="4547018">.</span><span class="ident" id="4547019">digest</span><span class="op" id="4547025">.</span><span class="ident" id="4547026">Sum32</span><span class="op" id="4547031">(</span><span class="op" id="4547032">)</span><span class="op" id="4547033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547036">put4</span><span class="op" id="4547040">(</span><span class="ident" id="4547041">z</span><span class="op" id="4547042">.</span><span class="ident" id="4547043">buf</span><span class="op" id="4547046">[</span><span class="num" id="4547047">4</span><span class="op" id="4547048">:</span><span class="num" id="4547049">8</span><span class="op" id="4547050">]</span><span class="op" id="4547051">,</span>&nbsp;<span class="ident" id="4547053">z</span><span class="op" id="4547054">.</span><span class="ident" id="4547055">size</span><span class="op" id="4547059">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547062">_</span><span class="op" id="4547063">,</span>&nbsp;<span class="ident" id="4547065">z</span><span class="op" id="4547066">.</span><span class="ident" id="4547067">err</span>&nbsp;<span class="op" id="4547071">=</span>&nbsp;<span class="ident" id="4547073">z</span><span class="op" id="4547074">.</span><span class="ident" id="4547075">w</span><span class="op" id="4547076">.</span><span class="ident" id="4547077">Write</span><span class="op" id="4547082">(</span><span class="ident" id="4547083">z</span><span class="op" id="4547084">.</span><span class="ident" id="4547085">buf</span><span class="op" id="4547088">[</span><span class="num" id="4547089">0</span><span class="op" id="4547090">:</span><span class="num" id="4547091">8</span><span class="op" id="4547092">]</span><span class="op" id="4547093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4547096">return</span>&nbsp;<span class="ident" id="4547103">z</span><span class="op" id="4547104">.</span><span class="ident" id="4547105">err</span><br>
<span class="lineno"></span><span class="op" id="4547109">}</span>
</div>
</body>
</html>
