<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3636373">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3636428">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3636482">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3636533">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3636611">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3636665">package</span>&nbsp;<span class="ident" id="3636673">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3636681">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3636736">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3636813">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3636863">func</span>&nbsp;<span class="ident" id="3636868">ConstantTimeCompare</span><span class="op" id="3636887">(</span><span class="ident" id="3636888">x</span><span class="op" id="3636889">,</span>&nbsp;<span class="ident" id="3636891">y</span>&nbsp;<span class="op" id="3636893">[</span><span class="op" id="3636894">]</span><span class="builtintype" id="3636895">byte</span><span class="op" id="3636899">)</span>&nbsp;<span class="builtintype" id="3636901">int</span>&nbsp;<span class="op" id="3636905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636908">if</span>&nbsp;<span class="builtinfunc" id="3636911">len</span><span class="op" id="3636914">(</span><span class="ident" id="3636915">x</span><span class="op" id="3636916">)</span>&nbsp;<span class="op" id="3636918">!=</span>&nbsp;<span class="builtinfunc" id="3636921">len</span><span class="op" id="3636924">(</span><span class="ident" id="3636925">y</span><span class="op" id="3636926">)</span>&nbsp;<span class="op" id="3636928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636932">return</span>&nbsp;<span class="num" id="3636939">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636946">var</span>&nbsp;<span class="ident" id="3636950">v</span>&nbsp;<span class="builtintype" id="3636952">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636959">for</span>&nbsp;<span class="ident" id="3636963">i</span>&nbsp;<span class="op" id="3636965">:=</span>&nbsp;<span class="num" id="3636968">0</span><span class="op" id="3636969">;</span>&nbsp;<span class="ident" id="3636971">i</span>&nbsp;<span class="op" id="3636973">&lt;</span>&nbsp;<span class="builtinfunc" id="3636975">len</span><span class="op" id="3636978">(</span><span class="ident" id="3636979">x</span><span class="op" id="3636980">)</span><span class="op" id="3636981">;</span>&nbsp;<span class="ident" id="3636983">i</span><span class="op" id="3636984">++</span>&nbsp;<span class="op" id="3636987">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636991">v</span>&nbsp;<span class="op" id="3636993">|=</span>&nbsp;<span class="ident" id="3636996">x</span><span class="op" id="3636997">[</span><span class="ident" id="3636998">i</span><span class="op" id="3636999">]</span>&nbsp;<span class="op" id="3637001">^</span>&nbsp;<span class="ident" id="3637003">y</span><span class="op" id="3637004">[</span><span class="ident" id="3637005">i</span><span class="op" id="3637006">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637013">return</span>&nbsp;<span class="ident" id="3637020">ConstantTimeByteEq</span><span class="op" id="3637038">(</span><span class="ident" id="3637039">v</span><span class="op" id="3637040">,</span>&nbsp;<span class="num" id="3637042">0</span><span class="op" id="3637043">)</span><br>
<span class="lineno"></span><span class="op" id="3637045">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3637048">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3637107">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3637164">func</span>&nbsp;<span class="ident" id="3637169">ConstantTimeSelect</span><span class="op" id="3637187">(</span><span class="ident" id="3637188">v</span><span class="op" id="3637189">,</span>&nbsp;<span class="ident" id="3637191">x</span><span class="op" id="3637192">,</span>&nbsp;<span class="ident" id="3637194">y</span>&nbsp;<span class="builtintype" id="3637196">int</span><span class="op" id="3637199">)</span>&nbsp;<span class="builtintype" id="3637201">int</span>&nbsp;<span class="op" id="3637205">{</span>&nbsp;<span class="keyword" id="3637207">return</span>&nbsp;<span class="op" id="3637214">^</span><span class="op" id="3637215">(</span><span class="ident" id="3637216">v</span><span class="op" id="3637217">-</span><span class="num" id="3637218">1</span><span class="op" id="3637219">)</span><span class="op" id="3637220">&amp;</span><span class="ident" id="3637221">x</span>&nbsp;<span class="op" id="3637223">|</span>&nbsp;<span class="op" id="3637225">(</span><span class="ident" id="3637226">v</span><span class="op" id="3637227">-</span><span class="num" id="3637228">1</span><span class="op" id="3637229">)</span><span class="op" id="3637230">&amp;</span><span class="ident" id="3637231">y</span>&nbsp;<span class="op" id="3637233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3637236">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3637295">func</span>&nbsp;<span class="ident" id="3637300">ConstantTimeByteEq</span><span class="op" id="3637318">(</span><span class="ident" id="3637319">x</span><span class="op" id="3637320">,</span>&nbsp;<span class="ident" id="3637322">y</span>&nbsp;<span class="builtintype" id="3637324">uint8</span><span class="op" id="3637329">)</span>&nbsp;<span class="builtintype" id="3637331">int</span>&nbsp;<span class="op" id="3637335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637338">z</span>&nbsp;<span class="op" id="3637340">:=</span>&nbsp;<span class="op" id="3637343">^</span><span class="op" id="3637344">(</span><span class="ident" id="3637345">x</span>&nbsp;<span class="op" id="3637347">^</span>&nbsp;<span class="ident" id="3637349">y</span><span class="op" id="3637350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637353">z</span>&nbsp;<span class="op" id="3637355">&amp;=</span>&nbsp;<span class="ident" id="3637358">z</span>&nbsp;<span class="op" id="3637360">&gt;&gt;</span>&nbsp;<span class="num" id="3637363">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637366">z</span>&nbsp;<span class="op" id="3637368">&amp;=</span>&nbsp;<span class="ident" id="3637371">z</span>&nbsp;<span class="op" id="3637373">&gt;&gt;</span>&nbsp;<span class="num" id="3637376">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637379">z</span>&nbsp;<span class="op" id="3637381">&amp;=</span>&nbsp;<span class="ident" id="3637384">z</span>&nbsp;<span class="op" id="3637386">&gt;&gt;</span>&nbsp;<span class="num" id="3637389">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637393">return</span>&nbsp;<span class="builtintype" id="3637400">int</span><span class="op" id="3637403">(</span><span class="ident" id="3637404">z</span><span class="op" id="3637405">)</span><br>
<span class="lineno"></span><span class="op" id="3637407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3637410">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3637465">func</span>&nbsp;<span class="ident" id="3637470">ConstantTimeEq</span><span class="op" id="3637484">(</span><span class="ident" id="3637485">x</span><span class="op" id="3637486">,</span>&nbsp;<span class="ident" id="3637488">y</span>&nbsp;<span class="builtintype" id="3637490">int32</span><span class="op" id="3637495">)</span>&nbsp;<span class="builtintype" id="3637497">int</span>&nbsp;<span class="op" id="3637501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637504">z</span>&nbsp;<span class="op" id="3637506">:=</span>&nbsp;<span class="op" id="3637509">^</span><span class="op" id="3637510">(</span><span class="ident" id="3637511">x</span>&nbsp;<span class="op" id="3637513">^</span>&nbsp;<span class="ident" id="3637515">y</span><span class="op" id="3637516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637519">z</span>&nbsp;<span class="op" id="3637521">&amp;=</span>&nbsp;<span class="ident" id="3637524">z</span>&nbsp;<span class="op" id="3637526">&gt;&gt;</span>&nbsp;<span class="num" id="3637529">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637533">z</span>&nbsp;<span class="op" id="3637535">&amp;=</span>&nbsp;<span class="ident" id="3637538">z</span>&nbsp;<span class="op" id="3637540">&gt;&gt;</span>&nbsp;<span class="num" id="3637543">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637546">z</span>&nbsp;<span class="op" id="3637548">&amp;=</span>&nbsp;<span class="ident" id="3637551">z</span>&nbsp;<span class="op" id="3637553">&gt;&gt;</span>&nbsp;<span class="num" id="3637556">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637559">z</span>&nbsp;<span class="op" id="3637561">&amp;=</span>&nbsp;<span class="ident" id="3637564">z</span>&nbsp;<span class="op" id="3637566">&gt;&gt;</span>&nbsp;<span class="num" id="3637569">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637572">z</span>&nbsp;<span class="op" id="3637574">&amp;=</span>&nbsp;<span class="ident" id="3637577">z</span>&nbsp;<span class="op" id="3637579">&gt;&gt;</span>&nbsp;<span class="num" id="3637582">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637586">return</span>&nbsp;<span class="builtintype" id="3637593">int</span><span class="op" id="3637596">(</span><span class="ident" id="3637597">z</span>&nbsp;<span class="op" id="3637599">&amp;</span>&nbsp;<span class="num" id="3637601">1</span><span class="op" id="3637602">)</span><br>
<span class="lineno">50</span><span class="op" id="3637604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3637607">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3637685">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3637762">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3637788">func</span>&nbsp;<span class="ident" id="3637793">ConstantTimeCopy</span><span class="op" id="3637809">(</span><span class="ident" id="3637810">v</span>&nbsp;<span class="builtintype" id="3637812">int</span><span class="op" id="3637815">,</span>&nbsp;<span class="ident" id="3637817">x</span><span class="op" id="3637818">,</span>&nbsp;<span class="ident" id="3637820">y</span>&nbsp;<span class="op" id="3637822">[</span><span class="op" id="3637823">]</span><span class="builtintype" id="3637824">byte</span><span class="op" id="3637828">)</span>&nbsp;<span class="op" id="3637830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637833">if</span>&nbsp;<span class="builtinfunc" id="3637836">len</span><span class="op" id="3637839">(</span><span class="ident" id="3637840">x</span><span class="op" id="3637841">)</span>&nbsp;<span class="op" id="3637843">!=</span>&nbsp;<span class="builtinfunc" id="3637846">len</span><span class="op" id="3637849">(</span><span class="ident" id="3637850">y</span><span class="op" id="3637851">)</span>&nbsp;<span class="op" id="3637853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3637857">panic</span><span class="op" id="3637862">(</span><span class="string" id="3637863">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3637902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637909">xmask</span>&nbsp;<span class="op" id="3637915">:=</span>&nbsp;<span class="builtintype" id="3637918">byte</span><span class="op" id="3637922">(</span><span class="ident" id="3637923">v</span>&nbsp;<span class="op" id="3637925">-</span>&nbsp;<span class="num" id="3637927">1</span><span class="op" id="3637928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637931">ymask</span>&nbsp;<span class="op" id="3637937">:=</span>&nbsp;<span class="builtintype" id="3637940">byte</span><span class="op" id="3637944">(</span><span class="op" id="3637945">^</span><span class="op" id="3637946">(</span><span class="ident" id="3637947">v</span>&nbsp;<span class="op" id="3637949">-</span>&nbsp;<span class="num" id="3637951">1</span><span class="op" id="3637952">)</span><span class="op" id="3637953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637956">for</span>&nbsp;<span class="ident" id="3637960">i</span>&nbsp;<span class="op" id="3637962">:=</span>&nbsp;<span class="num" id="3637965">0</span><span class="op" id="3637966">;</span>&nbsp;<span class="ident" id="3637968">i</span>&nbsp;<span class="op" id="3637970">&lt;</span>&nbsp;<span class="builtinfunc" id="3637972">len</span><span class="op" id="3637975">(</span><span class="ident" id="3637976">x</span><span class="op" id="3637977">)</span><span class="op" id="3637978">;</span>&nbsp;<span class="ident" id="3637980">i</span><span class="op" id="3637981">++</span>&nbsp;<span class="op" id="3637984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637988">x</span><span class="op" id="3637989">[</span><span class="ident" id="3637990">i</span><span class="op" id="3637991">]</span>&nbsp;<span class="op" id="3637993">=</span>&nbsp;<span class="ident" id="3637995">x</span><span class="op" id="3637996">[</span><span class="ident" id="3637997">i</span><span class="op" id="3637998">]</span><span class="op" id="3637999">&amp;</span><span class="ident" id="3638000">xmask</span>&nbsp;<span class="op" id="3638006">|</span>&nbsp;<span class="ident" id="3638008">y</span><span class="op" id="3638009">[</span><span class="ident" id="3638010">i</span><span class="op" id="3638011">]</span><span class="op" id="3638012">&amp;</span><span class="ident" id="3638013">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638020">}</span><br>
<span class="lineno">65</span><span class="op" id="3638022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638025">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3638086">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3638154">func</span>&nbsp;<span class="ident" id="3638159">ConstantTimeLessOrEq</span><span class="op" id="3638179">(</span><span class="ident" id="3638180">x</span><span class="op" id="3638181">,</span>&nbsp;<span class="ident" id="3638183">y</span>&nbsp;<span class="builtintype" id="3638185">int</span><span class="op" id="3638188">)</span>&nbsp;<span class="builtintype" id="3638190">int</span>&nbsp;<span class="op" id="3638194">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638197">x32</span>&nbsp;<span class="op" id="3638201">:=</span>&nbsp;<span class="builtintype" id="3638204">int32</span><span class="op" id="3638209">(</span><span class="ident" id="3638210">x</span><span class="op" id="3638211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638214">y32</span>&nbsp;<span class="op" id="3638218">:=</span>&nbsp;<span class="builtintype" id="3638221">int32</span><span class="op" id="3638226">(</span><span class="ident" id="3638227">y</span><span class="op" id="3638228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638231">return</span>&nbsp;<span class="builtintype" id="3638238">int</span><span class="op" id="3638241">(</span><span class="op" id="3638242">(</span><span class="op" id="3638243">(</span><span class="ident" id="3638244">x32</span>&nbsp;<span class="op" id="3638248">-</span>&nbsp;<span class="ident" id="3638250">y32</span>&nbsp;<span class="op" id="3638254">-</span>&nbsp;<span class="num" id="3638256">1</span><span class="op" id="3638257">)</span>&nbsp;<span class="op" id="3638259">&gt;&gt;</span>&nbsp;<span class="num" id="3638262">31</span><span class="op" id="3638264">)</span>&nbsp;<span class="op" id="3638266">&amp;</span>&nbsp;<span class="num" id="3638268">1</span><span class="op" id="3638269">)</span><br>
<span class="lineno"></span><span class="op" id="3638271">}</span>
</div>
</body>
</html>
