<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html" class="current">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7429690">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7429745">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7429799">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7429850">//&nbsp;Tests&nbsp;a&nbsp;Go&nbsp;CGI&nbsp;program&nbsp;running&nbsp;under&nbsp;a&nbsp;Go&nbsp;CGI&nbsp;host&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="7429913">//&nbsp;Further,&nbsp;the&nbsp;two&nbsp;programs&nbsp;are&nbsp;the&nbsp;same&nbsp;binary,&nbsp;just&nbsp;checking</span><br>
<span class="lineno"></span><span class="comment" id="7429977">//&nbsp;their&nbsp;environment&nbsp;to&nbsp;figure&nbsp;out&nbsp;what&nbsp;mode&nbsp;to&nbsp;run&nbsp;in.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430034">package</span>&nbsp;<span class="ident" id="7430042">cgi</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="7430047">import</span>&nbsp;<span class="op" id="7430054">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430057">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430066">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430076">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430083">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430089">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430101">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430122">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430128">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430139">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430150">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7430157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7430160">//&nbsp;This&nbsp;test&nbsp;is&nbsp;a&nbsp;CGI&nbsp;host&nbsp;(testing&nbsp;host.go)&nbsp;that&nbsp;runs&nbsp;its&nbsp;own&nbsp;binary</span><br>
<span class="lineno">25</span><span class="comment" id="7430230">//&nbsp;as&nbsp;a&nbsp;child&nbsp;process&nbsp;testing&nbsp;the&nbsp;other&nbsp;half&nbsp;of&nbsp;CGI&nbsp;(child.go).</span><br>
<span class="lineno"></span><span class="keyword" id="7430294">func</span>&nbsp;<span class="ident" id="7430299">TestHostingOurselves</span><span class="op" id="7430319">(</span><span class="ident" id="7430320">t</span>&nbsp;<span class="op" id="7430322">*</span><span class="ident" id="7430323"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7430330">.</span><span class="ident" id="7430331"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7430332">)</span>&nbsp;<span class="op" id="7430334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430337">if</span>&nbsp;<span class="ident" id="7430340"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430128">runtime</a></span><span class="op" id="7430347">.</span><span class="ident" id="7430348"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="7430353">==</span>&nbsp;<span class="string" id="7430356">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7430363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430367"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430320">t</a></span><span class="op" id="7430368">.</span><span class="ident" id="7430369"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="7430373">(</span><span class="string" id="7430374">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="7430392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430395">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430399">h</span>&nbsp;<span class="op" id="7430401">:=</span>&nbsp;<span class="op" id="7430404">&amp;</span><span class="ident" id="7430405"><a href="/gostd/net/http/cgi/host.go.html#5695901">Handler</a></span><span class="op" id="7430412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430416"><a href="/gostd/net/http/cgi/host.go.html#5695919">Path</a></span><span class="op" id="7430420">:</span>&nbsp;<span class="ident" id="7430422"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7430424">.</span><span class="ident" id="7430425"><a href="/gostd/os/proc.go.html#2468733">Args</a></span><span class="op" id="7430429">[</span><span class="num" id="7430430">0</span><span class="op" id="7430431">]</span><span class="op" id="7430432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430436"><a href="/gostd/net/http/cgi/host.go.html#5695962">Root</a></span><span class="op" id="7430440">:</span>&nbsp;<span class="string" id="7430442">&#34;/test.go&#34;</span><span class="op" id="7430452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430456"><a href="/gostd/net/http/cgi/host.go.html#5696470">Args</a></span><span class="op" id="7430460">:</span>&nbsp;<span class="op" id="7430462">[</span><span class="op" id="7430463">]</span><span class="builtintype" id="7430464">string</span><span class="op" id="7430470">{</span><span class="string" id="7430471">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7430504">}</span><span class="op" id="7430505">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430511">expectedMap</span>&nbsp;<span class="op" id="7430523">:=</span>&nbsp;<span class="keyword" id="7430526">map</span><span class="op" id="7430529">[</span><span class="builtintype" id="7430530">string</span><span class="op" id="7430536">]</span><span class="builtintype" id="7430537">string</span><span class="op" id="7430543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430547">&#34;test&#34;</span><span class="op" id="7430553">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430572">&#34;Hello&nbsp;CGI-in-CGI&#34;</span><span class="op" id="7430590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430594">&#34;param-a&#34;</span><span class="op" id="7430603">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430619">&#34;b&#34;</span><span class="op" id="7430622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430626">&#34;param-foo&#34;</span><span class="op" id="7430637">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430651">&#34;bar&#34;</span><span class="op" id="7430656">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430660">&#34;env-GATEWAY_INTERFACE&#34;</span><span class="op" id="7430683">:</span>&nbsp;<span class="string" id="7430685">&#34;CGI/1.1&#34;</span><span class="op" id="7430694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430698">&#34;env-HTTP_HOST&#34;</span><span class="op" id="7430713">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430723">&#34;example.com&#34;</span><span class="op" id="7430736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430740">&#34;env-PATH_INFO&#34;</span><span class="op" id="7430755">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430765">&#34;&#34;</span><span class="op" id="7430767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430771">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7430789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430796">&#34;foo=bar&amp;a=b&#34;</span><span class="op" id="7430809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430813">&#34;env-REMOTE_ADDR&#34;</span><span class="op" id="7430830">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430838">&#34;1.2.3.4&#34;</span><span class="op" id="7430847">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430851">&#34;env-REMOTE_HOST&#34;</span><span class="op" id="7430868">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430876">&#34;1.2.3.4&#34;</span><span class="op" id="7430885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430889">&#34;env-REQUEST_METHOD&#34;</span><span class="op" id="7430909">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430914">&#34;GET&#34;</span><span class="op" id="7430919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430923">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7430940">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430948">&#34;/test.go?foo=bar&amp;a=b&#34;</span><span class="op" id="7430970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430974">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7430995">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7430999"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7431001">.</span><span class="ident" id="7431002"><a href="/gostd/os/proc.go.html#2468733">Args</a></span><span class="op" id="7431006">[</span><span class="num" id="7431007">0</span><span class="op" id="7431008">]</span><span class="op" id="7431009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431013">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7431030">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431038">&#34;/test.go&#34;</span><span class="op" id="7431048">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431052">&#34;env-SERVER_NAME&#34;</span><span class="op" id="7431069">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431077">&#34;example.com&#34;</span><span class="op" id="7431090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431094">&#34;env-SERVER_PORT&#34;</span><span class="op" id="7431111">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431119">&#34;80&#34;</span><span class="op" id="7431123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7431127">&#34;env-SERVER_SOFTWARE&#34;</span><span class="op" id="7431148">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7431152">&#34;go&#34;</span><span class="op" id="7431156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431162">replay</span>&nbsp;<span class="op" id="7431169">:=</span>&nbsp;<span class="ident" id="7431172"><a href="/gostd/net/http/cgi/host_test.go.html#7418670">runCgiTest</a></span><span class="op" id="7431182">(</span><span class="ident" id="7431183"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430320">t</a></span><span class="op" id="7431184">,</span>&nbsp;<span class="ident" id="7431186"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430399">h</a></span><span class="op" id="7431187">,</span>&nbsp;<span class="string" id="7431189">&#34;GET&nbsp;/test.go?foo=bar&amp;a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7431247">,</span>&nbsp;<span class="ident" id="7431249"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430511">expectedMap</a></span><span class="op" id="7431260">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431264">if</span>&nbsp;<span class="ident" id="7431267">expected</span><span class="op" id="7431275">,</span>&nbsp;<span class="ident" id="7431277">got</span>&nbsp;<span class="op" id="7431281">:=</span>&nbsp;<span class="string" id="7431284">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="7431310">,</span>&nbsp;<span class="ident" id="7431312"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431162">replay</a></span><span class="op" id="7431318">.</span><span class="ident" id="7431319"><a href="/gostd/net/http/httptest/recorder.go.html#6132945">Header</a></span><span class="op" id="7431325">(</span><span class="op" id="7431326">)</span><span class="op" id="7431327">.</span><span class="ident" id="7431328"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="7431331">(</span><span class="string" id="7431332">&#34;Content-Type&#34;</span><span class="op" id="7431346">)</span><span class="op" id="7431347">;</span>&nbsp;<span class="ident" id="7431349"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431277">got</a></span>&nbsp;<span class="op" id="7431353">!=</span>&nbsp;<span class="ident" id="7431356"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431267">expected</a></span>&nbsp;<span class="op" id="7431365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431369"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430320">t</a></span><span class="op" id="7431370">.</span><span class="ident" id="7431371"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7431377">(</span><span class="string" id="7431378">&#34;got&nbsp;a&nbsp;Content-Type&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7431417">,</span>&nbsp;<span class="ident" id="7431419"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431277">got</a></span><span class="op" id="7431422">,</span>&nbsp;<span class="ident" id="7431424"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431267">expected</a></span><span class="op" id="7431432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431438">if</span>&nbsp;<span class="ident" id="7431441">expected</span><span class="op" id="7431449">,</span>&nbsp;<span class="ident" id="7431451">got</span>&nbsp;<span class="op" id="7431455">:=</span>&nbsp;<span class="string" id="7431458">&#34;X-Test-Value&#34;</span><span class="op" id="7431472">,</span>&nbsp;<span class="ident" id="7431474"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431162">replay</a></span><span class="op" id="7431480">.</span><span class="ident" id="7431481"><a href="/gostd/net/http/httptest/recorder.go.html#6132945">Header</a></span><span class="op" id="7431487">(</span><span class="op" id="7431488">)</span><span class="op" id="7431489">.</span><span class="ident" id="7431490"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="7431493">(</span><span class="string" id="7431494">&#34;X-Test-Header&#34;</span><span class="op" id="7431509">)</span><span class="op" id="7431510">;</span>&nbsp;<span class="ident" id="7431512"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431451">got</a></span>&nbsp;<span class="op" id="7431516">!=</span>&nbsp;<span class="ident" id="7431519"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431441">expected</a></span>&nbsp;<span class="op" id="7431528">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431532"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430320">t</a></span><span class="op" id="7431533">.</span><span class="ident" id="7431534"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7431540">(</span><span class="string" id="7431541">&#34;got&nbsp;a&nbsp;X-Test-Header&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7431581">,</span>&nbsp;<span class="ident" id="7431583"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431451">got</a></span><span class="op" id="7431586">,</span>&nbsp;<span class="ident" id="7431588"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431441">expected</a></span><span class="op" id="7431596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431599">}</span><br>
<span class="lineno"></span><span class="op" id="7431601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431604">type</span>&nbsp;<span class="ident" id="7431609">customWriterRecorder</span>&nbsp;<span class="keyword" id="7431630">struct</span>&nbsp;<span class="op" id="7431637">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431640">w</span>&nbsp;<span class="ident" id="7431642"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430083">io</a></span><span class="op" id="7431644">.</span><span class="ident" id="7431645"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431653">*</span><span class="ident" id="7431654"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430101">httptest</a></span><span class="op" id="7431662">.</span><span class="ident" id="7431663"><a href="/gostd/net/http/httptest/recorder.go.html#6132219">ResponseRecorder</a></span><br>
<span class="lineno"></span><span class="op" id="7431680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431683">func</span>&nbsp;<span class="op" id="7431688">(</span><span class="ident" id="7431689">r</span>&nbsp;<span class="op" id="7431691">*</span><span class="ident" id="7431692"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431609">customWriterRecorder</a></span><span class="op" id="7431712">)</span>&nbsp;<span class="ident" id="7431714">Write</span><span class="op" id="7431719">(</span><span class="ident" id="7431720">p</span>&nbsp;<span class="op" id="7431722">[</span><span class="op" id="7431723">]</span><span class="builtintype" id="7431724">byte</span><span class="op" id="7431728">)</span>&nbsp;<span class="op" id="7431730">(</span><span class="ident" id="7431731">n</span>&nbsp;<span class="builtintype" id="7431733">int</span><span class="op" id="7431736">,</span>&nbsp;<span class="ident" id="7431738">err</span>&nbsp;<span class="builtintype" id="7431742">error</span><span class="op" id="7431747">)</span>&nbsp;<span class="op" id="7431749">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431752">return</span>&nbsp;<span class="ident" id="7431759"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431689">r</a></span><span class="op" id="7431760">.</span><span class="ident" id="7431761"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431640">w</a></span><span class="op" id="7431762">.</span><span class="ident" id="7431763"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="7431768">(</span><span class="ident" id="7431769"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431720">p</a></span><span class="op" id="7431770">)</span><br>
<span class="lineno"></span><span class="op" id="7431772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431775">type</span>&nbsp;<span class="ident" id="7431780">limitWriter</span>&nbsp;<span class="keyword" id="7431792">struct</span>&nbsp;<span class="op" id="7431799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431802">w</span>&nbsp;<span class="ident" id="7431804"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430083">io</a></span><span class="op" id="7431806">.</span><span class="ident" id="7431807"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431815">n</span>&nbsp;<span class="builtintype" id="7431817">int</span><br>
<span class="lineno"></span><span class="op" id="7431821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431824">func</span>&nbsp;<span class="op" id="7431829">(</span><span class="ident" id="7431830">w</span>&nbsp;<span class="op" id="7431832">*</span><span class="ident" id="7431833"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431780">limitWriter</a></span><span class="op" id="7431844">)</span>&nbsp;<span class="ident" id="7431846">Write</span><span class="op" id="7431851">(</span><span class="ident" id="7431852">p</span>&nbsp;<span class="op" id="7431854">[</span><span class="op" id="7431855">]</span><span class="builtintype" id="7431856">byte</span><span class="op" id="7431860">)</span>&nbsp;<span class="op" id="7431862">(</span><span class="ident" id="7431863">n</span>&nbsp;<span class="builtintype" id="7431865">int</span><span class="op" id="7431868">,</span>&nbsp;<span class="ident" id="7431870">err</span>&nbsp;<span class="builtintype" id="7431874">error</span><span class="op" id="7431879">)</span>&nbsp;<span class="op" id="7431881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431884">if</span>&nbsp;<span class="builtinfunc" id="7431887">len</span><span class="op" id="7431890">(</span><span class="ident" id="7431891"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431852">p</a></span><span class="op" id="7431892">)</span>&nbsp;<span class="op" id="7431894">&gt;</span>&nbsp;<span class="ident" id="7431896"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431830">w</a></span><span class="op" id="7431897">.</span><span class="ident" id="7431898"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431815">n</a></span>&nbsp;<span class="op" id="7431900">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431904"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431852">p</a></span>&nbsp;<span class="op" id="7431906">=</span>&nbsp;<span class="ident" id="7431908"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431852">p</a></span><span class="op" id="7431909">[</span><span class="op" id="7431910">:</span><span class="ident" id="7431911"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431830">w</a></span><span class="op" id="7431912">.</span><span class="ident" id="7431913"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431815">n</a></span><span class="op" id="7431914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431920">if</span>&nbsp;<span class="builtinfunc" id="7431923">len</span><span class="op" id="7431926">(</span><span class="ident" id="7431927"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431852">p</a></span><span class="op" id="7431928">)</span>&nbsp;<span class="op" id="7431930">&gt;</span>&nbsp;<span class="num" id="7431932">0</span>&nbsp;<span class="op" id="7431934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431938"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431863">n</a></span><span class="op" id="7431939">,</span>&nbsp;<span class="ident" id="7431941"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431870">err</a></span>&nbsp;<span class="op" id="7431945">=</span>&nbsp;<span class="ident" id="7431947"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431830">w</a></span><span class="op" id="7431948">.</span><span class="ident" id="7431949"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431802">w</a></span><span class="op" id="7431950">.</span><span class="ident" id="7431951"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="7431956">(</span><span class="ident" id="7431957"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431852">p</a></span><span class="op" id="7431958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431962"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431830">w</a></span><span class="op" id="7431963">.</span><span class="ident" id="7431964"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431815">n</a></span>&nbsp;<span class="op" id="7431966">-=</span>&nbsp;<span class="ident" id="7431969"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431863">n</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431975">if</span>&nbsp;<span class="ident" id="7431978"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431830">w</a></span><span class="op" id="7431979">.</span><span class="ident" id="7431980"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431815">n</a></span>&nbsp;<span class="op" id="7431982">==</span>&nbsp;<span class="num" id="7431985">0</span>&nbsp;<span class="op" id="7431987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431991"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431870">err</a></span>&nbsp;<span class="op" id="7431995">=</span>&nbsp;<span class="ident" id="7431997"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430066">errors</a></span><span class="op" id="7432003">.</span><span class="ident" id="7432004"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7432007">(</span><span class="string" id="7432008">&#34;past&nbsp;write&nbsp;limit&#34;</span><span class="op" id="7432026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432032">return</span><br>
<span class="lineno">90</span><span class="op" id="7432039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7432042">//&nbsp;If&nbsp;there&#39;s&nbsp;an&nbsp;error&nbsp;copying&nbsp;the&nbsp;child&#39;s&nbsp;output&nbsp;to&nbsp;the&nbsp;parent,&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7432112">//&nbsp;that&nbsp;we&nbsp;kill&nbsp;the&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7432139">func</span>&nbsp;<span class="ident" id="7432144">TestKillChildAfterCopyError</span><span class="op" id="7432171">(</span><span class="ident" id="7432172">t</span>&nbsp;<span class="op" id="7432174">*</span><span class="ident" id="7432175"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7432182">.</span><span class="ident" id="7432183"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7432184">)</span>&nbsp;<span class="op" id="7432186">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432189">if</span>&nbsp;<span class="ident" id="7432192"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430128">runtime</a></span><span class="op" id="7432199">.</span><span class="ident" id="7432200"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="7432205">==</span>&nbsp;<span class="string" id="7432208">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7432215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432219"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432172">t</a></span><span class="op" id="7432220">.</span><span class="ident" id="7432221"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="7432225">(</span><span class="string" id="7432226">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="7432244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432251">defer</span>&nbsp;<span class="keyword" id="7432257">func</span><span class="op" id="7432261">(</span><span class="op" id="7432262">)</span>&nbsp;<span class="op" id="7432264">{</span>&nbsp;<span class="ident" id="7432266"><a href="/gostd/net/http/cgi/host.go.html#5704320">testHookStartProcess</a></span>&nbsp;<span class="op" id="7432287">=</span>&nbsp;<span class="builtintype" id="7432289">nil</span>&nbsp;<span class="op" id="7432293">}</span><span class="op" id="7432294">(</span><span class="op" id="7432295">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432298">proc</span>&nbsp;<span class="op" id="7432303">:=</span>&nbsp;<span class="builtinfunc" id="7432306">make</span><span class="op" id="7432310">(</span><span class="keyword" id="7432311">chan</span>&nbsp;<span class="op" id="7432316">*</span><span class="ident" id="7432317"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7432319">.</span><span class="ident" id="7432320"><a href="/gostd/os/exec.go.html#2433546">Process</a></span><span class="op" id="7432327">,</span>&nbsp;<span class="num" id="7432329">1</span><span class="op" id="7432330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432333"><a href="/gostd/net/http/cgi/host.go.html#5704320">testHookStartProcess</a></span>&nbsp;<span class="op" id="7432354">=</span>&nbsp;<span class="keyword" id="7432356">func</span><span class="op" id="7432360">(</span><span class="ident" id="7432361">p</span>&nbsp;<span class="op" id="7432363">*</span><span class="ident" id="7432364"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7432366">.</span><span class="ident" id="7432367"><a href="/gostd/os/exec.go.html#2433546">Process</a></span><span class="op" id="7432374">)</span>&nbsp;<span class="op" id="7432376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432380"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432298">proc</a></span>&nbsp;<span class="op" id="7432385">&lt;-</span>&nbsp;<span class="ident" id="7432388"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432361">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432395">h</span>&nbsp;<span class="op" id="7432397">:=</span>&nbsp;<span class="op" id="7432400">&amp;</span><span class="ident" id="7432401"><a href="/gostd/net/http/cgi/host.go.html#5695901">Handler</a></span><span class="op" id="7432408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432412"><a href="/gostd/net/http/cgi/host.go.html#5695919">Path</a></span><span class="op" id="7432416">:</span>&nbsp;<span class="ident" id="7432418"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7432420">.</span><span class="ident" id="7432421"><a href="/gostd/os/proc.go.html#2468733">Args</a></span><span class="op" id="7432425">[</span><span class="num" id="7432426">0</span><span class="op" id="7432427">]</span><span class="op" id="7432428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432432"><a href="/gostd/net/http/cgi/host.go.html#5695962">Root</a></span><span class="op" id="7432436">:</span>&nbsp;<span class="string" id="7432438">&#34;/test.go&#34;</span><span class="op" id="7432448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432452"><a href="/gostd/net/http/cgi/host.go.html#5696470">Args</a></span><span class="op" id="7432456">:</span>&nbsp;<span class="op" id="7432458">[</span><span class="op" id="7432459">]</span><span class="builtintype" id="7432460">string</span><span class="op" id="7432466">{</span><span class="string" id="7432467">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7432500">}</span><span class="op" id="7432501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432504">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432507">req</span><span class="op" id="7432510">,</span>&nbsp;<span class="ident" id="7432512">_</span>&nbsp;<span class="op" id="7432514">:=</span>&nbsp;<span class="ident" id="7432517"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430089">http</a></span><span class="op" id="7432521">.</span><span class="ident" id="7432522"><a href="/gostd/net/http/request.go.html#4149529">NewRequest</a></span><span class="op" id="7432532">(</span><span class="string" id="7432533">&#34;GET&#34;</span><span class="op" id="7432538">,</span>&nbsp;<span class="string" id="7432540">&#34;http://example.com/test.cgi?write-forever=1&#34;</span><span class="op" id="7432585">,</span>&nbsp;<span class="builtintype" id="7432587">nil</span><span class="op" id="7432590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432593">rec</span>&nbsp;<span class="op" id="7432597">:=</span>&nbsp;<span class="ident" id="7432600"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430101">httptest</a></span><span class="op" id="7432608">.</span><span class="ident" id="7432609"><a href="/gostd/net/http/httptest/recorder.go.html#6132549">NewRecorder</a></span><span class="op" id="7432620">(</span><span class="op" id="7432621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432624">var</span>&nbsp;<span class="ident" id="7432628">out</span>&nbsp;<span class="ident" id="7432632"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430057">bytes</a></span><span class="op" id="7432637">.</span><span class="ident" id="7432638"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432646">const</span>&nbsp;<span class="ident" id="7432652">writeLen</span>&nbsp;<span class="op" id="7432661">=</span>&nbsp;<span class="num" id="7432663">50</span>&nbsp;<span class="op" id="7432666">&lt;&lt;</span>&nbsp;<span class="num" id="7432669">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432673">rw</span>&nbsp;<span class="op" id="7432676">:=</span>&nbsp;<span class="op" id="7432679">&amp;</span><span class="ident" id="7432680"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431609">customWriterRecorder</a></span><span class="op" id="7432700">{</span><span class="op" id="7432701">&amp;</span><span class="ident" id="7432702"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7431780">limitWriter</a></span><span class="op" id="7432713">{</span><span class="op" id="7432714">&amp;</span><span class="ident" id="7432715"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432628">out</a></span><span class="op" id="7432718">,</span>&nbsp;<span class="ident" id="7432720"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432652">writeLen</a></span><span class="op" id="7432728">}</span><span class="op" id="7432729">,</span>&nbsp;<span class="ident" id="7432731"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432593">rec</a></span><span class="op" id="7432734">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432738">donec</span>&nbsp;<span class="op" id="7432744">:=</span>&nbsp;<span class="builtinfunc" id="7432747">make</span><span class="op" id="7432751">(</span><span class="keyword" id="7432752">chan</span>&nbsp;<span class="builtintype" id="7432757">bool</span><span class="op" id="7432761">,</span>&nbsp;<span class="num" id="7432763">1</span><span class="op" id="7432764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432767">go</span>&nbsp;<span class="keyword" id="7432770">func</span><span class="op" id="7432774">(</span><span class="op" id="7432775">)</span>&nbsp;<span class="op" id="7432777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432781"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432395">h</a></span><span class="op" id="7432782">.</span><span class="ident" id="7432783"><a href="/gostd/net/http/cgi/host.go.html#5697533">ServeHTTP</a></span><span class="op" id="7432792">(</span><span class="ident" id="7432793"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432673">rw</a></span><span class="op" id="7432795">,</span>&nbsp;<span class="ident" id="7432797"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432507">req</a></span><span class="op" id="7432800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432804"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432738">donec</a></span>&nbsp;<span class="op" id="7432810">&lt;-</span>&nbsp;<span class="builtintype" id="7432813">true</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432819">}</span><span class="op" id="7432820">(</span><span class="op" id="7432821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432825">select</span>&nbsp;<span class="op" id="7432832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432835">case</span>&nbsp;<span class="op" id="7432840">&lt;-</span><span class="ident" id="7432842"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432738">donec</a></span><span class="op" id="7432847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432851">if</span>&nbsp;<span class="ident" id="7432854"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432628">out</a></span><span class="op" id="7432857">.</span><span class="ident" id="7432858"><a href="/gostd/bytes/buffer.go.html#1384893">Len</a></span><span class="op" id="7432861">(</span><span class="op" id="7432862">)</span>&nbsp;<span class="op" id="7432864">!=</span>&nbsp;<span class="ident" id="7432867"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432652">writeLen</a></span>&nbsp;<span class="op" id="7432876">||</span>&nbsp;<span class="ident" id="7432879"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432628">out</a></span><span class="op" id="7432882">.</span><span class="ident" id="7432883"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="7432888">(</span><span class="op" id="7432889">)</span><span class="op" id="7432890">[</span><span class="num" id="7432891">0</span><span class="op" id="7432892">]</span>&nbsp;<span class="op" id="7432894">!=</span>&nbsp;<span class="string" id="7432897">&#39;a&#39;</span>&nbsp;<span class="op" id="7432901">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432906"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432172">t</a></span><span class="op" id="7432907">.</span><span class="ident" id="7432908"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7432914">(</span><span class="string" id="7432915">&#34;unexpected&nbsp;output:&nbsp;%q&#34;</span><span class="op" id="7432938">,</span>&nbsp;<span class="ident" id="7432940"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432628">out</a></span><span class="op" id="7432943">.</span><span class="ident" id="7432944"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="7432949">(</span><span class="op" id="7432950">)</span><span class="op" id="7432951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432958">case</span>&nbsp;<span class="op" id="7432963">&lt;-</span><span class="ident" id="7432965"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430150">time</a></span><span class="op" id="7432969">.</span><span class="ident" id="7432970"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="7432975">(</span><span class="num" id="7432976">5</span>&nbsp;<span class="op" id="7432978">*</span>&nbsp;<span class="ident" id="7432980"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430150">time</a></span><span class="op" id="7432984">.</span><span class="ident" id="7432985"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7432991">)</span><span class="op" id="7432992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432996"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432172">t</a></span><span class="op" id="7432997">.</span><span class="ident" id="7432998"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7433004">(</span><span class="string" id="7433005">&#34;timeout.&nbsp;ServeHTTP&nbsp;hung&nbsp;and&nbsp;didn&#39;t&nbsp;kill&nbsp;the&nbsp;child&nbsp;process?&#34;</span><span class="op" id="7433065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433069">select</span>&nbsp;<span class="op" id="7433076">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433080">case</span>&nbsp;<span class="ident" id="7433085">p</span>&nbsp;<span class="op" id="7433087">:=</span>&nbsp;<span class="op" id="7433090">&lt;-</span><span class="ident" id="7433092"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432298">proc</a></span><span class="op" id="7433096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433101"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433085">p</a></span><span class="op" id="7433102">.</span><span class="ident" id="7433103"><a href="/gostd/os/doc.go.html#2423746">Kill</a></span><span class="op" id="7433107">(</span><span class="op" id="7433108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433113"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432172">t</a></span><span class="op" id="7433114">.</span><span class="ident" id="7433115"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7433119">(</span><span class="string" id="7433120">&#34;killed&nbsp;process&#34;</span><span class="op" id="7433136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433140">default</span><span class="op" id="7433147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433152"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7432172">t</a></span><span class="op" id="7433153">.</span><span class="ident" id="7433154"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="7433158">(</span><span class="string" id="7433159">&#34;didn&#39;t&nbsp;kill&nbsp;process&#34;</span><span class="op" id="7433180">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433187">}</span><br>
<span class="lineno"></span><span class="op" id="7433189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7433192">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;child&nbsp;handler&nbsp;writing&nbsp;only&nbsp;headers&nbsp;works.</span><br>
<span class="lineno">140</span><span class="comment" id="7433249">//&nbsp;golang.org/issue/7196</span><br>
<span class="lineno"></span><span class="keyword" id="7433274">func</span>&nbsp;<span class="ident" id="7433279">TestChildOnlyHeaders</span><span class="op" id="7433299">(</span><span class="ident" id="7433300">t</span>&nbsp;<span class="op" id="7433302">*</span><span class="ident" id="7433303"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7433310">.</span><span class="ident" id="7433311"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7433312">)</span>&nbsp;<span class="op" id="7433314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433317">if</span>&nbsp;<span class="ident" id="7433320"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430128">runtime</a></span><span class="op" id="7433327">.</span><span class="ident" id="7433328"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="7433333">==</span>&nbsp;<span class="string" id="7433336">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7433343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433347"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433300">t</a></span><span class="op" id="7433348">.</span><span class="ident" id="7433349"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="7433353">(</span><span class="string" id="7433354">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="7433372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433375">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433379">h</span>&nbsp;<span class="op" id="7433381">:=</span>&nbsp;<span class="op" id="7433384">&amp;</span><span class="ident" id="7433385"><a href="/gostd/net/http/cgi/host.go.html#5695901">Handler</a></span><span class="op" id="7433392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433396"><a href="/gostd/net/http/cgi/host.go.html#5695919">Path</a></span><span class="op" id="7433400">:</span>&nbsp;<span class="ident" id="7433402"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7433404">.</span><span class="ident" id="7433405"><a href="/gostd/os/proc.go.html#2468733">Args</a></span><span class="op" id="7433409">[</span><span class="num" id="7433410">0</span><span class="op" id="7433411">]</span><span class="op" id="7433412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433416"><a href="/gostd/net/http/cgi/host.go.html#5695962">Root</a></span><span class="op" id="7433420">:</span>&nbsp;<span class="string" id="7433422">&#34;/test.go&#34;</span><span class="op" id="7433432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433436"><a href="/gostd/net/http/cgi/host.go.html#5696470">Args</a></span><span class="op" id="7433440">:</span>&nbsp;<span class="op" id="7433442">[</span><span class="op" id="7433443">]</span><span class="builtintype" id="7433444">string</span><span class="op" id="7433450">{</span><span class="string" id="7433451">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7433484">}</span><span class="op" id="7433485">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433491">expectedMap</span>&nbsp;<span class="op" id="7433503">:=</span>&nbsp;<span class="keyword" id="7433506">map</span><span class="op" id="7433509">[</span><span class="builtintype" id="7433510">string</span><span class="op" id="7433516">]</span><span class="builtintype" id="7433517">string</span><span class="op" id="7433523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7433527">&#34;_body&#34;</span><span class="op" id="7433534">:</span>&nbsp;<span class="string" id="7433536">&#34;&#34;</span><span class="op" id="7433538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433544">replay</span>&nbsp;<span class="op" id="7433551">:=</span>&nbsp;<span class="ident" id="7433554"><a href="/gostd/net/http/cgi/host_test.go.html#7418670">runCgiTest</a></span><span class="op" id="7433564">(</span><span class="ident" id="7433565"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433300">t</a></span><span class="op" id="7433566">,</span>&nbsp;<span class="ident" id="7433568"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433379">h</a></span><span class="op" id="7433569">,</span>&nbsp;<span class="string" id="7433571">&#34;GET&nbsp;/test.go?no-body=1&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7433627">,</span>&nbsp;<span class="ident" id="7433629"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433491">expectedMap</a></span><span class="op" id="7433640">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433643">if</span>&nbsp;<span class="ident" id="7433646">expected</span><span class="op" id="7433654">,</span>&nbsp;<span class="ident" id="7433656">got</span>&nbsp;<span class="op" id="7433660">:=</span>&nbsp;<span class="string" id="7433663">&#34;X-Test-Value&#34;</span><span class="op" id="7433677">,</span>&nbsp;<span class="ident" id="7433679"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433544">replay</a></span><span class="op" id="7433685">.</span><span class="ident" id="7433686"><a href="/gostd/net/http/httptest/recorder.go.html#6132945">Header</a></span><span class="op" id="7433692">(</span><span class="op" id="7433693">)</span><span class="op" id="7433694">.</span><span class="ident" id="7433695"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="7433698">(</span><span class="string" id="7433699">&#34;X-Test-Header&#34;</span><span class="op" id="7433714">)</span><span class="op" id="7433715">;</span>&nbsp;<span class="ident" id="7433717"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433656">got</a></span>&nbsp;<span class="op" id="7433721">!=</span>&nbsp;<span class="ident" id="7433724"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433646">expected</a></span>&nbsp;<span class="op" id="7433733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433737"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433300">t</a></span><span class="op" id="7433738">.</span><span class="ident" id="7433739"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7433745">(</span><span class="string" id="7433746">&#34;got&nbsp;a&nbsp;X-Test-Header&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7433786">,</span>&nbsp;<span class="ident" id="7433788"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433656">got</a></span><span class="op" id="7433791">,</span>&nbsp;<span class="ident" id="7433793"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433646">expected</a></span><span class="op" id="7433801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433804">}</span><br>
<span class="lineno"></span><span class="op" id="7433806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="7433809">//&nbsp;golang.org/issue/7198</span><br>
<span class="lineno"></span><span class="keyword" id="7433834">func</span>&nbsp;<span class="ident" id="7433839">Test500WithNoHeaders</span><span class="op" id="7433859">(</span><span class="ident" id="7433860">t</span>&nbsp;<span class="op" id="7433862">*</span><span class="ident" id="7433863"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7433870">.</span><span class="ident" id="7433871"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7433872">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433878">{</span>&nbsp;<span class="ident" id="7433880"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434092">want500Test</a></span><span class="op" id="7433891">(</span><span class="ident" id="7433892"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433860">t</a></span><span class="op" id="7433893">,</span>&nbsp;<span class="string" id="7433895">&#34;/immediate-disconnect&#34;</span><span class="op" id="7433918">)</span>&nbsp;<span class="op" id="7433920">}</span><br>
<span class="lineno"></span><span class="keyword" id="7433922">func</span>&nbsp;<span class="ident" id="7433927">Test500WithNoContentType</span><span class="op" id="7433951">(</span><span class="ident" id="7433952">t</span>&nbsp;<span class="op" id="7433954">*</span><span class="ident" id="7433955"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7433962">.</span><span class="ident" id="7433963"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7433964">)</span>&nbsp;<span class="op" id="7433966">{</span>&nbsp;<span class="ident" id="7433968"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434092">want500Test</a></span><span class="op" id="7433979">(</span><span class="ident" id="7433980"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7433952">t</a></span><span class="op" id="7433981">,</span>&nbsp;<span class="string" id="7433983">&#34;/no-content-type&#34;</span><span class="op" id="7434001">)</span>&nbsp;<span class="op" id="7434003">}</span><br>
<span class="lineno"></span><span class="keyword" id="7434005">func</span>&nbsp;<span class="ident" id="7434010">Test500WithEmptyHeaders</span><span class="op" id="7434033">(</span><span class="ident" id="7434034">t</span>&nbsp;<span class="op" id="7434036">*</span><span class="ident" id="7434037"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7434044">.</span><span class="ident" id="7434045"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7434046">)</span>&nbsp;&nbsp;<span class="op" id="7434049">{</span>&nbsp;<span class="ident" id="7434051"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434092">want500Test</a></span><span class="op" id="7434062">(</span><span class="ident" id="7434063"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434034">t</a></span><span class="op" id="7434064">,</span>&nbsp;<span class="string" id="7434066">&#34;/empty-headers&#34;</span><span class="op" id="7434082">)</span>&nbsp;<span class="op" id="7434084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7434087">func</span>&nbsp;<span class="ident" id="7434092">want500Test</span><span class="op" id="7434103">(</span><span class="ident" id="7434104">t</span>&nbsp;<span class="op" id="7434106">*</span><span class="ident" id="7434107"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7434114">.</span><span class="ident" id="7434115"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7434116">,</span>&nbsp;<span class="ident" id="7434118">path</span>&nbsp;<span class="builtintype" id="7434123">string</span><span class="op" id="7434129">)</span>&nbsp;<span class="op" id="7434131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434134">h</span>&nbsp;<span class="op" id="7434136">:=</span>&nbsp;<span class="op" id="7434139">&amp;</span><span class="ident" id="7434140"><a href="/gostd/net/http/cgi/host.go.html#5695901">Handler</a></span><span class="op" id="7434147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434151"><a href="/gostd/net/http/cgi/host.go.html#5695919">Path</a></span><span class="op" id="7434155">:</span>&nbsp;<span class="ident" id="7434157"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7434159">.</span><span class="ident" id="7434160"><a href="/gostd/os/proc.go.html#2468733">Args</a></span><span class="op" id="7434164">[</span><span class="num" id="7434165">0</span><span class="op" id="7434166">]</span><span class="op" id="7434167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434171"><a href="/gostd/net/http/cgi/host.go.html#5695962">Root</a></span><span class="op" id="7434175">:</span>&nbsp;<span class="string" id="7434177">&#34;/test.go&#34;</span><span class="op" id="7434187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434191"><a href="/gostd/net/http/cgi/host.go.html#5696470">Args</a></span><span class="op" id="7434195">:</span>&nbsp;<span class="op" id="7434197">[</span><span class="op" id="7434198">]</span><span class="builtintype" id="7434199">string</span><span class="op" id="7434205">{</span><span class="string" id="7434206">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7434239">}</span><span class="op" id="7434240">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434246">expectedMap</span>&nbsp;<span class="op" id="7434258">:=</span>&nbsp;<span class="keyword" id="7434261">map</span><span class="op" id="7434264">[</span><span class="builtintype" id="7434265">string</span><span class="op" id="7434271">]</span><span class="builtintype" id="7434272">string</span><span class="op" id="7434278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7434282">&#34;_body&#34;</span><span class="op" id="7434289">:</span>&nbsp;<span class="string" id="7434291">&#34;&#34;</span><span class="op" id="7434293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434299">replay</span>&nbsp;<span class="op" id="7434306">:=</span>&nbsp;<span class="ident" id="7434309"><a href="/gostd/net/http/cgi/host_test.go.html#7418670">runCgiTest</a></span><span class="op" id="7434319">(</span><span class="ident" id="7434320"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434104">t</a></span><span class="op" id="7434321">,</span>&nbsp;<span class="ident" id="7434323"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434134">h</a></span><span class="op" id="7434324">,</span>&nbsp;<span class="string" id="7434326">&#34;GET&nbsp;&#34;</span><span class="op" id="7434332">+</span><span class="ident" id="7434333"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434118">path</a></span><span class="op" id="7434337">+</span><span class="string" id="7434338">&#34;&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7434372">,</span>&nbsp;<span class="ident" id="7434374"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434246">expectedMap</a></span><span class="op" id="7434385">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434388">if</span>&nbsp;<span class="ident" id="7434391"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434299">replay</a></span><span class="op" id="7434397">.</span><span class="ident" id="7434398"><a href="/gostd/net/http/httptest/recorder.go.html#6132246">Code</a></span>&nbsp;<span class="op" id="7434403">!=</span>&nbsp;<span class="num" id="7434406">500</span>&nbsp;<span class="op" id="7434410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434414"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434104">t</a></span><span class="op" id="7434415">.</span><span class="ident" id="7434416"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7434422">(</span><span class="string" id="7434423">&#34;Got&nbsp;code&nbsp;%d;&nbsp;want&nbsp;500&#34;</span><span class="op" id="7434446">,</span>&nbsp;<span class="ident" id="7434448"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434299">replay</a></span><span class="op" id="7434454">.</span><span class="ident" id="7434455"><a href="/gostd/net/http/httptest/recorder.go.html#6132246">Code</a></span><span class="op" id="7434459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434462">}</span><br>
<span class="lineno"></span><span class="op" id="7434464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="7434467">type</span>&nbsp;<span class="ident" id="7434472">neverEnding</span>&nbsp;<span class="builtintype" id="7434484">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7434490">func</span>&nbsp;<span class="op" id="7434495">(</span><span class="ident" id="7434496">b</span>&nbsp;<span class="ident" id="7434498"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434472">neverEnding</a></span><span class="op" id="7434509">)</span>&nbsp;<span class="ident" id="7434511">Read</span><span class="op" id="7434515">(</span><span class="ident" id="7434516">p</span>&nbsp;<span class="op" id="7434518">[</span><span class="op" id="7434519">]</span><span class="builtintype" id="7434520">byte</span><span class="op" id="7434524">)</span>&nbsp;<span class="op" id="7434526">(</span><span class="ident" id="7434527">n</span>&nbsp;<span class="builtintype" id="7434529">int</span><span class="op" id="7434532">,</span>&nbsp;<span class="ident" id="7434534">err</span>&nbsp;<span class="builtintype" id="7434538">error</span><span class="op" id="7434543">)</span>&nbsp;<span class="op" id="7434545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434548">for</span>&nbsp;<span class="ident" id="7434552">i</span>&nbsp;<span class="op" id="7434554">:=</span>&nbsp;<span class="keyword" id="7434557">range</span>&nbsp;<span class="ident" id="7434563"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434516">p</a></span>&nbsp;<span class="op" id="7434565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434569"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434516">p</a></span><span class="op" id="7434570">[</span><span class="ident" id="7434571"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434552">i</a></span><span class="op" id="7434572">]</span>&nbsp;<span class="op" id="7434574">=</span>&nbsp;<span class="builtintype" id="7434576">byte</span><span class="op" id="7434580">(</span><span class="ident" id="7434581"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434496">b</a></span><span class="op" id="7434582">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434588">return</span>&nbsp;<span class="builtinfunc" id="7434595">len</span><span class="op" id="7434598">(</span><span class="ident" id="7434599"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434516">p</a></span><span class="op" id="7434600">)</span><span class="op" id="7434601">,</span>&nbsp;<span class="builtintype" id="7434603">nil</span><br>
<span class="lineno"></span><span class="op" id="7434607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7434610">//&nbsp;Note:&nbsp;not&nbsp;actually&nbsp;a&nbsp;test.</span><br>
<span class="lineno">190</span><span class="keyword" id="7434640">func</span>&nbsp;<span class="ident" id="7434645">TestBeChildCGIProcess</span><span class="op" id="7434666">(</span><span class="ident" id="7434667">t</span>&nbsp;<span class="op" id="7434669">*</span><span class="ident" id="7434670"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430139">testing</a></span><span class="op" id="7434677">.</span><span class="ident" id="7434678"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7434679">)</span>&nbsp;<span class="op" id="7434681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434684">if</span>&nbsp;<span class="ident" id="7434687"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7434689">.</span><span class="ident" id="7434690"><a href="/gostd/os/env.go.html#2429715">Getenv</a></span><span class="op" id="7434696">(</span><span class="string" id="7434697">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7434713">)</span>&nbsp;<span class="op" id="7434715">==</span>&nbsp;<span class="string" id="7434718">&#34;&#34;</span>&nbsp;<span class="op" id="7434721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7434725">//&nbsp;Not&nbsp;in&nbsp;a&nbsp;CGI&nbsp;environment;&nbsp;skipping&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434771">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434779">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434782">switch</span>&nbsp;<span class="ident" id="7434789"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7434791">.</span><span class="ident" id="7434792"><a href="/gostd/os/env.go.html#2429715">Getenv</a></span><span class="op" id="7434798">(</span><span class="string" id="7434799">&#34;REQUEST_URI&#34;</span><span class="op" id="7434812">)</span>&nbsp;<span class="op" id="7434814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434817">case</span>&nbsp;<span class="string" id="7434822">&#34;/immediate-disconnect&#34;</span><span class="op" id="7434845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434849"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7434851">.</span><span class="ident" id="7434852"><a href="/gostd/os/proc.go.html#2469766">Exit</a></span><span class="op" id="7434856">(</span><span class="num" id="7434857">0</span><span class="op" id="7434858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434861">case</span>&nbsp;<span class="string" id="7434866">&#34;/no-content-type&#34;</span><span class="op" id="7434884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434888"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430076">fmt</a></span><span class="op" id="7434891">.</span><span class="ident" id="7434892"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="7434898">(</span><span class="string" id="7434899">&#34;Content-Length:&nbsp;6\n\nHello\n&#34;</span><span class="op" id="7434929">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434933"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7434935">.</span><span class="ident" id="7434936"><a href="/gostd/os/proc.go.html#2469766">Exit</a></span><span class="op" id="7434940">(</span><span class="num" id="7434941">0</span><span class="op" id="7434942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434945">case</span>&nbsp;<span class="string" id="7434950">&#34;/empty-headers&#34;</span><span class="op" id="7434966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434970"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430076">fmt</a></span><span class="op" id="7434973">.</span><span class="ident" id="7434974"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="7434980">(</span><span class="string" id="7434981">&#34;\nHello&#34;</span><span class="op" id="7434990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434994"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7434996">.</span><span class="ident" id="7434997"><a href="/gostd/os/proc.go.html#2469766">Exit</a></span><span class="op" id="7435001">(</span><span class="num" id="7435002">0</span><span class="op" id="7435003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435006">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435009"><a href="/gostd/net/http/cgi/child.go.html#5693310">Serve</a></span><span class="op" id="7435014">(</span><span class="ident" id="7435015"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430089">http</a></span><span class="op" id="7435019">.</span><span class="ident" id="7435020"><a href="/gostd/net/http/server.go.html#4205623">HandlerFunc</a></span><span class="op" id="7435031">(</span><span class="keyword" id="7435032">func</span><span class="op" id="7435036">(</span><span class="ident" id="7435037">rw</span>&nbsp;<span class="ident" id="7435040"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430089">http</a></span><span class="op" id="7435044">.</span><span class="ident" id="7435045"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="7435059">,</span>&nbsp;<span class="ident" id="7435061">req</span>&nbsp;<span class="op" id="7435065">*</span><span class="ident" id="7435066"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430089">http</a></span><span class="op" id="7435070">.</span><span class="ident" id="7435071"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="7435078">)</span>&nbsp;<span class="op" id="7435080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435084"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435037">rw</a></span><span class="op" id="7435086">.</span><span class="ident" id="7435087"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="7435093">(</span><span class="op" id="7435094">)</span><span class="op" id="7435095">.</span><span class="ident" id="7435096"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="7435099">(</span><span class="string" id="7435100">&#34;X-Test-Header&#34;</span><span class="op" id="7435115">,</span>&nbsp;<span class="string" id="7435117">&#34;X-Test-Value&#34;</span><span class="op" id="7435131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435135"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435061">req</a></span><span class="op" id="7435138">.</span><span class="ident" id="7435139"><a href="/gostd/net/http/request.go.html#4157283">ParseForm</a></span><span class="op" id="7435148">(</span><span class="op" id="7435149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435153">if</span>&nbsp;<span class="ident" id="7435156"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435061">req</a></span><span class="op" id="7435159">.</span><span class="ident" id="7435160"><a href="/gostd/net/http/request.go.html#4159257">FormValue</a></span><span class="op" id="7435169">(</span><span class="string" id="7435170">&#34;no-body&#34;</span><span class="op" id="7435179">)</span>&nbsp;<span class="op" id="7435181">==</span>&nbsp;<span class="string" id="7435184">&#34;1&#34;</span>&nbsp;<span class="op" id="7435188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435193">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435206">if</span>&nbsp;<span class="ident" id="7435209"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435061">req</a></span><span class="op" id="7435212">.</span><span class="ident" id="7435213"><a href="/gostd/net/http/request.go.html#4159257">FormValue</a></span><span class="op" id="7435222">(</span><span class="string" id="7435223">&#34;write-forever&#34;</span><span class="op" id="7435238">)</span>&nbsp;<span class="op" id="7435240">==</span>&nbsp;<span class="string" id="7435243">&#34;1&#34;</span>&nbsp;<span class="op" id="7435247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435252"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430083">io</a></span><span class="op" id="7435254">.</span><span class="ident" id="7435255"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="7435259">(</span><span class="ident" id="7435260"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435037">rw</a></span><span class="op" id="7435262">,</span>&nbsp;<span class="ident" id="7435264"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7434472">neverEnding</a></span><span class="op" id="7435275">(</span><span class="string" id="7435276">&#39;a&#39;</span><span class="op" id="7435279">)</span><span class="op" id="7435280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435285">for</span>&nbsp;<span class="op" id="7435289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435295"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430150">time</a></span><span class="op" id="7435299">.</span><span class="ident" id="7435300"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="7435305">(</span><span class="num" id="7435306">5</span>&nbsp;<span class="op" id="7435308">*</span>&nbsp;<span class="ident" id="7435310"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430150">time</a></span><span class="op" id="7435314">.</span><span class="ident" id="7435315"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="7435321">)</span>&nbsp;<span class="comment" id="7435323">//&nbsp;hang&nbsp;forever,&nbsp;until&nbsp;killed</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435364"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430076">fmt</a></span><span class="op" id="7435367">.</span><span class="ident" id="7435368"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="7435375">(</span><span class="ident" id="7435376"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435037">rw</a></span><span class="op" id="7435378">,</span>&nbsp;<span class="string" id="7435380">&#34;test=Hello&nbsp;CGI-in-CGI\n&#34;</span><span class="op" id="7435405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435409">for</span>&nbsp;<span class="ident" id="7435413">k</span><span class="op" id="7435414">,</span>&nbsp;<span class="ident" id="7435416">vv</span>&nbsp;<span class="op" id="7435419">:=</span>&nbsp;<span class="keyword" id="7435422">range</span>&nbsp;<span class="ident" id="7435428"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435061">req</a></span><span class="op" id="7435431">.</span><span class="ident" id="7435432"><a href="/gostd/net/http/request.go.html#4139417">Form</a></span>&nbsp;<span class="op" id="7435437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435442">for</span>&nbsp;<span class="ident" id="7435446">_</span><span class="op" id="7435447">,</span>&nbsp;<span class="ident" id="7435449">v</span>&nbsp;<span class="op" id="7435451">:=</span>&nbsp;<span class="keyword" id="7435454">range</span>&nbsp;<span class="ident" id="7435460"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435416">vv</a></span>&nbsp;<span class="op" id="7435463">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435469"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430076">fmt</a></span><span class="op" id="7435472">.</span><span class="ident" id="7435473"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="7435480">(</span><span class="ident" id="7435481"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435037">rw</a></span><span class="op" id="7435483">,</span>&nbsp;<span class="string" id="7435485">&#34;param-%s=%s\n&#34;</span><span class="op" id="7435500">,</span>&nbsp;<span class="ident" id="7435502"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435413">k</a></span><span class="op" id="7435503">,</span>&nbsp;<span class="ident" id="7435505"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435449">v</a></span><span class="op" id="7435506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435519">for</span>&nbsp;<span class="ident" id="7435523">_</span><span class="op" id="7435524">,</span>&nbsp;<span class="ident" id="7435526">kv</span>&nbsp;<span class="op" id="7435529">:=</span>&nbsp;<span class="keyword" id="7435532">range</span>&nbsp;<span class="ident" id="7435538"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7435540">.</span><span class="ident" id="7435541"><a href="/gostd/os/env.go.html#2430342">Environ</a></span><span class="op" id="7435548">(</span><span class="op" id="7435549">)</span>&nbsp;<span class="op" id="7435551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435556"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430076">fmt</a></span><span class="op" id="7435559">.</span><span class="ident" id="7435560"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="7435567">(</span><span class="ident" id="7435568"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435037">rw</a></span><span class="op" id="7435570">,</span>&nbsp;<span class="string" id="7435572">&#34;env-%s\n&#34;</span><span class="op" id="7435582">,</span>&nbsp;<span class="ident" id="7435584"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7435526">kv</a></span><span class="op" id="7435586">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435593">}</span><span class="op" id="7435594">)</span><span class="op" id="7435595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435598"><a href="/gostd/net/http/cgi/matryoshka_test.go.html#7430122">os</a></span><span class="op" id="7435600">.</span><span class="ident" id="7435601"><a href="/gostd/os/proc.go.html#2469766">Exit</a></span><span class="op" id="7435605">(</span><span class="num" id="7435606">0</span><span class="op" id="7435607">)</span><br>
<span class="lineno"></span><span class="op" id="7435609">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
