<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3288033">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3288088">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3288142">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3288193">package</span>&nbsp;<span class="ident" id="3288201">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3288211">import</span>&nbsp;<span class="op" id="3288218">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3288221">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3288230">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3288237">&#34;html&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3288245">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3288251">&#34;text/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3288268">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3288290">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3288293">//&nbsp;escapeTemplate&nbsp;rewrites&nbsp;the&nbsp;named&nbsp;template,&nbsp;which&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3288354">//&nbsp;associated&nbsp;with&nbsp;t,&nbsp;to&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;output&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="3288425">//&nbsp;templates&nbsp;is&nbsp;properly&nbsp;escaped.&nbsp;&nbsp;If&nbsp;no&nbsp;error&nbsp;is&nbsp;returned,&nbsp;then&nbsp;the&nbsp;named&nbsp;templates&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3288515">//&nbsp;been&nbsp;modified.&nbsp;&nbsp;Otherwise&nbsp;the&nbsp;named&nbsp;templates&nbsp;have&nbsp;been&nbsp;rendered</span><br>
<span class="lineno">20</span><span class="comment" id="3288583">//&nbsp;unusable.</span><br>
<span class="lineno"></span><span class="keyword" id="3288596">func</span>&nbsp;<span class="ident" id="3288601">escapeTemplate</span><span class="op" id="3288615">(</span><span class="ident" id="3288616">tmpl</span>&nbsp;<span class="op" id="3288621">*</span><span class="ident" id="3288622"><a href="/html/template/template.go.html#3330985">Template</a></span><span class="op" id="3288630">,</span>&nbsp;<span class="ident" id="3288632">node</span>&nbsp;<span class="ident" id="3288637"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3288642">.</span><span class="ident" id="3288643">Node</span><span class="op" id="3288647">,</span>&nbsp;<span class="ident" id="3288649">name</span>&nbsp;<span class="builtintype" id="3288654">string</span><span class="op" id="3288660">)</span>&nbsp;<span class="builtintype" id="3288662">error</span>&nbsp;<span class="op" id="3288668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288671">e</span>&nbsp;<span class="op" id="3288673">:=</span>&nbsp;<span class="ident" id="3288676"><a href="/html/template/escape.go.html#3291349">newEscaper</a></span><span class="op" id="3288686">(</span><span class="ident" id="3288687"><a href="/html/template/escape.go.html#3288616">tmpl</a></span><span class="op" id="3288691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288694">c</span><span class="op" id="3288695">,</span>&nbsp;<span class="ident" id="3288697">_</span>&nbsp;<span class="op" id="3288699">:=</span>&nbsp;<span class="ident" id="3288702"><a href="/html/template/escape.go.html#3288671">e</a></span><span class="op" id="3288703">.</span><span class="ident" id="3288704">escapeTree</span><span class="op" id="3288714">(</span><span class="ident" id="3288715"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3288722">{</span><span class="op" id="3288723">}</span><span class="op" id="3288724">,</span>&nbsp;<span class="ident" id="3288726"><a href="/html/template/escape.go.html#3288632">node</a></span><span class="op" id="3288730">,</span>&nbsp;<span class="ident" id="3288732"><a href="/html/template/escape.go.html#3288649">name</a></span><span class="op" id="3288736">,</span>&nbsp;<span class="num" id="3288738">0</span><span class="op" id="3288739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288742">var</span>&nbsp;<span class="ident" id="3288746">err</span>&nbsp;<span class="builtintype" id="3288750">error</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288757">if</span>&nbsp;<span class="ident" id="3288760"><a href="/html/template/escape.go.html#3288694">c</a></span><span class="op" id="3288761">.</span><span class="ident" id="3288762">err</span>&nbsp;<span class="op" id="3288766">!=</span>&nbsp;<span class="ident" id="3288769">nil</span>&nbsp;<span class="op" id="3288773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288777"><a href="/html/template/escape.go.html#3288746">err</a></span><span class="op" id="3288780">,</span>&nbsp;<span class="ident" id="3288782"><a href="/html/template/escape.go.html#3288694">c</a></span><span class="op" id="3288783">.</span><span class="ident" id="3288784">err</span><span class="op" id="3288787">.</span><span class="ident" id="3288788">Name</span>&nbsp;<span class="op" id="3288793">=</span>&nbsp;<span class="ident" id="3288795"><a href="/html/template/escape.go.html#3288694">c</a></span><span class="op" id="3288796">.</span><span class="ident" id="3288797">err</span><span class="op" id="3288800">,</span>&nbsp;<span class="ident" id="3288802"><a href="/html/template/escape.go.html#3288649">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288808">}</span>&nbsp;<span class="keyword" id="3288810">else</span>&nbsp;<span class="keyword" id="3288815">if</span>&nbsp;<span class="ident" id="3288818"><a href="/html/template/escape.go.html#3288694">c</a></span><span class="op" id="3288819">.</span><span class="ident" id="3288820">state</span>&nbsp;<span class="op" id="3288826">!=</span>&nbsp;<span class="ident" id="3288829"><a href="/html/template/context.go.html#3259212">stateText</a></span>&nbsp;<span class="op" id="3288839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288843"><a href="/html/template/escape.go.html#3288746">err</a></span>&nbsp;<span class="op" id="3288847">=</span>&nbsp;<span class="op" id="3288849">&amp;</span><span class="ident" id="3288850"><a href="/html/template/error.go.html#3280695">Error</a></span><span class="op" id="3288855">{</span><span class="ident" id="3288856"><a href="/html/template/error.go.html#3284395">ErrEndContext</a></span><span class="op" id="3288869">,</span>&nbsp;<span class="ident" id="3288871">nil</span><span class="op" id="3288874">,</span>&nbsp;<span class="ident" id="3288876"><a href="/html/template/escape.go.html#3288649">name</a></span><span class="op" id="3288880">,</span>&nbsp;<span class="num" id="3288882">0</span><span class="op" id="3288883">,</span>&nbsp;<span class="ident" id="3288885"><a href="/html/template/escape.go.html#3288230">fmt</a></span><span class="op" id="3288888">.</span><span class="ident" id="3288889">Sprintf</span><span class="op" id="3288896">(</span><span class="string" id="3288897">&#34;ends&nbsp;in&nbsp;a&nbsp;non-text&nbsp;context:&nbsp;%v&#34;</span><span class="op" id="3288929">,</span>&nbsp;<span class="ident" id="3288931"><a href="/html/template/escape.go.html#3288694">c</a></span><span class="op" id="3288932">)</span><span class="op" id="3288933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288936">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288939">if</span>&nbsp;<span class="ident" id="3288942"><a href="/html/template/escape.go.html#3288746">err</a></span>&nbsp;<span class="op" id="3288946">!=</span>&nbsp;<span class="ident" id="3288949">nil</span>&nbsp;<span class="op" id="3288953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288957">//&nbsp;Prevent&nbsp;execution&nbsp;of&nbsp;unsafe&nbsp;templates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289001">if</span>&nbsp;<span class="ident" id="3289004">t</span>&nbsp;<span class="op" id="3289006">:=</span>&nbsp;<span class="ident" id="3289009"><a href="/html/template/escape.go.html#3288616">tmpl</a></span><span class="op" id="3289013">.</span><span class="ident" id="3289014">set</span><span class="op" id="3289017">[</span><span class="ident" id="3289018"><a href="/html/template/escape.go.html#3288649">name</a></span><span class="op" id="3289022">]</span><span class="op" id="3289023">;</span>&nbsp;<span class="ident" id="3289025"><a href="/html/template/escape.go.html#3289004">t</a></span>&nbsp;<span class="op" id="3289027">!=</span>&nbsp;<span class="ident" id="3289030">nil</span>&nbsp;<span class="op" id="3289034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289039"><a href="/html/template/escape.go.html#3289004">t</a></span><span class="op" id="3289040">.</span><span class="ident" id="3289041">escapeErr</span>&nbsp;<span class="op" id="3289051">=</span>&nbsp;<span class="ident" id="3289053"><a href="/html/template/escape.go.html#3288746">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289060"><a href="/html/template/escape.go.html#3289004">t</a></span><span class="op" id="3289061">.</span><span class="ident" id="3289062">text</span><span class="op" id="3289066">.</span><span class="ident" id="3289067">Tree</span>&nbsp;<span class="op" id="3289072">=</span>&nbsp;<span class="ident" id="3289074">nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289081"><a href="/html/template/escape.go.html#3289004">t</a></span><span class="op" id="3289082">.</span><span class="ident" id="3289083">Tree</span>&nbsp;<span class="op" id="3289088">=</span>&nbsp;<span class="ident" id="3289090">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289100">return</span>&nbsp;<span class="ident" id="3289107"><a href="/html/template/escape.go.html#3288746">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289115"><a href="/html/template/escape.go.html#3288671">e</a></span><span class="op" id="3289116">.</span><span class="ident" id="3289117">commit</span><span class="op" id="3289123">(</span><span class="op" id="3289124">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289127">if</span>&nbsp;<span class="ident" id="3289130">t</span>&nbsp;<span class="op" id="3289132">:=</span>&nbsp;<span class="ident" id="3289135"><a href="/html/template/escape.go.html#3288616">tmpl</a></span><span class="op" id="3289139">.</span><span class="ident" id="3289140">set</span><span class="op" id="3289143">[</span><span class="ident" id="3289144"><a href="/html/template/escape.go.html#3288649">name</a></span><span class="op" id="3289148">]</span><span class="op" id="3289149">;</span>&nbsp;<span class="ident" id="3289151"><a href="/html/template/escape.go.html#3289130">t</a></span>&nbsp;<span class="op" id="3289153">!=</span>&nbsp;<span class="ident" id="3289156">nil</span>&nbsp;<span class="op" id="3289160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289164"><a href="/html/template/escape.go.html#3289130">t</a></span><span class="op" id="3289165">.</span><span class="ident" id="3289166">escapeErr</span>&nbsp;<span class="op" id="3289176">=</span>&nbsp;<span class="ident" id="3289178"><a href="/html/template/template.go.html#3331461">escapeOK</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289189"><a href="/html/template/escape.go.html#3289130">t</a></span><span class="op" id="3289190">.</span><span class="ident" id="3289191">Tree</span>&nbsp;<span class="op" id="3289196">=</span>&nbsp;<span class="ident" id="3289198"><a href="/html/template/escape.go.html#3289130">t</a></span><span class="op" id="3289199">.</span><span class="ident" id="3289200">text</span><span class="op" id="3289204">.</span><span class="ident" id="3289205">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289214">return</span>&nbsp;<span class="ident" id="3289221">nil</span><br>
<span class="lineno">45</span><span class="op" id="3289225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3289228">//&nbsp;funcMap&nbsp;maps&nbsp;command&nbsp;names&nbsp;to&nbsp;functions&nbsp;that&nbsp;render&nbsp;their&nbsp;inputs&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="3289302">var</span>&nbsp;<span class="ident" id="3289306">funcMap</span>&nbsp;<span class="op" id="3289314">=</span>&nbsp;<span class="ident" id="3289316"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3289324">.</span><span class="ident" id="3289325">FuncMap</span><span class="op" id="3289332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289335">&#34;html_template_attrescaper&#34;</span><span class="op" id="3289362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289368"><a href="/html/template/html.go.html#3313761">attrEscaper</a></span><span class="op" id="3289379">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289382">&#34;html_template_commentescaper&#34;</span><span class="op" id="3289412">:</span>&nbsp;&nbsp;<span class="ident" id="3289415"><a href="/html/template/html.go.html#3320294">commentEscaper</a></span><span class="op" id="3289429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289432">&#34;html_template_cssescaper&#34;</span><span class="op" id="3289458">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289465"><a href="/html/template/css.go.html#3271242">cssEscaper</a></span><span class="op" id="3289475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289478">&#34;html_template_cssvaluefilter&#34;</span><span class="op" id="3289508">:</span>&nbsp;&nbsp;<span class="ident" id="3289511"><a href="/html/template/css.go.html#3272758">cssValueFilter</a></span><span class="op" id="3289525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289528">&#34;html_template_htmlnamefilter&#34;</span><span class="op" id="3289558">:</span>&nbsp;&nbsp;<span class="ident" id="3289561"><a href="/html/template/html.go.html#3319223">htmlNameFilter</a></span><span class="op" id="3289575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289578">&#34;html_template_htmlescaper&#34;</span><span class="op" id="3289605">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289611"><a href="/html/template/html.go.html#3314325">htmlEscaper</a></span><span class="op" id="3289622">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289625">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="3289656">:</span>&nbsp;<span class="ident" id="3289658"><a href="/html/template/js.go.html#3327658">jsRegexpEscaper</a></span><span class="op" id="3289673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289676">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="3289704">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289709"><a href="/html/template/js.go.html#3327174">jsStrEscaper</a></span><span class="op" id="3289721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289724">&#34;html_template_jsvalescaper&#34;</span><span class="op" id="3289752">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289757"><a href="/html/template/js.go.html#3324763">jsValEscaper</a></span><span class="op" id="3289769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289772">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="3289802">:</span>&nbsp;&nbsp;<span class="ident" id="3289805"><a href="/html/template/html.go.html#3313445">htmlNospaceEscaper</a></span><span class="op" id="3289823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289826">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="3289855">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3289859"><a href="/html/template/html.go.html#3314055">rcdataEscaper</a></span><span class="op" id="3289872">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289875">&#34;html_template_urlescaper&#34;</span><span class="op" id="3289901">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289908"><a href="/html/template/url.go.html#3358496">urlEscaper</a></span><span class="op" id="3289918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289921">&#34;html_template_urlfilter&#34;</span><span class="op" id="3289946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3289954"><a href="/html/template/url.go.html#3357993">urlFilter</a></span><span class="op" id="3289963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3289966">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="3289995">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3289999"><a href="/html/template/url.go.html#3358882">urlNormalizer</a></span><span class="op" id="3290012">,</span><br>
<span class="lineno"></span><span class="op" id="3290014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3290017">//&nbsp;equivEscapers&nbsp;matches&nbsp;contextual&nbsp;escapers&nbsp;to&nbsp;equivalent&nbsp;template&nbsp;builtins.</span><br>
<span class="lineno"></span><span class="keyword" id="3290095">var</span>&nbsp;<span class="ident" id="3290099">equivEscapers</span>&nbsp;<span class="op" id="3290113">=</span>&nbsp;<span class="keyword" id="3290115">map</span><span class="op" id="3290118">[</span><span class="builtintype" id="3290119">string</span><span class="op" id="3290125">]</span><span class="builtintype" id="3290126">string</span><span class="op" id="3290132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3290135">&#34;html_template_attrescaper&#34;</span><span class="op" id="3290162">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3290167">&#34;html&#34;</span><span class="op" id="3290173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3290176">&#34;html_template_htmlescaper&#34;</span><span class="op" id="3290203">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3290208">&#34;html&#34;</span><span class="op" id="3290214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3290217">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="3290247">:</span>&nbsp;<span class="string" id="3290249">&#34;html&#34;</span><span class="op" id="3290255">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3290258">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="3290287">:</span>&nbsp;&nbsp;<span class="string" id="3290290">&#34;html&#34;</span><span class="op" id="3290296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3290299">&#34;html_template_urlescaper&#34;</span><span class="op" id="3290325">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3290331">&#34;urlquery&#34;</span><span class="op" id="3290341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3290344">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="3290373">:</span>&nbsp;&nbsp;<span class="string" id="3290376">&#34;urlquery&#34;</span><span class="op" id="3290386">,</span><br>
<span class="lineno"></span><span class="op" id="3290388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3290391">//&nbsp;escaper&nbsp;collects&nbsp;type&nbsp;inferences&nbsp;about&nbsp;templates&nbsp;and&nbsp;changes&nbsp;needed&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span><span class="comment" id="3290470">//&nbsp;templates&nbsp;injection&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="3290499">type</span>&nbsp;<span class="ident" id="3290504">escaper</span>&nbsp;<span class="keyword" id="3290512">struct</span>&nbsp;<span class="op" id="3290519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290522">tmpl</span>&nbsp;<span class="op" id="3290527">*</span><span class="ident" id="3290528"><a href="/html/template/template.go.html#3330985">Template</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3290538">//&nbsp;output[templateName]&nbsp;is&nbsp;the&nbsp;output&nbsp;context&nbsp;for&nbsp;a&nbsp;templateName&nbsp;that</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3290609">//&nbsp;has&nbsp;been&nbsp;mangled&nbsp;to&nbsp;include&nbsp;its&nbsp;input&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290660">output</span>&nbsp;<span class="keyword" id="3290667">map</span><span class="op" id="3290670">[</span><span class="builtintype" id="3290671">string</span><span class="op" id="3290677">]</span><span class="ident" id="3290678"><a href="/html/template/context.go.html#3257317">context</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3290687">//&nbsp;derived[c.mangle(name)]&nbsp;maps&nbsp;to&nbsp;a&nbsp;template&nbsp;derived&nbsp;from&nbsp;the&nbsp;template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3290760">//&nbsp;named&nbsp;name&nbsp;templateName&nbsp;for&nbsp;the&nbsp;start&nbsp;context&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290813">derived</span>&nbsp;<span class="keyword" id="3290821">map</span><span class="op" id="3290824">[</span><span class="builtintype" id="3290825">string</span><span class="op" id="3290831">]</span><span class="op" id="3290832">*</span><span class="ident" id="3290833"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3290841">.</span><span class="ident" id="3290842">Template</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3290852">//&nbsp;called[templateName]&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;called&nbsp;mangled&nbsp;template&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290920">called</span>&nbsp;<span class="keyword" id="3290927">map</span><span class="op" id="3290930">[</span><span class="builtintype" id="3290931">string</span><span class="op" id="3290937">]</span><span class="builtintype" id="3290938">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3290944">//&nbsp;xxxNodeEdits&nbsp;are&nbsp;the&nbsp;accumulated&nbsp;edits&nbsp;to&nbsp;apply&nbsp;during&nbsp;commit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3291011">//&nbsp;Such&nbsp;edits&nbsp;are&nbsp;not&nbsp;applied&nbsp;immediately&nbsp;in&nbsp;case&nbsp;a&nbsp;template&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3291077">//&nbsp;executes&nbsp;a&nbsp;given&nbsp;template&nbsp;in&nbsp;different&nbsp;escaping&nbsp;contexts.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3291139">actionNodeEdits</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291157">map</span><span class="op" id="3291160">[</span><span class="op" id="3291161">*</span><span class="ident" id="3291162"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3291167">.</span><span class="ident" id="3291168">ActionNode</span><span class="op" id="3291178">]</span><span class="op" id="3291179">[</span><span class="op" id="3291180">]</span><span class="builtintype" id="3291181">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3291189">templateNodeEdits</span>&nbsp;<span class="keyword" id="3291207">map</span><span class="op" id="3291210">[</span><span class="op" id="3291211">*</span><span class="ident" id="3291212"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3291217">.</span><span class="ident" id="3291218">TemplateNode</span><span class="op" id="3291230">]</span><span class="builtintype" id="3291231">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3291239">textNodeEdits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3291257">map</span><span class="op" id="3291260">[</span><span class="op" id="3291261">*</span><span class="ident" id="3291262"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3291267">.</span><span class="ident" id="3291268">TextNode</span><span class="op" id="3291276">]</span><span class="op" id="3291277">[</span><span class="op" id="3291278">]</span><span class="builtintype" id="3291279">byte</span><br>
<span class="lineno"></span><span class="op" id="3291284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3291287">//&nbsp;newEscaper&nbsp;creates&nbsp;a&nbsp;blank&nbsp;escaper&nbsp;for&nbsp;the&nbsp;given&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3291344">func</span>&nbsp;<span class="ident" id="3291349">newEscaper</span><span class="op" id="3291359">(</span><span class="ident" id="3291360">t</span>&nbsp;<span class="op" id="3291362">*</span><span class="ident" id="3291363"><a href="/html/template/template.go.html#3330985">Template</a></span><span class="op" id="3291371">)</span>&nbsp;<span class="op" id="3291373">*</span><span class="ident" id="3291374"><a href="/html/template/escape.go.html#3290504">escaper</a></span>&nbsp;<span class="op" id="3291382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291385">return</span>&nbsp;<span class="op" id="3291392">&amp;</span><span class="ident" id="3291393"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3291400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3291404"><a href="/html/template/escape.go.html#3291360">t</a></span><span class="op" id="3291405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291409">map</span><span class="op" id="3291412">[</span><span class="builtintype" id="3291413">string</span><span class="op" id="3291419">]</span><span class="ident" id="3291420"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3291427">{</span><span class="op" id="3291428">}</span><span class="op" id="3291429">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291433">map</span><span class="op" id="3291436">[</span><span class="builtintype" id="3291437">string</span><span class="op" id="3291443">]</span><span class="op" id="3291444">*</span><span class="ident" id="3291445"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3291453">.</span><span class="ident" id="3291454">Template</span><span class="op" id="3291462">{</span><span class="op" id="3291463">}</span><span class="op" id="3291464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291468">map</span><span class="op" id="3291471">[</span><span class="builtintype" id="3291472">string</span><span class="op" id="3291478">]</span><span class="builtintype" id="3291479">bool</span><span class="op" id="3291483">{</span><span class="op" id="3291484">}</span><span class="op" id="3291485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291489">map</span><span class="op" id="3291492">[</span><span class="op" id="3291493">*</span><span class="ident" id="3291494"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3291499">.</span><span class="ident" id="3291500">ActionNode</span><span class="op" id="3291510">]</span><span class="op" id="3291511">[</span><span class="op" id="3291512">]</span><span class="builtintype" id="3291513">string</span><span class="op" id="3291519">{</span><span class="op" id="3291520">}</span><span class="op" id="3291521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291525">map</span><span class="op" id="3291528">[</span><span class="op" id="3291529">*</span><span class="ident" id="3291530"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3291535">.</span><span class="ident" id="3291536">TemplateNode</span><span class="op" id="3291548">]</span><span class="builtintype" id="3291549">string</span><span class="op" id="3291555">{</span><span class="op" id="3291556">}</span><span class="op" id="3291557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3291561">map</span><span class="op" id="3291564">[</span><span class="op" id="3291565">*</span><span class="ident" id="3291566"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3291571">.</span><span class="ident" id="3291572">TextNode</span><span class="op" id="3291580">]</span><span class="op" id="3291581">[</span><span class="op" id="3291582">]</span><span class="builtintype" id="3291583">byte</span><span class="op" id="3291587">{</span><span class="op" id="3291588">}</span><span class="op" id="3291589">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3291592">}</span><br>
<span class="lineno"></span><span class="op" id="3291594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3291597">//&nbsp;filterFailsafe&nbsp;is&nbsp;an&nbsp;innocuous&nbsp;word&nbsp;that&nbsp;is&nbsp;emitted&nbsp;in&nbsp;place&nbsp;of&nbsp;unsafe&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3291678">//&nbsp;by&nbsp;sanitizer&nbsp;functions.&nbsp;It&nbsp;is&nbsp;not&nbsp;a&nbsp;keyword&nbsp;in&nbsp;any&nbsp;programming&nbsp;language,</span><br>
<span class="lineno">110</span><span class="comment" id="3291754">//&nbsp;contains&nbsp;no&nbsp;special&nbsp;characters,&nbsp;is&nbsp;not&nbsp;empty,&nbsp;and&nbsp;when&nbsp;it&nbsp;appears&nbsp;in&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="3291833">//&nbsp;it&nbsp;is&nbsp;distinct&nbsp;enough&nbsp;that&nbsp;a&nbsp;developer&nbsp;can&nbsp;find&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;problem</span><br>
<span class="lineno"></span><span class="comment" id="3291910">//&nbsp;via&nbsp;a&nbsp;search&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="3291934">const</span>&nbsp;<span class="ident" id="3291940">filterFailsafe</span>&nbsp;<span class="op" id="3291955">=</span>&nbsp;<span class="string" id="3291957">&#34;ZgotmplZ&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3291969">//&nbsp;escape&nbsp;escapes&nbsp;a&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3292004">func</span>&nbsp;<span class="op" id="3292009">(</span><span class="ident" id="3292010">e</span>&nbsp;<span class="op" id="3292012">*</span><span class="ident" id="3292013"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3292020">)</span>&nbsp;<span class="ident" id="3292022">escape</span><span class="op" id="3292028">(</span><span class="ident" id="3292029">c</span>&nbsp;<span class="ident" id="3292031"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3292038">,</span>&nbsp;<span class="ident" id="3292040">n</span>&nbsp;<span class="ident" id="3292042"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292047">.</span><span class="ident" id="3292048">Node</span><span class="op" id="3292052">)</span>&nbsp;<span class="ident" id="3292054"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3292062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292065">switch</span>&nbsp;<span class="ident" id="3292072">n</span>&nbsp;<span class="op" id="3292074">:=</span>&nbsp;<span class="ident" id="3292077"><a href="/html/template/escape.go.html#3292040">n</a></span><span class="op" id="3292078">.</span><span class="op" id="3292079">(</span><span class="keyword" id="3292080">type</span><span class="op" id="3292084">)</span>&nbsp;<span class="op" id="3292086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292089">case</span>&nbsp;<span class="op" id="3292094">*</span><span class="ident" id="3292095"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292100">.</span><span class="ident" id="3292101">ActionNode</span><span class="op" id="3292111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292115">return</span>&nbsp;<span class="ident" id="3292122"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292123">.</span><span class="ident" id="3292124">escapeAction</span><span class="op" id="3292136">(</span><span class="ident" id="3292137"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292138">,</span>&nbsp;<span class="ident" id="3292140"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292141">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292144">case</span>&nbsp;<span class="op" id="3292149">*</span><span class="ident" id="3292150"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292155">.</span><span class="ident" id="3292156">IfNode</span><span class="op" id="3292162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292166">return</span>&nbsp;<span class="ident" id="3292173"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292174">.</span><span class="ident" id="3292175">escapeBranch</span><span class="op" id="3292187">(</span><span class="ident" id="3292188"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292189">,</span>&nbsp;<span class="op" id="3292191">&amp;</span><span class="ident" id="3292192"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292193">.</span><span class="ident" id="3292194">BranchNode</span><span class="op" id="3292204">,</span>&nbsp;<span class="string" id="3292206">&#34;if&#34;</span><span class="op" id="3292210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292213">case</span>&nbsp;<span class="op" id="3292218">*</span><span class="ident" id="3292219"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292224">.</span><span class="ident" id="3292225">ListNode</span><span class="op" id="3292233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292237">return</span>&nbsp;<span class="ident" id="3292244"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292245">.</span><span class="ident" id="3292246">escapeList</span><span class="op" id="3292256">(</span><span class="ident" id="3292257"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292258">,</span>&nbsp;<span class="ident" id="3292260"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292264">case</span>&nbsp;<span class="op" id="3292269">*</span><span class="ident" id="3292270"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292275">.</span><span class="ident" id="3292276">RangeNode</span><span class="op" id="3292285">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292289">return</span>&nbsp;<span class="ident" id="3292296"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292297">.</span><span class="ident" id="3292298">escapeBranch</span><span class="op" id="3292310">(</span><span class="ident" id="3292311"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292312">,</span>&nbsp;<span class="op" id="3292314">&amp;</span><span class="ident" id="3292315"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292316">.</span><span class="ident" id="3292317">BranchNode</span><span class="op" id="3292327">,</span>&nbsp;<span class="string" id="3292329">&#34;range&#34;</span><span class="op" id="3292336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292339">case</span>&nbsp;<span class="op" id="3292344">*</span><span class="ident" id="3292345"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292350">.</span><span class="ident" id="3292351">TemplateNode</span><span class="op" id="3292363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292367">return</span>&nbsp;<span class="ident" id="3292374"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292375">.</span><span class="ident" id="3292376">escapeTemplate</span><span class="op" id="3292390">(</span><span class="ident" id="3292391"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292392">,</span>&nbsp;<span class="ident" id="3292394"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292398">case</span>&nbsp;<span class="op" id="3292403">*</span><span class="ident" id="3292404"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292409">.</span><span class="ident" id="3292410">TextNode</span><span class="op" id="3292418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292422">return</span>&nbsp;<span class="ident" id="3292429"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292430">.</span><span class="ident" id="3292431">escapeText</span><span class="op" id="3292441">(</span><span class="ident" id="3292442"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292443">,</span>&nbsp;<span class="ident" id="3292445"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292446">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292449">case</span>&nbsp;<span class="op" id="3292454">*</span><span class="ident" id="3292455"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292460">.</span><span class="ident" id="3292461">WithNode</span><span class="op" id="3292469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292473">return</span>&nbsp;<span class="ident" id="3292480"><a href="/html/template/escape.go.html#3292010">e</a></span><span class="op" id="3292481">.</span><span class="ident" id="3292482">escapeBranch</span><span class="op" id="3292494">(</span><span class="ident" id="3292495"><a href="/html/template/escape.go.html#3292029">c</a></span><span class="op" id="3292496">,</span>&nbsp;<span class="op" id="3292498">&amp;</span><span class="ident" id="3292499"><a href="/html/template/escape.go.html#3292072">n</a></span><span class="op" id="3292500">.</span><span class="ident" id="3292501">BranchNode</span><span class="op" id="3292511">,</span>&nbsp;<span class="string" id="3292513">&#34;with&#34;</span><span class="op" id="3292519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3292522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3292525">panic</span><span class="op" id="3292530">(</span><span class="string" id="3292531">&#34;escaping&nbsp;&#34;</span>&nbsp;<span class="op" id="3292543">+</span>&nbsp;<span class="ident" id="3292545"><a href="/html/template/escape.go.html#3292040">n</a></span><span class="op" id="3292546">.</span><span class="ident" id="3292547">String</span><span class="op" id="3292553">(</span><span class="op" id="3292554">)</span>&nbsp;<span class="op" id="3292556">+</span>&nbsp;<span class="string" id="3292558">&#34;&nbsp;is&nbsp;unimplemented&#34;</span><span class="op" id="3292577">)</span><br>
<span class="lineno"></span><span class="op" id="3292579">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="3292582">//&nbsp;escapeAction&nbsp;escapes&nbsp;an&nbsp;action&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3292631">func</span>&nbsp;<span class="op" id="3292636">(</span><span class="ident" id="3292637">e</span>&nbsp;<span class="op" id="3292639">*</span><span class="ident" id="3292640"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3292647">)</span>&nbsp;<span class="ident" id="3292649">escapeAction</span><span class="op" id="3292661">(</span><span class="ident" id="3292662">c</span>&nbsp;<span class="ident" id="3292664"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3292671">,</span>&nbsp;<span class="ident" id="3292673">n</span>&nbsp;<span class="op" id="3292675">*</span><span class="ident" id="3292676"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3292681">.</span><span class="ident" id="3292682">ActionNode</span><span class="op" id="3292692">)</span>&nbsp;<span class="ident" id="3292694"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3292702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292705">if</span>&nbsp;<span class="builtinfunc" id="3292708">len</span><span class="op" id="3292711">(</span><span class="ident" id="3292712"><a href="/html/template/escape.go.html#3292673">n</a></span><span class="op" id="3292713">.</span><span class="ident" id="3292714">Pipe</span><span class="op" id="3292718">.</span><span class="ident" id="3292719">Decl</span><span class="op" id="3292723">)</span>&nbsp;<span class="op" id="3292725">!=</span>&nbsp;<span class="num" id="3292728">0</span>&nbsp;<span class="op" id="3292730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3292734">//&nbsp;A&nbsp;local&nbsp;variable&nbsp;assignment,&nbsp;not&nbsp;an&nbsp;interpolation.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292790">return</span>&nbsp;<span class="ident" id="3292797"><a href="/html/template/escape.go.html#3292662">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3292800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3292803"><a href="/html/template/escape.go.html#3292662">c</a></span>&nbsp;<span class="op" id="3292805">=</span>&nbsp;<span class="ident" id="3292807"><a href="/html/template/escape.go.html#3298967">nudge</a></span><span class="op" id="3292812">(</span><span class="ident" id="3292813"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3292814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3292817">s</span>&nbsp;<span class="op" id="3292819">:=</span>&nbsp;<span class="builtinfunc" id="3292822">make</span><span class="op" id="3292826">(</span><span class="op" id="3292827">[</span><span class="op" id="3292828">]</span><span class="builtintype" id="3292829">string</span><span class="op" id="3292835">,</span>&nbsp;<span class="num" id="3292837">0</span><span class="op" id="3292838">,</span>&nbsp;<span class="num" id="3292840">3</span><span class="op" id="3292841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292844">switch</span>&nbsp;<span class="ident" id="3292851"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3292852">.</span><span class="ident" id="3292853">state</span>&nbsp;<span class="op" id="3292859">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292862">case</span>&nbsp;<span class="ident" id="3292867"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3292877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292881">return</span>&nbsp;<span class="ident" id="3292888"><a href="/html/template/escape.go.html#3292662">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292891">case</span>&nbsp;<span class="ident" id="3292896"><a href="/html/template/context.go.html#3260098">stateURL</a></span><span class="op" id="3292904">,</span>&nbsp;<span class="ident" id="3292906"><a href="/html/template/context.go.html#3260714">stateCSSDqStr</a></span><span class="op" id="3292919">,</span>&nbsp;<span class="ident" id="3292921"><a href="/html/template/context.go.html#3260789">stateCSSSqStr</a></span><span class="op" id="3292934">,</span>&nbsp;<span class="ident" id="3292936"><a href="/html/template/context.go.html#3260868">stateCSSDqURL</a></span><span class="op" id="3292949">,</span>&nbsp;<span class="ident" id="3292951"><a href="/html/template/context.go.html#3260947">stateCSSSqURL</a></span><span class="op" id="3292964">,</span>&nbsp;<span class="ident" id="3292966"><a href="/html/template/context.go.html#3261017">stateCSSURL</a></span><span class="op" id="3292977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3292981">switch</span>&nbsp;<span class="ident" id="3292988"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3292989">.</span><span class="ident" id="3292990">urlPart</span>&nbsp;<span class="op" id="3292998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293002">case</span>&nbsp;<span class="ident" id="3293007"><a href="/html/template/context.go.html#3263847">urlPartNone</a></span><span class="op" id="3293018">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293023"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293025">=</span>&nbsp;<span class="builtinfunc" id="3293027">append</span><span class="op" id="3293033">(</span><span class="ident" id="3293034"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293035">,</span>&nbsp;<span class="string" id="3293037">&#34;html_template_urlfilter&#34;</span><span class="op" id="3293062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293067">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293081">case</span>&nbsp;<span class="ident" id="3293086"><a href="/html/template/context.go.html#3263990">urlPartPreQuery</a></span><span class="op" id="3293101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293106">switch</span>&nbsp;<span class="ident" id="3293113"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3293114">.</span><span class="ident" id="3293115">state</span>&nbsp;<span class="op" id="3293121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293126">case</span>&nbsp;<span class="ident" id="3293131"><a href="/html/template/context.go.html#3260714">stateCSSDqStr</a></span><span class="op" id="3293144">,</span>&nbsp;<span class="ident" id="3293146"><a href="/html/template/context.go.html#3260789">stateCSSSqStr</a></span><span class="op" id="3293159">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293165"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293167">=</span>&nbsp;<span class="builtinfunc" id="3293169">append</span><span class="op" id="3293175">(</span><span class="ident" id="3293176"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293177">,</span>&nbsp;<span class="string" id="3293179">&#34;html_template_cssescaper&#34;</span><span class="op" id="3293205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293210">default</span><span class="op" id="3293217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293223"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293225">=</span>&nbsp;<span class="builtinfunc" id="3293227">append</span><span class="op" id="3293233">(</span><span class="ident" id="3293234"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293235">,</span>&nbsp;<span class="string" id="3293237">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="3293266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3293271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293275">case</span>&nbsp;<span class="ident" id="3293280"><a href="/html/template/context.go.html#3264111">urlPartQueryOrFrag</a></span><span class="op" id="3293298">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293303"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293305">=</span>&nbsp;<span class="builtinfunc" id="3293307">append</span><span class="op" id="3293313">(</span><span class="ident" id="3293314"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293315">,</span>&nbsp;<span class="string" id="3293317">&#34;html_template_urlescaper&#34;</span><span class="op" id="3293343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293347">case</span>&nbsp;<span class="ident" id="3293352"><a href="/html/template/context.go.html#3264231">urlPartUnknown</a></span><span class="op" id="3293366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293371">return</span>&nbsp;<span class="ident" id="3293378"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3293385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293391">state</span><span class="op" id="3293396">:</span>&nbsp;<span class="ident" id="3293398"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3293408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293414">err</span><span class="op" id="3293417">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3293421"><a href="/html/template/error.go.html#3287884">errorf</a></span><span class="op" id="3293427">(</span><span class="ident" id="3293428"><a href="/html/template/error.go.html#3282309">ErrAmbigContext</a></span><span class="op" id="3293443">,</span>&nbsp;<span class="ident" id="3293445"><a href="/html/template/escape.go.html#3292673">n</a></span><span class="op" id="3293446">,</span>&nbsp;<span class="ident" id="3293448"><a href="/html/template/escape.go.html#3292673">n</a></span><span class="op" id="3293449">.</span><span class="ident" id="3293450">Line</span><span class="op" id="3293454">,</span>&nbsp;<span class="string" id="3293456">&#34;%s&nbsp;appears&nbsp;in&nbsp;an&nbsp;ambiguous&nbsp;URL&nbsp;context&#34;</span><span class="op" id="3293496">,</span>&nbsp;<span class="ident" id="3293498"><a href="/html/template/escape.go.html#3292673">n</a></span><span class="op" id="3293499">)</span><span class="op" id="3293500">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3293505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293509">default</span><span class="op" id="3293516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3293521">panic</span><span class="op" id="3293526">(</span><span class="ident" id="3293527"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3293528">.</span><span class="ident" id="3293529">urlPart</span><span class="op" id="3293536">.</span><span class="ident" id="3293537">String</span><span class="op" id="3293543">(</span><span class="op" id="3293544">)</span><span class="op" id="3293545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3293549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293552">case</span>&nbsp;<span class="ident" id="3293557"><a href="/html/template/context.go.html#3260170">stateJS</a></span><span class="op" id="3293564">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293568"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293570">=</span>&nbsp;<span class="builtinfunc" id="3293572">append</span><span class="op" id="3293578">(</span><span class="ident" id="3293579"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293580">,</span>&nbsp;<span class="string" id="3293582">&#34;html_template_jsvalescaper&#34;</span><span class="op" id="3293610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3293614">//&nbsp;A&nbsp;slash&nbsp;after&nbsp;a&nbsp;value&nbsp;starts&nbsp;a&nbsp;div&nbsp;operator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293664"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3293665">.</span><span class="ident" id="3293666">jsCtx</span>&nbsp;<span class="op" id="3293672">=</span>&nbsp;<span class="ident" id="3293674"><a href="/html/template/context.go.html#3264873">jsCtxDivOp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293686">case</span>&nbsp;<span class="ident" id="3293691"><a href="/html/template/context.go.html#3260245">stateJSDqStr</a></span><span class="op" id="3293703">,</span>&nbsp;<span class="ident" id="3293705"><a href="/html/template/context.go.html#3260325">stateJSSqStr</a></span><span class="op" id="3293717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293721"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293723">=</span>&nbsp;<span class="builtinfunc" id="3293725">append</span><span class="op" id="3293731">(</span><span class="ident" id="3293732"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293733">,</span>&nbsp;<span class="string" id="3293735">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="3293763">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293766">case</span>&nbsp;<span class="ident" id="3293771"><a href="/html/template/context.go.html#3260400">stateJSRegexp</a></span><span class="op" id="3293784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293788"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293790">=</span>&nbsp;<span class="builtinfunc" id="3293792">append</span><span class="op" id="3293798">(</span><span class="ident" id="3293799"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293800">,</span>&nbsp;<span class="string" id="3293802">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="3293833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293836">case</span>&nbsp;<span class="ident" id="3293841"><a href="/html/template/context.go.html#3260644">stateCSS</a></span><span class="op" id="3293849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293853"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293855">=</span>&nbsp;<span class="builtinfunc" id="3293857">append</span><span class="op" id="3293863">(</span><span class="ident" id="3293864"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293865">,</span>&nbsp;<span class="string" id="3293867">&#34;html_template_cssvaluefilter&#34;</span><span class="op" id="3293897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293900">case</span>&nbsp;<span class="ident" id="3293905"><a href="/html/template/context.go.html#3259212">stateText</a></span><span class="op" id="3293914">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293918"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293920">=</span>&nbsp;<span class="builtinfunc" id="3293922">append</span><span class="op" id="3293928">(</span><span class="ident" id="3293929"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293930">,</span>&nbsp;<span class="string" id="3293932">&#34;html_template_htmlescaper&#34;</span><span class="op" id="3293959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3293962">case</span>&nbsp;<span class="ident" id="3293967"><a href="/html/template/context.go.html#3259936">stateRCDATA</a></span><span class="op" id="3293978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3293982"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3293984">=</span>&nbsp;<span class="builtinfunc" id="3293986">append</span><span class="op" id="3293992">(</span><span class="ident" id="3293993"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3293994">,</span>&nbsp;<span class="string" id="3293996">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="3294025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294028">case</span>&nbsp;<span class="ident" id="3294033"><a href="/html/template/context.go.html#3260018">stateAttr</a></span><span class="op" id="3294042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3294046">//&nbsp;Handled&nbsp;below&nbsp;in&nbsp;delim&nbsp;check.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294080">case</span>&nbsp;<span class="ident" id="3294085"><a href="/html/template/context.go.html#3259415">stateAttrName</a></span><span class="op" id="3294098">,</span>&nbsp;<span class="ident" id="3294100"><a href="/html/template/context.go.html#3259302">stateTag</a></span><span class="op" id="3294108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294112"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3294113">.</span><span class="ident" id="3294114">state</span>&nbsp;<span class="op" id="3294120">=</span>&nbsp;<span class="ident" id="3294122"><a href="/html/template/context.go.html#3259415">stateAttrName</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294138"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3294140">=</span>&nbsp;<span class="builtinfunc" id="3294142">append</span><span class="op" id="3294148">(</span><span class="ident" id="3294149"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3294150">,</span>&nbsp;<span class="string" id="3294152">&#34;html_template_htmlnamefilter&#34;</span><span class="op" id="3294182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294185">default</span><span class="op" id="3294192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294196">if</span>&nbsp;<span class="ident" id="3294199"><a href="/html/template/context.go.html#3262436">isComment</a></span><span class="op" id="3294208">(</span><span class="ident" id="3294209"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3294210">.</span><span class="ident" id="3294211">state</span><span class="op" id="3294216">)</span>&nbsp;<span class="op" id="3294218">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294223"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3294225">=</span>&nbsp;<span class="builtinfunc" id="3294227">append</span><span class="op" id="3294233">(</span><span class="ident" id="3294234"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3294235">,</span>&nbsp;<span class="string" id="3294237">&#34;html_template_commentescaper&#34;</span><span class="op" id="3294267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294271">}</span>&nbsp;<span class="keyword" id="3294273">else</span>&nbsp;<span class="op" id="3294278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3294283">panic</span><span class="op" id="3294288">(</span><span class="string" id="3294289">&#34;unexpected&nbsp;state&nbsp;&#34;</span>&nbsp;<span class="op" id="3294309">+</span>&nbsp;<span class="ident" id="3294311"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3294312">.</span><span class="ident" id="3294313">state</span><span class="op" id="3294318">.</span><span class="ident" id="3294319">String</span><span class="op" id="3294325">(</span><span class="op" id="3294326">)</span><span class="op" id="3294327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294334">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294337">switch</span>&nbsp;<span class="ident" id="3294344"><a href="/html/template/escape.go.html#3292662">c</a></span><span class="op" id="3294345">.</span><span class="ident" id="3294346">delim</span>&nbsp;<span class="op" id="3294352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294355">case</span>&nbsp;<span class="ident" id="3294360"><a href="/html/template/context.go.html#3262948">delimNone</a></span><span class="op" id="3294369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3294373">//&nbsp;No&nbsp;extra-escaping&nbsp;needed&nbsp;for&nbsp;raw&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294424">case</span>&nbsp;<span class="ident" id="3294429"><a href="/html/template/context.go.html#3263252">delimSpaceOrTagEnd</a></span><span class="op" id="3294447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294451"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3294453">=</span>&nbsp;<span class="builtinfunc" id="3294455">append</span><span class="op" id="3294461">(</span><span class="ident" id="3294462"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3294463">,</span>&nbsp;<span class="string" id="3294465">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="3294495">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294498">default</span><span class="op" id="3294505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294509"><a href="/html/template/escape.go.html#3292817">s</a></span>&nbsp;<span class="op" id="3294511">=</span>&nbsp;<span class="builtinfunc" id="3294513">append</span><span class="op" id="3294519">(</span><span class="ident" id="3294520"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3294521">,</span>&nbsp;<span class="string" id="3294523">&#34;html_template_attrescaper&#34;</span><span class="op" id="3294550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294556"><a href="/html/template/escape.go.html#3292637">e</a></span><span class="op" id="3294557">.</span><span class="ident" id="3294558">editActionNode</span><span class="op" id="3294572">(</span><span class="ident" id="3294573"><a href="/html/template/escape.go.html#3292673">n</a></span><span class="op" id="3294574">,</span>&nbsp;<span class="ident" id="3294576"><a href="/html/template/escape.go.html#3292817">s</a></span><span class="op" id="3294577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294580">return</span>&nbsp;<span class="ident" id="3294587"><a href="/html/template/escape.go.html#3292662">c</a></span><br>
<span class="lineno">205</span><span class="op" id="3294589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3294592">//&nbsp;allIdents&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;identifiers&nbsp;under&nbsp;the&nbsp;Ident&nbsp;field&nbsp;of&nbsp;the&nbsp;node,</span><br>
<span class="lineno"></span><span class="comment" id="3294677">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;singleton&nbsp;(Identifier)&nbsp;or&nbsp;a&nbsp;slice&nbsp;(Field).</span><br>
<span class="lineno"></span><span class="keyword" id="3294740">func</span>&nbsp;<span class="ident" id="3294745">allIdents</span><span class="op" id="3294754">(</span><span class="ident" id="3294755">node</span>&nbsp;<span class="ident" id="3294760"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3294765">.</span><span class="ident" id="3294766">Node</span><span class="op" id="3294770">)</span>&nbsp;<span class="op" id="3294772">[</span><span class="op" id="3294773">]</span><span class="builtintype" id="3294774">string</span>&nbsp;<span class="op" id="3294781">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294784">switch</span>&nbsp;<span class="ident" id="3294791">node</span>&nbsp;<span class="op" id="3294796">:=</span>&nbsp;<span class="ident" id="3294799"><a href="/html/template/escape.go.html#3294755">node</a></span><span class="op" id="3294803">.</span><span class="op" id="3294804">(</span><span class="keyword" id="3294805">type</span><span class="op" id="3294809">)</span>&nbsp;<span class="op" id="3294811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294814">case</span>&nbsp;<span class="op" id="3294819">*</span><span class="ident" id="3294820"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3294825">.</span><span class="ident" id="3294826">IdentifierNode</span><span class="op" id="3294840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294844">return</span>&nbsp;<span class="op" id="3294851">[</span><span class="op" id="3294852">]</span><span class="builtintype" id="3294853">string</span><span class="op" id="3294859">{</span><span class="ident" id="3294860"><a href="/html/template/escape.go.html#3294791">node</a></span><span class="op" id="3294864">.</span><span class="ident" id="3294865">Ident</span><span class="op" id="3294870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294873">case</span>&nbsp;<span class="op" id="3294878">*</span><span class="ident" id="3294879"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3294884">.</span><span class="ident" id="3294885">FieldNode</span><span class="op" id="3294894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294898">return</span>&nbsp;<span class="ident" id="3294905"><a href="/html/template/escape.go.html#3294791">node</a></span><span class="op" id="3294909">.</span><span class="ident" id="3294910">Ident</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3294920">panic</span><span class="op" id="3294925">(</span><span class="string" id="3294926">&#34;unidentified&nbsp;node&nbsp;type&nbsp;in&nbsp;allIdents&#34;</span><span class="op" id="3294963">)</span><br>
<span class="lineno"></span><span class="op" id="3294965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3294968">//&nbsp;ensurePipelineContains&nbsp;ensures&nbsp;that&nbsp;the&nbsp;pipeline&nbsp;has&nbsp;commands&nbsp;with</span><br>
<span class="lineno">220</span><span class="comment" id="3295038">//&nbsp;the&nbsp;identifiers&nbsp;in&nbsp;s&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3295072">//&nbsp;If&nbsp;the&nbsp;pipeline&nbsp;already&nbsp;has&nbsp;some&nbsp;of&nbsp;the&nbsp;sanitizers,&nbsp;do&nbsp;not&nbsp;interfere.</span><br>
<span class="lineno"></span><span class="comment" id="3295145">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;p&nbsp;is&nbsp;(.X&nbsp;|&nbsp;html)&nbsp;and&nbsp;s&nbsp;is&nbsp;[&#34;escapeJSVal&#34;,&nbsp;&#34;html&#34;]&nbsp;then&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3295222">//&nbsp;has&nbsp;one&nbsp;matching,&nbsp;&#34;html&#34;,&nbsp;and&nbsp;one&nbsp;to&nbsp;insert,&nbsp;&#34;escapeJSVal&#34;,&nbsp;to&nbsp;produce</span><br>
<span class="lineno"></span><span class="comment" id="3295296">//&nbsp;(.X&nbsp;|&nbsp;escapeJSVal&nbsp;|&nbsp;html).</span><br>
<span class="lineno">225</span><span class="keyword" id="3295326">func</span>&nbsp;<span class="ident" id="3295331">ensurePipelineContains</span><span class="op" id="3295353">(</span><span class="ident" id="3295354">p</span>&nbsp;<span class="op" id="3295356">*</span><span class="ident" id="3295357"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3295362">.</span><span class="ident" id="3295363">PipeNode</span><span class="op" id="3295371">,</span>&nbsp;<span class="ident" id="3295373">s</span>&nbsp;<span class="op" id="3295375">[</span><span class="op" id="3295376">]</span><span class="builtintype" id="3295377">string</span><span class="op" id="3295383">)</span>&nbsp;<span class="op" id="3295385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295388">if</span>&nbsp;<span class="builtinfunc" id="3295391">len</span><span class="op" id="3295394">(</span><span class="ident" id="3295395"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3295396">)</span>&nbsp;<span class="op" id="3295398">==</span>&nbsp;<span class="num" id="3295401">0</span>&nbsp;<span class="op" id="3295403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295407">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295418">n</span>&nbsp;<span class="op" id="3295420">:=</span>&nbsp;<span class="builtinfunc" id="3295423">len</span><span class="op" id="3295426">(</span><span class="ident" id="3295427"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3295428">.</span><span class="ident" id="3295429">Cmds</span><span class="op" id="3295433">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3295436">//&nbsp;Find&nbsp;the&nbsp;identifiers&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;command&nbsp;chain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295494">idents</span>&nbsp;<span class="op" id="3295501">:=</span>&nbsp;<span class="ident" id="3295504"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3295505">.</span><span class="ident" id="3295506">Cmds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295512">for</span>&nbsp;<span class="ident" id="3295516">i</span>&nbsp;<span class="op" id="3295518">:=</span>&nbsp;<span class="ident" id="3295521"><a href="/html/template/escape.go.html#3295418">n</a></span>&nbsp;<span class="op" id="3295523">-</span>&nbsp;<span class="num" id="3295525">1</span><span class="op" id="3295526">;</span>&nbsp;<span class="ident" id="3295528"><a href="/html/template/escape.go.html#3295516">i</a></span>&nbsp;<span class="op" id="3295530">&gt;=</span>&nbsp;<span class="num" id="3295533">0</span><span class="op" id="3295534">;</span>&nbsp;<span class="ident" id="3295536"><a href="/html/template/escape.go.html#3295516">i</a></span><span class="op" id="3295537">--</span>&nbsp;<span class="op" id="3295540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295544">if</span>&nbsp;<span class="ident" id="3295547">cmd</span>&nbsp;<span class="op" id="3295551">:=</span>&nbsp;<span class="ident" id="3295554"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3295555">.</span><span class="ident" id="3295556">Cmds</span><span class="op" id="3295560">[</span><span class="ident" id="3295561"><a href="/html/template/escape.go.html#3295516">i</a></span><span class="op" id="3295562">]</span><span class="op" id="3295563">;</span>&nbsp;<span class="builtinfunc" id="3295565">len</span><span class="op" id="3295568">(</span><span class="ident" id="3295569"><a href="/html/template/escape.go.html#3295547">cmd</a></span><span class="op" id="3295572">.</span><span class="ident" id="3295573">Args</span><span class="op" id="3295577">)</span>&nbsp;<span class="op" id="3295579">!=</span>&nbsp;<span class="num" id="3295582">0</span>&nbsp;<span class="op" id="3295584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295589">if</span>&nbsp;<span class="ident" id="3295592">_</span><span class="op" id="3295593">,</span>&nbsp;<span class="ident" id="3295595">ok</span>&nbsp;<span class="op" id="3295598">:=</span>&nbsp;<span class="ident" id="3295601"><a href="/html/template/escape.go.html#3295547">cmd</a></span><span class="op" id="3295604">.</span><span class="ident" id="3295605">Args</span><span class="op" id="3295609">[</span><span class="num" id="3295610">0</span><span class="op" id="3295611">]</span><span class="op" id="3295612">.</span><span class="op" id="3295613">(</span><span class="op" id="3295614">*</span><span class="ident" id="3295615"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3295620">.</span><span class="ident" id="3295621">IdentifierNode</span><span class="op" id="3295635">)</span><span class="op" id="3295636">;</span>&nbsp;<span class="ident" id="3295638"><a href="/html/template/escape.go.html#3295595">ok</a></span>&nbsp;<span class="op" id="3295641">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295647">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295667"><a href="/html/template/escape.go.html#3295494">idents</a></span>&nbsp;<span class="op" id="3295674">=</span>&nbsp;<span class="ident" id="3295676"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3295677">.</span><span class="ident" id="3295678">Cmds</span><span class="op" id="3295682">[</span><span class="ident" id="3295683"><a href="/html/template/escape.go.html#3295516">i</a></span><span class="op" id="3295684">+</span><span class="num" id="3295685">1</span><span class="op" id="3295686">:</span><span class="op" id="3295687">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295690">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295693">dups</span>&nbsp;<span class="op" id="3295698">:=</span>&nbsp;<span class="num" id="3295701">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295704">for</span>&nbsp;<span class="ident" id="3295708">_</span><span class="op" id="3295709">,</span>&nbsp;<span class="ident" id="3295711">idNode</span>&nbsp;<span class="op" id="3295718">:=</span>&nbsp;<span class="keyword" id="3295721">range</span>&nbsp;<span class="ident" id="3295727"><a href="/html/template/escape.go.html#3295494">idents</a></span>&nbsp;<span class="op" id="3295734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295738">for</span>&nbsp;<span class="ident" id="3295742">_</span><span class="op" id="3295743">,</span>&nbsp;<span class="ident" id="3295745">ident</span>&nbsp;<span class="op" id="3295751">:=</span>&nbsp;<span class="keyword" id="3295754">range</span>&nbsp;<span class="ident" id="3295760"><a href="/html/template/escape.go.html#3294745">allIdents</a></span><span class="op" id="3295769">(</span><span class="ident" id="3295770"><a href="/html/template/escape.go.html#3295711">idNode</a></span><span class="op" id="3295776">.</span><span class="ident" id="3295777">Args</span><span class="op" id="3295781">[</span><span class="num" id="3295782">0</span><span class="op" id="3295783">]</span><span class="op" id="3295784">)</span>&nbsp;<span class="op" id="3295786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295791">if</span>&nbsp;<span class="ident" id="3295794"><a href="/html/template/escape.go.html#3297891">escFnsEq</a></span><span class="op" id="3295802">(</span><span class="ident" id="3295803"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3295804">[</span><span class="ident" id="3295805"><a href="/html/template/escape.go.html#3295693">dups</a></span><span class="op" id="3295809">]</span><span class="op" id="3295810">,</span>&nbsp;<span class="ident" id="3295812"><a href="/html/template/escape.go.html#3295745">ident</a></span><span class="op" id="3295817">)</span>&nbsp;<span class="op" id="3295819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295825"><a href="/html/template/escape.go.html#3295693">dups</a></span><span class="op" id="3295829">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295836">if</span>&nbsp;<span class="ident" id="3295839"><a href="/html/template/escape.go.html#3295693">dups</a></span>&nbsp;<span class="op" id="3295844">==</span>&nbsp;<span class="builtinfunc" id="3295847">len</span><span class="op" id="3295850">(</span><span class="ident" id="3295851"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3295852">)</span>&nbsp;<span class="op" id="3295854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295861">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295881">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295887">newCmds</span>&nbsp;<span class="op" id="3295895">:=</span>&nbsp;<span class="builtinfunc" id="3295898">make</span><span class="op" id="3295902">(</span><span class="op" id="3295903">[</span><span class="op" id="3295904">]</span><span class="op" id="3295905">*</span><span class="ident" id="3295906"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3295911">.</span><span class="ident" id="3295912">CommandNode</span><span class="op" id="3295923">,</span>&nbsp;<span class="ident" id="3295925"><a href="/html/template/escape.go.html#3295418">n</a></span><span class="op" id="3295926">-</span><span class="builtinfunc" id="3295927">len</span><span class="op" id="3295930">(</span><span class="ident" id="3295931"><a href="/html/template/escape.go.html#3295494">idents</a></span><span class="op" id="3295937">)</span><span class="op" id="3295938">,</span>&nbsp;<span class="ident" id="3295940"><a href="/html/template/escape.go.html#3295418">n</a></span><span class="op" id="3295941">+</span><span class="builtinfunc" id="3295942">len</span><span class="op" id="3295945">(</span><span class="ident" id="3295946"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3295947">)</span><span class="op" id="3295948">-</span><span class="ident" id="3295949"><a href="/html/template/escape.go.html#3295693">dups</a></span><span class="op" id="3295953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3295956">copy</span><span class="op" id="3295960">(</span><span class="ident" id="3295961"><a href="/html/template/escape.go.html#3295887">newCmds</a></span><span class="op" id="3295968">,</span>&nbsp;<span class="ident" id="3295970"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3295971">.</span><span class="ident" id="3295972">Cmds</span><span class="op" id="3295976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3295979">//&nbsp;Merge&nbsp;existing&nbsp;identifier&nbsp;commands&nbsp;with&nbsp;the&nbsp;sanitizers&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296046">for</span>&nbsp;<span class="ident" id="3296050">_</span><span class="op" id="3296051">,</span>&nbsp;<span class="ident" id="3296053">idNode</span>&nbsp;<span class="op" id="3296060">:=</span>&nbsp;<span class="keyword" id="3296063">range</span>&nbsp;<span class="ident" id="3296069"><a href="/html/template/escape.go.html#3295494">idents</a></span>&nbsp;<span class="op" id="3296076">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296080">pos</span>&nbsp;<span class="op" id="3296084">:=</span>&nbsp;<span class="ident" id="3296087"><a href="/html/template/escape.go.html#3296053">idNode</a></span><span class="op" id="3296093">.</span><span class="ident" id="3296094">Args</span><span class="op" id="3296098">[</span><span class="num" id="3296099">0</span><span class="op" id="3296100">]</span><span class="op" id="3296101">.</span><span class="ident" id="3296102">Position</span><span class="op" id="3296110">(</span><span class="op" id="3296111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296115">for</span>&nbsp;<span class="ident" id="3296119">_</span><span class="op" id="3296120">,</span>&nbsp;<span class="ident" id="3296122">ident</span>&nbsp;<span class="op" id="3296128">:=</span>&nbsp;<span class="keyword" id="3296131">range</span>&nbsp;<span class="ident" id="3296137"><a href="/html/template/escape.go.html#3294745">allIdents</a></span><span class="op" id="3296146">(</span><span class="ident" id="3296147"><a href="/html/template/escape.go.html#3296053">idNode</a></span><span class="op" id="3296153">.</span><span class="ident" id="3296154">Args</span><span class="op" id="3296158">[</span><span class="num" id="3296159">0</span><span class="op" id="3296160">]</span><span class="op" id="3296161">)</span>&nbsp;<span class="op" id="3296163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296168">i</span>&nbsp;<span class="op" id="3296170">:=</span>&nbsp;<span class="ident" id="3296173"><a href="/html/template/escape.go.html#3297671">indexOfStr</a></span><span class="op" id="3296183">(</span><span class="ident" id="3296184"><a href="/html/template/escape.go.html#3296122">ident</a></span><span class="op" id="3296189">,</span>&nbsp;<span class="ident" id="3296191"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3296192">,</span>&nbsp;<span class="ident" id="3296194"><a href="/html/template/escape.go.html#3297891">escFnsEq</a></span><span class="op" id="3296202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296207">if</span>&nbsp;<span class="ident" id="3296210"><a href="/html/template/escape.go.html#3296168">i</a></span>&nbsp;<span class="op" id="3296212">!=</span>&nbsp;<span class="op" id="3296215">-</span><span class="num" id="3296216">1</span>&nbsp;<span class="op" id="3296218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296224">for</span>&nbsp;<span class="ident" id="3296228">_</span><span class="op" id="3296229">,</span>&nbsp;<span class="ident" id="3296231">name</span>&nbsp;<span class="op" id="3296236">:=</span>&nbsp;<span class="keyword" id="3296239">range</span>&nbsp;<span class="ident" id="3296245"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3296246">[</span><span class="op" id="3296247">:</span><span class="ident" id="3296248"><a href="/html/template/escape.go.html#3296168">i</a></span><span class="op" id="3296249">]</span>&nbsp;<span class="op" id="3296251">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296258"><a href="/html/template/escape.go.html#3295887">newCmds</a></span>&nbsp;<span class="op" id="3296266">=</span>&nbsp;<span class="ident" id="3296268"><a href="/html/template/escape.go.html#3297265">appendCmd</a></span><span class="op" id="3296277">(</span><span class="ident" id="3296278"><a href="/html/template/escape.go.html#3295887">newCmds</a></span><span class="op" id="3296285">,</span>&nbsp;<span class="ident" id="3296287"><a href="/html/template/escape.go.html#3298110">newIdentCmd</a></span><span class="op" id="3296298">(</span><span class="ident" id="3296299"><a href="/html/template/escape.go.html#3296231">name</a></span><span class="op" id="3296303">,</span>&nbsp;<span class="ident" id="3296305"><a href="/html/template/escape.go.html#3296080">pos</a></span><span class="op" id="3296308">)</span><span class="op" id="3296309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296321"><a href="/html/template/escape.go.html#3295373">s</a></span>&nbsp;<span class="op" id="3296323">=</span>&nbsp;<span class="ident" id="3296325"><a href="/html/template/escape.go.html#3295373">s</a></span><span class="op" id="3296326">[</span><span class="ident" id="3296327"><a href="/html/template/escape.go.html#3296168">i</a></span><span class="op" id="3296328">+</span><span class="num" id="3296329">1</span><span class="op" id="3296330">:</span><span class="op" id="3296331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296340">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296344"><a href="/html/template/escape.go.html#3295887">newCmds</a></span>&nbsp;<span class="op" id="3296352">=</span>&nbsp;<span class="ident" id="3296354"><a href="/html/template/escape.go.html#3297265">appendCmd</a></span><span class="op" id="3296363">(</span><span class="ident" id="3296364"><a href="/html/template/escape.go.html#3295887">newCmds</a></span><span class="op" id="3296371">,</span>&nbsp;<span class="ident" id="3296373"><a href="/html/template/escape.go.html#3296053">idNode</a></span><span class="op" id="3296379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3296385">//&nbsp;Create&nbsp;any&nbsp;remaining&nbsp;sanitizers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296422">for</span>&nbsp;<span class="ident" id="3296426">_</span><span class="op" id="3296427">,</span>&nbsp;<span class="ident" id="3296429">name</span>&nbsp;<span class="op" id="3296434">:=</span>&nbsp;<span class="keyword" id="3296437">range</span>&nbsp;<span class="ident" id="3296443"><a href="/html/template/escape.go.html#3295373">s</a></span>&nbsp;<span class="op" id="3296445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296449"><a href="/html/template/escape.go.html#3295887">newCmds</a></span>&nbsp;<span class="op" id="3296457">=</span>&nbsp;<span class="ident" id="3296459"><a href="/html/template/escape.go.html#3297265">appendCmd</a></span><span class="op" id="3296468">(</span><span class="ident" id="3296469"><a href="/html/template/escape.go.html#3295887">newCmds</a></span><span class="op" id="3296476">,</span>&nbsp;<span class="ident" id="3296478"><a href="/html/template/escape.go.html#3298110">newIdentCmd</a></span><span class="op" id="3296489">(</span><span class="ident" id="3296490"><a href="/html/template/escape.go.html#3296429">name</a></span><span class="op" id="3296494">,</span>&nbsp;<span class="ident" id="3296496"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3296497">.</span><span class="ident" id="3296498">Position</span><span class="op" id="3296506">(</span><span class="op" id="3296507">)</span><span class="op" id="3296508">)</span><span class="op" id="3296509">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296515"><a href="/html/template/escape.go.html#3295354">p</a></span><span class="op" id="3296516">.</span><span class="ident" id="3296517">Cmds</span>&nbsp;<span class="op" id="3296522">=</span>&nbsp;<span class="ident" id="3296524"><a href="/html/template/escape.go.html#3295887">newCmds</a></span><br>
<span class="lineno"></span><span class="op" id="3296532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3296535">//&nbsp;redundantFuncs[a][b]&nbsp;implies&nbsp;that&nbsp;funcMap[b](funcMap[a](x))&nbsp;==&nbsp;funcMap[a](x)</span><br>
<span class="lineno">275</span><span class="comment" id="3296615">//&nbsp;for&nbsp;all&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3296629">var</span>&nbsp;<span class="ident" id="3296633">redundantFuncs</span>&nbsp;<span class="op" id="3296648">=</span>&nbsp;<span class="keyword" id="3296650">map</span><span class="op" id="3296653">[</span><span class="builtintype" id="3296654">string</span><span class="op" id="3296660">]</span><span class="keyword" id="3296661">map</span><span class="op" id="3296664">[</span><span class="builtintype" id="3296665">string</span><span class="op" id="3296671">]</span><span class="builtintype" id="3296672">bool</span><span class="op" id="3296676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296679">&#34;html_template_commentescaper&#34;</span><span class="op" id="3296709">:</span>&nbsp;<span class="op" id="3296711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296715">&#34;html_template_attrescaper&#34;</span><span class="op" id="3296742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296747">true</span><span class="op" id="3296751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296755">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="3296785">:</span>&nbsp;<span class="ident" id="3296787">true</span><span class="op" id="3296791">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296795">&#34;html_template_htmlescaper&#34;</span><span class="op" id="3296822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296827">true</span><span class="op" id="3296831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296834">}</span><span class="op" id="3296835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296838">&#34;html_template_cssescaper&#34;</span><span class="op" id="3296864">:</span>&nbsp;<span class="op" id="3296866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296870">&#34;html_template_attrescaper&#34;</span><span class="op" id="3296897">:</span>&nbsp;<span class="ident" id="3296899">true</span><span class="op" id="3296903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296906">}</span><span class="op" id="3296907">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296910">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="3296941">:</span>&nbsp;<span class="op" id="3296943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296947">&#34;html_template_attrescaper&#34;</span><span class="op" id="3296974">:</span>&nbsp;<span class="ident" id="3296976">true</span><span class="op" id="3296980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296983">}</span><span class="op" id="3296984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3296987">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="3297015">:</span>&nbsp;<span class="op" id="3297017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3297021">&#34;html_template_attrescaper&#34;</span><span class="op" id="3297048">:</span>&nbsp;<span class="ident" id="3297050">true</span><span class="op" id="3297054">,</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297057">}</span><span class="op" id="3297058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3297061">&#34;html_template_urlescaper&#34;</span><span class="op" id="3297087">:</span>&nbsp;<span class="op" id="3297089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3297093">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="3297122">:</span>&nbsp;<span class="ident" id="3297124">true</span><span class="op" id="3297128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297131">}</span><span class="op" id="3297132">,</span><br>
<span class="lineno"></span><span class="op" id="3297134">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="3297137">//&nbsp;appendCmd&nbsp;appends&nbsp;the&nbsp;given&nbsp;command&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;command&nbsp;pipeline</span><br>
<span class="lineno"></span><span class="comment" id="3297211">//&nbsp;unless&nbsp;it&nbsp;is&nbsp;redundant&nbsp;with&nbsp;the&nbsp;last&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="3297260">func</span>&nbsp;<span class="ident" id="3297265">appendCmd</span><span class="op" id="3297274">(</span><span class="ident" id="3297275">cmds</span>&nbsp;<span class="op" id="3297280">[</span><span class="op" id="3297281">]</span><span class="op" id="3297282">*</span><span class="ident" id="3297283"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3297288">.</span><span class="ident" id="3297289">CommandNode</span><span class="op" id="3297300">,</span>&nbsp;<span class="ident" id="3297302">cmd</span>&nbsp;<span class="op" id="3297306">*</span><span class="ident" id="3297307"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3297312">.</span><span class="ident" id="3297313">CommandNode</span><span class="op" id="3297324">)</span>&nbsp;<span class="op" id="3297326">[</span><span class="op" id="3297327">]</span><span class="op" id="3297328">*</span><span class="ident" id="3297329"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3297334">.</span><span class="ident" id="3297335">CommandNode</span>&nbsp;<span class="op" id="3297347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297350">if</span>&nbsp;<span class="ident" id="3297353">n</span>&nbsp;<span class="op" id="3297355">:=</span>&nbsp;<span class="builtinfunc" id="3297358">len</span><span class="op" id="3297361">(</span><span class="ident" id="3297362"><a href="/html/template/escape.go.html#3297275">cmds</a></span><span class="op" id="3297366">)</span><span class="op" id="3297367">;</span>&nbsp;<span class="ident" id="3297369"><a href="/html/template/escape.go.html#3297353">n</a></span>&nbsp;<span class="op" id="3297371">!=</span>&nbsp;<span class="num" id="3297374">0</span>&nbsp;<span class="op" id="3297376">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3297380">last</span><span class="op" id="3297384">,</span>&nbsp;<span class="ident" id="3297386">ok</span>&nbsp;<span class="op" id="3297389">:=</span>&nbsp;<span class="ident" id="3297392"><a href="/html/template/escape.go.html#3297275">cmds</a></span><span class="op" id="3297396">[</span><span class="ident" id="3297397"><a href="/html/template/escape.go.html#3297353">n</a></span><span class="op" id="3297398">-</span><span class="num" id="3297399">1</span><span class="op" id="3297400">]</span><span class="op" id="3297401">.</span><span class="ident" id="3297402">Args</span><span class="op" id="3297406">[</span><span class="num" id="3297407">0</span><span class="op" id="3297408">]</span><span class="op" id="3297409">.</span><span class="op" id="3297410">(</span><span class="op" id="3297411">*</span><span class="ident" id="3297412"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3297417">.</span><span class="ident" id="3297418">IdentifierNode</span><span class="op" id="3297432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3297436">next</span><span class="op" id="3297440">,</span>&nbsp;<span class="ident" id="3297442">_</span>&nbsp;<span class="op" id="3297444">:=</span>&nbsp;<span class="ident" id="3297447"><a href="/html/template/escape.go.html#3297302">cmd</a></span><span class="op" id="3297450">.</span><span class="ident" id="3297451">Args</span><span class="op" id="3297455">[</span><span class="num" id="3297456">0</span><span class="op" id="3297457">]</span><span class="op" id="3297458">.</span><span class="op" id="3297459">(</span><span class="op" id="3297460">*</span><span class="ident" id="3297461"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3297466">.</span><span class="ident" id="3297467">IdentifierNode</span><span class="op" id="3297481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297485">if</span>&nbsp;<span class="ident" id="3297488"><a href="/html/template/escape.go.html#3297386">ok</a></span>&nbsp;<span class="op" id="3297491">&amp;&amp;</span>&nbsp;<span class="ident" id="3297494"><a href="/html/template/escape.go.html#3296633">redundantFuncs</a></span><span class="op" id="3297508">[</span><span class="ident" id="3297509"><a href="/html/template/escape.go.html#3297380">last</a></span><span class="op" id="3297513">.</span><span class="ident" id="3297514">Ident</span><span class="op" id="3297519">]</span><span class="op" id="3297520">[</span><span class="ident" id="3297521"><a href="/html/template/escape.go.html#3297436">next</a></span><span class="op" id="3297525">.</span><span class="ident" id="3297526">Ident</span><span class="op" id="3297531">]</span>&nbsp;<span class="op" id="3297533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297538">return</span>&nbsp;<span class="ident" id="3297545"><a href="/html/template/escape.go.html#3297275">cmds</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297552">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297558">return</span>&nbsp;<span class="builtinfunc" id="3297565">append</span><span class="op" id="3297571">(</span><span class="ident" id="3297572"><a href="/html/template/escape.go.html#3297275">cmds</a></span><span class="op" id="3297576">,</span>&nbsp;<span class="ident" id="3297578"><a href="/html/template/escape.go.html#3297302">cmd</a></span><span class="op" id="3297581">)</span><br>
<span class="lineno"></span><span class="op" id="3297583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3297586">//&nbsp;indexOfStr&nbsp;is&nbsp;the&nbsp;first&nbsp;i&nbsp;such&nbsp;that&nbsp;eq(s,&nbsp;strs[i])&nbsp;or&nbsp;-1&nbsp;if&nbsp;s&nbsp;was&nbsp;not&nbsp;found.</span><br>
<span class="lineno">310</span><span class="keyword" id="3297666">func</span>&nbsp;<span class="ident" id="3297671">indexOfStr</span><span class="op" id="3297681">(</span><span class="ident" id="3297682">s</span>&nbsp;<span class="builtintype" id="3297684">string</span><span class="op" id="3297690">,</span>&nbsp;<span class="ident" id="3297692">strs</span>&nbsp;<span class="op" id="3297697">[</span><span class="op" id="3297698">]</span><span class="builtintype" id="3297699">string</span><span class="op" id="3297705">,</span>&nbsp;<span class="ident" id="3297707">eq</span>&nbsp;<span class="keyword" id="3297710">func</span><span class="op" id="3297714">(</span><span class="ident" id="3297715">a</span><span class="op" id="3297716">,</span>&nbsp;<span class="ident" id="3297718">b</span>&nbsp;<span class="builtintype" id="3297720">string</span><span class="op" id="3297726">)</span>&nbsp;<span class="builtintype" id="3297728">bool</span><span class="op" id="3297732">)</span>&nbsp;<span class="builtintype" id="3297734">int</span>&nbsp;<span class="op" id="3297738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297741">for</span>&nbsp;<span class="ident" id="3297745">i</span><span class="op" id="3297746">,</span>&nbsp;<span class="ident" id="3297748">t</span>&nbsp;<span class="op" id="3297750">:=</span>&nbsp;<span class="keyword" id="3297753">range</span>&nbsp;<span class="ident" id="3297759"><a href="/html/template/escape.go.html#3297692">strs</a></span>&nbsp;<span class="op" id="3297764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297768">if</span>&nbsp;<span class="ident" id="3297771"><a href="/html/template/escape.go.html#3297707">eq</a></span><span class="op" id="3297773">(</span><span class="ident" id="3297774"><a href="/html/template/escape.go.html#3297682">s</a></span><span class="op" id="3297775">,</span>&nbsp;<span class="ident" id="3297777"><a href="/html/template/escape.go.html#3297748">t</a></span><span class="op" id="3297778">)</span>&nbsp;<span class="op" id="3297780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297785">return</span>&nbsp;<span class="ident" id="3297792"><a href="/html/template/escape.go.html#3297745">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297796">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297802">return</span>&nbsp;<span class="op" id="3297809">-</span><span class="num" id="3297810">1</span><br>
<span class="lineno"></span><span class="op" id="3297812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3297815">//&nbsp;escFnsEq&nbsp;reports&nbsp;whether&nbsp;the&nbsp;two&nbsp;escaping&nbsp;functions&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno">320</span><span class="keyword" id="3297886">func</span>&nbsp;<span class="ident" id="3297891">escFnsEq</span><span class="op" id="3297899">(</span><span class="ident" id="3297900">a</span><span class="op" id="3297901">,</span>&nbsp;<span class="ident" id="3297903">b</span>&nbsp;<span class="builtintype" id="3297905">string</span><span class="op" id="3297911">)</span>&nbsp;<span class="builtintype" id="3297913">bool</span>&nbsp;<span class="op" id="3297918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297921">if</span>&nbsp;<span class="ident" id="3297924">e</span>&nbsp;<span class="op" id="3297926">:=</span>&nbsp;<span class="ident" id="3297929"><a href="/html/template/escape.go.html#3290099">equivEscapers</a></span><span class="op" id="3297942">[</span><span class="ident" id="3297943"><a href="/html/template/escape.go.html#3297900">a</a></span><span class="op" id="3297944">]</span><span class="op" id="3297945">;</span>&nbsp;<span class="ident" id="3297947"><a href="/html/template/escape.go.html#3297924">e</a></span>&nbsp;<span class="op" id="3297949">!=</span>&nbsp;<span class="string" id="3297952">&#34;&#34;</span>&nbsp;<span class="op" id="3297955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3297959"><a href="/html/template/escape.go.html#3297900">a</a></span>&nbsp;<span class="op" id="3297961">=</span>&nbsp;<span class="ident" id="3297963"><a href="/html/template/escape.go.html#3297924">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297969">if</span>&nbsp;<span class="ident" id="3297972">e</span>&nbsp;<span class="op" id="3297974">:=</span>&nbsp;<span class="ident" id="3297977"><a href="/html/template/escape.go.html#3290099">equivEscapers</a></span><span class="op" id="3297990">[</span><span class="ident" id="3297991"><a href="/html/template/escape.go.html#3297903">b</a></span><span class="op" id="3297992">]</span><span class="op" id="3297993">;</span>&nbsp;<span class="ident" id="3297995"><a href="/html/template/escape.go.html#3297972">e</a></span>&nbsp;<span class="op" id="3297997">!=</span>&nbsp;<span class="string" id="3298000">&#34;&#34;</span>&nbsp;<span class="op" id="3298003">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3298007"><a href="/html/template/escape.go.html#3297903">b</a></span>&nbsp;<span class="op" id="3298009">=</span>&nbsp;<span class="ident" id="3298011"><a href="/html/template/escape.go.html#3297972">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3298014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3298017">return</span>&nbsp;<span class="ident" id="3298024"><a href="/html/template/escape.go.html#3297900">a</a></span>&nbsp;<span class="op" id="3298026">==</span>&nbsp;<span class="ident" id="3298029"><a href="/html/template/escape.go.html#3297903">b</a></span><br>
<span class="lineno"></span><span class="op" id="3298031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="comment" id="3298034">//&nbsp;newIdentCmd&nbsp;produces&nbsp;a&nbsp;command&nbsp;containing&nbsp;a&nbsp;single&nbsp;identifier&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3298105">func</span>&nbsp;<span class="ident" id="3298110">newIdentCmd</span><span class="op" id="3298121">(</span><span class="ident" id="3298122">identifier</span>&nbsp;<span class="builtintype" id="3298133">string</span><span class="op" id="3298139">,</span>&nbsp;<span class="ident" id="3298141">pos</span>&nbsp;<span class="ident" id="3298145"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3298150">.</span><span class="ident" id="3298151">Pos</span><span class="op" id="3298154">)</span>&nbsp;<span class="op" id="3298156">*</span><span class="ident" id="3298157"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3298162">.</span><span class="ident" id="3298163">CommandNode</span>&nbsp;<span class="op" id="3298175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3298178">return</span>&nbsp;<span class="op" id="3298185">&amp;</span><span class="ident" id="3298186"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3298191">.</span><span class="ident" id="3298192">CommandNode</span><span class="op" id="3298203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3298207">NodeType</span><span class="op" id="3298215">:</span>&nbsp;<span class="ident" id="3298217"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3298222">.</span><span class="ident" id="3298223">NodeCommand</span><span class="op" id="3298234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3298238">Args</span><span class="op" id="3298242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298248">[</span><span class="op" id="3298249">]</span><span class="ident" id="3298250"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3298255">.</span><span class="ident" id="3298256">Node</span><span class="op" id="3298260">{</span><span class="ident" id="3298261"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3298266">.</span><span class="ident" id="3298267">NewIdentifier</span><span class="op" id="3298280">(</span><span class="ident" id="3298281"><a href="/html/template/escape.go.html#3298122">identifier</a></span><span class="op" id="3298291">)</span><span class="op" id="3298292">.</span><span class="ident" id="3298293">SetTree</span><span class="op" id="3298300">(</span><span class="ident" id="3298301">nil</span><span class="op" id="3298304">)</span><span class="op" id="3298305">.</span><span class="ident" id="3298306">SetPos</span><span class="op" id="3298312">(</span><span class="ident" id="3298313"><a href="/html/template/escape.go.html#3298141">pos</a></span><span class="op" id="3298316">)</span><span class="op" id="3298317">}</span><span class="op" id="3298318">,</span>&nbsp;<span class="comment" id="3298320">//&nbsp;TODO:&nbsp;SetTree.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3298339">}</span><br>
<span class="lineno"></span><span class="op" id="3298341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3298344">//&nbsp;nudge&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;would&nbsp;result&nbsp;from&nbsp;following&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="3298419">//&nbsp;transitions&nbsp;from&nbsp;the&nbsp;input&nbsp;context.</span><br>
<span class="lineno">340</span><span class="comment" id="3298458">//&nbsp;For&nbsp;example,&nbsp;parsing:</span><br>
<span class="lineno"></span><span class="comment" id="3298483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`&lt;a&nbsp;href=`</span><br>
<span class="lineno"></span><span class="comment" id="3298501">//&nbsp;will&nbsp;end&nbsp;in&nbsp;context{stateBeforeValue,&nbsp;attrURL},&nbsp;but&nbsp;parsing&nbsp;one&nbsp;extra&nbsp;rune:</span><br>
<span class="lineno"></span><span class="comment" id="3298580">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`&lt;a&nbsp;href=x`</span><br>
<span class="lineno"></span><span class="comment" id="3298599">//&nbsp;will&nbsp;end&nbsp;in&nbsp;context{stateURL,&nbsp;delimSpaceOrTagEnd,&nbsp;...}.</span><br>
<span class="lineno">345</span><span class="comment" id="3298658">//&nbsp;There&nbsp;are&nbsp;two&nbsp;transitions&nbsp;that&nbsp;happen&nbsp;when&nbsp;the&nbsp;&#39;x&#39;&nbsp;is&nbsp;seen:</span><br>
<span class="lineno"></span><span class="comment" id="3298721">//&nbsp;(1)&nbsp;Transition&nbsp;from&nbsp;a&nbsp;before-value&nbsp;state&nbsp;to&nbsp;a&nbsp;start-of-value&nbsp;state&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="3298799">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consuming&nbsp;any&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3298831">//&nbsp;(2)&nbsp;Consume&nbsp;&#39;x&#39;&nbsp;and&nbsp;transition&nbsp;past&nbsp;the&nbsp;first&nbsp;value&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3298897">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;nudging&nbsp;produces&nbsp;the&nbsp;context&nbsp;after&nbsp;(1)&nbsp;happens.</span><br>
<span class="lineno">350</span><span class="keyword" id="3298962">func</span>&nbsp;<span class="ident" id="3298967">nudge</span><span class="op" id="3298972">(</span><span class="ident" id="3298973">c</span>&nbsp;<span class="ident" id="3298975"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3298982">)</span>&nbsp;<span class="ident" id="3298984"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3298992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3298995">switch</span>&nbsp;<span class="ident" id="3299002"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299003">.</span><span class="ident" id="3299004">state</span>&nbsp;<span class="op" id="3299010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299013">case</span>&nbsp;<span class="ident" id="3299018"><a href="/html/template/context.go.html#3259302">stateTag</a></span><span class="op" id="3299026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3299030">//&nbsp;In&nbsp;`&lt;foo&nbsp;{{.}}`,&nbsp;the&nbsp;action&nbsp;should&nbsp;emit&nbsp;an&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299089"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299090">.</span><span class="ident" id="3299091">state</span>&nbsp;<span class="op" id="3299097">=</span>&nbsp;<span class="ident" id="3299099"><a href="/html/template/context.go.html#3259415">stateAttrName</a></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299114">case</span>&nbsp;<span class="ident" id="3299119"><a href="/html/template/context.go.html#3259705">stateBeforeValue</a></span><span class="op" id="3299135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3299139">//&nbsp;In&nbsp;`&lt;foo&nbsp;bar={{.}}`,&nbsp;the&nbsp;action&nbsp;is&nbsp;an&nbsp;undelimited&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299201"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299202">.</span><span class="ident" id="3299203">state</span><span class="op" id="3299208">,</span>&nbsp;<span class="ident" id="3299210"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299211">.</span><span class="ident" id="3299212">delim</span><span class="op" id="3299217">,</span>&nbsp;<span class="ident" id="3299219"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299220">.</span><span class="ident" id="3299221">attr</span>&nbsp;<span class="op" id="3299226">=</span>&nbsp;<span class="ident" id="3299228"><a href="/html/template/transition.go.html#3346885">attrStartStates</a></span><span class="op" id="3299243">[</span><span class="ident" id="3299244"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299245">.</span><span class="ident" id="3299246">attr</span><span class="op" id="3299250">]</span><span class="op" id="3299251">,</span>&nbsp;<span class="ident" id="3299253"><a href="/html/template/context.go.html#3263252">delimSpaceOrTagEnd</a></span><span class="op" id="3299271">,</span>&nbsp;<span class="ident" id="3299273"><a href="/html/template/context.go.html#3266506">attrNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299283">case</span>&nbsp;<span class="ident" id="3299288"><a href="/html/template/context.go.html#3259565">stateAfterName</a></span><span class="op" id="3299302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3299306">//&nbsp;In&nbsp;`&lt;foo&nbsp;bar&nbsp;{{.}}`,&nbsp;the&nbsp;action&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299365"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299366">.</span><span class="ident" id="3299367">state</span><span class="op" id="3299372">,</span>&nbsp;<span class="ident" id="3299374"><a href="/html/template/escape.go.html#3298973">c</a></span><span class="op" id="3299375">.</span><span class="ident" id="3299376">attr</span>&nbsp;<span class="op" id="3299381">=</span>&nbsp;<span class="ident" id="3299383"><a href="/html/template/context.go.html#3259415">stateAttrName</a></span><span class="op" id="3299396">,</span>&nbsp;<span class="ident" id="3299398"><a href="/html/template/context.go.html#3266506">attrNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299411">return</span>&nbsp;<span class="ident" id="3299418"><a href="/html/template/escape.go.html#3298973">c</a></span><br>
<span class="lineno"></span><span class="op" id="3299420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3299423">//&nbsp;join&nbsp;joins&nbsp;the&nbsp;two&nbsp;contexts&nbsp;of&nbsp;a&nbsp;branch&nbsp;template&nbsp;node.&nbsp;The&nbsp;result&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3299498">//&nbsp;error&nbsp;context&nbsp;if&nbsp;either&nbsp;of&nbsp;the&nbsp;input&nbsp;contexts&nbsp;are&nbsp;error&nbsp;contexts,&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3299577">//&nbsp;the&nbsp;input&nbsp;contexts&nbsp;differ.</span><br>
<span class="lineno"></span><span class="keyword" id="3299607">func</span>&nbsp;<span class="ident" id="3299612">join</span><span class="op" id="3299616">(</span><span class="ident" id="3299617">a</span><span class="op" id="3299618">,</span>&nbsp;<span class="ident" id="3299620">b</span>&nbsp;<span class="ident" id="3299622"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3299629">,</span>&nbsp;<span class="ident" id="3299631">node</span>&nbsp;<span class="ident" id="3299636"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3299641">.</span><span class="ident" id="3299642">Node</span><span class="op" id="3299646">,</span>&nbsp;<span class="ident" id="3299648">nodeName</span>&nbsp;<span class="builtintype" id="3299657">string</span><span class="op" id="3299663">)</span>&nbsp;<span class="ident" id="3299665"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3299673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299676">if</span>&nbsp;<span class="ident" id="3299679"><a href="/html/template/escape.go.html#3299617">a</a></span><span class="op" id="3299680">.</span><span class="ident" id="3299681">state</span>&nbsp;<span class="op" id="3299687">==</span>&nbsp;<span class="ident" id="3299690"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3299701">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299705">return</span>&nbsp;<span class="ident" id="3299712"><a href="/html/template/escape.go.html#3299617">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299718">if</span>&nbsp;<span class="ident" id="3299721"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3299722">.</span><span class="ident" id="3299723">state</span>&nbsp;<span class="op" id="3299729">==</span>&nbsp;<span class="ident" id="3299732"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3299743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299747">return</span>&nbsp;<span class="ident" id="3299754"><a href="/html/template/escape.go.html#3299620">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299757">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299760">if</span>&nbsp;<span class="ident" id="3299763"><a href="/html/template/escape.go.html#3299617">a</a></span><span class="op" id="3299764">.</span><span class="ident" id="3299765">eq</span><span class="op" id="3299767">(</span><span class="ident" id="3299768"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3299769">)</span>&nbsp;<span class="op" id="3299771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299775">return</span>&nbsp;<span class="ident" id="3299782"><a href="/html/template/escape.go.html#3299617">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299789">c</span>&nbsp;<span class="op" id="3299791">:=</span>&nbsp;<span class="ident" id="3299794"><a href="/html/template/escape.go.html#3299617">a</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299797"><a href="/html/template/escape.go.html#3299789">c</a></span><span class="op" id="3299798">.</span><span class="ident" id="3299799">urlPart</span>&nbsp;<span class="op" id="3299807">=</span>&nbsp;<span class="ident" id="3299809"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3299810">.</span><span class="ident" id="3299811">urlPart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299820">if</span>&nbsp;<span class="ident" id="3299823"><a href="/html/template/escape.go.html#3299789">c</a></span><span class="op" id="3299824">.</span><span class="ident" id="3299825">eq</span><span class="op" id="3299827">(</span><span class="ident" id="3299828"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3299829">)</span>&nbsp;<span class="op" id="3299831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3299835">//&nbsp;The&nbsp;contexts&nbsp;differ&nbsp;only&nbsp;by&nbsp;urlPart.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299877"><a href="/html/template/escape.go.html#3299789">c</a></span><span class="op" id="3299878">.</span><span class="ident" id="3299879">urlPart</span>&nbsp;<span class="op" id="3299887">=</span>&nbsp;<span class="ident" id="3299889"><a href="/html/template/context.go.html#3264231">urlPartUnknown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299906">return</span>&nbsp;<span class="ident" id="3299913"><a href="/html/template/escape.go.html#3299789">c</a></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299920"><a href="/html/template/escape.go.html#3299789">c</a></span>&nbsp;<span class="op" id="3299922">=</span>&nbsp;<span class="ident" id="3299924"><a href="/html/template/escape.go.html#3299617">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299927"><a href="/html/template/escape.go.html#3299789">c</a></span><span class="op" id="3299928">.</span><span class="ident" id="3299929">jsCtx</span>&nbsp;<span class="op" id="3299935">=</span>&nbsp;<span class="ident" id="3299937"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3299938">.</span><span class="ident" id="3299939">jsCtx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299946">if</span>&nbsp;<span class="ident" id="3299949"><a href="/html/template/escape.go.html#3299789">c</a></span><span class="op" id="3299950">.</span><span class="ident" id="3299951">eq</span><span class="op" id="3299953">(</span><span class="ident" id="3299954"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3299955">)</span>&nbsp;<span class="op" id="3299957">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3299961">//&nbsp;The&nbsp;contexts&nbsp;differ&nbsp;only&nbsp;by&nbsp;jsCtx.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300001"><a href="/html/template/escape.go.html#3299789">c</a></span><span class="op" id="3300002">.</span><span class="ident" id="3300003">jsCtx</span>&nbsp;<span class="op" id="3300009">=</span>&nbsp;<span class="ident" id="3300011"><a href="/html/template/context.go.html#3264958">jsCtxUnknown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300026">return</span>&nbsp;<span class="ident" id="3300033"><a href="/html/template/escape.go.html#3299789">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300040">//&nbsp;Allow&nbsp;a&nbsp;nudged&nbsp;context&nbsp;to&nbsp;join&nbsp;with&nbsp;an&nbsp;unnudged&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300097">//&nbsp;This&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300117">//&nbsp;&nbsp;&nbsp;&lt;p&nbsp;title={{if&nbsp;.C}}{{.}}{{end}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300154">//&nbsp;ends&nbsp;in&nbsp;an&nbsp;unquoted&nbsp;value&nbsp;state&nbsp;even&nbsp;though&nbsp;the&nbsp;else&nbsp;branch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300218">//&nbsp;ends&nbsp;in&nbsp;stateBeforeValue.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300248">if</span>&nbsp;<span class="ident" id="3300251">c</span><span class="op" id="3300252">,</span>&nbsp;<span class="ident" id="3300254">d</span>&nbsp;<span class="op" id="3300256">:=</span>&nbsp;<span class="ident" id="3300259"><a href="/html/template/escape.go.html#3298967">nudge</a></span><span class="op" id="3300264">(</span><span class="ident" id="3300265"><a href="/html/template/escape.go.html#3299617">a</a></span><span class="op" id="3300266">)</span><span class="op" id="3300267">,</span>&nbsp;<span class="ident" id="3300269"><a href="/html/template/escape.go.html#3298967">nudge</a></span><span class="op" id="3300274">(</span><span class="ident" id="3300275"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3300276">)</span><span class="op" id="3300277">;</span>&nbsp;<span class="op" id="3300279">!</span><span class="op" id="3300280">(</span><span class="ident" id="3300281"><a href="/html/template/escape.go.html#3300251">c</a></span><span class="op" id="3300282">.</span><span class="ident" id="3300283">eq</span><span class="op" id="3300285">(</span><span class="ident" id="3300286"><a href="/html/template/escape.go.html#3299617">a</a></span><span class="op" id="3300287">)</span>&nbsp;<span class="op" id="3300289">&amp;&amp;</span>&nbsp;<span class="ident" id="3300292"><a href="/html/template/escape.go.html#3300254">d</a></span><span class="op" id="3300293">.</span><span class="ident" id="3300294">eq</span><span class="op" id="3300296">(</span><span class="ident" id="3300297"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3300298">)</span><span class="op" id="3300299">)</span>&nbsp;<span class="op" id="3300301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300305">if</span>&nbsp;<span class="ident" id="3300308">e</span>&nbsp;<span class="op" id="3300310">:=</span>&nbsp;<span class="ident" id="3300313"><a href="/html/template/escape.go.html#3299612">join</a></span><span class="op" id="3300317">(</span><span class="ident" id="3300318"><a href="/html/template/escape.go.html#3300251">c</a></span><span class="op" id="3300319">,</span>&nbsp;<span class="ident" id="3300321"><a href="/html/template/escape.go.html#3300254">d</a></span><span class="op" id="3300322">,</span>&nbsp;<span class="ident" id="3300324"><a href="/html/template/escape.go.html#3299631">node</a></span><span class="op" id="3300328">,</span>&nbsp;<span class="ident" id="3300330"><a href="/html/template/escape.go.html#3299648">nodeName</a></span><span class="op" id="3300338">)</span><span class="op" id="3300339">;</span>&nbsp;<span class="ident" id="3300341"><a href="/html/template/escape.go.html#3300308">e</a></span><span class="op" id="3300342">.</span><span class="ident" id="3300343">state</span>&nbsp;<span class="op" id="3300349">!=</span>&nbsp;<span class="ident" id="3300352"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3300363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300368">return</span>&nbsp;<span class="ident" id="3300375"><a href="/html/template/escape.go.html#3300308">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300382">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300386">return</span>&nbsp;<span class="ident" id="3300393"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3300400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300404">state</span><span class="op" id="3300409">:</span>&nbsp;<span class="ident" id="3300411"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3300421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300425">err</span><span class="op" id="3300428">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3300432"><a href="/html/template/error.go.html#3287884">errorf</a></span><span class="op" id="3300438">(</span><span class="ident" id="3300439"><a href="/html/template/error.go.html#3283709">ErrBranchEnd</a></span><span class="op" id="3300451">,</span>&nbsp;<span class="ident" id="3300453"><a href="/html/template/escape.go.html#3299631">node</a></span><span class="op" id="3300457">,</span>&nbsp;<span class="num" id="3300459">0</span><span class="op" id="3300460">,</span>&nbsp;<span class="string" id="3300462">&#34;{{%s}}&nbsp;branches&nbsp;end&nbsp;in&nbsp;different&nbsp;contexts:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="3300513">,</span>&nbsp;<span class="ident" id="3300515"><a href="/html/template/escape.go.html#3299648">nodeName</a></span><span class="op" id="3300523">,</span>&nbsp;<span class="ident" id="3300525"><a href="/html/template/escape.go.html#3299617">a</a></span><span class="op" id="3300526">,</span>&nbsp;<span class="ident" id="3300528"><a href="/html/template/escape.go.html#3299620">b</a></span><span class="op" id="3300529">)</span><span class="op" id="3300530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300533">}</span><br>
<span class="lineno">410</span><span class="op" id="3300535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3300538">//&nbsp;escapeBranch&nbsp;escapes&nbsp;a&nbsp;branch&nbsp;template&nbsp;node:&nbsp;&#34;if&#34;,&nbsp;&#34;range&#34;&nbsp;and&nbsp;&#34;with&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3300612">func</span>&nbsp;<span class="op" id="3300617">(</span><span class="ident" id="3300618">e</span>&nbsp;<span class="op" id="3300620">*</span><span class="ident" id="3300621"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3300628">)</span>&nbsp;<span class="ident" id="3300630">escapeBranch</span><span class="op" id="3300642">(</span><span class="ident" id="3300643">c</span>&nbsp;<span class="ident" id="3300645"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3300652">,</span>&nbsp;<span class="ident" id="3300654">n</span>&nbsp;<span class="op" id="3300656">*</span><span class="ident" id="3300657"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3300662">.</span><span class="ident" id="3300663">BranchNode</span><span class="op" id="3300673">,</span>&nbsp;<span class="ident" id="3300675">nodeName</span>&nbsp;<span class="builtintype" id="3300684">string</span><span class="op" id="3300690">)</span>&nbsp;<span class="ident" id="3300692"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3300700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300703">c0</span>&nbsp;<span class="op" id="3300706">:=</span>&nbsp;<span class="ident" id="3300709"><a href="/html/template/escape.go.html#3300618">e</a></span><span class="op" id="3300710">.</span><span class="ident" id="3300711">escapeList</span><span class="op" id="3300721">(</span><span class="ident" id="3300722"><a href="/html/template/escape.go.html#3300643">c</a></span><span class="op" id="3300723">,</span>&nbsp;<span class="ident" id="3300725"><a href="/html/template/escape.go.html#3300654">n</a></span><span class="op" id="3300726">.</span><span class="ident" id="3300727">List</span><span class="op" id="3300731">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300734">if</span>&nbsp;<span class="ident" id="3300737"><a href="/html/template/escape.go.html#3300675">nodeName</a></span>&nbsp;<span class="op" id="3300746">==</span>&nbsp;<span class="string" id="3300749">&#34;range&#34;</span>&nbsp;<span class="op" id="3300757">&amp;&amp;</span>&nbsp;<span class="ident" id="3300760"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3300762">.</span><span class="ident" id="3300763">state</span>&nbsp;<span class="op" id="3300769">!=</span>&nbsp;<span class="ident" id="3300772"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3300783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300787">//&nbsp;The&nbsp;&#34;true&#34;&nbsp;branch&nbsp;of&nbsp;a&nbsp;&#34;range&#34;&nbsp;node&nbsp;can&nbsp;execute&nbsp;multiple&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300856">//&nbsp;We&nbsp;check&nbsp;that&nbsp;executing&nbsp;n.List&nbsp;once&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300925">//&nbsp;as&nbsp;executing&nbsp;n.List&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300957">c1</span><span class="op" id="3300959">,</span>&nbsp;<span class="ident" id="3300961">_</span>&nbsp;<span class="op" id="3300963">:=</span>&nbsp;<span class="ident" id="3300966"><a href="/html/template/escape.go.html#3300618">e</a></span><span class="op" id="3300967">.</span><span class="ident" id="3300968">escapeListConditionally</span><span class="op" id="3300991">(</span><span class="ident" id="3300992"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3300994">,</span>&nbsp;<span class="ident" id="3300996"><a href="/html/template/escape.go.html#3300654">n</a></span><span class="op" id="3300997">.</span><span class="ident" id="3300998">List</span><span class="op" id="3301002">,</span>&nbsp;<span class="ident" id="3301004">nil</span><span class="op" id="3301007">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301011"><a href="/html/template/escape.go.html#3300703">c0</a></span>&nbsp;<span class="op" id="3301014">=</span>&nbsp;<span class="ident" id="3301016"><a href="/html/template/escape.go.html#3299612">join</a></span><span class="op" id="3301020">(</span><span class="ident" id="3301021"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3301023">,</span>&nbsp;<span class="ident" id="3301025"><a href="/html/template/escape.go.html#3300957">c1</a></span><span class="op" id="3301027">,</span>&nbsp;<span class="ident" id="3301029"><a href="/html/template/escape.go.html#3300654">n</a></span><span class="op" id="3301030">,</span>&nbsp;<span class="ident" id="3301032"><a href="/html/template/escape.go.html#3300675">nodeName</a></span><span class="op" id="3301040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301044">if</span>&nbsp;<span class="ident" id="3301047"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3301049">.</span><span class="ident" id="3301050">state</span>&nbsp;<span class="op" id="3301056">==</span>&nbsp;<span class="ident" id="3301059"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3301070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3301075">//&nbsp;Make&nbsp;clear&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;problem&nbsp;on&nbsp;loop&nbsp;re-entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3301132">//&nbsp;since&nbsp;developers&nbsp;tend&nbsp;to&nbsp;overlook&nbsp;that&nbsp;branch&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3301189">//&nbsp;debugging&nbsp;templates.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301216"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3301218">.</span><span class="ident" id="3301219">err</span><span class="op" id="3301222">.</span><span class="ident" id="3301223">Line</span>&nbsp;<span class="op" id="3301228">=</span>&nbsp;<span class="ident" id="3301230"><a href="/html/template/escape.go.html#3300654">n</a></span><span class="op" id="3301231">.</span><span class="ident" id="3301232">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301240"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3301242">.</span><span class="ident" id="3301243">err</span><span class="op" id="3301246">.</span><span class="ident" id="3301247">Description</span>&nbsp;<span class="op" id="3301259">=</span>&nbsp;<span class="string" id="3301261">&#34;on&nbsp;range&nbsp;loop&nbsp;re-entry:&nbsp;&#34;</span>&nbsp;<span class="op" id="3301288">+</span>&nbsp;<span class="ident" id="3301290"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3301292">.</span><span class="ident" id="3301293">err</span><span class="op" id="3301296">.</span><span class="ident" id="3301297">Description</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301312">return</span>&nbsp;<span class="ident" id="3301319"><a href="/html/template/escape.go.html#3300703">c0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301327">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301330">c1</span>&nbsp;<span class="op" id="3301333">:=</span>&nbsp;<span class="ident" id="3301336"><a href="/html/template/escape.go.html#3300618">e</a></span><span class="op" id="3301337">.</span><span class="ident" id="3301338">escapeList</span><span class="op" id="3301348">(</span><span class="ident" id="3301349"><a href="/html/template/escape.go.html#3300643">c</a></span><span class="op" id="3301350">,</span>&nbsp;<span class="ident" id="3301352"><a href="/html/template/escape.go.html#3300654">n</a></span><span class="op" id="3301353">.</span><span class="ident" id="3301354">ElseList</span><span class="op" id="3301362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301365">return</span>&nbsp;<span class="ident" id="3301372"><a href="/html/template/escape.go.html#3299612">join</a></span><span class="op" id="3301376">(</span><span class="ident" id="3301377"><a href="/html/template/escape.go.html#3300703">c0</a></span><span class="op" id="3301379">,</span>&nbsp;<span class="ident" id="3301381"><a href="/html/template/escape.go.html#3301330">c1</a></span><span class="op" id="3301383">,</span>&nbsp;<span class="ident" id="3301385"><a href="/html/template/escape.go.html#3300654">n</a></span><span class="op" id="3301386">,</span>&nbsp;<span class="ident" id="3301388"><a href="/html/template/escape.go.html#3300675">nodeName</a></span><span class="op" id="3301396">)</span><br>
<span class="lineno"></span><span class="op" id="3301398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3301401">//&nbsp;escapeList&nbsp;escapes&nbsp;a&nbsp;list&nbsp;template&nbsp;node.</span><br>
<span class="lineno">435</span><span class="keyword" id="3301445">func</span>&nbsp;<span class="op" id="3301450">(</span><span class="ident" id="3301451">e</span>&nbsp;<span class="op" id="3301453">*</span><span class="ident" id="3301454"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3301461">)</span>&nbsp;<span class="ident" id="3301463">escapeList</span><span class="op" id="3301473">(</span><span class="ident" id="3301474">c</span>&nbsp;<span class="ident" id="3301476"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3301483">,</span>&nbsp;<span class="ident" id="3301485">n</span>&nbsp;<span class="op" id="3301487">*</span><span class="ident" id="3301488"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3301493">.</span><span class="ident" id="3301494">ListNode</span><span class="op" id="3301502">)</span>&nbsp;<span class="ident" id="3301504"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3301512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301515">if</span>&nbsp;<span class="ident" id="3301518"><a href="/html/template/escape.go.html#3301485">n</a></span>&nbsp;<span class="op" id="3301520">==</span>&nbsp;<span class="ident" id="3301523">nil</span>&nbsp;<span class="op" id="3301527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301531">return</span>&nbsp;<span class="ident" id="3301538"><a href="/html/template/escape.go.html#3301474">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301544">for</span>&nbsp;<span class="ident" id="3301548">_</span><span class="op" id="3301549">,</span>&nbsp;<span class="ident" id="3301551">m</span>&nbsp;<span class="op" id="3301553">:=</span>&nbsp;<span class="keyword" id="3301556">range</span>&nbsp;<span class="ident" id="3301562"><a href="/html/template/escape.go.html#3301485">n</a></span><span class="op" id="3301563">.</span><span class="ident" id="3301564">Nodes</span>&nbsp;<span class="op" id="3301570">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301574"><a href="/html/template/escape.go.html#3301474">c</a></span>&nbsp;<span class="op" id="3301576">=</span>&nbsp;<span class="ident" id="3301578"><a href="/html/template/escape.go.html#3301451">e</a></span><span class="op" id="3301579">.</span><span class="ident" id="3301580">escape</span><span class="op" id="3301586">(</span><span class="ident" id="3301587"><a href="/html/template/escape.go.html#3301474">c</a></span><span class="op" id="3301588">,</span>&nbsp;<span class="ident" id="3301590"><a href="/html/template/escape.go.html#3301551">m</a></span><span class="op" id="3301591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301597">return</span>&nbsp;<span class="ident" id="3301604"><a href="/html/template/escape.go.html#3301474">c</a></span><br>
<span class="lineno"></span><span class="op" id="3301606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="comment" id="3301609">//&nbsp;escapeListConditionally&nbsp;escapes&nbsp;a&nbsp;list&nbsp;node&nbsp;but&nbsp;only&nbsp;preserves&nbsp;edits&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3301685">//&nbsp;inferences&nbsp;in&nbsp;e&nbsp;if&nbsp;the&nbsp;inferences&nbsp;and&nbsp;output&nbsp;context&nbsp;satisfy&nbsp;filter.</span><br>
<span class="lineno"></span><span class="comment" id="3301757">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;best&nbsp;guess&nbsp;at&nbsp;an&nbsp;output&nbsp;context,&nbsp;and&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;filter</span><br>
<span class="lineno"></span><span class="comment" id="3301837">//&nbsp;which&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;whether&nbsp;e&nbsp;was&nbsp;updated.</span><br>
<span class="lineno"></span><span class="keyword" id="3301884">func</span>&nbsp;<span class="op" id="3301889">(</span><span class="ident" id="3301890">e</span>&nbsp;<span class="op" id="3301892">*</span><span class="ident" id="3301893"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3301900">)</span>&nbsp;<span class="ident" id="3301902">escapeListConditionally</span><span class="op" id="3301925">(</span><span class="ident" id="3301926">c</span>&nbsp;<span class="ident" id="3301928"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3301935">,</span>&nbsp;<span class="ident" id="3301937">n</span>&nbsp;<span class="op" id="3301939">*</span><span class="ident" id="3301940"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3301945">.</span><span class="ident" id="3301946">ListNode</span><span class="op" id="3301954">,</span>&nbsp;<span class="ident" id="3301956">filter</span>&nbsp;<span class="keyword" id="3301963">func</span><span class="op" id="3301967">(</span><span class="op" id="3301968">*</span><span class="ident" id="3301969"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3301976">,</span>&nbsp;<span class="ident" id="3301978"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3301985">)</span>&nbsp;<span class="builtintype" id="3301987">bool</span><span class="op" id="3301991">)</span>&nbsp;<span class="op" id="3301993">(</span><span class="ident" id="3301994"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3302001">,</span>&nbsp;<span class="builtintype" id="3302003">bool</span><span class="op" id="3302007">)</span>&nbsp;<span class="op" id="3302009">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302012">e1</span>&nbsp;<span class="op" id="3302015">:=</span>&nbsp;<span class="ident" id="3302018"><a href="/html/template/escape.go.html#3291349">newEscaper</a></span><span class="op" id="3302028">(</span><span class="ident" id="3302029"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302030">.</span><span class="ident" id="3302031">tmpl</span><span class="op" id="3302035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302038">//&nbsp;Make&nbsp;type&nbsp;inferences&nbsp;available&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302079">for</span>&nbsp;<span class="ident" id="3302083">k</span><span class="op" id="3302084">,</span>&nbsp;<span class="ident" id="3302086">v</span>&nbsp;<span class="op" id="3302088">:=</span>&nbsp;<span class="keyword" id="3302091">range</span>&nbsp;<span class="ident" id="3302097"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302098">.</span><span class="ident" id="3302099">output</span>&nbsp;<span class="op" id="3302106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302110"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302112">.</span><span class="ident" id="3302113">output</span><span class="op" id="3302119">[</span><span class="ident" id="3302120"><a href="/html/template/escape.go.html#3302083">k</a></span><span class="op" id="3302121">]</span>&nbsp;<span class="op" id="3302123">=</span>&nbsp;<span class="ident" id="3302125"><a href="/html/template/escape.go.html#3302086">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302128">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302131"><a href="/html/template/escape.go.html#3301926">c</a></span>&nbsp;<span class="op" id="3302133">=</span>&nbsp;<span class="ident" id="3302135"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302137">.</span><span class="ident" id="3302138">escapeList</span><span class="op" id="3302148">(</span><span class="ident" id="3302149"><a href="/html/template/escape.go.html#3301926">c</a></span><span class="op" id="3302150">,</span>&nbsp;<span class="ident" id="3302152"><a href="/html/template/escape.go.html#3301937">n</a></span><span class="op" id="3302153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302156">ok</span>&nbsp;<span class="op" id="3302159">:=</span>&nbsp;<span class="ident" id="3302162"><a href="/html/template/escape.go.html#3301956">filter</a></span>&nbsp;<span class="op" id="3302169">!=</span>&nbsp;<span class="ident" id="3302172">nil</span>&nbsp;<span class="op" id="3302176">&amp;&amp;</span>&nbsp;<span class="ident" id="3302179"><a href="/html/template/escape.go.html#3301956">filter</a></span><span class="op" id="3302185">(</span><span class="ident" id="3302186"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302188">,</span>&nbsp;<span class="ident" id="3302190"><a href="/html/template/escape.go.html#3301926">c</a></span><span class="op" id="3302191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302194">if</span>&nbsp;<span class="ident" id="3302197"><a href="/html/template/escape.go.html#3302156">ok</a></span>&nbsp;<span class="op" id="3302200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302204">//&nbsp;Copy&nbsp;inferences&nbsp;and&nbsp;edits&nbsp;from&nbsp;e1&nbsp;back&nbsp;into&nbsp;e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302256">for</span>&nbsp;<span class="ident" id="3302260">k</span><span class="op" id="3302261">,</span>&nbsp;<span class="ident" id="3302263">v</span>&nbsp;<span class="op" id="3302265">:=</span>&nbsp;<span class="keyword" id="3302268">range</span>&nbsp;<span class="ident" id="3302274"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302276">.</span><span class="ident" id="3302277">output</span>&nbsp;<span class="op" id="3302284">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302289"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302290">.</span><span class="ident" id="3302291">output</span><span class="op" id="3302297">[</span><span class="ident" id="3302298"><a href="/html/template/escape.go.html#3302260">k</a></span><span class="op" id="3302299">]</span>&nbsp;<span class="op" id="3302301">=</span>&nbsp;<span class="ident" id="3302303"><a href="/html/template/escape.go.html#3302263">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302311">for</span>&nbsp;<span class="ident" id="3302315">k</span><span class="op" id="3302316">,</span>&nbsp;<span class="ident" id="3302318">v</span>&nbsp;<span class="op" id="3302320">:=</span>&nbsp;<span class="keyword" id="3302323">range</span>&nbsp;<span class="ident" id="3302329"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302331">.</span><span class="ident" id="3302332">derived</span>&nbsp;<span class="op" id="3302340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302345"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302346">.</span><span class="ident" id="3302347">derived</span><span class="op" id="3302354">[</span><span class="ident" id="3302355"><a href="/html/template/escape.go.html#3302315">k</a></span><span class="op" id="3302356">]</span>&nbsp;<span class="op" id="3302358">=</span>&nbsp;<span class="ident" id="3302360"><a href="/html/template/escape.go.html#3302318">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302364">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302368">for</span>&nbsp;<span class="ident" id="3302372">k</span><span class="op" id="3302373">,</span>&nbsp;<span class="ident" id="3302375">v</span>&nbsp;<span class="op" id="3302377">:=</span>&nbsp;<span class="keyword" id="3302380">range</span>&nbsp;<span class="ident" id="3302386"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302388">.</span><span class="ident" id="3302389">called</span>&nbsp;<span class="op" id="3302396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302401"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302402">.</span><span class="ident" id="3302403">called</span><span class="op" id="3302409">[</span><span class="ident" id="3302410"><a href="/html/template/escape.go.html#3302372">k</a></span><span class="op" id="3302411">]</span>&nbsp;<span class="op" id="3302413">=</span>&nbsp;<span class="ident" id="3302415"><a href="/html/template/escape.go.html#3302375">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302423">for</span>&nbsp;<span class="ident" id="3302427">k</span><span class="op" id="3302428">,</span>&nbsp;<span class="ident" id="3302430">v</span>&nbsp;<span class="op" id="3302432">:=</span>&nbsp;<span class="keyword" id="3302435">range</span>&nbsp;<span class="ident" id="3302441"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302443">.</span><span class="ident" id="3302444">actionNodeEdits</span>&nbsp;<span class="op" id="3302460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302465"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302466">.</span><span class="ident" id="3302467">editActionNode</span><span class="op" id="3302481">(</span><span class="ident" id="3302482"><a href="/html/template/escape.go.html#3302427">k</a></span><span class="op" id="3302483">,</span>&nbsp;<span class="ident" id="3302485"><a href="/html/template/escape.go.html#3302430">v</a></span><span class="op" id="3302486">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302494">for</span>&nbsp;<span class="ident" id="3302498">k</span><span class="op" id="3302499">,</span>&nbsp;<span class="ident" id="3302501">v</span>&nbsp;<span class="op" id="3302503">:=</span>&nbsp;<span class="keyword" id="3302506">range</span>&nbsp;<span class="ident" id="3302512"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302514">.</span><span class="ident" id="3302515">templateNodeEdits</span>&nbsp;<span class="op" id="3302533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302538"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302539">.</span><span class="ident" id="3302540">editTemplateNode</span><span class="op" id="3302556">(</span><span class="ident" id="3302557"><a href="/html/template/escape.go.html#3302498">k</a></span><span class="op" id="3302558">,</span>&nbsp;<span class="ident" id="3302560"><a href="/html/template/escape.go.html#3302501">v</a></span><span class="op" id="3302561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302569">for</span>&nbsp;<span class="ident" id="3302573">k</span><span class="op" id="3302574">,</span>&nbsp;<span class="ident" id="3302576">v</span>&nbsp;<span class="op" id="3302578">:=</span>&nbsp;<span class="keyword" id="3302581">range</span>&nbsp;<span class="ident" id="3302587"><a href="/html/template/escape.go.html#3302012">e1</a></span><span class="op" id="3302589">.</span><span class="ident" id="3302590">textNodeEdits</span>&nbsp;<span class="op" id="3302604">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302609"><a href="/html/template/escape.go.html#3301890">e</a></span><span class="op" id="3302610">.</span><span class="ident" id="3302611">editTextNode</span><span class="op" id="3302623">(</span><span class="ident" id="3302624"><a href="/html/template/escape.go.html#3302573">k</a></span><span class="op" id="3302625">,</span>&nbsp;<span class="ident" id="3302627"><a href="/html/template/escape.go.html#3302576">v</a></span><span class="op" id="3302628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302638">return</span>&nbsp;<span class="ident" id="3302645"><a href="/html/template/escape.go.html#3301926">c</a></span><span class="op" id="3302646">,</span>&nbsp;<span class="ident" id="3302648"><a href="/html/template/escape.go.html#3302156">ok</a></span><br>
<span class="lineno"></span><span class="op" id="3302651">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3302654">//&nbsp;escapeTemplate&nbsp;escapes&nbsp;a&nbsp;{{template}}&nbsp;call&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3302706">func</span>&nbsp;<span class="op" id="3302711">(</span><span class="ident" id="3302712">e</span>&nbsp;<span class="op" id="3302714">*</span><span class="ident" id="3302715"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3302722">)</span>&nbsp;<span class="ident" id="3302724">escapeTemplate</span><span class="op" id="3302738">(</span><span class="ident" id="3302739">c</span>&nbsp;<span class="ident" id="3302741"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3302748">,</span>&nbsp;<span class="ident" id="3302750">n</span>&nbsp;<span class="op" id="3302752">*</span><span class="ident" id="3302753"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3302758">.</span><span class="ident" id="3302759">TemplateNode</span><span class="op" id="3302771">)</span>&nbsp;<span class="ident" id="3302773"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3302781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302784"><a href="/html/template/escape.go.html#3302739">c</a></span><span class="op" id="3302785">,</span>&nbsp;<span class="ident" id="3302787">name</span>&nbsp;<span class="op" id="3302792">:=</span>&nbsp;<span class="ident" id="3302795"><a href="/html/template/escape.go.html#3302712">e</a></span><span class="op" id="3302796">.</span><span class="ident" id="3302797">escapeTree</span><span class="op" id="3302807">(</span><span class="ident" id="3302808"><a href="/html/template/escape.go.html#3302739">c</a></span><span class="op" id="3302809">,</span>&nbsp;<span class="ident" id="3302811"><a href="/html/template/escape.go.html#3302750">n</a></span><span class="op" id="3302812">,</span>&nbsp;<span class="ident" id="3302814"><a href="/html/template/escape.go.html#3302750">n</a></span><span class="op" id="3302815">.</span><span class="ident" id="3302816">Name</span><span class="op" id="3302820">,</span>&nbsp;<span class="ident" id="3302822"><a href="/html/template/escape.go.html#3302750">n</a></span><span class="op" id="3302823">.</span><span class="ident" id="3302824">Line</span><span class="op" id="3302828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302831">if</span>&nbsp;<span class="ident" id="3302834"><a href="/html/template/escape.go.html#3302787">name</a></span>&nbsp;<span class="op" id="3302839">!=</span>&nbsp;<span class="ident" id="3302842"><a href="/html/template/escape.go.html#3302750">n</a></span><span class="op" id="3302843">.</span><span class="ident" id="3302844">Name</span>&nbsp;<span class="op" id="3302849">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302853"><a href="/html/template/escape.go.html#3302712">e</a></span><span class="op" id="3302854">.</span><span class="ident" id="3302855">editTemplateNode</span><span class="op" id="3302871">(</span><span class="ident" id="3302872"><a href="/html/template/escape.go.html#3302750">n</a></span><span class="op" id="3302873">,</span>&nbsp;<span class="ident" id="3302875"><a href="/html/template/escape.go.html#3302787">name</a></span><span class="op" id="3302879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302885">return</span>&nbsp;<span class="ident" id="3302892"><a href="/html/template/escape.go.html#3302739">c</a></span><br>
<span class="lineno"></span><span class="op" id="3302894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span><span class="comment" id="3302897">//&nbsp;escapeTree&nbsp;escapes&nbsp;the&nbsp;named&nbsp;template&nbsp;starting&nbsp;in&nbsp;the&nbsp;given&nbsp;context&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3302971">//&nbsp;necessary&nbsp;and&nbsp;returns&nbsp;its&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="3303016">func</span>&nbsp;<span class="op" id="3303021">(</span><span class="ident" id="3303022">e</span>&nbsp;<span class="op" id="3303024">*</span><span class="ident" id="3303025"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3303032">)</span>&nbsp;<span class="ident" id="3303034">escapeTree</span><span class="op" id="3303044">(</span><span class="ident" id="3303045">c</span>&nbsp;<span class="ident" id="3303047"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3303054">,</span>&nbsp;<span class="ident" id="3303056">node</span>&nbsp;<span class="ident" id="3303061"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3303066">.</span><span class="ident" id="3303067">Node</span><span class="op" id="3303071">,</span>&nbsp;<span class="ident" id="3303073">name</span>&nbsp;<span class="builtintype" id="3303078">string</span><span class="op" id="3303084">,</span>&nbsp;<span class="ident" id="3303086">line</span>&nbsp;<span class="builtintype" id="3303091">int</span><span class="op" id="3303094">)</span>&nbsp;<span class="op" id="3303096">(</span><span class="ident" id="3303097"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3303104">,</span>&nbsp;<span class="builtintype" id="3303106">string</span><span class="op" id="3303112">)</span>&nbsp;<span class="op" id="3303114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303117">//&nbsp;Mangle&nbsp;the&nbsp;template&nbsp;name&nbsp;with&nbsp;the&nbsp;input&nbsp;context&nbsp;to&nbsp;produce&nbsp;a&nbsp;reliable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303191">//&nbsp;identifier.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303207">dname</span>&nbsp;<span class="op" id="3303213">:=</span>&nbsp;<span class="ident" id="3303216"><a href="/html/template/escape.go.html#3303045">c</a></span><span class="op" id="3303217">.</span><span class="ident" id="3303218">mangle</span><span class="op" id="3303224">(</span><span class="ident" id="3303225"><a href="/html/template/escape.go.html#3303073">name</a></span><span class="op" id="3303229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303232"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3303233">.</span><span class="ident" id="3303234">called</span><span class="op" id="3303240">[</span><span class="ident" id="3303241"><a href="/html/template/escape.go.html#3303207">dname</a></span><span class="op" id="3303246">]</span>&nbsp;<span class="op" id="3303248">=</span>&nbsp;<span class="ident" id="3303250">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303256">if</span>&nbsp;<span class="ident" id="3303259">out</span><span class="op" id="3303262">,</span>&nbsp;<span class="ident" id="3303264">ok</span>&nbsp;<span class="op" id="3303267">:=</span>&nbsp;<span class="ident" id="3303270"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3303271">.</span><span class="ident" id="3303272">output</span><span class="op" id="3303278">[</span><span class="ident" id="3303279"><a href="/html/template/escape.go.html#3303207">dname</a></span><span class="op" id="3303284">]</span><span class="op" id="3303285">;</span>&nbsp;<span class="ident" id="3303287"><a href="/html/template/escape.go.html#3303264">ok</a></span>&nbsp;<span class="op" id="3303290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303294">//&nbsp;Already&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303316">return</span>&nbsp;<span class="ident" id="3303323"><a href="/html/template/escape.go.html#3303259">out</a></span><span class="op" id="3303326">,</span>&nbsp;<span class="ident" id="3303328"><a href="/html/template/escape.go.html#3303207">dname</a></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303338">t</span>&nbsp;<span class="op" id="3303340">:=</span>&nbsp;<span class="ident" id="3303343"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3303344">.</span><span class="ident" id="3303345">template</span><span class="op" id="3303353">(</span><span class="ident" id="3303354"><a href="/html/template/escape.go.html#3303073">name</a></span><span class="op" id="3303358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303361">if</span>&nbsp;<span class="ident" id="3303364"><a href="/html/template/escape.go.html#3303338">t</a></span>&nbsp;<span class="op" id="3303366">==</span>&nbsp;<span class="ident" id="3303369">nil</span>&nbsp;<span class="op" id="3303373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303377">//&nbsp;Two&nbsp;cases:&nbsp;The&nbsp;template&nbsp;exists&nbsp;but&nbsp;is&nbsp;empty,&nbsp;or&nbsp;has&nbsp;never&nbsp;been&nbsp;mentioned&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303458">//&nbsp;all.&nbsp;Distinguish&nbsp;the&nbsp;cases&nbsp;in&nbsp;the&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303513">if</span>&nbsp;<span class="ident" id="3303516"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3303517">.</span><span class="ident" id="3303518">tmpl</span><span class="op" id="3303522">.</span><span class="ident" id="3303523">set</span><span class="op" id="3303526">[</span><span class="ident" id="3303527"><a href="/html/template/escape.go.html#3303073">name</a></span><span class="op" id="3303531">]</span>&nbsp;<span class="op" id="3303533">!=</span>&nbsp;<span class="ident" id="3303536">nil</span>&nbsp;<span class="op" id="3303540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303545">return</span>&nbsp;<span class="ident" id="3303552"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3303559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303565">state</span><span class="op" id="3303570">:</span>&nbsp;<span class="ident" id="3303572"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3303582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303588">err</span><span class="op" id="3303591">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3303595"><a href="/html/template/error.go.html#3287884">errorf</a></span><span class="op" id="3303601">(</span><span class="ident" id="3303602"><a href="/html/template/error.go.html#3284852">ErrNoSuchTemplate</a></span><span class="op" id="3303619">,</span>&nbsp;<span class="ident" id="3303621"><a href="/html/template/escape.go.html#3303056">node</a></span><span class="op" id="3303625">,</span>&nbsp;<span class="ident" id="3303627"><a href="/html/template/escape.go.html#3303086">line</a></span><span class="op" id="3303631">,</span>&nbsp;<span class="string" id="3303633">&#34;%q&nbsp;is&nbsp;an&nbsp;incomplete&nbsp;or&nbsp;empty&nbsp;template&#34;</span><span class="op" id="3303672">,</span>&nbsp;<span class="ident" id="3303674"><a href="/html/template/escape.go.html#3303073">name</a></span><span class="op" id="3303678">)</span><span class="op" id="3303679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303684">}</span><span class="op" id="3303685">,</span>&nbsp;<span class="ident" id="3303687"><a href="/html/template/escape.go.html#3303207">dname</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303699">return</span>&nbsp;<span class="ident" id="3303706"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3303713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303718">state</span><span class="op" id="3303723">:</span>&nbsp;<span class="ident" id="3303725"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3303735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303740">err</span><span class="op" id="3303743">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3303747"><a href="/html/template/error.go.html#3287884">errorf</a></span><span class="op" id="3303753">(</span><span class="ident" id="3303754"><a href="/html/template/error.go.html#3284852">ErrNoSuchTemplate</a></span><span class="op" id="3303771">,</span>&nbsp;<span class="ident" id="3303773"><a href="/html/template/escape.go.html#3303056">node</a></span><span class="op" id="3303777">,</span>&nbsp;<span class="ident" id="3303779"><a href="/html/template/escape.go.html#3303086">line</a></span><span class="op" id="3303783">,</span>&nbsp;<span class="string" id="3303785">&#34;no&nbsp;such&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3303806">,</span>&nbsp;<span class="ident" id="3303808"><a href="/html/template/escape.go.html#3303073">name</a></span><span class="op" id="3303812">)</span><span class="op" id="3303813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303817">}</span><span class="op" id="3303818">,</span>&nbsp;<span class="ident" id="3303820"><a href="/html/template/escape.go.html#3303207">dname</a></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303830">if</span>&nbsp;<span class="ident" id="3303833"><a href="/html/template/escape.go.html#3303207">dname</a></span>&nbsp;<span class="op" id="3303839">!=</span>&nbsp;<span class="ident" id="3303842"><a href="/html/template/escape.go.html#3303073">name</a></span>&nbsp;<span class="op" id="3303847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303851">//&nbsp;Use&nbsp;any&nbsp;template&nbsp;derived&nbsp;during&nbsp;an&nbsp;earlier&nbsp;call&nbsp;to&nbsp;escapeTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303922">//&nbsp;with&nbsp;different&nbsp;top&nbsp;level&nbsp;templates,&nbsp;or&nbsp;clone&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303986">dt</span>&nbsp;<span class="op" id="3303989">:=</span>&nbsp;<span class="ident" id="3303992"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3303993">.</span><span class="ident" id="3303994">template</span><span class="op" id="3304002">(</span><span class="ident" id="3304003"><a href="/html/template/escape.go.html#3303207">dname</a></span><span class="op" id="3304008">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304012">if</span>&nbsp;<span class="ident" id="3304015"><a href="/html/template/escape.go.html#3303986">dt</a></span>&nbsp;<span class="op" id="3304018">==</span>&nbsp;<span class="ident" id="3304021">nil</span>&nbsp;<span class="op" id="3304025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304030"><a href="/html/template/escape.go.html#3303986">dt</a></span>&nbsp;<span class="op" id="3304033">=</span>&nbsp;<span class="ident" id="3304035"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3304043">.</span><span class="ident" id="3304044">New</span><span class="op" id="3304047">(</span><span class="ident" id="3304048"><a href="/html/template/escape.go.html#3303207">dname</a></span><span class="op" id="3304053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304058"><a href="/html/template/escape.go.html#3303986">dt</a></span><span class="op" id="3304060">.</span><span class="ident" id="3304061">Tree</span>&nbsp;<span class="op" id="3304066">=</span>&nbsp;<span class="op" id="3304068">&amp;</span><span class="ident" id="3304069"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3304074">.</span><span class="ident" id="3304075">Tree</span><span class="op" id="3304079">{</span><span class="ident" id="3304080">Name</span><span class="op" id="3304084">:</span>&nbsp;<span class="ident" id="3304086"><a href="/html/template/escape.go.html#3303207">dname</a></span><span class="op" id="3304091">,</span>&nbsp;<span class="ident" id="3304093">Root</span><span class="op" id="3304097">:</span>&nbsp;<span class="ident" id="3304099"><a href="/html/template/escape.go.html#3303338">t</a></span><span class="op" id="3304100">.</span><span class="ident" id="3304101">Root</span><span class="op" id="3304105">.</span><span class="ident" id="3304106">CopyList</span><span class="op" id="3304114">(</span><span class="op" id="3304115">)</span><span class="op" id="3304116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304121"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3304122">.</span><span class="ident" id="3304123">derived</span><span class="op" id="3304130">[</span><span class="ident" id="3304131"><a href="/html/template/escape.go.html#3303207">dname</a></span><span class="op" id="3304136">]</span>&nbsp;<span class="op" id="3304138">=</span>&nbsp;<span class="ident" id="3304140"><a href="/html/template/escape.go.html#3303986">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304145">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304149"><a href="/html/template/escape.go.html#3303338">t</a></span>&nbsp;<span class="op" id="3304151">=</span>&nbsp;<span class="ident" id="3304153"><a href="/html/template/escape.go.html#3303986">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304160">return</span>&nbsp;<span class="ident" id="3304167"><a href="/html/template/escape.go.html#3303022">e</a></span><span class="op" id="3304168">.</span><span class="ident" id="3304169">computeOutCtx</span><span class="op" id="3304182">(</span><span class="ident" id="3304183"><a href="/html/template/escape.go.html#3303045">c</a></span><span class="op" id="3304184">,</span>&nbsp;<span class="ident" id="3304186"><a href="/html/template/escape.go.html#3303338">t</a></span><span class="op" id="3304187">)</span><span class="op" id="3304188">,</span>&nbsp;<span class="ident" id="3304190"><a href="/html/template/escape.go.html#3303207">dname</a></span><br>
<span class="lineno"></span><span class="op" id="3304196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3304199">//&nbsp;computeOutCtx&nbsp;takes&nbsp;a&nbsp;template&nbsp;and&nbsp;its&nbsp;start&nbsp;context&nbsp;and&nbsp;computes&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="3304279">//&nbsp;context&nbsp;while&nbsp;storing&nbsp;any&nbsp;inferences&nbsp;in&nbsp;e.</span><br>
<span class="lineno"></span><span class="keyword" id="3304325">func</span>&nbsp;<span class="op" id="3304330">(</span><span class="ident" id="3304331">e</span>&nbsp;<span class="op" id="3304333">*</span><span class="ident" id="3304334"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3304341">)</span>&nbsp;<span class="ident" id="3304343">computeOutCtx</span><span class="op" id="3304356">(</span><span class="ident" id="3304357">c</span>&nbsp;<span class="ident" id="3304359"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3304366">,</span>&nbsp;<span class="ident" id="3304368">t</span>&nbsp;<span class="op" id="3304370">*</span><span class="ident" id="3304371"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3304379">.</span><span class="ident" id="3304380">Template</span><span class="op" id="3304388">)</span>&nbsp;<span class="ident" id="3304390"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3304398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304401">//&nbsp;Propagate&nbsp;context&nbsp;over&nbsp;the&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304438">c1</span><span class="op" id="3304440">,</span>&nbsp;<span class="ident" id="3304442">ok</span>&nbsp;<span class="op" id="3304445">:=</span>&nbsp;<span class="ident" id="3304448"><a href="/html/template/escape.go.html#3304331">e</a></span><span class="op" id="3304449">.</span><span class="ident" id="3304450">escapeTemplateBody</span><span class="op" id="3304468">(</span><span class="ident" id="3304469"><a href="/html/template/escape.go.html#3304357">c</a></span><span class="op" id="3304470">,</span>&nbsp;<span class="ident" id="3304472"><a href="/html/template/escape.go.html#3304368">t</a></span><span class="op" id="3304473">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304476">if</span>&nbsp;<span class="op" id="3304479">!</span><span class="ident" id="3304480"><a href="/html/template/escape.go.html#3304442">ok</a></span>&nbsp;<span class="op" id="3304483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304487">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;fixed&nbsp;point&nbsp;by&nbsp;assuming&nbsp;c1&nbsp;as&nbsp;the&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304553">if</span>&nbsp;<span class="ident" id="3304556">c2</span><span class="op" id="3304558">,</span>&nbsp;<span class="ident" id="3304560">ok2</span>&nbsp;<span class="op" id="3304564">:=</span>&nbsp;<span class="ident" id="3304567"><a href="/html/template/escape.go.html#3304331">e</a></span><span class="op" id="3304568">.</span><span class="ident" id="3304569">escapeTemplateBody</span><span class="op" id="3304587">(</span><span class="ident" id="3304588"><a href="/html/template/escape.go.html#3304438">c1</a></span><span class="op" id="3304590">,</span>&nbsp;<span class="ident" id="3304592"><a href="/html/template/escape.go.html#3304368">t</a></span><span class="op" id="3304593">)</span><span class="op" id="3304594">;</span>&nbsp;<span class="ident" id="3304596"><a href="/html/template/escape.go.html#3304560">ok2</a></span>&nbsp;<span class="op" id="3304600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304605"><a href="/html/template/escape.go.html#3304438">c1</a></span><span class="op" id="3304607">,</span>&nbsp;<span class="ident" id="3304609"><a href="/html/template/escape.go.html#3304442">ok</a></span>&nbsp;<span class="op" id="3304612">=</span>&nbsp;<span class="ident" id="3304614"><a href="/html/template/escape.go.html#3304556">c2</a></span><span class="op" id="3304616">,</span>&nbsp;<span class="ident" id="3304618">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304625">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304629">//&nbsp;Use&nbsp;c1&nbsp;as&nbsp;the&nbsp;error&nbsp;context&nbsp;if&nbsp;neither&nbsp;assumption&nbsp;worked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304694">if</span>&nbsp;<span class="op" id="3304697">!</span><span class="ident" id="3304698"><a href="/html/template/escape.go.html#3304442">ok</a></span>&nbsp;<span class="op" id="3304701">&amp;&amp;</span>&nbsp;<span class="ident" id="3304704"><a href="/html/template/escape.go.html#3304438">c1</a></span><span class="op" id="3304706">.</span><span class="ident" id="3304707">state</span>&nbsp;<span class="op" id="3304713">!=</span>&nbsp;<span class="ident" id="3304716"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3304727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304731">return</span>&nbsp;<span class="ident" id="3304738"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3304745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304750">state</span><span class="op" id="3304755">:</span>&nbsp;<span class="ident" id="3304757"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3304767">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304772">err</span><span class="op" id="3304775">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3304779"><a href="/html/template/error.go.html#3287884">errorf</a></span><span class="op" id="3304785">(</span><span class="ident" id="3304786"><a href="/html/template/error.go.html#3285419">ErrOutputContext</a></span><span class="op" id="3304802">,</span>&nbsp;<span class="ident" id="3304804"><a href="/html/template/escape.go.html#3304368">t</a></span><span class="op" id="3304805">.</span><span class="ident" id="3304806">Tree</span><span class="op" id="3304810">.</span><span class="ident" id="3304811">Root</span><span class="op" id="3304815">,</span>&nbsp;<span class="num" id="3304817">0</span><span class="op" id="3304818">,</span>&nbsp;<span class="string" id="3304820">&#34;cannot&nbsp;compute&nbsp;output&nbsp;context&nbsp;for&nbsp;template&nbsp;%s&#34;</span><span class="op" id="3304867">,</span>&nbsp;<span class="ident" id="3304869"><a href="/html/template/escape.go.html#3304368">t</a></span><span class="op" id="3304870">.</span><span class="ident" id="3304871">Name</span><span class="op" id="3304875">(</span><span class="op" id="3304876">)</span><span class="op" id="3304877">)</span><span class="op" id="3304878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304888">return</span>&nbsp;<span class="ident" id="3304895"><a href="/html/template/escape.go.html#3304438">c1</a></span><br>
<span class="lineno"></span><span class="op" id="3304898">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="3304901">//&nbsp;escapeTemplateBody&nbsp;escapes&nbsp;the&nbsp;given&nbsp;template&nbsp;assuming&nbsp;the&nbsp;given&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="3304976">//&nbsp;context,&nbsp;and&nbsp;returns&nbsp;the&nbsp;best&nbsp;guess&nbsp;at&nbsp;the&nbsp;output&nbsp;context&nbsp;and&nbsp;whether&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3305053">//&nbsp;assumption&nbsp;was&nbsp;correct.</span><br>
<span class="lineno"></span><span class="keyword" id="3305080">func</span>&nbsp;<span class="op" id="3305085">(</span><span class="ident" id="3305086">e</span>&nbsp;<span class="op" id="3305088">*</span><span class="ident" id="3305089"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3305096">)</span>&nbsp;<span class="ident" id="3305098">escapeTemplateBody</span><span class="op" id="3305116">(</span><span class="ident" id="3305117">c</span>&nbsp;<span class="ident" id="3305119"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3305126">,</span>&nbsp;<span class="ident" id="3305128">t</span>&nbsp;<span class="op" id="3305130">*</span><span class="ident" id="3305131"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3305139">.</span><span class="ident" id="3305140">Template</span><span class="op" id="3305148">)</span>&nbsp;<span class="op" id="3305150">(</span><span class="ident" id="3305151"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3305158">,</span>&nbsp;<span class="builtintype" id="3305160">bool</span><span class="op" id="3305164">)</span>&nbsp;<span class="op" id="3305166">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305169">filter</span>&nbsp;<span class="op" id="3305176">:=</span>&nbsp;<span class="keyword" id="3305179">func</span><span class="op" id="3305183">(</span><span class="ident" id="3305184">e1</span>&nbsp;<span class="op" id="3305187">*</span><span class="ident" id="3305188"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3305195">,</span>&nbsp;<span class="ident" id="3305197">c1</span>&nbsp;<span class="ident" id="3305200"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3305207">)</span>&nbsp;<span class="builtintype" id="3305209">bool</span>&nbsp;<span class="op" id="3305214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305218">if</span>&nbsp;<span class="ident" id="3305221"><a href="/html/template/escape.go.html#3305197">c1</a></span><span class="op" id="3305223">.</span><span class="ident" id="3305224">state</span>&nbsp;<span class="op" id="3305230">==</span>&nbsp;<span class="ident" id="3305233"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3305244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305249">//&nbsp;Do&nbsp;not&nbsp;update&nbsp;the&nbsp;input&nbsp;escaper,&nbsp;e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305291">return</span>&nbsp;<span class="ident" id="3305298">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305306">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305310">if</span>&nbsp;<span class="op" id="3305313">!</span><span class="ident" id="3305314"><a href="/html/template/escape.go.html#3305184">e1</a></span><span class="op" id="3305316">.</span><span class="ident" id="3305317">called</span><span class="op" id="3305323">[</span><span class="ident" id="3305324"><a href="/html/template/escape.go.html#3305128">t</a></span><span class="op" id="3305325">.</span><span class="ident" id="3305326">Name</span><span class="op" id="3305330">(</span><span class="op" id="3305331">)</span><span class="op" id="3305332">]</span>&nbsp;<span class="op" id="3305334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305339">//&nbsp;If&nbsp;t&nbsp;is&nbsp;not&nbsp;recursively&nbsp;called,&nbsp;then&nbsp;c1&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305391">//&nbsp;accurate&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305422">return</span>&nbsp;<span class="ident" id="3305429">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305436">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305440">//&nbsp;c1&nbsp;is&nbsp;accurate&nbsp;if&nbsp;it&nbsp;matches&nbsp;our&nbsp;assumed&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305502">return</span>&nbsp;<span class="ident" id="3305509"><a href="/html/template/escape.go.html#3305117">c</a></span><span class="op" id="3305510">.</span><span class="ident" id="3305511">eq</span><span class="op" id="3305513">(</span><span class="ident" id="3305514"><a href="/html/template/escape.go.html#3305197">c1</a></span><span class="op" id="3305516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305522">//&nbsp;We&nbsp;need&nbsp;to&nbsp;assume&nbsp;an&nbsp;output&nbsp;context&nbsp;so&nbsp;that&nbsp;recursive&nbsp;template&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305595">//&nbsp;take&nbsp;the&nbsp;fast&nbsp;path&nbsp;out&nbsp;of&nbsp;escapeTree&nbsp;instead&nbsp;of&nbsp;infinitely&nbsp;recursing.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305669">//&nbsp;Naively&nbsp;assuming&nbsp;that&nbsp;the&nbsp;input&nbsp;context&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305739">//&nbsp;works&nbsp;&gt;90%&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305767"><a href="/html/template/escape.go.html#3305086">e</a></span><span class="op" id="3305768">.</span><span class="ident" id="3305769">output</span><span class="op" id="3305775">[</span><span class="ident" id="3305776"><a href="/html/template/escape.go.html#3305128">t</a></span><span class="op" id="3305777">.</span><span class="ident" id="3305778">Name</span><span class="op" id="3305782">(</span><span class="op" id="3305783">)</span><span class="op" id="3305784">]</span>&nbsp;<span class="op" id="3305786">=</span>&nbsp;<span class="ident" id="3305788"><a href="/html/template/escape.go.html#3305117">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305791">return</span>&nbsp;<span class="ident" id="3305798"><a href="/html/template/escape.go.html#3305086">e</a></span><span class="op" id="3305799">.</span><span class="ident" id="3305800">escapeListConditionally</span><span class="op" id="3305823">(</span><span class="ident" id="3305824"><a href="/html/template/escape.go.html#3305117">c</a></span><span class="op" id="3305825">,</span>&nbsp;<span class="ident" id="3305827"><a href="/html/template/escape.go.html#3305128">t</a></span><span class="op" id="3305828">.</span><span class="ident" id="3305829">Tree</span><span class="op" id="3305833">.</span><span class="ident" id="3305834">Root</span><span class="op" id="3305838">,</span>&nbsp;<span class="ident" id="3305840"><a href="/html/template/escape.go.html#3305169">filter</a></span><span class="op" id="3305846">)</span><br>
<span class="lineno"></span><span class="op" id="3305848">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3305851">//&nbsp;delimEnds&nbsp;maps&nbsp;each&nbsp;delim&nbsp;to&nbsp;a&nbsp;string&nbsp;of&nbsp;characters&nbsp;that&nbsp;terminate&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3305925">var</span>&nbsp;<span class="ident" id="3305929">delimEnds</span>&nbsp;<span class="op" id="3305939">=</span>&nbsp;<span class="op" id="3305941">[</span><span class="op" id="3305942">...</span><span class="op" id="3305945">]</span><span class="builtintype" id="3305946">string</span><span class="op" id="3305952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305955"><a href="/html/template/context.go.html#3263046">delimDoubleQuote</a></span><span class="op" id="3305971">:</span>&nbsp;<span class="string" id="3305973">`&#34;`</span><span class="op" id="3305976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305979"><a href="/html/template/context.go.html#3263138">delimSingleQuote</a></span><span class="op" id="3305995">:</span>&nbsp;<span class="string" id="3305997">&#34;&#39;&#34;</span><span class="op" id="3306000">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306003">//&nbsp;Determined&nbsp;empirically&nbsp;by&nbsp;running&nbsp;the&nbsp;below&nbsp;in&nbsp;various&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306072">//&nbsp;var&nbsp;div&nbsp;=&nbsp;document.createElement(&#34;DIV&#34;);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306117">//&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306157">//&nbsp;&nbsp;&nbsp;div.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=x&#34;&nbsp;+&nbsp;String.fromCharCode(i)&nbsp;+&nbsp;&#34;-bar&gt;&#34;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306231">//&nbsp;&nbsp;&nbsp;if&nbsp;(div.getElementsByTagName(&#34;SPAN&#34;)[0].title.indexOf(&#34;bar&#34;)&nbsp;&lt;&nbsp;0)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306303">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.write(&#34;&lt;p&gt;U+&#34;&nbsp;+&nbsp;i.toString(16));</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306353">//&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306359"><a href="/html/template/context.go.html#3263252">delimSpaceOrTagEnd</a></span><span class="op" id="3306377">:</span>&nbsp;<span class="string" id="3306379">&#34;&nbsp;\t\n\f\r&gt;&#34;</span><span class="op" id="3306391">,</span><br>
<span class="lineno"></span><span class="op" id="3306393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="3306396">var</span>&nbsp;<span class="ident" id="3306400">doctypeBytes</span>&nbsp;<span class="op" id="3306413">=</span>&nbsp;<span class="op" id="3306415">[</span><span class="op" id="3306416">]</span><span class="builtintype" id="3306417">byte</span><span class="op" id="3306421">(</span><span class="string" id="3306422">&#34;&lt;!DOCTYPE&#34;</span><span class="op" id="3306433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3306436">//&nbsp;escapeText&nbsp;escapes&nbsp;a&nbsp;text&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3306480">func</span>&nbsp;<span class="op" id="3306485">(</span><span class="ident" id="3306486">e</span>&nbsp;<span class="op" id="3306488">*</span><span class="ident" id="3306489"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3306496">)</span>&nbsp;<span class="ident" id="3306498">escapeText</span><span class="op" id="3306508">(</span><span class="ident" id="3306509">c</span>&nbsp;<span class="ident" id="3306511"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3306518">,</span>&nbsp;<span class="ident" id="3306520">n</span>&nbsp;<span class="op" id="3306522">*</span><span class="ident" id="3306523"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3306528">.</span><span class="ident" id="3306529">TextNode</span><span class="op" id="3306537">)</span>&nbsp;<span class="ident" id="3306539"><a href="/html/template/context.go.html#3257317">context</a></span>&nbsp;<span class="op" id="3306547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306550">s</span><span class="op" id="3306551">,</span>&nbsp;<span class="ident" id="3306553">written</span><span class="op" id="3306560">,</span>&nbsp;<span class="ident" id="3306562">i</span><span class="op" id="3306563">,</span>&nbsp;<span class="ident" id="3306565">b</span>&nbsp;<span class="op" id="3306567">:=</span>&nbsp;<span class="ident" id="3306570"><a href="/html/template/escape.go.html#3306520">n</a></span><span class="op" id="3306571">.</span><span class="ident" id="3306572">Text</span><span class="op" id="3306576">,</span>&nbsp;<span class="num" id="3306578">0</span><span class="op" id="3306579">,</span>&nbsp;<span class="num" id="3306581">0</span><span class="op" id="3306582">,</span>&nbsp;<span class="builtinfunc" id="3306584">new</span><span class="op" id="3306587">(</span><span class="ident" id="3306588"><a href="/html/template/escape.go.html#3288221">bytes</a></span><span class="op" id="3306593">.</span><span class="ident" id="3306594">Buffer</span><span class="op" id="3306600">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306603">for</span>&nbsp;<span class="ident" id="3306607"><a href="/html/template/escape.go.html#3306562">i</a></span>&nbsp;<span class="op" id="3306609">!=</span>&nbsp;<span class="builtinfunc" id="3306612">len</span><span class="op" id="3306615">(</span><span class="ident" id="3306616"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3306617">)</span>&nbsp;<span class="op" id="3306619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306623">c1</span><span class="op" id="3306625">,</span>&nbsp;<span class="ident" id="3306627">nread</span>&nbsp;<span class="op" id="3306633">:=</span>&nbsp;<span class="ident" id="3306636"><a href="/html/template/escape.go.html#3308464">contextAfterText</a></span><span class="op" id="3306652">(</span><span class="ident" id="3306653"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3306654">,</span>&nbsp;<span class="ident" id="3306656"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3306657">[</span><span class="ident" id="3306658"><a href="/html/template/escape.go.html#3306562">i</a></span><span class="op" id="3306659">:</span><span class="op" id="3306660">]</span><span class="op" id="3306661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306665">i1</span>&nbsp;<span class="op" id="3306668">:=</span>&nbsp;<span class="ident" id="3306671"><a href="/html/template/escape.go.html#3306562">i</a></span>&nbsp;<span class="op" id="3306673">+</span>&nbsp;<span class="ident" id="3306675"><a href="/html/template/escape.go.html#3306627">nread</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306683">if</span>&nbsp;<span class="ident" id="3306686"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3306687">.</span><span class="ident" id="3306688">state</span>&nbsp;<span class="op" id="3306694">==</span>&nbsp;<span class="ident" id="3306697"><a href="/html/template/context.go.html#3259212">stateText</a></span>&nbsp;<span class="op" id="3306707">||</span>&nbsp;<span class="ident" id="3306710"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3306711">.</span><span class="ident" id="3306712">state</span>&nbsp;<span class="op" id="3306718">==</span>&nbsp;<span class="ident" id="3306721"><a href="/html/template/context.go.html#3259936">stateRCDATA</a></span>&nbsp;<span class="op" id="3306733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306738">end</span>&nbsp;<span class="op" id="3306742">:=</span>&nbsp;<span class="ident" id="3306745"><a href="/html/template/escape.go.html#3306665">i1</a></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306751">if</span>&nbsp;<span class="ident" id="3306754"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3306756">.</span><span class="ident" id="3306757">state</span>&nbsp;<span class="op" id="3306763">!=</span>&nbsp;<span class="ident" id="3306766"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3306767">.</span><span class="ident" id="3306768">state</span>&nbsp;<span class="op" id="3306774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306780">for</span>&nbsp;<span class="ident" id="3306784">j</span>&nbsp;<span class="op" id="3306786">:=</span>&nbsp;<span class="ident" id="3306789"><a href="/html/template/escape.go.html#3306738">end</a></span>&nbsp;<span class="op" id="3306793">-</span>&nbsp;<span class="num" id="3306795">1</span><span class="op" id="3306796">;</span>&nbsp;<span class="ident" id="3306798"><a href="/html/template/escape.go.html#3306784">j</a></span>&nbsp;<span class="op" id="3306800">&gt;=</span>&nbsp;<span class="ident" id="3306803"><a href="/html/template/escape.go.html#3306562">i</a></span><span class="op" id="3306804">;</span>&nbsp;<span class="ident" id="3306806"><a href="/html/template/escape.go.html#3306784">j</a></span><span class="op" id="3306807">--</span>&nbsp;<span class="op" id="3306810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306817">if</span>&nbsp;<span class="ident" id="3306820"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3306821">[</span><span class="ident" id="3306822"><a href="/html/template/escape.go.html#3306784">j</a></span><span class="op" id="3306823">]</span>&nbsp;<span class="op" id="3306825">==</span>&nbsp;<span class="string" id="3306828">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3306832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306840"><a href="/html/template/escape.go.html#3306738">end</a></span>&nbsp;<span class="op" id="3306844">=</span>&nbsp;<span class="ident" id="3306846"><a href="/html/template/escape.go.html#3306784">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306854">break</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306881">for</span>&nbsp;<span class="ident" id="3306885">j</span>&nbsp;<span class="op" id="3306887">:=</span>&nbsp;<span class="ident" id="3306890"><a href="/html/template/escape.go.html#3306562">i</a></span><span class="op" id="3306891">;</span>&nbsp;<span class="ident" id="3306893"><a href="/html/template/escape.go.html#3306885">j</a></span>&nbsp;<span class="op" id="3306895">&lt;</span>&nbsp;<span class="ident" id="3306897"><a href="/html/template/escape.go.html#3306738">end</a></span><span class="op" id="3306900">;</span>&nbsp;<span class="ident" id="3306902"><a href="/html/template/escape.go.html#3306885">j</a></span><span class="op" id="3306903">++</span>&nbsp;<span class="op" id="3306906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306912">if</span>&nbsp;<span class="ident" id="3306915"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3306916">[</span><span class="ident" id="3306917"><a href="/html/template/escape.go.html#3306885">j</a></span><span class="op" id="3306918">]</span>&nbsp;<span class="op" id="3306920">==</span>&nbsp;<span class="string" id="3306923">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3306927">&amp;&amp;</span>&nbsp;<span class="op" id="3306930">!</span><span class="ident" id="3306931"><a href="/html/template/escape.go.html#3288221">bytes</a></span><span class="op" id="3306936">.</span><span class="ident" id="3306937">HasPrefix</span><span class="op" id="3306946">(</span><span class="ident" id="3306947"><a href="/html/template/escape.go.html#3288221">bytes</a></span><span class="op" id="3306952">.</span><span class="ident" id="3306953">ToUpper</span><span class="op" id="3306960">(</span><span class="ident" id="3306961"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3306962">[</span><span class="ident" id="3306963"><a href="/html/template/escape.go.html#3306885">j</a></span><span class="op" id="3306964">:</span><span class="op" id="3306965">]</span><span class="op" id="3306966">)</span><span class="op" id="3306967">,</span>&nbsp;<span class="ident" id="3306969"><a href="/html/template/escape.go.html#3306400">doctypeBytes</a></span><span class="op" id="3306981">)</span>&nbsp;<span class="op" id="3306983">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306990"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3306991">.</span><span class="ident" id="3306992">Write</span><span class="op" id="3306997">(</span><span class="ident" id="3306998"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3306999">[</span><span class="ident" id="3307000"><a href="/html/template/escape.go.html#3306553">written</a></span><span class="op" id="3307007">:</span><span class="ident" id="3307008"><a href="/html/template/escape.go.html#3306885">j</a></span><span class="op" id="3307009">]</span><span class="op" id="3307010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307017"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3307018">.</span><span class="ident" id="3307019">WriteString</span><span class="op" id="3307030">(</span><span class="string" id="3307031">&#34;&amp;lt;&#34;</span><span class="op" id="3307037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307044"><a href="/html/template/escape.go.html#3306553">written</a></span>&nbsp;<span class="op" id="3307052">=</span>&nbsp;<span class="ident" id="3307054"><a href="/html/template/escape.go.html#3306885">j</a></span>&nbsp;<span class="op" id="3307056">+</span>&nbsp;<span class="num" id="3307058">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307069">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307073">}</span>&nbsp;<span class="keyword" id="3307075">else</span>&nbsp;<span class="keyword" id="3307080">if</span>&nbsp;<span class="ident" id="3307083"><a href="/html/template/context.go.html#3262436">isComment</a></span><span class="op" id="3307092">(</span><span class="ident" id="3307093"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3307094">.</span><span class="ident" id="3307095">state</span><span class="op" id="3307100">)</span>&nbsp;<span class="op" id="3307102">&amp;&amp;</span>&nbsp;<span class="ident" id="3307105"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3307106">.</span><span class="ident" id="3307107">delim</span>&nbsp;<span class="op" id="3307113">==</span>&nbsp;<span class="ident" id="3307116"><a href="/html/template/context.go.html#3262948">delimNone</a></span>&nbsp;<span class="op" id="3307126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307131">switch</span>&nbsp;<span class="ident" id="3307138"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3307139">.</span><span class="ident" id="3307140">state</span>&nbsp;<span class="op" id="3307146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307151">case</span>&nbsp;<span class="ident" id="3307156"><a href="/html/template/context.go.html#3260483">stateJSBlockCmt</a></span><span class="op" id="3307171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307177">//&nbsp;http://es5.github.com/#x7.4:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307213">//&nbsp;&#34;Comments&nbsp;behave&nbsp;like&nbsp;white&nbsp;space&nbsp;and&nbsp;are</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307262">//&nbsp;discarded&nbsp;except&nbsp;that,&nbsp;if&nbsp;a&nbsp;MultiLineComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307314">//&nbsp;contains&nbsp;a&nbsp;line&nbsp;terminator&nbsp;character,&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307364">//&nbsp;the&nbsp;entire&nbsp;comment&nbsp;is&nbsp;considered&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307412">//&nbsp;LineTerminator&nbsp;for&nbsp;purposes&nbsp;of&nbsp;parsing&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307461">//&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307492">if</span>&nbsp;<span class="ident" id="3307495"><a href="/html/template/escape.go.html#3288221">bytes</a></span><span class="op" id="3307500">.</span><span class="ident" id="3307501">IndexAny</span><span class="op" id="3307509">(</span><span class="ident" id="3307510"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3307511">[</span><span class="ident" id="3307512"><a href="/html/template/escape.go.html#3306553">written</a></span><span class="op" id="3307519">:</span><span class="ident" id="3307520"><a href="/html/template/escape.go.html#3306665">i1</a></span><span class="op" id="3307522">]</span><span class="op" id="3307523">,</span>&nbsp;<span class="string" id="3307525">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="3307543">)</span>&nbsp;<span class="op" id="3307545">!=</span>&nbsp;<span class="op" id="3307548">-</span><span class="num" id="3307549">1</span>&nbsp;<span class="op" id="3307551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307558"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3307559">.</span><span class="ident" id="3307560">WriteByte</span><span class="op" id="3307569">(</span><span class="string" id="3307570">&#39;\n&#39;</span><span class="op" id="3307574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307580">}</span>&nbsp;<span class="keyword" id="3307582">else</span>&nbsp;<span class="op" id="3307587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307594"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3307595">.</span><span class="ident" id="3307596">WriteByte</span><span class="op" id="3307605">(</span><span class="string" id="3307606">&#39;&nbsp;&#39;</span><span class="op" id="3307609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307615">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307620">case</span>&nbsp;<span class="ident" id="3307625"><a href="/html/template/context.go.html#3261092">stateCSSBlockCmt</a></span><span class="op" id="3307641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307647"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3307648">.</span><span class="ident" id="3307649">WriteByte</span><span class="op" id="3307658">(</span><span class="string" id="3307659">&#39;&nbsp;&#39;</span><span class="op" id="3307662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307672"><a href="/html/template/escape.go.html#3306553">written</a></span>&nbsp;<span class="op" id="3307680">=</span>&nbsp;<span class="ident" id="3307682"><a href="/html/template/escape.go.html#3306665">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307687">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307691">if</span>&nbsp;<span class="ident" id="3307694"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3307695">.</span><span class="ident" id="3307696">state</span>&nbsp;<span class="op" id="3307702">!=</span>&nbsp;<span class="ident" id="3307705"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3307707">.</span><span class="ident" id="3307708">state</span>&nbsp;<span class="op" id="3307714">&amp;&amp;</span>&nbsp;<span class="ident" id="3307717"><a href="/html/template/context.go.html#3262436">isComment</a></span><span class="op" id="3307726">(</span><span class="ident" id="3307727"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3307729">.</span><span class="ident" id="3307730">state</span><span class="op" id="3307735">)</span>&nbsp;<span class="op" id="3307737">&amp;&amp;</span>&nbsp;<span class="ident" id="3307740"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3307742">.</span><span class="ident" id="3307743">delim</span>&nbsp;<span class="op" id="3307749">==</span>&nbsp;<span class="ident" id="3307752"><a href="/html/template/context.go.html#3262948">delimNone</a></span>&nbsp;<span class="op" id="3307762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307767">//&nbsp;Preserve&nbsp;the&nbsp;portion&nbsp;between&nbsp;written&nbsp;and&nbsp;the&nbsp;comment&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307833">cs</span>&nbsp;<span class="op" id="3307836">:=</span>&nbsp;<span class="ident" id="3307839"><a href="/html/template/escape.go.html#3306665">i1</a></span>&nbsp;<span class="op" id="3307842">-</span>&nbsp;<span class="num" id="3307844">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307849">if</span>&nbsp;<span class="ident" id="3307852"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3307854">.</span><span class="ident" id="3307855">state</span>&nbsp;<span class="op" id="3307861">==</span>&nbsp;<span class="ident" id="3307864"><a href="/html/template/context.go.html#3259780">stateHTMLCmt</a></span>&nbsp;<span class="op" id="3307877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3307883">//&nbsp;&#34;&lt;!--&#34;&nbsp;instead&nbsp;of&nbsp;&#34;/*&#34;&nbsp;or&nbsp;&#34;//&#34;</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307921"><a href="/html/template/escape.go.html#3307833">cs</a></span>&nbsp;<span class="op" id="3307924">-=</span>&nbsp;<span class="num" id="3307927">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307937"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3307938">.</span><span class="ident" id="3307939">Write</span><span class="op" id="3307944">(</span><span class="ident" id="3307945"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3307946">[</span><span class="ident" id="3307947"><a href="/html/template/escape.go.html#3306553">written</a></span><span class="op" id="3307954">:</span><span class="ident" id="3307955"><a href="/html/template/escape.go.html#3307833">cs</a></span><span class="op" id="3307957">]</span><span class="op" id="3307958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307963"><a href="/html/template/escape.go.html#3306553">written</a></span>&nbsp;<span class="op" id="3307971">=</span>&nbsp;<span class="ident" id="3307973"><a href="/html/template/escape.go.html#3306665">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307978">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307982">if</span>&nbsp;<span class="ident" id="3307985"><a href="/html/template/escape.go.html#3306562">i</a></span>&nbsp;<span class="op" id="3307987">==</span>&nbsp;<span class="ident" id="3307990"><a href="/html/template/escape.go.html#3306665">i1</a></span>&nbsp;<span class="op" id="3307993">&amp;&amp;</span>&nbsp;<span class="ident" id="3307996"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3307997">.</span><span class="ident" id="3307998">state</span>&nbsp;<span class="op" id="3308004">==</span>&nbsp;<span class="ident" id="3308007"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3308009">.</span><span class="ident" id="3308010">state</span>&nbsp;<span class="op" id="3308016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3308021">panic</span><span class="op" id="3308026">(</span><span class="ident" id="3308027"><a href="/html/template/escape.go.html#3288230">fmt</a></span><span class="op" id="3308030">.</span><span class="ident" id="3308031">Sprintf</span><span class="op" id="3308038">(</span><span class="string" id="3308039">&#34;infinite&nbsp;loop&nbsp;from&nbsp;%v&nbsp;to&nbsp;%v&nbsp;on&nbsp;%q..%q&#34;</span><span class="op" id="3308078">,</span>&nbsp;<span class="ident" id="3308080"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3308081">,</span>&nbsp;<span class="ident" id="3308083"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3308085">,</span>&nbsp;<span class="ident" id="3308087"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3308088">[</span><span class="op" id="3308089">:</span><span class="ident" id="3308090"><a href="/html/template/escape.go.html#3306562">i</a></span><span class="op" id="3308091">]</span><span class="op" id="3308092">,</span>&nbsp;<span class="ident" id="3308094"><a href="/html/template/escape.go.html#3306550">s</a></span><span class="op" id="3308095">[</span><span class="ident" id="3308096"><a href="/html/template/escape.go.html#3306562">i</a></span><span class="op" id="3308097">:</span><span class="op" id="3308098">]</span><span class="op" id="3308099">)</span><span class="op" id="3308100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308108"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3308109">,</span>&nbsp;<span class="ident" id="3308111"><a href="/html/template/escape.go.html#3306562">i</a></span>&nbsp;<span class="op" id="3308113">=</span>&nbsp;<span class="ident" id="3308115"><a href="/html/template/escape.go.html#3306623">c1</a></span><span class="op" id="3308117">,</span>&nbsp;<span class="ident" id="3308119"><a href="/html/template/escape.go.html#3306665">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308123">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308127">if</span>&nbsp;<span class="ident" id="3308130"><a href="/html/template/escape.go.html#3306553">written</a></span>&nbsp;<span class="op" id="3308138">!=</span>&nbsp;<span class="num" id="3308141">0</span>&nbsp;<span class="op" id="3308143">&amp;&amp;</span>&nbsp;<span class="ident" id="3308146"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3308147">.</span><span class="ident" id="3308148">state</span>&nbsp;<span class="op" id="3308154">!=</span>&nbsp;<span class="ident" id="3308157"><a href="/html/template/context.go.html#3261273">stateError</a></span>&nbsp;<span class="op" id="3308168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308172">if</span>&nbsp;<span class="op" id="3308175">!</span><span class="ident" id="3308176"><a href="/html/template/context.go.html#3262436">isComment</a></span><span class="op" id="3308185">(</span><span class="ident" id="3308186"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3308187">.</span><span class="ident" id="3308188">state</span><span class="op" id="3308193">)</span>&nbsp;<span class="op" id="3308195">||</span>&nbsp;<span class="ident" id="3308198"><a href="/html/template/escape.go.html#3306509">c</a></span><span class="op" id="3308199">.</span><span class="ident" id="3308200">delim</span>&nbsp;<span class="op" id="3308206">!=</span>&nbsp;<span class="ident" id="3308209"><a href="/html/template/context.go.html#3262948">delimNone</a></span>&nbsp;<span class="op" id="3308219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308224"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3308225">.</span><span class="ident" id="3308226">Write</span><span class="op" id="3308231">(</span><span class="ident" id="3308232"><a href="/html/template/escape.go.html#3306520">n</a></span><span class="op" id="3308233">.</span><span class="ident" id="3308234">Text</span><span class="op" id="3308238">[</span><span class="ident" id="3308239"><a href="/html/template/escape.go.html#3306553">written</a></span><span class="op" id="3308246">:</span><span class="op" id="3308247">]</span><span class="op" id="3308248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308252">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308256"><a href="/html/template/escape.go.html#3306486">e</a></span><span class="op" id="3308257">.</span><span class="ident" id="3308258">editTextNode</span><span class="op" id="3308270">(</span><span class="ident" id="3308271"><a href="/html/template/escape.go.html#3306520">n</a></span><span class="op" id="3308272">,</span>&nbsp;<span class="ident" id="3308274"><a href="/html/template/escape.go.html#3306565">b</a></span><span class="op" id="3308275">.</span><span class="ident" id="3308276">Bytes</span><span class="op" id="3308281">(</span><span class="op" id="3308282">)</span><span class="op" id="3308283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308289">return</span>&nbsp;<span class="ident" id="3308296"><a href="/html/template/escape.go.html#3306509">c</a></span><br>
<span class="lineno"></span><span class="op" id="3308298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3308301">//&nbsp;contextAfterText&nbsp;starts&nbsp;in&nbsp;context&nbsp;c,&nbsp;consumes&nbsp;some&nbsp;tokens&nbsp;from&nbsp;the&nbsp;front&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3308381">//&nbsp;s,&nbsp;then&nbsp;returns&nbsp;the&nbsp;context&nbsp;after&nbsp;those&nbsp;tokens&nbsp;and&nbsp;the&nbsp;unprocessed&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="3308459">func</span>&nbsp;<span class="ident" id="3308464">contextAfterText</span><span class="op" id="3308480">(</span><span class="ident" id="3308481">c</span>&nbsp;<span class="ident" id="3308483"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3308490">,</span>&nbsp;<span class="ident" id="3308492">s</span>&nbsp;<span class="op" id="3308494">[</span><span class="op" id="3308495">]</span><span class="builtintype" id="3308496">byte</span><span class="op" id="3308500">)</span>&nbsp;<span class="op" id="3308502">(</span><span class="ident" id="3308503"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3308510">,</span>&nbsp;<span class="builtintype" id="3308512">int</span><span class="op" id="3308515">)</span>&nbsp;<span class="op" id="3308517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308520">if</span>&nbsp;<span class="ident" id="3308523"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3308524">.</span><span class="ident" id="3308525">delim</span>&nbsp;<span class="op" id="3308531">==</span>&nbsp;<span class="ident" id="3308534"><a href="/html/template/context.go.html#3262948">delimNone</a></span>&nbsp;<span class="op" id="3308544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308548">c1</span><span class="op" id="3308550">,</span>&nbsp;<span class="ident" id="3308552">i</span>&nbsp;<span class="op" id="3308554">:=</span>&nbsp;<span class="ident" id="3308557"><a href="/html/template/transition.go.html#3348079">tSpecialTagEnd</a></span><span class="op" id="3308571">(</span><span class="ident" id="3308572"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3308573">,</span>&nbsp;<span class="ident" id="3308575"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3308576">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308580">if</span>&nbsp;<span class="ident" id="3308583"><a href="/html/template/escape.go.html#3308552">i</a></span>&nbsp;<span class="op" id="3308585">==</span>&nbsp;<span class="num" id="3308588">0</span>&nbsp;<span class="op" id="3308590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3308595">//&nbsp;A&nbsp;special&nbsp;end&nbsp;tag&nbsp;(`&lt;/script&gt;`)&nbsp;has&nbsp;been&nbsp;seen&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3308651">//&nbsp;all&nbsp;content&nbsp;preceding&nbsp;it&nbsp;has&nbsp;been&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308701">return</span>&nbsp;<span class="ident" id="3308708"><a href="/html/template/escape.go.html#3308548">c1</a></span><span class="op" id="3308710">,</span>&nbsp;<span class="num" id="3308712">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308716">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3308720">//&nbsp;Consider&nbsp;all&nbsp;content&nbsp;up&nbsp;to&nbsp;any&nbsp;end&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308765">return</span>&nbsp;<span class="ident" id="3308772"><a href="/html/template/transition.go.html#3343607">transitionFunc</a></span><span class="op" id="3308786">[</span><span class="ident" id="3308787"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3308788">.</span><span class="ident" id="3308789">state</span><span class="op" id="3308794">]</span><span class="op" id="3308795">(</span><span class="ident" id="3308796"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3308797">,</span>&nbsp;<span class="ident" id="3308799"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3308800">[</span><span class="op" id="3308801">:</span><span class="ident" id="3308802"><a href="/html/template/escape.go.html#3308552">i</a></span><span class="op" id="3308803">]</span><span class="op" id="3308804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308811">i</span>&nbsp;<span class="op" id="3308813">:=</span>&nbsp;<span class="ident" id="3308816"><a href="/html/template/escape.go.html#3288221">bytes</a></span><span class="op" id="3308821">.</span><span class="ident" id="3308822">IndexAny</span><span class="op" id="3308830">(</span><span class="ident" id="3308831"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3308832">,</span>&nbsp;<span class="ident" id="3308834"><a href="/html/template/escape.go.html#3305929">delimEnds</a></span><span class="op" id="3308843">[</span><span class="ident" id="3308844"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3308845">.</span><span class="ident" id="3308846">delim</span><span class="op" id="3308851">]</span><span class="op" id="3308852">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308855">if</span>&nbsp;<span class="ident" id="3308858"><a href="/html/template/escape.go.html#3308811">i</a></span>&nbsp;<span class="op" id="3308860">==</span>&nbsp;<span class="op" id="3308863">-</span><span class="num" id="3308864">1</span>&nbsp;<span class="op" id="3308866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308870"><a href="/html/template/escape.go.html#3308811">i</a></span>&nbsp;<span class="op" id="3308872">=</span>&nbsp;<span class="builtinfunc" id="3308874">len</span><span class="op" id="3308877">(</span><span class="ident" id="3308878"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3308879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308885">if</span>&nbsp;<span class="ident" id="3308888"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3308889">.</span><span class="ident" id="3308890">delim</span>&nbsp;<span class="op" id="3308896">==</span>&nbsp;<span class="ident" id="3308899"><a href="/html/template/context.go.html#3263252">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="3308918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3308922">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3308999">//&nbsp;lists&nbsp;the&nbsp;runes&nbsp;below&nbsp;as&nbsp;error&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309047">//&nbsp;Error&nbsp;out&nbsp;because&nbsp;HTML&nbsp;parsers&nbsp;may&nbsp;differ&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309105">//&nbsp;&#34;&lt;a&nbsp;id=&nbsp;onclick=f(&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;inside&nbsp;id&#39;s&nbsp;or&nbsp;onclick&#39;s&nbsp;value,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309171">//&nbsp;&#34;&lt;a&nbsp;class=`foo&nbsp;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;inside&nbsp;a&nbsp;value,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309221">//&nbsp;&#34;&lt;a&nbsp;style=font:&#39;Arial&#39;&#34;&nbsp;needs&nbsp;open-quote&nbsp;fixup.</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309274">//&nbsp;IE&nbsp;treats&nbsp;&#39;`&#39;&nbsp;as&nbsp;a&nbsp;quotation&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309319">if</span>&nbsp;<span class="ident" id="3309322">j</span>&nbsp;<span class="op" id="3309324">:=</span>&nbsp;<span class="ident" id="3309327"><a href="/html/template/escape.go.html#3288221">bytes</a></span><span class="op" id="3309332">.</span><span class="ident" id="3309333">IndexAny</span><span class="op" id="3309341">(</span><span class="ident" id="3309342"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309343">[</span><span class="op" id="3309344">:</span><span class="ident" id="3309345"><a href="/html/template/escape.go.html#3308811">i</a></span><span class="op" id="3309346">]</span><span class="op" id="3309347">,</span>&nbsp;<span class="string" id="3309349">&#34;\&#34;&#39;&lt;=`&#34;</span><span class="op" id="3309357">)</span><span class="op" id="3309358">;</span>&nbsp;<span class="ident" id="3309360"><a href="/html/template/escape.go.html#3309322">j</a></span>&nbsp;<span class="op" id="3309362">&gt;=</span>&nbsp;<span class="num" id="3309365">0</span>&nbsp;<span class="op" id="3309367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309372">return</span>&nbsp;<span class="ident" id="3309379"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3309386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309392">state</span><span class="op" id="3309397">:</span>&nbsp;<span class="ident" id="3309399"><a href="/html/template/context.go.html#3261273">stateError</a></span><span class="op" id="3309409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309415">err</span><span class="op" id="3309418">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3309422"><a href="/html/template/error.go.html#3287884">errorf</a></span><span class="op" id="3309428">(</span><span class="ident" id="3309429"><a href="/html/template/error.go.html#3282823">ErrBadHTML</a></span><span class="op" id="3309439">,</span>&nbsp;<span class="ident" id="3309441">nil</span><span class="op" id="3309444">,</span>&nbsp;<span class="num" id="3309446">0</span><span class="op" id="3309447">,</span>&nbsp;<span class="string" id="3309449">&#34;%q&nbsp;in&nbsp;unquoted&nbsp;attr:&nbsp;%q&#34;</span><span class="op" id="3309474">,</span>&nbsp;<span class="ident" id="3309476"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309477">[</span><span class="ident" id="3309478"><a href="/html/template/escape.go.html#3309322">j</a></span><span class="op" id="3309479">:</span><span class="ident" id="3309480"><a href="/html/template/escape.go.html#3309322">j</a></span><span class="op" id="3309481">+</span><span class="num" id="3309482">1</span><span class="op" id="3309483">]</span><span class="op" id="3309484">,</span>&nbsp;<span class="ident" id="3309486"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309487">[</span><span class="op" id="3309488">:</span><span class="ident" id="3309489"><a href="/html/template/escape.go.html#3308811">i</a></span><span class="op" id="3309490">]</span><span class="op" id="3309491">)</span><span class="op" id="3309492">,</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309497">}</span><span class="op" id="3309498">,</span>&nbsp;<span class="builtinfunc" id="3309500">len</span><span class="op" id="3309503">(</span><span class="ident" id="3309504"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309515">if</span>&nbsp;<span class="ident" id="3309518"><a href="/html/template/escape.go.html#3308811">i</a></span>&nbsp;<span class="op" id="3309520">==</span>&nbsp;<span class="builtinfunc" id="3309523">len</span><span class="op" id="3309526">(</span><span class="ident" id="3309527"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309528">)</span>&nbsp;<span class="op" id="3309530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309534">//&nbsp;Remain&nbsp;inside&nbsp;the&nbsp;attribute.</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309568">//&nbsp;Decode&nbsp;the&nbsp;value&nbsp;so&nbsp;non-HTML&nbsp;rules&nbsp;can&nbsp;easily&nbsp;handle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309626">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;onclick=&#34;alert(&amp;quot;Hi!&amp;quot;)&#34;&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309677">//&nbsp;without&nbsp;having&nbsp;to&nbsp;entity&nbsp;decode&nbsp;token&nbsp;boundaries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309732">for</span>&nbsp;<span class="ident" id="3309736">u</span>&nbsp;<span class="op" id="3309738">:=</span>&nbsp;<span class="op" id="3309741">[</span><span class="op" id="3309742">]</span><span class="builtintype" id="3309743">byte</span><span class="op" id="3309747">(</span><span class="ident" id="3309748"><a href="/html/template/escape.go.html#3288237">html</a></span><span class="op" id="3309752">.</span><span class="ident" id="3309753">UnescapeString</span><span class="op" id="3309767">(</span><span class="builtintype" id="3309768">string</span><span class="op" id="3309774">(</span><span class="ident" id="3309775"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309776">)</span><span class="op" id="3309777">)</span><span class="op" id="3309778">)</span><span class="op" id="3309779">;</span>&nbsp;<span class="builtinfunc" id="3309781">len</span><span class="op" id="3309784">(</span><span class="ident" id="3309785"><a href="/html/template/escape.go.html#3309736">u</a></span><span class="op" id="3309786">)</span>&nbsp;<span class="op" id="3309788">!=</span>&nbsp;<span class="num" id="3309791">0</span><span class="op" id="3309792">;</span>&nbsp;<span class="op" id="3309794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309799">c1</span><span class="op" id="3309801">,</span>&nbsp;<span class="ident" id="3309803">i1</span>&nbsp;<span class="op" id="3309806">:=</span>&nbsp;<span class="ident" id="3309809"><a href="/html/template/transition.go.html#3343607">transitionFunc</a></span><span class="op" id="3309823">[</span><span class="ident" id="3309824"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3309825">.</span><span class="ident" id="3309826">state</span><span class="op" id="3309831">]</span><span class="op" id="3309832">(</span><span class="ident" id="3309833"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3309834">,</span>&nbsp;<span class="ident" id="3309836"><a href="/html/template/escape.go.html#3309736">u</a></span><span class="op" id="3309837">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309842"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3309843">,</span>&nbsp;<span class="ident" id="3309845"><a href="/html/template/escape.go.html#3309736">u</a></span>&nbsp;<span class="op" id="3309847">=</span>&nbsp;<span class="ident" id="3309849"><a href="/html/template/escape.go.html#3309799">c1</a></span><span class="op" id="3309851">,</span>&nbsp;<span class="ident" id="3309853"><a href="/html/template/escape.go.html#3309736">u</a></span><span class="op" id="3309854">[</span><span class="ident" id="3309855"><a href="/html/template/escape.go.html#3309803">i1</a></span><span class="op" id="3309857">:</span><span class="op" id="3309858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309866">return</span>&nbsp;<span class="ident" id="3309873"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3309874">,</span>&nbsp;<span class="builtinfunc" id="3309876">len</span><span class="op" id="3309879">(</span><span class="ident" id="3309880"><a href="/html/template/escape.go.html#3308492">s</a></span><span class="op" id="3309881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309887">if</span>&nbsp;<span class="ident" id="3309890"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3309891">.</span><span class="ident" id="3309892">delim</span>&nbsp;<span class="op" id="3309898">!=</span>&nbsp;<span class="ident" id="3309901"><a href="/html/template/context.go.html#3263252">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="3309920">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309924">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309948"><a href="/html/template/escape.go.html#3308811">i</a></span><span class="op" id="3309949">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3309956">//&nbsp;On&nbsp;exiting&nbsp;an&nbsp;attribute,&nbsp;we&nbsp;discard&nbsp;all&nbsp;state&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3310018">//&nbsp;except&nbsp;the&nbsp;state&nbsp;and&nbsp;element.</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310052">return</span>&nbsp;<span class="ident" id="3310059"><a href="/html/template/context.go.html#3257317">context</a></span><span class="op" id="3310066">{</span><span class="ident" id="3310067">state</span><span class="op" id="3310072">:</span>&nbsp;<span class="ident" id="3310074"><a href="/html/template/context.go.html#3259302">stateTag</a></span><span class="op" id="3310082">,</span>&nbsp;<span class="ident" id="3310084">element</span><span class="op" id="3310091">:</span>&nbsp;<span class="ident" id="3310093"><a href="/html/template/escape.go.html#3308481">c</a></span><span class="op" id="3310094">.</span><span class="ident" id="3310095">element</span><span class="op" id="3310102">}</span><span class="op" id="3310103">,</span>&nbsp;<span class="ident" id="3310105"><a href="/html/template/escape.go.html#3308811">i</a></span><br>
<span class="lineno"></span><span class="op" id="3310107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310110">//&nbsp;editActionNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;an&nbsp;action&nbsp;pipeline&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno"></span><span class="keyword" id="3310185">func</span>&nbsp;<span class="op" id="3310190">(</span><span class="ident" id="3310191">e</span>&nbsp;<span class="op" id="3310193">*</span><span class="ident" id="3310194"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3310201">)</span>&nbsp;<span class="ident" id="3310203">editActionNode</span><span class="op" id="3310217">(</span><span class="ident" id="3310218">n</span>&nbsp;<span class="op" id="3310220">*</span><span class="ident" id="3310221"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3310226">.</span><span class="ident" id="3310227">ActionNode</span><span class="op" id="3310237">,</span>&nbsp;<span class="ident" id="3310239">cmds</span>&nbsp;<span class="op" id="3310244">[</span><span class="op" id="3310245">]</span><span class="builtintype" id="3310246">string</span><span class="op" id="3310252">)</span>&nbsp;<span class="op" id="3310254">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310257">if</span>&nbsp;<span class="ident" id="3310260">_</span><span class="op" id="3310261">,</span>&nbsp;<span class="ident" id="3310263">ok</span>&nbsp;<span class="op" id="3310266">:=</span>&nbsp;<span class="ident" id="3310269"><a href="/html/template/escape.go.html#3310191">e</a></span><span class="op" id="3310270">.</span><span class="ident" id="3310271">actionNodeEdits</span><span class="op" id="3310286">[</span><span class="ident" id="3310287"><a href="/html/template/escape.go.html#3310218">n</a></span><span class="op" id="3310288">]</span><span class="op" id="3310289">;</span>&nbsp;<span class="ident" id="3310291"><a href="/html/template/escape.go.html#3310263">ok</a></span>&nbsp;<span class="op" id="3310294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3310298">panic</span><span class="op" id="3310303">(</span><span class="ident" id="3310304"><a href="/html/template/escape.go.html#3288230">fmt</a></span><span class="op" id="3310307">.</span><span class="ident" id="3310308">Sprintf</span><span class="op" id="3310315">(</span><span class="string" id="3310316">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="3310350">,</span>&nbsp;<span class="ident" id="3310352"><a href="/html/template/escape.go.html#3310218">n</a></span><span class="op" id="3310353">)</span><span class="op" id="3310354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310360"><a href="/html/template/escape.go.html#3310191">e</a></span><span class="op" id="3310361">.</span><span class="ident" id="3310362">actionNodeEdits</span><span class="op" id="3310377">[</span><span class="ident" id="3310378"><a href="/html/template/escape.go.html#3310218">n</a></span><span class="op" id="3310379">]</span>&nbsp;<span class="op" id="3310381">=</span>&nbsp;<span class="ident" id="3310383"><a href="/html/template/escape.go.html#3310239">cmds</a></span><br>
<span class="lineno"></span><span class="op" id="3310388">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="3310391">//&nbsp;editTemplateNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;a&nbsp;{{template}}&nbsp;callee&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno"></span><span class="keyword" id="3310471">func</span>&nbsp;<span class="op" id="3310476">(</span><span class="ident" id="3310477">e</span>&nbsp;<span class="op" id="3310479">*</span><span class="ident" id="3310480"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3310487">)</span>&nbsp;<span class="ident" id="3310489">editTemplateNode</span><span class="op" id="3310505">(</span><span class="ident" id="3310506">n</span>&nbsp;<span class="op" id="3310508">*</span><span class="ident" id="3310509"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3310514">.</span><span class="ident" id="3310515">TemplateNode</span><span class="op" id="3310527">,</span>&nbsp;<span class="ident" id="3310529">callee</span>&nbsp;<span class="builtintype" id="3310536">string</span><span class="op" id="3310542">)</span>&nbsp;<span class="op" id="3310544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310547">if</span>&nbsp;<span class="ident" id="3310550">_</span><span class="op" id="3310551">,</span>&nbsp;<span class="ident" id="3310553">ok</span>&nbsp;<span class="op" id="3310556">:=</span>&nbsp;<span class="ident" id="3310559"><a href="/html/template/escape.go.html#3310477">e</a></span><span class="op" id="3310560">.</span><span class="ident" id="3310561">templateNodeEdits</span><span class="op" id="3310578">[</span><span class="ident" id="3310579"><a href="/html/template/escape.go.html#3310506">n</a></span><span class="op" id="3310580">]</span><span class="op" id="3310581">;</span>&nbsp;<span class="ident" id="3310583"><a href="/html/template/escape.go.html#3310553">ok</a></span>&nbsp;<span class="op" id="3310586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3310590">panic</span><span class="op" id="3310595">(</span><span class="ident" id="3310596"><a href="/html/template/escape.go.html#3288230">fmt</a></span><span class="op" id="3310599">.</span><span class="ident" id="3310600">Sprintf</span><span class="op" id="3310607">(</span><span class="string" id="3310608">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="3310642">,</span>&nbsp;<span class="ident" id="3310644"><a href="/html/template/escape.go.html#3310506">n</a></span><span class="op" id="3310645">)</span><span class="op" id="3310646">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310652"><a href="/html/template/escape.go.html#3310477">e</a></span><span class="op" id="3310653">.</span><span class="ident" id="3310654">templateNodeEdits</span><span class="op" id="3310671">[</span><span class="ident" id="3310672"><a href="/html/template/escape.go.html#3310506">n</a></span><span class="op" id="3310673">]</span>&nbsp;<span class="op" id="3310675">=</span>&nbsp;<span class="ident" id="3310677"><a href="/html/template/escape.go.html#3310529">callee</a></span><br>
<span class="lineno"></span><span class="op" id="3310684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310687">//&nbsp;editTextNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;a&nbsp;text&nbsp;node&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno">730</span><span class="keyword" id="3310753">func</span>&nbsp;<span class="op" id="3310758">(</span><span class="ident" id="3310759">e</span>&nbsp;<span class="op" id="3310761">*</span><span class="ident" id="3310762"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3310769">)</span>&nbsp;<span class="ident" id="3310771">editTextNode</span><span class="op" id="3310783">(</span><span class="ident" id="3310784">n</span>&nbsp;<span class="op" id="3310786">*</span><span class="ident" id="3310787"><a href="/html/template/escape.go.html#3288268">parse</a></span><span class="op" id="3310792">.</span><span class="ident" id="3310793">TextNode</span><span class="op" id="3310801">,</span>&nbsp;<span class="ident" id="3310803">text</span>&nbsp;<span class="op" id="3310808">[</span><span class="op" id="3310809">]</span><span class="builtintype" id="3310810">byte</span><span class="op" id="3310814">)</span>&nbsp;<span class="op" id="3310816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310819">if</span>&nbsp;<span class="ident" id="3310822">_</span><span class="op" id="3310823">,</span>&nbsp;<span class="ident" id="3310825">ok</span>&nbsp;<span class="op" id="3310828">:=</span>&nbsp;<span class="ident" id="3310831"><a href="/html/template/escape.go.html#3310759">e</a></span><span class="op" id="3310832">.</span><span class="ident" id="3310833">textNodeEdits</span><span class="op" id="3310846">[</span><span class="ident" id="3310847"><a href="/html/template/escape.go.html#3310784">n</a></span><span class="op" id="3310848">]</span><span class="op" id="3310849">;</span>&nbsp;<span class="ident" id="3310851"><a href="/html/template/escape.go.html#3310825">ok</a></span>&nbsp;<span class="op" id="3310854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3310858">panic</span><span class="op" id="3310863">(</span><span class="ident" id="3310864"><a href="/html/template/escape.go.html#3288230">fmt</a></span><span class="op" id="3310867">.</span><span class="ident" id="3310868">Sprintf</span><span class="op" id="3310875">(</span><span class="string" id="3310876">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="3310910">,</span>&nbsp;<span class="ident" id="3310912"><a href="/html/template/escape.go.html#3310784">n</a></span><span class="op" id="3310913">)</span><span class="op" id="3310914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310920"><a href="/html/template/escape.go.html#3310759">e</a></span><span class="op" id="3310921">.</span><span class="ident" id="3310922">textNodeEdits</span><span class="op" id="3310935">[</span><span class="ident" id="3310936"><a href="/html/template/escape.go.html#3310784">n</a></span><span class="op" id="3310937">]</span>&nbsp;<span class="op" id="3310939">=</span>&nbsp;<span class="ident" id="3310941"><a href="/html/template/escape.go.html#3310803">text</a></span><br>
<span class="lineno">735</span><span class="op" id="3310946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310949">//&nbsp;commit&nbsp;applies&nbsp;changes&nbsp;to&nbsp;actions&nbsp;and&nbsp;template&nbsp;calls&nbsp;needed&nbsp;to&nbsp;contextually</span><br>
<span class="lineno"></span><span class="comment" id="3311028">//&nbsp;autoescape&nbsp;content&nbsp;and&nbsp;adds&nbsp;any&nbsp;derived&nbsp;templates&nbsp;to&nbsp;the&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3311093">func</span>&nbsp;<span class="op" id="3311098">(</span><span class="ident" id="3311099">e</span>&nbsp;<span class="op" id="3311101">*</span><span class="ident" id="3311102"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3311109">)</span>&nbsp;<span class="ident" id="3311111">commit</span><span class="op" id="3311117">(</span><span class="op" id="3311118">)</span>&nbsp;<span class="op" id="3311120">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311123">for</span>&nbsp;<span class="ident" id="3311127">name</span>&nbsp;<span class="op" id="3311132">:=</span>&nbsp;<span class="keyword" id="3311135">range</span>&nbsp;<span class="ident" id="3311141"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311142">.</span><span class="ident" id="3311143">output</span>&nbsp;<span class="op" id="3311150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311154"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311155">.</span><span class="ident" id="3311156">template</span><span class="op" id="3311164">(</span><span class="ident" id="3311165"><a href="/html/template/escape.go.html#3311127">name</a></span><span class="op" id="3311169">)</span><span class="op" id="3311170">.</span><span class="ident" id="3311171">Funcs</span><span class="op" id="3311176">(</span><span class="ident" id="3311177"><a href="/html/template/escape.go.html#3289306">funcMap</a></span><span class="op" id="3311184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311190">for</span>&nbsp;<span class="ident" id="3311194">_</span><span class="op" id="3311195">,</span>&nbsp;<span class="ident" id="3311197">t</span>&nbsp;<span class="op" id="3311199">:=</span>&nbsp;<span class="keyword" id="3311202">range</span>&nbsp;<span class="ident" id="3311208"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311209">.</span><span class="ident" id="3311210">derived</span>&nbsp;<span class="op" id="3311218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311222">if</span>&nbsp;<span class="ident" id="3311225">_</span><span class="op" id="3311226">,</span>&nbsp;<span class="ident" id="3311228">err</span>&nbsp;<span class="op" id="3311232">:=</span>&nbsp;<span class="ident" id="3311235"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311236">.</span><span class="ident" id="3311237">tmpl</span><span class="op" id="3311241">.</span><span class="ident" id="3311242">text</span><span class="op" id="3311246">.</span><span class="ident" id="3311247">AddParseTree</span><span class="op" id="3311259">(</span><span class="ident" id="3311260"><a href="/html/template/escape.go.html#3311197">t</a></span><span class="op" id="3311261">.</span><span class="ident" id="3311262">Name</span><span class="op" id="3311266">(</span><span class="op" id="3311267">)</span><span class="op" id="3311268">,</span>&nbsp;<span class="ident" id="3311270"><a href="/html/template/escape.go.html#3311197">t</a></span><span class="op" id="3311271">.</span><span class="ident" id="3311272">Tree</span><span class="op" id="3311276">)</span><span class="op" id="3311277">;</span>&nbsp;<span class="ident" id="3311279"><a href="/html/template/escape.go.html#3311228">err</a></span>&nbsp;<span class="op" id="3311283">!=</span>&nbsp;<span class="ident" id="3311286">nil</span>&nbsp;<span class="op" id="3311290">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3311295">panic</span><span class="op" id="3311300">(</span><span class="string" id="3311301">&#34;error&nbsp;adding&nbsp;derived&nbsp;template&#34;</span><span class="op" id="3311332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311342">for</span>&nbsp;<span class="ident" id="3311346">n</span><span class="op" id="3311347">,</span>&nbsp;<span class="ident" id="3311349">s</span>&nbsp;<span class="op" id="3311351">:=</span>&nbsp;<span class="keyword" id="3311354">range</span>&nbsp;<span class="ident" id="3311360"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311361">.</span><span class="ident" id="3311362">actionNodeEdits</span>&nbsp;<span class="op" id="3311378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311382"><a href="/html/template/escape.go.html#3295331">ensurePipelineContains</a></span><span class="op" id="3311404">(</span><span class="ident" id="3311405"><a href="/html/template/escape.go.html#3311346">n</a></span><span class="op" id="3311406">.</span><span class="ident" id="3311407">Pipe</span><span class="op" id="3311411">,</span>&nbsp;<span class="ident" id="3311413"><a href="/html/template/escape.go.html#3311349">s</a></span><span class="op" id="3311414">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311420">for</span>&nbsp;<span class="ident" id="3311424">n</span><span class="op" id="3311425">,</span>&nbsp;<span class="ident" id="3311427">name</span>&nbsp;<span class="op" id="3311432">:=</span>&nbsp;<span class="keyword" id="3311435">range</span>&nbsp;<span class="ident" id="3311441"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311442">.</span><span class="ident" id="3311443">templateNodeEdits</span>&nbsp;<span class="op" id="3311461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311465"><a href="/html/template/escape.go.html#3311424">n</a></span><span class="op" id="3311466">.</span><span class="ident" id="3311467">Name</span>&nbsp;<span class="op" id="3311472">=</span>&nbsp;<span class="ident" id="3311474"><a href="/html/template/escape.go.html#3311427">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311483">for</span>&nbsp;<span class="ident" id="3311487">n</span><span class="op" id="3311488">,</span>&nbsp;<span class="ident" id="3311490">s</span>&nbsp;<span class="op" id="3311492">:=</span>&nbsp;<span class="keyword" id="3311495">range</span>&nbsp;<span class="ident" id="3311501"><a href="/html/template/escape.go.html#3311099">e</a></span><span class="op" id="3311502">.</span><span class="ident" id="3311503">textNodeEdits</span>&nbsp;<span class="op" id="3311517">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311521"><a href="/html/template/escape.go.html#3311487">n</a></span><span class="op" id="3311522">.</span><span class="ident" id="3311523">Text</span>&nbsp;<span class="op" id="3311528">=</span>&nbsp;<span class="ident" id="3311530"><a href="/html/template/escape.go.html#3311490">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311533">}</span><br>
<span class="lineno"></span><span class="op" id="3311535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311538">//&nbsp;template&nbsp;returns&nbsp;the&nbsp;named&nbsp;template&nbsp;given&nbsp;a&nbsp;mangled&nbsp;template&nbsp;name.</span><br>
<span class="lineno">760</span><span class="keyword" id="3311608">func</span>&nbsp;<span class="op" id="3311613">(</span><span class="ident" id="3311614">e</span>&nbsp;<span class="op" id="3311616">*</span><span class="ident" id="3311617"><a href="/html/template/escape.go.html#3290504">escaper</a></span><span class="op" id="3311624">)</span>&nbsp;<span class="ident" id="3311626">template</span><span class="op" id="3311634">(</span><span class="ident" id="3311635">name</span>&nbsp;<span class="builtintype" id="3311640">string</span><span class="op" id="3311646">)</span>&nbsp;<span class="op" id="3311648">*</span><span class="ident" id="3311649"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3311657">.</span><span class="ident" id="3311658">Template</span>&nbsp;<span class="op" id="3311667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311670">t</span>&nbsp;<span class="op" id="3311672">:=</span>&nbsp;<span class="ident" id="3311675"><a href="/html/template/escape.go.html#3311614">e</a></span><span class="op" id="3311676">.</span><span class="ident" id="3311677">tmpl</span><span class="op" id="3311681">.</span><span class="ident" id="3311682">text</span><span class="op" id="3311686">.</span><span class="ident" id="3311687">Lookup</span><span class="op" id="3311693">(</span><span class="ident" id="3311694"><a href="/html/template/escape.go.html#3311635">name</a></span><span class="op" id="3311698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311701">if</span>&nbsp;<span class="ident" id="3311704"><a href="/html/template/escape.go.html#3311670">t</a></span>&nbsp;<span class="op" id="3311706">==</span>&nbsp;<span class="ident" id="3311709">nil</span>&nbsp;<span class="op" id="3311713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311717"><a href="/html/template/escape.go.html#3311670">t</a></span>&nbsp;<span class="op" id="3311719">=</span>&nbsp;<span class="ident" id="3311721"><a href="/html/template/escape.go.html#3311614">e</a></span><span class="op" id="3311722">.</span><span class="ident" id="3311723">derived</span><span class="op" id="3311730">[</span><span class="ident" id="3311731"><a href="/html/template/escape.go.html#3311635">name</a></span><span class="op" id="3311735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311738">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311741">return</span>&nbsp;<span class="ident" id="3311748"><a href="/html/template/escape.go.html#3311670">t</a></span><br>
<span class="lineno"></span><span class="op" id="3311750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311753">//&nbsp;Forwarding&nbsp;functions&nbsp;so&nbsp;that&nbsp;clients&nbsp;need&nbsp;only&nbsp;import&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3311823">//&nbsp;to&nbsp;reach&nbsp;the&nbsp;general&nbsp;escaping&nbsp;functions&nbsp;of&nbsp;text/template.</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="comment" id="3311885">//&nbsp;HTMLEscape&nbsp;writes&nbsp;to&nbsp;w&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3311965">func</span>&nbsp;<span class="ident" id="3311970">HTMLEscape</span><span class="op" id="3311980">(</span><span class="ident" id="3311981">w</span>&nbsp;<span class="ident" id="3311983"><a href="/html/template/escape.go.html#3288245">io</a></span><span class="op" id="3311985">.</span><span class="ident" id="3311986">Writer</span><span class="op" id="3311992">,</span>&nbsp;<span class="ident" id="3311994">b</span>&nbsp;<span class="op" id="3311996">[</span><span class="op" id="3311997">]</span><span class="builtintype" id="3311998">byte</span><span class="op" id="3312002">)</span>&nbsp;<span class="op" id="3312004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312007"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3312015">.</span><span class="ident" id="3312016">HTMLEscape</span><span class="op" id="3312026">(</span><span class="ident" id="3312027"><a href="/html/template/escape.go.html#3311981">w</a></span><span class="op" id="3312028">,</span>&nbsp;<span class="ident" id="3312030"><a href="/html/template/escape.go.html#3311994">b</a></span><span class="op" id="3312031">)</span><br>
<span class="lineno"></span><span class="op" id="3312033">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="3312036">//&nbsp;HTMLEscapeString&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3312118">func</span>&nbsp;<span class="ident" id="3312123">HTMLEscapeString</span><span class="op" id="3312139">(</span><span class="ident" id="3312140">s</span>&nbsp;<span class="builtintype" id="3312142">string</span><span class="op" id="3312148">)</span>&nbsp;<span class="builtintype" id="3312150">string</span>&nbsp;<span class="op" id="3312157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312160">return</span>&nbsp;<span class="ident" id="3312167"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3312175">.</span><span class="ident" id="3312176">HTMLEscapeString</span><span class="op" id="3312192">(</span><span class="ident" id="3312193"><a href="/html/template/escape.go.html#3312140">s</a></span><span class="op" id="3312194">)</span><br>
<span class="lineno"></span><span class="op" id="3312196">}</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span><span class="comment" id="3312199">//&nbsp;HTMLEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;textual</span><br>
<span class="lineno"></span><span class="comment" id="3312265">//&nbsp;representation&nbsp;of&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="keyword" id="3312301">func</span>&nbsp;<span class="ident" id="3312306">HTMLEscaper</span><span class="op" id="3312317">(</span><span class="ident" id="3312318">args</span>&nbsp;<span class="op" id="3312323">...</span><span class="keyword" id="3312326">interface</span><span class="op" id="3312335">{</span><span class="op" id="3312336">}</span><span class="op" id="3312337">)</span>&nbsp;<span class="builtintype" id="3312339">string</span>&nbsp;<span class="op" id="3312346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312349">return</span>&nbsp;<span class="ident" id="3312356"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3312364">.</span><span class="ident" id="3312365">HTMLEscaper</span><span class="op" id="3312376">(</span><span class="ident" id="3312377"><a href="/html/template/escape.go.html#3312318">args</a></span><span class="op" id="3312381">...</span><span class="op" id="3312384">)</span><br>
<span class="lineno">785</span><span class="op" id="3312386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312389">//&nbsp;JSEscape&nbsp;writes&nbsp;to&nbsp;w&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3312473">func</span>&nbsp;<span class="ident" id="3312478">JSEscape</span><span class="op" id="3312486">(</span><span class="ident" id="3312487">w</span>&nbsp;<span class="ident" id="3312489"><a href="/html/template/escape.go.html#3288245">io</a></span><span class="op" id="3312491">.</span><span class="ident" id="3312492">Writer</span><span class="op" id="3312498">,</span>&nbsp;<span class="ident" id="3312500">b</span>&nbsp;<span class="op" id="3312502">[</span><span class="op" id="3312503">]</span><span class="builtintype" id="3312504">byte</span><span class="op" id="3312508">)</span>&nbsp;<span class="op" id="3312510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312513"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3312521">.</span><span class="ident" id="3312522">JSEscape</span><span class="op" id="3312530">(</span><span class="ident" id="3312531"><a href="/html/template/escape.go.html#3312487">w</a></span><span class="op" id="3312532">,</span>&nbsp;<span class="ident" id="3312534"><a href="/html/template/escape.go.html#3312500">b</a></span><span class="op" id="3312535">)</span><br>
<span class="lineno">790</span><span class="op" id="3312537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312540">//&nbsp;JSEscapeString&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3312626">func</span>&nbsp;<span class="ident" id="3312631">JSEscapeString</span><span class="op" id="3312645">(</span><span class="ident" id="3312646">s</span>&nbsp;<span class="builtintype" id="3312648">string</span><span class="op" id="3312654">)</span>&nbsp;<span class="builtintype" id="3312656">string</span>&nbsp;<span class="op" id="3312663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312666">return</span>&nbsp;<span class="ident" id="3312673"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3312681">.</span><span class="ident" id="3312682">JSEscapeString</span><span class="op" id="3312696">(</span><span class="ident" id="3312697"><a href="/html/template/escape.go.html#3312646">s</a></span><span class="op" id="3312698">)</span><br>
<span class="lineno">795</span><span class="op" id="3312700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312703">//&nbsp;JSEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;textual</span><br>
<span class="lineno"></span><span class="comment" id="3312773">//&nbsp;representation&nbsp;of&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="keyword" id="3312809">func</span>&nbsp;<span class="ident" id="3312814">JSEscaper</span><span class="op" id="3312823">(</span><span class="ident" id="3312824">args</span>&nbsp;<span class="op" id="3312829">...</span><span class="keyword" id="3312832">interface</span><span class="op" id="3312841">{</span><span class="op" id="3312842">}</span><span class="op" id="3312843">)</span>&nbsp;<span class="builtintype" id="3312845">string</span>&nbsp;<span class="op" id="3312852">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312855">return</span>&nbsp;<span class="ident" id="3312862"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3312870">.</span><span class="ident" id="3312871">JSEscaper</span><span class="op" id="3312880">(</span><span class="ident" id="3312881"><a href="/html/template/escape.go.html#3312824">args</a></span><span class="op" id="3312885">...</span><span class="op" id="3312888">)</span><br>
<span class="lineno"></span><span class="op" id="3312890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312893">//&nbsp;URLQueryEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;value&nbsp;of&nbsp;the&nbsp;textual&nbsp;representation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3312971">//&nbsp;its&nbsp;arguments&nbsp;in&nbsp;a&nbsp;form&nbsp;suitable&nbsp;for&nbsp;embedding&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">805</span><span class="keyword" id="3313037">func</span>&nbsp;<span class="ident" id="3313042">URLQueryEscaper</span><span class="op" id="3313057">(</span><span class="ident" id="3313058">args</span>&nbsp;<span class="op" id="3313063">...</span><span class="keyword" id="3313066">interface</span><span class="op" id="3313075">{</span><span class="op" id="3313076">}</span><span class="op" id="3313077">)</span>&nbsp;<span class="builtintype" id="3313079">string</span>&nbsp;<span class="op" id="3313086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313089">return</span>&nbsp;<span class="ident" id="3313096"><a href="/html/template/escape.go.html#3288251">template</a></span><span class="op" id="3313104">.</span><span class="ident" id="3313105">URLQueryEscaper</span><span class="op" id="3313120">(</span><span class="ident" id="3313121"><a href="/html/template/escape.go.html#3313058">args</a></span><span class="op" id="3313125">...</span><span class="op" id="3313128">)</span><br>
<span class="lineno"></span><span class="op" id="3313130">}</span>
</div>
</body>
</html>
