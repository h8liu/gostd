<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html" class="current">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5884459">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5884514">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5884568">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5884619">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5884672">package</span>&nbsp;<span class="ident" id="5884680">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884689">import</span>&nbsp;<span class="op" id="5884696">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884699">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884706">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884716">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884728">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884734">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884740">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884751">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884762">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5884780">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5884790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5884793">const</span>&nbsp;<span class="op" id="5884799">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884802">maxNewlines</span>&nbsp;<span class="op" id="5884814">=</span>&nbsp;<span class="num" id="5884816">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5884822">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884870">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884882">=</span>&nbsp;<span class="builtintype" id="5884884">false</span>&nbsp;<span class="comment" id="5884890">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884915">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884927">=</span>&nbsp;<span class="num" id="5884929">1</span>&nbsp;<span class="op" id="5884931">&lt;&lt;</span>&nbsp;<span class="num" id="5884934">30</span><br>
<span class="lineno"></span><span class="op" id="5884937">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5884940">type</span>&nbsp;<span class="ident" id="5884945">whiteSpace</span>&nbsp;<span class="builtintype" id="5884956">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884962">const</span>&nbsp;<span class="op" id="5884968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884971">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5884980">=</span>&nbsp;<span class="ident" id="5884982">whiteSpace</span><span class="op" id="5884992">(</span><span class="num" id="5884993">0</span><span class="op" id="5884994">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884997">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885006">=</span>&nbsp;<span class="ident" id="5885008">whiteSpace</span><span class="op" id="5885018">(</span><span class="string" id="5885019">&#39;&nbsp;&#39;</span><span class="op" id="5885022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885025">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885034">=</span>&nbsp;<span class="ident" id="5885036">whiteSpace</span><span class="op" id="5885046">(</span><span class="string" id="5885047">&#39;\v&#39;</span><span class="op" id="5885051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885054">newline</span>&nbsp;&nbsp;<span class="op" id="5885063">=</span>&nbsp;<span class="ident" id="5885065">whiteSpace</span><span class="op" id="5885075">(</span><span class="string" id="5885076">&#39;\n&#39;</span><span class="op" id="5885080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885083">formfeed</span>&nbsp;<span class="op" id="5885092">=</span>&nbsp;<span class="ident" id="5885094">whiteSpace</span><span class="op" id="5885104">(</span><span class="string" id="5885105">&#39;\f&#39;</span><span class="op" id="5885109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885112">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5885121">=</span>&nbsp;<span class="ident" id="5885123">whiteSpace</span><span class="op" id="5885133">(</span><span class="string" id="5885134">&#39;&gt;&#39;</span><span class="op" id="5885137">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885140">unindent</span>&nbsp;<span class="op" id="5885149">=</span>&nbsp;<span class="ident" id="5885151">whiteSpace</span><span class="op" id="5885161">(</span><span class="string" id="5885162">&#39;&lt;&#39;</span><span class="op" id="5885165">)</span><br>
<span class="lineno"></span><span class="op" id="5885167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5885170">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5885224">type</span>&nbsp;<span class="ident" id="5885229">pmode</span>&nbsp;<span class="builtintype" id="5885235">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5885240">const</span>&nbsp;<span class="op" id="5885246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885249">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885266">pmode</span>&nbsp;<span class="op" id="5885272">=</span>&nbsp;<span class="num" id="5885274">1</span>&nbsp;<span class="op" id="5885276">&lt;&lt;</span>&nbsp;<span class="ident" id="5885279">iota</span>&nbsp;<span class="comment" id="5885284">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885332">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885367">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5885419">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5885422">type</span>&nbsp;<span class="ident" id="5885427">commentInfo</span>&nbsp;<span class="keyword" id="5885439">struct</span>&nbsp;<span class="op" id="5885446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885449">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5885464">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885482">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885508">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885523">*</span><span class="ident" id="5885524">ast</span><span class="op" id="5885527">.</span><span class="ident" id="5885528">CommentGroup</span>&nbsp;<span class="comment" id="5885541">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885580">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5885595">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885613">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885694">commentNewline</span>&nbsp;<span class="builtintype" id="5885709">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885727">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5885774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5885777">type</span>&nbsp;<span class="ident" id="5885782">printer</span>&nbsp;<span class="keyword" id="5885790">struct</span>&nbsp;<span class="op" id="5885797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885800">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885857">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885865">fset</span>&nbsp;<span class="op" id="5885870">*</span><span class="ident" id="5885871">token</span><span class="op" id="5885876">.</span><span class="ident" id="5885877">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885887">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885905">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885917">[</span><span class="op" id="5885918">]</span><span class="builtintype" id="5885919">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885930">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885953">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5885965">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885978">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886002">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886014">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886027">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886052">impliedSemi</span>&nbsp;<span class="builtintype" id="5886064">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886077">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886121">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886133">token</span><span class="op" id="5886138">.</span><span class="ident" id="5886139">Token</span>&nbsp;&nbsp;<span class="comment" id="5886146">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886204">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886216">token</span><span class="op" id="5886221">.</span><span class="ident" id="5886222">Token</span>&nbsp;&nbsp;<span class="comment" id="5886229">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886288">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886300">[</span><span class="op" id="5886301">]</span><span class="ident" id="5886302">whiteSpace</span>&nbsp;<span class="comment" id="5886313">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886338">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886352">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886419">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886487">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886553">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886619">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886663">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886671">token</span><span class="op" id="5886676">.</span><span class="ident" id="5886677">Position</span>&nbsp;<span class="comment" id="5886686">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886729">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886737">token</span><span class="op" id="5886742">.</span><span class="ident" id="5886743">Position</span>&nbsp;<span class="comment" id="5886752">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886789">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886797">token</span><span class="op" id="5886802">.</span><span class="ident" id="5886803">Position</span>&nbsp;<span class="comment" id="5886812">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886855">linePtr</span>&nbsp;<span class="op" id="5886863">*</span><span class="builtintype" id="5886864">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886878">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886938">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886999">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887015">[</span><span class="op" id="5887016">]</span><span class="op" id="5887017">*</span><span class="ident" id="5887018">ast</span><span class="op" id="5887021">.</span><span class="ident" id="5887022">CommentGroup</span>&nbsp;<span class="comment" id="5887035">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887050">useNodeComments</span>&nbsp;<span class="builtintype" id="5887066">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5887086">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5887142">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887209">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5887223">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887265">nodeSizes</span>&nbsp;<span class="keyword" id="5887275">map</span><span class="op" id="5887278">[</span><span class="ident" id="5887279">ast</span><span class="op" id="5887282">.</span><span class="ident" id="5887283">Node</span><span class="op" id="5887287">]</span><span class="builtintype" id="5887288">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5887294">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887345">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5887356">token</span><span class="op" id="5887361">.</span><span class="ident" id="5887362">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887367">cachedLine</span>&nbsp;<span class="builtintype" id="5887378">int</span>&nbsp;<span class="comment" id="5887382">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5887417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5887420">func</span>&nbsp;<span class="op" id="5887425">(</span><span class="ident" id="5887426">p</span>&nbsp;<span class="op" id="5887428">*</span><span class="ident" id="5887429">printer</span><span class="op" id="5887436">)</span>&nbsp;<span class="ident" id="5887438">init</span><span class="op" id="5887442">(</span><span class="ident" id="5887443">cfg</span>&nbsp;<span class="op" id="5887447">*</span><span class="ident" id="5887448">Config</span><span class="op" id="5887454">,</span>&nbsp;<span class="ident" id="5887456">fset</span>&nbsp;<span class="op" id="5887461">*</span><span class="ident" id="5887462">token</span><span class="op" id="5887467">.</span><span class="ident" id="5887468">FileSet</span><span class="op" id="5887475">,</span>&nbsp;<span class="ident" id="5887477">nodeSizes</span>&nbsp;<span class="keyword" id="5887487">map</span><span class="op" id="5887490">[</span><span class="ident" id="5887491">ast</span><span class="op" id="5887494">.</span><span class="ident" id="5887495">Node</span><span class="op" id="5887499">]</span><span class="builtintype" id="5887500">int</span><span class="op" id="5887503">)</span>&nbsp;<span class="op" id="5887505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887508">p</span><span class="op" id="5887509">.</span><span class="ident" id="5887510">Config</span>&nbsp;<span class="op" id="5887517">=</span>&nbsp;<span class="op" id="5887519">*</span><span class="ident" id="5887520">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887525">p</span><span class="op" id="5887526">.</span><span class="ident" id="5887527">fset</span>&nbsp;<span class="op" id="5887532">=</span>&nbsp;<span class="ident" id="5887534">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887540">p</span><span class="op" id="5887541">.</span><span class="ident" id="5887542">pos</span>&nbsp;<span class="op" id="5887546">=</span>&nbsp;<span class="ident" id="5887548">token</span><span class="op" id="5887553">.</span><span class="ident" id="5887554">Position</span><span class="op" id="5887562">{</span><span class="ident" id="5887563">Line</span><span class="op" id="5887567">:</span>&nbsp;<span class="num" id="5887569">1</span><span class="op" id="5887570">,</span>&nbsp;<span class="ident" id="5887572">Column</span><span class="op" id="5887578">:</span>&nbsp;<span class="num" id="5887580">1</span><span class="op" id="5887581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887584">p</span><span class="op" id="5887585">.</span><span class="ident" id="5887586">out</span>&nbsp;<span class="op" id="5887590">=</span>&nbsp;<span class="ident" id="5887592">token</span><span class="op" id="5887597">.</span><span class="ident" id="5887598">Position</span><span class="op" id="5887606">{</span><span class="ident" id="5887607">Line</span><span class="op" id="5887611">:</span>&nbsp;<span class="num" id="5887613">1</span><span class="op" id="5887614">,</span>&nbsp;<span class="ident" id="5887616">Column</span><span class="op" id="5887622">:</span>&nbsp;<span class="num" id="5887624">1</span><span class="op" id="5887625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887628">p</span><span class="op" id="5887629">.</span><span class="ident" id="5887630">wsbuf</span>&nbsp;<span class="op" id="5887636">=</span>&nbsp;<span class="builtinfunc" id="5887638">make</span><span class="op" id="5887642">(</span><span class="op" id="5887643">[</span><span class="op" id="5887644">]</span><span class="ident" id="5887645">whiteSpace</span><span class="op" id="5887655">,</span>&nbsp;<span class="num" id="5887657">0</span><span class="op" id="5887658">,</span>&nbsp;<span class="num" id="5887660">16</span><span class="op" id="5887662">)</span>&nbsp;<span class="comment" id="5887664">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887699">p</span><span class="op" id="5887700">.</span><span class="ident" id="5887701">nodeSizes</span>&nbsp;<span class="op" id="5887711">=</span>&nbsp;<span class="ident" id="5887713">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887724">p</span><span class="op" id="5887725">.</span><span class="ident" id="5887726">cachedPos</span>&nbsp;<span class="op" id="5887736">=</span>&nbsp;<span class="op" id="5887738">-</span><span class="num" id="5887739">1</span><br>
<span class="lineno"></span><span class="op" id="5887741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5887744">func</span>&nbsp;<span class="op" id="5887749">(</span><span class="ident" id="5887750">p</span>&nbsp;<span class="op" id="5887752">*</span><span class="ident" id="5887753">printer</span><span class="op" id="5887760">)</span>&nbsp;<span class="ident" id="5887762">internalError</span><span class="op" id="5887775">(</span><span class="ident" id="5887776">msg</span>&nbsp;<span class="op" id="5887780">...</span><span class="keyword" id="5887783">interface</span><span class="op" id="5887792">{</span><span class="op" id="5887793">}</span><span class="op" id="5887794">)</span>&nbsp;<span class="op" id="5887796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887799">if</span>&nbsp;<span class="ident" id="5887802">debug</span>&nbsp;<span class="op" id="5887808">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887812">fmt</span><span class="op" id="5887815">.</span><span class="ident" id="5887816">Print</span><span class="op" id="5887821">(</span><span class="ident" id="5887822">p</span><span class="op" id="5887823">.</span><span class="ident" id="5887824">pos</span><span class="op" id="5887827">.</span><span class="ident" id="5887828">String</span><span class="op" id="5887834">(</span><span class="op" id="5887835">)</span>&nbsp;<span class="op" id="5887837">+</span>&nbsp;<span class="string" id="5887839">&#34;:&nbsp;&#34;</span><span class="op" id="5887843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887847">fmt</span><span class="op" id="5887850">.</span><span class="ident" id="5887851">Println</span><span class="op" id="5887858">(</span><span class="ident" id="5887859">msg</span><span class="op" id="5887862">...</span><span class="op" id="5887865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5887869">panic</span><span class="op" id="5887874">(</span><span class="string" id="5887875">&#34;go/printer&#34;</span><span class="op" id="5887887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887890">}</span><br>
<span class="lineno"></span><span class="op" id="5887892">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5887895">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5887966">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5888042">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5888115">func</span>&nbsp;<span class="op" id="5888120">(</span><span class="ident" id="5888121">p</span>&nbsp;<span class="op" id="5888123">*</span><span class="ident" id="5888124">printer</span><span class="op" id="5888131">)</span>&nbsp;<span class="ident" id="5888133">commentsHaveNewline</span><span class="op" id="5888152">(</span><span class="ident" id="5888153">list</span>&nbsp;<span class="op" id="5888158">[</span><span class="op" id="5888159">]</span><span class="op" id="5888160">*</span><span class="ident" id="5888161">ast</span><span class="op" id="5888164">.</span><span class="ident" id="5888165">Comment</span><span class="op" id="5888172">)</span>&nbsp;<span class="builtintype" id="5888174">bool</span>&nbsp;<span class="op" id="5888179">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888182">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888200">line</span>&nbsp;<span class="op" id="5888205">:=</span>&nbsp;<span class="ident" id="5888208">p</span><span class="op" id="5888209">.</span><span class="ident" id="5888210">lineFor</span><span class="op" id="5888217">(</span><span class="ident" id="5888218">list</span><span class="op" id="5888222">[</span><span class="num" id="5888223">0</span><span class="op" id="5888224">]</span><span class="op" id="5888225">.</span><span class="ident" id="5888226">Pos</span><span class="op" id="5888229">(</span><span class="op" id="5888230">)</span><span class="op" id="5888231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888234">for</span>&nbsp;<span class="ident" id="5888238">i</span><span class="op" id="5888239">,</span>&nbsp;<span class="ident" id="5888241">c</span>&nbsp;<span class="op" id="5888243">:=</span>&nbsp;<span class="keyword" id="5888246">range</span>&nbsp;<span class="ident" id="5888252">list</span>&nbsp;<span class="op" id="5888257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888261">if</span>&nbsp;<span class="ident" id="5888264">i</span>&nbsp;<span class="op" id="5888266">&gt;</span>&nbsp;<span class="num" id="5888268">0</span>&nbsp;<span class="op" id="5888270">&amp;&amp;</span>&nbsp;<span class="ident" id="5888273">p</span><span class="op" id="5888274">.</span><span class="ident" id="5888275">lineFor</span><span class="op" id="5888282">(</span><span class="ident" id="5888283">list</span><span class="op" id="5888287">[</span><span class="ident" id="5888288">i</span><span class="op" id="5888289">]</span><span class="op" id="5888290">.</span><span class="ident" id="5888291">Pos</span><span class="op" id="5888294">(</span><span class="op" id="5888295">)</span><span class="op" id="5888296">)</span>&nbsp;<span class="op" id="5888298">!=</span>&nbsp;<span class="ident" id="5888301">line</span>&nbsp;<span class="op" id="5888306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888311">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888351">return</span>&nbsp;<span class="builtintype" id="5888358">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888369">if</span>&nbsp;<span class="ident" id="5888372">t</span>&nbsp;<span class="op" id="5888374">:=</span>&nbsp;<span class="ident" id="5888377">c</span><span class="op" id="5888378">.</span><span class="ident" id="5888379">Text</span><span class="op" id="5888383">;</span>&nbsp;<span class="builtinfunc" id="5888385">len</span><span class="op" id="5888388">(</span><span class="ident" id="5888389">t</span><span class="op" id="5888390">)</span>&nbsp;<span class="op" id="5888392">&gt;=</span>&nbsp;<span class="num" id="5888395">2</span>&nbsp;<span class="op" id="5888397">&amp;&amp;</span>&nbsp;<span class="op" id="5888400">(</span><span class="ident" id="5888401">t</span><span class="op" id="5888402">[</span><span class="num" id="5888403">1</span><span class="op" id="5888404">]</span>&nbsp;<span class="op" id="5888406">==</span>&nbsp;<span class="string" id="5888409">&#39;/&#39;</span>&nbsp;<span class="op" id="5888413">||</span>&nbsp;<span class="ident" id="5888416">strings</span><span class="op" id="5888423">.</span><span class="ident" id="5888424">Contains</span><span class="op" id="5888432">(</span><span class="ident" id="5888433">t</span><span class="op" id="5888434">,</span>&nbsp;<span class="string" id="5888436">&#34;\n&#34;</span><span class="op" id="5888440">)</span><span class="op" id="5888441">)</span>&nbsp;<span class="op" id="5888443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888448">return</span>&nbsp;<span class="builtintype" id="5888455">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888462">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888468">_</span>&nbsp;<span class="op" id="5888470">=</span>&nbsp;<span class="ident" id="5888472">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888478">return</span>&nbsp;<span class="builtintype" id="5888485">false</span><br>
<span class="lineno"></span><span class="op" id="5888491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5888494">func</span>&nbsp;<span class="op" id="5888499">(</span><span class="ident" id="5888500">p</span>&nbsp;<span class="op" id="5888502">*</span><span class="ident" id="5888503">printer</span><span class="op" id="5888510">)</span>&nbsp;<span class="ident" id="5888512">nextComment</span><span class="op" id="5888523">(</span><span class="op" id="5888524">)</span>&nbsp;<span class="op" id="5888526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888529">for</span>&nbsp;<span class="ident" id="5888533">p</span><span class="op" id="5888534">.</span><span class="ident" id="5888535">cindex</span>&nbsp;<span class="op" id="5888542">&lt;</span>&nbsp;<span class="builtinfunc" id="5888544">len</span><span class="op" id="5888547">(</span><span class="ident" id="5888548">p</span><span class="op" id="5888549">.</span><span class="ident" id="5888550">comments</span><span class="op" id="5888558">)</span>&nbsp;<span class="op" id="5888560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888564">c</span>&nbsp;<span class="op" id="5888566">:=</span>&nbsp;<span class="ident" id="5888569">p</span><span class="op" id="5888570">.</span><span class="ident" id="5888571">comments</span><span class="op" id="5888579">[</span><span class="ident" id="5888580">p</span><span class="op" id="5888581">.</span><span class="ident" id="5888582">cindex</span><span class="op" id="5888588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888592">p</span><span class="op" id="5888593">.</span><span class="ident" id="5888594">cindex</span><span class="op" id="5888600">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888605">if</span>&nbsp;<span class="ident" id="5888608">list</span>&nbsp;<span class="op" id="5888613">:=</span>&nbsp;<span class="ident" id="5888616">c</span><span class="op" id="5888617">.</span><span class="ident" id="5888618">List</span><span class="op" id="5888622">;</span>&nbsp;<span class="builtinfunc" id="5888624">len</span><span class="op" id="5888627">(</span><span class="ident" id="5888628">list</span><span class="op" id="5888632">)</span>&nbsp;<span class="op" id="5888634">&gt;</span>&nbsp;<span class="num" id="5888636">0</span>&nbsp;<span class="op" id="5888638">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888643">p</span><span class="op" id="5888644">.</span><span class="ident" id="5888645">comment</span>&nbsp;<span class="op" id="5888653">=</span>&nbsp;<span class="ident" id="5888655">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888660">p</span><span class="op" id="5888661">.</span><span class="ident" id="5888662">commentOffset</span>&nbsp;<span class="op" id="5888676">=</span>&nbsp;<span class="ident" id="5888678">p</span><span class="op" id="5888679">.</span><span class="ident" id="5888680">posFor</span><span class="op" id="5888686">(</span><span class="ident" id="5888687">list</span><span class="op" id="5888691">[</span><span class="num" id="5888692">0</span><span class="op" id="5888693">]</span><span class="op" id="5888694">.</span><span class="ident" id="5888695">Pos</span><span class="op" id="5888698">(</span><span class="op" id="5888699">)</span><span class="op" id="5888700">)</span><span class="op" id="5888701">.</span><span class="ident" id="5888702">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888712">p</span><span class="op" id="5888713">.</span><span class="ident" id="5888714">commentNewline</span>&nbsp;<span class="op" id="5888729">=</span>&nbsp;<span class="ident" id="5888731">p</span><span class="op" id="5888732">.</span><span class="ident" id="5888733">commentsHaveNewline</span><span class="op" id="5888752">(</span><span class="ident" id="5888753">list</span><span class="op" id="5888757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888771">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888775">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888836">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888902">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888923">p</span><span class="op" id="5888924">.</span><span class="ident" id="5888925">commentOffset</span>&nbsp;<span class="op" id="5888939">=</span>&nbsp;<span class="ident" id="5888941">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5888950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5888953">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5889020">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5889088">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5889126">//</span><br>
<span class="lineno"></span><span class="keyword" id="5889129">func</span>&nbsp;<span class="op" id="5889134">(</span><span class="ident" id="5889135">p</span>&nbsp;<span class="op" id="5889137">*</span><span class="ident" id="5889138">printer</span><span class="op" id="5889145">)</span>&nbsp;<span class="ident" id="5889147">commentBefore</span><span class="op" id="5889160">(</span><span class="ident" id="5889161">next</span>&nbsp;<span class="ident" id="5889166">token</span><span class="op" id="5889171">.</span><span class="ident" id="5889172">Position</span><span class="op" id="5889180">)</span>&nbsp;<span class="builtintype" id="5889182">bool</span>&nbsp;<span class="op" id="5889187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889190">return</span>&nbsp;<span class="ident" id="5889197">p</span><span class="op" id="5889198">.</span><span class="ident" id="5889199">commentOffset</span>&nbsp;<span class="op" id="5889213">&lt;</span>&nbsp;<span class="ident" id="5889215">next</span><span class="op" id="5889219">.</span><span class="ident" id="5889220">Offset</span>&nbsp;<span class="op" id="5889227">&amp;&amp;</span>&nbsp;<span class="op" id="5889230">(</span><span class="op" id="5889231">!</span><span class="ident" id="5889232">p</span><span class="op" id="5889233">.</span><span class="ident" id="5889234">impliedSemi</span>&nbsp;<span class="op" id="5889246">||</span>&nbsp;<span class="op" id="5889249">!</span><span class="ident" id="5889250">p</span><span class="op" id="5889251">.</span><span class="ident" id="5889252">commentNewline</span><span class="op" id="5889266">)</span><br>
<span class="lineno"></span><span class="op" id="5889268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5889271">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5889326">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5889381">//</span><br>
<span class="lineno"></span><span class="keyword" id="5889384">func</span>&nbsp;<span class="op" id="5889389">(</span><span class="ident" id="5889390">p</span>&nbsp;<span class="op" id="5889392">*</span><span class="ident" id="5889393">printer</span><span class="op" id="5889400">)</span>&nbsp;<span class="ident" id="5889402">commentSizeBefore</span><span class="op" id="5889419">(</span><span class="ident" id="5889420">next</span>&nbsp;<span class="ident" id="5889425">token</span><span class="op" id="5889430">.</span><span class="ident" id="5889431">Position</span><span class="op" id="5889439">)</span>&nbsp;<span class="builtintype" id="5889441">int</span>&nbsp;<span class="op" id="5889445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5889448">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889517">defer</span>&nbsp;<span class="keyword" id="5889523">func</span><span class="op" id="5889527">(</span><span class="ident" id="5889528">info</span>&nbsp;<span class="ident" id="5889533">commentInfo</span><span class="op" id="5889544">)</span>&nbsp;<span class="op" id="5889546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889550">p</span><span class="op" id="5889551">.</span><span class="ident" id="5889552">commentInfo</span>&nbsp;<span class="op" id="5889564">=</span>&nbsp;<span class="ident" id="5889566">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5889572">}</span><span class="op" id="5889573">(</span><span class="ident" id="5889574">p</span><span class="op" id="5889575">.</span><span class="ident" id="5889576">commentInfo</span><span class="op" id="5889587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889591">size</span>&nbsp;<span class="op" id="5889596">:=</span>&nbsp;<span class="num" id="5889599">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889602">for</span>&nbsp;<span class="ident" id="5889606">p</span><span class="op" id="5889607">.</span><span class="ident" id="5889608">commentBefore</span><span class="op" id="5889621">(</span><span class="ident" id="5889622">next</span><span class="op" id="5889626">)</span>&nbsp;<span class="op" id="5889628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889632">for</span>&nbsp;<span class="ident" id="5889636">_</span><span class="op" id="5889637">,</span>&nbsp;<span class="ident" id="5889639">c</span>&nbsp;<span class="op" id="5889641">:=</span>&nbsp;<span class="keyword" id="5889644">range</span>&nbsp;<span class="ident" id="5889650">p</span><span class="op" id="5889651">.</span><span class="ident" id="5889652">comment</span><span class="op" id="5889659">.</span><span class="ident" id="5889660">List</span>&nbsp;<span class="op" id="5889665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889670">size</span>&nbsp;<span class="op" id="5889675">+=</span>&nbsp;<span class="builtinfunc" id="5889678">len</span><span class="op" id="5889681">(</span><span class="ident" id="5889682">c</span><span class="op" id="5889683">.</span><span class="ident" id="5889684">Text</span><span class="op" id="5889688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5889692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889696">p</span><span class="op" id="5889697">.</span><span class="ident" id="5889698">nextComment</span><span class="op" id="5889709">(</span><span class="op" id="5889710">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5889713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889716">return</span>&nbsp;<span class="ident" id="5889723">size</span><br>
<span class="lineno"></span><span class="op" id="5889728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5889731">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5889804">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5889878">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5889954">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5889970">//</span><br>
<span class="lineno"></span><span class="keyword" id="5889973">func</span>&nbsp;<span class="op" id="5889978">(</span><span class="ident" id="5889979">p</span>&nbsp;<span class="op" id="5889981">*</span><span class="ident" id="5889982">printer</span><span class="op" id="5889989">)</span>&nbsp;<span class="ident" id="5889991">recordLine</span><span class="op" id="5890001">(</span><span class="ident" id="5890002">linePtr</span>&nbsp;<span class="op" id="5890010">*</span><span class="builtintype" id="5890011">int</span><span class="op" id="5890014">)</span>&nbsp;<span class="op" id="5890016">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890019">p</span><span class="op" id="5890020">.</span><span class="ident" id="5890021">linePtr</span>&nbsp;<span class="op" id="5890029">=</span>&nbsp;<span class="ident" id="5890031">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5890039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5890042">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5890110">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5890178">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5890248">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5890304">//</span><br>
<span class="lineno"></span><span class="keyword" id="5890307">func</span>&nbsp;<span class="op" id="5890312">(</span><span class="ident" id="5890313">p</span>&nbsp;<span class="op" id="5890315">*</span><span class="ident" id="5890316">printer</span><span class="op" id="5890323">)</span>&nbsp;<span class="ident" id="5890325">linesFrom</span><span class="op" id="5890334">(</span><span class="ident" id="5890335">line</span>&nbsp;<span class="builtintype" id="5890340">int</span><span class="op" id="5890343">)</span>&nbsp;<span class="builtintype" id="5890345">int</span>&nbsp;<span class="op" id="5890349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890352">return</span>&nbsp;<span class="ident" id="5890359">p</span><span class="op" id="5890360">.</span><span class="ident" id="5890361">out</span><span class="op" id="5890364">.</span><span class="ident" id="5890365">Line</span>&nbsp;<span class="op" id="5890370">-</span>&nbsp;<span class="ident" id="5890372">line</span><br>
<span class="lineno">190</span><span class="op" id="5890377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5890380">func</span>&nbsp;<span class="op" id="5890385">(</span><span class="ident" id="5890386">p</span>&nbsp;<span class="op" id="5890388">*</span><span class="ident" id="5890389">printer</span><span class="op" id="5890396">)</span>&nbsp;<span class="ident" id="5890398">posFor</span><span class="op" id="5890404">(</span><span class="ident" id="5890405">pos</span>&nbsp;<span class="ident" id="5890409">token</span><span class="op" id="5890414">.</span><span class="ident" id="5890415">Pos</span><span class="op" id="5890418">)</span>&nbsp;<span class="ident" id="5890420">token</span><span class="op" id="5890425">.</span><span class="ident" id="5890426">Position</span>&nbsp;<span class="op" id="5890435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5890438">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890500">return</span>&nbsp;<span class="ident" id="5890507">p</span><span class="op" id="5890508">.</span><span class="ident" id="5890509">fset</span><span class="op" id="5890513">.</span><span class="ident" id="5890514">Position</span><span class="op" id="5890522">(</span><span class="ident" id="5890523">pos</span><span class="op" id="5890526">)</span><br>
<span class="lineno">195</span><span class="op" id="5890528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5890531">func</span>&nbsp;<span class="op" id="5890536">(</span><span class="ident" id="5890537">p</span>&nbsp;<span class="op" id="5890539">*</span><span class="ident" id="5890540">printer</span><span class="op" id="5890547">)</span>&nbsp;<span class="ident" id="5890549">lineFor</span><span class="op" id="5890556">(</span><span class="ident" id="5890557">pos</span>&nbsp;<span class="ident" id="5890561">token</span><span class="op" id="5890566">.</span><span class="ident" id="5890567">Pos</span><span class="op" id="5890570">)</span>&nbsp;<span class="builtintype" id="5890572">int</span>&nbsp;<span class="op" id="5890576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890579">if</span>&nbsp;<span class="ident" id="5890582">pos</span>&nbsp;<span class="op" id="5890586">!=</span>&nbsp;<span class="ident" id="5890589">p</span><span class="op" id="5890590">.</span><span class="ident" id="5890591">cachedPos</span>&nbsp;<span class="op" id="5890601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890605">p</span><span class="op" id="5890606">.</span><span class="ident" id="5890607">cachedPos</span>&nbsp;<span class="op" id="5890617">=</span>&nbsp;<span class="ident" id="5890619">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890625">p</span><span class="op" id="5890626">.</span><span class="ident" id="5890627">cachedLine</span>&nbsp;<span class="op" id="5890638">=</span>&nbsp;<span class="ident" id="5890640">p</span><span class="op" id="5890641">.</span><span class="ident" id="5890642">fset</span><span class="op" id="5890646">.</span><span class="ident" id="5890647">Position</span><span class="op" id="5890655">(</span><span class="ident" id="5890656">pos</span><span class="op" id="5890659">)</span><span class="op" id="5890660">.</span><span class="ident" id="5890661">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890670">return</span>&nbsp;<span class="ident" id="5890677">p</span><span class="op" id="5890678">.</span><span class="ident" id="5890679">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5890690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5890693">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5890768">func</span>&nbsp;<span class="op" id="5890773">(</span><span class="ident" id="5890774">p</span>&nbsp;<span class="op" id="5890776">*</span><span class="ident" id="5890777">printer</span><span class="op" id="5890784">)</span>&nbsp;<span class="ident" id="5890786">atLineBegin</span><span class="op" id="5890797">(</span><span class="ident" id="5890798">pos</span>&nbsp;<span class="ident" id="5890802">token</span><span class="op" id="5890807">.</span><span class="ident" id="5890808">Position</span><span class="op" id="5890816">)</span>&nbsp;<span class="op" id="5890818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5890821">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890861">if</span>&nbsp;<span class="ident" id="5890864">p</span><span class="op" id="5890865">.</span><span class="ident" id="5890866">Config</span><span class="op" id="5890872">.</span><span class="ident" id="5890873">Mode</span><span class="op" id="5890877">&amp;</span><span class="ident" id="5890878">SourcePos</span>&nbsp;<span class="op" id="5890888">!=</span>&nbsp;<span class="num" id="5890891">0</span>&nbsp;<span class="op" id="5890893">&amp;&amp;</span>&nbsp;<span class="ident" id="5890896">pos</span><span class="op" id="5890899">.</span><span class="ident" id="5890900">IsValid</span><span class="op" id="5890907">(</span><span class="op" id="5890908">)</span>&nbsp;<span class="op" id="5890910">&amp;&amp;</span>&nbsp;<span class="op" id="5890913">(</span><span class="ident" id="5890914">p</span><span class="op" id="5890915">.</span><span class="ident" id="5890916">out</span><span class="op" id="5890919">.</span><span class="ident" id="5890920">Line</span>&nbsp;<span class="op" id="5890925">!=</span>&nbsp;<span class="ident" id="5890928">pos</span><span class="op" id="5890931">.</span><span class="ident" id="5890932">Line</span>&nbsp;<span class="op" id="5890937">||</span>&nbsp;<span class="ident" id="5890940">p</span><span class="op" id="5890941">.</span><span class="ident" id="5890942">out</span><span class="op" id="5890945">.</span><span class="ident" id="5890946">Filename</span>&nbsp;<span class="op" id="5890955">!=</span>&nbsp;<span class="ident" id="5890958">pos</span><span class="op" id="5890961">.</span><span class="ident" id="5890962">Filename</span><span class="op" id="5890970">)</span>&nbsp;<span class="op" id="5890972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890976">p</span><span class="op" id="5890977">.</span><span class="ident" id="5890978">output</span>&nbsp;<span class="op" id="5890985">=</span>&nbsp;<span class="builtinfunc" id="5890987">append</span><span class="op" id="5890993">(</span><span class="ident" id="5890994">p</span><span class="op" id="5890995">.</span><span class="ident" id="5890996">output</span><span class="op" id="5891002">,</span>&nbsp;<span class="ident" id="5891004">tabwriter</span><span class="op" id="5891013">.</span><span class="ident" id="5891014">Escape</span><span class="op" id="5891020">)</span>&nbsp;<span class="comment" id="5891022">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891080">p</span><span class="op" id="5891081">.</span><span class="ident" id="5891082">output</span>&nbsp;<span class="op" id="5891089">=</span>&nbsp;<span class="builtinfunc" id="5891091">append</span><span class="op" id="5891097">(</span><span class="ident" id="5891098">p</span><span class="op" id="5891099">.</span><span class="ident" id="5891100">output</span><span class="op" id="5891106">,</span>&nbsp;<span class="ident" id="5891108">fmt</span><span class="op" id="5891111">.</span><span class="ident" id="5891112">Sprintf</span><span class="op" id="5891119">(</span><span class="string" id="5891120">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5891136">,</span>&nbsp;<span class="ident" id="5891138">pos</span><span class="op" id="5891141">.</span><span class="ident" id="5891142">Filename</span><span class="op" id="5891150">,</span>&nbsp;<span class="ident" id="5891152">pos</span><span class="op" id="5891155">.</span><span class="ident" id="5891156">Line</span><span class="op" id="5891160">)</span><span class="op" id="5891161">...</span><span class="op" id="5891164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891168">p</span><span class="op" id="5891169">.</span><span class="ident" id="5891170">output</span>&nbsp;<span class="op" id="5891177">=</span>&nbsp;<span class="builtinfunc" id="5891179">append</span><span class="op" id="5891185">(</span><span class="ident" id="5891186">p</span><span class="op" id="5891187">.</span><span class="ident" id="5891188">output</span><span class="op" id="5891194">,</span>&nbsp;<span class="ident" id="5891196">tabwriter</span><span class="op" id="5891205">.</span><span class="ident" id="5891206">Escape</span><span class="op" id="5891212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891216">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891257">p</span><span class="op" id="5891258">.</span><span class="ident" id="5891259">out</span><span class="op" id="5891262">.</span><span class="ident" id="5891263">Filename</span>&nbsp;<span class="op" id="5891272">=</span>&nbsp;<span class="ident" id="5891274">pos</span><span class="op" id="5891277">.</span><span class="ident" id="5891278">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891289">p</span><span class="op" id="5891290">.</span><span class="ident" id="5891291">out</span><span class="op" id="5891294">.</span><span class="ident" id="5891295">Line</span>&nbsp;<span class="op" id="5891300">=</span>&nbsp;<span class="ident" id="5891302">pos</span><span class="op" id="5891305">.</span><span class="ident" id="5891306">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891316">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891338">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891381">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891424">n</span>&nbsp;<span class="op" id="5891426">:=</span>&nbsp;<span class="ident" id="5891429">p</span><span class="op" id="5891430">.</span><span class="ident" id="5891431">Config</span><span class="op" id="5891437">.</span><span class="ident" id="5891438">Indent</span>&nbsp;<span class="op" id="5891445">+</span>&nbsp;<span class="ident" id="5891447">p</span><span class="op" id="5891448">.</span><span class="ident" id="5891449">indent</span>&nbsp;<span class="comment" id="5891456">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891485">for</span>&nbsp;<span class="ident" id="5891489">i</span>&nbsp;<span class="op" id="5891491">:=</span>&nbsp;<span class="num" id="5891494">0</span><span class="op" id="5891495">;</span>&nbsp;<span class="ident" id="5891497">i</span>&nbsp;<span class="op" id="5891499">&lt;</span>&nbsp;<span class="ident" id="5891501">n</span><span class="op" id="5891502">;</span>&nbsp;<span class="ident" id="5891504">i</span><span class="op" id="5891505">++</span>&nbsp;<span class="op" id="5891508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891512">p</span><span class="op" id="5891513">.</span><span class="ident" id="5891514">output</span>&nbsp;<span class="op" id="5891521">=</span>&nbsp;<span class="builtinfunc" id="5891523">append</span><span class="op" id="5891529">(</span><span class="ident" id="5891530">p</span><span class="op" id="5891531">.</span><span class="ident" id="5891532">output</span><span class="op" id="5891538">,</span>&nbsp;<span class="string" id="5891540">&#39;\t&#39;</span><span class="op" id="5891544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891551">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891572">p</span><span class="op" id="5891573">.</span><span class="ident" id="5891574">pos</span><span class="op" id="5891577">.</span><span class="ident" id="5891578">Offset</span>&nbsp;<span class="op" id="5891585">+=</span>&nbsp;<span class="ident" id="5891588">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891591">p</span><span class="op" id="5891592">.</span><span class="ident" id="5891593">pos</span><span class="op" id="5891596">.</span><span class="ident" id="5891597">Column</span>&nbsp;<span class="op" id="5891604">+=</span>&nbsp;<span class="ident" id="5891607">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891610">p</span><span class="op" id="5891611">.</span><span class="ident" id="5891612">out</span><span class="op" id="5891615">.</span><span class="ident" id="5891616">Column</span>&nbsp;<span class="op" id="5891623">+=</span>&nbsp;<span class="ident" id="5891626">n</span><br>
<span class="lineno"></span><span class="op" id="5891628">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5891631">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5891693">func</span>&nbsp;<span class="op" id="5891698">(</span><span class="ident" id="5891699">p</span>&nbsp;<span class="op" id="5891701">*</span><span class="ident" id="5891702">printer</span><span class="op" id="5891709">)</span>&nbsp;<span class="ident" id="5891711">writeByte</span><span class="op" id="5891720">(</span><span class="ident" id="5891721">ch</span>&nbsp;<span class="builtintype" id="5891724">byte</span><span class="op" id="5891728">,</span>&nbsp;<span class="ident" id="5891730">n</span>&nbsp;<span class="builtintype" id="5891732">int</span><span class="op" id="5891735">)</span>&nbsp;<span class="op" id="5891737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891740">if</span>&nbsp;<span class="ident" id="5891743">p</span><span class="op" id="5891744">.</span><span class="ident" id="5891745">out</span><span class="op" id="5891748">.</span><span class="ident" id="5891749">Column</span>&nbsp;<span class="op" id="5891756">==</span>&nbsp;<span class="num" id="5891759">1</span>&nbsp;<span class="op" id="5891761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891765">p</span><span class="op" id="5891766">.</span><span class="ident" id="5891767">atLineBegin</span><span class="op" id="5891778">(</span><span class="ident" id="5891779">p</span><span class="op" id="5891780">.</span><span class="ident" id="5891781">pos</span><span class="op" id="5891784">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891791">for</span>&nbsp;<span class="ident" id="5891795">i</span>&nbsp;<span class="op" id="5891797">:=</span>&nbsp;<span class="num" id="5891800">0</span><span class="op" id="5891801">;</span>&nbsp;<span class="ident" id="5891803">i</span>&nbsp;<span class="op" id="5891805">&lt;</span>&nbsp;<span class="ident" id="5891807">n</span><span class="op" id="5891808">;</span>&nbsp;<span class="ident" id="5891810">i</span><span class="op" id="5891811">++</span>&nbsp;<span class="op" id="5891814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891818">p</span><span class="op" id="5891819">.</span><span class="ident" id="5891820">output</span>&nbsp;<span class="op" id="5891827">=</span>&nbsp;<span class="builtinfunc" id="5891829">append</span><span class="op" id="5891835">(</span><span class="ident" id="5891836">p</span><span class="op" id="5891837">.</span><span class="ident" id="5891838">output</span><span class="op" id="5891844">,</span>&nbsp;<span class="ident" id="5891846">ch</span><span class="op" id="5891848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891851">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891855">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891876">p</span><span class="op" id="5891877">.</span><span class="ident" id="5891878">pos</span><span class="op" id="5891881">.</span><span class="ident" id="5891882">Offset</span>&nbsp;<span class="op" id="5891889">+=</span>&nbsp;<span class="ident" id="5891892">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891895">if</span>&nbsp;<span class="ident" id="5891898">ch</span>&nbsp;<span class="op" id="5891901">==</span>&nbsp;<span class="string" id="5891904">&#39;\n&#39;</span>&nbsp;<span class="op" id="5891909">||</span>&nbsp;<span class="ident" id="5891912">ch</span>&nbsp;<span class="op" id="5891915">==</span>&nbsp;<span class="string" id="5891918">&#39;\f&#39;</span>&nbsp;<span class="op" id="5891923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891927">p</span><span class="op" id="5891928">.</span><span class="ident" id="5891929">pos</span><span class="op" id="5891932">.</span><span class="ident" id="5891933">Line</span>&nbsp;<span class="op" id="5891938">+=</span>&nbsp;<span class="ident" id="5891941">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891945">p</span><span class="op" id="5891946">.</span><span class="ident" id="5891947">out</span><span class="op" id="5891950">.</span><span class="ident" id="5891951">Line</span>&nbsp;<span class="op" id="5891956">+=</span>&nbsp;<span class="ident" id="5891959">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891963">p</span><span class="op" id="5891964">.</span><span class="ident" id="5891965">pos</span><span class="op" id="5891968">.</span><span class="ident" id="5891969">Column</span>&nbsp;<span class="op" id="5891976">=</span>&nbsp;<span class="num" id="5891978">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891982">p</span><span class="op" id="5891983">.</span><span class="ident" id="5891984">out</span><span class="op" id="5891987">.</span><span class="ident" id="5891988">Column</span>&nbsp;<span class="op" id="5891995">=</span>&nbsp;<span class="num" id="5891997">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892001">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892009">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892012">p</span><span class="op" id="5892013">.</span><span class="ident" id="5892014">pos</span><span class="op" id="5892017">.</span><span class="ident" id="5892018">Column</span>&nbsp;<span class="op" id="5892025">+=</span>&nbsp;<span class="ident" id="5892028">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892031">p</span><span class="op" id="5892032">.</span><span class="ident" id="5892033">out</span><span class="op" id="5892036">.</span><span class="ident" id="5892037">Column</span>&nbsp;<span class="op" id="5892044">+=</span>&nbsp;<span class="ident" id="5892047">n</span><br>
<span class="lineno"></span><span class="op" id="5892049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5892052">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5892125">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5892201">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5892258">//</span><br>
<span class="lineno"></span><span class="comment" id="5892261">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5892329">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5892402">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5892474">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5892550">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5892623">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5892658">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5892661">func</span>&nbsp;<span class="op" id="5892666">(</span><span class="ident" id="5892667">p</span>&nbsp;<span class="op" id="5892669">*</span><span class="ident" id="5892670">printer</span><span class="op" id="5892677">)</span>&nbsp;<span class="ident" id="5892679">writeString</span><span class="op" id="5892690">(</span><span class="ident" id="5892691">pos</span>&nbsp;<span class="ident" id="5892695">token</span><span class="op" id="5892700">.</span><span class="ident" id="5892701">Position</span><span class="op" id="5892709">,</span>&nbsp;<span class="ident" id="5892711">s</span>&nbsp;<span class="builtintype" id="5892713">string</span><span class="op" id="5892719">,</span>&nbsp;<span class="ident" id="5892721">isLit</span>&nbsp;<span class="builtintype" id="5892727">bool</span><span class="op" id="5892731">)</span>&nbsp;<span class="op" id="5892733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892736">if</span>&nbsp;<span class="ident" id="5892739">p</span><span class="op" id="5892740">.</span><span class="ident" id="5892741">out</span><span class="op" id="5892744">.</span><span class="ident" id="5892745">Column</span>&nbsp;<span class="op" id="5892752">==</span>&nbsp;<span class="num" id="5892755">1</span>&nbsp;<span class="op" id="5892757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892761">p</span><span class="op" id="5892762">.</span><span class="ident" id="5892763">atLineBegin</span><span class="op" id="5892774">(</span><span class="ident" id="5892775">pos</span><span class="op" id="5892778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892785">if</span>&nbsp;<span class="ident" id="5892788">pos</span><span class="op" id="5892791">.</span><span class="ident" id="5892792">IsValid</span><span class="op" id="5892799">(</span><span class="op" id="5892800">)</span>&nbsp;<span class="op" id="5892802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5892806">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5892874">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5892937">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893002">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893029">p</span><span class="op" id="5893030">.</span><span class="ident" id="5893031">pos</span>&nbsp;<span class="op" id="5893035">=</span>&nbsp;<span class="ident" id="5893037">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893046">if</span>&nbsp;<span class="ident" id="5893049">isLit</span>&nbsp;<span class="op" id="5893055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893059">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893116">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893175">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893237">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893259">p</span><span class="op" id="5893260">.</span><span class="ident" id="5893261">output</span>&nbsp;<span class="op" id="5893268">=</span>&nbsp;<span class="builtinfunc" id="5893270">append</span><span class="op" id="5893276">(</span><span class="ident" id="5893277">p</span><span class="op" id="5893278">.</span><span class="ident" id="5893279">output</span><span class="op" id="5893285">,</span>&nbsp;<span class="ident" id="5893287">tabwriter</span><span class="op" id="5893296">.</span><span class="ident" id="5893297">Escape</span><span class="op" id="5893303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893306">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893310">if</span>&nbsp;<span class="ident" id="5893313">debug</span>&nbsp;<span class="op" id="5893319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893323">p</span><span class="op" id="5893324">.</span><span class="ident" id="5893325">output</span>&nbsp;<span class="op" id="5893332">=</span>&nbsp;<span class="builtinfunc" id="5893334">append</span><span class="op" id="5893340">(</span><span class="ident" id="5893341">p</span><span class="op" id="5893342">.</span><span class="ident" id="5893343">output</span><span class="op" id="5893349">,</span>&nbsp;<span class="ident" id="5893351">fmt</span><span class="op" id="5893354">.</span><span class="ident" id="5893355">Sprintf</span><span class="op" id="5893362">(</span><span class="string" id="5893363">&#34;/*%s*/&#34;</span><span class="op" id="5893371">,</span>&nbsp;<span class="ident" id="5893373">pos</span><span class="op" id="5893376">)</span><span class="op" id="5893377">...</span><span class="op" id="5893380">)</span>&nbsp;<span class="comment" id="5893382">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893410">p</span><span class="op" id="5893411">.</span><span class="ident" id="5893412">output</span>&nbsp;<span class="op" id="5893419">=</span>&nbsp;<span class="builtinfunc" id="5893421">append</span><span class="op" id="5893427">(</span><span class="ident" id="5893428">p</span><span class="op" id="5893429">.</span><span class="ident" id="5893430">output</span><span class="op" id="5893436">,</span>&nbsp;<span class="ident" id="5893438">s</span><span class="op" id="5893439">...</span><span class="op" id="5893442">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893446">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893467">nlines</span>&nbsp;<span class="op" id="5893474">:=</span>&nbsp;<span class="num" id="5893477">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893480">var</span>&nbsp;<span class="ident" id="5893484">li</span>&nbsp;<span class="builtintype" id="5893487">int</span>&nbsp;<span class="comment" id="5893491">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893538">for</span>&nbsp;<span class="ident" id="5893542">i</span>&nbsp;<span class="op" id="5893544">:=</span>&nbsp;<span class="num" id="5893547">0</span><span class="op" id="5893548">;</span>&nbsp;<span class="ident" id="5893550">i</span>&nbsp;<span class="op" id="5893552">&lt;</span>&nbsp;<span class="builtinfunc" id="5893554">len</span><span class="op" id="5893557">(</span><span class="ident" id="5893558">s</span><span class="op" id="5893559">)</span><span class="op" id="5893560">;</span>&nbsp;<span class="ident" id="5893562">i</span><span class="op" id="5893563">++</span>&nbsp;<span class="op" id="5893566">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893570">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893630">if</span>&nbsp;<span class="ident" id="5893633">s</span><span class="op" id="5893634">[</span><span class="ident" id="5893635">i</span><span class="op" id="5893636">]</span>&nbsp;<span class="op" id="5893638">==</span>&nbsp;<span class="string" id="5893641">&#39;\n&#39;</span>&nbsp;<span class="op" id="5893646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893651">nlines</span><span class="op" id="5893657">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893663">li</span>&nbsp;<span class="op" id="5893666">=</span>&nbsp;<span class="ident" id="5893668">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893672">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893678">p</span><span class="op" id="5893679">.</span><span class="ident" id="5893680">pos</span><span class="op" id="5893683">.</span><span class="ident" id="5893684">Offset</span>&nbsp;<span class="op" id="5893691">+=</span>&nbsp;<span class="builtinfunc" id="5893694">len</span><span class="op" id="5893697">(</span><span class="ident" id="5893698">s</span><span class="op" id="5893699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893702">if</span>&nbsp;<span class="ident" id="5893705">nlines</span>&nbsp;<span class="op" id="5893712">&gt;</span>&nbsp;<span class="num" id="5893714">0</span>&nbsp;<span class="op" id="5893716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893720">p</span><span class="op" id="5893721">.</span><span class="ident" id="5893722">pos</span><span class="op" id="5893725">.</span><span class="ident" id="5893726">Line</span>&nbsp;<span class="op" id="5893731">+=</span>&nbsp;<span class="ident" id="5893734">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893743">p</span><span class="op" id="5893744">.</span><span class="ident" id="5893745">out</span><span class="op" id="5893748">.</span><span class="ident" id="5893749">Line</span>&nbsp;<span class="op" id="5893754">+=</span>&nbsp;<span class="ident" id="5893757">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893766">c</span>&nbsp;<span class="op" id="5893768">:=</span>&nbsp;<span class="builtinfunc" id="5893771">len</span><span class="op" id="5893774">(</span><span class="ident" id="5893775">s</span><span class="op" id="5893776">)</span>&nbsp;<span class="op" id="5893778">-</span>&nbsp;<span class="ident" id="5893780">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893785">p</span><span class="op" id="5893786">.</span><span class="ident" id="5893787">pos</span><span class="op" id="5893790">.</span><span class="ident" id="5893791">Column</span>&nbsp;<span class="op" id="5893798">=</span>&nbsp;<span class="ident" id="5893800">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893804">p</span><span class="op" id="5893805">.</span><span class="ident" id="5893806">out</span><span class="op" id="5893809">.</span><span class="ident" id="5893810">Column</span>&nbsp;<span class="op" id="5893817">=</span>&nbsp;<span class="ident" id="5893819">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893822">}</span>&nbsp;<span class="keyword" id="5893824">else</span>&nbsp;<span class="op" id="5893829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893833">p</span><span class="op" id="5893834">.</span><span class="ident" id="5893835">pos</span><span class="op" id="5893838">.</span><span class="ident" id="5893839">Column</span>&nbsp;<span class="op" id="5893846">+=</span>&nbsp;<span class="builtinfunc" id="5893849">len</span><span class="op" id="5893852">(</span><span class="ident" id="5893853">s</span><span class="op" id="5893854">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893858">p</span><span class="op" id="5893859">.</span><span class="ident" id="5893860">out</span><span class="op" id="5893863">.</span><span class="ident" id="5893864">Column</span>&nbsp;<span class="op" id="5893871">+=</span>&nbsp;<span class="builtinfunc" id="5893874">len</span><span class="op" id="5893877">(</span><span class="ident" id="5893878">s</span><span class="op" id="5893879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893886">if</span>&nbsp;<span class="ident" id="5893889">isLit</span>&nbsp;<span class="op" id="5893895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893899">p</span><span class="op" id="5893900">.</span><span class="ident" id="5893901">output</span>&nbsp;<span class="op" id="5893908">=</span>&nbsp;<span class="builtinfunc" id="5893910">append</span><span class="op" id="5893916">(</span><span class="ident" id="5893917">p</span><span class="op" id="5893918">.</span><span class="ident" id="5893919">output</span><span class="op" id="5893925">,</span>&nbsp;<span class="ident" id="5893927">tabwriter</span><span class="op" id="5893936">.</span><span class="ident" id="5893937">Escape</span><span class="op" id="5893943">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893950">p</span><span class="op" id="5893951">.</span><span class="ident" id="5893952">last</span>&nbsp;<span class="op" id="5893957">=</span>&nbsp;<span class="ident" id="5893959">p</span><span class="op" id="5893960">.</span><span class="ident" id="5893961">pos</span><br>
<span class="lineno"></span><span class="op" id="5893965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5893968">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5894030">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5894092">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5894148">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5894210">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5894273">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5894333">//</span><br>
<span class="lineno"></span><span class="keyword" id="5894336">func</span>&nbsp;<span class="op" id="5894341">(</span><span class="ident" id="5894342">p</span>&nbsp;<span class="op" id="5894344">*</span><span class="ident" id="5894345">printer</span><span class="op" id="5894352">)</span>&nbsp;<span class="ident" id="5894354">writeCommentPrefix</span><span class="op" id="5894372">(</span><span class="ident" id="5894373">pos</span><span class="op" id="5894376">,</span>&nbsp;<span class="ident" id="5894378">next</span>&nbsp;<span class="ident" id="5894383">token</span><span class="op" id="5894388">.</span><span class="ident" id="5894389">Position</span><span class="op" id="5894397">,</span>&nbsp;<span class="ident" id="5894399">prev</span><span class="op" id="5894403">,</span>&nbsp;<span class="ident" id="5894405">comment</span>&nbsp;<span class="op" id="5894413">*</span><span class="ident" id="5894414">ast</span><span class="op" id="5894417">.</span><span class="ident" id="5894418">Comment</span><span class="op" id="5894425">,</span>&nbsp;<span class="ident" id="5894427">tok</span>&nbsp;<span class="ident" id="5894431">token</span><span class="op" id="5894436">.</span><span class="ident" id="5894437">Token</span><span class="op" id="5894442">)</span>&nbsp;<span class="op" id="5894444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894447">if</span>&nbsp;<span class="builtinfunc" id="5894450">len</span><span class="op" id="5894453">(</span><span class="ident" id="5894454">p</span><span class="op" id="5894455">.</span><span class="ident" id="5894456">output</span><span class="op" id="5894462">)</span>&nbsp;<span class="op" id="5894464">==</span>&nbsp;<span class="num" id="5894467">0</span>&nbsp;<span class="op" id="5894469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894473">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894551">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894563">if</span>&nbsp;<span class="ident" id="5894566">pos</span><span class="op" id="5894569">.</span><span class="ident" id="5894570">IsValid</span><span class="op" id="5894577">(</span><span class="op" id="5894578">)</span>&nbsp;<span class="op" id="5894580">&amp;&amp;</span>&nbsp;<span class="ident" id="5894583">pos</span><span class="op" id="5894586">.</span><span class="ident" id="5894587">Filename</span>&nbsp;<span class="op" id="5894596">!=</span>&nbsp;<span class="ident" id="5894599">p</span><span class="op" id="5894600">.</span><span class="ident" id="5894601">last</span><span class="op" id="5894605">.</span><span class="ident" id="5894606">Filename</span>&nbsp;<span class="op" id="5894615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894619">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894677">p</span><span class="op" id="5894678">.</span><span class="ident" id="5894679">writeByte</span><span class="op" id="5894688">(</span><span class="string" id="5894689">&#39;\f&#39;</span><span class="op" id="5894693">,</span>&nbsp;<span class="ident" id="5894695">maxNewlines</span><span class="op" id="5894706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894710">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894722">if</span>&nbsp;<span class="ident" id="5894725">pos</span><span class="op" id="5894728">.</span><span class="ident" id="5894729">Line</span>&nbsp;<span class="op" id="5894734">==</span>&nbsp;<span class="ident" id="5894737">p</span><span class="op" id="5894738">.</span><span class="ident" id="5894739">last</span><span class="op" id="5894743">.</span><span class="ident" id="5894744">Line</span>&nbsp;<span class="op" id="5894749">&amp;&amp;</span>&nbsp;<span class="op" id="5894752">(</span><span class="ident" id="5894753">prev</span>&nbsp;<span class="op" id="5894758">==</span>&nbsp;<span class="builtintype" id="5894761">nil</span>&nbsp;<span class="op" id="5894765">||</span>&nbsp;<span class="ident" id="5894768">prev</span><span class="op" id="5894772">.</span><span class="ident" id="5894773">Text</span><span class="op" id="5894777">[</span><span class="num" id="5894778">1</span><span class="op" id="5894779">]</span>&nbsp;<span class="op" id="5894781">!=</span>&nbsp;<span class="string" id="5894784">&#39;/&#39;</span><span class="op" id="5894787">)</span>&nbsp;<span class="op" id="5894789">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894793">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894837">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894879">hasSep</span>&nbsp;<span class="op" id="5894886">:=</span>&nbsp;<span class="builtintype" id="5894889">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894897">if</span>&nbsp;<span class="ident" id="5894900">prev</span>&nbsp;<span class="op" id="5894905">==</span>&nbsp;<span class="builtintype" id="5894908">nil</span>&nbsp;<span class="op" id="5894912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894917">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894956">j</span>&nbsp;<span class="op" id="5894958">:=</span>&nbsp;<span class="num" id="5894961">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894966">for</span>&nbsp;<span class="ident" id="5894970">i</span><span class="op" id="5894971">,</span>&nbsp;<span class="ident" id="5894973">ch</span>&nbsp;<span class="op" id="5894976">:=</span>&nbsp;<span class="keyword" id="5894979">range</span>&nbsp;<span class="ident" id="5894985">p</span><span class="op" id="5894986">.</span><span class="ident" id="5894987">wsbuf</span>&nbsp;<span class="op" id="5894993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894999">switch</span>&nbsp;<span class="ident" id="5895006">ch</span>&nbsp;<span class="op" id="5895009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895015">case</span>&nbsp;<span class="ident" id="5895020">blank</span><span class="op" id="5895025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895032">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895075">p</span><span class="op" id="5895076">.</span><span class="ident" id="5895077">wsbuf</span><span class="op" id="5895082">[</span><span class="ident" id="5895083">i</span><span class="op" id="5895084">]</span>&nbsp;<span class="op" id="5895086">=</span>&nbsp;<span class="ident" id="5895088">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895100">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895113">case</span>&nbsp;<span class="ident" id="5895118">vtab</span><span class="op" id="5895122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895129">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895171">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895222">hasSep</span>&nbsp;<span class="op" id="5895229">=</span>&nbsp;<span class="builtintype" id="5895231">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895241">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895254">case</span>&nbsp;<span class="ident" id="5895259">indent</span><span class="op" id="5895265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895272">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895306">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895325">j</span>&nbsp;<span class="op" id="5895327">=</span>&nbsp;<span class="ident" id="5895329">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895335">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895349">p</span><span class="op" id="5895350">.</span><span class="ident" id="5895351">writeWhitespace</span><span class="op" id="5895366">(</span><span class="ident" id="5895367">j</span><span class="op" id="5895368">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895376">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895423">if</span>&nbsp;<span class="op" id="5895426">!</span><span class="ident" id="5895427">hasSep</span>&nbsp;<span class="op" id="5895434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895439">sep</span>&nbsp;<span class="op" id="5895443">:=</span>&nbsp;<span class="builtintype" id="5895446">byte</span><span class="op" id="5895450">(</span><span class="string" id="5895451">&#39;\t&#39;</span><span class="op" id="5895455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895460">if</span>&nbsp;<span class="ident" id="5895463">pos</span><span class="op" id="5895466">.</span><span class="ident" id="5895467">Line</span>&nbsp;<span class="op" id="5895472">==</span>&nbsp;<span class="ident" id="5895475">next</span><span class="op" id="5895479">.</span><span class="ident" id="5895480">Line</span>&nbsp;<span class="op" id="5895485">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895491">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895543">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895595">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895632">sep</span>&nbsp;<span class="op" id="5895636">=</span>&nbsp;<span class="string" id="5895638">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895645">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895650">p</span><span class="op" id="5895651">.</span><span class="ident" id="5895652">writeByte</span><span class="op" id="5895661">(</span><span class="ident" id="5895662">sep</span><span class="op" id="5895665">,</span>&nbsp;<span class="num" id="5895667">1</span><span class="op" id="5895668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895676">}</span>&nbsp;<span class="keyword" id="5895678">else</span>&nbsp;<span class="op" id="5895683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895687">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895721">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895764">droppedLinebreak</span>&nbsp;<span class="op" id="5895781">:=</span>&nbsp;<span class="builtintype" id="5895784">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895792">j</span>&nbsp;<span class="op" id="5895794">:=</span>&nbsp;<span class="num" id="5895797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895801">for</span>&nbsp;<span class="ident" id="5895805">i</span><span class="op" id="5895806">,</span>&nbsp;<span class="ident" id="5895808">ch</span>&nbsp;<span class="op" id="5895811">:=</span>&nbsp;<span class="keyword" id="5895814">range</span>&nbsp;<span class="ident" id="5895820">p</span><span class="op" id="5895821">.</span><span class="ident" id="5895822">wsbuf</span>&nbsp;<span class="op" id="5895828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895833">switch</span>&nbsp;<span class="ident" id="5895840">ch</span>&nbsp;<span class="op" id="5895843">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895848">case</span>&nbsp;<span class="ident" id="5895853">blank</span><span class="op" id="5895858">,</span>&nbsp;<span class="ident" id="5895860">vtab</span><span class="op" id="5895864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895870">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895929">p</span><span class="op" id="5895930">.</span><span class="ident" id="5895931">wsbuf</span><span class="op" id="5895936">[</span><span class="ident" id="5895937">i</span><span class="op" id="5895938">]</span>&nbsp;<span class="op" id="5895940">=</span>&nbsp;<span class="ident" id="5895942">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895953">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895965">case</span>&nbsp;<span class="ident" id="5895970">indent</span><span class="op" id="5895976">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895982">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896015">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896027">case</span>&nbsp;<span class="ident" id="5896032">unindent</span><span class="op" id="5896040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896046">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896096">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896143">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896197">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896239">if</span>&nbsp;<span class="ident" id="5896242">i</span><span class="op" id="5896243">+</span><span class="num" id="5896244">1</span>&nbsp;<span class="op" id="5896246">&lt;</span>&nbsp;<span class="builtinfunc" id="5896248">len</span><span class="op" id="5896251">(</span><span class="ident" id="5896252">p</span><span class="op" id="5896253">.</span><span class="ident" id="5896254">wsbuf</span><span class="op" id="5896259">)</span>&nbsp;<span class="op" id="5896261">&amp;&amp;</span>&nbsp;<span class="ident" id="5896264">p</span><span class="op" id="5896265">.</span><span class="ident" id="5896266">wsbuf</span><span class="op" id="5896271">[</span><span class="ident" id="5896272">i</span><span class="op" id="5896273">+</span><span class="num" id="5896274">1</span><span class="op" id="5896275">]</span>&nbsp;<span class="op" id="5896277">==</span>&nbsp;<span class="ident" id="5896280">unindent</span>&nbsp;<span class="op" id="5896289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896296">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896309">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896315">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896379">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896437">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896494">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896552">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896607">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896665">if</span>&nbsp;<span class="ident" id="5896668">tok</span>&nbsp;<span class="op" id="5896672">!=</span>&nbsp;<span class="ident" id="5896675">token</span><span class="op" id="5896680">.</span><span class="ident" id="5896681">RBRACE</span>&nbsp;<span class="op" id="5896688">&amp;&amp;</span>&nbsp;<span class="ident" id="5896691">pos</span><span class="op" id="5896694">.</span><span class="ident" id="5896695">Column</span>&nbsp;<span class="op" id="5896702">==</span>&nbsp;<span class="ident" id="5896705">next</span><span class="op" id="5896709">.</span><span class="ident" id="5896710">Column</span>&nbsp;<span class="op" id="5896717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896724">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896742">case</span>&nbsp;<span class="ident" id="5896747">newline</span><span class="op" id="5896754">,</span>&nbsp;<span class="ident" id="5896756">formfeed</span><span class="op" id="5896764">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896770">p</span><span class="op" id="5896771">.</span><span class="ident" id="5896772">wsbuf</span><span class="op" id="5896777">[</span><span class="ident" id="5896778">i</span><span class="op" id="5896779">]</span>&nbsp;<span class="op" id="5896781">=</span>&nbsp;<span class="ident" id="5896783">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896794">droppedLinebreak</span>&nbsp;<span class="op" id="5896811">=</span>&nbsp;<span class="ident" id="5896813">prev</span>&nbsp;<span class="op" id="5896818">==</span>&nbsp;<span class="builtintype" id="5896821">nil</span>&nbsp;<span class="comment" id="5896825">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896876">j</span>&nbsp;<span class="op" id="5896878">=</span>&nbsp;<span class="ident" id="5896880">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896885">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896897">p</span><span class="op" id="5896898">.</span><span class="ident" id="5896899">writeWhitespace</span><span class="op" id="5896914">(</span><span class="ident" id="5896915">j</span><span class="op" id="5896916">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896921">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896976">n</span>&nbsp;<span class="op" id="5896978">:=</span>&nbsp;<span class="num" id="5896981">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896985">if</span>&nbsp;<span class="ident" id="5896988">pos</span><span class="op" id="5896991">.</span><span class="ident" id="5896992">IsValid</span><span class="op" id="5896999">(</span><span class="op" id="5897000">)</span>&nbsp;<span class="op" id="5897002">&amp;&amp;</span>&nbsp;<span class="ident" id="5897005">p</span><span class="op" id="5897006">.</span><span class="ident" id="5897007">last</span><span class="op" id="5897011">.</span><span class="ident" id="5897012">IsValid</span><span class="op" id="5897019">(</span><span class="op" id="5897020">)</span>&nbsp;<span class="op" id="5897022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897027">n</span>&nbsp;<span class="op" id="5897029">=</span>&nbsp;<span class="ident" id="5897031">pos</span><span class="op" id="5897034">.</span><span class="ident" id="5897035">Line</span>&nbsp;<span class="op" id="5897040">-</span>&nbsp;<span class="ident" id="5897042">p</span><span class="op" id="5897043">.</span><span class="ident" id="5897044">last</span><span class="op" id="5897048">.</span><span class="ident" id="5897049">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897057">if</span>&nbsp;<span class="ident" id="5897060">n</span>&nbsp;<span class="op" id="5897062">&lt;</span>&nbsp;<span class="num" id="5897064">0</span>&nbsp;<span class="op" id="5897066">{</span>&nbsp;<span class="comment" id="5897068">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897095">n</span>&nbsp;<span class="op" id="5897097">=</span>&nbsp;<span class="num" id="5897099">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897104">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897113">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897167">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897219">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897273">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897327">if</span>&nbsp;<span class="ident" id="5897330">p</span><span class="op" id="5897331">.</span><span class="ident" id="5897332">indent</span>&nbsp;<span class="op" id="5897339">==</span>&nbsp;<span class="num" id="5897342">0</span>&nbsp;<span class="op" id="5897344">&amp;&amp;</span>&nbsp;<span class="ident" id="5897347">droppedLinebreak</span>&nbsp;<span class="op" id="5897364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897369">n</span><span class="op" id="5897370">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897380">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897428">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897476">if</span>&nbsp;<span class="ident" id="5897479">n</span>&nbsp;<span class="op" id="5897481">==</span>&nbsp;<span class="num" id="5897484">0</span>&nbsp;<span class="op" id="5897486">&amp;&amp;</span>&nbsp;<span class="ident" id="5897489">prev</span>&nbsp;<span class="op" id="5897494">!=</span>&nbsp;<span class="builtintype" id="5897497">nil</span>&nbsp;<span class="op" id="5897501">&amp;&amp;</span>&nbsp;<span class="ident" id="5897504">prev</span><span class="op" id="5897508">.</span><span class="ident" id="5897509">Text</span><span class="op" id="5897513">[</span><span class="num" id="5897514">1</span><span class="op" id="5897515">]</span>&nbsp;<span class="op" id="5897517">==</span>&nbsp;<span class="string" id="5897520">&#39;/&#39;</span>&nbsp;<span class="op" id="5897524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897529">n</span>&nbsp;<span class="op" id="5897531">=</span>&nbsp;<span class="num" id="5897533">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897537">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897542">if</span>&nbsp;<span class="ident" id="5897545">n</span>&nbsp;<span class="op" id="5897547">&gt;</span>&nbsp;<span class="num" id="5897549">0</span>&nbsp;<span class="op" id="5897551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897556">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897611">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897666">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897710">p</span><span class="op" id="5897711">.</span><span class="ident" id="5897712">writeByte</span><span class="op" id="5897721">(</span><span class="string" id="5897722">&#39;\f&#39;</span><span class="op" id="5897726">,</span>&nbsp;<span class="ident" id="5897728">nlimit</span><span class="op" id="5897734">(</span><span class="ident" id="5897735">n</span><span class="op" id="5897736">)</span><span class="op" id="5897737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897744">}</span><br>
<span class="lineno"></span><span class="op" id="5897746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5897749">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5897796">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5897859">//</span><br>
<span class="lineno"></span><span class="keyword" id="5897862">func</span>&nbsp;<span class="ident" id="5897867">isBlank</span><span class="op" id="5897874">(</span><span class="ident" id="5897875">s</span>&nbsp;<span class="builtintype" id="5897877">string</span><span class="op" id="5897883">)</span>&nbsp;<span class="builtintype" id="5897885">bool</span>&nbsp;<span class="op" id="5897890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897893">for</span>&nbsp;<span class="ident" id="5897897">i</span>&nbsp;<span class="op" id="5897899">:=</span>&nbsp;<span class="num" id="5897902">0</span><span class="op" id="5897903">;</span>&nbsp;<span class="ident" id="5897905">i</span>&nbsp;<span class="op" id="5897907">&lt;</span>&nbsp;<span class="builtinfunc" id="5897909">len</span><span class="op" id="5897912">(</span><span class="ident" id="5897913">s</span><span class="op" id="5897914">)</span><span class="op" id="5897915">;</span>&nbsp;<span class="ident" id="5897917">i</span><span class="op" id="5897918">++</span>&nbsp;<span class="op" id="5897921">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897925">if</span>&nbsp;<span class="ident" id="5897928">s</span><span class="op" id="5897929">[</span><span class="ident" id="5897930">i</span><span class="op" id="5897931">]</span>&nbsp;<span class="op" id="5897933">&gt;</span>&nbsp;<span class="string" id="5897935">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5897939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897944">return</span>&nbsp;<span class="builtintype" id="5897951">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897965">return</span>&nbsp;<span class="builtintype" id="5897972">true</span><br>
<span class="lineno">460</span><span class="op" id="5897977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5897980">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5898034">func</span>&nbsp;<span class="ident" id="5898039">commonPrefix</span><span class="op" id="5898051">(</span><span class="ident" id="5898052">a</span><span class="op" id="5898053">,</span>&nbsp;<span class="ident" id="5898055">b</span>&nbsp;<span class="builtintype" id="5898057">string</span><span class="op" id="5898063">)</span>&nbsp;<span class="builtintype" id="5898065">string</span>&nbsp;<span class="op" id="5898072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5898075">i</span>&nbsp;<span class="op" id="5898077">:=</span>&nbsp;<span class="num" id="5898080">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5898083">for</span>&nbsp;<span class="ident" id="5898087">i</span>&nbsp;<span class="op" id="5898089">&lt;</span>&nbsp;<span class="builtinfunc" id="5898091">len</span><span class="op" id="5898094">(</span><span class="ident" id="5898095">a</span><span class="op" id="5898096">)</span>&nbsp;<span class="op" id="5898098">&amp;&amp;</span>&nbsp;<span class="ident" id="5898101">i</span>&nbsp;<span class="op" id="5898103">&lt;</span>&nbsp;<span class="builtinfunc" id="5898105">len</span><span class="op" id="5898108">(</span><span class="ident" id="5898109">b</span><span class="op" id="5898110">)</span>&nbsp;<span class="op" id="5898112">&amp;&amp;</span>&nbsp;<span class="ident" id="5898115">a</span><span class="op" id="5898116">[</span><span class="ident" id="5898117">i</span><span class="op" id="5898118">]</span>&nbsp;<span class="op" id="5898120">==</span>&nbsp;<span class="ident" id="5898123">b</span><span class="op" id="5898124">[</span><span class="ident" id="5898125">i</span><span class="op" id="5898126">]</span>&nbsp;<span class="op" id="5898128">&amp;&amp;</span>&nbsp;<span class="op" id="5898131">(</span><span class="ident" id="5898132">a</span><span class="op" id="5898133">[</span><span class="ident" id="5898134">i</span><span class="op" id="5898135">]</span>&nbsp;<span class="op" id="5898137">&lt;=</span>&nbsp;<span class="string" id="5898140">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5898144">||</span>&nbsp;<span class="ident" id="5898147">a</span><span class="op" id="5898148">[</span><span class="ident" id="5898149">i</span><span class="op" id="5898150">]</span>&nbsp;<span class="op" id="5898152">==</span>&nbsp;<span class="string" id="5898155">&#39;*&#39;</span><span class="op" id="5898158">)</span>&nbsp;<span class="op" id="5898160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5898164">i</span><span class="op" id="5898165">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5898169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5898172">return</span>&nbsp;<span class="ident" id="5898179">a</span><span class="op" id="5898180">[</span><span class="num" id="5898181">0</span><span class="op" id="5898182">:</span><span class="ident" id="5898183">i</span><span class="op" id="5898184">]</span><br>
<span class="lineno"></span><span class="op" id="5898186">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5898189">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5898246">func</span>&nbsp;<span class="ident" id="5898251">trimRight</span><span class="op" id="5898260">(</span><span class="ident" id="5898261">s</span>&nbsp;<span class="builtintype" id="5898263">string</span><span class="op" id="5898269">)</span>&nbsp;<span class="builtintype" id="5898271">string</span>&nbsp;<span class="op" id="5898278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5898281">return</span>&nbsp;<span class="ident" id="5898288">strings</span><span class="op" id="5898295">.</span><span class="ident" id="5898296">TrimRightFunc</span><span class="op" id="5898309">(</span><span class="ident" id="5898310">s</span><span class="op" id="5898311">,</span>&nbsp;<span class="ident" id="5898313">unicode</span><span class="op" id="5898320">.</span><span class="ident" id="5898321">IsSpace</span><span class="op" id="5898328">)</span><br>
<span class="lineno"></span><span class="op" id="5898330">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5898333">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5898417">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5898502">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5898582">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5898662">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5898686">//</span><br>
<span class="lineno"></span><span class="keyword" id="5898689">func</span>&nbsp;<span class="ident" id="5898694">stripCommonPrefix</span><span class="op" id="5898711">(</span><span class="ident" id="5898712">lines</span>&nbsp;<span class="op" id="5898718">[</span><span class="op" id="5898719">]</span><span class="builtintype" id="5898720">string</span><span class="op" id="5898726">)</span>&nbsp;<span class="op" id="5898728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5898731">if</span>&nbsp;<span class="builtinfunc" id="5898734">len</span><span class="op" id="5898737">(</span><span class="ident" id="5898738">lines</span><span class="op" id="5898743">)</span>&nbsp;<span class="op" id="5898745">&lt;=</span>&nbsp;<span class="num" id="5898748">1</span>&nbsp;<span class="op" id="5898750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5898754">return</span>&nbsp;<span class="comment" id="5898761">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5898798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898801">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898821">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898878">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898935">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898989">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899047">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899105">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899163">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899204">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899266">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899328">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899389">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899450">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899510">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899524">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899528">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899588">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899648">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899702">var</span>&nbsp;<span class="ident" id="5899706">prefix</span>&nbsp;<span class="builtintype" id="5899713">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899721">if</span>&nbsp;<span class="builtinfunc" id="5899724">len</span><span class="op" id="5899727">(</span><span class="ident" id="5899728">lines</span><span class="op" id="5899733">)</span>&nbsp;<span class="op" id="5899735">&gt;</span>&nbsp;<span class="num" id="5899737">2</span>&nbsp;<span class="op" id="5899739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899743">first</span>&nbsp;<span class="op" id="5899749">:=</span>&nbsp;<span class="builtintype" id="5899752">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899759">for</span>&nbsp;<span class="ident" id="5899763">i</span><span class="op" id="5899764">,</span>&nbsp;<span class="ident" id="5899766">line</span>&nbsp;<span class="op" id="5899771">:=</span>&nbsp;<span class="keyword" id="5899774">range</span>&nbsp;<span class="ident" id="5899780">lines</span><span class="op" id="5899785">[</span><span class="num" id="5899786">1</span>&nbsp;<span class="op" id="5899788">:</span>&nbsp;<span class="builtinfunc" id="5899790">len</span><span class="op" id="5899793">(</span><span class="ident" id="5899794">lines</span><span class="op" id="5899799">)</span><span class="op" id="5899800">-</span><span class="num" id="5899801">1</span><span class="op" id="5899802">]</span>&nbsp;<span class="op" id="5899804">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899809">switch</span>&nbsp;<span class="op" id="5899816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899821">case</span>&nbsp;<span class="ident" id="5899826">isBlank</span><span class="op" id="5899833">(</span><span class="ident" id="5899834">line</span><span class="op" id="5899838">)</span><span class="op" id="5899839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899845">lines</span><span class="op" id="5899850">[</span><span class="num" id="5899851">1</span><span class="op" id="5899852">+</span><span class="ident" id="5899853">i</span><span class="op" id="5899854">]</span>&nbsp;<span class="op" id="5899856">=</span>&nbsp;<span class="string" id="5899858">&#34;&#34;</span>&nbsp;<span class="comment" id="5899861">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899894">case</span>&nbsp;<span class="ident" id="5899899">first</span><span class="op" id="5899904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899910">prefix</span>&nbsp;<span class="op" id="5899917">=</span>&nbsp;<span class="ident" id="5899919">commonPrefix</span><span class="op" id="5899931">(</span><span class="ident" id="5899932">line</span><span class="op" id="5899936">,</span>&nbsp;<span class="ident" id="5899938">line</span><span class="op" id="5899942">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899948">first</span>&nbsp;<span class="op" id="5899954">=</span>&nbsp;<span class="builtintype" id="5899956">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899965">default</span><span class="op" id="5899972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899978">prefix</span>&nbsp;<span class="op" id="5899985">=</span>&nbsp;<span class="ident" id="5899987">commonPrefix</span><span class="op" id="5899999">(</span><span class="ident" id="5900000">prefix</span><span class="op" id="5900006">,</span>&nbsp;<span class="ident" id="5900008">line</span><span class="op" id="5900012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900021">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900024">}</span>&nbsp;<span class="keyword" id="5900026">else</span>&nbsp;<span class="op" id="5900031">{</span>&nbsp;<span class="comment" id="5900033">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900097">line</span>&nbsp;<span class="op" id="5900102">:=</span>&nbsp;<span class="ident" id="5900105">lines</span><span class="op" id="5900110">[</span><span class="num" id="5900111">1</span><span class="op" id="5900112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900116">prefix</span>&nbsp;<span class="op" id="5900123">=</span>&nbsp;<span class="ident" id="5900125">commonPrefix</span><span class="op" id="5900137">(</span><span class="ident" id="5900138">line</span><span class="op" id="5900142">,</span>&nbsp;<span class="ident" id="5900144">line</span><span class="op" id="5900148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900155">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900235">lineOfStars</span>&nbsp;<span class="op" id="5900247">:=</span>&nbsp;<span class="builtintype" id="5900250">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900257">if</span>&nbsp;<span class="ident" id="5900260">i</span>&nbsp;<span class="op" id="5900262">:=</span>&nbsp;<span class="ident" id="5900265">strings</span><span class="op" id="5900272">.</span><span class="ident" id="5900273">Index</span><span class="op" id="5900278">(</span><span class="ident" id="5900279">prefix</span><span class="op" id="5900285">,</span>&nbsp;<span class="string" id="5900287">&#34;*&#34;</span><span class="op" id="5900290">)</span><span class="op" id="5900291">;</span>&nbsp;<span class="ident" id="5900293">i</span>&nbsp;<span class="op" id="5900295">&gt;=</span>&nbsp;<span class="num" id="5900298">0</span>&nbsp;<span class="op" id="5900300">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900304">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900332">if</span>&nbsp;<span class="ident" id="5900335">i</span>&nbsp;<span class="op" id="5900337">&gt;</span>&nbsp;<span class="num" id="5900339">0</span>&nbsp;<span class="op" id="5900341">&amp;&amp;</span>&nbsp;<span class="ident" id="5900344">prefix</span><span class="op" id="5900350">[</span><span class="ident" id="5900351">i</span><span class="op" id="5900352">-</span><span class="num" id="5900353">1</span><span class="op" id="5900354">]</span>&nbsp;<span class="op" id="5900356">==</span>&nbsp;<span class="string" id="5900359">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5900363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900368">i</span><span class="op" id="5900369">--</span>&nbsp;<span class="comment" id="5900372">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900439">prefix</span>&nbsp;<span class="op" id="5900446">=</span>&nbsp;<span class="ident" id="5900448">prefix</span><span class="op" id="5900454">[</span><span class="num" id="5900455">0</span><span class="op" id="5900456">:</span><span class="ident" id="5900457">i</span><span class="op" id="5900458">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900462">lineOfStars</span>&nbsp;<span class="op" id="5900474">=</span>&nbsp;<span class="builtintype" id="5900476">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900482">}</span>&nbsp;<span class="keyword" id="5900484">else</span>&nbsp;<span class="op" id="5900489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900493">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900524">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900586">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900648">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900711">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900772">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900834">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900895">first</span>&nbsp;<span class="op" id="5900901">:=</span>&nbsp;<span class="ident" id="5900904">lines</span><span class="op" id="5900909">[</span><span class="num" id="5900910">0</span><span class="op" id="5900911">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900915">if</span>&nbsp;<span class="ident" id="5900918">isBlank</span><span class="op" id="5900925">(</span><span class="ident" id="5900926">first</span><span class="op" id="5900931">[</span><span class="num" id="5900932">2</span><span class="op" id="5900933">:</span><span class="op" id="5900934">]</span><span class="op" id="5900935">)</span>&nbsp;<span class="op" id="5900937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900942">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900983">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901030">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901082">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901135">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901160">i</span>&nbsp;<span class="op" id="5901162">:=</span>&nbsp;<span class="builtinfunc" id="5901165">len</span><span class="op" id="5901168">(</span><span class="ident" id="5901169">prefix</span><span class="op" id="5901175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901180">for</span>&nbsp;<span class="ident" id="5901184">n</span>&nbsp;<span class="op" id="5901186">:=</span>&nbsp;<span class="num" id="5901189">0</span><span class="op" id="5901190">;</span>&nbsp;<span class="ident" id="5901192">n</span>&nbsp;<span class="op" id="5901194">&lt;</span>&nbsp;<span class="num" id="5901196">3</span>&nbsp;<span class="op" id="5901198">&amp;&amp;</span>&nbsp;<span class="ident" id="5901201">i</span>&nbsp;<span class="op" id="5901203">&gt;</span>&nbsp;<span class="num" id="5901205">0</span>&nbsp;<span class="op" id="5901207">&amp;&amp;</span>&nbsp;<span class="ident" id="5901210">prefix</span><span class="op" id="5901216">[</span><span class="ident" id="5901217">i</span><span class="op" id="5901218">-</span><span class="num" id="5901219">1</span><span class="op" id="5901220">]</span>&nbsp;<span class="op" id="5901222">==</span>&nbsp;<span class="string" id="5901225">&#39;&nbsp;&#39;</span><span class="op" id="5901228">;</span>&nbsp;<span class="ident" id="5901230">n</span><span class="op" id="5901231">++</span>&nbsp;<span class="op" id="5901234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901240">i</span><span class="op" id="5901241">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901247">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901252">if</span>&nbsp;<span class="ident" id="5901255">i</span>&nbsp;<span class="op" id="5901257">==</span>&nbsp;<span class="builtinfunc" id="5901260">len</span><span class="op" id="5901263">(</span><span class="ident" id="5901264">prefix</span><span class="op" id="5901270">)</span>&nbsp;<span class="op" id="5901272">&amp;&amp;</span>&nbsp;<span class="ident" id="5901275">i</span>&nbsp;<span class="op" id="5901277">&gt;</span>&nbsp;<span class="num" id="5901279">0</span>&nbsp;<span class="op" id="5901281">&amp;&amp;</span>&nbsp;<span class="ident" id="5901284">prefix</span><span class="op" id="5901290">[</span><span class="ident" id="5901291">i</span><span class="op" id="5901292">-</span><span class="num" id="5901293">1</span><span class="op" id="5901294">]</span>&nbsp;<span class="op" id="5901296">==</span>&nbsp;<span class="string" id="5901299">&#39;\t&#39;</span>&nbsp;<span class="op" id="5901304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901310">i</span><span class="op" id="5901311">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901322">prefix</span>&nbsp;<span class="op" id="5901329">=</span>&nbsp;<span class="ident" id="5901331">prefix</span><span class="op" id="5901337">[</span><span class="num" id="5901338">0</span><span class="op" id="5901339">:</span><span class="ident" id="5901340">i</span><span class="op" id="5901341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901345">}</span>&nbsp;<span class="keyword" id="5901347">else</span>&nbsp;<span class="op" id="5901352">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901357">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901394">suffix</span>&nbsp;<span class="op" id="5901401">:=</span>&nbsp;<span class="builtinfunc" id="5901404">make</span><span class="op" id="5901408">(</span><span class="op" id="5901409">[</span><span class="op" id="5901410">]</span><span class="builtintype" id="5901411">byte</span><span class="op" id="5901415">,</span>&nbsp;<span class="builtinfunc" id="5901417">len</span><span class="op" id="5901420">(</span><span class="ident" id="5901421">first</span><span class="op" id="5901426">)</span><span class="op" id="5901427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901432">n</span>&nbsp;<span class="op" id="5901434">:=</span>&nbsp;<span class="num" id="5901437">2</span>&nbsp;<span class="comment" id="5901439">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901468">for</span>&nbsp;<span class="ident" id="5901472">n</span>&nbsp;<span class="op" id="5901474">&lt;</span>&nbsp;<span class="builtinfunc" id="5901476">len</span><span class="op" id="5901479">(</span><span class="ident" id="5901480">first</span><span class="op" id="5901485">)</span>&nbsp;<span class="op" id="5901487">&amp;&amp;</span>&nbsp;<span class="ident" id="5901490">first</span><span class="op" id="5901495">[</span><span class="ident" id="5901496">n</span><span class="op" id="5901497">]</span>&nbsp;<span class="op" id="5901499">&lt;=</span>&nbsp;<span class="string" id="5901502">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5901506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901512">suffix</span><span class="op" id="5901518">[</span><span class="ident" id="5901519">n</span><span class="op" id="5901520">]</span>&nbsp;<span class="op" id="5901522">=</span>&nbsp;<span class="ident" id="5901524">first</span><span class="op" id="5901529">[</span><span class="ident" id="5901530">n</span><span class="op" id="5901531">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901537">n</span><span class="op" id="5901538">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901549">if</span>&nbsp;<span class="ident" id="5901552">n</span>&nbsp;<span class="op" id="5901554">&gt;</span>&nbsp;<span class="num" id="5901556">2</span>&nbsp;<span class="op" id="5901558">&amp;&amp;</span>&nbsp;<span class="ident" id="5901561">suffix</span><span class="op" id="5901567">[</span><span class="num" id="5901568">2</span><span class="op" id="5901569">]</span>&nbsp;<span class="op" id="5901571">==</span>&nbsp;<span class="string" id="5901574">&#39;\t&#39;</span>&nbsp;<span class="op" id="5901579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901585">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901631">suffix</span>&nbsp;<span class="op" id="5901638">=</span>&nbsp;<span class="ident" id="5901640">suffix</span><span class="op" id="5901646">[</span><span class="num" id="5901647">2</span><span class="op" id="5901648">:</span><span class="ident" id="5901649">n</span><span class="op" id="5901650">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901655">}</span>&nbsp;<span class="keyword" id="5901657">else</span>&nbsp;<span class="op" id="5901662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901668">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901703">suffix</span><span class="op" id="5901709">[</span><span class="num" id="5901710">0</span><span class="op" id="5901711">]</span><span class="op" id="5901712">,</span>&nbsp;<span class="ident" id="5901714">suffix</span><span class="op" id="5901720">[</span><span class="num" id="5901721">1</span><span class="op" id="5901722">]</span>&nbsp;<span class="op" id="5901724">=</span>&nbsp;<span class="string" id="5901726">&#39;&nbsp;&#39;</span><span class="op" id="5901729">,</span>&nbsp;<span class="string" id="5901731">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901739">suffix</span>&nbsp;<span class="op" id="5901746">=</span>&nbsp;<span class="ident" id="5901748">suffix</span><span class="op" id="5901754">[</span><span class="num" id="5901755">0</span><span class="op" id="5901756">:</span><span class="ident" id="5901757">n</span><span class="op" id="5901758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901763">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901768">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901826">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901880">prefix</span>&nbsp;<span class="op" id="5901887">=</span>&nbsp;<span class="ident" id="5901889">strings</span><span class="op" id="5901896">.</span><span class="ident" id="5901897">TrimSuffix</span><span class="op" id="5901907">(</span><span class="ident" id="5901908">prefix</span><span class="op" id="5901914">,</span>&nbsp;<span class="builtintype" id="5901916">string</span><span class="op" id="5901922">(</span><span class="ident" id="5901923">suffix</span><span class="op" id="5901929">)</span><span class="op" id="5901930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901937">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901941">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902006">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902071">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902082">last</span>&nbsp;<span class="op" id="5902087">:=</span>&nbsp;<span class="ident" id="5902090">lines</span><span class="op" id="5902095">[</span><span class="builtinfunc" id="5902096">len</span><span class="op" id="5902099">(</span><span class="ident" id="5902100">lines</span><span class="op" id="5902105">)</span><span class="op" id="5902106">-</span><span class="num" id="5902107">1</span><span class="op" id="5902108">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902111">closing</span>&nbsp;<span class="op" id="5902119">:=</span>&nbsp;<span class="string" id="5902122">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902128">i</span>&nbsp;<span class="op" id="5902130">:=</span>&nbsp;<span class="ident" id="5902133">strings</span><span class="op" id="5902140">.</span><span class="ident" id="5902141">Index</span><span class="op" id="5902146">(</span><span class="ident" id="5902147">last</span><span class="op" id="5902151">,</span>&nbsp;<span class="ident" id="5902153">closing</span><span class="op" id="5902160">)</span>&nbsp;<span class="comment" id="5902162">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902201">if</span>&nbsp;<span class="ident" id="5902204">isBlank</span><span class="op" id="5902211">(</span><span class="ident" id="5902212">last</span><span class="op" id="5902216">[</span><span class="num" id="5902217">0</span><span class="op" id="5902218">:</span><span class="ident" id="5902219">i</span><span class="op" id="5902220">]</span><span class="op" id="5902221">)</span>&nbsp;<span class="op" id="5902223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902227">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902267">if</span>&nbsp;<span class="ident" id="5902270">lineOfStars</span>&nbsp;<span class="op" id="5902282">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902287">closing</span>&nbsp;<span class="op" id="5902295">=</span>&nbsp;<span class="string" id="5902297">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5902303">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902342">lines</span><span class="op" id="5902347">[</span><span class="builtinfunc" id="5902348">len</span><span class="op" id="5902351">(</span><span class="ident" id="5902352">lines</span><span class="op" id="5902357">)</span><span class="op" id="5902358">-</span><span class="num" id="5902359">1</span><span class="op" id="5902360">]</span>&nbsp;<span class="op" id="5902362">=</span>&nbsp;<span class="ident" id="5902364">prefix</span>&nbsp;<span class="op" id="5902371">+</span>&nbsp;<span class="ident" id="5902373">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902382">}</span>&nbsp;<span class="keyword" id="5902384">else</span>&nbsp;<span class="op" id="5902389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902393">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902444">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902496">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902523">prefix</span>&nbsp;<span class="op" id="5902530">=</span>&nbsp;<span class="ident" id="5902532">commonPrefix</span><span class="op" id="5902544">(</span><span class="ident" id="5902545">prefix</span><span class="op" id="5902551">,</span>&nbsp;<span class="ident" id="5902553">last</span><span class="op" id="5902557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902564">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902633">for</span>&nbsp;<span class="ident" id="5902637">i</span><span class="op" id="5902638">,</span>&nbsp;<span class="ident" id="5902640">line</span>&nbsp;<span class="op" id="5902645">:=</span>&nbsp;<span class="keyword" id="5902648">range</span>&nbsp;<span class="ident" id="5902654">lines</span>&nbsp;<span class="op" id="5902660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902664">if</span>&nbsp;<span class="ident" id="5902667">i</span>&nbsp;<span class="op" id="5902669">&gt;</span>&nbsp;<span class="num" id="5902671">0</span>&nbsp;<span class="op" id="5902673">&amp;&amp;</span>&nbsp;<span class="ident" id="5902676">line</span>&nbsp;<span class="op" id="5902681">!=</span>&nbsp;<span class="string" id="5902684">&#34;&#34;</span>&nbsp;<span class="op" id="5902687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902692">lines</span><span class="op" id="5902697">[</span><span class="ident" id="5902698">i</span><span class="op" id="5902699">]</span>&nbsp;<span class="op" id="5902701">=</span>&nbsp;<span class="ident" id="5902703">line</span><span class="op" id="5902707">[</span><span class="builtinfunc" id="5902708">len</span><span class="op" id="5902711">(</span><span class="ident" id="5902712">prefix</span><span class="op" id="5902718">)</span><span class="op" id="5902719">:</span><span class="op" id="5902720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902724">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902727">}</span><br>
<span class="lineno"></span><span class="op" id="5902729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5902732">func</span>&nbsp;<span class="op" id="5902737">(</span><span class="ident" id="5902738">p</span>&nbsp;<span class="op" id="5902740">*</span><span class="ident" id="5902741">printer</span><span class="op" id="5902748">)</span>&nbsp;<span class="ident" id="5902750">writeComment</span><span class="op" id="5902762">(</span><span class="ident" id="5902763">comment</span>&nbsp;<span class="op" id="5902771">*</span><span class="ident" id="5902772">ast</span><span class="op" id="5902775">.</span><span class="ident" id="5902776">Comment</span><span class="op" id="5902783">)</span>&nbsp;<span class="op" id="5902785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902788">text</span>&nbsp;<span class="op" id="5902793">:=</span>&nbsp;<span class="ident" id="5902796">comment</span><span class="op" id="5902803">.</span><span class="ident" id="5902804">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902810">pos</span>&nbsp;<span class="op" id="5902814">:=</span>&nbsp;<span class="ident" id="5902817">p</span><span class="op" id="5902818">.</span><span class="ident" id="5902819">posFor</span><span class="op" id="5902825">(</span><span class="ident" id="5902826">comment</span><span class="op" id="5902833">.</span><span class="ident" id="5902834">Pos</span><span class="op" id="5902837">(</span><span class="op" id="5902838">)</span><span class="op" id="5902839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902843">const</span>&nbsp;<span class="ident" id="5902849">linePrefix</span>&nbsp;<span class="op" id="5902860">=</span>&nbsp;<span class="string" id="5902862">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902873">if</span>&nbsp;<span class="ident" id="5902876">strings</span><span class="op" id="5902883">.</span><span class="ident" id="5902884">HasPrefix</span><span class="op" id="5902893">(</span><span class="ident" id="5902894">text</span><span class="op" id="5902898">,</span>&nbsp;<span class="ident" id="5902900">linePrefix</span><span class="op" id="5902910">)</span>&nbsp;<span class="op" id="5902912">&amp;&amp;</span>&nbsp;<span class="op" id="5902915">(</span><span class="op" id="5902916">!</span><span class="ident" id="5902917">pos</span><span class="op" id="5902920">.</span><span class="ident" id="5902921">IsValid</span><span class="op" id="5902928">(</span><span class="op" id="5902929">)</span>&nbsp;<span class="op" id="5902931">||</span>&nbsp;<span class="ident" id="5902934">pos</span><span class="op" id="5902937">.</span><span class="ident" id="5902938">Column</span>&nbsp;<span class="op" id="5902945">==</span>&nbsp;<span class="num" id="5902948">1</span><span class="op" id="5902949">)</span>&nbsp;<span class="op" id="5902951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5902955">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902986">ldir</span>&nbsp;<span class="op" id="5902991">:=</span>&nbsp;<span class="ident" id="5902994">strings</span><span class="op" id="5903001">.</span><span class="ident" id="5903002">TrimSpace</span><span class="op" id="5903011">(</span><span class="ident" id="5903012">text</span><span class="op" id="5903016">[</span><span class="builtinfunc" id="5903017">len</span><span class="op" id="5903020">(</span><span class="ident" id="5903021">linePrefix</span><span class="op" id="5903031">)</span><span class="op" id="5903032">:</span><span class="op" id="5903033">]</span><span class="op" id="5903034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903038">if</span>&nbsp;<span class="ident" id="5903041">i</span>&nbsp;<span class="op" id="5903043">:=</span>&nbsp;<span class="ident" id="5903046">strings</span><span class="op" id="5903053">.</span><span class="ident" id="5903054">LastIndex</span><span class="op" id="5903063">(</span><span class="ident" id="5903064">ldir</span><span class="op" id="5903068">,</span>&nbsp;<span class="string" id="5903070">&#34;:&#34;</span><span class="op" id="5903073">)</span><span class="op" id="5903074">;</span>&nbsp;<span class="ident" id="5903076">i</span>&nbsp;<span class="op" id="5903078">&gt;=</span>&nbsp;<span class="num" id="5903081">0</span>&nbsp;<span class="op" id="5903083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903088">if</span>&nbsp;<span class="ident" id="5903091">line</span><span class="op" id="5903095">,</span>&nbsp;<span class="ident" id="5903097">err</span>&nbsp;<span class="op" id="5903101">:=</span>&nbsp;<span class="ident" id="5903104">strconv</span><span class="op" id="5903111">.</span><span class="ident" id="5903112">Atoi</span><span class="op" id="5903116">(</span><span class="ident" id="5903117">ldir</span><span class="op" id="5903121">[</span><span class="ident" id="5903122">i</span><span class="op" id="5903123">+</span><span class="num" id="5903124">1</span><span class="op" id="5903125">:</span><span class="op" id="5903126">]</span><span class="op" id="5903127">)</span><span class="op" id="5903128">;</span>&nbsp;<span class="ident" id="5903130">err</span>&nbsp;<span class="op" id="5903134">==</span>&nbsp;<span class="builtintype" id="5903137">nil</span>&nbsp;<span class="op" id="5903141">&amp;&amp;</span>&nbsp;<span class="ident" id="5903144">line</span>&nbsp;<span class="op" id="5903149">&gt;</span>&nbsp;<span class="num" id="5903151">0</span>&nbsp;<span class="op" id="5903153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903159">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903215">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903271">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903327">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903383">indent</span>&nbsp;<span class="op" id="5903390">:=</span>&nbsp;<span class="ident" id="5903393">p</span><span class="op" id="5903394">.</span><span class="ident" id="5903395">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903406">p</span><span class="op" id="5903407">.</span><span class="ident" id="5903408">indent</span>&nbsp;<span class="op" id="5903415">=</span>&nbsp;<span class="num" id="5903417">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903423">defer</span>&nbsp;<span class="keyword" id="5903429">func</span><span class="op" id="5903433">(</span><span class="op" id="5903434">)</span>&nbsp;<span class="op" id="5903436">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903443">p</span><span class="op" id="5903444">.</span><span class="ident" id="5903445">pos</span><span class="op" id="5903448">.</span><span class="ident" id="5903449">Filename</span>&nbsp;<span class="op" id="5903458">=</span>&nbsp;<span class="ident" id="5903460">ldir</span><span class="op" id="5903464">[</span><span class="op" id="5903465">:</span><span class="ident" id="5903466">i</span><span class="op" id="5903467">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903474">p</span><span class="op" id="5903475">.</span><span class="ident" id="5903476">pos</span><span class="op" id="5903479">.</span><span class="ident" id="5903480">Line</span>&nbsp;<span class="op" id="5903485">=</span>&nbsp;<span class="ident" id="5903487">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903497">p</span><span class="op" id="5903498">.</span><span class="ident" id="5903499">pos</span><span class="op" id="5903502">.</span><span class="ident" id="5903503">Column</span>&nbsp;<span class="op" id="5903510">=</span>&nbsp;<span class="num" id="5903512">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903519">p</span><span class="op" id="5903520">.</span><span class="ident" id="5903521">indent</span>&nbsp;<span class="op" id="5903528">=</span>&nbsp;<span class="ident" id="5903530">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903541">}</span><span class="op" id="5903542">(</span><span class="op" id="5903543">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903559">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903605">if</span>&nbsp;<span class="ident" id="5903608">text</span><span class="op" id="5903612">[</span><span class="num" id="5903613">1</span><span class="op" id="5903614">]</span>&nbsp;<span class="op" id="5903616">==</span>&nbsp;<span class="string" id="5903619">&#39;/&#39;</span>&nbsp;<span class="op" id="5903623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903627">p</span><span class="op" id="5903628">.</span><span class="ident" id="5903629">writeString</span><span class="op" id="5903640">(</span><span class="ident" id="5903641">pos</span><span class="op" id="5903644">,</span>&nbsp;<span class="ident" id="5903646">trimRight</span><span class="op" id="5903655">(</span><span class="ident" id="5903656">text</span><span class="op" id="5903660">)</span><span class="op" id="5903661">,</span>&nbsp;<span class="builtintype" id="5903663">true</span><span class="op" id="5903667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903671">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903683">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903741">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903796">lines</span>&nbsp;<span class="op" id="5903802">:=</span>&nbsp;<span class="ident" id="5903805">strings</span><span class="op" id="5903812">.</span><span class="ident" id="5903813">Split</span><span class="op" id="5903818">(</span><span class="ident" id="5903819">text</span><span class="op" id="5903823">,</span>&nbsp;<span class="string" id="5903825">&#34;\n&#34;</span><span class="op" id="5903829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903833">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903890">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903952">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904013">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904076">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904136">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5904166">if</span>&nbsp;<span class="ident" id="5904169">pos</span><span class="op" id="5904172">.</span><span class="ident" id="5904173">IsValid</span><span class="op" id="5904180">(</span><span class="op" id="5904181">)</span>&nbsp;<span class="op" id="5904183">&amp;&amp;</span>&nbsp;<span class="ident" id="5904186">pos</span><span class="op" id="5904189">.</span><span class="ident" id="5904190">Column</span>&nbsp;<span class="op" id="5904197">==</span>&nbsp;<span class="num" id="5904200">1</span>&nbsp;<span class="op" id="5904202">&amp;&amp;</span>&nbsp;<span class="ident" id="5904205">p</span><span class="op" id="5904206">.</span><span class="ident" id="5904207">indent</span>&nbsp;<span class="op" id="5904214">&gt;</span>&nbsp;<span class="num" id="5904216">0</span>&nbsp;<span class="op" id="5904218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5904222">for</span>&nbsp;<span class="ident" id="5904226">i</span><span class="op" id="5904227">,</span>&nbsp;<span class="ident" id="5904229">line</span>&nbsp;<span class="op" id="5904234">:=</span>&nbsp;<span class="keyword" id="5904237">range</span>&nbsp;<span class="ident" id="5904243">lines</span><span class="op" id="5904248">[</span><span class="num" id="5904249">1</span><span class="op" id="5904250">:</span><span class="op" id="5904251">]</span>&nbsp;<span class="op" id="5904253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904258">lines</span><span class="op" id="5904263">[</span><span class="num" id="5904264">1</span><span class="op" id="5904265">+</span><span class="ident" id="5904266">i</span><span class="op" id="5904267">]</span>&nbsp;<span class="op" id="5904269">=</span>&nbsp;<span class="string" id="5904271">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5904277">+</span>&nbsp;<span class="ident" id="5904279">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904289">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904293">stripCommonPrefix</span><span class="op" id="5904310">(</span><span class="ident" id="5904311">lines</span><span class="op" id="5904316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904320">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904368">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5904413">for</span>&nbsp;<span class="ident" id="5904417">i</span><span class="op" id="5904418">,</span>&nbsp;<span class="ident" id="5904420">line</span>&nbsp;<span class="op" id="5904425">:=</span>&nbsp;<span class="keyword" id="5904428">range</span>&nbsp;<span class="ident" id="5904434">lines</span>&nbsp;<span class="op" id="5904440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5904444">if</span>&nbsp;<span class="ident" id="5904447">i</span>&nbsp;<span class="op" id="5904449">&gt;</span>&nbsp;<span class="num" id="5904451">0</span>&nbsp;<span class="op" id="5904453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904458">p</span><span class="op" id="5904459">.</span><span class="ident" id="5904460">writeByte</span><span class="op" id="5904469">(</span><span class="string" id="5904470">&#39;\f&#39;</span><span class="op" id="5904474">,</span>&nbsp;<span class="num" id="5904476">1</span><span class="op" id="5904477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904482">pos</span>&nbsp;<span class="op" id="5904486">=</span>&nbsp;<span class="ident" id="5904488">p</span><span class="op" id="5904489">.</span><span class="ident" id="5904490">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904496">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5904500">if</span>&nbsp;<span class="builtinfunc" id="5904503">len</span><span class="op" id="5904506">(</span><span class="ident" id="5904507">line</span><span class="op" id="5904511">)</span>&nbsp;<span class="op" id="5904513">&gt;</span>&nbsp;<span class="num" id="5904515">0</span>&nbsp;<span class="op" id="5904517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904522">p</span><span class="op" id="5904523">.</span><span class="ident" id="5904524">writeString</span><span class="op" id="5904535">(</span><span class="ident" id="5904536">pos</span><span class="op" id="5904539">,</span>&nbsp;<span class="ident" id="5904541">trimRight</span><span class="op" id="5904550">(</span><span class="ident" id="5904551">line</span><span class="op" id="5904555">)</span><span class="op" id="5904556">,</span>&nbsp;<span class="builtintype" id="5904558">true</span><span class="op" id="5904562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904569">}</span><br>
<span class="lineno"></span><span class="op" id="5904571">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5904574">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5904645">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5904716">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5904785">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5904853">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5904925">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5904936">//</span><br>
<span class="lineno"></span><span class="keyword" id="5904939">func</span>&nbsp;<span class="op" id="5904944">(</span><span class="ident" id="5904945">p</span>&nbsp;<span class="op" id="5904947">*</span><span class="ident" id="5904948">printer</span><span class="op" id="5904955">)</span>&nbsp;<span class="ident" id="5904957">writeCommentSuffix</span><span class="op" id="5904975">(</span><span class="ident" id="5904976">needsLinebreak</span>&nbsp;<span class="builtintype" id="5904991">bool</span><span class="op" id="5904995">)</span>&nbsp;<span class="op" id="5904997">(</span><span class="ident" id="5904998">wroteNewline</span><span class="op" id="5905010">,</span>&nbsp;<span class="ident" id="5905012">droppedFF</span>&nbsp;<span class="builtintype" id="5905022">bool</span><span class="op" id="5905026">)</span>&nbsp;<span class="op" id="5905028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905031">for</span>&nbsp;<span class="ident" id="5905035">i</span><span class="op" id="5905036">,</span>&nbsp;<span class="ident" id="5905038">ch</span>&nbsp;<span class="op" id="5905041">:=</span>&nbsp;<span class="keyword" id="5905044">range</span>&nbsp;<span class="ident" id="5905050">p</span><span class="op" id="5905051">.</span><span class="ident" id="5905052">wsbuf</span>&nbsp;<span class="op" id="5905058">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905062">switch</span>&nbsp;<span class="ident" id="5905069">ch</span>&nbsp;<span class="op" id="5905072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905076">case</span>&nbsp;<span class="ident" id="5905081">blank</span><span class="op" id="5905086">,</span>&nbsp;<span class="ident" id="5905088">vtab</span><span class="op" id="5905092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905097">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905130">p</span><span class="op" id="5905131">.</span><span class="ident" id="5905132">wsbuf</span><span class="op" id="5905137">[</span><span class="ident" id="5905138">i</span><span class="op" id="5905139">]</span>&nbsp;<span class="op" id="5905141">=</span>&nbsp;<span class="ident" id="5905143">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905152">case</span>&nbsp;<span class="ident" id="5905157">indent</span><span class="op" id="5905163">,</span>&nbsp;<span class="ident" id="5905165">unindent</span><span class="op" id="5905173">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905178">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905218">case</span>&nbsp;<span class="ident" id="5905223">newline</span><span class="op" id="5905230">,</span>&nbsp;<span class="ident" id="5905232">formfeed</span><span class="op" id="5905240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905245">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905293">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905340">if</span>&nbsp;<span class="ident" id="5905343">needsLinebreak</span>&nbsp;<span class="op" id="5905358">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905364">needsLinebreak</span>&nbsp;<span class="op" id="5905379">=</span>&nbsp;<span class="builtintype" id="5905381">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905391">wroteNewline</span>&nbsp;<span class="op" id="5905404">=</span>&nbsp;<span class="builtintype" id="5905406">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905414">}</span>&nbsp;<span class="keyword" id="5905416">else</span>&nbsp;<span class="op" id="5905421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905427">if</span>&nbsp;<span class="ident" id="5905430">ch</span>&nbsp;<span class="op" id="5905433">==</span>&nbsp;<span class="ident" id="5905436">formfeed</span>&nbsp;<span class="op" id="5905445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905452">droppedFF</span>&nbsp;<span class="op" id="5905462">=</span>&nbsp;<span class="builtintype" id="5905464">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905479">p</span><span class="op" id="5905480">.</span><span class="ident" id="5905481">wsbuf</span><span class="op" id="5905486">[</span><span class="ident" id="5905487">i</span><span class="op" id="5905488">]</span>&nbsp;<span class="op" id="5905490">=</span>&nbsp;<span class="ident" id="5905492">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905509">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905512">p</span><span class="op" id="5905513">.</span><span class="ident" id="5905514">writeWhitespace</span><span class="op" id="5905529">(</span><span class="builtinfunc" id="5905530">len</span><span class="op" id="5905533">(</span><span class="ident" id="5905534">p</span><span class="op" id="5905535">.</span><span class="ident" id="5905536">wsbuf</span><span class="op" id="5905541">)</span><span class="op" id="5905542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905546">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905581">if</span>&nbsp;<span class="ident" id="5905584">needsLinebreak</span>&nbsp;<span class="op" id="5905599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905603">p</span><span class="op" id="5905604">.</span><span class="ident" id="5905605">writeByte</span><span class="op" id="5905614">(</span><span class="string" id="5905615">&#39;\n&#39;</span><span class="op" id="5905619">,</span>&nbsp;<span class="num" id="5905621">1</span><span class="op" id="5905622">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905626">wroteNewline</span>&nbsp;<span class="op" id="5905639">=</span>&nbsp;<span class="builtintype" id="5905641">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5905651">return</span><br>
<span class="lineno"></span><span class="op" id="5905658">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5905661">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5905740">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5905821">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5905900">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5905978">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5906058">//</span><br>
<span class="lineno"></span><span class="keyword" id="5906061">func</span>&nbsp;<span class="op" id="5906066">(</span><span class="ident" id="5906067">p</span>&nbsp;<span class="op" id="5906069">*</span><span class="ident" id="5906070">printer</span><span class="op" id="5906077">)</span>&nbsp;<span class="ident" id="5906079">intersperseComments</span><span class="op" id="5906098">(</span><span class="ident" id="5906099">next</span>&nbsp;<span class="ident" id="5906104">token</span><span class="op" id="5906109">.</span><span class="ident" id="5906110">Position</span><span class="op" id="5906118">,</span>&nbsp;<span class="ident" id="5906120">tok</span>&nbsp;<span class="ident" id="5906124">token</span><span class="op" id="5906129">.</span><span class="ident" id="5906130">Token</span><span class="op" id="5906135">)</span>&nbsp;<span class="op" id="5906137">(</span><span class="ident" id="5906138">wroteNewline</span><span class="op" id="5906150">,</span>&nbsp;<span class="ident" id="5906152">droppedFF</span>&nbsp;<span class="builtintype" id="5906162">bool</span><span class="op" id="5906166">)</span>&nbsp;<span class="op" id="5906168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5906171">var</span>&nbsp;<span class="ident" id="5906175">last</span>&nbsp;<span class="op" id="5906180">*</span><span class="ident" id="5906181">ast</span><span class="op" id="5906184">.</span><span class="ident" id="5906185">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5906194">for</span>&nbsp;<span class="ident" id="5906198">p</span><span class="op" id="5906199">.</span><span class="ident" id="5906200">commentBefore</span><span class="op" id="5906213">(</span><span class="ident" id="5906214">next</span><span class="op" id="5906218">)</span>&nbsp;<span class="op" id="5906220">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5906224">for</span>&nbsp;<span class="ident" id="5906228">_</span><span class="op" id="5906229">,</span>&nbsp;<span class="ident" id="5906231">c</span>&nbsp;<span class="op" id="5906233">:=</span>&nbsp;<span class="keyword" id="5906236">range</span>&nbsp;<span class="ident" id="5906242">p</span><span class="op" id="5906243">.</span><span class="ident" id="5906244">comment</span><span class="op" id="5906251">.</span><span class="ident" id="5906252">List</span>&nbsp;<span class="op" id="5906257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906262">p</span><span class="op" id="5906263">.</span><span class="ident" id="5906264">writeCommentPrefix</span><span class="op" id="5906282">(</span><span class="ident" id="5906283">p</span><span class="op" id="5906284">.</span><span class="ident" id="5906285">posFor</span><span class="op" id="5906291">(</span><span class="ident" id="5906292">c</span><span class="op" id="5906293">.</span><span class="ident" id="5906294">Pos</span><span class="op" id="5906297">(</span><span class="op" id="5906298">)</span><span class="op" id="5906299">)</span><span class="op" id="5906300">,</span>&nbsp;<span class="ident" id="5906302">next</span><span class="op" id="5906306">,</span>&nbsp;<span class="ident" id="5906308">last</span><span class="op" id="5906312">,</span>&nbsp;<span class="ident" id="5906314">c</span><span class="op" id="5906315">,</span>&nbsp;<span class="ident" id="5906317">tok</span><span class="op" id="5906320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906325">p</span><span class="op" id="5906326">.</span><span class="ident" id="5906327">writeComment</span><span class="op" id="5906339">(</span><span class="ident" id="5906340">c</span><span class="op" id="5906341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906346">last</span>&nbsp;<span class="op" id="5906351">=</span>&nbsp;<span class="ident" id="5906353">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5906357">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906361">p</span><span class="op" id="5906362">.</span><span class="ident" id="5906363">nextComment</span><span class="op" id="5906374">(</span><span class="op" id="5906375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5906378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5906382">if</span>&nbsp;<span class="ident" id="5906385">last</span>&nbsp;<span class="op" id="5906390">!=</span>&nbsp;<span class="builtintype" id="5906393">nil</span>&nbsp;<span class="op" id="5906397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5906401">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5906466">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5906536">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5906604">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5906670">if</span>&nbsp;<span class="ident" id="5906673">p</span><span class="op" id="5906674">.</span><span class="ident" id="5906675">mode</span><span class="op" id="5906679">&amp;</span><span class="ident" id="5906680">noExtraBlank</span>&nbsp;<span class="op" id="5906693">==</span>&nbsp;<span class="num" id="5906696">0</span>&nbsp;<span class="op" id="5906698">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906704">last</span><span class="op" id="5906708">.</span><span class="ident" id="5906709">Text</span><span class="op" id="5906713">[</span><span class="num" id="5906714">1</span><span class="op" id="5906715">]</span>&nbsp;<span class="op" id="5906717">==</span>&nbsp;<span class="string" id="5906720">&#39;*&#39;</span>&nbsp;<span class="op" id="5906724">&amp;&amp;</span>&nbsp;<span class="ident" id="5906727">p</span><span class="op" id="5906728">.</span><span class="ident" id="5906729">lineFor</span><span class="op" id="5906736">(</span><span class="ident" id="5906737">last</span><span class="op" id="5906741">.</span><span class="ident" id="5906742">Pos</span><span class="op" id="5906745">(</span><span class="op" id="5906746">)</span><span class="op" id="5906747">)</span>&nbsp;<span class="op" id="5906749">==</span>&nbsp;<span class="ident" id="5906752">next</span><span class="op" id="5906756">.</span><span class="ident" id="5906757">Line</span>&nbsp;<span class="op" id="5906762">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906768">tok</span>&nbsp;<span class="op" id="5906772">!=</span>&nbsp;<span class="ident" id="5906775">token</span><span class="op" id="5906780">.</span><span class="ident" id="5906781">COMMA</span>&nbsp;<span class="op" id="5906787">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5906793">(</span><span class="ident" id="5906794">tok</span>&nbsp;<span class="op" id="5906798">!=</span>&nbsp;<span class="ident" id="5906801">token</span><span class="op" id="5906806">.</span><span class="ident" id="5906807">RPAREN</span>&nbsp;<span class="op" id="5906814">||</span>&nbsp;<span class="ident" id="5906817">p</span><span class="op" id="5906818">.</span><span class="ident" id="5906819">prevOpen</span>&nbsp;<span class="op" id="5906828">==</span>&nbsp;<span class="ident" id="5906831">token</span><span class="op" id="5906836">.</span><span class="ident" id="5906837">LPAREN</span><span class="op" id="5906843">)</span>&nbsp;<span class="op" id="5906845">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5906851">(</span><span class="ident" id="5906852">tok</span>&nbsp;<span class="op" id="5906856">!=</span>&nbsp;<span class="ident" id="5906859">token</span><span class="op" id="5906864">.</span><span class="ident" id="5906865">RBRACK</span>&nbsp;<span class="op" id="5906872">||</span>&nbsp;<span class="ident" id="5906875">p</span><span class="op" id="5906876">.</span><span class="ident" id="5906877">prevOpen</span>&nbsp;<span class="op" id="5906886">==</span>&nbsp;<span class="ident" id="5906889">token</span><span class="op" id="5906894">.</span><span class="ident" id="5906895">LBRACK</span><span class="op" id="5906901">)</span>&nbsp;<span class="op" id="5906903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5906908">p</span><span class="op" id="5906909">.</span><span class="ident" id="5906910">writeByte</span><span class="op" id="5906919">(</span><span class="string" id="5906920">&#39;&nbsp;&#39;</span><span class="op" id="5906923">,</span>&nbsp;<span class="num" id="5906925">1</span><span class="op" id="5906926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5906930">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5906934">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5906999">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907063">needsLinebreak</span>&nbsp;<span class="op" id="5907078">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907084">last</span><span class="op" id="5907088">.</span><span class="ident" id="5907089">Text</span><span class="op" id="5907093">[</span><span class="num" id="5907094">1</span><span class="op" id="5907095">]</span>&nbsp;<span class="op" id="5907097">==</span>&nbsp;<span class="string" id="5907100">&#39;/&#39;</span>&nbsp;<span class="op" id="5907104">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907111">tok</span>&nbsp;<span class="op" id="5907115">==</span>&nbsp;<span class="ident" id="5907118">token</span><span class="op" id="5907123">.</span><span class="ident" id="5907124">RBRACE</span>&nbsp;<span class="op" id="5907131">&amp;&amp;</span>&nbsp;<span class="ident" id="5907134">p</span><span class="op" id="5907135">.</span><span class="ident" id="5907136">mode</span><span class="op" id="5907140">&amp;</span><span class="ident" id="5907141">noExtraLinebreak</span>&nbsp;<span class="op" id="5907158">==</span>&nbsp;<span class="num" id="5907161">0</span>&nbsp;<span class="op" id="5907163">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907170">tok</span>&nbsp;<span class="op" id="5907174">==</span>&nbsp;<span class="ident" id="5907177">token</span><span class="op" id="5907182">.</span><span class="ident" id="5907183">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907189">return</span>&nbsp;<span class="ident" id="5907196">p</span><span class="op" id="5907197">.</span><span class="ident" id="5907198">writeCommentSuffix</span><span class="op" id="5907216">(</span><span class="ident" id="5907217">needsLinebreak</span><span class="op" id="5907231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5907234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907238">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907300">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907358">p</span><span class="op" id="5907359">.</span><span class="ident" id="5907360">internalError</span><span class="op" id="5907373">(</span><span class="string" id="5907374">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5907427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907430">return</span><br>
<span class="lineno"></span><span class="op" id="5907437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5907440">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5907498">func</span>&nbsp;<span class="op" id="5907503">(</span><span class="ident" id="5907504">p</span>&nbsp;<span class="op" id="5907506">*</span><span class="ident" id="5907507">printer</span><span class="op" id="5907514">)</span>&nbsp;<span class="ident" id="5907516">writeWhitespace</span><span class="op" id="5907531">(</span><span class="ident" id="5907532">n</span>&nbsp;<span class="builtintype" id="5907534">int</span><span class="op" id="5907537">)</span>&nbsp;<span class="op" id="5907539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907542">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907560">for</span>&nbsp;<span class="ident" id="5907564">i</span>&nbsp;<span class="op" id="5907566">:=</span>&nbsp;<span class="num" id="5907569">0</span><span class="op" id="5907570">;</span>&nbsp;<span class="ident" id="5907572">i</span>&nbsp;<span class="op" id="5907574">&lt;</span>&nbsp;<span class="ident" id="5907576">n</span><span class="op" id="5907577">;</span>&nbsp;<span class="ident" id="5907579">i</span><span class="op" id="5907580">++</span>&nbsp;<span class="op" id="5907583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907587">switch</span>&nbsp;<span class="ident" id="5907594">ch</span>&nbsp;<span class="op" id="5907597">:=</span>&nbsp;<span class="ident" id="5907600">p</span><span class="op" id="5907601">.</span><span class="ident" id="5907602">wsbuf</span><span class="op" id="5907607">[</span><span class="ident" id="5907608">i</span><span class="op" id="5907609">]</span><span class="op" id="5907610">;</span>&nbsp;<span class="ident" id="5907612">ch</span>&nbsp;<span class="op" id="5907615">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907619">case</span>&nbsp;<span class="ident" id="5907624">ignore</span><span class="op" id="5907630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907635">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907648">case</span>&nbsp;<span class="ident" id="5907653">indent</span><span class="op" id="5907659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907664">p</span><span class="op" id="5907665">.</span><span class="ident" id="5907666">indent</span><span class="op" id="5907672">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907677">case</span>&nbsp;<span class="ident" id="5907682">unindent</span><span class="op" id="5907690">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907695">p</span><span class="op" id="5907696">.</span><span class="ident" id="5907697">indent</span><span class="op" id="5907703">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907709">if</span>&nbsp;<span class="ident" id="5907712">p</span><span class="op" id="5907713">.</span><span class="ident" id="5907714">indent</span>&nbsp;<span class="op" id="5907721">&lt;</span>&nbsp;<span class="num" id="5907723">0</span>&nbsp;<span class="op" id="5907725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907731">p</span><span class="op" id="5907732">.</span><span class="ident" id="5907733">internalError</span><span class="op" id="5907746">(</span><span class="string" id="5907747">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5907770">,</span>&nbsp;<span class="ident" id="5907772">p</span><span class="op" id="5907773">.</span><span class="ident" id="5907774">indent</span><span class="op" id="5907780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907786">p</span><span class="op" id="5907787">.</span><span class="ident" id="5907788">indent</span>&nbsp;<span class="op" id="5907795">=</span>&nbsp;<span class="num" id="5907797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5907802">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5907806">case</span>&nbsp;<span class="ident" id="5907811">newline</span><span class="op" id="5907818">,</span>&nbsp;<span class="ident" id="5907820">formfeed</span><span class="op" id="5907828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907833">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907891">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907950">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908006">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908062">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908122">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908167">if</span>&nbsp;<span class="ident" id="5908170">i</span><span class="op" id="5908171">+</span><span class="num" id="5908172">1</span>&nbsp;<span class="op" id="5908174">&lt;</span>&nbsp;<span class="ident" id="5908176">n</span>&nbsp;<span class="op" id="5908178">&amp;&amp;</span>&nbsp;<span class="ident" id="5908181">p</span><span class="op" id="5908182">.</span><span class="ident" id="5908183">wsbuf</span><span class="op" id="5908188">[</span><span class="ident" id="5908189">i</span><span class="op" id="5908190">+</span><span class="num" id="5908191">1</span><span class="op" id="5908192">]</span>&nbsp;<span class="op" id="5908194">==</span>&nbsp;<span class="ident" id="5908197">unindent</span>&nbsp;<span class="op" id="5908206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908212">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908268">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908329">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908389">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908452">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5908472">p</span><span class="op" id="5908473">.</span><span class="ident" id="5908474">wsbuf</span><span class="op" id="5908479">[</span><span class="ident" id="5908480">i</span><span class="op" id="5908481">]</span><span class="op" id="5908482">,</span>&nbsp;<span class="ident" id="5908484">p</span><span class="op" id="5908485">.</span><span class="ident" id="5908486">wsbuf</span><span class="op" id="5908491">[</span><span class="ident" id="5908492">i</span><span class="op" id="5908493">+</span><span class="num" id="5908494">1</span><span class="op" id="5908495">]</span>&nbsp;<span class="op" id="5908497">=</span>&nbsp;<span class="ident" id="5908499">unindent</span><span class="op" id="5908507">,</span>&nbsp;<span class="ident" id="5908509">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5908522">i</span><span class="op" id="5908523">--</span>&nbsp;<span class="comment" id="5908526">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908545">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908562">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908576">default</span><span class="op" id="5908583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5908588">p</span><span class="op" id="5908589">.</span><span class="ident" id="5908590">writeByte</span><span class="op" id="5908599">(</span><span class="builtintype" id="5908600">byte</span><span class="op" id="5908604">(</span><span class="ident" id="5908605">ch</span><span class="op" id="5908607">)</span><span class="op" id="5908608">,</span>&nbsp;<span class="num" id="5908610">1</span><span class="op" id="5908611">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908622">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5908655">l</span>&nbsp;<span class="op" id="5908657">:=</span>&nbsp;<span class="builtinfunc" id="5908660">copy</span><span class="op" id="5908664">(</span><span class="ident" id="5908665">p</span><span class="op" id="5908666">.</span><span class="ident" id="5908667">wsbuf</span><span class="op" id="5908672">,</span>&nbsp;<span class="ident" id="5908674">p</span><span class="op" id="5908675">.</span><span class="ident" id="5908676">wsbuf</span><span class="op" id="5908681">[</span><span class="ident" id="5908682">n</span><span class="op" id="5908683">:</span><span class="op" id="5908684">]</span><span class="op" id="5908685">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5908688">p</span><span class="op" id="5908689">.</span><span class="ident" id="5908690">wsbuf</span>&nbsp;<span class="op" id="5908696">=</span>&nbsp;<span class="ident" id="5908698">p</span><span class="op" id="5908699">.</span><span class="ident" id="5908700">wsbuf</span><span class="op" id="5908705">[</span><span class="op" id="5908706">:</span><span class="ident" id="5908707">l</span><span class="op" id="5908708">]</span><br>
<span class="lineno"></span><span class="op" id="5908710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908713">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5908793">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5908816">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5908851">func</span>&nbsp;<span class="ident" id="5908856">nlimit</span><span class="op" id="5908862">(</span><span class="ident" id="5908863">n</span>&nbsp;<span class="builtintype" id="5908865">int</span><span class="op" id="5908868">)</span>&nbsp;<span class="builtintype" id="5908870">int</span>&nbsp;<span class="op" id="5908874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908877">if</span>&nbsp;<span class="ident" id="5908880">n</span>&nbsp;<span class="op" id="5908882">&gt;</span>&nbsp;<span class="ident" id="5908884">maxNewlines</span>&nbsp;<span class="op" id="5908896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5908900">n</span>&nbsp;<span class="op" id="5908902">=</span>&nbsp;<span class="ident" id="5908904">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908920">return</span>&nbsp;<span class="ident" id="5908927">n</span><br>
<span class="lineno"></span><span class="op" id="5908929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5908932">func</span>&nbsp;<span class="ident" id="5908937">mayCombine</span><span class="op" id="5908947">(</span><span class="ident" id="5908948">prev</span>&nbsp;<span class="ident" id="5908953">token</span><span class="op" id="5908958">.</span><span class="ident" id="5908959">Token</span><span class="op" id="5908964">,</span>&nbsp;<span class="ident" id="5908966">next</span>&nbsp;<span class="builtintype" id="5908971">byte</span><span class="op" id="5908975">)</span>&nbsp;<span class="op" id="5908977">(</span><span class="ident" id="5908978">b</span>&nbsp;<span class="builtintype" id="5908980">bool</span><span class="op" id="5908984">)</span>&nbsp;<span class="op" id="5908986">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5908989">switch</span>&nbsp;<span class="ident" id="5908996">prev</span>&nbsp;<span class="op" id="5909001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909004">case</span>&nbsp;<span class="ident" id="5909009">token</span><span class="op" id="5909014">.</span><span class="ident" id="5909015">INT</span><span class="op" id="5909018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5909022">b</span>&nbsp;<span class="op" id="5909024">=</span>&nbsp;<span class="ident" id="5909026">next</span>&nbsp;<span class="op" id="5909031">==</span>&nbsp;<span class="string" id="5909034">&#39;.&#39;</span>&nbsp;<span class="comment" id="5909038">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909045">case</span>&nbsp;<span class="ident" id="5909050">token</span><span class="op" id="5909055">.</span><span class="ident" id="5909056">ADD</span><span class="op" id="5909059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5909063">b</span>&nbsp;<span class="op" id="5909065">=</span>&nbsp;<span class="ident" id="5909067">next</span>&nbsp;<span class="op" id="5909072">==</span>&nbsp;<span class="string" id="5909075">&#39;+&#39;</span>&nbsp;<span class="comment" id="5909079">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909086">case</span>&nbsp;<span class="ident" id="5909091">token</span><span class="op" id="5909096">.</span><span class="ident" id="5909097">SUB</span><span class="op" id="5909100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5909104">b</span>&nbsp;<span class="op" id="5909106">=</span>&nbsp;<span class="ident" id="5909108">next</span>&nbsp;<span class="op" id="5909113">==</span>&nbsp;<span class="string" id="5909116">&#39;-&#39;</span>&nbsp;<span class="comment" id="5909120">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909127">case</span>&nbsp;<span class="ident" id="5909132">token</span><span class="op" id="5909137">.</span><span class="ident" id="5909138">QUO</span><span class="op" id="5909141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5909145">b</span>&nbsp;<span class="op" id="5909147">=</span>&nbsp;<span class="ident" id="5909149">next</span>&nbsp;<span class="op" id="5909154">==</span>&nbsp;<span class="string" id="5909157">&#39;*&#39;</span>&nbsp;<span class="comment" id="5909161">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909168">case</span>&nbsp;<span class="ident" id="5909173">token</span><span class="op" id="5909178">.</span><span class="ident" id="5909179">LSS</span><span class="op" id="5909182">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5909186">b</span>&nbsp;<span class="op" id="5909188">=</span>&nbsp;<span class="ident" id="5909190">next</span>&nbsp;<span class="op" id="5909195">==</span>&nbsp;<span class="string" id="5909198">&#39;-&#39;</span>&nbsp;<span class="op" id="5909202">||</span>&nbsp;<span class="ident" id="5909205">next</span>&nbsp;<span class="op" id="5909210">==</span>&nbsp;<span class="string" id="5909213">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5909217">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909230">case</span>&nbsp;<span class="ident" id="5909235">token</span><span class="op" id="5909240">.</span><span class="ident" id="5909241">AND</span><span class="op" id="5909244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5909248">b</span>&nbsp;<span class="op" id="5909250">=</span>&nbsp;<span class="ident" id="5909252">next</span>&nbsp;<span class="op" id="5909257">==</span>&nbsp;<span class="string" id="5909260">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5909264">||</span>&nbsp;<span class="ident" id="5909267">next</span>&nbsp;<span class="op" id="5909272">==</span>&nbsp;<span class="string" id="5909275">&#39;^&#39;</span>&nbsp;<span class="comment" id="5909279">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5909292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909295">return</span><br>
<span class="lineno">825</span><span class="op" id="5909302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5909305">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5909375">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5909445">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5909514">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5909564">//</span><br>
<span class="lineno"></span><span class="comment" id="5909567">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5909638">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5909707">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5909777">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5909847">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5909889">//</span><br>
<span class="lineno"></span><span class="keyword" id="5909892">func</span>&nbsp;<span class="op" id="5909897">(</span><span class="ident" id="5909898">p</span>&nbsp;<span class="op" id="5909900">*</span><span class="ident" id="5909901">printer</span><span class="op" id="5909908">)</span>&nbsp;<span class="builtinfunc" id="5909910">print</span><span class="op" id="5909915">(</span><span class="ident" id="5909916">args</span>&nbsp;<span class="op" id="5909921">...</span><span class="keyword" id="5909924">interface</span><span class="op" id="5909933">{</span><span class="op" id="5909934">}</span><span class="op" id="5909935">)</span>&nbsp;<span class="op" id="5909937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5909940">for</span>&nbsp;<span class="ident" id="5909944">_</span><span class="op" id="5909945">,</span>&nbsp;<span class="ident" id="5909947">arg</span>&nbsp;<span class="op" id="5909951">:=</span>&nbsp;<span class="keyword" id="5909954">range</span>&nbsp;<span class="ident" id="5909960">args</span>&nbsp;<span class="op" id="5909965">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5909969">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910008">var</span>&nbsp;<span class="ident" id="5910012">data</span>&nbsp;<span class="builtintype" id="5910017">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910026">var</span>&nbsp;<span class="ident" id="5910030">isLit</span>&nbsp;<span class="builtintype" id="5910036">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910043">var</span>&nbsp;<span class="ident" id="5910047">impliedSemi</span>&nbsp;<span class="builtintype" id="5910059">bool</span>&nbsp;<span class="comment" id="5910064">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910109">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910152">switch</span>&nbsp;<span class="ident" id="5910159">p</span><span class="op" id="5910160">.</span><span class="ident" id="5910161">lastTok</span>&nbsp;<span class="op" id="5910169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910173">case</span>&nbsp;<span class="ident" id="5910178">token</span><span class="op" id="5910183">.</span><span class="ident" id="5910184">ILLEGAL</span><span class="op" id="5910191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910196">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910222">case</span>&nbsp;<span class="ident" id="5910227">token</span><span class="op" id="5910232">.</span><span class="ident" id="5910233">LPAREN</span><span class="op" id="5910239">,</span>&nbsp;<span class="ident" id="5910241">token</span><span class="op" id="5910246">.</span><span class="ident" id="5910247">LBRACK</span><span class="op" id="5910253">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910258">p</span><span class="op" id="5910259">.</span><span class="ident" id="5910260">prevOpen</span>&nbsp;<span class="op" id="5910269">=</span>&nbsp;<span class="ident" id="5910271">p</span><span class="op" id="5910272">.</span><span class="ident" id="5910273">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910283">default</span><span class="op" id="5910290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910295">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910341">p</span><span class="op" id="5910342">.</span><span class="ident" id="5910343">prevOpen</span>&nbsp;<span class="op" id="5910352">=</span>&nbsp;<span class="ident" id="5910354">token</span><span class="op" id="5910359">.</span><span class="ident" id="5910360">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5910370">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910375">switch</span>&nbsp;<span class="ident" id="5910382">x</span>&nbsp;<span class="op" id="5910384">:=</span>&nbsp;<span class="ident" id="5910387">arg</span><span class="op" id="5910390">.</span><span class="op" id="5910391">(</span><span class="keyword" id="5910392">type</span><span class="op" id="5910396">)</span>&nbsp;<span class="op" id="5910398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910402">case</span>&nbsp;<span class="ident" id="5910407">pmode</span><span class="op" id="5910412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910417">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910443">p</span><span class="op" id="5910444">.</span><span class="ident" id="5910445">mode</span>&nbsp;<span class="op" id="5910450">^=</span>&nbsp;<span class="ident" id="5910453">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910458">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910470">case</span>&nbsp;<span class="ident" id="5910475">whiteSpace</span><span class="op" id="5910485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910490">if</span>&nbsp;<span class="ident" id="5910493">x</span>&nbsp;<span class="op" id="5910495">==</span>&nbsp;<span class="ident" id="5910498">ignore</span>&nbsp;<span class="op" id="5910505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910511">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910557">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910605">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910625">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5910637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910642">i</span>&nbsp;<span class="op" id="5910644">:=</span>&nbsp;<span class="builtinfunc" id="5910647">len</span><span class="op" id="5910650">(</span><span class="ident" id="5910651">p</span><span class="op" id="5910652">.</span><span class="ident" id="5910653">wsbuf</span><span class="op" id="5910658">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910663">if</span>&nbsp;<span class="ident" id="5910666">i</span>&nbsp;<span class="op" id="5910668">==</span>&nbsp;<span class="builtinfunc" id="5910671">cap</span><span class="op" id="5910674">(</span><span class="ident" id="5910675">p</span><span class="op" id="5910676">.</span><span class="ident" id="5910677">wsbuf</span><span class="op" id="5910682">)</span>&nbsp;<span class="op" id="5910684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910690">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910748">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910806">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910855">p</span><span class="op" id="5910856">.</span><span class="ident" id="5910857">writeWhitespace</span><span class="op" id="5910872">(</span><span class="ident" id="5910873">i</span><span class="op" id="5910874">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910880">i</span>&nbsp;<span class="op" id="5910882">=</span>&nbsp;<span class="num" id="5910884">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5910889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910894">p</span><span class="op" id="5910895">.</span><span class="ident" id="5910896">wsbuf</span>&nbsp;<span class="op" id="5910902">=</span>&nbsp;<span class="ident" id="5910904">p</span><span class="op" id="5910905">.</span><span class="ident" id="5910906">wsbuf</span><span class="op" id="5910911">[</span><span class="num" id="5910912">0</span>&nbsp;<span class="op" id="5910914">:</span>&nbsp;<span class="ident" id="5910916">i</span><span class="op" id="5910917">+</span><span class="num" id="5910918">1</span><span class="op" id="5910919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5910924">p</span><span class="op" id="5910925">.</span><span class="ident" id="5910926">wsbuf</span><span class="op" id="5910931">[</span><span class="ident" id="5910932">i</span><span class="op" id="5910933">]</span>&nbsp;<span class="op" id="5910935">=</span>&nbsp;<span class="ident" id="5910937">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5910942">if</span>&nbsp;<span class="ident" id="5910945">x</span>&nbsp;<span class="op" id="5910947">==</span>&nbsp;<span class="ident" id="5910950">newline</span>&nbsp;<span class="op" id="5910958">||</span>&nbsp;<span class="ident" id="5910961">x</span>&nbsp;<span class="op" id="5910963">==</span>&nbsp;<span class="ident" id="5910966">formfeed</span>&nbsp;<span class="op" id="5910975">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910981">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911038">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911096">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911155">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911175">p</span><span class="op" id="5911176">.</span><span class="ident" id="5911177">impliedSemi</span>&nbsp;<span class="op" id="5911189">=</span>&nbsp;<span class="builtintype" id="5911191">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5911200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911205">p</span><span class="op" id="5911206">.</span><span class="ident" id="5911207">lastTok</span>&nbsp;<span class="op" id="5911215">=</span>&nbsp;<span class="ident" id="5911217">token</span><span class="op" id="5911222">.</span><span class="ident" id="5911223">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5911234">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5911246">case</span>&nbsp;<span class="op" id="5911251">*</span><span class="ident" id="5911252">ast</span><span class="op" id="5911255">.</span><span class="ident" id="5911256">Ident</span><span class="op" id="5911261">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911266">data</span>&nbsp;<span class="op" id="5911271">=</span>&nbsp;<span class="ident" id="5911273">x</span><span class="op" id="5911274">.</span><span class="ident" id="5911275">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911283">impliedSemi</span>&nbsp;<span class="op" id="5911295">=</span>&nbsp;<span class="builtintype" id="5911297">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911305">p</span><span class="op" id="5911306">.</span><span class="ident" id="5911307">lastTok</span>&nbsp;<span class="op" id="5911315">=</span>&nbsp;<span class="ident" id="5911317">token</span><span class="op" id="5911322">.</span><span class="ident" id="5911323">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5911332">case</span>&nbsp;<span class="op" id="5911337">*</span><span class="ident" id="5911338">ast</span><span class="op" id="5911341">.</span><span class="ident" id="5911342">BasicLit</span><span class="op" id="5911350">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911355">data</span>&nbsp;<span class="op" id="5911360">=</span>&nbsp;<span class="ident" id="5911362">x</span><span class="op" id="5911363">.</span><span class="ident" id="5911364">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911373">isLit</span>&nbsp;<span class="op" id="5911379">=</span>&nbsp;<span class="builtintype" id="5911381">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911389">impliedSemi</span>&nbsp;<span class="op" id="5911401">=</span>&nbsp;<span class="builtintype" id="5911403">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911411">p</span><span class="op" id="5911412">.</span><span class="ident" id="5911413">lastTok</span>&nbsp;<span class="op" id="5911421">=</span>&nbsp;<span class="ident" id="5911423">x</span><span class="op" id="5911424">.</span><span class="ident" id="5911425">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5911433">case</span>&nbsp;<span class="ident" id="5911438">token</span><span class="op" id="5911443">.</span><span class="ident" id="5911444">Token</span><span class="op" id="5911449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911454">s</span>&nbsp;<span class="op" id="5911456">:=</span>&nbsp;<span class="ident" id="5911459">x</span><span class="op" id="5911460">.</span><span class="ident" id="5911461">String</span><span class="op" id="5911467">(</span><span class="op" id="5911468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5911473">if</span>&nbsp;<span class="ident" id="5911476">mayCombine</span><span class="op" id="5911486">(</span><span class="ident" id="5911487">p</span><span class="op" id="5911488">.</span><span class="ident" id="5911489">lastTok</span><span class="op" id="5911496">,</span>&nbsp;<span class="ident" id="5911498">s</span><span class="op" id="5911499">[</span><span class="num" id="5911500">0</span><span class="op" id="5911501">]</span><span class="op" id="5911502">)</span>&nbsp;<span class="op" id="5911504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911510">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911560">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911611">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911660">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911712">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911764">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5911808">if</span>&nbsp;<span class="builtinfunc" id="5911811">len</span><span class="op" id="5911814">(</span><span class="ident" id="5911815">p</span><span class="op" id="5911816">.</span><span class="ident" id="5911817">wsbuf</span><span class="op" id="5911822">)</span>&nbsp;<span class="op" id="5911824">!=</span>&nbsp;<span class="num" id="5911827">0</span>&nbsp;<span class="op" id="5911829">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911836">p</span><span class="op" id="5911837">.</span><span class="ident" id="5911838">internalError</span><span class="op" id="5911851">(</span><span class="string" id="5911852">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5911881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5911887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911893">p</span><span class="op" id="5911894">.</span><span class="ident" id="5911895">wsbuf</span>&nbsp;<span class="op" id="5911901">=</span>&nbsp;<span class="ident" id="5911903">p</span><span class="op" id="5911904">.</span><span class="ident" id="5911905">wsbuf</span><span class="op" id="5911910">[</span><span class="num" id="5911911">0</span><span class="op" id="5911912">:</span><span class="num" id="5911913">1</span><span class="op" id="5911914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911920">p</span><span class="op" id="5911921">.</span><span class="ident" id="5911922">wsbuf</span><span class="op" id="5911927">[</span><span class="num" id="5911928">0</span><span class="op" id="5911929">]</span>&nbsp;<span class="op" id="5911931">=</span>&nbsp;<span class="string" id="5911933">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5911940">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911945">data</span>&nbsp;<span class="op" id="5911950">=</span>&nbsp;<span class="ident" id="5911952">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911957">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912017">switch</span>&nbsp;<span class="ident" id="5912024">x</span>&nbsp;<span class="op" id="5912026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912031">case</span>&nbsp;<span class="ident" id="5912036">token</span><span class="op" id="5912041">.</span><span class="ident" id="5912042">BREAK</span><span class="op" id="5912047">,</span>&nbsp;<span class="ident" id="5912049">token</span><span class="op" id="5912054">.</span><span class="ident" id="5912055">CONTINUE</span><span class="op" id="5912063">,</span>&nbsp;<span class="ident" id="5912065">token</span><span class="op" id="5912070">.</span><span class="ident" id="5912071">FALLTHROUGH</span><span class="op" id="5912082">,</span>&nbsp;<span class="ident" id="5912084">token</span><span class="op" id="5912089">.</span><span class="ident" id="5912090">RETURN</span><span class="op" id="5912096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912102">token</span><span class="op" id="5912107">.</span><span class="ident" id="5912108">INC</span><span class="op" id="5912111">,</span>&nbsp;<span class="ident" id="5912113">token</span><span class="op" id="5912118">.</span><span class="ident" id="5912119">DEC</span><span class="op" id="5912122">,</span>&nbsp;<span class="ident" id="5912124">token</span><span class="op" id="5912129">.</span><span class="ident" id="5912130">RPAREN</span><span class="op" id="5912136">,</span>&nbsp;<span class="ident" id="5912138">token</span><span class="op" id="5912143">.</span><span class="ident" id="5912144">RBRACK</span><span class="op" id="5912150">,</span>&nbsp;<span class="ident" id="5912152">token</span><span class="op" id="5912157">.</span><span class="ident" id="5912158">RBRACE</span><span class="op" id="5912164">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912170">impliedSemi</span>&nbsp;<span class="op" id="5912182">=</span>&nbsp;<span class="builtintype" id="5912184">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912197">p</span><span class="op" id="5912198">.</span><span class="ident" id="5912199">lastTok</span>&nbsp;<span class="op" id="5912207">=</span>&nbsp;<span class="ident" id="5912209">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912214">case</span>&nbsp;<span class="ident" id="5912219">token</span><span class="op" id="5912224">.</span><span class="ident" id="5912225">Pos</span><span class="op" id="5912228">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912233">if</span>&nbsp;<span class="ident" id="5912236">x</span><span class="op" id="5912237">.</span><span class="ident" id="5912238">IsValid</span><span class="op" id="5912245">(</span><span class="op" id="5912246">)</span>&nbsp;<span class="op" id="5912248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912254">p</span><span class="op" id="5912255">.</span><span class="ident" id="5912256">pos</span>&nbsp;<span class="op" id="5912260">=</span>&nbsp;<span class="ident" id="5912262">p</span><span class="op" id="5912263">.</span><span class="ident" id="5912264">posFor</span><span class="op" id="5912270">(</span><span class="ident" id="5912271">x</span><span class="op" id="5912272">)</span>&nbsp;<span class="comment" id="5912274">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912316">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912328">case</span>&nbsp;<span class="builtintype" id="5912333">string</span><span class="op" id="5912339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912344">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912386">data</span>&nbsp;<span class="op" id="5912391">=</span>&nbsp;<span class="ident" id="5912393">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912398">isLit</span>&nbsp;<span class="op" id="5912404">=</span>&nbsp;<span class="builtintype" id="5912406">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912414">impliedSemi</span>&nbsp;<span class="op" id="5912426">=</span>&nbsp;<span class="builtintype" id="5912428">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912436">p</span><span class="op" id="5912437">.</span><span class="ident" id="5912438">lastTok</span>&nbsp;<span class="op" id="5912446">=</span>&nbsp;<span class="ident" id="5912448">token</span><span class="op" id="5912453">.</span><span class="ident" id="5912454">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912464">default</span><span class="op" id="5912471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912476">fmt</span><span class="op" id="5912479">.</span><span class="ident" id="5912480">Fprintf</span><span class="op" id="5912487">(</span><span class="ident" id="5912488">os</span><span class="op" id="5912490">.</span><span class="ident" id="5912491">Stderr</span><span class="op" id="5912497">,</span>&nbsp;<span class="string" id="5912499">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5912538">,</span>&nbsp;<span class="ident" id="5912540">arg</span><span class="op" id="5912543">,</span>&nbsp;<span class="ident" id="5912545">arg</span><span class="op" id="5912548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5912553">panic</span><span class="op" id="5912558">(</span><span class="string" id="5912559">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5912576">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912584">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912601">next</span>&nbsp;<span class="op" id="5912606">:=</span>&nbsp;<span class="ident" id="5912609">p</span><span class="op" id="5912610">.</span><span class="ident" id="5912611">pos</span>&nbsp;<span class="comment" id="5912615">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912661">wroteNewline</span><span class="op" id="5912673">,</span>&nbsp;<span class="ident" id="5912675">droppedFF</span>&nbsp;<span class="op" id="5912685">:=</span>&nbsp;<span class="ident" id="5912688">p</span><span class="op" id="5912689">.</span><span class="ident" id="5912690">flush</span><span class="op" id="5912695">(</span><span class="ident" id="5912696">next</span><span class="op" id="5912700">,</span>&nbsp;<span class="ident" id="5912702">p</span><span class="op" id="5912703">.</span><span class="ident" id="5912704">lastTok</span><span class="op" id="5912711">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912716">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912777">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912837">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912902">if</span>&nbsp;<span class="op" id="5912905">!</span><span class="ident" id="5912906">p</span><span class="op" id="5912907">.</span><span class="ident" id="5912908">impliedSemi</span>&nbsp;<span class="op" id="5912920">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912925">n</span>&nbsp;<span class="op" id="5912927">:=</span>&nbsp;<span class="ident" id="5912930">nlimit</span><span class="op" id="5912936">(</span><span class="ident" id="5912937">next</span><span class="op" id="5912941">.</span><span class="ident" id="5912942">Line</span>&nbsp;<span class="op" id="5912947">-</span>&nbsp;<span class="ident" id="5912949">p</span><span class="op" id="5912950">.</span><span class="ident" id="5912951">pos</span><span class="op" id="5912954">.</span><span class="ident" id="5912955">Line</span><span class="op" id="5912959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912964">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913019">if</span>&nbsp;<span class="ident" id="5913022">wroteNewline</span>&nbsp;<span class="op" id="5913035">&amp;&amp;</span>&nbsp;<span class="ident" id="5913038">n</span>&nbsp;<span class="op" id="5913040">==</span>&nbsp;<span class="ident" id="5913043">maxNewlines</span>&nbsp;<span class="op" id="5913055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913061">n</span>&nbsp;<span class="op" id="5913063">=</span>&nbsp;<span class="ident" id="5913065">maxNewlines</span>&nbsp;<span class="op" id="5913077">-</span>&nbsp;<span class="num" id="5913079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913084">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913089">if</span>&nbsp;<span class="ident" id="5913092">n</span>&nbsp;<span class="op" id="5913094">&gt;</span>&nbsp;<span class="num" id="5913096">0</span>&nbsp;<span class="op" id="5913098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913104">ch</span>&nbsp;<span class="op" id="5913107">:=</span>&nbsp;<span class="builtintype" id="5913110">byte</span><span class="op" id="5913114">(</span><span class="string" id="5913115">&#39;\n&#39;</span><span class="op" id="5913119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913125">if</span>&nbsp;<span class="ident" id="5913128">droppedFF</span>&nbsp;<span class="op" id="5913138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913145">ch</span>&nbsp;<span class="op" id="5913148">=</span>&nbsp;<span class="string" id="5913150">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5913155">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913203">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913209">p</span><span class="op" id="5913210">.</span><span class="ident" id="5913211">writeByte</span><span class="op" id="5913220">(</span><span class="ident" id="5913221">ch</span><span class="op" id="5913223">,</span>&nbsp;<span class="ident" id="5913225">n</span><span class="op" id="5913226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913232">impliedSemi</span>&nbsp;<span class="op" id="5913244">=</span>&nbsp;<span class="builtintype" id="5913246">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913264">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913333">if</span>&nbsp;<span class="ident" id="5913336">p</span><span class="op" id="5913337">.</span><span class="ident" id="5913338">linePtr</span>&nbsp;<span class="op" id="5913346">!=</span>&nbsp;<span class="builtintype" id="5913349">nil</span>&nbsp;<span class="op" id="5913353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913358">*</span><span class="ident" id="5913359">p</span><span class="op" id="5913360">.</span><span class="ident" id="5913361">linePtr</span>&nbsp;<span class="op" id="5913369">=</span>&nbsp;<span class="ident" id="5913371">p</span><span class="op" id="5913372">.</span><span class="ident" id="5913373">out</span><span class="op" id="5913376">.</span><span class="ident" id="5913377">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913385">p</span><span class="op" id="5913386">.</span><span class="ident" id="5913387">linePtr</span>&nbsp;<span class="op" id="5913395">=</span>&nbsp;<span class="builtintype" id="5913397">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913403">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913408">p</span><span class="op" id="5913409">.</span><span class="ident" id="5913410">writeString</span><span class="op" id="5913421">(</span><span class="ident" id="5913422">next</span><span class="op" id="5913426">,</span>&nbsp;<span class="ident" id="5913428">data</span><span class="op" id="5913432">,</span>&nbsp;<span class="ident" id="5913434">isLit</span><span class="op" id="5913439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913443">p</span><span class="op" id="5913444">.</span><span class="ident" id="5913445">impliedSemi</span>&nbsp;<span class="op" id="5913457">=</span>&nbsp;<span class="ident" id="5913459">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913472">}</span><br>
<span class="lineno"></span><span class="op" id="5913474">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5913477">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5913549">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5913622">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5913699">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5913710">//</span><br>
<span class="lineno"></span><span class="keyword" id="5913713">func</span>&nbsp;<span class="op" id="5913718">(</span><span class="ident" id="5913719">p</span>&nbsp;<span class="op" id="5913721">*</span><span class="ident" id="5913722">printer</span><span class="op" id="5913729">)</span>&nbsp;<span class="ident" id="5913731">flush</span><span class="op" id="5913736">(</span><span class="ident" id="5913737">next</span>&nbsp;<span class="ident" id="5913742">token</span><span class="op" id="5913747">.</span><span class="ident" id="5913748">Position</span><span class="op" id="5913756">,</span>&nbsp;<span class="ident" id="5913758">tok</span>&nbsp;<span class="ident" id="5913762">token</span><span class="op" id="5913767">.</span><span class="ident" id="5913768">Token</span><span class="op" id="5913773">)</span>&nbsp;<span class="op" id="5913775">(</span><span class="ident" id="5913776">wroteNewline</span><span class="op" id="5913788">,</span>&nbsp;<span class="ident" id="5913790">droppedFF</span>&nbsp;<span class="builtintype" id="5913800">bool</span><span class="op" id="5913804">)</span>&nbsp;<span class="op" id="5913806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913809">if</span>&nbsp;<span class="ident" id="5913812">p</span><span class="op" id="5913813">.</span><span class="ident" id="5913814">commentBefore</span><span class="op" id="5913827">(</span><span class="ident" id="5913828">next</span><span class="op" id="5913832">)</span>&nbsp;<span class="op" id="5913834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913838">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913904">wroteNewline</span><span class="op" id="5913916">,</span>&nbsp;<span class="ident" id="5913918">droppedFF</span>&nbsp;<span class="op" id="5913928">=</span>&nbsp;<span class="ident" id="5913930">p</span><span class="op" id="5913931">.</span><span class="ident" id="5913932">intersperseComments</span><span class="op" id="5913951">(</span><span class="ident" id="5913952">next</span><span class="op" id="5913956">,</span>&nbsp;<span class="ident" id="5913958">tok</span><span class="op" id="5913961">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913964">}</span>&nbsp;<span class="keyword" id="5913966">else</span>&nbsp;<span class="op" id="5913971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913975">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914021">p</span><span class="op" id="5914022">.</span><span class="ident" id="5914023">writeWhitespace</span><span class="op" id="5914038">(</span><span class="builtinfunc" id="5914039">len</span><span class="op" id="5914042">(</span><span class="ident" id="5914043">p</span><span class="op" id="5914044">.</span><span class="ident" id="5914045">wsbuf</span><span class="op" id="5914050">)</span><span class="op" id="5914051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914057">return</span><br>
<span class="lineno">990</span><span class="op" id="5914064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5914067">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5914134">func</span>&nbsp;<span class="ident" id="5914139">getDoc</span><span class="op" id="5914145">(</span><span class="ident" id="5914146">n</span>&nbsp;<span class="ident" id="5914148">ast</span><span class="op" id="5914151">.</span><span class="ident" id="5914152">Node</span><span class="op" id="5914156">)</span>&nbsp;<span class="op" id="5914158">*</span><span class="ident" id="5914159">ast</span><span class="op" id="5914162">.</span><span class="ident" id="5914163">CommentGroup</span>&nbsp;<span class="op" id="5914176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914179">switch</span>&nbsp;<span class="ident" id="5914186">n</span>&nbsp;<span class="op" id="5914188">:=</span>&nbsp;<span class="ident" id="5914191">n</span><span class="op" id="5914192">.</span><span class="op" id="5914193">(</span><span class="keyword" id="5914194">type</span><span class="op" id="5914198">)</span>&nbsp;<span class="op" id="5914200">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914203">case</span>&nbsp;<span class="op" id="5914208">*</span><span class="ident" id="5914209">ast</span><span class="op" id="5914212">.</span><span class="ident" id="5914213">Field</span><span class="op" id="5914218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914222">return</span>&nbsp;<span class="ident" id="5914229">n</span><span class="op" id="5914230">.</span><span class="ident" id="5914231">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914236">case</span>&nbsp;<span class="op" id="5914241">*</span><span class="ident" id="5914242">ast</span><span class="op" id="5914245">.</span><span class="ident" id="5914246">ImportSpec</span><span class="op" id="5914256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914260">return</span>&nbsp;<span class="ident" id="5914267">n</span><span class="op" id="5914268">.</span><span class="ident" id="5914269">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914274">case</span>&nbsp;<span class="op" id="5914279">*</span><span class="ident" id="5914280">ast</span><span class="op" id="5914283">.</span><span class="ident" id="5914284">ValueSpec</span><span class="op" id="5914293">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914297">return</span>&nbsp;<span class="ident" id="5914304">n</span><span class="op" id="5914305">.</span><span class="ident" id="5914306">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914311">case</span>&nbsp;<span class="op" id="5914316">*</span><span class="ident" id="5914317">ast</span><span class="op" id="5914320">.</span><span class="ident" id="5914321">TypeSpec</span><span class="op" id="5914329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914333">return</span>&nbsp;<span class="ident" id="5914340">n</span><span class="op" id="5914341">.</span><span class="ident" id="5914342">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914347">case</span>&nbsp;<span class="op" id="5914352">*</span><span class="ident" id="5914353">ast</span><span class="op" id="5914356">.</span><span class="ident" id="5914357">GenDecl</span><span class="op" id="5914364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914368">return</span>&nbsp;<span class="ident" id="5914375">n</span><span class="op" id="5914376">.</span><span class="ident" id="5914377">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914382">case</span>&nbsp;<span class="op" id="5914387">*</span><span class="ident" id="5914388">ast</span><span class="op" id="5914391">.</span><span class="ident" id="5914392">FuncDecl</span><span class="op" id="5914400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914404">return</span>&nbsp;<span class="ident" id="5914411">n</span><span class="op" id="5914412">.</span><span class="ident" id="5914413">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914418">case</span>&nbsp;<span class="op" id="5914423">*</span><span class="ident" id="5914424">ast</span><span class="op" id="5914427">.</span><span class="ident" id="5914428">File</span><span class="op" id="5914432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914436">return</span>&nbsp;<span class="ident" id="5914443">n</span><span class="op" id="5914444">.</span><span class="ident" id="5914445">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914450">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914453">return</span>&nbsp;<span class="builtintype" id="5914460">nil</span><br>
<span class="lineno"></span><span class="op" id="5914464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5914467">func</span>&nbsp;<span class="op" id="5914472">(</span><span class="ident" id="5914473">p</span>&nbsp;<span class="op" id="5914475">*</span><span class="ident" id="5914476">printer</span><span class="op" id="5914483">)</span>&nbsp;<span class="ident" id="5914485">printNode</span><span class="op" id="5914494">(</span><span class="ident" id="5914495">node</span>&nbsp;<span class="keyword" id="5914500">interface</span><span class="op" id="5914509">{</span><span class="op" id="5914510">}</span><span class="op" id="5914511">)</span>&nbsp;<span class="builtintype" id="5914513">error</span>&nbsp;<span class="op" id="5914519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914522">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914556">var</span>&nbsp;<span class="ident" id="5914560">comments</span>&nbsp;<span class="op" id="5914569">[</span><span class="op" id="5914570">]</span><span class="op" id="5914571">*</span><span class="ident" id="5914572">ast</span><span class="op" id="5914575">.</span><span class="ident" id="5914576">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914590">if</span>&nbsp;<span class="ident" id="5914593">cnode</span><span class="op" id="5914598">,</span>&nbsp;<span class="ident" id="5914600">ok</span>&nbsp;<span class="op" id="5914603">:=</span>&nbsp;<span class="ident" id="5914606">node</span><span class="op" id="5914610">.</span><span class="op" id="5914611">(</span><span class="op" id="5914612">*</span><span class="ident" id="5914613">CommentedNode</span><span class="op" id="5914626">)</span><span class="op" id="5914627">;</span>&nbsp;<span class="ident" id="5914629">ok</span>&nbsp;<span class="op" id="5914632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914636">node</span>&nbsp;<span class="op" id="5914641">=</span>&nbsp;<span class="ident" id="5914643">cnode</span><span class="op" id="5914648">.</span><span class="ident" id="5914649">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914656">comments</span>&nbsp;<span class="op" id="5914665">=</span>&nbsp;<span class="ident" id="5914667">cnode</span><span class="op" id="5914672">.</span><span class="ident" id="5914673">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914683">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914687">if</span>&nbsp;<span class="ident" id="5914690">comments</span>&nbsp;<span class="op" id="5914699">!=</span>&nbsp;<span class="builtintype" id="5914702">nil</span>&nbsp;<span class="op" id="5914706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914710">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914772">n</span><span class="op" id="5914773">,</span>&nbsp;<span class="ident" id="5914775">ok</span>&nbsp;<span class="op" id="5914778">:=</span>&nbsp;<span class="ident" id="5914781">node</span><span class="op" id="5914785">.</span><span class="op" id="5914786">(</span><span class="ident" id="5914787">ast</span><span class="op" id="5914790">.</span><span class="ident" id="5914791">Node</span><span class="op" id="5914795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914799">if</span>&nbsp;<span class="op" id="5914802">!</span><span class="ident" id="5914803">ok</span>&nbsp;<span class="op" id="5914806">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914811">goto</span>&nbsp;<span class="ident" id="5914816">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914834">beg</span>&nbsp;<span class="op" id="5914838">:=</span>&nbsp;<span class="ident" id="5914841">n</span><span class="op" id="5914842">.</span><span class="ident" id="5914843">Pos</span><span class="op" id="5914846">(</span><span class="op" id="5914847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914851">end</span>&nbsp;<span class="op" id="5914855">:=</span>&nbsp;<span class="ident" id="5914858">n</span><span class="op" id="5914859">.</span><span class="ident" id="5914860">End</span><span class="op" id="5914863">(</span><span class="op" id="5914864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914868">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914915">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914959">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915005">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915056">if</span>&nbsp;<span class="ident" id="5915059">doc</span>&nbsp;<span class="op" id="5915063">:=</span>&nbsp;<span class="ident" id="5915066">getDoc</span><span class="op" id="5915072">(</span><span class="ident" id="5915073">n</span><span class="op" id="5915074">)</span><span class="op" id="5915075">;</span>&nbsp;<span class="ident" id="5915077">doc</span>&nbsp;<span class="op" id="5915081">!=</span>&nbsp;<span class="builtintype" id="5915084">nil</span>&nbsp;<span class="op" id="5915088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915093">beg</span>&nbsp;<span class="op" id="5915097">=</span>&nbsp;<span class="ident" id="5915099">doc</span><span class="op" id="5915102">.</span><span class="ident" id="5915103">Pos</span><span class="op" id="5915106">(</span><span class="op" id="5915107">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915115">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915164">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915191">i</span>&nbsp;<span class="op" id="5915193">:=</span>&nbsp;<span class="num" id="5915196">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915200">for</span>&nbsp;<span class="ident" id="5915204">i</span>&nbsp;<span class="op" id="5915206">&lt;</span>&nbsp;<span class="builtinfunc" id="5915208">len</span><span class="op" id="5915211">(</span><span class="ident" id="5915212">comments</span><span class="op" id="5915220">)</span>&nbsp;<span class="op" id="5915222">&amp;&amp;</span>&nbsp;<span class="ident" id="5915225">comments</span><span class="op" id="5915233">[</span><span class="ident" id="5915234">i</span><span class="op" id="5915235">]</span><span class="op" id="5915236">.</span><span class="ident" id="5915237">End</span><span class="op" id="5915240">(</span><span class="op" id="5915241">)</span>&nbsp;<span class="op" id="5915243">&lt;</span>&nbsp;<span class="ident" id="5915245">beg</span>&nbsp;<span class="op" id="5915249">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915254">i</span><span class="op" id="5915255">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915264">j</span>&nbsp;<span class="op" id="5915266">:=</span>&nbsp;<span class="ident" id="5915269">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915273">for</span>&nbsp;<span class="ident" id="5915277">j</span>&nbsp;<span class="op" id="5915279">&lt;</span>&nbsp;<span class="builtinfunc" id="5915281">len</span><span class="op" id="5915284">(</span><span class="ident" id="5915285">comments</span><span class="op" id="5915293">)</span>&nbsp;<span class="op" id="5915295">&amp;&amp;</span>&nbsp;<span class="ident" id="5915298">comments</span><span class="op" id="5915306">[</span><span class="ident" id="5915307">j</span><span class="op" id="5915308">]</span><span class="op" id="5915309">.</span><span class="ident" id="5915310">Pos</span><span class="op" id="5915313">(</span><span class="op" id="5915314">)</span>&nbsp;<span class="op" id="5915316">&lt;</span>&nbsp;<span class="ident" id="5915318">end</span>&nbsp;<span class="op" id="5915322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915327">j</span><span class="op" id="5915328">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915337">if</span>&nbsp;<span class="ident" id="5915340">i</span>&nbsp;<span class="op" id="5915342">&lt;</span>&nbsp;<span class="ident" id="5915344">j</span>&nbsp;<span class="op" id="5915346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915351">p</span><span class="op" id="5915352">.</span><span class="ident" id="5915353">comments</span>&nbsp;<span class="op" id="5915362">=</span>&nbsp;<span class="ident" id="5915364">comments</span><span class="op" id="5915372">[</span><span class="ident" id="5915373">i</span><span class="op" id="5915374">:</span><span class="ident" id="5915375">j</span><span class="op" id="5915376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915383">}</span>&nbsp;<span class="keyword" id="5915385">else</span>&nbsp;<span class="keyword" id="5915390">if</span>&nbsp;<span class="ident" id="5915393">n</span><span class="op" id="5915394">,</span>&nbsp;<span class="ident" id="5915396">ok</span>&nbsp;<span class="op" id="5915399">:=</span>&nbsp;<span class="ident" id="5915402">node</span><span class="op" id="5915406">.</span><span class="op" id="5915407">(</span><span class="op" id="5915408">*</span><span class="ident" id="5915409">ast</span><span class="op" id="5915412">.</span><span class="ident" id="5915413">File</span><span class="op" id="5915417">)</span><span class="op" id="5915418">;</span>&nbsp;<span class="ident" id="5915420">ok</span>&nbsp;<span class="op" id="5915423">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915427">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915462">p</span><span class="op" id="5915463">.</span><span class="ident" id="5915464">comments</span>&nbsp;<span class="op" id="5915473">=</span>&nbsp;<span class="ident" id="5915475">n</span><span class="op" id="5915476">.</span><span class="ident" id="5915477">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915491">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915539">p</span><span class="op" id="5915540">.</span><span class="ident" id="5915541">useNodeComments</span>&nbsp;<span class="op" id="5915557">=</span>&nbsp;<span class="ident" id="5915559">p</span><span class="op" id="5915560">.</span><span class="ident" id="5915561">comments</span>&nbsp;<span class="op" id="5915570">==</span>&nbsp;<span class="builtintype" id="5915573">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915579">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915610">p</span><span class="op" id="5915611">.</span><span class="ident" id="5915612">nextComment</span><span class="op" id="5915623">(</span><span class="op" id="5915624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915628">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915644">switch</span>&nbsp;<span class="ident" id="5915651">n</span>&nbsp;<span class="op" id="5915653">:=</span>&nbsp;<span class="ident" id="5915656">node</span><span class="op" id="5915660">.</span><span class="op" id="5915661">(</span><span class="keyword" id="5915662">type</span><span class="op" id="5915666">)</span>&nbsp;<span class="op" id="5915668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915671">case</span>&nbsp;<span class="ident" id="5915676">ast</span><span class="op" id="5915679">.</span><span class="ident" id="5915680">Expr</span><span class="op" id="5915684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915688">p</span><span class="op" id="5915689">.</span><span class="ident" id="5915690">expr</span><span class="op" id="5915694">(</span><span class="ident" id="5915695">n</span><span class="op" id="5915696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915699">case</span>&nbsp;<span class="ident" id="5915704">ast</span><span class="op" id="5915707">.</span><span class="ident" id="5915708">Stmt</span><span class="op" id="5915712">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915716">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5915779">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915838">if</span>&nbsp;<span class="ident" id="5915841">_</span><span class="op" id="5915842">,</span>&nbsp;<span class="ident" id="5915844">ok</span>&nbsp;<span class="op" id="5915847">:=</span>&nbsp;<span class="ident" id="5915850">n</span><span class="op" id="5915851">.</span><span class="op" id="5915852">(</span><span class="op" id="5915853">*</span><span class="ident" id="5915854">ast</span><span class="op" id="5915857">.</span><span class="ident" id="5915858">LabeledStmt</span><span class="op" id="5915869">)</span><span class="op" id="5915870">;</span>&nbsp;<span class="ident" id="5915872">ok</span>&nbsp;<span class="op" id="5915875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915880">p</span><span class="op" id="5915881">.</span><span class="ident" id="5915882">indent</span>&nbsp;<span class="op" id="5915889">=</span>&nbsp;<span class="num" id="5915891">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915895">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915899">p</span><span class="op" id="5915900">.</span><span class="ident" id="5915901">stmt</span><span class="op" id="5915905">(</span><span class="ident" id="5915906">n</span><span class="op" id="5915907">,</span>&nbsp;<span class="builtintype" id="5915909">false</span><span class="op" id="5915914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915917">case</span>&nbsp;<span class="ident" id="5915922">ast</span><span class="op" id="5915925">.</span><span class="ident" id="5915926">Decl</span><span class="op" id="5915930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915934">p</span><span class="op" id="5915935">.</span><span class="ident" id="5915936">decl</span><span class="op" id="5915940">(</span><span class="ident" id="5915941">n</span><span class="op" id="5915942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915945">case</span>&nbsp;<span class="ident" id="5915950">ast</span><span class="op" id="5915953">.</span><span class="ident" id="5915954">Spec</span><span class="op" id="5915958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915962">p</span><span class="op" id="5915963">.</span><span class="ident" id="5915964">spec</span><span class="op" id="5915968">(</span><span class="ident" id="5915969">n</span><span class="op" id="5915970">,</span>&nbsp;<span class="num" id="5915972">1</span><span class="op" id="5915973">,</span>&nbsp;<span class="builtintype" id="5915975">false</span><span class="op" id="5915980">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915983">case</span>&nbsp;<span class="op" id="5915988">[</span><span class="op" id="5915989">]</span><span class="ident" id="5915990">ast</span><span class="op" id="5915993">.</span><span class="ident" id="5915994">Stmt</span><span class="op" id="5915998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916002">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5916065">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916124">for</span>&nbsp;<span class="ident" id="5916128">_</span><span class="op" id="5916129">,</span>&nbsp;<span class="ident" id="5916131">s</span>&nbsp;<span class="op" id="5916133">:=</span>&nbsp;<span class="keyword" id="5916136">range</span>&nbsp;<span class="ident" id="5916142">n</span>&nbsp;<span class="op" id="5916144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916149">if</span>&nbsp;<span class="ident" id="5916152">_</span><span class="op" id="5916153">,</span>&nbsp;<span class="ident" id="5916155">ok</span>&nbsp;<span class="op" id="5916158">:=</span>&nbsp;<span class="ident" id="5916161">s</span><span class="op" id="5916162">.</span><span class="op" id="5916163">(</span><span class="op" id="5916164">*</span><span class="ident" id="5916165">ast</span><span class="op" id="5916168">.</span><span class="ident" id="5916169">LabeledStmt</span><span class="op" id="5916180">)</span><span class="op" id="5916181">;</span>&nbsp;<span class="ident" id="5916183">ok</span>&nbsp;<span class="op" id="5916186">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916192">p</span><span class="op" id="5916193">.</span><span class="ident" id="5916194">indent</span>&nbsp;<span class="op" id="5916201">=</span>&nbsp;<span class="num" id="5916203">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916216">p</span><span class="op" id="5916217">.</span><span class="ident" id="5916218">stmtList</span><span class="op" id="5916226">(</span><span class="ident" id="5916227">n</span><span class="op" id="5916228">,</span>&nbsp;<span class="num" id="5916230">0</span><span class="op" id="5916231">,</span>&nbsp;<span class="builtintype" id="5916233">false</span><span class="op" id="5916238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916241">case</span>&nbsp;<span class="op" id="5916246">[</span><span class="op" id="5916247">]</span><span class="ident" id="5916248">ast</span><span class="op" id="5916251">.</span><span class="ident" id="5916252">Decl</span><span class="op" id="5916256">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916260">p</span><span class="op" id="5916261">.</span><span class="ident" id="5916262">declList</span><span class="op" id="5916270">(</span><span class="ident" id="5916271">n</span><span class="op" id="5916272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916275">case</span>&nbsp;<span class="op" id="5916280">*</span><span class="ident" id="5916281">ast</span><span class="op" id="5916284">.</span><span class="ident" id="5916285">File</span><span class="op" id="5916289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916293">p</span><span class="op" id="5916294">.</span><span class="ident" id="5916295">file</span><span class="op" id="5916299">(</span><span class="ident" id="5916300">n</span><span class="op" id="5916301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916304">default</span><span class="op" id="5916311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916315">goto</span>&nbsp;<span class="ident" id="5916320">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916337">return</span>&nbsp;<span class="builtintype" id="5916344">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5916349">unsupported</span><span class="op" id="5916360">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916363">return</span>&nbsp;<span class="ident" id="5916370">fmt</span><span class="op" id="5916373">.</span><span class="ident" id="5916374">Errorf</span><span class="op" id="5916380">(</span><span class="string" id="5916381">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5916419">,</span>&nbsp;<span class="ident" id="5916421">node</span><span class="op" id="5916425">)</span><br>
<span class="lineno"></span><span class="op" id="5916427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916430">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5916510">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5916522">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5916589">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5916658">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5916727">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5916796">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5916818">//</span><br>
<span class="lineno"></span><span class="keyword" id="5916821">type</span>&nbsp;<span class="ident" id="5916826">trimmer</span>&nbsp;<span class="keyword" id="5916834">struct</span>&nbsp;<span class="op" id="5916841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916844">output</span>&nbsp;<span class="ident" id="5916851">io</span><span class="op" id="5916853">.</span><span class="ident" id="5916854">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916862">state</span>&nbsp;&nbsp;<span class="builtintype" id="5916869">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916874">space</span>&nbsp;&nbsp;<span class="op" id="5916881">[</span><span class="op" id="5916882">]</span><span class="builtintype" id="5916883">byte</span><br>
<span class="lineno"></span><span class="op" id="5916888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916891">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5916937">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5916982">const</span>&nbsp;<span class="op" id="5916988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916991">inSpace</span>&nbsp;&nbsp;<span class="op" id="5917000">=</span>&nbsp;<span class="ident" id="5917002">iota</span>&nbsp;<span class="comment" id="5917007">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917024">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917040">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917087">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917103">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5917118">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5917121">func</span>&nbsp;<span class="op" id="5917126">(</span><span class="ident" id="5917127">p</span>&nbsp;<span class="op" id="5917129">*</span><span class="ident" id="5917130">trimmer</span><span class="op" id="5917137">)</span>&nbsp;<span class="ident" id="5917139">resetSpace</span><span class="op" id="5917149">(</span><span class="op" id="5917150">)</span>&nbsp;<span class="op" id="5917152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917155">p</span><span class="op" id="5917156">.</span><span class="ident" id="5917157">state</span>&nbsp;<span class="op" id="5917163">=</span>&nbsp;<span class="ident" id="5917165">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917174">p</span><span class="op" id="5917175">.</span><span class="ident" id="5917176">space</span>&nbsp;<span class="op" id="5917182">=</span>&nbsp;<span class="ident" id="5917184">p</span><span class="op" id="5917185">.</span><span class="ident" id="5917186">space</span><span class="op" id="5917191">[</span><span class="num" id="5917192">0</span><span class="op" id="5917193">:</span><span class="num" id="5917194">0</span><span class="op" id="5917195">]</span><br>
<span class="lineno"></span><span class="op" id="5917197">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5917200">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5917270">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5917340">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5917408">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5917475">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5917507">var</span>&nbsp;<span class="ident" id="5917511">aNewline</span>&nbsp;<span class="op" id="5917520">=</span>&nbsp;<span class="op" id="5917522">[</span><span class="op" id="5917523">]</span><span class="builtintype" id="5917524">byte</span><span class="op" id="5917528">(</span><span class="string" id="5917529">&#34;\n&#34;</span><span class="op" id="5917533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5917536">func</span>&nbsp;<span class="op" id="5917541">(</span><span class="ident" id="5917542">p</span>&nbsp;<span class="op" id="5917544">*</span><span class="ident" id="5917545">trimmer</span><span class="op" id="5917552">)</span>&nbsp;<span class="ident" id="5917554">Write</span><span class="op" id="5917559">(</span><span class="ident" id="5917560">data</span>&nbsp;<span class="op" id="5917565">[</span><span class="op" id="5917566">]</span><span class="builtintype" id="5917567">byte</span><span class="op" id="5917571">)</span>&nbsp;<span class="op" id="5917573">(</span><span class="ident" id="5917574">n</span>&nbsp;<span class="builtintype" id="5917576">int</span><span class="op" id="5917579">,</span>&nbsp;<span class="ident" id="5917581">err</span>&nbsp;<span class="builtintype" id="5917585">error</span><span class="op" id="5917590">)</span>&nbsp;<span class="op" id="5917592">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917595">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917611">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917635">//&nbsp;&nbsp;&nbsp;&nbsp;p.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917660">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5917693">//&nbsp;&nbsp;&nbsp;&nbsp;data[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917720">m</span>&nbsp;<span class="op" id="5917722">:=</span>&nbsp;<span class="num" id="5917725">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917728">var</span>&nbsp;<span class="ident" id="5917732">b</span>&nbsp;<span class="builtintype" id="5917734">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917740">for</span>&nbsp;<span class="ident" id="5917744">n</span><span class="op" id="5917745">,</span>&nbsp;<span class="ident" id="5917747">b</span>&nbsp;<span class="op" id="5917749">=</span>&nbsp;<span class="keyword" id="5917751">range</span>&nbsp;<span class="ident" id="5917757">data</span>&nbsp;<span class="op" id="5917762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917766">if</span>&nbsp;<span class="ident" id="5917769">b</span>&nbsp;<span class="op" id="5917771">==</span>&nbsp;<span class="string" id="5917774">&#39;\v&#39;</span>&nbsp;<span class="op" id="5917779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917784">b</span>&nbsp;<span class="op" id="5917786">=</span>&nbsp;<span class="string" id="5917788">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5917793">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917818">switch</span>&nbsp;<span class="ident" id="5917825">p</span><span class="op" id="5917826">.</span><span class="ident" id="5917827">state</span>&nbsp;<span class="op" id="5917833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917837">case</span>&nbsp;<span class="ident" id="5917842">inSpace</span><span class="op" id="5917849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917854">switch</span>&nbsp;<span class="ident" id="5917861">b</span>&nbsp;<span class="op" id="5917863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917868">case</span>&nbsp;<span class="string" id="5917873">&#39;\t&#39;</span><span class="op" id="5917877">,</span>&nbsp;<span class="string" id="5917879">&#39;&nbsp;&#39;</span><span class="op" id="5917882">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917888">p</span><span class="op" id="5917889">.</span><span class="ident" id="5917890">space</span>&nbsp;<span class="op" id="5917896">=</span>&nbsp;<span class="builtinfunc" id="5917898">append</span><span class="op" id="5917904">(</span><span class="ident" id="5917905">p</span><span class="op" id="5917906">.</span><span class="ident" id="5917907">space</span><span class="op" id="5917912">,</span>&nbsp;<span class="ident" id="5917914">b</span><span class="op" id="5917915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917920">case</span>&nbsp;<span class="string" id="5917925">&#39;\n&#39;</span><span class="op" id="5917929">,</span>&nbsp;<span class="string" id="5917931">&#39;\f&#39;</span><span class="op" id="5917935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917941">p</span><span class="op" id="5917942">.</span><span class="ident" id="5917943">resetSpace</span><span class="op" id="5917953">(</span><span class="op" id="5917954">)</span>&nbsp;<span class="comment" id="5917956">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917986">_</span><span class="op" id="5917987">,</span>&nbsp;<span class="ident" id="5917989">err</span>&nbsp;<span class="op" id="5917993">=</span>&nbsp;<span class="ident" id="5917995">p</span><span class="op" id="5917996">.</span><span class="ident" id="5917997">output</span><span class="op" id="5918003">.</span><span class="ident" id="5918004">Write</span><span class="op" id="5918009">(</span><span class="ident" id="5918010">aNewline</span><span class="op" id="5918018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918023">case</span>&nbsp;<span class="ident" id="5918028">tabwriter</span><span class="op" id="5918037">.</span><span class="ident" id="5918038">Escape</span><span class="op" id="5918044">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918050">_</span><span class="op" id="5918051">,</span>&nbsp;<span class="ident" id="5918053">err</span>&nbsp;<span class="op" id="5918057">=</span>&nbsp;<span class="ident" id="5918059">p</span><span class="op" id="5918060">.</span><span class="ident" id="5918061">output</span><span class="op" id="5918067">.</span><span class="ident" id="5918068">Write</span><span class="op" id="5918073">(</span><span class="ident" id="5918074">p</span><span class="op" id="5918075">.</span><span class="ident" id="5918076">space</span><span class="op" id="5918081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918087">p</span><span class="op" id="5918088">.</span><span class="ident" id="5918089">state</span>&nbsp;<span class="op" id="5918095">=</span>&nbsp;<span class="ident" id="5918097">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918110">m</span>&nbsp;<span class="op" id="5918112">=</span>&nbsp;<span class="ident" id="5918114">n</span>&nbsp;<span class="op" id="5918116">+</span>&nbsp;<span class="num" id="5918118">1</span>&nbsp;<span class="comment" id="5918120">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918152">default</span><span class="op" id="5918159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918165">_</span><span class="op" id="5918166">,</span>&nbsp;<span class="ident" id="5918168">err</span>&nbsp;<span class="op" id="5918172">=</span>&nbsp;<span class="ident" id="5918174">p</span><span class="op" id="5918175">.</span><span class="ident" id="5918176">output</span><span class="op" id="5918182">.</span><span class="ident" id="5918183">Write</span><span class="op" id="5918188">(</span><span class="ident" id="5918189">p</span><span class="op" id="5918190">.</span><span class="ident" id="5918191">space</span><span class="op" id="5918196">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918202">p</span><span class="op" id="5918203">.</span><span class="ident" id="5918204">state</span>&nbsp;<span class="op" id="5918210">=</span>&nbsp;<span class="ident" id="5918212">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918223">m</span>&nbsp;<span class="op" id="5918225">=</span>&nbsp;<span class="ident" id="5918227">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918236">case</span>&nbsp;<span class="ident" id="5918241">inEscape</span><span class="op" id="5918249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918254">if</span>&nbsp;<span class="ident" id="5918257">b</span>&nbsp;<span class="op" id="5918259">==</span>&nbsp;<span class="ident" id="5918262">tabwriter</span><span class="op" id="5918271">.</span><span class="ident" id="5918272">Escape</span>&nbsp;<span class="op" id="5918279">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918285">_</span><span class="op" id="5918286">,</span>&nbsp;<span class="ident" id="5918288">err</span>&nbsp;<span class="op" id="5918292">=</span>&nbsp;<span class="ident" id="5918294">p</span><span class="op" id="5918295">.</span><span class="ident" id="5918296">output</span><span class="op" id="5918302">.</span><span class="ident" id="5918303">Write</span><span class="op" id="5918308">(</span><span class="ident" id="5918309">data</span><span class="op" id="5918313">[</span><span class="ident" id="5918314">m</span><span class="op" id="5918315">:</span><span class="ident" id="5918316">n</span><span class="op" id="5918317">]</span><span class="op" id="5918318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918324">p</span><span class="op" id="5918325">.</span><span class="ident" id="5918326">resetSpace</span><span class="op" id="5918336">(</span><span class="op" id="5918337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918346">case</span>&nbsp;<span class="ident" id="5918351">inText</span><span class="op" id="5918357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918362">switch</span>&nbsp;<span class="ident" id="5918369">b</span>&nbsp;<span class="op" id="5918371">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918376">case</span>&nbsp;<span class="string" id="5918381">&#39;\t&#39;</span><span class="op" id="5918385">,</span>&nbsp;<span class="string" id="5918387">&#39;&nbsp;&#39;</span><span class="op" id="5918390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918396">_</span><span class="op" id="5918397">,</span>&nbsp;<span class="ident" id="5918399">err</span>&nbsp;<span class="op" id="5918403">=</span>&nbsp;<span class="ident" id="5918405">p</span><span class="op" id="5918406">.</span><span class="ident" id="5918407">output</span><span class="op" id="5918413">.</span><span class="ident" id="5918414">Write</span><span class="op" id="5918419">(</span><span class="ident" id="5918420">data</span><span class="op" id="5918424">[</span><span class="ident" id="5918425">m</span><span class="op" id="5918426">:</span><span class="ident" id="5918427">n</span><span class="op" id="5918428">]</span><span class="op" id="5918429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918435">p</span><span class="op" id="5918436">.</span><span class="ident" id="5918437">resetSpace</span><span class="op" id="5918447">(</span><span class="op" id="5918448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918454">p</span><span class="op" id="5918455">.</span><span class="ident" id="5918456">space</span>&nbsp;<span class="op" id="5918462">=</span>&nbsp;<span class="builtinfunc" id="5918464">append</span><span class="op" id="5918470">(</span><span class="ident" id="5918471">p</span><span class="op" id="5918472">.</span><span class="ident" id="5918473">space</span><span class="op" id="5918478">,</span>&nbsp;<span class="ident" id="5918480">b</span><span class="op" id="5918481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918486">case</span>&nbsp;<span class="string" id="5918491">&#39;\n&#39;</span><span class="op" id="5918495">,</span>&nbsp;<span class="string" id="5918497">&#39;\f&#39;</span><span class="op" id="5918501">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918507">_</span><span class="op" id="5918508">,</span>&nbsp;<span class="ident" id="5918510">err</span>&nbsp;<span class="op" id="5918514">=</span>&nbsp;<span class="ident" id="5918516">p</span><span class="op" id="5918517">.</span><span class="ident" id="5918518">output</span><span class="op" id="5918524">.</span><span class="ident" id="5918525">Write</span><span class="op" id="5918530">(</span><span class="ident" id="5918531">data</span><span class="op" id="5918535">[</span><span class="ident" id="5918536">m</span><span class="op" id="5918537">:</span><span class="ident" id="5918538">n</span><span class="op" id="5918539">]</span><span class="op" id="5918540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918546">p</span><span class="op" id="5918547">.</span><span class="ident" id="5918548">resetSpace</span><span class="op" id="5918558">(</span><span class="op" id="5918559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918565">_</span><span class="op" id="5918566">,</span>&nbsp;<span class="ident" id="5918568">err</span>&nbsp;<span class="op" id="5918572">=</span>&nbsp;<span class="ident" id="5918574">p</span><span class="op" id="5918575">.</span><span class="ident" id="5918576">output</span><span class="op" id="5918582">.</span><span class="ident" id="5918583">Write</span><span class="op" id="5918588">(</span><span class="ident" id="5918589">aNewline</span><span class="op" id="5918597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918602">case</span>&nbsp;<span class="ident" id="5918607">tabwriter</span><span class="op" id="5918616">.</span><span class="ident" id="5918617">Escape</span><span class="op" id="5918623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918629">_</span><span class="op" id="5918630">,</span>&nbsp;<span class="ident" id="5918632">err</span>&nbsp;<span class="op" id="5918636">=</span>&nbsp;<span class="ident" id="5918638">p</span><span class="op" id="5918639">.</span><span class="ident" id="5918640">output</span><span class="op" id="5918646">.</span><span class="ident" id="5918647">Write</span><span class="op" id="5918652">(</span><span class="ident" id="5918653">data</span><span class="op" id="5918657">[</span><span class="ident" id="5918658">m</span><span class="op" id="5918659">:</span><span class="ident" id="5918660">n</span><span class="op" id="5918661">]</span><span class="op" id="5918662">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918668">p</span><span class="op" id="5918669">.</span><span class="ident" id="5918670">state</span>&nbsp;<span class="op" id="5918676">=</span>&nbsp;<span class="ident" id="5918678">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918691">m</span>&nbsp;<span class="op" id="5918693">=</span>&nbsp;<span class="ident" id="5918695">n</span>&nbsp;<span class="op" id="5918697">+</span>&nbsp;<span class="num" id="5918699">1</span>&nbsp;<span class="comment" id="5918701">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918737">default</span><span class="op" id="5918744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5918749">panic</span><span class="op" id="5918754">(</span><span class="string" id="5918755">&#34;unreachable&#34;</span><span class="op" id="5918768">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918776">if</span>&nbsp;<span class="ident" id="5918779">err</span>&nbsp;<span class="op" id="5918783">!=</span>&nbsp;<span class="builtintype" id="5918786">nil</span>&nbsp;<span class="op" id="5918790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918795">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918807">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918810">n</span>&nbsp;<span class="op" id="5918812">=</span>&nbsp;<span class="builtinfunc" id="5918814">len</span><span class="op" id="5918817">(</span><span class="ident" id="5918818">data</span><span class="op" id="5918822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918826">switch</span>&nbsp;<span class="ident" id="5918833">p</span><span class="op" id="5918834">.</span><span class="ident" id="5918835">state</span>&nbsp;<span class="op" id="5918841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918844">case</span>&nbsp;<span class="ident" id="5918849">inEscape</span><span class="op" id="5918857">,</span>&nbsp;<span class="ident" id="5918859">inText</span><span class="op" id="5918865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918869">_</span><span class="op" id="5918870">,</span>&nbsp;<span class="ident" id="5918872">err</span>&nbsp;<span class="op" id="5918876">=</span>&nbsp;<span class="ident" id="5918878">p</span><span class="op" id="5918879">.</span><span class="ident" id="5918880">output</span><span class="op" id="5918886">.</span><span class="ident" id="5918887">Write</span><span class="op" id="5918892">(</span><span class="ident" id="5918893">data</span><span class="op" id="5918897">[</span><span class="ident" id="5918898">m</span><span class="op" id="5918899">:</span><span class="ident" id="5918900">n</span><span class="op" id="5918901">]</span><span class="op" id="5918902">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918906">p</span><span class="op" id="5918907">.</span><span class="ident" id="5918908">resetSpace</span><span class="op" id="5918918">(</span><span class="op" id="5918919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918926">return</span><br>
<span class="lineno"></span><span class="op" id="5918933">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5918936">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5919016">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5919037">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5919102">type</span>&nbsp;<span class="ident" id="5919107">Mode</span>&nbsp;<span class="builtintype" id="5919112">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5919118">const</span>&nbsp;<span class="op" id="5919124">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919127">RawFormat</span>&nbsp;<span class="ident" id="5919137">Mode</span>&nbsp;<span class="op" id="5919142">=</span>&nbsp;<span class="num" id="5919144">1</span>&nbsp;<span class="op" id="5919146">&lt;&lt;</span>&nbsp;<span class="ident" id="5919149">iota</span>&nbsp;<span class="comment" id="5919154">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919211">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919238">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919292">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919319">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919364">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919391">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5919453">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5919456">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5919504">type</span>&nbsp;<span class="ident" id="5919509">Config</span>&nbsp;<span class="keyword" id="5919516">struct</span>&nbsp;<span class="op" id="5919523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919526">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919535">Mode</span>&nbsp;<span class="comment" id="5919540">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919555">Tabwidth</span>&nbsp;<span class="builtintype" id="5919564">int</span>&nbsp;&nbsp;<span class="comment" id="5919569">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919584">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5919593">int</span>&nbsp;&nbsp;<span class="comment" id="5919598">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5919657">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5919660">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5919749">func</span>&nbsp;<span class="op" id="5919754">(</span><span class="ident" id="5919755">cfg</span>&nbsp;<span class="op" id="5919759">*</span><span class="ident" id="5919760">Config</span><span class="op" id="5919766">)</span>&nbsp;<span class="ident" id="5919768">fprint</span><span class="op" id="5919774">(</span><span class="ident" id="5919775">output</span>&nbsp;<span class="ident" id="5919782">io</span><span class="op" id="5919784">.</span><span class="ident" id="5919785">Writer</span><span class="op" id="5919791">,</span>&nbsp;<span class="ident" id="5919793">fset</span>&nbsp;<span class="op" id="5919798">*</span><span class="ident" id="5919799">token</span><span class="op" id="5919804">.</span><span class="ident" id="5919805">FileSet</span><span class="op" id="5919812">,</span>&nbsp;<span class="ident" id="5919814">node</span>&nbsp;<span class="keyword" id="5919819">interface</span><span class="op" id="5919828">{</span><span class="op" id="5919829">}</span><span class="op" id="5919830">,</span>&nbsp;<span class="ident" id="5919832">nodeSizes</span>&nbsp;<span class="keyword" id="5919842">map</span><span class="op" id="5919845">[</span><span class="ident" id="5919846">ast</span><span class="op" id="5919849">.</span><span class="ident" id="5919850">Node</span><span class="op" id="5919854">]</span><span class="builtintype" id="5919855">int</span><span class="op" id="5919858">)</span>&nbsp;<span class="op" id="5919860">(</span><span class="ident" id="5919861">err</span>&nbsp;<span class="builtintype" id="5919865">error</span><span class="op" id="5919870">)</span>&nbsp;<span class="op" id="5919872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919875">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919890">var</span>&nbsp;<span class="ident" id="5919894">p</span>&nbsp;<span class="ident" id="5919896">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919905">p</span><span class="op" id="5919906">.</span><span class="ident" id="5919907">init</span><span class="op" id="5919911">(</span><span class="ident" id="5919912">cfg</span><span class="op" id="5919915">,</span>&nbsp;<span class="ident" id="5919917">fset</span><span class="op" id="5919921">,</span>&nbsp;<span class="ident" id="5919923">nodeSizes</span><span class="op" id="5919932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919935">if</span>&nbsp;<span class="ident" id="5919938">err</span>&nbsp;<span class="op" id="5919942">=</span>&nbsp;<span class="ident" id="5919944">p</span><span class="op" id="5919945">.</span><span class="ident" id="5919946">printNode</span><span class="op" id="5919955">(</span><span class="ident" id="5919956">node</span><span class="op" id="5919960">)</span><span class="op" id="5919961">;</span>&nbsp;<span class="ident" id="5919963">err</span>&nbsp;<span class="op" id="5919967">!=</span>&nbsp;<span class="builtintype" id="5919970">nil</span>&nbsp;<span class="op" id="5919974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919978">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919989">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920020">p</span><span class="op" id="5920021">.</span><span class="ident" id="5920022">impliedSemi</span>&nbsp;<span class="op" id="5920034">=</span>&nbsp;<span class="builtintype" id="5920036">false</span>&nbsp;<span class="comment" id="5920042">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920070">p</span><span class="op" id="5920071">.</span><span class="ident" id="5920072">flush</span><span class="op" id="5920077">(</span><span class="ident" id="5920078">token</span><span class="op" id="5920083">.</span><span class="ident" id="5920084">Position</span><span class="op" id="5920092">{</span><span class="ident" id="5920093">Offset</span><span class="op" id="5920099">:</span>&nbsp;<span class="ident" id="5920101">infinity</span><span class="op" id="5920109">,</span>&nbsp;<span class="ident" id="5920111">Line</span><span class="op" id="5920115">:</span>&nbsp;<span class="ident" id="5920117">infinity</span><span class="op" id="5920125">}</span><span class="op" id="5920126">,</span>&nbsp;<span class="ident" id="5920128">token</span><span class="op" id="5920133">.</span><span class="ident" id="5920134">EOF</span><span class="op" id="5920137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920141">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920212">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920284">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920349">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920416">output</span>&nbsp;<span class="op" id="5920423">=</span>&nbsp;<span class="op" id="5920425">&amp;</span><span class="ident" id="5920426">trimmer</span><span class="op" id="5920433">{</span><span class="ident" id="5920434">output</span><span class="op" id="5920440">:</span>&nbsp;<span class="ident" id="5920442">output</span><span class="op" id="5920448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920452">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920505">if</span>&nbsp;<span class="ident" id="5920508">cfg</span><span class="op" id="5920511">.</span><span class="ident" id="5920512">Mode</span><span class="op" id="5920516">&amp;</span><span class="ident" id="5920517">RawFormat</span>&nbsp;<span class="op" id="5920527">==</span>&nbsp;<span class="num" id="5920530">0</span>&nbsp;<span class="op" id="5920532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920536">minwidth</span>&nbsp;<span class="op" id="5920545">:=</span>&nbsp;<span class="ident" id="5920548">cfg</span><span class="op" id="5920551">.</span><span class="ident" id="5920552">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920564">padchar</span>&nbsp;<span class="op" id="5920572">:=</span>&nbsp;<span class="builtintype" id="5920575">byte</span><span class="op" id="5920579">(</span><span class="string" id="5920580">&#39;\t&#39;</span><span class="op" id="5920584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920588">if</span>&nbsp;<span class="ident" id="5920591">cfg</span><span class="op" id="5920594">.</span><span class="ident" id="5920595">Mode</span><span class="op" id="5920599">&amp;</span><span class="ident" id="5920600">UseSpaces</span>&nbsp;<span class="op" id="5920610">!=</span>&nbsp;<span class="num" id="5920613">0</span>&nbsp;<span class="op" id="5920615">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920620">padchar</span>&nbsp;<span class="op" id="5920628">=</span>&nbsp;<span class="string" id="5920630">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920641">twmode</span>&nbsp;<span class="op" id="5920648">:=</span>&nbsp;<span class="ident" id="5920651">tabwriter</span><span class="op" id="5920660">.</span><span class="ident" id="5920661">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920683">if</span>&nbsp;<span class="ident" id="5920686">cfg</span><span class="op" id="5920689">.</span><span class="ident" id="5920690">Mode</span><span class="op" id="5920694">&amp;</span><span class="ident" id="5920695">TabIndent</span>&nbsp;<span class="op" id="5920705">!=</span>&nbsp;<span class="num" id="5920708">0</span>&nbsp;<span class="op" id="5920710">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920715">minwidth</span>&nbsp;<span class="op" id="5920724">=</span>&nbsp;<span class="num" id="5920726">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920731">twmode</span>&nbsp;<span class="op" id="5920738">|=</span>&nbsp;<span class="ident" id="5920741">tabwriter</span><span class="op" id="5920750">.</span><span class="ident" id="5920751">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920768">output</span>&nbsp;<span class="op" id="5920775">=</span>&nbsp;<span class="ident" id="5920777">tabwriter</span><span class="op" id="5920786">.</span><span class="ident" id="5920787">NewWriter</span><span class="op" id="5920796">(</span><span class="ident" id="5920797">output</span><span class="op" id="5920803">,</span>&nbsp;<span class="ident" id="5920805">minwidth</span><span class="op" id="5920813">,</span>&nbsp;<span class="ident" id="5920815">cfg</span><span class="op" id="5920818">.</span><span class="ident" id="5920819">Tabwidth</span><span class="op" id="5920827">,</span>&nbsp;<span class="num" id="5920829">1</span><span class="op" id="5920830">,</span>&nbsp;<span class="ident" id="5920832">padchar</span><span class="op" id="5920839">,</span>&nbsp;<span class="ident" id="5920841">twmode</span><span class="op" id="5920847">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920854">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920911">if</span>&nbsp;<span class="ident" id="5920914">_</span><span class="op" id="5920915">,</span>&nbsp;<span class="ident" id="5920917">err</span>&nbsp;<span class="op" id="5920921">=</span>&nbsp;<span class="ident" id="5920923">output</span><span class="op" id="5920929">.</span><span class="ident" id="5920930">Write</span><span class="op" id="5920935">(</span><span class="ident" id="5920936">p</span><span class="op" id="5920937">.</span><span class="ident" id="5920938">output</span><span class="op" id="5920944">)</span><span class="op" id="5920945">;</span>&nbsp;<span class="ident" id="5920947">err</span>&nbsp;<span class="op" id="5920951">!=</span>&nbsp;<span class="builtintype" id="5920954">nil</span>&nbsp;<span class="op" id="5920958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920962">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920974">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921002">if</span>&nbsp;<span class="ident" id="5921005">tw</span><span class="op" id="5921007">,</span>&nbsp;<span class="ident" id="5921009">_</span>&nbsp;<span class="op" id="5921011">:=</span>&nbsp;<span class="ident" id="5921014">output</span><span class="op" id="5921020">.</span><span class="op" id="5921021">(</span><span class="op" id="5921022">*</span><span class="ident" id="5921023">tabwriter</span><span class="op" id="5921032">.</span><span class="ident" id="5921033">Writer</span><span class="op" id="5921039">)</span><span class="op" id="5921040">;</span>&nbsp;<span class="ident" id="5921042">tw</span>&nbsp;<span class="op" id="5921045">!=</span>&nbsp;<span class="builtintype" id="5921048">nil</span>&nbsp;<span class="op" id="5921052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921056">err</span>&nbsp;<span class="op" id="5921060">=</span>&nbsp;<span class="ident" id="5921062">tw</span><span class="op" id="5921064">.</span><span class="ident" id="5921065">Flush</span><span class="op" id="5921070">(</span><span class="op" id="5921071">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921078">return</span><br>
<span class="lineno"></span><span class="op" id="5921085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5921088">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5921155">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5921221">//</span><br>
<span class="lineno"></span><span class="keyword" id="5921224">type</span>&nbsp;<span class="ident" id="5921229">CommentedNode</span>&nbsp;<span class="keyword" id="5921243">struct</span>&nbsp;<span class="op" id="5921250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921253">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921262">interface</span><span class="op" id="5921271">{</span><span class="op" id="5921272">}</span>&nbsp;<span class="comment" id="5921274">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921334">Comments</span>&nbsp;<span class="op" id="5921343">[</span><span class="op" id="5921344">]</span><span class="op" id="5921345">*</span><span class="ident" id="5921346">ast</span><span class="op" id="5921349">.</span><span class="ident" id="5921350">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5921363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921366">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5921445">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5921515">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5921591">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5921665">//</span><br>
<span class="lineno"></span><span class="keyword" id="5921668">func</span>&nbsp;<span class="op" id="5921673">(</span><span class="ident" id="5921674">cfg</span>&nbsp;<span class="op" id="5921678">*</span><span class="ident" id="5921679">Config</span><span class="op" id="5921685">)</span>&nbsp;<span class="ident" id="5921687">Fprint</span><span class="op" id="5921693">(</span><span class="ident" id="5921694">output</span>&nbsp;<span class="ident" id="5921701">io</span><span class="op" id="5921703">.</span><span class="ident" id="5921704">Writer</span><span class="op" id="5921710">,</span>&nbsp;<span class="ident" id="5921712">fset</span>&nbsp;<span class="op" id="5921717">*</span><span class="ident" id="5921718">token</span><span class="op" id="5921723">.</span><span class="ident" id="5921724">FileSet</span><span class="op" id="5921731">,</span>&nbsp;<span class="ident" id="5921733">node</span>&nbsp;<span class="keyword" id="5921738">interface</span><span class="op" id="5921747">{</span><span class="op" id="5921748">}</span><span class="op" id="5921749">)</span>&nbsp;<span class="builtintype" id="5921751">error</span>&nbsp;<span class="op" id="5921757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921760">return</span>&nbsp;<span class="ident" id="5921767">cfg</span><span class="op" id="5921770">.</span><span class="ident" id="5921771">fprint</span><span class="op" id="5921777">(</span><span class="ident" id="5921778">output</span><span class="op" id="5921784">,</span>&nbsp;<span class="ident" id="5921786">fset</span><span class="op" id="5921790">,</span>&nbsp;<span class="ident" id="5921792">node</span><span class="op" id="5921796">,</span>&nbsp;<span class="builtinfunc" id="5921798">make</span><span class="op" id="5921802">(</span><span class="keyword" id="5921803">map</span><span class="op" id="5921806">[</span><span class="ident" id="5921807">ast</span><span class="op" id="5921810">.</span><span class="ident" id="5921811">Node</span><span class="op" id="5921815">]</span><span class="builtintype" id="5921816">int</span><span class="op" id="5921819">)</span><span class="op" id="5921820">)</span><br>
<span class="lineno">1285</span><span class="op" id="5921822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921825">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5921874">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5921923">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5921926">func</span>&nbsp;<span class="ident" id="5921931">Fprint</span><span class="op" id="5921937">(</span><span class="ident" id="5921938">output</span>&nbsp;<span class="ident" id="5921945">io</span><span class="op" id="5921947">.</span><span class="ident" id="5921948">Writer</span><span class="op" id="5921954">,</span>&nbsp;<span class="ident" id="5921956">fset</span>&nbsp;<span class="op" id="5921961">*</span><span class="ident" id="5921962">token</span><span class="op" id="5921967">.</span><span class="ident" id="5921968">FileSet</span><span class="op" id="5921975">,</span>&nbsp;<span class="ident" id="5921977">node</span>&nbsp;<span class="keyword" id="5921982">interface</span><span class="op" id="5921991">{</span><span class="op" id="5921992">}</span><span class="op" id="5921993">)</span>&nbsp;<span class="builtintype" id="5921995">error</span>&nbsp;<span class="op" id="5922001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922004">return</span>&nbsp;<span class="op" id="5922011">(</span><span class="op" id="5922012">&amp;</span><span class="ident" id="5922013">Config</span><span class="op" id="5922019">{</span><span class="ident" id="5922020">Tabwidth</span><span class="op" id="5922028">:</span>&nbsp;<span class="num" id="5922030">8</span><span class="op" id="5922031">}</span><span class="op" id="5922032">)</span><span class="op" id="5922033">.</span><span class="ident" id="5922034">Fprint</span><span class="op" id="5922040">(</span><span class="ident" id="5922041">output</span><span class="op" id="5922047">,</span>&nbsp;<span class="ident" id="5922049">fset</span><span class="op" id="5922053">,</span>&nbsp;<span class="ident" id="5922055">node</span><span class="op" id="5922059">)</span><br>
<span class="lineno"></span><span class="op" id="5922061">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
