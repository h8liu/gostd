<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7861950">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7862005">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7862059">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7862110">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="7862183">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7862256">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7862329">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="7862399">//</span><br>
<span class="lineno">10</span><span class="comment" id="7862402">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="7862474">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="7862548">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="7862621">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="7862664">//</span><br>
<span class="lineno">15</span><span class="comment" id="7862667">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7862740">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="7862799">//</span><br>
<span class="lineno"></span><span class="comment" id="7862802">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="7862815">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="7862829">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="7862870">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7862876">package</span>&nbsp;<span class="ident" id="7862884">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7862892">import</span>&nbsp;<span class="op" id="7862899">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862902">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862916">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862928">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862941">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862958">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862968">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7862979">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7862989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7862992">const</span>&nbsp;<span class="ident" id="7862998">testdata</span>&nbsp;<span class="op" id="7863007">=</span>&nbsp;<span class="string" id="7863009">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863021">var</span>&nbsp;<span class="ident" id="7863025">fsetErrs</span>&nbsp;<span class="op" id="7863034">=</span>&nbsp;<span class="ident" id="7863036">token</span><span class="op" id="7863041">.</span><span class="ident" id="7863042">NewFileSet</span><span class="op" id="7863052">(</span><span class="op" id="7863053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7863056">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="7863114">func</span>&nbsp;<span class="ident" id="7863119">getFile</span><span class="op" id="7863126">(</span><span class="ident" id="7863127">filename</span>&nbsp;<span class="builtintype" id="7863136">string</span><span class="op" id="7863142">)</span>&nbsp;<span class="op" id="7863144">(</span><span class="ident" id="7863145">file</span>&nbsp;<span class="op" id="7863150">*</span><span class="ident" id="7863151">token</span><span class="op" id="7863156">.</span><span class="ident" id="7863157">File</span><span class="op" id="7863161">)</span>&nbsp;<span class="op" id="7863163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863166">fsetErrs</span><span class="op" id="7863174">.</span><span class="ident" id="7863175">Iterate</span><span class="op" id="7863182">(</span><span class="keyword" id="7863183">func</span><span class="op" id="7863187">(</span><span class="ident" id="7863188">f</span>&nbsp;<span class="op" id="7863190">*</span><span class="ident" id="7863191">token</span><span class="op" id="7863196">.</span><span class="ident" id="7863197">File</span><span class="op" id="7863201">)</span>&nbsp;<span class="builtintype" id="7863203">bool</span>&nbsp;<span class="op" id="7863208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863212">if</span>&nbsp;<span class="ident" id="7863215">f</span><span class="op" id="7863216">.</span><span class="ident" id="7863217">Name</span><span class="op" id="7863221">(</span><span class="op" id="7863222">)</span>&nbsp;<span class="op" id="7863224">==</span>&nbsp;<span class="ident" id="7863227">filename</span>&nbsp;<span class="op" id="7863236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863241">if</span>&nbsp;<span class="ident" id="7863244">file</span>&nbsp;<span class="op" id="7863249">!=</span>&nbsp;<span class="ident" id="7863252">nil</span>&nbsp;<span class="op" id="7863256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7863262">panic</span><span class="op" id="7863267">(</span><span class="ident" id="7863268">filename</span>&nbsp;<span class="op" id="7863277">+</span>&nbsp;<span class="string" id="7863279">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="7863301">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863311">file</span>&nbsp;<span class="op" id="7863316">=</span>&nbsp;<span class="ident" id="7863318">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863326">return</span>&nbsp;<span class="builtintype" id="7863333">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863339">}</span><span class="op" id="7863340">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863343">return</span>&nbsp;<span class="ident" id="7863350">file</span><br>
<span class="lineno"></span><span class="op" id="7863355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863358">func</span>&nbsp;<span class="ident" id="7863363">getPos</span><span class="op" id="7863369">(</span><span class="ident" id="7863370">filename</span>&nbsp;<span class="builtintype" id="7863379">string</span><span class="op" id="7863385">,</span>&nbsp;<span class="ident" id="7863387">offset</span>&nbsp;<span class="builtintype" id="7863394">int</span><span class="op" id="7863397">)</span>&nbsp;<span class="ident" id="7863399">token</span><span class="op" id="7863404">.</span><span class="ident" id="7863405">Pos</span>&nbsp;<span class="op" id="7863409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863412">if</span>&nbsp;<span class="ident" id="7863415">f</span>&nbsp;<span class="op" id="7863417">:=</span>&nbsp;<span class="ident" id="7863420">getFile</span><span class="op" id="7863427">(</span><span class="ident" id="7863428">filename</span><span class="op" id="7863436">)</span><span class="op" id="7863437">;</span>&nbsp;<span class="ident" id="7863439">f</span>&nbsp;<span class="op" id="7863441">!=</span>&nbsp;<span class="ident" id="7863444">nil</span>&nbsp;<span class="op" id="7863448">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863452">return</span>&nbsp;<span class="ident" id="7863459">f</span><span class="op" id="7863460">.</span><span class="ident" id="7863461">Pos</span><span class="op" id="7863464">(</span><span class="ident" id="7863465">offset</span><span class="op" id="7863471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863477">return</span>&nbsp;<span class="ident" id="7863484">token</span><span class="op" id="7863489">.</span><span class="ident" id="7863490">NoPos</span><br>
<span class="lineno"></span><span class="op" id="7863496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7863499">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="7863564">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="7863629">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="7863694">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="7863760">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="7863783">//</span><br>
<span class="lineno"></span><span class="keyword" id="7863786">var</span>&nbsp;<span class="ident" id="7863790">errRx</span>&nbsp;<span class="op" id="7863796">=</span>&nbsp;<span class="ident" id="7863798">regexp</span><span class="op" id="7863804">.</span><span class="ident" id="7863805">MustCompile</span><span class="op" id="7863816">(</span><span class="string" id="7863817">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="7863856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7863859">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="7863934">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="7864010">//</span><br>
<span class="lineno"></span><span class="keyword" id="7864013">func</span>&nbsp;<span class="ident" id="7864018">expectedErrors</span><span class="op" id="7864032">(</span><span class="ident" id="7864033">t</span>&nbsp;<span class="op" id="7864035">*</span><span class="ident" id="7864036">testing</span><span class="op" id="7864043">.</span><span class="ident" id="7864044">T</span><span class="op" id="7864045">,</span>&nbsp;<span class="ident" id="7864047">filename</span>&nbsp;<span class="builtintype" id="7864056">string</span><span class="op" id="7864062">,</span>&nbsp;<span class="ident" id="7864064">src</span>&nbsp;<span class="op" id="7864068">[</span><span class="op" id="7864069">]</span><span class="builtintype" id="7864070">byte</span><span class="op" id="7864074">)</span>&nbsp;<span class="keyword" id="7864076">map</span><span class="op" id="7864079">[</span><span class="ident" id="7864080">token</span><span class="op" id="7864085">.</span><span class="ident" id="7864086">Pos</span><span class="op" id="7864089">]</span><span class="builtintype" id="7864090">string</span>&nbsp;<span class="op" id="7864097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864100">errors</span>&nbsp;<span class="op" id="7864107">:=</span>&nbsp;<span class="builtinfunc" id="7864110">make</span><span class="op" id="7864114">(</span><span class="keyword" id="7864115">map</span><span class="op" id="7864118">[</span><span class="ident" id="7864119">token</span><span class="op" id="7864124">.</span><span class="ident" id="7864125">Pos</span><span class="op" id="7864128">]</span><span class="builtintype" id="7864129">string</span><span class="op" id="7864135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864139">var</span>&nbsp;<span class="ident" id="7864143">s</span>&nbsp;<span class="ident" id="7864145">scanner</span><span class="op" id="7864152">.</span><span class="ident" id="7864153">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7864162">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7864224">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7864286">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864349">s</span><span class="op" id="7864350">.</span><span class="ident" id="7864351">Init</span><span class="op" id="7864355">(</span><span class="ident" id="7864356">getFile</span><span class="op" id="7864363">(</span><span class="ident" id="7864364">filename</span><span class="op" id="7864372">)</span><span class="op" id="7864373">,</span>&nbsp;<span class="ident" id="7864375">src</span><span class="op" id="7864378">,</span>&nbsp;<span class="ident" id="7864380">nil</span><span class="op" id="7864383">,</span>&nbsp;<span class="ident" id="7864385">scanner</span><span class="op" id="7864392">.</span><span class="ident" id="7864393">ScanComments</span><span class="op" id="7864405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864408">var</span>&nbsp;<span class="ident" id="7864412">prev</span>&nbsp;<span class="ident" id="7864417">token</span><span class="op" id="7864422">.</span><span class="ident" id="7864423">Pos</span>&nbsp;<span class="comment" id="7864427">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864481">var</span>&nbsp;<span class="ident" id="7864485">here</span>&nbsp;<span class="ident" id="7864490">token</span><span class="op" id="7864495">.</span><span class="ident" id="7864496">Pos</span>&nbsp;<span class="comment" id="7864500">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864559">for</span>&nbsp;<span class="op" id="7864563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864567">pos</span><span class="op" id="7864570">,</span>&nbsp;<span class="ident" id="7864572">tok</span><span class="op" id="7864575">,</span>&nbsp;<span class="ident" id="7864577">lit</span>&nbsp;<span class="op" id="7864581">:=</span>&nbsp;<span class="ident" id="7864584">s</span><span class="op" id="7864585">.</span><span class="ident" id="7864586">Scan</span><span class="op" id="7864590">(</span><span class="op" id="7864591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864595">switch</span>&nbsp;<span class="ident" id="7864602">tok</span>&nbsp;<span class="op" id="7864606">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864610">case</span>&nbsp;<span class="ident" id="7864615">token</span><span class="op" id="7864620">.</span><span class="ident" id="7864621">EOF</span><span class="op" id="7864624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864629">return</span>&nbsp;<span class="ident" id="7864636">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864645">case</span>&nbsp;<span class="ident" id="7864650">token</span><span class="op" id="7864655">.</span><span class="ident" id="7864656">COMMENT</span><span class="op" id="7864663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864668">s</span>&nbsp;<span class="op" id="7864670">:=</span>&nbsp;<span class="ident" id="7864673">errRx</span><span class="op" id="7864678">.</span><span class="ident" id="7864679">FindStringSubmatch</span><span class="op" id="7864697">(</span><span class="ident" id="7864698">lit</span><span class="op" id="7864701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864706">if</span>&nbsp;<span class="builtinfunc" id="7864709">len</span><span class="op" id="7864712">(</span><span class="ident" id="7864713">s</span><span class="op" id="7864714">)</span>&nbsp;<span class="op" id="7864716">==</span>&nbsp;<span class="num" id="7864719">3</span>&nbsp;<span class="op" id="7864721">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864727">pos</span>&nbsp;<span class="op" id="7864731">:=</span>&nbsp;<span class="ident" id="7864734">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864743">if</span>&nbsp;<span class="ident" id="7864746">s</span><span class="op" id="7864747">[</span><span class="num" id="7864748">1</span><span class="op" id="7864749">]</span>&nbsp;<span class="op" id="7864751">==</span>&nbsp;<span class="string" id="7864754">&#34;HERE&#34;</span>&nbsp;<span class="op" id="7864761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864768">pos</span>&nbsp;<span class="op" id="7864772">=</span>&nbsp;<span class="ident" id="7864774">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864789">errors</span><span class="op" id="7864795">[</span><span class="ident" id="7864796">pos</span><span class="op" id="7864799">]</span>&nbsp;<span class="op" id="7864801">=</span>&nbsp;<span class="builtintype" id="7864803">string</span><span class="op" id="7864809">(</span><span class="ident" id="7864810">s</span><span class="op" id="7864811">[</span><span class="num" id="7864812">2</span><span class="op" id="7864813">]</span><span class="op" id="7864814">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864823">default</span><span class="op" id="7864830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864835">prev</span>&nbsp;<span class="op" id="7864840">=</span>&nbsp;<span class="ident" id="7864842">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864849">var</span>&nbsp;<span class="ident" id="7864853">l</span>&nbsp;<span class="builtintype" id="7864855">int</span>&nbsp;<span class="comment" id="7864859">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864878">if</span>&nbsp;<span class="ident" id="7864881">tok</span><span class="op" id="7864884">.</span><span class="ident" id="7864885">IsLiteral</span><span class="op" id="7864894">(</span><span class="op" id="7864895">)</span>&nbsp;<span class="op" id="7864897">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864903">l</span>&nbsp;<span class="op" id="7864905">=</span>&nbsp;<span class="builtinfunc" id="7864907">len</span><span class="op" id="7864910">(</span><span class="ident" id="7864911">lit</span><span class="op" id="7864914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864919">}</span>&nbsp;<span class="keyword" id="7864921">else</span>&nbsp;<span class="op" id="7864926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864932">l</span>&nbsp;<span class="op" id="7864934">=</span>&nbsp;<span class="builtinfunc" id="7864936">len</span><span class="op" id="7864939">(</span><span class="ident" id="7864940">tok</span><span class="op" id="7864943">.</span><span class="ident" id="7864944">String</span><span class="op" id="7864950">(</span><span class="op" id="7864951">)</span><span class="op" id="7864952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864962">here</span>&nbsp;<span class="op" id="7864967">=</span>&nbsp;<span class="ident" id="7864969">prev</span>&nbsp;<span class="op" id="7864974">+</span>&nbsp;<span class="ident" id="7864976">token</span><span class="op" id="7864981">.</span><span class="ident" id="7864982">Pos</span><span class="op" id="7864985">(</span><span class="ident" id="7864986">l</span><span class="op" id="7864987">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864994">}</span><br>
<span class="lineno"></span><span class="op" id="7864996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7864999">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="7865074">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="7865120">//</span><br>
<span class="lineno"></span><span class="keyword" id="7865123">func</span>&nbsp;<span class="ident" id="7865128">compareErrors</span><span class="op" id="7865141">(</span><span class="ident" id="7865142">t</span>&nbsp;<span class="op" id="7865144">*</span><span class="ident" id="7865145">testing</span><span class="op" id="7865152">.</span><span class="ident" id="7865153">T</span><span class="op" id="7865154">,</span>&nbsp;<span class="ident" id="7865156">expected</span>&nbsp;<span class="keyword" id="7865165">map</span><span class="op" id="7865168">[</span><span class="ident" id="7865169">token</span><span class="op" id="7865174">.</span><span class="ident" id="7865175">Pos</span><span class="op" id="7865178">]</span><span class="builtintype" id="7865179">string</span><span class="op" id="7865185">,</span>&nbsp;<span class="ident" id="7865187">found</span>&nbsp;<span class="ident" id="7865193">scanner</span><span class="op" id="7865200">.</span><span class="ident" id="7865201">ErrorList</span><span class="op" id="7865210">)</span>&nbsp;<span class="op" id="7865212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865215">for</span>&nbsp;<span class="ident" id="7865219">_</span><span class="op" id="7865220">,</span>&nbsp;<span class="builtintype" id="7865222">error</span>&nbsp;<span class="op" id="7865228">:=</span>&nbsp;<span class="keyword" id="7865231">range</span>&nbsp;<span class="ident" id="7865237">found</span>&nbsp;<span class="op" id="7865243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865247">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865295">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865338">pos</span>&nbsp;<span class="op" id="7865342">:=</span>&nbsp;<span class="ident" id="7865345">getPos</span><span class="op" id="7865351">(</span><span class="builtintype" id="7865352">error</span><span class="op" id="7865357">.</span><span class="ident" id="7865358">Pos</span><span class="op" id="7865361">.</span><span class="ident" id="7865362">Filename</span><span class="op" id="7865370">,</span>&nbsp;<span class="builtintype" id="7865372">error</span><span class="op" id="7865377">.</span><span class="ident" id="7865378">Pos</span><span class="op" id="7865381">.</span><span class="ident" id="7865382">Offset</span><span class="op" id="7865388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865392">if</span>&nbsp;<span class="ident" id="7865395">msg</span><span class="op" id="7865398">,</span>&nbsp;<span class="ident" id="7865400">found</span>&nbsp;<span class="op" id="7865406">:=</span>&nbsp;<span class="ident" id="7865409">expected</span><span class="op" id="7865417">[</span><span class="ident" id="7865418">pos</span><span class="op" id="7865421">]</span><span class="op" id="7865422">;</span>&nbsp;<span class="ident" id="7865424">found</span>&nbsp;<span class="op" id="7865430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865435">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865489">rx</span><span class="op" id="7865491">,</span>&nbsp;<span class="ident" id="7865493">err</span>&nbsp;<span class="op" id="7865497">:=</span>&nbsp;<span class="ident" id="7865500">regexp</span><span class="op" id="7865506">.</span><span class="ident" id="7865507">Compile</span><span class="op" id="7865514">(</span><span class="ident" id="7865515">msg</span><span class="op" id="7865518">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865523">if</span>&nbsp;<span class="ident" id="7865526">err</span>&nbsp;<span class="op" id="7865530">!=</span>&nbsp;<span class="ident" id="7865533">nil</span>&nbsp;<span class="op" id="7865537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865543">t</span><span class="op" id="7865544">.</span><span class="ident" id="7865545">Errorf</span><span class="op" id="7865551">(</span><span class="string" id="7865552">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7865560">,</span>&nbsp;<span class="builtintype" id="7865562">error</span><span class="op" id="7865567">.</span><span class="ident" id="7865568">Pos</span><span class="op" id="7865571">,</span>&nbsp;<span class="ident" id="7865573">err</span><span class="op" id="7865576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865582">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865599">if</span>&nbsp;<span class="ident" id="7865602">match</span>&nbsp;<span class="op" id="7865608">:=</span>&nbsp;<span class="ident" id="7865611">rx</span><span class="op" id="7865613">.</span><span class="ident" id="7865614">MatchString</span><span class="op" id="7865625">(</span><span class="builtintype" id="7865626">error</span><span class="op" id="7865631">.</span><span class="ident" id="7865632">Msg</span><span class="op" id="7865635">)</span><span class="op" id="7865636">;</span>&nbsp;<span class="op" id="7865638">!</span><span class="ident" id="7865639">match</span>&nbsp;<span class="op" id="7865645">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865651">t</span><span class="op" id="7865652">.</span><span class="ident" id="7865653">Errorf</span><span class="op" id="7865659">(</span><span class="string" id="7865660">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="7865686">,</span>&nbsp;<span class="builtintype" id="7865688">error</span><span class="op" id="7865693">.</span><span class="ident" id="7865694">Pos</span><span class="op" id="7865697">,</span>&nbsp;<span class="builtintype" id="7865699">error</span><span class="op" id="7865704">.</span><span class="ident" id="7865705">Msg</span><span class="op" id="7865708">,</span>&nbsp;<span class="ident" id="7865710">msg</span><span class="op" id="7865713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865719">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865736">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7865781">delete</span><span class="op" id="7865787">(</span><span class="ident" id="7865788">expected</span><span class="op" id="7865796">,</span>&nbsp;<span class="ident" id="7865798">pos</span><span class="op" id="7865801">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865805">}</span>&nbsp;<span class="keyword" id="7865807">else</span>&nbsp;<span class="op" id="7865812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865817">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865874">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7865940">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7866005">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866073">t</span><span class="op" id="7866074">.</span><span class="ident" id="7866075">Errorf</span><span class="op" id="7866081">(</span><span class="string" id="7866082">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7866108">,</span>&nbsp;<span class="builtintype" id="7866110">error</span><span class="op" id="7866115">.</span><span class="ident" id="7866116">Pos</span><span class="op" id="7866119">,</span>&nbsp;<span class="builtintype" id="7866121">error</span><span class="op" id="7866126">.</span><span class="ident" id="7866127">Msg</span><span class="op" id="7866130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7866141">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866185">if</span>&nbsp;<span class="builtinfunc" id="7866188">len</span><span class="op" id="7866191">(</span><span class="ident" id="7866192">expected</span><span class="op" id="7866200">)</span>&nbsp;<span class="op" id="7866202">&gt;</span>&nbsp;<span class="num" id="7866204">0</span>&nbsp;<span class="op" id="7866206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866210">t</span><span class="op" id="7866211">.</span><span class="ident" id="7866212">Errorf</span><span class="op" id="7866218">(</span><span class="string" id="7866219">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="7866244">,</span>&nbsp;<span class="builtinfunc" id="7866246">len</span><span class="op" id="7866249">(</span><span class="ident" id="7866250">expected</span><span class="op" id="7866258">)</span><span class="op" id="7866259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866263">for</span>&nbsp;<span class="ident" id="7866267">pos</span><span class="op" id="7866270">,</span>&nbsp;<span class="ident" id="7866272">msg</span>&nbsp;<span class="op" id="7866276">:=</span>&nbsp;<span class="keyword" id="7866279">range</span>&nbsp;<span class="ident" id="7866285">expected</span>&nbsp;<span class="op" id="7866294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866299">t</span><span class="op" id="7866300">.</span><span class="ident" id="7866301">Errorf</span><span class="op" id="7866307">(</span><span class="string" id="7866308">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="7866318">,</span>&nbsp;<span class="ident" id="7866320">fsetErrs</span><span class="op" id="7866328">.</span><span class="ident" id="7866329">Position</span><span class="op" id="7866337">(</span><span class="ident" id="7866338">pos</span><span class="op" id="7866341">)</span><span class="op" id="7866342">,</span>&nbsp;<span class="ident" id="7866344">msg</span><span class="op" id="7866347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866351">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866354">}</span><br>
<span class="lineno"></span><span class="op" id="7866356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866359">func</span>&nbsp;<span class="ident" id="7866364">checkErrors</span><span class="op" id="7866375">(</span><span class="ident" id="7866376">t</span>&nbsp;<span class="op" id="7866378">*</span><span class="ident" id="7866379">testing</span><span class="op" id="7866386">.</span><span class="ident" id="7866387">T</span><span class="op" id="7866388">,</span>&nbsp;<span class="ident" id="7866390">filename</span>&nbsp;<span class="builtintype" id="7866399">string</span><span class="op" id="7866405">,</span>&nbsp;<span class="ident" id="7866407">input</span>&nbsp;<span class="keyword" id="7866413">interface</span><span class="op" id="7866422">{</span><span class="op" id="7866423">}</span><span class="op" id="7866424">)</span>&nbsp;<span class="op" id="7866426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866429">src</span><span class="op" id="7866432">,</span>&nbsp;<span class="ident" id="7866434">err</span>&nbsp;<span class="op" id="7866438">:=</span>&nbsp;<span class="ident" id="7866441">readSource</span><span class="op" id="7866451">(</span><span class="ident" id="7866452">filename</span><span class="op" id="7866460">,</span>&nbsp;<span class="ident" id="7866462">input</span><span class="op" id="7866467">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866470">if</span>&nbsp;<span class="ident" id="7866473">err</span>&nbsp;<span class="op" id="7866477">!=</span>&nbsp;<span class="ident" id="7866480">nil</span>&nbsp;<span class="op" id="7866484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866488">t</span><span class="op" id="7866489">.</span><span class="ident" id="7866490">Error</span><span class="op" id="7866495">(</span><span class="ident" id="7866496">err</span><span class="op" id="7866499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866503">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866515">_</span><span class="op" id="7866516">,</span>&nbsp;<span class="ident" id="7866518">err</span>&nbsp;<span class="op" id="7866522">=</span>&nbsp;<span class="ident" id="7866524">ParseFile</span><span class="op" id="7866533">(</span><span class="ident" id="7866534">fsetErrs</span><span class="op" id="7866542">,</span>&nbsp;<span class="ident" id="7866544">filename</span><span class="op" id="7866552">,</span>&nbsp;<span class="ident" id="7866554">src</span><span class="op" id="7866557">,</span>&nbsp;<span class="ident" id="7866559">DeclarationErrors</span><span class="op" id="7866576">|</span><span class="ident" id="7866577">AllErrors</span><span class="op" id="7866586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866589">found</span><span class="op" id="7866594">,</span>&nbsp;<span class="ident" id="7866596">ok</span>&nbsp;<span class="op" id="7866599">:=</span>&nbsp;<span class="ident" id="7866602">err</span><span class="op" id="7866605">.</span><span class="op" id="7866606">(</span><span class="ident" id="7866607">scanner</span><span class="op" id="7866614">.</span><span class="ident" id="7866615">ErrorList</span><span class="op" id="7866624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866627">if</span>&nbsp;<span class="ident" id="7866630">err</span>&nbsp;<span class="op" id="7866634">!=</span>&nbsp;<span class="ident" id="7866637">nil</span>&nbsp;<span class="op" id="7866641">&amp;&amp;</span>&nbsp;<span class="op" id="7866644">!</span><span class="ident" id="7866645">ok</span>&nbsp;<span class="op" id="7866648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866652">t</span><span class="op" id="7866653">.</span><span class="ident" id="7866654">Error</span><span class="op" id="7866659">(</span><span class="ident" id="7866660">err</span><span class="op" id="7866663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866667">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866678">found</span><span class="op" id="7866683">.</span><span class="ident" id="7866684">RemoveMultiples</span><span class="op" id="7866699">(</span><span class="op" id="7866700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7866704">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7866746">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866823">expected</span>&nbsp;<span class="op" id="7866832">:=</span>&nbsp;<span class="ident" id="7866835">expectedErrors</span><span class="op" id="7866849">(</span><span class="ident" id="7866850">t</span><span class="op" id="7866851">,</span>&nbsp;<span class="ident" id="7866853">filename</span><span class="op" id="7866861">,</span>&nbsp;<span class="ident" id="7866863">src</span><span class="op" id="7866866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7866870">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866911">compareErrors</span><span class="op" id="7866924">(</span><span class="ident" id="7866925">t</span><span class="op" id="7866926">,</span>&nbsp;<span class="ident" id="7866928">expected</span><span class="op" id="7866936">,</span>&nbsp;<span class="ident" id="7866938">found</span><span class="op" id="7866943">)</span><br>
<span class="lineno"></span><span class="op" id="7866945">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7866948">func</span>&nbsp;<span class="ident" id="7866953">TestErrors</span><span class="op" id="7866963">(</span><span class="ident" id="7866964">t</span>&nbsp;<span class="op" id="7866966">*</span><span class="ident" id="7866967">testing</span><span class="op" id="7866974">.</span><span class="ident" id="7866975">T</span><span class="op" id="7866976">)</span>&nbsp;<span class="op" id="7866978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866981">list</span><span class="op" id="7866985">,</span>&nbsp;<span class="ident" id="7866987">err</span>&nbsp;<span class="op" id="7866991">:=</span>&nbsp;<span class="ident" id="7866994">ioutil</span><span class="op" id="7867000">.</span><span class="ident" id="7867001">ReadDir</span><span class="op" id="7867008">(</span><span class="ident" id="7867009">testdata</span><span class="op" id="7867017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867020">if</span>&nbsp;<span class="ident" id="7867023">err</span>&nbsp;<span class="op" id="7867027">!=</span>&nbsp;<span class="ident" id="7867030">nil</span>&nbsp;<span class="op" id="7867034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867038">t</span><span class="op" id="7867039">.</span><span class="ident" id="7867040">Fatal</span><span class="op" id="7867045">(</span><span class="ident" id="7867046">err</span><span class="op" id="7867049">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867055">for</span>&nbsp;<span class="ident" id="7867059">_</span><span class="op" id="7867060">,</span>&nbsp;<span class="ident" id="7867062">fi</span>&nbsp;<span class="op" id="7867065">:=</span>&nbsp;<span class="keyword" id="7867068">range</span>&nbsp;<span class="ident" id="7867074">list</span>&nbsp;<span class="op" id="7867079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867083">name</span>&nbsp;<span class="op" id="7867088">:=</span>&nbsp;<span class="ident" id="7867091">fi</span><span class="op" id="7867093">.</span><span class="ident" id="7867094">Name</span><span class="op" id="7867098">(</span><span class="op" id="7867099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867103">if</span>&nbsp;<span class="op" id="7867106">!</span><span class="ident" id="7867107">fi</span><span class="op" id="7867109">.</span><span class="ident" id="7867110">IsDir</span><span class="op" id="7867115">(</span><span class="op" id="7867116">)</span>&nbsp;<span class="op" id="7867118">&amp;&amp;</span>&nbsp;<span class="op" id="7867121">!</span><span class="ident" id="7867122">strings</span><span class="op" id="7867129">.</span><span class="ident" id="7867130">HasPrefix</span><span class="op" id="7867139">(</span><span class="ident" id="7867140">name</span><span class="op" id="7867144">,</span>&nbsp;<span class="string" id="7867146">&#34;.&#34;</span><span class="op" id="7867149">)</span>&nbsp;<span class="op" id="7867151">&amp;&amp;</span>&nbsp;<span class="ident" id="7867154">strings</span><span class="op" id="7867161">.</span><span class="ident" id="7867162">HasSuffix</span><span class="op" id="7867171">(</span><span class="ident" id="7867172">name</span><span class="op" id="7867176">,</span>&nbsp;<span class="string" id="7867178">&#34;.src&#34;</span><span class="op" id="7867184">)</span>&nbsp;<span class="op" id="7867186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867191">checkErrors</span><span class="op" id="7867202">(</span><span class="ident" id="7867203">t</span><span class="op" id="7867204">,</span>&nbsp;<span class="ident" id="7867206">filepath</span><span class="op" id="7867214">.</span><span class="ident" id="7867215">Join</span><span class="op" id="7867219">(</span><span class="ident" id="7867220">testdata</span><span class="op" id="7867228">,</span>&nbsp;<span class="ident" id="7867230">name</span><span class="op" id="7867234">)</span><span class="op" id="7867235">,</span>&nbsp;<span class="ident" id="7867237">nil</span><span class="op" id="7867240">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867247">}</span><br>
<span class="lineno"></span><span class="op" id="7867249">}</span>
</div>
</body>
</html>
