<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4060004">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4060059">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4060113">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4060164">package</span>&nbsp;<span class="ident" id="4060172">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4060177">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4060231">//</span><br>
<span class="lineno"></span><span class="comment" id="4060234">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4060331">import</span>&nbsp;<span class="op" id="4060338">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4060341">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4060350">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4060360">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4060370">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4060378">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4060384">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4060395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4060398">func</span>&nbsp;<span class="ident" id="4060403">emsaPSSEncode</span><span class="op" id="4060416">(</span><span class="ident" id="4060417">mHash</span>&nbsp;<span class="op" id="4060423">[</span><span class="op" id="4060424">]</span><span class="builtintype" id="4060425">byte</span><span class="op" id="4060429">,</span>&nbsp;<span class="ident" id="4060431">emBits</span>&nbsp;<span class="builtintype" id="4060438">int</span><span class="op" id="4060441">,</span>&nbsp;<span class="ident" id="4060443">salt</span>&nbsp;<span class="op" id="4060448">[</span><span class="op" id="4060449">]</span><span class="builtintype" id="4060450">byte</span><span class="op" id="4060454">,</span>&nbsp;<span class="ident" id="4060456">hash</span>&nbsp;<span class="ident" id="4060461">hash</span><span class="op" id="4060465">.</span><span class="ident" id="4060466">Hash</span><span class="op" id="4060470">)</span>&nbsp;<span class="op" id="4060472">(</span><span class="op" id="4060473">[</span><span class="op" id="4060474">]</span><span class="builtintype" id="4060475">byte</span><span class="op" id="4060479">,</span>&nbsp;<span class="builtintype" id="4060481">error</span><span class="op" id="4060486">)</span>&nbsp;<span class="op" id="4060488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060491">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060518">hLen</span>&nbsp;<span class="op" id="4060523">:=</span>&nbsp;<span class="ident" id="4060526">hash</span><span class="op" id="4060530">.</span><span class="ident" id="4060531">Size</span><span class="op" id="4060535">(</span><span class="op" id="4060536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060539">sLen</span>&nbsp;<span class="op" id="4060544">:=</span>&nbsp;<span class="builtinfunc" id="4060547">len</span><span class="op" id="4060550">(</span><span class="ident" id="4060551">salt</span><span class="op" id="4060555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060558">emLen</span>&nbsp;<span class="op" id="4060564">:=</span>&nbsp;<span class="op" id="4060567">(</span><span class="ident" id="4060568">emBits</span>&nbsp;<span class="op" id="4060575">+</span>&nbsp;<span class="num" id="4060577">7</span><span class="op" id="4060578">)</span>&nbsp;<span class="op" id="4060580">/</span>&nbsp;<span class="num" id="4060582">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060586">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060658">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060729">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060753">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060757">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060819">if</span>&nbsp;<span class="builtinfunc" id="4060822">len</span><span class="op" id="4060825">(</span><span class="ident" id="4060826">mHash</span><span class="op" id="4060831">)</span>&nbsp;<span class="op" id="4060833">!=</span>&nbsp;<span class="ident" id="4060836">hLen</span>&nbsp;<span class="op" id="4060841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060845">return</span>&nbsp;<span class="ident" id="4060852">nil</span><span class="op" id="4060855">,</span>&nbsp;<span class="ident" id="4060857">errors</span><span class="op" id="4060863">.</span><span class="ident" id="4060864">New</span><span class="op" id="4060867">(</span><span class="string" id="4060868">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4060910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060913">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060917">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060988">if</span>&nbsp;<span class="ident" id="4060991">emLen</span>&nbsp;<span class="op" id="4060997">&lt;</span>&nbsp;<span class="ident" id="4060999">hLen</span><span class="op" id="4061003">+</span><span class="ident" id="4061004">sLen</span><span class="op" id="4061008">+</span><span class="num" id="4061009">2</span>&nbsp;<span class="op" id="4061011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061015">return</span>&nbsp;<span class="ident" id="4061022">nil</span><span class="op" id="4061025">,</span>&nbsp;<span class="ident" id="4061027">errors</span><span class="op" id="4061033">.</span><span class="ident" id="4061034">New</span><span class="op" id="4061037">(</span><span class="string" id="4061038">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="4061066">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061073">em</span>&nbsp;<span class="op" id="4061076">:=</span>&nbsp;<span class="builtinfunc" id="4061079">make</span><span class="op" id="4061083">(</span><span class="op" id="4061084">[</span><span class="op" id="4061085">]</span><span class="builtintype" id="4061086">byte</span><span class="op" id="4061090">,</span>&nbsp;<span class="ident" id="4061092">emLen</span><span class="op" id="4061097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061100">db</span>&nbsp;<span class="op" id="4061103">:=</span>&nbsp;<span class="ident" id="4061106">em</span><span class="op" id="4061108">[</span><span class="op" id="4061109">:</span><span class="ident" id="4061110">emLen</span><span class="op" id="4061115">-</span><span class="ident" id="4061116">sLen</span><span class="op" id="4061120">-</span><span class="ident" id="4061121">hLen</span><span class="op" id="4061125">-</span><span class="num" id="4061126">2</span><span class="op" id="4061127">+</span><span class="num" id="4061128">1</span><span class="op" id="4061129">+</span><span class="ident" id="4061130">sLen</span><span class="op" id="4061134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061137">h</span>&nbsp;<span class="op" id="4061139">:=</span>&nbsp;<span class="ident" id="4061142">em</span><span class="op" id="4061144">[</span><span class="ident" id="4061145">emLen</span><span class="op" id="4061150">-</span><span class="ident" id="4061151">sLen</span><span class="op" id="4061155">-</span><span class="ident" id="4061156">hLen</span><span class="op" id="4061160">-</span><span class="num" id="4061161">2</span><span class="op" id="4061162">+</span><span class="num" id="4061163">1</span><span class="op" id="4061164">+</span><span class="ident" id="4061165">sLen</span>&nbsp;<span class="op" id="4061170">:</span>&nbsp;<span class="ident" id="4061172">emLen</span><span class="op" id="4061177">-</span><span class="num" id="4061178">1</span><span class="op" id="4061179">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061183">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061256">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061295">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061299">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061311">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061372">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061376">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061443">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061472">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061476">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061535">var</span>&nbsp;<span class="ident" id="4061539">prefix</span>&nbsp;<span class="op" id="4061546">[</span><span class="num" id="4061547">8</span><span class="op" id="4061548">]</span><span class="builtintype" id="4061549">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061556">hash</span><span class="op" id="4061560">.</span><span class="ident" id="4061561">Write</span><span class="op" id="4061566">(</span><span class="ident" id="4061567">prefix</span><span class="op" id="4061573">[</span><span class="op" id="4061574">:</span><span class="op" id="4061575">]</span><span class="op" id="4061576">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061579">hash</span><span class="op" id="4061583">.</span><span class="ident" id="4061584">Write</span><span class="op" id="4061589">(</span><span class="ident" id="4061590">mHash</span><span class="op" id="4061595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061598">hash</span><span class="op" id="4061602">.</span><span class="ident" id="4061603">Write</span><span class="op" id="4061608">(</span><span class="ident" id="4061609">salt</span><span class="op" id="4061613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061617">h</span>&nbsp;<span class="op" id="4061619">=</span>&nbsp;<span class="ident" id="4061621">hash</span><span class="op" id="4061625">.</span><span class="ident" id="4061626">Sum</span><span class="op" id="4061629">(</span><span class="ident" id="4061630">h</span><span class="op" id="4061631">[</span><span class="op" id="4061632">:</span><span class="num" id="4061633">0</span><span class="op" id="4061634">]</span><span class="op" id="4061635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061638">hash</span><span class="op" id="4061642">.</span><span class="ident" id="4061643">Reset</span><span class="op" id="4061648">(</span><span class="op" id="4061649">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061653">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061727">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061776">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061780">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061849">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061876">db</span><span class="op" id="4061878">[</span><span class="ident" id="4061879">emLen</span><span class="op" id="4061884">-</span><span class="ident" id="4061885">sLen</span><span class="op" id="4061889">-</span><span class="ident" id="4061890">hLen</span><span class="op" id="4061894">-</span><span class="num" id="4061895">2</span><span class="op" id="4061896">]</span>&nbsp;<span class="op" id="4061898">=</span>&nbsp;<span class="num" id="4061900">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4061906">copy</span><span class="op" id="4061910">(</span><span class="ident" id="4061911">db</span><span class="op" id="4061913">[</span><span class="ident" id="4061914">emLen</span><span class="op" id="4061919">-</span><span class="ident" id="4061920">sLen</span><span class="op" id="4061924">-</span><span class="ident" id="4061925">hLen</span><span class="op" id="4061929">-</span><span class="num" id="4061930">1</span><span class="op" id="4061931">:</span><span class="op" id="4061932">]</span><span class="op" id="4061933">,</span>&nbsp;<span class="ident" id="4061935">salt</span><span class="op" id="4061939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061943">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061990">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061994">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062034">mgf1XOR</span><span class="op" id="4062041">(</span><span class="ident" id="4062042">db</span><span class="op" id="4062044">,</span>&nbsp;<span class="ident" id="4062046">hash</span><span class="op" id="4062050">,</span>&nbsp;<span class="ident" id="4062052">h</span><span class="op" id="4062053">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062057">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062131">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062158">db</span><span class="op" id="4062160">[</span><span class="num" id="4062161">0</span><span class="op" id="4062162">]</span>&nbsp;<span class="op" id="4062164">&amp;=</span>&nbsp;<span class="op" id="4062167">(</span><span class="num" id="4062168">0xFF</span>&nbsp;<span class="op" id="4062173">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4062176">uint</span><span class="op" id="4062180">(</span><span class="num" id="4062181">8</span><span class="op" id="4062182">*</span><span class="ident" id="4062183">emLen</span><span class="op" id="4062188">-</span><span class="ident" id="4062189">emBits</span><span class="op" id="4062195">)</span><span class="op" id="4062196">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062200">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062240">em</span><span class="op" id="4062242">[</span><span class="ident" id="4062243">emLen</span><span class="op" id="4062248">-</span><span class="num" id="4062249">1</span><span class="op" id="4062250">]</span>&nbsp;<span class="op" id="4062252">=</span>&nbsp;<span class="num" id="4062254">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062261">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062280">return</span>&nbsp;<span class="ident" id="4062287">em</span><span class="op" id="4062289">,</span>&nbsp;<span class="ident" id="4062291">nil</span><br>
<span class="lineno"></span><span class="op" id="4062295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4062298">func</span>&nbsp;<span class="ident" id="4062303">emsaPSSVerify</span><span class="op" id="4062316">(</span><span class="ident" id="4062317">mHash</span><span class="op" id="4062322">,</span>&nbsp;<span class="ident" id="4062324">em</span>&nbsp;<span class="op" id="4062327">[</span><span class="op" id="4062328">]</span><span class="builtintype" id="4062329">byte</span><span class="op" id="4062333">,</span>&nbsp;<span class="ident" id="4062335">emBits</span><span class="op" id="4062341">,</span>&nbsp;<span class="ident" id="4062343">sLen</span>&nbsp;<span class="builtintype" id="4062348">int</span><span class="op" id="4062351">,</span>&nbsp;<span class="ident" id="4062353">hash</span>&nbsp;<span class="ident" id="4062358">hash</span><span class="op" id="4062362">.</span><span class="ident" id="4062363">Hash</span><span class="op" id="4062367">)</span>&nbsp;<span class="builtintype" id="4062369">error</span>&nbsp;<span class="op" id="4062375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062378">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062450">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062523">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062541">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062545">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062606">hLen</span>&nbsp;<span class="op" id="4062611">:=</span>&nbsp;<span class="ident" id="4062614">hash</span><span class="op" id="4062618">.</span><span class="ident" id="4062619">Size</span><span class="op" id="4062623">(</span><span class="op" id="4062624">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062627">if</span>&nbsp;<span class="ident" id="4062630">hLen</span>&nbsp;<span class="op" id="4062635">!=</span>&nbsp;<span class="builtinfunc" id="4062638">len</span><span class="op" id="4062641">(</span><span class="ident" id="4062642">mHash</span><span class="op" id="4062647">)</span>&nbsp;<span class="op" id="4062649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062653">return</span>&nbsp;<span class="ident" id="4062660">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062681">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062749">emLen</span>&nbsp;<span class="op" id="4062755">:=</span>&nbsp;<span class="op" id="4062758">(</span><span class="ident" id="4062759">emBits</span>&nbsp;<span class="op" id="4062766">+</span>&nbsp;<span class="num" id="4062768">7</span><span class="op" id="4062769">)</span>&nbsp;<span class="op" id="4062771">/</span>&nbsp;<span class="num" id="4062773">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062776">if</span>&nbsp;<span class="ident" id="4062779">emLen</span>&nbsp;<span class="op" id="4062785">&lt;</span>&nbsp;<span class="ident" id="4062787">hLen</span><span class="op" id="4062791">+</span><span class="ident" id="4062792">sLen</span><span class="op" id="4062796">+</span><span class="num" id="4062797">2</span>&nbsp;<span class="op" id="4062799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062803">return</span>&nbsp;<span class="ident" id="4062810">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062831">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4062900">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062946">if</span>&nbsp;<span class="ident" id="4062949">em</span><span class="op" id="4062951">[</span><span class="builtinfunc" id="4062952">len</span><span class="op" id="4062955">(</span><span class="ident" id="4062956">em</span><span class="op" id="4062958">)</span><span class="op" id="4062959">-</span><span class="num" id="4062960">1</span><span class="op" id="4062961">]</span>&nbsp;<span class="op" id="4062963">!=</span>&nbsp;<span class="num" id="4062966">0xBC</span>&nbsp;<span class="op" id="4062971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062975">return</span>&nbsp;<span class="ident" id="4062982">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062999">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063003">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063075">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063114">db</span>&nbsp;<span class="op" id="4063117">:=</span>&nbsp;<span class="ident" id="4063120">em</span><span class="op" id="4063122">[</span><span class="op" id="4063123">:</span><span class="ident" id="4063124">emLen</span><span class="op" id="4063129">-</span><span class="ident" id="4063130">hLen</span><span class="op" id="4063134">-</span><span class="num" id="4063135">1</span><span class="op" id="4063136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063139">h</span>&nbsp;<span class="op" id="4063141">:=</span>&nbsp;<span class="ident" id="4063144">em</span><span class="op" id="4063146">[</span><span class="ident" id="4063147">emLen</span><span class="op" id="4063152">-</span><span class="ident" id="4063153">hLen</span><span class="op" id="4063157">-</span><span class="num" id="4063158">1</span>&nbsp;<span class="op" id="4063160">:</span>&nbsp;<span class="builtinfunc" id="4063162">len</span><span class="op" id="4063165">(</span><span class="ident" id="4063166">em</span><span class="op" id="4063168">)</span><span class="op" id="4063169">-</span><span class="num" id="4063170">1</span><span class="op" id="4063171">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063175">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063248">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063318">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063332">if</span>&nbsp;<span class="ident" id="4063335">em</span><span class="op" id="4063337">[</span><span class="num" id="4063338">0</span><span class="op" id="4063339">]</span><span class="op" id="4063340">&amp;</span><span class="op" id="4063341">(</span><span class="num" id="4063342">0xFF</span><span class="op" id="4063346">&lt;&lt;</span><span class="builtintype" id="4063348">uint</span><span class="op" id="4063352">(</span><span class="num" id="4063353">8</span><span class="op" id="4063354">-</span><span class="op" id="4063355">(</span><span class="num" id="4063356">8</span><span class="op" id="4063357">*</span><span class="ident" id="4063358">emLen</span><span class="op" id="4063363">-</span><span class="ident" id="4063364">emBits</span><span class="op" id="4063370">)</span><span class="op" id="4063371">)</span><span class="op" id="4063372">)</span>&nbsp;<span class="op" id="4063374">!=</span>&nbsp;<span class="num" id="4063377">0</span>&nbsp;<span class="op" id="4063379">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063383">return</span>&nbsp;<span class="ident" id="4063390">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063411">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063458">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063462">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063501">mgf1XOR</span><span class="op" id="4063508">(</span><span class="ident" id="4063509">db</span><span class="op" id="4063511">,</span>&nbsp;<span class="ident" id="4063513">hash</span><span class="op" id="4063517">,</span>&nbsp;<span class="ident" id="4063519">h</span><span class="op" id="4063520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063524">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063601">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063618">db</span><span class="op" id="4063620">[</span><span class="num" id="4063621">0</span><span class="op" id="4063622">]</span>&nbsp;<span class="op" id="4063624">&amp;=</span>&nbsp;<span class="op" id="4063627">(</span><span class="num" id="4063628">0xFF</span>&nbsp;<span class="op" id="4063633">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4063636">uint</span><span class="op" id="4063640">(</span><span class="num" id="4063641">8</span><span class="op" id="4063642">*</span><span class="ident" id="4063643">emLen</span><span class="op" id="4063648">-</span><span class="ident" id="4063649">emBits</span><span class="op" id="4063655">)</span><span class="op" id="4063656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063660">if</span>&nbsp;<span class="ident" id="4063663">sLen</span>&nbsp;<span class="op" id="4063668">==</span>&nbsp;<span class="ident" id="4063671">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4063689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063692">FindSaltLength</span><span class="op" id="4063706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063710">for</span>&nbsp;<span class="ident" id="4063714">sLen</span>&nbsp;<span class="op" id="4063719">=</span>&nbsp;<span class="ident" id="4063721">emLen</span>&nbsp;<span class="op" id="4063727">-</span>&nbsp;<span class="op" id="4063729">(</span><span class="ident" id="4063730">hLen</span>&nbsp;<span class="op" id="4063735">+</span>&nbsp;<span class="num" id="4063737">2</span><span class="op" id="4063738">)</span><span class="op" id="4063739">;</span>&nbsp;<span class="ident" id="4063741">sLen</span>&nbsp;<span class="op" id="4063746">&gt;=</span>&nbsp;<span class="num" id="4063749">0</span><span class="op" id="4063750">;</span>&nbsp;<span class="ident" id="4063752">sLen</span><span class="op" id="4063756">--</span>&nbsp;<span class="op" id="4063759">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063764">switch</span>&nbsp;<span class="ident" id="4063771">db</span><span class="op" id="4063773">[</span><span class="ident" id="4063774">emLen</span><span class="op" id="4063779">-</span><span class="ident" id="4063780">hLen</span><span class="op" id="4063784">-</span><span class="ident" id="4063785">sLen</span><span class="op" id="4063789">-</span><span class="num" id="4063790">2</span><span class="op" id="4063791">]</span>&nbsp;<span class="op" id="4063793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063798">case</span>&nbsp;<span class="num" id="4063803">1</span><span class="op" id="4063804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063810">break</span>&nbsp;<span class="ident" id="4063816">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063834">case</span>&nbsp;<span class="num" id="4063839">0</span><span class="op" id="4063840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063846">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063858">default</span><span class="op" id="4063865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063871">return</span>&nbsp;<span class="ident" id="4063878">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063905">if</span>&nbsp;<span class="ident" id="4063908">sLen</span>&nbsp;<span class="op" id="4063913">&lt;</span>&nbsp;<span class="num" id="4063915">0</span>&nbsp;<span class="op" id="4063917">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063922">return</span>&nbsp;<span class="ident" id="4063929">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063950">}</span>&nbsp;<span class="keyword" id="4063952">else</span>&nbsp;<span class="op" id="4063957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063961">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064036">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064111">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064184">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064225">for</span>&nbsp;<span class="ident" id="4064229">_</span><span class="op" id="4064230">,</span>&nbsp;<span class="ident" id="4064232">e</span>&nbsp;<span class="op" id="4064234">:=</span>&nbsp;<span class="keyword" id="4064237">range</span>&nbsp;<span class="ident" id="4064243">db</span><span class="op" id="4064245">[</span><span class="op" id="4064246">:</span><span class="ident" id="4064247">emLen</span><span class="op" id="4064252">-</span><span class="ident" id="4064253">hLen</span><span class="op" id="4064257">-</span><span class="ident" id="4064258">sLen</span><span class="op" id="4064262">-</span><span class="num" id="4064263">2</span><span class="op" id="4064264">]</span>&nbsp;<span class="op" id="4064266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064271">if</span>&nbsp;<span class="ident" id="4064274">e</span>&nbsp;<span class="op" id="4064276">!=</span>&nbsp;<span class="num" id="4064279">0x00</span>&nbsp;<span class="op" id="4064284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064290">return</span>&nbsp;<span class="ident" id="4064297">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064324">if</span>&nbsp;<span class="ident" id="4064327">db</span><span class="op" id="4064329">[</span><span class="ident" id="4064330">emLen</span><span class="op" id="4064335">-</span><span class="ident" id="4064336">hLen</span><span class="op" id="4064340">-</span><span class="ident" id="4064341">sLen</span><span class="op" id="4064345">-</span><span class="num" id="4064346">2</span><span class="op" id="4064347">]</span>&nbsp;<span class="op" id="4064349">!=</span>&nbsp;<span class="num" id="4064352">0x01</span>&nbsp;<span class="op" id="4064357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064362">return</span>&nbsp;<span class="ident" id="4064369">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064387">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064394">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064443">salt</span>&nbsp;<span class="op" id="4064448">:=</span>&nbsp;<span class="ident" id="4064451">db</span><span class="op" id="4064453">[</span><span class="builtinfunc" id="4064454">len</span><span class="op" id="4064457">(</span><span class="ident" id="4064458">db</span><span class="op" id="4064460">)</span><span class="op" id="4064461">-</span><span class="ident" id="4064462">sLen</span><span class="op" id="4064466">:</span><span class="op" id="4064467">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064471">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064484">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064549">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064616">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064645">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064649">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064708">var</span>&nbsp;<span class="ident" id="4064712">prefix</span>&nbsp;<span class="op" id="4064719">[</span><span class="num" id="4064720">8</span><span class="op" id="4064721">]</span><span class="builtintype" id="4064722">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064728">hash</span><span class="op" id="4064732">.</span><span class="ident" id="4064733">Write</span><span class="op" id="4064738">(</span><span class="ident" id="4064739">prefix</span><span class="op" id="4064745">[</span><span class="op" id="4064746">:</span><span class="op" id="4064747">]</span><span class="op" id="4064748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064751">hash</span><span class="op" id="4064755">.</span><span class="ident" id="4064756">Write</span><span class="op" id="4064761">(</span><span class="ident" id="4064762">mHash</span><span class="op" id="4064767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064770">hash</span><span class="op" id="4064774">.</span><span class="ident" id="4064775">Write</span><span class="op" id="4064780">(</span><span class="ident" id="4064781">salt</span><span class="op" id="4064785">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064789">h0</span>&nbsp;<span class="op" id="4064792">:=</span>&nbsp;<span class="ident" id="4064795">hash</span><span class="op" id="4064799">.</span><span class="ident" id="4064800">Sum</span><span class="op" id="4064803">(</span><span class="ident" id="4064804">nil</span><span class="op" id="4064807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064811">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064885">if</span>&nbsp;<span class="op" id="4064888">!</span><span class="ident" id="4064889">bytes</span><span class="op" id="4064894">.</span><span class="ident" id="4064895">Equal</span><span class="op" id="4064900">(</span><span class="ident" id="4064901">h0</span><span class="op" id="4064903">,</span>&nbsp;<span class="ident" id="4064905">h</span><span class="op" id="4064906">)</span>&nbsp;<span class="op" id="4064908">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064912">return</span>&nbsp;<span class="ident" id="4064919">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064939">return</span>&nbsp;<span class="ident" id="4064946">nil</span><br>
<span class="lineno"></span><span class="op" id="4064950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4064953">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="4065042">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4065120">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4065200">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4065239">func</span>&nbsp;<span class="ident" id="4065244">signPSSWithSalt</span><span class="op" id="4065259">(</span><span class="ident" id="4065260">rand</span>&nbsp;<span class="ident" id="4065265">io</span><span class="op" id="4065267">.</span><span class="ident" id="4065268">Reader</span><span class="op" id="4065274">,</span>&nbsp;<span class="ident" id="4065276">priv</span>&nbsp;<span class="op" id="4065281">*</span><span class="ident" id="4065282">PrivateKey</span><span class="op" id="4065292">,</span>&nbsp;<span class="ident" id="4065294">hash</span>&nbsp;<span class="ident" id="4065299">crypto</span><span class="op" id="4065305">.</span><span class="ident" id="4065306">Hash</span><span class="op" id="4065310">,</span>&nbsp;<span class="ident" id="4065312">hashed</span><span class="op" id="4065318">,</span>&nbsp;<span class="ident" id="4065320">salt</span>&nbsp;<span class="op" id="4065325">[</span><span class="op" id="4065326">]</span><span class="builtintype" id="4065327">byte</span><span class="op" id="4065331">)</span>&nbsp;<span class="op" id="4065333">(</span><span class="ident" id="4065334">s</span>&nbsp;<span class="op" id="4065336">[</span><span class="op" id="4065337">]</span><span class="builtintype" id="4065338">byte</span><span class="op" id="4065342">,</span>&nbsp;<span class="ident" id="4065344">err</span>&nbsp;<span class="builtintype" id="4065348">error</span><span class="op" id="4065353">)</span>&nbsp;<span class="op" id="4065355">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065358">nBits</span>&nbsp;<span class="op" id="4065364">:=</span>&nbsp;<span class="ident" id="4065367">priv</span><span class="op" id="4065371">.</span><span class="ident" id="4065372">N</span><span class="op" id="4065373">.</span><span class="ident" id="4065374">BitLen</span><span class="op" id="4065380">(</span><span class="op" id="4065381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065384">em</span><span class="op" id="4065386">,</span>&nbsp;<span class="ident" id="4065388">err</span>&nbsp;<span class="op" id="4065392">:=</span>&nbsp;<span class="ident" id="4065395">emsaPSSEncode</span><span class="op" id="4065408">(</span><span class="ident" id="4065409">hashed</span><span class="op" id="4065415">,</span>&nbsp;<span class="ident" id="4065417">nBits</span><span class="op" id="4065422">-</span><span class="num" id="4065423">1</span><span class="op" id="4065424">,</span>&nbsp;<span class="ident" id="4065426">salt</span><span class="op" id="4065430">,</span>&nbsp;<span class="ident" id="4065432">hash</span><span class="op" id="4065436">.</span><span class="ident" id="4065437">New</span><span class="op" id="4065440">(</span><span class="op" id="4065441">)</span><span class="op" id="4065442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065445">if</span>&nbsp;<span class="ident" id="4065448">err</span>&nbsp;<span class="op" id="4065452">!=</span>&nbsp;<span class="ident" id="4065455">nil</span>&nbsp;<span class="op" id="4065459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065463">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065471">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065474">m</span>&nbsp;<span class="op" id="4065476">:=</span>&nbsp;<span class="builtinfunc" id="4065479">new</span><span class="op" id="4065482">(</span><span class="ident" id="4065483">big</span><span class="op" id="4065486">.</span><span class="ident" id="4065487">Int</span><span class="op" id="4065490">)</span><span class="op" id="4065491">.</span><span class="ident" id="4065492">SetBytes</span><span class="op" id="4065500">(</span><span class="ident" id="4065501">em</span><span class="op" id="4065503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065506">c</span><span class="op" id="4065507">,</span>&nbsp;<span class="ident" id="4065509">err</span>&nbsp;<span class="op" id="4065513">:=</span>&nbsp;<span class="ident" id="4065516">decrypt</span><span class="op" id="4065523">(</span><span class="ident" id="4065524">rand</span><span class="op" id="4065528">,</span>&nbsp;<span class="ident" id="4065530">priv</span><span class="op" id="4065534">,</span>&nbsp;<span class="ident" id="4065536">m</span><span class="op" id="4065537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065540">if</span>&nbsp;<span class="ident" id="4065543">err</span>&nbsp;<span class="op" id="4065547">!=</span>&nbsp;<span class="ident" id="4065550">nil</span>&nbsp;<span class="op" id="4065554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065558">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065566">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065569">s</span>&nbsp;<span class="op" id="4065571">=</span>&nbsp;<span class="builtinfunc" id="4065573">make</span><span class="op" id="4065577">(</span><span class="op" id="4065578">[</span><span class="op" id="4065579">]</span><span class="builtintype" id="4065580">byte</span><span class="op" id="4065584">,</span>&nbsp;<span class="op" id="4065586">(</span><span class="ident" id="4065587">nBits</span><span class="op" id="4065592">+</span><span class="num" id="4065593">7</span><span class="op" id="4065594">)</span><span class="op" id="4065595">/</span><span class="num" id="4065596">8</span><span class="op" id="4065597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065600">copyWithLeftPad</span><span class="op" id="4065615">(</span><span class="ident" id="4065616">s</span><span class="op" id="4065617">,</span>&nbsp;<span class="ident" id="4065619">c</span><span class="op" id="4065620">.</span><span class="ident" id="4065621">Bytes</span><span class="op" id="4065626">(</span><span class="op" id="4065627">)</span><span class="op" id="4065628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065631">return</span><br>
<span class="lineno"></span><span class="op" id="4065638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4065641">const</span>&nbsp;<span class="op" id="4065647">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065650">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065722">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065792">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4065810">=</span>&nbsp;<span class="num" id="4065812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065815">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065886">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065925">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4065949">=</span>&nbsp;<span class="op" id="4065951">-</span><span class="num" id="4065952">1</span><br>
<span class="lineno"></span><span class="op" id="4065954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4065957">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="4066031">type</span>&nbsp;<span class="ident" id="4066036">PSSOptions</span>&nbsp;<span class="keyword" id="4066047">struct</span>&nbsp;<span class="op" id="4066054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066057">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066120">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066193">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066222">SaltLength</span>&nbsp;<span class="builtintype" id="4066233">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066239">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066309">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066378">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066407">Hash</span>&nbsp;<span class="ident" id="4066412">crypto</span><span class="op" id="4066418">.</span><span class="ident" id="4066419">Hash</span><br>
<span class="lineno">230</span><span class="op" id="4066424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4066427">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4066490">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="4066512">func</span>&nbsp;<span class="op" id="4066517">(</span><span class="ident" id="4066518">pssOpts</span>&nbsp;<span class="op" id="4066526">*</span><span class="ident" id="4066527">PSSOptions</span><span class="op" id="4066537">)</span>&nbsp;<span class="ident" id="4066539">HashFunc</span><span class="op" id="4066547">(</span><span class="op" id="4066548">)</span>&nbsp;<span class="ident" id="4066550">crypto</span><span class="op" id="4066556">.</span><span class="ident" id="4066557">Hash</span>&nbsp;<span class="op" id="4066562">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066565">return</span>&nbsp;<span class="ident" id="4066572">pssOpts</span><span class="op" id="4066579">.</span><span class="ident" id="4066580">Hash</span><br>
<span class="lineno"></span><span class="op" id="4066585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4066588">func</span>&nbsp;<span class="op" id="4066593">(</span><span class="ident" id="4066594">opts</span>&nbsp;<span class="op" id="4066599">*</span><span class="ident" id="4066600">PSSOptions</span><span class="op" id="4066610">)</span>&nbsp;<span class="ident" id="4066612">saltLength</span><span class="op" id="4066622">(</span><span class="op" id="4066623">)</span>&nbsp;<span class="builtintype" id="4066625">int</span>&nbsp;<span class="op" id="4066629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066632">if</span>&nbsp;<span class="ident" id="4066635">opts</span>&nbsp;<span class="op" id="4066640">==</span>&nbsp;<span class="ident" id="4066643">nil</span>&nbsp;<span class="op" id="4066647">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066651">return</span>&nbsp;<span class="ident" id="4066658">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066680">return</span>&nbsp;<span class="ident" id="4066687">opts</span><span class="op" id="4066691">.</span><span class="ident" id="4066692">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="4066703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4066706">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4066774">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4066852">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4066929">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4066951">func</span>&nbsp;<span class="ident" id="4066956">SignPSS</span><span class="op" id="4066963">(</span><span class="ident" id="4066964">rand</span>&nbsp;<span class="ident" id="4066969">io</span><span class="op" id="4066971">.</span><span class="ident" id="4066972">Reader</span><span class="op" id="4066978">,</span>&nbsp;<span class="ident" id="4066980">priv</span>&nbsp;<span class="op" id="4066985">*</span><span class="ident" id="4066986">PrivateKey</span><span class="op" id="4066996">,</span>&nbsp;<span class="ident" id="4066998">hash</span>&nbsp;<span class="ident" id="4067003">crypto</span><span class="op" id="4067009">.</span><span class="ident" id="4067010">Hash</span><span class="op" id="4067014">,</span>&nbsp;<span class="ident" id="4067016">hashed</span>&nbsp;<span class="op" id="4067023">[</span><span class="op" id="4067024">]</span><span class="builtintype" id="4067025">byte</span><span class="op" id="4067029">,</span>&nbsp;<span class="ident" id="4067031">opts</span>&nbsp;<span class="op" id="4067036">*</span><span class="ident" id="4067037">PSSOptions</span><span class="op" id="4067047">)</span>&nbsp;<span class="op" id="4067049">(</span><span class="ident" id="4067050">s</span>&nbsp;<span class="op" id="4067052">[</span><span class="op" id="4067053">]</span><span class="builtintype" id="4067054">byte</span><span class="op" id="4067058">,</span>&nbsp;<span class="ident" id="4067060">err</span>&nbsp;<span class="builtintype" id="4067064">error</span><span class="op" id="4067069">)</span>&nbsp;<span class="op" id="4067071">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067074">saltLength</span>&nbsp;<span class="op" id="4067085">:=</span>&nbsp;<span class="ident" id="4067088">opts</span><span class="op" id="4067092">.</span><span class="ident" id="4067093">saltLength</span><span class="op" id="4067103">(</span><span class="op" id="4067104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067107">switch</span>&nbsp;<span class="ident" id="4067114">saltLength</span>&nbsp;<span class="op" id="4067125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067128">case</span>&nbsp;<span class="ident" id="4067133">PSSSaltLengthAuto</span><span class="op" id="4067150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067154">saltLength</span>&nbsp;<span class="op" id="4067165">=</span>&nbsp;<span class="op" id="4067167">(</span><span class="ident" id="4067168">priv</span><span class="op" id="4067172">.</span><span class="ident" id="4067173">N</span><span class="op" id="4067174">.</span><span class="ident" id="4067175">BitLen</span><span class="op" id="4067181">(</span><span class="op" id="4067182">)</span><span class="op" id="4067183">+</span><span class="num" id="4067184">7</span><span class="op" id="4067185">)</span><span class="op" id="4067186">/</span><span class="num" id="4067187">8</span>&nbsp;<span class="op" id="4067189">-</span>&nbsp;<span class="num" id="4067191">2</span>&nbsp;<span class="op" id="4067193">-</span>&nbsp;<span class="ident" id="4067195">hash</span><span class="op" id="4067199">.</span><span class="ident" id="4067200">Size</span><span class="op" id="4067204">(</span><span class="op" id="4067205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067208">case</span>&nbsp;<span class="ident" id="4067213">PSSSaltLengthEqualsHash</span><span class="op" id="4067236">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067240">saltLength</span>&nbsp;<span class="op" id="4067251">=</span>&nbsp;<span class="ident" id="4067253">hash</span><span class="op" id="4067257">.</span><span class="ident" id="4067258">Size</span><span class="op" id="4067262">(</span><span class="op" id="4067263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067270">if</span>&nbsp;<span class="ident" id="4067273">opts</span><span class="op" id="4067277">.</span><span class="ident" id="4067278">Hash</span>&nbsp;<span class="op" id="4067283">!=</span>&nbsp;<span class="num" id="4067286">0</span>&nbsp;<span class="op" id="4067288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067292">hash</span>&nbsp;<span class="op" id="4067297">=</span>&nbsp;<span class="ident" id="4067299">opts</span><span class="op" id="4067303">.</span><span class="ident" id="4067304">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067314">salt</span>&nbsp;<span class="op" id="4067319">:=</span>&nbsp;<span class="builtinfunc" id="4067322">make</span><span class="op" id="4067326">(</span><span class="op" id="4067327">[</span><span class="op" id="4067328">]</span><span class="builtintype" id="4067329">byte</span><span class="op" id="4067333">,</span>&nbsp;<span class="ident" id="4067335">saltLength</span><span class="op" id="4067345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067348">if</span>&nbsp;<span class="ident" id="4067351">_</span><span class="op" id="4067352">,</span>&nbsp;<span class="ident" id="4067354">err</span>&nbsp;<span class="op" id="4067358">=</span>&nbsp;<span class="ident" id="4067360">io</span><span class="op" id="4067362">.</span><span class="ident" id="4067363">ReadFull</span><span class="op" id="4067371">(</span><span class="ident" id="4067372">rand</span><span class="op" id="4067376">,</span>&nbsp;<span class="ident" id="4067378">salt</span><span class="op" id="4067382">)</span><span class="op" id="4067383">;</span>&nbsp;<span class="ident" id="4067385">err</span>&nbsp;<span class="op" id="4067389">!=</span>&nbsp;<span class="ident" id="4067392">nil</span>&nbsp;<span class="op" id="4067396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067400">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067411">return</span>&nbsp;<span class="ident" id="4067418">signPSSWithSalt</span><span class="op" id="4067433">(</span><span class="ident" id="4067434">rand</span><span class="op" id="4067438">,</span>&nbsp;<span class="ident" id="4067440">priv</span><span class="op" id="4067444">,</span>&nbsp;<span class="ident" id="4067446">hash</span><span class="op" id="4067450">,</span>&nbsp;<span class="ident" id="4067452">hashed</span><span class="op" id="4067458">,</span>&nbsp;<span class="ident" id="4067460">salt</span><span class="op" id="4067464">)</span><br>
<span class="lineno"></span><span class="op" id="4067466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4067469">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="4067508">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4067582">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4067654">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4067733">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4067755">func</span>&nbsp;<span class="ident" id="4067760">VerifyPSS</span><span class="op" id="4067769">(</span><span class="ident" id="4067770">pub</span>&nbsp;<span class="op" id="4067774">*</span><span class="ident" id="4067775">PublicKey</span><span class="op" id="4067784">,</span>&nbsp;<span class="ident" id="4067786">hash</span>&nbsp;<span class="ident" id="4067791">crypto</span><span class="op" id="4067797">.</span><span class="ident" id="4067798">Hash</span><span class="op" id="4067802">,</span>&nbsp;<span class="ident" id="4067804">hashed</span>&nbsp;<span class="op" id="4067811">[</span><span class="op" id="4067812">]</span><span class="builtintype" id="4067813">byte</span><span class="op" id="4067817">,</span>&nbsp;<span class="ident" id="4067819">sig</span>&nbsp;<span class="op" id="4067823">[</span><span class="op" id="4067824">]</span><span class="builtintype" id="4067825">byte</span><span class="op" id="4067829">,</span>&nbsp;<span class="ident" id="4067831">opts</span>&nbsp;<span class="op" id="4067836">*</span><span class="ident" id="4067837">PSSOptions</span><span class="op" id="4067847">)</span>&nbsp;<span class="builtintype" id="4067849">error</span>&nbsp;<span class="op" id="4067855">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067858">return</span>&nbsp;<span class="ident" id="4067865">verifyPSS</span><span class="op" id="4067874">(</span><span class="ident" id="4067875">pub</span><span class="op" id="4067878">,</span>&nbsp;<span class="ident" id="4067880">hash</span><span class="op" id="4067884">,</span>&nbsp;<span class="ident" id="4067886">hashed</span><span class="op" id="4067892">,</span>&nbsp;<span class="ident" id="4067894">sig</span><span class="op" id="4067897">,</span>&nbsp;<span class="ident" id="4067899">opts</span><span class="op" id="4067903">.</span><span class="ident" id="4067904">saltLength</span><span class="op" id="4067914">(</span><span class="op" id="4067915">)</span><span class="op" id="4067916">)</span><br>
<span class="lineno"></span><span class="op" id="4067918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4067921">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4067987">func</span>&nbsp;<span class="ident" id="4067992">verifyPSS</span><span class="op" id="4068001">(</span><span class="ident" id="4068002">pub</span>&nbsp;<span class="op" id="4068006">*</span><span class="ident" id="4068007">PublicKey</span><span class="op" id="4068016">,</span>&nbsp;<span class="ident" id="4068018">hash</span>&nbsp;<span class="ident" id="4068023">crypto</span><span class="op" id="4068029">.</span><span class="ident" id="4068030">Hash</span><span class="op" id="4068034">,</span>&nbsp;<span class="ident" id="4068036">hashed</span>&nbsp;<span class="op" id="4068043">[</span><span class="op" id="4068044">]</span><span class="builtintype" id="4068045">byte</span><span class="op" id="4068049">,</span>&nbsp;<span class="ident" id="4068051">sig</span>&nbsp;<span class="op" id="4068055">[</span><span class="op" id="4068056">]</span><span class="builtintype" id="4068057">byte</span><span class="op" id="4068061">,</span>&nbsp;<span class="ident" id="4068063">saltLen</span>&nbsp;<span class="builtintype" id="4068071">int</span><span class="op" id="4068074">)</span>&nbsp;<span class="builtintype" id="4068076">error</span>&nbsp;<span class="op" id="4068082">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068085">nBits</span>&nbsp;<span class="op" id="4068091">:=</span>&nbsp;<span class="ident" id="4068094">pub</span><span class="op" id="4068097">.</span><span class="ident" id="4068098">N</span><span class="op" id="4068099">.</span><span class="ident" id="4068100">BitLen</span><span class="op" id="4068106">(</span><span class="op" id="4068107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068110">if</span>&nbsp;<span class="builtinfunc" id="4068113">len</span><span class="op" id="4068116">(</span><span class="ident" id="4068117">sig</span><span class="op" id="4068120">)</span>&nbsp;<span class="op" id="4068122">!=</span>&nbsp;<span class="op" id="4068125">(</span><span class="ident" id="4068126">nBits</span><span class="op" id="4068131">+</span><span class="num" id="4068132">7</span><span class="op" id="4068133">)</span><span class="op" id="4068134">/</span><span class="num" id="4068135">8</span>&nbsp;<span class="op" id="4068137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068141">return</span>&nbsp;<span class="ident" id="4068148">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068168">s</span>&nbsp;<span class="op" id="4068170">:=</span>&nbsp;<span class="builtinfunc" id="4068173">new</span><span class="op" id="4068176">(</span><span class="ident" id="4068177">big</span><span class="op" id="4068180">.</span><span class="ident" id="4068181">Int</span><span class="op" id="4068184">)</span><span class="op" id="4068185">.</span><span class="ident" id="4068186">SetBytes</span><span class="op" id="4068194">(</span><span class="ident" id="4068195">sig</span><span class="op" id="4068198">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068201">m</span>&nbsp;<span class="op" id="4068203">:=</span>&nbsp;<span class="ident" id="4068206">encrypt</span><span class="op" id="4068213">(</span><span class="builtinfunc" id="4068214">new</span><span class="op" id="4068217">(</span><span class="ident" id="4068218">big</span><span class="op" id="4068221">.</span><span class="ident" id="4068222">Int</span><span class="op" id="4068225">)</span><span class="op" id="4068226">,</span>&nbsp;<span class="ident" id="4068228">pub</span><span class="op" id="4068231">,</span>&nbsp;<span class="ident" id="4068233">s</span><span class="op" id="4068234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068237">emBits</span>&nbsp;<span class="op" id="4068244">:=</span>&nbsp;<span class="ident" id="4068247">nBits</span>&nbsp;<span class="op" id="4068253">-</span>&nbsp;<span class="num" id="4068255">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068258">emLen</span>&nbsp;<span class="op" id="4068264">:=</span>&nbsp;<span class="op" id="4068267">(</span><span class="ident" id="4068268">emBits</span>&nbsp;<span class="op" id="4068275">+</span>&nbsp;<span class="num" id="4068277">7</span><span class="op" id="4068278">)</span>&nbsp;<span class="op" id="4068280">/</span>&nbsp;<span class="num" id="4068282">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068285">if</span>&nbsp;<span class="ident" id="4068288">emLen</span>&nbsp;<span class="op" id="4068294">&lt;</span>&nbsp;<span class="builtinfunc" id="4068296">len</span><span class="op" id="4068299">(</span><span class="ident" id="4068300">m</span><span class="op" id="4068301">.</span><span class="ident" id="4068302">Bytes</span><span class="op" id="4068307">(</span><span class="op" id="4068308">)</span><span class="op" id="4068309">)</span>&nbsp;<span class="op" id="4068311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068315">return</span>&nbsp;<span class="ident" id="4068322">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068342">em</span>&nbsp;<span class="op" id="4068345">:=</span>&nbsp;<span class="builtinfunc" id="4068348">make</span><span class="op" id="4068352">(</span><span class="op" id="4068353">[</span><span class="op" id="4068354">]</span><span class="builtintype" id="4068355">byte</span><span class="op" id="4068359">,</span>&nbsp;<span class="ident" id="4068361">emLen</span><span class="op" id="4068366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068369">copyWithLeftPad</span><span class="op" id="4068384">(</span><span class="ident" id="4068385">em</span><span class="op" id="4068387">,</span>&nbsp;<span class="ident" id="4068389">m</span><span class="op" id="4068390">.</span><span class="ident" id="4068391">Bytes</span><span class="op" id="4068396">(</span><span class="op" id="4068397">)</span><span class="op" id="4068398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068401">if</span>&nbsp;<span class="ident" id="4068404">saltLen</span>&nbsp;<span class="op" id="4068412">==</span>&nbsp;<span class="ident" id="4068415">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4068439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068443">saltLen</span>&nbsp;<span class="op" id="4068451">=</span>&nbsp;<span class="ident" id="4068453">hash</span><span class="op" id="4068457">.</span><span class="ident" id="4068458">Size</span><span class="op" id="4068462">(</span><span class="op" id="4068463">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068469">return</span>&nbsp;<span class="ident" id="4068476">emsaPSSVerify</span><span class="op" id="4068489">(</span><span class="ident" id="4068490">hashed</span><span class="op" id="4068496">,</span>&nbsp;<span class="ident" id="4068498">em</span><span class="op" id="4068500">,</span>&nbsp;<span class="ident" id="4068502">emBits</span><span class="op" id="4068508">,</span>&nbsp;<span class="ident" id="4068510">saltLen</span><span class="op" id="4068517">,</span>&nbsp;<span class="ident" id="4068519">hash</span><span class="op" id="4068523">.</span><span class="ident" id="4068524">New</span><span class="op" id="4068527">(</span><span class="op" id="4068528">)</span><span class="op" id="4068529">)</span><br>
<span class="lineno"></span><span class="op" id="4068531">}</span>
</div>
</body>
</html>
