<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html" class="current">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4417985">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4418040">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4418094">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4418145">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="4418213">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="4418259">//</span><br>
<span class="lineno"></span><span class="comment" id="4418262">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="4418287">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="4418313">//</span><br>
<span class="lineno"></span><span class="comment" id="4418316">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="4418354">//</span><br>
<span class="lineno"></span><span class="comment" id="4418357">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="4418412">//</span><br>
<span class="lineno">15</span><span class="comment" id="4418415">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4418489">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="4418562">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="4418636">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4418710">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="4418727">//</span><br>
<span class="lineno"></span><span class="keyword" id="4418730">package</span>&nbsp;<span class="ident" id="4418738">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418743">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="4418814">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="4418885">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4418904">import</span>&nbsp;<span class="op" id="4418911">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4418914">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4418924">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4418930">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4418938">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4418951">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4418958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4418961">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4418998">//</span><br>
<span class="lineno"></span><span class="comment" id="4419001">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="4419067">//</span><br>
<span class="lineno"></span><span class="comment" id="4419070">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="4419142">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="4419189">//</span><br>
<span class="lineno"></span><span class="comment" id="4419192">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="4419261">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4419332">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="4419403">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4419466">//</span><br>
<span class="lineno"></span><span class="keyword" id="4419469">type</span>&nbsp;<span class="ident" id="4419474">nat</span>&nbsp;<span class="op" id="4419478">[</span><span class="op" id="4419479">]</span><span class="ident" id="4419480">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4419486">var</span>&nbsp;<span class="op" id="4419490">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419493">natOne</span>&nbsp;<span class="op" id="4419500">=</span>&nbsp;<span class="ident" id="4419502">nat</span><span class="op" id="4419505">{</span><span class="num" id="4419506">1</span><span class="op" id="4419507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419510">natTwo</span>&nbsp;<span class="op" id="4419517">=</span>&nbsp;<span class="ident" id="4419519">nat</span><span class="op" id="4419522">{</span><span class="num" id="4419523">2</span><span class="op" id="4419524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419527">natTen</span>&nbsp;<span class="op" id="4419534">=</span>&nbsp;<span class="ident" id="4419536">nat</span><span class="op" id="4419539">{</span><span class="num" id="4419540">10</span><span class="op" id="4419542">}</span><br>
<span class="lineno"></span><span class="op" id="4419544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4419547">func</span>&nbsp;<span class="op" id="4419552">(</span><span class="ident" id="4419553">z</span>&nbsp;<span class="ident" id="4419555">nat</span><span class="op" id="4419558">)</span>&nbsp;<span class="ident" id="4419560">clear</span><span class="op" id="4419565">(</span><span class="op" id="4419566">)</span>&nbsp;<span class="op" id="4419568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419571">for</span>&nbsp;<span class="ident" id="4419575">i</span>&nbsp;<span class="op" id="4419577">:=</span>&nbsp;<span class="keyword" id="4419580">range</span>&nbsp;<span class="ident" id="4419586">z</span>&nbsp;<span class="op" id="4419588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419592">z</span><span class="op" id="4419593">[</span><span class="ident" id="4419594">i</span><span class="op" id="4419595">]</span>&nbsp;<span class="op" id="4419597">=</span>&nbsp;<span class="num" id="4419599">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419602">}</span><br>
<span class="lineno"></span><span class="op" id="4419604">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4419607">func</span>&nbsp;<span class="op" id="4419612">(</span><span class="ident" id="4419613">z</span>&nbsp;<span class="ident" id="4419615">nat</span><span class="op" id="4419618">)</span>&nbsp;<span class="ident" id="4419620">norm</span><span class="op" id="4419624">(</span><span class="op" id="4419625">)</span>&nbsp;<span class="ident" id="4419627">nat</span>&nbsp;<span class="op" id="4419631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419634">i</span>&nbsp;<span class="op" id="4419636">:=</span>&nbsp;<span class="builtinfunc" id="4419639">len</span><span class="op" id="4419642">(</span><span class="ident" id="4419643">z</span><span class="op" id="4419644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419647">for</span>&nbsp;<span class="ident" id="4419651">i</span>&nbsp;<span class="op" id="4419653">&gt;</span>&nbsp;<span class="num" id="4419655">0</span>&nbsp;<span class="op" id="4419657">&amp;&amp;</span>&nbsp;<span class="ident" id="4419660">z</span><span class="op" id="4419661">[</span><span class="ident" id="4419662">i</span><span class="op" id="4419663">-</span><span class="num" id="4419664">1</span><span class="op" id="4419665">]</span>&nbsp;<span class="op" id="4419667">==</span>&nbsp;<span class="num" id="4419670">0</span>&nbsp;<span class="op" id="4419672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419676">i</span><span class="op" id="4419677">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419684">return</span>&nbsp;<span class="ident" id="4419691">z</span><span class="op" id="4419692">[</span><span class="num" id="4419693">0</span><span class="op" id="4419694">:</span><span class="ident" id="4419695">i</span><span class="op" id="4419696">]</span><br>
<span class="lineno"></span><span class="op" id="4419698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4419701">func</span>&nbsp;<span class="op" id="4419706">(</span><span class="ident" id="4419707">z</span>&nbsp;<span class="ident" id="4419709">nat</span><span class="op" id="4419712">)</span>&nbsp;<span class="builtinfunc" id="4419714">make</span><span class="op" id="4419718">(</span><span class="ident" id="4419719">n</span>&nbsp;<span class="builtintype" id="4419721">int</span><span class="op" id="4419724">)</span>&nbsp;<span class="ident" id="4419726">nat</span>&nbsp;<span class="op" id="4419730">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419733">if</span>&nbsp;<span class="ident" id="4419736">n</span>&nbsp;<span class="op" id="4419738">&lt;=</span>&nbsp;<span class="builtinfunc" id="4419741">cap</span><span class="op" id="4419744">(</span><span class="ident" id="4419745">z</span><span class="op" id="4419746">)</span>&nbsp;<span class="op" id="4419748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419752">return</span>&nbsp;<span class="ident" id="4419759">z</span><span class="op" id="4419760">[</span><span class="num" id="4419761">0</span><span class="op" id="4419762">:</span><span class="ident" id="4419763">n</span><span class="op" id="4419764">]</span>&nbsp;<span class="comment" id="4419766">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419781">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419848">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419912">const</span>&nbsp;<span class="ident" id="4419918">e</span>&nbsp;<span class="op" id="4419920">=</span>&nbsp;<span class="num" id="4419922">4</span>&nbsp;<span class="comment" id="4419924">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419943">return</span>&nbsp;<span class="builtinfunc" id="4419950">make</span><span class="op" id="4419954">(</span><span class="ident" id="4419955">nat</span><span class="op" id="4419958">,</span>&nbsp;<span class="ident" id="4419960">n</span><span class="op" id="4419961">,</span>&nbsp;<span class="ident" id="4419963">n</span><span class="op" id="4419964">+</span><span class="ident" id="4419965">e</span><span class="op" id="4419966">)</span><br>
<span class="lineno"></span><span class="op" id="4419968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4419971">func</span>&nbsp;<span class="op" id="4419976">(</span><span class="ident" id="4419977">z</span>&nbsp;<span class="ident" id="4419979">nat</span><span class="op" id="4419982">)</span>&nbsp;<span class="ident" id="4419984">setWord</span><span class="op" id="4419991">(</span><span class="ident" id="4419992">x</span>&nbsp;<span class="ident" id="4419994">Word</span><span class="op" id="4419998">)</span>&nbsp;<span class="ident" id="4420000">nat</span>&nbsp;<span class="op" id="4420004">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420007">if</span>&nbsp;<span class="ident" id="4420010">x</span>&nbsp;<span class="op" id="4420012">==</span>&nbsp;<span class="num" id="4420015">0</span>&nbsp;<span class="op" id="4420017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420021">return</span>&nbsp;<span class="ident" id="4420028">z</span><span class="op" id="4420029">.</span><span class="builtinfunc" id="4420030">make</span><span class="op" id="4420034">(</span><span class="num" id="4420035">0</span><span class="op" id="4420036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420042">z</span>&nbsp;<span class="op" id="4420044">=</span>&nbsp;<span class="ident" id="4420046">z</span><span class="op" id="4420047">.</span><span class="builtinfunc" id="4420048">make</span><span class="op" id="4420052">(</span><span class="num" id="4420053">1</span><span class="op" id="4420054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420057">z</span><span class="op" id="4420058">[</span><span class="num" id="4420059">0</span><span class="op" id="4420060">]</span>&nbsp;<span class="op" id="4420062">=</span>&nbsp;<span class="ident" id="4420064">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420067">return</span>&nbsp;<span class="ident" id="4420074">z</span><br>
<span class="lineno"></span><span class="op" id="4420076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4420079">func</span>&nbsp;<span class="op" id="4420084">(</span><span class="ident" id="4420085">z</span>&nbsp;<span class="ident" id="4420087">nat</span><span class="op" id="4420090">)</span>&nbsp;<span class="ident" id="4420092">setUint64</span><span class="op" id="4420101">(</span><span class="ident" id="4420102">x</span>&nbsp;<span class="ident" id="4420104">uint64</span><span class="op" id="4420110">)</span>&nbsp;<span class="ident" id="4420112">nat</span>&nbsp;<span class="op" id="4420116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420119">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420143">if</span>&nbsp;<span class="ident" id="4420146">w</span>&nbsp;<span class="op" id="4420148">:=</span>&nbsp;<span class="ident" id="4420151">Word</span><span class="op" id="4420155">(</span><span class="ident" id="4420156">x</span><span class="op" id="4420157">)</span><span class="op" id="4420158">;</span>&nbsp;<span class="ident" id="4420160">uint64</span><span class="op" id="4420166">(</span><span class="ident" id="4420167">w</span><span class="op" id="4420168">)</span>&nbsp;<span class="op" id="4420170">==</span>&nbsp;<span class="ident" id="4420173">x</span>&nbsp;<span class="op" id="4420175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420179">return</span>&nbsp;<span class="ident" id="4420186">z</span><span class="op" id="4420187">.</span><span class="ident" id="4420188">setWord</span><span class="op" id="4420195">(</span><span class="ident" id="4420196">w</span><span class="op" id="4420197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420204">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420258">n</span>&nbsp;<span class="op" id="4420260">:=</span>&nbsp;<span class="num" id="4420263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420266">for</span>&nbsp;<span class="ident" id="4420270">t</span>&nbsp;<span class="op" id="4420272">:=</span>&nbsp;<span class="ident" id="4420275">x</span><span class="op" id="4420276">;</span>&nbsp;<span class="ident" id="4420278">t</span>&nbsp;<span class="op" id="4420280">&gt;</span>&nbsp;<span class="num" id="4420282">0</span><span class="op" id="4420283">;</span>&nbsp;<span class="ident" id="4420285">t</span>&nbsp;<span class="op" id="4420287">&gt;&gt;=</span>&nbsp;<span class="ident" id="4420291">_W</span>&nbsp;<span class="op" id="4420294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420298">n</span><span class="op" id="4420299">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420307">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420332">z</span>&nbsp;<span class="op" id="4420334">=</span>&nbsp;<span class="ident" id="4420336">z</span><span class="op" id="4420337">.</span><span class="builtinfunc" id="4420338">make</span><span class="op" id="4420342">(</span><span class="ident" id="4420343">n</span><span class="op" id="4420344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420347">for</span>&nbsp;<span class="ident" id="4420351">i</span>&nbsp;<span class="op" id="4420353">:=</span>&nbsp;<span class="keyword" id="4420356">range</span>&nbsp;<span class="ident" id="4420362">z</span>&nbsp;<span class="op" id="4420364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420368">z</span><span class="op" id="4420369">[</span><span class="ident" id="4420370">i</span><span class="op" id="4420371">]</span>&nbsp;<span class="op" id="4420373">=</span>&nbsp;<span class="ident" id="4420375">Word</span><span class="op" id="4420379">(</span><span class="ident" id="4420380">x</span>&nbsp;<span class="op" id="4420382">&amp;</span>&nbsp;<span class="ident" id="4420384">_M</span><span class="op" id="4420386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420390">x</span>&nbsp;<span class="op" id="4420392">&gt;&gt;=</span>&nbsp;<span class="ident" id="4420396">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420404">return</span>&nbsp;<span class="ident" id="4420411">z</span><br>
<span class="lineno"></span><span class="op" id="4420413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="4420416">func</span>&nbsp;<span class="op" id="4420421">(</span><span class="ident" id="4420422">z</span>&nbsp;<span class="ident" id="4420424">nat</span><span class="op" id="4420427">)</span>&nbsp;<span class="ident" id="4420429">set</span><span class="op" id="4420432">(</span><span class="ident" id="4420433">x</span>&nbsp;<span class="ident" id="4420435">nat</span><span class="op" id="4420438">)</span>&nbsp;<span class="ident" id="4420440">nat</span>&nbsp;<span class="op" id="4420444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420447">z</span>&nbsp;<span class="op" id="4420449">=</span>&nbsp;<span class="ident" id="4420451">z</span><span class="op" id="4420452">.</span><span class="builtinfunc" id="4420453">make</span><span class="op" id="4420457">(</span><span class="builtinfunc" id="4420458">len</span><span class="op" id="4420461">(</span><span class="ident" id="4420462">x</span><span class="op" id="4420463">)</span><span class="op" id="4420464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4420467">copy</span><span class="op" id="4420471">(</span><span class="ident" id="4420472">z</span><span class="op" id="4420473">,</span>&nbsp;<span class="ident" id="4420475">x</span><span class="op" id="4420476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420479">return</span>&nbsp;<span class="ident" id="4420486">z</span><br>
<span class="lineno"></span><span class="op" id="4420488">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="4420491">func</span>&nbsp;<span class="op" id="4420496">(</span><span class="ident" id="4420497">z</span>&nbsp;<span class="ident" id="4420499">nat</span><span class="op" id="4420502">)</span>&nbsp;<span class="ident" id="4420504">add</span><span class="op" id="4420507">(</span><span class="ident" id="4420508">x</span><span class="op" id="4420509">,</span>&nbsp;<span class="ident" id="4420511">y</span>&nbsp;<span class="ident" id="4420513">nat</span><span class="op" id="4420516">)</span>&nbsp;<span class="ident" id="4420518">nat</span>&nbsp;<span class="op" id="4420522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420525">m</span>&nbsp;<span class="op" id="4420527">:=</span>&nbsp;<span class="builtinfunc" id="4420530">len</span><span class="op" id="4420533">(</span><span class="ident" id="4420534">x</span><span class="op" id="4420535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420538">n</span>&nbsp;<span class="op" id="4420540">:=</span>&nbsp;<span class="builtinfunc" id="4420543">len</span><span class="op" id="4420546">(</span><span class="ident" id="4420547">y</span><span class="op" id="4420548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420552">switch</span>&nbsp;<span class="op" id="4420559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420562">case</span>&nbsp;<span class="ident" id="4420567">m</span>&nbsp;<span class="op" id="4420569">&lt;</span>&nbsp;<span class="ident" id="4420571">n</span><span class="op" id="4420572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420576">return</span>&nbsp;<span class="ident" id="4420583">z</span><span class="op" id="4420584">.</span><span class="ident" id="4420585">add</span><span class="op" id="4420588">(</span><span class="ident" id="4420589">y</span><span class="op" id="4420590">,</span>&nbsp;<span class="ident" id="4420592">x</span><span class="op" id="4420593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420596">case</span>&nbsp;<span class="ident" id="4420601">m</span>&nbsp;<span class="op" id="4420603">==</span>&nbsp;<span class="num" id="4420606">0</span><span class="op" id="4420607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420611">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420651">return</span>&nbsp;<span class="ident" id="4420658">z</span><span class="op" id="4420659">.</span><span class="builtinfunc" id="4420660">make</span><span class="op" id="4420664">(</span><span class="num" id="4420665">0</span><span class="op" id="4420666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420669">case</span>&nbsp;<span class="ident" id="4420674">n</span>&nbsp;<span class="op" id="4420676">==</span>&nbsp;<span class="num" id="4420679">0</span><span class="op" id="4420680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420684">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420701">return</span>&nbsp;<span class="ident" id="4420708">z</span><span class="op" id="4420709">.</span><span class="ident" id="4420710">set</span><span class="op" id="4420713">(</span><span class="ident" id="4420714">x</span><span class="op" id="4420715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420718">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420721">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420732">z</span>&nbsp;<span class="op" id="4420734">=</span>&nbsp;<span class="ident" id="4420736">z</span><span class="op" id="4420737">.</span><span class="builtinfunc" id="4420738">make</span><span class="op" id="4420742">(</span><span class="ident" id="4420743">m</span>&nbsp;<span class="op" id="4420745">+</span>&nbsp;<span class="num" id="4420747">1</span><span class="op" id="4420748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420751">c</span>&nbsp;<span class="op" id="4420753">:=</span>&nbsp;<span class="ident" id="4420756">addVV</span><span class="op" id="4420761">(</span><span class="ident" id="4420762">z</span><span class="op" id="4420763">[</span><span class="num" id="4420764">0</span><span class="op" id="4420765">:</span><span class="ident" id="4420766">n</span><span class="op" id="4420767">]</span><span class="op" id="4420768">,</span>&nbsp;<span class="ident" id="4420770">x</span><span class="op" id="4420771">,</span>&nbsp;<span class="ident" id="4420773">y</span><span class="op" id="4420774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420777">if</span>&nbsp;<span class="ident" id="4420780">m</span>&nbsp;<span class="op" id="4420782">&gt;</span>&nbsp;<span class="ident" id="4420784">n</span>&nbsp;<span class="op" id="4420786">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420790">c</span>&nbsp;<span class="op" id="4420792">=</span>&nbsp;<span class="ident" id="4420794">addVW</span><span class="op" id="4420799">(</span><span class="ident" id="4420800">z</span><span class="op" id="4420801">[</span><span class="ident" id="4420802">n</span><span class="op" id="4420803">:</span><span class="ident" id="4420804">m</span><span class="op" id="4420805">]</span><span class="op" id="4420806">,</span>&nbsp;<span class="ident" id="4420808">x</span><span class="op" id="4420809">[</span><span class="ident" id="4420810">n</span><span class="op" id="4420811">:</span><span class="op" id="4420812">]</span><span class="op" id="4420813">,</span>&nbsp;<span class="ident" id="4420815">c</span><span class="op" id="4420816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420822">z</span><span class="op" id="4420823">[</span><span class="ident" id="4420824">m</span><span class="op" id="4420825">]</span>&nbsp;<span class="op" id="4420827">=</span>&nbsp;<span class="ident" id="4420829">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420833">return</span>&nbsp;<span class="ident" id="4420840">z</span><span class="op" id="4420841">.</span><span class="ident" id="4420842">norm</span><span class="op" id="4420846">(</span><span class="op" id="4420847">)</span><br>
<span class="lineno">140</span><span class="op" id="4420849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4420852">func</span>&nbsp;<span class="op" id="4420857">(</span><span class="ident" id="4420858">z</span>&nbsp;<span class="ident" id="4420860">nat</span><span class="op" id="4420863">)</span>&nbsp;<span class="ident" id="4420865">sub</span><span class="op" id="4420868">(</span><span class="ident" id="4420869">x</span><span class="op" id="4420870">,</span>&nbsp;<span class="ident" id="4420872">y</span>&nbsp;<span class="ident" id="4420874">nat</span><span class="op" id="4420877">)</span>&nbsp;<span class="ident" id="4420879">nat</span>&nbsp;<span class="op" id="4420883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420886">m</span>&nbsp;<span class="op" id="4420888">:=</span>&nbsp;<span class="builtinfunc" id="4420891">len</span><span class="op" id="4420894">(</span><span class="ident" id="4420895">x</span><span class="op" id="4420896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420899">n</span>&nbsp;<span class="op" id="4420901">:=</span>&nbsp;<span class="builtinfunc" id="4420904">len</span><span class="op" id="4420907">(</span><span class="ident" id="4420908">y</span><span class="op" id="4420909">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420913">switch</span>&nbsp;<span class="op" id="4420920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420923">case</span>&nbsp;<span class="ident" id="4420928">m</span>&nbsp;<span class="op" id="4420930">&lt;</span>&nbsp;<span class="ident" id="4420932">n</span><span class="op" id="4420933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4420937">panic</span><span class="op" id="4420942">(</span><span class="string" id="4420943">&#34;underflow&#34;</span><span class="op" id="4420954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420957">case</span>&nbsp;<span class="ident" id="4420962">m</span>&nbsp;<span class="op" id="4420964">==</span>&nbsp;<span class="num" id="4420967">0</span><span class="op" id="4420968">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420972">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421012">return</span>&nbsp;<span class="ident" id="4421019">z</span><span class="op" id="4421020">.</span><span class="builtinfunc" id="4421021">make</span><span class="op" id="4421025">(</span><span class="num" id="4421026">0</span><span class="op" id="4421027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421030">case</span>&nbsp;<span class="ident" id="4421035">n</span>&nbsp;<span class="op" id="4421037">==</span>&nbsp;<span class="num" id="4421040">0</span><span class="op" id="4421041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421045">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421062">return</span>&nbsp;<span class="ident" id="4421069">z</span><span class="op" id="4421070">.</span><span class="ident" id="4421071">set</span><span class="op" id="4421074">(</span><span class="ident" id="4421075">x</span><span class="op" id="4421076">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421082">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421093">z</span>&nbsp;<span class="op" id="4421095">=</span>&nbsp;<span class="ident" id="4421097">z</span><span class="op" id="4421098">.</span><span class="builtinfunc" id="4421099">make</span><span class="op" id="4421103">(</span><span class="ident" id="4421104">m</span><span class="op" id="4421105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421108">c</span>&nbsp;<span class="op" id="4421110">:=</span>&nbsp;<span class="ident" id="4421113">subVV</span><span class="op" id="4421118">(</span><span class="ident" id="4421119">z</span><span class="op" id="4421120">[</span><span class="num" id="4421121">0</span><span class="op" id="4421122">:</span><span class="ident" id="4421123">n</span><span class="op" id="4421124">]</span><span class="op" id="4421125">,</span>&nbsp;<span class="ident" id="4421127">x</span><span class="op" id="4421128">,</span>&nbsp;<span class="ident" id="4421130">y</span><span class="op" id="4421131">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421134">if</span>&nbsp;<span class="ident" id="4421137">m</span>&nbsp;<span class="op" id="4421139">&gt;</span>&nbsp;<span class="ident" id="4421141">n</span>&nbsp;<span class="op" id="4421143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421147">c</span>&nbsp;<span class="op" id="4421149">=</span>&nbsp;<span class="ident" id="4421151">subVW</span><span class="op" id="4421156">(</span><span class="ident" id="4421157">z</span><span class="op" id="4421158">[</span><span class="ident" id="4421159">n</span><span class="op" id="4421160">:</span><span class="op" id="4421161">]</span><span class="op" id="4421162">,</span>&nbsp;<span class="ident" id="4421164">x</span><span class="op" id="4421165">[</span><span class="ident" id="4421166">n</span><span class="op" id="4421167">:</span><span class="op" id="4421168">]</span><span class="op" id="4421169">,</span>&nbsp;<span class="ident" id="4421171">c</span><span class="op" id="4421172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421178">if</span>&nbsp;<span class="ident" id="4421181">c</span>&nbsp;<span class="op" id="4421183">!=</span>&nbsp;<span class="num" id="4421186">0</span>&nbsp;<span class="op" id="4421188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4421192">panic</span><span class="op" id="4421197">(</span><span class="string" id="4421198">&#34;underflow&#34;</span><span class="op" id="4421209">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421216">return</span>&nbsp;<span class="ident" id="4421223">z</span><span class="op" id="4421224">.</span><span class="ident" id="4421225">norm</span><span class="op" id="4421229">(</span><span class="op" id="4421230">)</span><br>
<span class="lineno"></span><span class="op" id="4421232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4421235">func</span>&nbsp;<span class="op" id="4421240">(</span><span class="ident" id="4421241">x</span>&nbsp;<span class="ident" id="4421243">nat</span><span class="op" id="4421246">)</span>&nbsp;<span class="ident" id="4421248">cmp</span><span class="op" id="4421251">(</span><span class="ident" id="4421252">y</span>&nbsp;<span class="ident" id="4421254">nat</span><span class="op" id="4421257">)</span>&nbsp;<span class="op" id="4421259">(</span><span class="ident" id="4421260">r</span>&nbsp;<span class="builtintype" id="4421262">int</span><span class="op" id="4421265">)</span>&nbsp;<span class="op" id="4421267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421270">m</span>&nbsp;<span class="op" id="4421272">:=</span>&nbsp;<span class="builtinfunc" id="4421275">len</span><span class="op" id="4421278">(</span><span class="ident" id="4421279">x</span><span class="op" id="4421280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421283">n</span>&nbsp;<span class="op" id="4421285">:=</span>&nbsp;<span class="builtinfunc" id="4421288">len</span><span class="op" id="4421291">(</span><span class="ident" id="4421292">y</span><span class="op" id="4421293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421296">if</span>&nbsp;<span class="ident" id="4421299">m</span>&nbsp;<span class="op" id="4421301">!=</span>&nbsp;<span class="ident" id="4421304">n</span>&nbsp;<span class="op" id="4421306">||</span>&nbsp;<span class="ident" id="4421309">m</span>&nbsp;<span class="op" id="4421311">==</span>&nbsp;<span class="num" id="4421314">0</span>&nbsp;<span class="op" id="4421316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421320">switch</span>&nbsp;<span class="op" id="4421327">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421331">case</span>&nbsp;<span class="ident" id="4421336">m</span>&nbsp;<span class="op" id="4421338">&lt;</span>&nbsp;<span class="ident" id="4421340">n</span><span class="op" id="4421341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421346">r</span>&nbsp;<span class="op" id="4421348">=</span>&nbsp;<span class="op" id="4421350">-</span><span class="num" id="4421351">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421355">case</span>&nbsp;<span class="ident" id="4421360">m</span>&nbsp;<span class="op" id="4421362">&gt;</span>&nbsp;<span class="ident" id="4421364">n</span><span class="op" id="4421365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421370">r</span>&nbsp;<span class="op" id="4421372">=</span>&nbsp;<span class="num" id="4421374">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421378">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421382">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421394">i</span>&nbsp;<span class="op" id="4421396">:=</span>&nbsp;<span class="ident" id="4421399">m</span>&nbsp;<span class="op" id="4421401">-</span>&nbsp;<span class="num" id="4421403">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421406">for</span>&nbsp;<span class="ident" id="4421410">i</span>&nbsp;<span class="op" id="4421412">&gt;</span>&nbsp;<span class="num" id="4421414">0</span>&nbsp;<span class="op" id="4421416">&amp;&amp;</span>&nbsp;<span class="ident" id="4421419">x</span><span class="op" id="4421420">[</span><span class="ident" id="4421421">i</span><span class="op" id="4421422">]</span>&nbsp;<span class="op" id="4421424">==</span>&nbsp;<span class="ident" id="4421427">y</span><span class="op" id="4421428">[</span><span class="ident" id="4421429">i</span><span class="op" id="4421430">]</span>&nbsp;<span class="op" id="4421432">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421436">i</span><span class="op" id="4421437">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421445">switch</span>&nbsp;<span class="op" id="4421452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421455">case</span>&nbsp;<span class="ident" id="4421460">x</span><span class="op" id="4421461">[</span><span class="ident" id="4421462">i</span><span class="op" id="4421463">]</span>&nbsp;<span class="op" id="4421465">&lt;</span>&nbsp;<span class="ident" id="4421467">y</span><span class="op" id="4421468">[</span><span class="ident" id="4421469">i</span><span class="op" id="4421470">]</span><span class="op" id="4421471">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421475">r</span>&nbsp;<span class="op" id="4421477">=</span>&nbsp;<span class="op" id="4421479">-</span><span class="num" id="4421480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421483">case</span>&nbsp;<span class="ident" id="4421488">x</span><span class="op" id="4421489">[</span><span class="ident" id="4421490">i</span><span class="op" id="4421491">]</span>&nbsp;<span class="op" id="4421493">&gt;</span>&nbsp;<span class="ident" id="4421495">y</span><span class="op" id="4421496">[</span><span class="ident" id="4421497">i</span><span class="op" id="4421498">]</span><span class="op" id="4421499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421503">r</span>&nbsp;<span class="op" id="4421505">=</span>&nbsp;<span class="num" id="4421507">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421513">return</span><br>
<span class="lineno">195</span><span class="op" id="4421520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4421523">func</span>&nbsp;<span class="op" id="4421528">(</span><span class="ident" id="4421529">z</span>&nbsp;<span class="ident" id="4421531">nat</span><span class="op" id="4421534">)</span>&nbsp;<span class="ident" id="4421536">mulAddWW</span><span class="op" id="4421544">(</span><span class="ident" id="4421545">x</span>&nbsp;<span class="ident" id="4421547">nat</span><span class="op" id="4421550">,</span>&nbsp;<span class="ident" id="4421552">y</span><span class="op" id="4421553">,</span>&nbsp;<span class="ident" id="4421555">r</span>&nbsp;<span class="ident" id="4421557">Word</span><span class="op" id="4421561">)</span>&nbsp;<span class="ident" id="4421563">nat</span>&nbsp;<span class="op" id="4421567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421570">m</span>&nbsp;<span class="op" id="4421572">:=</span>&nbsp;<span class="builtinfunc" id="4421575">len</span><span class="op" id="4421578">(</span><span class="ident" id="4421579">x</span><span class="op" id="4421580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421583">if</span>&nbsp;<span class="ident" id="4421586">m</span>&nbsp;<span class="op" id="4421588">==</span>&nbsp;<span class="num" id="4421591">0</span>&nbsp;<span class="op" id="4421593">||</span>&nbsp;<span class="ident" id="4421596">y</span>&nbsp;<span class="op" id="4421598">==</span>&nbsp;<span class="num" id="4421601">0</span>&nbsp;<span class="op" id="4421603">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421607">return</span>&nbsp;<span class="ident" id="4421614">z</span><span class="op" id="4421615">.</span><span class="ident" id="4421616">setWord</span><span class="op" id="4421623">(</span><span class="ident" id="4421624">r</span><span class="op" id="4421625">)</span>&nbsp;<span class="comment" id="4421627">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421646">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421657">z</span>&nbsp;<span class="op" id="4421659">=</span>&nbsp;<span class="ident" id="4421661">z</span><span class="op" id="4421662">.</span><span class="builtinfunc" id="4421663">make</span><span class="op" id="4421667">(</span><span class="ident" id="4421668">m</span>&nbsp;<span class="op" id="4421670">+</span>&nbsp;<span class="num" id="4421672">1</span><span class="op" id="4421673">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421676">z</span><span class="op" id="4421677">[</span><span class="ident" id="4421678">m</span><span class="op" id="4421679">]</span>&nbsp;<span class="op" id="4421681">=</span>&nbsp;<span class="ident" id="4421683">mulAddVWW</span><span class="op" id="4421692">(</span><span class="ident" id="4421693">z</span><span class="op" id="4421694">[</span><span class="num" id="4421695">0</span><span class="op" id="4421696">:</span><span class="ident" id="4421697">m</span><span class="op" id="4421698">]</span><span class="op" id="4421699">,</span>&nbsp;<span class="ident" id="4421701">x</span><span class="op" id="4421702">,</span>&nbsp;<span class="ident" id="4421704">y</span><span class="op" id="4421705">,</span>&nbsp;<span class="ident" id="4421707">r</span><span class="op" id="4421708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421712">return</span>&nbsp;<span class="ident" id="4421719">z</span><span class="op" id="4421720">.</span><span class="ident" id="4421721">norm</span><span class="op" id="4421725">(</span><span class="op" id="4421726">)</span><br>
<span class="lineno"></span><span class="op" id="4421728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="4421731">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4421790">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="4421858">func</span>&nbsp;<span class="ident" id="4421863">basicMul</span><span class="op" id="4421871">(</span><span class="ident" id="4421872">z</span><span class="op" id="4421873">,</span>&nbsp;<span class="ident" id="4421875">x</span><span class="op" id="4421876">,</span>&nbsp;<span class="ident" id="4421878">y</span>&nbsp;<span class="ident" id="4421880">nat</span><span class="op" id="4421883">)</span>&nbsp;<span class="op" id="4421885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421888">z</span><span class="op" id="4421889">[</span><span class="num" id="4421890">0</span>&nbsp;<span class="op" id="4421892">:</span>&nbsp;<span class="builtinfunc" id="4421894">len</span><span class="op" id="4421897">(</span><span class="ident" id="4421898">x</span><span class="op" id="4421899">)</span><span class="op" id="4421900">+</span><span class="builtinfunc" id="4421901">len</span><span class="op" id="4421904">(</span><span class="ident" id="4421905">y</span><span class="op" id="4421906">)</span><span class="op" id="4421907">]</span><span class="op" id="4421908">.</span><span class="ident" id="4421909">clear</span><span class="op" id="4421914">(</span><span class="op" id="4421915">)</span>&nbsp;<span class="comment" id="4421917">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421934">for</span>&nbsp;<span class="ident" id="4421938">i</span><span class="op" id="4421939">,</span>&nbsp;<span class="ident" id="4421941">d</span>&nbsp;<span class="op" id="4421943">:=</span>&nbsp;<span class="keyword" id="4421946">range</span>&nbsp;<span class="ident" id="4421952">y</span>&nbsp;<span class="op" id="4421954">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421958">if</span>&nbsp;<span class="ident" id="4421961">d</span>&nbsp;<span class="op" id="4421963">!=</span>&nbsp;<span class="num" id="4421966">0</span>&nbsp;<span class="op" id="4421968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421973">z</span><span class="op" id="4421974">[</span><span class="builtinfunc" id="4421975">len</span><span class="op" id="4421978">(</span><span class="ident" id="4421979">x</span><span class="op" id="4421980">)</span><span class="op" id="4421981">+</span><span class="ident" id="4421982">i</span><span class="op" id="4421983">]</span>&nbsp;<span class="op" id="4421985">=</span>&nbsp;<span class="ident" id="4421987">addMulVVW</span><span class="op" id="4421996">(</span><span class="ident" id="4421997">z</span><span class="op" id="4421998">[</span><span class="ident" id="4421999">i</span><span class="op" id="4422000">:</span><span class="ident" id="4422001">i</span><span class="op" id="4422002">+</span><span class="builtinfunc" id="4422003">len</span><span class="op" id="4422006">(</span><span class="ident" id="4422007">x</span><span class="op" id="4422008">)</span><span class="op" id="4422009">]</span><span class="op" id="4422010">,</span>&nbsp;<span class="ident" id="4422012">x</span><span class="op" id="4422013">,</span>&nbsp;<span class="ident" id="4422015">d</span><span class="op" id="4422016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422023">}</span><br>
<span class="lineno"></span><span class="op" id="4422025">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4422028">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="4422103">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="4422167">func</span>&nbsp;<span class="ident" id="4422172">karatsubaAdd</span><span class="op" id="4422184">(</span><span class="ident" id="4422185">z</span><span class="op" id="4422186">,</span>&nbsp;<span class="ident" id="4422188">x</span>&nbsp;<span class="ident" id="4422190">nat</span><span class="op" id="4422193">,</span>&nbsp;<span class="ident" id="4422195">n</span>&nbsp;<span class="builtintype" id="4422197">int</span><span class="op" id="4422200">)</span>&nbsp;<span class="op" id="4422202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422205">if</span>&nbsp;<span class="ident" id="4422208">c</span>&nbsp;<span class="op" id="4422210">:=</span>&nbsp;<span class="ident" id="4422213">addVV</span><span class="op" id="4422218">(</span><span class="ident" id="4422219">z</span><span class="op" id="4422220">[</span><span class="num" id="4422221">0</span><span class="op" id="4422222">:</span><span class="ident" id="4422223">n</span><span class="op" id="4422224">]</span><span class="op" id="4422225">,</span>&nbsp;<span class="ident" id="4422227">z</span><span class="op" id="4422228">,</span>&nbsp;<span class="ident" id="4422230">x</span><span class="op" id="4422231">)</span><span class="op" id="4422232">;</span>&nbsp;<span class="ident" id="4422234">c</span>&nbsp;<span class="op" id="4422236">!=</span>&nbsp;<span class="num" id="4422239">0</span>&nbsp;<span class="op" id="4422241">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422245">addVW</span><span class="op" id="4422250">(</span><span class="ident" id="4422251">z</span><span class="op" id="4422252">[</span><span class="ident" id="4422253">n</span><span class="op" id="4422254">:</span><span class="ident" id="4422255">n</span><span class="op" id="4422256">+</span><span class="ident" id="4422257">n</span><span class="op" id="4422258">&gt;&gt;</span><span class="num" id="4422260">1</span><span class="op" id="4422261">]</span><span class="op" id="4422262">,</span>&nbsp;<span class="ident" id="4422264">z</span><span class="op" id="4422265">[</span><span class="ident" id="4422266">n</span><span class="op" id="4422267">:</span><span class="op" id="4422268">]</span><span class="op" id="4422269">,</span>&nbsp;<span class="ident" id="4422271">c</span><span class="op" id="4422272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422275">}</span><br>
<span class="lineno"></span><span class="op" id="4422277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4422280">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="4422321">func</span>&nbsp;<span class="ident" id="4422326">karatsubaSub</span><span class="op" id="4422338">(</span><span class="ident" id="4422339">z</span><span class="op" id="4422340">,</span>&nbsp;<span class="ident" id="4422342">x</span>&nbsp;<span class="ident" id="4422344">nat</span><span class="op" id="4422347">,</span>&nbsp;<span class="ident" id="4422349">n</span>&nbsp;<span class="builtintype" id="4422351">int</span><span class="op" id="4422354">)</span>&nbsp;<span class="op" id="4422356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422359">if</span>&nbsp;<span class="ident" id="4422362">c</span>&nbsp;<span class="op" id="4422364">:=</span>&nbsp;<span class="ident" id="4422367">subVV</span><span class="op" id="4422372">(</span><span class="ident" id="4422373">z</span><span class="op" id="4422374">[</span><span class="num" id="4422375">0</span><span class="op" id="4422376">:</span><span class="ident" id="4422377">n</span><span class="op" id="4422378">]</span><span class="op" id="4422379">,</span>&nbsp;<span class="ident" id="4422381">z</span><span class="op" id="4422382">,</span>&nbsp;<span class="ident" id="4422384">x</span><span class="op" id="4422385">)</span><span class="op" id="4422386">;</span>&nbsp;<span class="ident" id="4422388">c</span>&nbsp;<span class="op" id="4422390">!=</span>&nbsp;<span class="num" id="4422393">0</span>&nbsp;<span class="op" id="4422395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422399">subVW</span><span class="op" id="4422404">(</span><span class="ident" id="4422405">z</span><span class="op" id="4422406">[</span><span class="ident" id="4422407">n</span><span class="op" id="4422408">:</span><span class="ident" id="4422409">n</span><span class="op" id="4422410">+</span><span class="ident" id="4422411">n</span><span class="op" id="4422412">&gt;&gt;</span><span class="num" id="4422414">1</span><span class="op" id="4422415">]</span><span class="op" id="4422416">,</span>&nbsp;<span class="ident" id="4422418">z</span><span class="op" id="4422419">[</span><span class="ident" id="4422420">n</span><span class="op" id="4422421">:</span><span class="op" id="4422422">]</span><span class="op" id="4422423">,</span>&nbsp;<span class="ident" id="4422425">c</span><span class="op" id="4422426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422429">}</span><br>
<span class="lineno"></span><span class="op" id="4422431">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="4422434">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="4422508">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="4422586">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4422598">var</span>&nbsp;<span class="ident" id="4422602">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="4422621">int</span>&nbsp;<span class="op" id="4422625">=</span>&nbsp;<span class="num" id="4422627">40</span>&nbsp;<span class="comment" id="4422630">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4422659">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4422719">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4422779">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="4422839">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="4422895">func</span>&nbsp;<span class="ident" id="4422900">karatsuba</span><span class="op" id="4422909">(</span><span class="ident" id="4422910">z</span><span class="op" id="4422911">,</span>&nbsp;<span class="ident" id="4422913">x</span><span class="op" id="4422914">,</span>&nbsp;<span class="ident" id="4422916">y</span>&nbsp;<span class="ident" id="4422918">nat</span><span class="op" id="4422921">)</span>&nbsp;<span class="op" id="4422923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422926">n</span>&nbsp;<span class="op" id="4422928">:=</span>&nbsp;<span class="builtinfunc" id="4422931">len</span><span class="op" id="4422934">(</span><span class="ident" id="4422935">y</span><span class="op" id="4422936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422940">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423004">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423064">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423082">if</span>&nbsp;<span class="ident" id="4423085">n</span><span class="op" id="4423086">&amp;</span><span class="num" id="4423087">1</span>&nbsp;<span class="op" id="4423089">!=</span>&nbsp;<span class="num" id="4423092">0</span>&nbsp;<span class="op" id="4423094">||</span>&nbsp;<span class="ident" id="4423097">n</span>&nbsp;<span class="op" id="4423099">&lt;</span>&nbsp;<span class="ident" id="4423101">karatsubaThreshold</span>&nbsp;<span class="op" id="4423120">||</span>&nbsp;<span class="ident" id="4423123">n</span>&nbsp;<span class="op" id="4423125">&lt;</span>&nbsp;<span class="num" id="4423127">2</span>&nbsp;<span class="op" id="4423129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423133">basicMul</span><span class="op" id="4423141">(</span><span class="ident" id="4423142">z</span><span class="op" id="4423143">,</span>&nbsp;<span class="ident" id="4423145">x</span><span class="op" id="4423146">,</span>&nbsp;<span class="ident" id="4423148">y</span><span class="op" id="4423149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423153">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423161">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423164">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423215">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423277">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423311">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423315">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423335">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423355">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423359">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423422">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423440">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423444">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423494">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423544">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423548">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423558">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423562">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423581">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423600">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423604">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423655">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423706">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423757">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423808">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423850">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423879">n2</span>&nbsp;<span class="op" id="4423882">:=</span>&nbsp;<span class="ident" id="4423885">n</span>&nbsp;<span class="op" id="4423887">&gt;&gt;</span>&nbsp;<span class="num" id="4423890">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4423905">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423917">x1</span><span class="op" id="4423919">,</span>&nbsp;<span class="ident" id="4423921">x0</span>&nbsp;<span class="op" id="4423924">:=</span>&nbsp;<span class="ident" id="4423927">x</span><span class="op" id="4423928">[</span><span class="ident" id="4423929">n2</span><span class="op" id="4423931">:</span><span class="op" id="4423932">]</span><span class="op" id="4423933">,</span>&nbsp;<span class="ident" id="4423935">x</span><span class="op" id="4423936">[</span><span class="num" id="4423937">0</span><span class="op" id="4423938">:</span><span class="ident" id="4423939">n2</span><span class="op" id="4423941">]</span>&nbsp;<span class="comment" id="4423943">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423961">y1</span><span class="op" id="4423963">,</span>&nbsp;<span class="ident" id="4423965">y0</span>&nbsp;<span class="op" id="4423968">:=</span>&nbsp;<span class="ident" id="4423971">y</span><span class="op" id="4423972">[</span><span class="ident" id="4423973">n2</span><span class="op" id="4423975">:</span><span class="op" id="4423976">]</span><span class="op" id="4423977">,</span>&nbsp;<span class="ident" id="4423979">y</span><span class="op" id="4423980">[</span><span class="num" id="4423981">0</span><span class="op" id="4423982">:</span><span class="ident" id="4423983">n2</span><span class="op" id="4423985">]</span>&nbsp;<span class="comment" id="4423987">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424006">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424058">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424062">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424120">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424178">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424182">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424243">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424305">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424322">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424376">karatsuba</span><span class="op" id="4424385">(</span><span class="ident" id="4424386">z</span><span class="op" id="4424387">,</span>&nbsp;<span class="ident" id="4424389">x0</span><span class="op" id="4424391">,</span>&nbsp;<span class="ident" id="4424393">y0</span><span class="op" id="4424395">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4424401">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424416">karatsuba</span><span class="op" id="4424425">(</span><span class="ident" id="4424426">z</span><span class="op" id="4424427">[</span><span class="ident" id="4424428">n</span><span class="op" id="4424429">:</span><span class="op" id="4424430">]</span><span class="op" id="4424431">,</span>&nbsp;<span class="ident" id="4424433">x1</span><span class="op" id="4424435">,</span>&nbsp;<span class="ident" id="4424437">y1</span><span class="op" id="4424439">)</span>&nbsp;<span class="comment" id="4424441">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424457">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424516">s</span>&nbsp;<span class="op" id="4424518">:=</span>&nbsp;<span class="num" id="4424521">1</span>&nbsp;<span class="comment" id="4424523">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424549">xd</span>&nbsp;<span class="op" id="4424552">:=</span>&nbsp;<span class="ident" id="4424555">z</span><span class="op" id="4424556">[</span><span class="num" id="4424557">2</span><span class="op" id="4424558">*</span><span class="ident" id="4424559">n</span>&nbsp;<span class="op" id="4424561">:</span>&nbsp;<span class="num" id="4424563">2</span><span class="op" id="4424564">*</span><span class="ident" id="4424565">n</span><span class="op" id="4424566">+</span><span class="ident" id="4424567">n2</span><span class="op" id="4424569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424572">if</span>&nbsp;<span class="ident" id="4424575">subVV</span><span class="op" id="4424580">(</span><span class="ident" id="4424581">xd</span><span class="op" id="4424583">,</span>&nbsp;<span class="ident" id="4424585">x1</span><span class="op" id="4424587">,</span>&nbsp;<span class="ident" id="4424589">x0</span><span class="op" id="4424591">)</span>&nbsp;<span class="op" id="4424593">!=</span>&nbsp;<span class="num" id="4424596">0</span>&nbsp;<span class="op" id="4424598">{</span>&nbsp;<span class="comment" id="4424600">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424611">s</span>&nbsp;<span class="op" id="4424613">=</span>&nbsp;<span class="op" id="4424615">-</span><span class="ident" id="4424616">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424620">subVV</span><span class="op" id="4424625">(</span><span class="ident" id="4424626">xd</span><span class="op" id="4424628">,</span>&nbsp;<span class="ident" id="4424630">x0</span><span class="op" id="4424632">,</span>&nbsp;<span class="ident" id="4424634">x1</span><span class="op" id="4424636">)</span>&nbsp;<span class="comment" id="4424638">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424648">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424652">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424711">yd</span>&nbsp;<span class="op" id="4424714">:=</span>&nbsp;<span class="ident" id="4424717">z</span><span class="op" id="4424718">[</span><span class="num" id="4424719">2</span><span class="op" id="4424720">*</span><span class="ident" id="4424721">n</span><span class="op" id="4424722">+</span><span class="ident" id="4424723">n2</span>&nbsp;<span class="op" id="4424726">:</span>&nbsp;<span class="num" id="4424728">3</span><span class="op" id="4424729">*</span><span class="ident" id="4424730">n</span><span class="op" id="4424731">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424734">if</span>&nbsp;<span class="ident" id="4424737">subVV</span><span class="op" id="4424742">(</span><span class="ident" id="4424743">yd</span><span class="op" id="4424745">,</span>&nbsp;<span class="ident" id="4424747">y0</span><span class="op" id="4424749">,</span>&nbsp;<span class="ident" id="4424751">y1</span><span class="op" id="4424753">)</span>&nbsp;<span class="op" id="4424755">!=</span>&nbsp;<span class="num" id="4424758">0</span>&nbsp;<span class="op" id="4424760">{</span>&nbsp;<span class="comment" id="4424762">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424773">s</span>&nbsp;<span class="op" id="4424775">=</span>&nbsp;<span class="op" id="4424777">-</span><span class="ident" id="4424778">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424782">subVV</span><span class="op" id="4424787">(</span><span class="ident" id="4424788">yd</span><span class="op" id="4424790">,</span>&nbsp;<span class="ident" id="4424792">y1</span><span class="op" id="4424794">,</span>&nbsp;<span class="ident" id="4424796">y0</span><span class="op" id="4424798">)</span>&nbsp;<span class="comment" id="4424800">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424814">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424881">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424948">p</span>&nbsp;<span class="op" id="4424950">:=</span>&nbsp;<span class="ident" id="4424953">z</span><span class="op" id="4424954">[</span><span class="ident" id="4424955">n</span><span class="op" id="4424956">*</span><span class="num" id="4424957">3</span><span class="op" id="4424958">:</span><span class="op" id="4424959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424962">karatsuba</span><span class="op" id="4424971">(</span><span class="ident" id="4424972">p</span><span class="op" id="4424973">,</span>&nbsp;<span class="ident" id="4424975">xd</span><span class="op" id="4424977">,</span>&nbsp;<span class="ident" id="4424979">yd</span><span class="op" id="4424981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424985">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425009">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425068">r</span>&nbsp;<span class="op" id="4425070">:=</span>&nbsp;<span class="ident" id="4425073">z</span><span class="op" id="4425074">[</span><span class="ident" id="4425075">n</span><span class="op" id="4425076">*</span><span class="num" id="4425077">4</span><span class="op" id="4425078">:</span><span class="op" id="4425079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4425082">copy</span><span class="op" id="4425086">(</span><span class="ident" id="4425087">r</span><span class="op" id="4425088">,</span>&nbsp;<span class="ident" id="4425090">z</span><span class="op" id="4425091">[</span><span class="op" id="4425092">:</span><span class="ident" id="4425093">n</span><span class="op" id="4425094">*</span><span class="num" id="4425095">2</span><span class="op" id="4425096">]</span><span class="op" id="4425097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425101">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425133">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425137">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425159">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425181">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425200">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425219">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425238">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425242">karatsubaAdd</span><span class="op" id="4425254">(</span><span class="ident" id="4425255">z</span><span class="op" id="4425256">[</span><span class="ident" id="4425257">n2</span><span class="op" id="4425259">:</span><span class="op" id="4425260">]</span><span class="op" id="4425261">,</span>&nbsp;<span class="ident" id="4425263">r</span><span class="op" id="4425264">,</span>&nbsp;<span class="ident" id="4425266">n</span><span class="op" id="4425267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425270">karatsubaAdd</span><span class="op" id="4425282">(</span><span class="ident" id="4425283">z</span><span class="op" id="4425284">[</span><span class="ident" id="4425285">n2</span><span class="op" id="4425287">:</span><span class="op" id="4425288">]</span><span class="op" id="4425289">,</span>&nbsp;<span class="ident" id="4425291">r</span><span class="op" id="4425292">[</span><span class="ident" id="4425293">n</span><span class="op" id="4425294">:</span><span class="op" id="4425295">]</span><span class="op" id="4425296">,</span>&nbsp;<span class="ident" id="4425298">n</span><span class="op" id="4425299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425302">if</span>&nbsp;<span class="ident" id="4425305">s</span>&nbsp;<span class="op" id="4425307">&gt;</span>&nbsp;<span class="num" id="4425309">0</span>&nbsp;<span class="op" id="4425311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425315">karatsubaAdd</span><span class="op" id="4425327">(</span><span class="ident" id="4425328">z</span><span class="op" id="4425329">[</span><span class="ident" id="4425330">n2</span><span class="op" id="4425332">:</span><span class="op" id="4425333">]</span><span class="op" id="4425334">,</span>&nbsp;<span class="ident" id="4425336">p</span><span class="op" id="4425337">,</span>&nbsp;<span class="ident" id="4425339">n</span><span class="op" id="4425340">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425343">}</span>&nbsp;<span class="keyword" id="4425345">else</span>&nbsp;<span class="op" id="4425350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425354">karatsubaSub</span><span class="op" id="4425366">(</span><span class="ident" id="4425367">z</span><span class="op" id="4425368">[</span><span class="ident" id="4425369">n2</span><span class="op" id="4425371">:</span><span class="op" id="4425372">]</span><span class="op" id="4425373">,</span>&nbsp;<span class="ident" id="4425375">p</span><span class="op" id="4425376">,</span>&nbsp;<span class="ident" id="4425378">n</span><span class="op" id="4425379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425382">}</span><br>
<span class="lineno"></span><span class="op" id="4425384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="4425387">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="4425447">func</span>&nbsp;<span class="ident" id="4425452">alias</span><span class="op" id="4425457">(</span><span class="ident" id="4425458">x</span><span class="op" id="4425459">,</span>&nbsp;<span class="ident" id="4425461">y</span>&nbsp;<span class="ident" id="4425463">nat</span><span class="op" id="4425466">)</span>&nbsp;<span class="builtintype" id="4425468">bool</span>&nbsp;<span class="op" id="4425473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425476">return</span>&nbsp;<span class="builtinfunc" id="4425483">cap</span><span class="op" id="4425486">(</span><span class="ident" id="4425487">x</span><span class="op" id="4425488">)</span>&nbsp;<span class="op" id="4425490">&gt;</span>&nbsp;<span class="num" id="4425492">0</span>&nbsp;<span class="op" id="4425494">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4425497">cap</span><span class="op" id="4425500">(</span><span class="ident" id="4425501">y</span><span class="op" id="4425502">)</span>&nbsp;<span class="op" id="4425504">&gt;</span>&nbsp;<span class="num" id="4425506">0</span>&nbsp;<span class="op" id="4425508">&amp;&amp;</span>&nbsp;<span class="op" id="4425511">&amp;</span><span class="ident" id="4425512">x</span><span class="op" id="4425513">[</span><span class="num" id="4425514">0</span><span class="op" id="4425515">:</span><span class="builtinfunc" id="4425516">cap</span><span class="op" id="4425519">(</span><span class="ident" id="4425520">x</span><span class="op" id="4425521">)</span><span class="op" id="4425522">]</span><span class="op" id="4425523">[</span><span class="builtinfunc" id="4425524">cap</span><span class="op" id="4425527">(</span><span class="ident" id="4425528">x</span><span class="op" id="4425529">)</span><span class="op" id="4425530">-</span><span class="num" id="4425531">1</span><span class="op" id="4425532">]</span>&nbsp;<span class="op" id="4425534">==</span>&nbsp;<span class="op" id="4425537">&amp;</span><span class="ident" id="4425538">y</span><span class="op" id="4425539">[</span><span class="num" id="4425540">0</span><span class="op" id="4425541">:</span><span class="builtinfunc" id="4425542">cap</span><span class="op" id="4425545">(</span><span class="ident" id="4425546">y</span><span class="op" id="4425547">)</span><span class="op" id="4425548">]</span><span class="op" id="4425549">[</span><span class="builtinfunc" id="4425550">cap</span><span class="op" id="4425553">(</span><span class="ident" id="4425554">y</span><span class="op" id="4425555">)</span><span class="op" id="4425556">-</span><span class="num" id="4425557">1</span><span class="op" id="4425558">]</span><br>
<span class="lineno"></span><span class="op" id="4425560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="4425563">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="4425622">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4425682">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="4425746">func</span>&nbsp;<span class="ident" id="4425751">addAt</span><span class="op" id="4425756">(</span><span class="ident" id="4425757">z</span><span class="op" id="4425758">,</span>&nbsp;<span class="ident" id="4425760">x</span>&nbsp;<span class="ident" id="4425762">nat</span><span class="op" id="4425765">,</span>&nbsp;<span class="ident" id="4425767">i</span>&nbsp;<span class="builtintype" id="4425769">int</span><span class="op" id="4425772">)</span>&nbsp;<span class="op" id="4425774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425777">if</span>&nbsp;<span class="ident" id="4425780">n</span>&nbsp;<span class="op" id="4425782">:=</span>&nbsp;<span class="builtinfunc" id="4425785">len</span><span class="op" id="4425788">(</span><span class="ident" id="4425789">x</span><span class="op" id="4425790">)</span><span class="op" id="4425791">;</span>&nbsp;<span class="ident" id="4425793">n</span>&nbsp;<span class="op" id="4425795">&gt;</span>&nbsp;<span class="num" id="4425797">0</span>&nbsp;<span class="op" id="4425799">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425803">if</span>&nbsp;<span class="ident" id="4425806">c</span>&nbsp;<span class="op" id="4425808">:=</span>&nbsp;<span class="ident" id="4425811">addVV</span><span class="op" id="4425816">(</span><span class="ident" id="4425817">z</span><span class="op" id="4425818">[</span><span class="ident" id="4425819">i</span><span class="op" id="4425820">:</span><span class="ident" id="4425821">i</span><span class="op" id="4425822">+</span><span class="ident" id="4425823">n</span><span class="op" id="4425824">]</span><span class="op" id="4425825">,</span>&nbsp;<span class="ident" id="4425827">z</span><span class="op" id="4425828">[</span><span class="ident" id="4425829">i</span><span class="op" id="4425830">:</span><span class="op" id="4425831">]</span><span class="op" id="4425832">,</span>&nbsp;<span class="ident" id="4425834">x</span><span class="op" id="4425835">)</span><span class="op" id="4425836">;</span>&nbsp;<span class="ident" id="4425838">c</span>&nbsp;<span class="op" id="4425840">!=</span>&nbsp;<span class="num" id="4425843">0</span>&nbsp;<span class="op" id="4425845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425850">j</span>&nbsp;<span class="op" id="4425852">:=</span>&nbsp;<span class="ident" id="4425855">i</span>&nbsp;<span class="op" id="4425857">+</span>&nbsp;<span class="ident" id="4425859">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425864">if</span>&nbsp;<span class="ident" id="4425867">j</span>&nbsp;<span class="op" id="4425869">&lt;</span>&nbsp;<span class="builtinfunc" id="4425871">len</span><span class="op" id="4425874">(</span><span class="ident" id="4425875">z</span><span class="op" id="4425876">)</span>&nbsp;<span class="op" id="4425878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425884">addVW</span><span class="op" id="4425889">(</span><span class="ident" id="4425890">z</span><span class="op" id="4425891">[</span><span class="ident" id="4425892">j</span><span class="op" id="4425893">:</span><span class="op" id="4425894">]</span><span class="op" id="4425895">,</span>&nbsp;<span class="ident" id="4425897">z</span><span class="op" id="4425898">[</span><span class="ident" id="4425899">j</span><span class="op" id="4425900">:</span><span class="op" id="4425901">]</span><span class="op" id="4425902">,</span>&nbsp;<span class="ident" id="4425904">c</span><span class="op" id="4425905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425910">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425917">}</span><br>
<span class="lineno"></span><span class="op" id="4425919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4425922">func</span>&nbsp;<span class="ident" id="4425927">max</span><span class="op" id="4425930">(</span><span class="ident" id="4425931">x</span><span class="op" id="4425932">,</span>&nbsp;<span class="ident" id="4425934">y</span>&nbsp;<span class="builtintype" id="4425936">int</span><span class="op" id="4425939">)</span>&nbsp;<span class="builtintype" id="4425941">int</span>&nbsp;<span class="op" id="4425945">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425948">if</span>&nbsp;<span class="ident" id="4425951">x</span>&nbsp;<span class="op" id="4425953">&gt;</span>&nbsp;<span class="ident" id="4425955">y</span>&nbsp;<span class="op" id="4425957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425961">return</span>&nbsp;<span class="ident" id="4425968">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425974">return</span>&nbsp;<span class="ident" id="4425981">y</span><br>
<span class="lineno"></span><span class="op" id="4425983">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="4425986">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4426060">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4426134">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4426209">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="4426260">func</span>&nbsp;<span class="ident" id="4426265">karatsubaLen</span><span class="op" id="4426277">(</span><span class="ident" id="4426278">n</span>&nbsp;<span class="builtintype" id="4426280">int</span><span class="op" id="4426283">)</span>&nbsp;<span class="builtintype" id="4426285">int</span>&nbsp;<span class="op" id="4426289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426292">i</span>&nbsp;<span class="op" id="4426294">:=</span>&nbsp;<span class="builtintype" id="4426297">uint</span><span class="op" id="4426301">(</span><span class="num" id="4426302">0</span><span class="op" id="4426303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426306">for</span>&nbsp;<span class="ident" id="4426310">n</span>&nbsp;<span class="op" id="4426312">&gt;</span>&nbsp;<span class="ident" id="4426314">karatsubaThreshold</span>&nbsp;<span class="op" id="4426333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426337">n</span>&nbsp;<span class="op" id="4426339">&gt;&gt;=</span>&nbsp;<span class="num" id="4426343">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426347">i</span><span class="op" id="4426348">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426355">return</span>&nbsp;<span class="ident" id="4426362">n</span>&nbsp;<span class="op" id="4426364">&lt;&lt;</span>&nbsp;<span class="ident" id="4426367">i</span><br>
<span class="lineno"></span><span class="op" id="4426369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4426372">func</span>&nbsp;<span class="op" id="4426377">(</span><span class="ident" id="4426378">z</span>&nbsp;<span class="ident" id="4426380">nat</span><span class="op" id="4426383">)</span>&nbsp;<span class="ident" id="4426385">mul</span><span class="op" id="4426388">(</span><span class="ident" id="4426389">x</span><span class="op" id="4426390">,</span>&nbsp;<span class="ident" id="4426392">y</span>&nbsp;<span class="ident" id="4426394">nat</span><span class="op" id="4426397">)</span>&nbsp;<span class="ident" id="4426399">nat</span>&nbsp;<span class="op" id="4426403">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426406">m</span>&nbsp;<span class="op" id="4426408">:=</span>&nbsp;<span class="builtinfunc" id="4426411">len</span><span class="op" id="4426414">(</span><span class="ident" id="4426415">x</span><span class="op" id="4426416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426419">n</span>&nbsp;<span class="op" id="4426421">:=</span>&nbsp;<span class="builtinfunc" id="4426424">len</span><span class="op" id="4426427">(</span><span class="ident" id="4426428">y</span><span class="op" id="4426429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426433">switch</span>&nbsp;<span class="op" id="4426440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426443">case</span>&nbsp;<span class="ident" id="4426448">m</span>&nbsp;<span class="op" id="4426450">&lt;</span>&nbsp;<span class="ident" id="4426452">n</span><span class="op" id="4426453">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426457">return</span>&nbsp;<span class="ident" id="4426464">z</span><span class="op" id="4426465">.</span><span class="ident" id="4426466">mul</span><span class="op" id="4426469">(</span><span class="ident" id="4426470">y</span><span class="op" id="4426471">,</span>&nbsp;<span class="ident" id="4426473">x</span><span class="op" id="4426474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426477">case</span>&nbsp;<span class="ident" id="4426482">m</span>&nbsp;<span class="op" id="4426484">==</span>&nbsp;<span class="num" id="4426487">0</span>&nbsp;<span class="op" id="4426489">||</span>&nbsp;<span class="ident" id="4426492">n</span>&nbsp;<span class="op" id="4426494">==</span>&nbsp;<span class="num" id="4426497">0</span><span class="op" id="4426498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426502">return</span>&nbsp;<span class="ident" id="4426509">z</span><span class="op" id="4426510">.</span><span class="builtinfunc" id="4426511">make</span><span class="op" id="4426515">(</span><span class="num" id="4426516">0</span><span class="op" id="4426517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426520">case</span>&nbsp;<span class="ident" id="4426525">n</span>&nbsp;<span class="op" id="4426527">==</span>&nbsp;<span class="num" id="4426530">1</span><span class="op" id="4426531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426535">return</span>&nbsp;<span class="ident" id="4426542">z</span><span class="op" id="4426543">.</span><span class="ident" id="4426544">mulAddWW</span><span class="op" id="4426552">(</span><span class="ident" id="4426553">x</span><span class="op" id="4426554">,</span>&nbsp;<span class="ident" id="4426556">y</span><span class="op" id="4426557">[</span><span class="num" id="4426558">0</span><span class="op" id="4426559">]</span><span class="op" id="4426560">,</span>&nbsp;<span class="num" id="4426562">0</span><span class="op" id="4426563">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426569">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426585">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426618">if</span>&nbsp;<span class="ident" id="4426621">alias</span><span class="op" id="4426626">(</span><span class="ident" id="4426627">z</span><span class="op" id="4426628">,</span>&nbsp;<span class="ident" id="4426630">x</span><span class="op" id="4426631">)</span>&nbsp;<span class="op" id="4426633">||</span>&nbsp;<span class="ident" id="4426636">alias</span><span class="op" id="4426641">(</span><span class="ident" id="4426642">z</span><span class="op" id="4426643">,</span>&nbsp;<span class="ident" id="4426645">y</span><span class="op" id="4426646">)</span>&nbsp;<span class="op" id="4426648">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426652">z</span>&nbsp;<span class="op" id="4426654">=</span>&nbsp;<span class="ident" id="4426656">nil</span>&nbsp;<span class="comment" id="4426660">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426708">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426762">if</span>&nbsp;<span class="ident" id="4426765">n</span>&nbsp;<span class="op" id="4426767">&lt;</span>&nbsp;<span class="ident" id="4426769">karatsubaThreshold</span>&nbsp;<span class="op" id="4426788">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426792">z</span>&nbsp;<span class="op" id="4426794">=</span>&nbsp;<span class="ident" id="4426796">z</span><span class="op" id="4426797">.</span><span class="builtinfunc" id="4426798">make</span><span class="op" id="4426802">(</span><span class="ident" id="4426803">m</span>&nbsp;<span class="op" id="4426805">+</span>&nbsp;<span class="ident" id="4426807">n</span><span class="op" id="4426808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426812">basicMul</span><span class="op" id="4426820">(</span><span class="ident" id="4426821">z</span><span class="op" id="4426822">,</span>&nbsp;<span class="ident" id="4426824">x</span><span class="op" id="4426825">,</span>&nbsp;<span class="ident" id="4426827">y</span><span class="op" id="4426828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426832">return</span>&nbsp;<span class="ident" id="4426839">z</span><span class="op" id="4426840">.</span><span class="ident" id="4426841">norm</span><span class="op" id="4426845">(</span><span class="op" id="4426846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426852">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426901">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426944">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426948">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426983">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427018">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427065">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427069">k</span>&nbsp;<span class="op" id="4427071">:=</span>&nbsp;<span class="ident" id="4427074">karatsubaLen</span><span class="op" id="4427086">(</span><span class="ident" id="4427087">n</span><span class="op" id="4427088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427091">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427103">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427140">x0</span>&nbsp;<span class="op" id="4427143">:=</span>&nbsp;<span class="ident" id="4427146">x</span><span class="op" id="4427147">[</span><span class="num" id="4427148">0</span><span class="op" id="4427149">:</span><span class="ident" id="4427150">k</span><span class="op" id="4427151">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4427166">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427191">y0</span>&nbsp;<span class="op" id="4427194">:=</span>&nbsp;<span class="ident" id="4427197">y</span><span class="op" id="4427198">[</span><span class="num" id="4427199">0</span><span class="op" id="4427200">:</span><span class="ident" id="4427201">k</span><span class="op" id="4427202">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4427217">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427242">z</span>&nbsp;<span class="op" id="4427244">=</span>&nbsp;<span class="ident" id="4427246">z</span><span class="op" id="4427247">.</span><span class="builtinfunc" id="4427248">make</span><span class="op" id="4427252">(</span><span class="ident" id="4427253">max</span><span class="op" id="4427256">(</span><span class="num" id="4427257">6</span><span class="op" id="4427258">*</span><span class="ident" id="4427259">k</span><span class="op" id="4427260">,</span>&nbsp;<span class="ident" id="4427262">m</span><span class="op" id="4427263">+</span><span class="ident" id="4427264">n</span><span class="op" id="4427265">)</span><span class="op" id="4427266">)</span>&nbsp;<span class="comment" id="4427268">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427331">karatsuba</span><span class="op" id="4427340">(</span><span class="ident" id="4427341">z</span><span class="op" id="4427342">,</span>&nbsp;<span class="ident" id="4427344">x0</span><span class="op" id="4427346">,</span>&nbsp;<span class="ident" id="4427348">y0</span><span class="op" id="4427350">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427353">z</span>&nbsp;<span class="op" id="4427355">=</span>&nbsp;<span class="ident" id="4427357">z</span><span class="op" id="4427358">[</span><span class="num" id="4427359">0</span>&nbsp;<span class="op" id="4427361">:</span>&nbsp;<span class="ident" id="4427363">m</span><span class="op" id="4427364">+</span><span class="ident" id="4427365">n</span><span class="op" id="4427366">]</span>&nbsp;&nbsp;<span class="comment" id="4427369">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427414">z</span><span class="op" id="4427415">[</span><span class="num" id="4427416">2</span><span class="op" id="4427417">*</span><span class="ident" id="4427418">k</span><span class="op" id="4427419">:</span><span class="op" id="4427420">]</span><span class="op" id="4427421">.</span><span class="ident" id="4427422">clear</span><span class="op" id="4427427">(</span><span class="op" id="4427428">)</span>&nbsp;<span class="comment" id="4427430">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427500">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427559">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427563">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427617">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427671">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427675">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427701">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427705">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427758">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427762">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427830">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427898">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427968">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427972">if</span>&nbsp;<span class="ident" id="4427975">k</span>&nbsp;<span class="op" id="4427977">&lt;</span>&nbsp;<span class="ident" id="4427979">n</span>&nbsp;<span class="op" id="4427981">||</span>&nbsp;<span class="ident" id="4427984">m</span>&nbsp;<span class="op" id="4427986">!=</span>&nbsp;<span class="ident" id="4427989">n</span>&nbsp;<span class="op" id="4427991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427995">var</span>&nbsp;<span class="ident" id="4427999">t</span>&nbsp;<span class="ident" id="4428001">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428008">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428025">x0</span>&nbsp;<span class="op" id="4428028">:=</span>&nbsp;<span class="ident" id="4428031">x0</span><span class="op" id="4428033">.</span><span class="ident" id="4428034">norm</span><span class="op" id="4428038">(</span><span class="op" id="4428039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428043">y1</span>&nbsp;<span class="op" id="4428046">:=</span>&nbsp;<span class="ident" id="4428049">y</span><span class="op" id="4428050">[</span><span class="ident" id="4428051">k</span><span class="op" id="4428052">:</span><span class="op" id="4428053">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4428061">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428096">t</span>&nbsp;<span class="op" id="4428098">=</span>&nbsp;<span class="ident" id="4428100">t</span><span class="op" id="4428101">.</span><span class="ident" id="4428102">mul</span><span class="op" id="4428105">(</span><span class="ident" id="4428106">x0</span><span class="op" id="4428108">,</span>&nbsp;<span class="ident" id="4428110">y1</span><span class="op" id="4428112">)</span>&nbsp;<span class="comment" id="4428114">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428166">addAt</span><span class="op" id="4428171">(</span><span class="ident" id="4428172">z</span><span class="op" id="4428173">,</span>&nbsp;<span class="ident" id="4428175">t</span><span class="op" id="4428176">,</span>&nbsp;<span class="ident" id="4428178">k</span><span class="op" id="4428179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428184">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428218">y0</span>&nbsp;<span class="op" id="4428221">:=</span>&nbsp;<span class="ident" id="4428224">y0</span><span class="op" id="4428226">.</span><span class="ident" id="4428227">norm</span><span class="op" id="4428231">(</span><span class="op" id="4428232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428236">for</span>&nbsp;<span class="ident" id="4428240">i</span>&nbsp;<span class="op" id="4428242">:=</span>&nbsp;<span class="ident" id="4428245">k</span><span class="op" id="4428246">;</span>&nbsp;<span class="ident" id="4428248">i</span>&nbsp;<span class="op" id="4428250">&lt;</span>&nbsp;<span class="builtinfunc" id="4428252">len</span><span class="op" id="4428255">(</span><span class="ident" id="4428256">x</span><span class="op" id="4428257">)</span><span class="op" id="4428258">;</span>&nbsp;<span class="ident" id="4428260">i</span>&nbsp;<span class="op" id="4428262">+=</span>&nbsp;<span class="ident" id="4428265">k</span>&nbsp;<span class="op" id="4428267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428272">xi</span>&nbsp;<span class="op" id="4428275">:=</span>&nbsp;<span class="ident" id="4428278">x</span><span class="op" id="4428279">[</span><span class="ident" id="4428280">i</span><span class="op" id="4428281">:</span><span class="op" id="4428282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428287">if</span>&nbsp;<span class="builtinfunc" id="4428290">len</span><span class="op" id="4428293">(</span><span class="ident" id="4428294">xi</span><span class="op" id="4428296">)</span>&nbsp;<span class="op" id="4428298">&gt;</span>&nbsp;<span class="ident" id="4428300">k</span>&nbsp;<span class="op" id="4428302">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428308">xi</span>&nbsp;<span class="op" id="4428311">=</span>&nbsp;<span class="ident" id="4428313">xi</span><span class="op" id="4428315">[</span><span class="op" id="4428316">:</span><span class="ident" id="4428317">k</span><span class="op" id="4428318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428328">xi</span>&nbsp;<span class="op" id="4428331">=</span>&nbsp;<span class="ident" id="4428333">xi</span><span class="op" id="4428335">.</span><span class="ident" id="4428336">norm</span><span class="op" id="4428340">(</span><span class="op" id="4428341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428346">t</span>&nbsp;<span class="op" id="4428348">=</span>&nbsp;<span class="ident" id="4428350">t</span><span class="op" id="4428351">.</span><span class="ident" id="4428352">mul</span><span class="op" id="4428355">(</span><span class="ident" id="4428356">xi</span><span class="op" id="4428358">,</span>&nbsp;<span class="ident" id="4428360">y0</span><span class="op" id="4428362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428367">addAt</span><span class="op" id="4428372">(</span><span class="ident" id="4428373">z</span><span class="op" id="4428374">,</span>&nbsp;<span class="ident" id="4428376">t</span><span class="op" id="4428377">,</span>&nbsp;<span class="ident" id="4428379">i</span><span class="op" id="4428380">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428385">t</span>&nbsp;<span class="op" id="4428387">=</span>&nbsp;<span class="ident" id="4428389">t</span><span class="op" id="4428390">.</span><span class="ident" id="4428391">mul</span><span class="op" id="4428394">(</span><span class="ident" id="4428395">xi</span><span class="op" id="4428397">,</span>&nbsp;<span class="ident" id="4428399">y1</span><span class="op" id="4428401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428406">addAt</span><span class="op" id="4428411">(</span><span class="ident" id="4428412">z</span><span class="op" id="4428413">,</span>&nbsp;<span class="ident" id="4428415">t</span><span class="op" id="4428416">,</span>&nbsp;<span class="ident" id="4428418">i</span><span class="op" id="4428419">+</span><span class="ident" id="4428420">k</span><span class="op" id="4428421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428432">return</span>&nbsp;<span class="ident" id="4428439">z</span><span class="op" id="4428440">.</span><span class="ident" id="4428441">norm</span><span class="op" id="4428445">(</span><span class="op" id="4428446">)</span><br>
<span class="lineno"></span><span class="op" id="4428448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4428451">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4428520">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="4428590">func</span>&nbsp;<span class="op" id="4428595">(</span><span class="ident" id="4428596">z</span>&nbsp;<span class="ident" id="4428598">nat</span><span class="op" id="4428601">)</span>&nbsp;<span class="ident" id="4428603">mulRange</span><span class="op" id="4428611">(</span><span class="ident" id="4428612">a</span><span class="op" id="4428613">,</span>&nbsp;<span class="ident" id="4428615">b</span>&nbsp;<span class="ident" id="4428617">uint64</span><span class="op" id="4428623">)</span>&nbsp;<span class="ident" id="4428625">nat</span>&nbsp;<span class="op" id="4428629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428632">switch</span>&nbsp;<span class="op" id="4428639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428642">case</span>&nbsp;<span class="ident" id="4428647">a</span>&nbsp;<span class="op" id="4428649">==</span>&nbsp;<span class="num" id="4428652">0</span><span class="op" id="4428653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428657">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428699">return</span>&nbsp;<span class="ident" id="4428706">z</span><span class="op" id="4428707">.</span><span class="ident" id="4428708">setUint64</span><span class="op" id="4428717">(</span><span class="num" id="4428718">0</span><span class="op" id="4428719">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428722">case</span>&nbsp;<span class="ident" id="4428727">a</span>&nbsp;<span class="op" id="4428729">&gt;</span>&nbsp;<span class="ident" id="4428731">b</span><span class="op" id="4428732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428736">return</span>&nbsp;<span class="ident" id="4428743">z</span><span class="op" id="4428744">.</span><span class="ident" id="4428745">setUint64</span><span class="op" id="4428754">(</span><span class="num" id="4428755">1</span><span class="op" id="4428756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428759">case</span>&nbsp;<span class="ident" id="4428764">a</span>&nbsp;<span class="op" id="4428766">==</span>&nbsp;<span class="ident" id="4428769">b</span><span class="op" id="4428770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428774">return</span>&nbsp;<span class="ident" id="4428781">z</span><span class="op" id="4428782">.</span><span class="ident" id="4428783">setUint64</span><span class="op" id="4428792">(</span><span class="ident" id="4428793">a</span><span class="op" id="4428794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428797">case</span>&nbsp;<span class="ident" id="4428802">a</span><span class="op" id="4428803">+</span><span class="num" id="4428804">1</span>&nbsp;<span class="op" id="4428806">==</span>&nbsp;<span class="ident" id="4428809">b</span><span class="op" id="4428810">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428814">return</span>&nbsp;<span class="ident" id="4428821">z</span><span class="op" id="4428822">.</span><span class="ident" id="4428823">mul</span><span class="op" id="4428826">(</span><span class="ident" id="4428827">nat</span><span class="op" id="4428830">(</span><span class="ident" id="4428831">nil</span><span class="op" id="4428834">)</span><span class="op" id="4428835">.</span><span class="ident" id="4428836">setUint64</span><span class="op" id="4428845">(</span><span class="ident" id="4428846">a</span><span class="op" id="4428847">)</span><span class="op" id="4428848">,</span>&nbsp;<span class="ident" id="4428850">nat</span><span class="op" id="4428853">(</span><span class="ident" id="4428854">nil</span><span class="op" id="4428857">)</span><span class="op" id="4428858">.</span><span class="ident" id="4428859">setUint64</span><span class="op" id="4428868">(</span><span class="ident" id="4428869">b</span><span class="op" id="4428870">)</span><span class="op" id="4428871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428877">m</span>&nbsp;<span class="op" id="4428879">:=</span>&nbsp;<span class="op" id="4428882">(</span><span class="ident" id="4428883">a</span>&nbsp;<span class="op" id="4428885">+</span>&nbsp;<span class="ident" id="4428887">b</span><span class="op" id="4428888">)</span>&nbsp;<span class="op" id="4428890">/</span>&nbsp;<span class="num" id="4428892">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428895">return</span>&nbsp;<span class="ident" id="4428902">z</span><span class="op" id="4428903">.</span><span class="ident" id="4428904">mul</span><span class="op" id="4428907">(</span><span class="ident" id="4428908">nat</span><span class="op" id="4428911">(</span><span class="ident" id="4428912">nil</span><span class="op" id="4428915">)</span><span class="op" id="4428916">.</span><span class="ident" id="4428917">mulRange</span><span class="op" id="4428925">(</span><span class="ident" id="4428926">a</span><span class="op" id="4428927">,</span>&nbsp;<span class="ident" id="4428929">m</span><span class="op" id="4428930">)</span><span class="op" id="4428931">,</span>&nbsp;<span class="ident" id="4428933">nat</span><span class="op" id="4428936">(</span><span class="ident" id="4428937">nil</span><span class="op" id="4428940">)</span><span class="op" id="4428941">.</span><span class="ident" id="4428942">mulRange</span><span class="op" id="4428950">(</span><span class="ident" id="4428951">m</span><span class="op" id="4428952">+</span><span class="num" id="4428953">1</span><span class="op" id="4428954">,</span>&nbsp;<span class="ident" id="4428956">b</span><span class="op" id="4428957">)</span><span class="op" id="4428958">)</span><br>
<span class="lineno"></span><span class="op" id="4428960">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4428963">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="4428995">func</span>&nbsp;<span class="op" id="4429000">(</span><span class="ident" id="4429001">z</span>&nbsp;<span class="ident" id="4429003">nat</span><span class="op" id="4429006">)</span>&nbsp;<span class="ident" id="4429008">divW</span><span class="op" id="4429012">(</span><span class="ident" id="4429013">x</span>&nbsp;<span class="ident" id="4429015">nat</span><span class="op" id="4429018">,</span>&nbsp;<span class="ident" id="4429020">y</span>&nbsp;<span class="ident" id="4429022">Word</span><span class="op" id="4429026">)</span>&nbsp;<span class="op" id="4429028">(</span><span class="ident" id="4429029">q</span>&nbsp;<span class="ident" id="4429031">nat</span><span class="op" id="4429034">,</span>&nbsp;<span class="ident" id="4429036">r</span>&nbsp;<span class="ident" id="4429038">Word</span><span class="op" id="4429042">)</span>&nbsp;<span class="op" id="4429044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429047">m</span>&nbsp;<span class="op" id="4429049">:=</span>&nbsp;<span class="builtinfunc" id="4429052">len</span><span class="op" id="4429055">(</span><span class="ident" id="4429056">x</span><span class="op" id="4429057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429060">switch</span>&nbsp;<span class="op" id="4429067">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429070">case</span>&nbsp;<span class="ident" id="4429075">y</span>&nbsp;<span class="op" id="4429077">==</span>&nbsp;<span class="num" id="4429080">0</span><span class="op" id="4429081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4429085">panic</span><span class="op" id="4429090">(</span><span class="string" id="4429091">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4429109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429112">case</span>&nbsp;<span class="ident" id="4429117">y</span>&nbsp;<span class="op" id="4429119">==</span>&nbsp;<span class="num" id="4429122">1</span><span class="op" id="4429123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429127">q</span>&nbsp;<span class="op" id="4429129">=</span>&nbsp;<span class="ident" id="4429131">z</span><span class="op" id="4429132">.</span><span class="ident" id="4429133">set</span><span class="op" id="4429136">(</span><span class="ident" id="4429137">x</span><span class="op" id="4429138">)</span>&nbsp;<span class="comment" id="4429140">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429157">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429165">case</span>&nbsp;<span class="ident" id="4429170">m</span>&nbsp;<span class="op" id="4429172">==</span>&nbsp;<span class="num" id="4429175">0</span><span class="op" id="4429176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429180">q</span>&nbsp;<span class="op" id="4429182">=</span>&nbsp;<span class="ident" id="4429184">z</span><span class="op" id="4429185">.</span><span class="builtinfunc" id="4429186">make</span><span class="op" id="4429190">(</span><span class="num" id="4429191">0</span><span class="op" id="4429192">)</span>&nbsp;<span class="comment" id="4429194">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429211">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429222">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429232">z</span>&nbsp;<span class="op" id="4429234">=</span>&nbsp;<span class="ident" id="4429236">z</span><span class="op" id="4429237">.</span><span class="builtinfunc" id="4429238">make</span><span class="op" id="4429242">(</span><span class="ident" id="4429243">m</span><span class="op" id="4429244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429247">r</span>&nbsp;<span class="op" id="4429249">=</span>&nbsp;<span class="ident" id="4429251">divWVW</span><span class="op" id="4429257">(</span><span class="ident" id="4429258">z</span><span class="op" id="4429259">,</span>&nbsp;<span class="num" id="4429261">0</span><span class="op" id="4429262">,</span>&nbsp;<span class="ident" id="4429264">x</span><span class="op" id="4429265">,</span>&nbsp;<span class="ident" id="4429267">y</span><span class="op" id="4429268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429271">q</span>&nbsp;<span class="op" id="4429273">=</span>&nbsp;<span class="ident" id="4429275">z</span><span class="op" id="4429276">.</span><span class="ident" id="4429277">norm</span><span class="op" id="4429281">(</span><span class="op" id="4429282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429285">return</span><br>
<span class="lineno"></span><span class="op" id="4429292">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="4429295">func</span>&nbsp;<span class="op" id="4429300">(</span><span class="ident" id="4429301">z</span>&nbsp;<span class="ident" id="4429303">nat</span><span class="op" id="4429306">)</span>&nbsp;<span class="ident" id="4429308">div</span><span class="op" id="4429311">(</span><span class="ident" id="4429312">z2</span><span class="op" id="4429314">,</span>&nbsp;<span class="ident" id="4429316">u</span><span class="op" id="4429317">,</span>&nbsp;<span class="ident" id="4429319">v</span>&nbsp;<span class="ident" id="4429321">nat</span><span class="op" id="4429324">)</span>&nbsp;<span class="op" id="4429326">(</span><span class="ident" id="4429327">q</span><span class="op" id="4429328">,</span>&nbsp;<span class="ident" id="4429330">r</span>&nbsp;<span class="ident" id="4429332">nat</span><span class="op" id="4429335">)</span>&nbsp;<span class="op" id="4429337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429340">if</span>&nbsp;<span class="builtinfunc" id="4429343">len</span><span class="op" id="4429346">(</span><span class="ident" id="4429347">v</span><span class="op" id="4429348">)</span>&nbsp;<span class="op" id="4429350">==</span>&nbsp;<span class="num" id="4429353">0</span>&nbsp;<span class="op" id="4429355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4429359">panic</span><span class="op" id="4429364">(</span><span class="string" id="4429365">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4429383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429386">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429390">if</span>&nbsp;<span class="ident" id="4429393">u</span><span class="op" id="4429394">.</span><span class="ident" id="4429395">cmp</span><span class="op" id="4429398">(</span><span class="ident" id="4429399">v</span><span class="op" id="4429400">)</span>&nbsp;<span class="op" id="4429402">&lt;</span>&nbsp;<span class="num" id="4429404">0</span>&nbsp;<span class="op" id="4429406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429410">q</span>&nbsp;<span class="op" id="4429412">=</span>&nbsp;<span class="ident" id="4429414">z</span><span class="op" id="4429415">.</span><span class="builtinfunc" id="4429416">make</span><span class="op" id="4429420">(</span><span class="num" id="4429421">0</span><span class="op" id="4429422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429426">r</span>&nbsp;<span class="op" id="4429428">=</span>&nbsp;<span class="ident" id="4429430">z2</span><span class="op" id="4429432">.</span><span class="ident" id="4429433">set</span><span class="op" id="4429436">(</span><span class="ident" id="4429437">u</span><span class="op" id="4429438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429442">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429454">if</span>&nbsp;<span class="builtinfunc" id="4429457">len</span><span class="op" id="4429460">(</span><span class="ident" id="4429461">v</span><span class="op" id="4429462">)</span>&nbsp;<span class="op" id="4429464">==</span>&nbsp;<span class="num" id="4429467">1</span>&nbsp;<span class="op" id="4429469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429473">var</span>&nbsp;<span class="ident" id="4429477">r2</span>&nbsp;<span class="ident" id="4429480">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429487">q</span><span class="op" id="4429488">,</span>&nbsp;<span class="ident" id="4429490">r2</span>&nbsp;<span class="op" id="4429493">=</span>&nbsp;<span class="ident" id="4429495">z</span><span class="op" id="4429496">.</span><span class="ident" id="4429497">divW</span><span class="op" id="4429501">(</span><span class="ident" id="4429502">u</span><span class="op" id="4429503">,</span>&nbsp;<span class="ident" id="4429505">v</span><span class="op" id="4429506">[</span><span class="num" id="4429507">0</span><span class="op" id="4429508">]</span><span class="op" id="4429509">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429513">r</span>&nbsp;<span class="op" id="4429515">=</span>&nbsp;<span class="ident" id="4429517">z2</span><span class="op" id="4429519">.</span><span class="ident" id="4429520">setWord</span><span class="op" id="4429527">(</span><span class="ident" id="4429528">r2</span><span class="op" id="4429530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429546">q</span><span class="op" id="4429547">,</span>&nbsp;<span class="ident" id="4429549">r</span>&nbsp;<span class="op" id="4429551">=</span>&nbsp;<span class="ident" id="4429553">z</span><span class="op" id="4429554">.</span><span class="ident" id="4429555">divLarge</span><span class="op" id="4429563">(</span><span class="ident" id="4429564">z2</span><span class="op" id="4429566">,</span>&nbsp;<span class="ident" id="4429568">u</span><span class="op" id="4429569">,</span>&nbsp;<span class="ident" id="4429571">v</span><span class="op" id="4429572">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429575">return</span><br>
<span class="lineno"></span><span class="op" id="4429582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4429585">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4429619">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="4429683">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="4429735">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="4429753">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4429771">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="4429796">func</span>&nbsp;<span class="op" id="4429801">(</span><span class="ident" id="4429802">z</span>&nbsp;<span class="ident" id="4429804">nat</span><span class="op" id="4429807">)</span>&nbsp;<span class="ident" id="4429809">divLarge</span><span class="op" id="4429817">(</span><span class="ident" id="4429818">u</span><span class="op" id="4429819">,</span>&nbsp;<span class="ident" id="4429821">uIn</span><span class="op" id="4429824">,</span>&nbsp;<span class="ident" id="4429826">v</span>&nbsp;<span class="ident" id="4429828">nat</span><span class="op" id="4429831">)</span>&nbsp;<span class="op" id="4429833">(</span><span class="ident" id="4429834">q</span><span class="op" id="4429835">,</span>&nbsp;<span class="ident" id="4429837">r</span>&nbsp;<span class="ident" id="4429839">nat</span><span class="op" id="4429842">)</span>&nbsp;<span class="op" id="4429844">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429847">n</span>&nbsp;<span class="op" id="4429849">:=</span>&nbsp;<span class="builtinfunc" id="4429852">len</span><span class="op" id="4429855">(</span><span class="ident" id="4429856">v</span><span class="op" id="4429857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429860">m</span>&nbsp;<span class="op" id="4429862">:=</span>&nbsp;<span class="builtinfunc" id="4429865">len</span><span class="op" id="4429868">(</span><span class="ident" id="4429869">uIn</span><span class="op" id="4429872">)</span>&nbsp;<span class="op" id="4429874">-</span>&nbsp;<span class="ident" id="4429876">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429880">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429913">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430043">if</span>&nbsp;<span class="ident" id="4430046">alias</span><span class="op" id="4430051">(</span><span class="ident" id="4430052">z</span><span class="op" id="4430053">,</span>&nbsp;<span class="ident" id="4430055">uIn</span><span class="op" id="4430058">)</span>&nbsp;<span class="op" id="4430060">||</span>&nbsp;<span class="ident" id="4430063">alias</span><span class="op" id="4430068">(</span><span class="ident" id="4430069">z</span><span class="op" id="4430070">,</span>&nbsp;<span class="ident" id="4430072">v</span><span class="op" id="4430073">)</span>&nbsp;<span class="op" id="4430075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430079">z</span>&nbsp;<span class="op" id="4430081">=</span>&nbsp;<span class="ident" id="4430083">nil</span>&nbsp;<span class="comment" id="4430087">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430136">q</span>&nbsp;<span class="op" id="4430138">=</span>&nbsp;<span class="ident" id="4430140">z</span><span class="op" id="4430141">.</span><span class="builtinfunc" id="4430142">make</span><span class="op" id="4430146">(</span><span class="ident" id="4430147">m</span>&nbsp;<span class="op" id="4430149">+</span>&nbsp;<span class="num" id="4430151">1</span><span class="op" id="4430152">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430156">qhatv</span>&nbsp;<span class="op" id="4430162">:=</span>&nbsp;<span class="builtinfunc" id="4430165">make</span><span class="op" id="4430169">(</span><span class="ident" id="4430170">nat</span><span class="op" id="4430173">,</span>&nbsp;<span class="ident" id="4430175">n</span><span class="op" id="4430176">+</span><span class="num" id="4430177">1</span><span class="op" id="4430178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430181">if</span>&nbsp;<span class="ident" id="4430184">alias</span><span class="op" id="4430189">(</span><span class="ident" id="4430190">u</span><span class="op" id="4430191">,</span>&nbsp;<span class="ident" id="4430193">uIn</span><span class="op" id="4430196">)</span>&nbsp;<span class="op" id="4430198">||</span>&nbsp;<span class="ident" id="4430201">alias</span><span class="op" id="4430206">(</span><span class="ident" id="4430207">u</span><span class="op" id="4430208">,</span>&nbsp;<span class="ident" id="4430210">v</span><span class="op" id="4430211">)</span>&nbsp;<span class="op" id="4430213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430217">u</span>&nbsp;<span class="op" id="4430219">=</span>&nbsp;<span class="ident" id="4430221">nil</span>&nbsp;<span class="comment" id="4430225">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430271">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430274">u</span>&nbsp;<span class="op" id="4430276">=</span>&nbsp;<span class="ident" id="4430278">u</span><span class="op" id="4430279">.</span><span class="builtinfunc" id="4430280">make</span><span class="op" id="4430284">(</span><span class="builtinfunc" id="4430285">len</span><span class="op" id="4430288">(</span><span class="ident" id="4430289">uIn</span><span class="op" id="4430292">)</span>&nbsp;<span class="op" id="4430294">+</span>&nbsp;<span class="num" id="4430296">1</span><span class="op" id="4430297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430300">u</span><span class="op" id="4430301">.</span><span class="ident" id="4430302">clear</span><span class="op" id="4430307">(</span><span class="op" id="4430308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430312">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430320">shift</span>&nbsp;<span class="op" id="4430326">:=</span>&nbsp;<span class="ident" id="4430329">leadingZeros</span><span class="op" id="4430341">(</span><span class="ident" id="4430342">v</span><span class="op" id="4430343">[</span><span class="ident" id="4430344">n</span><span class="op" id="4430345">-</span><span class="num" id="4430346">1</span><span class="op" id="4430347">]</span><span class="op" id="4430348">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430351">if</span>&nbsp;<span class="ident" id="4430354">shift</span>&nbsp;<span class="op" id="4430360">&gt;</span>&nbsp;<span class="num" id="4430362">0</span>&nbsp;<span class="op" id="4430364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430368">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430441">v1</span>&nbsp;<span class="op" id="4430444">:=</span>&nbsp;<span class="builtinfunc" id="4430447">make</span><span class="op" id="4430451">(</span><span class="ident" id="4430452">nat</span><span class="op" id="4430455">,</span>&nbsp;<span class="ident" id="4430457">n</span><span class="op" id="4430458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430462">shlVU</span><span class="op" id="4430467">(</span><span class="ident" id="4430468">v1</span><span class="op" id="4430470">,</span>&nbsp;<span class="ident" id="4430472">v</span><span class="op" id="4430473">,</span>&nbsp;<span class="ident" id="4430475">shift</span><span class="op" id="4430480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430484">v</span>&nbsp;<span class="op" id="4430486">=</span>&nbsp;<span class="ident" id="4430488">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430495">u</span><span class="op" id="4430496">[</span><span class="builtinfunc" id="4430497">len</span><span class="op" id="4430500">(</span><span class="ident" id="4430501">uIn</span><span class="op" id="4430504">)</span><span class="op" id="4430505">]</span>&nbsp;<span class="op" id="4430507">=</span>&nbsp;<span class="ident" id="4430509">shlVU</span><span class="op" id="4430514">(</span><span class="ident" id="4430515">u</span><span class="op" id="4430516">[</span><span class="num" id="4430517">0</span><span class="op" id="4430518">:</span><span class="builtinfunc" id="4430519">len</span><span class="op" id="4430522">(</span><span class="ident" id="4430523">uIn</span><span class="op" id="4430526">)</span><span class="op" id="4430527">]</span><span class="op" id="4430528">,</span>&nbsp;<span class="ident" id="4430530">uIn</span><span class="op" id="4430533">,</span>&nbsp;<span class="ident" id="4430535">shift</span><span class="op" id="4430540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430544">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430552">for</span>&nbsp;<span class="ident" id="4430556">j</span>&nbsp;<span class="op" id="4430558">:=</span>&nbsp;<span class="ident" id="4430561">m</span><span class="op" id="4430562">;</span>&nbsp;<span class="ident" id="4430564">j</span>&nbsp;<span class="op" id="4430566">&gt;=</span>&nbsp;<span class="num" id="4430569">0</span><span class="op" id="4430570">;</span>&nbsp;<span class="ident" id="4430572">j</span><span class="op" id="4430573">--</span>&nbsp;<span class="op" id="4430576">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430580">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430589">qhat</span>&nbsp;<span class="op" id="4430594">:=</span>&nbsp;<span class="ident" id="4430597">Word</span><span class="op" id="4430601">(</span><span class="ident" id="4430602">_M</span><span class="op" id="4430604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430608">if</span>&nbsp;<span class="ident" id="4430611">u</span><span class="op" id="4430612">[</span><span class="ident" id="4430613">j</span><span class="op" id="4430614">+</span><span class="ident" id="4430615">n</span><span class="op" id="4430616">]</span>&nbsp;<span class="op" id="4430618">!=</span>&nbsp;<span class="ident" id="4430621">v</span><span class="op" id="4430622">[</span><span class="ident" id="4430623">n</span><span class="op" id="4430624">-</span><span class="num" id="4430625">1</span><span class="op" id="4430626">]</span>&nbsp;<span class="op" id="4430628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430633">var</span>&nbsp;<span class="ident" id="4430637">rhat</span>&nbsp;<span class="ident" id="4430642">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430650">qhat</span><span class="op" id="4430654">,</span>&nbsp;<span class="ident" id="4430656">rhat</span>&nbsp;<span class="op" id="4430661">=</span>&nbsp;<span class="ident" id="4430663">divWW</span><span class="op" id="4430668">(</span><span class="ident" id="4430669">u</span><span class="op" id="4430670">[</span><span class="ident" id="4430671">j</span><span class="op" id="4430672">+</span><span class="ident" id="4430673">n</span><span class="op" id="4430674">]</span><span class="op" id="4430675">,</span>&nbsp;<span class="ident" id="4430677">u</span><span class="op" id="4430678">[</span><span class="ident" id="4430679">j</span><span class="op" id="4430680">+</span><span class="ident" id="4430681">n</span><span class="op" id="4430682">-</span><span class="num" id="4430683">1</span><span class="op" id="4430684">]</span><span class="op" id="4430685">,</span>&nbsp;<span class="ident" id="4430687">v</span><span class="op" id="4430688">[</span><span class="ident" id="4430689">n</span><span class="op" id="4430690">-</span><span class="num" id="4430691">1</span><span class="op" id="4430692">]</span><span class="op" id="4430693">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430699">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;qv_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430726">x1</span><span class="op" id="4430728">,</span>&nbsp;<span class="ident" id="4430730">x2</span>&nbsp;<span class="op" id="4430733">:=</span>&nbsp;<span class="ident" id="4430736">mulWW</span><span class="op" id="4430741">(</span><span class="ident" id="4430742">qhat</span><span class="op" id="4430746">,</span>&nbsp;<span class="ident" id="4430748">v</span><span class="op" id="4430749">[</span><span class="ident" id="4430750">n</span><span class="op" id="4430751">-</span><span class="num" id="4430752">2</span><span class="op" id="4430753">]</span><span class="op" id="4430754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430759">//&nbsp;test&nbsp;if&nbsp;qv_{n-2}&nbsp;&gt;&nbsp;br&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430803">for</span>&nbsp;<span class="ident" id="4430807">greaterThan</span><span class="op" id="4430818">(</span><span class="ident" id="4430819">x1</span><span class="op" id="4430821">,</span>&nbsp;<span class="ident" id="4430823">x2</span><span class="op" id="4430825">,</span>&nbsp;<span class="ident" id="4430827">rhat</span><span class="op" id="4430831">,</span>&nbsp;<span class="ident" id="4430833">u</span><span class="op" id="4430834">[</span><span class="ident" id="4430835">j</span><span class="op" id="4430836">+</span><span class="ident" id="4430837">n</span><span class="op" id="4430838">-</span><span class="num" id="4430839">2</span><span class="op" id="4430840">]</span><span class="op" id="4430841">)</span>&nbsp;<span class="op" id="4430843">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430849">qhat</span><span class="op" id="4430853">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430860">prevRhat</span>&nbsp;<span class="op" id="4430869">:=</span>&nbsp;<span class="ident" id="4430872">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430881">rhat</span>&nbsp;<span class="op" id="4430886">+=</span>&nbsp;<span class="ident" id="4430889">v</span><span class="op" id="4430890">[</span><span class="ident" id="4430891">n</span><span class="op" id="4430892">-</span><span class="num" id="4430893">1</span><span class="op" id="4430894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430900">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430948">if</span>&nbsp;<span class="ident" id="4430951">rhat</span>&nbsp;<span class="op" id="4430956">&lt;</span>&nbsp;<span class="ident" id="4430958">prevRhat</span>&nbsp;<span class="op" id="4430967">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430974">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430990">x1</span><span class="op" id="4430992">,</span>&nbsp;<span class="ident" id="4430994">x2</span>&nbsp;<span class="op" id="4430997">=</span>&nbsp;<span class="ident" id="4430999">mulWW</span><span class="op" id="4431004">(</span><span class="ident" id="4431005">qhat</span><span class="op" id="4431009">,</span>&nbsp;<span class="ident" id="4431011">v</span><span class="op" id="4431012">[</span><span class="ident" id="4431013">n</span><span class="op" id="4431014">-</span><span class="num" id="4431015">2</span><span class="op" id="4431016">]</span><span class="op" id="4431017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431026">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431031">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431040">qhatv</span><span class="op" id="4431045">[</span><span class="ident" id="4431046">n</span><span class="op" id="4431047">]</span>&nbsp;<span class="op" id="4431049">=</span>&nbsp;<span class="ident" id="4431051">mulAddVWW</span><span class="op" id="4431060">(</span><span class="ident" id="4431061">qhatv</span><span class="op" id="4431066">[</span><span class="num" id="4431067">0</span><span class="op" id="4431068">:</span><span class="ident" id="4431069">n</span><span class="op" id="4431070">]</span><span class="op" id="4431071">,</span>&nbsp;<span class="ident" id="4431073">v</span><span class="op" id="4431074">,</span>&nbsp;<span class="ident" id="4431076">qhat</span><span class="op" id="4431080">,</span>&nbsp;<span class="num" id="4431082">0</span><span class="op" id="4431083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431088">c</span>&nbsp;<span class="op" id="4431090">:=</span>&nbsp;<span class="ident" id="4431093">subVV</span><span class="op" id="4431098">(</span><span class="ident" id="4431099">u</span><span class="op" id="4431100">[</span><span class="ident" id="4431101">j</span><span class="op" id="4431102">:</span><span class="ident" id="4431103">j</span><span class="op" id="4431104">+</span><span class="builtinfunc" id="4431105">len</span><span class="op" id="4431108">(</span><span class="ident" id="4431109">qhatv</span><span class="op" id="4431114">)</span><span class="op" id="4431115">]</span><span class="op" id="4431116">,</span>&nbsp;<span class="ident" id="4431118">u</span><span class="op" id="4431119">[</span><span class="ident" id="4431120">j</span><span class="op" id="4431121">:</span><span class="op" id="4431122">]</span><span class="op" id="4431123">,</span>&nbsp;<span class="ident" id="4431125">qhatv</span><span class="op" id="4431130">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431134">if</span>&nbsp;<span class="ident" id="4431137">c</span>&nbsp;<span class="op" id="4431139">!=</span>&nbsp;<span class="num" id="4431142">0</span>&nbsp;<span class="op" id="4431144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431149">c</span>&nbsp;<span class="op" id="4431151">:=</span>&nbsp;<span class="ident" id="4431154">addVV</span><span class="op" id="4431159">(</span><span class="ident" id="4431160">u</span><span class="op" id="4431161">[</span><span class="ident" id="4431162">j</span><span class="op" id="4431163">:</span><span class="ident" id="4431164">j</span><span class="op" id="4431165">+</span><span class="ident" id="4431166">n</span><span class="op" id="4431167">]</span><span class="op" id="4431168">,</span>&nbsp;<span class="ident" id="4431170">u</span><span class="op" id="4431171">[</span><span class="ident" id="4431172">j</span><span class="op" id="4431173">:</span><span class="op" id="4431174">]</span><span class="op" id="4431175">,</span>&nbsp;<span class="ident" id="4431177">v</span><span class="op" id="4431178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431183">u</span><span class="op" id="4431184">[</span><span class="ident" id="4431185">j</span><span class="op" id="4431186">+</span><span class="ident" id="4431187">n</span><span class="op" id="4431188">]</span>&nbsp;<span class="op" id="4431190">+=</span>&nbsp;<span class="ident" id="4431193">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431198">qhat</span><span class="op" id="4431202">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431207">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431212">q</span><span class="op" id="4431213">[</span><span class="ident" id="4431214">j</span><span class="op" id="4431215">]</span>&nbsp;<span class="op" id="4431217">=</span>&nbsp;<span class="ident" id="4431219">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431229">q</span>&nbsp;<span class="op" id="4431231">=</span>&nbsp;<span class="ident" id="4431233">q</span><span class="op" id="4431234">.</span><span class="ident" id="4431235">norm</span><span class="op" id="4431239">(</span><span class="op" id="4431240">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431243">shrVU</span><span class="op" id="4431248">(</span><span class="ident" id="4431249">u</span><span class="op" id="4431250">,</span>&nbsp;<span class="ident" id="4431252">u</span><span class="op" id="4431253">,</span>&nbsp;<span class="ident" id="4431255">shift</span><span class="op" id="4431260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431263">r</span>&nbsp;<span class="op" id="4431265">=</span>&nbsp;<span class="ident" id="4431267">u</span><span class="op" id="4431268">.</span><span class="ident" id="4431269">norm</span><span class="op" id="4431273">(</span><span class="op" id="4431274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431278">return</span>&nbsp;<span class="ident" id="4431285">q</span><span class="op" id="4431286">,</span>&nbsp;<span class="ident" id="4431288">r</span><br>
<span class="lineno"></span><span class="op" id="4431290">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="4431293">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="4431339">func</span>&nbsp;<span class="op" id="4431344">(</span><span class="ident" id="4431345">x</span>&nbsp;<span class="ident" id="4431347">nat</span><span class="op" id="4431350">)</span>&nbsp;<span class="ident" id="4431352">bitLen</span><span class="op" id="4431358">(</span><span class="op" id="4431359">)</span>&nbsp;<span class="builtintype" id="4431361">int</span>&nbsp;<span class="op" id="4431365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431368">if</span>&nbsp;<span class="ident" id="4431371">i</span>&nbsp;<span class="op" id="4431373">:=</span>&nbsp;<span class="builtinfunc" id="4431376">len</span><span class="op" id="4431379">(</span><span class="ident" id="4431380">x</span><span class="op" id="4431381">)</span>&nbsp;<span class="op" id="4431383">-</span>&nbsp;<span class="num" id="4431385">1</span><span class="op" id="4431386">;</span>&nbsp;<span class="ident" id="4431388">i</span>&nbsp;<span class="op" id="4431390">&gt;=</span>&nbsp;<span class="num" id="4431393">0</span>&nbsp;<span class="op" id="4431395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431399">return</span>&nbsp;<span class="ident" id="4431406">i</span><span class="op" id="4431407">*</span><span class="ident" id="4431408">_W</span>&nbsp;<span class="op" id="4431411">+</span>&nbsp;<span class="ident" id="4431413">bitLen</span><span class="op" id="4431419">(</span><span class="ident" id="4431420">x</span><span class="op" id="4431421">[</span><span class="ident" id="4431422">i</span><span class="op" id="4431423">]</span><span class="op" id="4431424">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431430">return</span>&nbsp;<span class="num" id="4431437">0</span><br>
<span class="lineno"></span><span class="op" id="4431439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431442">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="4431513">const</span>&nbsp;<span class="ident" id="4431519">MaxBase</span>&nbsp;<span class="op" id="4431527">=</span>&nbsp;<span class="string" id="4431529">&#39;z&#39;</span>&nbsp;<span class="op" id="4431533">-</span>&nbsp;<span class="string" id="4431535">&#39;a&#39;</span>&nbsp;<span class="op" id="4431539">+</span>&nbsp;<span class="num" id="4431541">10</span>&nbsp;<span class="op" id="4431544">+</span>&nbsp;<span class="num" id="4431546">1</span>&nbsp;<span class="comment" id="4431548">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431572">func</span>&nbsp;<span class="ident" id="4431577">hexValue</span><span class="op" id="4431585">(</span><span class="ident" id="4431586">ch</span>&nbsp;<span class="builtintype" id="4431589">rune</span><span class="op" id="4431593">)</span>&nbsp;<span class="ident" id="4431595">Word</span>&nbsp;<span class="op" id="4431600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431603">d</span>&nbsp;<span class="op" id="4431605">:=</span>&nbsp;<span class="builtintype" id="4431608">int</span><span class="op" id="4431611">(</span><span class="ident" id="4431612">MaxBase</span>&nbsp;<span class="op" id="4431620">+</span>&nbsp;<span class="num" id="4431622">1</span><span class="op" id="4431623">)</span>&nbsp;<span class="comment" id="4431625">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431642">switch</span>&nbsp;<span class="op" id="4431649">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431652">case</span>&nbsp;<span class="string" id="4431657">&#39;0&#39;</span>&nbsp;<span class="op" id="4431661">&lt;=</span>&nbsp;<span class="ident" id="4431664">ch</span>&nbsp;<span class="op" id="4431667">&amp;&amp;</span>&nbsp;<span class="ident" id="4431670">ch</span>&nbsp;<span class="op" id="4431673">&lt;=</span>&nbsp;<span class="string" id="4431676">&#39;9&#39;</span><span class="op" id="4431679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431683">d</span>&nbsp;<span class="op" id="4431685">=</span>&nbsp;<span class="builtintype" id="4431687">int</span><span class="op" id="4431690">(</span><span class="ident" id="4431691">ch</span>&nbsp;<span class="op" id="4431694">-</span>&nbsp;<span class="string" id="4431696">&#39;0&#39;</span><span class="op" id="4431699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431702">case</span>&nbsp;<span class="string" id="4431707">&#39;a&#39;</span>&nbsp;<span class="op" id="4431711">&lt;=</span>&nbsp;<span class="ident" id="4431714">ch</span>&nbsp;<span class="op" id="4431717">&amp;&amp;</span>&nbsp;<span class="ident" id="4431720">ch</span>&nbsp;<span class="op" id="4431723">&lt;=</span>&nbsp;<span class="string" id="4431726">&#39;z&#39;</span><span class="op" id="4431729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431733">d</span>&nbsp;<span class="op" id="4431735">=</span>&nbsp;<span class="builtintype" id="4431737">int</span><span class="op" id="4431740">(</span><span class="ident" id="4431741">ch</span>&nbsp;<span class="op" id="4431744">-</span>&nbsp;<span class="string" id="4431746">&#39;a&#39;</span>&nbsp;<span class="op" id="4431750">+</span>&nbsp;<span class="num" id="4431752">10</span><span class="op" id="4431754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431757">case</span>&nbsp;<span class="string" id="4431762">&#39;A&#39;</span>&nbsp;<span class="op" id="4431766">&lt;=</span>&nbsp;<span class="ident" id="4431769">ch</span>&nbsp;<span class="op" id="4431772">&amp;&amp;</span>&nbsp;<span class="ident" id="4431775">ch</span>&nbsp;<span class="op" id="4431778">&lt;=</span>&nbsp;<span class="string" id="4431781">&#39;Z&#39;</span><span class="op" id="4431784">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431788">d</span>&nbsp;<span class="op" id="4431790">=</span>&nbsp;<span class="builtintype" id="4431792">int</span><span class="op" id="4431795">(</span><span class="ident" id="4431796">ch</span>&nbsp;<span class="op" id="4431799">-</span>&nbsp;<span class="string" id="4431801">&#39;A&#39;</span>&nbsp;<span class="op" id="4431805">+</span>&nbsp;<span class="num" id="4431807">10</span><span class="op" id="4431809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431815">return</span>&nbsp;<span class="ident" id="4431822">Word</span><span class="op" id="4431826">(</span><span class="ident" id="4431827">d</span><span class="op" id="4431828">)</span><br>
<span class="lineno"></span><span class="op" id="4431830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4431833">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="4431915">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="4431991">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4432070">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4432147">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="4432183">//</span><br>
<span class="lineno"></span><span class="comment" id="4432186">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="4432264">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4432342">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4432418">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="4432496">//</span><br>
<span class="lineno"></span><span class="keyword" id="4432499">func</span>&nbsp;<span class="op" id="4432504">(</span><span class="ident" id="4432505">z</span>&nbsp;<span class="ident" id="4432507">nat</span><span class="op" id="4432510">)</span>&nbsp;<span class="ident" id="4432512">scan</span><span class="op" id="4432516">(</span><span class="ident" id="4432517">r</span>&nbsp;<span class="ident" id="4432519">io</span><span class="op" id="4432521">.</span><span class="ident" id="4432522">RuneScanner</span><span class="op" id="4432533">,</span>&nbsp;<span class="ident" id="4432535">base</span>&nbsp;<span class="builtintype" id="4432540">int</span><span class="op" id="4432543">)</span>&nbsp;<span class="op" id="4432545">(</span><span class="ident" id="4432546">nat</span><span class="op" id="4432549">,</span>&nbsp;<span class="builtintype" id="4432551">int</span><span class="op" id="4432554">,</span>&nbsp;<span class="builtintype" id="4432556">error</span><span class="op" id="4432561">)</span>&nbsp;<span class="op" id="4432563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4432566">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432591">if</span>&nbsp;<span class="ident" id="4432594">base</span>&nbsp;<span class="op" id="4432599">&lt;</span>&nbsp;<span class="num" id="4432601">0</span>&nbsp;<span class="op" id="4432603">||</span>&nbsp;<span class="ident" id="4432606">base</span>&nbsp;<span class="op" id="4432611">==</span>&nbsp;<span class="num" id="4432614">1</span>&nbsp;<span class="op" id="4432616">||</span>&nbsp;<span class="ident" id="4432619">MaxBase</span>&nbsp;<span class="op" id="4432627">&lt;</span>&nbsp;<span class="ident" id="4432629">base</span>&nbsp;<span class="op" id="4432634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432638">return</span>&nbsp;<span class="ident" id="4432645">z</span><span class="op" id="4432646">,</span>&nbsp;<span class="num" id="4432648">0</span><span class="op" id="4432649">,</span>&nbsp;<span class="ident" id="4432651">errors</span><span class="op" id="4432657">.</span><span class="ident" id="4432658">New</span><span class="op" id="4432661">(</span><span class="string" id="4432662">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="4432683">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4432690">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432714">ch</span><span class="op" id="4432716">,</span>&nbsp;<span class="ident" id="4432718">_</span><span class="op" id="4432719">,</span>&nbsp;<span class="ident" id="4432721">err</span>&nbsp;<span class="op" id="4432725">:=</span>&nbsp;<span class="ident" id="4432728">r</span><span class="op" id="4432729">.</span><span class="ident" id="4432730">ReadRune</span><span class="op" id="4432738">(</span><span class="op" id="4432739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432742">if</span>&nbsp;<span class="ident" id="4432745">err</span>&nbsp;<span class="op" id="4432749">!=</span>&nbsp;<span class="ident" id="4432752">nil</span>&nbsp;<span class="op" id="4432756">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432760">return</span>&nbsp;<span class="ident" id="4432767">z</span><span class="op" id="4432768">,</span>&nbsp;<span class="num" id="4432770">0</span><span class="op" id="4432771">,</span>&nbsp;<span class="ident" id="4432773">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4432782">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432814">b</span>&nbsp;<span class="op" id="4432816">:=</span>&nbsp;<span class="ident" id="4432819">Word</span><span class="op" id="4432823">(</span><span class="ident" id="4432824">base</span><span class="op" id="4432828">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432831">if</span>&nbsp;<span class="ident" id="4432834">base</span>&nbsp;<span class="op" id="4432839">==</span>&nbsp;<span class="num" id="4432842">0</span>&nbsp;<span class="op" id="4432844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432848">b</span>&nbsp;<span class="op" id="4432850">=</span>&nbsp;<span class="num" id="4432852">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432857">if</span>&nbsp;<span class="ident" id="4432860">ch</span>&nbsp;<span class="op" id="4432863">==</span>&nbsp;<span class="string" id="4432866">&#39;0&#39;</span>&nbsp;<span class="op" id="4432870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432875">switch</span>&nbsp;<span class="ident" id="4432882">ch</span><span class="op" id="4432884">,</span>&nbsp;<span class="ident" id="4432886">_</span><span class="op" id="4432887">,</span>&nbsp;<span class="ident" id="4432889">err</span>&nbsp;<span class="op" id="4432893">=</span>&nbsp;<span class="ident" id="4432895">r</span><span class="op" id="4432896">.</span><span class="ident" id="4432897">ReadRune</span><span class="op" id="4432905">(</span><span class="op" id="4432906">)</span><span class="op" id="4432907">;</span>&nbsp;<span class="ident" id="4432909">err</span>&nbsp;<span class="op" id="4432913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432918">case</span>&nbsp;<span class="ident" id="4432923">nil</span><span class="op" id="4432926">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432932">b</span>&nbsp;<span class="op" id="4432934">=</span>&nbsp;<span class="num" id="4432936">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432942">switch</span>&nbsp;<span class="ident" id="4432949">ch</span>&nbsp;<span class="op" id="4432952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432958">case</span>&nbsp;<span class="string" id="4432963">&#39;x&#39;</span><span class="op" id="4432966">,</span>&nbsp;<span class="string" id="4432968">&#39;X&#39;</span><span class="op" id="4432971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432978">b</span>&nbsp;<span class="op" id="4432980">=</span>&nbsp;<span class="num" id="4432982">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432989">case</span>&nbsp;<span class="string" id="4432994">&#39;b&#39;</span><span class="op" id="4432997">,</span>&nbsp;<span class="string" id="4432999">&#39;B&#39;</span><span class="op" id="4433002">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433009">b</span>&nbsp;<span class="op" id="4433011">=</span>&nbsp;<span class="num" id="4433013">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433025">if</span>&nbsp;<span class="ident" id="4433028">b</span>&nbsp;<span class="op" id="4433030">==</span>&nbsp;<span class="num" id="4433033">2</span>&nbsp;<span class="op" id="4433035">||</span>&nbsp;<span class="ident" id="4433038">b</span>&nbsp;<span class="op" id="4433040">==</span>&nbsp;<span class="num" id="4433043">16</span>&nbsp;<span class="op" id="4433046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433053">if</span>&nbsp;<span class="ident" id="4433056">ch</span><span class="op" id="4433058">,</span>&nbsp;<span class="ident" id="4433060">_</span><span class="op" id="4433061">,</span>&nbsp;<span class="ident" id="4433063">err</span>&nbsp;<span class="op" id="4433067">=</span>&nbsp;<span class="ident" id="4433069">r</span><span class="op" id="4433070">.</span><span class="ident" id="4433071">ReadRune</span><span class="op" id="4433079">(</span><span class="op" id="4433080">)</span><span class="op" id="4433081">;</span>&nbsp;<span class="ident" id="4433083">err</span>&nbsp;<span class="op" id="4433087">!=</span>&nbsp;<span class="ident" id="4433090">nil</span>&nbsp;<span class="op" id="4433094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433102">return</span>&nbsp;<span class="ident" id="4433109">z</span><span class="op" id="4433110">,</span>&nbsp;<span class="num" id="4433112">0</span><span class="op" id="4433113">,</span>&nbsp;<span class="ident" id="4433115">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433135">case</span>&nbsp;<span class="ident" id="4433140">io</span><span class="op" id="4433142">.</span><span class="ident" id="4433143">EOF</span><span class="op" id="4433146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433152">return</span>&nbsp;<span class="ident" id="4433159">z</span><span class="op" id="4433160">.</span><span class="builtinfunc" id="4433161">make</span><span class="op" id="4433165">(</span><span class="num" id="4433166">0</span><span class="op" id="4433167">)</span><span class="op" id="4433168">,</span>&nbsp;<span class="num" id="4433170">10</span><span class="op" id="4433172">,</span>&nbsp;<span class="ident" id="4433174">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433181">default</span><span class="op" id="4433188">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433194">return</span>&nbsp;<span class="ident" id="4433201">z</span><span class="op" id="4433202">,</span>&nbsp;<span class="num" id="4433204">10</span><span class="op" id="4433206">,</span>&nbsp;<span class="ident" id="4433208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433226">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433245">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433340">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433435">z</span>&nbsp;<span class="op" id="4433437">=</span>&nbsp;<span class="ident" id="4433439">z</span><span class="op" id="4433440">.</span><span class="builtinfunc" id="4433441">make</span><span class="op" id="4433445">(</span><span class="num" id="4433446">0</span><span class="op" id="4433447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433450">bb</span>&nbsp;<span class="op" id="4433453">:=</span>&nbsp;<span class="ident" id="4433456">Word</span><span class="op" id="4433460">(</span><span class="num" id="4433461">1</span><span class="op" id="4433462">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433465">dd</span>&nbsp;<span class="op" id="4433468">:=</span>&nbsp;<span class="ident" id="4433471">Word</span><span class="op" id="4433475">(</span><span class="num" id="4433476">0</span><span class="op" id="4433477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433480">for</span>&nbsp;<span class="ident" id="4433484">max</span>&nbsp;<span class="op" id="4433488">:=</span>&nbsp;<span class="ident" id="4433491">_M</span>&nbsp;<span class="op" id="4433494">/</span>&nbsp;<span class="ident" id="4433496">b</span><span class="op" id="4433497">;</span>&nbsp;<span class="op" id="4433499">;</span>&nbsp;<span class="op" id="4433501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433505">d</span>&nbsp;<span class="op" id="4433507">:=</span>&nbsp;<span class="ident" id="4433510">hexValue</span><span class="op" id="4433518">(</span><span class="ident" id="4433519">ch</span><span class="op" id="4433521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433525">if</span>&nbsp;<span class="ident" id="4433528">d</span>&nbsp;<span class="op" id="4433530">&gt;=</span>&nbsp;<span class="ident" id="4433533">b</span>&nbsp;<span class="op" id="4433535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433540">r</span><span class="op" id="4433541">.</span><span class="ident" id="4433542">UnreadRune</span><span class="op" id="4433552">(</span><span class="op" id="4433553">)</span>&nbsp;<span class="comment" id="4433555">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433598">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433611">if</span>&nbsp;<span class="ident" id="4433614">bb</span>&nbsp;<span class="op" id="4433617">&lt;=</span>&nbsp;<span class="ident" id="4433620">max</span>&nbsp;<span class="op" id="4433624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433629">bb</span>&nbsp;<span class="op" id="4433632">*=</span>&nbsp;<span class="ident" id="4433635">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433640">dd</span>&nbsp;<span class="op" id="4433643">=</span>&nbsp;<span class="ident" id="4433645">dd</span><span class="op" id="4433647">*</span><span class="ident" id="4433648">b</span>&nbsp;<span class="op" id="4433650">+</span>&nbsp;<span class="ident" id="4433652">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433656">}</span>&nbsp;<span class="keyword" id="4433658">else</span>&nbsp;<span class="op" id="4433663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433668">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433696">z</span>&nbsp;<span class="op" id="4433698">=</span>&nbsp;<span class="ident" id="4433700">z</span><span class="op" id="4433701">.</span><span class="ident" id="4433702">mulAddWW</span><span class="op" id="4433710">(</span><span class="ident" id="4433711">z</span><span class="op" id="4433712">,</span>&nbsp;<span class="ident" id="4433714">bb</span><span class="op" id="4433716">,</span>&nbsp;<span class="ident" id="4433718">dd</span><span class="op" id="4433720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433725">bb</span>&nbsp;<span class="op" id="4433728">=</span>&nbsp;<span class="ident" id="4433730">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433735">dd</span>&nbsp;<span class="op" id="4433738">=</span>&nbsp;<span class="ident" id="4433740">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433749">if</span>&nbsp;<span class="ident" id="4433752">ch</span><span class="op" id="4433754">,</span>&nbsp;<span class="ident" id="4433756">_</span><span class="op" id="4433757">,</span>&nbsp;<span class="ident" id="4433759">err</span>&nbsp;<span class="op" id="4433763">=</span>&nbsp;<span class="ident" id="4433765">r</span><span class="op" id="4433766">.</span><span class="ident" id="4433767">ReadRune</span><span class="op" id="4433775">(</span><span class="op" id="4433776">)</span><span class="op" id="4433777">;</span>&nbsp;<span class="ident" id="4433779">err</span>&nbsp;<span class="op" id="4433783">!=</span>&nbsp;<span class="ident" id="4433786">nil</span>&nbsp;<span class="op" id="4433790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433795">if</span>&nbsp;<span class="ident" id="4433798">err</span>&nbsp;<span class="op" id="4433802">!=</span>&nbsp;<span class="ident" id="4433805">io</span><span class="op" id="4433807">.</span><span class="ident" id="4433808">EOF</span>&nbsp;<span class="op" id="4433812">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433818">return</span>&nbsp;<span class="ident" id="4433825">z</span><span class="op" id="4433826">,</span>&nbsp;<span class="builtintype" id="4433828">int</span><span class="op" id="4433831">(</span><span class="ident" id="4433832">b</span><span class="op" id="4433833">)</span><span class="op" id="4433834">,</span>&nbsp;<span class="ident" id="4433836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433848">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433859">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433863">switch</span>&nbsp;<span class="op" id="4433870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433873">case</span>&nbsp;<span class="ident" id="4433878">bb</span>&nbsp;<span class="op" id="4433881">&gt;</span>&nbsp;<span class="num" id="4433883">1</span><span class="op" id="4433884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433888">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433931">z</span>&nbsp;<span class="op" id="4433933">=</span>&nbsp;<span class="ident" id="4433935">z</span><span class="op" id="4433936">.</span><span class="ident" id="4433937">mulAddWW</span><span class="op" id="4433945">(</span><span class="ident" id="4433946">z</span><span class="op" id="4433947">,</span>&nbsp;<span class="ident" id="4433949">bb</span><span class="op" id="4433951">,</span>&nbsp;<span class="ident" id="4433953">dd</span><span class="op" id="4433955">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433958">case</span>&nbsp;<span class="ident" id="4433963">base</span>&nbsp;<span class="op" id="4433968">==</span>&nbsp;<span class="num" id="4433971">0</span>&nbsp;<span class="op" id="4433973">&amp;&amp;</span>&nbsp;<span class="ident" id="4433976">b</span>&nbsp;<span class="op" id="4433978">==</span>&nbsp;<span class="num" id="4433981">8</span><span class="op" id="4433982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433986">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434060">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434087">return</span>&nbsp;<span class="ident" id="4434094">z</span><span class="op" id="4434095">,</span>&nbsp;<span class="num" id="4434097">10</span><span class="op" id="4434099">,</span>&nbsp;<span class="ident" id="4434101">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434106">case</span>&nbsp;<span class="ident" id="4434111">base</span>&nbsp;<span class="op" id="4434116">!=</span>&nbsp;<span class="num" id="4434119">0</span>&nbsp;<span class="op" id="4434121">||</span>&nbsp;<span class="ident" id="4434124">b</span>&nbsp;<span class="op" id="4434126">!=</span>&nbsp;<span class="num" id="4434129">8</span><span class="op" id="4434130">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434134">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434197">return</span>&nbsp;<span class="ident" id="4434204">z</span><span class="op" id="4434205">,</span>&nbsp;<span class="builtintype" id="4434207">int</span><span class="op" id="4434210">(</span><span class="ident" id="4434211">b</span><span class="op" id="4434212">)</span><span class="op" id="4434213">,</span>&nbsp;<span class="ident" id="4434215">errors</span><span class="op" id="4434221">.</span><span class="ident" id="4434222">New</span><span class="op" id="4434225">(</span><span class="string" id="4434226">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="4434256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434263">return</span>&nbsp;<span class="ident" id="4434270">z</span><span class="op" id="4434271">.</span><span class="ident" id="4434272">norm</span><span class="op" id="4434276">(</span><span class="op" id="4434277">)</span><span class="op" id="4434278">,</span>&nbsp;<span class="builtintype" id="4434280">int</span><span class="op" id="4434283">(</span><span class="ident" id="4434284">b</span><span class="op" id="4434285">)</span><span class="op" id="4434286">,</span>&nbsp;<span class="ident" id="4434288">nil</span><br>
<span class="lineno">720</span><span class="op" id="4434292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4434295">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="4434336">const</span>&nbsp;<span class="op" id="4434342">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434345">lowercaseDigits</span>&nbsp;<span class="op" id="4434361">=</span>&nbsp;<span class="string" id="4434363">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434403">uppercaseDigits</span>&nbsp;<span class="op" id="4434419">=</span>&nbsp;<span class="string" id="4434421">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="4434460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4434463">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="4434519">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="4434571">func</span>&nbsp;<span class="op" id="4434576">(</span><span class="ident" id="4434577">x</span>&nbsp;<span class="ident" id="4434579">nat</span><span class="op" id="4434582">)</span>&nbsp;<span class="ident" id="4434584">decimalString</span><span class="op" id="4434597">(</span><span class="op" id="4434598">)</span>&nbsp;<span class="builtintype" id="4434600">string</span>&nbsp;<span class="op" id="4434607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434610">return</span>&nbsp;<span class="ident" id="4434617">x</span><span class="op" id="4434618">.</span><span class="builtintype" id="4434619">string</span><span class="op" id="4434625">(</span><span class="ident" id="4434626">lowercaseDigits</span><span class="op" id="4434641">[</span><span class="num" id="4434642">0</span><span class="op" id="4434643">:</span><span class="num" id="4434644">10</span><span class="op" id="4434646">]</span><span class="op" id="4434647">)</span><br>
<span class="lineno"></span><span class="op" id="4434649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4434652">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="4434727">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="4434802">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="4434853">func</span>&nbsp;<span class="op" id="4434858">(</span><span class="ident" id="4434859">x</span>&nbsp;<span class="ident" id="4434861">nat</span><span class="op" id="4434864">)</span>&nbsp;<span class="builtintype" id="4434866">string</span><span class="op" id="4434872">(</span><span class="ident" id="4434873">charset</span>&nbsp;<span class="builtintype" id="4434881">string</span><span class="op" id="4434887">)</span>&nbsp;<span class="builtintype" id="4434889">string</span>&nbsp;<span class="op" id="4434896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434899">b</span>&nbsp;<span class="op" id="4434901">:=</span>&nbsp;<span class="ident" id="4434904">Word</span><span class="op" id="4434908">(</span><span class="builtinfunc" id="4434909">len</span><span class="op" id="4434912">(</span><span class="ident" id="4434913">charset</span><span class="op" id="4434920">)</span><span class="op" id="4434921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434925">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434943">switch</span>&nbsp;<span class="op" id="4434950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434953">case</span>&nbsp;<span class="ident" id="4434958">b</span>&nbsp;<span class="op" id="4434960">&lt;</span>&nbsp;<span class="num" id="4434962">2</span>&nbsp;<span class="op" id="4434964">||</span>&nbsp;<span class="ident" id="4434967">MaxBase</span>&nbsp;<span class="op" id="4434975">&gt;</span>&nbsp;<span class="num" id="4434977">256</span><span class="op" id="4434980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4434984">panic</span><span class="op" id="4434989">(</span><span class="string" id="4434990">&#34;illegal&nbsp;base&#34;</span><span class="op" id="4435004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435007">case</span>&nbsp;<span class="builtinfunc" id="4435012">len</span><span class="op" id="4435015">(</span><span class="ident" id="4435016">x</span><span class="op" id="4435017">)</span>&nbsp;<span class="op" id="4435019">==</span>&nbsp;<span class="num" id="4435022">0</span><span class="op" id="4435023">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435027">return</span>&nbsp;<span class="builtintype" id="4435034">string</span><span class="op" id="4435040">(</span><span class="ident" id="4435041">charset</span><span class="op" id="4435048">[</span><span class="num" id="4435049">0</span><span class="op" id="4435050">]</span><span class="op" id="4435051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435058">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435093">i</span>&nbsp;<span class="op" id="4435095">:=</span>&nbsp;<span class="builtintype" id="4435098">int</span><span class="op" id="4435101">(</span><span class="builtintype" id="4435102">float64</span><span class="op" id="4435109">(</span><span class="ident" id="4435110">x</span><span class="op" id="4435111">.</span><span class="ident" id="4435112">bitLen</span><span class="op" id="4435118">(</span><span class="op" id="4435119">)</span><span class="op" id="4435120">)</span><span class="op" id="4435121">/</span><span class="ident" id="4435122">math</span><span class="op" id="4435126">.</span><span class="ident" id="4435127">Log2</span><span class="op" id="4435131">(</span><span class="builtintype" id="4435132">float64</span><span class="op" id="4435139">(</span><span class="ident" id="4435140">b</span><span class="op" id="4435141">)</span><span class="op" id="4435142">)</span><span class="op" id="4435143">)</span>&nbsp;<span class="op" id="4435145">+</span>&nbsp;<span class="num" id="4435147">1</span>&nbsp;<span class="comment" id="4435149">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435172">s</span>&nbsp;<span class="op" id="4435174">:=</span>&nbsp;<span class="builtinfunc" id="4435177">make</span><span class="op" id="4435181">(</span><span class="op" id="4435182">[</span><span class="op" id="4435183">]</span><span class="builtintype" id="4435184">byte</span><span class="op" id="4435188">,</span>&nbsp;<span class="ident" id="4435190">i</span><span class="op" id="4435191">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435195">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435258">if</span>&nbsp;<span class="ident" id="4435261">b</span>&nbsp;<span class="op" id="4435263">==</span>&nbsp;<span class="ident" id="4435266">b</span><span class="op" id="4435267">&amp;</span><span class="op" id="4435268">-</span><span class="ident" id="4435269">b</span>&nbsp;<span class="op" id="4435271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435275">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435315">shift</span>&nbsp;<span class="op" id="4435321">:=</span>&nbsp;<span class="ident" id="4435324">trailingZeroBits</span><span class="op" id="4435340">(</span><span class="ident" id="4435341">b</span><span class="op" id="4435342">)</span>&nbsp;<span class="comment" id="4435344">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435374">mask</span>&nbsp;<span class="op" id="4435379">:=</span>&nbsp;<span class="ident" id="4435382">Word</span><span class="op" id="4435386">(</span><span class="num" id="4435387">1</span><span class="op" id="4435388">)</span><span class="op" id="4435389">&lt;&lt;</span><span class="ident" id="4435391">shift</span>&nbsp;<span class="op" id="4435397">-</span>&nbsp;<span class="num" id="4435399">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435403">w</span>&nbsp;<span class="op" id="4435405">:=</span>&nbsp;<span class="ident" id="4435408">x</span><span class="op" id="4435409">[</span><span class="num" id="4435410">0</span><span class="op" id="4435411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435415">nbits</span>&nbsp;<span class="op" id="4435421">:=</span>&nbsp;<span class="builtintype" id="4435424">uint</span><span class="op" id="4435428">(</span><span class="ident" id="4435429">_W</span><span class="op" id="4435431">)</span>&nbsp;<span class="comment" id="4435433">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435471">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435507">for</span>&nbsp;<span class="ident" id="4435511">k</span>&nbsp;<span class="op" id="4435513">:=</span>&nbsp;<span class="num" id="4435516">1</span><span class="op" id="4435517">;</span>&nbsp;<span class="ident" id="4435519">k</span>&nbsp;<span class="op" id="4435521">&lt;</span>&nbsp;<span class="builtinfunc" id="4435523">len</span><span class="op" id="4435526">(</span><span class="ident" id="4435527">x</span><span class="op" id="4435528">)</span><span class="op" id="4435529">;</span>&nbsp;<span class="ident" id="4435531">k</span><span class="op" id="4435532">++</span>&nbsp;<span class="op" id="4435535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435540">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435566">for</span>&nbsp;<span class="ident" id="4435570">nbits</span>&nbsp;<span class="op" id="4435576">&gt;=</span>&nbsp;<span class="ident" id="4435579">shift</span>&nbsp;<span class="op" id="4435585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435591">i</span><span class="op" id="4435592">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435599">s</span><span class="op" id="4435600">[</span><span class="ident" id="4435601">i</span><span class="op" id="4435602">]</span>&nbsp;<span class="op" id="4435604">=</span>&nbsp;<span class="ident" id="4435606">charset</span><span class="op" id="4435613">[</span><span class="ident" id="4435614">w</span><span class="op" id="4435615">&amp;</span><span class="ident" id="4435616">mask</span><span class="op" id="4435620">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435626">w</span>&nbsp;<span class="op" id="4435628">&gt;&gt;=</span>&nbsp;<span class="ident" id="4435632">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435642">nbits</span>&nbsp;<span class="op" id="4435648">-=</span>&nbsp;<span class="ident" id="4435651">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435666">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435731">if</span>&nbsp;<span class="ident" id="4435734">nbits</span>&nbsp;<span class="op" id="4435740">==</span>&nbsp;<span class="num" id="4435743">0</span>&nbsp;<span class="op" id="4435745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435751">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435799">w</span>&nbsp;<span class="op" id="4435801">=</span>&nbsp;<span class="ident" id="4435803">x</span><span class="op" id="4435804">[</span><span class="ident" id="4435805">k</span><span class="op" id="4435806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435812">nbits</span>&nbsp;<span class="op" id="4435818">=</span>&nbsp;<span class="ident" id="4435820">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435826">}</span>&nbsp;<span class="keyword" id="4435828">else</span>&nbsp;<span class="op" id="4435833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435839">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435895">w</span>&nbsp;<span class="op" id="4435897">|=</span>&nbsp;<span class="ident" id="4435900">x</span><span class="op" id="4435901">[</span><span class="ident" id="4435902">k</span><span class="op" id="4435903">]</span>&nbsp;<span class="op" id="4435905">&lt;&lt;</span>&nbsp;<span class="ident" id="4435908">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435918">i</span><span class="op" id="4435919">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435926">s</span><span class="op" id="4435927">[</span><span class="ident" id="4435928">i</span><span class="op" id="4435929">]</span>&nbsp;<span class="op" id="4435931">=</span>&nbsp;<span class="ident" id="4435933">charset</span><span class="op" id="4435940">[</span><span class="ident" id="4435941">w</span><span class="op" id="4435942">&amp;</span><span class="ident" id="4435943">mask</span><span class="op" id="4435947">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435954">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435969">w</span>&nbsp;<span class="op" id="4435971">=</span>&nbsp;<span class="ident" id="4435973">x</span><span class="op" id="4435974">[</span><span class="ident" id="4435975">k</span><span class="op" id="4435976">]</span>&nbsp;<span class="op" id="4435978">&gt;&gt;</span>&nbsp;<span class="op" id="4435981">(</span><span class="ident" id="4435982">shift</span>&nbsp;<span class="op" id="4435988">-</span>&nbsp;<span class="ident" id="4435990">nbits</span><span class="op" id="4435995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436001">nbits</span>&nbsp;<span class="op" id="4436007">=</span>&nbsp;<span class="ident" id="4436009">_W</span>&nbsp;<span class="op" id="4436012">-</span>&nbsp;<span class="op" id="4436014">(</span><span class="ident" id="4436015">shift</span>&nbsp;<span class="op" id="4436021">-</span>&nbsp;<span class="ident" id="4436023">nbits</span><span class="op" id="4436028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436033">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436042">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436108">for</span>&nbsp;<span class="ident" id="4436112">nbits</span>&nbsp;<span class="op" id="4436118">&gt;=</span>&nbsp;<span class="num" id="4436121">0</span>&nbsp;<span class="op" id="4436123">&amp;&amp;</span>&nbsp;<span class="ident" id="4436126">w</span>&nbsp;<span class="op" id="4436128">!=</span>&nbsp;<span class="num" id="4436131">0</span>&nbsp;<span class="op" id="4436133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436138">i</span><span class="op" id="4436139">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436145">s</span><span class="op" id="4436146">[</span><span class="ident" id="4436147">i</span><span class="op" id="4436148">]</span>&nbsp;<span class="op" id="4436150">=</span>&nbsp;<span class="ident" id="4436152">charset</span><span class="op" id="4436159">[</span><span class="ident" id="4436160">w</span><span class="op" id="4436161">&amp;</span><span class="ident" id="4436162">mask</span><span class="op" id="4436166">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436171">w</span>&nbsp;<span class="op" id="4436173">&gt;&gt;=</span>&nbsp;<span class="ident" id="4436177">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436186">nbits</span>&nbsp;<span class="op" id="4436192">-=</span>&nbsp;<span class="ident" id="4436195">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436207">}</span>&nbsp;<span class="keyword" id="4436209">else</span>&nbsp;<span class="op" id="4436214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436218">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436281">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436339">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436396">bb</span>&nbsp;<span class="op" id="4436399">:=</span>&nbsp;<span class="ident" id="4436402">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4436409">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436437">ndigits</span>&nbsp;<span class="op" id="4436445">:=</span>&nbsp;<span class="num" id="4436448">1</span>&nbsp;<span class="comment" id="4436450">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436479">for</span>&nbsp;<span class="ident" id="4436483">max</span>&nbsp;<span class="op" id="4436487">:=</span>&nbsp;<span class="ident" id="4436490">Word</span><span class="op" id="4436494">(</span><span class="ident" id="4436495">_M</span>&nbsp;<span class="op" id="4436498">/</span>&nbsp;<span class="ident" id="4436500">b</span><span class="op" id="4436501">)</span><span class="op" id="4436502">;</span>&nbsp;<span class="ident" id="4436504">bb</span>&nbsp;<span class="op" id="4436507">&lt;=</span>&nbsp;<span class="ident" id="4436510">max</span><span class="op" id="4436513">;</span>&nbsp;<span class="ident" id="4436515">bb</span>&nbsp;<span class="op" id="4436518">*=</span>&nbsp;<span class="ident" id="4436521">b</span>&nbsp;<span class="op" id="4436523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436528">ndigits</span><span class="op" id="4436535">++</span>&nbsp;<span class="comment" id="4436538">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436597">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436678">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436733">table</span>&nbsp;<span class="op" id="4436739">:=</span>&nbsp;<span class="ident" id="4436742">divisors</span><span class="op" id="4436750">(</span><span class="builtinfunc" id="4436751">len</span><span class="op" id="4436754">(</span><span class="ident" id="4436755">x</span><span class="op" id="4436756">)</span><span class="op" id="4436757">,</span>&nbsp;<span class="ident" id="4436759">b</span><span class="op" id="4436760">,</span>&nbsp;<span class="ident" id="4436762">ndigits</span><span class="op" id="4436769">,</span>&nbsp;<span class="ident" id="4436771">bb</span><span class="op" id="4436773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436778">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436837">q</span>&nbsp;<span class="op" id="4436839">:=</span>&nbsp;<span class="ident" id="4436842">nat</span><span class="op" id="4436845">(</span><span class="ident" id="4436846">nil</span><span class="op" id="4436849">)</span><span class="op" id="4436850">.</span><span class="ident" id="4436851">set</span><span class="op" id="4436854">(</span><span class="ident" id="4436855">x</span><span class="op" id="4436856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436861">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436898">q</span><span class="op" id="4436899">.</span><span class="ident" id="4436900">convertWords</span><span class="op" id="4436912">(</span><span class="ident" id="4436913">s</span><span class="op" id="4436914">,</span>&nbsp;<span class="ident" id="4436916">charset</span><span class="op" id="4436923">,</span>&nbsp;<span class="ident" id="4436925">b</span><span class="op" id="4436926">,</span>&nbsp;<span class="ident" id="4436928">ndigits</span><span class="op" id="4436935">,</span>&nbsp;<span class="ident" id="4436937">bb</span><span class="op" id="4436939">,</span>&nbsp;<span class="ident" id="4436941">table</span><span class="op" id="4436946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436951">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436976">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437038">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437072">i</span>&nbsp;<span class="op" id="4437074">=</span>&nbsp;<span class="num" id="4437076">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437080">for</span>&nbsp;<span class="ident" id="4437084">zero</span>&nbsp;<span class="op" id="4437089">:=</span>&nbsp;<span class="ident" id="4437092">charset</span><span class="op" id="4437099">[</span><span class="num" id="4437100">0</span><span class="op" id="4437101">]</span><span class="op" id="4437102">;</span>&nbsp;<span class="ident" id="4437104">s</span><span class="op" id="4437105">[</span><span class="ident" id="4437106">i</span><span class="op" id="4437107">]</span>&nbsp;<span class="op" id="4437109">==</span>&nbsp;<span class="ident" id="4437112">zero</span><span class="op" id="4437116">;</span>&nbsp;<span class="op" id="4437118">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437123">i</span><span class="op" id="4437124">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437136">return</span>&nbsp;<span class="builtintype" id="4437143">string</span><span class="op" id="4437149">(</span><span class="ident" id="4437150">s</span><span class="op" id="4437151">[</span><span class="ident" id="4437152">i</span><span class="op" id="4437153">:</span><span class="op" id="4437154">]</span><span class="op" id="4437155">)</span><br>
<span class="lineno">825</span><span class="op" id="4437157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437160">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4437254">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="4437348">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="4437379">//</span><br>
<span class="lineno"></span><span class="comment" id="4437382">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4437482">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="4437579">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="4437675">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="4437771">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4437869">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="4437966">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4438063">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4438161">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="4438257">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4438350">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="4438372">//</span><br>
<span class="lineno"></span><span class="keyword" id="4438375">func</span>&nbsp;<span class="op" id="4438380">(</span><span class="ident" id="4438381">q</span>&nbsp;<span class="ident" id="4438383">nat</span><span class="op" id="4438386">)</span>&nbsp;<span class="ident" id="4438388">convertWords</span><span class="op" id="4438400">(</span><span class="ident" id="4438401">s</span>&nbsp;<span class="op" id="4438403">[</span><span class="op" id="4438404">]</span><span class="builtintype" id="4438405">byte</span><span class="op" id="4438409">,</span>&nbsp;<span class="ident" id="4438411">charset</span>&nbsp;<span class="builtintype" id="4438419">string</span><span class="op" id="4438425">,</span>&nbsp;<span class="ident" id="4438427">b</span>&nbsp;<span class="ident" id="4438429">Word</span><span class="op" id="4438433">,</span>&nbsp;<span class="ident" id="4438435">ndigits</span>&nbsp;<span class="builtintype" id="4438443">int</span><span class="op" id="4438446">,</span>&nbsp;<span class="ident" id="4438448">bb</span>&nbsp;<span class="ident" id="4438451">Word</span><span class="op" id="4438455">,</span>&nbsp;<span class="ident" id="4438457">table</span>&nbsp;<span class="op" id="4438463">[</span><span class="op" id="4438464">]</span><span class="ident" id="4438465">divisor</span><span class="op" id="4438472">)</span>&nbsp;<span class="op" id="4438474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438477">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438513">if</span>&nbsp;<span class="ident" id="4438516">table</span>&nbsp;<span class="op" id="4438522">!=</span>&nbsp;<span class="ident" id="4438525">nil</span>&nbsp;<span class="op" id="4438529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438533">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438560">var</span>&nbsp;<span class="ident" id="4438564">r</span>&nbsp;<span class="ident" id="4438566">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438572">index</span>&nbsp;<span class="op" id="4438578">:=</span>&nbsp;<span class="builtinfunc" id="4438581">len</span><span class="op" id="4438584">(</span><span class="ident" id="4438585">table</span><span class="op" id="4438590">)</span>&nbsp;<span class="op" id="4438592">-</span>&nbsp;<span class="num" id="4438594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438598">for</span>&nbsp;<span class="builtinfunc" id="4438602">len</span><span class="op" id="4438605">(</span><span class="ident" id="4438606">q</span><span class="op" id="4438607">)</span>&nbsp;<span class="op" id="4438609">&gt;</span>&nbsp;<span class="ident" id="4438611">leafSize</span>&nbsp;<span class="op" id="4438620">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438625">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438694">maxLength</span>&nbsp;<span class="op" id="4438704">:=</span>&nbsp;<span class="ident" id="4438707">q</span><span class="op" id="4438708">.</span><span class="ident" id="4438709">bitLen</span><span class="op" id="4438715">(</span><span class="op" id="4438716">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4438722">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438792">minLength</span>&nbsp;<span class="op" id="4438802">:=</span>&nbsp;<span class="ident" id="4438805">maxLength</span>&nbsp;<span class="op" id="4438815">&gt;&gt;</span>&nbsp;<span class="num" id="4438818">1</span>&nbsp;<span class="comment" id="4438820">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438842">for</span>&nbsp;<span class="ident" id="4438846">index</span>&nbsp;<span class="op" id="4438852">&gt;</span>&nbsp;<span class="num" id="4438854">0</span>&nbsp;<span class="op" id="4438856">&amp;&amp;</span>&nbsp;<span class="ident" id="4438859">table</span><span class="op" id="4438864">[</span><span class="ident" id="4438865">index</span><span class="op" id="4438870">-</span><span class="num" id="4438871">1</span><span class="op" id="4438872">]</span><span class="op" id="4438873">.</span><span class="ident" id="4438874">nbits</span>&nbsp;<span class="op" id="4438880">&gt;</span>&nbsp;<span class="ident" id="4438882">minLength</span>&nbsp;<span class="op" id="4438892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438898">index</span><span class="op" id="4438903">--</span>&nbsp;<span class="comment" id="4438906">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438925">if</span>&nbsp;<span class="ident" id="4438928">table</span><span class="op" id="4438933">[</span><span class="ident" id="4438934">index</span><span class="op" id="4438939">]</span><span class="op" id="4438940">.</span><span class="ident" id="4438941">nbits</span>&nbsp;<span class="op" id="4438947">&gt;=</span>&nbsp;<span class="ident" id="4438950">maxLength</span>&nbsp;<span class="op" id="4438960">&amp;&amp;</span>&nbsp;<span class="ident" id="4438963">table</span><span class="op" id="4438968">[</span><span class="ident" id="4438969">index</span><span class="op" id="4438974">]</span><span class="op" id="4438975">.</span><span class="ident" id="4438976">bbb</span><span class="op" id="4438979">.</span><span class="ident" id="4438980">cmp</span><span class="op" id="4438983">(</span><span class="ident" id="4438984">q</span><span class="op" id="4438985">)</span>&nbsp;<span class="op" id="4438987">&gt;=</span>&nbsp;<span class="num" id="4438990">0</span>&nbsp;<span class="op" id="4438992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438998">index</span><span class="op" id="4439003">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439010">if</span>&nbsp;<span class="ident" id="4439013">index</span>&nbsp;<span class="op" id="4439019">&lt;</span>&nbsp;<span class="num" id="4439021">0</span>&nbsp;<span class="op" id="4439023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4439030">panic</span><span class="op" id="4439035">(</span><span class="string" id="4439036">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="4439060">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439077">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439160">q</span><span class="op" id="4439161">,</span>&nbsp;<span class="ident" id="4439163">r</span>&nbsp;<span class="op" id="4439165">=</span>&nbsp;<span class="ident" id="4439167">q</span><span class="op" id="4439168">.</span><span class="ident" id="4439169">div</span><span class="op" id="4439172">(</span><span class="ident" id="4439173">r</span><span class="op" id="4439174">,</span>&nbsp;<span class="ident" id="4439176">q</span><span class="op" id="4439177">,</span>&nbsp;<span class="ident" id="4439179">table</span><span class="op" id="4439184">[</span><span class="ident" id="4439185">index</span><span class="op" id="4439190">]</span><span class="op" id="4439191">.</span><span class="ident" id="4439192">bbb</span><span class="op" id="4439195">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439201">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439264">h</span>&nbsp;<span class="op" id="4439266">:=</span>&nbsp;<span class="builtinfunc" id="4439269">len</span><span class="op" id="4439272">(</span><span class="ident" id="4439273">s</span><span class="op" id="4439274">)</span>&nbsp;<span class="op" id="4439276">-</span>&nbsp;<span class="ident" id="4439278">table</span><span class="op" id="4439283">[</span><span class="ident" id="4439284">index</span><span class="op" id="4439289">]</span><span class="op" id="4439290">.</span><span class="ident" id="4439291">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439302">r</span><span class="op" id="4439303">.</span><span class="ident" id="4439304">convertWords</span><span class="op" id="4439316">(</span><span class="ident" id="4439317">s</span><span class="op" id="4439318">[</span><span class="ident" id="4439319">h</span><span class="op" id="4439320">:</span><span class="op" id="4439321">]</span><span class="op" id="4439322">,</span>&nbsp;<span class="ident" id="4439324">charset</span><span class="op" id="4439331">,</span>&nbsp;<span class="ident" id="4439333">b</span><span class="op" id="4439334">,</span>&nbsp;<span class="ident" id="4439336">ndigits</span><span class="op" id="4439343">,</span>&nbsp;<span class="ident" id="4439345">bb</span><span class="op" id="4439347">,</span>&nbsp;<span class="ident" id="4439349">table</span><span class="op" id="4439354">[</span><span class="num" id="4439355">0</span><span class="op" id="4439356">:</span><span class="ident" id="4439357">index</span><span class="op" id="4439362">]</span><span class="op" id="4439363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439368">s</span>&nbsp;<span class="op" id="4439370">=</span>&nbsp;<span class="ident" id="4439372">s</span><span class="op" id="4439373">[</span><span class="op" id="4439374">:</span><span class="ident" id="4439375">h</span><span class="op" id="4439376">]</span>&nbsp;<span class="comment" id="4439378">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439454">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439540">i</span>&nbsp;<span class="op" id="4439542">:=</span>&nbsp;<span class="builtinfunc" id="4439545">len</span><span class="op" id="4439548">(</span><span class="ident" id="4439549">s</span><span class="op" id="4439550">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439553">var</span>&nbsp;<span class="ident" id="4439557">r</span>&nbsp;<span class="ident" id="4439559">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439565">if</span>&nbsp;<span class="ident" id="4439568">b</span>&nbsp;<span class="op" id="4439570">==</span>&nbsp;<span class="num" id="4439573">10</span>&nbsp;<span class="op" id="4439576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439580">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439667">for</span>&nbsp;<span class="builtinfunc" id="4439671">len</span><span class="op" id="4439674">(</span><span class="ident" id="4439675">q</span><span class="op" id="4439676">)</span>&nbsp;<span class="op" id="4439678">&gt;</span>&nbsp;<span class="num" id="4439680">0</span>&nbsp;<span class="op" id="4439682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439687">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439736">q</span><span class="op" id="4439737">,</span>&nbsp;<span class="ident" id="4439739">r</span>&nbsp;<span class="op" id="4439741">=</span>&nbsp;<span class="ident" id="4439743">q</span><span class="op" id="4439744">.</span><span class="ident" id="4439745">divW</span><span class="op" id="4439749">(</span><span class="ident" id="4439750">q</span><span class="op" id="4439751">,</span>&nbsp;<span class="ident" id="4439753">bb</span><span class="op" id="4439755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439760">for</span>&nbsp;<span class="ident" id="4439764">j</span>&nbsp;<span class="op" id="4439766">:=</span>&nbsp;<span class="num" id="4439769">0</span><span class="op" id="4439770">;</span>&nbsp;<span class="ident" id="4439772">j</span>&nbsp;<span class="op" id="4439774">&lt;</span>&nbsp;<span class="ident" id="4439776">ndigits</span>&nbsp;<span class="op" id="4439784">&amp;&amp;</span>&nbsp;<span class="ident" id="4439787">i</span>&nbsp;<span class="op" id="4439789">&gt;</span>&nbsp;<span class="num" id="4439791">0</span><span class="op" id="4439792">;</span>&nbsp;<span class="ident" id="4439794">j</span><span class="op" id="4439795">++</span>&nbsp;<span class="op" id="4439798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439804">i</span><span class="op" id="4439805">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439812">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439871">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439935">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439997">t</span>&nbsp;<span class="op" id="4439999">:=</span>&nbsp;<span class="ident" id="4440002">r</span>&nbsp;<span class="op" id="4440004">/</span>&nbsp;<span class="num" id="4440006">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440013">s</span><span class="op" id="4440014">[</span><span class="ident" id="4440015">i</span><span class="op" id="4440016">]</span>&nbsp;<span class="op" id="4440018">=</span>&nbsp;<span class="ident" id="4440020">charset</span><span class="op" id="4440027">[</span><span class="ident" id="4440028">r</span><span class="op" id="4440029">-</span><span class="ident" id="4440030">t</span><span class="op" id="4440031">&lt;&lt;</span><span class="num" id="4440033">3</span><span class="op" id="4440034">-</span><span class="ident" id="4440035">t</span><span class="op" id="4440036">-</span><span class="ident" id="4440037">t</span><span class="op" id="4440038">]</span>&nbsp;<span class="comment" id="4440040">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440108">r</span>&nbsp;<span class="op" id="4440110">=</span>&nbsp;<span class="ident" id="4440112">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440117">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440124">}</span>&nbsp;<span class="keyword" id="4440126">else</span>&nbsp;<span class="op" id="4440131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440135">for</span>&nbsp;<span class="builtinfunc" id="4440139">len</span><span class="op" id="4440142">(</span><span class="ident" id="4440143">q</span><span class="op" id="4440144">)</span>&nbsp;<span class="op" id="4440146">&gt;</span>&nbsp;<span class="num" id="4440148">0</span>&nbsp;<span class="op" id="4440150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440155">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440204">q</span><span class="op" id="4440205">,</span>&nbsp;<span class="ident" id="4440207">r</span>&nbsp;<span class="op" id="4440209">=</span>&nbsp;<span class="ident" id="4440211">q</span><span class="op" id="4440212">.</span><span class="ident" id="4440213">divW</span><span class="op" id="4440217">(</span><span class="ident" id="4440218">q</span><span class="op" id="4440219">,</span>&nbsp;<span class="ident" id="4440221">bb</span><span class="op" id="4440223">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440228">for</span>&nbsp;<span class="ident" id="4440232">j</span>&nbsp;<span class="op" id="4440234">:=</span>&nbsp;<span class="num" id="4440237">0</span><span class="op" id="4440238">;</span>&nbsp;<span class="ident" id="4440240">j</span>&nbsp;<span class="op" id="4440242">&lt;</span>&nbsp;<span class="ident" id="4440244">ndigits</span>&nbsp;<span class="op" id="4440252">&amp;&amp;</span>&nbsp;<span class="ident" id="4440255">i</span>&nbsp;<span class="op" id="4440257">&gt;</span>&nbsp;<span class="num" id="4440259">0</span><span class="op" id="4440260">;</span>&nbsp;<span class="ident" id="4440262">j</span><span class="op" id="4440263">++</span>&nbsp;<span class="op" id="4440266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440272">i</span><span class="op" id="4440273">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440280">s</span><span class="op" id="4440281">[</span><span class="ident" id="4440282">i</span><span class="op" id="4440283">]</span>&nbsp;<span class="op" id="4440285">=</span>&nbsp;<span class="ident" id="4440287">charset</span><span class="op" id="4440294">[</span><span class="ident" id="4440295">r</span><span class="op" id="4440296">%</span><span class="ident" id="4440297">b</span><span class="op" id="4440298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440304">r</span>&nbsp;<span class="op" id="4440306">/=</span>&nbsp;<span class="ident" id="4440309">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440314">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440325">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440355">zero</span>&nbsp;<span class="op" id="4440360">:=</span>&nbsp;<span class="ident" id="4440363">charset</span><span class="op" id="4440370">[</span><span class="num" id="4440371">0</span><span class="op" id="4440372">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440375">for</span>&nbsp;<span class="ident" id="4440379">i</span>&nbsp;<span class="op" id="4440381">&gt;</span>&nbsp;<span class="num" id="4440383">0</span>&nbsp;<span class="op" id="4440385">{</span>&nbsp;<span class="comment" id="4440387">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440423">i</span><span class="op" id="4440424">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440429">s</span><span class="op" id="4440430">[</span><span class="ident" id="4440431">i</span><span class="op" id="4440432">]</span>&nbsp;<span class="op" id="4440434">=</span>&nbsp;<span class="ident" id="4440436">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440442">}</span><br>
<span class="lineno"></span><span class="op" id="4440444">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="4440447">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="4440537">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4440602">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="4440682">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="4440742">var</span>&nbsp;<span class="ident" id="4440746">leafSize</span>&nbsp;<span class="builtintype" id="4440755">int</span>&nbsp;<span class="op" id="4440759">=</span>&nbsp;<span class="num" id="4440761">8</span>&nbsp;<span class="comment" id="4440763">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4440829">type</span>&nbsp;<span class="ident" id="4440834">divisor</span>&nbsp;<span class="keyword" id="4440842">struct</span>&nbsp;<span class="op" id="4440849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440852">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440860">nat</span>&nbsp;<span class="comment" id="4440864">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440876">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4440884">int</span>&nbsp;<span class="comment" id="4440888">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440956">ndigits</span>&nbsp;<span class="builtintype" id="4440964">int</span>&nbsp;<span class="comment" id="4440968">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="4441026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4441029">var</span>&nbsp;<span class="ident" id="4441033">cacheBase10</span>&nbsp;<span class="keyword" id="4441045">struct</span>&nbsp;<span class="op" id="4441052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441055">sync</span><span class="op" id="4441059">.</span><span class="ident" id="4441060">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441067">table</span>&nbsp;<span class="op" id="4441073">[</span><span class="num" id="4441074">64</span><span class="op" id="4441076">]</span><span class="ident" id="4441077">divisor</span>&nbsp;<span class="comment" id="4441085">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="4441116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4441119">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="4441142">func</span>&nbsp;<span class="op" id="4441147">(</span><span class="ident" id="4441148">z</span>&nbsp;<span class="ident" id="4441150">nat</span><span class="op" id="4441153">)</span>&nbsp;<span class="ident" id="4441155">expWW</span><span class="op" id="4441160">(</span><span class="ident" id="4441161">x</span><span class="op" id="4441162">,</span>&nbsp;<span class="ident" id="4441164">y</span>&nbsp;<span class="ident" id="4441166">Word</span><span class="op" id="4441170">)</span>&nbsp;<span class="ident" id="4441172">nat</span>&nbsp;<span class="op" id="4441176">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441179">return</span>&nbsp;<span class="ident" id="4441186">z</span><span class="op" id="4441187">.</span><span class="ident" id="4441188">expNN</span><span class="op" id="4441193">(</span><span class="ident" id="4441194">nat</span><span class="op" id="4441197">(</span><span class="ident" id="4441198">nil</span><span class="op" id="4441201">)</span><span class="op" id="4441202">.</span><span class="ident" id="4441203">setWord</span><span class="op" id="4441210">(</span><span class="ident" id="4441211">x</span><span class="op" id="4441212">)</span><span class="op" id="4441213">,</span>&nbsp;<span class="ident" id="4441215">nat</span><span class="op" id="4441218">(</span><span class="ident" id="4441219">nil</span><span class="op" id="4441222">)</span><span class="op" id="4441223">.</span><span class="ident" id="4441224">setWord</span><span class="op" id="4441231">(</span><span class="ident" id="4441232">y</span><span class="op" id="4441233">)</span><span class="op" id="4441234">,</span>&nbsp;<span class="ident" id="4441236">nil</span><span class="op" id="4441239">)</span><br>
<span class="lineno"></span><span class="op" id="4441241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4441244">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="4441311">func</span>&nbsp;<span class="ident" id="4441316">divisors</span><span class="op" id="4441324">(</span><span class="ident" id="4441325">m</span>&nbsp;<span class="builtintype" id="4441327">int</span><span class="op" id="4441330">,</span>&nbsp;<span class="ident" id="4441332">b</span>&nbsp;<span class="ident" id="4441334">Word</span><span class="op" id="4441338">,</span>&nbsp;<span class="ident" id="4441340">ndigits</span>&nbsp;<span class="builtintype" id="4441348">int</span><span class="op" id="4441351">,</span>&nbsp;<span class="ident" id="4441353">bb</span>&nbsp;<span class="ident" id="4441356">Word</span><span class="op" id="4441360">)</span>&nbsp;<span class="op" id="4441362">[</span><span class="op" id="4441363">]</span><span class="ident" id="4441364">divisor</span>&nbsp;<span class="op" id="4441372">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441375">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441450">if</span>&nbsp;<span class="ident" id="4441453">leafSize</span>&nbsp;<span class="op" id="4441462">==</span>&nbsp;<span class="num" id="4441465">0</span>&nbsp;<span class="op" id="4441467">||</span>&nbsp;<span class="ident" id="4441470">m</span>&nbsp;<span class="op" id="4441472">&lt;=</span>&nbsp;<span class="ident" id="4441475">leafSize</span>&nbsp;<span class="op" id="4441484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441488">return</span>&nbsp;<span class="ident" id="4441495">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441504">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441560">k</span>&nbsp;<span class="op" id="4441562">:=</span>&nbsp;<span class="num" id="4441565">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441568">for</span>&nbsp;<span class="ident" id="4441572">words</span>&nbsp;<span class="op" id="4441578">:=</span>&nbsp;<span class="ident" id="4441581">leafSize</span><span class="op" id="4441589">;</span>&nbsp;<span class="ident" id="4441591">words</span>&nbsp;<span class="op" id="4441597">&lt;</span>&nbsp;<span class="ident" id="4441599">m</span><span class="op" id="4441600">&gt;&gt;</span><span class="num" id="4441602">1</span>&nbsp;<span class="op" id="4441604">&amp;&amp;</span>&nbsp;<span class="ident" id="4441607">k</span>&nbsp;<span class="op" id="4441609">&lt;</span>&nbsp;<span class="builtinfunc" id="4441611">len</span><span class="op" id="4441614">(</span><span class="ident" id="4441615">cacheBase10</span><span class="op" id="4441626">.</span><span class="ident" id="4441627">table</span><span class="op" id="4441632">)</span><span class="op" id="4441633">;</span>&nbsp;<span class="ident" id="4441635">words</span>&nbsp;<span class="op" id="4441641">&lt;&lt;=</span>&nbsp;<span class="num" id="4441645">1</span>&nbsp;<span class="op" id="4441647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441651">k</span><span class="op" id="4441652">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441656">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441660">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441743">var</span>&nbsp;<span class="ident" id="4441747">table</span>&nbsp;<span class="op" id="4441753">[</span><span class="op" id="4441754">]</span><span class="ident" id="4441755">divisor</span>&nbsp;<span class="comment" id="4441763">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441818">if</span>&nbsp;<span class="ident" id="4441821">b</span>&nbsp;<span class="op" id="4441823">==</span>&nbsp;<span class="num" id="4441826">10</span>&nbsp;<span class="op" id="4441829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441833">cacheBase10</span><span class="op" id="4441844">.</span><span class="ident" id="4441845">Lock</span><span class="op" id="4441849">(</span><span class="op" id="4441850">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441854">table</span>&nbsp;<span class="op" id="4441860">=</span>&nbsp;<span class="ident" id="4441862">cacheBase10</span><span class="op" id="4441873">.</span><span class="ident" id="4441874">table</span><span class="op" id="4441879">[</span><span class="num" id="4441880">0</span><span class="op" id="4441881">:</span><span class="ident" id="4441882">k</span><span class="op" id="4441883">]</span>&nbsp;<span class="comment" id="4441885">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441925">}</span>&nbsp;<span class="keyword" id="4441927">else</span>&nbsp;<span class="op" id="4441932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441936">table</span>&nbsp;<span class="op" id="4441942">=</span>&nbsp;<span class="builtinfunc" id="4441944">make</span><span class="op" id="4441948">(</span><span class="op" id="4441949">[</span><span class="op" id="4441950">]</span><span class="ident" id="4441951">divisor</span><span class="op" id="4441958">,</span>&nbsp;<span class="ident" id="4441960">k</span><span class="op" id="4441961">)</span>&nbsp;<span class="comment" id="4441963">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442008">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442025">if</span>&nbsp;<span class="ident" id="4442028">table</span><span class="op" id="4442033">[</span><span class="ident" id="4442034">k</span><span class="op" id="4442035">-</span><span class="num" id="4442036">1</span><span class="op" id="4442037">]</span><span class="op" id="4442038">.</span><span class="ident" id="4442039">ndigits</span>&nbsp;<span class="op" id="4442047">==</span>&nbsp;<span class="num" id="4442050">0</span>&nbsp;<span class="op" id="4442052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442056">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442087">var</span>&nbsp;<span class="ident" id="4442091">larger</span>&nbsp;<span class="ident" id="4442098">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442104">for</span>&nbsp;<span class="ident" id="4442108">i</span>&nbsp;<span class="op" id="4442110">:=</span>&nbsp;<span class="num" id="4442113">0</span><span class="op" id="4442114">;</span>&nbsp;<span class="ident" id="4442116">i</span>&nbsp;<span class="op" id="4442118">&lt;</span>&nbsp;<span class="ident" id="4442120">k</span><span class="op" id="4442121">;</span>&nbsp;<span class="ident" id="4442123">i</span><span class="op" id="4442124">++</span>&nbsp;<span class="op" id="4442127">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442132">if</span>&nbsp;<span class="ident" id="4442135">table</span><span class="op" id="4442140">[</span><span class="ident" id="4442141">i</span><span class="op" id="4442142">]</span><span class="op" id="4442143">.</span><span class="ident" id="4442144">ndigits</span>&nbsp;<span class="op" id="4442152">==</span>&nbsp;<span class="num" id="4442155">0</span>&nbsp;<span class="op" id="4442157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442163">if</span>&nbsp;<span class="ident" id="4442166">i</span>&nbsp;<span class="op" id="4442168">==</span>&nbsp;<span class="num" id="4442171">0</span>&nbsp;<span class="op" id="4442173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442180">table</span><span class="op" id="4442185">[</span><span class="num" id="4442186">0</span><span class="op" id="4442187">]</span><span class="op" id="4442188">.</span><span class="ident" id="4442189">bbb</span>&nbsp;<span class="op" id="4442193">=</span>&nbsp;<span class="ident" id="4442195">nat</span><span class="op" id="4442198">(</span><span class="ident" id="4442199">nil</span><span class="op" id="4442202">)</span><span class="op" id="4442203">.</span><span class="ident" id="4442204">expWW</span><span class="op" id="4442209">(</span><span class="ident" id="4442210">bb</span><span class="op" id="4442212">,</span>&nbsp;<span class="ident" id="4442214">Word</span><span class="op" id="4442218">(</span><span class="ident" id="4442219">leafSize</span><span class="op" id="4442227">)</span><span class="op" id="4442228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442235">table</span><span class="op" id="4442240">[</span><span class="num" id="4442241">0</span><span class="op" id="4442242">]</span><span class="op" id="4442243">.</span><span class="ident" id="4442244">ndigits</span>&nbsp;<span class="op" id="4442252">=</span>&nbsp;<span class="ident" id="4442254">ndigits</span>&nbsp;<span class="op" id="4442262">*</span>&nbsp;<span class="ident" id="4442264">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442277">}</span>&nbsp;<span class="keyword" id="4442279">else</span>&nbsp;<span class="op" id="4442284">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442291">table</span><span class="op" id="4442296">[</span><span class="ident" id="4442297">i</span><span class="op" id="4442298">]</span><span class="op" id="4442299">.</span><span class="ident" id="4442300">bbb</span>&nbsp;<span class="op" id="4442304">=</span>&nbsp;<span class="ident" id="4442306">nat</span><span class="op" id="4442309">(</span><span class="ident" id="4442310">nil</span><span class="op" id="4442313">)</span><span class="op" id="4442314">.</span><span class="ident" id="4442315">mul</span><span class="op" id="4442318">(</span><span class="ident" id="4442319">table</span><span class="op" id="4442324">[</span><span class="ident" id="4442325">i</span><span class="op" id="4442326">-</span><span class="num" id="4442327">1</span><span class="op" id="4442328">]</span><span class="op" id="4442329">.</span><span class="ident" id="4442330">bbb</span><span class="op" id="4442333">,</span>&nbsp;<span class="ident" id="4442335">table</span><span class="op" id="4442340">[</span><span class="ident" id="4442341">i</span><span class="op" id="4442342">-</span><span class="num" id="4442343">1</span><span class="op" id="4442344">]</span><span class="op" id="4442345">.</span><span class="ident" id="4442346">bbb</span><span class="op" id="4442349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442356">table</span><span class="op" id="4442361">[</span><span class="ident" id="4442362">i</span><span class="op" id="4442363">]</span><span class="op" id="4442364">.</span><span class="ident" id="4442365">ndigits</span>&nbsp;<span class="op" id="4442373">=</span>&nbsp;<span class="num" id="4442375">2</span>&nbsp;<span class="op" id="4442377">*</span>&nbsp;<span class="ident" id="4442379">table</span><span class="op" id="4442384">[</span><span class="ident" id="4442385">i</span><span class="op" id="4442386">-</span><span class="num" id="4442387">1</span><span class="op" id="4442388">]</span><span class="op" id="4442389">.</span><span class="ident" id="4442390">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442409">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442476">larger</span>&nbsp;<span class="op" id="4442483">=</span>&nbsp;<span class="ident" id="4442485">nat</span><span class="op" id="4442488">(</span><span class="ident" id="4442489">nil</span><span class="op" id="4442492">)</span><span class="op" id="4442493">.</span><span class="ident" id="4442494">set</span><span class="op" id="4442497">(</span><span class="ident" id="4442498">table</span><span class="op" id="4442503">[</span><span class="ident" id="4442504">i</span><span class="op" id="4442505">]</span><span class="op" id="4442506">.</span><span class="ident" id="4442507">bbb</span><span class="op" id="4442510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442516">for</span>&nbsp;<span class="ident" id="4442520">mulAddVWW</span><span class="op" id="4442529">(</span><span class="ident" id="4442530">larger</span><span class="op" id="4442536">,</span>&nbsp;<span class="ident" id="4442538">larger</span><span class="op" id="4442544">,</span>&nbsp;<span class="ident" id="4442546">b</span><span class="op" id="4442547">,</span>&nbsp;<span class="num" id="4442549">0</span><span class="op" id="4442550">)</span>&nbsp;<span class="op" id="4442552">==</span>&nbsp;<span class="num" id="4442555">0</span>&nbsp;<span class="op" id="4442557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442564">table</span><span class="op" id="4442569">[</span><span class="ident" id="4442570">i</span><span class="op" id="4442571">]</span><span class="op" id="4442572">.</span><span class="ident" id="4442573">bbb</span>&nbsp;<span class="op" id="4442577">=</span>&nbsp;<span class="ident" id="4442579">table</span><span class="op" id="4442584">[</span><span class="ident" id="4442585">i</span><span class="op" id="4442586">]</span><span class="op" id="4442587">.</span><span class="ident" id="4442588">bbb</span><span class="op" id="4442591">.</span><span class="ident" id="4442592">set</span><span class="op" id="4442595">(</span><span class="ident" id="4442596">larger</span><span class="op" id="4442602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442609">table</span><span class="op" id="4442614">[</span><span class="ident" id="4442615">i</span><span class="op" id="4442616">]</span><span class="op" id="4442617">.</span><span class="ident" id="4442618">ndigits</span><span class="op" id="4442625">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442632">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442639">table</span><span class="op" id="4442644">[</span><span class="ident" id="4442645">i</span><span class="op" id="4442646">]</span><span class="op" id="4442647">.</span><span class="ident" id="4442648">nbits</span>&nbsp;<span class="op" id="4442654">=</span>&nbsp;<span class="ident" id="4442656">table</span><span class="op" id="4442661">[</span><span class="ident" id="4442662">i</span><span class="op" id="4442663">]</span><span class="op" id="4442664">.</span><span class="ident" id="4442665">bbb</span><span class="op" id="4442668">.</span><span class="ident" id="4442669">bitLen</span><span class="op" id="4442675">(</span><span class="op" id="4442676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442688">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442692">if</span>&nbsp;<span class="ident" id="4442695">b</span>&nbsp;<span class="op" id="4442697">==</span>&nbsp;<span class="num" id="4442700">10</span>&nbsp;<span class="op" id="4442703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442707">cacheBase10</span><span class="op" id="4442718">.</span><span class="ident" id="4442719">Unlock</span><span class="op" id="4442725">(</span><span class="op" id="4442726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442733">return</span>&nbsp;<span class="ident" id="4442740">table</span><br>
<span class="lineno"></span><span class="op" id="4442746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442749">const</span>&nbsp;<span class="ident" id="4442755">deBruijn32</span>&nbsp;<span class="op" id="4442766">=</span>&nbsp;<span class="num" id="4442768">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="4442780">var</span>&nbsp;<span class="ident" id="4442784">deBruijn32Lookup</span>&nbsp;<span class="op" id="4442801">=</span>&nbsp;<span class="op" id="4442803">[</span><span class="op" id="4442804">]</span><span class="builtintype" id="4442805">byte</span><span class="op" id="4442809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4442812">0</span><span class="op" id="4442813">,</span>&nbsp;<span class="num" id="4442815">1</span><span class="op" id="4442816">,</span>&nbsp;<span class="num" id="4442818">28</span><span class="op" id="4442820">,</span>&nbsp;<span class="num" id="4442822">2</span><span class="op" id="4442823">,</span>&nbsp;<span class="num" id="4442825">29</span><span class="op" id="4442827">,</span>&nbsp;<span class="num" id="4442829">14</span><span class="op" id="4442831">,</span>&nbsp;<span class="num" id="4442833">24</span><span class="op" id="4442835">,</span>&nbsp;<span class="num" id="4442837">3</span><span class="op" id="4442838">,</span>&nbsp;<span class="num" id="4442840">30</span><span class="op" id="4442842">,</span>&nbsp;<span class="num" id="4442844">22</span><span class="op" id="4442846">,</span>&nbsp;<span class="num" id="4442848">20</span><span class="op" id="4442850">,</span>&nbsp;<span class="num" id="4442852">15</span><span class="op" id="4442854">,</span>&nbsp;<span class="num" id="4442856">25</span><span class="op" id="4442858">,</span>&nbsp;<span class="num" id="4442860">17</span><span class="op" id="4442862">,</span>&nbsp;<span class="num" id="4442864">4</span><span class="op" id="4442865">,</span>&nbsp;<span class="num" id="4442867">8</span><span class="op" id="4442868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4442871">31</span><span class="op" id="4442873">,</span>&nbsp;<span class="num" id="4442875">27</span><span class="op" id="4442877">,</span>&nbsp;<span class="num" id="4442879">13</span><span class="op" id="4442881">,</span>&nbsp;<span class="num" id="4442883">23</span><span class="op" id="4442885">,</span>&nbsp;<span class="num" id="4442887">21</span><span class="op" id="4442889">,</span>&nbsp;<span class="num" id="4442891">19</span><span class="op" id="4442893">,</span>&nbsp;<span class="num" id="4442895">16</span><span class="op" id="4442897">,</span>&nbsp;<span class="num" id="4442899">7</span><span class="op" id="4442900">,</span>&nbsp;<span class="num" id="4442902">26</span><span class="op" id="4442904">,</span>&nbsp;<span class="num" id="4442906">12</span><span class="op" id="4442908">,</span>&nbsp;<span class="num" id="4442910">18</span><span class="op" id="4442912">,</span>&nbsp;<span class="num" id="4442914">6</span><span class="op" id="4442915">,</span>&nbsp;<span class="num" id="4442917">11</span><span class="op" id="4442919">,</span>&nbsp;<span class="num" id="4442921">5</span><span class="op" id="4442922">,</span>&nbsp;<span class="num" id="4442924">10</span><span class="op" id="4442926">,</span>&nbsp;<span class="num" id="4442928">9</span><span class="op" id="4442929">,</span><br>
<span class="lineno"></span><span class="op" id="4442931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="4442934">const</span>&nbsp;<span class="ident" id="4442940">deBruijn64</span>&nbsp;<span class="op" id="4442951">=</span>&nbsp;<span class="num" id="4442953">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442973">var</span>&nbsp;<span class="ident" id="4442977">deBruijn64Lookup</span>&nbsp;<span class="op" id="4442994">=</span>&nbsp;<span class="op" id="4442996">[</span><span class="op" id="4442997">]</span><span class="builtintype" id="4442998">byte</span><span class="op" id="4443002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4443005">0</span><span class="op" id="4443006">,</span>&nbsp;<span class="num" id="4443008">1</span><span class="op" id="4443009">,</span>&nbsp;<span class="num" id="4443011">56</span><span class="op" id="4443013">,</span>&nbsp;<span class="num" id="4443015">2</span><span class="op" id="4443016">,</span>&nbsp;<span class="num" id="4443018">57</span><span class="op" id="4443020">,</span>&nbsp;<span class="num" id="4443022">49</span><span class="op" id="4443024">,</span>&nbsp;<span class="num" id="4443026">28</span><span class="op" id="4443028">,</span>&nbsp;<span class="num" id="4443030">3</span><span class="op" id="4443031">,</span>&nbsp;<span class="num" id="4443033">61</span><span class="op" id="4443035">,</span>&nbsp;<span class="num" id="4443037">58</span><span class="op" id="4443039">,</span>&nbsp;<span class="num" id="4443041">42</span><span class="op" id="4443043">,</span>&nbsp;<span class="num" id="4443045">50</span><span class="op" id="4443047">,</span>&nbsp;<span class="num" id="4443049">38</span><span class="op" id="4443051">,</span>&nbsp;<span class="num" id="4443053">29</span><span class="op" id="4443055">,</span>&nbsp;<span class="num" id="4443057">17</span><span class="op" id="4443059">,</span>&nbsp;<span class="num" id="4443061">4</span><span class="op" id="4443062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4443065">62</span><span class="op" id="4443067">,</span>&nbsp;<span class="num" id="4443069">47</span><span class="op" id="4443071">,</span>&nbsp;<span class="num" id="4443073">59</span><span class="op" id="4443075">,</span>&nbsp;<span class="num" id="4443077">36</span><span class="op" id="4443079">,</span>&nbsp;<span class="num" id="4443081">45</span><span class="op" id="4443083">,</span>&nbsp;<span class="num" id="4443085">43</span><span class="op" id="4443087">,</span>&nbsp;<span class="num" id="4443089">51</span><span class="op" id="4443091">,</span>&nbsp;<span class="num" id="4443093">22</span><span class="op" id="4443095">,</span>&nbsp;<span class="num" id="4443097">53</span><span class="op" id="4443099">,</span>&nbsp;<span class="num" id="4443101">39</span><span class="op" id="4443103">,</span>&nbsp;<span class="num" id="4443105">33</span><span class="op" id="4443107">,</span>&nbsp;<span class="num" id="4443109">30</span><span class="op" id="4443111">,</span>&nbsp;<span class="num" id="4443113">24</span><span class="op" id="4443115">,</span>&nbsp;<span class="num" id="4443117">18</span><span class="op" id="4443119">,</span>&nbsp;<span class="num" id="4443121">12</span><span class="op" id="4443123">,</span>&nbsp;<span class="num" id="4443125">5</span><span class="op" id="4443126">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4443129">63</span><span class="op" id="4443131">,</span>&nbsp;<span class="num" id="4443133">55</span><span class="op" id="4443135">,</span>&nbsp;<span class="num" id="4443137">48</span><span class="op" id="4443139">,</span>&nbsp;<span class="num" id="4443141">27</span><span class="op" id="4443143">,</span>&nbsp;<span class="num" id="4443145">60</span><span class="op" id="4443147">,</span>&nbsp;<span class="num" id="4443149">41</span><span class="op" id="4443151">,</span>&nbsp;<span class="num" id="4443153">37</span><span class="op" id="4443155">,</span>&nbsp;<span class="num" id="4443157">16</span><span class="op" id="4443159">,</span>&nbsp;<span class="num" id="4443161">46</span><span class="op" id="4443163">,</span>&nbsp;<span class="num" id="4443165">35</span><span class="op" id="4443167">,</span>&nbsp;<span class="num" id="4443169">44</span><span class="op" id="4443171">,</span>&nbsp;<span class="num" id="4443173">21</span><span class="op" id="4443175">,</span>&nbsp;<span class="num" id="4443177">52</span><span class="op" id="4443179">,</span>&nbsp;<span class="num" id="4443181">32</span><span class="op" id="4443183">,</span>&nbsp;<span class="num" id="4443185">23</span><span class="op" id="4443187">,</span>&nbsp;<span class="num" id="4443189">11</span><span class="op" id="4443191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4443194">54</span><span class="op" id="4443196">,</span>&nbsp;<span class="num" id="4443198">26</span><span class="op" id="4443200">,</span>&nbsp;<span class="num" id="4443202">40</span><span class="op" id="4443204">,</span>&nbsp;<span class="num" id="4443206">15</span><span class="op" id="4443208">,</span>&nbsp;<span class="num" id="4443210">34</span><span class="op" id="4443212">,</span>&nbsp;<span class="num" id="4443214">20</span><span class="op" id="4443216">,</span>&nbsp;<span class="num" id="4443218">31</span><span class="op" id="4443220">,</span>&nbsp;<span class="num" id="4443222">10</span><span class="op" id="4443224">,</span>&nbsp;<span class="num" id="4443226">25</span><span class="op" id="4443228">,</span>&nbsp;<span class="num" id="4443230">14</span><span class="op" id="4443232">,</span>&nbsp;<span class="num" id="4443234">19</span><span class="op" id="4443236">,</span>&nbsp;<span class="num" id="4443238">9</span><span class="op" id="4443239">,</span>&nbsp;<span class="num" id="4443241">13</span><span class="op" id="4443243">,</span>&nbsp;<span class="num" id="4443245">8</span><span class="op" id="4443246">,</span>&nbsp;<span class="num" id="4443248">7</span><span class="op" id="4443249">,</span>&nbsp;<span class="num" id="4443251">6</span><span class="op" id="4443252">,</span><br>
<span class="lineno"></span><span class="op" id="4443254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4443257">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="4443334">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4443348">func</span>&nbsp;<span class="ident" id="4443353">trailingZeroBits</span><span class="op" id="4443369">(</span><span class="ident" id="4443370">x</span>&nbsp;<span class="ident" id="4443372">Word</span><span class="op" id="4443376">)</span>&nbsp;<span class="builtintype" id="4443378">uint</span>&nbsp;<span class="op" id="4443383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443386">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443458">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443530">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443600">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443670">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443734">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443807">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443876">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443923">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443960">switch</span>&nbsp;<span class="ident" id="4443967">_W</span>&nbsp;<span class="op" id="4443970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443973">case</span>&nbsp;<span class="num" id="4443978">32</span><span class="op" id="4443980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443984">return</span>&nbsp;<span class="builtintype" id="4443991">uint</span><span class="op" id="4443995">(</span><span class="ident" id="4443996">deBruijn32Lookup</span><span class="op" id="4444012">[</span><span class="op" id="4444013">(</span><span class="op" id="4444014">(</span><span class="ident" id="4444015">x</span><span class="op" id="4444016">&amp;</span><span class="op" id="4444017">-</span><span class="ident" id="4444018">x</span><span class="op" id="4444019">)</span><span class="op" id="4444020">*</span><span class="ident" id="4444021">deBruijn32</span><span class="op" id="4444031">)</span><span class="op" id="4444032">&gt;&gt;</span><span class="num" id="4444034">27</span><span class="op" id="4444036">]</span><span class="op" id="4444037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444040">case</span>&nbsp;<span class="num" id="4444045">64</span><span class="op" id="4444047">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444051">return</span>&nbsp;<span class="builtintype" id="4444058">uint</span><span class="op" id="4444062">(</span><span class="ident" id="4444063">deBruijn64Lookup</span><span class="op" id="4444079">[</span><span class="op" id="4444080">(</span><span class="op" id="4444081">(</span><span class="ident" id="4444082">x</span><span class="op" id="4444083">&amp;</span><span class="op" id="4444084">-</span><span class="ident" id="4444085">x</span><span class="op" id="4444086">)</span><span class="op" id="4444087">*</span><span class="op" id="4444088">(</span><span class="ident" id="4444089">deBruijn64</span><span class="op" id="4444099">&amp;</span><span class="ident" id="4444100">_M</span><span class="op" id="4444102">)</span><span class="op" id="4444103">)</span><span class="op" id="4444104">&gt;&gt;</span><span class="num" id="4444106">58</span><span class="op" id="4444108">]</span><span class="op" id="4444109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444112">default</span><span class="op" id="4444119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4444123">panic</span><span class="op" id="4444128">(</span><span class="string" id="4444129">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4444148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444151">}</span><br>
<span class="lineno"></span><span class="op" id="4444153">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="4444156">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4444233">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4444247">func</span>&nbsp;<span class="op" id="4444252">(</span><span class="ident" id="4444253">x</span>&nbsp;<span class="ident" id="4444255">nat</span><span class="op" id="4444258">)</span>&nbsp;<span class="ident" id="4444260">trailingZeroBits</span><span class="op" id="4444276">(</span><span class="op" id="4444277">)</span>&nbsp;<span class="builtintype" id="4444279">uint</span>&nbsp;<span class="op" id="4444284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444287">if</span>&nbsp;<span class="builtinfunc" id="4444290">len</span><span class="op" id="4444293">(</span><span class="ident" id="4444294">x</span><span class="op" id="4444295">)</span>&nbsp;<span class="op" id="4444297">==</span>&nbsp;<span class="num" id="4444300">0</span>&nbsp;<span class="op" id="4444302">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444306">return</span>&nbsp;<span class="num" id="4444313">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444319">var</span>&nbsp;<span class="ident" id="4444323">i</span>&nbsp;<span class="builtintype" id="4444325">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444331">for</span>&nbsp;<span class="ident" id="4444335">x</span><span class="op" id="4444336">[</span><span class="ident" id="4444337">i</span><span class="op" id="4444338">]</span>&nbsp;<span class="op" id="4444340">==</span>&nbsp;<span class="num" id="4444343">0</span>&nbsp;<span class="op" id="4444345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444349">i</span><span class="op" id="4444350">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444357">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444371">return</span>&nbsp;<span class="ident" id="4444378">i</span><span class="op" id="4444379">*</span><span class="ident" id="4444380">_W</span>&nbsp;<span class="op" id="4444383">+</span>&nbsp;<span class="ident" id="4444385">trailingZeroBits</span><span class="op" id="4444401">(</span><span class="ident" id="4444402">x</span><span class="op" id="4444403">[</span><span class="ident" id="4444404">i</span><span class="op" id="4444405">]</span><span class="op" id="4444406">)</span><br>
<span class="lineno"></span><span class="op" id="4444408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="4444411">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4444425">func</span>&nbsp;<span class="op" id="4444430">(</span><span class="ident" id="4444431">z</span>&nbsp;<span class="ident" id="4444433">nat</span><span class="op" id="4444436">)</span>&nbsp;<span class="ident" id="4444438">shl</span><span class="op" id="4444441">(</span><span class="ident" id="4444442">x</span>&nbsp;<span class="ident" id="4444444">nat</span><span class="op" id="4444447">,</span>&nbsp;<span class="ident" id="4444449">s</span>&nbsp;<span class="builtintype" id="4444451">uint</span><span class="op" id="4444455">)</span>&nbsp;<span class="ident" id="4444457">nat</span>&nbsp;<span class="op" id="4444461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444464">m</span>&nbsp;<span class="op" id="4444466">:=</span>&nbsp;<span class="builtinfunc" id="4444469">len</span><span class="op" id="4444472">(</span><span class="ident" id="4444473">x</span><span class="op" id="4444474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444477">if</span>&nbsp;<span class="ident" id="4444480">m</span>&nbsp;<span class="op" id="4444482">==</span>&nbsp;<span class="num" id="4444485">0</span>&nbsp;<span class="op" id="4444487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444491">return</span>&nbsp;<span class="ident" id="4444498">z</span><span class="op" id="4444499">.</span><span class="builtinfunc" id="4444500">make</span><span class="op" id="4444504">(</span><span class="num" id="4444505">0</span><span class="op" id="4444506">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444512">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444523">n</span>&nbsp;<span class="op" id="4444525">:=</span>&nbsp;<span class="ident" id="4444528">m</span>&nbsp;<span class="op" id="4444530">+</span>&nbsp;<span class="builtintype" id="4444532">int</span><span class="op" id="4444535">(</span><span class="ident" id="4444536">s</span><span class="op" id="4444537">/</span><span class="ident" id="4444538">_W</span><span class="op" id="4444540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444543">z</span>&nbsp;<span class="op" id="4444545">=</span>&nbsp;<span class="ident" id="4444547">z</span><span class="op" id="4444548">.</span><span class="builtinfunc" id="4444549">make</span><span class="op" id="4444553">(</span><span class="ident" id="4444554">n</span>&nbsp;<span class="op" id="4444556">+</span>&nbsp;<span class="num" id="4444558">1</span><span class="op" id="4444559">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444562">z</span><span class="op" id="4444563">[</span><span class="ident" id="4444564">n</span><span class="op" id="4444565">]</span>&nbsp;<span class="op" id="4444567">=</span>&nbsp;<span class="ident" id="4444569">shlVU</span><span class="op" id="4444574">(</span><span class="ident" id="4444575">z</span><span class="op" id="4444576">[</span><span class="ident" id="4444577">n</span><span class="op" id="4444578">-</span><span class="ident" id="4444579">m</span><span class="op" id="4444580">:</span><span class="ident" id="4444581">n</span><span class="op" id="4444582">]</span><span class="op" id="4444583">,</span>&nbsp;<span class="ident" id="4444585">x</span><span class="op" id="4444586">,</span>&nbsp;<span class="ident" id="4444588">s</span><span class="op" id="4444589">%</span><span class="ident" id="4444590">_W</span><span class="op" id="4444592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444595">z</span><span class="op" id="4444596">[</span><span class="num" id="4444597">0</span>&nbsp;<span class="op" id="4444599">:</span>&nbsp;<span class="ident" id="4444601">n</span><span class="op" id="4444602">-</span><span class="ident" id="4444603">m</span><span class="op" id="4444604">]</span><span class="op" id="4444605">.</span><span class="ident" id="4444606">clear</span><span class="op" id="4444611">(</span><span class="op" id="4444612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444616">return</span>&nbsp;<span class="ident" id="4444623">z</span><span class="op" id="4444624">.</span><span class="ident" id="4444625">norm</span><span class="op" id="4444629">(</span><span class="op" id="4444630">)</span><br>
<span class="lineno"></span><span class="op" id="4444632">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="4444635">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4444649">func</span>&nbsp;<span class="op" id="4444654">(</span><span class="ident" id="4444655">z</span>&nbsp;<span class="ident" id="4444657">nat</span><span class="op" id="4444660">)</span>&nbsp;<span class="ident" id="4444662">shr</span><span class="op" id="4444665">(</span><span class="ident" id="4444666">x</span>&nbsp;<span class="ident" id="4444668">nat</span><span class="op" id="4444671">,</span>&nbsp;<span class="ident" id="4444673">s</span>&nbsp;<span class="builtintype" id="4444675">uint</span><span class="op" id="4444679">)</span>&nbsp;<span class="ident" id="4444681">nat</span>&nbsp;<span class="op" id="4444685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444688">m</span>&nbsp;<span class="op" id="4444690">:=</span>&nbsp;<span class="builtinfunc" id="4444693">len</span><span class="op" id="4444696">(</span><span class="ident" id="4444697">x</span><span class="op" id="4444698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444701">n</span>&nbsp;<span class="op" id="4444703">:=</span>&nbsp;<span class="ident" id="4444706">m</span>&nbsp;<span class="op" id="4444708">-</span>&nbsp;<span class="builtintype" id="4444710">int</span><span class="op" id="4444713">(</span><span class="ident" id="4444714">s</span><span class="op" id="4444715">/</span><span class="ident" id="4444716">_W</span><span class="op" id="4444718">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444721">if</span>&nbsp;<span class="ident" id="4444724">n</span>&nbsp;<span class="op" id="4444726">&lt;=</span>&nbsp;<span class="num" id="4444729">0</span>&nbsp;<span class="op" id="4444731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444735">return</span>&nbsp;<span class="ident" id="4444742">z</span><span class="op" id="4444743">.</span><span class="builtinfunc" id="4444744">make</span><span class="op" id="4444748">(</span><span class="num" id="4444749">0</span><span class="op" id="4444750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444756">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444767">z</span>&nbsp;<span class="op" id="4444769">=</span>&nbsp;<span class="ident" id="4444771">z</span><span class="op" id="4444772">.</span><span class="builtinfunc" id="4444773">make</span><span class="op" id="4444777">(</span><span class="ident" id="4444778">n</span><span class="op" id="4444779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444782">shrVU</span><span class="op" id="4444787">(</span><span class="ident" id="4444788">z</span><span class="op" id="4444789">,</span>&nbsp;<span class="ident" id="4444791">x</span><span class="op" id="4444792">[</span><span class="ident" id="4444793">m</span><span class="op" id="4444794">-</span><span class="ident" id="4444795">n</span><span class="op" id="4444796">:</span><span class="op" id="4444797">]</span><span class="op" id="4444798">,</span>&nbsp;<span class="ident" id="4444800">s</span><span class="op" id="4444801">%</span><span class="ident" id="4444802">_W</span><span class="op" id="4444804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444808">return</span>&nbsp;<span class="ident" id="4444815">z</span><span class="op" id="4444816">.</span><span class="ident" id="4444817">norm</span><span class="op" id="4444821">(</span><span class="op" id="4444822">)</span><br>
<span class="lineno"></span><span class="op" id="4444824">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="4444827">func</span>&nbsp;<span class="op" id="4444832">(</span><span class="ident" id="4444833">z</span>&nbsp;<span class="ident" id="4444835">nat</span><span class="op" id="4444838">)</span>&nbsp;<span class="ident" id="4444840">setBit</span><span class="op" id="4444846">(</span><span class="ident" id="4444847">x</span>&nbsp;<span class="ident" id="4444849">nat</span><span class="op" id="4444852">,</span>&nbsp;<span class="ident" id="4444854">i</span>&nbsp;<span class="builtintype" id="4444856">uint</span><span class="op" id="4444860">,</span>&nbsp;<span class="ident" id="4444862">b</span>&nbsp;<span class="builtintype" id="4444864">uint</span><span class="op" id="4444868">)</span>&nbsp;<span class="ident" id="4444870">nat</span>&nbsp;<span class="op" id="4444874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444877">j</span>&nbsp;<span class="op" id="4444879">:=</span>&nbsp;<span class="builtintype" id="4444882">int</span><span class="op" id="4444885">(</span><span class="ident" id="4444886">i</span>&nbsp;<span class="op" id="4444888">/</span>&nbsp;<span class="ident" id="4444890">_W</span><span class="op" id="4444892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444895">m</span>&nbsp;<span class="op" id="4444897">:=</span>&nbsp;<span class="ident" id="4444900">Word</span><span class="op" id="4444904">(</span><span class="num" id="4444905">1</span><span class="op" id="4444906">)</span>&nbsp;<span class="op" id="4444908">&lt;&lt;</span>&nbsp;<span class="op" id="4444911">(</span><span class="ident" id="4444912">i</span>&nbsp;<span class="op" id="4444914">%</span>&nbsp;<span class="ident" id="4444916">_W</span><span class="op" id="4444918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444921">n</span>&nbsp;<span class="op" id="4444923">:=</span>&nbsp;<span class="builtinfunc" id="4444926">len</span><span class="op" id="4444929">(</span><span class="ident" id="4444930">x</span><span class="op" id="4444931">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444934">switch</span>&nbsp;<span class="ident" id="4444941">b</span>&nbsp;<span class="op" id="4444943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444946">case</span>&nbsp;<span class="num" id="4444951">0</span><span class="op" id="4444952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444956">z</span>&nbsp;<span class="op" id="4444958">=</span>&nbsp;<span class="ident" id="4444960">z</span><span class="op" id="4444961">.</span><span class="builtinfunc" id="4444962">make</span><span class="op" id="4444966">(</span><span class="ident" id="4444967">n</span><span class="op" id="4444968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4444972">copy</span><span class="op" id="4444976">(</span><span class="ident" id="4444977">z</span><span class="op" id="4444978">,</span>&nbsp;<span class="ident" id="4444980">x</span><span class="op" id="4444981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444985">if</span>&nbsp;<span class="ident" id="4444988">j</span>&nbsp;<span class="op" id="4444990">&gt;=</span>&nbsp;<span class="ident" id="4444993">n</span>&nbsp;<span class="op" id="4444995">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445000">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445022">return</span>&nbsp;<span class="ident" id="4445029">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445037">z</span><span class="op" id="4445038">[</span><span class="ident" id="4445039">j</span><span class="op" id="4445040">]</span>&nbsp;<span class="op" id="4445042">&amp;^=</span>&nbsp;<span class="ident" id="4445046">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445050">return</span>&nbsp;<span class="ident" id="4445057">z</span><span class="op" id="4445058">.</span><span class="ident" id="4445059">norm</span><span class="op" id="4445063">(</span><span class="op" id="4445064">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445067">case</span>&nbsp;<span class="num" id="4445072">1</span><span class="op" id="4445073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445077">if</span>&nbsp;<span class="ident" id="4445080">j</span>&nbsp;<span class="op" id="4445082">&gt;=</span>&nbsp;<span class="ident" id="4445085">n</span>&nbsp;<span class="op" id="4445087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445092">z</span>&nbsp;<span class="op" id="4445094">=</span>&nbsp;<span class="ident" id="4445096">z</span><span class="op" id="4445097">.</span><span class="builtinfunc" id="4445098">make</span><span class="op" id="4445102">(</span><span class="ident" id="4445103">j</span>&nbsp;<span class="op" id="4445105">+</span>&nbsp;<span class="num" id="4445107">1</span><span class="op" id="4445108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445113">z</span><span class="op" id="4445114">[</span><span class="ident" id="4445115">n</span><span class="op" id="4445116">:</span><span class="op" id="4445117">]</span><span class="op" id="4445118">.</span><span class="ident" id="4445119">clear</span><span class="op" id="4445124">(</span><span class="op" id="4445125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445129">}</span>&nbsp;<span class="keyword" id="4445131">else</span>&nbsp;<span class="op" id="4445136">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445141">z</span>&nbsp;<span class="op" id="4445143">=</span>&nbsp;<span class="ident" id="4445145">z</span><span class="op" id="4445146">.</span><span class="builtinfunc" id="4445147">make</span><span class="op" id="4445151">(</span><span class="ident" id="4445152">n</span><span class="op" id="4445153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445161">copy</span><span class="op" id="4445165">(</span><span class="ident" id="4445166">z</span><span class="op" id="4445167">,</span>&nbsp;<span class="ident" id="4445169">x</span><span class="op" id="4445170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445174">z</span><span class="op" id="4445175">[</span><span class="ident" id="4445176">j</span><span class="op" id="4445177">]</span>&nbsp;<span class="op" id="4445179">|=</span>&nbsp;<span class="ident" id="4445182">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445186">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445212">return</span>&nbsp;<span class="ident" id="4445219">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445225">panic</span><span class="op" id="4445230">(</span><span class="string" id="4445231">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="4445254">)</span><br>
<span class="lineno"></span><span class="op" id="4445256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="4445259">func</span>&nbsp;<span class="op" id="4445264">(</span><span class="ident" id="4445265">z</span>&nbsp;<span class="ident" id="4445267">nat</span><span class="op" id="4445270">)</span>&nbsp;<span class="ident" id="4445272">bit</span><span class="op" id="4445275">(</span><span class="ident" id="4445276">i</span>&nbsp;<span class="builtintype" id="4445278">uint</span><span class="op" id="4445282">)</span>&nbsp;<span class="builtintype" id="4445284">uint</span>&nbsp;<span class="op" id="4445289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445292">j</span>&nbsp;<span class="op" id="4445294">:=</span>&nbsp;<span class="builtintype" id="4445297">int</span><span class="op" id="4445300">(</span><span class="ident" id="4445301">i</span>&nbsp;<span class="op" id="4445303">/</span>&nbsp;<span class="ident" id="4445305">_W</span><span class="op" id="4445307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445310">if</span>&nbsp;<span class="ident" id="4445313">j</span>&nbsp;<span class="op" id="4445315">&gt;=</span>&nbsp;<span class="builtinfunc" id="4445318">len</span><span class="op" id="4445321">(</span><span class="ident" id="4445322">z</span><span class="op" id="4445323">)</span>&nbsp;<span class="op" id="4445325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445329">return</span>&nbsp;<span class="num" id="4445336">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445339">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445342">return</span>&nbsp;<span class="builtintype" id="4445349">uint</span><span class="op" id="4445353">(</span><span class="ident" id="4445354">z</span><span class="op" id="4445355">[</span><span class="ident" id="4445356">j</span><span class="op" id="4445357">]</span>&nbsp;<span class="op" id="4445359">&gt;&gt;</span>&nbsp;<span class="op" id="4445362">(</span><span class="ident" id="4445363">i</span>&nbsp;<span class="op" id="4445365">%</span>&nbsp;<span class="ident" id="4445367">_W</span><span class="op" id="4445369">)</span>&nbsp;<span class="op" id="4445371">&amp;</span>&nbsp;<span class="num" id="4445373">1</span><span class="op" id="4445374">)</span><br>
<span class="lineno"></span><span class="op" id="4445376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4445379">func</span>&nbsp;<span class="op" id="4445384">(</span><span class="ident" id="4445385">z</span>&nbsp;<span class="ident" id="4445387">nat</span><span class="op" id="4445390">)</span>&nbsp;<span class="ident" id="4445392">and</span><span class="op" id="4445395">(</span><span class="ident" id="4445396">x</span><span class="op" id="4445397">,</span>&nbsp;<span class="ident" id="4445399">y</span>&nbsp;<span class="ident" id="4445401">nat</span><span class="op" id="4445404">)</span>&nbsp;<span class="ident" id="4445406">nat</span>&nbsp;<span class="op" id="4445410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445413">m</span>&nbsp;<span class="op" id="4445415">:=</span>&nbsp;<span class="builtinfunc" id="4445418">len</span><span class="op" id="4445421">(</span><span class="ident" id="4445422">x</span><span class="op" id="4445423">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445426">n</span>&nbsp;<span class="op" id="4445428">:=</span>&nbsp;<span class="builtinfunc" id="4445431">len</span><span class="op" id="4445434">(</span><span class="ident" id="4445435">y</span><span class="op" id="4445436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445439">if</span>&nbsp;<span class="ident" id="4445442">m</span>&nbsp;<span class="op" id="4445444">&gt;</span>&nbsp;<span class="ident" id="4445446">n</span>&nbsp;<span class="op" id="4445448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445452">m</span>&nbsp;<span class="op" id="4445454">=</span>&nbsp;<span class="ident" id="4445456">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445462">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445474">z</span>&nbsp;<span class="op" id="4445476">=</span>&nbsp;<span class="ident" id="4445478">z</span><span class="op" id="4445479">.</span><span class="builtinfunc" id="4445480">make</span><span class="op" id="4445484">(</span><span class="ident" id="4445485">m</span><span class="op" id="4445486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445489">for</span>&nbsp;<span class="ident" id="4445493">i</span>&nbsp;<span class="op" id="4445495">:=</span>&nbsp;<span class="num" id="4445498">0</span><span class="op" id="4445499">;</span>&nbsp;<span class="ident" id="4445501">i</span>&nbsp;<span class="op" id="4445503">&lt;</span>&nbsp;<span class="ident" id="4445505">m</span><span class="op" id="4445506">;</span>&nbsp;<span class="ident" id="4445508">i</span><span class="op" id="4445509">++</span>&nbsp;<span class="op" id="4445512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445516">z</span><span class="op" id="4445517">[</span><span class="ident" id="4445518">i</span><span class="op" id="4445519">]</span>&nbsp;<span class="op" id="4445521">=</span>&nbsp;<span class="ident" id="4445523">x</span><span class="op" id="4445524">[</span><span class="ident" id="4445525">i</span><span class="op" id="4445526">]</span>&nbsp;<span class="op" id="4445528">&amp;</span>&nbsp;<span class="ident" id="4445530">y</span><span class="op" id="4445531">[</span><span class="ident" id="4445532">i</span><span class="op" id="4445533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445536">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445540">return</span>&nbsp;<span class="ident" id="4445547">z</span><span class="op" id="4445548">.</span><span class="ident" id="4445549">norm</span><span class="op" id="4445553">(</span><span class="op" id="4445554">)</span><br>
<span class="lineno"></span><span class="op" id="4445556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4445559">func</span>&nbsp;<span class="op" id="4445564">(</span><span class="ident" id="4445565">z</span>&nbsp;<span class="ident" id="4445567">nat</span><span class="op" id="4445570">)</span>&nbsp;<span class="ident" id="4445572">andNot</span><span class="op" id="4445578">(</span><span class="ident" id="4445579">x</span><span class="op" id="4445580">,</span>&nbsp;<span class="ident" id="4445582">y</span>&nbsp;<span class="ident" id="4445584">nat</span><span class="op" id="4445587">)</span>&nbsp;<span class="ident" id="4445589">nat</span>&nbsp;<span class="op" id="4445593">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445596">m</span>&nbsp;<span class="op" id="4445598">:=</span>&nbsp;<span class="builtinfunc" id="4445601">len</span><span class="op" id="4445604">(</span><span class="ident" id="4445605">x</span><span class="op" id="4445606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445609">n</span>&nbsp;<span class="op" id="4445611">:=</span>&nbsp;<span class="builtinfunc" id="4445614">len</span><span class="op" id="4445617">(</span><span class="ident" id="4445618">y</span><span class="op" id="4445619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445622">if</span>&nbsp;<span class="ident" id="4445625">n</span>&nbsp;<span class="op" id="4445627">&gt;</span>&nbsp;<span class="ident" id="4445629">m</span>&nbsp;<span class="op" id="4445631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445635">n</span>&nbsp;<span class="op" id="4445637">=</span>&nbsp;<span class="ident" id="4445639">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445642">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445645">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445657">z</span>&nbsp;<span class="op" id="4445659">=</span>&nbsp;<span class="ident" id="4445661">z</span><span class="op" id="4445662">.</span><span class="builtinfunc" id="4445663">make</span><span class="op" id="4445667">(</span><span class="ident" id="4445668">m</span><span class="op" id="4445669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445672">for</span>&nbsp;<span class="ident" id="4445676">i</span>&nbsp;<span class="op" id="4445678">:=</span>&nbsp;<span class="num" id="4445681">0</span><span class="op" id="4445682">;</span>&nbsp;<span class="ident" id="4445684">i</span>&nbsp;<span class="op" id="4445686">&lt;</span>&nbsp;<span class="ident" id="4445688">n</span><span class="op" id="4445689">;</span>&nbsp;<span class="ident" id="4445691">i</span><span class="op" id="4445692">++</span>&nbsp;<span class="op" id="4445695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445699">z</span><span class="op" id="4445700">[</span><span class="ident" id="4445701">i</span><span class="op" id="4445702">]</span>&nbsp;<span class="op" id="4445704">=</span>&nbsp;<span class="ident" id="4445706">x</span><span class="op" id="4445707">[</span><span class="ident" id="4445708">i</span><span class="op" id="4445709">]</span>&nbsp;<span class="op" id="4445711">&amp;^</span>&nbsp;<span class="ident" id="4445714">y</span><span class="op" id="4445715">[</span><span class="ident" id="4445716">i</span><span class="op" id="4445717">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445723">copy</span><span class="op" id="4445727">(</span><span class="ident" id="4445728">z</span><span class="op" id="4445729">[</span><span class="ident" id="4445730">n</span><span class="op" id="4445731">:</span><span class="ident" id="4445732">m</span><span class="op" id="4445733">]</span><span class="op" id="4445734">,</span>&nbsp;<span class="ident" id="4445736">x</span><span class="op" id="4445737">[</span><span class="ident" id="4445738">n</span><span class="op" id="4445739">:</span><span class="ident" id="4445740">m</span><span class="op" id="4445741">]</span><span class="op" id="4445742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445746">return</span>&nbsp;<span class="ident" id="4445753">z</span><span class="op" id="4445754">.</span><span class="ident" id="4445755">norm</span><span class="op" id="4445759">(</span><span class="op" id="4445760">)</span><br>
<span class="lineno"></span><span class="op" id="4445762">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="4445765">func</span>&nbsp;<span class="op" id="4445770">(</span><span class="ident" id="4445771">z</span>&nbsp;<span class="ident" id="4445773">nat</span><span class="op" id="4445776">)</span>&nbsp;<span class="ident" id="4445778">or</span><span class="op" id="4445780">(</span><span class="ident" id="4445781">x</span><span class="op" id="4445782">,</span>&nbsp;<span class="ident" id="4445784">y</span>&nbsp;<span class="ident" id="4445786">nat</span><span class="op" id="4445789">)</span>&nbsp;<span class="ident" id="4445791">nat</span>&nbsp;<span class="op" id="4445795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445798">m</span>&nbsp;<span class="op" id="4445800">:=</span>&nbsp;<span class="builtinfunc" id="4445803">len</span><span class="op" id="4445806">(</span><span class="ident" id="4445807">x</span><span class="op" id="4445808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445811">n</span>&nbsp;<span class="op" id="4445813">:=</span>&nbsp;<span class="builtinfunc" id="4445816">len</span><span class="op" id="4445819">(</span><span class="ident" id="4445820">y</span><span class="op" id="4445821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445824">s</span>&nbsp;<span class="op" id="4445826">:=</span>&nbsp;<span class="ident" id="4445829">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445832">if</span>&nbsp;<span class="ident" id="4445835">m</span>&nbsp;<span class="op" id="4445837">&lt;</span>&nbsp;<span class="ident" id="4445839">n</span>&nbsp;<span class="op" id="4445841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445845">n</span><span class="op" id="4445846">,</span>&nbsp;<span class="ident" id="4445848">m</span>&nbsp;<span class="op" id="4445850">=</span>&nbsp;<span class="ident" id="4445852">m</span><span class="op" id="4445853">,</span>&nbsp;<span class="ident" id="4445855">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445859">s</span>&nbsp;<span class="op" id="4445861">=</span>&nbsp;<span class="ident" id="4445863">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445869">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445881">z</span>&nbsp;<span class="op" id="4445883">=</span>&nbsp;<span class="ident" id="4445885">z</span><span class="op" id="4445886">.</span><span class="builtinfunc" id="4445887">make</span><span class="op" id="4445891">(</span><span class="ident" id="4445892">m</span><span class="op" id="4445893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445896">for</span>&nbsp;<span class="ident" id="4445900">i</span>&nbsp;<span class="op" id="4445902">:=</span>&nbsp;<span class="num" id="4445905">0</span><span class="op" id="4445906">;</span>&nbsp;<span class="ident" id="4445908">i</span>&nbsp;<span class="op" id="4445910">&lt;</span>&nbsp;<span class="ident" id="4445912">n</span><span class="op" id="4445913">;</span>&nbsp;<span class="ident" id="4445915">i</span><span class="op" id="4445916">++</span>&nbsp;<span class="op" id="4445919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445923">z</span><span class="op" id="4445924">[</span><span class="ident" id="4445925">i</span><span class="op" id="4445926">]</span>&nbsp;<span class="op" id="4445928">=</span>&nbsp;<span class="ident" id="4445930">x</span><span class="op" id="4445931">[</span><span class="ident" id="4445932">i</span><span class="op" id="4445933">]</span>&nbsp;<span class="op" id="4445935">|</span>&nbsp;<span class="ident" id="4445937">y</span><span class="op" id="4445938">[</span><span class="ident" id="4445939">i</span><span class="op" id="4445940">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445943">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445946">copy</span><span class="op" id="4445950">(</span><span class="ident" id="4445951">z</span><span class="op" id="4445952">[</span><span class="ident" id="4445953">n</span><span class="op" id="4445954">:</span><span class="ident" id="4445955">m</span><span class="op" id="4445956">]</span><span class="op" id="4445957">,</span>&nbsp;<span class="ident" id="4445959">s</span><span class="op" id="4445960">[</span><span class="ident" id="4445961">n</span><span class="op" id="4445962">:</span><span class="ident" id="4445963">m</span><span class="op" id="4445964">]</span><span class="op" id="4445965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445969">return</span>&nbsp;<span class="ident" id="4445976">z</span><span class="op" id="4445977">.</span><span class="ident" id="4445978">norm</span><span class="op" id="4445982">(</span><span class="op" id="4445983">)</span><br>
<span class="lineno"></span><span class="op" id="4445985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="4445988">func</span>&nbsp;<span class="op" id="4445993">(</span><span class="ident" id="4445994">z</span>&nbsp;<span class="ident" id="4445996">nat</span><span class="op" id="4445999">)</span>&nbsp;<span class="ident" id="4446001">xor</span><span class="op" id="4446004">(</span><span class="ident" id="4446005">x</span><span class="op" id="4446006">,</span>&nbsp;<span class="ident" id="4446008">y</span>&nbsp;<span class="ident" id="4446010">nat</span><span class="op" id="4446013">)</span>&nbsp;<span class="ident" id="4446015">nat</span>&nbsp;<span class="op" id="4446019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446022">m</span>&nbsp;<span class="op" id="4446024">:=</span>&nbsp;<span class="builtinfunc" id="4446027">len</span><span class="op" id="4446030">(</span><span class="ident" id="4446031">x</span><span class="op" id="4446032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446035">n</span>&nbsp;<span class="op" id="4446037">:=</span>&nbsp;<span class="builtinfunc" id="4446040">len</span><span class="op" id="4446043">(</span><span class="ident" id="4446044">y</span><span class="op" id="4446045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446048">s</span>&nbsp;<span class="op" id="4446050">:=</span>&nbsp;<span class="ident" id="4446053">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446056">if</span>&nbsp;<span class="ident" id="4446059">m</span>&nbsp;<span class="op" id="4446061">&lt;</span>&nbsp;<span class="ident" id="4446063">n</span>&nbsp;<span class="op" id="4446065">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446069">n</span><span class="op" id="4446070">,</span>&nbsp;<span class="ident" id="4446072">m</span>&nbsp;<span class="op" id="4446074">=</span>&nbsp;<span class="ident" id="4446076">m</span><span class="op" id="4446077">,</span>&nbsp;<span class="ident" id="4446079">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446083">s</span>&nbsp;<span class="op" id="4446085">=</span>&nbsp;<span class="ident" id="4446087">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446093">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446105">z</span>&nbsp;<span class="op" id="4446107">=</span>&nbsp;<span class="ident" id="4446109">z</span><span class="op" id="4446110">.</span><span class="builtinfunc" id="4446111">make</span><span class="op" id="4446115">(</span><span class="ident" id="4446116">m</span><span class="op" id="4446117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446120">for</span>&nbsp;<span class="ident" id="4446124">i</span>&nbsp;<span class="op" id="4446126">:=</span>&nbsp;<span class="num" id="4446129">0</span><span class="op" id="4446130">;</span>&nbsp;<span class="ident" id="4446132">i</span>&nbsp;<span class="op" id="4446134">&lt;</span>&nbsp;<span class="ident" id="4446136">n</span><span class="op" id="4446137">;</span>&nbsp;<span class="ident" id="4446139">i</span><span class="op" id="4446140">++</span>&nbsp;<span class="op" id="4446143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446147">z</span><span class="op" id="4446148">[</span><span class="ident" id="4446149">i</span><span class="op" id="4446150">]</span>&nbsp;<span class="op" id="4446152">=</span>&nbsp;<span class="ident" id="4446154">x</span><span class="op" id="4446155">[</span><span class="ident" id="4446156">i</span><span class="op" id="4446157">]</span>&nbsp;<span class="op" id="4446159">^</span>&nbsp;<span class="ident" id="4446161">y</span><span class="op" id="4446162">[</span><span class="ident" id="4446163">i</span><span class="op" id="4446164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4446170">copy</span><span class="op" id="4446174">(</span><span class="ident" id="4446175">z</span><span class="op" id="4446176">[</span><span class="ident" id="4446177">n</span><span class="op" id="4446178">:</span><span class="ident" id="4446179">m</span><span class="op" id="4446180">]</span><span class="op" id="4446181">,</span>&nbsp;<span class="ident" id="4446183">s</span><span class="op" id="4446184">[</span><span class="ident" id="4446185">n</span><span class="op" id="4446186">:</span><span class="ident" id="4446187">m</span><span class="op" id="4446188">]</span><span class="op" id="4446189">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446193">return</span>&nbsp;<span class="ident" id="4446200">z</span><span class="op" id="4446201">.</span><span class="ident" id="4446202">norm</span><span class="op" id="4446206">(</span><span class="op" id="4446207">)</span><br>
<span class="lineno"></span><span class="op" id="4446209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446212">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="4446274">func</span>&nbsp;<span class="ident" id="4446279">greaterThan</span><span class="op" id="4446290">(</span><span class="ident" id="4446291">x1</span><span class="op" id="4446293">,</span>&nbsp;<span class="ident" id="4446295">x2</span><span class="op" id="4446297">,</span>&nbsp;<span class="ident" id="4446299">y1</span><span class="op" id="4446301">,</span>&nbsp;<span class="ident" id="4446303">y2</span>&nbsp;<span class="ident" id="4446306">Word</span><span class="op" id="4446310">)</span>&nbsp;<span class="builtintype" id="4446312">bool</span>&nbsp;<span class="op" id="4446317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446320">return</span>&nbsp;<span class="ident" id="4446327">x1</span>&nbsp;<span class="op" id="4446330">&gt;</span>&nbsp;<span class="ident" id="4446332">y1</span>&nbsp;<span class="op" id="4446335">||</span>&nbsp;<span class="ident" id="4446338">x1</span>&nbsp;<span class="op" id="4446341">==</span>&nbsp;<span class="ident" id="4446344">y1</span>&nbsp;<span class="op" id="4446347">&amp;&amp;</span>&nbsp;<span class="ident" id="4446350">x2</span>&nbsp;<span class="op" id="4446353">&gt;</span>&nbsp;<span class="ident" id="4446355">y2</span><br>
<span class="lineno"></span><span class="op" id="4446358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446361">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="4446384">func</span>&nbsp;<span class="op" id="4446389">(</span><span class="ident" id="4446390">x</span>&nbsp;<span class="ident" id="4446392">nat</span><span class="op" id="4446395">)</span>&nbsp;<span class="ident" id="4446397">modW</span><span class="op" id="4446401">(</span><span class="ident" id="4446402">d</span>&nbsp;<span class="ident" id="4446404">Word</span><span class="op" id="4446408">)</span>&nbsp;<span class="op" id="4446410">(</span><span class="ident" id="4446411">r</span>&nbsp;<span class="ident" id="4446413">Word</span><span class="op" id="4446417">)</span>&nbsp;<span class="op" id="4446419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446422">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446482">var</span>&nbsp;<span class="ident" id="4446486">q</span>&nbsp;<span class="ident" id="4446488">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446493">q</span>&nbsp;<span class="op" id="4446495">=</span>&nbsp;<span class="ident" id="4446497">q</span><span class="op" id="4446498">.</span><span class="builtinfunc" id="4446499">make</span><span class="op" id="4446503">(</span><span class="builtinfunc" id="4446504">len</span><span class="op" id="4446507">(</span><span class="ident" id="4446508">x</span><span class="op" id="4446509">)</span><span class="op" id="4446510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446513">return</span>&nbsp;<span class="ident" id="4446520">divWVW</span><span class="op" id="4446526">(</span><span class="ident" id="4446527">q</span><span class="op" id="4446528">,</span>&nbsp;<span class="num" id="4446530">0</span><span class="op" id="4446531">,</span>&nbsp;<span class="ident" id="4446533">x</span><span class="op" id="4446534">,</span>&nbsp;<span class="ident" id="4446536">d</span><span class="op" id="4446537">)</span><br>
<span class="lineno">1190</span><span class="op" id="4446539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446542">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4446616">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="4446659">func</span>&nbsp;<span class="op" id="4446664">(</span><span class="ident" id="4446665">z</span>&nbsp;<span class="ident" id="4446667">nat</span><span class="op" id="4446670">)</span>&nbsp;<span class="ident" id="4446672">random</span><span class="op" id="4446678">(</span><span class="ident" id="4446679">rand</span>&nbsp;<span class="op" id="4446684">*</span><span class="ident" id="4446685">rand</span><span class="op" id="4446689">.</span><span class="ident" id="4446690">Rand</span><span class="op" id="4446694">,</span>&nbsp;<span class="ident" id="4446696">limit</span>&nbsp;<span class="ident" id="4446702">nat</span><span class="op" id="4446705">,</span>&nbsp;<span class="ident" id="4446707">n</span>&nbsp;<span class="builtintype" id="4446709">int</span><span class="op" id="4446712">)</span>&nbsp;<span class="ident" id="4446714">nat</span>&nbsp;<span class="op" id="4446718">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446721">if</span>&nbsp;<span class="ident" id="4446724">alias</span><span class="op" id="4446729">(</span><span class="ident" id="4446730">z</span><span class="op" id="4446731">,</span>&nbsp;<span class="ident" id="4446733">limit</span><span class="op" id="4446738">)</span>&nbsp;<span class="op" id="4446740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446744">z</span>&nbsp;<span class="op" id="4446746">=</span>&nbsp;<span class="ident" id="4446748">nil</span>&nbsp;<span class="comment" id="4446752">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446798">z</span>&nbsp;<span class="op" id="4446800">=</span>&nbsp;<span class="ident" id="4446802">z</span><span class="op" id="4446803">.</span><span class="builtinfunc" id="4446804">make</span><span class="op" id="4446808">(</span><span class="builtinfunc" id="4446809">len</span><span class="op" id="4446812">(</span><span class="ident" id="4446813">limit</span><span class="op" id="4446818">)</span><span class="op" id="4446819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446823">bitLengthOfMSW</span>&nbsp;<span class="op" id="4446838">:=</span>&nbsp;<span class="builtintype" id="4446841">uint</span><span class="op" id="4446845">(</span><span class="ident" id="4446846">n</span>&nbsp;<span class="op" id="4446848">%</span>&nbsp;<span class="ident" id="4446850">_W</span><span class="op" id="4446852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446855">if</span>&nbsp;<span class="ident" id="4446858">bitLengthOfMSW</span>&nbsp;<span class="op" id="4446873">==</span>&nbsp;<span class="num" id="4446876">0</span>&nbsp;<span class="op" id="4446878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446882">bitLengthOfMSW</span>&nbsp;<span class="op" id="4446897">=</span>&nbsp;<span class="ident" id="4446899">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446906">mask</span>&nbsp;<span class="op" id="4446911">:=</span>&nbsp;<span class="ident" id="4446914">Word</span><span class="op" id="4446918">(</span><span class="op" id="4446919">(</span><span class="num" id="4446920">1</span>&nbsp;<span class="op" id="4446922">&lt;&lt;</span>&nbsp;<span class="ident" id="4446925">bitLengthOfMSW</span><span class="op" id="4446939">)</span>&nbsp;<span class="op" id="4446941">-</span>&nbsp;<span class="num" id="4446943">1</span><span class="op" id="4446944">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446948">for</span>&nbsp;<span class="op" id="4446952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446956">switch</span>&nbsp;<span class="ident" id="4446963">_W</span>&nbsp;<span class="op" id="4446966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446970">case</span>&nbsp;<span class="num" id="4446975">32</span><span class="op" id="4446977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446982">for</span>&nbsp;<span class="ident" id="4446986">i</span>&nbsp;<span class="op" id="4446988">:=</span>&nbsp;<span class="keyword" id="4446991">range</span>&nbsp;<span class="ident" id="4446997">z</span>&nbsp;<span class="op" id="4446999">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447005">z</span><span class="op" id="4447006">[</span><span class="ident" id="4447007">i</span><span class="op" id="4447008">]</span>&nbsp;<span class="op" id="4447010">=</span>&nbsp;<span class="ident" id="4447012">Word</span><span class="op" id="4447016">(</span><span class="ident" id="4447017">rand</span><span class="op" id="4447021">.</span><span class="ident" id="4447022">Uint32</span><span class="op" id="4447028">(</span><span class="op" id="4447029">)</span><span class="op" id="4447030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447039">case</span>&nbsp;<span class="num" id="4447044">64</span><span class="op" id="4447046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447051">for</span>&nbsp;<span class="ident" id="4447055">i</span>&nbsp;<span class="op" id="4447057">:=</span>&nbsp;<span class="keyword" id="4447060">range</span>&nbsp;<span class="ident" id="4447066">z</span>&nbsp;<span class="op" id="4447068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447074">z</span><span class="op" id="4447075">[</span><span class="ident" id="4447076">i</span><span class="op" id="4447077">]</span>&nbsp;<span class="op" id="4447079">=</span>&nbsp;<span class="ident" id="4447081">Word</span><span class="op" id="4447085">(</span><span class="ident" id="4447086">rand</span><span class="op" id="4447090">.</span><span class="ident" id="4447091">Uint32</span><span class="op" id="4447097">(</span><span class="op" id="4447098">)</span><span class="op" id="4447099">)</span>&nbsp;<span class="op" id="4447101">|</span>&nbsp;<span class="ident" id="4447103">Word</span><span class="op" id="4447107">(</span><span class="ident" id="4447108">rand</span><span class="op" id="4447112">.</span><span class="ident" id="4447113">Uint32</span><span class="op" id="4447119">(</span><span class="op" id="4447120">)</span><span class="op" id="4447121">)</span><span class="op" id="4447122">&lt;&lt;</span><span class="num" id="4447124">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447134">default</span><span class="op" id="4447141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4447146">panic</span><span class="op" id="4447151">(</span><span class="string" id="4447152">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4447171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447179">z</span><span class="op" id="4447180">[</span><span class="builtinfunc" id="4447181">len</span><span class="op" id="4447184">(</span><span class="ident" id="4447185">limit</span><span class="op" id="4447190">)</span><span class="op" id="4447191">-</span><span class="num" id="4447192">1</span><span class="op" id="4447193">]</span>&nbsp;<span class="op" id="4447195">&amp;=</span>&nbsp;<span class="ident" id="4447198">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447205">if</span>&nbsp;<span class="ident" id="4447208">z</span><span class="op" id="4447209">.</span><span class="ident" id="4447210">cmp</span><span class="op" id="4447213">(</span><span class="ident" id="4447214">limit</span><span class="op" id="4447219">)</span>&nbsp;<span class="op" id="4447221">&lt;</span>&nbsp;<span class="num" id="4447223">0</span>&nbsp;<span class="op" id="4447225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447230">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447245">return</span>&nbsp;<span class="ident" id="4447252">z</span><span class="op" id="4447253">.</span><span class="ident" id="4447254">norm</span><span class="op" id="4447258">(</span><span class="op" id="4447259">)</span><br>
<span class="lineno"></span><span class="op" id="4447261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447264">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="4447326">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="4447388">func</span>&nbsp;<span class="op" id="4447393">(</span><span class="ident" id="4447394">z</span>&nbsp;<span class="ident" id="4447396">nat</span><span class="op" id="4447399">)</span>&nbsp;<span class="ident" id="4447401">expNN</span><span class="op" id="4447406">(</span><span class="ident" id="4447407">x</span><span class="op" id="4447408">,</span>&nbsp;<span class="ident" id="4447410">y</span><span class="op" id="4447411">,</span>&nbsp;<span class="ident" id="4447413">m</span>&nbsp;<span class="ident" id="4447415">nat</span><span class="op" id="4447418">)</span>&nbsp;<span class="ident" id="4447420">nat</span>&nbsp;<span class="op" id="4447424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447427">if</span>&nbsp;<span class="ident" id="4447430">alias</span><span class="op" id="4447435">(</span><span class="ident" id="4447436">z</span><span class="op" id="4447437">,</span>&nbsp;<span class="ident" id="4447439">x</span><span class="op" id="4447440">)</span>&nbsp;<span class="op" id="4447442">||</span>&nbsp;<span class="ident" id="4447445">alias</span><span class="op" id="4447450">(</span><span class="ident" id="4447451">z</span><span class="op" id="4447452">,</span>&nbsp;<span class="ident" id="4447454">y</span><span class="op" id="4447455">)</span>&nbsp;<span class="op" id="4447457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447461">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447515">z</span>&nbsp;<span class="op" id="4447517">=</span>&nbsp;<span class="ident" id="4447519">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447524">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447528">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447548">if</span>&nbsp;<span class="builtinfunc" id="4447551">len</span><span class="op" id="4447554">(</span><span class="ident" id="4447555">m</span><span class="op" id="4447556">)</span>&nbsp;<span class="op" id="4447558">==</span>&nbsp;<span class="num" id="4447561">1</span>&nbsp;<span class="op" id="4447563">&amp;&amp;</span>&nbsp;<span class="ident" id="4447566">m</span><span class="op" id="4447567">[</span><span class="num" id="4447568">0</span><span class="op" id="4447569">]</span>&nbsp;<span class="op" id="4447571">==</span>&nbsp;<span class="num" id="4447574">1</span>&nbsp;<span class="op" id="4447576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447580">return</span>&nbsp;<span class="ident" id="4447587">z</span><span class="op" id="4447588">.</span><span class="ident" id="4447589">setWord</span><span class="op" id="4447596">(</span><span class="num" id="4447597">0</span><span class="op" id="4447598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447601">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447604">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447625">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447639">if</span>&nbsp;<span class="builtinfunc" id="4447642">len</span><span class="op" id="4447645">(</span><span class="ident" id="4447646">y</span><span class="op" id="4447647">)</span>&nbsp;<span class="op" id="4447649">==</span>&nbsp;<span class="num" id="4447652">0</span>&nbsp;<span class="op" id="4447654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447658">return</span>&nbsp;<span class="ident" id="4447665">z</span><span class="op" id="4447666">.</span><span class="ident" id="4447667">setWord</span><span class="op" id="4447674">(</span><span class="num" id="4447675">1</span><span class="op" id="4447676">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447682">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447693">if</span>&nbsp;<span class="builtinfunc" id="4447696">len</span><span class="op" id="4447699">(</span><span class="ident" id="4447700">m</span><span class="op" id="4447701">)</span>&nbsp;<span class="op" id="4447703">!=</span>&nbsp;<span class="num" id="4447706">0</span>&nbsp;<span class="op" id="4447708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447712">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447764">z</span>&nbsp;<span class="op" id="4447766">=</span>&nbsp;<span class="ident" id="4447768">z</span><span class="op" id="4447769">.</span><span class="builtinfunc" id="4447770">make</span><span class="op" id="4447774">(</span><span class="builtinfunc" id="4447775">len</span><span class="op" id="4447778">(</span><span class="ident" id="4447779">m</span><span class="op" id="4447780">)</span><span class="op" id="4447781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447787">z</span>&nbsp;<span class="op" id="4447789">=</span>&nbsp;<span class="ident" id="4447791">z</span><span class="op" id="4447792">.</span><span class="ident" id="4447793">set</span><span class="op" id="4447796">(</span><span class="ident" id="4447797">x</span><span class="op" id="4447798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447802">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447867">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447940">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448010">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448076">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448092">if</span>&nbsp;<span class="builtinfunc" id="4448095">len</span><span class="op" id="4448098">(</span><span class="ident" id="4448099">x</span><span class="op" id="4448100">)</span>&nbsp;<span class="op" id="4448102">&gt;</span>&nbsp;<span class="num" id="4448104">1</span>&nbsp;<span class="op" id="4448106">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4448109">len</span><span class="op" id="4448112">(</span><span class="ident" id="4448113">y</span><span class="op" id="4448114">)</span>&nbsp;<span class="op" id="4448116">&gt;</span>&nbsp;<span class="num" id="4448118">1</span>&nbsp;<span class="op" id="4448120">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4448123">len</span><span class="op" id="4448126">(</span><span class="ident" id="4448127">m</span><span class="op" id="4448128">)</span>&nbsp;<span class="op" id="4448130">&gt;</span>&nbsp;<span class="num" id="4448132">0</span>&nbsp;<span class="op" id="4448134">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448138">return</span>&nbsp;<span class="ident" id="4448145">z</span><span class="op" id="4448146">.</span><span class="ident" id="4448147">expNNWindowed</span><span class="op" id="4448160">(</span><span class="ident" id="4448161">x</span><span class="op" id="4448162">,</span>&nbsp;<span class="ident" id="4448164">y</span><span class="op" id="4448165">,</span>&nbsp;<span class="ident" id="4448167">m</span><span class="op" id="4448168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448175">v</span>&nbsp;<span class="op" id="4448177">:=</span>&nbsp;<span class="ident" id="4448180">y</span><span class="op" id="4448181">[</span><span class="builtinfunc" id="4448182">len</span><span class="op" id="4448185">(</span><span class="ident" id="4448186">y</span><span class="op" id="4448187">)</span><span class="op" id="4448188">-</span><span class="num" id="4448189">1</span><span class="op" id="4448190">]</span>&nbsp;<span class="comment" id="4448192">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448236">shift</span>&nbsp;<span class="op" id="4448242">:=</span>&nbsp;<span class="ident" id="4448245">leadingZeros</span><span class="op" id="4448257">(</span><span class="ident" id="4448258">v</span><span class="op" id="4448259">)</span>&nbsp;<span class="op" id="4448261">+</span>&nbsp;<span class="num" id="4448263">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448266">v</span>&nbsp;<span class="op" id="4448268">&lt;&lt;=</span>&nbsp;<span class="ident" id="4448272">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448279">var</span>&nbsp;<span class="ident" id="4448283">q</span>&nbsp;<span class="ident" id="4448285">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448291">const</span>&nbsp;<span class="ident" id="4448297">mask</span>&nbsp;<span class="op" id="4448302">=</span>&nbsp;<span class="num" id="4448304">1</span>&nbsp;<span class="op" id="4448306">&lt;&lt;</span>&nbsp;<span class="op" id="4448309">(</span><span class="ident" id="4448310">_W</span>&nbsp;<span class="op" id="4448313">-</span>&nbsp;<span class="num" id="4448315">1</span><span class="op" id="4448316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448320">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448390">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448462">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448520">w</span>&nbsp;<span class="op" id="4448522">:=</span>&nbsp;<span class="ident" id="4448525">_W</span>&nbsp;<span class="op" id="4448528">-</span>&nbsp;<span class="builtintype" id="4448530">int</span><span class="op" id="4448533">(</span><span class="ident" id="4448534">shift</span><span class="op" id="4448539">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448542">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448602">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448643">var</span>&nbsp;<span class="ident" id="4448647">zz</span><span class="op" id="4448649">,</span>&nbsp;<span class="ident" id="4448651">r</span>&nbsp;<span class="ident" id="4448653">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448658">for</span>&nbsp;<span class="ident" id="4448662">j</span>&nbsp;<span class="op" id="4448664">:=</span>&nbsp;<span class="num" id="4448667">0</span><span class="op" id="4448668">;</span>&nbsp;<span class="ident" id="4448670">j</span>&nbsp;<span class="op" id="4448672">&lt;</span>&nbsp;<span class="ident" id="4448674">w</span><span class="op" id="4448675">;</span>&nbsp;<span class="ident" id="4448677">j</span><span class="op" id="4448678">++</span>&nbsp;<span class="op" id="4448681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448685">zz</span>&nbsp;<span class="op" id="4448688">=</span>&nbsp;<span class="ident" id="4448690">zz</span><span class="op" id="4448692">.</span><span class="ident" id="4448693">mul</span><span class="op" id="4448696">(</span><span class="ident" id="4448697">z</span><span class="op" id="4448698">,</span>&nbsp;<span class="ident" id="4448700">z</span><span class="op" id="4448701">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448705">zz</span><span class="op" id="4448707">,</span>&nbsp;<span class="ident" id="4448709">z</span>&nbsp;<span class="op" id="4448711">=</span>&nbsp;<span class="ident" id="4448713">z</span><span class="op" id="4448714">,</span>&nbsp;<span class="ident" id="4448716">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448722">if</span>&nbsp;<span class="ident" id="4448725">v</span><span class="op" id="4448726">&amp;</span><span class="ident" id="4448727">mask</span>&nbsp;<span class="op" id="4448732">!=</span>&nbsp;<span class="num" id="4448735">0</span>&nbsp;<span class="op" id="4448737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448742">zz</span>&nbsp;<span class="op" id="4448745">=</span>&nbsp;<span class="ident" id="4448747">zz</span><span class="op" id="4448749">.</span><span class="ident" id="4448750">mul</span><span class="op" id="4448753">(</span><span class="ident" id="4448754">z</span><span class="op" id="4448755">,</span>&nbsp;<span class="ident" id="4448757">x</span><span class="op" id="4448758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448763">zz</span><span class="op" id="4448765">,</span>&nbsp;<span class="ident" id="4448767">z</span>&nbsp;<span class="op" id="4448769">=</span>&nbsp;<span class="ident" id="4448771">z</span><span class="op" id="4448772">,</span>&nbsp;<span class="ident" id="4448774">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448784">if</span>&nbsp;<span class="builtinfunc" id="4448787">len</span><span class="op" id="4448790">(</span><span class="ident" id="4448791">m</span><span class="op" id="4448792">)</span>&nbsp;<span class="op" id="4448794">!=</span>&nbsp;<span class="num" id="4448797">0</span>&nbsp;<span class="op" id="4448799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448804">zz</span><span class="op" id="4448806">,</span>&nbsp;<span class="ident" id="4448808">r</span>&nbsp;<span class="op" id="4448810">=</span>&nbsp;<span class="ident" id="4448812">zz</span><span class="op" id="4448814">.</span><span class="ident" id="4448815">div</span><span class="op" id="4448818">(</span><span class="ident" id="4448819">r</span><span class="op" id="4448820">,</span>&nbsp;<span class="ident" id="4448822">z</span><span class="op" id="4448823">,</span>&nbsp;<span class="ident" id="4448825">m</span><span class="op" id="4448826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448831">zz</span><span class="op" id="4448833">,</span>&nbsp;<span class="ident" id="4448835">r</span><span class="op" id="4448836">,</span>&nbsp;<span class="ident" id="4448838">q</span><span class="op" id="4448839">,</span>&nbsp;<span class="ident" id="4448841">z</span>&nbsp;<span class="op" id="4448843">=</span>&nbsp;<span class="ident" id="4448845">q</span><span class="op" id="4448846">,</span>&nbsp;<span class="ident" id="4448848">z</span><span class="op" id="4448849">,</span>&nbsp;<span class="ident" id="4448851">zz</span><span class="op" id="4448853">,</span>&nbsp;<span class="ident" id="4448855">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448864">v</span>&nbsp;<span class="op" id="4448866">&lt;&lt;=</span>&nbsp;<span class="num" id="4448870">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448877">for</span>&nbsp;<span class="ident" id="4448881">i</span>&nbsp;<span class="op" id="4448883">:=</span>&nbsp;<span class="builtinfunc" id="4448886">len</span><span class="op" id="4448889">(</span><span class="ident" id="4448890">y</span><span class="op" id="4448891">)</span>&nbsp;<span class="op" id="4448893">-</span>&nbsp;<span class="num" id="4448895">2</span><span class="op" id="4448896">;</span>&nbsp;<span class="ident" id="4448898">i</span>&nbsp;<span class="op" id="4448900">&gt;=</span>&nbsp;<span class="num" id="4448903">0</span><span class="op" id="4448904">;</span>&nbsp;<span class="ident" id="4448906">i</span><span class="op" id="4448907">--</span>&nbsp;<span class="op" id="4448910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448914">v</span>&nbsp;<span class="op" id="4448916">=</span>&nbsp;<span class="ident" id="4448918">y</span><span class="op" id="4448919">[</span><span class="ident" id="4448920">i</span><span class="op" id="4448921">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448926">for</span>&nbsp;<span class="ident" id="4448930">j</span>&nbsp;<span class="op" id="4448932">:=</span>&nbsp;<span class="num" id="4448935">0</span><span class="op" id="4448936">;</span>&nbsp;<span class="ident" id="4448938">j</span>&nbsp;<span class="op" id="4448940">&lt;</span>&nbsp;<span class="ident" id="4448942">_W</span><span class="op" id="4448944">;</span>&nbsp;<span class="ident" id="4448946">j</span><span class="op" id="4448947">++</span>&nbsp;<span class="op" id="4448950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448955">zz</span>&nbsp;<span class="op" id="4448958">=</span>&nbsp;<span class="ident" id="4448960">zz</span><span class="op" id="4448962">.</span><span class="ident" id="4448963">mul</span><span class="op" id="4448966">(</span><span class="ident" id="4448967">z</span><span class="op" id="4448968">,</span>&nbsp;<span class="ident" id="4448970">z</span><span class="op" id="4448971">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448976">zz</span><span class="op" id="4448978">,</span>&nbsp;<span class="ident" id="4448980">z</span>&nbsp;<span class="op" id="4448982">=</span>&nbsp;<span class="ident" id="4448984">z</span><span class="op" id="4448985">,</span>&nbsp;<span class="ident" id="4448987">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448994">if</span>&nbsp;<span class="ident" id="4448997">v</span><span class="op" id="4448998">&amp;</span><span class="ident" id="4448999">mask</span>&nbsp;<span class="op" id="4449004">!=</span>&nbsp;<span class="num" id="4449007">0</span>&nbsp;<span class="op" id="4449009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449015">zz</span>&nbsp;<span class="op" id="4449018">=</span>&nbsp;<span class="ident" id="4449020">zz</span><span class="op" id="4449022">.</span><span class="ident" id="4449023">mul</span><span class="op" id="4449026">(</span><span class="ident" id="4449027">z</span><span class="op" id="4449028">,</span>&nbsp;<span class="ident" id="4449030">x</span><span class="op" id="4449031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449037">zz</span><span class="op" id="4449039">,</span>&nbsp;<span class="ident" id="4449041">z</span>&nbsp;<span class="op" id="4449043">=</span>&nbsp;<span class="ident" id="4449045">z</span><span class="op" id="4449046">,</span>&nbsp;<span class="ident" id="4449048">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449060">if</span>&nbsp;<span class="builtinfunc" id="4449063">len</span><span class="op" id="4449066">(</span><span class="ident" id="4449067">m</span><span class="op" id="4449068">)</span>&nbsp;<span class="op" id="4449070">!=</span>&nbsp;<span class="num" id="4449073">0</span>&nbsp;<span class="op" id="4449075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449081">zz</span><span class="op" id="4449083">,</span>&nbsp;<span class="ident" id="4449085">r</span>&nbsp;<span class="op" id="4449087">=</span>&nbsp;<span class="ident" id="4449089">zz</span><span class="op" id="4449091">.</span><span class="ident" id="4449092">div</span><span class="op" id="4449095">(</span><span class="ident" id="4449096">r</span><span class="op" id="4449097">,</span>&nbsp;<span class="ident" id="4449099">z</span><span class="op" id="4449100">,</span>&nbsp;<span class="ident" id="4449102">m</span><span class="op" id="4449103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449109">zz</span><span class="op" id="4449111">,</span>&nbsp;<span class="ident" id="4449113">r</span><span class="op" id="4449114">,</span>&nbsp;<span class="ident" id="4449116">q</span><span class="op" id="4449117">,</span>&nbsp;<span class="ident" id="4449119">z</span>&nbsp;<span class="op" id="4449121">=</span>&nbsp;<span class="ident" id="4449123">q</span><span class="op" id="4449124">,</span>&nbsp;<span class="ident" id="4449126">z</span><span class="op" id="4449127">,</span>&nbsp;<span class="ident" id="4449129">zz</span><span class="op" id="4449131">,</span>&nbsp;<span class="ident" id="4449133">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449144">v</span>&nbsp;<span class="op" id="4449146">&lt;&lt;=</span>&nbsp;<span class="num" id="4449150">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449157">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449161">return</span>&nbsp;<span class="ident" id="4449168">z</span><span class="op" id="4449169">.</span><span class="ident" id="4449170">norm</span><span class="op" id="4449174">(</span><span class="op" id="4449175">)</span><br>
<span class="lineno"></span><span class="op" id="4449177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4449180">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="4449248">func</span>&nbsp;<span class="op" id="4449253">(</span><span class="ident" id="4449254">z</span>&nbsp;<span class="ident" id="4449256">nat</span><span class="op" id="4449259">)</span>&nbsp;<span class="ident" id="4449261">expNNWindowed</span><span class="op" id="4449274">(</span><span class="ident" id="4449275">x</span><span class="op" id="4449276">,</span>&nbsp;<span class="ident" id="4449278">y</span><span class="op" id="4449279">,</span>&nbsp;<span class="ident" id="4449281">m</span>&nbsp;<span class="ident" id="4449283">nat</span><span class="op" id="4449286">)</span>&nbsp;<span class="ident" id="4449288">nat</span>&nbsp;<span class="op" id="4449292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449295">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449365">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449396">var</span>&nbsp;<span class="ident" id="4449400">zz</span><span class="op" id="4449402">,</span>&nbsp;<span class="ident" id="4449404">r</span>&nbsp;<span class="ident" id="4449406">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449412">const</span>&nbsp;<span class="ident" id="4449418">n</span>&nbsp;<span class="op" id="4449420">=</span>&nbsp;<span class="num" id="4449422">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449425">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449453">var</span>&nbsp;<span class="ident" id="4449457">powers</span>&nbsp;<span class="op" id="4449464">[</span><span class="num" id="4449465">1</span>&nbsp;<span class="op" id="4449467">&lt;&lt;</span>&nbsp;<span class="ident" id="4449470">n</span><span class="op" id="4449471">]</span><span class="ident" id="4449472">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449477">powers</span><span class="op" id="4449483">[</span><span class="num" id="4449484">0</span><span class="op" id="4449485">]</span>&nbsp;<span class="op" id="4449487">=</span>&nbsp;<span class="ident" id="4449489">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449497">powers</span><span class="op" id="4449503">[</span><span class="num" id="4449504">1</span><span class="op" id="4449505">]</span>&nbsp;<span class="op" id="4449507">=</span>&nbsp;<span class="ident" id="4449509">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449512">for</span>&nbsp;<span class="ident" id="4449516">i</span>&nbsp;<span class="op" id="4449518">:=</span>&nbsp;<span class="num" id="4449521">2</span><span class="op" id="4449522">;</span>&nbsp;<span class="ident" id="4449524">i</span>&nbsp;<span class="op" id="4449526">&lt;</span>&nbsp;<span class="num" id="4449528">1</span><span class="op" id="4449529">&lt;&lt;</span><span class="ident" id="4449531">n</span><span class="op" id="4449532">;</span>&nbsp;<span class="ident" id="4449534">i</span>&nbsp;<span class="op" id="4449536">+=</span>&nbsp;<span class="num" id="4449539">2</span>&nbsp;<span class="op" id="4449541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449545">p2</span><span class="op" id="4449547">,</span>&nbsp;<span class="ident" id="4449549">p</span><span class="op" id="4449550">,</span>&nbsp;<span class="ident" id="4449552">p1</span>&nbsp;<span class="op" id="4449555">:=</span>&nbsp;<span class="op" id="4449558">&amp;</span><span class="ident" id="4449559">powers</span><span class="op" id="4449565">[</span><span class="ident" id="4449566">i</span><span class="op" id="4449567">/</span><span class="num" id="4449568">2</span><span class="op" id="4449569">]</span><span class="op" id="4449570">,</span>&nbsp;<span class="op" id="4449572">&amp;</span><span class="ident" id="4449573">powers</span><span class="op" id="4449579">[</span><span class="ident" id="4449580">i</span><span class="op" id="4449581">]</span><span class="op" id="4449582">,</span>&nbsp;<span class="op" id="4449584">&amp;</span><span class="ident" id="4449585">powers</span><span class="op" id="4449591">[</span><span class="ident" id="4449592">i</span><span class="op" id="4449593">+</span><span class="num" id="4449594">1</span><span class="op" id="4449595">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449599">*</span><span class="ident" id="4449600">p</span>&nbsp;<span class="op" id="4449602">=</span>&nbsp;<span class="ident" id="4449604">p</span><span class="op" id="4449605">.</span><span class="ident" id="4449606">mul</span><span class="op" id="4449609">(</span><span class="op" id="4449610">*</span><span class="ident" id="4449611">p2</span><span class="op" id="4449613">,</span>&nbsp;<span class="op" id="4449615">*</span><span class="ident" id="4449616">p2</span><span class="op" id="4449618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449622">zz</span><span class="op" id="4449624">,</span>&nbsp;<span class="ident" id="4449626">r</span>&nbsp;<span class="op" id="4449628">=</span>&nbsp;<span class="ident" id="4449630">zz</span><span class="op" id="4449632">.</span><span class="ident" id="4449633">div</span><span class="op" id="4449636">(</span><span class="ident" id="4449637">r</span><span class="op" id="4449638">,</span>&nbsp;<span class="op" id="4449640">*</span><span class="ident" id="4449641">p</span><span class="op" id="4449642">,</span>&nbsp;<span class="ident" id="4449644">m</span><span class="op" id="4449645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449649">*</span><span class="ident" id="4449650">p</span><span class="op" id="4449651">,</span>&nbsp;<span class="ident" id="4449653">r</span>&nbsp;<span class="op" id="4449655">=</span>&nbsp;<span class="ident" id="4449657">r</span><span class="op" id="4449658">,</span>&nbsp;<span class="op" id="4449660">*</span><span class="ident" id="4449661">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449665">*</span><span class="ident" id="4449666">p1</span>&nbsp;<span class="op" id="4449669">=</span>&nbsp;<span class="ident" id="4449671">p1</span><span class="op" id="4449673">.</span><span class="ident" id="4449674">mul</span><span class="op" id="4449677">(</span><span class="op" id="4449678">*</span><span class="ident" id="4449679">p</span><span class="op" id="4449680">,</span>&nbsp;<span class="ident" id="4449682">x</span><span class="op" id="4449683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449687">zz</span><span class="op" id="4449689">,</span>&nbsp;<span class="ident" id="4449691">r</span>&nbsp;<span class="op" id="4449693">=</span>&nbsp;<span class="ident" id="4449695">zz</span><span class="op" id="4449697">.</span><span class="ident" id="4449698">div</span><span class="op" id="4449701">(</span><span class="ident" id="4449702">r</span><span class="op" id="4449703">,</span>&nbsp;<span class="op" id="4449705">*</span><span class="ident" id="4449706">p1</span><span class="op" id="4449708">,</span>&nbsp;<span class="ident" id="4449710">m</span><span class="op" id="4449711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449715">*</span><span class="ident" id="4449716">p1</span><span class="op" id="4449718">,</span>&nbsp;<span class="ident" id="4449720">r</span>&nbsp;<span class="op" id="4449722">=</span>&nbsp;<span class="ident" id="4449724">r</span><span class="op" id="4449725">,</span>&nbsp;<span class="op" id="4449727">*</span><span class="ident" id="4449728">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449736">z</span>&nbsp;<span class="op" id="4449738">=</span>&nbsp;<span class="ident" id="4449740">z</span><span class="op" id="4449741">.</span><span class="ident" id="4449742">setWord</span><span class="op" id="4449749">(</span><span class="num" id="4449750">1</span><span class="op" id="4449751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449755">for</span>&nbsp;<span class="ident" id="4449759">i</span>&nbsp;<span class="op" id="4449761">:=</span>&nbsp;<span class="builtinfunc" id="4449764">len</span><span class="op" id="4449767">(</span><span class="ident" id="4449768">y</span><span class="op" id="4449769">)</span>&nbsp;<span class="op" id="4449771">-</span>&nbsp;<span class="num" id="4449773">1</span><span class="op" id="4449774">;</span>&nbsp;<span class="ident" id="4449776">i</span>&nbsp;<span class="op" id="4449778">&gt;=</span>&nbsp;<span class="num" id="4449781">0</span><span class="op" id="4449782">;</span>&nbsp;<span class="ident" id="4449784">i</span><span class="op" id="4449785">--</span>&nbsp;<span class="op" id="4449788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449792">yi</span>&nbsp;<span class="op" id="4449795">:=</span>&nbsp;<span class="ident" id="4449798">y</span><span class="op" id="4449799">[</span><span class="ident" id="4449800">i</span><span class="op" id="4449801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449805">for</span>&nbsp;<span class="ident" id="4449809">j</span>&nbsp;<span class="op" id="4449811">:=</span>&nbsp;<span class="num" id="4449814">0</span><span class="op" id="4449815">;</span>&nbsp;<span class="ident" id="4449817">j</span>&nbsp;<span class="op" id="4449819">&lt;</span>&nbsp;<span class="ident" id="4449821">_W</span><span class="op" id="4449823">;</span>&nbsp;<span class="ident" id="4449825">j</span>&nbsp;<span class="op" id="4449827">+=</span>&nbsp;<span class="ident" id="4449830">n</span>&nbsp;<span class="op" id="4449832">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449837">if</span>&nbsp;<span class="ident" id="4449840">i</span>&nbsp;<span class="op" id="4449842">!=</span>&nbsp;<span class="builtinfunc" id="4449845">len</span><span class="op" id="4449848">(</span><span class="ident" id="4449849">y</span><span class="op" id="4449850">)</span><span class="op" id="4449851">-</span><span class="num" id="4449852">1</span>&nbsp;<span class="op" id="4449854">||</span>&nbsp;<span class="ident" id="4449857">j</span>&nbsp;<span class="op" id="4449859">!=</span>&nbsp;<span class="num" id="4449862">0</span>&nbsp;<span class="op" id="4449864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449870">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449919">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449971">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450022">zz</span>&nbsp;<span class="op" id="4450025">=</span>&nbsp;<span class="ident" id="4450027">zz</span><span class="op" id="4450029">.</span><span class="ident" id="4450030">mul</span><span class="op" id="4450033">(</span><span class="ident" id="4450034">z</span><span class="op" id="4450035">,</span>&nbsp;<span class="ident" id="4450037">z</span><span class="op" id="4450038">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450044">zz</span><span class="op" id="4450046">,</span>&nbsp;<span class="ident" id="4450048">z</span>&nbsp;<span class="op" id="4450050">=</span>&nbsp;<span class="ident" id="4450052">z</span><span class="op" id="4450053">,</span>&nbsp;<span class="ident" id="4450055">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450062">zz</span><span class="op" id="4450064">,</span>&nbsp;<span class="ident" id="4450066">r</span>&nbsp;<span class="op" id="4450068">=</span>&nbsp;<span class="ident" id="4450070">zz</span><span class="op" id="4450072">.</span><span class="ident" id="4450073">div</span><span class="op" id="4450076">(</span><span class="ident" id="4450077">r</span><span class="op" id="4450078">,</span>&nbsp;<span class="ident" id="4450080">z</span><span class="op" id="4450081">,</span>&nbsp;<span class="ident" id="4450083">m</span><span class="op" id="4450084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450090">z</span><span class="op" id="4450091">,</span>&nbsp;<span class="ident" id="4450093">r</span>&nbsp;<span class="op" id="4450095">=</span>&nbsp;<span class="ident" id="4450097">r</span><span class="op" id="4450098">,</span>&nbsp;<span class="ident" id="4450100">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450107">zz</span>&nbsp;<span class="op" id="4450110">=</span>&nbsp;<span class="ident" id="4450112">zz</span><span class="op" id="4450114">.</span><span class="ident" id="4450115">mul</span><span class="op" id="4450118">(</span><span class="ident" id="4450119">z</span><span class="op" id="4450120">,</span>&nbsp;<span class="ident" id="4450122">z</span><span class="op" id="4450123">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450129">zz</span><span class="op" id="4450131">,</span>&nbsp;<span class="ident" id="4450133">z</span>&nbsp;<span class="op" id="4450135">=</span>&nbsp;<span class="ident" id="4450137">z</span><span class="op" id="4450138">,</span>&nbsp;<span class="ident" id="4450140">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450147">zz</span><span class="op" id="4450149">,</span>&nbsp;<span class="ident" id="4450151">r</span>&nbsp;<span class="op" id="4450153">=</span>&nbsp;<span class="ident" id="4450155">zz</span><span class="op" id="4450157">.</span><span class="ident" id="4450158">div</span><span class="op" id="4450161">(</span><span class="ident" id="4450162">r</span><span class="op" id="4450163">,</span>&nbsp;<span class="ident" id="4450165">z</span><span class="op" id="4450166">,</span>&nbsp;<span class="ident" id="4450168">m</span><span class="op" id="4450169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450175">z</span><span class="op" id="4450176">,</span>&nbsp;<span class="ident" id="4450178">r</span>&nbsp;<span class="op" id="4450180">=</span>&nbsp;<span class="ident" id="4450182">r</span><span class="op" id="4450183">,</span>&nbsp;<span class="ident" id="4450185">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450192">zz</span>&nbsp;<span class="op" id="4450195">=</span>&nbsp;<span class="ident" id="4450197">zz</span><span class="op" id="4450199">.</span><span class="ident" id="4450200">mul</span><span class="op" id="4450203">(</span><span class="ident" id="4450204">z</span><span class="op" id="4450205">,</span>&nbsp;<span class="ident" id="4450207">z</span><span class="op" id="4450208">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450214">zz</span><span class="op" id="4450216">,</span>&nbsp;<span class="ident" id="4450218">z</span>&nbsp;<span class="op" id="4450220">=</span>&nbsp;<span class="ident" id="4450222">z</span><span class="op" id="4450223">,</span>&nbsp;<span class="ident" id="4450225">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450232">zz</span><span class="op" id="4450234">,</span>&nbsp;<span class="ident" id="4450236">r</span>&nbsp;<span class="op" id="4450238">=</span>&nbsp;<span class="ident" id="4450240">zz</span><span class="op" id="4450242">.</span><span class="ident" id="4450243">div</span><span class="op" id="4450246">(</span><span class="ident" id="4450247">r</span><span class="op" id="4450248">,</span>&nbsp;<span class="ident" id="4450250">z</span><span class="op" id="4450251">,</span>&nbsp;<span class="ident" id="4450253">m</span><span class="op" id="4450254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450260">z</span><span class="op" id="4450261">,</span>&nbsp;<span class="ident" id="4450263">r</span>&nbsp;<span class="op" id="4450265">=</span>&nbsp;<span class="ident" id="4450267">r</span><span class="op" id="4450268">,</span>&nbsp;<span class="ident" id="4450270">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450277">zz</span>&nbsp;<span class="op" id="4450280">=</span>&nbsp;<span class="ident" id="4450282">zz</span><span class="op" id="4450284">.</span><span class="ident" id="4450285">mul</span><span class="op" id="4450288">(</span><span class="ident" id="4450289">z</span><span class="op" id="4450290">,</span>&nbsp;<span class="ident" id="4450292">z</span><span class="op" id="4450293">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450299">zz</span><span class="op" id="4450301">,</span>&nbsp;<span class="ident" id="4450303">z</span>&nbsp;<span class="op" id="4450305">=</span>&nbsp;<span class="ident" id="4450307">z</span><span class="op" id="4450308">,</span>&nbsp;<span class="ident" id="4450310">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450317">zz</span><span class="op" id="4450319">,</span>&nbsp;<span class="ident" id="4450321">r</span>&nbsp;<span class="op" id="4450323">=</span>&nbsp;<span class="ident" id="4450325">zz</span><span class="op" id="4450327">.</span><span class="ident" id="4450328">div</span><span class="op" id="4450331">(</span><span class="ident" id="4450332">r</span><span class="op" id="4450333">,</span>&nbsp;<span class="ident" id="4450335">z</span><span class="op" id="4450336">,</span>&nbsp;<span class="ident" id="4450338">m</span><span class="op" id="4450339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450345">z</span><span class="op" id="4450346">,</span>&nbsp;<span class="ident" id="4450348">r</span>&nbsp;<span class="op" id="4450350">=</span>&nbsp;<span class="ident" id="4450352">r</span><span class="op" id="4450353">,</span>&nbsp;<span class="ident" id="4450355">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450366">zz</span>&nbsp;<span class="op" id="4450369">=</span>&nbsp;<span class="ident" id="4450371">zz</span><span class="op" id="4450373">.</span><span class="ident" id="4450374">mul</span><span class="op" id="4450377">(</span><span class="ident" id="4450378">z</span><span class="op" id="4450379">,</span>&nbsp;<span class="ident" id="4450381">powers</span><span class="op" id="4450387">[</span><span class="ident" id="4450388">yi</span><span class="op" id="4450390">&gt;&gt;</span><span class="op" id="4450392">(</span><span class="ident" id="4450393">_W</span><span class="op" id="4450395">-</span><span class="ident" id="4450396">n</span><span class="op" id="4450397">)</span><span class="op" id="4450398">]</span><span class="op" id="4450399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450404">zz</span><span class="op" id="4450406">,</span>&nbsp;<span class="ident" id="4450408">z</span>&nbsp;<span class="op" id="4450410">=</span>&nbsp;<span class="ident" id="4450412">z</span><span class="op" id="4450413">,</span>&nbsp;<span class="ident" id="4450415">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450421">zz</span><span class="op" id="4450423">,</span>&nbsp;<span class="ident" id="4450425">r</span>&nbsp;<span class="op" id="4450427">=</span>&nbsp;<span class="ident" id="4450429">zz</span><span class="op" id="4450431">.</span><span class="ident" id="4450432">div</span><span class="op" id="4450435">(</span><span class="ident" id="4450436">r</span><span class="op" id="4450437">,</span>&nbsp;<span class="ident" id="4450439">z</span><span class="op" id="4450440">,</span>&nbsp;<span class="ident" id="4450442">m</span><span class="op" id="4450443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450448">z</span><span class="op" id="4450449">,</span>&nbsp;<span class="ident" id="4450451">r</span>&nbsp;<span class="op" id="4450453">=</span>&nbsp;<span class="ident" id="4450455">r</span><span class="op" id="4450456">,</span>&nbsp;<span class="ident" id="4450458">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450464">yi</span>&nbsp;<span class="op" id="4450467">&lt;&lt;=</span>&nbsp;<span class="ident" id="4450471">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450482">return</span>&nbsp;<span class="ident" id="4450489">z</span><span class="op" id="4450490">.</span><span class="ident" id="4450491">norm</span><span class="op" id="4450495">(</span><span class="op" id="4450496">)</span><br>
<span class="lineno">1380</span><span class="op" id="4450498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4450501">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="4450580">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="4450645">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="4450685">func</span>&nbsp;<span class="op" id="4450690">(</span><span class="ident" id="4450691">n</span>&nbsp;<span class="ident" id="4450693">nat</span><span class="op" id="4450696">)</span>&nbsp;<span class="ident" id="4450698">probablyPrime</span><span class="op" id="4450711">(</span><span class="ident" id="4450712">reps</span>&nbsp;<span class="builtintype" id="4450717">int</span><span class="op" id="4450720">)</span>&nbsp;<span class="builtintype" id="4450722">bool</span>&nbsp;<span class="op" id="4450727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450730">if</span>&nbsp;<span class="builtinfunc" id="4450733">len</span><span class="op" id="4450736">(</span><span class="ident" id="4450737">n</span><span class="op" id="4450738">)</span>&nbsp;<span class="op" id="4450740">==</span>&nbsp;<span class="num" id="4450743">0</span>&nbsp;<span class="op" id="4450745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450749">return</span>&nbsp;<span class="builtintype" id="4450756">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450767">if</span>&nbsp;<span class="builtinfunc" id="4450770">len</span><span class="op" id="4450773">(</span><span class="ident" id="4450774">n</span><span class="op" id="4450775">)</span>&nbsp;<span class="op" id="4450777">==</span>&nbsp;<span class="num" id="4450780">1</span>&nbsp;<span class="op" id="4450782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450786">if</span>&nbsp;<span class="ident" id="4450789">n</span><span class="op" id="4450790">[</span><span class="num" id="4450791">0</span><span class="op" id="4450792">]</span>&nbsp;<span class="op" id="4450794">&lt;</span>&nbsp;<span class="num" id="4450796">2</span>&nbsp;<span class="op" id="4450798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450803">return</span>&nbsp;<span class="builtintype" id="4450810">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450823">if</span>&nbsp;<span class="ident" id="4450826">n</span><span class="op" id="4450827">[</span><span class="num" id="4450828">0</span><span class="op" id="4450829">]</span><span class="op" id="4450830">%</span><span class="num" id="4450831">2</span>&nbsp;<span class="op" id="4450833">==</span>&nbsp;<span class="num" id="4450836">0</span>&nbsp;<span class="op" id="4450838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450843">return</span>&nbsp;<span class="ident" id="4450850">n</span><span class="op" id="4450851">[</span><span class="num" id="4450852">0</span><span class="op" id="4450853">]</span>&nbsp;<span class="op" id="4450855">==</span>&nbsp;<span class="num" id="4450858">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4450867">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4450925">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450964">switch</span>&nbsp;<span class="ident" id="4450971">n</span><span class="op" id="4450972">[</span><span class="num" id="4450973">0</span><span class="op" id="4450974">]</span>&nbsp;<span class="op" id="4450976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450980">case</span>&nbsp;<span class="num" id="4450985">3</span><span class="op" id="4450986">,</span>&nbsp;<span class="num" id="4450988">5</span><span class="op" id="4450989">,</span>&nbsp;<span class="num" id="4450991">7</span><span class="op" id="4450992">,</span>&nbsp;<span class="num" id="4450994">11</span><span class="op" id="4450996">,</span>&nbsp;<span class="num" id="4450998">13</span><span class="op" id="4451000">,</span>&nbsp;<span class="num" id="4451002">17</span><span class="op" id="4451004">,</span>&nbsp;<span class="num" id="4451006">19</span><span class="op" id="4451008">,</span>&nbsp;<span class="num" id="4451010">23</span><span class="op" id="4451012">,</span>&nbsp;<span class="num" id="4451014">29</span><span class="op" id="4451016">,</span>&nbsp;<span class="num" id="4451018">31</span><span class="op" id="4451020">,</span>&nbsp;<span class="num" id="4451022">37</span><span class="op" id="4451024">,</span>&nbsp;<span class="num" id="4451026">41</span><span class="op" id="4451028">,</span>&nbsp;<span class="num" id="4451030">43</span><span class="op" id="4451032">,</span>&nbsp;<span class="num" id="4451034">47</span><span class="op" id="4451036">,</span>&nbsp;<span class="num" id="4451038">53</span><span class="op" id="4451040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451045">return</span>&nbsp;<span class="builtintype" id="4451052">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451059">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451066">const</span>&nbsp;<span class="ident" id="4451072">primesProduct32</span>&nbsp;<span class="op" id="4451088">=</span>&nbsp;<span class="num" id="4451090">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451109">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451144">const</span>&nbsp;<span class="ident" id="4451150">primesProduct64</span>&nbsp;<span class="op" id="4451166">=</span>&nbsp;<span class="num" id="4451168">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="4451187">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451223">var</span>&nbsp;<span class="ident" id="4451227">r</span>&nbsp;<span class="ident" id="4451229">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451235">switch</span>&nbsp;<span class="ident" id="4451242">_W</span>&nbsp;<span class="op" id="4451245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451248">case</span>&nbsp;<span class="num" id="4451253">32</span><span class="op" id="4451255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451259">r</span>&nbsp;<span class="op" id="4451261">=</span>&nbsp;<span class="ident" id="4451263">n</span><span class="op" id="4451264">.</span><span class="ident" id="4451265">modW</span><span class="op" id="4451269">(</span><span class="ident" id="4451270">primesProduct32</span><span class="op" id="4451285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451288">case</span>&nbsp;<span class="num" id="4451293">64</span><span class="op" id="4451295">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451299">r</span>&nbsp;<span class="op" id="4451301">=</span>&nbsp;<span class="ident" id="4451303">n</span><span class="op" id="4451304">.</span><span class="ident" id="4451305">modW</span><span class="op" id="4451309">(</span><span class="ident" id="4451310">primesProduct64</span>&nbsp;<span class="op" id="4451326">&amp;</span>&nbsp;<span class="ident" id="4451328">_M</span><span class="op" id="4451330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451333">default</span><span class="op" id="4451340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4451344">panic</span><span class="op" id="4451349">(</span><span class="string" id="4451350">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4451369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451376">if</span>&nbsp;<span class="ident" id="4451379">r</span><span class="op" id="4451380">%</span><span class="num" id="4451381">3</span>&nbsp;<span class="op" id="4451383">==</span>&nbsp;<span class="num" id="4451386">0</span>&nbsp;<span class="op" id="4451388">||</span>&nbsp;<span class="ident" id="4451391">r</span><span class="op" id="4451392">%</span><span class="num" id="4451393">5</span>&nbsp;<span class="op" id="4451395">==</span>&nbsp;<span class="num" id="4451398">0</span>&nbsp;<span class="op" id="4451400">||</span>&nbsp;<span class="ident" id="4451403">r</span><span class="op" id="4451404">%</span><span class="num" id="4451405">7</span>&nbsp;<span class="op" id="4451407">==</span>&nbsp;<span class="num" id="4451410">0</span>&nbsp;<span class="op" id="4451412">||</span>&nbsp;<span class="ident" id="4451415">r</span><span class="op" id="4451416">%</span><span class="num" id="4451417">11</span>&nbsp;<span class="op" id="4451420">==</span>&nbsp;<span class="num" id="4451423">0</span>&nbsp;<span class="op" id="4451425">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451430">r</span><span class="op" id="4451431">%</span><span class="num" id="4451432">13</span>&nbsp;<span class="op" id="4451435">==</span>&nbsp;<span class="num" id="4451438">0</span>&nbsp;<span class="op" id="4451440">||</span>&nbsp;<span class="ident" id="4451443">r</span><span class="op" id="4451444">%</span><span class="num" id="4451445">17</span>&nbsp;<span class="op" id="4451448">==</span>&nbsp;<span class="num" id="4451451">0</span>&nbsp;<span class="op" id="4451453">||</span>&nbsp;<span class="ident" id="4451456">r</span><span class="op" id="4451457">%</span><span class="num" id="4451458">19</span>&nbsp;<span class="op" id="4451461">==</span>&nbsp;<span class="num" id="4451464">0</span>&nbsp;<span class="op" id="4451466">||</span>&nbsp;<span class="ident" id="4451469">r</span><span class="op" id="4451470">%</span><span class="num" id="4451471">23</span>&nbsp;<span class="op" id="4451474">==</span>&nbsp;<span class="num" id="4451477">0</span>&nbsp;<span class="op" id="4451479">||</span>&nbsp;<span class="ident" id="4451482">r</span><span class="op" id="4451483">%</span><span class="num" id="4451484">29</span>&nbsp;<span class="op" id="4451487">==</span>&nbsp;<span class="num" id="4451490">0</span>&nbsp;<span class="op" id="4451492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451496">return</span>&nbsp;<span class="builtintype" id="4451503">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451514">if</span>&nbsp;<span class="ident" id="4451517">_W</span>&nbsp;<span class="op" id="4451520">==</span>&nbsp;<span class="num" id="4451523">64</span>&nbsp;<span class="op" id="4451526">&amp;&amp;</span>&nbsp;<span class="op" id="4451529">(</span><span class="ident" id="4451530">r</span><span class="op" id="4451531">%</span><span class="num" id="4451532">31</span>&nbsp;<span class="op" id="4451535">==</span>&nbsp;<span class="num" id="4451538">0</span>&nbsp;<span class="op" id="4451540">||</span>&nbsp;<span class="ident" id="4451543">r</span><span class="op" id="4451544">%</span><span class="num" id="4451545">37</span>&nbsp;<span class="op" id="4451548">==</span>&nbsp;<span class="num" id="4451551">0</span>&nbsp;<span class="op" id="4451553">||</span>&nbsp;<span class="ident" id="4451556">r</span><span class="op" id="4451557">%</span><span class="num" id="4451558">41</span>&nbsp;<span class="op" id="4451561">==</span>&nbsp;<span class="num" id="4451564">0</span>&nbsp;<span class="op" id="4451566">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451571">r</span><span class="op" id="4451572">%</span><span class="num" id="4451573">43</span>&nbsp;<span class="op" id="4451576">==</span>&nbsp;<span class="num" id="4451579">0</span>&nbsp;<span class="op" id="4451581">||</span>&nbsp;<span class="ident" id="4451584">r</span><span class="op" id="4451585">%</span><span class="num" id="4451586">47</span>&nbsp;<span class="op" id="4451589">==</span>&nbsp;<span class="num" id="4451592">0</span>&nbsp;<span class="op" id="4451594">||</span>&nbsp;<span class="ident" id="4451597">r</span><span class="op" id="4451598">%</span><span class="num" id="4451599">53</span>&nbsp;<span class="op" id="4451602">==</span>&nbsp;<span class="num" id="4451605">0</span><span class="op" id="4451606">)</span>&nbsp;<span class="op" id="4451608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451612">return</span>&nbsp;<span class="builtintype" id="4451619">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451630">nm1</span>&nbsp;<span class="op" id="4451634">:=</span>&nbsp;<span class="ident" id="4451637">nat</span><span class="op" id="4451640">(</span><span class="ident" id="4451641">nil</span><span class="op" id="4451644">)</span><span class="op" id="4451645">.</span><span class="ident" id="4451646">sub</span><span class="op" id="4451649">(</span><span class="ident" id="4451650">n</span><span class="op" id="4451651">,</span>&nbsp;<span class="ident" id="4451653">natOne</span><span class="op" id="4451659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451662">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451704">k</span>&nbsp;<span class="op" id="4451706">:=</span>&nbsp;<span class="ident" id="4451709">nm1</span><span class="op" id="4451712">.</span><span class="ident" id="4451713">trailingZeroBits</span><span class="op" id="4451729">(</span><span class="op" id="4451730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451733">q</span>&nbsp;<span class="op" id="4451735">:=</span>&nbsp;<span class="ident" id="4451738">nat</span><span class="op" id="4451741">(</span><span class="ident" id="4451742">nil</span><span class="op" id="4451745">)</span><span class="op" id="4451746">.</span><span class="ident" id="4451747">shr</span><span class="op" id="4451750">(</span><span class="ident" id="4451751">nm1</span><span class="op" id="4451754">,</span>&nbsp;<span class="ident" id="4451756">k</span><span class="op" id="4451757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451761">nm3</span>&nbsp;<span class="op" id="4451765">:=</span>&nbsp;<span class="ident" id="4451768">nat</span><span class="op" id="4451771">(</span><span class="ident" id="4451772">nil</span><span class="op" id="4451775">)</span><span class="op" id="4451776">.</span><span class="ident" id="4451777">sub</span><span class="op" id="4451780">(</span><span class="ident" id="4451781">nm1</span><span class="op" id="4451784">,</span>&nbsp;<span class="ident" id="4451786">natTwo</span><span class="op" id="4451792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451795">rand</span>&nbsp;<span class="op" id="4451800">:=</span>&nbsp;<span class="ident" id="4451803">rand</span><span class="op" id="4451807">.</span><span class="ident" id="4451808">New</span><span class="op" id="4451811">(</span><span class="ident" id="4451812">rand</span><span class="op" id="4451816">.</span><span class="ident" id="4451817">NewSource</span><span class="op" id="4451826">(</span><span class="ident" id="4451827">int64</span><span class="op" id="4451832">(</span><span class="ident" id="4451833">n</span><span class="op" id="4451834">[</span><span class="num" id="4451835">0</span><span class="op" id="4451836">]</span><span class="op" id="4451837">)</span><span class="op" id="4451838">)</span><span class="op" id="4451839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451843">var</span>&nbsp;<span class="ident" id="4451847">x</span><span class="op" id="4451848">,</span>&nbsp;<span class="ident" id="4451850">y</span><span class="op" id="4451851">,</span>&nbsp;<span class="ident" id="4451853">quotient</span>&nbsp;<span class="ident" id="4451862">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451867">nm3Len</span>&nbsp;<span class="op" id="4451874">:=</span>&nbsp;<span class="ident" id="4451877">nm3</span><span class="op" id="4451880">.</span><span class="ident" id="4451881">bitLen</span><span class="op" id="4451887">(</span><span class="op" id="4451888">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="4451891">NextRandom</span><span class="op" id="4451901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451904">for</span>&nbsp;<span class="ident" id="4451908">i</span>&nbsp;<span class="op" id="4451910">:=</span>&nbsp;<span class="num" id="4451913">0</span><span class="op" id="4451914">;</span>&nbsp;<span class="ident" id="4451916">i</span>&nbsp;<span class="op" id="4451918">&lt;</span>&nbsp;<span class="ident" id="4451920">reps</span><span class="op" id="4451924">;</span>&nbsp;<span class="ident" id="4451926">i</span><span class="op" id="4451927">++</span>&nbsp;<span class="op" id="4451930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451934">x</span>&nbsp;<span class="op" id="4451936">=</span>&nbsp;<span class="ident" id="4451938">x</span><span class="op" id="4451939">.</span><span class="ident" id="4451940">random</span><span class="op" id="4451946">(</span><span class="ident" id="4451947">rand</span><span class="op" id="4451951">,</span>&nbsp;<span class="ident" id="4451953">nm3</span><span class="op" id="4451956">,</span>&nbsp;<span class="ident" id="4451958">nm3Len</span><span class="op" id="4451964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451968">x</span>&nbsp;<span class="op" id="4451970">=</span>&nbsp;<span class="ident" id="4451972">x</span><span class="op" id="4451973">.</span><span class="ident" id="4451974">add</span><span class="op" id="4451977">(</span><span class="ident" id="4451978">x</span><span class="op" id="4451979">,</span>&nbsp;<span class="ident" id="4451981">natTwo</span><span class="op" id="4451987">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451991">y</span>&nbsp;<span class="op" id="4451993">=</span>&nbsp;<span class="ident" id="4451995">y</span><span class="op" id="4451996">.</span><span class="ident" id="4451997">expNN</span><span class="op" id="4452002">(</span><span class="ident" id="4452003">x</span><span class="op" id="4452004">,</span>&nbsp;<span class="ident" id="4452006">q</span><span class="op" id="4452007">,</span>&nbsp;<span class="ident" id="4452009">n</span><span class="op" id="4452010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452014">if</span>&nbsp;<span class="ident" id="4452017">y</span><span class="op" id="4452018">.</span><span class="ident" id="4452019">cmp</span><span class="op" id="4452022">(</span><span class="ident" id="4452023">natOne</span><span class="op" id="4452029">)</span>&nbsp;<span class="op" id="4452031">==</span>&nbsp;<span class="num" id="4452034">0</span>&nbsp;<span class="op" id="4452036">||</span>&nbsp;<span class="ident" id="4452039">y</span><span class="op" id="4452040">.</span><span class="ident" id="4452041">cmp</span><span class="op" id="4452044">(</span><span class="ident" id="4452045">nm1</span><span class="op" id="4452048">)</span>&nbsp;<span class="op" id="4452050">==</span>&nbsp;<span class="num" id="4452053">0</span>&nbsp;<span class="op" id="4452055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452060">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452075">for</span>&nbsp;<span class="ident" id="4452079">j</span>&nbsp;<span class="op" id="4452081">:=</span>&nbsp;<span class="builtintype" id="4452084">uint</span><span class="op" id="4452088">(</span><span class="num" id="4452089">1</span><span class="op" id="4452090">)</span><span class="op" id="4452091">;</span>&nbsp;<span class="ident" id="4452093">j</span>&nbsp;<span class="op" id="4452095">&lt;</span>&nbsp;<span class="ident" id="4452097">k</span><span class="op" id="4452098">;</span>&nbsp;<span class="ident" id="4452100">j</span><span class="op" id="4452101">++</span>&nbsp;<span class="op" id="4452104">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452109">y</span>&nbsp;<span class="op" id="4452111">=</span>&nbsp;<span class="ident" id="4452113">y</span><span class="op" id="4452114">.</span><span class="ident" id="4452115">mul</span><span class="op" id="4452118">(</span><span class="ident" id="4452119">y</span><span class="op" id="4452120">,</span>&nbsp;<span class="ident" id="4452122">y</span><span class="op" id="4452123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452128">quotient</span><span class="op" id="4452136">,</span>&nbsp;<span class="ident" id="4452138">y</span>&nbsp;<span class="op" id="4452140">=</span>&nbsp;<span class="ident" id="4452142">quotient</span><span class="op" id="4452150">.</span><span class="ident" id="4452151">div</span><span class="op" id="4452154">(</span><span class="ident" id="4452155">y</span><span class="op" id="4452156">,</span>&nbsp;<span class="ident" id="4452158">y</span><span class="op" id="4452159">,</span>&nbsp;<span class="ident" id="4452161">n</span><span class="op" id="4452162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452167">if</span>&nbsp;<span class="ident" id="4452170">y</span><span class="op" id="4452171">.</span><span class="ident" id="4452172">cmp</span><span class="op" id="4452175">(</span><span class="ident" id="4452176">nm1</span><span class="op" id="4452179">)</span>&nbsp;<span class="op" id="4452181">==</span>&nbsp;<span class="num" id="4452184">0</span>&nbsp;<span class="op" id="4452186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452192">continue</span>&nbsp;<span class="ident" id="4452201">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452215">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452220">if</span>&nbsp;<span class="ident" id="4452223">y</span><span class="op" id="4452224">.</span><span class="ident" id="4452225">cmp</span><span class="op" id="4452228">(</span><span class="ident" id="4452229">natOne</span><span class="op" id="4452235">)</span>&nbsp;<span class="op" id="4452237">==</span>&nbsp;<span class="num" id="4452240">0</span>&nbsp;<span class="op" id="4452242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452248">return</span>&nbsp;<span class="builtintype" id="4452255">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452272">return</span>&nbsp;<span class="builtintype" id="4452279">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452290">return</span>&nbsp;<span class="builtintype" id="4452297">true</span><br>
<span class="lineno"></span><span class="op" id="4452302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="4452305">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4452372">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4452439">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4452506">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="4452536">func</span>&nbsp;<span class="op" id="4452541">(</span><span class="ident" id="4452542">z</span>&nbsp;<span class="ident" id="4452544">nat</span><span class="op" id="4452547">)</span>&nbsp;<span class="ident" id="4452549">bytes</span><span class="op" id="4452554">(</span><span class="ident" id="4452555">buf</span>&nbsp;<span class="op" id="4452559">[</span><span class="op" id="4452560">]</span><span class="builtintype" id="4452561">byte</span><span class="op" id="4452565">)</span>&nbsp;<span class="op" id="4452567">(</span><span class="ident" id="4452568">i</span>&nbsp;<span class="builtintype" id="4452570">int</span><span class="op" id="4452573">)</span>&nbsp;<span class="op" id="4452575">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452578">i</span>&nbsp;<span class="op" id="4452580">=</span>&nbsp;<span class="builtinfunc" id="4452582">len</span><span class="op" id="4452585">(</span><span class="ident" id="4452586">buf</span><span class="op" id="4452589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452592">for</span>&nbsp;<span class="ident" id="4452596">_</span><span class="op" id="4452597">,</span>&nbsp;<span class="ident" id="4452599">d</span>&nbsp;<span class="op" id="4452601">:=</span>&nbsp;<span class="keyword" id="4452604">range</span>&nbsp;<span class="ident" id="4452610">z</span>&nbsp;<span class="op" id="4452612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452616">for</span>&nbsp;<span class="ident" id="4452620">j</span>&nbsp;<span class="op" id="4452622">:=</span>&nbsp;<span class="num" id="4452625">0</span><span class="op" id="4452626">;</span>&nbsp;<span class="ident" id="4452628">j</span>&nbsp;<span class="op" id="4452630">&lt;</span>&nbsp;<span class="ident" id="4452632">_S</span><span class="op" id="4452634">;</span>&nbsp;<span class="ident" id="4452636">j</span><span class="op" id="4452637">++</span>&nbsp;<span class="op" id="4452640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452645">i</span><span class="op" id="4452646">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452652">buf</span><span class="op" id="4452655">[</span><span class="ident" id="4452656">i</span><span class="op" id="4452657">]</span>&nbsp;<span class="op" id="4452659">=</span>&nbsp;<span class="builtintype" id="4452661">byte</span><span class="op" id="4452665">(</span><span class="ident" id="4452666">d</span><span class="op" id="4452667">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452672">d</span>&nbsp;<span class="op" id="4452674">&gt;&gt;=</span>&nbsp;<span class="num" id="4452678">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452689">for</span>&nbsp;<span class="ident" id="4452693">i</span>&nbsp;<span class="op" id="4452695">&lt;</span>&nbsp;<span class="builtinfunc" id="4452697">len</span><span class="op" id="4452700">(</span><span class="ident" id="4452701">buf</span><span class="op" id="4452704">)</span>&nbsp;<span class="op" id="4452706">&amp;&amp;</span>&nbsp;<span class="ident" id="4452709">buf</span><span class="op" id="4452712">[</span><span class="ident" id="4452713">i</span><span class="op" id="4452714">]</span>&nbsp;<span class="op" id="4452716">==</span>&nbsp;<span class="num" id="4452719">0</span>&nbsp;<span class="op" id="4452721">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452725">i</span><span class="op" id="4452726">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452734">return</span><br>
<span class="lineno"></span><span class="op" id="4452741">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="4452744">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="4452809">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4452858">func</span>&nbsp;<span class="op" id="4452863">(</span><span class="ident" id="4452864">z</span>&nbsp;<span class="ident" id="4452866">nat</span><span class="op" id="4452869">)</span>&nbsp;<span class="ident" id="4452871">setBytes</span><span class="op" id="4452879">(</span><span class="ident" id="4452880">buf</span>&nbsp;<span class="op" id="4452884">[</span><span class="op" id="4452885">]</span><span class="builtintype" id="4452886">byte</span><span class="op" id="4452890">)</span>&nbsp;<span class="ident" id="4452892">nat</span>&nbsp;<span class="op" id="4452896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452899">z</span>&nbsp;<span class="op" id="4452901">=</span>&nbsp;<span class="ident" id="4452903">z</span><span class="op" id="4452904">.</span><span class="builtinfunc" id="4452905">make</span><span class="op" id="4452909">(</span><span class="op" id="4452910">(</span><span class="builtinfunc" id="4452911">len</span><span class="op" id="4452914">(</span><span class="ident" id="4452915">buf</span><span class="op" id="4452918">)</span>&nbsp;<span class="op" id="4452920">+</span>&nbsp;<span class="ident" id="4452922">_S</span>&nbsp;<span class="op" id="4452925">-</span>&nbsp;<span class="num" id="4452927">1</span><span class="op" id="4452928">)</span>&nbsp;<span class="op" id="4452930">/</span>&nbsp;<span class="ident" id="4452932">_S</span><span class="op" id="4452934">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452938">k</span>&nbsp;<span class="op" id="4452940">:=</span>&nbsp;<span class="num" id="4452943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452946">s</span>&nbsp;<span class="op" id="4452948">:=</span>&nbsp;<span class="builtintype" id="4452951">uint</span><span class="op" id="4452955">(</span><span class="num" id="4452956">0</span><span class="op" id="4452957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452960">var</span>&nbsp;<span class="ident" id="4452964">d</span>&nbsp;<span class="ident" id="4452966">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452972">for</span>&nbsp;<span class="ident" id="4452976">i</span>&nbsp;<span class="op" id="4452978">:=</span>&nbsp;<span class="builtinfunc" id="4452981">len</span><span class="op" id="4452984">(</span><span class="ident" id="4452985">buf</span><span class="op" id="4452988">)</span><span class="op" id="4452989">;</span>&nbsp;<span class="ident" id="4452991">i</span>&nbsp;<span class="op" id="4452993">&gt;</span>&nbsp;<span class="num" id="4452995">0</span><span class="op" id="4452996">;</span>&nbsp;<span class="ident" id="4452998">i</span><span class="op" id="4452999">--</span>&nbsp;<span class="op" id="4453002">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453006">d</span>&nbsp;<span class="op" id="4453008">|=</span>&nbsp;<span class="ident" id="4453011">Word</span><span class="op" id="4453015">(</span><span class="ident" id="4453016">buf</span><span class="op" id="4453019">[</span><span class="ident" id="4453020">i</span><span class="op" id="4453021">-</span><span class="num" id="4453022">1</span><span class="op" id="4453023">]</span><span class="op" id="4453024">)</span>&nbsp;<span class="op" id="4453026">&lt;&lt;</span>&nbsp;<span class="ident" id="4453029">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453033">if</span>&nbsp;<span class="ident" id="4453036">s</span>&nbsp;<span class="op" id="4453038">+=</span>&nbsp;<span class="num" id="4453041">8</span><span class="op" id="4453042">;</span>&nbsp;<span class="ident" id="4453044">s</span>&nbsp;<span class="op" id="4453046">==</span>&nbsp;<span class="ident" id="4453049">_S</span><span class="op" id="4453051">*</span><span class="num" id="4453052">8</span>&nbsp;<span class="op" id="4453054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453059">z</span><span class="op" id="4453060">[</span><span class="ident" id="4453061">k</span><span class="op" id="4453062">]</span>&nbsp;<span class="op" id="4453064">=</span>&nbsp;<span class="ident" id="4453066">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453071">k</span><span class="op" id="4453072">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453078">s</span>&nbsp;<span class="op" id="4453080">=</span>&nbsp;<span class="num" id="4453082">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453087">d</span>&nbsp;<span class="op" id="4453089">=</span>&nbsp;<span class="num" id="4453091">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453101">if</span>&nbsp;<span class="ident" id="4453104">k</span>&nbsp;<span class="op" id="4453106">&lt;</span>&nbsp;<span class="builtinfunc" id="4453108">len</span><span class="op" id="4453111">(</span><span class="ident" id="4453112">z</span><span class="op" id="4453113">)</span>&nbsp;<span class="op" id="4453115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453119">z</span><span class="op" id="4453120">[</span><span class="ident" id="4453121">k</span><span class="op" id="4453122">]</span>&nbsp;<span class="op" id="4453124">=</span>&nbsp;<span class="ident" id="4453126">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453133">return</span>&nbsp;<span class="ident" id="4453140">z</span><span class="op" id="4453141">.</span><span class="ident" id="4453142">norm</span><span class="op" id="4453146">(</span><span class="op" id="4453147">)</span><br>
<span class="lineno"></span><span class="op" id="4453149">}</span>
</div>
</body>
</html>
