<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html" class="current">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3080230">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3080285">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3080339">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3080390">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="3080446">//</span><br>
<span class="lineno"></span><span class="comment" id="3080449">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3080511">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="3080572">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="3080641">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="3080701">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="3080739">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="3080764">//</span><br>
<span class="lineno"></span><span class="comment" id="3080767">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="3080824">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3080886">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="3080944">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3081009">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="3081037">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="3081082">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="3081120">//</span><br>
<span class="lineno"></span><span class="comment" id="3081123">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="3081172">//</span><br>
<span class="lineno"></span><span class="comment" id="3081175">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="3081254">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="3081328">//</span><br>
<span class="lineno"></span><span class="comment" id="3081331">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="3081373">//</span><br>
<span class="lineno"></span><span class="comment" id="3081376">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="3081447">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="3081520">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="3081597">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="3081675">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3081750">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="3081773">//</span><br>
<span class="lineno"></span><span class="comment" id="3081776">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3081853">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="3081909">//</span><br>
<span class="lineno"></span><span class="comment" id="3081912">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="3081985">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3082055">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3082131">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="3082202">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3082279">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="3082345">//</span><br>
<span class="lineno"></span><span class="comment" id="3082348">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="3082426">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3082504">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="3082579">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="3082653">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3082724">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3082780">//</span><br>
<span class="lineno"></span><span class="comment" id="3082783">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3082857">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="3082879">//</span><br>
<span class="lineno"></span><span class="comment" id="3082882">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="3082939">//</span><br>
<span class="lineno"></span><span class="comment" id="3082942">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3083014">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="3083087">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="3083159">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="3083180">//</span><br>
<span class="lineno"></span><span class="comment" id="3083183">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="3083250">//</span><br>
<span class="lineno">65</span><span class="keyword" id="3083253">package</span>&nbsp;<span class="ident" id="3083261">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3083269">import</span>&nbsp;<span class="op" id="3083276">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083279">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083288">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083294">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083311">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083322">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083333">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083341">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3083352">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3083367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3083370">var</span>&nbsp;<span class="ident" id="3083374">debug</span>&nbsp;<span class="op" id="3083380">=</span>&nbsp;<span class="builtintype" id="3083382">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3083389">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="3083455">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3083518">type</span>&nbsp;<span class="ident" id="3083523">Regexp</span>&nbsp;<span class="keyword" id="3083530">struct</span>&nbsp;<span class="op" id="3083537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083540">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083568">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3083583">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3083598">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083623">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3083638">*</span><span class="ident" id="3083639">syntax</span><span class="op" id="3083645">.</span><span class="ident" id="3083646">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3083653">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083674">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3083689">*</span><span class="ident" id="3083690">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3083704">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083730">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3083745">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3083760">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083802">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3083817">[</span><span class="op" id="3083818">]</span><span class="builtintype" id="3083819">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3083832">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083856">prefixComplete</span>&nbsp;<span class="builtintype" id="3083871">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3083886">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083918">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3083933">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3083948">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083973">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3083988">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3084003">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084034">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084049">syntax</span><span class="op" id="3084055">.</span><span class="ident" id="3084056">EmptyOp</span>&nbsp;<span class="comment" id="3084064">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084118">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3084133">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084138">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3084153">[</span><span class="op" id="3084154">]</span><span class="builtintype" id="3084155">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084163">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3084178">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084185">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084226">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084234">sync</span><span class="op" id="3084238">.</span><span class="ident" id="3084239">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084246">machine</span>&nbsp;<span class="op" id="3084254">[</span><span class="op" id="3084255">]</span><span class="op" id="3084256">*</span><span class="ident" id="3084257">machine</span><br>
<span class="lineno">100</span><span class="op" id="3084265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3084268">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3084342">func</span>&nbsp;<span class="op" id="3084347">(</span><span class="ident" id="3084348">re</span>&nbsp;<span class="op" id="3084351">*</span><span class="ident" id="3084352">Regexp</span><span class="op" id="3084358">)</span>&nbsp;<span class="ident" id="3084360">String</span><span class="op" id="3084366">(</span><span class="op" id="3084367">)</span>&nbsp;<span class="builtintype" id="3084369">string</span>&nbsp;<span class="op" id="3084376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084379">return</span>&nbsp;<span class="ident" id="3084386">re</span><span class="op" id="3084388">.</span><span class="ident" id="3084389">expr</span><br>
<span class="lineno">105</span><span class="op" id="3084394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3084397">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="3084464">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="3084523">//</span><br>
<span class="lineno">110</span><span class="comment" id="3084526">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3084589">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3084661">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3084734">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="3084798">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="3084865">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="3084927">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="3084985">func</span>&nbsp;<span class="ident" id="3084990">Compile</span><span class="op" id="3084997">(</span><span class="ident" id="3084998">expr</span>&nbsp;<span class="builtintype" id="3085003">string</span><span class="op" id="3085009">)</span>&nbsp;<span class="op" id="3085011">(</span><span class="op" id="3085012">*</span><span class="ident" id="3085013">Regexp</span><span class="op" id="3085019">,</span>&nbsp;<span class="builtintype" id="3085021">error</span><span class="op" id="3085026">)</span>&nbsp;<span class="op" id="3085028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085031">return</span>&nbsp;<span class="ident" id="3085038">compile</span><span class="op" id="3085045">(</span><span class="ident" id="3085046">expr</span><span class="op" id="3085050">,</span>&nbsp;<span class="ident" id="3085052">syntax</span><span class="op" id="3085058">.</span><span class="ident" id="3085059">Perl</span><span class="op" id="3085063">,</span>&nbsp;<span class="builtintype" id="3085065">false</span><span class="op" id="3085070">)</span><br>
<span class="lineno"></span><span class="op" id="3085072">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3085075">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3085144">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3085210">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="3085231">//</span><br>
<span class="lineno">125</span><span class="comment" id="3085234">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3085306">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3085378">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="3085429">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="3085495">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="3085564">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="3085578">//</span><br>
<span class="lineno"></span><span class="comment" id="3085581">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3085656">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="3085720">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="3085789">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="3085863">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3085937">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="3086002">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="3086078">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="3086146">func</span>&nbsp;<span class="ident" id="3086151">CompilePOSIX</span><span class="op" id="3086163">(</span><span class="ident" id="3086164">expr</span>&nbsp;<span class="builtintype" id="3086169">string</span><span class="op" id="3086175">)</span>&nbsp;<span class="op" id="3086177">(</span><span class="op" id="3086178">*</span><span class="ident" id="3086179">Regexp</span><span class="op" id="3086185">,</span>&nbsp;<span class="builtintype" id="3086187">error</span><span class="op" id="3086192">)</span>&nbsp;<span class="op" id="3086194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086197">return</span>&nbsp;<span class="ident" id="3086204">compile</span><span class="op" id="3086211">(</span><span class="ident" id="3086212">expr</span><span class="op" id="3086216">,</span>&nbsp;<span class="ident" id="3086218">syntax</span><span class="op" id="3086224">.</span><span class="ident" id="3086225">POSIX</span><span class="op" id="3086230">,</span>&nbsp;<span class="builtintype" id="3086232">true</span><span class="op" id="3086236">)</span><br>
<span class="lineno"></span><span class="op" id="3086238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3086241">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="3086309">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3086381">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3086453">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3086504">func</span>&nbsp;<span class="op" id="3086509">(</span><span class="ident" id="3086510">re</span>&nbsp;<span class="op" id="3086513">*</span><span class="ident" id="3086514">Regexp</span><span class="op" id="3086520">)</span>&nbsp;<span class="ident" id="3086522">Longest</span><span class="op" id="3086529">(</span><span class="op" id="3086530">)</span>&nbsp;<span class="op" id="3086532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086535">re</span><span class="op" id="3086537">.</span><span class="ident" id="3086538">longest</span>&nbsp;<span class="op" id="3086546">=</span>&nbsp;<span class="builtintype" id="3086548">true</span><br>
<span class="lineno">150</span><span class="op" id="3086553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3086556">func</span>&nbsp;<span class="ident" id="3086561">compile</span><span class="op" id="3086568">(</span><span class="ident" id="3086569">expr</span>&nbsp;<span class="builtintype" id="3086574">string</span><span class="op" id="3086580">,</span>&nbsp;<span class="ident" id="3086582">mode</span>&nbsp;<span class="ident" id="3086587">syntax</span><span class="op" id="3086593">.</span><span class="ident" id="3086594">Flags</span><span class="op" id="3086599">,</span>&nbsp;<span class="ident" id="3086601">longest</span>&nbsp;<span class="builtintype" id="3086609">bool</span><span class="op" id="3086613">)</span>&nbsp;<span class="op" id="3086615">(</span><span class="op" id="3086616">*</span><span class="ident" id="3086617">Regexp</span><span class="op" id="3086623">,</span>&nbsp;<span class="builtintype" id="3086625">error</span><span class="op" id="3086630">)</span>&nbsp;<span class="op" id="3086632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086635">re</span><span class="op" id="3086637">,</span>&nbsp;<span class="ident" id="3086639">err</span>&nbsp;<span class="op" id="3086643">:=</span>&nbsp;<span class="ident" id="3086646">syntax</span><span class="op" id="3086652">.</span><span class="ident" id="3086653">Parse</span><span class="op" id="3086658">(</span><span class="ident" id="3086659">expr</span><span class="op" id="3086663">,</span>&nbsp;<span class="ident" id="3086665">mode</span><span class="op" id="3086669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086672">if</span>&nbsp;<span class="ident" id="3086675">err</span>&nbsp;<span class="op" id="3086679">!=</span>&nbsp;<span class="ident" id="3086682">nil</span>&nbsp;<span class="op" id="3086686">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086690">return</span>&nbsp;<span class="ident" id="3086697">nil</span><span class="op" id="3086700">,</span>&nbsp;<span class="ident" id="3086702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3086707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086710">maxCap</span>&nbsp;<span class="op" id="3086717">:=</span>&nbsp;<span class="ident" id="3086720">re</span><span class="op" id="3086722">.</span><span class="ident" id="3086723">MaxCap</span><span class="op" id="3086729">(</span><span class="op" id="3086730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086733">capNames</span>&nbsp;<span class="op" id="3086742">:=</span>&nbsp;<span class="ident" id="3086745">re</span><span class="op" id="3086747">.</span><span class="ident" id="3086748">CapNames</span><span class="op" id="3086756">(</span><span class="op" id="3086757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086761">re</span>&nbsp;<span class="op" id="3086764">=</span>&nbsp;<span class="ident" id="3086766">re</span><span class="op" id="3086768">.</span><span class="ident" id="3086769">Simplify</span><span class="op" id="3086777">(</span><span class="op" id="3086778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086781">prog</span><span class="op" id="3086785">,</span>&nbsp;<span class="ident" id="3086787">err</span>&nbsp;<span class="op" id="3086791">:=</span>&nbsp;<span class="ident" id="3086794">syntax</span><span class="op" id="3086800">.</span><span class="ident" id="3086801">Compile</span><span class="op" id="3086808">(</span><span class="ident" id="3086809">re</span><span class="op" id="3086811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086814">if</span>&nbsp;<span class="ident" id="3086817">err</span>&nbsp;<span class="op" id="3086821">!=</span>&nbsp;<span class="ident" id="3086824">nil</span>&nbsp;<span class="op" id="3086828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086832">return</span>&nbsp;<span class="ident" id="3086839">nil</span><span class="op" id="3086842">,</span>&nbsp;<span class="ident" id="3086844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3086849">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086852">regexp</span>&nbsp;<span class="op" id="3086859">:=</span>&nbsp;<span class="op" id="3086862">&amp;</span><span class="ident" id="3086863">Regexp</span><span class="op" id="3086869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086873">expr</span><span class="op" id="3086877">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3086886">expr</span><span class="op" id="3086890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086894">prog</span><span class="op" id="3086898">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3086907">prog</span><span class="op" id="3086911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086915">onepass</span><span class="op" id="3086922">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3086928">compileOnePass</span><span class="op" id="3086942">(</span><span class="ident" id="3086943">prog</span><span class="op" id="3086947">)</span><span class="op" id="3086948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086952">numSubexp</span><span class="op" id="3086961">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3086965">maxCap</span><span class="op" id="3086971">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086975">subexpNames</span><span class="op" id="3086986">:</span>&nbsp;<span class="ident" id="3086988">capNames</span><span class="op" id="3086996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087000">cond</span><span class="op" id="3087004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3087013">prog</span><span class="op" id="3087017">.</span><span class="ident" id="3087018">StartCond</span><span class="op" id="3087027">(</span><span class="op" id="3087028">)</span><span class="op" id="3087029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087033">longest</span><span class="op" id="3087040">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3087046">longest</span><span class="op" id="3087053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087059">if</span>&nbsp;<span class="ident" id="3087062">regexp</span><span class="op" id="3087068">.</span><span class="ident" id="3087069">onepass</span>&nbsp;<span class="op" id="3087077">==</span>&nbsp;<span class="ident" id="3087080">notOnePass</span>&nbsp;<span class="op" id="3087091">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087095">regexp</span><span class="op" id="3087101">.</span><span class="ident" id="3087102">prefix</span><span class="op" id="3087108">,</span>&nbsp;<span class="ident" id="3087110">regexp</span><span class="op" id="3087116">.</span><span class="ident" id="3087117">prefixComplete</span>&nbsp;<span class="op" id="3087132">=</span>&nbsp;<span class="ident" id="3087134">prog</span><span class="op" id="3087138">.</span><span class="ident" id="3087139">Prefix</span><span class="op" id="3087145">(</span><span class="op" id="3087146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087149">}</span>&nbsp;<span class="keyword" id="3087151">else</span>&nbsp;<span class="op" id="3087156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087160">regexp</span><span class="op" id="3087166">.</span><span class="ident" id="3087167">prefix</span><span class="op" id="3087173">,</span>&nbsp;<span class="ident" id="3087175">regexp</span><span class="op" id="3087181">.</span><span class="ident" id="3087182">prefixComplete</span><span class="op" id="3087196">,</span>&nbsp;<span class="ident" id="3087198">regexp</span><span class="op" id="3087204">.</span><span class="ident" id="3087205">prefixEnd</span>&nbsp;<span class="op" id="3087215">=</span>&nbsp;<span class="ident" id="3087217">onePassPrefix</span><span class="op" id="3087230">(</span><span class="ident" id="3087231">prog</span><span class="op" id="3087235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087241">if</span>&nbsp;<span class="ident" id="3087244">regexp</span><span class="op" id="3087250">.</span><span class="ident" id="3087251">prefix</span>&nbsp;<span class="op" id="3087258">!=</span>&nbsp;<span class="string" id="3087261">&#34;&#34;</span>&nbsp;<span class="op" id="3087264">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3087268">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3087317">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087352">regexp</span><span class="op" id="3087358">.</span><span class="ident" id="3087359">prefixBytes</span>&nbsp;<span class="op" id="3087371">=</span>&nbsp;<span class="op" id="3087373">[</span><span class="op" id="3087374">]</span><span class="builtintype" id="3087375">byte</span><span class="op" id="3087379">(</span><span class="ident" id="3087380">regexp</span><span class="op" id="3087386">.</span><span class="ident" id="3087387">prefix</span><span class="op" id="3087393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087397">regexp</span><span class="op" id="3087403">.</span><span class="ident" id="3087404">prefixRune</span><span class="op" id="3087414">,</span>&nbsp;<span class="ident" id="3087416">_</span>&nbsp;<span class="op" id="3087418">=</span>&nbsp;<span class="ident" id="3087420">utf8</span><span class="op" id="3087424">.</span><span class="ident" id="3087425">DecodeRuneInString</span><span class="op" id="3087443">(</span><span class="ident" id="3087444">regexp</span><span class="op" id="3087450">.</span><span class="ident" id="3087451">prefix</span><span class="op" id="3087457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087460">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087463">return</span>&nbsp;<span class="ident" id="3087470">regexp</span><span class="op" id="3087476">,</span>&nbsp;<span class="ident" id="3087478">nil</span><br>
<span class="lineno"></span><span class="op" id="3087482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3087485">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="3087534">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="3087590">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3087617">func</span>&nbsp;<span class="op" id="3087622">(</span><span class="ident" id="3087623">re</span>&nbsp;<span class="op" id="3087626">*</span><span class="ident" id="3087627">Regexp</span><span class="op" id="3087633">)</span>&nbsp;<span class="ident" id="3087635">get</span><span class="op" id="3087638">(</span><span class="op" id="3087639">)</span>&nbsp;<span class="op" id="3087641">*</span><span class="ident" id="3087642">machine</span>&nbsp;<span class="op" id="3087650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087653">re</span><span class="op" id="3087655">.</span><span class="ident" id="3087656">mu</span><span class="op" id="3087658">.</span><span class="ident" id="3087659">Lock</span><span class="op" id="3087663">(</span><span class="op" id="3087664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087667">if</span>&nbsp;<span class="ident" id="3087670">n</span>&nbsp;<span class="op" id="3087672">:=</span>&nbsp;<span class="builtinfunc" id="3087675">len</span><span class="op" id="3087678">(</span><span class="ident" id="3087679">re</span><span class="op" id="3087681">.</span><span class="ident" id="3087682">machine</span><span class="op" id="3087689">)</span><span class="op" id="3087690">;</span>&nbsp;<span class="ident" id="3087692">n</span>&nbsp;<span class="op" id="3087694">&gt;</span>&nbsp;<span class="num" id="3087696">0</span>&nbsp;<span class="op" id="3087698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087702">z</span>&nbsp;<span class="op" id="3087704">:=</span>&nbsp;<span class="ident" id="3087707">re</span><span class="op" id="3087709">.</span><span class="ident" id="3087710">machine</span><span class="op" id="3087717">[</span><span class="ident" id="3087718">n</span><span class="op" id="3087719">-</span><span class="num" id="3087720">1</span><span class="op" id="3087721">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087725">re</span><span class="op" id="3087727">.</span><span class="ident" id="3087728">machine</span>&nbsp;<span class="op" id="3087736">=</span>&nbsp;<span class="ident" id="3087738">re</span><span class="op" id="3087740">.</span><span class="ident" id="3087741">machine</span><span class="op" id="3087748">[</span><span class="op" id="3087749">:</span><span class="ident" id="3087750">n</span><span class="op" id="3087751">-</span><span class="num" id="3087752">1</span><span class="op" id="3087753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087757">re</span><span class="op" id="3087759">.</span><span class="ident" id="3087760">mu</span><span class="op" id="3087762">.</span><span class="ident" id="3087763">Unlock</span><span class="op" id="3087769">(</span><span class="op" id="3087770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087774">return</span>&nbsp;<span class="ident" id="3087781">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087787">re</span><span class="op" id="3087789">.</span><span class="ident" id="3087790">mu</span><span class="op" id="3087792">.</span><span class="ident" id="3087793">Unlock</span><span class="op" id="3087799">(</span><span class="op" id="3087800">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087803">z</span>&nbsp;<span class="op" id="3087805">:=</span>&nbsp;<span class="ident" id="3087808">progMachine</span><span class="op" id="3087819">(</span><span class="ident" id="3087820">re</span><span class="op" id="3087822">.</span><span class="ident" id="3087823">prog</span><span class="op" id="3087827">,</span>&nbsp;<span class="ident" id="3087829">re</span><span class="op" id="3087831">.</span><span class="ident" id="3087832">onepass</span><span class="op" id="3087839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087842">z</span><span class="op" id="3087843">.</span><span class="ident" id="3087844">re</span>&nbsp;<span class="op" id="3087847">=</span>&nbsp;<span class="ident" id="3087849">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087853">return</span>&nbsp;<span class="ident" id="3087860">z</span><br>
<span class="lineno"></span><span class="op" id="3087862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3087865">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="3087917">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3087983">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="3088037">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="3088107">func</span>&nbsp;<span class="op" id="3088112">(</span><span class="ident" id="3088113">re</span>&nbsp;<span class="op" id="3088116">*</span><span class="ident" id="3088117">Regexp</span><span class="op" id="3088123">)</span>&nbsp;<span class="ident" id="3088125">put</span><span class="op" id="3088128">(</span><span class="ident" id="3088129">z</span>&nbsp;<span class="op" id="3088131">*</span><span class="ident" id="3088132">machine</span><span class="op" id="3088139">)</span>&nbsp;<span class="op" id="3088141">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088144">re</span><span class="op" id="3088146">.</span><span class="ident" id="3088147">mu</span><span class="op" id="3088149">.</span><span class="ident" id="3088150">Lock</span><span class="op" id="3088154">(</span><span class="op" id="3088155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088158">re</span><span class="op" id="3088160">.</span><span class="ident" id="3088161">machine</span>&nbsp;<span class="op" id="3088169">=</span>&nbsp;<span class="builtinfunc" id="3088171">append</span><span class="op" id="3088177">(</span><span class="ident" id="3088178">re</span><span class="op" id="3088180">.</span><span class="ident" id="3088181">machine</span><span class="op" id="3088188">,</span>&nbsp;<span class="ident" id="3088190">z</span><span class="op" id="3088191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088194">re</span><span class="op" id="3088196">.</span><span class="ident" id="3088197">mu</span><span class="op" id="3088199">.</span><span class="ident" id="3088200">Unlock</span><span class="op" id="3088206">(</span><span class="op" id="3088207">)</span><br>
<span class="lineno"></span><span class="op" id="3088209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3088212">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3088290">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3088372">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3088388">func</span>&nbsp;<span class="ident" id="3088393">MustCompile</span><span class="op" id="3088404">(</span><span class="ident" id="3088405">str</span>&nbsp;<span class="builtintype" id="3088409">string</span><span class="op" id="3088415">)</span>&nbsp;<span class="op" id="3088417">*</span><span class="ident" id="3088418">Regexp</span>&nbsp;<span class="op" id="3088425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088428">regexp</span><span class="op" id="3088434">,</span>&nbsp;<span class="builtintype" id="3088436">error</span>&nbsp;<span class="op" id="3088442">:=</span>&nbsp;<span class="ident" id="3088445">Compile</span><span class="op" id="3088452">(</span><span class="ident" id="3088453">str</span><span class="op" id="3088456">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088459">if</span>&nbsp;<span class="builtintype" id="3088462">error</span>&nbsp;<span class="op" id="3088468">!=</span>&nbsp;<span class="ident" id="3088471">nil</span>&nbsp;<span class="op" id="3088475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3088479">panic</span><span class="op" id="3088484">(</span><span class="string" id="3088485">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="3088504">+</span>&nbsp;<span class="ident" id="3088506">quote</span><span class="op" id="3088511">(</span><span class="ident" id="3088512">str</span><span class="op" id="3088515">)</span>&nbsp;<span class="op" id="3088517">+</span>&nbsp;<span class="string" id="3088519">`):&nbsp;`</span>&nbsp;<span class="op" id="3088525">+</span>&nbsp;<span class="builtintype" id="3088527">error</span><span class="op" id="3088532">.</span><span class="ident" id="3088533">Error</span><span class="op" id="3088538">(</span><span class="op" id="3088539">)</span><span class="op" id="3088540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088546">return</span>&nbsp;<span class="ident" id="3088553">regexp</span><br>
<span class="lineno"></span><span class="op" id="3088560">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3088563">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3088651">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3088733">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3088749">func</span>&nbsp;<span class="ident" id="3088754">MustCompilePOSIX</span><span class="op" id="3088770">(</span><span class="ident" id="3088771">str</span>&nbsp;<span class="builtintype" id="3088775">string</span><span class="op" id="3088781">)</span>&nbsp;<span class="op" id="3088783">*</span><span class="ident" id="3088784">Regexp</span>&nbsp;<span class="op" id="3088791">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088794">regexp</span><span class="op" id="3088800">,</span>&nbsp;<span class="builtintype" id="3088802">error</span>&nbsp;<span class="op" id="3088808">:=</span>&nbsp;<span class="ident" id="3088811">CompilePOSIX</span><span class="op" id="3088823">(</span><span class="ident" id="3088824">str</span><span class="op" id="3088827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088830">if</span>&nbsp;<span class="builtintype" id="3088833">error</span>&nbsp;<span class="op" id="3088839">!=</span>&nbsp;<span class="ident" id="3088842">nil</span>&nbsp;<span class="op" id="3088846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3088850">panic</span><span class="op" id="3088855">(</span><span class="string" id="3088856">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="3088880">+</span>&nbsp;<span class="ident" id="3088882">quote</span><span class="op" id="3088887">(</span><span class="ident" id="3088888">str</span><span class="op" id="3088891">)</span>&nbsp;<span class="op" id="3088893">+</span>&nbsp;<span class="string" id="3088895">`):&nbsp;`</span>&nbsp;<span class="op" id="3088901">+</span>&nbsp;<span class="builtintype" id="3088903">error</span><span class="op" id="3088908">.</span><span class="ident" id="3088909">Error</span><span class="op" id="3088914">(</span><span class="op" id="3088915">)</span><span class="op" id="3088916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088922">return</span>&nbsp;<span class="ident" id="3088929">regexp</span><br>
<span class="lineno">235</span><span class="op" id="3088936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3088939">func</span>&nbsp;<span class="ident" id="3088944">quote</span><span class="op" id="3088949">(</span><span class="ident" id="3088950">s</span>&nbsp;<span class="builtintype" id="3088952">string</span><span class="op" id="3088958">)</span>&nbsp;<span class="builtintype" id="3088960">string</span>&nbsp;<span class="op" id="3088967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088970">if</span>&nbsp;<span class="ident" id="3088973">strconv</span><span class="op" id="3088980">.</span><span class="ident" id="3088981">CanBackquote</span><span class="op" id="3088993">(</span><span class="ident" id="3088994">s</span><span class="op" id="3088995">)</span>&nbsp;<span class="op" id="3088997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089001">return</span>&nbsp;<span class="string" id="3089008">&#34;`&#34;</span>&nbsp;<span class="op" id="3089012">+</span>&nbsp;<span class="ident" id="3089014">s</span>&nbsp;<span class="op" id="3089016">+</span>&nbsp;<span class="string" id="3089018">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089026">return</span>&nbsp;<span class="ident" id="3089033">strconv</span><span class="op" id="3089040">.</span><span class="ident" id="3089041">Quote</span><span class="op" id="3089046">(</span><span class="ident" id="3089047">s</span><span class="op" id="3089048">)</span><br>
<span class="lineno"></span><span class="op" id="3089050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3089053">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="3089133">func</span>&nbsp;<span class="op" id="3089138">(</span><span class="ident" id="3089139">re</span>&nbsp;<span class="op" id="3089142">*</span><span class="ident" id="3089143">Regexp</span><span class="op" id="3089149">)</span>&nbsp;<span class="ident" id="3089151">NumSubexp</span><span class="op" id="3089160">(</span><span class="op" id="3089161">)</span>&nbsp;<span class="builtintype" id="3089163">int</span>&nbsp;<span class="op" id="3089167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089170">return</span>&nbsp;<span class="ident" id="3089177">re</span><span class="op" id="3089179">.</span><span class="ident" id="3089180">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="3089190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3089193">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="3089262">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="3089333">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="3089406">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="3089473">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="3089529">func</span>&nbsp;<span class="op" id="3089534">(</span><span class="ident" id="3089535">re</span>&nbsp;<span class="op" id="3089538">*</span><span class="ident" id="3089539">Regexp</span><span class="op" id="3089545">)</span>&nbsp;<span class="ident" id="3089547">SubexpNames</span><span class="op" id="3089558">(</span><span class="op" id="3089559">)</span>&nbsp;<span class="op" id="3089561">[</span><span class="op" id="3089562">]</span><span class="builtintype" id="3089563">string</span>&nbsp;<span class="op" id="3089570">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089573">return</span>&nbsp;<span class="ident" id="3089580">re</span><span class="op" id="3089582">.</span><span class="ident" id="3089583">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="3089595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3089598">const</span>&nbsp;<span class="ident" id="3089604">endOfText</span>&nbsp;<span class="builtintype" id="3089614">rune</span>&nbsp;<span class="op" id="3089619">=</span>&nbsp;<span class="op" id="3089621">-</span><span class="num" id="3089622">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3089625">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="3089701">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="3089729">type</span>&nbsp;<span class="ident" id="3089734">input</span>&nbsp;<span class="keyword" id="3089740">interface</span>&nbsp;<span class="op" id="3089750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089753">step</span><span class="op" id="3089757">(</span><span class="ident" id="3089758">pos</span>&nbsp;<span class="builtintype" id="3089762">int</span><span class="op" id="3089765">)</span>&nbsp;<span class="op" id="3089767">(</span><span class="ident" id="3089768">r</span>&nbsp;<span class="builtintype" id="3089770">rune</span><span class="op" id="3089774">,</span>&nbsp;<span class="ident" id="3089776">width</span>&nbsp;<span class="builtintype" id="3089782">int</span><span class="op" id="3089785">)</span>&nbsp;<span class="comment" id="3089787">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089808">canCheckPrefix</span><span class="op" id="3089822">(</span><span class="op" id="3089823">)</span>&nbsp;<span class="builtintype" id="3089825">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3089842">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089885">hasPrefix</span><span class="op" id="3089894">(</span><span class="ident" id="3089895">re</span>&nbsp;<span class="op" id="3089898">*</span><span class="ident" id="3089899">Regexp</span><span class="op" id="3089905">)</span>&nbsp;<span class="builtintype" id="3089907">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089913">index</span><span class="op" id="3089918">(</span><span class="ident" id="3089919">re</span>&nbsp;<span class="op" id="3089922">*</span><span class="ident" id="3089923">Regexp</span><span class="op" id="3089929">,</span>&nbsp;<span class="ident" id="3089931">pos</span>&nbsp;<span class="builtintype" id="3089935">int</span><span class="op" id="3089938">)</span>&nbsp;<span class="builtintype" id="3089940">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089945">context</span><span class="op" id="3089952">(</span><span class="ident" id="3089953">pos</span>&nbsp;<span class="builtintype" id="3089957">int</span><span class="op" id="3089960">)</span>&nbsp;<span class="ident" id="3089962">syntax</span><span class="op" id="3089968">.</span><span class="ident" id="3089969">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="3089977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3089980">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3090011">type</span>&nbsp;<span class="ident" id="3090016">inputString</span>&nbsp;<span class="keyword" id="3090028">struct</span>&nbsp;<span class="op" id="3090035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090038">str</span>&nbsp;<span class="builtintype" id="3090042">string</span><br>
<span class="lineno"></span><span class="op" id="3090049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="3090052">func</span>&nbsp;<span class="op" id="3090057">(</span><span class="ident" id="3090058">i</span>&nbsp;<span class="op" id="3090060">*</span><span class="ident" id="3090061">inputString</span><span class="op" id="3090072">)</span>&nbsp;<span class="ident" id="3090074">step</span><span class="op" id="3090078">(</span><span class="ident" id="3090079">pos</span>&nbsp;<span class="builtintype" id="3090083">int</span><span class="op" id="3090086">)</span>&nbsp;<span class="op" id="3090088">(</span><span class="builtintype" id="3090089">rune</span><span class="op" id="3090093">,</span>&nbsp;<span class="builtintype" id="3090095">int</span><span class="op" id="3090098">)</span>&nbsp;<span class="op" id="3090100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090103">if</span>&nbsp;<span class="ident" id="3090106">pos</span>&nbsp;<span class="op" id="3090110">&lt;</span>&nbsp;<span class="builtinfunc" id="3090112">len</span><span class="op" id="3090115">(</span><span class="ident" id="3090116">i</span><span class="op" id="3090117">.</span><span class="ident" id="3090118">str</span><span class="op" id="3090121">)</span>&nbsp;<span class="op" id="3090123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090127">c</span>&nbsp;<span class="op" id="3090129">:=</span>&nbsp;<span class="ident" id="3090132">i</span><span class="op" id="3090133">.</span><span class="ident" id="3090134">str</span><span class="op" id="3090137">[</span><span class="ident" id="3090138">pos</span><span class="op" id="3090141">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090145">if</span>&nbsp;<span class="ident" id="3090148">c</span>&nbsp;<span class="op" id="3090150">&lt;</span>&nbsp;<span class="ident" id="3090152">utf8</span><span class="op" id="3090156">.</span><span class="ident" id="3090157">RuneSelf</span>&nbsp;<span class="op" id="3090166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090171">return</span>&nbsp;<span class="builtintype" id="3090178">rune</span><span class="op" id="3090182">(</span><span class="ident" id="3090183">c</span><span class="op" id="3090184">)</span><span class="op" id="3090185">,</span>&nbsp;<span class="num" id="3090187">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090195">return</span>&nbsp;<span class="ident" id="3090202">utf8</span><span class="op" id="3090206">.</span><span class="ident" id="3090207">DecodeRuneInString</span><span class="op" id="3090225">(</span><span class="ident" id="3090226">i</span><span class="op" id="3090227">.</span><span class="ident" id="3090228">str</span><span class="op" id="3090231">[</span><span class="ident" id="3090232">pos</span><span class="op" id="3090235">:</span><span class="op" id="3090236">]</span><span class="op" id="3090237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090243">return</span>&nbsp;<span class="ident" id="3090250">endOfText</span><span class="op" id="3090259">,</span>&nbsp;<span class="num" id="3090261">0</span><br>
<span class="lineno"></span><span class="op" id="3090263">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="3090266">func</span>&nbsp;<span class="op" id="3090271">(</span><span class="ident" id="3090272">i</span>&nbsp;<span class="op" id="3090274">*</span><span class="ident" id="3090275">inputString</span><span class="op" id="3090286">)</span>&nbsp;<span class="ident" id="3090288">canCheckPrefix</span><span class="op" id="3090302">(</span><span class="op" id="3090303">)</span>&nbsp;<span class="builtintype" id="3090305">bool</span>&nbsp;<span class="op" id="3090310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090313">return</span>&nbsp;<span class="builtintype" id="3090320">true</span><br>
<span class="lineno"></span><span class="op" id="3090325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="3090328">func</span>&nbsp;<span class="op" id="3090333">(</span><span class="ident" id="3090334">i</span>&nbsp;<span class="op" id="3090336">*</span><span class="ident" id="3090337">inputString</span><span class="op" id="3090348">)</span>&nbsp;<span class="ident" id="3090350">hasPrefix</span><span class="op" id="3090359">(</span><span class="ident" id="3090360">re</span>&nbsp;<span class="op" id="3090363">*</span><span class="ident" id="3090364">Regexp</span><span class="op" id="3090370">)</span>&nbsp;<span class="builtintype" id="3090372">bool</span>&nbsp;<span class="op" id="3090377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090380">return</span>&nbsp;<span class="ident" id="3090387">strings</span><span class="op" id="3090394">.</span><span class="ident" id="3090395">HasPrefix</span><span class="op" id="3090404">(</span><span class="ident" id="3090405">i</span><span class="op" id="3090406">.</span><span class="ident" id="3090407">str</span><span class="op" id="3090410">,</span>&nbsp;<span class="ident" id="3090412">re</span><span class="op" id="3090414">.</span><span class="ident" id="3090415">prefix</span><span class="op" id="3090421">)</span><br>
<span class="lineno"></span><span class="op" id="3090423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3090426">func</span>&nbsp;<span class="op" id="3090431">(</span><span class="ident" id="3090432">i</span>&nbsp;<span class="op" id="3090434">*</span><span class="ident" id="3090435">inputString</span><span class="op" id="3090446">)</span>&nbsp;<span class="ident" id="3090448">index</span><span class="op" id="3090453">(</span><span class="ident" id="3090454">re</span>&nbsp;<span class="op" id="3090457">*</span><span class="ident" id="3090458">Regexp</span><span class="op" id="3090464">,</span>&nbsp;<span class="ident" id="3090466">pos</span>&nbsp;<span class="builtintype" id="3090470">int</span><span class="op" id="3090473">)</span>&nbsp;<span class="builtintype" id="3090475">int</span>&nbsp;<span class="op" id="3090479">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090482">return</span>&nbsp;<span class="ident" id="3090489">strings</span><span class="op" id="3090496">.</span><span class="ident" id="3090497">Index</span><span class="op" id="3090502">(</span><span class="ident" id="3090503">i</span><span class="op" id="3090504">.</span><span class="ident" id="3090505">str</span><span class="op" id="3090508">[</span><span class="ident" id="3090509">pos</span><span class="op" id="3090512">:</span><span class="op" id="3090513">]</span><span class="op" id="3090514">,</span>&nbsp;<span class="ident" id="3090516">re</span><span class="op" id="3090518">.</span><span class="ident" id="3090519">prefix</span><span class="op" id="3090525">)</span><br>
<span class="lineno"></span><span class="op" id="3090527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3090530">func</span>&nbsp;<span class="op" id="3090535">(</span><span class="ident" id="3090536">i</span>&nbsp;<span class="op" id="3090538">*</span><span class="ident" id="3090539">inputString</span><span class="op" id="3090550">)</span>&nbsp;<span class="ident" id="3090552">context</span><span class="op" id="3090559">(</span><span class="ident" id="3090560">pos</span>&nbsp;<span class="builtintype" id="3090564">int</span><span class="op" id="3090567">)</span>&nbsp;<span class="ident" id="3090569">syntax</span><span class="op" id="3090575">.</span><span class="ident" id="3090576">EmptyOp</span>&nbsp;<span class="op" id="3090584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090587">r1</span><span class="op" id="3090589">,</span>&nbsp;<span class="ident" id="3090591">r2</span>&nbsp;<span class="op" id="3090594">:=</span>&nbsp;<span class="ident" id="3090597">endOfText</span><span class="op" id="3090606">,</span>&nbsp;<span class="ident" id="3090608">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090619">if</span>&nbsp;<span class="ident" id="3090622">pos</span>&nbsp;<span class="op" id="3090626">&gt;</span>&nbsp;<span class="num" id="3090628">0</span>&nbsp;<span class="op" id="3090630">&amp;&amp;</span>&nbsp;<span class="ident" id="3090633">pos</span>&nbsp;<span class="op" id="3090637">&lt;=</span>&nbsp;<span class="builtinfunc" id="3090640">len</span><span class="op" id="3090643">(</span><span class="ident" id="3090644">i</span><span class="op" id="3090645">.</span><span class="ident" id="3090646">str</span><span class="op" id="3090649">)</span>&nbsp;<span class="op" id="3090651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090655">r1</span><span class="op" id="3090657">,</span>&nbsp;<span class="ident" id="3090659">_</span>&nbsp;<span class="op" id="3090661">=</span>&nbsp;<span class="ident" id="3090663">utf8</span><span class="op" id="3090667">.</span><span class="ident" id="3090668">DecodeLastRuneInString</span><span class="op" id="3090690">(</span><span class="ident" id="3090691">i</span><span class="op" id="3090692">.</span><span class="ident" id="3090693">str</span><span class="op" id="3090696">[</span><span class="op" id="3090697">:</span><span class="ident" id="3090698">pos</span><span class="op" id="3090701">]</span><span class="op" id="3090702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090708">if</span>&nbsp;<span class="ident" id="3090711">pos</span>&nbsp;<span class="op" id="3090715">&lt;</span>&nbsp;<span class="builtinfunc" id="3090717">len</span><span class="op" id="3090720">(</span><span class="ident" id="3090721">i</span><span class="op" id="3090722">.</span><span class="ident" id="3090723">str</span><span class="op" id="3090726">)</span>&nbsp;<span class="op" id="3090728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090732">r2</span><span class="op" id="3090734">,</span>&nbsp;<span class="ident" id="3090736">_</span>&nbsp;<span class="op" id="3090738">=</span>&nbsp;<span class="ident" id="3090740">utf8</span><span class="op" id="3090744">.</span><span class="ident" id="3090745">DecodeRuneInString</span><span class="op" id="3090763">(</span><span class="ident" id="3090764">i</span><span class="op" id="3090765">.</span><span class="ident" id="3090766">str</span><span class="op" id="3090769">[</span><span class="ident" id="3090770">pos</span><span class="op" id="3090773">:</span><span class="op" id="3090774">]</span><span class="op" id="3090775">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090781">return</span>&nbsp;<span class="ident" id="3090788">syntax</span><span class="op" id="3090794">.</span><span class="ident" id="3090795">EmptyOpContext</span><span class="op" id="3090809">(</span><span class="ident" id="3090810">r1</span><span class="op" id="3090812">,</span>&nbsp;<span class="ident" id="3090814">r2</span><span class="op" id="3090816">)</span><br>
<span class="lineno"></span><span class="op" id="3090818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3090821">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="3090855">type</span>&nbsp;<span class="ident" id="3090860">inputBytes</span>&nbsp;<span class="keyword" id="3090871">struct</span>&nbsp;<span class="op" id="3090878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090881">str</span>&nbsp;<span class="op" id="3090885">[</span><span class="op" id="3090886">]</span><span class="builtintype" id="3090887">byte</span><br>
<span class="lineno"></span><span class="op" id="3090892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3090895">func</span>&nbsp;<span class="op" id="3090900">(</span><span class="ident" id="3090901">i</span>&nbsp;<span class="op" id="3090903">*</span><span class="ident" id="3090904">inputBytes</span><span class="op" id="3090914">)</span>&nbsp;<span class="ident" id="3090916">step</span><span class="op" id="3090920">(</span><span class="ident" id="3090921">pos</span>&nbsp;<span class="builtintype" id="3090925">int</span><span class="op" id="3090928">)</span>&nbsp;<span class="op" id="3090930">(</span><span class="builtintype" id="3090931">rune</span><span class="op" id="3090935">,</span>&nbsp;<span class="builtintype" id="3090937">int</span><span class="op" id="3090940">)</span>&nbsp;<span class="op" id="3090942">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090945">if</span>&nbsp;<span class="ident" id="3090948">pos</span>&nbsp;<span class="op" id="3090952">&lt;</span>&nbsp;<span class="builtinfunc" id="3090954">len</span><span class="op" id="3090957">(</span><span class="ident" id="3090958">i</span><span class="op" id="3090959">.</span><span class="ident" id="3090960">str</span><span class="op" id="3090963">)</span>&nbsp;<span class="op" id="3090965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090969">c</span>&nbsp;<span class="op" id="3090971">:=</span>&nbsp;<span class="ident" id="3090974">i</span><span class="op" id="3090975">.</span><span class="ident" id="3090976">str</span><span class="op" id="3090979">[</span><span class="ident" id="3090980">pos</span><span class="op" id="3090983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090987">if</span>&nbsp;<span class="ident" id="3090990">c</span>&nbsp;<span class="op" id="3090992">&lt;</span>&nbsp;<span class="ident" id="3090994">utf8</span><span class="op" id="3090998">.</span><span class="ident" id="3090999">RuneSelf</span>&nbsp;<span class="op" id="3091008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091013">return</span>&nbsp;<span class="builtintype" id="3091020">rune</span><span class="op" id="3091024">(</span><span class="ident" id="3091025">c</span><span class="op" id="3091026">)</span><span class="op" id="3091027">,</span>&nbsp;<span class="num" id="3091029">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091033">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091037">return</span>&nbsp;<span class="ident" id="3091044">utf8</span><span class="op" id="3091048">.</span><span class="ident" id="3091049">DecodeRune</span><span class="op" id="3091059">(</span><span class="ident" id="3091060">i</span><span class="op" id="3091061">.</span><span class="ident" id="3091062">str</span><span class="op" id="3091065">[</span><span class="ident" id="3091066">pos</span><span class="op" id="3091069">:</span><span class="op" id="3091070">]</span><span class="op" id="3091071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091077">return</span>&nbsp;<span class="ident" id="3091084">endOfText</span><span class="op" id="3091093">,</span>&nbsp;<span class="num" id="3091095">0</span><br>
<span class="lineno"></span><span class="op" id="3091097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="3091100">func</span>&nbsp;<span class="op" id="3091105">(</span><span class="ident" id="3091106">i</span>&nbsp;<span class="op" id="3091108">*</span><span class="ident" id="3091109">inputBytes</span><span class="op" id="3091119">)</span>&nbsp;<span class="ident" id="3091121">canCheckPrefix</span><span class="op" id="3091135">(</span><span class="op" id="3091136">)</span>&nbsp;<span class="builtintype" id="3091138">bool</span>&nbsp;<span class="op" id="3091143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091146">return</span>&nbsp;<span class="builtintype" id="3091153">true</span><br>
<span class="lineno"></span><span class="op" id="3091158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3091161">func</span>&nbsp;<span class="op" id="3091166">(</span><span class="ident" id="3091167">i</span>&nbsp;<span class="op" id="3091169">*</span><span class="ident" id="3091170">inputBytes</span><span class="op" id="3091180">)</span>&nbsp;<span class="ident" id="3091182">hasPrefix</span><span class="op" id="3091191">(</span><span class="ident" id="3091192">re</span>&nbsp;<span class="op" id="3091195">*</span><span class="ident" id="3091196">Regexp</span><span class="op" id="3091202">)</span>&nbsp;<span class="builtintype" id="3091204">bool</span>&nbsp;<span class="op" id="3091209">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091212">return</span>&nbsp;<span class="ident" id="3091219">bytes</span><span class="op" id="3091224">.</span><span class="ident" id="3091225">HasPrefix</span><span class="op" id="3091234">(</span><span class="ident" id="3091235">i</span><span class="op" id="3091236">.</span><span class="ident" id="3091237">str</span><span class="op" id="3091240">,</span>&nbsp;<span class="ident" id="3091242">re</span><span class="op" id="3091244">.</span><span class="ident" id="3091245">prefixBytes</span><span class="op" id="3091256">)</span><br>
<span class="lineno"></span><span class="op" id="3091258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3091261">func</span>&nbsp;<span class="op" id="3091266">(</span><span class="ident" id="3091267">i</span>&nbsp;<span class="op" id="3091269">*</span><span class="ident" id="3091270">inputBytes</span><span class="op" id="3091280">)</span>&nbsp;<span class="ident" id="3091282">index</span><span class="op" id="3091287">(</span><span class="ident" id="3091288">re</span>&nbsp;<span class="op" id="3091291">*</span><span class="ident" id="3091292">Regexp</span><span class="op" id="3091298">,</span>&nbsp;<span class="ident" id="3091300">pos</span>&nbsp;<span class="builtintype" id="3091304">int</span><span class="op" id="3091307">)</span>&nbsp;<span class="builtintype" id="3091309">int</span>&nbsp;<span class="op" id="3091313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091316">return</span>&nbsp;<span class="ident" id="3091323">bytes</span><span class="op" id="3091328">.</span><span class="ident" id="3091329">Index</span><span class="op" id="3091334">(</span><span class="ident" id="3091335">i</span><span class="op" id="3091336">.</span><span class="ident" id="3091337">str</span><span class="op" id="3091340">[</span><span class="ident" id="3091341">pos</span><span class="op" id="3091344">:</span><span class="op" id="3091345">]</span><span class="op" id="3091346">,</span>&nbsp;<span class="ident" id="3091348">re</span><span class="op" id="3091350">.</span><span class="ident" id="3091351">prefixBytes</span><span class="op" id="3091362">)</span><br>
<span class="lineno">335</span><span class="op" id="3091364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3091367">func</span>&nbsp;<span class="op" id="3091372">(</span><span class="ident" id="3091373">i</span>&nbsp;<span class="op" id="3091375">*</span><span class="ident" id="3091376">inputBytes</span><span class="op" id="3091386">)</span>&nbsp;<span class="ident" id="3091388">context</span><span class="op" id="3091395">(</span><span class="ident" id="3091396">pos</span>&nbsp;<span class="builtintype" id="3091400">int</span><span class="op" id="3091403">)</span>&nbsp;<span class="ident" id="3091405">syntax</span><span class="op" id="3091411">.</span><span class="ident" id="3091412">EmptyOp</span>&nbsp;<span class="op" id="3091420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091423">r1</span><span class="op" id="3091425">,</span>&nbsp;<span class="ident" id="3091427">r2</span>&nbsp;<span class="op" id="3091430">:=</span>&nbsp;<span class="ident" id="3091433">endOfText</span><span class="op" id="3091442">,</span>&nbsp;<span class="ident" id="3091444">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091455">if</span>&nbsp;<span class="ident" id="3091458">pos</span>&nbsp;<span class="op" id="3091462">&gt;</span>&nbsp;<span class="num" id="3091464">0</span>&nbsp;<span class="op" id="3091466">&amp;&amp;</span>&nbsp;<span class="ident" id="3091469">pos</span>&nbsp;<span class="op" id="3091473">&lt;=</span>&nbsp;<span class="builtinfunc" id="3091476">len</span><span class="op" id="3091479">(</span><span class="ident" id="3091480">i</span><span class="op" id="3091481">.</span><span class="ident" id="3091482">str</span><span class="op" id="3091485">)</span>&nbsp;<span class="op" id="3091487">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091491">r1</span><span class="op" id="3091493">,</span>&nbsp;<span class="ident" id="3091495">_</span>&nbsp;<span class="op" id="3091497">=</span>&nbsp;<span class="ident" id="3091499">utf8</span><span class="op" id="3091503">.</span><span class="ident" id="3091504">DecodeLastRune</span><span class="op" id="3091518">(</span><span class="ident" id="3091519">i</span><span class="op" id="3091520">.</span><span class="ident" id="3091521">str</span><span class="op" id="3091524">[</span><span class="op" id="3091525">:</span><span class="ident" id="3091526">pos</span><span class="op" id="3091529">]</span><span class="op" id="3091530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091536">if</span>&nbsp;<span class="ident" id="3091539">pos</span>&nbsp;<span class="op" id="3091543">&lt;</span>&nbsp;<span class="builtinfunc" id="3091545">len</span><span class="op" id="3091548">(</span><span class="ident" id="3091549">i</span><span class="op" id="3091550">.</span><span class="ident" id="3091551">str</span><span class="op" id="3091554">)</span>&nbsp;<span class="op" id="3091556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091560">r2</span><span class="op" id="3091562">,</span>&nbsp;<span class="ident" id="3091564">_</span>&nbsp;<span class="op" id="3091566">=</span>&nbsp;<span class="ident" id="3091568">utf8</span><span class="op" id="3091572">.</span><span class="ident" id="3091573">DecodeRune</span><span class="op" id="3091583">(</span><span class="ident" id="3091584">i</span><span class="op" id="3091585">.</span><span class="ident" id="3091586">str</span><span class="op" id="3091589">[</span><span class="ident" id="3091590">pos</span><span class="op" id="3091593">:</span><span class="op" id="3091594">]</span><span class="op" id="3091595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091598">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091601">return</span>&nbsp;<span class="ident" id="3091608">syntax</span><span class="op" id="3091614">.</span><span class="ident" id="3091615">EmptyOpContext</span><span class="op" id="3091629">(</span><span class="ident" id="3091630">r1</span><span class="op" id="3091632">,</span>&nbsp;<span class="ident" id="3091634">r2</span><span class="op" id="3091636">)</span><br>
<span class="lineno"></span><span class="op" id="3091638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3091641">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="3091676">type</span>&nbsp;<span class="ident" id="3091681">inputReader</span>&nbsp;<span class="keyword" id="3091693">struct</span>&nbsp;<span class="op" id="3091700">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091703">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3091709">io</span><span class="op" id="3091711">.</span><span class="ident" id="3091712">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091724">atEOT</span>&nbsp;<span class="builtintype" id="3091730">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091736">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3091742">int</span><br>
<span class="lineno"></span><span class="op" id="3091746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="3091749">func</span>&nbsp;<span class="op" id="3091754">(</span><span class="ident" id="3091755">i</span>&nbsp;<span class="op" id="3091757">*</span><span class="ident" id="3091758">inputReader</span><span class="op" id="3091769">)</span>&nbsp;<span class="ident" id="3091771">step</span><span class="op" id="3091775">(</span><span class="ident" id="3091776">pos</span>&nbsp;<span class="builtintype" id="3091780">int</span><span class="op" id="3091783">)</span>&nbsp;<span class="op" id="3091785">(</span><span class="builtintype" id="3091786">rune</span><span class="op" id="3091790">,</span>&nbsp;<span class="builtintype" id="3091792">int</span><span class="op" id="3091795">)</span>&nbsp;<span class="op" id="3091797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091800">if</span>&nbsp;<span class="op" id="3091803">!</span><span class="ident" id="3091804">i</span><span class="op" id="3091805">.</span><span class="ident" id="3091806">atEOT</span>&nbsp;<span class="op" id="3091812">&amp;&amp;</span>&nbsp;<span class="ident" id="3091815">pos</span>&nbsp;<span class="op" id="3091819">!=</span>&nbsp;<span class="ident" id="3091822">i</span><span class="op" id="3091823">.</span><span class="ident" id="3091824">pos</span>&nbsp;<span class="op" id="3091828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091832">return</span>&nbsp;<span class="ident" id="3091839">endOfText</span><span class="op" id="3091848">,</span>&nbsp;<span class="num" id="3091850">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091854">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091857">r</span><span class="op" id="3091858">,</span>&nbsp;<span class="ident" id="3091860">w</span><span class="op" id="3091861">,</span>&nbsp;<span class="ident" id="3091863">err</span>&nbsp;<span class="op" id="3091867">:=</span>&nbsp;<span class="ident" id="3091870">i</span><span class="op" id="3091871">.</span><span class="ident" id="3091872">r</span><span class="op" id="3091873">.</span><span class="ident" id="3091874">ReadRune</span><span class="op" id="3091882">(</span><span class="op" id="3091883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091886">if</span>&nbsp;<span class="ident" id="3091889">err</span>&nbsp;<span class="op" id="3091893">!=</span>&nbsp;<span class="ident" id="3091896">nil</span>&nbsp;<span class="op" id="3091900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091904">i</span><span class="op" id="3091905">.</span><span class="ident" id="3091906">atEOT</span>&nbsp;<span class="op" id="3091912">=</span>&nbsp;<span class="builtintype" id="3091914">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091921">return</span>&nbsp;<span class="ident" id="3091928">endOfText</span><span class="op" id="3091937">,</span>&nbsp;<span class="num" id="3091939">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091942">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091945">i</span><span class="op" id="3091946">.</span><span class="ident" id="3091947">pos</span>&nbsp;<span class="op" id="3091951">+=</span>&nbsp;<span class="ident" id="3091954">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091957">return</span>&nbsp;<span class="ident" id="3091964">r</span><span class="op" id="3091965">,</span>&nbsp;<span class="ident" id="3091967">w</span><br>
<span class="lineno"></span><span class="op" id="3091969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3091972">func</span>&nbsp;<span class="op" id="3091977">(</span><span class="ident" id="3091978">i</span>&nbsp;<span class="op" id="3091980">*</span><span class="ident" id="3091981">inputReader</span><span class="op" id="3091992">)</span>&nbsp;<span class="ident" id="3091994">canCheckPrefix</span><span class="op" id="3092008">(</span><span class="op" id="3092009">)</span>&nbsp;<span class="builtintype" id="3092011">bool</span>&nbsp;<span class="op" id="3092016">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092019">return</span>&nbsp;<span class="builtintype" id="3092026">false</span><br>
<span class="lineno"></span><span class="op" id="3092032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3092035">func</span>&nbsp;<span class="op" id="3092040">(</span><span class="ident" id="3092041">i</span>&nbsp;<span class="op" id="3092043">*</span><span class="ident" id="3092044">inputReader</span><span class="op" id="3092055">)</span>&nbsp;<span class="ident" id="3092057">hasPrefix</span><span class="op" id="3092066">(</span><span class="ident" id="3092067">re</span>&nbsp;<span class="op" id="3092070">*</span><span class="ident" id="3092071">Regexp</span><span class="op" id="3092077">)</span>&nbsp;<span class="builtintype" id="3092079">bool</span>&nbsp;<span class="op" id="3092084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092087">return</span>&nbsp;<span class="builtintype" id="3092094">false</span><br>
<span class="lineno">375</span><span class="op" id="3092100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3092103">func</span>&nbsp;<span class="op" id="3092108">(</span><span class="ident" id="3092109">i</span>&nbsp;<span class="op" id="3092111">*</span><span class="ident" id="3092112">inputReader</span><span class="op" id="3092123">)</span>&nbsp;<span class="ident" id="3092125">index</span><span class="op" id="3092130">(</span><span class="ident" id="3092131">re</span>&nbsp;<span class="op" id="3092134">*</span><span class="ident" id="3092135">Regexp</span><span class="op" id="3092141">,</span>&nbsp;<span class="ident" id="3092143">pos</span>&nbsp;<span class="builtintype" id="3092147">int</span><span class="op" id="3092150">)</span>&nbsp;<span class="builtintype" id="3092152">int</span>&nbsp;<span class="op" id="3092156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092159">return</span>&nbsp;<span class="op" id="3092166">-</span><span class="num" id="3092167">1</span><br>
<span class="lineno"></span><span class="op" id="3092169">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="3092172">func</span>&nbsp;<span class="op" id="3092177">(</span><span class="ident" id="3092178">i</span>&nbsp;<span class="op" id="3092180">*</span><span class="ident" id="3092181">inputReader</span><span class="op" id="3092192">)</span>&nbsp;<span class="ident" id="3092194">context</span><span class="op" id="3092201">(</span><span class="ident" id="3092202">pos</span>&nbsp;<span class="builtintype" id="3092206">int</span><span class="op" id="3092209">)</span>&nbsp;<span class="ident" id="3092211">syntax</span><span class="op" id="3092217">.</span><span class="ident" id="3092218">EmptyOp</span>&nbsp;<span class="op" id="3092226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092229">return</span>&nbsp;<span class="num" id="3092236">0</span><br>
<span class="lineno"></span><span class="op" id="3092238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3092241">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="3092309">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3092378">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3092437">func</span>&nbsp;<span class="op" id="3092442">(</span><span class="ident" id="3092443">re</span>&nbsp;<span class="op" id="3092446">*</span><span class="ident" id="3092447">Regexp</span><span class="op" id="3092453">)</span>&nbsp;<span class="ident" id="3092455">LiteralPrefix</span><span class="op" id="3092468">(</span><span class="op" id="3092469">)</span>&nbsp;<span class="op" id="3092471">(</span><span class="ident" id="3092472">prefix</span>&nbsp;<span class="builtintype" id="3092479">string</span><span class="op" id="3092485">,</span>&nbsp;<span class="ident" id="3092487">complete</span>&nbsp;<span class="builtintype" id="3092496">bool</span><span class="op" id="3092500">)</span>&nbsp;<span class="op" id="3092502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092505">return</span>&nbsp;<span class="ident" id="3092512">re</span><span class="op" id="3092514">.</span><span class="ident" id="3092515">prefix</span><span class="op" id="3092521">,</span>&nbsp;<span class="ident" id="3092523">re</span><span class="op" id="3092525">.</span><span class="ident" id="3092526">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="3092541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3092544">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3092615">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="3092630">func</span>&nbsp;<span class="op" id="3092635">(</span><span class="ident" id="3092636">re</span>&nbsp;<span class="op" id="3092639">*</span><span class="ident" id="3092640">Regexp</span><span class="op" id="3092646">)</span>&nbsp;<span class="ident" id="3092648">MatchReader</span><span class="op" id="3092659">(</span><span class="ident" id="3092660">r</span>&nbsp;<span class="ident" id="3092662">io</span><span class="op" id="3092664">.</span><span class="ident" id="3092665">RuneReader</span><span class="op" id="3092675">)</span>&nbsp;<span class="builtintype" id="3092677">bool</span>&nbsp;<span class="op" id="3092682">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092685">return</span>&nbsp;<span class="ident" id="3092692">re</span><span class="op" id="3092694">.</span><span class="ident" id="3092695">doExecute</span><span class="op" id="3092704">(</span><span class="ident" id="3092705">r</span><span class="op" id="3092706">,</span>&nbsp;<span class="ident" id="3092708">nil</span><span class="op" id="3092711">,</span>&nbsp;<span class="string" id="3092713">&#34;&#34;</span><span class="op" id="3092715">,</span>&nbsp;<span class="num" id="3092717">0</span><span class="op" id="3092718">,</span>&nbsp;<span class="num" id="3092720">0</span><span class="op" id="3092721">)</span>&nbsp;<span class="op" id="3092723">!=</span>&nbsp;<span class="ident" id="3092726">nil</span><br>
<span class="lineno"></span><span class="op" id="3092730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3092733">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3092797">func</span>&nbsp;<span class="op" id="3092802">(</span><span class="ident" id="3092803">re</span>&nbsp;<span class="op" id="3092806">*</span><span class="ident" id="3092807">Regexp</span><span class="op" id="3092813">)</span>&nbsp;<span class="ident" id="3092815">MatchString</span><span class="op" id="3092826">(</span><span class="ident" id="3092827">s</span>&nbsp;<span class="builtintype" id="3092829">string</span><span class="op" id="3092835">)</span>&nbsp;<span class="builtintype" id="3092837">bool</span>&nbsp;<span class="op" id="3092842">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092845">return</span>&nbsp;<span class="ident" id="3092852">re</span><span class="op" id="3092854">.</span><span class="ident" id="3092855">doExecute</span><span class="op" id="3092864">(</span><span class="ident" id="3092865">nil</span><span class="op" id="3092868">,</span>&nbsp;<span class="ident" id="3092870">nil</span><span class="op" id="3092873">,</span>&nbsp;<span class="ident" id="3092875">s</span><span class="op" id="3092876">,</span>&nbsp;<span class="num" id="3092878">0</span><span class="op" id="3092879">,</span>&nbsp;<span class="num" id="3092881">0</span><span class="op" id="3092882">)</span>&nbsp;<span class="op" id="3092884">!=</span>&nbsp;<span class="ident" id="3092887">nil</span><br>
<span class="lineno"></span><span class="op" id="3092891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3092894">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3092956">func</span>&nbsp;<span class="op" id="3092961">(</span><span class="ident" id="3092962">re</span>&nbsp;<span class="op" id="3092965">*</span><span class="ident" id="3092966">Regexp</span><span class="op" id="3092972">)</span>&nbsp;<span class="ident" id="3092974">Match</span><span class="op" id="3092979">(</span><span class="ident" id="3092980">b</span>&nbsp;<span class="op" id="3092982">[</span><span class="op" id="3092983">]</span><span class="builtintype" id="3092984">byte</span><span class="op" id="3092988">)</span>&nbsp;<span class="builtintype" id="3092990">bool</span>&nbsp;<span class="op" id="3092995">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092998">return</span>&nbsp;<span class="ident" id="3093005">re</span><span class="op" id="3093007">.</span><span class="ident" id="3093008">doExecute</span><span class="op" id="3093017">(</span><span class="ident" id="3093018">nil</span><span class="op" id="3093021">,</span>&nbsp;<span class="ident" id="3093023">b</span><span class="op" id="3093024">,</span>&nbsp;<span class="string" id="3093026">&#34;&#34;</span><span class="op" id="3093028">,</span>&nbsp;<span class="num" id="3093030">0</span><span class="op" id="3093031">,</span>&nbsp;<span class="num" id="3093033">0</span><span class="op" id="3093034">)</span>&nbsp;<span class="op" id="3093036">!=</span>&nbsp;<span class="ident" id="3093039">nil</span><br>
<span class="lineno"></span><span class="op" id="3093043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3093046">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="3093122">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="3093199">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3093229">func</span>&nbsp;<span class="ident" id="3093234">MatchReader</span><span class="op" id="3093245">(</span><span class="ident" id="3093246">pattern</span>&nbsp;<span class="builtintype" id="3093254">string</span><span class="op" id="3093260">,</span>&nbsp;<span class="ident" id="3093262">r</span>&nbsp;<span class="ident" id="3093264">io</span><span class="op" id="3093266">.</span><span class="ident" id="3093267">RuneReader</span><span class="op" id="3093277">)</span>&nbsp;<span class="op" id="3093279">(</span><span class="ident" id="3093280">matched</span>&nbsp;<span class="builtintype" id="3093288">bool</span><span class="op" id="3093292">,</span>&nbsp;<span class="ident" id="3093294">err</span>&nbsp;<span class="builtintype" id="3093298">error</span><span class="op" id="3093303">)</span>&nbsp;<span class="op" id="3093305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093308">re</span><span class="op" id="3093310">,</span>&nbsp;<span class="ident" id="3093312">err</span>&nbsp;<span class="op" id="3093316">:=</span>&nbsp;<span class="ident" id="3093319">Compile</span><span class="op" id="3093326">(</span><span class="ident" id="3093327">pattern</span><span class="op" id="3093334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093337">if</span>&nbsp;<span class="ident" id="3093340">err</span>&nbsp;<span class="op" id="3093344">!=</span>&nbsp;<span class="ident" id="3093347">nil</span>&nbsp;<span class="op" id="3093351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093355">return</span>&nbsp;<span class="builtintype" id="3093362">false</span><span class="op" id="3093367">,</span>&nbsp;<span class="ident" id="3093369">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3093374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093377">return</span>&nbsp;<span class="ident" id="3093384">re</span><span class="op" id="3093386">.</span><span class="ident" id="3093387">MatchReader</span><span class="op" id="3093398">(</span><span class="ident" id="3093399">r</span><span class="op" id="3093400">)</span><span class="op" id="3093401">,</span>&nbsp;<span class="ident" id="3093403">nil</span><br>
<span class="lineno"></span><span class="op" id="3093407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3093410">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="3093469">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3093521">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3093570">func</span>&nbsp;<span class="ident" id="3093575">MatchString</span><span class="op" id="3093586">(</span><span class="ident" id="3093587">pattern</span>&nbsp;<span class="builtintype" id="3093595">string</span><span class="op" id="3093601">,</span>&nbsp;<span class="ident" id="3093603">s</span>&nbsp;<span class="builtintype" id="3093605">string</span><span class="op" id="3093611">)</span>&nbsp;<span class="op" id="3093613">(</span><span class="ident" id="3093614">matched</span>&nbsp;<span class="builtintype" id="3093622">bool</span><span class="op" id="3093626">,</span>&nbsp;<span class="ident" id="3093628">err</span>&nbsp;<span class="builtintype" id="3093632">error</span><span class="op" id="3093637">)</span>&nbsp;<span class="op" id="3093639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093642">re</span><span class="op" id="3093644">,</span>&nbsp;<span class="ident" id="3093646">err</span>&nbsp;<span class="op" id="3093650">:=</span>&nbsp;<span class="ident" id="3093653">Compile</span><span class="op" id="3093660">(</span><span class="ident" id="3093661">pattern</span><span class="op" id="3093668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093671">if</span>&nbsp;<span class="ident" id="3093674">err</span>&nbsp;<span class="op" id="3093678">!=</span>&nbsp;<span class="ident" id="3093681">nil</span>&nbsp;<span class="op" id="3093685">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093689">return</span>&nbsp;<span class="builtintype" id="3093696">false</span><span class="op" id="3093701">,</span>&nbsp;<span class="ident" id="3093703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3093708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093711">return</span>&nbsp;<span class="ident" id="3093718">re</span><span class="op" id="3093720">.</span><span class="ident" id="3093721">MatchString</span><span class="op" id="3093732">(</span><span class="ident" id="3093733">s</span><span class="op" id="3093734">)</span><span class="op" id="3093735">,</span>&nbsp;<span class="ident" id="3093737">nil</span><br>
<span class="lineno"></span><span class="op" id="3093741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="3093744">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3093797">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3093853">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3093902">func</span>&nbsp;<span class="ident" id="3093907">Match</span><span class="op" id="3093912">(</span><span class="ident" id="3093913">pattern</span>&nbsp;<span class="builtintype" id="3093921">string</span><span class="op" id="3093927">,</span>&nbsp;<span class="ident" id="3093929">b</span>&nbsp;<span class="op" id="3093931">[</span><span class="op" id="3093932">]</span><span class="builtintype" id="3093933">byte</span><span class="op" id="3093937">)</span>&nbsp;<span class="op" id="3093939">(</span><span class="ident" id="3093940">matched</span>&nbsp;<span class="builtintype" id="3093948">bool</span><span class="op" id="3093952">,</span>&nbsp;<span class="ident" id="3093954">err</span>&nbsp;<span class="builtintype" id="3093958">error</span><span class="op" id="3093963">)</span>&nbsp;<span class="op" id="3093965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3093968">re</span><span class="op" id="3093970">,</span>&nbsp;<span class="ident" id="3093972">err</span>&nbsp;<span class="op" id="3093976">:=</span>&nbsp;<span class="ident" id="3093979">Compile</span><span class="op" id="3093986">(</span><span class="ident" id="3093987">pattern</span><span class="op" id="3093994">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3093997">if</span>&nbsp;<span class="ident" id="3094000">err</span>&nbsp;<span class="op" id="3094004">!=</span>&nbsp;<span class="ident" id="3094007">nil</span>&nbsp;<span class="op" id="3094011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094015">return</span>&nbsp;<span class="builtintype" id="3094022">false</span><span class="op" id="3094027">,</span>&nbsp;<span class="ident" id="3094029">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3094034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094037">return</span>&nbsp;<span class="ident" id="3094044">re</span><span class="op" id="3094046">.</span><span class="ident" id="3094047">Match</span><span class="op" id="3094052">(</span><span class="ident" id="3094053">b</span><span class="op" id="3094054">)</span><span class="op" id="3094055">,</span>&nbsp;<span class="ident" id="3094057">nil</span><br>
<span class="lineno"></span><span class="op" id="3094061">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3094064">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3094139">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3094217">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3094293">func</span>&nbsp;<span class="op" id="3094298">(</span><span class="ident" id="3094299">re</span>&nbsp;<span class="op" id="3094302">*</span><span class="ident" id="3094303">Regexp</span><span class="op" id="3094309">)</span>&nbsp;<span class="ident" id="3094311">ReplaceAllString</span><span class="op" id="3094327">(</span><span class="ident" id="3094328">src</span><span class="op" id="3094331">,</span>&nbsp;<span class="ident" id="3094333">repl</span>&nbsp;<span class="builtintype" id="3094338">string</span><span class="op" id="3094344">)</span>&nbsp;<span class="builtintype" id="3094346">string</span>&nbsp;<span class="op" id="3094353">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094356">n</span>&nbsp;<span class="op" id="3094358">:=</span>&nbsp;<span class="num" id="3094361">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094364">if</span>&nbsp;<span class="ident" id="3094367">strings</span><span class="op" id="3094374">.</span><span class="ident" id="3094375">Index</span><span class="op" id="3094380">(</span><span class="ident" id="3094381">repl</span><span class="op" id="3094385">,</span>&nbsp;<span class="string" id="3094387">&#34;$&#34;</span><span class="op" id="3094390">)</span>&nbsp;<span class="op" id="3094392">&gt;=</span>&nbsp;<span class="num" id="3094395">0</span>&nbsp;<span class="op" id="3094397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094401">n</span>&nbsp;<span class="op" id="3094403">=</span>&nbsp;<span class="num" id="3094405">2</span>&nbsp;<span class="op" id="3094407">*</span>&nbsp;<span class="op" id="3094409">(</span><span class="ident" id="3094410">re</span><span class="op" id="3094412">.</span><span class="ident" id="3094413">numSubexp</span>&nbsp;<span class="op" id="3094423">+</span>&nbsp;<span class="num" id="3094425">1</span><span class="op" id="3094426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3094429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3094432">b</span>&nbsp;<span class="op" id="3094434">:=</span>&nbsp;<span class="ident" id="3094437">re</span><span class="op" id="3094439">.</span><span class="ident" id="3094440">replaceAll</span><span class="op" id="3094450">(</span><span class="ident" id="3094451">nil</span><span class="op" id="3094454">,</span>&nbsp;<span class="ident" id="3094456">src</span><span class="op" id="3094459">,</span>&nbsp;<span class="ident" id="3094461">n</span><span class="op" id="3094462">,</span>&nbsp;<span class="keyword" id="3094464">func</span><span class="op" id="3094468">(</span><span class="ident" id="3094469">dst</span>&nbsp;<span class="op" id="3094473">[</span><span class="op" id="3094474">]</span><span class="builtintype" id="3094475">byte</span><span class="op" id="3094479">,</span>&nbsp;<span class="ident" id="3094481">match</span>&nbsp;<span class="op" id="3094487">[</span><span class="op" id="3094488">]</span><span class="builtintype" id="3094489">int</span><span class="op" id="3094492">)</span>&nbsp;<span class="op" id="3094494">[</span><span class="op" id="3094495">]</span><span class="builtintype" id="3094496">byte</span>&nbsp;<span class="op" id="3094501">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094505">return</span>&nbsp;<span class="ident" id="3094512">re</span><span class="op" id="3094514">.</span><span class="ident" id="3094515">expand</span><span class="op" id="3094521">(</span><span class="ident" id="3094522">dst</span><span class="op" id="3094525">,</span>&nbsp;<span class="ident" id="3094527">repl</span><span class="op" id="3094531">,</span>&nbsp;<span class="ident" id="3094533">nil</span><span class="op" id="3094536">,</span>&nbsp;<span class="ident" id="3094538">src</span><span class="op" id="3094541">,</span>&nbsp;<span class="ident" id="3094543">match</span><span class="op" id="3094548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3094551">}</span><span class="op" id="3094552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094555">return</span>&nbsp;<span class="builtintype" id="3094562">string</span><span class="op" id="3094568">(</span><span class="ident" id="3094569">b</span><span class="op" id="3094570">)</span><br>
<span class="lineno"></span><span class="op" id="3094572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3094575">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3094657">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="3094741">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3094766">func</span>&nbsp;<span class="op" id="3094771">(</span><span class="ident" id="3094772">re</span>&nbsp;<span class="op" id="3094775">*</span><span class="ident" id="3094776">Regexp</span><span class="op" id="3094782">)</span>&nbsp;<span class="ident" id="3094784">ReplaceAllLiteralString</span><span class="op" id="3094807">(</span><span class="ident" id="3094808">src</span><span class="op" id="3094811">,</span>&nbsp;<span class="ident" id="3094813">repl</span>&nbsp;<span class="builtintype" id="3094818">string</span><span class="op" id="3094824">)</span>&nbsp;<span class="builtintype" id="3094826">string</span>&nbsp;<span class="op" id="3094833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094836">return</span>&nbsp;<span class="builtintype" id="3094843">string</span><span class="op" id="3094849">(</span><span class="ident" id="3094850">re</span><span class="op" id="3094852">.</span><span class="ident" id="3094853">replaceAll</span><span class="op" id="3094863">(</span><span class="ident" id="3094864">nil</span><span class="op" id="3094867">,</span>&nbsp;<span class="ident" id="3094869">src</span><span class="op" id="3094872">,</span>&nbsp;<span class="num" id="3094874">2</span><span class="op" id="3094875">,</span>&nbsp;<span class="keyword" id="3094877">func</span><span class="op" id="3094881">(</span><span class="ident" id="3094882">dst</span>&nbsp;<span class="op" id="3094886">[</span><span class="op" id="3094887">]</span><span class="builtintype" id="3094888">byte</span><span class="op" id="3094892">,</span>&nbsp;<span class="ident" id="3094894">match</span>&nbsp;<span class="op" id="3094900">[</span><span class="op" id="3094901">]</span><span class="builtintype" id="3094902">int</span><span class="op" id="3094905">)</span>&nbsp;<span class="op" id="3094907">[</span><span class="op" id="3094908">]</span><span class="builtintype" id="3094909">byte</span>&nbsp;<span class="op" id="3094914">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3094918">return</span>&nbsp;<span class="builtinfunc" id="3094925">append</span><span class="op" id="3094931">(</span><span class="ident" id="3094932">dst</span><span class="op" id="3094935">,</span>&nbsp;<span class="ident" id="3094937">repl</span><span class="op" id="3094941">...</span><span class="op" id="3094944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3094947">}</span><span class="op" id="3094948">)</span><span class="op" id="3094949">)</span><br>
<span class="lineno"></span><span class="op" id="3094951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3094954">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3095028">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="3095102">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="3095180">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3095215">func</span>&nbsp;<span class="op" id="3095220">(</span><span class="ident" id="3095221">re</span>&nbsp;<span class="op" id="3095224">*</span><span class="ident" id="3095225">Regexp</span><span class="op" id="3095231">)</span>&nbsp;<span class="ident" id="3095233">ReplaceAllStringFunc</span><span class="op" id="3095253">(</span><span class="ident" id="3095254">src</span>&nbsp;<span class="builtintype" id="3095258">string</span><span class="op" id="3095264">,</span>&nbsp;<span class="ident" id="3095266">repl</span>&nbsp;<span class="keyword" id="3095271">func</span><span class="op" id="3095275">(</span><span class="builtintype" id="3095276">string</span><span class="op" id="3095282">)</span>&nbsp;<span class="builtintype" id="3095284">string</span><span class="op" id="3095290">)</span>&nbsp;<span class="builtintype" id="3095292">string</span>&nbsp;<span class="op" id="3095299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095302">b</span>&nbsp;<span class="op" id="3095304">:=</span>&nbsp;<span class="ident" id="3095307">re</span><span class="op" id="3095309">.</span><span class="ident" id="3095310">replaceAll</span><span class="op" id="3095320">(</span><span class="ident" id="3095321">nil</span><span class="op" id="3095324">,</span>&nbsp;<span class="ident" id="3095326">src</span><span class="op" id="3095329">,</span>&nbsp;<span class="num" id="3095331">2</span><span class="op" id="3095332">,</span>&nbsp;<span class="keyword" id="3095334">func</span><span class="op" id="3095338">(</span><span class="ident" id="3095339">dst</span>&nbsp;<span class="op" id="3095343">[</span><span class="op" id="3095344">]</span><span class="builtintype" id="3095345">byte</span><span class="op" id="3095349">,</span>&nbsp;<span class="ident" id="3095351">match</span>&nbsp;<span class="op" id="3095357">[</span><span class="op" id="3095358">]</span><span class="builtintype" id="3095359">int</span><span class="op" id="3095362">)</span>&nbsp;<span class="op" id="3095364">[</span><span class="op" id="3095365">]</span><span class="builtintype" id="3095366">byte</span>&nbsp;<span class="op" id="3095371">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095375">return</span>&nbsp;<span class="builtinfunc" id="3095382">append</span><span class="op" id="3095388">(</span><span class="ident" id="3095389">dst</span><span class="op" id="3095392">,</span>&nbsp;<span class="ident" id="3095394">repl</span><span class="op" id="3095398">(</span><span class="ident" id="3095399">src</span><span class="op" id="3095402">[</span><span class="ident" id="3095403">match</span><span class="op" id="3095408">[</span><span class="num" id="3095409">0</span><span class="op" id="3095410">]</span><span class="op" id="3095411">:</span><span class="ident" id="3095412">match</span><span class="op" id="3095417">[</span><span class="num" id="3095418">1</span><span class="op" id="3095419">]</span><span class="op" id="3095420">]</span><span class="op" id="3095421">)</span><span class="op" id="3095422">...</span><span class="op" id="3095425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095428">}</span><span class="op" id="3095429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095432">return</span>&nbsp;<span class="builtintype" id="3095439">string</span><span class="op" id="3095445">(</span><span class="ident" id="3095446">b</span><span class="op" id="3095447">)</span><br>
<span class="lineno"></span><span class="op" id="3095449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="3095452">func</span>&nbsp;<span class="op" id="3095457">(</span><span class="ident" id="3095458">re</span>&nbsp;<span class="op" id="3095461">*</span><span class="ident" id="3095462">Regexp</span><span class="op" id="3095468">)</span>&nbsp;<span class="ident" id="3095470">replaceAll</span><span class="op" id="3095480">(</span><span class="ident" id="3095481">bsrc</span>&nbsp;<span class="op" id="3095486">[</span><span class="op" id="3095487">]</span><span class="builtintype" id="3095488">byte</span><span class="op" id="3095492">,</span>&nbsp;<span class="ident" id="3095494">src</span>&nbsp;<span class="builtintype" id="3095498">string</span><span class="op" id="3095504">,</span>&nbsp;<span class="ident" id="3095506">nmatch</span>&nbsp;<span class="builtintype" id="3095513">int</span><span class="op" id="3095516">,</span>&nbsp;<span class="ident" id="3095518">repl</span>&nbsp;<span class="keyword" id="3095523">func</span><span class="op" id="3095527">(</span><span class="ident" id="3095528">dst</span>&nbsp;<span class="op" id="3095532">[</span><span class="op" id="3095533">]</span><span class="builtintype" id="3095534">byte</span><span class="op" id="3095538">,</span>&nbsp;<span class="ident" id="3095540">m</span>&nbsp;<span class="op" id="3095542">[</span><span class="op" id="3095543">]</span><span class="builtintype" id="3095544">int</span><span class="op" id="3095547">)</span>&nbsp;<span class="op" id="3095549">[</span><span class="op" id="3095550">]</span><span class="builtintype" id="3095551">byte</span><span class="op" id="3095555">)</span>&nbsp;<span class="op" id="3095557">[</span><span class="op" id="3095558">]</span><span class="builtintype" id="3095559">byte</span>&nbsp;<span class="op" id="3095564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095567">lastMatchEnd</span>&nbsp;<span class="op" id="3095580">:=</span>&nbsp;<span class="num" id="3095583">0</span>&nbsp;<span class="comment" id="3095585">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095627">searchPos</span>&nbsp;<span class="op" id="3095637">:=</span>&nbsp;<span class="num" id="3095640">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3095645">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095689">var</span>&nbsp;<span class="ident" id="3095693">buf</span>&nbsp;<span class="op" id="3095697">[</span><span class="op" id="3095698">]</span><span class="builtintype" id="3095699">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095705">var</span>&nbsp;<span class="ident" id="3095709">endPos</span>&nbsp;<span class="builtintype" id="3095716">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095721">if</span>&nbsp;<span class="ident" id="3095724">bsrc</span>&nbsp;<span class="op" id="3095729">!=</span>&nbsp;<span class="ident" id="3095732">nil</span>&nbsp;<span class="op" id="3095736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095740">endPos</span>&nbsp;<span class="op" id="3095747">=</span>&nbsp;<span class="builtinfunc" id="3095749">len</span><span class="op" id="3095752">(</span><span class="ident" id="3095753">bsrc</span><span class="op" id="3095757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095760">}</span>&nbsp;<span class="keyword" id="3095762">else</span>&nbsp;<span class="op" id="3095767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095771">endPos</span>&nbsp;<span class="op" id="3095778">=</span>&nbsp;<span class="builtinfunc" id="3095780">len</span><span class="op" id="3095783">(</span><span class="ident" id="3095784">src</span><span class="op" id="3095787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095790">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095793">for</span>&nbsp;<span class="ident" id="3095797">searchPos</span>&nbsp;<span class="op" id="3095807">&lt;=</span>&nbsp;<span class="ident" id="3095810">endPos</span>&nbsp;<span class="op" id="3095817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3095821">a</span>&nbsp;<span class="op" id="3095823">:=</span>&nbsp;<span class="ident" id="3095826">re</span><span class="op" id="3095828">.</span><span class="ident" id="3095829">doExecute</span><span class="op" id="3095838">(</span><span class="ident" id="3095839">nil</span><span class="op" id="3095842">,</span>&nbsp;<span class="ident" id="3095844">bsrc</span><span class="op" id="3095848">,</span>&nbsp;<span class="ident" id="3095850">src</span><span class="op" id="3095853">,</span>&nbsp;<span class="ident" id="3095855">searchPos</span><span class="op" id="3095864">,</span>&nbsp;<span class="ident" id="3095866">nmatch</span><span class="op" id="3095872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095876">if</span>&nbsp;<span class="builtinfunc" id="3095879">len</span><span class="op" id="3095882">(</span><span class="ident" id="3095883">a</span><span class="op" id="3095884">)</span>&nbsp;<span class="op" id="3095886">==</span>&nbsp;<span class="num" id="3095889">0</span>&nbsp;<span class="op" id="3095891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095896">break</span>&nbsp;<span class="comment" id="3095902">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3095923">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3095928">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3095982">if</span>&nbsp;<span class="ident" id="3095985">bsrc</span>&nbsp;<span class="op" id="3095990">!=</span>&nbsp;<span class="ident" id="3095993">nil</span>&nbsp;<span class="op" id="3095997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096002">buf</span>&nbsp;<span class="op" id="3096006">=</span>&nbsp;<span class="builtinfunc" id="3096008">append</span><span class="op" id="3096014">(</span><span class="ident" id="3096015">buf</span><span class="op" id="3096018">,</span>&nbsp;<span class="ident" id="3096020">bsrc</span><span class="op" id="3096024">[</span><span class="ident" id="3096025">lastMatchEnd</span><span class="op" id="3096037">:</span><span class="ident" id="3096038">a</span><span class="op" id="3096039">[</span><span class="num" id="3096040">0</span><span class="op" id="3096041">]</span><span class="op" id="3096042">]</span><span class="op" id="3096043">...</span><span class="op" id="3096046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096050">}</span>&nbsp;<span class="keyword" id="3096052">else</span>&nbsp;<span class="op" id="3096057">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096062">buf</span>&nbsp;<span class="op" id="3096066">=</span>&nbsp;<span class="builtinfunc" id="3096068">append</span><span class="op" id="3096074">(</span><span class="ident" id="3096075">buf</span><span class="op" id="3096078">,</span>&nbsp;<span class="ident" id="3096080">src</span><span class="op" id="3096083">[</span><span class="ident" id="3096084">lastMatchEnd</span><span class="op" id="3096096">:</span><span class="ident" id="3096097">a</span><span class="op" id="3096098">[</span><span class="num" id="3096099">0</span><span class="op" id="3096100">]</span><span class="op" id="3096101">]</span><span class="op" id="3096102">...</span><span class="op" id="3096105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096114">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096178">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096242">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096303">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096348">if</span>&nbsp;<span class="ident" id="3096351">a</span><span class="op" id="3096352">[</span><span class="num" id="3096353">1</span><span class="op" id="3096354">]</span>&nbsp;<span class="op" id="3096356">&gt;</span>&nbsp;<span class="ident" id="3096358">lastMatchEnd</span>&nbsp;<span class="op" id="3096371">||</span>&nbsp;<span class="ident" id="3096374">a</span><span class="op" id="3096375">[</span><span class="num" id="3096376">0</span><span class="op" id="3096377">]</span>&nbsp;<span class="op" id="3096379">==</span>&nbsp;<span class="num" id="3096382">0</span>&nbsp;<span class="op" id="3096384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096389">buf</span>&nbsp;<span class="op" id="3096393">=</span>&nbsp;<span class="ident" id="3096395">repl</span><span class="op" id="3096399">(</span><span class="ident" id="3096400">buf</span><span class="op" id="3096403">,</span>&nbsp;<span class="ident" id="3096405">a</span><span class="op" id="3096406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096410">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096414">lastMatchEnd</span>&nbsp;<span class="op" id="3096427">=</span>&nbsp;<span class="ident" id="3096429">a</span><span class="op" id="3096430">[</span><span class="num" id="3096431">1</span><span class="op" id="3096432">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096437">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096506">var</span>&nbsp;<span class="ident" id="3096510">width</span>&nbsp;<span class="builtintype" id="3096516">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096522">if</span>&nbsp;<span class="ident" id="3096525">bsrc</span>&nbsp;<span class="op" id="3096530">!=</span>&nbsp;<span class="ident" id="3096533">nil</span>&nbsp;<span class="op" id="3096537">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096542">_</span><span class="op" id="3096543">,</span>&nbsp;<span class="ident" id="3096545">width</span>&nbsp;<span class="op" id="3096551">=</span>&nbsp;<span class="ident" id="3096553">utf8</span><span class="op" id="3096557">.</span><span class="ident" id="3096558">DecodeRune</span><span class="op" id="3096568">(</span><span class="ident" id="3096569">bsrc</span><span class="op" id="3096573">[</span><span class="ident" id="3096574">searchPos</span><span class="op" id="3096583">:</span><span class="op" id="3096584">]</span><span class="op" id="3096585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096589">}</span>&nbsp;<span class="keyword" id="3096591">else</span>&nbsp;<span class="op" id="3096596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096601">_</span><span class="op" id="3096602">,</span>&nbsp;<span class="ident" id="3096604">width</span>&nbsp;<span class="op" id="3096610">=</span>&nbsp;<span class="ident" id="3096612">utf8</span><span class="op" id="3096616">.</span><span class="ident" id="3096617">DecodeRuneInString</span><span class="op" id="3096635">(</span><span class="ident" id="3096636">src</span><span class="op" id="3096639">[</span><span class="ident" id="3096640">searchPos</span><span class="op" id="3096649">:</span><span class="op" id="3096650">]</span><span class="op" id="3096651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096659">if</span>&nbsp;<span class="ident" id="3096662">searchPos</span><span class="op" id="3096671">+</span><span class="ident" id="3096672">width</span>&nbsp;<span class="op" id="3096678">&gt;</span>&nbsp;<span class="ident" id="3096680">a</span><span class="op" id="3096681">[</span><span class="num" id="3096682">1</span><span class="op" id="3096683">]</span>&nbsp;<span class="op" id="3096685">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096690">searchPos</span>&nbsp;<span class="op" id="3096700">+=</span>&nbsp;<span class="ident" id="3096703">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096711">}</span>&nbsp;<span class="keyword" id="3096713">else</span>&nbsp;<span class="keyword" id="3096718">if</span>&nbsp;<span class="ident" id="3096721">searchPos</span><span class="op" id="3096730">+</span><span class="num" id="3096731">1</span>&nbsp;<span class="op" id="3096733">&gt;</span>&nbsp;<span class="ident" id="3096735">a</span><span class="op" id="3096736">[</span><span class="num" id="3096737">1</span><span class="op" id="3096738">]</span>&nbsp;<span class="op" id="3096740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096745">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096802">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096867">searchPos</span><span class="op" id="3096876">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096881">}</span>&nbsp;<span class="keyword" id="3096883">else</span>&nbsp;<span class="op" id="3096888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096893">searchPos</span>&nbsp;<span class="op" id="3096903">=</span>&nbsp;<span class="ident" id="3096905">a</span><span class="op" id="3096906">[</span><span class="num" id="3096907">1</span><span class="op" id="3096908">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3096915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096919">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3096975">if</span>&nbsp;<span class="ident" id="3096978">bsrc</span>&nbsp;<span class="op" id="3096983">!=</span>&nbsp;<span class="ident" id="3096986">nil</span>&nbsp;<span class="op" id="3096990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096994">buf</span>&nbsp;<span class="op" id="3096998">=</span>&nbsp;<span class="builtinfunc" id="3097000">append</span><span class="op" id="3097006">(</span><span class="ident" id="3097007">buf</span><span class="op" id="3097010">,</span>&nbsp;<span class="ident" id="3097012">bsrc</span><span class="op" id="3097016">[</span><span class="ident" id="3097017">lastMatchEnd</span><span class="op" id="3097029">:</span><span class="op" id="3097030">]</span><span class="op" id="3097031">...</span><span class="op" id="3097034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097037">}</span>&nbsp;<span class="keyword" id="3097039">else</span>&nbsp;<span class="op" id="3097044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097048">buf</span>&nbsp;<span class="op" id="3097052">=</span>&nbsp;<span class="builtinfunc" id="3097054">append</span><span class="op" id="3097060">(</span><span class="ident" id="3097061">buf</span><span class="op" id="3097064">,</span>&nbsp;<span class="ident" id="3097066">src</span><span class="op" id="3097069">[</span><span class="ident" id="3097070">lastMatchEnd</span><span class="op" id="3097082">:</span><span class="op" id="3097083">]</span><span class="op" id="3097084">...</span><span class="op" id="3097087">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097094">return</span>&nbsp;<span class="ident" id="3097101">buf</span><br>
<span class="lineno"></span><span class="op" id="3097105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3097108">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3097177">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3097253">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3097329">func</span>&nbsp;<span class="op" id="3097334">(</span><span class="ident" id="3097335">re</span>&nbsp;<span class="op" id="3097338">*</span><span class="ident" id="3097339">Regexp</span><span class="op" id="3097345">)</span>&nbsp;<span class="ident" id="3097347">ReplaceAll</span><span class="op" id="3097357">(</span><span class="ident" id="3097358">src</span><span class="op" id="3097361">,</span>&nbsp;<span class="ident" id="3097363">repl</span>&nbsp;<span class="op" id="3097368">[</span><span class="op" id="3097369">]</span><span class="builtintype" id="3097370">byte</span><span class="op" id="3097374">)</span>&nbsp;<span class="op" id="3097376">[</span><span class="op" id="3097377">]</span><span class="builtintype" id="3097378">byte</span>&nbsp;<span class="op" id="3097383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097386">n</span>&nbsp;<span class="op" id="3097388">:=</span>&nbsp;<span class="num" id="3097391">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097394">if</span>&nbsp;<span class="ident" id="3097397">bytes</span><span class="op" id="3097402">.</span><span class="ident" id="3097403">IndexByte</span><span class="op" id="3097412">(</span><span class="ident" id="3097413">repl</span><span class="op" id="3097417">,</span>&nbsp;<span class="string" id="3097419">&#39;$&#39;</span><span class="op" id="3097422">)</span>&nbsp;<span class="op" id="3097424">&gt;=</span>&nbsp;<span class="num" id="3097427">0</span>&nbsp;<span class="op" id="3097429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097433">n</span>&nbsp;<span class="op" id="3097435">=</span>&nbsp;<span class="num" id="3097437">2</span>&nbsp;<span class="op" id="3097439">*</span>&nbsp;<span class="op" id="3097441">(</span><span class="ident" id="3097442">re</span><span class="op" id="3097444">.</span><span class="ident" id="3097445">numSubexp</span>&nbsp;<span class="op" id="3097455">+</span>&nbsp;<span class="num" id="3097457">1</span><span class="op" id="3097458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097464">srepl</span>&nbsp;<span class="op" id="3097470">:=</span>&nbsp;<span class="string" id="3097473">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097477">b</span>&nbsp;<span class="op" id="3097479">:=</span>&nbsp;<span class="ident" id="3097482">re</span><span class="op" id="3097484">.</span><span class="ident" id="3097485">replaceAll</span><span class="op" id="3097495">(</span><span class="ident" id="3097496">src</span><span class="op" id="3097499">,</span>&nbsp;<span class="string" id="3097501">&#34;&#34;</span><span class="op" id="3097503">,</span>&nbsp;<span class="ident" id="3097505">n</span><span class="op" id="3097506">,</span>&nbsp;<span class="keyword" id="3097508">func</span><span class="op" id="3097512">(</span><span class="ident" id="3097513">dst</span>&nbsp;<span class="op" id="3097517">[</span><span class="op" id="3097518">]</span><span class="builtintype" id="3097519">byte</span><span class="op" id="3097523">,</span>&nbsp;<span class="ident" id="3097525">match</span>&nbsp;<span class="op" id="3097531">[</span><span class="op" id="3097532">]</span><span class="builtintype" id="3097533">int</span><span class="op" id="3097536">)</span>&nbsp;<span class="op" id="3097538">[</span><span class="op" id="3097539">]</span><span class="builtintype" id="3097540">byte</span>&nbsp;<span class="op" id="3097545">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097549">if</span>&nbsp;<span class="builtinfunc" id="3097552">len</span><span class="op" id="3097555">(</span><span class="ident" id="3097556">srepl</span><span class="op" id="3097561">)</span>&nbsp;<span class="op" id="3097563">!=</span>&nbsp;<span class="builtinfunc" id="3097566">len</span><span class="op" id="3097569">(</span><span class="ident" id="3097570">repl</span><span class="op" id="3097574">)</span>&nbsp;<span class="op" id="3097576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097581">srepl</span>&nbsp;<span class="op" id="3097587">=</span>&nbsp;<span class="builtintype" id="3097589">string</span><span class="op" id="3097595">(</span><span class="ident" id="3097596">repl</span><span class="op" id="3097600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097608">return</span>&nbsp;<span class="ident" id="3097615">re</span><span class="op" id="3097617">.</span><span class="ident" id="3097618">expand</span><span class="op" id="3097624">(</span><span class="ident" id="3097625">dst</span><span class="op" id="3097628">,</span>&nbsp;<span class="ident" id="3097630">srepl</span><span class="op" id="3097635">,</span>&nbsp;<span class="ident" id="3097637">src</span><span class="op" id="3097640">,</span>&nbsp;<span class="string" id="3097642">&#34;&#34;</span><span class="op" id="3097644">,</span>&nbsp;<span class="ident" id="3097646">match</span><span class="op" id="3097651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097654">}</span><span class="op" id="3097655">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097658">return</span>&nbsp;<span class="ident" id="3097665">b</span><br>
<span class="lineno"></span><span class="op" id="3097667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3097670">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3097746">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="3097829">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3097854">func</span>&nbsp;<span class="op" id="3097859">(</span><span class="ident" id="3097860">re</span>&nbsp;<span class="op" id="3097863">*</span><span class="ident" id="3097864">Regexp</span><span class="op" id="3097870">)</span>&nbsp;<span class="ident" id="3097872">ReplaceAllLiteral</span><span class="op" id="3097889">(</span><span class="ident" id="3097890">src</span><span class="op" id="3097893">,</span>&nbsp;<span class="ident" id="3097895">repl</span>&nbsp;<span class="op" id="3097900">[</span><span class="op" id="3097901">]</span><span class="builtintype" id="3097902">byte</span><span class="op" id="3097906">)</span>&nbsp;<span class="op" id="3097908">[</span><span class="op" id="3097909">]</span><span class="builtintype" id="3097910">byte</span>&nbsp;<span class="op" id="3097915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097918">return</span>&nbsp;<span class="ident" id="3097925">re</span><span class="op" id="3097927">.</span><span class="ident" id="3097928">replaceAll</span><span class="op" id="3097938">(</span><span class="ident" id="3097939">src</span><span class="op" id="3097942">,</span>&nbsp;<span class="string" id="3097944">&#34;&#34;</span><span class="op" id="3097946">,</span>&nbsp;<span class="num" id="3097948">2</span><span class="op" id="3097949">,</span>&nbsp;<span class="keyword" id="3097951">func</span><span class="op" id="3097955">(</span><span class="ident" id="3097956">dst</span>&nbsp;<span class="op" id="3097960">[</span><span class="op" id="3097961">]</span><span class="builtintype" id="3097962">byte</span><span class="op" id="3097966">,</span>&nbsp;<span class="ident" id="3097968">match</span>&nbsp;<span class="op" id="3097974">[</span><span class="op" id="3097975">]</span><span class="builtintype" id="3097976">int</span><span class="op" id="3097979">)</span>&nbsp;<span class="op" id="3097981">[</span><span class="op" id="3097982">]</span><span class="builtintype" id="3097983">byte</span>&nbsp;<span class="op" id="3097988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097992">return</span>&nbsp;<span class="builtinfunc" id="3097999">append</span><span class="op" id="3098005">(</span><span class="ident" id="3098006">dst</span><span class="op" id="3098009">,</span>&nbsp;<span class="ident" id="3098011">repl</span><span class="op" id="3098015">...</span><span class="op" id="3098018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098021">}</span><span class="op" id="3098022">)</span><br>
<span class="lineno">560</span><span class="op" id="3098024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3098027">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3098095">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="3098169">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="3098248">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3098283">func</span>&nbsp;<span class="op" id="3098288">(</span><span class="ident" id="3098289">re</span>&nbsp;<span class="op" id="3098292">*</span><span class="ident" id="3098293">Regexp</span><span class="op" id="3098299">)</span>&nbsp;<span class="ident" id="3098301">ReplaceAllFunc</span><span class="op" id="3098315">(</span><span class="ident" id="3098316">src</span>&nbsp;<span class="op" id="3098320">[</span><span class="op" id="3098321">]</span><span class="builtintype" id="3098322">byte</span><span class="op" id="3098326">,</span>&nbsp;<span class="ident" id="3098328">repl</span>&nbsp;<span class="keyword" id="3098333">func</span><span class="op" id="3098337">(</span><span class="op" id="3098338">[</span><span class="op" id="3098339">]</span><span class="builtintype" id="3098340">byte</span><span class="op" id="3098344">)</span>&nbsp;<span class="op" id="3098346">[</span><span class="op" id="3098347">]</span><span class="builtintype" id="3098348">byte</span><span class="op" id="3098352">)</span>&nbsp;<span class="op" id="3098354">[</span><span class="op" id="3098355">]</span><span class="builtintype" id="3098356">byte</span>&nbsp;<span class="op" id="3098361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098364">return</span>&nbsp;<span class="ident" id="3098371">re</span><span class="op" id="3098373">.</span><span class="ident" id="3098374">replaceAll</span><span class="op" id="3098384">(</span><span class="ident" id="3098385">src</span><span class="op" id="3098388">,</span>&nbsp;<span class="string" id="3098390">&#34;&#34;</span><span class="op" id="3098392">,</span>&nbsp;<span class="num" id="3098394">2</span><span class="op" id="3098395">,</span>&nbsp;<span class="keyword" id="3098397">func</span><span class="op" id="3098401">(</span><span class="ident" id="3098402">dst</span>&nbsp;<span class="op" id="3098406">[</span><span class="op" id="3098407">]</span><span class="builtintype" id="3098408">byte</span><span class="op" id="3098412">,</span>&nbsp;<span class="ident" id="3098414">match</span>&nbsp;<span class="op" id="3098420">[</span><span class="op" id="3098421">]</span><span class="builtintype" id="3098422">int</span><span class="op" id="3098425">)</span>&nbsp;<span class="op" id="3098427">[</span><span class="op" id="3098428">]</span><span class="builtintype" id="3098429">byte</span>&nbsp;<span class="op" id="3098434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098438">return</span>&nbsp;<span class="builtinfunc" id="3098445">append</span><span class="op" id="3098451">(</span><span class="ident" id="3098452">dst</span><span class="op" id="3098455">,</span>&nbsp;<span class="ident" id="3098457">repl</span><span class="op" id="3098461">(</span><span class="ident" id="3098462">src</span><span class="op" id="3098465">[</span><span class="ident" id="3098466">match</span><span class="op" id="3098471">[</span><span class="num" id="3098472">0</span><span class="op" id="3098473">]</span><span class="op" id="3098474">:</span><span class="ident" id="3098475">match</span><span class="op" id="3098480">[</span><span class="num" id="3098481">1</span><span class="op" id="3098482">]</span><span class="op" id="3098483">]</span><span class="op" id="3098484">)</span><span class="op" id="3098485">...</span><span class="op" id="3098488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098491">}</span><span class="op" id="3098492">)</span><br>
<span class="lineno">570</span><span class="op" id="3098494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3098497">var</span>&nbsp;<span class="ident" id="3098501">specialBytes</span>&nbsp;<span class="op" id="3098514">=</span>&nbsp;<span class="op" id="3098516">[</span><span class="op" id="3098517">]</span><span class="builtintype" id="3098518">byte</span><span class="op" id="3098522">(</span><span class="string" id="3098523">`\.+*?()|[]{}^$`</span><span class="op" id="3098539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3098542">func</span>&nbsp;<span class="ident" id="3098547">special</span><span class="op" id="3098554">(</span><span class="ident" id="3098555">b</span>&nbsp;<span class="builtintype" id="3098557">byte</span><span class="op" id="3098561">)</span>&nbsp;<span class="builtintype" id="3098563">bool</span>&nbsp;<span class="op" id="3098568">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098571">return</span>&nbsp;<span class="ident" id="3098578">bytes</span><span class="op" id="3098583">.</span><span class="ident" id="3098584">IndexByte</span><span class="op" id="3098593">(</span><span class="ident" id="3098594">specialBytes</span><span class="op" id="3098606">,</span>&nbsp;<span class="ident" id="3098608">b</span><span class="op" id="3098609">)</span>&nbsp;<span class="op" id="3098611">&gt;=</span>&nbsp;<span class="num" id="3098614">0</span><br>
<span class="lineno"></span><span class="op" id="3098616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3098619">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="3098699">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="3098781">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="3098854">func</span>&nbsp;<span class="ident" id="3098859">QuoteMeta</span><span class="op" id="3098868">(</span><span class="ident" id="3098869">s</span>&nbsp;<span class="builtintype" id="3098871">string</span><span class="op" id="3098877">)</span>&nbsp;<span class="builtintype" id="3098879">string</span>&nbsp;<span class="op" id="3098886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098889">b</span>&nbsp;<span class="op" id="3098891">:=</span>&nbsp;<span class="builtinfunc" id="3098894">make</span><span class="op" id="3098898">(</span><span class="op" id="3098899">[</span><span class="op" id="3098900">]</span><span class="builtintype" id="3098901">byte</span><span class="op" id="3098905">,</span>&nbsp;<span class="num" id="3098907">2</span><span class="op" id="3098908">*</span><span class="builtinfunc" id="3098909">len</span><span class="op" id="3098912">(</span><span class="ident" id="3098913">s</span><span class="op" id="3098914">)</span><span class="op" id="3098915">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098919">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098984">j</span>&nbsp;<span class="op" id="3098986">:=</span>&nbsp;<span class="num" id="3098989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098992">for</span>&nbsp;<span class="ident" id="3098996">i</span>&nbsp;<span class="op" id="3098998">:=</span>&nbsp;<span class="num" id="3099001">0</span><span class="op" id="3099002">;</span>&nbsp;<span class="ident" id="3099004">i</span>&nbsp;<span class="op" id="3099006">&lt;</span>&nbsp;<span class="builtinfunc" id="3099008">len</span><span class="op" id="3099011">(</span><span class="ident" id="3099012">s</span><span class="op" id="3099013">)</span><span class="op" id="3099014">;</span>&nbsp;<span class="ident" id="3099016">i</span><span class="op" id="3099017">++</span>&nbsp;<span class="op" id="3099020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099024">if</span>&nbsp;<span class="ident" id="3099027">special</span><span class="op" id="3099034">(</span><span class="ident" id="3099035">s</span><span class="op" id="3099036">[</span><span class="ident" id="3099037">i</span><span class="op" id="3099038">]</span><span class="op" id="3099039">)</span>&nbsp;<span class="op" id="3099041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099046">b</span><span class="op" id="3099047">[</span><span class="ident" id="3099048">j</span><span class="op" id="3099049">]</span>&nbsp;<span class="op" id="3099051">=</span>&nbsp;<span class="string" id="3099053">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099061">j</span><span class="op" id="3099062">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099071">b</span><span class="op" id="3099072">[</span><span class="ident" id="3099073">j</span><span class="op" id="3099074">]</span>&nbsp;<span class="op" id="3099076">=</span>&nbsp;<span class="ident" id="3099078">s</span><span class="op" id="3099079">[</span><span class="ident" id="3099080">i</span><span class="op" id="3099081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099085">j</span><span class="op" id="3099086">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099093">return</span>&nbsp;<span class="builtintype" id="3099100">string</span><span class="op" id="3099106">(</span><span class="ident" id="3099107">b</span><span class="op" id="3099108">[</span><span class="num" id="3099109">0</span><span class="op" id="3099110">:</span><span class="ident" id="3099111">j</span><span class="op" id="3099112">]</span><span class="op" id="3099113">)</span><br>
<span class="lineno">595</span><span class="op" id="3099115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3099118">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="3099180">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="3099238">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="3099299">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3099360">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="3099428">func</span>&nbsp;<span class="op" id="3099433">(</span><span class="ident" id="3099434">re</span>&nbsp;<span class="op" id="3099437">*</span><span class="ident" id="3099438">Regexp</span><span class="op" id="3099444">)</span>&nbsp;<span class="ident" id="3099446">pad</span><span class="op" id="3099449">(</span><span class="ident" id="3099450">a</span>&nbsp;<span class="op" id="3099452">[</span><span class="op" id="3099453">]</span><span class="builtintype" id="3099454">int</span><span class="op" id="3099457">)</span>&nbsp;<span class="op" id="3099459">[</span><span class="op" id="3099460">]</span><span class="builtintype" id="3099461">int</span>&nbsp;<span class="op" id="3099465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099468">if</span>&nbsp;<span class="ident" id="3099471">a</span>&nbsp;<span class="op" id="3099473">==</span>&nbsp;<span class="ident" id="3099476">nil</span>&nbsp;<span class="op" id="3099480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3099484">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099499">return</span>&nbsp;<span class="ident" id="3099506">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099514">n</span>&nbsp;<span class="op" id="3099516">:=</span>&nbsp;<span class="op" id="3099519">(</span><span class="num" id="3099520">1</span>&nbsp;<span class="op" id="3099522">+</span>&nbsp;<span class="ident" id="3099524">re</span><span class="op" id="3099526">.</span><span class="ident" id="3099527">numSubexp</span><span class="op" id="3099536">)</span>&nbsp;<span class="op" id="3099538">*</span>&nbsp;<span class="num" id="3099540">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099543">for</span>&nbsp;<span class="builtinfunc" id="3099547">len</span><span class="op" id="3099550">(</span><span class="ident" id="3099551">a</span><span class="op" id="3099552">)</span>&nbsp;<span class="op" id="3099554">&lt;</span>&nbsp;<span class="ident" id="3099556">n</span>&nbsp;<span class="op" id="3099558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099562">a</span>&nbsp;<span class="op" id="3099564">=</span>&nbsp;<span class="builtinfunc" id="3099566">append</span><span class="op" id="3099572">(</span><span class="ident" id="3099573">a</span><span class="op" id="3099574">,</span>&nbsp;<span class="op" id="3099576">-</span><span class="num" id="3099577">1</span><span class="op" id="3099578">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099584">return</span>&nbsp;<span class="ident" id="3099591">a</span><br>
<span class="lineno"></span><span class="op" id="3099593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3099596">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="3099676">func</span>&nbsp;<span class="op" id="3099681">(</span><span class="ident" id="3099682">re</span>&nbsp;<span class="op" id="3099685">*</span><span class="ident" id="3099686">Regexp</span><span class="op" id="3099692">)</span>&nbsp;<span class="ident" id="3099694">allMatches</span><span class="op" id="3099704">(</span><span class="ident" id="3099705">s</span>&nbsp;<span class="builtintype" id="3099707">string</span><span class="op" id="3099713">,</span>&nbsp;<span class="ident" id="3099715">b</span>&nbsp;<span class="op" id="3099717">[</span><span class="op" id="3099718">]</span><span class="builtintype" id="3099719">byte</span><span class="op" id="3099723">,</span>&nbsp;<span class="ident" id="3099725">n</span>&nbsp;<span class="builtintype" id="3099727">int</span><span class="op" id="3099730">,</span>&nbsp;<span class="ident" id="3099732">deliver</span>&nbsp;<span class="keyword" id="3099740">func</span><span class="op" id="3099744">(</span><span class="op" id="3099745">[</span><span class="op" id="3099746">]</span><span class="builtintype" id="3099747">int</span><span class="op" id="3099750">)</span><span class="op" id="3099751">)</span>&nbsp;<span class="op" id="3099753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099756">var</span>&nbsp;<span class="ident" id="3099760">end</span>&nbsp;<span class="builtintype" id="3099764">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099769">if</span>&nbsp;<span class="ident" id="3099772">b</span>&nbsp;<span class="op" id="3099774">==</span>&nbsp;<span class="ident" id="3099777">nil</span>&nbsp;<span class="op" id="3099781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099785">end</span>&nbsp;<span class="op" id="3099789">=</span>&nbsp;<span class="builtinfunc" id="3099791">len</span><span class="op" id="3099794">(</span><span class="ident" id="3099795">s</span><span class="op" id="3099796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099799">}</span>&nbsp;<span class="keyword" id="3099801">else</span>&nbsp;<span class="op" id="3099806">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099810">end</span>&nbsp;<span class="op" id="3099814">=</span>&nbsp;<span class="builtinfunc" id="3099816">len</span><span class="op" id="3099819">(</span><span class="ident" id="3099820">b</span><span class="op" id="3099821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099828">for</span>&nbsp;<span class="ident" id="3099832">pos</span><span class="op" id="3099835">,</span>&nbsp;<span class="ident" id="3099837">i</span><span class="op" id="3099838">,</span>&nbsp;<span class="ident" id="3099840">prevMatchEnd</span>&nbsp;<span class="op" id="3099853">:=</span>&nbsp;<span class="num" id="3099856">0</span><span class="op" id="3099857">,</span>&nbsp;<span class="num" id="3099859">0</span><span class="op" id="3099860">,</span>&nbsp;<span class="op" id="3099862">-</span><span class="num" id="3099863">1</span><span class="op" id="3099864">;</span>&nbsp;<span class="ident" id="3099866">i</span>&nbsp;<span class="op" id="3099868">&lt;</span>&nbsp;<span class="ident" id="3099870">n</span>&nbsp;<span class="op" id="3099872">&amp;&amp;</span>&nbsp;<span class="ident" id="3099875">pos</span>&nbsp;<span class="op" id="3099879">&lt;=</span>&nbsp;<span class="ident" id="3099882">end</span><span class="op" id="3099885">;</span>&nbsp;<span class="op" id="3099887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099891">matches</span>&nbsp;<span class="op" id="3099899">:=</span>&nbsp;<span class="ident" id="3099902">re</span><span class="op" id="3099904">.</span><span class="ident" id="3099905">doExecute</span><span class="op" id="3099914">(</span><span class="ident" id="3099915">nil</span><span class="op" id="3099918">,</span>&nbsp;<span class="ident" id="3099920">b</span><span class="op" id="3099921">,</span>&nbsp;<span class="ident" id="3099923">s</span><span class="op" id="3099924">,</span>&nbsp;<span class="ident" id="3099926">pos</span><span class="op" id="3099929">,</span>&nbsp;<span class="ident" id="3099931">re</span><span class="op" id="3099933">.</span><span class="ident" id="3099934">prog</span><span class="op" id="3099938">.</span><span class="ident" id="3099939">NumCap</span><span class="op" id="3099945">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099949">if</span>&nbsp;<span class="builtinfunc" id="3099952">len</span><span class="op" id="3099955">(</span><span class="ident" id="3099956">matches</span><span class="op" id="3099963">)</span>&nbsp;<span class="op" id="3099965">==</span>&nbsp;<span class="num" id="3099968">0</span>&nbsp;<span class="op" id="3099970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099975">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099988">accept</span>&nbsp;<span class="op" id="3099995">:=</span>&nbsp;<span class="builtintype" id="3099998">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100005">if</span>&nbsp;<span class="ident" id="3100008">matches</span><span class="op" id="3100015">[</span><span class="num" id="3100016">1</span><span class="op" id="3100017">]</span>&nbsp;<span class="op" id="3100019">==</span>&nbsp;<span class="ident" id="3100022">pos</span>&nbsp;<span class="op" id="3100026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100031">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100065">if</span>&nbsp;<span class="ident" id="3100068">matches</span><span class="op" id="3100075">[</span><span class="num" id="3100076">0</span><span class="op" id="3100077">]</span>&nbsp;<span class="op" id="3100079">==</span>&nbsp;<span class="ident" id="3100082">prevMatchEnd</span>&nbsp;<span class="op" id="3100095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100101">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100144">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100189">accept</span>&nbsp;<span class="op" id="3100196">=</span>&nbsp;<span class="builtintype" id="3100198">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100212">var</span>&nbsp;<span class="ident" id="3100216">width</span>&nbsp;<span class="builtintype" id="3100222">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100229">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100252">if</span>&nbsp;<span class="ident" id="3100255">b</span>&nbsp;<span class="op" id="3100257">==</span>&nbsp;<span class="ident" id="3100260">nil</span>&nbsp;<span class="op" id="3100264">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100270">_</span><span class="op" id="3100271">,</span>&nbsp;<span class="ident" id="3100273">width</span>&nbsp;<span class="op" id="3100279">=</span>&nbsp;<span class="ident" id="3100281">utf8</span><span class="op" id="3100285">.</span><span class="ident" id="3100286">DecodeRuneInString</span><span class="op" id="3100304">(</span><span class="ident" id="3100305">s</span><span class="op" id="3100306">[</span><span class="ident" id="3100307">pos</span><span class="op" id="3100310">:</span><span class="ident" id="3100311">end</span><span class="op" id="3100314">]</span><span class="op" id="3100315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100320">}</span>&nbsp;<span class="keyword" id="3100322">else</span>&nbsp;<span class="op" id="3100327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100333">_</span><span class="op" id="3100334">,</span>&nbsp;<span class="ident" id="3100336">width</span>&nbsp;<span class="op" id="3100342">=</span>&nbsp;<span class="ident" id="3100344">utf8</span><span class="op" id="3100348">.</span><span class="ident" id="3100349">DecodeRune</span><span class="op" id="3100359">(</span><span class="ident" id="3100360">b</span><span class="op" id="3100361">[</span><span class="ident" id="3100362">pos</span><span class="op" id="3100365">:</span><span class="ident" id="3100366">end</span><span class="op" id="3100369">]</span><span class="op" id="3100370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100380">if</span>&nbsp;<span class="ident" id="3100383">width</span>&nbsp;<span class="op" id="3100389">&gt;</span>&nbsp;<span class="num" id="3100391">0</span>&nbsp;<span class="op" id="3100393">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100399">pos</span>&nbsp;<span class="op" id="3100403">+=</span>&nbsp;<span class="ident" id="3100406">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100415">}</span>&nbsp;<span class="keyword" id="3100417">else</span>&nbsp;<span class="op" id="3100422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100428">pos</span>&nbsp;<span class="op" id="3100432">=</span>&nbsp;<span class="ident" id="3100434">end</span>&nbsp;<span class="op" id="3100438">+</span>&nbsp;<span class="num" id="3100440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100449">}</span>&nbsp;<span class="keyword" id="3100451">else</span>&nbsp;<span class="op" id="3100456">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100461">pos</span>&nbsp;<span class="op" id="3100465">=</span>&nbsp;<span class="ident" id="3100467">matches</span><span class="op" id="3100474">[</span><span class="num" id="3100475">1</span><span class="op" id="3100476">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100484">prevMatchEnd</span>&nbsp;<span class="op" id="3100497">=</span>&nbsp;<span class="ident" id="3100499">matches</span><span class="op" id="3100506">[</span><span class="num" id="3100507">1</span><span class="op" id="3100508">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100513">if</span>&nbsp;<span class="ident" id="3100516">accept</span>&nbsp;<span class="op" id="3100523">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100528">deliver</span><span class="op" id="3100535">(</span><span class="ident" id="3100536">re</span><span class="op" id="3100538">.</span><span class="ident" id="3100539">pad</span><span class="op" id="3100542">(</span><span class="ident" id="3100543">matches</span><span class="op" id="3100550">)</span><span class="op" id="3100551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100556">i</span><span class="op" id="3100557">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100565">}</span><br>
<span class="lineno"></span><span class="op" id="3100567">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="3100570">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="3100665">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3100710">func</span>&nbsp;<span class="op" id="3100715">(</span><span class="ident" id="3100716">re</span>&nbsp;<span class="op" id="3100719">*</span><span class="ident" id="3100720">Regexp</span><span class="op" id="3100726">)</span>&nbsp;<span class="ident" id="3100728">Find</span><span class="op" id="3100732">(</span><span class="ident" id="3100733">b</span>&nbsp;<span class="op" id="3100735">[</span><span class="op" id="3100736">]</span><span class="builtintype" id="3100737">byte</span><span class="op" id="3100741">)</span>&nbsp;<span class="op" id="3100743">[</span><span class="op" id="3100744">]</span><span class="builtintype" id="3100745">byte</span>&nbsp;<span class="op" id="3100750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100753">a</span>&nbsp;<span class="op" id="3100755">:=</span>&nbsp;<span class="ident" id="3100758">re</span><span class="op" id="3100760">.</span><span class="ident" id="3100761">doExecute</span><span class="op" id="3100770">(</span><span class="ident" id="3100771">nil</span><span class="op" id="3100774">,</span>&nbsp;<span class="ident" id="3100776">b</span><span class="op" id="3100777">,</span>&nbsp;<span class="string" id="3100779">&#34;&#34;</span><span class="op" id="3100781">,</span>&nbsp;<span class="num" id="3100783">0</span><span class="op" id="3100784">,</span>&nbsp;<span class="num" id="3100786">2</span><span class="op" id="3100787">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100790">if</span>&nbsp;<span class="ident" id="3100793">a</span>&nbsp;<span class="op" id="3100795">==</span>&nbsp;<span class="ident" id="3100798">nil</span>&nbsp;<span class="op" id="3100802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100806">return</span>&nbsp;<span class="ident" id="3100813">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100821">return</span>&nbsp;<span class="ident" id="3100828">b</span><span class="op" id="3100829">[</span><span class="ident" id="3100830">a</span><span class="op" id="3100831">[</span><span class="num" id="3100832">0</span><span class="op" id="3100833">]</span><span class="op" id="3100834">:</span><span class="ident" id="3100835">a</span><span class="op" id="3100836">[</span><span class="num" id="3100837">1</span><span class="op" id="3100838">]</span><span class="op" id="3100839">]</span><br>
<span class="lineno"></span><span class="op" id="3100841">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="3100844">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3100922">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3101000">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="3101021">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="3101066">func</span>&nbsp;<span class="op" id="3101071">(</span><span class="ident" id="3101072">re</span>&nbsp;<span class="op" id="3101075">*</span><span class="ident" id="3101076">Regexp</span><span class="op" id="3101082">)</span>&nbsp;<span class="ident" id="3101084">FindIndex</span><span class="op" id="3101093">(</span><span class="ident" id="3101094">b</span>&nbsp;<span class="op" id="3101096">[</span><span class="op" id="3101097">]</span><span class="builtintype" id="3101098">byte</span><span class="op" id="3101102">)</span>&nbsp;<span class="op" id="3101104">(</span><span class="ident" id="3101105">loc</span>&nbsp;<span class="op" id="3101109">[</span><span class="op" id="3101110">]</span><span class="builtintype" id="3101111">int</span><span class="op" id="3101114">)</span>&nbsp;<span class="op" id="3101116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3101119">a</span>&nbsp;<span class="op" id="3101121">:=</span>&nbsp;<span class="ident" id="3101124">re</span><span class="op" id="3101126">.</span><span class="ident" id="3101127">doExecute</span><span class="op" id="3101136">(</span><span class="ident" id="3101137">nil</span><span class="op" id="3101140">,</span>&nbsp;<span class="ident" id="3101142">b</span><span class="op" id="3101143">,</span>&nbsp;<span class="string" id="3101145">&#34;&#34;</span><span class="op" id="3101147">,</span>&nbsp;<span class="num" id="3101149">0</span><span class="op" id="3101150">,</span>&nbsp;<span class="num" id="3101152">2</span><span class="op" id="3101153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101156">if</span>&nbsp;<span class="ident" id="3101159">a</span>&nbsp;<span class="op" id="3101161">==</span>&nbsp;<span class="ident" id="3101164">nil</span>&nbsp;<span class="op" id="3101168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101172">return</span>&nbsp;<span class="ident" id="3101179">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3101184">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101187">return</span>&nbsp;<span class="ident" id="3101194">a</span><span class="op" id="3101195">[</span><span class="num" id="3101196">0</span><span class="op" id="3101197">:</span><span class="num" id="3101198">2</span><span class="op" id="3101199">]</span><br>
<span class="lineno"></span><span class="op" id="3101201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3101204">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3101294">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="3101369">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="3101445">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3101517">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="3101558">func</span>&nbsp;<span class="op" id="3101563">(</span><span class="ident" id="3101564">re</span>&nbsp;<span class="op" id="3101567">*</span><span class="ident" id="3101568">Regexp</span><span class="op" id="3101574">)</span>&nbsp;<span class="ident" id="3101576">FindString</span><span class="op" id="3101586">(</span><span class="ident" id="3101587">s</span>&nbsp;<span class="builtintype" id="3101589">string</span><span class="op" id="3101595">)</span>&nbsp;<span class="builtintype" id="3101597">string</span>&nbsp;<span class="op" id="3101604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3101607">a</span>&nbsp;<span class="op" id="3101609">:=</span>&nbsp;<span class="ident" id="3101612">re</span><span class="op" id="3101614">.</span><span class="ident" id="3101615">doExecute</span><span class="op" id="3101624">(</span><span class="ident" id="3101625">nil</span><span class="op" id="3101628">,</span>&nbsp;<span class="ident" id="3101630">nil</span><span class="op" id="3101633">,</span>&nbsp;<span class="ident" id="3101635">s</span><span class="op" id="3101636">,</span>&nbsp;<span class="num" id="3101638">0</span><span class="op" id="3101639">,</span>&nbsp;<span class="num" id="3101641">2</span><span class="op" id="3101642">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101645">if</span>&nbsp;<span class="ident" id="3101648">a</span>&nbsp;<span class="op" id="3101650">==</span>&nbsp;<span class="ident" id="3101653">nil</span>&nbsp;<span class="op" id="3101657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101661">return</span>&nbsp;<span class="string" id="3101668">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3101672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101675">return</span>&nbsp;<span class="ident" id="3101682">s</span><span class="op" id="3101683">[</span><span class="ident" id="3101684">a</span><span class="op" id="3101685">[</span><span class="num" id="3101686">0</span><span class="op" id="3101687">]</span><span class="op" id="3101688">:</span><span class="ident" id="3101689">a</span><span class="op" id="3101690">[</span><span class="num" id="3101691">1</span><span class="op" id="3101692">]</span><span class="op" id="3101693">]</span><br>
<span class="lineno"></span><span class="op" id="3101695">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="3101698">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3101770">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="3101847">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="3101881">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="3101926">func</span>&nbsp;<span class="op" id="3101931">(</span><span class="ident" id="3101932">re</span>&nbsp;<span class="op" id="3101935">*</span><span class="ident" id="3101936">Regexp</span><span class="op" id="3101942">)</span>&nbsp;<span class="ident" id="3101944">FindStringIndex</span><span class="op" id="3101959">(</span><span class="ident" id="3101960">s</span>&nbsp;<span class="builtintype" id="3101962">string</span><span class="op" id="3101968">)</span>&nbsp;<span class="op" id="3101970">(</span><span class="ident" id="3101971">loc</span>&nbsp;<span class="op" id="3101975">[</span><span class="op" id="3101976">]</span><span class="builtintype" id="3101977">int</span><span class="op" id="3101980">)</span>&nbsp;<span class="op" id="3101982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3101985">a</span>&nbsp;<span class="op" id="3101987">:=</span>&nbsp;<span class="ident" id="3101990">re</span><span class="op" id="3101992">.</span><span class="ident" id="3101993">doExecute</span><span class="op" id="3102002">(</span><span class="ident" id="3102003">nil</span><span class="op" id="3102006">,</span>&nbsp;<span class="ident" id="3102008">nil</span><span class="op" id="3102011">,</span>&nbsp;<span class="ident" id="3102013">s</span><span class="op" id="3102014">,</span>&nbsp;<span class="num" id="3102016">0</span><span class="op" id="3102017">,</span>&nbsp;<span class="num" id="3102019">2</span><span class="op" id="3102020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102023">if</span>&nbsp;<span class="ident" id="3102026">a</span>&nbsp;<span class="op" id="3102028">==</span>&nbsp;<span class="ident" id="3102031">nil</span>&nbsp;<span class="op" id="3102035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102039">return</span>&nbsp;<span class="ident" id="3102046">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102051">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102054">return</span>&nbsp;<span class="ident" id="3102061">a</span><span class="op" id="3102062">[</span><span class="num" id="3102063">0</span><span class="op" id="3102064">:</span><span class="num" id="3102065">2</span><span class="op" id="3102066">]</span><br>
<span class="lineno"></span><span class="op" id="3102068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3102071">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3102143">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="3102221">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3102289">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="3102329">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3102374">func</span>&nbsp;<span class="op" id="3102379">(</span><span class="ident" id="3102380">re</span>&nbsp;<span class="op" id="3102383">*</span><span class="ident" id="3102384">Regexp</span><span class="op" id="3102390">)</span>&nbsp;<span class="ident" id="3102392">FindReaderIndex</span><span class="op" id="3102407">(</span><span class="ident" id="3102408">r</span>&nbsp;<span class="ident" id="3102410">io</span><span class="op" id="3102412">.</span><span class="ident" id="3102413">RuneReader</span><span class="op" id="3102423">)</span>&nbsp;<span class="op" id="3102425">(</span><span class="ident" id="3102426">loc</span>&nbsp;<span class="op" id="3102430">[</span><span class="op" id="3102431">]</span><span class="builtintype" id="3102432">int</span><span class="op" id="3102435">)</span>&nbsp;<span class="op" id="3102437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102440">a</span>&nbsp;<span class="op" id="3102442">:=</span>&nbsp;<span class="ident" id="3102445">re</span><span class="op" id="3102447">.</span><span class="ident" id="3102448">doExecute</span><span class="op" id="3102457">(</span><span class="ident" id="3102458">r</span><span class="op" id="3102459">,</span>&nbsp;<span class="ident" id="3102461">nil</span><span class="op" id="3102464">,</span>&nbsp;<span class="string" id="3102466">&#34;&#34;</span><span class="op" id="3102468">,</span>&nbsp;<span class="num" id="3102470">0</span><span class="op" id="3102471">,</span>&nbsp;<span class="num" id="3102473">2</span><span class="op" id="3102474">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102477">if</span>&nbsp;<span class="ident" id="3102480">a</span>&nbsp;<span class="op" id="3102482">==</span>&nbsp;<span class="ident" id="3102485">nil</span>&nbsp;<span class="op" id="3102489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102493">return</span>&nbsp;<span class="ident" id="3102500">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102508">return</span>&nbsp;<span class="ident" id="3102515">a</span><span class="op" id="3102516">[</span><span class="num" id="3102517">0</span><span class="op" id="3102518">:</span><span class="num" id="3102519">2</span><span class="op" id="3102520">]</span><br>
<span class="lineno"></span><span class="op" id="3102522">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="3102525">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="3102600">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3102672">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3102748">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="3102760">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3102805">func</span>&nbsp;<span class="op" id="3102810">(</span><span class="ident" id="3102811">re</span>&nbsp;<span class="op" id="3102814">*</span><span class="ident" id="3102815">Regexp</span><span class="op" id="3102821">)</span>&nbsp;<span class="ident" id="3102823">FindSubmatch</span><span class="op" id="3102835">(</span><span class="ident" id="3102836">b</span>&nbsp;<span class="op" id="3102838">[</span><span class="op" id="3102839">]</span><span class="builtintype" id="3102840">byte</span><span class="op" id="3102844">)</span>&nbsp;<span class="op" id="3102846">[</span><span class="op" id="3102847">]</span><span class="op" id="3102848">[</span><span class="op" id="3102849">]</span><span class="builtintype" id="3102850">byte</span>&nbsp;<span class="op" id="3102855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102858">a</span>&nbsp;<span class="op" id="3102860">:=</span>&nbsp;<span class="ident" id="3102863">re</span><span class="op" id="3102865">.</span><span class="ident" id="3102866">doExecute</span><span class="op" id="3102875">(</span><span class="ident" id="3102876">nil</span><span class="op" id="3102879">,</span>&nbsp;<span class="ident" id="3102881">b</span><span class="op" id="3102882">,</span>&nbsp;<span class="string" id="3102884">&#34;&#34;</span><span class="op" id="3102886">,</span>&nbsp;<span class="num" id="3102888">0</span><span class="op" id="3102889">,</span>&nbsp;<span class="ident" id="3102891">re</span><span class="op" id="3102893">.</span><span class="ident" id="3102894">prog</span><span class="op" id="3102898">.</span><span class="ident" id="3102899">NumCap</span><span class="op" id="3102905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102908">if</span>&nbsp;<span class="ident" id="3102911">a</span>&nbsp;<span class="op" id="3102913">==</span>&nbsp;<span class="ident" id="3102916">nil</span>&nbsp;<span class="op" id="3102920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102924">return</span>&nbsp;<span class="ident" id="3102931">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102939">ret</span>&nbsp;<span class="op" id="3102943">:=</span>&nbsp;<span class="builtinfunc" id="3102946">make</span><span class="op" id="3102950">(</span><span class="op" id="3102951">[</span><span class="op" id="3102952">]</span><span class="op" id="3102953">[</span><span class="op" id="3102954">]</span><span class="builtintype" id="3102955">byte</span><span class="op" id="3102959">,</span>&nbsp;<span class="num" id="3102961">1</span><span class="op" id="3102962">+</span><span class="ident" id="3102963">re</span><span class="op" id="3102965">.</span><span class="ident" id="3102966">numSubexp</span><span class="op" id="3102975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102978">for</span>&nbsp;<span class="ident" id="3102982">i</span>&nbsp;<span class="op" id="3102984">:=</span>&nbsp;<span class="keyword" id="3102987">range</span>&nbsp;<span class="ident" id="3102993">ret</span>&nbsp;<span class="op" id="3102997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103001">if</span>&nbsp;<span class="num" id="3103004">2</span><span class="op" id="3103005">*</span><span class="ident" id="3103006">i</span>&nbsp;<span class="op" id="3103008">&lt;</span>&nbsp;<span class="builtinfunc" id="3103010">len</span><span class="op" id="3103013">(</span><span class="ident" id="3103014">a</span><span class="op" id="3103015">)</span>&nbsp;<span class="op" id="3103017">&amp;&amp;</span>&nbsp;<span class="ident" id="3103020">a</span><span class="op" id="3103021">[</span><span class="num" id="3103022">2</span><span class="op" id="3103023">*</span><span class="ident" id="3103024">i</span><span class="op" id="3103025">]</span>&nbsp;<span class="op" id="3103027">&gt;=</span>&nbsp;<span class="num" id="3103030">0</span>&nbsp;<span class="op" id="3103032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103037">ret</span><span class="op" id="3103040">[</span><span class="ident" id="3103041">i</span><span class="op" id="3103042">]</span>&nbsp;<span class="op" id="3103044">=</span>&nbsp;<span class="ident" id="3103046">b</span><span class="op" id="3103047">[</span><span class="ident" id="3103048">a</span><span class="op" id="3103049">[</span><span class="num" id="3103050">2</span><span class="op" id="3103051">*</span><span class="ident" id="3103052">i</span><span class="op" id="3103053">]</span><span class="op" id="3103054">:</span><span class="ident" id="3103055">a</span><span class="op" id="3103056">[</span><span class="num" id="3103057">2</span><span class="op" id="3103058">*</span><span class="ident" id="3103059">i</span><span class="op" id="3103060">+</span><span class="num" id="3103061">1</span><span class="op" id="3103062">]</span><span class="op" id="3103063">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103073">return</span>&nbsp;<span class="ident" id="3103080">ret</span><br>
<span class="lineno"></span><span class="op" id="3103084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="3103087">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3103156">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3103228">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3103301">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="3103323">//</span><br>
<span class="lineno">745</span><span class="comment" id="3103326">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3103395">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="3103463">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3103532">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3103599">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="3103664">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3103737">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="3103807">//</span><br>
<span class="lineno"></span><span class="comment" id="3103810">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3103880">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="3103959">//</span><br>
<span class="lineno"></span><span class="comment" id="3103962">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3104026">func</span>&nbsp;<span class="op" id="3104031">(</span><span class="ident" id="3104032">re</span>&nbsp;<span class="op" id="3104035">*</span><span class="ident" id="3104036">Regexp</span><span class="op" id="3104042">)</span>&nbsp;<span class="ident" id="3104044">Expand</span><span class="op" id="3104050">(</span><span class="ident" id="3104051">dst</span>&nbsp;<span class="op" id="3104055">[</span><span class="op" id="3104056">]</span><span class="builtintype" id="3104057">byte</span><span class="op" id="3104061">,</span>&nbsp;<span class="ident" id="3104063">template</span>&nbsp;<span class="op" id="3104072">[</span><span class="op" id="3104073">]</span><span class="builtintype" id="3104074">byte</span><span class="op" id="3104078">,</span>&nbsp;<span class="ident" id="3104080">src</span>&nbsp;<span class="op" id="3104084">[</span><span class="op" id="3104085">]</span><span class="builtintype" id="3104086">byte</span><span class="op" id="3104090">,</span>&nbsp;<span class="ident" id="3104092">match</span>&nbsp;<span class="op" id="3104098">[</span><span class="op" id="3104099">]</span><span class="builtintype" id="3104100">int</span><span class="op" id="3104103">)</span>&nbsp;<span class="op" id="3104105">[</span><span class="op" id="3104106">]</span><span class="builtintype" id="3104107">byte</span>&nbsp;<span class="op" id="3104112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104115">return</span>&nbsp;<span class="ident" id="3104122">re</span><span class="op" id="3104124">.</span><span class="ident" id="3104125">expand</span><span class="op" id="3104131">(</span><span class="ident" id="3104132">dst</span><span class="op" id="3104135">,</span>&nbsp;<span class="builtintype" id="3104137">string</span><span class="op" id="3104143">(</span><span class="ident" id="3104144">template</span><span class="op" id="3104152">)</span><span class="op" id="3104153">,</span>&nbsp;<span class="ident" id="3104155">src</span><span class="op" id="3104158">,</span>&nbsp;<span class="string" id="3104160">&#34;&#34;</span><span class="op" id="3104162">,</span>&nbsp;<span class="ident" id="3104164">match</span><span class="op" id="3104169">)</span><br>
<span class="lineno"></span><span class="op" id="3104171">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="3104174">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="3104246">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="3104317">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3104350">func</span>&nbsp;<span class="op" id="3104355">(</span><span class="ident" id="3104356">re</span>&nbsp;<span class="op" id="3104359">*</span><span class="ident" id="3104360">Regexp</span><span class="op" id="3104366">)</span>&nbsp;<span class="ident" id="3104368">ExpandString</span><span class="op" id="3104380">(</span><span class="ident" id="3104381">dst</span>&nbsp;<span class="op" id="3104385">[</span><span class="op" id="3104386">]</span><span class="builtintype" id="3104387">byte</span><span class="op" id="3104391">,</span>&nbsp;<span class="ident" id="3104393">template</span>&nbsp;<span class="builtintype" id="3104402">string</span><span class="op" id="3104408">,</span>&nbsp;<span class="ident" id="3104410">src</span>&nbsp;<span class="builtintype" id="3104414">string</span><span class="op" id="3104420">,</span>&nbsp;<span class="ident" id="3104422">match</span>&nbsp;<span class="op" id="3104428">[</span><span class="op" id="3104429">]</span><span class="builtintype" id="3104430">int</span><span class="op" id="3104433">)</span>&nbsp;<span class="op" id="3104435">[</span><span class="op" id="3104436">]</span><span class="builtintype" id="3104437">byte</span>&nbsp;<span class="op" id="3104442">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104445">return</span>&nbsp;<span class="ident" id="3104452">re</span><span class="op" id="3104454">.</span><span class="ident" id="3104455">expand</span><span class="op" id="3104461">(</span><span class="ident" id="3104462">dst</span><span class="op" id="3104465">,</span>&nbsp;<span class="ident" id="3104467">template</span><span class="op" id="3104475">,</span>&nbsp;<span class="ident" id="3104477">nil</span><span class="op" id="3104480">,</span>&nbsp;<span class="ident" id="3104482">src</span><span class="op" id="3104485">,</span>&nbsp;<span class="ident" id="3104487">match</span><span class="op" id="3104492">)</span><br>
<span class="lineno"></span><span class="op" id="3104494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3104497">func</span>&nbsp;<span class="op" id="3104502">(</span><span class="ident" id="3104503">re</span>&nbsp;<span class="op" id="3104506">*</span><span class="ident" id="3104507">Regexp</span><span class="op" id="3104513">)</span>&nbsp;<span class="ident" id="3104515">expand</span><span class="op" id="3104521">(</span><span class="ident" id="3104522">dst</span>&nbsp;<span class="op" id="3104526">[</span><span class="op" id="3104527">]</span><span class="builtintype" id="3104528">byte</span><span class="op" id="3104532">,</span>&nbsp;<span class="ident" id="3104534">template</span>&nbsp;<span class="builtintype" id="3104543">string</span><span class="op" id="3104549">,</span>&nbsp;<span class="ident" id="3104551">bsrc</span>&nbsp;<span class="op" id="3104556">[</span><span class="op" id="3104557">]</span><span class="builtintype" id="3104558">byte</span><span class="op" id="3104562">,</span>&nbsp;<span class="ident" id="3104564">src</span>&nbsp;<span class="builtintype" id="3104568">string</span><span class="op" id="3104574">,</span>&nbsp;<span class="ident" id="3104576">match</span>&nbsp;<span class="op" id="3104582">[</span><span class="op" id="3104583">]</span><span class="builtintype" id="3104584">int</span><span class="op" id="3104587">)</span>&nbsp;<span class="op" id="3104589">[</span><span class="op" id="3104590">]</span><span class="builtintype" id="3104591">byte</span>&nbsp;<span class="op" id="3104596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104599">for</span>&nbsp;<span class="builtinfunc" id="3104603">len</span><span class="op" id="3104606">(</span><span class="ident" id="3104607">template</span><span class="op" id="3104615">)</span>&nbsp;<span class="op" id="3104617">&gt;</span>&nbsp;<span class="num" id="3104619">0</span>&nbsp;<span class="op" id="3104621">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104625">i</span>&nbsp;<span class="op" id="3104627">:=</span>&nbsp;<span class="ident" id="3104630">strings</span><span class="op" id="3104637">.</span><span class="ident" id="3104638">Index</span><span class="op" id="3104643">(</span><span class="ident" id="3104644">template</span><span class="op" id="3104652">,</span>&nbsp;<span class="string" id="3104654">&#34;$&#34;</span><span class="op" id="3104657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104661">if</span>&nbsp;<span class="ident" id="3104664">i</span>&nbsp;<span class="op" id="3104666">&lt;</span>&nbsp;<span class="num" id="3104668">0</span>&nbsp;<span class="op" id="3104670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104675">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104687">dst</span>&nbsp;<span class="op" id="3104691">=</span>&nbsp;<span class="builtinfunc" id="3104693">append</span><span class="op" id="3104699">(</span><span class="ident" id="3104700">dst</span><span class="op" id="3104703">,</span>&nbsp;<span class="ident" id="3104705">template</span><span class="op" id="3104713">[</span><span class="op" id="3104714">:</span><span class="ident" id="3104715">i</span><span class="op" id="3104716">]</span><span class="op" id="3104717">...</span><span class="op" id="3104720">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104724">template</span>&nbsp;<span class="op" id="3104733">=</span>&nbsp;<span class="ident" id="3104735">template</span><span class="op" id="3104743">[</span><span class="ident" id="3104744">i</span><span class="op" id="3104745">:</span><span class="op" id="3104746">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104750">if</span>&nbsp;<span class="builtinfunc" id="3104753">len</span><span class="op" id="3104756">(</span><span class="ident" id="3104757">template</span><span class="op" id="3104765">)</span>&nbsp;<span class="op" id="3104767">&gt;</span>&nbsp;<span class="num" id="3104769">1</span>&nbsp;<span class="op" id="3104771">&amp;&amp;</span>&nbsp;<span class="ident" id="3104774">template</span><span class="op" id="3104782">[</span><span class="num" id="3104783">1</span><span class="op" id="3104784">]</span>&nbsp;<span class="op" id="3104786">==</span>&nbsp;<span class="string" id="3104789">&#39;$&#39;</span>&nbsp;<span class="op" id="3104793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3104798">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104819">dst</span>&nbsp;<span class="op" id="3104823">=</span>&nbsp;<span class="builtinfunc" id="3104825">append</span><span class="op" id="3104831">(</span><span class="ident" id="3104832">dst</span><span class="op" id="3104835">,</span>&nbsp;<span class="string" id="3104837">&#39;$&#39;</span><span class="op" id="3104840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104845">template</span>&nbsp;<span class="op" id="3104854">=</span>&nbsp;<span class="ident" id="3104856">template</span><span class="op" id="3104864">[</span><span class="num" id="3104865">2</span><span class="op" id="3104866">:</span><span class="op" id="3104867">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104872">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104887">name</span><span class="op" id="3104891">,</span>&nbsp;<span class="ident" id="3104893">num</span><span class="op" id="3104896">,</span>&nbsp;<span class="ident" id="3104898">rest</span><span class="op" id="3104902">,</span>&nbsp;<span class="ident" id="3104904">ok</span>&nbsp;<span class="op" id="3104907">:=</span>&nbsp;<span class="ident" id="3104910">extract</span><span class="op" id="3104917">(</span><span class="ident" id="3104918">template</span><span class="op" id="3104926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104930">if</span>&nbsp;<span class="op" id="3104933">!</span><span class="ident" id="3104934">ok</span>&nbsp;<span class="op" id="3104937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3104942">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104980">dst</span>&nbsp;<span class="op" id="3104984">=</span>&nbsp;<span class="builtinfunc" id="3104986">append</span><span class="op" id="3104992">(</span><span class="ident" id="3104993">dst</span><span class="op" id="3104996">,</span>&nbsp;<span class="string" id="3104998">&#39;$&#39;</span><span class="op" id="3105001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105006">template</span>&nbsp;<span class="op" id="3105015">=</span>&nbsp;<span class="ident" id="3105017">template</span><span class="op" id="3105025">[</span><span class="num" id="3105026">1</span><span class="op" id="3105027">:</span><span class="op" id="3105028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105048">template</span>&nbsp;<span class="op" id="3105057">=</span>&nbsp;<span class="ident" id="3105059">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105066">if</span>&nbsp;<span class="ident" id="3105069">num</span>&nbsp;<span class="op" id="3105073">&gt;=</span>&nbsp;<span class="num" id="3105076">0</span>&nbsp;<span class="op" id="3105078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105083">if</span>&nbsp;<span class="num" id="3105086">2</span><span class="op" id="3105087">*</span><span class="ident" id="3105088">num</span><span class="op" id="3105091">+</span><span class="num" id="3105092">1</span>&nbsp;<span class="op" id="3105094">&lt;</span>&nbsp;<span class="builtinfunc" id="3105096">len</span><span class="op" id="3105099">(</span><span class="ident" id="3105100">match</span><span class="op" id="3105105">)</span>&nbsp;<span class="op" id="3105107">&amp;&amp;</span>&nbsp;<span class="ident" id="3105110">match</span><span class="op" id="3105115">[</span><span class="num" id="3105116">2</span><span class="op" id="3105117">*</span><span class="ident" id="3105118">num</span><span class="op" id="3105121">]</span>&nbsp;<span class="op" id="3105123">&gt;=</span>&nbsp;<span class="num" id="3105126">0</span>&nbsp;<span class="op" id="3105128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105134">if</span>&nbsp;<span class="ident" id="3105137">bsrc</span>&nbsp;<span class="op" id="3105142">!=</span>&nbsp;<span class="ident" id="3105145">nil</span>&nbsp;<span class="op" id="3105149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105156">dst</span>&nbsp;<span class="op" id="3105160">=</span>&nbsp;<span class="builtinfunc" id="3105162">append</span><span class="op" id="3105168">(</span><span class="ident" id="3105169">dst</span><span class="op" id="3105172">,</span>&nbsp;<span class="ident" id="3105174">bsrc</span><span class="op" id="3105178">[</span><span class="ident" id="3105179">match</span><span class="op" id="3105184">[</span><span class="num" id="3105185">2</span><span class="op" id="3105186">*</span><span class="ident" id="3105187">num</span><span class="op" id="3105190">]</span><span class="op" id="3105191">:</span><span class="ident" id="3105192">match</span><span class="op" id="3105197">[</span><span class="num" id="3105198">2</span><span class="op" id="3105199">*</span><span class="ident" id="3105200">num</span><span class="op" id="3105203">+</span><span class="num" id="3105204">1</span><span class="op" id="3105205">]</span><span class="op" id="3105206">]</span><span class="op" id="3105207">...</span><span class="op" id="3105210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105216">}</span>&nbsp;<span class="keyword" id="3105218">else</span>&nbsp;<span class="op" id="3105223">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105230">dst</span>&nbsp;<span class="op" id="3105234">=</span>&nbsp;<span class="builtinfunc" id="3105236">append</span><span class="op" id="3105242">(</span><span class="ident" id="3105243">dst</span><span class="op" id="3105246">,</span>&nbsp;<span class="ident" id="3105248">src</span><span class="op" id="3105251">[</span><span class="ident" id="3105252">match</span><span class="op" id="3105257">[</span><span class="num" id="3105258">2</span><span class="op" id="3105259">*</span><span class="ident" id="3105260">num</span><span class="op" id="3105263">]</span><span class="op" id="3105264">:</span><span class="ident" id="3105265">match</span><span class="op" id="3105270">[</span><span class="num" id="3105271">2</span><span class="op" id="3105272">*</span><span class="ident" id="3105273">num</span><span class="op" id="3105276">+</span><span class="num" id="3105277">1</span><span class="op" id="3105278">]</span><span class="op" id="3105279">]</span><span class="op" id="3105280">...</span><span class="op" id="3105283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105298">}</span>&nbsp;<span class="keyword" id="3105300">else</span>&nbsp;<span class="op" id="3105305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105310">for</span>&nbsp;<span class="ident" id="3105314">i</span><span class="op" id="3105315">,</span>&nbsp;<span class="ident" id="3105317">namei</span>&nbsp;<span class="op" id="3105323">:=</span>&nbsp;<span class="keyword" id="3105326">range</span>&nbsp;<span class="ident" id="3105332">re</span><span class="op" id="3105334">.</span><span class="ident" id="3105335">subexpNames</span>&nbsp;<span class="op" id="3105347">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105353">if</span>&nbsp;<span class="ident" id="3105356">name</span>&nbsp;<span class="op" id="3105361">==</span>&nbsp;<span class="ident" id="3105364">namei</span>&nbsp;<span class="op" id="3105370">&amp;&amp;</span>&nbsp;<span class="num" id="3105373">2</span><span class="op" id="3105374">*</span><span class="ident" id="3105375">i</span><span class="op" id="3105376">+</span><span class="num" id="3105377">1</span>&nbsp;<span class="op" id="3105379">&lt;</span>&nbsp;<span class="builtinfunc" id="3105381">len</span><span class="op" id="3105384">(</span><span class="ident" id="3105385">match</span><span class="op" id="3105390">)</span>&nbsp;<span class="op" id="3105392">&amp;&amp;</span>&nbsp;<span class="ident" id="3105395">match</span><span class="op" id="3105400">[</span><span class="num" id="3105401">2</span><span class="op" id="3105402">*</span><span class="ident" id="3105403">i</span><span class="op" id="3105404">]</span>&nbsp;<span class="op" id="3105406">&gt;=</span>&nbsp;<span class="num" id="3105409">0</span>&nbsp;<span class="op" id="3105411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105418">if</span>&nbsp;<span class="ident" id="3105421">bsrc</span>&nbsp;<span class="op" id="3105426">!=</span>&nbsp;<span class="ident" id="3105429">nil</span>&nbsp;<span class="op" id="3105433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105441">dst</span>&nbsp;<span class="op" id="3105445">=</span>&nbsp;<span class="builtinfunc" id="3105447">append</span><span class="op" id="3105453">(</span><span class="ident" id="3105454">dst</span><span class="op" id="3105457">,</span>&nbsp;<span class="ident" id="3105459">bsrc</span><span class="op" id="3105463">[</span><span class="ident" id="3105464">match</span><span class="op" id="3105469">[</span><span class="num" id="3105470">2</span><span class="op" id="3105471">*</span><span class="ident" id="3105472">i</span><span class="op" id="3105473">]</span><span class="op" id="3105474">:</span><span class="ident" id="3105475">match</span><span class="op" id="3105480">[</span><span class="num" id="3105481">2</span><span class="op" id="3105482">*</span><span class="ident" id="3105483">i</span><span class="op" id="3105484">+</span><span class="num" id="3105485">1</span><span class="op" id="3105486">]</span><span class="op" id="3105487">]</span><span class="op" id="3105488">...</span><span class="op" id="3105491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105498">}</span>&nbsp;<span class="keyword" id="3105500">else</span>&nbsp;<span class="op" id="3105505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105513">dst</span>&nbsp;<span class="op" id="3105517">=</span>&nbsp;<span class="builtinfunc" id="3105519">append</span><span class="op" id="3105525">(</span><span class="ident" id="3105526">dst</span><span class="op" id="3105529">,</span>&nbsp;<span class="ident" id="3105531">src</span><span class="op" id="3105534">[</span><span class="ident" id="3105535">match</span><span class="op" id="3105540">[</span><span class="num" id="3105541">2</span><span class="op" id="3105542">*</span><span class="ident" id="3105543">i</span><span class="op" id="3105544">]</span><span class="op" id="3105545">:</span><span class="ident" id="3105546">match</span><span class="op" id="3105551">[</span><span class="num" id="3105552">2</span><span class="op" id="3105553">*</span><span class="ident" id="3105554">i</span><span class="op" id="3105555">+</span><span class="num" id="3105556">1</span><span class="op" id="3105557">]</span><span class="op" id="3105558">]</span><span class="op" id="3105559">...</span><span class="op" id="3105562">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105576">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105595">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105601">dst</span>&nbsp;<span class="op" id="3105605">=</span>&nbsp;<span class="builtinfunc" id="3105607">append</span><span class="op" id="3105613">(</span><span class="ident" id="3105614">dst</span><span class="op" id="3105617">,</span>&nbsp;<span class="ident" id="3105619">template</span><span class="op" id="3105627">...</span><span class="op" id="3105630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105633">return</span>&nbsp;<span class="ident" id="3105640">dst</span><br>
<span class="lineno"></span><span class="op" id="3105644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="3105647">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="3105719">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="3105801">func</span>&nbsp;<span class="ident" id="3105806">extract</span><span class="op" id="3105813">(</span><span class="ident" id="3105814">str</span>&nbsp;<span class="builtintype" id="3105818">string</span><span class="op" id="3105824">)</span>&nbsp;<span class="op" id="3105826">(</span><span class="ident" id="3105827">name</span>&nbsp;<span class="builtintype" id="3105832">string</span><span class="op" id="3105838">,</span>&nbsp;<span class="ident" id="3105840">num</span>&nbsp;<span class="builtintype" id="3105844">int</span><span class="op" id="3105847">,</span>&nbsp;<span class="ident" id="3105849">rest</span>&nbsp;<span class="builtintype" id="3105854">string</span><span class="op" id="3105860">,</span>&nbsp;<span class="ident" id="3105862">ok</span>&nbsp;<span class="builtintype" id="3105865">bool</span><span class="op" id="3105869">)</span>&nbsp;<span class="op" id="3105871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105874">if</span>&nbsp;<span class="builtinfunc" id="3105877">len</span><span class="op" id="3105880">(</span><span class="ident" id="3105881">str</span><span class="op" id="3105884">)</span>&nbsp;<span class="op" id="3105886">&lt;</span>&nbsp;<span class="num" id="3105888">2</span>&nbsp;<span class="op" id="3105890">||</span>&nbsp;<span class="ident" id="3105893">str</span><span class="op" id="3105896">[</span><span class="num" id="3105897">0</span><span class="op" id="3105898">]</span>&nbsp;<span class="op" id="3105900">!=</span>&nbsp;<span class="string" id="3105903">&#39;$&#39;</span>&nbsp;<span class="op" id="3105907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105911">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105922">brace</span>&nbsp;<span class="op" id="3105928">:=</span>&nbsp;<span class="builtintype" id="3105931">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3105938">if</span>&nbsp;<span class="ident" id="3105941">str</span><span class="op" id="3105944">[</span><span class="num" id="3105945">1</span><span class="op" id="3105946">]</span>&nbsp;<span class="op" id="3105948">==</span>&nbsp;<span class="string" id="3105951">&#39;{&#39;</span>&nbsp;<span class="op" id="3105955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105959">brace</span>&nbsp;<span class="op" id="3105965">=</span>&nbsp;<span class="builtintype" id="3105967">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105974">str</span>&nbsp;<span class="op" id="3105978">=</span>&nbsp;<span class="ident" id="3105980">str</span><span class="op" id="3105983">[</span><span class="num" id="3105984">2</span><span class="op" id="3105985">:</span><span class="op" id="3105986">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3105989">}</span>&nbsp;<span class="keyword" id="3105991">else</span>&nbsp;<span class="op" id="3105996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106000">str</span>&nbsp;<span class="op" id="3106004">=</span>&nbsp;<span class="ident" id="3106006">str</span><span class="op" id="3106009">[</span><span class="num" id="3106010">1</span><span class="op" id="3106011">:</span><span class="op" id="3106012">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106018">i</span>&nbsp;<span class="op" id="3106020">:=</span>&nbsp;<span class="num" id="3106023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106026">for</span>&nbsp;<span class="ident" id="3106030">i</span>&nbsp;<span class="op" id="3106032">&lt;</span>&nbsp;<span class="builtinfunc" id="3106034">len</span><span class="op" id="3106037">(</span><span class="ident" id="3106038">str</span><span class="op" id="3106041">)</span>&nbsp;<span class="op" id="3106043">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3106047">rune</span><span class="op" id="3106051">,</span>&nbsp;<span class="ident" id="3106053">size</span>&nbsp;<span class="op" id="3106058">:=</span>&nbsp;<span class="ident" id="3106061">utf8</span><span class="op" id="3106065">.</span><span class="ident" id="3106066">DecodeRuneInString</span><span class="op" id="3106084">(</span><span class="ident" id="3106085">str</span><span class="op" id="3106088">[</span><span class="ident" id="3106089">i</span><span class="op" id="3106090">:</span><span class="op" id="3106091">]</span><span class="op" id="3106092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106096">if</span>&nbsp;<span class="op" id="3106099">!</span><span class="ident" id="3106100">unicode</span><span class="op" id="3106107">.</span><span class="ident" id="3106108">IsLetter</span><span class="op" id="3106116">(</span><span class="builtintype" id="3106117">rune</span><span class="op" id="3106121">)</span>&nbsp;<span class="op" id="3106123">&amp;&amp;</span>&nbsp;<span class="op" id="3106126">!</span><span class="ident" id="3106127">unicode</span><span class="op" id="3106134">.</span><span class="ident" id="3106135">IsDigit</span><span class="op" id="3106142">(</span><span class="builtintype" id="3106143">rune</span><span class="op" id="3106147">)</span>&nbsp;<span class="op" id="3106149">&amp;&amp;</span>&nbsp;<span class="builtintype" id="3106152">rune</span>&nbsp;<span class="op" id="3106157">!=</span>&nbsp;<span class="string" id="3106160">&#39;_&#39;</span>&nbsp;<span class="op" id="3106164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106169">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106181">i</span>&nbsp;<span class="op" id="3106183">+=</span>&nbsp;<span class="ident" id="3106186">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106195">if</span>&nbsp;<span class="ident" id="3106198">i</span>&nbsp;<span class="op" id="3106200">==</span>&nbsp;<span class="num" id="3106203">0</span>&nbsp;<span class="op" id="3106205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106209">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106237">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106245">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106248">name</span>&nbsp;<span class="op" id="3106253">=</span>&nbsp;<span class="ident" id="3106255">str</span><span class="op" id="3106258">[</span><span class="op" id="3106259">:</span><span class="ident" id="3106260">i</span><span class="op" id="3106261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106264">if</span>&nbsp;<span class="ident" id="3106267">brace</span>&nbsp;<span class="op" id="3106273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106277">if</span>&nbsp;<span class="ident" id="3106280">i</span>&nbsp;<span class="op" id="3106282">&gt;=</span>&nbsp;<span class="builtinfunc" id="3106285">len</span><span class="op" id="3106288">(</span><span class="ident" id="3106289">str</span><span class="op" id="3106292">)</span>&nbsp;<span class="op" id="3106294">||</span>&nbsp;<span class="ident" id="3106297">str</span><span class="op" id="3106300">[</span><span class="ident" id="3106301">i</span><span class="op" id="3106302">]</span>&nbsp;<span class="op" id="3106304">!=</span>&nbsp;<span class="string" id="3106307">&#39;}&#39;</span>&nbsp;<span class="op" id="3106311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106316">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106344">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106357">i</span><span class="op" id="3106358">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106366">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106384">num</span>&nbsp;<span class="op" id="3106388">=</span>&nbsp;<span class="num" id="3106390">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106393">for</span>&nbsp;<span class="ident" id="3106397">i</span>&nbsp;<span class="op" id="3106399">:=</span>&nbsp;<span class="num" id="3106402">0</span><span class="op" id="3106403">;</span>&nbsp;<span class="ident" id="3106405">i</span>&nbsp;<span class="op" id="3106407">&lt;</span>&nbsp;<span class="builtinfunc" id="3106409">len</span><span class="op" id="3106412">(</span><span class="ident" id="3106413">name</span><span class="op" id="3106417">)</span><span class="op" id="3106418">;</span>&nbsp;<span class="ident" id="3106420">i</span><span class="op" id="3106421">++</span>&nbsp;<span class="op" id="3106424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106428">if</span>&nbsp;<span class="ident" id="3106431">name</span><span class="op" id="3106435">[</span><span class="ident" id="3106436">i</span><span class="op" id="3106437">]</span>&nbsp;<span class="op" id="3106439">&lt;</span>&nbsp;<span class="string" id="3106441">&#39;0&#39;</span>&nbsp;<span class="op" id="3106445">||</span>&nbsp;<span class="string" id="3106448">&#39;9&#39;</span>&nbsp;<span class="op" id="3106452">&lt;</span>&nbsp;<span class="ident" id="3106454">name</span><span class="op" id="3106458">[</span><span class="ident" id="3106459">i</span><span class="op" id="3106460">]</span>&nbsp;<span class="op" id="3106462">||</span>&nbsp;<span class="ident" id="3106465">num</span>&nbsp;<span class="op" id="3106469">&gt;=</span>&nbsp;<span class="num" id="3106472">1e8</span>&nbsp;<span class="op" id="3106476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106481">num</span>&nbsp;<span class="op" id="3106485">=</span>&nbsp;<span class="op" id="3106487">-</span><span class="num" id="3106488">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106493">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106505">num</span>&nbsp;<span class="op" id="3106509">=</span>&nbsp;<span class="ident" id="3106511">num</span><span class="op" id="3106514">*</span><span class="num" id="3106515">10</span>&nbsp;<span class="op" id="3106518">+</span>&nbsp;<span class="builtintype" id="3106520">int</span><span class="op" id="3106523">(</span><span class="ident" id="3106524">name</span><span class="op" id="3106528">[</span><span class="ident" id="3106529">i</span><span class="op" id="3106530">]</span><span class="op" id="3106531">)</span>&nbsp;<span class="op" id="3106533">-</span>&nbsp;<span class="string" id="3106535">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106543">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106571">if</span>&nbsp;<span class="ident" id="3106574">name</span><span class="op" id="3106578">[</span><span class="num" id="3106579">0</span><span class="op" id="3106580">]</span>&nbsp;<span class="op" id="3106582">==</span>&nbsp;<span class="string" id="3106585">&#39;0&#39;</span>&nbsp;<span class="op" id="3106589">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3106592">len</span><span class="op" id="3106595">(</span><span class="ident" id="3106596">name</span><span class="op" id="3106600">)</span>&nbsp;<span class="op" id="3106602">&gt;</span>&nbsp;<span class="num" id="3106604">1</span>&nbsp;<span class="op" id="3106606">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106610">num</span>&nbsp;<span class="op" id="3106614">=</span>&nbsp;<span class="op" id="3106616">-</span><span class="num" id="3106617">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106624">rest</span>&nbsp;<span class="op" id="3106629">=</span>&nbsp;<span class="ident" id="3106631">str</span><span class="op" id="3106634">[</span><span class="ident" id="3106635">i</span><span class="op" id="3106636">:</span><span class="op" id="3106637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106640">ok</span>&nbsp;<span class="op" id="3106643">=</span>&nbsp;<span class="builtintype" id="3106645">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106651">return</span><br>
<span class="lineno"></span><span class="op" id="3106658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3106661">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3106738">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="3106815">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="3106892">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3106919">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3106964">func</span>&nbsp;<span class="op" id="3106969">(</span><span class="ident" id="3106970">re</span>&nbsp;<span class="op" id="3106973">*</span><span class="ident" id="3106974">Regexp</span><span class="op" id="3106980">)</span>&nbsp;<span class="ident" id="3106982">FindSubmatchIndex</span><span class="op" id="3106999">(</span><span class="ident" id="3107000">b</span>&nbsp;<span class="op" id="3107002">[</span><span class="op" id="3107003">]</span><span class="builtintype" id="3107004">byte</span><span class="op" id="3107008">)</span>&nbsp;<span class="op" id="3107010">[</span><span class="op" id="3107011">]</span><span class="builtintype" id="3107012">int</span>&nbsp;<span class="op" id="3107016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107019">return</span>&nbsp;<span class="ident" id="3107026">re</span><span class="op" id="3107028">.</span><span class="ident" id="3107029">pad</span><span class="op" id="3107032">(</span><span class="ident" id="3107033">re</span><span class="op" id="3107035">.</span><span class="ident" id="3107036">doExecute</span><span class="op" id="3107045">(</span><span class="ident" id="3107046">nil</span><span class="op" id="3107049">,</span>&nbsp;<span class="ident" id="3107051">b</span><span class="op" id="3107052">,</span>&nbsp;<span class="string" id="3107054">&#34;&#34;</span><span class="op" id="3107056">,</span>&nbsp;<span class="num" id="3107058">0</span><span class="op" id="3107059">,</span>&nbsp;<span class="ident" id="3107061">re</span><span class="op" id="3107063">.</span><span class="ident" id="3107064">prog</span><span class="op" id="3107068">.</span><span class="ident" id="3107069">NumCap</span><span class="op" id="3107075">)</span><span class="op" id="3107076">)</span><br>
<span class="lineno">875</span><span class="op" id="3107078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3107081">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3107154">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3107231">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="3107302">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3107322">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3107367">func</span>&nbsp;<span class="op" id="3107372">(</span><span class="ident" id="3107373">re</span>&nbsp;<span class="op" id="3107376">*</span><span class="ident" id="3107377">Regexp</span><span class="op" id="3107383">)</span>&nbsp;<span class="ident" id="3107385">FindStringSubmatch</span><span class="op" id="3107403">(</span><span class="ident" id="3107404">s</span>&nbsp;<span class="builtintype" id="3107406">string</span><span class="op" id="3107412">)</span>&nbsp;<span class="op" id="3107414">[</span><span class="op" id="3107415">]</span><span class="builtintype" id="3107416">string</span>&nbsp;<span class="op" id="3107423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107426">a</span>&nbsp;<span class="op" id="3107428">:=</span>&nbsp;<span class="ident" id="3107431">re</span><span class="op" id="3107433">.</span><span class="ident" id="3107434">doExecute</span><span class="op" id="3107443">(</span><span class="ident" id="3107444">nil</span><span class="op" id="3107447">,</span>&nbsp;<span class="ident" id="3107449">nil</span><span class="op" id="3107452">,</span>&nbsp;<span class="ident" id="3107454">s</span><span class="op" id="3107455">,</span>&nbsp;<span class="num" id="3107457">0</span><span class="op" id="3107458">,</span>&nbsp;<span class="ident" id="3107460">re</span><span class="op" id="3107462">.</span><span class="ident" id="3107463">prog</span><span class="op" id="3107467">.</span><span class="ident" id="3107468">NumCap</span><span class="op" id="3107474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107477">if</span>&nbsp;<span class="ident" id="3107480">a</span>&nbsp;<span class="op" id="3107482">==</span>&nbsp;<span class="ident" id="3107485">nil</span>&nbsp;<span class="op" id="3107489">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107493">return</span>&nbsp;<span class="ident" id="3107500">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107508">ret</span>&nbsp;<span class="op" id="3107512">:=</span>&nbsp;<span class="builtinfunc" id="3107515">make</span><span class="op" id="3107519">(</span><span class="op" id="3107520">[</span><span class="op" id="3107521">]</span><span class="builtintype" id="3107522">string</span><span class="op" id="3107528">,</span>&nbsp;<span class="num" id="3107530">1</span><span class="op" id="3107531">+</span><span class="ident" id="3107532">re</span><span class="op" id="3107534">.</span><span class="ident" id="3107535">numSubexp</span><span class="op" id="3107544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107547">for</span>&nbsp;<span class="ident" id="3107551">i</span>&nbsp;<span class="op" id="3107553">:=</span>&nbsp;<span class="keyword" id="3107556">range</span>&nbsp;<span class="ident" id="3107562">ret</span>&nbsp;<span class="op" id="3107566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107570">if</span>&nbsp;<span class="num" id="3107573">2</span><span class="op" id="3107574">*</span><span class="ident" id="3107575">i</span>&nbsp;<span class="op" id="3107577">&lt;</span>&nbsp;<span class="builtinfunc" id="3107579">len</span><span class="op" id="3107582">(</span><span class="ident" id="3107583">a</span><span class="op" id="3107584">)</span>&nbsp;<span class="op" id="3107586">&amp;&amp;</span>&nbsp;<span class="ident" id="3107589">a</span><span class="op" id="3107590">[</span><span class="num" id="3107591">2</span><span class="op" id="3107592">*</span><span class="ident" id="3107593">i</span><span class="op" id="3107594">]</span>&nbsp;<span class="op" id="3107596">&gt;=</span>&nbsp;<span class="num" id="3107599">0</span>&nbsp;<span class="op" id="3107601">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107606">ret</span><span class="op" id="3107609">[</span><span class="ident" id="3107610">i</span><span class="op" id="3107611">]</span>&nbsp;<span class="op" id="3107613">=</span>&nbsp;<span class="ident" id="3107615">s</span><span class="op" id="3107616">[</span><span class="ident" id="3107617">a</span><span class="op" id="3107618">[</span><span class="num" id="3107619">2</span><span class="op" id="3107620">*</span><span class="ident" id="3107621">i</span><span class="op" id="3107622">]</span><span class="op" id="3107623">:</span><span class="ident" id="3107624">a</span><span class="op" id="3107625">[</span><span class="num" id="3107626">2</span><span class="op" id="3107627">*</span><span class="ident" id="3107628">i</span><span class="op" id="3107629">+</span><span class="num" id="3107630">1</span><span class="op" id="3107631">]</span><span class="op" id="3107632">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107642">return</span>&nbsp;<span class="ident" id="3107649">ret</span><br>
<span class="lineno"></span><span class="op" id="3107653">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="3107656">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3107723">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3107796">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3107872">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="3107920">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3107965">func</span>&nbsp;<span class="op" id="3107970">(</span><span class="ident" id="3107971">re</span>&nbsp;<span class="op" id="3107974">*</span><span class="ident" id="3107975">Regexp</span><span class="op" id="3107981">)</span>&nbsp;<span class="ident" id="3107983">FindStringSubmatchIndex</span><span class="op" id="3108006">(</span><span class="ident" id="3108007">s</span>&nbsp;<span class="builtintype" id="3108009">string</span><span class="op" id="3108015">)</span>&nbsp;<span class="op" id="3108017">[</span><span class="op" id="3108018">]</span><span class="builtintype" id="3108019">int</span>&nbsp;<span class="op" id="3108023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108026">return</span>&nbsp;<span class="ident" id="3108033">re</span><span class="op" id="3108035">.</span><span class="ident" id="3108036">pad</span><span class="op" id="3108039">(</span><span class="ident" id="3108040">re</span><span class="op" id="3108042">.</span><span class="ident" id="3108043">doExecute</span><span class="op" id="3108052">(</span><span class="ident" id="3108053">nil</span><span class="op" id="3108056">,</span>&nbsp;<span class="ident" id="3108058">nil</span><span class="op" id="3108061">,</span>&nbsp;<span class="ident" id="3108063">s</span><span class="op" id="3108064">,</span>&nbsp;<span class="num" id="3108066">0</span><span class="op" id="3108067">,</span>&nbsp;<span class="ident" id="3108069">re</span><span class="op" id="3108071">.</span><span class="ident" id="3108072">prog</span><span class="op" id="3108076">.</span><span class="ident" id="3108077">NumCap</span><span class="op" id="3108083">)</span><span class="op" id="3108084">)</span><br>
<span class="lineno"></span><span class="op" id="3108086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="3108089">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3108156">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3108232">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="3108310">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="3108383">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="3108426">func</span>&nbsp;<span class="op" id="3108431">(</span><span class="ident" id="3108432">re</span>&nbsp;<span class="op" id="3108435">*</span><span class="ident" id="3108436">Regexp</span><span class="op" id="3108442">)</span>&nbsp;<span class="ident" id="3108444">FindReaderSubmatchIndex</span><span class="op" id="3108467">(</span><span class="ident" id="3108468">r</span>&nbsp;<span class="ident" id="3108470">io</span><span class="op" id="3108472">.</span><span class="ident" id="3108473">RuneReader</span><span class="op" id="3108483">)</span>&nbsp;<span class="op" id="3108485">[</span><span class="op" id="3108486">]</span><span class="builtintype" id="3108487">int</span>&nbsp;<span class="op" id="3108491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108494">return</span>&nbsp;<span class="ident" id="3108501">re</span><span class="op" id="3108503">.</span><span class="ident" id="3108504">pad</span><span class="op" id="3108507">(</span><span class="ident" id="3108508">re</span><span class="op" id="3108510">.</span><span class="ident" id="3108511">doExecute</span><span class="op" id="3108520">(</span><span class="ident" id="3108521">r</span><span class="op" id="3108522">,</span>&nbsp;<span class="ident" id="3108524">nil</span><span class="op" id="3108527">,</span>&nbsp;<span class="string" id="3108529">&#34;&#34;</span><span class="op" id="3108531">,</span>&nbsp;<span class="num" id="3108533">0</span><span class="op" id="3108534">,</span>&nbsp;<span class="ident" id="3108536">re</span><span class="op" id="3108538">.</span><span class="ident" id="3108539">prog</span><span class="op" id="3108543">.</span><span class="ident" id="3108544">NumCap</span><span class="op" id="3108550">)</span><span class="op" id="3108551">)</span><br>
<span class="lineno"></span><span class="op" id="3108553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3108556">const</span>&nbsp;<span class="ident" id="3108562">startSize</span>&nbsp;<span class="op" id="3108572">=</span>&nbsp;<span class="num" id="3108574">10</span>&nbsp;<span class="comment" id="3108577">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="3108639">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="3108717">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3108790">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3108810">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="3108855">func</span>&nbsp;<span class="op" id="3108860">(</span><span class="ident" id="3108861">re</span>&nbsp;<span class="op" id="3108864">*</span><span class="ident" id="3108865">Regexp</span><span class="op" id="3108871">)</span>&nbsp;<span class="ident" id="3108873">FindAll</span><span class="op" id="3108880">(</span><span class="ident" id="3108881">b</span>&nbsp;<span class="op" id="3108883">[</span><span class="op" id="3108884">]</span><span class="builtintype" id="3108885">byte</span><span class="op" id="3108889">,</span>&nbsp;<span class="ident" id="3108891">n</span>&nbsp;<span class="builtintype" id="3108893">int</span><span class="op" id="3108896">)</span>&nbsp;<span class="op" id="3108898">[</span><span class="op" id="3108899">]</span><span class="op" id="3108900">[</span><span class="op" id="3108901">]</span><span class="builtintype" id="3108902">byte</span>&nbsp;<span class="op" id="3108907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108910">if</span>&nbsp;<span class="ident" id="3108913">n</span>&nbsp;<span class="op" id="3108915">&lt;</span>&nbsp;<span class="num" id="3108917">0</span>&nbsp;<span class="op" id="3108919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108923">n</span>&nbsp;<span class="op" id="3108925">=</span>&nbsp;<span class="builtinfunc" id="3108927">len</span><span class="op" id="3108930">(</span><span class="ident" id="3108931">b</span><span class="op" id="3108932">)</span>&nbsp;<span class="op" id="3108934">+</span>&nbsp;<span class="num" id="3108936">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108942">result</span>&nbsp;<span class="op" id="3108949">:=</span>&nbsp;<span class="builtinfunc" id="3108952">make</span><span class="op" id="3108956">(</span><span class="op" id="3108957">[</span><span class="op" id="3108958">]</span><span class="op" id="3108959">[</span><span class="op" id="3108960">]</span><span class="builtintype" id="3108961">byte</span><span class="op" id="3108965">,</span>&nbsp;<span class="num" id="3108967">0</span><span class="op" id="3108968">,</span>&nbsp;<span class="ident" id="3108970">startSize</span><span class="op" id="3108979">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108982">re</span><span class="op" id="3108984">.</span><span class="ident" id="3108985">allMatches</span><span class="op" id="3108995">(</span><span class="string" id="3108996">&#34;&#34;</span><span class="op" id="3108998">,</span>&nbsp;<span class="ident" id="3109000">b</span><span class="op" id="3109001">,</span>&nbsp;<span class="ident" id="3109003">n</span><span class="op" id="3109004">,</span>&nbsp;<span class="keyword" id="3109006">func</span><span class="op" id="3109010">(</span><span class="ident" id="3109011">match</span>&nbsp;<span class="op" id="3109017">[</span><span class="op" id="3109018">]</span><span class="builtintype" id="3109019">int</span><span class="op" id="3109022">)</span>&nbsp;<span class="op" id="3109024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109028">result</span>&nbsp;<span class="op" id="3109035">=</span>&nbsp;<span class="builtinfunc" id="3109037">append</span><span class="op" id="3109043">(</span><span class="ident" id="3109044">result</span><span class="op" id="3109050">,</span>&nbsp;<span class="ident" id="3109052">b</span><span class="op" id="3109053">[</span><span class="ident" id="3109054">match</span><span class="op" id="3109059">[</span><span class="num" id="3109060">0</span><span class="op" id="3109061">]</span><span class="op" id="3109062">:</span><span class="ident" id="3109063">match</span><span class="op" id="3109068">[</span><span class="num" id="3109069">1</span><span class="op" id="3109070">]</span><span class="op" id="3109071">]</span><span class="op" id="3109072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109075">}</span><span class="op" id="3109076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109079">if</span>&nbsp;<span class="builtinfunc" id="3109082">len</span><span class="op" id="3109085">(</span><span class="ident" id="3109086">result</span><span class="op" id="3109092">)</span>&nbsp;<span class="op" id="3109094">==</span>&nbsp;<span class="num" id="3109097">0</span>&nbsp;<span class="op" id="3109099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109103">return</span>&nbsp;<span class="ident" id="3109110">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109118">return</span>&nbsp;<span class="ident" id="3109125">result</span><br>
<span class="lineno"></span><span class="op" id="3109132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3109135">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="3109212">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="3109289">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3109316">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3109361">func</span>&nbsp;<span class="op" id="3109366">(</span><span class="ident" id="3109367">re</span>&nbsp;<span class="op" id="3109370">*</span><span class="ident" id="3109371">Regexp</span><span class="op" id="3109377">)</span>&nbsp;<span class="ident" id="3109379">FindAllIndex</span><span class="op" id="3109391">(</span><span class="ident" id="3109392">b</span>&nbsp;<span class="op" id="3109394">[</span><span class="op" id="3109395">]</span><span class="builtintype" id="3109396">byte</span><span class="op" id="3109400">,</span>&nbsp;<span class="ident" id="3109402">n</span>&nbsp;<span class="builtintype" id="3109404">int</span><span class="op" id="3109407">)</span>&nbsp;<span class="op" id="3109409">[</span><span class="op" id="3109410">]</span><span class="op" id="3109411">[</span><span class="op" id="3109412">]</span><span class="builtintype" id="3109413">int</span>&nbsp;<span class="op" id="3109417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109420">if</span>&nbsp;<span class="ident" id="3109423">n</span>&nbsp;<span class="op" id="3109425">&lt;</span>&nbsp;<span class="num" id="3109427">0</span>&nbsp;<span class="op" id="3109429">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109433">n</span>&nbsp;<span class="op" id="3109435">=</span>&nbsp;<span class="builtinfunc" id="3109437">len</span><span class="op" id="3109440">(</span><span class="ident" id="3109441">b</span><span class="op" id="3109442">)</span>&nbsp;<span class="op" id="3109444">+</span>&nbsp;<span class="num" id="3109446">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109452">result</span>&nbsp;<span class="op" id="3109459">:=</span>&nbsp;<span class="builtinfunc" id="3109462">make</span><span class="op" id="3109466">(</span><span class="op" id="3109467">[</span><span class="op" id="3109468">]</span><span class="op" id="3109469">[</span><span class="op" id="3109470">]</span><span class="builtintype" id="3109471">int</span><span class="op" id="3109474">,</span>&nbsp;<span class="num" id="3109476">0</span><span class="op" id="3109477">,</span>&nbsp;<span class="ident" id="3109479">startSize</span><span class="op" id="3109488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109491">re</span><span class="op" id="3109493">.</span><span class="ident" id="3109494">allMatches</span><span class="op" id="3109504">(</span><span class="string" id="3109505">&#34;&#34;</span><span class="op" id="3109507">,</span>&nbsp;<span class="ident" id="3109509">b</span><span class="op" id="3109510">,</span>&nbsp;<span class="ident" id="3109512">n</span><span class="op" id="3109513">,</span>&nbsp;<span class="keyword" id="3109515">func</span><span class="op" id="3109519">(</span><span class="ident" id="3109520">match</span>&nbsp;<span class="op" id="3109526">[</span><span class="op" id="3109527">]</span><span class="builtintype" id="3109528">int</span><span class="op" id="3109531">)</span>&nbsp;<span class="op" id="3109533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109537">result</span>&nbsp;<span class="op" id="3109544">=</span>&nbsp;<span class="builtinfunc" id="3109546">append</span><span class="op" id="3109552">(</span><span class="ident" id="3109553">result</span><span class="op" id="3109559">,</span>&nbsp;<span class="ident" id="3109561">match</span><span class="op" id="3109566">[</span><span class="num" id="3109567">0</span><span class="op" id="3109568">:</span><span class="num" id="3109569">2</span><span class="op" id="3109570">]</span><span class="op" id="3109571">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109574">}</span><span class="op" id="3109575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109578">if</span>&nbsp;<span class="builtinfunc" id="3109581">len</span><span class="op" id="3109584">(</span><span class="ident" id="3109585">result</span><span class="op" id="3109591">)</span>&nbsp;<span class="op" id="3109593">==</span>&nbsp;<span class="num" id="3109596">0</span>&nbsp;<span class="op" id="3109598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109602">return</span>&nbsp;<span class="ident" id="3109609">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109617">return</span>&nbsp;<span class="ident" id="3109624">result</span><br>
<span class="lineno">950</span><span class="op" id="3109631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3109634">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3109713">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="3109790">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="3109817">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3109862">func</span>&nbsp;<span class="op" id="3109867">(</span><span class="ident" id="3109868">re</span>&nbsp;<span class="op" id="3109871">*</span><span class="ident" id="3109872">Regexp</span><span class="op" id="3109878">)</span>&nbsp;<span class="ident" id="3109880">FindAllString</span><span class="op" id="3109893">(</span><span class="ident" id="3109894">s</span>&nbsp;<span class="builtintype" id="3109896">string</span><span class="op" id="3109902">,</span>&nbsp;<span class="ident" id="3109904">n</span>&nbsp;<span class="builtintype" id="3109906">int</span><span class="op" id="3109909">)</span>&nbsp;<span class="op" id="3109911">[</span><span class="op" id="3109912">]</span><span class="builtintype" id="3109913">string</span>&nbsp;<span class="op" id="3109920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109923">if</span>&nbsp;<span class="ident" id="3109926">n</span>&nbsp;<span class="op" id="3109928">&lt;</span>&nbsp;<span class="num" id="3109930">0</span>&nbsp;<span class="op" id="3109932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109936">n</span>&nbsp;<span class="op" id="3109938">=</span>&nbsp;<span class="builtinfunc" id="3109940">len</span><span class="op" id="3109943">(</span><span class="ident" id="3109944">s</span><span class="op" id="3109945">)</span>&nbsp;<span class="op" id="3109947">+</span>&nbsp;<span class="num" id="3109949">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109952">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109955">result</span>&nbsp;<span class="op" id="3109962">:=</span>&nbsp;<span class="builtinfunc" id="3109965">make</span><span class="op" id="3109969">(</span><span class="op" id="3109970">[</span><span class="op" id="3109971">]</span><span class="builtintype" id="3109972">string</span><span class="op" id="3109978">,</span>&nbsp;<span class="num" id="3109980">0</span><span class="op" id="3109981">,</span>&nbsp;<span class="ident" id="3109983">startSize</span><span class="op" id="3109992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109995">re</span><span class="op" id="3109997">.</span><span class="ident" id="3109998">allMatches</span><span class="op" id="3110008">(</span><span class="ident" id="3110009">s</span><span class="op" id="3110010">,</span>&nbsp;<span class="ident" id="3110012">nil</span><span class="op" id="3110015">,</span>&nbsp;<span class="ident" id="3110017">n</span><span class="op" id="3110018">,</span>&nbsp;<span class="keyword" id="3110020">func</span><span class="op" id="3110024">(</span><span class="ident" id="3110025">match</span>&nbsp;<span class="op" id="3110031">[</span><span class="op" id="3110032">]</span><span class="builtintype" id="3110033">int</span><span class="op" id="3110036">)</span>&nbsp;<span class="op" id="3110038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110042">result</span>&nbsp;<span class="op" id="3110049">=</span>&nbsp;<span class="builtinfunc" id="3110051">append</span><span class="op" id="3110057">(</span><span class="ident" id="3110058">result</span><span class="op" id="3110064">,</span>&nbsp;<span class="ident" id="3110066">s</span><span class="op" id="3110067">[</span><span class="ident" id="3110068">match</span><span class="op" id="3110073">[</span><span class="num" id="3110074">0</span><span class="op" id="3110075">]</span><span class="op" id="3110076">:</span><span class="ident" id="3110077">match</span><span class="op" id="3110082">[</span><span class="num" id="3110083">1</span><span class="op" id="3110084">]</span><span class="op" id="3110085">]</span><span class="op" id="3110086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110089">}</span><span class="op" id="3110090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110093">if</span>&nbsp;<span class="builtinfunc" id="3110096">len</span><span class="op" id="3110099">(</span><span class="ident" id="3110100">result</span><span class="op" id="3110106">)</span>&nbsp;<span class="op" id="3110108">==</span>&nbsp;<span class="num" id="3110111">0</span>&nbsp;<span class="op" id="3110113">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110117">return</span>&nbsp;<span class="ident" id="3110124">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110132">return</span>&nbsp;<span class="ident" id="3110139">result</span><br>
<span class="lineno"></span><span class="op" id="3110146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="3110149">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3110225">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="3110303">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3110342">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3110387">func</span>&nbsp;<span class="op" id="3110392">(</span><span class="ident" id="3110393">re</span>&nbsp;<span class="op" id="3110396">*</span><span class="ident" id="3110397">Regexp</span><span class="op" id="3110403">)</span>&nbsp;<span class="ident" id="3110405">FindAllStringIndex</span><span class="op" id="3110423">(</span><span class="ident" id="3110424">s</span>&nbsp;<span class="builtintype" id="3110426">string</span><span class="op" id="3110432">,</span>&nbsp;<span class="ident" id="3110434">n</span>&nbsp;<span class="builtintype" id="3110436">int</span><span class="op" id="3110439">)</span>&nbsp;<span class="op" id="3110441">[</span><span class="op" id="3110442">]</span><span class="op" id="3110443">[</span><span class="op" id="3110444">]</span><span class="builtintype" id="3110445">int</span>&nbsp;<span class="op" id="3110449">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110452">if</span>&nbsp;<span class="ident" id="3110455">n</span>&nbsp;<span class="op" id="3110457">&lt;</span>&nbsp;<span class="num" id="3110459">0</span>&nbsp;<span class="op" id="3110461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110465">n</span>&nbsp;<span class="op" id="3110467">=</span>&nbsp;<span class="builtinfunc" id="3110469">len</span><span class="op" id="3110472">(</span><span class="ident" id="3110473">s</span><span class="op" id="3110474">)</span>&nbsp;<span class="op" id="3110476">+</span>&nbsp;<span class="num" id="3110478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110484">result</span>&nbsp;<span class="op" id="3110491">:=</span>&nbsp;<span class="builtinfunc" id="3110494">make</span><span class="op" id="3110498">(</span><span class="op" id="3110499">[</span><span class="op" id="3110500">]</span><span class="op" id="3110501">[</span><span class="op" id="3110502">]</span><span class="builtintype" id="3110503">int</span><span class="op" id="3110506">,</span>&nbsp;<span class="num" id="3110508">0</span><span class="op" id="3110509">,</span>&nbsp;<span class="ident" id="3110511">startSize</span><span class="op" id="3110520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110523">re</span><span class="op" id="3110525">.</span><span class="ident" id="3110526">allMatches</span><span class="op" id="3110536">(</span><span class="ident" id="3110537">s</span><span class="op" id="3110538">,</span>&nbsp;<span class="ident" id="3110540">nil</span><span class="op" id="3110543">,</span>&nbsp;<span class="ident" id="3110545">n</span><span class="op" id="3110546">,</span>&nbsp;<span class="keyword" id="3110548">func</span><span class="op" id="3110552">(</span><span class="ident" id="3110553">match</span>&nbsp;<span class="op" id="3110559">[</span><span class="op" id="3110560">]</span><span class="builtintype" id="3110561">int</span><span class="op" id="3110564">)</span>&nbsp;<span class="op" id="3110566">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110570">result</span>&nbsp;<span class="op" id="3110577">=</span>&nbsp;<span class="builtinfunc" id="3110579">append</span><span class="op" id="3110585">(</span><span class="ident" id="3110586">result</span><span class="op" id="3110592">,</span>&nbsp;<span class="ident" id="3110594">match</span><span class="op" id="3110599">[</span><span class="num" id="3110600">0</span><span class="op" id="3110601">:</span><span class="num" id="3110602">2</span><span class="op" id="3110603">]</span><span class="op" id="3110604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110607">}</span><span class="op" id="3110608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110611">if</span>&nbsp;<span class="builtinfunc" id="3110614">len</span><span class="op" id="3110617">(</span><span class="ident" id="3110618">result</span><span class="op" id="3110624">)</span>&nbsp;<span class="op" id="3110626">==</span>&nbsp;<span class="num" id="3110629">0</span>&nbsp;<span class="op" id="3110631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110635">return</span>&nbsp;<span class="ident" id="3110642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110647">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110650">return</span>&nbsp;<span class="ident" id="3110657">result</span><br>
<span class="lineno"></span><span class="op" id="3110664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3110667">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3110743">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="3110815">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3110854">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3110899">func</span>&nbsp;<span class="op" id="3110904">(</span><span class="ident" id="3110905">re</span>&nbsp;<span class="op" id="3110908">*</span><span class="ident" id="3110909">Regexp</span><span class="op" id="3110915">)</span>&nbsp;<span class="ident" id="3110917">FindAllSubmatch</span><span class="op" id="3110932">(</span><span class="ident" id="3110933">b</span>&nbsp;<span class="op" id="3110935">[</span><span class="op" id="3110936">]</span><span class="builtintype" id="3110937">byte</span><span class="op" id="3110941">,</span>&nbsp;<span class="ident" id="3110943">n</span>&nbsp;<span class="builtintype" id="3110945">int</span><span class="op" id="3110948">)</span>&nbsp;<span class="op" id="3110950">[</span><span class="op" id="3110951">]</span><span class="op" id="3110952">[</span><span class="op" id="3110953">]</span><span class="op" id="3110954">[</span><span class="op" id="3110955">]</span><span class="builtintype" id="3110956">byte</span>&nbsp;<span class="op" id="3110961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110964">if</span>&nbsp;<span class="ident" id="3110967">n</span>&nbsp;<span class="op" id="3110969">&lt;</span>&nbsp;<span class="num" id="3110971">0</span>&nbsp;<span class="op" id="3110973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110977">n</span>&nbsp;<span class="op" id="3110979">=</span>&nbsp;<span class="builtinfunc" id="3110981">len</span><span class="op" id="3110984">(</span><span class="ident" id="3110985">b</span><span class="op" id="3110986">)</span>&nbsp;<span class="op" id="3110988">+</span>&nbsp;<span class="num" id="3110990">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110996">result</span>&nbsp;<span class="op" id="3111003">:=</span>&nbsp;<span class="builtinfunc" id="3111006">make</span><span class="op" id="3111010">(</span><span class="op" id="3111011">[</span><span class="op" id="3111012">]</span><span class="op" id="3111013">[</span><span class="op" id="3111014">]</span><span class="op" id="3111015">[</span><span class="op" id="3111016">]</span><span class="builtintype" id="3111017">byte</span><span class="op" id="3111021">,</span>&nbsp;<span class="num" id="3111023">0</span><span class="op" id="3111024">,</span>&nbsp;<span class="ident" id="3111026">startSize</span><span class="op" id="3111035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111038">re</span><span class="op" id="3111040">.</span><span class="ident" id="3111041">allMatches</span><span class="op" id="3111051">(</span><span class="string" id="3111052">&#34;&#34;</span><span class="op" id="3111054">,</span>&nbsp;<span class="ident" id="3111056">b</span><span class="op" id="3111057">,</span>&nbsp;<span class="ident" id="3111059">n</span><span class="op" id="3111060">,</span>&nbsp;<span class="keyword" id="3111062">func</span><span class="op" id="3111066">(</span><span class="ident" id="3111067">match</span>&nbsp;<span class="op" id="3111073">[</span><span class="op" id="3111074">]</span><span class="builtintype" id="3111075">int</span><span class="op" id="3111078">)</span>&nbsp;<span class="op" id="3111080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111084">slice</span>&nbsp;<span class="op" id="3111090">:=</span>&nbsp;<span class="builtinfunc" id="3111093">make</span><span class="op" id="3111097">(</span><span class="op" id="3111098">[</span><span class="op" id="3111099">]</span><span class="op" id="3111100">[</span><span class="op" id="3111101">]</span><span class="builtintype" id="3111102">byte</span><span class="op" id="3111106">,</span>&nbsp;<span class="builtinfunc" id="3111108">len</span><span class="op" id="3111111">(</span><span class="ident" id="3111112">match</span><span class="op" id="3111117">)</span><span class="op" id="3111118">/</span><span class="num" id="3111119">2</span><span class="op" id="3111120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111124">for</span>&nbsp;<span class="ident" id="3111128">j</span>&nbsp;<span class="op" id="3111130">:=</span>&nbsp;<span class="keyword" id="3111133">range</span>&nbsp;<span class="ident" id="3111139">slice</span>&nbsp;<span class="op" id="3111145">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111150">if</span>&nbsp;<span class="ident" id="3111153">match</span><span class="op" id="3111158">[</span><span class="num" id="3111159">2</span><span class="op" id="3111160">*</span><span class="ident" id="3111161">j</span><span class="op" id="3111162">]</span>&nbsp;<span class="op" id="3111164">&gt;=</span>&nbsp;<span class="num" id="3111167">0</span>&nbsp;<span class="op" id="3111169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111175">slice</span><span class="op" id="3111180">[</span><span class="ident" id="3111181">j</span><span class="op" id="3111182">]</span>&nbsp;<span class="op" id="3111184">=</span>&nbsp;<span class="ident" id="3111186">b</span><span class="op" id="3111187">[</span><span class="ident" id="3111188">match</span><span class="op" id="3111193">[</span><span class="num" id="3111194">2</span><span class="op" id="3111195">*</span><span class="ident" id="3111196">j</span><span class="op" id="3111197">]</span><span class="op" id="3111198">:</span><span class="ident" id="3111199">match</span><span class="op" id="3111204">[</span><span class="num" id="3111205">2</span><span class="op" id="3111206">*</span><span class="ident" id="3111207">j</span><span class="op" id="3111208">+</span><span class="num" id="3111209">1</span><span class="op" id="3111210">]</span><span class="op" id="3111211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111224">result</span>&nbsp;<span class="op" id="3111231">=</span>&nbsp;<span class="builtinfunc" id="3111233">append</span><span class="op" id="3111239">(</span><span class="ident" id="3111240">result</span><span class="op" id="3111246">,</span>&nbsp;<span class="ident" id="3111248">slice</span><span class="op" id="3111253">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111256">}</span><span class="op" id="3111257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111260">if</span>&nbsp;<span class="builtinfunc" id="3111263">len</span><span class="op" id="3111266">(</span><span class="ident" id="3111267">result</span><span class="op" id="3111273">)</span>&nbsp;<span class="op" id="3111275">==</span>&nbsp;<span class="num" id="3111278">0</span>&nbsp;<span class="op" id="3111280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111284">return</span>&nbsp;<span class="ident" id="3111291">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111299">return</span>&nbsp;<span class="ident" id="3111306">result</span><br>
<span class="lineno">1010</span><span class="op" id="3111313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3111316">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3111394">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3111468">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="3111513">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3111558">func</span>&nbsp;<span class="op" id="3111563">(</span><span class="ident" id="3111564">re</span>&nbsp;<span class="op" id="3111567">*</span><span class="ident" id="3111568">Regexp</span><span class="op" id="3111574">)</span>&nbsp;<span class="ident" id="3111576">FindAllSubmatchIndex</span><span class="op" id="3111596">(</span><span class="ident" id="3111597">b</span>&nbsp;<span class="op" id="3111599">[</span><span class="op" id="3111600">]</span><span class="builtintype" id="3111601">byte</span><span class="op" id="3111605">,</span>&nbsp;<span class="ident" id="3111607">n</span>&nbsp;<span class="builtintype" id="3111609">int</span><span class="op" id="3111612">)</span>&nbsp;<span class="op" id="3111614">[</span><span class="op" id="3111615">]</span><span class="op" id="3111616">[</span><span class="op" id="3111617">]</span><span class="builtintype" id="3111618">int</span>&nbsp;<span class="op" id="3111622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111625">if</span>&nbsp;<span class="ident" id="3111628">n</span>&nbsp;<span class="op" id="3111630">&lt;</span>&nbsp;<span class="num" id="3111632">0</span>&nbsp;<span class="op" id="3111634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111638">n</span>&nbsp;<span class="op" id="3111640">=</span>&nbsp;<span class="builtinfunc" id="3111642">len</span><span class="op" id="3111645">(</span><span class="ident" id="3111646">b</span><span class="op" id="3111647">)</span>&nbsp;<span class="op" id="3111649">+</span>&nbsp;<span class="num" id="3111651">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111654">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111657">result</span>&nbsp;<span class="op" id="3111664">:=</span>&nbsp;<span class="builtinfunc" id="3111667">make</span><span class="op" id="3111671">(</span><span class="op" id="3111672">[</span><span class="op" id="3111673">]</span><span class="op" id="3111674">[</span><span class="op" id="3111675">]</span><span class="builtintype" id="3111676">int</span><span class="op" id="3111679">,</span>&nbsp;<span class="num" id="3111681">0</span><span class="op" id="3111682">,</span>&nbsp;<span class="ident" id="3111684">startSize</span><span class="op" id="3111693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111696">re</span><span class="op" id="3111698">.</span><span class="ident" id="3111699">allMatches</span><span class="op" id="3111709">(</span><span class="string" id="3111710">&#34;&#34;</span><span class="op" id="3111712">,</span>&nbsp;<span class="ident" id="3111714">b</span><span class="op" id="3111715">,</span>&nbsp;<span class="ident" id="3111717">n</span><span class="op" id="3111718">,</span>&nbsp;<span class="keyword" id="3111720">func</span><span class="op" id="3111724">(</span><span class="ident" id="3111725">match</span>&nbsp;<span class="op" id="3111731">[</span><span class="op" id="3111732">]</span><span class="builtintype" id="3111733">int</span><span class="op" id="3111736">)</span>&nbsp;<span class="op" id="3111738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3111742">result</span>&nbsp;<span class="op" id="3111749">=</span>&nbsp;<span class="builtinfunc" id="3111751">append</span><span class="op" id="3111757">(</span><span class="ident" id="3111758">result</span><span class="op" id="3111764">,</span>&nbsp;<span class="ident" id="3111766">match</span><span class="op" id="3111771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111774">}</span><span class="op" id="3111775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111778">if</span>&nbsp;<span class="builtinfunc" id="3111781">len</span><span class="op" id="3111784">(</span><span class="ident" id="3111785">result</span><span class="op" id="3111791">)</span>&nbsp;<span class="op" id="3111793">==</span>&nbsp;<span class="num" id="3111796">0</span>&nbsp;<span class="op" id="3111798">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111802">return</span>&nbsp;<span class="ident" id="3111809">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3111814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3111817">return</span>&nbsp;<span class="ident" id="3111824">result</span><br>
<span class="lineno"></span><span class="op" id="3111831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="3111834">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3111906">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3111984">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3112033">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3112078">func</span>&nbsp;<span class="op" id="3112083">(</span><span class="ident" id="3112084">re</span>&nbsp;<span class="op" id="3112087">*</span><span class="ident" id="3112088">Regexp</span><span class="op" id="3112094">)</span>&nbsp;<span class="ident" id="3112096">FindAllStringSubmatch</span><span class="op" id="3112117">(</span><span class="ident" id="3112118">s</span>&nbsp;<span class="builtintype" id="3112120">string</span><span class="op" id="3112126">,</span>&nbsp;<span class="ident" id="3112128">n</span>&nbsp;<span class="builtintype" id="3112130">int</span><span class="op" id="3112133">)</span>&nbsp;<span class="op" id="3112135">[</span><span class="op" id="3112136">]</span><span class="op" id="3112137">[</span><span class="op" id="3112138">]</span><span class="builtintype" id="3112139">string</span>&nbsp;<span class="op" id="3112146">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112149">if</span>&nbsp;<span class="ident" id="3112152">n</span>&nbsp;<span class="op" id="3112154">&lt;</span>&nbsp;<span class="num" id="3112156">0</span>&nbsp;<span class="op" id="3112158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112162">n</span>&nbsp;<span class="op" id="3112164">=</span>&nbsp;<span class="builtinfunc" id="3112166">len</span><span class="op" id="3112169">(</span><span class="ident" id="3112170">s</span><span class="op" id="3112171">)</span>&nbsp;<span class="op" id="3112173">+</span>&nbsp;<span class="num" id="3112175">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112181">result</span>&nbsp;<span class="op" id="3112188">:=</span>&nbsp;<span class="builtinfunc" id="3112191">make</span><span class="op" id="3112195">(</span><span class="op" id="3112196">[</span><span class="op" id="3112197">]</span><span class="op" id="3112198">[</span><span class="op" id="3112199">]</span><span class="builtintype" id="3112200">string</span><span class="op" id="3112206">,</span>&nbsp;<span class="num" id="3112208">0</span><span class="op" id="3112209">,</span>&nbsp;<span class="ident" id="3112211">startSize</span><span class="op" id="3112220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112223">re</span><span class="op" id="3112225">.</span><span class="ident" id="3112226">allMatches</span><span class="op" id="3112236">(</span><span class="ident" id="3112237">s</span><span class="op" id="3112238">,</span>&nbsp;<span class="ident" id="3112240">nil</span><span class="op" id="3112243">,</span>&nbsp;<span class="ident" id="3112245">n</span><span class="op" id="3112246">,</span>&nbsp;<span class="keyword" id="3112248">func</span><span class="op" id="3112252">(</span><span class="ident" id="3112253">match</span>&nbsp;<span class="op" id="3112259">[</span><span class="op" id="3112260">]</span><span class="builtintype" id="3112261">int</span><span class="op" id="3112264">)</span>&nbsp;<span class="op" id="3112266">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112270">slice</span>&nbsp;<span class="op" id="3112276">:=</span>&nbsp;<span class="builtinfunc" id="3112279">make</span><span class="op" id="3112283">(</span><span class="op" id="3112284">[</span><span class="op" id="3112285">]</span><span class="builtintype" id="3112286">string</span><span class="op" id="3112292">,</span>&nbsp;<span class="builtinfunc" id="3112294">len</span><span class="op" id="3112297">(</span><span class="ident" id="3112298">match</span><span class="op" id="3112303">)</span><span class="op" id="3112304">/</span><span class="num" id="3112305">2</span><span class="op" id="3112306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112310">for</span>&nbsp;<span class="ident" id="3112314">j</span>&nbsp;<span class="op" id="3112316">:=</span>&nbsp;<span class="keyword" id="3112319">range</span>&nbsp;<span class="ident" id="3112325">slice</span>&nbsp;<span class="op" id="3112331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112336">if</span>&nbsp;<span class="ident" id="3112339">match</span><span class="op" id="3112344">[</span><span class="num" id="3112345">2</span><span class="op" id="3112346">*</span><span class="ident" id="3112347">j</span><span class="op" id="3112348">]</span>&nbsp;<span class="op" id="3112350">&gt;=</span>&nbsp;<span class="num" id="3112353">0</span>&nbsp;<span class="op" id="3112355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112361">slice</span><span class="op" id="3112366">[</span><span class="ident" id="3112367">j</span><span class="op" id="3112368">]</span>&nbsp;<span class="op" id="3112370">=</span>&nbsp;<span class="ident" id="3112372">s</span><span class="op" id="3112373">[</span><span class="ident" id="3112374">match</span><span class="op" id="3112379">[</span><span class="num" id="3112380">2</span><span class="op" id="3112381">*</span><span class="ident" id="3112382">j</span><span class="op" id="3112383">]</span><span class="op" id="3112384">:</span><span class="ident" id="3112385">match</span><span class="op" id="3112390">[</span><span class="num" id="3112391">2</span><span class="op" id="3112392">*</span><span class="ident" id="3112393">j</span><span class="op" id="3112394">+</span><span class="num" id="3112395">1</span><span class="op" id="3112396">]</span><span class="op" id="3112397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112402">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112410">result</span>&nbsp;<span class="op" id="3112417">=</span>&nbsp;<span class="builtinfunc" id="3112419">append</span><span class="op" id="3112425">(</span><span class="ident" id="3112426">result</span><span class="op" id="3112432">,</span>&nbsp;<span class="ident" id="3112434">slice</span><span class="op" id="3112439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112442">}</span><span class="op" id="3112443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112446">if</span>&nbsp;<span class="builtinfunc" id="3112449">len</span><span class="op" id="3112452">(</span><span class="ident" id="3112453">result</span><span class="op" id="3112459">)</span>&nbsp;<span class="op" id="3112461">==</span>&nbsp;<span class="num" id="3112464">0</span>&nbsp;<span class="op" id="3112466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112470">return</span>&nbsp;<span class="ident" id="3112477">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112485">return</span>&nbsp;<span class="ident" id="3112492">result</span><br>
<span class="lineno"></span><span class="op" id="3112499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3112502">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="3112556">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3112632">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3112702">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3112714">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3112759">func</span>&nbsp;<span class="op" id="3112764">(</span><span class="ident" id="3112765">re</span>&nbsp;<span class="op" id="3112768">*</span><span class="ident" id="3112769">Regexp</span><span class="op" id="3112775">)</span>&nbsp;<span class="ident" id="3112777">FindAllStringSubmatchIndex</span><span class="op" id="3112803">(</span><span class="ident" id="3112804">s</span>&nbsp;<span class="builtintype" id="3112806">string</span><span class="op" id="3112812">,</span>&nbsp;<span class="ident" id="3112814">n</span>&nbsp;<span class="builtintype" id="3112816">int</span><span class="op" id="3112819">)</span>&nbsp;<span class="op" id="3112821">[</span><span class="op" id="3112822">]</span><span class="op" id="3112823">[</span><span class="op" id="3112824">]</span><span class="builtintype" id="3112825">int</span>&nbsp;<span class="op" id="3112829">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112832">if</span>&nbsp;<span class="ident" id="3112835">n</span>&nbsp;<span class="op" id="3112837">&lt;</span>&nbsp;<span class="num" id="3112839">0</span>&nbsp;<span class="op" id="3112841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112845">n</span>&nbsp;<span class="op" id="3112847">=</span>&nbsp;<span class="builtinfunc" id="3112849">len</span><span class="op" id="3112852">(</span><span class="ident" id="3112853">s</span><span class="op" id="3112854">)</span>&nbsp;<span class="op" id="3112856">+</span>&nbsp;<span class="num" id="3112858">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112864">result</span>&nbsp;<span class="op" id="3112871">:=</span>&nbsp;<span class="builtinfunc" id="3112874">make</span><span class="op" id="3112878">(</span><span class="op" id="3112879">[</span><span class="op" id="3112880">]</span><span class="op" id="3112881">[</span><span class="op" id="3112882">]</span><span class="builtintype" id="3112883">int</span><span class="op" id="3112886">,</span>&nbsp;<span class="num" id="3112888">0</span><span class="op" id="3112889">,</span>&nbsp;<span class="ident" id="3112891">startSize</span><span class="op" id="3112900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112903">re</span><span class="op" id="3112905">.</span><span class="ident" id="3112906">allMatches</span><span class="op" id="3112916">(</span><span class="ident" id="3112917">s</span><span class="op" id="3112918">,</span>&nbsp;<span class="ident" id="3112920">nil</span><span class="op" id="3112923">,</span>&nbsp;<span class="ident" id="3112925">n</span><span class="op" id="3112926">,</span>&nbsp;<span class="keyword" id="3112928">func</span><span class="op" id="3112932">(</span><span class="ident" id="3112933">match</span>&nbsp;<span class="op" id="3112939">[</span><span class="op" id="3112940">]</span><span class="builtintype" id="3112941">int</span><span class="op" id="3112944">)</span>&nbsp;<span class="op" id="3112946">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3112950">result</span>&nbsp;<span class="op" id="3112957">=</span>&nbsp;<span class="builtinfunc" id="3112959">append</span><span class="op" id="3112965">(</span><span class="ident" id="3112966">result</span><span class="op" id="3112972">,</span>&nbsp;<span class="ident" id="3112974">match</span><span class="op" id="3112979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3112982">}</span><span class="op" id="3112983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3112986">if</span>&nbsp;<span class="builtinfunc" id="3112989">len</span><span class="op" id="3112992">(</span><span class="ident" id="3112993">result</span><span class="op" id="3112999">)</span>&nbsp;<span class="op" id="3113001">==</span>&nbsp;<span class="num" id="3113004">0</span>&nbsp;<span class="op" id="3113006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3113010">return</span>&nbsp;<span class="ident" id="3113017">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3113022">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3113025">return</span>&nbsp;<span class="ident" id="3113032">result</span><br>
<span class="lineno"></span><span class="op" id="3113039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3113042">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3113127">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="3113179">//</span><br>
<span class="lineno"></span><span class="comment" id="3113182">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3113255">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3113341">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="3113413">//</span><br>
<span class="lineno">1080</span><span class="comment" id="3113416">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="3113428">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="3113490">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="3113532">//</span><br>
<span class="lineno"></span><span class="comment" id="3113535">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="3113595">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="3113679">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="3113728">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="3113755">func</span>&nbsp;<span class="op" id="3113760">(</span><span class="ident" id="3113761">re</span>&nbsp;<span class="op" id="3113764">*</span><span class="ident" id="3113765">Regexp</span><span class="op" id="3113771">)</span>&nbsp;<span class="ident" id="3113773">Split</span><span class="op" id="3113778">(</span><span class="ident" id="3113779">s</span>&nbsp;<span class="builtintype" id="3113781">string</span><span class="op" id="3113787">,</span>&nbsp;<span class="ident" id="3113789">n</span>&nbsp;<span class="builtintype" id="3113791">int</span><span class="op" id="3113794">)</span>&nbsp;<span class="op" id="3113796">[</span><span class="op" id="3113797">]</span><span class="builtintype" id="3113798">string</span>&nbsp;<span class="op" id="3113805">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3113809">if</span>&nbsp;<span class="ident" id="3113812">n</span>&nbsp;<span class="op" id="3113814">==</span>&nbsp;<span class="num" id="3113817">0</span>&nbsp;<span class="op" id="3113819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3113823">return</span>&nbsp;<span class="ident" id="3113830">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3113835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3113839">if</span>&nbsp;<span class="builtinfunc" id="3113842">len</span><span class="op" id="3113845">(</span><span class="ident" id="3113846">re</span><span class="op" id="3113848">.</span><span class="ident" id="3113849">expr</span><span class="op" id="3113853">)</span>&nbsp;<span class="op" id="3113855">&gt;</span>&nbsp;<span class="num" id="3113857">0</span>&nbsp;<span class="op" id="3113859">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3113862">len</span><span class="op" id="3113865">(</span><span class="ident" id="3113866">s</span><span class="op" id="3113867">)</span>&nbsp;<span class="op" id="3113869">==</span>&nbsp;<span class="num" id="3113872">0</span>&nbsp;<span class="op" id="3113874">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3113878">return</span>&nbsp;<span class="op" id="3113885">[</span><span class="op" id="3113886">]</span><span class="builtintype" id="3113887">string</span><span class="op" id="3113893">{</span><span class="string" id="3113894">&#34;&#34;</span><span class="op" id="3113896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3113899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3113903">matches</span>&nbsp;<span class="op" id="3113911">:=</span>&nbsp;<span class="ident" id="3113914">re</span><span class="op" id="3113916">.</span><span class="ident" id="3113917">FindAllStringIndex</span><span class="op" id="3113935">(</span><span class="ident" id="3113936">s</span><span class="op" id="3113937">,</span>&nbsp;<span class="ident" id="3113939">n</span><span class="op" id="3113940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3113943">strings</span>&nbsp;<span class="op" id="3113951">:=</span>&nbsp;<span class="builtinfunc" id="3113954">make</span><span class="op" id="3113958">(</span><span class="op" id="3113959">[</span><span class="op" id="3113960">]</span><span class="builtintype" id="3113961">string</span><span class="op" id="3113967">,</span>&nbsp;<span class="num" id="3113969">0</span><span class="op" id="3113970">,</span>&nbsp;<span class="builtinfunc" id="3113972">len</span><span class="op" id="3113975">(</span><span class="ident" id="3113976">matches</span><span class="op" id="3113983">)</span><span class="op" id="3113984">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3113988">beg</span>&nbsp;<span class="op" id="3113992">:=</span>&nbsp;<span class="num" id="3113995">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3113998">end</span>&nbsp;<span class="op" id="3114002">:=</span>&nbsp;<span class="num" id="3114005">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3114008">for</span>&nbsp;<span class="ident" id="3114012">_</span><span class="op" id="3114013">,</span>&nbsp;<span class="ident" id="3114015">match</span>&nbsp;<span class="op" id="3114021">:=</span>&nbsp;<span class="keyword" id="3114024">range</span>&nbsp;<span class="ident" id="3114030">matches</span>&nbsp;<span class="op" id="3114038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3114042">if</span>&nbsp;<span class="ident" id="3114045">n</span>&nbsp;<span class="op" id="3114047">&gt;</span>&nbsp;<span class="num" id="3114049">0</span>&nbsp;<span class="op" id="3114051">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3114054">len</span><span class="op" id="3114057">(</span><span class="ident" id="3114058">strings</span><span class="op" id="3114065">)</span>&nbsp;<span class="op" id="3114067">&gt;=</span>&nbsp;<span class="ident" id="3114070">n</span><span class="op" id="3114071">-</span><span class="num" id="3114072">1</span>&nbsp;<span class="op" id="3114074">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3114079">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3114087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3114092">end</span>&nbsp;<span class="op" id="3114096">=</span>&nbsp;<span class="ident" id="3114098">match</span><span class="op" id="3114103">[</span><span class="num" id="3114104">0</span><span class="op" id="3114105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3114109">if</span>&nbsp;<span class="ident" id="3114112">match</span><span class="op" id="3114117">[</span><span class="num" id="3114118">1</span><span class="op" id="3114119">]</span>&nbsp;<span class="op" id="3114121">!=</span>&nbsp;<span class="num" id="3114124">0</span>&nbsp;<span class="op" id="3114126">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3114131">strings</span>&nbsp;<span class="op" id="3114139">=</span>&nbsp;<span class="builtinfunc" id="3114141">append</span><span class="op" id="3114147">(</span><span class="ident" id="3114148">strings</span><span class="op" id="3114155">,</span>&nbsp;<span class="ident" id="3114157">s</span><span class="op" id="3114158">[</span><span class="ident" id="3114159">beg</span><span class="op" id="3114162">:</span><span class="ident" id="3114163">end</span><span class="op" id="3114166">]</span><span class="op" id="3114167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3114171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3114175">beg</span>&nbsp;<span class="op" id="3114179">=</span>&nbsp;<span class="ident" id="3114181">match</span><span class="op" id="3114186">[</span><span class="num" id="3114187">1</span><span class="op" id="3114188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3114191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3114195">if</span>&nbsp;<span class="ident" id="3114198">end</span>&nbsp;<span class="op" id="3114202">!=</span>&nbsp;<span class="builtinfunc" id="3114205">len</span><span class="op" id="3114208">(</span><span class="ident" id="3114209">s</span><span class="op" id="3114210">)</span>&nbsp;<span class="op" id="3114212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3114216">strings</span>&nbsp;<span class="op" id="3114224">=</span>&nbsp;<span class="builtinfunc" id="3114226">append</span><span class="op" id="3114232">(</span><span class="ident" id="3114233">strings</span><span class="op" id="3114240">,</span>&nbsp;<span class="ident" id="3114242">s</span><span class="op" id="3114243">[</span><span class="ident" id="3114244">beg</span><span class="op" id="3114247">:</span><span class="op" id="3114248">]</span><span class="op" id="3114249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3114252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3114256">return</span>&nbsp;<span class="ident" id="3114263">strings</span><br>
<span class="lineno">1120</span><span class="op" id="3114271">}</span>
</div>
</body>
</html>
