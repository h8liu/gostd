<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3561854">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3561909">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3561963">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3562014">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3562087">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="3562112">package</span>&nbsp;<span class="ident" id="3562120">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3562125">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="3562195">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562235">import</span>&nbsp;<span class="string" id="3562242">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3562253">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="3562311">type</span>&nbsp;<span class="ident" id="3562316">Cipher</span>&nbsp;<span class="keyword" id="3562323">struct</span>&nbsp;<span class="op" id="3562330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562333">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3562338">[</span><span class="num" id="3562339">256</span><span class="op" id="3562342">]</span><span class="builtintype" id="3562343">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562351">i</span><span class="op" id="3562352">,</span>&nbsp;<span class="ident" id="3562354">j</span>&nbsp;<span class="builtintype" id="3562356">uint8</span><br>
<span class="lineno"></span><span class="op" id="3562362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3562365">type</span>&nbsp;<span class="ident" id="3562370">KeySizeError</span>&nbsp;<span class="builtintype" id="3562383">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562388">func</span>&nbsp;<span class="op" id="3562393">(</span><span class="ident" id="3562394">k</span>&nbsp;<span class="ident" id="3562396">KeySizeError</span><span class="op" id="3562408">)</span>&nbsp;<span class="ident" id="3562410">Error</span><span class="op" id="3562415">(</span><span class="op" id="3562416">)</span>&nbsp;<span class="builtintype" id="3562418">string</span>&nbsp;<span class="op" id="3562425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562428">return</span>&nbsp;<span class="string" id="3562435">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3562467">+</span>&nbsp;<span class="ident" id="3562469">strconv</span><span class="op" id="3562476">.</span><span class="ident" id="3562477">Itoa</span><span class="op" id="3562481">(</span><span class="builtintype" id="3562482">int</span><span class="op" id="3562485">(</span><span class="ident" id="3562486">k</span><span class="op" id="3562487">)</span><span class="op" id="3562488">)</span><br>
<span class="lineno"></span><span class="op" id="3562490">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3562493">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3562572">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3562623">func</span>&nbsp;<span class="ident" id="3562628">NewCipher</span><span class="op" id="3562637">(</span><span class="ident" id="3562638">key</span>&nbsp;<span class="op" id="3562642">[</span><span class="op" id="3562643">]</span><span class="builtintype" id="3562644">byte</span><span class="op" id="3562648">)</span>&nbsp;<span class="op" id="3562650">(</span><span class="op" id="3562651">*</span><span class="ident" id="3562652">Cipher</span><span class="op" id="3562658">,</span>&nbsp;<span class="builtintype" id="3562660">error</span><span class="op" id="3562665">)</span>&nbsp;<span class="op" id="3562667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562670">k</span>&nbsp;<span class="op" id="3562672">:=</span>&nbsp;<span class="builtinfunc" id="3562675">len</span><span class="op" id="3562678">(</span><span class="ident" id="3562679">key</span><span class="op" id="3562682">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562685">if</span>&nbsp;<span class="ident" id="3562688">k</span>&nbsp;<span class="op" id="3562690">&lt;</span>&nbsp;<span class="num" id="3562692">1</span>&nbsp;<span class="op" id="3562694">||</span>&nbsp;<span class="ident" id="3562697">k</span>&nbsp;<span class="op" id="3562699">&gt;</span>&nbsp;<span class="num" id="3562701">256</span>&nbsp;<span class="op" id="3562705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562709">return</span>&nbsp;<span class="ident" id="3562716">nil</span><span class="op" id="3562719">,</span>&nbsp;<span class="ident" id="3562721">KeySizeError</span><span class="op" id="3562733">(</span><span class="ident" id="3562734">k</span><span class="op" id="3562735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562741">var</span>&nbsp;<span class="ident" id="3562745">c</span>&nbsp;<span class="ident" id="3562747">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562755">for</span>&nbsp;<span class="ident" id="3562759">i</span>&nbsp;<span class="op" id="3562761">:=</span>&nbsp;<span class="num" id="3562764">0</span><span class="op" id="3562765">;</span>&nbsp;<span class="ident" id="3562767">i</span>&nbsp;<span class="op" id="3562769">&lt;</span>&nbsp;<span class="num" id="3562771">256</span><span class="op" id="3562774">;</span>&nbsp;<span class="ident" id="3562776">i</span><span class="op" id="3562777">++</span>&nbsp;<span class="op" id="3562780">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562784">c</span><span class="op" id="3562785">.</span><span class="ident" id="3562786">s</span><span class="op" id="3562787">[</span><span class="ident" id="3562788">i</span><span class="op" id="3562789">]</span>&nbsp;<span class="op" id="3562791">=</span>&nbsp;<span class="builtintype" id="3562793">uint32</span><span class="op" id="3562799">(</span><span class="ident" id="3562800">i</span><span class="op" id="3562801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562807">var</span>&nbsp;<span class="ident" id="3562811">j</span>&nbsp;<span class="builtintype" id="3562813">uint8</span>&nbsp;<span class="op" id="3562819">=</span>&nbsp;<span class="num" id="3562821">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562824">for</span>&nbsp;<span class="ident" id="3562828">i</span>&nbsp;<span class="op" id="3562830">:=</span>&nbsp;<span class="num" id="3562833">0</span><span class="op" id="3562834">;</span>&nbsp;<span class="ident" id="3562836">i</span>&nbsp;<span class="op" id="3562838">&lt;</span>&nbsp;<span class="num" id="3562840">256</span><span class="op" id="3562843">;</span>&nbsp;<span class="ident" id="3562845">i</span><span class="op" id="3562846">++</span>&nbsp;<span class="op" id="3562849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562853">j</span>&nbsp;<span class="op" id="3562855">+=</span>&nbsp;<span class="builtintype" id="3562858">uint8</span><span class="op" id="3562863">(</span><span class="ident" id="3562864">c</span><span class="op" id="3562865">.</span><span class="ident" id="3562866">s</span><span class="op" id="3562867">[</span><span class="ident" id="3562868">i</span><span class="op" id="3562869">]</span><span class="op" id="3562870">)</span>&nbsp;<span class="op" id="3562872">+</span>&nbsp;<span class="ident" id="3562874">key</span><span class="op" id="3562877">[</span><span class="ident" id="3562878">i</span><span class="op" id="3562879">%</span><span class="ident" id="3562880">k</span><span class="op" id="3562881">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562885">c</span><span class="op" id="3562886">.</span><span class="ident" id="3562887">s</span><span class="op" id="3562888">[</span><span class="ident" id="3562889">i</span><span class="op" id="3562890">]</span><span class="op" id="3562891">,</span>&nbsp;<span class="ident" id="3562893">c</span><span class="op" id="3562894">.</span><span class="ident" id="3562895">s</span><span class="op" id="3562896">[</span><span class="ident" id="3562897">j</span><span class="op" id="3562898">]</span>&nbsp;<span class="op" id="3562900">=</span>&nbsp;<span class="ident" id="3562902">c</span><span class="op" id="3562903">.</span><span class="ident" id="3562904">s</span><span class="op" id="3562905">[</span><span class="ident" id="3562906">j</span><span class="op" id="3562907">]</span><span class="op" id="3562908">,</span>&nbsp;<span class="ident" id="3562910">c</span><span class="op" id="3562911">.</span><span class="ident" id="3562912">s</span><span class="op" id="3562913">[</span><span class="ident" id="3562914">i</span><span class="op" id="3562915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562921">return</span>&nbsp;<span class="op" id="3562928">&amp;</span><span class="ident" id="3562929">c</span><span class="op" id="3562930">,</span>&nbsp;<span class="ident" id="3562932">nil</span><br>
<span class="lineno"></span><span class="op" id="3562936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3562939">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3563007">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="3563028">func</span>&nbsp;<span class="op" id="3563033">(</span><span class="ident" id="3563034">c</span>&nbsp;<span class="op" id="3563036">*</span><span class="ident" id="3563037">Cipher</span><span class="op" id="3563043">)</span>&nbsp;<span class="ident" id="3563045">Reset</span><span class="op" id="3563050">(</span><span class="op" id="3563051">)</span>&nbsp;<span class="op" id="3563053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563056">for</span>&nbsp;<span class="ident" id="3563060">i</span>&nbsp;<span class="op" id="3563062">:=</span>&nbsp;<span class="keyword" id="3563065">range</span>&nbsp;<span class="ident" id="3563071">c</span><span class="op" id="3563072">.</span><span class="ident" id="3563073">s</span>&nbsp;<span class="op" id="3563075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563079">c</span><span class="op" id="3563080">.</span><span class="ident" id="3563081">s</span><span class="op" id="3563082">[</span><span class="ident" id="3563083">i</span><span class="op" id="3563084">]</span>&nbsp;<span class="op" id="3563086">=</span>&nbsp;<span class="num" id="3563088">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563094">c</span><span class="op" id="3563095">.</span><span class="ident" id="3563096">i</span><span class="op" id="3563097">,</span>&nbsp;<span class="ident" id="3563099">c</span><span class="op" id="3563100">.</span><span class="ident" id="3563101">j</span>&nbsp;<span class="op" id="3563103">=</span>&nbsp;<span class="num" id="3563105">0</span><span class="op" id="3563106">,</span>&nbsp;<span class="num" id="3563108">0</span><br>
<span class="lineno"></span><span class="op" id="3563110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3563113">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="3563182">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3563253">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="3563269">//</span><br>
<span class="lineno"></span><span class="comment" id="3563272">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="3563342">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="3563408">func</span>&nbsp;<span class="op" id="3563413">(</span><span class="ident" id="3563414">c</span>&nbsp;<span class="op" id="3563416">*</span><span class="ident" id="3563417">Cipher</span><span class="op" id="3563423">)</span>&nbsp;<span class="ident" id="3563425">xorKeyStreamGeneric</span><span class="op" id="3563444">(</span><span class="ident" id="3563445">dst</span><span class="op" id="3563448">,</span>&nbsp;<span class="ident" id="3563450">src</span>&nbsp;<span class="op" id="3563454">[</span><span class="op" id="3563455">]</span><span class="builtintype" id="3563456">byte</span><span class="op" id="3563460">)</span>&nbsp;<span class="op" id="3563462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563465">i</span><span class="op" id="3563466">,</span>&nbsp;<span class="ident" id="3563468">j</span>&nbsp;<span class="op" id="3563470">:=</span>&nbsp;<span class="ident" id="3563473">c</span><span class="op" id="3563474">.</span><span class="ident" id="3563475">i</span><span class="op" id="3563476">,</span>&nbsp;<span class="ident" id="3563478">c</span><span class="op" id="3563479">.</span><span class="ident" id="3563480">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3563483">for</span>&nbsp;<span class="ident" id="3563487">k</span><span class="op" id="3563488">,</span>&nbsp;<span class="ident" id="3563490">v</span>&nbsp;<span class="op" id="3563492">:=</span>&nbsp;<span class="keyword" id="3563495">range</span>&nbsp;<span class="ident" id="3563501">src</span>&nbsp;<span class="op" id="3563505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563509">i</span>&nbsp;<span class="op" id="3563511">+=</span>&nbsp;<span class="num" id="3563514">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563518">j</span>&nbsp;<span class="op" id="3563520">+=</span>&nbsp;<span class="builtintype" id="3563523">uint8</span><span class="op" id="3563528">(</span><span class="ident" id="3563529">c</span><span class="op" id="3563530">.</span><span class="ident" id="3563531">s</span><span class="op" id="3563532">[</span><span class="ident" id="3563533">i</span><span class="op" id="3563534">]</span><span class="op" id="3563535">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563539">c</span><span class="op" id="3563540">.</span><span class="ident" id="3563541">s</span><span class="op" id="3563542">[</span><span class="ident" id="3563543">i</span><span class="op" id="3563544">]</span><span class="op" id="3563545">,</span>&nbsp;<span class="ident" id="3563547">c</span><span class="op" id="3563548">.</span><span class="ident" id="3563549">s</span><span class="op" id="3563550">[</span><span class="ident" id="3563551">j</span><span class="op" id="3563552">]</span>&nbsp;<span class="op" id="3563554">=</span>&nbsp;<span class="ident" id="3563556">c</span><span class="op" id="3563557">.</span><span class="ident" id="3563558">s</span><span class="op" id="3563559">[</span><span class="ident" id="3563560">j</span><span class="op" id="3563561">]</span><span class="op" id="3563562">,</span>&nbsp;<span class="ident" id="3563564">c</span><span class="op" id="3563565">.</span><span class="ident" id="3563566">s</span><span class="op" id="3563567">[</span><span class="ident" id="3563568">i</span><span class="op" id="3563569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563573">dst</span><span class="op" id="3563576">[</span><span class="ident" id="3563577">k</span><span class="op" id="3563578">]</span>&nbsp;<span class="op" id="3563580">=</span>&nbsp;<span class="ident" id="3563582">v</span>&nbsp;<span class="op" id="3563584">^</span>&nbsp;<span class="builtintype" id="3563586">uint8</span><span class="op" id="3563591">(</span><span class="ident" id="3563592">c</span><span class="op" id="3563593">.</span><span class="ident" id="3563594">s</span><span class="op" id="3563595">[</span><span class="builtintype" id="3563596">uint8</span><span class="op" id="3563601">(</span><span class="ident" id="3563602">c</span><span class="op" id="3563603">.</span><span class="ident" id="3563604">s</span><span class="op" id="3563605">[</span><span class="ident" id="3563606">i</span><span class="op" id="3563607">]</span><span class="op" id="3563608">+</span><span class="ident" id="3563609">c</span><span class="op" id="3563610">.</span><span class="ident" id="3563611">s</span><span class="op" id="3563612">[</span><span class="ident" id="3563613">j</span><span class="op" id="3563614">]</span><span class="op" id="3563615">)</span><span class="op" id="3563616">]</span><span class="op" id="3563617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3563620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3563623">c</span><span class="op" id="3563624">.</span><span class="ident" id="3563625">i</span><span class="op" id="3563626">,</span>&nbsp;<span class="ident" id="3563628">c</span><span class="op" id="3563629">.</span><span class="ident" id="3563630">j</span>&nbsp;<span class="op" id="3563632">=</span>&nbsp;<span class="ident" id="3563634">i</span><span class="op" id="3563635">,</span>&nbsp;<span class="ident" id="3563637">j</span><br>
<span class="lineno"></span><span class="op" id="3563639">}</span>
</div>
</body>
</html>
