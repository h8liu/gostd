<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html" class="current">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8540532">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8540587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8540641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8540692">package</span>&nbsp;<span class="ident" id="8540700">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8540707">import</span>&nbsp;<span class="op" id="8540714">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8540717">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8540730">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8540736">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8540747">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8540757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8540760">func</span>&nbsp;<span class="ident" id="8540765">TestWriteHeapDumpNonempty</span><span class="op" id="8540790">(</span><span class="ident" id="8540791">t</span>&nbsp;<span class="op" id="8540793">*</span><span class="ident" id="8540794">testing</span><span class="op" id="8540801">.</span><span class="ident" id="8540802">T</span><span class="op" id="8540803">)</span>&nbsp;<span class="op" id="8540805">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8540808">if</span>&nbsp;<span class="ident" id="8540811">runtime</span><span class="op" id="8540818">.</span><span class="ident" id="8540819">GOOS</span>&nbsp;<span class="op" id="8540824">==</span>&nbsp;<span class="string" id="8540827">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8540834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8540838">t</span><span class="op" id="8540839">.</span><span class="ident" id="8540840">Skip</span><span class="op" id="8540844">(</span><span class="string" id="8540845">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8540886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8540889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8540892">f</span><span class="op" id="8540893">,</span>&nbsp;<span class="ident" id="8540895">err</span>&nbsp;<span class="op" id="8540899">:=</span>&nbsp;<span class="ident" id="8540902">ioutil</span><span class="op" id="8540908">.</span><span class="ident" id="8540909">TempFile</span><span class="op" id="8540917">(</span><span class="string" id="8540918">&#34;&#34;</span><span class="op" id="8540920">,</span>&nbsp;<span class="string" id="8540922">&#34;heapdumptest&#34;</span><span class="op" id="8540936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8540939">if</span>&nbsp;<span class="ident" id="8540942">err</span>&nbsp;<span class="op" id="8540946">!=</span>&nbsp;<span class="ident" id="8540949">nil</span>&nbsp;<span class="op" id="8540953">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8540957">t</span><span class="op" id="8540958">.</span><span class="ident" id="8540959">Fatalf</span><span class="op" id="8540965">(</span><span class="string" id="8540966">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8540987">,</span>&nbsp;<span class="ident" id="8540989">err</span><span class="op" id="8540992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8540995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8540998">defer</span>&nbsp;<span class="ident" id="8541004">os</span><span class="op" id="8541006">.</span><span class="ident" id="8541007">Remove</span><span class="op" id="8541013">(</span><span class="ident" id="8541014">f</span><span class="op" id="8541015">.</span><span class="ident" id="8541016">Name</span><span class="op" id="8541020">(</span><span class="op" id="8541021">)</span><span class="op" id="8541022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8541025">defer</span>&nbsp;<span class="ident" id="8541031">f</span><span class="op" id="8541032">.</span><span class="ident" id="8541033">Close</span><span class="op" id="8541038">(</span><span class="op" id="8541039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8541042">WriteHeapDump</span><span class="op" id="8541055">(</span><span class="ident" id="8541056">f</span><span class="op" id="8541057">.</span><span class="ident" id="8541058">Fd</span><span class="op" id="8541060">(</span><span class="op" id="8541061">)</span><span class="op" id="8541062">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8541065">fi</span><span class="op" id="8541067">,</span>&nbsp;<span class="ident" id="8541069">err</span>&nbsp;<span class="op" id="8541073">:=</span>&nbsp;<span class="ident" id="8541076">f</span><span class="op" id="8541077">.</span><span class="ident" id="8541078">Stat</span><span class="op" id="8541082">(</span><span class="op" id="8541083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8541086">if</span>&nbsp;<span class="ident" id="8541089">err</span>&nbsp;<span class="op" id="8541093">!=</span>&nbsp;<span class="ident" id="8541096">nil</span>&nbsp;<span class="op" id="8541100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8541104">t</span><span class="op" id="8541105">.</span><span class="ident" id="8541106">Fatalf</span><span class="op" id="8541112">(</span><span class="string" id="8541113">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8541130">,</span>&nbsp;<span class="ident" id="8541132">err</span><span class="op" id="8541135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8541138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8541141">const</span>&nbsp;<span class="ident" id="8541147">minSize</span>&nbsp;<span class="op" id="8541155">=</span>&nbsp;<span class="num" id="8541157">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8541160">if</span>&nbsp;<span class="ident" id="8541163">size</span>&nbsp;<span class="op" id="8541168">:=</span>&nbsp;<span class="ident" id="8541171">fi</span><span class="op" id="8541173">.</span><span class="ident" id="8541174">Size</span><span class="op" id="8541178">(</span><span class="op" id="8541179">)</span><span class="op" id="8541180">;</span>&nbsp;<span class="ident" id="8541182">size</span>&nbsp;<span class="op" id="8541187">&lt;</span>&nbsp;<span class="ident" id="8541189">minSize</span>&nbsp;<span class="op" id="8541197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8541201">t</span><span class="op" id="8541202">.</span><span class="ident" id="8541203">Fatalf</span><span class="op" id="8541209">(</span><span class="string" id="8541210">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8541263">,</span>&nbsp;<span class="ident" id="8541265">size</span><span class="op" id="8541269">,</span>&nbsp;<span class="ident" id="8541271">minSize</span><span class="op" id="8541278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8541281">}</span><br>
<span class="lineno"></span><span class="op" id="8541283">}</span>
</div>
</body>
</html>
