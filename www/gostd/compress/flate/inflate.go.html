<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html" class="current">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4393418">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4393473">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4393527">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4393578">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4393628">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4393705">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4393785">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4393797">package</span>&nbsp;<span class="ident" id="4393805">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4393812">import</span>&nbsp;<span class="op" id="4393819">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4393822">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4393831">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4393837">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4393847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4393850">const</span>&nbsp;<span class="op" id="4393856">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393859">maxCodeLen</span>&nbsp;<span class="op" id="4393870">=</span>&nbsp;<span class="num" id="4393872">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4393878">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393909">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393920">=</span>&nbsp;<span class="num" id="4393922">32768</span>&nbsp;<span class="comment" id="4393928">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4393953">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394014">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4394023">=</span>&nbsp;<span class="num" id="4394025">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394030">maxDist</span>&nbsp;&nbsp;<span class="op" id="4394039">=</span>&nbsp;<span class="num" id="4394041">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394045">numCodes</span>&nbsp;<span class="op" id="4394054">=</span>&nbsp;<span class="num" id="4394056">19</span>&nbsp;<span class="comment" id="4394059">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4394099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394102">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4394182">type</span>&nbsp;<span class="ident" id="4394187">CorruptInputError</span>&nbsp;<span class="ident" id="4394205">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4394212">func</span>&nbsp;<span class="op" id="4394217">(</span><span class="ident" id="4394218">e</span>&nbsp;<span class="ident" id="4394220">CorruptInputError</span><span class="op" id="4394237">)</span>&nbsp;<span class="ident" id="4394239">Error</span><span class="op" id="4394244">(</span><span class="op" id="4394245">)</span>&nbsp;<span class="builtintype" id="4394247">string</span>&nbsp;<span class="op" id="4394254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394257">return</span>&nbsp;<span class="string" id="4394264">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4394302">+</span>&nbsp;<span class="ident" id="4394304">strconv</span><span class="op" id="4394311">.</span><span class="ident" id="4394312">FormatInt</span><span class="op" id="4394321">(</span><span class="ident" id="4394322">int64</span><span class="op" id="4394327">(</span><span class="ident" id="4394328">e</span><span class="op" id="4394329">)</span><span class="op" id="4394330">,</span>&nbsp;<span class="num" id="4394332">10</span><span class="op" id="4394334">)</span><br>
<span class="lineno"></span><span class="op" id="4394336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394339">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4394402">type</span>&nbsp;<span class="ident" id="4394407">InternalError</span>&nbsp;<span class="builtintype" id="4394421">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4394429">func</span>&nbsp;<span class="op" id="4394434">(</span><span class="ident" id="4394435">e</span>&nbsp;<span class="ident" id="4394437">InternalError</span><span class="op" id="4394450">)</span>&nbsp;<span class="ident" id="4394452">Error</span><span class="op" id="4394457">(</span><span class="op" id="4394458">)</span>&nbsp;<span class="builtintype" id="4394460">string</span>&nbsp;<span class="op" id="4394467">{</span>&nbsp;<span class="keyword" id="4394469">return</span>&nbsp;<span class="string" id="4394476">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4394502">+</span>&nbsp;<span class="builtintype" id="4394504">string</span><span class="op" id="4394510">(</span><span class="ident" id="4394511">e</span><span class="op" id="4394512">)</span>&nbsp;<span class="op" id="4394514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394517">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4394582">type</span>&nbsp;<span class="ident" id="4394587">ReadError</span>&nbsp;<span class="keyword" id="4394597">struct</span>&nbsp;<span class="op" id="4394604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394607">Offset</span>&nbsp;<span class="ident" id="4394614">int64</span>&nbsp;<span class="comment" id="4394620">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394657">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4394664">error</span>&nbsp;<span class="comment" id="4394670">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4394707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4394710">func</span>&nbsp;<span class="op" id="4394715">(</span><span class="ident" id="4394716">e</span>&nbsp;<span class="op" id="4394718">*</span><span class="ident" id="4394719">ReadError</span><span class="op" id="4394728">)</span>&nbsp;<span class="ident" id="4394730">Error</span><span class="op" id="4394735">(</span><span class="op" id="4394736">)</span>&nbsp;<span class="builtintype" id="4394738">string</span>&nbsp;<span class="op" id="4394745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394748">return</span>&nbsp;<span class="string" id="4394755">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4394786">+</span>&nbsp;<span class="ident" id="4394788">strconv</span><span class="op" id="4394795">.</span><span class="ident" id="4394796">FormatInt</span><span class="op" id="4394805">(</span><span class="ident" id="4394806">e</span><span class="op" id="4394807">.</span><span class="ident" id="4394808">Offset</span><span class="op" id="4394814">,</span>&nbsp;<span class="num" id="4394816">10</span><span class="op" id="4394818">)</span>&nbsp;<span class="op" id="4394820">+</span>&nbsp;<span class="string" id="4394822">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4394827">+</span>&nbsp;<span class="ident" id="4394829">e</span><span class="op" id="4394830">.</span><span class="ident" id="4394831">Err</span><span class="op" id="4394834">.</span><span class="ident" id="4394835">Error</span><span class="op" id="4394840">(</span><span class="op" id="4394841">)</span><br>
<span class="lineno"></span><span class="op" id="4394843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394846">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4394913">type</span>&nbsp;<span class="ident" id="4394918">WriteError</span>&nbsp;<span class="keyword" id="4394929">struct</span>&nbsp;<span class="op" id="4394936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394939">Offset</span>&nbsp;<span class="ident" id="4394946">int64</span>&nbsp;<span class="comment" id="4394952">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394989">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4394996">error</span>&nbsp;<span class="comment" id="4395002">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4395040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4395043">func</span>&nbsp;<span class="op" id="4395048">(</span><span class="ident" id="4395049">e</span>&nbsp;<span class="op" id="4395051">*</span><span class="ident" id="4395052">WriteError</span><span class="op" id="4395062">)</span>&nbsp;<span class="ident" id="4395064">Error</span><span class="op" id="4395069">(</span><span class="op" id="4395070">)</span>&nbsp;<span class="builtintype" id="4395072">string</span>&nbsp;<span class="op" id="4395079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395082">return</span>&nbsp;<span class="string" id="4395089">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4395121">+</span>&nbsp;<span class="ident" id="4395123">strconv</span><span class="op" id="4395130">.</span><span class="ident" id="4395131">FormatInt</span><span class="op" id="4395140">(</span><span class="ident" id="4395141">e</span><span class="op" id="4395142">.</span><span class="ident" id="4395143">Offset</span><span class="op" id="4395149">,</span>&nbsp;<span class="num" id="4395151">10</span><span class="op" id="4395153">)</span>&nbsp;<span class="op" id="4395155">+</span>&nbsp;<span class="string" id="4395157">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4395162">+</span>&nbsp;<span class="ident" id="4395164">e</span><span class="op" id="4395165">.</span><span class="ident" id="4395166">Err</span><span class="op" id="4395169">.</span><span class="ident" id="4395170">Error</span><span class="op" id="4395175">(</span><span class="op" id="4395176">)</span><br>
<span class="lineno"></span><span class="op" id="4395178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4395181">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4395255">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4395330">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4395366">type</span>&nbsp;<span class="ident" id="4395371">Resetter</span>&nbsp;<span class="keyword" id="4395380">interface</span>&nbsp;<span class="op" id="4395390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4395393">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4395467">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4395512">Reset</span><span class="op" id="4395517">(</span><span class="ident" id="4395518">r</span>&nbsp;<span class="ident" id="4395520">io</span><span class="op" id="4395522">.</span><span class="ident" id="4395523">Reader</span><span class="op" id="4395529">,</span>&nbsp;<span class="ident" id="4395531">dict</span>&nbsp;<span class="op" id="4395536">[</span><span class="op" id="4395537">]</span><span class="builtintype" id="4395538">byte</span><span class="op" id="4395542">)</span>&nbsp;<span class="builtintype" id="4395544">error</span><br>
<span class="lineno"></span><span class="op" id="4395550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4395553">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4395626">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4395695">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4395756">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4395826">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4395900">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4395970">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4396039">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4396112">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4396184">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4396216">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4396284">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4396356">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4396425">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4396493">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4396513">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4396545">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4396591">const</span>&nbsp;<span class="op" id="4396597">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396600">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4396618">=</span>&nbsp;<span class="num" id="4396620">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396623">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4396641">=</span>&nbsp;<span class="num" id="4396643">1</span>&nbsp;<span class="op" id="4396645">&lt;&lt;</span>&nbsp;<span class="ident" id="4396648">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396666">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4396684">=</span>&nbsp;<span class="num" id="4396686">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396690">huffmanValueShift</span>&nbsp;<span class="op" id="4396708">=</span>&nbsp;<span class="num" id="4396710">4</span><br>
<span class="lineno"></span><span class="op" id="4396712">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4396715">type</span>&nbsp;<span class="ident" id="4396720">huffmanDecoder</span>&nbsp;<span class="keyword" id="4396735">struct</span>&nbsp;<span class="op" id="4396742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396745">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4396754">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4396779">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396807">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4396816">[</span><span class="ident" id="4396817">huffmanNumChunks</span><span class="op" id="4396833">]</span><span class="builtintype" id="4396834">uint32</span>&nbsp;<span class="comment" id="4396841">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396871">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4396880">[</span><span class="op" id="4396881">]</span><span class="op" id="4396882">[</span><span class="op" id="4396883">]</span><span class="builtintype" id="4396884">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4396905">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4396924">linkMask</span>&nbsp;<span class="builtintype" id="4396933">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4396958">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4396994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4396997">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4397063">func</span>&nbsp;<span class="op" id="4397068">(</span><span class="ident" id="4397069">h</span>&nbsp;<span class="op" id="4397071">*</span><span class="ident" id="4397072">huffmanDecoder</span><span class="op" id="4397086">)</span>&nbsp;<span class="ident" id="4397088">init</span><span class="op" id="4397092">(</span><span class="ident" id="4397093">bits</span>&nbsp;<span class="op" id="4397098">[</span><span class="op" id="4397099">]</span><span class="builtintype" id="4397100">int</span><span class="op" id="4397103">)</span>&nbsp;<span class="builtintype" id="4397105">bool</span>&nbsp;<span class="op" id="4397110">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397113">if</span>&nbsp;<span class="ident" id="4397116">h</span><span class="op" id="4397117">.</span><span class="ident" id="4397118">min</span>&nbsp;<span class="op" id="4397122">!=</span>&nbsp;<span class="num" id="4397125">0</span>&nbsp;<span class="op" id="4397127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397131">*</span><span class="ident" id="4397132">h</span>&nbsp;<span class="op" id="4397134">=</span>&nbsp;<span class="ident" id="4397136">huffmanDecoder</span><span class="op" id="4397150">{</span><span class="op" id="4397151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4397158">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4397200">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397232">var</span>&nbsp;<span class="ident" id="4397236">count</span>&nbsp;<span class="op" id="4397242">[</span><span class="ident" id="4397243">maxCodeLen</span><span class="op" id="4397253">]</span><span class="builtintype" id="4397254">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397259">var</span>&nbsp;<span class="ident" id="4397263">min</span><span class="op" id="4397266">,</span>&nbsp;<span class="ident" id="4397268">max</span>&nbsp;<span class="builtintype" id="4397272">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397277">for</span>&nbsp;<span class="ident" id="4397281">_</span><span class="op" id="4397282">,</span>&nbsp;<span class="ident" id="4397284">n</span>&nbsp;<span class="op" id="4397286">:=</span>&nbsp;<span class="keyword" id="4397289">range</span>&nbsp;<span class="ident" id="4397295">bits</span>&nbsp;<span class="op" id="4397300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397304">if</span>&nbsp;<span class="ident" id="4397307">n</span>&nbsp;<span class="op" id="4397309">==</span>&nbsp;<span class="num" id="4397312">0</span>&nbsp;<span class="op" id="4397314">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397319">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397334">if</span>&nbsp;<span class="ident" id="4397337">min</span>&nbsp;<span class="op" id="4397341">==</span>&nbsp;<span class="num" id="4397344">0</span>&nbsp;<span class="op" id="4397346">||</span>&nbsp;<span class="ident" id="4397349">n</span>&nbsp;<span class="op" id="4397351">&lt;</span>&nbsp;<span class="ident" id="4397353">min</span>&nbsp;<span class="op" id="4397357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397362">min</span>&nbsp;<span class="op" id="4397366">=</span>&nbsp;<span class="ident" id="4397368">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397372">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397376">if</span>&nbsp;<span class="ident" id="4397379">n</span>&nbsp;<span class="op" id="4397381">&gt;</span>&nbsp;<span class="ident" id="4397383">max</span>&nbsp;<span class="op" id="4397387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397392">max</span>&nbsp;<span class="op" id="4397396">=</span>&nbsp;<span class="ident" id="4397398">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397406">count</span><span class="op" id="4397411">[</span><span class="ident" id="4397412">n</span><span class="op" id="4397413">]</span><span class="op" id="4397414">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397418">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397421">if</span>&nbsp;<span class="ident" id="4397424">max</span>&nbsp;<span class="op" id="4397428">==</span>&nbsp;<span class="num" id="4397431">0</span>&nbsp;<span class="op" id="4397433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397437">return</span>&nbsp;<span class="builtintype" id="4397444">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397455">h</span><span class="op" id="4397456">.</span><span class="ident" id="4397457">min</span>&nbsp;<span class="op" id="4397461">=</span>&nbsp;<span class="ident" id="4397463">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397468">var</span>&nbsp;<span class="ident" id="4397472">linkBits</span>&nbsp;<span class="builtintype" id="4397481">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397487">var</span>&nbsp;<span class="ident" id="4397491">numLinks</span>&nbsp;<span class="builtintype" id="4397500">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397505">if</span>&nbsp;<span class="ident" id="4397508">max</span>&nbsp;<span class="op" id="4397512">&gt;</span>&nbsp;<span class="ident" id="4397514">huffmanChunkBits</span>&nbsp;<span class="op" id="4397531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397535">linkBits</span>&nbsp;<span class="op" id="4397544">=</span>&nbsp;<span class="builtintype" id="4397546">uint</span><span class="op" id="4397550">(</span><span class="ident" id="4397551">max</span><span class="op" id="4397554">)</span>&nbsp;<span class="op" id="4397556">-</span>&nbsp;<span class="ident" id="4397558">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397577">numLinks</span>&nbsp;<span class="op" id="4397586">=</span>&nbsp;<span class="num" id="4397588">1</span>&nbsp;<span class="op" id="4397590">&lt;&lt;</span>&nbsp;<span class="ident" id="4397593">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397604">h</span><span class="op" id="4397605">.</span><span class="ident" id="4397606">linkMask</span>&nbsp;<span class="op" id="4397615">=</span>&nbsp;<span class="builtintype" id="4397617">uint32</span><span class="op" id="4397623">(</span><span class="ident" id="4397624">numLinks</span>&nbsp;<span class="op" id="4397633">-</span>&nbsp;<span class="num" id="4397635">1</span><span class="op" id="4397636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397642">code</span>&nbsp;<span class="op" id="4397647">:=</span>&nbsp;<span class="num" id="4397650">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397653">var</span>&nbsp;<span class="ident" id="4397657">nextcode</span>&nbsp;<span class="op" id="4397666">[</span><span class="ident" id="4397667">maxCodeLen</span><span class="op" id="4397677">]</span><span class="builtintype" id="4397678">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397683">for</span>&nbsp;<span class="ident" id="4397687">i</span>&nbsp;<span class="op" id="4397689">:=</span>&nbsp;<span class="ident" id="4397692">min</span><span class="op" id="4397695">;</span>&nbsp;<span class="ident" id="4397697">i</span>&nbsp;<span class="op" id="4397699">&lt;=</span>&nbsp;<span class="ident" id="4397702">max</span><span class="op" id="4397705">;</span>&nbsp;<span class="ident" id="4397707">i</span><span class="op" id="4397708">++</span>&nbsp;<span class="op" id="4397711">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397715">if</span>&nbsp;<span class="ident" id="4397718">i</span>&nbsp;<span class="op" id="4397720">==</span>&nbsp;<span class="ident" id="4397723">huffmanChunkBits</span><span class="op" id="4397739">+</span><span class="num" id="4397740">1</span>&nbsp;<span class="op" id="4397742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4397747">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397772">link</span>&nbsp;<span class="op" id="4397777">:=</span>&nbsp;<span class="ident" id="4397780">code</span>&nbsp;<span class="op" id="4397785">&gt;&gt;</span>&nbsp;<span class="num" id="4397788">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397793">if</span>&nbsp;<span class="ident" id="4397796">huffmanNumChunks</span>&nbsp;<span class="op" id="4397813">&lt;</span>&nbsp;<span class="ident" id="4397815">link</span>&nbsp;<span class="op" id="4397820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397826">return</span>&nbsp;<span class="builtintype" id="4397833">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4397842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397847">h</span><span class="op" id="4397848">.</span><span class="ident" id="4397849">links</span>&nbsp;<span class="op" id="4397855">=</span>&nbsp;<span class="builtinfunc" id="4397857">make</span><span class="op" id="4397861">(</span><span class="op" id="4397862">[</span><span class="op" id="4397863">]</span><span class="op" id="4397864">[</span><span class="op" id="4397865">]</span><span class="builtintype" id="4397866">uint32</span><span class="op" id="4397872">,</span>&nbsp;<span class="ident" id="4397874">huffmanNumChunks</span><span class="op" id="4397890">-</span><span class="ident" id="4397891">link</span><span class="op" id="4397895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4397900">for</span>&nbsp;<span class="ident" id="4397904">j</span>&nbsp;<span class="op" id="4397906">:=</span>&nbsp;<span class="builtintype" id="4397909">uint</span><span class="op" id="4397913">(</span><span class="ident" id="4397914">link</span><span class="op" id="4397918">)</span><span class="op" id="4397919">;</span>&nbsp;<span class="ident" id="4397921">j</span>&nbsp;<span class="op" id="4397923">&lt;</span>&nbsp;<span class="ident" id="4397925">huffmanNumChunks</span><span class="op" id="4397941">;</span>&nbsp;<span class="ident" id="4397943">j</span><span class="op" id="4397944">++</span>&nbsp;<span class="op" id="4397947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4397953">reverse</span>&nbsp;<span class="op" id="4397961">:=</span>&nbsp;<span class="builtintype" id="4397964">int</span><span class="op" id="4397967">(</span><span class="ident" id="4397968">reverseByte</span><span class="op" id="4397979">[</span><span class="ident" id="4397980">j</span><span class="op" id="4397981">&gt;&gt;</span><span class="num" id="4397983">8</span><span class="op" id="4397984">]</span><span class="op" id="4397985">)</span>&nbsp;<span class="op" id="4397987">|</span>&nbsp;<span class="builtintype" id="4397989">int</span><span class="op" id="4397992">(</span><span class="ident" id="4397993">reverseByte</span><span class="op" id="4398004">[</span><span class="ident" id="4398005">j</span><span class="op" id="4398006">&amp;</span><span class="num" id="4398007">0xff</span><span class="op" id="4398011">]</span><span class="op" id="4398012">)</span><span class="op" id="4398013">&lt;&lt;</span><span class="num" id="4398015">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398021">reverse</span>&nbsp;<span class="op" id="4398029">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4398033">uint</span><span class="op" id="4398037">(</span><span class="num" id="4398038">16</span>&nbsp;<span class="op" id="4398041">-</span>&nbsp;<span class="ident" id="4398043">huffmanChunkBits</span><span class="op" id="4398059">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398065">off</span>&nbsp;<span class="op" id="4398069">:=</span>&nbsp;<span class="ident" id="4398072">j</span>&nbsp;<span class="op" id="4398074">-</span>&nbsp;<span class="builtintype" id="4398076">uint</span><span class="op" id="4398080">(</span><span class="ident" id="4398081">link</span><span class="op" id="4398085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398091">h</span><span class="op" id="4398092">.</span><span class="ident" id="4398093">chunks</span><span class="op" id="4398099">[</span><span class="ident" id="4398100">reverse</span><span class="op" id="4398107">]</span>&nbsp;<span class="op" id="4398109">=</span>&nbsp;<span class="builtintype" id="4398111">uint32</span><span class="op" id="4398117">(</span><span class="ident" id="4398118">off</span><span class="op" id="4398121">&lt;&lt;</span><span class="ident" id="4398123">huffmanValueShift</span>&nbsp;<span class="op" id="4398141">+</span>&nbsp;<span class="builtintype" id="4398143">uint</span><span class="op" id="4398147">(</span><span class="ident" id="4398148">i</span><span class="op" id="4398149">)</span><span class="op" id="4398150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398156">h</span><span class="op" id="4398157">.</span><span class="ident" id="4398158">links</span><span class="op" id="4398163">[</span><span class="ident" id="4398164">off</span><span class="op" id="4398167">]</span>&nbsp;<span class="op" id="4398169">=</span>&nbsp;<span class="builtinfunc" id="4398171">make</span><span class="op" id="4398175">(</span><span class="op" id="4398176">[</span><span class="op" id="4398177">]</span><span class="builtintype" id="4398178">uint32</span><span class="op" id="4398184">,</span>&nbsp;<span class="num" id="4398186">1</span><span class="op" id="4398187">&lt;&lt;</span><span class="ident" id="4398189">linkBits</span><span class="op" id="4398197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398206">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398210">n</span>&nbsp;<span class="op" id="4398212">:=</span>&nbsp;<span class="ident" id="4398215">count</span><span class="op" id="4398220">[</span><span class="ident" id="4398221">i</span><span class="op" id="4398222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398226">nextcode</span><span class="op" id="4398234">[</span><span class="ident" id="4398235">i</span><span class="op" id="4398236">]</span>&nbsp;<span class="op" id="4398238">=</span>&nbsp;<span class="ident" id="4398240">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398247">code</span>&nbsp;<span class="op" id="4398252">+=</span>&nbsp;<span class="ident" id="4398255">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398259">code</span>&nbsp;<span class="op" id="4398264">&lt;&lt;=</span>&nbsp;<span class="num" id="4398268">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398271">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398275">for</span>&nbsp;<span class="ident" id="4398279">i</span><span class="op" id="4398280">,</span>&nbsp;<span class="ident" id="4398282">n</span>&nbsp;<span class="op" id="4398284">:=</span>&nbsp;<span class="keyword" id="4398287">range</span>&nbsp;<span class="ident" id="4398293">bits</span>&nbsp;<span class="op" id="4398298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398302">if</span>&nbsp;<span class="ident" id="4398305">n</span>&nbsp;<span class="op" id="4398307">==</span>&nbsp;<span class="num" id="4398310">0</span>&nbsp;<span class="op" id="4398312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398317">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398328">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398332">code</span>&nbsp;<span class="op" id="4398337">:=</span>&nbsp;<span class="ident" id="4398340">nextcode</span><span class="op" id="4398348">[</span><span class="ident" id="4398349">n</span><span class="op" id="4398350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398354">nextcode</span><span class="op" id="4398362">[</span><span class="ident" id="4398363">n</span><span class="op" id="4398364">]</span><span class="op" id="4398365">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398370">chunk</span>&nbsp;<span class="op" id="4398376">:=</span>&nbsp;<span class="builtintype" id="4398379">uint32</span><span class="op" id="4398385">(</span><span class="ident" id="4398386">i</span><span class="op" id="4398387">&lt;&lt;</span><span class="ident" id="4398389">huffmanValueShift</span>&nbsp;<span class="op" id="4398407">|</span>&nbsp;<span class="ident" id="4398409">n</span><span class="op" id="4398410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398414">reverse</span>&nbsp;<span class="op" id="4398422">:=</span>&nbsp;<span class="builtintype" id="4398425">int</span><span class="op" id="4398428">(</span><span class="ident" id="4398429">reverseByte</span><span class="op" id="4398440">[</span><span class="ident" id="4398441">code</span><span class="op" id="4398445">&gt;&gt;</span><span class="num" id="4398447">8</span><span class="op" id="4398448">]</span><span class="op" id="4398449">)</span>&nbsp;<span class="op" id="4398451">|</span>&nbsp;<span class="builtintype" id="4398453">int</span><span class="op" id="4398456">(</span><span class="ident" id="4398457">reverseByte</span><span class="op" id="4398468">[</span><span class="ident" id="4398469">code</span><span class="op" id="4398473">&amp;</span><span class="num" id="4398474">0xff</span><span class="op" id="4398478">]</span><span class="op" id="4398479">)</span><span class="op" id="4398480">&lt;&lt;</span><span class="num" id="4398482">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398486">reverse</span>&nbsp;<span class="op" id="4398494">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4398498">uint</span><span class="op" id="4398502">(</span><span class="num" id="4398503">16</span>&nbsp;<span class="op" id="4398506">-</span>&nbsp;<span class="ident" id="4398508">n</span><span class="op" id="4398509">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398513">if</span>&nbsp;<span class="ident" id="4398516">n</span>&nbsp;<span class="op" id="4398518">&lt;=</span>&nbsp;<span class="ident" id="4398521">huffmanChunkBits</span>&nbsp;<span class="op" id="4398538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398543">for</span>&nbsp;<span class="ident" id="4398547">off</span>&nbsp;<span class="op" id="4398551">:=</span>&nbsp;<span class="ident" id="4398554">reverse</span><span class="op" id="4398561">;</span>&nbsp;<span class="ident" id="4398563">off</span>&nbsp;<span class="op" id="4398567">&lt;</span>&nbsp;<span class="ident" id="4398569">huffmanNumChunks</span><span class="op" id="4398585">;</span>&nbsp;<span class="ident" id="4398587">off</span>&nbsp;<span class="op" id="4398591">+=</span>&nbsp;<span class="num" id="4398594">1</span>&nbsp;<span class="op" id="4398596">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4398599">uint</span><span class="op" id="4398603">(</span><span class="ident" id="4398604">n</span><span class="op" id="4398605">)</span>&nbsp;<span class="op" id="4398607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398613">h</span><span class="op" id="4398614">.</span><span class="ident" id="4398615">chunks</span><span class="op" id="4398621">[</span><span class="ident" id="4398622">off</span><span class="op" id="4398625">]</span>&nbsp;<span class="op" id="4398627">=</span>&nbsp;<span class="ident" id="4398629">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398642">}</span>&nbsp;<span class="keyword" id="4398644">else</span>&nbsp;<span class="op" id="4398649">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398654">value</span>&nbsp;<span class="op" id="4398660">:=</span>&nbsp;<span class="ident" id="4398663">h</span><span class="op" id="4398664">.</span><span class="ident" id="4398665">chunks</span><span class="op" id="4398671">[</span><span class="ident" id="4398672">reverse</span><span class="op" id="4398679">&amp;</span><span class="op" id="4398680">(</span><span class="ident" id="4398681">huffmanNumChunks</span><span class="op" id="4398697">-</span><span class="num" id="4398698">1</span><span class="op" id="4398699">)</span><span class="op" id="4398700">]</span>&nbsp;<span class="op" id="4398702">&gt;&gt;</span>&nbsp;<span class="ident" id="4398705">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398726">if</span>&nbsp;<span class="ident" id="4398729">value</span>&nbsp;<span class="op" id="4398735">&gt;=</span>&nbsp;<span class="builtintype" id="4398738">uint32</span><span class="op" id="4398744">(</span><span class="builtinfunc" id="4398745">len</span><span class="op" id="4398748">(</span><span class="ident" id="4398749">h</span><span class="op" id="4398750">.</span><span class="ident" id="4398751">links</span><span class="op" id="4398756">)</span><span class="op" id="4398757">)</span>&nbsp;<span class="op" id="4398759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398765">return</span>&nbsp;<span class="builtintype" id="4398772">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398786">linktab</span>&nbsp;<span class="op" id="4398794">:=</span>&nbsp;<span class="ident" id="4398797">h</span><span class="op" id="4398798">.</span><span class="ident" id="4398799">links</span><span class="op" id="4398804">[</span><span class="ident" id="4398805">value</span><span class="op" id="4398810">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398815">reverse</span>&nbsp;<span class="op" id="4398823">&gt;&gt;=</span>&nbsp;<span class="ident" id="4398827">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398847">for</span>&nbsp;<span class="ident" id="4398851">off</span>&nbsp;<span class="op" id="4398855">:=</span>&nbsp;<span class="ident" id="4398858">reverse</span><span class="op" id="4398865">;</span>&nbsp;<span class="ident" id="4398867">off</span>&nbsp;<span class="op" id="4398871">&lt;</span>&nbsp;<span class="ident" id="4398873">numLinks</span><span class="op" id="4398881">;</span>&nbsp;<span class="ident" id="4398883">off</span>&nbsp;<span class="op" id="4398887">+=</span>&nbsp;<span class="num" id="4398890">1</span>&nbsp;<span class="op" id="4398892">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4398895">uint</span><span class="op" id="4398899">(</span><span class="ident" id="4398900">n</span><span class="op" id="4398901">-</span><span class="ident" id="4398902">huffmanChunkBits</span><span class="op" id="4398918">)</span>&nbsp;<span class="op" id="4398920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4398926">linktab</span><span class="op" id="4398933">[</span><span class="ident" id="4398934">off</span><span class="op" id="4398937">]</span>&nbsp;<span class="op" id="4398939">=</span>&nbsp;<span class="ident" id="4398941">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398954">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4398957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4398960">return</span>&nbsp;<span class="builtintype" id="4398967">true</span><br>
<span class="lineno"></span><span class="op" id="4398972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4398975">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4399025">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4399084">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4399135">type</span>&nbsp;<span class="ident" id="4399140">Reader</span>&nbsp;<span class="keyword" id="4399147">interface</span>&nbsp;<span class="op" id="4399157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399160">io</span><span class="op" id="4399162">.</span><span class="ident" id="4399163">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399171">io</span><span class="op" id="4399173">.</span><span class="ident" id="4399174">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4399185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4399188">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4399209">type</span>&nbsp;<span class="ident" id="4399214">decompressor</span>&nbsp;<span class="keyword" id="4399227">struct</span>&nbsp;<span class="op" id="4399234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399237">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399255">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399263">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399271">roffset</span>&nbsp;<span class="ident" id="4399279">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399286">woffset</span>&nbsp;<span class="ident" id="4399294">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399302">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399331">b</span>&nbsp;&nbsp;<span class="builtintype" id="4399334">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399342">nb</span>&nbsp;<span class="builtintype" id="4399345">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399352">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399403">h1</span><span class="op" id="4399405">,</span>&nbsp;<span class="ident" id="4399407">h2</span>&nbsp;<span class="ident" id="4399410">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399427">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399475">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4399484">*</span><span class="op" id="4399485">[</span><span class="ident" id="4399486">maxLit</span>&nbsp;<span class="op" id="4399493">+</span>&nbsp;<span class="ident" id="4399495">maxDist</span><span class="op" id="4399502">]</span><span class="builtintype" id="4399503">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399508">codebits</span>&nbsp;<span class="op" id="4399517">*</span><span class="op" id="4399518">[</span><span class="ident" id="4399519">numCodes</span><span class="op" id="4399527">]</span><span class="builtintype" id="4399528">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399534">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399562">hist</span>&nbsp;&nbsp;<span class="op" id="4399568">*</span><span class="op" id="4399569">[</span><span class="ident" id="4399570">maxHist</span><span class="op" id="4399577">]</span><span class="builtintype" id="4399578">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399584">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4399590">int</span>&nbsp;&nbsp;<span class="comment" id="4399595">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399633">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4399639">int</span>&nbsp;&nbsp;<span class="comment" id="4399644">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399680">hfull</span>&nbsp;<span class="builtintype" id="4399686">bool</span>&nbsp;<span class="comment" id="4399691">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399728">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399779">buf</span>&nbsp;<span class="op" id="4399783">[</span><span class="num" id="4399784">4</span><span class="op" id="4399785">]</span><span class="builtintype" id="4399786">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399793">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4399829">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399858">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4399867">func</span><span class="op" id="4399871">(</span><span class="op" id="4399872">*</span><span class="ident" id="4399873">decompressor</span><span class="op" id="4399885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399888">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4399897">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399903">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4399912">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399919">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4399928">[</span><span class="op" id="4399929">]</span><span class="builtintype" id="4399930">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399936">hl</span><span class="op" id="4399938">,</span>&nbsp;<span class="ident" id="4399940">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4399945">*</span><span class="ident" id="4399946">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399962">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4399971">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4399976">copyDist</span>&nbsp;<span class="builtintype" id="4399985">int</span><br>
<span class="lineno"></span><span class="op" id="4399989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4399992">func</span>&nbsp;<span class="op" id="4399997">(</span><span class="ident" id="4399998">f</span>&nbsp;<span class="op" id="4400000">*</span><span class="ident" id="4400001">decompressor</span><span class="op" id="4400013">)</span>&nbsp;<span class="ident" id="4400015">nextBlock</span><span class="op" id="4400024">(</span><span class="op" id="4400025">)</span>&nbsp;<span class="op" id="4400027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400030">if</span>&nbsp;<span class="ident" id="4400033">f</span><span class="op" id="4400034">.</span><span class="ident" id="4400035">final</span>&nbsp;<span class="op" id="4400041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400045">if</span>&nbsp;<span class="ident" id="4400048">f</span><span class="op" id="4400049">.</span><span class="ident" id="4400050">hw</span>&nbsp;<span class="op" id="4400053">!=</span>&nbsp;<span class="ident" id="4400056">f</span><span class="op" id="4400057">.</span><span class="ident" id="4400058">hp</span>&nbsp;<span class="op" id="4400061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400066">f</span><span class="op" id="4400067">.</span><span class="ident" id="4400068">flush</span><span class="op" id="4400073">(</span><span class="op" id="4400074">(</span><span class="op" id="4400075">*</span><span class="ident" id="4400076">decompressor</span><span class="op" id="4400088">)</span><span class="op" id="4400089">.</span><span class="ident" id="4400090">nextBlock</span><span class="op" id="4400099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400104">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400117">f</span><span class="op" id="4400118">.</span><span class="ident" id="4400119">err</span>&nbsp;<span class="op" id="4400123">=</span>&nbsp;<span class="ident" id="4400125">io</span><span class="op" id="4400127">.</span><span class="ident" id="4400128">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400134">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400145">for</span>&nbsp;<span class="ident" id="4400149">f</span><span class="op" id="4400150">.</span><span class="ident" id="4400151">nb</span>&nbsp;<span class="op" id="4400154">&lt;</span>&nbsp;<span class="num" id="4400156">1</span><span class="op" id="4400157">+</span><span class="num" id="4400158">2</span>&nbsp;<span class="op" id="4400160">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400164">if</span>&nbsp;<span class="ident" id="4400167">f</span><span class="op" id="4400168">.</span><span class="ident" id="4400169">err</span>&nbsp;<span class="op" id="4400173">=</span>&nbsp;<span class="ident" id="4400175">f</span><span class="op" id="4400176">.</span><span class="ident" id="4400177">moreBits</span><span class="op" id="4400185">(</span><span class="op" id="4400186">)</span><span class="op" id="4400187">;</span>&nbsp;<span class="ident" id="4400189">f</span><span class="op" id="4400190">.</span><span class="ident" id="4400191">err</span>&nbsp;<span class="op" id="4400195">!=</span>&nbsp;<span class="ident" id="4400198">nil</span>&nbsp;<span class="op" id="4400202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400207">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400222">f</span><span class="op" id="4400223">.</span><span class="ident" id="4400224">final</span>&nbsp;<span class="op" id="4400230">=</span>&nbsp;<span class="ident" id="4400232">f</span><span class="op" id="4400233">.</span><span class="ident" id="4400234">b</span><span class="op" id="4400235">&amp;</span><span class="num" id="4400236">1</span>&nbsp;<span class="op" id="4400238">==</span>&nbsp;<span class="num" id="4400241">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400244">f</span><span class="op" id="4400245">.</span><span class="ident" id="4400246">b</span>&nbsp;<span class="op" id="4400248">&gt;&gt;=</span>&nbsp;<span class="num" id="4400252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400255">typ</span>&nbsp;<span class="op" id="4400259">:=</span>&nbsp;<span class="ident" id="4400262">f</span><span class="op" id="4400263">.</span><span class="ident" id="4400264">b</span>&nbsp;<span class="op" id="4400266">&amp;</span>&nbsp;<span class="num" id="4400268">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400271">f</span><span class="op" id="4400272">.</span><span class="ident" id="4400273">b</span>&nbsp;<span class="op" id="4400275">&gt;&gt;=</span>&nbsp;<span class="num" id="4400279">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400282">f</span><span class="op" id="4400283">.</span><span class="ident" id="4400284">nb</span>&nbsp;<span class="op" id="4400287">-=</span>&nbsp;<span class="num" id="4400290">1</span>&nbsp;<span class="op" id="4400292">+</span>&nbsp;<span class="num" id="4400294">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400297">switch</span>&nbsp;<span class="ident" id="4400304">typ</span>&nbsp;<span class="op" id="4400308">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400311">case</span>&nbsp;<span class="num" id="4400316">0</span><span class="op" id="4400317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400321">f</span><span class="op" id="4400322">.</span><span class="ident" id="4400323">dataBlock</span><span class="op" id="4400332">(</span><span class="op" id="4400333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400336">case</span>&nbsp;<span class="num" id="4400341">1</span><span class="op" id="4400342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4400346">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400384">f</span><span class="op" id="4400385">.</span><span class="ident" id="4400386">hl</span>&nbsp;<span class="op" id="4400389">=</span>&nbsp;<span class="op" id="4400391">&amp;</span><span class="ident" id="4400392">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400414">f</span><span class="op" id="4400415">.</span><span class="ident" id="4400416">hd</span>&nbsp;<span class="op" id="4400419">=</span>&nbsp;<span class="ident" id="4400421">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400427">f</span><span class="op" id="4400428">.</span><span class="ident" id="4400429">huffmanBlock</span><span class="op" id="4400441">(</span><span class="op" id="4400442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400445">case</span>&nbsp;<span class="num" id="4400450">2</span><span class="op" id="4400451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4400455">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400495">if</span>&nbsp;<span class="ident" id="4400498">f</span><span class="op" id="4400499">.</span><span class="ident" id="4400500">err</span>&nbsp;<span class="op" id="4400504">=</span>&nbsp;<span class="ident" id="4400506">f</span><span class="op" id="4400507">.</span><span class="ident" id="4400508">readHuffman</span><span class="op" id="4400519">(</span><span class="op" id="4400520">)</span><span class="op" id="4400521">;</span>&nbsp;<span class="ident" id="4400523">f</span><span class="op" id="4400524">.</span><span class="ident" id="4400525">err</span>&nbsp;<span class="op" id="4400529">!=</span>&nbsp;<span class="ident" id="4400532">nil</span>&nbsp;<span class="op" id="4400536">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400541">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400553">f</span><span class="op" id="4400554">.</span><span class="ident" id="4400555">hl</span>&nbsp;<span class="op" id="4400558">=</span>&nbsp;<span class="op" id="4400560">&amp;</span><span class="ident" id="4400561">f</span><span class="op" id="4400562">.</span><span class="ident" id="4400563">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400568">f</span><span class="op" id="4400569">.</span><span class="ident" id="4400570">hd</span>&nbsp;<span class="op" id="4400573">=</span>&nbsp;<span class="op" id="4400575">&amp;</span><span class="ident" id="4400576">f</span><span class="op" id="4400577">.</span><span class="ident" id="4400578">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400583">f</span><span class="op" id="4400584">.</span><span class="ident" id="4400585">huffmanBlock</span><span class="op" id="4400597">(</span><span class="op" id="4400598">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400601">default</span><span class="op" id="4400608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4400612">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400632">f</span><span class="op" id="4400633">.</span><span class="ident" id="4400634">err</span>&nbsp;<span class="op" id="4400638">=</span>&nbsp;<span class="ident" id="4400640">CorruptInputError</span><span class="op" id="4400657">(</span><span class="ident" id="4400658">f</span><span class="op" id="4400659">.</span><span class="ident" id="4400660">roffset</span><span class="op" id="4400667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400670">}</span><br>
<span class="lineno"></span><span class="op" id="4400672">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4400675">func</span>&nbsp;<span class="op" id="4400680">(</span><span class="ident" id="4400681">f</span>&nbsp;<span class="op" id="4400683">*</span><span class="ident" id="4400684">decompressor</span><span class="op" id="4400696">)</span>&nbsp;<span class="ident" id="4400698">Read</span><span class="op" id="4400702">(</span><span class="ident" id="4400703">b</span>&nbsp;<span class="op" id="4400705">[</span><span class="op" id="4400706">]</span><span class="builtintype" id="4400707">byte</span><span class="op" id="4400711">)</span>&nbsp;<span class="op" id="4400713">(</span><span class="builtintype" id="4400714">int</span><span class="op" id="4400717">,</span>&nbsp;<span class="builtintype" id="4400719">error</span><span class="op" id="4400724">)</span>&nbsp;<span class="op" id="4400726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400729">for</span>&nbsp;<span class="op" id="4400733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400737">if</span>&nbsp;<span class="builtinfunc" id="4400740">len</span><span class="op" id="4400743">(</span><span class="ident" id="4400744">f</span><span class="op" id="4400745">.</span><span class="ident" id="4400746">toRead</span><span class="op" id="4400752">)</span>&nbsp;<span class="op" id="4400754">&gt;</span>&nbsp;<span class="num" id="4400756">0</span>&nbsp;<span class="op" id="4400758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400763">n</span>&nbsp;<span class="op" id="4400765">:=</span>&nbsp;<span class="builtinfunc" id="4400768">copy</span><span class="op" id="4400772">(</span><span class="ident" id="4400773">b</span><span class="op" id="4400774">,</span>&nbsp;<span class="ident" id="4400776">f</span><span class="op" id="4400777">.</span><span class="ident" id="4400778">toRead</span><span class="op" id="4400784">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400789">f</span><span class="op" id="4400790">.</span><span class="ident" id="4400791">toRead</span>&nbsp;<span class="op" id="4400798">=</span>&nbsp;<span class="ident" id="4400800">f</span><span class="op" id="4400801">.</span><span class="ident" id="4400802">toRead</span><span class="op" id="4400808">[</span><span class="ident" id="4400809">n</span><span class="op" id="4400810">:</span><span class="op" id="4400811">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400816">return</span>&nbsp;<span class="ident" id="4400823">n</span><span class="op" id="4400824">,</span>&nbsp;<span class="ident" id="4400826">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400836">if</span>&nbsp;<span class="ident" id="4400839">f</span><span class="op" id="4400840">.</span><span class="ident" id="4400841">err</span>&nbsp;<span class="op" id="4400845">!=</span>&nbsp;<span class="ident" id="4400848">nil</span>&nbsp;<span class="op" id="4400852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400857">return</span>&nbsp;<span class="num" id="4400864">0</span><span class="op" id="4400865">,</span>&nbsp;<span class="ident" id="4400867">f</span><span class="op" id="4400868">.</span><span class="ident" id="4400869">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4400879">f</span><span class="op" id="4400880">.</span><span class="ident" id="4400881">step</span><span class="op" id="4400885">(</span><span class="ident" id="4400886">f</span><span class="op" id="4400887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400890">}</span><br>
<span class="lineno"></span><span class="op" id="4400892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4400895">func</span>&nbsp;<span class="op" id="4400900">(</span><span class="ident" id="4400901">f</span>&nbsp;<span class="op" id="4400903">*</span><span class="ident" id="4400904">decompressor</span><span class="op" id="4400916">)</span>&nbsp;<span class="ident" id="4400918">Close</span><span class="op" id="4400923">(</span><span class="op" id="4400924">)</span>&nbsp;<span class="builtintype" id="4400926">error</span>&nbsp;<span class="op" id="4400932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400935">if</span>&nbsp;<span class="ident" id="4400938">f</span><span class="op" id="4400939">.</span><span class="ident" id="4400940">err</span>&nbsp;<span class="op" id="4400944">==</span>&nbsp;<span class="ident" id="4400947">io</span><span class="op" id="4400949">.</span><span class="ident" id="4400950">EOF</span>&nbsp;<span class="op" id="4400954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400958">return</span>&nbsp;<span class="ident" id="4400965">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4400970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4400973">return</span>&nbsp;<span class="ident" id="4400980">f</span><span class="op" id="4400981">.</span><span class="ident" id="4400982">err</span><br>
<span class="lineno">295</span><span class="op" id="4400986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4400989">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4401016">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4401059">var</span>&nbsp;<span class="ident" id="4401063">codeOrder</span>&nbsp;<span class="op" id="4401073">=</span>&nbsp;<span class="op" id="4401075">[</span><span class="op" id="4401076">...</span><span class="op" id="4401079">]</span><span class="builtintype" id="4401080">int</span><span class="op" id="4401083">{</span><span class="num" id="4401084">16</span><span class="op" id="4401086">,</span>&nbsp;<span class="num" id="4401088">17</span><span class="op" id="4401090">,</span>&nbsp;<span class="num" id="4401092">18</span><span class="op" id="4401094">,</span>&nbsp;<span class="num" id="4401096">0</span><span class="op" id="4401097">,</span>&nbsp;<span class="num" id="4401099">8</span><span class="op" id="4401100">,</span>&nbsp;<span class="num" id="4401102">7</span><span class="op" id="4401103">,</span>&nbsp;<span class="num" id="4401105">9</span><span class="op" id="4401106">,</span>&nbsp;<span class="num" id="4401108">6</span><span class="op" id="4401109">,</span>&nbsp;<span class="num" id="4401111">10</span><span class="op" id="4401113">,</span>&nbsp;<span class="num" id="4401115">5</span><span class="op" id="4401116">,</span>&nbsp;<span class="num" id="4401118">11</span><span class="op" id="4401120">,</span>&nbsp;<span class="num" id="4401122">4</span><span class="op" id="4401123">,</span>&nbsp;<span class="num" id="4401125">12</span><span class="op" id="4401127">,</span>&nbsp;<span class="num" id="4401129">3</span><span class="op" id="4401130">,</span>&nbsp;<span class="num" id="4401132">13</span><span class="op" id="4401134">,</span>&nbsp;<span class="num" id="4401136">2</span><span class="op" id="4401137">,</span>&nbsp;<span class="num" id="4401139">14</span><span class="op" id="4401141">,</span>&nbsp;<span class="num" id="4401143">1</span><span class="op" id="4401144">,</span>&nbsp;<span class="num" id="4401146">15</span><span class="op" id="4401148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4401151">func</span>&nbsp;<span class="op" id="4401156">(</span><span class="ident" id="4401157">f</span>&nbsp;<span class="op" id="4401159">*</span><span class="ident" id="4401160">decompressor</span><span class="op" id="4401172">)</span>&nbsp;<span class="ident" id="4401174">readHuffman</span><span class="op" id="4401185">(</span><span class="op" id="4401186">)</span>&nbsp;<span class="builtintype" id="4401188">error</span>&nbsp;<span class="op" id="4401194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4401197">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401230">for</span>&nbsp;<span class="ident" id="4401234">f</span><span class="op" id="4401235">.</span><span class="ident" id="4401236">nb</span>&nbsp;<span class="op" id="4401239">&lt;</span>&nbsp;<span class="num" id="4401241">5</span><span class="op" id="4401242">+</span><span class="num" id="4401243">5</span><span class="op" id="4401244">+</span><span class="num" id="4401245">4</span>&nbsp;<span class="op" id="4401247">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401251">if</span>&nbsp;<span class="ident" id="4401254">err</span>&nbsp;<span class="op" id="4401258">:=</span>&nbsp;<span class="ident" id="4401261">f</span><span class="op" id="4401262">.</span><span class="ident" id="4401263">moreBits</span><span class="op" id="4401271">(</span><span class="op" id="4401272">)</span><span class="op" id="4401273">;</span>&nbsp;<span class="ident" id="4401275">err</span>&nbsp;<span class="op" id="4401279">!=</span>&nbsp;<span class="ident" id="4401282">nil</span>&nbsp;<span class="op" id="4401286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401291">return</span>&nbsp;<span class="ident" id="4401298">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401310">nlit</span>&nbsp;<span class="op" id="4401315">:=</span>&nbsp;<span class="builtintype" id="4401318">int</span><span class="op" id="4401321">(</span><span class="ident" id="4401322">f</span><span class="op" id="4401323">.</span><span class="ident" id="4401324">b</span><span class="op" id="4401325">&amp;</span><span class="num" id="4401326">0x1F</span><span class="op" id="4401330">)</span>&nbsp;<span class="op" id="4401332">+</span>&nbsp;<span class="num" id="4401334">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401339">if</span>&nbsp;<span class="ident" id="4401342">nlit</span>&nbsp;<span class="op" id="4401347">&gt;</span>&nbsp;<span class="ident" id="4401349">maxLit</span>&nbsp;<span class="op" id="4401356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401360">return</span>&nbsp;<span class="ident" id="4401367">CorruptInputError</span><span class="op" id="4401384">(</span><span class="ident" id="4401385">f</span><span class="op" id="4401386">.</span><span class="ident" id="4401387">roffset</span><span class="op" id="4401394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401400">f</span><span class="op" id="4401401">.</span><span class="ident" id="4401402">b</span>&nbsp;<span class="op" id="4401404">&gt;&gt;=</span>&nbsp;<span class="num" id="4401408">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401411">ndist</span>&nbsp;<span class="op" id="4401417">:=</span>&nbsp;<span class="builtintype" id="4401420">int</span><span class="op" id="4401423">(</span><span class="ident" id="4401424">f</span><span class="op" id="4401425">.</span><span class="ident" id="4401426">b</span><span class="op" id="4401427">&amp;</span><span class="num" id="4401428">0x1F</span><span class="op" id="4401432">)</span>&nbsp;<span class="op" id="4401434">+</span>&nbsp;<span class="num" id="4401436">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4401439">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401484">f</span><span class="op" id="4401485">.</span><span class="ident" id="4401486">b</span>&nbsp;<span class="op" id="4401488">&gt;&gt;=</span>&nbsp;<span class="num" id="4401492">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401495">nclen</span>&nbsp;<span class="op" id="4401501">:=</span>&nbsp;<span class="builtintype" id="4401504">int</span><span class="op" id="4401507">(</span><span class="ident" id="4401508">f</span><span class="op" id="4401509">.</span><span class="ident" id="4401510">b</span><span class="op" id="4401511">&amp;</span><span class="num" id="4401512">0xF</span><span class="op" id="4401515">)</span>&nbsp;<span class="op" id="4401517">+</span>&nbsp;<span class="num" id="4401519">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4401522">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401568">f</span><span class="op" id="4401569">.</span><span class="ident" id="4401570">b</span>&nbsp;<span class="op" id="4401572">&gt;&gt;=</span>&nbsp;<span class="num" id="4401576">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401579">f</span><span class="op" id="4401580">.</span><span class="ident" id="4401581">nb</span>&nbsp;<span class="op" id="4401584">-=</span>&nbsp;<span class="num" id="4401587">5</span>&nbsp;<span class="op" id="4401589">+</span>&nbsp;<span class="num" id="4401591">5</span>&nbsp;<span class="op" id="4401593">+</span>&nbsp;<span class="num" id="4401595">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4401599">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401664">for</span>&nbsp;<span class="ident" id="4401668">i</span>&nbsp;<span class="op" id="4401670">:=</span>&nbsp;<span class="num" id="4401673">0</span><span class="op" id="4401674">;</span>&nbsp;<span class="ident" id="4401676">i</span>&nbsp;<span class="op" id="4401678">&lt;</span>&nbsp;<span class="ident" id="4401680">nclen</span><span class="op" id="4401685">;</span>&nbsp;<span class="ident" id="4401687">i</span><span class="op" id="4401688">++</span>&nbsp;<span class="op" id="4401691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401695">for</span>&nbsp;<span class="ident" id="4401699">f</span><span class="op" id="4401700">.</span><span class="ident" id="4401701">nb</span>&nbsp;<span class="op" id="4401704">&lt;</span>&nbsp;<span class="num" id="4401706">3</span>&nbsp;<span class="op" id="4401708">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401713">if</span>&nbsp;<span class="ident" id="4401716">err</span>&nbsp;<span class="op" id="4401720">:=</span>&nbsp;<span class="ident" id="4401723">f</span><span class="op" id="4401724">.</span><span class="ident" id="4401725">moreBits</span><span class="op" id="4401733">(</span><span class="op" id="4401734">)</span><span class="op" id="4401735">;</span>&nbsp;<span class="ident" id="4401737">err</span>&nbsp;<span class="op" id="4401741">!=</span>&nbsp;<span class="ident" id="4401744">nil</span>&nbsp;<span class="op" id="4401748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401754">return</span>&nbsp;<span class="ident" id="4401761">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401776">f</span><span class="op" id="4401777">.</span><span class="ident" id="4401778">codebits</span><span class="op" id="4401786">[</span><span class="ident" id="4401787">codeOrder</span><span class="op" id="4401796">[</span><span class="ident" id="4401797">i</span><span class="op" id="4401798">]</span><span class="op" id="4401799">]</span>&nbsp;<span class="op" id="4401801">=</span>&nbsp;<span class="builtintype" id="4401803">int</span><span class="op" id="4401806">(</span><span class="ident" id="4401807">f</span><span class="op" id="4401808">.</span><span class="ident" id="4401809">b</span>&nbsp;<span class="op" id="4401811">&amp;</span>&nbsp;<span class="num" id="4401813">0x7</span><span class="op" id="4401816">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401820">f</span><span class="op" id="4401821">.</span><span class="ident" id="4401822">b</span>&nbsp;<span class="op" id="4401824">&gt;&gt;=</span>&nbsp;<span class="num" id="4401828">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401832">f</span><span class="op" id="4401833">.</span><span class="ident" id="4401834">nb</span>&nbsp;<span class="op" id="4401837">-=</span>&nbsp;<span class="num" id="4401840">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401846">for</span>&nbsp;<span class="ident" id="4401850">i</span>&nbsp;<span class="op" id="4401852">:=</span>&nbsp;<span class="ident" id="4401855">nclen</span><span class="op" id="4401860">;</span>&nbsp;<span class="ident" id="4401862">i</span>&nbsp;<span class="op" id="4401864">&lt;</span>&nbsp;<span class="builtinfunc" id="4401866">len</span><span class="op" id="4401869">(</span><span class="ident" id="4401870">codeOrder</span><span class="op" id="4401879">)</span><span class="op" id="4401880">;</span>&nbsp;<span class="ident" id="4401882">i</span><span class="op" id="4401883">++</span>&nbsp;<span class="op" id="4401886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4401890">f</span><span class="op" id="4401891">.</span><span class="ident" id="4401892">codebits</span><span class="op" id="4401900">[</span><span class="ident" id="4401901">codeOrder</span><span class="op" id="4401910">[</span><span class="ident" id="4401911">i</span><span class="op" id="4401912">]</span><span class="op" id="4401913">]</span>&nbsp;<span class="op" id="4401915">=</span>&nbsp;<span class="num" id="4401917">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401923">if</span>&nbsp;<span class="op" id="4401926">!</span><span class="ident" id="4401927">f</span><span class="op" id="4401928">.</span><span class="ident" id="4401929">h1</span><span class="op" id="4401931">.</span><span class="ident" id="4401932">init</span><span class="op" id="4401936">(</span><span class="ident" id="4401937">f</span><span class="op" id="4401938">.</span><span class="ident" id="4401939">codebits</span><span class="op" id="4401947">[</span><span class="num" id="4401948">0</span><span class="op" id="4401949">:</span><span class="op" id="4401950">]</span><span class="op" id="4401951">)</span>&nbsp;<span class="op" id="4401953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4401957">return</span>&nbsp;<span class="ident" id="4401964">CorruptInputError</span><span class="op" id="4401981">(</span><span class="ident" id="4401982">f</span><span class="op" id="4401983">.</span><span class="ident" id="4401984">roffset</span><span class="op" id="4401991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4401994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4401998">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4402051">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402091">for</span>&nbsp;<span class="ident" id="4402095">i</span><span class="op" id="4402096">,</span>&nbsp;<span class="ident" id="4402098">n</span>&nbsp;<span class="op" id="4402100">:=</span>&nbsp;<span class="num" id="4402103">0</span><span class="op" id="4402104">,</span>&nbsp;<span class="ident" id="4402106">nlit</span><span class="op" id="4402110">+</span><span class="ident" id="4402111">ndist</span><span class="op" id="4402116">;</span>&nbsp;<span class="ident" id="4402118">i</span>&nbsp;<span class="op" id="4402120">&lt;</span>&nbsp;<span class="ident" id="4402122">n</span><span class="op" id="4402123">;</span>&nbsp;<span class="op" id="4402125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402129">x</span><span class="op" id="4402130">,</span>&nbsp;<span class="ident" id="4402132">err</span>&nbsp;<span class="op" id="4402136">:=</span>&nbsp;<span class="ident" id="4402139">f</span><span class="op" id="4402140">.</span><span class="ident" id="4402141">huffSym</span><span class="op" id="4402148">(</span><span class="op" id="4402149">&amp;</span><span class="ident" id="4402150">f</span><span class="op" id="4402151">.</span><span class="ident" id="4402152">h1</span><span class="op" id="4402154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402158">if</span>&nbsp;<span class="ident" id="4402161">err</span>&nbsp;<span class="op" id="4402165">!=</span>&nbsp;<span class="ident" id="4402168">nil</span>&nbsp;<span class="op" id="4402172">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402177">return</span>&nbsp;<span class="ident" id="4402184">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402194">if</span>&nbsp;<span class="ident" id="4402197">x</span>&nbsp;<span class="op" id="4402199">&lt;</span>&nbsp;<span class="num" id="4402201">16</span>&nbsp;<span class="op" id="4402204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4402209">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402230">f</span><span class="op" id="4402231">.</span><span class="ident" id="4402232">bits</span><span class="op" id="4402236">[</span><span class="ident" id="4402237">i</span><span class="op" id="4402238">]</span>&nbsp;<span class="op" id="4402240">=</span>&nbsp;<span class="ident" id="4402242">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402247">i</span><span class="op" id="4402248">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402254">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4402269">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402306">var</span>&nbsp;<span class="ident" id="4402310">rep</span>&nbsp;<span class="builtintype" id="4402314">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402320">var</span>&nbsp;<span class="ident" id="4402324">nb</span>&nbsp;<span class="builtintype" id="4402327">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402334">var</span>&nbsp;<span class="ident" id="4402338">b</span>&nbsp;<span class="builtintype" id="4402340">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402346">switch</span>&nbsp;<span class="ident" id="4402353">x</span>&nbsp;<span class="op" id="4402355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402359">default</span><span class="op" id="4402366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402371">return</span>&nbsp;<span class="ident" id="4402378">InternalError</span><span class="op" id="4402391">(</span><span class="string" id="4402392">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4402416">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402420">case</span>&nbsp;<span class="num" id="4402425">16</span><span class="op" id="4402427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402432">rep</span>&nbsp;<span class="op" id="4402436">=</span>&nbsp;<span class="num" id="4402438">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402443">nb</span>&nbsp;<span class="op" id="4402446">=</span>&nbsp;<span class="num" id="4402448">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402453">if</span>&nbsp;<span class="ident" id="4402456">i</span>&nbsp;<span class="op" id="4402458">==</span>&nbsp;<span class="num" id="4402461">0</span>&nbsp;<span class="op" id="4402463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402469">return</span>&nbsp;<span class="ident" id="4402476">CorruptInputError</span><span class="op" id="4402493">(</span><span class="ident" id="4402494">f</span><span class="op" id="4402495">.</span><span class="ident" id="4402496">roffset</span><span class="op" id="4402503">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402513">b</span>&nbsp;<span class="op" id="4402515">=</span>&nbsp;<span class="ident" id="4402517">f</span><span class="op" id="4402518">.</span><span class="ident" id="4402519">bits</span><span class="op" id="4402523">[</span><span class="ident" id="4402524">i</span><span class="op" id="4402525">-</span><span class="num" id="4402526">1</span><span class="op" id="4402527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402531">case</span>&nbsp;<span class="num" id="4402536">17</span><span class="op" id="4402538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402543">rep</span>&nbsp;<span class="op" id="4402547">=</span>&nbsp;<span class="num" id="4402549">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402554">nb</span>&nbsp;<span class="op" id="4402557">=</span>&nbsp;<span class="num" id="4402559">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402564">b</span>&nbsp;<span class="op" id="4402566">=</span>&nbsp;<span class="num" id="4402568">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402572">case</span>&nbsp;<span class="num" id="4402577">18</span><span class="op" id="4402579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402584">rep</span>&nbsp;<span class="op" id="4402588">=</span>&nbsp;<span class="num" id="4402590">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402596">nb</span>&nbsp;<span class="op" id="4402599">=</span>&nbsp;<span class="num" id="4402601">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402606">b</span>&nbsp;<span class="op" id="4402608">=</span>&nbsp;<span class="num" id="4402610">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402618">for</span>&nbsp;<span class="ident" id="4402622">f</span><span class="op" id="4402623">.</span><span class="ident" id="4402624">nb</span>&nbsp;<span class="op" id="4402627">&lt;</span>&nbsp;<span class="ident" id="4402629">nb</span>&nbsp;<span class="op" id="4402632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402637">if</span>&nbsp;<span class="ident" id="4402640">err</span>&nbsp;<span class="op" id="4402644">:=</span>&nbsp;<span class="ident" id="4402647">f</span><span class="op" id="4402648">.</span><span class="ident" id="4402649">moreBits</span><span class="op" id="4402657">(</span><span class="op" id="4402658">)</span><span class="op" id="4402659">;</span>&nbsp;<span class="ident" id="4402661">err</span>&nbsp;<span class="op" id="4402665">!=</span>&nbsp;<span class="ident" id="4402668">nil</span>&nbsp;<span class="op" id="4402672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402678">return</span>&nbsp;<span class="ident" id="4402685">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402692">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402700">rep</span>&nbsp;<span class="op" id="4402704">+=</span>&nbsp;<span class="builtintype" id="4402707">int</span><span class="op" id="4402710">(</span><span class="ident" id="4402711">f</span><span class="op" id="4402712">.</span><span class="ident" id="4402713">b</span>&nbsp;<span class="op" id="4402715">&amp;</span>&nbsp;<span class="builtintype" id="4402717">uint32</span><span class="op" id="4402723">(</span><span class="num" id="4402724">1</span><span class="op" id="4402725">&lt;&lt;</span><span class="ident" id="4402727">nb</span><span class="op" id="4402729">-</span><span class="num" id="4402730">1</span><span class="op" id="4402731">)</span><span class="op" id="4402732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402736">f</span><span class="op" id="4402737">.</span><span class="ident" id="4402738">b</span>&nbsp;<span class="op" id="4402740">&gt;&gt;=</span>&nbsp;<span class="ident" id="4402744">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402749">f</span><span class="op" id="4402750">.</span><span class="ident" id="4402751">nb</span>&nbsp;<span class="op" id="4402754">-=</span>&nbsp;<span class="ident" id="4402757">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402762">if</span>&nbsp;<span class="ident" id="4402765">i</span><span class="op" id="4402766">+</span><span class="ident" id="4402767">rep</span>&nbsp;<span class="op" id="4402771">&gt;</span>&nbsp;<span class="ident" id="4402773">n</span>&nbsp;<span class="op" id="4402775">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402780">return</span>&nbsp;<span class="ident" id="4402787">CorruptInputError</span><span class="op" id="4402804">(</span><span class="ident" id="4402805">f</span><span class="op" id="4402806">.</span><span class="ident" id="4402807">roffset</span><span class="op" id="4402814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402822">for</span>&nbsp;<span class="ident" id="4402826">j</span>&nbsp;<span class="op" id="4402828">:=</span>&nbsp;<span class="num" id="4402831">0</span><span class="op" id="4402832">;</span>&nbsp;<span class="ident" id="4402834">j</span>&nbsp;<span class="op" id="4402836">&lt;</span>&nbsp;<span class="ident" id="4402838">rep</span><span class="op" id="4402841">;</span>&nbsp;<span class="ident" id="4402843">j</span><span class="op" id="4402844">++</span>&nbsp;<span class="op" id="4402847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402852">f</span><span class="op" id="4402853">.</span><span class="ident" id="4402854">bits</span><span class="op" id="4402858">[</span><span class="ident" id="4402859">i</span><span class="op" id="4402860">]</span>&nbsp;<span class="op" id="4402862">=</span>&nbsp;<span class="ident" id="4402864">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4402869">i</span><span class="op" id="4402870">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402882">if</span>&nbsp;<span class="op" id="4402885">!</span><span class="ident" id="4402886">f</span><span class="op" id="4402887">.</span><span class="ident" id="4402888">h1</span><span class="op" id="4402890">.</span><span class="ident" id="4402891">init</span><span class="op" id="4402895">(</span><span class="ident" id="4402896">f</span><span class="op" id="4402897">.</span><span class="ident" id="4402898">bits</span><span class="op" id="4402902">[</span><span class="num" id="4402903">0</span><span class="op" id="4402904">:</span><span class="ident" id="4402905">nlit</span><span class="op" id="4402909">]</span><span class="op" id="4402910">)</span>&nbsp;<span class="op" id="4402912">||</span>&nbsp;<span class="op" id="4402915">!</span><span class="ident" id="4402916">f</span><span class="op" id="4402917">.</span><span class="ident" id="4402918">h2</span><span class="op" id="4402920">.</span><span class="ident" id="4402921">init</span><span class="op" id="4402925">(</span><span class="ident" id="4402926">f</span><span class="op" id="4402927">.</span><span class="ident" id="4402928">bits</span><span class="op" id="4402932">[</span><span class="ident" id="4402933">nlit</span><span class="op" id="4402937">:</span><span class="ident" id="4402938">nlit</span><span class="op" id="4402942">+</span><span class="ident" id="4402943">ndist</span><span class="op" id="4402948">]</span><span class="op" id="4402949">)</span>&nbsp;<span class="op" id="4402951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402955">return</span>&nbsp;<span class="ident" id="4402962">CorruptInputError</span><span class="op" id="4402979">(</span><span class="ident" id="4402980">f</span><span class="op" id="4402981">.</span><span class="ident" id="4402982">roffset</span><span class="op" id="4402989">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4402996">return</span>&nbsp;<span class="ident" id="4403003">nil</span><br>
<span class="lineno"></span><span class="op" id="4403007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4403010">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4403051">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4403113">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4403180">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4403245">func</span>&nbsp;<span class="op" id="4403250">(</span><span class="ident" id="4403251">f</span>&nbsp;<span class="op" id="4403253">*</span><span class="ident" id="4403254">decompressor</span><span class="op" id="4403266">)</span>&nbsp;<span class="ident" id="4403268">huffmanBlock</span><span class="op" id="4403280">(</span><span class="op" id="4403281">)</span>&nbsp;<span class="op" id="4403283">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403286">for</span>&nbsp;<span class="op" id="4403290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403294">v</span><span class="op" id="4403295">,</span>&nbsp;<span class="ident" id="4403297">err</span>&nbsp;<span class="op" id="4403301">:=</span>&nbsp;<span class="ident" id="4403304">f</span><span class="op" id="4403305">.</span><span class="ident" id="4403306">huffSym</span><span class="op" id="4403313">(</span><span class="ident" id="4403314">f</span><span class="op" id="4403315">.</span><span class="ident" id="4403316">hl</span><span class="op" id="4403318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403322">if</span>&nbsp;<span class="ident" id="4403325">err</span>&nbsp;<span class="op" id="4403329">!=</span>&nbsp;<span class="ident" id="4403332">nil</span>&nbsp;<span class="op" id="4403336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403341">f</span><span class="op" id="4403342">.</span><span class="ident" id="4403343">err</span>&nbsp;<span class="op" id="4403347">=</span>&nbsp;<span class="ident" id="4403349">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403356">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4403365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403369">var</span>&nbsp;<span class="ident" id="4403373">n</span>&nbsp;<span class="builtintype" id="4403375">uint</span>&nbsp;<span class="comment" id="4403380">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403406">var</span>&nbsp;<span class="ident" id="4403410">length</span>&nbsp;<span class="builtintype" id="4403417">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403423">switch</span>&nbsp;<span class="op" id="4403430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403434">case</span>&nbsp;<span class="ident" id="4403439">v</span>&nbsp;<span class="op" id="4403441">&lt;</span>&nbsp;<span class="num" id="4403443">256</span><span class="op" id="4403446">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403451">f</span><span class="op" id="4403452">.</span><span class="ident" id="4403453">hist</span><span class="op" id="4403457">[</span><span class="ident" id="4403458">f</span><span class="op" id="4403459">.</span><span class="ident" id="4403460">hp</span><span class="op" id="4403462">]</span>&nbsp;<span class="op" id="4403464">=</span>&nbsp;<span class="builtintype" id="4403466">byte</span><span class="op" id="4403470">(</span><span class="ident" id="4403471">v</span><span class="op" id="4403472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403477">f</span><span class="op" id="4403478">.</span><span class="ident" id="4403479">hp</span><span class="op" id="4403481">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403487">if</span>&nbsp;<span class="ident" id="4403490">f</span><span class="op" id="4403491">.</span><span class="ident" id="4403492">hp</span>&nbsp;<span class="op" id="4403495">==</span>&nbsp;<span class="builtinfunc" id="4403498">len</span><span class="op" id="4403501">(</span><span class="ident" id="4403502">f</span><span class="op" id="4403503">.</span><span class="ident" id="4403504">hist</span><span class="op" id="4403508">)</span>&nbsp;<span class="op" id="4403510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4403516">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403560">f</span><span class="op" id="4403561">.</span><span class="ident" id="4403562">flush</span><span class="op" id="4403567">(</span><span class="op" id="4403568">(</span><span class="op" id="4403569">*</span><span class="ident" id="4403570">decompressor</span><span class="op" id="4403582">)</span><span class="op" id="4403583">.</span><span class="ident" id="4403584">huffmanBlock</span><span class="op" id="4403596">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403602">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4403612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403617">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403628">case</span>&nbsp;<span class="ident" id="4403633">v</span>&nbsp;<span class="op" id="4403635">==</span>&nbsp;<span class="num" id="4403638">256</span><span class="op" id="4403641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4403646">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403694">f</span><span class="op" id="4403695">.</span><span class="ident" id="4403696">step</span>&nbsp;<span class="op" id="4403701">=</span>&nbsp;<span class="op" id="4403703">(</span><span class="op" id="4403704">*</span><span class="ident" id="4403705">decompressor</span><span class="op" id="4403717">)</span><span class="op" id="4403718">.</span><span class="ident" id="4403719">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403732">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4403741">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403781">case</span>&nbsp;<span class="ident" id="4403786">v</span>&nbsp;<span class="op" id="4403788">&lt;</span>&nbsp;<span class="num" id="4403790">265</span><span class="op" id="4403793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403798">length</span>&nbsp;<span class="op" id="4403805">=</span>&nbsp;<span class="ident" id="4403807">v</span>&nbsp;<span class="op" id="4403809">-</span>&nbsp;<span class="op" id="4403811">(</span><span class="num" id="4403812">257</span>&nbsp;<span class="op" id="4403816">-</span>&nbsp;<span class="num" id="4403818">3</span><span class="op" id="4403819">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403824">n</span>&nbsp;<span class="op" id="4403826">=</span>&nbsp;<span class="num" id="4403828">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403832">case</span>&nbsp;<span class="ident" id="4403837">v</span>&nbsp;<span class="op" id="4403839">&lt;</span>&nbsp;<span class="num" id="4403841">269</span><span class="op" id="4403844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403849">length</span>&nbsp;<span class="op" id="4403856">=</span>&nbsp;<span class="ident" id="4403858">v</span><span class="op" id="4403859">*</span><span class="num" id="4403860">2</span>&nbsp;<span class="op" id="4403862">-</span>&nbsp;<span class="op" id="4403864">(</span><span class="num" id="4403865">265</span><span class="op" id="4403868">*</span><span class="num" id="4403869">2</span>&nbsp;<span class="op" id="4403871">-</span>&nbsp;<span class="num" id="4403873">11</span><span class="op" id="4403875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403880">n</span>&nbsp;<span class="op" id="4403882">=</span>&nbsp;<span class="num" id="4403884">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403888">case</span>&nbsp;<span class="ident" id="4403893">v</span>&nbsp;<span class="op" id="4403895">&lt;</span>&nbsp;<span class="num" id="4403897">273</span><span class="op" id="4403900">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403905">length</span>&nbsp;<span class="op" id="4403912">=</span>&nbsp;<span class="ident" id="4403914">v</span><span class="op" id="4403915">*</span><span class="num" id="4403916">4</span>&nbsp;<span class="op" id="4403918">-</span>&nbsp;<span class="op" id="4403920">(</span><span class="num" id="4403921">269</span><span class="op" id="4403924">*</span><span class="num" id="4403925">4</span>&nbsp;<span class="op" id="4403927">-</span>&nbsp;<span class="num" id="4403929">19</span><span class="op" id="4403931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403936">n</span>&nbsp;<span class="op" id="4403938">=</span>&nbsp;<span class="num" id="4403940">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4403944">case</span>&nbsp;<span class="ident" id="4403949">v</span>&nbsp;<span class="op" id="4403951">&lt;</span>&nbsp;<span class="num" id="4403953">277</span><span class="op" id="4403956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403961">length</span>&nbsp;<span class="op" id="4403968">=</span>&nbsp;<span class="ident" id="4403970">v</span><span class="op" id="4403971">*</span><span class="num" id="4403972">8</span>&nbsp;<span class="op" id="4403974">-</span>&nbsp;<span class="op" id="4403976">(</span><span class="num" id="4403977">273</span><span class="op" id="4403980">*</span><span class="num" id="4403981">8</span>&nbsp;<span class="op" id="4403983">-</span>&nbsp;<span class="num" id="4403985">35</span><span class="op" id="4403987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4403992">n</span>&nbsp;<span class="op" id="4403994">=</span>&nbsp;<span class="num" id="4403996">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404000">case</span>&nbsp;<span class="ident" id="4404005">v</span>&nbsp;<span class="op" id="4404007">&lt;</span>&nbsp;<span class="num" id="4404009">281</span><span class="op" id="4404012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404017">length</span>&nbsp;<span class="op" id="4404024">=</span>&nbsp;<span class="ident" id="4404026">v</span><span class="op" id="4404027">*</span><span class="num" id="4404028">16</span>&nbsp;<span class="op" id="4404031">-</span>&nbsp;<span class="op" id="4404033">(</span><span class="num" id="4404034">277</span><span class="op" id="4404037">*</span><span class="num" id="4404038">16</span>&nbsp;<span class="op" id="4404041">-</span>&nbsp;<span class="num" id="4404043">67</span><span class="op" id="4404045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404050">n</span>&nbsp;<span class="op" id="4404052">=</span>&nbsp;<span class="num" id="4404054">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404058">case</span>&nbsp;<span class="ident" id="4404063">v</span>&nbsp;<span class="op" id="4404065">&lt;</span>&nbsp;<span class="num" id="4404067">285</span><span class="op" id="4404070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404075">length</span>&nbsp;<span class="op" id="4404082">=</span>&nbsp;<span class="ident" id="4404084">v</span><span class="op" id="4404085">*</span><span class="num" id="4404086">32</span>&nbsp;<span class="op" id="4404089">-</span>&nbsp;<span class="op" id="4404091">(</span><span class="num" id="4404092">281</span><span class="op" id="4404095">*</span><span class="num" id="4404096">32</span>&nbsp;<span class="op" id="4404099">-</span>&nbsp;<span class="num" id="4404101">131</span><span class="op" id="4404104">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404109">n</span>&nbsp;<span class="op" id="4404111">=</span>&nbsp;<span class="num" id="4404113">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404117">default</span><span class="op" id="4404124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404129">length</span>&nbsp;<span class="op" id="4404136">=</span>&nbsp;<span class="num" id="4404138">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404145">n</span>&nbsp;<span class="op" id="4404147">=</span>&nbsp;<span class="num" id="4404149">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404153">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404157">if</span>&nbsp;<span class="ident" id="4404160">n</span>&nbsp;<span class="op" id="4404162">&gt;</span>&nbsp;<span class="num" id="4404164">0</span>&nbsp;<span class="op" id="4404166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404171">for</span>&nbsp;<span class="ident" id="4404175">f</span><span class="op" id="4404176">.</span><span class="ident" id="4404177">nb</span>&nbsp;<span class="op" id="4404180">&lt;</span>&nbsp;<span class="ident" id="4404182">n</span>&nbsp;<span class="op" id="4404184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404190">if</span>&nbsp;<span class="ident" id="4404193">err</span>&nbsp;<span class="op" id="4404197">=</span>&nbsp;<span class="ident" id="4404199">f</span><span class="op" id="4404200">.</span><span class="ident" id="4404201">moreBits</span><span class="op" id="4404209">(</span><span class="op" id="4404210">)</span><span class="op" id="4404211">;</span>&nbsp;<span class="ident" id="4404213">err</span>&nbsp;<span class="op" id="4404217">!=</span>&nbsp;<span class="ident" id="4404220">nil</span>&nbsp;<span class="op" id="4404224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404231">f</span><span class="op" id="4404232">.</span><span class="ident" id="4404233">err</span>&nbsp;<span class="op" id="4404237">=</span>&nbsp;<span class="ident" id="4404239">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404248">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404269">length</span>&nbsp;<span class="op" id="4404276">+=</span>&nbsp;<span class="builtintype" id="4404279">int</span><span class="op" id="4404282">(</span><span class="ident" id="4404283">f</span><span class="op" id="4404284">.</span><span class="ident" id="4404285">b</span>&nbsp;<span class="op" id="4404287">&amp;</span>&nbsp;<span class="builtintype" id="4404289">uint32</span><span class="op" id="4404295">(</span><span class="num" id="4404296">1</span><span class="op" id="4404297">&lt;&lt;</span><span class="ident" id="4404299">n</span><span class="op" id="4404300">-</span><span class="num" id="4404301">1</span><span class="op" id="4404302">)</span><span class="op" id="4404303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404308">f</span><span class="op" id="4404309">.</span><span class="ident" id="4404310">b</span>&nbsp;<span class="op" id="4404312">&gt;&gt;=</span>&nbsp;<span class="ident" id="4404316">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404321">f</span><span class="op" id="4404322">.</span><span class="ident" id="4404323">nb</span>&nbsp;<span class="op" id="4404326">-=</span>&nbsp;<span class="ident" id="4404329">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404338">var</span>&nbsp;<span class="ident" id="4404342">dist</span>&nbsp;<span class="builtintype" id="4404347">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404353">if</span>&nbsp;<span class="ident" id="4404356">f</span><span class="op" id="4404357">.</span><span class="ident" id="4404358">hd</span>&nbsp;<span class="op" id="4404361">==</span>&nbsp;<span class="ident" id="4404364">nil</span>&nbsp;<span class="op" id="4404368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404373">for</span>&nbsp;<span class="ident" id="4404377">f</span><span class="op" id="4404378">.</span><span class="ident" id="4404379">nb</span>&nbsp;<span class="op" id="4404382">&lt;</span>&nbsp;<span class="num" id="4404384">5</span>&nbsp;<span class="op" id="4404386">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404392">if</span>&nbsp;<span class="ident" id="4404395">err</span>&nbsp;<span class="op" id="4404399">=</span>&nbsp;<span class="ident" id="4404401">f</span><span class="op" id="4404402">.</span><span class="ident" id="4404403">moreBits</span><span class="op" id="4404411">(</span><span class="op" id="4404412">)</span><span class="op" id="4404413">;</span>&nbsp;<span class="ident" id="4404415">err</span>&nbsp;<span class="op" id="4404419">!=</span>&nbsp;<span class="ident" id="4404422">nil</span>&nbsp;<span class="op" id="4404426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404433">f</span><span class="op" id="4404434">.</span><span class="ident" id="4404435">err</span>&nbsp;<span class="op" id="4404439">=</span>&nbsp;<span class="ident" id="4404441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404466">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404471">dist</span>&nbsp;<span class="op" id="4404476">=</span>&nbsp;<span class="builtintype" id="4404478">int</span><span class="op" id="4404481">(</span><span class="ident" id="4404482">reverseByte</span><span class="op" id="4404493">[</span><span class="op" id="4404494">(</span><span class="ident" id="4404495">f</span><span class="op" id="4404496">.</span><span class="ident" id="4404497">b</span><span class="op" id="4404498">&amp;</span><span class="num" id="4404499">0x1F</span><span class="op" id="4404503">)</span><span class="op" id="4404504">&lt;&lt;</span><span class="num" id="4404506">3</span><span class="op" id="4404507">]</span><span class="op" id="4404508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404513">f</span><span class="op" id="4404514">.</span><span class="ident" id="4404515">b</span>&nbsp;<span class="op" id="4404517">&gt;&gt;=</span>&nbsp;<span class="num" id="4404521">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404526">f</span><span class="op" id="4404527">.</span><span class="ident" id="4404528">nb</span>&nbsp;<span class="op" id="4404531">-=</span>&nbsp;<span class="num" id="4404534">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404538">}</span>&nbsp;<span class="keyword" id="4404540">else</span>&nbsp;<span class="op" id="4404545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404550">if</span>&nbsp;<span class="ident" id="4404553">dist</span><span class="op" id="4404557">,</span>&nbsp;<span class="ident" id="4404559">err</span>&nbsp;<span class="op" id="4404563">=</span>&nbsp;<span class="ident" id="4404565">f</span><span class="op" id="4404566">.</span><span class="ident" id="4404567">huffSym</span><span class="op" id="4404574">(</span><span class="ident" id="4404575">f</span><span class="op" id="4404576">.</span><span class="ident" id="4404577">hd</span><span class="op" id="4404579">)</span><span class="op" id="4404580">;</span>&nbsp;<span class="ident" id="4404582">err</span>&nbsp;<span class="op" id="4404586">!=</span>&nbsp;<span class="ident" id="4404589">nil</span>&nbsp;<span class="op" id="4404593">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404599">f</span><span class="op" id="4404600">.</span><span class="ident" id="4404601">err</span>&nbsp;<span class="op" id="4404605">=</span>&nbsp;<span class="ident" id="4404607">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404615">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404634">switch</span>&nbsp;<span class="op" id="4404641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404645">case</span>&nbsp;<span class="ident" id="4404650">dist</span>&nbsp;<span class="op" id="4404655">&lt;</span>&nbsp;<span class="num" id="4404657">4</span><span class="op" id="4404658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404663">dist</span><span class="op" id="4404667">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404672">case</span>&nbsp;<span class="ident" id="4404677">dist</span>&nbsp;<span class="op" id="4404682">&gt;=</span>&nbsp;<span class="num" id="4404685">30</span><span class="op" id="4404687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404692">f</span><span class="op" id="4404693">.</span><span class="ident" id="4404694">err</span>&nbsp;<span class="op" id="4404698">=</span>&nbsp;<span class="ident" id="4404700">CorruptInputError</span><span class="op" id="4404717">(</span><span class="ident" id="4404718">f</span><span class="op" id="4404719">.</span><span class="ident" id="4404720">roffset</span><span class="op" id="4404727">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404732">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404741">default</span><span class="op" id="4404748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404753">nb</span>&nbsp;<span class="op" id="4404756">:=</span>&nbsp;<span class="builtintype" id="4404759">uint</span><span class="op" id="4404763">(</span><span class="ident" id="4404764">dist</span><span class="op" id="4404768">-</span><span class="num" id="4404769">2</span><span class="op" id="4404770">)</span>&nbsp;<span class="op" id="4404772">&gt;&gt;</span>&nbsp;<span class="num" id="4404775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4404780">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404830">extra</span>&nbsp;<span class="op" id="4404836">:=</span>&nbsp;<span class="op" id="4404839">(</span><span class="ident" id="4404840">dist</span>&nbsp;<span class="op" id="4404845">&amp;</span>&nbsp;<span class="num" id="4404847">1</span><span class="op" id="4404848">)</span>&nbsp;<span class="op" id="4404850">&lt;&lt;</span>&nbsp;<span class="ident" id="4404853">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404859">for</span>&nbsp;<span class="ident" id="4404863">f</span><span class="op" id="4404864">.</span><span class="ident" id="4404865">nb</span>&nbsp;<span class="op" id="4404868">&lt;</span>&nbsp;<span class="ident" id="4404870">nb</span>&nbsp;<span class="op" id="4404873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404879">if</span>&nbsp;<span class="ident" id="4404882">err</span>&nbsp;<span class="op" id="4404886">=</span>&nbsp;<span class="ident" id="4404888">f</span><span class="op" id="4404889">.</span><span class="ident" id="4404890">moreBits</span><span class="op" id="4404898">(</span><span class="op" id="4404899">)</span><span class="op" id="4404900">;</span>&nbsp;<span class="ident" id="4404902">err</span>&nbsp;<span class="op" id="4404906">!=</span>&nbsp;<span class="ident" id="4404909">nil</span>&nbsp;<span class="op" id="4404913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404920">f</span><span class="op" id="4404921">.</span><span class="ident" id="4404922">err</span>&nbsp;<span class="op" id="4404926">=</span>&nbsp;<span class="ident" id="4404928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4404937">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404948">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4404953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404958">extra</span>&nbsp;<span class="op" id="4404964">|=</span>&nbsp;<span class="builtintype" id="4404967">int</span><span class="op" id="4404970">(</span><span class="ident" id="4404971">f</span><span class="op" id="4404972">.</span><span class="ident" id="4404973">b</span>&nbsp;<span class="op" id="4404975">&amp;</span>&nbsp;<span class="builtintype" id="4404977">uint32</span><span class="op" id="4404983">(</span><span class="num" id="4404984">1</span><span class="op" id="4404985">&lt;&lt;</span><span class="ident" id="4404987">nb</span><span class="op" id="4404989">-</span><span class="num" id="4404990">1</span><span class="op" id="4404991">)</span><span class="op" id="4404992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4404997">f</span><span class="op" id="4404998">.</span><span class="ident" id="4404999">b</span>&nbsp;<span class="op" id="4405001">&gt;&gt;=</span>&nbsp;<span class="ident" id="4405005">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405011">f</span><span class="op" id="4405012">.</span><span class="ident" id="4405013">nb</span>&nbsp;<span class="op" id="4405016">-=</span>&nbsp;<span class="ident" id="4405019">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405025">dist</span>&nbsp;<span class="op" id="4405030">=</span>&nbsp;<span class="num" id="4405032">1</span><span class="op" id="4405033">&lt;&lt;</span><span class="op" id="4405035">(</span><span class="ident" id="4405036">nb</span><span class="op" id="4405038">+</span><span class="num" id="4405039">1</span><span class="op" id="4405040">)</span>&nbsp;<span class="op" id="4405042">+</span>&nbsp;<span class="num" id="4405044">1</span>&nbsp;<span class="op" id="4405046">+</span>&nbsp;<span class="ident" id="4405048">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4405061">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405112">if</span>&nbsp;<span class="ident" id="4405115">dist</span>&nbsp;<span class="op" id="4405120">&gt;</span>&nbsp;<span class="builtinfunc" id="4405122">len</span><span class="op" id="4405125">(</span><span class="ident" id="4405126">f</span><span class="op" id="4405127">.</span><span class="ident" id="4405128">hist</span><span class="op" id="4405132">)</span>&nbsp;<span class="op" id="4405134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405139">f</span><span class="op" id="4405140">.</span><span class="ident" id="4405141">err</span>&nbsp;<span class="op" id="4405145">=</span>&nbsp;<span class="ident" id="4405147">InternalError</span><span class="op" id="4405160">(</span><span class="string" id="4405161">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4405183">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4405202">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405254">if</span>&nbsp;<span class="op" id="4405257">!</span><span class="ident" id="4405258">f</span><span class="op" id="4405259">.</span><span class="ident" id="4405260">hfull</span>&nbsp;<span class="op" id="4405266">&amp;&amp;</span>&nbsp;<span class="ident" id="4405269">dist</span>&nbsp;<span class="op" id="4405274">&gt;</span>&nbsp;<span class="ident" id="4405276">f</span><span class="op" id="4405277">.</span><span class="ident" id="4405278">hp</span>&nbsp;<span class="op" id="4405281">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405286">f</span><span class="op" id="4405287">.</span><span class="ident" id="4405288">err</span>&nbsp;<span class="op" id="4405292">=</span>&nbsp;<span class="ident" id="4405294">CorruptInputError</span><span class="op" id="4405311">(</span><span class="ident" id="4405312">f</span><span class="op" id="4405313">.</span><span class="ident" id="4405314">roffset</span><span class="op" id="4405321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405326">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405340">f</span><span class="op" id="4405341">.</span><span class="ident" id="4405342">copyLen</span><span class="op" id="4405349">,</span>&nbsp;<span class="ident" id="4405351">f</span><span class="op" id="4405352">.</span><span class="ident" id="4405353">copyDist</span>&nbsp;<span class="op" id="4405362">=</span>&nbsp;<span class="ident" id="4405364">length</span><span class="op" id="4405370">,</span>&nbsp;<span class="ident" id="4405372">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405379">if</span>&nbsp;<span class="ident" id="4405382">f</span><span class="op" id="4405383">.</span><span class="ident" id="4405384">copyHist</span><span class="op" id="4405392">(</span><span class="op" id="4405393">)</span>&nbsp;<span class="op" id="4405395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405400">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405412">}</span><br>
<span class="lineno"></span><span class="op" id="4405414">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4405417">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4405498">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4405547">func</span>&nbsp;<span class="op" id="4405552">(</span><span class="ident" id="4405553">f</span>&nbsp;<span class="op" id="4405555">*</span><span class="ident" id="4405556">decompressor</span><span class="op" id="4405568">)</span>&nbsp;<span class="ident" id="4405570">copyHist</span><span class="op" id="4405578">(</span><span class="op" id="4405579">)</span>&nbsp;<span class="builtintype" id="4405581">bool</span>&nbsp;<span class="op" id="4405586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405589">p</span>&nbsp;<span class="op" id="4405591">:=</span>&nbsp;<span class="ident" id="4405594">f</span><span class="op" id="4405595">.</span><span class="ident" id="4405596">hp</span>&nbsp;<span class="op" id="4405599">-</span>&nbsp;<span class="ident" id="4405601">f</span><span class="op" id="4405602">.</span><span class="ident" id="4405603">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405613">if</span>&nbsp;<span class="ident" id="4405616">p</span>&nbsp;<span class="op" id="4405618">&lt;</span>&nbsp;<span class="num" id="4405620">0</span>&nbsp;<span class="op" id="4405622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405626">p</span>&nbsp;<span class="op" id="4405628">+=</span>&nbsp;<span class="builtinfunc" id="4405631">len</span><span class="op" id="4405634">(</span><span class="ident" id="4405635">f</span><span class="op" id="4405636">.</span><span class="ident" id="4405637">hist</span><span class="op" id="4405641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405647">for</span>&nbsp;<span class="ident" id="4405651">f</span><span class="op" id="4405652">.</span><span class="ident" id="4405653">copyLen</span>&nbsp;<span class="op" id="4405661">&gt;</span>&nbsp;<span class="num" id="4405663">0</span>&nbsp;<span class="op" id="4405665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405669">n</span>&nbsp;<span class="op" id="4405671">:=</span>&nbsp;<span class="ident" id="4405674">f</span><span class="op" id="4405675">.</span><span class="ident" id="4405676">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405686">if</span>&nbsp;<span class="ident" id="4405689">x</span>&nbsp;<span class="op" id="4405691">:=</span>&nbsp;<span class="builtinfunc" id="4405694">len</span><span class="op" id="4405697">(</span><span class="ident" id="4405698">f</span><span class="op" id="4405699">.</span><span class="ident" id="4405700">hist</span><span class="op" id="4405704">)</span>&nbsp;<span class="op" id="4405706">-</span>&nbsp;<span class="ident" id="4405708">f</span><span class="op" id="4405709">.</span><span class="ident" id="4405710">hp</span><span class="op" id="4405712">;</span>&nbsp;<span class="ident" id="4405714">n</span>&nbsp;<span class="op" id="4405716">&gt;</span>&nbsp;<span class="ident" id="4405718">x</span>&nbsp;<span class="op" id="4405720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405725">n</span>&nbsp;<span class="op" id="4405727">=</span>&nbsp;<span class="ident" id="4405729">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405737">if</span>&nbsp;<span class="ident" id="4405740">x</span>&nbsp;<span class="op" id="4405742">:=</span>&nbsp;<span class="builtinfunc" id="4405745">len</span><span class="op" id="4405748">(</span><span class="ident" id="4405749">f</span><span class="op" id="4405750">.</span><span class="ident" id="4405751">hist</span><span class="op" id="4405755">)</span>&nbsp;<span class="op" id="4405757">-</span>&nbsp;<span class="ident" id="4405759">p</span><span class="op" id="4405760">;</span>&nbsp;<span class="ident" id="4405762">n</span>&nbsp;<span class="op" id="4405764">&gt;</span>&nbsp;<span class="ident" id="4405766">x</span>&nbsp;<span class="op" id="4405768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405773">n</span>&nbsp;<span class="op" id="4405775">=</span>&nbsp;<span class="ident" id="4405777">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405785">forwardCopy</span><span class="op" id="4405796">(</span><span class="ident" id="4405797">f</span><span class="op" id="4405798">.</span><span class="ident" id="4405799">hist</span><span class="op" id="4405803">[</span><span class="op" id="4405804">:</span><span class="op" id="4405805">]</span><span class="op" id="4405806">,</span>&nbsp;<span class="ident" id="4405808">f</span><span class="op" id="4405809">.</span><span class="ident" id="4405810">hp</span><span class="op" id="4405812">,</span>&nbsp;<span class="ident" id="4405814">p</span><span class="op" id="4405815">,</span>&nbsp;<span class="ident" id="4405817">n</span><span class="op" id="4405818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405822">p</span>&nbsp;<span class="op" id="4405824">+=</span>&nbsp;<span class="ident" id="4405827">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405831">f</span><span class="op" id="4405832">.</span><span class="ident" id="4405833">hp</span>&nbsp;<span class="op" id="4405836">+=</span>&nbsp;<span class="ident" id="4405839">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405843">f</span><span class="op" id="4405844">.</span><span class="ident" id="4405845">copyLen</span>&nbsp;<span class="op" id="4405853">-=</span>&nbsp;<span class="ident" id="4405856">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405860">if</span>&nbsp;<span class="ident" id="4405863">f</span><span class="op" id="4405864">.</span><span class="ident" id="4405865">hp</span>&nbsp;<span class="op" id="4405868">==</span>&nbsp;<span class="builtinfunc" id="4405871">len</span><span class="op" id="4405874">(</span><span class="ident" id="4405875">f</span><span class="op" id="4405876">.</span><span class="ident" id="4405877">hist</span><span class="op" id="4405881">)</span>&nbsp;<span class="op" id="4405883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4405888">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405939">f</span><span class="op" id="4405940">.</span><span class="ident" id="4405941">flush</span><span class="op" id="4405946">(</span><span class="op" id="4405947">(</span><span class="op" id="4405948">*</span><span class="ident" id="4405949">decompressor</span><span class="op" id="4405961">)</span><span class="op" id="4405962">.</span><span class="ident" id="4405963">copyHuff</span><span class="op" id="4405971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405976">return</span>&nbsp;<span class="builtintype" id="4405983">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405990">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405994">if</span>&nbsp;<span class="ident" id="4405997">p</span>&nbsp;<span class="op" id="4405999">==</span>&nbsp;<span class="builtinfunc" id="4406002">len</span><span class="op" id="4406005">(</span><span class="ident" id="4406006">f</span><span class="op" id="4406007">.</span><span class="ident" id="4406008">hist</span><span class="op" id="4406012">)</span>&nbsp;<span class="op" id="4406014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406019">p</span>&nbsp;<span class="op" id="4406021">=</span>&nbsp;<span class="num" id="4406023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406033">return</span>&nbsp;<span class="builtintype" id="4406040">false</span><br>
<span class="lineno">550</span><span class="op" id="4406046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4406049">func</span>&nbsp;<span class="op" id="4406054">(</span><span class="ident" id="4406055">f</span>&nbsp;<span class="op" id="4406057">*</span><span class="ident" id="4406058">decompressor</span><span class="op" id="4406070">)</span>&nbsp;<span class="ident" id="4406072">copyHuff</span><span class="op" id="4406080">(</span><span class="op" id="4406081">)</span>&nbsp;<span class="op" id="4406083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406086">if</span>&nbsp;<span class="ident" id="4406089">f</span><span class="op" id="4406090">.</span><span class="ident" id="4406091">copyHist</span><span class="op" id="4406099">(</span><span class="op" id="4406100">)</span>&nbsp;<span class="op" id="4406102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406106">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406117">f</span><span class="op" id="4406118">.</span><span class="ident" id="4406119">huffmanBlock</span><span class="op" id="4406131">(</span><span class="op" id="4406132">)</span><br>
<span class="lineno"></span><span class="op" id="4406134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4406137">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4406200">func</span>&nbsp;<span class="op" id="4406205">(</span><span class="ident" id="4406206">f</span>&nbsp;<span class="op" id="4406208">*</span><span class="ident" id="4406209">decompressor</span><span class="op" id="4406221">)</span>&nbsp;<span class="ident" id="4406223">dataBlock</span><span class="op" id="4406232">(</span><span class="op" id="4406233">)</span>&nbsp;<span class="op" id="4406235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406238">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406256">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406287">f</span><span class="op" id="4406288">.</span><span class="ident" id="4406289">nb</span>&nbsp;<span class="op" id="4406292">=</span>&nbsp;<span class="num" id="4406294">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406297">f</span><span class="op" id="4406298">.</span><span class="ident" id="4406299">b</span>&nbsp;<span class="op" id="4406301">=</span>&nbsp;<span class="num" id="4406303">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406307">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406350">nr</span><span class="op" id="4406352">,</span>&nbsp;<span class="ident" id="4406354">err</span>&nbsp;<span class="op" id="4406358">:=</span>&nbsp;<span class="ident" id="4406361">io</span><span class="op" id="4406363">.</span><span class="ident" id="4406364">ReadFull</span><span class="op" id="4406372">(</span><span class="ident" id="4406373">f</span><span class="op" id="4406374">.</span><span class="ident" id="4406375">r</span><span class="op" id="4406376">,</span>&nbsp;<span class="ident" id="4406378">f</span><span class="op" id="4406379">.</span><span class="ident" id="4406380">buf</span><span class="op" id="4406383">[</span><span class="num" id="4406384">0</span><span class="op" id="4406385">:</span><span class="num" id="4406386">4</span><span class="op" id="4406387">]</span><span class="op" id="4406388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406391">f</span><span class="op" id="4406392">.</span><span class="ident" id="4406393">roffset</span>&nbsp;<span class="op" id="4406401">+=</span>&nbsp;<span class="ident" id="4406404">int64</span><span class="op" id="4406409">(</span><span class="ident" id="4406410">nr</span><span class="op" id="4406412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406415">if</span>&nbsp;<span class="ident" id="4406418">err</span>&nbsp;<span class="op" id="4406422">!=</span>&nbsp;<span class="ident" id="4406425">nil</span>&nbsp;<span class="op" id="4406429">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406433">f</span><span class="op" id="4406434">.</span><span class="ident" id="4406435">err</span>&nbsp;<span class="op" id="4406439">=</span>&nbsp;<span class="op" id="4406441">&amp;</span><span class="ident" id="4406442">ReadError</span><span class="op" id="4406451">{</span><span class="ident" id="4406452">f</span><span class="op" id="4406453">.</span><span class="ident" id="4406454">roffset</span><span class="op" id="4406461">,</span>&nbsp;<span class="ident" id="4406463">err</span><span class="op" id="4406466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406470">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406481">n</span>&nbsp;<span class="op" id="4406483">:=</span>&nbsp;<span class="builtintype" id="4406486">int</span><span class="op" id="4406489">(</span><span class="ident" id="4406490">f</span><span class="op" id="4406491">.</span><span class="ident" id="4406492">buf</span><span class="op" id="4406495">[</span><span class="num" id="4406496">0</span><span class="op" id="4406497">]</span><span class="op" id="4406498">)</span>&nbsp;<span class="op" id="4406500">|</span>&nbsp;<span class="builtintype" id="4406502">int</span><span class="op" id="4406505">(</span><span class="ident" id="4406506">f</span><span class="op" id="4406507">.</span><span class="ident" id="4406508">buf</span><span class="op" id="4406511">[</span><span class="num" id="4406512">1</span><span class="op" id="4406513">]</span><span class="op" id="4406514">)</span><span class="op" id="4406515">&lt;&lt;</span><span class="num" id="4406517">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406520">nn</span>&nbsp;<span class="op" id="4406523">:=</span>&nbsp;<span class="builtintype" id="4406526">int</span><span class="op" id="4406529">(</span><span class="ident" id="4406530">f</span><span class="op" id="4406531">.</span><span class="ident" id="4406532">buf</span><span class="op" id="4406535">[</span><span class="num" id="4406536">2</span><span class="op" id="4406537">]</span><span class="op" id="4406538">)</span>&nbsp;<span class="op" id="4406540">|</span>&nbsp;<span class="builtintype" id="4406542">int</span><span class="op" id="4406545">(</span><span class="ident" id="4406546">f</span><span class="op" id="4406547">.</span><span class="ident" id="4406548">buf</span><span class="op" id="4406551">[</span><span class="num" id="4406552">3</span><span class="op" id="4406553">]</span><span class="op" id="4406554">)</span><span class="op" id="4406555">&lt;&lt;</span><span class="num" id="4406557">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406560">if</span>&nbsp;<span class="builtintype" id="4406563">uint16</span><span class="op" id="4406569">(</span><span class="ident" id="4406570">nn</span><span class="op" id="4406572">)</span>&nbsp;<span class="op" id="4406574">!=</span>&nbsp;<span class="builtintype" id="4406577">uint16</span><span class="op" id="4406583">(</span><span class="op" id="4406584">^</span><span class="ident" id="4406585">n</span><span class="op" id="4406586">)</span>&nbsp;<span class="op" id="4406588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406592">f</span><span class="op" id="4406593">.</span><span class="ident" id="4406594">err</span>&nbsp;<span class="op" id="4406598">=</span>&nbsp;<span class="ident" id="4406600">CorruptInputError</span><span class="op" id="4406617">(</span><span class="ident" id="4406618">f</span><span class="op" id="4406619">.</span><span class="ident" id="4406620">roffset</span><span class="op" id="4406627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406631">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406643">if</span>&nbsp;<span class="ident" id="4406646">n</span>&nbsp;<span class="op" id="4406648">==</span>&nbsp;<span class="num" id="4406651">0</span>&nbsp;<span class="op" id="4406653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406657">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406688">f</span><span class="op" id="4406689">.</span><span class="ident" id="4406690">flush</span><span class="op" id="4406695">(</span><span class="op" id="4406696">(</span><span class="op" id="4406697">*</span><span class="ident" id="4406698">decompressor</span><span class="op" id="4406710">)</span><span class="op" id="4406711">.</span><span class="ident" id="4406712">nextBlock</span><span class="op" id="4406721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406725">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406733">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406737">f</span><span class="op" id="4406738">.</span><span class="ident" id="4406739">copyLen</span>&nbsp;<span class="op" id="4406747">=</span>&nbsp;<span class="ident" id="4406749">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406752">f</span><span class="op" id="4406753">.</span><span class="ident" id="4406754">copyData</span><span class="op" id="4406762">(</span><span class="op" id="4406763">)</span><br>
<span class="lineno"></span><span class="op" id="4406765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4406768">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4406843">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4406887">func</span>&nbsp;<span class="op" id="4406892">(</span><span class="ident" id="4406893">f</span>&nbsp;<span class="op" id="4406895">*</span><span class="ident" id="4406896">decompressor</span><span class="op" id="4406908">)</span>&nbsp;<span class="ident" id="4406910">copyData</span><span class="op" id="4406918">(</span><span class="op" id="4406919">)</span>&nbsp;<span class="op" id="4406921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406924">n</span>&nbsp;<span class="op" id="4406926">:=</span>&nbsp;<span class="ident" id="4406929">f</span><span class="op" id="4406930">.</span><span class="ident" id="4406931">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406940">for</span>&nbsp;<span class="ident" id="4406944">n</span>&nbsp;<span class="op" id="4406946">&gt;</span>&nbsp;<span class="num" id="4406948">0</span>&nbsp;<span class="op" id="4406950">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406954">m</span>&nbsp;<span class="op" id="4406956">:=</span>&nbsp;<span class="builtinfunc" id="4406959">len</span><span class="op" id="4406962">(</span><span class="ident" id="4406963">f</span><span class="op" id="4406964">.</span><span class="ident" id="4406965">hist</span><span class="op" id="4406969">)</span>&nbsp;<span class="op" id="4406971">-</span>&nbsp;<span class="ident" id="4406973">f</span><span class="op" id="4406974">.</span><span class="ident" id="4406975">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406980">if</span>&nbsp;<span class="ident" id="4406983">m</span>&nbsp;<span class="op" id="4406985">&gt;</span>&nbsp;<span class="ident" id="4406987">n</span>&nbsp;<span class="op" id="4406989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406994">m</span>&nbsp;<span class="op" id="4406996">=</span>&nbsp;<span class="ident" id="4406998">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407006">m</span><span class="op" id="4407007">,</span>&nbsp;<span class="ident" id="4407009">err</span>&nbsp;<span class="op" id="4407013">:=</span>&nbsp;<span class="ident" id="4407016">io</span><span class="op" id="4407018">.</span><span class="ident" id="4407019">ReadFull</span><span class="op" id="4407027">(</span><span class="ident" id="4407028">f</span><span class="op" id="4407029">.</span><span class="ident" id="4407030">r</span><span class="op" id="4407031">,</span>&nbsp;<span class="ident" id="4407033">f</span><span class="op" id="4407034">.</span><span class="ident" id="4407035">hist</span><span class="op" id="4407039">[</span><span class="ident" id="4407040">f</span><span class="op" id="4407041">.</span><span class="ident" id="4407042">hp</span><span class="op" id="4407044">:</span><span class="ident" id="4407045">f</span><span class="op" id="4407046">.</span><span class="ident" id="4407047">hp</span><span class="op" id="4407049">+</span><span class="ident" id="4407050">m</span><span class="op" id="4407051">]</span><span class="op" id="4407052">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407056">f</span><span class="op" id="4407057">.</span><span class="ident" id="4407058">roffset</span>&nbsp;<span class="op" id="4407066">+=</span>&nbsp;<span class="ident" id="4407069">int64</span><span class="op" id="4407074">(</span><span class="ident" id="4407075">m</span><span class="op" id="4407076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407080">if</span>&nbsp;<span class="ident" id="4407083">err</span>&nbsp;<span class="op" id="4407087">!=</span>&nbsp;<span class="ident" id="4407090">nil</span>&nbsp;<span class="op" id="4407094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407099">f</span><span class="op" id="4407100">.</span><span class="ident" id="4407101">err</span>&nbsp;<span class="op" id="4407105">=</span>&nbsp;<span class="op" id="4407107">&amp;</span><span class="ident" id="4407108">ReadError</span><span class="op" id="4407117">{</span><span class="ident" id="4407118">f</span><span class="op" id="4407119">.</span><span class="ident" id="4407120">roffset</span><span class="op" id="4407127">,</span>&nbsp;<span class="ident" id="4407129">err</span><span class="op" id="4407132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407137">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407146">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407150">n</span>&nbsp;<span class="op" id="4407152">-=</span>&nbsp;<span class="ident" id="4407155">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407159">f</span><span class="op" id="4407160">.</span><span class="ident" id="4407161">hp</span>&nbsp;<span class="op" id="4407164">+=</span>&nbsp;<span class="ident" id="4407167">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407171">if</span>&nbsp;<span class="ident" id="4407174">f</span><span class="op" id="4407175">.</span><span class="ident" id="4407176">hp</span>&nbsp;<span class="op" id="4407179">==</span>&nbsp;<span class="builtinfunc" id="4407182">len</span><span class="op" id="4407185">(</span><span class="ident" id="4407186">f</span><span class="op" id="4407187">.</span><span class="ident" id="4407188">hist</span><span class="op" id="4407192">)</span>&nbsp;<span class="op" id="4407194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407199">f</span><span class="op" id="4407200">.</span><span class="ident" id="4407201">copyLen</span>&nbsp;<span class="op" id="4407209">=</span>&nbsp;<span class="ident" id="4407211">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407216">f</span><span class="op" id="4407217">.</span><span class="ident" id="4407218">flush</span><span class="op" id="4407223">(</span><span class="op" id="4407224">(</span><span class="op" id="4407225">*</span><span class="ident" id="4407226">decompressor</span><span class="op" id="4407238">)</span><span class="op" id="4407239">.</span><span class="ident" id="4407240">copyData</span><span class="op" id="4407248">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407253">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407268">f</span><span class="op" id="4407269">.</span><span class="ident" id="4407270">step</span>&nbsp;<span class="op" id="4407275">=</span>&nbsp;<span class="op" id="4407277">(</span><span class="op" id="4407278">*</span><span class="ident" id="4407279">decompressor</span><span class="op" id="4407291">)</span><span class="op" id="4407292">.</span><span class="ident" id="4407293">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4407303">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4407306">func</span>&nbsp;<span class="op" id="4407311">(</span><span class="ident" id="4407312">f</span>&nbsp;<span class="op" id="4407314">*</span><span class="ident" id="4407315">decompressor</span><span class="op" id="4407327">)</span>&nbsp;<span class="ident" id="4407329">setDict</span><span class="op" id="4407336">(</span><span class="ident" id="4407337">dict</span>&nbsp;<span class="op" id="4407342">[</span><span class="op" id="4407343">]</span><span class="builtintype" id="4407344">byte</span><span class="op" id="4407348">)</span>&nbsp;<span class="op" id="4407350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407353">if</span>&nbsp;<span class="builtinfunc" id="4407356">len</span><span class="op" id="4407359">(</span><span class="ident" id="4407360">dict</span><span class="op" id="4407364">)</span>&nbsp;<span class="op" id="4407366">&gt;</span>&nbsp;<span class="builtinfunc" id="4407368">len</span><span class="op" id="4407371">(</span><span class="ident" id="4407372">f</span><span class="op" id="4407373">.</span><span class="ident" id="4407374">hist</span><span class="op" id="4407378">)</span>&nbsp;<span class="op" id="4407380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4407384">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407418">dict</span>&nbsp;<span class="op" id="4407423">=</span>&nbsp;<span class="ident" id="4407425">dict</span><span class="op" id="4407429">[</span><span class="builtinfunc" id="4407430">len</span><span class="op" id="4407433">(</span><span class="ident" id="4407434">dict</span><span class="op" id="4407438">)</span><span class="op" id="4407439">-</span><span class="builtinfunc" id="4407440">len</span><span class="op" id="4407443">(</span><span class="ident" id="4407444">f</span><span class="op" id="4407445">.</span><span class="ident" id="4407446">hist</span><span class="op" id="4407450">)</span><span class="op" id="4407451">:</span><span class="op" id="4407452">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407459">f</span><span class="op" id="4407460">.</span><span class="ident" id="4407461">hp</span>&nbsp;<span class="op" id="4407464">=</span>&nbsp;<span class="builtinfunc" id="4407466">copy</span><span class="op" id="4407470">(</span><span class="ident" id="4407471">f</span><span class="op" id="4407472">.</span><span class="ident" id="4407473">hist</span><span class="op" id="4407477">[</span><span class="op" id="4407478">:</span><span class="op" id="4407479">]</span><span class="op" id="4407480">,</span>&nbsp;<span class="ident" id="4407482">dict</span><span class="op" id="4407486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407489">if</span>&nbsp;<span class="ident" id="4407492">f</span><span class="op" id="4407493">.</span><span class="ident" id="4407494">hp</span>&nbsp;<span class="op" id="4407497">==</span>&nbsp;<span class="builtinfunc" id="4407500">len</span><span class="op" id="4407503">(</span><span class="ident" id="4407504">f</span><span class="op" id="4407505">.</span><span class="ident" id="4407506">hist</span><span class="op" id="4407510">)</span>&nbsp;<span class="op" id="4407512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407516">f</span><span class="op" id="4407517">.</span><span class="ident" id="4407518">hp</span>&nbsp;<span class="op" id="4407521">=</span>&nbsp;<span class="num" id="4407523">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407527">f</span><span class="op" id="4407528">.</span><span class="ident" id="4407529">hfull</span>&nbsp;<span class="op" id="4407535">=</span>&nbsp;<span class="builtintype" id="4407537">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407546">f</span><span class="op" id="4407547">.</span><span class="ident" id="4407548">hw</span>&nbsp;<span class="op" id="4407551">=</span>&nbsp;<span class="ident" id="4407553">f</span><span class="op" id="4407554">.</span><span class="ident" id="4407555">hp</span><br>
<span class="lineno"></span><span class="op" id="4407558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4407561">func</span>&nbsp;<span class="op" id="4407566">(</span><span class="ident" id="4407567">f</span>&nbsp;<span class="op" id="4407569">*</span><span class="ident" id="4407570">decompressor</span><span class="op" id="4407582">)</span>&nbsp;<span class="ident" id="4407584">moreBits</span><span class="op" id="4407592">(</span><span class="op" id="4407593">)</span>&nbsp;<span class="builtintype" id="4407595">error</span>&nbsp;<span class="op" id="4407601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407604">c</span><span class="op" id="4407605">,</span>&nbsp;<span class="ident" id="4407607">err</span>&nbsp;<span class="op" id="4407611">:=</span>&nbsp;<span class="ident" id="4407614">f</span><span class="op" id="4407615">.</span><span class="ident" id="4407616">r</span><span class="op" id="4407617">.</span><span class="ident" id="4407618">ReadByte</span><span class="op" id="4407626">(</span><span class="op" id="4407627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407630">if</span>&nbsp;<span class="ident" id="4407633">err</span>&nbsp;<span class="op" id="4407637">!=</span>&nbsp;<span class="ident" id="4407640">nil</span>&nbsp;<span class="op" id="4407644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407648">if</span>&nbsp;<span class="ident" id="4407651">err</span>&nbsp;<span class="op" id="4407655">==</span>&nbsp;<span class="ident" id="4407658">io</span><span class="op" id="4407660">.</span><span class="ident" id="4407661">EOF</span>&nbsp;<span class="op" id="4407665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407670">err</span>&nbsp;<span class="op" id="4407674">=</span>&nbsp;<span class="ident" id="4407676">io</span><span class="op" id="4407678">.</span><span class="ident" id="4407679">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407702">return</span>&nbsp;<span class="ident" id="4407709">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407717">f</span><span class="op" id="4407718">.</span><span class="ident" id="4407719">roffset</span><span class="op" id="4407726">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407730">f</span><span class="op" id="4407731">.</span><span class="ident" id="4407732">b</span>&nbsp;<span class="op" id="4407734">|=</span>&nbsp;<span class="builtintype" id="4407737">uint32</span><span class="op" id="4407743">(</span><span class="ident" id="4407744">c</span><span class="op" id="4407745">)</span>&nbsp;<span class="op" id="4407747">&lt;&lt;</span>&nbsp;<span class="ident" id="4407750">f</span><span class="op" id="4407751">.</span><span class="ident" id="4407752">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407756">f</span><span class="op" id="4407757">.</span><span class="ident" id="4407758">nb</span>&nbsp;<span class="op" id="4407761">+=</span>&nbsp;<span class="num" id="4407764">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407767">return</span>&nbsp;<span class="ident" id="4407774">nil</span><br>
<span class="lineno"></span><span class="op" id="4407778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4407781">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4407844">func</span>&nbsp;<span class="op" id="4407849">(</span><span class="ident" id="4407850">f</span>&nbsp;<span class="op" id="4407852">*</span><span class="ident" id="4407853">decompressor</span><span class="op" id="4407865">)</span>&nbsp;<span class="ident" id="4407867">huffSym</span><span class="op" id="4407874">(</span><span class="ident" id="4407875">h</span>&nbsp;<span class="op" id="4407877">*</span><span class="ident" id="4407878">huffmanDecoder</span><span class="op" id="4407892">)</span>&nbsp;<span class="op" id="4407894">(</span><span class="builtintype" id="4407895">int</span><span class="op" id="4407898">,</span>&nbsp;<span class="builtintype" id="4407900">error</span><span class="op" id="4407905">)</span>&nbsp;<span class="op" id="4407907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407910">n</span>&nbsp;<span class="op" id="4407912">:=</span>&nbsp;<span class="builtintype" id="4407915">uint</span><span class="op" id="4407919">(</span><span class="ident" id="4407920">h</span><span class="op" id="4407921">.</span><span class="ident" id="4407922">min</span><span class="op" id="4407925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407928">for</span>&nbsp;<span class="op" id="4407932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407936">for</span>&nbsp;<span class="ident" id="4407940">f</span><span class="op" id="4407941">.</span><span class="ident" id="4407942">nb</span>&nbsp;<span class="op" id="4407945">&lt;</span>&nbsp;<span class="ident" id="4407947">n</span>&nbsp;<span class="op" id="4407949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407954">if</span>&nbsp;<span class="ident" id="4407957">err</span>&nbsp;<span class="op" id="4407961">:=</span>&nbsp;<span class="ident" id="4407964">f</span><span class="op" id="4407965">.</span><span class="ident" id="4407966">moreBits</span><span class="op" id="4407974">(</span><span class="op" id="4407975">)</span><span class="op" id="4407976">;</span>&nbsp;<span class="ident" id="4407978">err</span>&nbsp;<span class="op" id="4407982">!=</span>&nbsp;<span class="ident" id="4407985">nil</span>&nbsp;<span class="op" id="4407989">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407995">return</span>&nbsp;<span class="num" id="4408002">0</span><span class="op" id="4408003">,</span>&nbsp;<span class="ident" id="4408005">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408020">chunk</span>&nbsp;<span class="op" id="4408026">:=</span>&nbsp;<span class="ident" id="4408029">h</span><span class="op" id="4408030">.</span><span class="ident" id="4408031">chunks</span><span class="op" id="4408037">[</span><span class="ident" id="4408038">f</span><span class="op" id="4408039">.</span><span class="ident" id="4408040">b</span><span class="op" id="4408041">&amp;</span><span class="op" id="4408042">(</span><span class="ident" id="4408043">huffmanNumChunks</span><span class="op" id="4408059">-</span><span class="num" id="4408060">1</span><span class="op" id="4408061">)</span><span class="op" id="4408062">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408066">n</span>&nbsp;<span class="op" id="4408068">=</span>&nbsp;<span class="builtintype" id="4408070">uint</span><span class="op" id="4408074">(</span><span class="ident" id="4408075">chunk</span>&nbsp;<span class="op" id="4408081">&amp;</span>&nbsp;<span class="ident" id="4408083">huffmanCountMask</span><span class="op" id="4408099">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408103">if</span>&nbsp;<span class="ident" id="4408106">n</span>&nbsp;<span class="op" id="4408108">&gt;</span>&nbsp;<span class="ident" id="4408110">huffmanChunkBits</span>&nbsp;<span class="op" id="4408127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408132">chunk</span>&nbsp;<span class="op" id="4408138">=</span>&nbsp;<span class="ident" id="4408140">h</span><span class="op" id="4408141">.</span><span class="ident" id="4408142">links</span><span class="op" id="4408147">[</span><span class="ident" id="4408148">chunk</span><span class="op" id="4408153">&gt;&gt;</span><span class="ident" id="4408155">huffmanValueShift</span><span class="op" id="4408172">]</span><span class="op" id="4408173">[</span><span class="op" id="4408174">(</span><span class="ident" id="4408175">f</span><span class="op" id="4408176">.</span><span class="ident" id="4408177">b</span><span class="op" id="4408178">&gt;&gt;</span><span class="ident" id="4408180">huffmanChunkBits</span><span class="op" id="4408196">)</span><span class="op" id="4408197">&amp;</span><span class="ident" id="4408198">h</span><span class="op" id="4408199">.</span><span class="ident" id="4408200">linkMask</span><span class="op" id="4408208">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408213">n</span>&nbsp;<span class="op" id="4408215">=</span>&nbsp;<span class="builtintype" id="4408217">uint</span><span class="op" id="4408221">(</span><span class="ident" id="4408222">chunk</span>&nbsp;<span class="op" id="4408228">&amp;</span>&nbsp;<span class="ident" id="4408230">huffmanCountMask</span><span class="op" id="4408246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408251">if</span>&nbsp;<span class="ident" id="4408254">n</span>&nbsp;<span class="op" id="4408256">==</span>&nbsp;<span class="num" id="4408259">0</span>&nbsp;<span class="op" id="4408261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408267">f</span><span class="op" id="4408268">.</span><span class="ident" id="4408269">err</span>&nbsp;<span class="op" id="4408273">=</span>&nbsp;<span class="ident" id="4408275">CorruptInputError</span><span class="op" id="4408292">(</span><span class="ident" id="4408293">f</span><span class="op" id="4408294">.</span><span class="ident" id="4408295">roffset</span><span class="op" id="4408302">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408308">return</span>&nbsp;<span class="num" id="4408315">0</span><span class="op" id="4408316">,</span>&nbsp;<span class="ident" id="4408318">f</span><span class="op" id="4408319">.</span><span class="ident" id="4408320">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408335">if</span>&nbsp;<span class="ident" id="4408338">n</span>&nbsp;<span class="op" id="4408340">&lt;=</span>&nbsp;<span class="ident" id="4408343">f</span><span class="op" id="4408344">.</span><span class="ident" id="4408345">nb</span>&nbsp;<span class="op" id="4408348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408353">f</span><span class="op" id="4408354">.</span><span class="ident" id="4408355">b</span>&nbsp;<span class="op" id="4408357">&gt;&gt;=</span>&nbsp;<span class="ident" id="4408361">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408366">f</span><span class="op" id="4408367">.</span><span class="ident" id="4408368">nb</span>&nbsp;<span class="op" id="4408371">-=</span>&nbsp;<span class="ident" id="4408374">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408379">return</span>&nbsp;<span class="builtintype" id="4408386">int</span><span class="op" id="4408389">(</span><span class="ident" id="4408390">chunk</span>&nbsp;<span class="op" id="4408396">&gt;&gt;</span>&nbsp;<span class="ident" id="4408399">huffmanValueShift</span><span class="op" id="4408416">)</span><span class="op" id="4408417">,</span>&nbsp;<span class="ident" id="4408419">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408428">}</span><br>
<span class="lineno"></span><span class="op" id="4408430">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4408433">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4408488">func</span>&nbsp;<span class="op" id="4408493">(</span><span class="ident" id="4408494">f</span>&nbsp;<span class="op" id="4408496">*</span><span class="ident" id="4408497">decompressor</span><span class="op" id="4408509">)</span>&nbsp;<span class="ident" id="4408511">flush</span><span class="op" id="4408516">(</span><span class="ident" id="4408517">step</span>&nbsp;<span class="keyword" id="4408522">func</span><span class="op" id="4408526">(</span><span class="op" id="4408527">*</span><span class="ident" id="4408528">decompressor</span><span class="op" id="4408540">)</span><span class="op" id="4408541">)</span>&nbsp;<span class="op" id="4408543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408546">f</span><span class="op" id="4408547">.</span><span class="ident" id="4408548">toRead</span>&nbsp;<span class="op" id="4408555">=</span>&nbsp;<span class="ident" id="4408557">f</span><span class="op" id="4408558">.</span><span class="ident" id="4408559">hist</span><span class="op" id="4408563">[</span><span class="ident" id="4408564">f</span><span class="op" id="4408565">.</span><span class="ident" id="4408566">hw</span><span class="op" id="4408568">:</span><span class="ident" id="4408569">f</span><span class="op" id="4408570">.</span><span class="ident" id="4408571">hp</span><span class="op" id="4408573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408576">f</span><span class="op" id="4408577">.</span><span class="ident" id="4408578">woffset</span>&nbsp;<span class="op" id="4408586">+=</span>&nbsp;<span class="ident" id="4408589">int64</span><span class="op" id="4408594">(</span><span class="ident" id="4408595">f</span><span class="op" id="4408596">.</span><span class="ident" id="4408597">hp</span>&nbsp;<span class="op" id="4408600">-</span>&nbsp;<span class="ident" id="4408602">f</span><span class="op" id="4408603">.</span><span class="ident" id="4408604">hw</span><span class="op" id="4408606">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408609">f</span><span class="op" id="4408610">.</span><span class="ident" id="4408611">hw</span>&nbsp;<span class="op" id="4408614">=</span>&nbsp;<span class="ident" id="4408616">f</span><span class="op" id="4408617">.</span><span class="ident" id="4408618">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408622">if</span>&nbsp;<span class="ident" id="4408625">f</span><span class="op" id="4408626">.</span><span class="ident" id="4408627">hp</span>&nbsp;<span class="op" id="4408630">==</span>&nbsp;<span class="builtinfunc" id="4408633">len</span><span class="op" id="4408636">(</span><span class="ident" id="4408637">f</span><span class="op" id="4408638">.</span><span class="ident" id="4408639">hist</span><span class="op" id="4408643">)</span>&nbsp;<span class="op" id="4408645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408649">f</span><span class="op" id="4408650">.</span><span class="ident" id="4408651">hp</span>&nbsp;<span class="op" id="4408654">=</span>&nbsp;<span class="num" id="4408656">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408660">f</span><span class="op" id="4408661">.</span><span class="ident" id="4408662">hw</span>&nbsp;<span class="op" id="4408665">=</span>&nbsp;<span class="num" id="4408667">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408671">f</span><span class="op" id="4408672">.</span><span class="ident" id="4408673">hfull</span>&nbsp;<span class="op" id="4408679">=</span>&nbsp;<span class="builtintype" id="4408681">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408690">f</span><span class="op" id="4408691">.</span><span class="ident" id="4408692">step</span>&nbsp;<span class="op" id="4408697">=</span>&nbsp;<span class="ident" id="4408699">step</span><br>
<span class="lineno"></span><span class="op" id="4408704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4408707">func</span>&nbsp;<span class="ident" id="4408712">makeReader</span><span class="op" id="4408722">(</span><span class="ident" id="4408723">r</span>&nbsp;<span class="ident" id="4408725">io</span><span class="op" id="4408727">.</span><span class="ident" id="4408728">Reader</span><span class="op" id="4408734">)</span>&nbsp;<span class="ident" id="4408736">Reader</span>&nbsp;<span class="op" id="4408743">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408746">if</span>&nbsp;<span class="ident" id="4408749">rr</span><span class="op" id="4408751">,</span>&nbsp;<span class="ident" id="4408753">ok</span>&nbsp;<span class="op" id="4408756">:=</span>&nbsp;<span class="ident" id="4408759">r</span><span class="op" id="4408760">.</span><span class="op" id="4408761">(</span><span class="ident" id="4408762">Reader</span><span class="op" id="4408768">)</span><span class="op" id="4408769">;</span>&nbsp;<span class="ident" id="4408771">ok</span>&nbsp;<span class="op" id="4408774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408778">return</span>&nbsp;<span class="ident" id="4408785">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408792">return</span>&nbsp;<span class="ident" id="4408799">bufio</span><span class="op" id="4408804">.</span><span class="ident" id="4408805">NewReader</span><span class="op" id="4408814">(</span><span class="ident" id="4408815">r</span><span class="op" id="4408816">)</span><br>
<span class="lineno"></span><span class="op" id="4408818">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4408821">func</span>&nbsp;<span class="op" id="4408826">(</span><span class="ident" id="4408827">f</span>&nbsp;<span class="op" id="4408829">*</span><span class="ident" id="4408830">decompressor</span><span class="op" id="4408842">)</span>&nbsp;<span class="ident" id="4408844">Reset</span><span class="op" id="4408849">(</span><span class="ident" id="4408850">r</span>&nbsp;<span class="ident" id="4408852">io</span><span class="op" id="4408854">.</span><span class="ident" id="4408855">Reader</span><span class="op" id="4408861">,</span>&nbsp;<span class="ident" id="4408863">dict</span>&nbsp;<span class="op" id="4408868">[</span><span class="op" id="4408869">]</span><span class="builtintype" id="4408870">byte</span><span class="op" id="4408874">)</span>&nbsp;<span class="builtintype" id="4408876">error</span>&nbsp;<span class="op" id="4408882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408885">*</span><span class="ident" id="4408886">f</span>&nbsp;<span class="op" id="4408888">=</span>&nbsp;<span class="ident" id="4408890">decompressor</span><span class="op" id="4408902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408906">r</span><span class="op" id="4408907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408916">makeReader</span><span class="op" id="4408926">(</span><span class="ident" id="4408927">r</span><span class="op" id="4408928">)</span><span class="op" id="4408929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408933">bits</span><span class="op" id="4408937">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408943">f</span><span class="op" id="4408944">.</span><span class="ident" id="4408945">bits</span><span class="op" id="4408949">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408953">codebits</span><span class="op" id="4408961">:</span>&nbsp;<span class="ident" id="4408963">f</span><span class="op" id="4408964">.</span><span class="ident" id="4408965">codebits</span><span class="op" id="4408973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408977">hist</span><span class="op" id="4408981">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408987">f</span><span class="op" id="4408988">.</span><span class="ident" id="4408989">hist</span><span class="op" id="4408993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408997">step</span><span class="op" id="4409001">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4409007">(</span><span class="op" id="4409008">*</span><span class="ident" id="4409009">decompressor</span><span class="op" id="4409021">)</span><span class="op" id="4409022">.</span><span class="ident" id="4409023">nextBlock</span><span class="op" id="4409032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4409035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4409038">if</span>&nbsp;<span class="ident" id="4409041">dict</span>&nbsp;<span class="op" id="4409046">!=</span>&nbsp;<span class="ident" id="4409049">nil</span>&nbsp;<span class="op" id="4409053">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4409057">f</span><span class="op" id="4409058">.</span><span class="ident" id="4409059">setDict</span><span class="op" id="4409066">(</span><span class="ident" id="4409067">dict</span><span class="op" id="4409071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4409074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4409077">return</span>&nbsp;<span class="ident" id="4409084">nil</span><br>
<span class="lineno"></span><span class="op" id="4409088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4409091">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4409146">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4409188">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4409235">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4409297">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4409366">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4409392">//</span><br>
<span class="lineno"></span><span class="comment" id="4409395">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4409461">func</span>&nbsp;<span class="ident" id="4409466">NewReader</span><span class="op" id="4409475">(</span><span class="ident" id="4409476">r</span>&nbsp;<span class="ident" id="4409478">io</span><span class="op" id="4409480">.</span><span class="ident" id="4409481">Reader</span><span class="op" id="4409487">)</span>&nbsp;<span class="ident" id="4409489">io</span><span class="op" id="4409491">.</span><span class="ident" id="4409492">ReadCloser</span>&nbsp;<span class="op" id="4409503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4409506">var</span>&nbsp;<span class="ident" id="4409510">f</span>&nbsp;<span class="ident" id="4409512">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4409526">f</span><span class="op" id="4409527">.</span><span class="ident" id="4409528">bits</span>&nbsp;<span class="op" id="4409533">=</span>&nbsp;<span class="builtinfunc" id="4409535">new</span><span class="op" id="4409538">(</span><span class="op" id="4409539">[</span><span class="ident" id="4409540">maxLit</span>&nbsp;<span class="op" id="4409547">+</span>&nbsp;<span class="ident" id="4409549">maxDist</span><span class="op" id="4409556">]</span><span class="builtintype" id="4409557">int</span><span class="op" id="4409560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4409563">f</span><span class="op" id="4409564">.</span><span class="ident" id="4409565">codebits</span>&nbsp;<span class="op" id="4409574">=</span>&nbsp;<span class="builtinfunc" id="4409576">new</span><span class="op" id="4409579">(</span><span class="op" id="4409580">[</span><span class="ident" id="4409581">numCodes</span><span class="op" id="4409589">]</span><span class="builtintype" id="4409590">int</span><span class="op" id="4409593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4409596">f</span><span class="op" id="4409597">.</span><span class="ident" id="4409598">r</span>&nbsp;<span class="op" id="4409600">=</span>&nbsp;<span class="ident" id="4409602">makeReader</span><span class="op" id="4409612">(</span><span class="ident" id="4409613">r</span><span class="op" id="4409614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4409617">f</span><span class="op" id="4409618">.</span><span class="ident" id="4409619">hist</span>&nbsp;<span class="op" id="4409624">=</span>&nbsp;<span class="builtinfunc" id="4409626">new</span><span class="op" id="4409629">(</span><span class="op" id="4409630">[</span><span class="ident" id="4409631">maxHist</span><span class="op" id="4409638">]</span><span class="builtintype" id="4409639">byte</span><span class="op" id="4409643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4409646">f</span><span class="op" id="4409647">.</span><span class="ident" id="4409648">step</span>&nbsp;<span class="op" id="4409653">=</span>&nbsp;<span class="op" id="4409655">(</span><span class="op" id="4409656">*</span><span class="ident" id="4409657">decompressor</span><span class="op" id="4409669">)</span><span class="op" id="4409670">.</span><span class="ident" id="4409671">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4409682">return</span>&nbsp;<span class="op" id="4409689">&amp;</span><span class="ident" id="4409690">f</span><br>
<span class="lineno"></span><span class="op" id="4409692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4409695">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4409757">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4409821">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4409888">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4409953">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4409998">//</span><br>
<span class="lineno"></span><span class="comment" id="4410001">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4410067">func</span>&nbsp;<span class="ident" id="4410072">NewReaderDict</span><span class="op" id="4410085">(</span><span class="ident" id="4410086">r</span>&nbsp;<span class="ident" id="4410088">io</span><span class="op" id="4410090">.</span><span class="ident" id="4410091">Reader</span><span class="op" id="4410097">,</span>&nbsp;<span class="ident" id="4410099">dict</span>&nbsp;<span class="op" id="4410104">[</span><span class="op" id="4410105">]</span><span class="builtintype" id="4410106">byte</span><span class="op" id="4410110">)</span>&nbsp;<span class="ident" id="4410112">io</span><span class="op" id="4410114">.</span><span class="ident" id="4410115">ReadCloser</span>&nbsp;<span class="op" id="4410126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4410129">var</span>&nbsp;<span class="ident" id="4410133">f</span>&nbsp;<span class="ident" id="4410135">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410149">f</span><span class="op" id="4410150">.</span><span class="ident" id="4410151">r</span>&nbsp;<span class="op" id="4410153">=</span>&nbsp;<span class="ident" id="4410155">makeReader</span><span class="op" id="4410165">(</span><span class="ident" id="4410166">r</span><span class="op" id="4410167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410170">f</span><span class="op" id="4410171">.</span><span class="ident" id="4410172">hist</span>&nbsp;<span class="op" id="4410177">=</span>&nbsp;<span class="builtinfunc" id="4410179">new</span><span class="op" id="4410182">(</span><span class="op" id="4410183">[</span><span class="ident" id="4410184">maxHist</span><span class="op" id="4410191">]</span><span class="builtintype" id="4410192">byte</span><span class="op" id="4410196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410199">f</span><span class="op" id="4410200">.</span><span class="ident" id="4410201">bits</span>&nbsp;<span class="op" id="4410206">=</span>&nbsp;<span class="builtinfunc" id="4410208">new</span><span class="op" id="4410211">(</span><span class="op" id="4410212">[</span><span class="ident" id="4410213">maxLit</span>&nbsp;<span class="op" id="4410220">+</span>&nbsp;<span class="ident" id="4410222">maxDist</span><span class="op" id="4410229">]</span><span class="builtintype" id="4410230">int</span><span class="op" id="4410233">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410236">f</span><span class="op" id="4410237">.</span><span class="ident" id="4410238">codebits</span>&nbsp;<span class="op" id="4410247">=</span>&nbsp;<span class="builtinfunc" id="4410249">new</span><span class="op" id="4410252">(</span><span class="op" id="4410253">[</span><span class="ident" id="4410254">numCodes</span><span class="op" id="4410262">]</span><span class="builtintype" id="4410263">int</span><span class="op" id="4410266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410269">f</span><span class="op" id="4410270">.</span><span class="ident" id="4410271">step</span>&nbsp;<span class="op" id="4410276">=</span>&nbsp;<span class="op" id="4410278">(</span><span class="op" id="4410279">*</span><span class="ident" id="4410280">decompressor</span><span class="op" id="4410292">)</span><span class="op" id="4410293">.</span><span class="ident" id="4410294">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410305">f</span><span class="op" id="4410306">.</span><span class="ident" id="4410307">setDict</span><span class="op" id="4410314">(</span><span class="ident" id="4410315">dict</span><span class="op" id="4410319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4410322">return</span>&nbsp;<span class="op" id="4410329">&amp;</span><span class="ident" id="4410330">f</span><br>
<span class="lineno"></span><span class="op" id="4410332">}</span>
</div>
</body>
</html>
