<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode</h2>
<ul>
<li><a href="/gostd/unicode/casetables.go.html">casetables.go</a></li>
<li><a href="/gostd/unicode/digit.go.html">digit.go</a></li>
<li><a href="/gostd/unicode/digit_test.go.html">digit_test.go</a></li>
<li><a href="/gostd/unicode/graphic.go.html">graphic.go</a></li>
<li><a href="/gostd/unicode/graphic_test.go.html">graphic_test.go</a></li>
<li><a href="/gostd/unicode/letter.go.html">letter.go</a></li>
<li><a href="/gostd/unicode/letter_test.go.html">letter_test.go</a></li>
<li><a href="/gostd/unicode/script_test.go.html">script_test.go</a></li>
<li><a href="/gostd/unicode/tables.go.html">tables.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2080594">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2080649">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2080703">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2080754">//&nbsp;Package&nbsp;unicode&nbsp;provides&nbsp;data&nbsp;and&nbsp;functions&nbsp;to&nbsp;test&nbsp;some&nbsp;properties&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2080828">//&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="2080852">package</span>&nbsp;<span class="ident" id="2080860">unicode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2080869">//&nbsp;Tables&nbsp;are&nbsp;regenerated&nbsp;each&nbsp;time&nbsp;we&nbsp;update&nbsp;the&nbsp;Unicode&nbsp;version.</span><br>
<span class="lineno">10</span><span class="comment" id="2080936">//go:generate&nbsp;go&nbsp;run&nbsp;maketables.go&nbsp;-tables=all&nbsp;-output&nbsp;tables.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2081002">const</span>&nbsp;<span class="op" id="2081008">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081011">MaxRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081027">=</span>&nbsp;<span class="string" id="2081029">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="2081042">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081080">ReplacementChar</span>&nbsp;<span class="op" id="2081096">=</span>&nbsp;<span class="string" id="2081098">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081111">//&nbsp;Represents&nbsp;invalid&nbsp;code&nbsp;points.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081147">MaxASCII</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081163">=</span>&nbsp;<span class="string" id="2081165">&#39;\u007F&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081178">//&nbsp;maximum&nbsp;ASCII&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081203">MaxLatin1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081219">=</span>&nbsp;<span class="string" id="2081221">&#39;\u00FF&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081234">//&nbsp;maximum&nbsp;Latin-1&nbsp;value.</span><br>
<span class="lineno"></span><span class="op" id="2081260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2081263">//&nbsp;RangeTable&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;by&nbsp;listing&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno">20</span><span class="comment" id="2081339">//&nbsp;code&nbsp;points&nbsp;within&nbsp;the&nbsp;set.&nbsp;The&nbsp;ranges&nbsp;are&nbsp;listed&nbsp;in&nbsp;two&nbsp;slices</span><br>
<span class="lineno"></span><span class="comment" id="2081406">//&nbsp;to&nbsp;save&nbsp;space:&nbsp;a&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges&nbsp;and&nbsp;a&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="comment" id="2081479">//&nbsp;The&nbsp;two&nbsp;slices&nbsp;must&nbsp;be&nbsp;in&nbsp;sorted&nbsp;order&nbsp;and&nbsp;non-overlapping.</span><br>
<span class="lineno"></span><span class="comment" id="2081542">//&nbsp;Also,&nbsp;R32&nbsp;should&nbsp;contain&nbsp;only&nbsp;values&nbsp;&gt;=&nbsp;0x10000&nbsp;(1&lt;&lt;16).</span><br>
<span class="lineno"></span><span class="keyword" id="2081602">type</span>&nbsp;<span class="ident" id="2081607">RangeTable</span>&nbsp;<span class="keyword" id="2081618">struct</span>&nbsp;<span class="op" id="2081625">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081628">R16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081640">[</span><span class="op" id="2081641">]</span><span class="ident" id="2081642">Range16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081651">R32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081663">[</span><span class="op" id="2081664">]</span><span class="ident" id="2081665">Range32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081674">LatinOffset</span>&nbsp;<span class="builtintype" id="2081686">int</span>&nbsp;<span class="comment" id="2081690">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;R16&nbsp;with&nbsp;Hi&nbsp;&lt;=&nbsp;MaxLatin1</span><br>
<span class="lineno"></span><span class="op" id="2081739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2081742">//&nbsp;Range16&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;16-bit&nbsp;Unicode&nbsp;code&nbsp;points.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno"></span><span class="comment" id="2081836">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.</span><br>
<span class="lineno"></span><span class="keyword" id="2081879">type</span>&nbsp;<span class="ident" id="2081884">Range16</span>&nbsp;<span class="keyword" id="2081892">struct</span>&nbsp;<span class="op" id="2081899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081902">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2081909">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081917">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2081924">uint16</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081932">Stride</span>&nbsp;<span class="builtintype" id="2081939">uint16</span><br>
<span class="lineno"></span><span class="op" id="2081946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2081949">//&nbsp;Range32&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;and&nbsp;is&nbsp;used&nbsp;when&nbsp;one&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2082029">//&nbsp;more&nbsp;of&nbsp;the&nbsp;values&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;16&nbsp;bits.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno">40</span><span class="comment" id="2082106">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.&nbsp;Lo&nbsp;and&nbsp;Hi&nbsp;must&nbsp;always&nbsp;be&nbsp;&gt;=&nbsp;1&lt;&lt;16.</span><br>
<span class="lineno"></span><span class="keyword" id="2082184">type</span>&nbsp;<span class="ident" id="2082189">Range32</span>&nbsp;<span class="keyword" id="2082197">struct</span>&nbsp;<span class="op" id="2082204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082207">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2082214">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082222">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2082229">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082237">Stride</span>&nbsp;<span class="builtintype" id="2082244">uint32</span><br>
<span class="lineno">45</span><span class="op" id="2082251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2082254">//&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;for&nbsp;simple&nbsp;(one</span><br>
<span class="lineno"></span><span class="comment" id="2082325">//&nbsp;code&nbsp;point&nbsp;to&nbsp;one&nbsp;code&nbsp;point)&nbsp;case&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2082375">//&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi&nbsp;inclusive,&nbsp;with&nbsp;a&nbsp;fixed&nbsp;stride&nbsp;of&nbsp;1.&nbsp;&nbsp;Deltas</span><br>
<span class="lineno">50</span><span class="comment" id="2082452">//&nbsp;are&nbsp;the&nbsp;number&nbsp;to&nbsp;add&nbsp;to&nbsp;the&nbsp;code&nbsp;point&nbsp;to&nbsp;reach&nbsp;the&nbsp;code&nbsp;point&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2082525">//&nbsp;different&nbsp;case&nbsp;for&nbsp;that&nbsp;character.&nbsp;&nbsp;They&nbsp;may&nbsp;be&nbsp;negative.&nbsp;&nbsp;If&nbsp;zero,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2082599">//&nbsp;means&nbsp;the&nbsp;character&nbsp;is&nbsp;in&nbsp;the&nbsp;corresponding&nbsp;case.&nbsp;There&nbsp;is&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span><span class="comment" id="2082671">//&nbsp;case&nbsp;representing&nbsp;sequences&nbsp;of&nbsp;alternating&nbsp;corresponding&nbsp;Upper&nbsp;and&nbsp;Lower</span><br>
<span class="lineno"></span><span class="comment" id="2082747">//&nbsp;pairs.&nbsp;&nbsp;It&nbsp;appears&nbsp;with&nbsp;a&nbsp;fixed&nbsp;Delta&nbsp;of</span><br>
<span class="lineno">55</span><span class="comment" id="2082791">//&nbsp;&nbsp;&nbsp;&nbsp{UpperLower,&nbsp;UpperLower,&nbsp;UpperLower}</span><br>
<span class="lineno"></span><span class="comment" id="2082831">//&nbsp;The&nbsp;constant&nbsp;UpperLower&nbsp;has&nbsp;an&nbsp;otherwise&nbsp;impossible&nbsp;delta&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="2082899">type</span>&nbsp;<span class="ident" id="2082904">CaseRange</span>&nbsp;<span class="keyword" id="2082914">struct</span>&nbsp;<span class="op" id="2082921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082924">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2082930">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082938">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2082944">uint32</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082952">Delta</span>&nbsp;<span class="ident" id="2082958">d</span><br>
<span class="lineno"></span><span class="op" id="2082960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2082963">//&nbsp;SpecialCase&nbsp;represents&nbsp;language-specific&nbsp;case&nbsp;mappings&nbsp;such&nbsp;as&nbsp;Turkish.</span><br>
<span class="lineno"></span><span class="comment" id="2083038">//&nbsp;Methods&nbsp;of&nbsp;SpecialCase&nbsp;customize&nbsp;(by&nbsp;overriding)&nbsp;the&nbsp;standard&nbsp;mappings.</span><br>
<span class="lineno">65</span><span class="keyword" id="2083113">type</span>&nbsp;<span class="ident" id="2083118">SpecialCase</span>&nbsp;<span class="op" id="2083130">[</span><span class="op" id="2083131">]</span><span class="ident" id="2083132">CaseRange</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2083143">//&nbsp;BUG(r):&nbsp;There&nbsp;is&nbsp;no&nbsp;mechanism&nbsp;for&nbsp;full&nbsp;case&nbsp;folding,&nbsp;that&nbsp;is,&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2083212">//&nbsp;characters&nbsp;that&nbsp;involve&nbsp;multiple&nbsp;runes&nbsp;in&nbsp;the&nbsp;input&nbsp;or&nbsp;output.</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="2083279">//&nbsp;Indices&nbsp;into&nbsp;the&nbsp;Delta&nbsp;arrays&nbsp;inside&nbsp;CaseRanges&nbsp;for&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="2083348">const</span>&nbsp;<span class="op" id="2083354">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083357">UpperCase</span>&nbsp;<span class="op" id="2083367">=</span>&nbsp;<span class="ident" id="2083369">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083375">LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083386">TitleCase</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083397">MaxCase</span><br>
<span class="lineno"></span><span class="op" id="2083405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2083408">type</span>&nbsp;<span class="ident" id="2083413">d</span>&nbsp;<span class="op" id="2083415">[</span><span class="ident" id="2083416">MaxCase</span><span class="op" id="2083423">]</span><span class="builtintype" id="2083424">rune</span>&nbsp;<span class="comment" id="2083429">//&nbsp;to&nbsp;make&nbsp;the&nbsp;CaseRanges&nbsp;text&nbsp;shorter</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2083469">//&nbsp;If&nbsp;the&nbsp;Delta&nbsp;field&nbsp;of&nbsp;a&nbsp;CaseRange&nbsp;is&nbsp;UpperLower,&nbsp;it&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2083530">//&nbsp;this&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;sequence&nbsp;of&nbsp;the&nbsp;form&nbsp;(say)</span><br>
<span class="lineno"></span><span class="comment" id="2083588">//&nbsp;Upper&nbsp;Lower&nbsp;Upper&nbsp;Lower.</span><br>
<span class="lineno"></span><span class="keyword" id="2083616">const</span>&nbsp;<span class="op" id="2083622">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083625">UpperLower</span>&nbsp;<span class="op" id="2083636">=</span>&nbsp;<span class="ident" id="2083638">MaxRune</span>&nbsp;<span class="op" id="2083646">+</span>&nbsp;<span class="num" id="2083648">1</span>&nbsp;<span class="comment" id="2083650">//&nbsp;(Cannot&nbsp;be&nbsp;a&nbsp;valid&nbsp;delta.)</span><br>
<span class="lineno">85</span><span class="op" id="2083680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2083683">//&nbsp;linearMax&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;table&nbsp;for&nbsp;linear&nbsp;search&nbsp;for&nbsp;non-Latin1&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="2083761">//&nbsp;Derived&nbsp;by&nbsp;running&nbsp;&#39;go&nbsp;test&nbsp;-calibrate&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="2083805">const</span>&nbsp;<span class="ident" id="2083811">linearMax</span>&nbsp;<span class="op" id="2083821">=</span>&nbsp;<span class="num" id="2083823">18</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="2083827">//&nbsp;is16&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword" id="2083894">func</span>&nbsp;<span class="ident" id="2083899">is16</span><span class="op" id="2083903">(</span><span class="ident" id="2083904">ranges</span>&nbsp;<span class="op" id="2083911">[</span><span class="op" id="2083912">]</span><span class="ident" id="2083913">Range16</span><span class="op" id="2083920">,</span>&nbsp;<span class="ident" id="2083922">r</span>&nbsp;<span class="builtintype" id="2083924">uint16</span><span class="op" id="2083930">)</span>&nbsp;<span class="builtintype" id="2083932">bool</span>&nbsp;<span class="op" id="2083937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083940">if</span>&nbsp;<span class="builtinfunc" id="2083943">len</span><span class="op" id="2083946">(</span><span class="ident" id="2083947">ranges</span><span class="op" id="2083953">)</span>&nbsp;<span class="op" id="2083955">&lt;=</span>&nbsp;<span class="ident" id="2083958">linearMax</span>&nbsp;<span class="op" id="2083968">||</span>&nbsp;<span class="ident" id="2083971">r</span>&nbsp;<span class="op" id="2083973">&lt;=</span>&nbsp;<span class="ident" id="2083976">MaxLatin1</span>&nbsp;<span class="op" id="2083986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083990">for</span>&nbsp;<span class="ident" id="2083994">i</span>&nbsp;<span class="op" id="2083996">:=</span>&nbsp;<span class="keyword" id="2083999">range</span>&nbsp;<span class="ident" id="2084005">ranges</span>&nbsp;<span class="op" id="2084012">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084017">range_</span>&nbsp;<span class="op" id="2084024">:=</span>&nbsp;<span class="op" id="2084027">&amp;</span><span class="ident" id="2084028">ranges</span><span class="op" id="2084034">[</span><span class="ident" id="2084035">i</span><span class="op" id="2084036">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084041">if</span>&nbsp;<span class="ident" id="2084044">r</span>&nbsp;<span class="op" id="2084046">&lt;</span>&nbsp;<span class="ident" id="2084048">range_</span><span class="op" id="2084054">.</span><span class="ident" id="2084055">Lo</span>&nbsp;<span class="op" id="2084058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084064">return</span>&nbsp;<span class="builtintype" id="2084071">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084085">if</span>&nbsp;<span class="ident" id="2084088">r</span>&nbsp;<span class="op" id="2084090">&lt;=</span>&nbsp;<span class="ident" id="2084093">range_</span><span class="op" id="2084099">.</span><span class="ident" id="2084100">Hi</span>&nbsp;<span class="op" id="2084103">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084109">return</span>&nbsp;<span class="op" id="2084116">(</span><span class="ident" id="2084117">r</span><span class="op" id="2084118">-</span><span class="ident" id="2084119">range_</span><span class="op" id="2084125">.</span><span class="ident" id="2084126">Lo</span><span class="op" id="2084128">)</span><span class="op" id="2084129">%</span><span class="ident" id="2084130">range_</span><span class="op" id="2084136">.</span><span class="ident" id="2084137">Stride</span>&nbsp;<span class="op" id="2084144">==</span>&nbsp;<span class="num" id="2084147">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084160">return</span>&nbsp;<span class="builtintype" id="2084167">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084174">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2084178">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084208">lo</span>&nbsp;<span class="op" id="2084211">:=</span>&nbsp;<span class="num" id="2084214">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084217">hi</span>&nbsp;<span class="op" id="2084220">:=</span>&nbsp;<span class="builtinfunc" id="2084223">len</span><span class="op" id="2084226">(</span><span class="ident" id="2084227">ranges</span><span class="op" id="2084233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084236">for</span>&nbsp;<span class="ident" id="2084240">lo</span>&nbsp;<span class="op" id="2084243">&lt;</span>&nbsp;<span class="ident" id="2084245">hi</span>&nbsp;<span class="op" id="2084248">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084252">m</span>&nbsp;<span class="op" id="2084254">:=</span>&nbsp;<span class="ident" id="2084257">lo</span>&nbsp;<span class="op" id="2084260">+</span>&nbsp;<span class="op" id="2084262">(</span><span class="ident" id="2084263">hi</span><span class="op" id="2084265">-</span><span class="ident" id="2084266">lo</span><span class="op" id="2084268">)</span><span class="op" id="2084269">/</span><span class="num" id="2084270">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084274">range_</span>&nbsp;<span class="op" id="2084281">:=</span>&nbsp;<span class="op" id="2084284">&amp;</span><span class="ident" id="2084285">ranges</span><span class="op" id="2084291">[</span><span class="ident" id="2084292">m</span><span class="op" id="2084293">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084297">if</span>&nbsp;<span class="ident" id="2084300">range_</span><span class="op" id="2084306">.</span><span class="ident" id="2084307">Lo</span>&nbsp;<span class="op" id="2084310">&lt;=</span>&nbsp;<span class="ident" id="2084313">r</span>&nbsp;<span class="op" id="2084315">&amp;&amp;</span>&nbsp;<span class="ident" id="2084318">r</span>&nbsp;<span class="op" id="2084320">&lt;=</span>&nbsp;<span class="ident" id="2084323">range_</span><span class="op" id="2084329">.</span><span class="ident" id="2084330">Hi</span>&nbsp;<span class="op" id="2084333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084338">return</span>&nbsp;<span class="op" id="2084345">(</span><span class="ident" id="2084346">r</span><span class="op" id="2084347">-</span><span class="ident" id="2084348">range_</span><span class="op" id="2084354">.</span><span class="ident" id="2084355">Lo</span><span class="op" id="2084357">)</span><span class="op" id="2084358">%</span><span class="ident" id="2084359">range_</span><span class="op" id="2084365">.</span><span class="ident" id="2084366">Stride</span>&nbsp;<span class="op" id="2084373">==</span>&nbsp;<span class="num" id="2084376">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084380">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084384">if</span>&nbsp;<span class="ident" id="2084387">r</span>&nbsp;<span class="op" id="2084389">&lt;</span>&nbsp;<span class="ident" id="2084391">range_</span><span class="op" id="2084397">.</span><span class="ident" id="2084398">Lo</span>&nbsp;<span class="op" id="2084401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084406">hi</span>&nbsp;<span class="op" id="2084409">=</span>&nbsp;<span class="ident" id="2084411">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084415">}</span>&nbsp;<span class="keyword" id="2084417">else</span>&nbsp;<span class="op" id="2084422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084427">lo</span>&nbsp;<span class="op" id="2084430">=</span>&nbsp;<span class="ident" id="2084432">m</span>&nbsp;<span class="op" id="2084434">+</span>&nbsp;<span class="num" id="2084436">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084440">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084446">return</span>&nbsp;<span class="builtintype" id="2084453">false</span><br>
<span class="lineno"></span><span class="op" id="2084459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2084462">//&nbsp;is32&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno">125</span><span class="keyword" id="2084529">func</span>&nbsp;<span class="ident" id="2084534">is32</span><span class="op" id="2084538">(</span><span class="ident" id="2084539">ranges</span>&nbsp;<span class="op" id="2084546">[</span><span class="op" id="2084547">]</span><span class="ident" id="2084548">Range32</span><span class="op" id="2084555">,</span>&nbsp;<span class="ident" id="2084557">r</span>&nbsp;<span class="builtintype" id="2084559">uint32</span><span class="op" id="2084565">)</span>&nbsp;<span class="builtintype" id="2084567">bool</span>&nbsp;<span class="op" id="2084572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084575">if</span>&nbsp;<span class="builtinfunc" id="2084578">len</span><span class="op" id="2084581">(</span><span class="ident" id="2084582">ranges</span><span class="op" id="2084588">)</span>&nbsp;<span class="op" id="2084590">&lt;=</span>&nbsp;<span class="ident" id="2084593">linearMax</span>&nbsp;<span class="op" id="2084603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084607">for</span>&nbsp;<span class="ident" id="2084611">i</span>&nbsp;<span class="op" id="2084613">:=</span>&nbsp;<span class="keyword" id="2084616">range</span>&nbsp;<span class="ident" id="2084622">ranges</span>&nbsp;<span class="op" id="2084629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084634">range_</span>&nbsp;<span class="op" id="2084641">:=</span>&nbsp;<span class="op" id="2084644">&amp;</span><span class="ident" id="2084645">ranges</span><span class="op" id="2084651">[</span><span class="ident" id="2084652">i</span><span class="op" id="2084653">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084658">if</span>&nbsp;<span class="ident" id="2084661">r</span>&nbsp;<span class="op" id="2084663">&lt;</span>&nbsp;<span class="ident" id="2084665">range_</span><span class="op" id="2084671">.</span><span class="ident" id="2084672">Lo</span>&nbsp;<span class="op" id="2084675">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084681">return</span>&nbsp;<span class="builtintype" id="2084688">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084702">if</span>&nbsp;<span class="ident" id="2084705">r</span>&nbsp;<span class="op" id="2084707">&lt;=</span>&nbsp;<span class="ident" id="2084710">range_</span><span class="op" id="2084716">.</span><span class="ident" id="2084717">Hi</span>&nbsp;<span class="op" id="2084720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084726">return</span>&nbsp;<span class="op" id="2084733">(</span><span class="ident" id="2084734">r</span><span class="op" id="2084735">-</span><span class="ident" id="2084736">range_</span><span class="op" id="2084742">.</span><span class="ident" id="2084743">Lo</span><span class="op" id="2084745">)</span><span class="op" id="2084746">%</span><span class="ident" id="2084747">range_</span><span class="op" id="2084753">.</span><span class="ident" id="2084754">Stride</span>&nbsp;<span class="op" id="2084761">==</span>&nbsp;<span class="num" id="2084764">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084769">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084777">return</span>&nbsp;<span class="builtintype" id="2084784">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2084795">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084825">lo</span>&nbsp;<span class="op" id="2084828">:=</span>&nbsp;<span class="num" id="2084831">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084834">hi</span>&nbsp;<span class="op" id="2084837">:=</span>&nbsp;<span class="builtinfunc" id="2084840">len</span><span class="op" id="2084843">(</span><span class="ident" id="2084844">ranges</span><span class="op" id="2084850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084853">for</span>&nbsp;<span class="ident" id="2084857">lo</span>&nbsp;<span class="op" id="2084860">&lt;</span>&nbsp;<span class="ident" id="2084862">hi</span>&nbsp;<span class="op" id="2084865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084869">m</span>&nbsp;<span class="op" id="2084871">:=</span>&nbsp;<span class="ident" id="2084874">lo</span>&nbsp;<span class="op" id="2084877">+</span>&nbsp;<span class="op" id="2084879">(</span><span class="ident" id="2084880">hi</span><span class="op" id="2084882">-</span><span class="ident" id="2084883">lo</span><span class="op" id="2084885">)</span><span class="op" id="2084886">/</span><span class="num" id="2084887">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084891">range_</span>&nbsp;<span class="op" id="2084898">:=</span>&nbsp;<span class="ident" id="2084901">ranges</span><span class="op" id="2084907">[</span><span class="ident" id="2084908">m</span><span class="op" id="2084909">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084913">if</span>&nbsp;<span class="ident" id="2084916">range_</span><span class="op" id="2084922">.</span><span class="ident" id="2084923">Lo</span>&nbsp;<span class="op" id="2084926">&lt;=</span>&nbsp;<span class="ident" id="2084929">r</span>&nbsp;<span class="op" id="2084931">&amp;&amp;</span>&nbsp;<span class="ident" id="2084934">r</span>&nbsp;<span class="op" id="2084936">&lt;=</span>&nbsp;<span class="ident" id="2084939">range_</span><span class="op" id="2084945">.</span><span class="ident" id="2084946">Hi</span>&nbsp;<span class="op" id="2084949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084954">return</span>&nbsp;<span class="op" id="2084961">(</span><span class="ident" id="2084962">r</span><span class="op" id="2084963">-</span><span class="ident" id="2084964">range_</span><span class="op" id="2084970">.</span><span class="ident" id="2084971">Lo</span><span class="op" id="2084973">)</span><span class="op" id="2084974">%</span><span class="ident" id="2084975">range_</span><span class="op" id="2084981">.</span><span class="ident" id="2084982">Stride</span>&nbsp;<span class="op" id="2084989">==</span>&nbsp;<span class="num" id="2084992">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085000">if</span>&nbsp;<span class="ident" id="2085003">r</span>&nbsp;<span class="op" id="2085005">&lt;</span>&nbsp;<span class="ident" id="2085007">range_</span><span class="op" id="2085013">.</span><span class="ident" id="2085014">Lo</span>&nbsp;<span class="op" id="2085017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085022">hi</span>&nbsp;<span class="op" id="2085025">=</span>&nbsp;<span class="ident" id="2085027">m</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085031">}</span>&nbsp;<span class="keyword" id="2085033">else</span>&nbsp;<span class="op" id="2085038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085043">lo</span>&nbsp;<span class="op" id="2085046">=</span>&nbsp;<span class="ident" id="2085048">m</span>&nbsp;<span class="op" id="2085050">+</span>&nbsp;<span class="num" id="2085052">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085062">return</span>&nbsp;<span class="builtintype" id="2085069">false</span><br>
<span class="lineno">155</span><span class="op" id="2085075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2085078">//&nbsp;Is&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;in&nbsp;the&nbsp;specified&nbsp;table&nbsp;of&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword" id="2085146">func</span>&nbsp;<span class="ident" id="2085151">Is</span><span class="op" id="2085153">(</span><span class="ident" id="2085154">rangeTab</span>&nbsp;<span class="op" id="2085163">*</span><span class="ident" id="2085164">RangeTable</span><span class="op" id="2085174">,</span>&nbsp;<span class="ident" id="2085176">r</span>&nbsp;<span class="builtintype" id="2085178">rune</span><span class="op" id="2085182">)</span>&nbsp;<span class="builtintype" id="2085184">bool</span>&nbsp;<span class="op" id="2085189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085192">r16</span>&nbsp;<span class="op" id="2085196">:=</span>&nbsp;<span class="ident" id="2085199">rangeTab</span><span class="op" id="2085207">.</span><span class="ident" id="2085208">R16</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085213">if</span>&nbsp;<span class="builtinfunc" id="2085216">len</span><span class="op" id="2085219">(</span><span class="ident" id="2085220">r16</span><span class="op" id="2085223">)</span>&nbsp;<span class="op" id="2085225">&gt;</span>&nbsp;<span class="num" id="2085227">0</span>&nbsp;<span class="op" id="2085229">&amp;&amp;</span>&nbsp;<span class="ident" id="2085232">r</span>&nbsp;<span class="op" id="2085234">&lt;=</span>&nbsp;<span class="builtintype" id="2085237">rune</span><span class="op" id="2085241">(</span><span class="ident" id="2085242">r16</span><span class="op" id="2085245">[</span><span class="builtinfunc" id="2085246">len</span><span class="op" id="2085249">(</span><span class="ident" id="2085250">r16</span><span class="op" id="2085253">)</span><span class="op" id="2085254">-</span><span class="num" id="2085255">1</span><span class="op" id="2085256">]</span><span class="op" id="2085257">.</span><span class="ident" id="2085258">Hi</span><span class="op" id="2085260">)</span>&nbsp;<span class="op" id="2085262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085266">return</span>&nbsp;<span class="ident" id="2085273">is16</span><span class="op" id="2085277">(</span><span class="ident" id="2085278">r16</span><span class="op" id="2085281">,</span>&nbsp;<span class="builtintype" id="2085283">uint16</span><span class="op" id="2085289">(</span><span class="ident" id="2085290">r</span><span class="op" id="2085291">)</span><span class="op" id="2085292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085298">r32</span>&nbsp;<span class="op" id="2085302">:=</span>&nbsp;<span class="ident" id="2085305">rangeTab</span><span class="op" id="2085313">.</span><span class="ident" id="2085314">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085319">if</span>&nbsp;<span class="builtinfunc" id="2085322">len</span><span class="op" id="2085325">(</span><span class="ident" id="2085326">r32</span><span class="op" id="2085329">)</span>&nbsp;<span class="op" id="2085331">&gt;</span>&nbsp;<span class="num" id="2085333">0</span>&nbsp;<span class="op" id="2085335">&amp;&amp;</span>&nbsp;<span class="ident" id="2085338">r</span>&nbsp;<span class="op" id="2085340">&gt;=</span>&nbsp;<span class="builtintype" id="2085343">rune</span><span class="op" id="2085347">(</span><span class="ident" id="2085348">r32</span><span class="op" id="2085351">[</span><span class="num" id="2085352">0</span><span class="op" id="2085353">]</span><span class="op" id="2085354">.</span><span class="ident" id="2085355">Lo</span><span class="op" id="2085357">)</span>&nbsp;<span class="op" id="2085359">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085363">return</span>&nbsp;<span class="ident" id="2085370">is32</span><span class="op" id="2085374">(</span><span class="ident" id="2085375">r32</span><span class="op" id="2085378">,</span>&nbsp;<span class="builtintype" id="2085380">uint32</span><span class="op" id="2085386">(</span><span class="ident" id="2085387">r</span><span class="op" id="2085388">)</span><span class="op" id="2085389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085395">return</span>&nbsp;<span class="builtintype" id="2085402">false</span><br>
<span class="lineno"></span><span class="op" id="2085408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="2085411">func</span>&nbsp;<span class="ident" id="2085416">isExcludingLatin</span><span class="op" id="2085432">(</span><span class="ident" id="2085433">rangeTab</span>&nbsp;<span class="op" id="2085442">*</span><span class="ident" id="2085443">RangeTable</span><span class="op" id="2085453">,</span>&nbsp;<span class="ident" id="2085455">r</span>&nbsp;<span class="builtintype" id="2085457">rune</span><span class="op" id="2085461">)</span>&nbsp;<span class="builtintype" id="2085463">bool</span>&nbsp;<span class="op" id="2085468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085471">r16</span>&nbsp;<span class="op" id="2085475">:=</span>&nbsp;<span class="ident" id="2085478">rangeTab</span><span class="op" id="2085486">.</span><span class="ident" id="2085487">R16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085492">if</span>&nbsp;<span class="ident" id="2085495">off</span>&nbsp;<span class="op" id="2085499">:=</span>&nbsp;<span class="ident" id="2085502">rangeTab</span><span class="op" id="2085510">.</span><span class="ident" id="2085511">LatinOffset</span><span class="op" id="2085522">;</span>&nbsp;<span class="builtinfunc" id="2085524">len</span><span class="op" id="2085527">(</span><span class="ident" id="2085528">r16</span><span class="op" id="2085531">)</span>&nbsp;<span class="op" id="2085533">&gt;</span>&nbsp;<span class="ident" id="2085535">off</span>&nbsp;<span class="op" id="2085539">&amp;&amp;</span>&nbsp;<span class="ident" id="2085542">r</span>&nbsp;<span class="op" id="2085544">&lt;=</span>&nbsp;<span class="builtintype" id="2085547">rune</span><span class="op" id="2085551">(</span><span class="ident" id="2085552">r16</span><span class="op" id="2085555">[</span><span class="builtinfunc" id="2085556">len</span><span class="op" id="2085559">(</span><span class="ident" id="2085560">r16</span><span class="op" id="2085563">)</span><span class="op" id="2085564">-</span><span class="num" id="2085565">1</span><span class="op" id="2085566">]</span><span class="op" id="2085567">.</span><span class="ident" id="2085568">Hi</span><span class="op" id="2085570">)</span>&nbsp;<span class="op" id="2085572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085576">return</span>&nbsp;<span class="ident" id="2085583">is16</span><span class="op" id="2085587">(</span><span class="ident" id="2085588">r16</span><span class="op" id="2085591">[</span><span class="ident" id="2085592">off</span><span class="op" id="2085595">:</span><span class="op" id="2085596">]</span><span class="op" id="2085597">,</span>&nbsp;<span class="builtintype" id="2085599">uint16</span><span class="op" id="2085605">(</span><span class="ident" id="2085606">r</span><span class="op" id="2085607">)</span><span class="op" id="2085608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085611">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085614">r32</span>&nbsp;<span class="op" id="2085618">:=</span>&nbsp;<span class="ident" id="2085621">rangeTab</span><span class="op" id="2085629">.</span><span class="ident" id="2085630">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085635">if</span>&nbsp;<span class="builtinfunc" id="2085638">len</span><span class="op" id="2085641">(</span><span class="ident" id="2085642">r32</span><span class="op" id="2085645">)</span>&nbsp;<span class="op" id="2085647">&gt;</span>&nbsp;<span class="num" id="2085649">0</span>&nbsp;<span class="op" id="2085651">&amp;&amp;</span>&nbsp;<span class="ident" id="2085654">r</span>&nbsp;<span class="op" id="2085656">&gt;=</span>&nbsp;<span class="builtintype" id="2085659">rune</span><span class="op" id="2085663">(</span><span class="ident" id="2085664">r32</span><span class="op" id="2085667">[</span><span class="num" id="2085668">0</span><span class="op" id="2085669">]</span><span class="op" id="2085670">.</span><span class="ident" id="2085671">Lo</span><span class="op" id="2085673">)</span>&nbsp;<span class="op" id="2085675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085679">return</span>&nbsp;<span class="ident" id="2085686">is32</span><span class="op" id="2085690">(</span><span class="ident" id="2085691">r32</span><span class="op" id="2085694">,</span>&nbsp;<span class="builtintype" id="2085696">uint32</span><span class="op" id="2085702">(</span><span class="ident" id="2085703">r</span><span class="op" id="2085704">)</span><span class="op" id="2085705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085711">return</span>&nbsp;<span class="builtintype" id="2085718">false</span><br>
<span class="lineno">180</span><span class="op" id="2085724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2085727">//&nbsp;IsUpper&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;an&nbsp;upper&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="2085788">func</span>&nbsp;<span class="ident" id="2085793">IsUpper</span><span class="op" id="2085800">(</span><span class="ident" id="2085801">r</span>&nbsp;<span class="builtintype" id="2085803">rune</span><span class="op" id="2085807">)</span>&nbsp;<span class="builtintype" id="2085809">bool</span>&nbsp;<span class="op" id="2085814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085817">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085847">if</span>&nbsp;<span class="builtintype" id="2085850">uint32</span><span class="op" id="2085856">(</span><span class="ident" id="2085857">r</span><span class="op" id="2085858">)</span>&nbsp;<span class="op" id="2085860">&lt;=</span>&nbsp;<span class="ident" id="2085863">MaxLatin1</span>&nbsp;<span class="op" id="2085873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085877">return</span>&nbsp;<span class="ident" id="2085884">properties</span><span class="op" id="2085894">[</span><span class="builtintype" id="2085895">uint8</span><span class="op" id="2085900">(</span><span class="ident" id="2085901">r</span><span class="op" id="2085902">)</span><span class="op" id="2085903">]</span><span class="op" id="2085904">&amp;</span><span class="ident" id="2085905">pLmask</span>&nbsp;<span class="op" id="2085912">==</span>&nbsp;<span class="ident" id="2085915">pLu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085923">return</span>&nbsp;<span class="ident" id="2085930">isExcludingLatin</span><span class="op" id="2085946">(</span><span class="ident" id="2085947">Upper</span><span class="op" id="2085952">,</span>&nbsp;<span class="ident" id="2085954">r</span><span class="op" id="2085955">)</span><br>
<span class="lineno"></span><span class="op" id="2085957">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="2085960">//&nbsp;IsLower&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;lower&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="2086020">func</span>&nbsp;<span class="ident" id="2086025">IsLower</span><span class="op" id="2086032">(</span><span class="ident" id="2086033">r</span>&nbsp;<span class="builtintype" id="2086035">rune</span><span class="op" id="2086039">)</span>&nbsp;<span class="builtintype" id="2086041">bool</span>&nbsp;<span class="op" id="2086046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086049">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086079">if</span>&nbsp;<span class="builtintype" id="2086082">uint32</span><span class="op" id="2086088">(</span><span class="ident" id="2086089">r</span><span class="op" id="2086090">)</span>&nbsp;<span class="op" id="2086092">&lt;=</span>&nbsp;<span class="ident" id="2086095">MaxLatin1</span>&nbsp;<span class="op" id="2086105">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086109">return</span>&nbsp;<span class="ident" id="2086116">properties</span><span class="op" id="2086126">[</span><span class="builtintype" id="2086127">uint8</span><span class="op" id="2086132">(</span><span class="ident" id="2086133">r</span><span class="op" id="2086134">)</span><span class="op" id="2086135">]</span><span class="op" id="2086136">&amp;</span><span class="ident" id="2086137">pLmask</span>&nbsp;<span class="op" id="2086144">==</span>&nbsp;<span class="ident" id="2086147">pLl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086155">return</span>&nbsp;<span class="ident" id="2086162">isExcludingLatin</span><span class="op" id="2086178">(</span><span class="ident" id="2086179">Lower</span><span class="op" id="2086184">,</span>&nbsp;<span class="ident" id="2086186">r</span><span class="op" id="2086187">)</span><br>
<span class="lineno"></span><span class="op" id="2086189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="2086192">//&nbsp;IsTitle&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;title&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="2086252">func</span>&nbsp;<span class="ident" id="2086257">IsTitle</span><span class="op" id="2086264">(</span><span class="ident" id="2086265">r</span>&nbsp;<span class="builtintype" id="2086267">rune</span><span class="op" id="2086271">)</span>&nbsp;<span class="builtintype" id="2086273">bool</span>&nbsp;<span class="op" id="2086278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086281">if</span>&nbsp;<span class="ident" id="2086284">r</span>&nbsp;<span class="op" id="2086286">&lt;=</span>&nbsp;<span class="ident" id="2086289">MaxLatin1</span>&nbsp;<span class="op" id="2086299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086303">return</span>&nbsp;<span class="builtintype" id="2086310">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086317">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086320">return</span>&nbsp;<span class="ident" id="2086327">isExcludingLatin</span><span class="op" id="2086343">(</span><span class="ident" id="2086344">Title</span><span class="op" id="2086349">,</span>&nbsp;<span class="ident" id="2086351">r</span><span class="op" id="2086352">)</span><br>
<span class="lineno"></span><span class="op" id="2086354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2086357">//&nbsp;to&nbsp;maps&nbsp;the&nbsp;rune&nbsp;using&nbsp;the&nbsp;specified&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="2086411">func</span>&nbsp;<span class="ident" id="2086416">to</span><span class="op" id="2086418">(</span><span class="ident" id="2086419">_case</span>&nbsp;<span class="builtintype" id="2086425">int</span><span class="op" id="2086428">,</span>&nbsp;<span class="ident" id="2086430">r</span>&nbsp;<span class="builtintype" id="2086432">rune</span><span class="op" id="2086436">,</span>&nbsp;<span class="ident" id="2086438">caseRange</span>&nbsp;<span class="op" id="2086448">[</span><span class="op" id="2086449">]</span><span class="ident" id="2086450">CaseRange</span><span class="op" id="2086459">)</span>&nbsp;<span class="builtintype" id="2086461">rune</span>&nbsp;<span class="op" id="2086466">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086469">if</span>&nbsp;<span class="ident" id="2086472">_case</span>&nbsp;<span class="op" id="2086478">&lt;</span>&nbsp;<span class="num" id="2086480">0</span>&nbsp;<span class="op" id="2086482">||</span>&nbsp;<span class="ident" id="2086485">MaxCase</span>&nbsp;<span class="op" id="2086493">&lt;=</span>&nbsp;<span class="ident" id="2086496">_case</span>&nbsp;<span class="op" id="2086502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086506">return</span>&nbsp;<span class="ident" id="2086513">ReplacementChar</span>&nbsp;<span class="comment" id="2086529">//&nbsp;as&nbsp;reasonable&nbsp;an&nbsp;error&nbsp;as&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086566">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086596">lo</span>&nbsp;<span class="op" id="2086599">:=</span>&nbsp;<span class="num" id="2086602">0</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086605">hi</span>&nbsp;<span class="op" id="2086608">:=</span>&nbsp;<span class="builtinfunc" id="2086611">len</span><span class="op" id="2086614">(</span><span class="ident" id="2086615">caseRange</span><span class="op" id="2086624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086627">for</span>&nbsp;<span class="ident" id="2086631">lo</span>&nbsp;<span class="op" id="2086634">&lt;</span>&nbsp;<span class="ident" id="2086636">hi</span>&nbsp;<span class="op" id="2086639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086643">m</span>&nbsp;<span class="op" id="2086645">:=</span>&nbsp;<span class="ident" id="2086648">lo</span>&nbsp;<span class="op" id="2086651">+</span>&nbsp;<span class="op" id="2086653">(</span><span class="ident" id="2086654">hi</span><span class="op" id="2086656">-</span><span class="ident" id="2086657">lo</span><span class="op" id="2086659">)</span><span class="op" id="2086660">/</span><span class="num" id="2086661">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086665">cr</span>&nbsp;<span class="op" id="2086668">:=</span>&nbsp;<span class="ident" id="2086671">caseRange</span><span class="op" id="2086680">[</span><span class="ident" id="2086681">m</span><span class="op" id="2086682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086686">if</span>&nbsp;<span class="builtintype" id="2086689">rune</span><span class="op" id="2086693">(</span><span class="ident" id="2086694">cr</span><span class="op" id="2086696">.</span><span class="ident" id="2086697">Lo</span><span class="op" id="2086699">)</span>&nbsp;<span class="op" id="2086701">&lt;=</span>&nbsp;<span class="ident" id="2086704">r</span>&nbsp;<span class="op" id="2086706">&amp;&amp;</span>&nbsp;<span class="ident" id="2086709">r</span>&nbsp;<span class="op" id="2086711">&lt;=</span>&nbsp;<span class="builtintype" id="2086714">rune</span><span class="op" id="2086718">(</span><span class="ident" id="2086719">cr</span><span class="op" id="2086721">.</span><span class="ident" id="2086722">Hi</span><span class="op" id="2086724">)</span>&nbsp;<span class="op" id="2086726">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086731">delta</span>&nbsp;<span class="op" id="2086737">:=</span>&nbsp;<span class="builtintype" id="2086740">rune</span><span class="op" id="2086744">(</span><span class="ident" id="2086745">cr</span><span class="op" id="2086747">.</span><span class="ident" id="2086748">Delta</span><span class="op" id="2086753">[</span><span class="ident" id="2086754">_case</span><span class="op" id="2086759">]</span><span class="op" id="2086760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086765">if</span>&nbsp;<span class="ident" id="2086768">delta</span>&nbsp;<span class="op" id="2086774">&gt;</span>&nbsp;<span class="ident" id="2086776">MaxRune</span>&nbsp;<span class="op" id="2086784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086790">//&nbsp;In&nbsp;an&nbsp;Upper-Lower&nbsp;sequence,&nbsp;which&nbsp;always&nbsp;starts&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086850">//&nbsp;an&nbsp;UpperCase&nbsp;letter,&nbsp;the&nbsp;real&nbsp;deltas&nbsp;always&nbsp;look&nbsp;like:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086912">//&nbsp;&nbsp;&nbsp;&nbsp{0,&nbsp;1,&nbsp;0}&nbsp;&nbsp;&nbsp;&nbsp;UpperCase&nbsp;(Lower&nbsp;is&nbsp;next)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086958">//&nbsp;&nbsp;&nbsp;&nbsp{-1,&nbsp;0,&nbsp;-1}&nbsp;&nbsp;LowerCase&nbsp;(Upper,&nbsp;Title&nbsp;are&nbsp;previous)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087016">//&nbsp;The&nbsp;characters&nbsp;at&nbsp;even&nbsp;offsets&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087080">//&nbsp;sequence&nbsp;are&nbsp;upper&nbsp;case;&nbsp;the&nbsp;ones&nbsp;at&nbsp;odd&nbsp;offsets&nbsp;are&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087147">//&nbsp;The&nbsp;correct&nbsp;mapping&nbsp;can&nbsp;be&nbsp;done&nbsp;by&nbsp;clearing&nbsp;or&nbsp;setting&nbsp;the&nbsp;low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087217">//&nbsp;bit&nbsp;in&nbsp;the&nbsp;sequence&nbsp;offset.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087252">//&nbsp;The&nbsp;constants&nbsp;UpperCase&nbsp;and&nbsp;TitleCase&nbsp;are&nbsp;even&nbsp;while&nbsp;LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087322">//&nbsp;is&nbsp;odd&nbsp;so&nbsp;we&nbsp;take&nbsp;the&nbsp;low&nbsp;bit&nbsp;from&nbsp;_case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087371">return</span>&nbsp;<span class="builtintype" id="2087378">rune</span><span class="op" id="2087382">(</span><span class="ident" id="2087383">cr</span><span class="op" id="2087385">.</span><span class="ident" id="2087386">Lo</span><span class="op" id="2087388">)</span>&nbsp;<span class="op" id="2087390">+</span>&nbsp;<span class="op" id="2087392">(</span><span class="op" id="2087393">(</span><span class="ident" id="2087394">r</span><span class="op" id="2087395">-</span><span class="builtintype" id="2087396">rune</span><span class="op" id="2087400">(</span><span class="ident" id="2087401">cr</span><span class="op" id="2087403">.</span><span class="ident" id="2087404">Lo</span><span class="op" id="2087406">)</span><span class="op" id="2087407">)</span><span class="op" id="2087408">&amp;^</span><span class="num" id="2087410">1</span>&nbsp;<span class="op" id="2087412">|</span>&nbsp;<span class="builtintype" id="2087414">rune</span><span class="op" id="2087418">(</span><span class="ident" id="2087419">_case</span><span class="op" id="2087424">&amp;</span><span class="num" id="2087425">1</span><span class="op" id="2087426">)</span><span class="op" id="2087427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087437">return</span>&nbsp;<span class="ident" id="2087444">r</span>&nbsp;<span class="op" id="2087446">+</span>&nbsp;<span class="ident" id="2087448">delta</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087460">if</span>&nbsp;<span class="ident" id="2087463">r</span>&nbsp;<span class="op" id="2087465">&lt;</span>&nbsp;<span class="builtintype" id="2087467">rune</span><span class="op" id="2087471">(</span><span class="ident" id="2087472">cr</span><span class="op" id="2087474">.</span><span class="ident" id="2087475">Lo</span><span class="op" id="2087477">)</span>&nbsp;<span class="op" id="2087479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087484">hi</span>&nbsp;<span class="op" id="2087487">=</span>&nbsp;<span class="ident" id="2087489">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087493">}</span>&nbsp;<span class="keyword" id="2087495">else</span>&nbsp;<span class="op" id="2087500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087505">lo</span>&nbsp;<span class="op" id="2087508">=</span>&nbsp;<span class="ident" id="2087510">m</span>&nbsp;<span class="op" id="2087512">+</span>&nbsp;<span class="num" id="2087514">1</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087524">return</span>&nbsp;<span class="ident" id="2087531">r</span><br>
<span class="lineno"></span><span class="op" id="2087533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="2087536">//&nbsp;To&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;the&nbsp;specified&nbsp;case:&nbsp;UpperCase,&nbsp;LowerCase,&nbsp;or&nbsp;TitleCase.</span><br>
<span class="lineno"></span><span class="keyword" id="2087615">func</span>&nbsp;<span class="ident" id="2087620">To</span><span class="op" id="2087622">(</span><span class="ident" id="2087623">_case</span>&nbsp;<span class="builtintype" id="2087629">int</span><span class="op" id="2087632">,</span>&nbsp;<span class="ident" id="2087634">r</span>&nbsp;<span class="builtintype" id="2087636">rune</span><span class="op" id="2087640">)</span>&nbsp;<span class="builtintype" id="2087642">rune</span>&nbsp;<span class="op" id="2087647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087650">return</span>&nbsp;<span class="ident" id="2087657">to</span><span class="op" id="2087659">(</span><span class="ident" id="2087660">_case</span><span class="op" id="2087665">,</span>&nbsp;<span class="ident" id="2087667">r</span><span class="op" id="2087668">,</span>&nbsp;<span class="ident" id="2087670">CaseRanges</span><span class="op" id="2087680">)</span><br>
<span class="lineno"></span><span class="op" id="2087682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="2087685">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2087725">func</span>&nbsp;<span class="ident" id="2087730">ToUpper</span><span class="op" id="2087737">(</span><span class="ident" id="2087738">r</span>&nbsp;<span class="builtintype" id="2087740">rune</span><span class="op" id="2087744">)</span>&nbsp;<span class="builtintype" id="2087746">rune</span>&nbsp;<span class="op" id="2087751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087754">if</span>&nbsp;<span class="ident" id="2087757">r</span>&nbsp;<span class="op" id="2087759">&lt;=</span>&nbsp;<span class="ident" id="2087762">MaxASCII</span>&nbsp;<span class="op" id="2087771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087775">if</span>&nbsp;<span class="string" id="2087778">&#39;a&#39;</span>&nbsp;<span class="op" id="2087782">&lt;=</span>&nbsp;<span class="ident" id="2087785">r</span>&nbsp;<span class="op" id="2087787">&amp;&amp;</span>&nbsp;<span class="ident" id="2087790">r</span>&nbsp;<span class="op" id="2087792">&lt;=</span>&nbsp;<span class="string" id="2087795">&#39;z&#39;</span>&nbsp;<span class="op" id="2087799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087804">r</span>&nbsp;<span class="op" id="2087806">-=</span>&nbsp;<span class="string" id="2087809">&#39;a&#39;</span>&nbsp;<span class="op" id="2087813">-</span>&nbsp;<span class="string" id="2087815">&#39;A&#39;</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087825">return</span>&nbsp;<span class="ident" id="2087832">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087838">return</span>&nbsp;<span class="ident" id="2087845">To</span><span class="op" id="2087847">(</span><span class="ident" id="2087848">UpperCase</span><span class="op" id="2087857">,</span>&nbsp;<span class="ident" id="2087859">r</span><span class="op" id="2087860">)</span><br>
<span class="lineno"></span><span class="op" id="2087862">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="2087865">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2087905">func</span>&nbsp;<span class="ident" id="2087910">ToLower</span><span class="op" id="2087917">(</span><span class="ident" id="2087918">r</span>&nbsp;<span class="builtintype" id="2087920">rune</span><span class="op" id="2087924">)</span>&nbsp;<span class="builtintype" id="2087926">rune</span>&nbsp;<span class="op" id="2087931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087934">if</span>&nbsp;<span class="ident" id="2087937">r</span>&nbsp;<span class="op" id="2087939">&lt;=</span>&nbsp;<span class="ident" id="2087942">MaxASCII</span>&nbsp;<span class="op" id="2087951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087955">if</span>&nbsp;<span class="string" id="2087958">&#39;A&#39;</span>&nbsp;<span class="op" id="2087962">&lt;=</span>&nbsp;<span class="ident" id="2087965">r</span>&nbsp;<span class="op" id="2087967">&amp;&amp;</span>&nbsp;<span class="ident" id="2087970">r</span>&nbsp;<span class="op" id="2087972">&lt;=</span>&nbsp;<span class="string" id="2087975">&#39;Z&#39;</span>&nbsp;<span class="op" id="2087979">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087984">r</span>&nbsp;<span class="op" id="2087986">+=</span>&nbsp;<span class="string" id="2087989">&#39;a&#39;</span>&nbsp;<span class="op" id="2087993">-</span>&nbsp;<span class="string" id="2087995">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088005">return</span>&nbsp;<span class="ident" id="2088012">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088018">return</span>&nbsp;<span class="ident" id="2088025">To</span><span class="op" id="2088027">(</span><span class="ident" id="2088028">LowerCase</span><span class="op" id="2088037">,</span>&nbsp;<span class="ident" id="2088039">r</span><span class="op" id="2088040">)</span><br>
<span class="lineno">270</span><span class="op" id="2088042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2088045">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2088085">func</span>&nbsp;<span class="ident" id="2088090">ToTitle</span><span class="op" id="2088097">(</span><span class="ident" id="2088098">r</span>&nbsp;<span class="builtintype" id="2088100">rune</span><span class="op" id="2088104">)</span>&nbsp;<span class="builtintype" id="2088106">rune</span>&nbsp;<span class="op" id="2088111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088114">if</span>&nbsp;<span class="ident" id="2088117">r</span>&nbsp;<span class="op" id="2088119">&lt;=</span>&nbsp;<span class="ident" id="2088122">MaxASCII</span>&nbsp;<span class="op" id="2088131">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088135">if</span>&nbsp;<span class="string" id="2088138">&#39;a&#39;</span>&nbsp;<span class="op" id="2088142">&lt;=</span>&nbsp;<span class="ident" id="2088145">r</span>&nbsp;<span class="op" id="2088147">&amp;&amp;</span>&nbsp;<span class="ident" id="2088150">r</span>&nbsp;<span class="op" id="2088152">&lt;=</span>&nbsp;<span class="string" id="2088155">&#39;z&#39;</span>&nbsp;<span class="op" id="2088159">{</span>&nbsp;<span class="comment" id="2088161">//&nbsp;title&nbsp;case&nbsp;is&nbsp;upper&nbsp;case&nbsp;for&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088202">r</span>&nbsp;<span class="op" id="2088204">-=</span>&nbsp;<span class="string" id="2088207">&#39;a&#39;</span>&nbsp;<span class="op" id="2088211">-</span>&nbsp;<span class="string" id="2088213">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088223">return</span>&nbsp;<span class="ident" id="2088230">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088233">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088236">return</span>&nbsp;<span class="ident" id="2088243">To</span><span class="op" id="2088245">(</span><span class="ident" id="2088246">TitleCase</span><span class="op" id="2088255">,</span>&nbsp;<span class="ident" id="2088257">r</span><span class="op" id="2088258">)</span><br>
<span class="lineno"></span><span class="op" id="2088260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2088263">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="2088342">func</span>&nbsp;<span class="op" id="2088347">(</span><span class="ident" id="2088348">special</span>&nbsp;<span class="ident" id="2088356">SpecialCase</span><span class="op" id="2088367">)</span>&nbsp;<span class="ident" id="2088369">ToUpper</span><span class="op" id="2088376">(</span><span class="ident" id="2088377">r</span>&nbsp;<span class="builtintype" id="2088379">rune</span><span class="op" id="2088383">)</span>&nbsp;<span class="builtintype" id="2088385">rune</span>&nbsp;<span class="op" id="2088390">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088393">r1</span>&nbsp;<span class="op" id="2088396">:=</span>&nbsp;<span class="ident" id="2088399">to</span><span class="op" id="2088401">(</span><span class="ident" id="2088402">UpperCase</span><span class="op" id="2088411">,</span>&nbsp;<span class="ident" id="2088413">r</span><span class="op" id="2088414">,</span>&nbsp;<span class="op" id="2088416">[</span><span class="op" id="2088417">]</span><span class="ident" id="2088418">CaseRange</span><span class="op" id="2088427">(</span><span class="ident" id="2088428">special</span><span class="op" id="2088435">)</span><span class="op" id="2088436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088439">if</span>&nbsp;<span class="ident" id="2088442">r1</span>&nbsp;<span class="op" id="2088445">==</span>&nbsp;<span class="ident" id="2088448">r</span>&nbsp;<span class="op" id="2088450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088454">r1</span>&nbsp;<span class="op" id="2088457">=</span>&nbsp;<span class="ident" id="2088459">ToUpper</span><span class="op" id="2088466">(</span><span class="ident" id="2088467">r</span><span class="op" id="2088468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088474">return</span>&nbsp;<span class="ident" id="2088481">r1</span><br>
<span class="lineno">290</span><span class="op" id="2088484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2088487">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="2088566">func</span>&nbsp;<span class="op" id="2088571">(</span><span class="ident" id="2088572">special</span>&nbsp;<span class="ident" id="2088580">SpecialCase</span><span class="op" id="2088591">)</span>&nbsp;<span class="ident" id="2088593">ToTitle</span><span class="op" id="2088600">(</span><span class="ident" id="2088601">r</span>&nbsp;<span class="builtintype" id="2088603">rune</span><span class="op" id="2088607">)</span>&nbsp;<span class="builtintype" id="2088609">rune</span>&nbsp;<span class="op" id="2088614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088617">r1</span>&nbsp;<span class="op" id="2088620">:=</span>&nbsp;<span class="ident" id="2088623">to</span><span class="op" id="2088625">(</span><span class="ident" id="2088626">TitleCase</span><span class="op" id="2088635">,</span>&nbsp;<span class="ident" id="2088637">r</span><span class="op" id="2088638">,</span>&nbsp;<span class="op" id="2088640">[</span><span class="op" id="2088641">]</span><span class="ident" id="2088642">CaseRange</span><span class="op" id="2088651">(</span><span class="ident" id="2088652">special</span><span class="op" id="2088659">)</span><span class="op" id="2088660">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088663">if</span>&nbsp;<span class="ident" id="2088666">r1</span>&nbsp;<span class="op" id="2088669">==</span>&nbsp;<span class="ident" id="2088672">r</span>&nbsp;<span class="op" id="2088674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088678">r1</span>&nbsp;<span class="op" id="2088681">=</span>&nbsp;<span class="ident" id="2088683">ToTitle</span><span class="op" id="2088690">(</span><span class="ident" id="2088691">r</span><span class="op" id="2088692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088698">return</span>&nbsp;<span class="ident" id="2088705">r1</span><br>
<span class="lineno"></span><span class="op" id="2088708">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2088711">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="2088790">func</span>&nbsp;<span class="op" id="2088795">(</span><span class="ident" id="2088796">special</span>&nbsp;<span class="ident" id="2088804">SpecialCase</span><span class="op" id="2088815">)</span>&nbsp;<span class="ident" id="2088817">ToLower</span><span class="op" id="2088824">(</span><span class="ident" id="2088825">r</span>&nbsp;<span class="builtintype" id="2088827">rune</span><span class="op" id="2088831">)</span>&nbsp;<span class="builtintype" id="2088833">rune</span>&nbsp;<span class="op" id="2088838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088841">r1</span>&nbsp;<span class="op" id="2088844">:=</span>&nbsp;<span class="ident" id="2088847">to</span><span class="op" id="2088849">(</span><span class="ident" id="2088850">LowerCase</span><span class="op" id="2088859">,</span>&nbsp;<span class="ident" id="2088861">r</span><span class="op" id="2088862">,</span>&nbsp;<span class="op" id="2088864">[</span><span class="op" id="2088865">]</span><span class="ident" id="2088866">CaseRange</span><span class="op" id="2088875">(</span><span class="ident" id="2088876">special</span><span class="op" id="2088883">)</span><span class="op" id="2088884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088887">if</span>&nbsp;<span class="ident" id="2088890">r1</span>&nbsp;<span class="op" id="2088893">==</span>&nbsp;<span class="ident" id="2088896">r</span>&nbsp;<span class="op" id="2088898">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088902">r1</span>&nbsp;<span class="op" id="2088905">=</span>&nbsp;<span class="ident" id="2088907">ToLower</span><span class="op" id="2088914">(</span><span class="ident" id="2088915">r</span><span class="op" id="2088916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088922">return</span>&nbsp;<span class="ident" id="2088929">r1</span><br>
<span class="lineno"></span><span class="op" id="2088932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2088935">//&nbsp;caseOrbit&nbsp;is&nbsp;defined&nbsp;in&nbsp;tables.go&nbsp;as&nbsp;[]foldPair.&nbsp;&nbsp;Right&nbsp;now&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2089006">//&nbsp;entries&nbsp;fit&nbsp;in&nbsp;uint16,&nbsp;so&nbsp;use&nbsp;uint16.&nbsp;&nbsp;If&nbsp;that&nbsp;changes,&nbsp;compilation</span><br>
<span class="lineno"></span><span class="comment" id="2089077">//&nbsp;will&nbsp;fail&nbsp;(the&nbsp;constants&nbsp;in&nbsp;the&nbsp;composite&nbsp;literal&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;uint16)</span><br>
<span class="lineno"></span><span class="comment" id="2089154">//&nbsp;and&nbsp;the&nbsp;types&nbsp;here&nbsp;can&nbsp;change&nbsp;to&nbsp;uint32.</span><br>
<span class="lineno"></span><span class="keyword" id="2089198">type</span>&nbsp;<span class="ident" id="2089203">foldPair</span>&nbsp;<span class="keyword" id="2089212">struct</span>&nbsp;<span class="op" id="2089219">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089222">From</span>&nbsp;<span class="builtintype" id="2089227">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089235">To</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2089240">uint16</span><br>
<span class="lineno"></span><span class="op" id="2089247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2089250">//&nbsp;SimpleFold&nbsp;iterates&nbsp;over&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;equivalent&nbsp;under</span><br>
<span class="lineno">320</span><span class="comment" id="2089315">//&nbsp;the&nbsp;Unicode-defined&nbsp;simple&nbsp;case&nbsp;folding.&nbsp;&nbsp;Among&nbsp;the&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="2089382">//&nbsp;equivalent&nbsp;to&nbsp;rune&nbsp;(including&nbsp;rune&nbsp;itself),&nbsp;SimpleFold&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2089452">//&nbsp;smallest&nbsp;rune&nbsp;&gt;&nbsp;r&nbsp;if&nbsp;one&nbsp;exists,&nbsp;or&nbsp;else&nbsp;the&nbsp;smallest&nbsp;rune&nbsp;&gt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2089520">//</span><br>
<span class="lineno"></span><span class="comment" id="2089523">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno">325</span><span class="comment" id="2089539">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;A&#39;)&nbsp;=&nbsp;&#39;a&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2089564">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;a&#39;)&nbsp;=&nbsp;&#39;A&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2089589">//</span><br>
<span class="lineno"></span><span class="comment" id="2089592">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;K&#39;)&nbsp;=&nbsp;&#39;k&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2089617">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;k&#39;)&nbsp;=&nbsp;&#39;\u212A&#39;&nbsp;(Kelvin&nbsp;symbol,&nbsp;)</span><br>
<span class="lineno">330</span><span class="comment" id="2089668">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;\u212A&#39;)&nbsp;=&nbsp;&#39;K&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2089698">//</span><br>
<span class="lineno"></span><span class="comment" id="2089701">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;1&#39;)&nbsp;=&nbsp;&#39;1&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2089726">//</span><br>
<span class="lineno"></span><span class="keyword" id="2089729">func</span>&nbsp;<span class="ident" id="2089734">SimpleFold</span><span class="op" id="2089744">(</span><span class="ident" id="2089745">r</span>&nbsp;<span class="builtintype" id="2089747">rune</span><span class="op" id="2089751">)</span>&nbsp;<span class="builtintype" id="2089753">rune</span>&nbsp;<span class="op" id="2089758">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2089761">//&nbsp;Consult&nbsp;caseOrbit&nbsp;table&nbsp;for&nbsp;special&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089808">lo</span>&nbsp;<span class="op" id="2089811">:=</span>&nbsp;<span class="num" id="2089814">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089817">hi</span>&nbsp;<span class="op" id="2089820">:=</span>&nbsp;<span class="builtinfunc" id="2089823">len</span><span class="op" id="2089826">(</span><span class="ident" id="2089827">caseOrbit</span><span class="op" id="2089836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089839">for</span>&nbsp;<span class="ident" id="2089843">lo</span>&nbsp;<span class="op" id="2089846">&lt;</span>&nbsp;<span class="ident" id="2089848">hi</span>&nbsp;<span class="op" id="2089851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089855">m</span>&nbsp;<span class="op" id="2089857">:=</span>&nbsp;<span class="ident" id="2089860">lo</span>&nbsp;<span class="op" id="2089863">+</span>&nbsp;<span class="op" id="2089865">(</span><span class="ident" id="2089866">hi</span><span class="op" id="2089868">-</span><span class="ident" id="2089869">lo</span><span class="op" id="2089871">)</span><span class="op" id="2089872">/</span><span class="num" id="2089873">2</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089877">if</span>&nbsp;<span class="builtintype" id="2089880">rune</span><span class="op" id="2089884">(</span><span class="ident" id="2089885">caseOrbit</span><span class="op" id="2089894">[</span><span class="ident" id="2089895">m</span><span class="op" id="2089896">]</span><span class="op" id="2089897">.</span><span class="ident" id="2089898">From</span><span class="op" id="2089902">)</span>&nbsp;<span class="op" id="2089904">&lt;</span>&nbsp;<span class="ident" id="2089906">r</span>&nbsp;<span class="op" id="2089908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089913">lo</span>&nbsp;<span class="op" id="2089916">=</span>&nbsp;<span class="ident" id="2089918">m</span>&nbsp;<span class="op" id="2089920">+</span>&nbsp;<span class="num" id="2089922">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089926">}</span>&nbsp;<span class="keyword" id="2089928">else</span>&nbsp;<span class="op" id="2089933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089938">hi</span>&nbsp;<span class="op" id="2089941">=</span>&nbsp;<span class="ident" id="2089943">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089947">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089953">if</span>&nbsp;<span class="ident" id="2089956">lo</span>&nbsp;<span class="op" id="2089959">&lt;</span>&nbsp;<span class="builtinfunc" id="2089961">len</span><span class="op" id="2089964">(</span><span class="ident" id="2089965">caseOrbit</span><span class="op" id="2089974">)</span>&nbsp;<span class="op" id="2089976">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2089979">rune</span><span class="op" id="2089983">(</span><span class="ident" id="2089984">caseOrbit</span><span class="op" id="2089993">[</span><span class="ident" id="2089994">lo</span><span class="op" id="2089996">]</span><span class="op" id="2089997">.</span><span class="ident" id="2089998">From</span><span class="op" id="2090002">)</span>&nbsp;<span class="op" id="2090004">==</span>&nbsp;<span class="ident" id="2090007">r</span>&nbsp;<span class="op" id="2090009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090013">return</span>&nbsp;<span class="builtintype" id="2090020">rune</span><span class="op" id="2090024">(</span><span class="ident" id="2090025">caseOrbit</span><span class="op" id="2090034">[</span><span class="ident" id="2090035">lo</span><span class="op" id="2090037">]</span><span class="op" id="2090038">.</span><span class="ident" id="2090039">To</span><span class="op" id="2090041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2090048">//&nbsp;No&nbsp;folding&nbsp;specified.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;one-&nbsp;or&nbsp;two-element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2090105">//&nbsp;equivalence&nbsp;class&nbsp;containing&nbsp;rune&nbsp;and&nbsp;ToLower(rune)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2090161">//&nbsp;and&nbsp;ToUpper(rune)&nbsp;if&nbsp;they&nbsp;are&nbsp;different&nbsp;from&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090216">if</span>&nbsp;<span class="ident" id="2090219">l</span>&nbsp;<span class="op" id="2090221">:=</span>&nbsp;<span class="ident" id="2090224">ToLower</span><span class="op" id="2090231">(</span><span class="ident" id="2090232">r</span><span class="op" id="2090233">)</span><span class="op" id="2090234">;</span>&nbsp;<span class="ident" id="2090236">l</span>&nbsp;<span class="op" id="2090238">!=</span>&nbsp;<span class="ident" id="2090241">r</span>&nbsp;<span class="op" id="2090243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090247">return</span>&nbsp;<span class="ident" id="2090254">l</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090260">return</span>&nbsp;<span class="ident" id="2090267">ToUpper</span><span class="op" id="2090274">(</span><span class="ident" id="2090275">r</span><span class="op" id="2090276">)</span><br>
<span class="lineno"></span><span class="op" id="2090278">}</span>
</div>
</body>
</html>
