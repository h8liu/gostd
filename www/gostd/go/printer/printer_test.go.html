<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html" class="current">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7995162">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7995217">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7995271">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7995322">package</span>&nbsp;<span class="ident" id="7995330">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7995339">import</span>&nbsp;<span class="op" id="7995346">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995349">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995358">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995368">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995376">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995383">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995393">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995406">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995418">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995431">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995448">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995459">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7995466">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7995469">const</span>&nbsp;<span class="op" id="7995475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995478">dataDir</span>&nbsp;&nbsp;<span class="op" id="7995487">=</span>&nbsp;<span class="string" id="7995489">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995501">tabwidth</span>&nbsp;<span class="op" id="7995510">=</span>&nbsp;<span class="num" id="7995512">8</span><br>
<span class="lineno"></span><span class="op" id="7995514">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7995517">var</span>&nbsp;<span class="ident" id="7995521">update</span>&nbsp;<span class="op" id="7995528">=</span>&nbsp;<span class="ident" id="7995530">flag</span><span class="op" id="7995534">.</span><span class="ident" id="7995535">Bool</span><span class="op" id="7995539">(</span><span class="string" id="7995540">&#34;update&#34;</span><span class="op" id="7995548">,</span>&nbsp;<span class="builtintype" id="7995550">false</span><span class="op" id="7995555">,</span>&nbsp;<span class="string" id="7995557">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7995578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7995581">var</span>&nbsp;<span class="ident" id="7995585">fset</span>&nbsp;<span class="op" id="7995590">=</span>&nbsp;<span class="ident" id="7995592">token</span><span class="op" id="7995597">.</span><span class="ident" id="7995598">NewFileSet</span><span class="op" id="7995608">(</span><span class="op" id="7995609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7995612">type</span>&nbsp;<span class="ident" id="7995617">checkMode</span>&nbsp;<span class="builtintype" id="7995627">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7995633">const</span>&nbsp;<span class="op" id="7995639">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995642">export</span>&nbsp;<span class="ident" id="7995649">checkMode</span>&nbsp;<span class="op" id="7995659">=</span>&nbsp;<span class="num" id="7995661">1</span>&nbsp;<span class="op" id="7995663">&lt;&lt;</span>&nbsp;<span class="ident" id="7995666">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995672">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995683">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7995694">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7995697">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7995772">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7995847">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7995858">func</span>&nbsp;<span class="ident" id="7995863">format</span><span class="op" id="7995869">(</span><span class="ident" id="7995870">src</span>&nbsp;<span class="op" id="7995874">[</span><span class="op" id="7995875">]</span><span class="builtintype" id="7995876">byte</span><span class="op" id="7995880">,</span>&nbsp;<span class="ident" id="7995882">mode</span>&nbsp;<span class="ident" id="7995887">checkMode</span><span class="op" id="7995896">)</span>&nbsp;<span class="op" id="7995898">(</span><span class="op" id="7995899">[</span><span class="op" id="7995900">]</span><span class="builtintype" id="7995901">byte</span><span class="op" id="7995905">,</span>&nbsp;<span class="builtintype" id="7995907">error</span><span class="op" id="7995912">)</span>&nbsp;<span class="op" id="7995914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7995917">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995931">f</span><span class="op" id="7995932">,</span>&nbsp;<span class="ident" id="7995934">err</span>&nbsp;<span class="op" id="7995938">:=</span>&nbsp;<span class="ident" id="7995941">parser</span><span class="op" id="7995947">.</span><span class="ident" id="7995948">ParseFile</span><span class="op" id="7995957">(</span><span class="ident" id="7995958">fset</span><span class="op" id="7995962">,</span>&nbsp;<span class="string" id="7995964">&#34;&#34;</span><span class="op" id="7995966">,</span>&nbsp;<span class="ident" id="7995968">src</span><span class="op" id="7995971">,</span>&nbsp;<span class="ident" id="7995973">parser</span><span class="op" id="7995979">.</span><span class="ident" id="7995980">ParseComments</span><span class="op" id="7995993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995996">if</span>&nbsp;<span class="ident" id="7995999">err</span>&nbsp;<span class="op" id="7996003">!=</span>&nbsp;<span class="ident" id="7996006">nil</span>&nbsp;<span class="op" id="7996010">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996014">return</span>&nbsp;<span class="ident" id="7996021">nil</span><span class="op" id="7996024">,</span>&nbsp;<span class="ident" id="7996026">fmt</span><span class="op" id="7996029">.</span><span class="ident" id="7996030">Errorf</span><span class="op" id="7996036">(</span><span class="string" id="7996037">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7996052">,</span>&nbsp;<span class="ident" id="7996054">err</span><span class="op" id="7996057">,</span>&nbsp;<span class="ident" id="7996059">src</span><span class="op" id="7996062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7996069">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996101">if</span>&nbsp;<span class="ident" id="7996104">mode</span><span class="op" id="7996108">&amp;</span><span class="ident" id="7996109">export</span>&nbsp;<span class="op" id="7996116">!=</span>&nbsp;<span class="num" id="7996119">0</span>&nbsp;<span class="op" id="7996121">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996125">ast</span><span class="op" id="7996128">.</span><span class="ident" id="7996129">FileExports</span><span class="op" id="7996140">(</span><span class="ident" id="7996141">f</span><span class="op" id="7996142">)</span>&nbsp;<span class="comment" id="7996144">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996163">f</span><span class="op" id="7996164">.</span><span class="ident" id="7996165">Comments</span>&nbsp;<span class="op" id="7996174">=</span>&nbsp;<span class="ident" id="7996176">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7996182">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7996231">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996267">cfg</span>&nbsp;<span class="op" id="7996271">:=</span>&nbsp;<span class="ident" id="7996274">Config</span><span class="op" id="7996280">{</span><span class="ident" id="7996281">Tabwidth</span><span class="op" id="7996289">:</span>&nbsp;<span class="ident" id="7996291">tabwidth</span><span class="op" id="7996299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996302">if</span>&nbsp;<span class="ident" id="7996305">mode</span><span class="op" id="7996309">&amp;</span><span class="ident" id="7996310">rawFormat</span>&nbsp;<span class="op" id="7996320">!=</span>&nbsp;<span class="num" id="7996323">0</span>&nbsp;<span class="op" id="7996325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996329">cfg</span><span class="op" id="7996332">.</span><span class="ident" id="7996333">Mode</span>&nbsp;<span class="op" id="7996338">|=</span>&nbsp;<span class="ident" id="7996341">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7996356">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996370">var</span>&nbsp;<span class="ident" id="7996374">buf</span>&nbsp;<span class="ident" id="7996378">bytes</span><span class="op" id="7996383">.</span><span class="ident" id="7996384">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996392">if</span>&nbsp;<span class="ident" id="7996395">err</span>&nbsp;<span class="op" id="7996399">:=</span>&nbsp;<span class="ident" id="7996402">cfg</span><span class="op" id="7996405">.</span><span class="ident" id="7996406">Fprint</span><span class="op" id="7996412">(</span><span class="op" id="7996413">&amp;</span><span class="ident" id="7996414">buf</span><span class="op" id="7996417">,</span>&nbsp;<span class="ident" id="7996419">fset</span><span class="op" id="7996423">,</span>&nbsp;<span class="ident" id="7996425">f</span><span class="op" id="7996426">)</span><span class="op" id="7996427">;</span>&nbsp;<span class="ident" id="7996429">err</span>&nbsp;<span class="op" id="7996433">!=</span>&nbsp;<span class="ident" id="7996436">nil</span>&nbsp;<span class="op" id="7996440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996444">return</span>&nbsp;<span class="ident" id="7996451">nil</span><span class="op" id="7996454">,</span>&nbsp;<span class="ident" id="7996456">fmt</span><span class="op" id="7996459">.</span><span class="ident" id="7996460">Errorf</span><span class="op" id="7996466">(</span><span class="string" id="7996467">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7996478">,</span>&nbsp;<span class="ident" id="7996480">err</span><span class="op" id="7996483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996486">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7996490">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996546">res</span>&nbsp;<span class="op" id="7996550">:=</span>&nbsp;<span class="ident" id="7996553">buf</span><span class="op" id="7996556">.</span><span class="ident" id="7996557">Bytes</span><span class="op" id="7996562">(</span><span class="op" id="7996563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996566">if</span>&nbsp;<span class="ident" id="7996569">_</span><span class="op" id="7996570">,</span>&nbsp;<span class="ident" id="7996572">err</span>&nbsp;<span class="op" id="7996576">:=</span>&nbsp;<span class="ident" id="7996579">parser</span><span class="op" id="7996585">.</span><span class="ident" id="7996586">ParseFile</span><span class="op" id="7996595">(</span><span class="ident" id="7996596">fset</span><span class="op" id="7996600">,</span>&nbsp;<span class="string" id="7996602">&#34;&#34;</span><span class="op" id="7996604">,</span>&nbsp;<span class="ident" id="7996606">res</span><span class="op" id="7996609">,</span>&nbsp;<span class="num" id="7996611">0</span><span class="op" id="7996612">)</span><span class="op" id="7996613">;</span>&nbsp;<span class="ident" id="7996615">err</span>&nbsp;<span class="op" id="7996619">!=</span>&nbsp;<span class="ident" id="7996622">nil</span>&nbsp;<span class="op" id="7996626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996630">return</span>&nbsp;<span class="ident" id="7996637">nil</span><span class="op" id="7996640">,</span>&nbsp;<span class="ident" id="7996642">fmt</span><span class="op" id="7996645">.</span><span class="ident" id="7996646">Errorf</span><span class="op" id="7996652">(</span><span class="string" id="7996653">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7996671">,</span>&nbsp;<span class="ident" id="7996673">err</span><span class="op" id="7996676">,</span>&nbsp;<span class="ident" id="7996678">buf</span><span class="op" id="7996681">.</span><span class="ident" id="7996682">Bytes</span><span class="op" id="7996687">(</span><span class="op" id="7996688">)</span><span class="op" id="7996689">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996696">return</span>&nbsp;<span class="ident" id="7996703">res</span><span class="op" id="7996706">,</span>&nbsp;<span class="ident" id="7996708">nil</span><br>
<span class="lineno"></span><span class="op" id="7996712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7996715">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7996775">func</span>&nbsp;<span class="ident" id="7996780">lineAt</span><span class="op" id="7996786">(</span><span class="ident" id="7996787">text</span>&nbsp;<span class="op" id="7996792">[</span><span class="op" id="7996793">]</span><span class="builtintype" id="7996794">byte</span><span class="op" id="7996798">,</span>&nbsp;<span class="ident" id="7996800">offs</span>&nbsp;<span class="builtintype" id="7996805">int</span><span class="op" id="7996808">)</span>&nbsp;<span class="op" id="7996810">[</span><span class="op" id="7996811">]</span><span class="builtintype" id="7996812">byte</span>&nbsp;<span class="op" id="7996817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996820">i</span>&nbsp;<span class="op" id="7996822">:=</span>&nbsp;<span class="ident" id="7996825">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996831">for</span>&nbsp;<span class="ident" id="7996835">i</span>&nbsp;<span class="op" id="7996837">&lt;</span>&nbsp;<span class="builtinfunc" id="7996839">len</span><span class="op" id="7996842">(</span><span class="ident" id="7996843">text</span><span class="op" id="7996847">)</span>&nbsp;<span class="op" id="7996849">&amp;&amp;</span>&nbsp;<span class="ident" id="7996852">text</span><span class="op" id="7996856">[</span><span class="ident" id="7996857">i</span><span class="op" id="7996858">]</span>&nbsp;<span class="op" id="7996860">!=</span>&nbsp;<span class="string" id="7996863">&#39;\n&#39;</span>&nbsp;<span class="op" id="7996868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996872">i</span><span class="op" id="7996873">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996880">return</span>&nbsp;<span class="ident" id="7996887">text</span><span class="op" id="7996891">[</span><span class="ident" id="7996892">offs</span><span class="op" id="7996896">:</span><span class="ident" id="7996897">i</span><span class="op" id="7996898">]</span><br>
<span class="lineno"></span><span class="op" id="7996900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7996903">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7996929">func</span>&nbsp;<span class="ident" id="7996934">diff</span><span class="op" id="7996938">(</span><span class="ident" id="7996939">aname</span><span class="op" id="7996944">,</span>&nbsp;<span class="ident" id="7996946">bname</span>&nbsp;<span class="builtintype" id="7996952">string</span><span class="op" id="7996958">,</span>&nbsp;<span class="ident" id="7996960">a</span><span class="op" id="7996961">,</span>&nbsp;<span class="ident" id="7996963">b</span>&nbsp;<span class="op" id="7996965">[</span><span class="op" id="7996966">]</span><span class="builtintype" id="7996967">byte</span><span class="op" id="7996971">)</span>&nbsp;<span class="builtintype" id="7996973">error</span>&nbsp;<span class="op" id="7996979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996982">var</span>&nbsp;<span class="ident" id="7996986">buf</span>&nbsp;<span class="ident" id="7996990">bytes</span><span class="op" id="7996995">.</span><span class="ident" id="7996996">Buffer</span>&nbsp;<span class="comment" id="7997003">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7997035">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997055">if</span>&nbsp;<span class="builtinfunc" id="7997058">len</span><span class="op" id="7997061">(</span><span class="ident" id="7997062">a</span><span class="op" id="7997063">)</span>&nbsp;<span class="op" id="7997065">!=</span>&nbsp;<span class="builtinfunc" id="7997068">len</span><span class="op" id="7997071">(</span><span class="ident" id="7997072">b</span><span class="op" id="7997073">)</span>&nbsp;<span class="op" id="7997075">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997079">fmt</span><span class="op" id="7997082">.</span><span class="ident" id="7997083">Fprintf</span><span class="op" id="7997090">(</span><span class="op" id="7997091">&amp;</span><span class="ident" id="7997092">buf</span><span class="op" id="7997095">,</span>&nbsp;<span class="string" id="7997097">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7997143">,</span>&nbsp;<span class="ident" id="7997145">aname</span><span class="op" id="7997150">,</span>&nbsp;<span class="builtinfunc" id="7997152">len</span><span class="op" id="7997155">(</span><span class="ident" id="7997156">a</span><span class="op" id="7997157">)</span><span class="op" id="7997158">,</span>&nbsp;<span class="ident" id="7997160">bname</span><span class="op" id="7997165">,</span>&nbsp;<span class="builtinfunc" id="7997167">len</span><span class="op" id="7997170">(</span><span class="ident" id="7997171">b</span><span class="op" id="7997172">)</span><span class="op" id="7997173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7997180">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997201">line</span>&nbsp;<span class="op" id="7997206">:=</span>&nbsp;<span class="num" id="7997209">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997212">offs</span>&nbsp;<span class="op" id="7997217">:=</span>&nbsp;<span class="num" id="7997220">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997223">for</span>&nbsp;<span class="ident" id="7997227">i</span>&nbsp;<span class="op" id="7997229">:=</span>&nbsp;<span class="num" id="7997232">0</span><span class="op" id="7997233">;</span>&nbsp;<span class="ident" id="7997235">i</span>&nbsp;<span class="op" id="7997237">&lt;</span>&nbsp;<span class="builtinfunc" id="7997239">len</span><span class="op" id="7997242">(</span><span class="ident" id="7997243">a</span><span class="op" id="7997244">)</span>&nbsp;<span class="op" id="7997246">&amp;&amp;</span>&nbsp;<span class="ident" id="7997249">i</span>&nbsp;<span class="op" id="7997251">&lt;</span>&nbsp;<span class="builtinfunc" id="7997253">len</span><span class="op" id="7997256">(</span><span class="ident" id="7997257">b</span><span class="op" id="7997258">)</span><span class="op" id="7997259">;</span>&nbsp;<span class="ident" id="7997261">i</span><span class="op" id="7997262">++</span>&nbsp;<span class="op" id="7997265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997269">ch</span>&nbsp;<span class="op" id="7997272">:=</span>&nbsp;<span class="ident" id="7997275">a</span><span class="op" id="7997276">[</span><span class="ident" id="7997277">i</span><span class="op" id="7997278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997282">if</span>&nbsp;<span class="ident" id="7997285">ch</span>&nbsp;<span class="op" id="7997288">!=</span>&nbsp;<span class="ident" id="7997291">b</span><span class="op" id="7997292">[</span><span class="ident" id="7997293">i</span><span class="op" id="7997294">]</span>&nbsp;<span class="op" id="7997296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997301">fmt</span><span class="op" id="7997304">.</span><span class="ident" id="7997305">Fprintf</span><span class="op" id="7997312">(</span><span class="op" id="7997313">&amp;</span><span class="ident" id="7997314">buf</span><span class="op" id="7997317">,</span>&nbsp;<span class="string" id="7997319">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7997335">,</span>&nbsp;<span class="ident" id="7997337">aname</span><span class="op" id="7997342">,</span>&nbsp;<span class="ident" id="7997344">line</span><span class="op" id="7997348">,</span>&nbsp;<span class="ident" id="7997350">i</span><span class="op" id="7997351">-</span><span class="ident" id="7997352">offs</span><span class="op" id="7997356">+</span><span class="num" id="7997357">1</span><span class="op" id="7997358">,</span>&nbsp;<span class="ident" id="7997360">lineAt</span><span class="op" id="7997366">(</span><span class="ident" id="7997367">a</span><span class="op" id="7997368">,</span>&nbsp;<span class="ident" id="7997370">offs</span><span class="op" id="7997374">)</span><span class="op" id="7997375">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997380">fmt</span><span class="op" id="7997383">.</span><span class="ident" id="7997384">Fprintf</span><span class="op" id="7997391">(</span><span class="op" id="7997392">&amp;</span><span class="ident" id="7997393">buf</span><span class="op" id="7997396">,</span>&nbsp;<span class="string" id="7997398">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7997414">,</span>&nbsp;<span class="ident" id="7997416">bname</span><span class="op" id="7997421">,</span>&nbsp;<span class="ident" id="7997423">line</span><span class="op" id="7997427">,</span>&nbsp;<span class="ident" id="7997429">i</span><span class="op" id="7997430">-</span><span class="ident" id="7997431">offs</span><span class="op" id="7997435">+</span><span class="num" id="7997436">1</span><span class="op" id="7997437">,</span>&nbsp;<span class="ident" id="7997439">lineAt</span><span class="op" id="7997445">(</span><span class="ident" id="7997446">b</span><span class="op" id="7997447">,</span>&nbsp;<span class="ident" id="7997449">offs</span><span class="op" id="7997453">)</span><span class="op" id="7997454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997459">fmt</span><span class="op" id="7997462">.</span><span class="ident" id="7997463">Fprintf</span><span class="op" id="7997470">(</span><span class="op" id="7997471">&amp;</span><span class="ident" id="7997472">buf</span><span class="op" id="7997475">,</span>&nbsp;<span class="string" id="7997477">&#34;\n\n&#34;</span><span class="op" id="7997483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997488">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997500">if</span>&nbsp;<span class="ident" id="7997503">ch</span>&nbsp;<span class="op" id="7997506">==</span>&nbsp;<span class="string" id="7997509">&#39;\n&#39;</span>&nbsp;<span class="op" id="7997514">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997519">line</span><span class="op" id="7997523">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997529">offs</span>&nbsp;<span class="op" id="7997534">=</span>&nbsp;<span class="ident" id="7997536">i</span>&nbsp;<span class="op" id="7997538">+</span>&nbsp;<span class="num" id="7997540">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997551">if</span>&nbsp;<span class="ident" id="7997554">buf</span><span class="op" id="7997557">.</span><span class="ident" id="7997558">Len</span><span class="op" id="7997561">(</span><span class="op" id="7997562">)</span>&nbsp;<span class="op" id="7997564">&gt;</span>&nbsp;<span class="num" id="7997566">0</span>&nbsp;<span class="op" id="7997568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997572">return</span>&nbsp;<span class="ident" id="7997579">errors</span><span class="op" id="7997585">.</span><span class="ident" id="7997586">New</span><span class="op" id="7997589">(</span><span class="ident" id="7997590">buf</span><span class="op" id="7997593">.</span><span class="ident" id="7997594">String</span><span class="op" id="7997600">(</span><span class="op" id="7997601">)</span><span class="op" id="7997602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997608">return</span>&nbsp;<span class="ident" id="7997615">nil</span><br>
<span class="lineno"></span><span class="op" id="7997619">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7997622">func</span>&nbsp;<span class="ident" id="7997627">runcheck</span><span class="op" id="7997635">(</span><span class="ident" id="7997636">t</span>&nbsp;<span class="op" id="7997638">*</span><span class="ident" id="7997639">testing</span><span class="op" id="7997646">.</span><span class="ident" id="7997647">T</span><span class="op" id="7997648">,</span>&nbsp;<span class="ident" id="7997650">source</span><span class="op" id="7997656">,</span>&nbsp;<span class="ident" id="7997658">golden</span>&nbsp;<span class="builtintype" id="7997665">string</span><span class="op" id="7997671">,</span>&nbsp;<span class="ident" id="7997673">mode</span>&nbsp;<span class="ident" id="7997678">checkMode</span><span class="op" id="7997687">)</span>&nbsp;<span class="op" id="7997689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997692">src</span><span class="op" id="7997695">,</span>&nbsp;<span class="ident" id="7997697">err</span>&nbsp;<span class="op" id="7997701">:=</span>&nbsp;<span class="ident" id="7997704">ioutil</span><span class="op" id="7997710">.</span><span class="ident" id="7997711">ReadFile</span><span class="op" id="7997719">(</span><span class="ident" id="7997720">source</span><span class="op" id="7997726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997729">if</span>&nbsp;<span class="ident" id="7997732">err</span>&nbsp;<span class="op" id="7997736">!=</span>&nbsp;<span class="ident" id="7997739">nil</span>&nbsp;<span class="op" id="7997743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997747">t</span><span class="op" id="7997748">.</span><span class="ident" id="7997749">Error</span><span class="op" id="7997754">(</span><span class="ident" id="7997755">err</span><span class="op" id="7997758">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997774">res</span><span class="op" id="7997777">,</span>&nbsp;<span class="ident" id="7997779">err</span>&nbsp;<span class="op" id="7997783">:=</span>&nbsp;<span class="ident" id="7997786">format</span><span class="op" id="7997792">(</span><span class="ident" id="7997793">src</span><span class="op" id="7997796">,</span>&nbsp;<span class="ident" id="7997798">mode</span><span class="op" id="7997802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997805">if</span>&nbsp;<span class="ident" id="7997808">err</span>&nbsp;<span class="op" id="7997812">!=</span>&nbsp;<span class="ident" id="7997815">nil</span>&nbsp;<span class="op" id="7997819">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997823">t</span><span class="op" id="7997824">.</span><span class="ident" id="7997825">Error</span><span class="op" id="7997830">(</span><span class="ident" id="7997831">err</span><span class="op" id="7997834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997838">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7997850">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997887">if</span>&nbsp;<span class="op" id="7997890">*</span><span class="ident" id="7997891">update</span>&nbsp;<span class="op" id="7997898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997902">if</span>&nbsp;<span class="ident" id="7997905">err</span>&nbsp;<span class="op" id="7997909">:=</span>&nbsp;<span class="ident" id="7997912">ioutil</span><span class="op" id="7997918">.</span><span class="ident" id="7997919">WriteFile</span><span class="op" id="7997928">(</span><span class="ident" id="7997929">golden</span><span class="op" id="7997935">,</span>&nbsp;<span class="ident" id="7997937">res</span><span class="op" id="7997940">,</span>&nbsp;<span class="num" id="7997942">0644</span><span class="op" id="7997946">)</span><span class="op" id="7997947">;</span>&nbsp;<span class="ident" id="7997949">err</span>&nbsp;<span class="op" id="7997953">!=</span>&nbsp;<span class="ident" id="7997956">nil</span>&nbsp;<span class="op" id="7997960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997965">t</span><span class="op" id="7997966">.</span><span class="ident" id="7997967">Error</span><span class="op" id="7997972">(</span><span class="ident" id="7997973">err</span><span class="op" id="7997976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997984">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7997996">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998011">gld</span><span class="op" id="7998014">,</span>&nbsp;<span class="ident" id="7998016">err</span>&nbsp;<span class="op" id="7998020">:=</span>&nbsp;<span class="ident" id="7998023">ioutil</span><span class="op" id="7998029">.</span><span class="ident" id="7998030">ReadFile</span><span class="op" id="7998038">(</span><span class="ident" id="7998039">golden</span><span class="op" id="7998045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998048">if</span>&nbsp;<span class="ident" id="7998051">err</span>&nbsp;<span class="op" id="7998055">!=</span>&nbsp;<span class="ident" id="7998058">nil</span>&nbsp;<span class="op" id="7998062">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998066">t</span><span class="op" id="7998067">.</span><span class="ident" id="7998068">Error</span><span class="op" id="7998073">(</span><span class="ident" id="7998074">err</span><span class="op" id="7998077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998081">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998093">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998142">if</span>&nbsp;<span class="ident" id="7998145">err</span>&nbsp;<span class="op" id="7998149">:=</span>&nbsp;<span class="ident" id="7998152">diff</span><span class="op" id="7998156">(</span><span class="ident" id="7998157">source</span><span class="op" id="7998163">,</span>&nbsp;<span class="ident" id="7998165">golden</span><span class="op" id="7998171">,</span>&nbsp;<span class="ident" id="7998173">res</span><span class="op" id="7998176">,</span>&nbsp;<span class="ident" id="7998178">gld</span><span class="op" id="7998181">)</span><span class="op" id="7998182">;</span>&nbsp;<span class="ident" id="7998184">err</span>&nbsp;<span class="op" id="7998188">!=</span>&nbsp;<span class="ident" id="7998191">nil</span>&nbsp;<span class="op" id="7998195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998199">t</span><span class="op" id="7998200">.</span><span class="ident" id="7998201">Error</span><span class="op" id="7998206">(</span><span class="ident" id="7998207">err</span><span class="op" id="7998210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998214">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998226">if</span>&nbsp;<span class="ident" id="7998229">mode</span><span class="op" id="7998233">&amp;</span><span class="ident" id="7998234">idempotent</span>&nbsp;<span class="op" id="7998245">!=</span>&nbsp;<span class="num" id="7998248">0</span>&nbsp;<span class="op" id="7998250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998254">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998296">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998359">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998421">res</span><span class="op" id="7998424">,</span>&nbsp;<span class="ident" id="7998426">err</span>&nbsp;<span class="op" id="7998430">=</span>&nbsp;<span class="ident" id="7998432">format</span><span class="op" id="7998438">(</span><span class="ident" id="7998439">gld</span><span class="op" id="7998442">,</span>&nbsp;<span class="ident" id="7998444">mode</span><span class="op" id="7998448">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998452">if</span>&nbsp;<span class="ident" id="7998455">err</span>&nbsp;<span class="op" id="7998459">:=</span>&nbsp;<span class="ident" id="7998462">diff</span><span class="op" id="7998466">(</span><span class="ident" id="7998467">golden</span><span class="op" id="7998473">,</span>&nbsp;<span class="ident" id="7998475">fmt</span><span class="op" id="7998478">.</span><span class="ident" id="7998479">Sprintf</span><span class="op" id="7998486">(</span><span class="string" id="7998487">&#34;format(%s)&#34;</span><span class="op" id="7998499">,</span>&nbsp;<span class="ident" id="7998501">golden</span><span class="op" id="7998507">)</span><span class="op" id="7998508">,</span>&nbsp;<span class="ident" id="7998510">gld</span><span class="op" id="7998513">,</span>&nbsp;<span class="ident" id="7998515">res</span><span class="op" id="7998518">)</span><span class="op" id="7998519">;</span>&nbsp;<span class="ident" id="7998521">err</span>&nbsp;<span class="op" id="7998525">!=</span>&nbsp;<span class="ident" id="7998528">nil</span>&nbsp;<span class="op" id="7998532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998537">t</span><span class="op" id="7998538">.</span><span class="ident" id="7998539">Errorf</span><span class="op" id="7998545">(</span><span class="string" id="7998546">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7998576">,</span>&nbsp;<span class="ident" id="7998578">err</span><span class="op" id="7998581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998588">}</span><br>
<span class="lineno"></span><span class="op" id="7998590">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7998593">func</span>&nbsp;<span class="ident" id="7998598">check</span><span class="op" id="7998603">(</span><span class="ident" id="7998604">t</span>&nbsp;<span class="op" id="7998606">*</span><span class="ident" id="7998607">testing</span><span class="op" id="7998614">.</span><span class="ident" id="7998615">T</span><span class="op" id="7998616">,</span>&nbsp;<span class="ident" id="7998618">source</span><span class="op" id="7998624">,</span>&nbsp;<span class="ident" id="7998626">golden</span>&nbsp;<span class="builtintype" id="7998633">string</span><span class="op" id="7998639">,</span>&nbsp;<span class="ident" id="7998641">mode</span>&nbsp;<span class="ident" id="7998646">checkMode</span><span class="op" id="7998655">)</span>&nbsp;<span class="op" id="7998657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998660">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998677">cc</span>&nbsp;<span class="op" id="7998680">:=</span>&nbsp;<span class="builtinfunc" id="7998683">make</span><span class="op" id="7998687">(</span><span class="keyword" id="7998688">chan</span>&nbsp;<span class="builtintype" id="7998693">int</span><span class="op" id="7998696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998699">go</span>&nbsp;<span class="keyword" id="7998702">func</span><span class="op" id="7998706">(</span><span class="op" id="7998707">)</span>&nbsp;<span class="op" id="7998709">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998713">runcheck</span><span class="op" id="7998721">(</span><span class="ident" id="7998722">t</span><span class="op" id="7998723">,</span>&nbsp;<span class="ident" id="7998725">source</span><span class="op" id="7998731">,</span>&nbsp;<span class="ident" id="7998733">golden</span><span class="op" id="7998739">,</span>&nbsp;<span class="ident" id="7998741">mode</span><span class="op" id="7998745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998749">cc</span>&nbsp;<span class="op" id="7998752">&lt;-</span>&nbsp;<span class="num" id="7998755">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998758">}</span><span class="op" id="7998759">(</span><span class="op" id="7998760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998764">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998786">select</span>&nbsp;<span class="op" id="7998793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998796">case</span>&nbsp;<span class="op" id="7998801">&lt;-</span><span class="ident" id="7998803">time</span><span class="op" id="7998807">.</span><span class="ident" id="7998808">After</span><span class="op" id="7998813">(</span><span class="num" id="7998814">10</span>&nbsp;<span class="op" id="7998817">*</span>&nbsp;<span class="ident" id="7998819">time</span><span class="op" id="7998823">.</span><span class="ident" id="7998824">Second</span><span class="op" id="7998830">)</span><span class="op" id="7998831">:</span>&nbsp;<span class="comment" id="7998833">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998893">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998925">t</span><span class="op" id="7998926">.</span><span class="ident" id="7998927">Errorf</span><span class="op" id="7998933">(</span><span class="string" id="7998934">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7998958">,</span>&nbsp;<span class="ident" id="7998960">source</span><span class="op" id="7998966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998969">case</span>&nbsp;<span class="op" id="7998974">&lt;-</span><span class="ident" id="7998976">cc</span><span class="op" id="7998978">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998982">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999028">}</span><br>
<span class="lineno"></span><span class="op" id="7999030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7999033">type</span>&nbsp;<span class="ident" id="7999038">entry</span>&nbsp;<span class="keyword" id="7999044">struct</span>&nbsp;<span class="op" id="7999051">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999054">source</span><span class="op" id="7999060">,</span>&nbsp;<span class="ident" id="7999062">golden</span>&nbsp;<span class="builtintype" id="7999069">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999077">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999092">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7999102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7999105">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7999174">var</span>&nbsp;<span class="ident" id="7999178">data</span>&nbsp;<span class="op" id="7999183">=</span>&nbsp;<span class="op" id="7999185">[</span><span class="op" id="7999186">]</span><span class="ident" id="7999187">entry</span><span class="op" id="7999192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999195">{</span><span class="string" id="7999196">&#34;empty.input&#34;</span><span class="op" id="7999209">,</span>&nbsp;<span class="string" id="7999211">&#34;empty.golden&#34;</span><span class="op" id="7999225">,</span>&nbsp;<span class="ident" id="7999227">idempotent</span><span class="op" id="7999237">}</span><span class="op" id="7999238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999241">{</span><span class="string" id="7999242">&#34;comments.input&#34;</span><span class="op" id="7999258">,</span>&nbsp;<span class="string" id="7999260">&#34;comments.golden&#34;</span><span class="op" id="7999277">,</span>&nbsp;<span class="num" id="7999279">0</span><span class="op" id="7999280">}</span><span class="op" id="7999281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999284">{</span><span class="string" id="7999285">&#34;comments.input&#34;</span><span class="op" id="7999301">,</span>&nbsp;<span class="string" id="7999303">&#34;comments.x&#34;</span><span class="op" id="7999315">,</span>&nbsp;<span class="ident" id="7999317">export</span><span class="op" id="7999323">}</span><span class="op" id="7999324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999327">{</span><span class="string" id="7999328">&#34;comments2.input&#34;</span><span class="op" id="7999345">,</span>&nbsp;<span class="string" id="7999347">&#34;comments2.golden&#34;</span><span class="op" id="7999365">,</span>&nbsp;<span class="ident" id="7999367">idempotent</span><span class="op" id="7999377">}</span><span class="op" id="7999378">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999381">{</span><span class="string" id="7999382">&#34;linebreaks.input&#34;</span><span class="op" id="7999400">,</span>&nbsp;<span class="string" id="7999402">&#34;linebreaks.golden&#34;</span><span class="op" id="7999421">,</span>&nbsp;<span class="ident" id="7999423">idempotent</span><span class="op" id="7999433">}</span><span class="op" id="7999434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999437">{</span><span class="string" id="7999438">&#34;expressions.input&#34;</span><span class="op" id="7999457">,</span>&nbsp;<span class="string" id="7999459">&#34;expressions.golden&#34;</span><span class="op" id="7999479">,</span>&nbsp;<span class="ident" id="7999481">idempotent</span><span class="op" id="7999491">}</span><span class="op" id="7999492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999495">{</span><span class="string" id="7999496">&#34;expressions.input&#34;</span><span class="op" id="7999515">,</span>&nbsp;<span class="string" id="7999517">&#34;expressions.raw&#34;</span><span class="op" id="7999534">,</span>&nbsp;<span class="ident" id="7999536">rawFormat</span>&nbsp;<span class="op" id="7999546">|</span>&nbsp;<span class="ident" id="7999548">idempotent</span><span class="op" id="7999558">}</span><span class="op" id="7999559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999562">{</span><span class="string" id="7999563">&#34;declarations.input&#34;</span><span class="op" id="7999583">,</span>&nbsp;<span class="string" id="7999585">&#34;declarations.golden&#34;</span><span class="op" id="7999606">,</span>&nbsp;<span class="num" id="7999608">0</span><span class="op" id="7999609">}</span><span class="op" id="7999610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999613">{</span><span class="string" id="7999614">&#34;statements.input&#34;</span><span class="op" id="7999632">,</span>&nbsp;<span class="string" id="7999634">&#34;statements.golden&#34;</span><span class="op" id="7999653">,</span>&nbsp;<span class="num" id="7999655">0</span><span class="op" id="7999656">}</span><span class="op" id="7999657">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999660">{</span><span class="string" id="7999661">&#34;slow.input&#34;</span><span class="op" id="7999673">,</span>&nbsp;<span class="string" id="7999675">&#34;slow.golden&#34;</span><span class="op" id="7999688">,</span>&nbsp;<span class="ident" id="7999690">idempotent</span><span class="op" id="7999700">}</span><span class="op" id="7999701">,</span><br>
<span class="lineno"></span><span class="op" id="7999703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7999706">func</span>&nbsp;<span class="ident" id="7999711">TestFiles</span><span class="op" id="7999720">(</span><span class="ident" id="7999721">t</span>&nbsp;<span class="op" id="7999723">*</span><span class="ident" id="7999724">testing</span><span class="op" id="7999731">.</span><span class="ident" id="7999732">T</span><span class="op" id="7999733">)</span>&nbsp;<span class="op" id="7999735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999738">for</span>&nbsp;<span class="ident" id="7999742">_</span><span class="op" id="7999743">,</span>&nbsp;<span class="ident" id="7999745">e</span>&nbsp;<span class="op" id="7999747">:=</span>&nbsp;<span class="keyword" id="7999750">range</span>&nbsp;<span class="ident" id="7999756">data</span>&nbsp;<span class="op" id="7999761">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999765">source</span>&nbsp;<span class="op" id="7999772">:=</span>&nbsp;<span class="ident" id="7999775">filepath</span><span class="op" id="7999783">.</span><span class="ident" id="7999784">Join</span><span class="op" id="7999788">(</span><span class="ident" id="7999789">dataDir</span><span class="op" id="7999796">,</span>&nbsp;<span class="ident" id="7999798">e</span><span class="op" id="7999799">.</span><span class="ident" id="7999800">source</span><span class="op" id="7999806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999810">golden</span>&nbsp;<span class="op" id="7999817">:=</span>&nbsp;<span class="ident" id="7999820">filepath</span><span class="op" id="7999828">.</span><span class="ident" id="7999829">Join</span><span class="op" id="7999833">(</span><span class="ident" id="7999834">dataDir</span><span class="op" id="7999841">,</span>&nbsp;<span class="ident" id="7999843">e</span><span class="op" id="7999844">.</span><span class="ident" id="7999845">golden</span><span class="op" id="7999851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999855">check</span><span class="op" id="7999860">(</span><span class="ident" id="7999861">t</span><span class="op" id="7999862">,</span>&nbsp;<span class="ident" id="7999864">source</span><span class="op" id="7999870">,</span>&nbsp;<span class="ident" id="7999872">golden</span><span class="op" id="7999878">,</span>&nbsp;<span class="ident" id="7999880">e</span><span class="op" id="7999881">.</span><span class="ident" id="7999882">mode</span><span class="op" id="7999886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7999890">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7999937">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999973">}</span><br>
<span class="lineno"></span><span class="op" id="7999975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7999978">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="8000054">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="8000130">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="8000159">//</span><br>
<span class="lineno"></span><span class="keyword" id="8000162">func</span>&nbsp;<span class="ident" id="8000167">TestLineComments</span><span class="op" id="8000183">(</span><span class="ident" id="8000184">t</span>&nbsp;<span class="op" id="8000186">*</span><span class="ident" id="8000187">testing</span><span class="op" id="8000194">.</span><span class="ident" id="8000195">T</span><span class="op" id="8000196">)</span>&nbsp;<span class="op" id="8000198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000201">const</span>&nbsp;<span class="ident" id="8000207">src</span>&nbsp;<span class="op" id="8000211">=</span>&nbsp;<span class="string" id="8000213">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000274">fset</span>&nbsp;<span class="op" id="8000279">:=</span>&nbsp;<span class="ident" id="8000282">token</span><span class="op" id="8000287">.</span><span class="ident" id="8000288">NewFileSet</span><span class="op" id="8000298">(</span><span class="op" id="8000299">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000302">f</span><span class="op" id="8000303">,</span>&nbsp;<span class="ident" id="8000305">err</span>&nbsp;<span class="op" id="8000309">:=</span>&nbsp;<span class="ident" id="8000312">parser</span><span class="op" id="8000318">.</span><span class="ident" id="8000319">ParseFile</span><span class="op" id="8000328">(</span><span class="ident" id="8000329">fset</span><span class="op" id="8000333">,</span>&nbsp;<span class="string" id="8000335">&#34;&#34;</span><span class="op" id="8000337">,</span>&nbsp;<span class="ident" id="8000339">src</span><span class="op" id="8000342">,</span>&nbsp;<span class="ident" id="8000344">parser</span><span class="op" id="8000350">.</span><span class="ident" id="8000351">ParseComments</span><span class="op" id="8000364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000367">if</span>&nbsp;<span class="ident" id="8000370">err</span>&nbsp;<span class="op" id="8000374">!=</span>&nbsp;<span class="ident" id="8000377">nil</span>&nbsp;<span class="op" id="8000381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8000385">panic</span><span class="op" id="8000390">(</span><span class="ident" id="8000391">err</span><span class="op" id="8000394">)</span>&nbsp;<span class="comment" id="8000396">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000418">var</span>&nbsp;<span class="ident" id="8000422">buf</span>&nbsp;<span class="ident" id="8000426">bytes</span><span class="op" id="8000431">.</span><span class="ident" id="8000432">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000440">fset</span>&nbsp;<span class="op" id="8000445">=</span>&nbsp;<span class="ident" id="8000447">token</span><span class="op" id="8000452">.</span><span class="ident" id="8000453">NewFileSet</span><span class="op" id="8000463">(</span><span class="op" id="8000464">)</span>&nbsp;<span class="comment" id="8000466">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000493">Fprint</span><span class="op" id="8000499">(</span><span class="op" id="8000500">&amp;</span><span class="ident" id="8000501">buf</span><span class="op" id="8000504">,</span>&nbsp;<span class="ident" id="8000506">fset</span><span class="op" id="8000510">,</span>&nbsp;<span class="ident" id="8000512">f</span><span class="op" id="8000513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000517">nlines</span>&nbsp;<span class="op" id="8000524">:=</span>&nbsp;<span class="num" id="8000527">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000530">for</span>&nbsp;<span class="ident" id="8000534">_</span><span class="op" id="8000535">,</span>&nbsp;<span class="ident" id="8000537">ch</span>&nbsp;<span class="op" id="8000540">:=</span>&nbsp;<span class="keyword" id="8000543">range</span>&nbsp;<span class="ident" id="8000549">buf</span><span class="op" id="8000552">.</span><span class="ident" id="8000553">Bytes</span><span class="op" id="8000558">(</span><span class="op" id="8000559">)</span>&nbsp;<span class="op" id="8000561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000565">if</span>&nbsp;<span class="ident" id="8000568">ch</span>&nbsp;<span class="op" id="8000571">==</span>&nbsp;<span class="string" id="8000574">&#39;\n&#39;</span>&nbsp;<span class="op" id="8000579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000584">nlines</span><span class="op" id="8000590">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000598">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000602">const</span>&nbsp;<span class="ident" id="8000608">expected</span>&nbsp;<span class="op" id="8000617">=</span>&nbsp;<span class="num" id="8000619">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000622">if</span>&nbsp;<span class="ident" id="8000625">nlines</span>&nbsp;<span class="op" id="8000632">&lt;</span>&nbsp;<span class="ident" id="8000634">expected</span>&nbsp;<span class="op" id="8000643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000647">t</span><span class="op" id="8000648">.</span><span class="ident" id="8000649">Errorf</span><span class="op" id="8000655">(</span><span class="string" id="8000656">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="8000679">,</span>&nbsp;<span class="ident" id="8000681">nlines</span><span class="op" id="8000687">,</span>&nbsp;<span class="ident" id="8000689">expected</span><span class="op" id="8000697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000701">t</span><span class="op" id="8000702">.</span><span class="ident" id="8000703">Errorf</span><span class="op" id="8000709">(</span><span class="string" id="8000710">&#34;result:\n%s&#34;</span><span class="op" id="8000723">,</span>&nbsp;<span class="ident" id="8000725">buf</span><span class="op" id="8000728">.</span><span class="ident" id="8000729">Bytes</span><span class="op" id="8000734">(</span><span class="op" id="8000735">)</span><span class="op" id="8000736">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000739">}</span><br>
<span class="lineno"></span><span class="op" id="8000741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8000744">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="8000809">func</span>&nbsp;<span class="ident" id="8000814">init</span><span class="op" id="8000818">(</span><span class="op" id="8000819">)</span>&nbsp;<span class="op" id="8000821">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000824">const</span>&nbsp;<span class="ident" id="8000830">name</span>&nbsp;<span class="op" id="8000835">=</span>&nbsp;<span class="string" id="8000837">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000847">var</span>&nbsp;<span class="ident" id="8000851">buf</span>&nbsp;<span class="ident" id="8000855">bytes</span><span class="op" id="8000860">.</span><span class="ident" id="8000861">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000869">if</span>&nbsp;<span class="ident" id="8000872">err</span>&nbsp;<span class="op" id="8000876">:=</span>&nbsp;<span class="ident" id="8000879">Fprint</span><span class="op" id="8000885">(</span><span class="op" id="8000886">&amp;</span><span class="ident" id="8000887">buf</span><span class="op" id="8000890">,</span>&nbsp;<span class="ident" id="8000892">fset</span><span class="op" id="8000896">,</span>&nbsp;<span class="op" id="8000898">&amp;</span><span class="ident" id="8000899">ast</span><span class="op" id="8000902">.</span><span class="ident" id="8000903">Ident</span><span class="op" id="8000908">{</span><span class="ident" id="8000909">Name</span><span class="op" id="8000913">:</span>&nbsp;<span class="ident" id="8000915">name</span><span class="op" id="8000919">}</span><span class="op" id="8000920">)</span><span class="op" id="8000921">;</span>&nbsp;<span class="ident" id="8000923">err</span>&nbsp;<span class="op" id="8000927">!=</span>&nbsp;<span class="ident" id="8000930">nil</span>&nbsp;<span class="op" id="8000934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8000938">panic</span><span class="op" id="8000943">(</span><span class="ident" id="8000944">err</span><span class="op" id="8000947">)</span>&nbsp;<span class="comment" id="8000949">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000967">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8000970">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8001033">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001047">if</span>&nbsp;<span class="ident" id="8001050">s</span>&nbsp;<span class="op" id="8001052">:=</span>&nbsp;<span class="ident" id="8001055">buf</span><span class="op" id="8001058">.</span><span class="ident" id="8001059">String</span><span class="op" id="8001065">(</span><span class="op" id="8001066">)</span><span class="op" id="8001067">;</span>&nbsp;<span class="op" id="8001069">!</span><span class="ident" id="8001070">debug</span>&nbsp;<span class="op" id="8001076">&amp;&amp;</span>&nbsp;<span class="ident" id="8001079">s</span>&nbsp;<span class="op" id="8001081">!=</span>&nbsp;<span class="ident" id="8001084">name</span>&nbsp;<span class="op" id="8001089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8001093">panic</span><span class="op" id="8001098">(</span><span class="string" id="8001099">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="8001106">+</span>&nbsp;<span class="ident" id="8001108">s</span>&nbsp;<span class="op" id="8001110">+</span>&nbsp;<span class="string" id="8001112">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="8001122">+</span>&nbsp;<span class="ident" id="8001124">name</span><span class="op" id="8001128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001131">}</span><br>
<span class="lineno">255</span><span class="op" id="8001133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8001136">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="8001211">func</span>&nbsp;<span class="ident" id="8001216">TestBadNodes</span><span class="op" id="8001228">(</span><span class="ident" id="8001229">t</span>&nbsp;<span class="op" id="8001231">*</span><span class="ident" id="8001232">testing</span><span class="op" id="8001239">.</span><span class="ident" id="8001240">T</span><span class="op" id="8001241">)</span>&nbsp;<span class="op" id="8001243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001246">const</span>&nbsp;<span class="ident" id="8001252">src</span>&nbsp;<span class="op" id="8001256">=</span>&nbsp;<span class="string" id="8001258">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001274">const</span>&nbsp;<span class="ident" id="8001280">res</span>&nbsp;<span class="op" id="8001284">=</span>&nbsp;<span class="string" id="8001286">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001310">f</span><span class="op" id="8001311">,</span>&nbsp;<span class="ident" id="8001313">err</span>&nbsp;<span class="op" id="8001317">:=</span>&nbsp;<span class="ident" id="8001320">parser</span><span class="op" id="8001326">.</span><span class="ident" id="8001327">ParseFile</span><span class="op" id="8001336">(</span><span class="ident" id="8001337">fset</span><span class="op" id="8001341">,</span>&nbsp;<span class="string" id="8001343">&#34;&#34;</span><span class="op" id="8001345">,</span>&nbsp;<span class="ident" id="8001347">src</span><span class="op" id="8001350">,</span>&nbsp;<span class="ident" id="8001352">parser</span><span class="op" id="8001358">.</span><span class="ident" id="8001359">ParseComments</span><span class="op" id="8001372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001375">if</span>&nbsp;<span class="ident" id="8001378">err</span>&nbsp;<span class="op" id="8001382">==</span>&nbsp;<span class="ident" id="8001385">nil</span>&nbsp;<span class="op" id="8001389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001393">t</span><span class="op" id="8001394">.</span><span class="ident" id="8001395">Error</span><span class="op" id="8001400">(</span><span class="string" id="8001401">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="8001427">)</span>&nbsp;<span class="comment" id="8001429">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001447">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001450">var</span>&nbsp;<span class="ident" id="8001454">buf</span>&nbsp;<span class="ident" id="8001458">bytes</span><span class="op" id="8001463">.</span><span class="ident" id="8001464">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001472">Fprint</span><span class="op" id="8001478">(</span><span class="op" id="8001479">&amp;</span><span class="ident" id="8001480">buf</span><span class="op" id="8001483">,</span>&nbsp;<span class="ident" id="8001485">fset</span><span class="op" id="8001489">,</span>&nbsp;<span class="ident" id="8001491">f</span><span class="op" id="8001492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001495">if</span>&nbsp;<span class="ident" id="8001498">buf</span><span class="op" id="8001501">.</span><span class="ident" id="8001502">String</span><span class="op" id="8001508">(</span><span class="op" id="8001509">)</span>&nbsp;<span class="op" id="8001511">!=</span>&nbsp;<span class="ident" id="8001514">res</span>&nbsp;<span class="op" id="8001518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001522">t</span><span class="op" id="8001523">.</span><span class="ident" id="8001524">Errorf</span><span class="op" id="8001530">(</span><span class="string" id="8001531">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8001552">,</span>&nbsp;<span class="ident" id="8001554">buf</span><span class="op" id="8001557">.</span><span class="ident" id="8001558">String</span><span class="op" id="8001564">(</span><span class="op" id="8001565">)</span><span class="op" id="8001566">,</span>&nbsp;<span class="ident" id="8001568">res</span><span class="op" id="8001571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001574">}</span><br>
<span class="lineno">270</span><span class="op" id="8001576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8001579">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="8001648">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="8001720">func</span>&nbsp;<span class="ident" id="8001725">testComment</span><span class="op" id="8001736">(</span><span class="ident" id="8001737">t</span>&nbsp;<span class="op" id="8001739">*</span><span class="ident" id="8001740">testing</span><span class="op" id="8001747">.</span><span class="ident" id="8001748">T</span><span class="op" id="8001749">,</span>&nbsp;<span class="ident" id="8001751">f</span>&nbsp;<span class="op" id="8001753">*</span><span class="ident" id="8001754">ast</span><span class="op" id="8001757">.</span><span class="ident" id="8001758">File</span><span class="op" id="8001762">,</span>&nbsp;<span class="ident" id="8001764">srclen</span>&nbsp;<span class="builtintype" id="8001771">int</span><span class="op" id="8001774">,</span>&nbsp;<span class="ident" id="8001776">comment</span>&nbsp;<span class="op" id="8001784">*</span><span class="ident" id="8001785">ast</span><span class="op" id="8001788">.</span><span class="ident" id="8001789">Comment</span><span class="op" id="8001796">)</span>&nbsp;<span class="op" id="8001798">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001801">f</span><span class="op" id="8001802">.</span><span class="ident" id="8001803">Comments</span><span class="op" id="8001811">[</span><span class="num" id="8001812">0</span><span class="op" id="8001813">]</span><span class="op" id="8001814">.</span><span class="ident" id="8001815">List</span><span class="op" id="8001819">[</span><span class="num" id="8001820">0</span><span class="op" id="8001821">]</span>&nbsp;<span class="op" id="8001823">=</span>&nbsp;<span class="ident" id="8001825">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001834">var</span>&nbsp;<span class="ident" id="8001838">buf</span>&nbsp;<span class="ident" id="8001842">bytes</span><span class="op" id="8001847">.</span><span class="ident" id="8001848">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001856">for</span>&nbsp;<span class="ident" id="8001860">offs</span>&nbsp;<span class="op" id="8001865">:=</span>&nbsp;<span class="num" id="8001868">0</span><span class="op" id="8001869">;</span>&nbsp;<span class="ident" id="8001871">offs</span>&nbsp;<span class="op" id="8001876">&lt;=</span>&nbsp;<span class="ident" id="8001879">srclen</span><span class="op" id="8001885">;</span>&nbsp;<span class="ident" id="8001887">offs</span><span class="op" id="8001891">++</span>&nbsp;<span class="op" id="8001894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001898">buf</span><span class="op" id="8001901">.</span><span class="ident" id="8001902">Reset</span><span class="op" id="8001907">(</span><span class="op" id="8001908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8001912">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8001966">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002020">if</span>&nbsp;<span class="ident" id="8002023">err</span>&nbsp;<span class="op" id="8002027">:=</span>&nbsp;<span class="ident" id="8002030">Fprint</span><span class="op" id="8002036">(</span><span class="op" id="8002037">&amp;</span><span class="ident" id="8002038">buf</span><span class="op" id="8002041">,</span>&nbsp;<span class="ident" id="8002043">fset</span><span class="op" id="8002047">,</span>&nbsp;<span class="ident" id="8002049">f</span><span class="op" id="8002050">)</span><span class="op" id="8002051">;</span>&nbsp;<span class="ident" id="8002053">err</span>&nbsp;<span class="op" id="8002057">!=</span>&nbsp;<span class="ident" id="8002060">nil</span>&nbsp;<span class="op" id="8002064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002069">t</span><span class="op" id="8002070">.</span><span class="ident" id="8002071">Error</span><span class="op" id="8002076">(</span><span class="ident" id="8002077">err</span><span class="op" id="8002080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002088">if</span>&nbsp;<span class="ident" id="8002091">_</span><span class="op" id="8002092">,</span>&nbsp;<span class="ident" id="8002094">err</span>&nbsp;<span class="op" id="8002098">:=</span>&nbsp;<span class="ident" id="8002101">parser</span><span class="op" id="8002107">.</span><span class="ident" id="8002108">ParseFile</span><span class="op" id="8002117">(</span><span class="ident" id="8002118">fset</span><span class="op" id="8002122">,</span>&nbsp;<span class="string" id="8002124">&#34;&#34;</span><span class="op" id="8002126">,</span>&nbsp;<span class="ident" id="8002128">buf</span><span class="op" id="8002131">.</span><span class="ident" id="8002132">Bytes</span><span class="op" id="8002137">(</span><span class="op" id="8002138">)</span><span class="op" id="8002139">,</span>&nbsp;<span class="num" id="8002141">0</span><span class="op" id="8002142">)</span><span class="op" id="8002143">;</span>&nbsp;<span class="ident" id="8002145">err</span>&nbsp;<span class="op" id="8002149">!=</span>&nbsp;<span class="ident" id="8002152">nil</span>&nbsp;<span class="op" id="8002156">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002161">t</span><span class="op" id="8002162">.</span><span class="ident" id="8002163">Fatalf</span><span class="op" id="8002169">(</span><span class="string" id="8002170">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="8002207">,</span>&nbsp;<span class="ident" id="8002209">comment</span><span class="op" id="8002216">.</span><span class="ident" id="8002217">Slash</span><span class="op" id="8002222">,</span>&nbsp;<span class="ident" id="8002224">buf</span><span class="op" id="8002227">.</span><span class="ident" id="8002228">String</span><span class="op" id="8002234">(</span><span class="op" id="8002235">)</span><span class="op" id="8002236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8002244">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8002289">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002336">comment</span><span class="op" id="8002343">.</span><span class="ident" id="8002344">Slash</span><span class="op" id="8002349">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002353">}</span><br>
<span class="lineno"></span><span class="op" id="8002355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8002358">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="8002412">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="8002481">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="8002498">func</span>&nbsp;<span class="ident" id="8002503">TestBadComments</span><span class="op" id="8002518">(</span><span class="ident" id="8002519">t</span>&nbsp;<span class="op" id="8002521">*</span><span class="ident" id="8002522">testing</span><span class="op" id="8002529">.</span><span class="ident" id="8002530">T</span><span class="op" id="8002531">)</span>&nbsp;<span class="op" id="8002533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002536">const</span>&nbsp;<span class="ident" id="8002542">src</span>&nbsp;<span class="op" id="8002546">=</span>&nbsp;<span class="string" id="8002548">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002802">f</span><span class="op" id="8002803">,</span>&nbsp;<span class="ident" id="8002805">err</span>&nbsp;<span class="op" id="8002809">:=</span>&nbsp;<span class="ident" id="8002812">parser</span><span class="op" id="8002818">.</span><span class="ident" id="8002819">ParseFile</span><span class="op" id="8002828">(</span><span class="ident" id="8002829">fset</span><span class="op" id="8002833">,</span>&nbsp;<span class="string" id="8002835">&#34;&#34;</span><span class="op" id="8002837">,</span>&nbsp;<span class="ident" id="8002839">src</span><span class="op" id="8002842">,</span>&nbsp;<span class="ident" id="8002844">parser</span><span class="op" id="8002850">.</span><span class="ident" id="8002851">ParseComments</span><span class="op" id="8002864">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002867">if</span>&nbsp;<span class="ident" id="8002870">err</span>&nbsp;<span class="op" id="8002874">!=</span>&nbsp;<span class="ident" id="8002877">nil</span>&nbsp;<span class="op" id="8002881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002885">t</span><span class="op" id="8002886">.</span><span class="ident" id="8002887">Error</span><span class="op" id="8002892">(</span><span class="ident" id="8002893">err</span><span class="op" id="8002896">)</span>&nbsp;<span class="comment" id="8002898">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002920">comment</span>&nbsp;<span class="op" id="8002928">:=</span>&nbsp;<span class="ident" id="8002931">f</span><span class="op" id="8002932">.</span><span class="ident" id="8002933">Comments</span><span class="op" id="8002941">[</span><span class="num" id="8002942">0</span><span class="op" id="8002943">]</span><span class="op" id="8002944">.</span><span class="ident" id="8002945">List</span><span class="op" id="8002949">[</span><span class="num" id="8002950">0</span><span class="op" id="8002951">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002954">pos</span>&nbsp;<span class="op" id="8002958">:=</span>&nbsp;<span class="ident" id="8002961">comment</span><span class="op" id="8002968">.</span><span class="ident" id="8002969">Pos</span><span class="op" id="8002972">(</span><span class="op" id="8002973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002976">if</span>&nbsp;<span class="ident" id="8002979">fset</span><span class="op" id="8002983">.</span><span class="ident" id="8002984">Position</span><span class="op" id="8002992">(</span><span class="ident" id="8002993">pos</span><span class="op" id="8002996">)</span><span class="op" id="8002997">.</span><span class="ident" id="8002998">Offset</span>&nbsp;<span class="op" id="8003005">!=</span>&nbsp;<span class="num" id="8003008">1</span>&nbsp;<span class="op" id="8003010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003014">t</span><span class="op" id="8003015">.</span><span class="ident" id="8003016">Error</span><span class="op" id="8003021">(</span><span class="string" id="8003022">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="8003041">)</span>&nbsp;<span class="comment" id="8003043">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003065">testComment</span><span class="op" id="8003076">(</span><span class="ident" id="8003077">t</span><span class="op" id="8003078">,</span>&nbsp;<span class="ident" id="8003080">f</span><span class="op" id="8003081">,</span>&nbsp;<span class="builtinfunc" id="8003083">len</span><span class="op" id="8003086">(</span><span class="ident" id="8003087">src</span><span class="op" id="8003090">)</span><span class="op" id="8003091">,</span>&nbsp;<span class="op" id="8003093">&amp;</span><span class="ident" id="8003094">ast</span><span class="op" id="8003097">.</span><span class="ident" id="8003098">Comment</span><span class="op" id="8003105">{</span><span class="ident" id="8003106">Slash</span><span class="op" id="8003111">:</span>&nbsp;<span class="ident" id="8003113">pos</span><span class="op" id="8003116">,</span>&nbsp;<span class="ident" id="8003118">Text</span><span class="op" id="8003122">:</span>&nbsp;<span class="string" id="8003124">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="8003142">}</span><span class="op" id="8003143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003146">testComment</span><span class="op" id="8003157">(</span><span class="ident" id="8003158">t</span><span class="op" id="8003159">,</span>&nbsp;<span class="ident" id="8003161">f</span><span class="op" id="8003162">,</span>&nbsp;<span class="builtinfunc" id="8003164">len</span><span class="op" id="8003167">(</span><span class="ident" id="8003168">src</span><span class="op" id="8003171">)</span><span class="op" id="8003172">,</span>&nbsp;<span class="op" id="8003174">&amp;</span><span class="ident" id="8003175">ast</span><span class="op" id="8003178">.</span><span class="ident" id="8003179">Comment</span><span class="op" id="8003186">{</span><span class="ident" id="8003187">Slash</span><span class="op" id="8003192">:</span>&nbsp;<span class="ident" id="8003194">pos</span><span class="op" id="8003197">,</span>&nbsp;<span class="ident" id="8003199">Text</span><span class="op" id="8003203">:</span>&nbsp;<span class="string" id="8003205">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8003226">}</span><span class="op" id="8003227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003230">testComment</span><span class="op" id="8003241">(</span><span class="ident" id="8003242">t</span><span class="op" id="8003243">,</span>&nbsp;<span class="ident" id="8003245">f</span><span class="op" id="8003246">,</span>&nbsp;<span class="builtinfunc" id="8003248">len</span><span class="op" id="8003251">(</span><span class="ident" id="8003252">src</span><span class="op" id="8003255">)</span><span class="op" id="8003256">,</span>&nbsp;<span class="op" id="8003258">&amp;</span><span class="ident" id="8003259">ast</span><span class="op" id="8003262">.</span><span class="ident" id="8003263">Comment</span><span class="op" id="8003270">{</span><span class="ident" id="8003271">Slash</span><span class="op" id="8003276">:</span>&nbsp;<span class="ident" id="8003278">pos</span><span class="op" id="8003281">,</span>&nbsp;<span class="ident" id="8003283">Text</span><span class="op" id="8003287">:</span>&nbsp;<span class="string" id="8003289">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8003313">}</span><span class="op" id="8003314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003317">testComment</span><span class="op" id="8003328">(</span><span class="ident" id="8003329">t</span><span class="op" id="8003330">,</span>&nbsp;<span class="ident" id="8003332">f</span><span class="op" id="8003333">,</span>&nbsp;<span class="builtinfunc" id="8003335">len</span><span class="op" id="8003338">(</span><span class="ident" id="8003339">src</span><span class="op" id="8003342">)</span><span class="op" id="8003343">,</span>&nbsp;<span class="op" id="8003345">&amp;</span><span class="ident" id="8003346">ast</span><span class="op" id="8003349">.</span><span class="ident" id="8003350">Comment</span><span class="op" id="8003357">{</span><span class="ident" id="8003358">Slash</span><span class="op" id="8003363">:</span>&nbsp;<span class="ident" id="8003365">pos</span><span class="op" id="8003368">,</span>&nbsp;<span class="ident" id="8003370">Text</span><span class="op" id="8003374">:</span>&nbsp;<span class="string" id="8003376">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="8003404">}</span><span class="op" id="8003405">)</span><br>
<span class="lineno"></span><span class="op" id="8003407">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="8003410">type</span>&nbsp;<span class="ident" id="8003415">visitor</span>&nbsp;<span class="keyword" id="8003423">chan</span>&nbsp;<span class="op" id="8003428">*</span><span class="ident" id="8003429">ast</span><span class="op" id="8003432">.</span><span class="ident" id="8003433">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8003440">func</span>&nbsp;<span class="op" id="8003445">(</span><span class="ident" id="8003446">v</span>&nbsp;<span class="ident" id="8003448">visitor</span><span class="op" id="8003455">)</span>&nbsp;<span class="ident" id="8003457">Visit</span><span class="op" id="8003462">(</span><span class="ident" id="8003463">n</span>&nbsp;<span class="ident" id="8003465">ast</span><span class="op" id="8003468">.</span><span class="ident" id="8003469">Node</span><span class="op" id="8003473">)</span>&nbsp;<span class="op" id="8003475">(</span><span class="ident" id="8003476">w</span>&nbsp;<span class="ident" id="8003478">ast</span><span class="op" id="8003481">.</span><span class="ident" id="8003482">Visitor</span><span class="op" id="8003489">)</span>&nbsp;<span class="op" id="8003491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003494">if</span>&nbsp;<span class="ident" id="8003497">ident</span><span class="op" id="8003502">,</span>&nbsp;<span class="ident" id="8003504">ok</span>&nbsp;<span class="op" id="8003507">:=</span>&nbsp;<span class="ident" id="8003510">n</span><span class="op" id="8003511">.</span><span class="op" id="8003512">(</span><span class="op" id="8003513">*</span><span class="ident" id="8003514">ast</span><span class="op" id="8003517">.</span><span class="ident" id="8003518">Ident</span><span class="op" id="8003523">)</span><span class="op" id="8003524">;</span>&nbsp;<span class="ident" id="8003526">ok</span>&nbsp;<span class="op" id="8003529">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003533">v</span>&nbsp;<span class="op" id="8003535">&lt;-</span>&nbsp;<span class="ident" id="8003538">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003548">return</span>&nbsp;<span class="ident" id="8003555">v</span><br>
<span class="lineno"></span><span class="op" id="8003557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="8003560">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="8003638">func</span>&nbsp;<span class="ident" id="8003643">idents</span><span class="op" id="8003649">(</span><span class="ident" id="8003650">f</span>&nbsp;<span class="op" id="8003652">*</span><span class="ident" id="8003653">ast</span><span class="op" id="8003656">.</span><span class="ident" id="8003657">File</span><span class="op" id="8003661">)</span>&nbsp;<span class="op" id="8003663">&lt;-</span><span class="keyword" id="8003665">chan</span>&nbsp;<span class="op" id="8003670">*</span><span class="ident" id="8003671">ast</span><span class="op" id="8003674">.</span><span class="ident" id="8003675">Ident</span>&nbsp;<span class="op" id="8003681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003684">v</span>&nbsp;<span class="op" id="8003686">:=</span>&nbsp;<span class="builtinfunc" id="8003689">make</span><span class="op" id="8003693">(</span><span class="ident" id="8003694">visitor</span><span class="op" id="8003701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003704">go</span>&nbsp;<span class="keyword" id="8003707">func</span><span class="op" id="8003711">(</span><span class="op" id="8003712">)</span>&nbsp;<span class="op" id="8003714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003718">ast</span><span class="op" id="8003721">.</span><span class="ident" id="8003722">Walk</span><span class="op" id="8003726">(</span><span class="ident" id="8003727">v</span><span class="op" id="8003728">,</span>&nbsp;<span class="ident" id="8003730">f</span><span class="op" id="8003731">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8003735">close</span><span class="op" id="8003740">(</span><span class="ident" id="8003741">v</span><span class="op" id="8003742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003745">}</span><span class="op" id="8003746">(</span><span class="op" id="8003747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003750">return</span>&nbsp;<span class="ident" id="8003757">v</span><br>
<span class="lineno"></span><span class="op" id="8003759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="8003762">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="8003822">func</span>&nbsp;<span class="ident" id="8003827">identCount</span><span class="op" id="8003837">(</span><span class="ident" id="8003838">f</span>&nbsp;<span class="op" id="8003840">*</span><span class="ident" id="8003841">ast</span><span class="op" id="8003844">.</span><span class="ident" id="8003845">File</span><span class="op" id="8003849">)</span>&nbsp;<span class="builtintype" id="8003851">int</span>&nbsp;<span class="op" id="8003855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003858">n</span>&nbsp;<span class="op" id="8003860">:=</span>&nbsp;<span class="num" id="8003863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003866">for</span>&nbsp;<span class="keyword" id="8003870">range</span>&nbsp;<span class="ident" id="8003876">idents</span><span class="op" id="8003882">(</span><span class="ident" id="8003883">f</span><span class="op" id="8003884">)</span>&nbsp;<span class="op" id="8003886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003890">n</span><span class="op" id="8003891">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003898">return</span>&nbsp;<span class="ident" id="8003905">n</span><br>
<span class="lineno"></span><span class="op" id="8003907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8003910">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="8003974">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="8004039">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="8004057">func</span>&nbsp;<span class="ident" id="8004062">TestSourcePos</span><span class="op" id="8004075">(</span><span class="ident" id="8004076">t</span>&nbsp;<span class="op" id="8004078">*</span><span class="ident" id="8004079">testing</span><span class="op" id="8004086">.</span><span class="ident" id="8004087">T</span><span class="op" id="8004088">)</span>&nbsp;<span class="op" id="8004090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004093">const</span>&nbsp;<span class="ident" id="8004099">src</span>&nbsp;<span class="op" id="8004103">=</span>&nbsp;<span class="string" id="8004105">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004330">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004349">f1</span><span class="op" id="8004351">,</span>&nbsp;<span class="ident" id="8004353">err</span>&nbsp;<span class="op" id="8004357">:=</span>&nbsp;<span class="ident" id="8004360">parser</span><span class="op" id="8004366">.</span><span class="ident" id="8004367">ParseFile</span><span class="op" id="8004376">(</span><span class="ident" id="8004377">fset</span><span class="op" id="8004381">,</span>&nbsp;<span class="string" id="8004383">&#34;src&#34;</span><span class="op" id="8004388">,</span>&nbsp;<span class="ident" id="8004390">src</span><span class="op" id="8004393">,</span>&nbsp;<span class="ident" id="8004395">parser</span><span class="op" id="8004401">.</span><span class="ident" id="8004402">ParseComments</span><span class="op" id="8004415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004418">if</span>&nbsp;<span class="ident" id="8004421">err</span>&nbsp;<span class="op" id="8004425">!=</span>&nbsp;<span class="ident" id="8004428">nil</span>&nbsp;<span class="op" id="8004432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004436">t</span><span class="op" id="8004437">.</span><span class="ident" id="8004438">Fatal</span><span class="op" id="8004443">(</span><span class="ident" id="8004444">err</span><span class="op" id="8004447">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004454">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004480">var</span>&nbsp;<span class="ident" id="8004484">buf</span>&nbsp;<span class="ident" id="8004488">bytes</span><span class="op" id="8004493">.</span><span class="ident" id="8004494">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004502">err</span>&nbsp;<span class="op" id="8004506">=</span>&nbsp;<span class="op" id="8004508">(</span><span class="op" id="8004509">&amp;</span><span class="ident" id="8004510">Config</span><span class="op" id="8004516">{</span><span class="ident" id="8004517">Mode</span><span class="op" id="8004521">:</span>&nbsp;<span class="ident" id="8004523">UseSpaces</span>&nbsp;<span class="op" id="8004533">|</span>&nbsp;<span class="ident" id="8004535">SourcePos</span><span class="op" id="8004544">,</span>&nbsp;<span class="ident" id="8004546">Tabwidth</span><span class="op" id="8004554">:</span>&nbsp;<span class="num" id="8004556">8</span><span class="op" id="8004557">}</span><span class="op" id="8004558">)</span><span class="op" id="8004559">.</span><span class="ident" id="8004560">Fprint</span><span class="op" id="8004566">(</span><span class="op" id="8004567">&amp;</span><span class="ident" id="8004568">buf</span><span class="op" id="8004571">,</span>&nbsp;<span class="ident" id="8004573">fset</span><span class="op" id="8004577">,</span>&nbsp;<span class="ident" id="8004579">f1</span><span class="op" id="8004581">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004584">if</span>&nbsp;<span class="ident" id="8004587">err</span>&nbsp;<span class="op" id="8004591">!=</span>&nbsp;<span class="ident" id="8004594">nil</span>&nbsp;<span class="op" id="8004598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004602">t</span><span class="op" id="8004603">.</span><span class="ident" id="8004604">Fatal</span><span class="op" id="8004609">(</span><span class="ident" id="8004610">err</span><span class="op" id="8004613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004620">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004654">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004730">f2</span><span class="op" id="8004732">,</span>&nbsp;<span class="ident" id="8004734">err</span>&nbsp;<span class="op" id="8004738">:=</span>&nbsp;<span class="ident" id="8004741">parser</span><span class="op" id="8004747">.</span><span class="ident" id="8004748">ParseFile</span><span class="op" id="8004757">(</span><span class="ident" id="8004758">fset</span><span class="op" id="8004762">,</span>&nbsp;<span class="string" id="8004764">&#34;&#34;</span><span class="op" id="8004766">,</span>&nbsp;<span class="ident" id="8004768">buf</span><span class="op" id="8004771">.</span><span class="ident" id="8004772">Bytes</span><span class="op" id="8004777">(</span><span class="op" id="8004778">)</span><span class="op" id="8004779">,</span>&nbsp;<span class="num" id="8004781">0</span><span class="op" id="8004782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004785">if</span>&nbsp;<span class="ident" id="8004788">err</span>&nbsp;<span class="op" id="8004792">!=</span>&nbsp;<span class="ident" id="8004795">nil</span>&nbsp;<span class="op" id="8004799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004803">t</span><span class="op" id="8004804">.</span><span class="ident" id="8004805">Fatalf</span><span class="op" id="8004811">(</span><span class="string" id="8004812">&#34;%s\n%s&#34;</span><span class="op" id="8004820">,</span>&nbsp;<span class="ident" id="8004822">err</span><span class="op" id="8004825">,</span>&nbsp;<span class="ident" id="8004827">buf</span><span class="op" id="8004830">.</span><span class="ident" id="8004831">Bytes</span><span class="op" id="8004836">(</span><span class="op" id="8004837">)</span><span class="op" id="8004838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004841">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004845">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004916">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8004988">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005059">n1</span>&nbsp;<span class="op" id="8005062">:=</span>&nbsp;<span class="ident" id="8005065">identCount</span><span class="op" id="8005075">(</span><span class="ident" id="8005076">f1</span><span class="op" id="8005078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005081">n2</span>&nbsp;<span class="op" id="8005084">:=</span>&nbsp;<span class="ident" id="8005087">identCount</span><span class="op" id="8005097">(</span><span class="ident" id="8005098">f2</span><span class="op" id="8005100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005103">if</span>&nbsp;<span class="ident" id="8005106">n1</span>&nbsp;<span class="op" id="8005109">==</span>&nbsp;<span class="num" id="8005112">0</span>&nbsp;<span class="op" id="8005114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005118">t</span><span class="op" id="8005119">.</span><span class="ident" id="8005120">Fatal</span><span class="op" id="8005125">(</span><span class="string" id="8005126">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="8005141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005144">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005147">if</span>&nbsp;<span class="ident" id="8005150">n2</span>&nbsp;<span class="op" id="8005153">!=</span>&nbsp;<span class="ident" id="8005156">n1</span>&nbsp;<span class="op" id="8005159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005163">t</span><span class="op" id="8005164">.</span><span class="ident" id="8005165">Errorf</span><span class="op" id="8005171">(</span><span class="string" id="8005172">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8005196">,</span>&nbsp;<span class="ident" id="8005198">n2</span><span class="op" id="8005200">,</span>&nbsp;<span class="ident" id="8005202">n1</span><span class="op" id="8005204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8005211">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005273">i2range</span>&nbsp;<span class="op" id="8005281">:=</span>&nbsp;<span class="ident" id="8005284">idents</span><span class="op" id="8005290">(</span><span class="ident" id="8005291">f2</span><span class="op" id="8005293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005296">for</span>&nbsp;<span class="ident" id="8005300">i1</span>&nbsp;<span class="op" id="8005303">:=</span>&nbsp;<span class="keyword" id="8005306">range</span>&nbsp;<span class="ident" id="8005312">idents</span><span class="op" id="8005318">(</span><span class="ident" id="8005319">f1</span><span class="op" id="8005321">)</span>&nbsp;<span class="op" id="8005323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005327">i2</span>&nbsp;<span class="op" id="8005330">:=</span>&nbsp;<span class="op" id="8005333">&lt;-</span><span class="ident" id="8005335">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005346">if</span>&nbsp;<span class="ident" id="8005349">i2</span><span class="op" id="8005351">.</span><span class="ident" id="8005352">Name</span>&nbsp;<span class="op" id="8005357">!=</span>&nbsp;<span class="ident" id="8005360">i1</span><span class="op" id="8005362">.</span><span class="ident" id="8005363">Name</span>&nbsp;<span class="op" id="8005368">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005373">t</span><span class="op" id="8005374">.</span><span class="ident" id="8005375">Errorf</span><span class="op" id="8005381">(</span><span class="string" id="8005382">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8005405">,</span>&nbsp;<span class="ident" id="8005407">i2</span><span class="op" id="8005409">.</span><span class="ident" id="8005410">Name</span><span class="op" id="8005414">,</span>&nbsp;<span class="ident" id="8005416">i1</span><span class="op" id="8005418">.</span><span class="ident" id="8005419">Name</span><span class="op" id="8005423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005432">l1</span>&nbsp;<span class="op" id="8005435">:=</span>&nbsp;<span class="ident" id="8005438">fset</span><span class="op" id="8005442">.</span><span class="ident" id="8005443">Position</span><span class="op" id="8005451">(</span><span class="ident" id="8005452">i1</span><span class="op" id="8005454">.</span><span class="ident" id="8005455">Pos</span><span class="op" id="8005458">(</span><span class="op" id="8005459">)</span><span class="op" id="8005460">)</span><span class="op" id="8005461">.</span><span class="ident" id="8005462">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005469">l2</span>&nbsp;<span class="op" id="8005472">:=</span>&nbsp;<span class="ident" id="8005475">fset</span><span class="op" id="8005479">.</span><span class="ident" id="8005480">Position</span><span class="op" id="8005488">(</span><span class="ident" id="8005489">i2</span><span class="op" id="8005491">.</span><span class="ident" id="8005492">Pos</span><span class="op" id="8005495">(</span><span class="op" id="8005496">)</span><span class="op" id="8005497">)</span><span class="op" id="8005498">.</span><span class="ident" id="8005499">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005506">if</span>&nbsp;<span class="ident" id="8005509">l2</span>&nbsp;<span class="op" id="8005512">!=</span>&nbsp;<span class="ident" id="8005515">l1</span>&nbsp;<span class="op" id="8005518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005523">t</span><span class="op" id="8005524">.</span><span class="ident" id="8005525">Errorf</span><span class="op" id="8005531">(</span><span class="string" id="8005532">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="8005561">,</span>&nbsp;<span class="ident" id="8005563">l2</span><span class="op" id="8005565">,</span>&nbsp;<span class="ident" id="8005567">l1</span><span class="op" id="8005569">,</span>&nbsp;<span class="ident" id="8005571">i1</span><span class="op" id="8005573">.</span><span class="ident" id="8005574">Name</span><span class="op" id="8005578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005589">if</span>&nbsp;<span class="ident" id="8005592">t</span><span class="op" id="8005593">.</span><span class="ident" id="8005594">Failed</span><span class="op" id="8005600">(</span><span class="op" id="8005601">)</span>&nbsp;<span class="op" id="8005603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005607">t</span><span class="op" id="8005608">.</span><span class="ident" id="8005609">Logf</span><span class="op" id="8005613">(</span><span class="string" id="8005614">&#34;\n%s&#34;</span><span class="op" id="8005620">,</span>&nbsp;<span class="ident" id="8005622">buf</span><span class="op" id="8005625">.</span><span class="ident" id="8005626">Bytes</span><span class="op" id="8005631">(</span><span class="op" id="8005632">)</span><span class="op" id="8005633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005636">}</span><br>
<span class="lineno"></span><span class="op" id="8005638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8005641">var</span>&nbsp;<span class="ident" id="8005645">decls</span>&nbsp;<span class="op" id="8005651">=</span>&nbsp;<span class="op" id="8005653">[</span><span class="op" id="8005654">]</span><span class="builtintype" id="8005655">string</span><span class="op" id="8005661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8005664">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="8005678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8005681">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="8005733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8005736">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="8005778">,</span><br>
<span class="lineno"></span><span class="op" id="8005780">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="8005783">func</span>&nbsp;<span class="ident" id="8005788">TestDeclLists</span><span class="op" id="8005801">(</span><span class="ident" id="8005802">t</span>&nbsp;<span class="op" id="8005804">*</span><span class="ident" id="8005805">testing</span><span class="op" id="8005812">.</span><span class="ident" id="8005813">T</span><span class="op" id="8005814">)</span>&nbsp;<span class="op" id="8005816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005819">for</span>&nbsp;<span class="ident" id="8005823">_</span><span class="op" id="8005824">,</span>&nbsp;<span class="ident" id="8005826">src</span>&nbsp;<span class="op" id="8005830">:=</span>&nbsp;<span class="keyword" id="8005833">range</span>&nbsp;<span class="ident" id="8005839">decls</span>&nbsp;<span class="op" id="8005845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8005849">file</span><span class="op" id="8005853">,</span>&nbsp;<span class="ident" id="8005855">err</span>&nbsp;<span class="op" id="8005859">:=</span>&nbsp;<span class="ident" id="8005862">parser</span><span class="op" id="8005868">.</span><span class="ident" id="8005869">ParseFile</span><span class="op" id="8005878">(</span><span class="ident" id="8005879">fset</span><span class="op" id="8005883">,</span>&nbsp;<span class="string" id="8005885">&#34;&#34;</span><span class="op" id="8005887">,</span>&nbsp;<span class="string" id="8005889">&#34;package&nbsp;p;&#34;</span><span class="op" id="8005901">+</span><span class="ident" id="8005902">src</span><span class="op" id="8005905">,</span>&nbsp;<span class="ident" id="8005907">parser</span><span class="op" id="8005913">.</span><span class="ident" id="8005914">ParseComments</span><span class="op" id="8005927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005931">if</span>&nbsp;<span class="ident" id="8005934">err</span>&nbsp;<span class="op" id="8005938">!=</span>&nbsp;<span class="ident" id="8005941">nil</span>&nbsp;<span class="op" id="8005945">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8005950">panic</span><span class="op" id="8005955">(</span><span class="ident" id="8005956">err</span><span class="op" id="8005959">)</span>&nbsp;<span class="comment" id="8005961">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8005980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8005985">var</span>&nbsp;<span class="ident" id="8005989">buf</span>&nbsp;<span class="ident" id="8005993">bytes</span><span class="op" id="8005998">.</span><span class="ident" id="8005999">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006008">err</span>&nbsp;<span class="op" id="8006012">=</span>&nbsp;<span class="ident" id="8006014">Fprint</span><span class="op" id="8006020">(</span><span class="op" id="8006021">&amp;</span><span class="ident" id="8006022">buf</span><span class="op" id="8006025">,</span>&nbsp;<span class="ident" id="8006027">fset</span><span class="op" id="8006031">,</span>&nbsp;<span class="ident" id="8006033">file</span><span class="op" id="8006037">.</span><span class="ident" id="8006038">Decls</span><span class="op" id="8006043">)</span>&nbsp;<span class="comment" id="8006045">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006074">if</span>&nbsp;<span class="ident" id="8006077">err</span>&nbsp;<span class="op" id="8006081">!=</span>&nbsp;<span class="ident" id="8006084">nil</span>&nbsp;<span class="op" id="8006088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8006093">panic</span><span class="op" id="8006098">(</span><span class="ident" id="8006099">err</span><span class="op" id="8006102">)</span>&nbsp;<span class="comment" id="8006104">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006128">out</span>&nbsp;<span class="op" id="8006132">:=</span>&nbsp;<span class="ident" id="8006135">buf</span><span class="op" id="8006138">.</span><span class="ident" id="8006139">String</span><span class="op" id="8006145">(</span><span class="op" id="8006146">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006150">if</span>&nbsp;<span class="ident" id="8006153">out</span>&nbsp;<span class="op" id="8006157">!=</span>&nbsp;<span class="ident" id="8006160">src</span>&nbsp;<span class="op" id="8006164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006169">t</span><span class="op" id="8006170">.</span><span class="ident" id="8006171">Errorf</span><span class="op" id="8006177">(</span><span class="string" id="8006178">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8006202">,</span>&nbsp;<span class="ident" id="8006204">out</span><span class="op" id="8006207">,</span>&nbsp;<span class="ident" id="8006209">src</span><span class="op" id="8006212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006219">}</span><br>
<span class="lineno"></span><span class="op" id="8006221">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8006224">var</span>&nbsp;<span class="ident" id="8006228">stmts</span>&nbsp;<span class="op" id="8006234">=</span>&nbsp;<span class="op" id="8006236">[</span><span class="op" id="8006237">]</span><span class="builtintype" id="8006238">string</span><span class="op" id="8006244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006247">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="8006255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006258">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="8006300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006303">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="8006330">,</span><br>
<span class="lineno">460</span><span class="op" id="8006332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006335">func</span>&nbsp;<span class="ident" id="8006340">TestStmtLists</span><span class="op" id="8006353">(</span><span class="ident" id="8006354">t</span>&nbsp;<span class="op" id="8006356">*</span><span class="ident" id="8006357">testing</span><span class="op" id="8006364">.</span><span class="ident" id="8006365">T</span><span class="op" id="8006366">)</span>&nbsp;<span class="op" id="8006368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006371">for</span>&nbsp;<span class="ident" id="8006375">_</span><span class="op" id="8006376">,</span>&nbsp;<span class="ident" id="8006378">src</span>&nbsp;<span class="op" id="8006382">:=</span>&nbsp;<span class="keyword" id="8006385">range</span>&nbsp;<span class="ident" id="8006391">stmts</span>&nbsp;<span class="op" id="8006397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006401">file</span><span class="op" id="8006405">,</span>&nbsp;<span class="ident" id="8006407">err</span>&nbsp;<span class="op" id="8006411">:=</span>&nbsp;<span class="ident" id="8006414">parser</span><span class="op" id="8006420">.</span><span class="ident" id="8006421">ParseFile</span><span class="op" id="8006430">(</span><span class="ident" id="8006431">fset</span><span class="op" id="8006435">,</span>&nbsp;<span class="string" id="8006437">&#34;&#34;</span><span class="op" id="8006439">,</span>&nbsp;<span class="string" id="8006441">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="8006464">+</span><span class="ident" id="8006465">src</span><span class="op" id="8006468">+</span><span class="string" id="8006469">&#34;}&#34;</span><span class="op" id="8006472">,</span>&nbsp;<span class="ident" id="8006474">parser</span><span class="op" id="8006480">.</span><span class="ident" id="8006481">ParseComments</span><span class="op" id="8006494">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006498">if</span>&nbsp;<span class="ident" id="8006501">err</span>&nbsp;<span class="op" id="8006505">!=</span>&nbsp;<span class="ident" id="8006508">nil</span>&nbsp;<span class="op" id="8006512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8006517">panic</span><span class="op" id="8006522">(</span><span class="ident" id="8006523">err</span><span class="op" id="8006526">)</span>&nbsp;<span class="comment" id="8006528">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006552">var</span>&nbsp;<span class="ident" id="8006556">buf</span>&nbsp;<span class="ident" id="8006560">bytes</span><span class="op" id="8006565">.</span><span class="ident" id="8006566">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006575">err</span>&nbsp;<span class="op" id="8006579">=</span>&nbsp;<span class="ident" id="8006581">Fprint</span><span class="op" id="8006587">(</span><span class="op" id="8006588">&amp;</span><span class="ident" id="8006589">buf</span><span class="op" id="8006592">,</span>&nbsp;<span class="ident" id="8006594">fset</span><span class="op" id="8006598">,</span>&nbsp;<span class="ident" id="8006600">file</span><span class="op" id="8006604">.</span><span class="ident" id="8006605">Decls</span><span class="op" id="8006610">[</span><span class="num" id="8006611">0</span><span class="op" id="8006612">]</span><span class="op" id="8006613">.</span><span class="op" id="8006614">(</span><span class="op" id="8006615">*</span><span class="ident" id="8006616">ast</span><span class="op" id="8006619">.</span><span class="ident" id="8006620">FuncDecl</span><span class="op" id="8006628">)</span><span class="op" id="8006629">.</span><span class="ident" id="8006630">Body</span><span class="op" id="8006634">.</span><span class="ident" id="8006635">List</span><span class="op" id="8006639">)</span>&nbsp;<span class="comment" id="8006641">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006668">if</span>&nbsp;<span class="ident" id="8006671">err</span>&nbsp;<span class="op" id="8006675">!=</span>&nbsp;<span class="ident" id="8006678">nil</span>&nbsp;<span class="op" id="8006682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8006687">panic</span><span class="op" id="8006692">(</span><span class="ident" id="8006693">err</span><span class="op" id="8006696">)</span>&nbsp;<span class="comment" id="8006698">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006722">out</span>&nbsp;<span class="op" id="8006726">:=</span>&nbsp;<span class="ident" id="8006729">buf</span><span class="op" id="8006732">.</span><span class="ident" id="8006733">String</span><span class="op" id="8006739">(</span><span class="op" id="8006740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8006744">if</span>&nbsp;<span class="ident" id="8006747">out</span>&nbsp;<span class="op" id="8006751">!=</span>&nbsp;<span class="ident" id="8006754">src</span>&nbsp;<span class="op" id="8006758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006763">t</span><span class="op" id="8006764">.</span><span class="ident" id="8006765">Errorf</span><span class="op" id="8006771">(</span><span class="string" id="8006772">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8006796">,</span>&nbsp;<span class="ident" id="8006798">out</span><span class="op" id="8006801">,</span>&nbsp;<span class="ident" id="8006803">src</span><span class="op" id="8006806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006813">}</span><br>
<span class="lineno">480</span><span class="op" id="8006815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006818">func</span>&nbsp;<span class="ident" id="8006823">TestBaseIndent</span><span class="op" id="8006837">(</span><span class="ident" id="8006838">t</span>&nbsp;<span class="op" id="8006840">*</span><span class="ident" id="8006841">testing</span><span class="op" id="8006848">.</span><span class="ident" id="8006849">T</span><span class="op" id="8006850">)</span>&nbsp;<span class="op" id="8006852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8006855">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8006924">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8006993">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007013">const</span>&nbsp;<span class="ident" id="8007019">filename</span>&nbsp;<span class="op" id="8007028">=</span>&nbsp;<span class="string" id="8007030">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007044">src</span><span class="op" id="8007047">,</span>&nbsp;<span class="ident" id="8007049">err</span>&nbsp;<span class="op" id="8007053">:=</span>&nbsp;<span class="ident" id="8007056">ioutil</span><span class="op" id="8007062">.</span><span class="ident" id="8007063">ReadFile</span><span class="op" id="8007071">(</span><span class="ident" id="8007072">filename</span><span class="op" id="8007080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007083">if</span>&nbsp;<span class="ident" id="8007086">err</span>&nbsp;<span class="op" id="8007090">!=</span>&nbsp;<span class="ident" id="8007093">nil</span>&nbsp;<span class="op" id="8007097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8007101">panic</span><span class="op" id="8007106">(</span><span class="ident" id="8007107">err</span><span class="op" id="8007110">)</span>&nbsp;<span class="comment" id="8007112">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007134">file</span><span class="op" id="8007138">,</span>&nbsp;<span class="ident" id="8007140">err</span>&nbsp;<span class="op" id="8007144">:=</span>&nbsp;<span class="ident" id="8007147">parser</span><span class="op" id="8007153">.</span><span class="ident" id="8007154">ParseFile</span><span class="op" id="8007163">(</span><span class="ident" id="8007164">fset</span><span class="op" id="8007168">,</span>&nbsp;<span class="ident" id="8007170">filename</span><span class="op" id="8007178">,</span>&nbsp;<span class="ident" id="8007180">src</span><span class="op" id="8007183">,</span>&nbsp;<span class="num" id="8007185">0</span><span class="op" id="8007186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007189">if</span>&nbsp;<span class="ident" id="8007192">err</span>&nbsp;<span class="op" id="8007196">!=</span>&nbsp;<span class="ident" id="8007199">nil</span>&nbsp;<span class="op" id="8007203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8007207">panic</span><span class="op" id="8007212">(</span><span class="ident" id="8007213">err</span><span class="op" id="8007216">)</span>&nbsp;<span class="comment" id="8007218">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007240">var</span>&nbsp;<span class="ident" id="8007244">buf</span>&nbsp;<span class="ident" id="8007248">bytes</span><span class="op" id="8007253">.</span><span class="ident" id="8007254">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007262">for</span>&nbsp;<span class="ident" id="8007266">indent</span>&nbsp;<span class="op" id="8007273">:=</span>&nbsp;<span class="num" id="8007276">0</span><span class="op" id="8007277">;</span>&nbsp;<span class="ident" id="8007279">indent</span>&nbsp;<span class="op" id="8007286">&lt;</span>&nbsp;<span class="num" id="8007288">4</span><span class="op" id="8007289">;</span>&nbsp;<span class="ident" id="8007291">indent</span><span class="op" id="8007297">++</span>&nbsp;<span class="op" id="8007300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007304">buf</span><span class="op" id="8007307">.</span><span class="ident" id="8007308">Reset</span><span class="op" id="8007313">(</span><span class="op" id="8007314">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007318">(</span><span class="op" id="8007319">&amp;</span><span class="ident" id="8007320">Config</span><span class="op" id="8007326">{</span><span class="ident" id="8007327">Tabwidth</span><span class="op" id="8007335">:</span>&nbsp;<span class="ident" id="8007337">tabwidth</span><span class="op" id="8007345">,</span>&nbsp;<span class="ident" id="8007347">Indent</span><span class="op" id="8007353">:</span>&nbsp;<span class="ident" id="8007355">indent</span><span class="op" id="8007361">}</span><span class="op" id="8007362">)</span><span class="op" id="8007363">.</span><span class="ident" id="8007364">Fprint</span><span class="op" id="8007370">(</span><span class="op" id="8007371">&amp;</span><span class="ident" id="8007372">buf</span><span class="op" id="8007375">,</span>&nbsp;<span class="ident" id="8007377">fset</span><span class="op" id="8007381">,</span>&nbsp;<span class="ident" id="8007383">file</span><span class="op" id="8007387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8007391">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007448">lines</span>&nbsp;<span class="op" id="8007454">:=</span>&nbsp;<span class="ident" id="8007457">bytes</span><span class="op" id="8007462">.</span><span class="ident" id="8007463">Split</span><span class="op" id="8007468">(</span><span class="ident" id="8007469">buf</span><span class="op" id="8007472">.</span><span class="ident" id="8007473">Bytes</span><span class="op" id="8007478">(</span><span class="op" id="8007479">)</span><span class="op" id="8007480">,</span>&nbsp;<span class="op" id="8007482">[</span><span class="op" id="8007483">]</span><span class="builtintype" id="8007484">byte</span><span class="op" id="8007488">{</span><span class="string" id="8007489">&#39;\n&#39;</span><span class="op" id="8007493">}</span><span class="op" id="8007494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007498">for</span>&nbsp;<span class="ident" id="8007502">i</span><span class="op" id="8007503">,</span>&nbsp;<span class="ident" id="8007505">line</span>&nbsp;<span class="op" id="8007510">:=</span>&nbsp;<span class="keyword" id="8007513">range</span>&nbsp;<span class="ident" id="8007519">lines</span>&nbsp;<span class="op" id="8007525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007530">if</span>&nbsp;<span class="builtinfunc" id="8007533">len</span><span class="op" id="8007536">(</span><span class="ident" id="8007537">line</span><span class="op" id="8007541">)</span>&nbsp;<span class="op" id="8007543">==</span>&nbsp;<span class="num" id="8007546">0</span>&nbsp;<span class="op" id="8007548">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007554">continue</span>&nbsp;<span class="comment" id="8007563">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007609">n</span>&nbsp;<span class="op" id="8007611">:=</span>&nbsp;<span class="num" id="8007614">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007619">for</span>&nbsp;<span class="ident" id="8007623">j</span><span class="op" id="8007624">,</span>&nbsp;<span class="ident" id="8007626">b</span>&nbsp;<span class="op" id="8007628">:=</span>&nbsp;<span class="keyword" id="8007631">range</span>&nbsp;<span class="ident" id="8007637">line</span>&nbsp;<span class="op" id="8007642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007648">if</span>&nbsp;<span class="ident" id="8007651">b</span>&nbsp;<span class="op" id="8007653">!=</span>&nbsp;<span class="string" id="8007656">&#39;\t&#39;</span>&nbsp;<span class="op" id="8007661">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8007668">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007695">n</span>&nbsp;<span class="op" id="8007697">=</span>&nbsp;<span class="ident" id="8007699">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007706">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007721">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8007726">if</span>&nbsp;<span class="ident" id="8007729">n</span>&nbsp;<span class="op" id="8007731">&lt;</span>&nbsp;<span class="ident" id="8007733">indent</span>&nbsp;<span class="op" id="8007740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007746">t</span><span class="op" id="8007747">.</span><span class="ident" id="8007748">Errorf</span><span class="op" id="8007754">(</span><span class="string" id="8007755">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="8007804">,</span>&nbsp;<span class="ident" id="8007806">i</span><span class="op" id="8007807">,</span>&nbsp;<span class="ident" id="8007809">n</span><span class="op" id="8007810">,</span>&nbsp;<span class="ident" id="8007812">indent</span><span class="op" id="8007818">,</span>&nbsp;<span class="ident" id="8007820">line</span><span class="op" id="8007824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007836">}</span><br>
<span class="lineno">520</span><span class="op" id="8007838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8007841">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="8007908">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="8007980">func</span>&nbsp;<span class="ident" id="8007985">TestFuncType</span><span class="op" id="8007997">(</span><span class="ident" id="8007998">t</span>&nbsp;<span class="op" id="8008000">*</span><span class="ident" id="8008001">testing</span><span class="op" id="8008008">.</span><span class="ident" id="8008009">T</span><span class="op" id="8008010">)</span>&nbsp;<span class="op" id="8008012">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008015">src</span>&nbsp;<span class="op" id="8008019">:=</span>&nbsp;<span class="op" id="8008022">&amp;</span><span class="ident" id="8008023">ast</span><span class="op" id="8008026">.</span><span class="ident" id="8008027">File</span><span class="op" id="8008031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008035">Name</span><span class="op" id="8008039">:</span>&nbsp;<span class="op" id="8008041">&amp;</span><span class="ident" id="8008042">ast</span><span class="op" id="8008045">.</span><span class="ident" id="8008046">Ident</span><span class="op" id="8008051">{</span><span class="ident" id="8008052">Name</span><span class="op" id="8008056">:</span>&nbsp;<span class="string" id="8008058">&#34;p&#34;</span><span class="op" id="8008061">}</span><span class="op" id="8008062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008066">Decls</span><span class="op" id="8008071">:</span>&nbsp;<span class="op" id="8008073">[</span><span class="op" id="8008074">]</span><span class="ident" id="8008075">ast</span><span class="op" id="8008078">.</span><span class="ident" id="8008079">Decl</span><span class="op" id="8008083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008088">&amp;</span><span class="ident" id="8008089">ast</span><span class="op" id="8008092">.</span><span class="ident" id="8008093">FuncDecl</span><span class="op" id="8008101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008107">Name</span><span class="op" id="8008111">:</span>&nbsp;<span class="op" id="8008113">&amp;</span><span class="ident" id="8008114">ast</span><span class="op" id="8008117">.</span><span class="ident" id="8008118">Ident</span><span class="op" id="8008123">{</span><span class="ident" id="8008124">Name</span><span class="op" id="8008128">:</span>&nbsp;<span class="string" id="8008130">&#34;f&#34;</span><span class="op" id="8008133">}</span><span class="op" id="8008134">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008140">Type</span><span class="op" id="8008144">:</span>&nbsp;<span class="op" id="8008146">&amp;</span><span class="ident" id="8008147">ast</span><span class="op" id="8008150">.</span><span class="ident" id="8008151">FuncType</span><span class="op" id="8008159">{</span><span class="op" id="8008160">}</span><span class="op" id="8008161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008166">}</span><span class="op" id="8008167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008171">}</span><span class="op" id="8008172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8008179">var</span>&nbsp;<span class="ident" id="8008183">buf</span>&nbsp;<span class="ident" id="8008187">bytes</span><span class="op" id="8008192">.</span><span class="ident" id="8008193">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8008201">if</span>&nbsp;<span class="ident" id="8008204">err</span>&nbsp;<span class="op" id="8008208">:=</span>&nbsp;<span class="ident" id="8008211">Fprint</span><span class="op" id="8008217">(</span><span class="op" id="8008218">&amp;</span><span class="ident" id="8008219">buf</span><span class="op" id="8008222">,</span>&nbsp;<span class="ident" id="8008224">fset</span><span class="op" id="8008228">,</span>&nbsp;<span class="ident" id="8008230">src</span><span class="op" id="8008233">)</span><span class="op" id="8008234">;</span>&nbsp;<span class="ident" id="8008236">err</span>&nbsp;<span class="op" id="8008240">!=</span>&nbsp;<span class="ident" id="8008243">nil</span>&nbsp;<span class="op" id="8008247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008251">t</span><span class="op" id="8008252">.</span><span class="ident" id="8008253">Fatal</span><span class="op" id="8008258">(</span><span class="ident" id="8008259">err</span><span class="op" id="8008262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008268">got</span>&nbsp;<span class="op" id="8008272">:=</span>&nbsp;<span class="ident" id="8008275">buf</span><span class="op" id="8008278">.</span><span class="ident" id="8008279">String</span><span class="op" id="8008285">(</span><span class="op" id="8008286">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8008290">const</span>&nbsp;<span class="ident" id="8008296">want</span>&nbsp;<span class="op" id="8008301">=</span>&nbsp;<span class="string" id="8008303">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8008328">if</span>&nbsp;<span class="ident" id="8008331">got</span>&nbsp;<span class="op" id="8008335">!=</span>&nbsp;<span class="ident" id="8008338">want</span>&nbsp;<span class="op" id="8008343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008347">t</span><span class="op" id="8008348">.</span><span class="ident" id="8008349">Fatalf</span><span class="op" id="8008355">(</span><span class="string" id="8008356">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="8008379">,</span>&nbsp;<span class="ident" id="8008381">got</span><span class="op" id="8008384">,</span>&nbsp;<span class="ident" id="8008386">want</span><span class="op" id="8008390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008393">}</span><br>
<span class="lineno"></span><span class="op" id="8008395">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="8008398">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="8008477">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="8008495">func</span>&nbsp;<span class="ident" id="8008500">TestX</span><span class="op" id="8008505">(</span><span class="ident" id="8008506">t</span>&nbsp;<span class="op" id="8008508">*</span><span class="ident" id="8008509">testing</span><span class="op" id="8008516">.</span><span class="ident" id="8008517">T</span><span class="op" id="8008518">)</span>&nbsp;<span class="op" id="8008520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8008523">const</span>&nbsp;<span class="ident" id="8008529">src</span>&nbsp;<span class="op" id="8008533">=</span>&nbsp;<span class="string" id="8008535">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008562">_</span><span class="op" id="8008563">,</span>&nbsp;<span class="ident" id="8008565">err</span>&nbsp;<span class="op" id="8008569">:=</span>&nbsp;<span class="ident" id="8008572">format</span><span class="op" id="8008578">(</span><span class="op" id="8008579">[</span><span class="op" id="8008580">]</span><span class="builtintype" id="8008581">byte</span><span class="op" id="8008585">(</span><span class="ident" id="8008586">src</span><span class="op" id="8008589">)</span><span class="op" id="8008590">,</span>&nbsp;<span class="num" id="8008592">0</span><span class="op" id="8008593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8008596">if</span>&nbsp;<span class="ident" id="8008599">err</span>&nbsp;<span class="op" id="8008603">!=</span>&nbsp;<span class="ident" id="8008606">nil</span>&nbsp;<span class="op" id="8008610">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008614">t</span><span class="op" id="8008615">.</span><span class="ident" id="8008616">Error</span><span class="op" id="8008621">(</span><span class="ident" id="8008622">err</span><span class="op" id="8008625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008628">}</span><br>
<span class="lineno"></span><span class="op" id="8008630">}</span>
</div>
</body>
</html>
