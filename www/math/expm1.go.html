<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2275581">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2275636">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2275690">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2275741">package</span>&nbsp;<span class="ident" id="2275749">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2275755">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2275815">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2275875">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2275934">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2275964">//</span><br>
<span class="lineno"></span><span class="comment" id="2275967">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2276023">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2276092">//</span><br>
<span class="lineno">15</span><span class="comment" id="2276095">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2276154">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2276210">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2276267">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2276284">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2276340">//</span><br>
<span class="lineno"></span><span class="comment" id="2276343">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2276355">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2276406">//</span><br>
<span class="lineno"></span><span class="comment" id="2276409">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2276419">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2276447">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2276495">//</span><br>
<span class="lineno"></span><span class="comment" id="2276498">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2276556">//</span><br>
<span class="lineno">30</span><span class="comment" id="2276559">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2276623">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2276687">//</span><br>
<span class="lineno"></span><span class="comment" id="2276690">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2276755">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2276789">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2276803">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2276868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2276897">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2276955">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2276972">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2277030">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2277091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2277158">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2277223">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2277286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2277352">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2277387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2277458">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2277508">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2277558">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2277608">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2277658">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2277708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2277775">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2277805">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2277858">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2277908">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2277953">//</span><br>
<span class="lineno"></span><span class="comment" id="2277956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2278018">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2278087">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2278126">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2278190">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2278254">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2278318">//</span><br>
<span class="lineno"></span><span class="comment" id="2278321">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2278387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2278442">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2278490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2278554">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2278619">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2278637">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2278709">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2278781">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2278853">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2278925">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2278997">//</span><br>
<span class="lineno"></span><span class="comment" id="2279000">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2279027">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2279066">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2279095">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2279146">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2279203">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2279233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2279302">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2279354">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2279419">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2279490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2279525">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2279571">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2279630">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2279690">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2279761">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2279824">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2279869">//</span><br>
<span class="lineno"></span><span class="comment" id="2279872">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2279890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2279936">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2279967">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2280022">//</span><br>
<span class="lineno"></span><span class="comment" id="2280025">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2280038">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2280108">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2280148">//</span><br>
<span class="lineno">105</span><span class="comment" id="2280151">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2280166">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2280190">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2280260">//</span><br>
<span class="lineno"></span><span class="comment" id="2280263">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2280277">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2280343">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2280407">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2280473">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2280517">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2280521">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2280585">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2280645">//</span><br>
<span class="lineno"></span><span class="comment" id="2280648">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2280670">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2280692">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2280712">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2280732">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2280777">func</span>&nbsp;<span class="ident" id="2280782">Expm1</span><span class="op" id="2280787">(</span><span class="ident" id="2280788">x</span>&nbsp;<span class="builtintype" id="2280790">float64</span><span class="op" id="2280797">)</span>&nbsp;<span class="builtintype" id="2280799">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2280808">func</span>&nbsp;<span class="ident" id="2280813">expm1</span><span class="op" id="2280818">(</span><span class="ident" id="2280819">x</span>&nbsp;<span class="builtintype" id="2280821">float64</span><span class="op" id="2280828">)</span>&nbsp;<span class="builtintype" id="2280830">float64</span>&nbsp;<span class="op" id="2280838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280841">const</span>&nbsp;<span class="op" id="2280847">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280851">Othreshold</span>&nbsp;<span class="op" id="2280862">=</span>&nbsp;<span class="num" id="2280864">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2280891">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280915">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2280926">=</span>&nbsp;<span class="num" id="2280928">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2280955">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280979">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2280990">=</span>&nbsp;<span class="num" id="2280992">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2281019">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281043">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281054">=</span>&nbsp;<span class="num" id="2281056">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2281083">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281107">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281118">=</span>&nbsp;<span class="num" id="2281120">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2281147">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281171">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281182">=</span>&nbsp;<span class="num" id="2281184">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2281211">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281235">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281246">=</span>&nbsp;<span class="num" id="2281248">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2281275">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281299">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281310">=</span>&nbsp;<span class="num" id="2281312">1.0</span>&nbsp;<span class="op" id="2281316">/</span>&nbsp;<span class="op" id="2281318">(</span><span class="num" id="2281319">1</span>&nbsp;<span class="op" id="2281321">&lt;&lt;</span>&nbsp;<span class="num" id="2281324">54</span><span class="op" id="2281326">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2281339">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281372">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281414">Q1</span>&nbsp;<span class="op" id="2281417">=</span>&nbsp;<span class="op" id="2281419">-</span><span class="num" id="2281420">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2281447">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281471">Q2</span>&nbsp;<span class="op" id="2281474">=</span>&nbsp;<span class="num" id="2281476">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2281504">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281528">Q3</span>&nbsp;<span class="op" id="2281531">=</span>&nbsp;<span class="op" id="2281533">-</span><span class="num" id="2281534">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2281561">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281585">Q4</span>&nbsp;<span class="op" id="2281588">=</span>&nbsp;<span class="num" id="2281590">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2281618">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281642">Q5</span>&nbsp;<span class="op" id="2281645">=</span>&nbsp;<span class="op" id="2281647">-</span><span class="num" id="2281648">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2281675">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281702">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281720">switch</span>&nbsp;<span class="op" id="2281727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281730">case</span>&nbsp;<span class="ident" id="2281735"><a href="/math/bits.go.html#2252563">IsInf</a></span><span class="op" id="2281740">(</span><span class="ident" id="2281741"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2281742">,</span>&nbsp;<span class="num" id="2281744">1</span><span class="op" id="2281745">)</span>&nbsp;<span class="op" id="2281747">||</span>&nbsp;<span class="ident" id="2281750"><a href="/math/bits.go.html#2252065">IsNaN</a></span><span class="op" id="2281755">(</span><span class="ident" id="2281756"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2281757">)</span><span class="op" id="2281758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281762">return</span>&nbsp;<span class="ident" id="2281769"><a href="/math/expm1.go.html#2280819">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281772">case</span>&nbsp;<span class="ident" id="2281777"><a href="/math/bits.go.html#2252563">IsInf</a></span><span class="op" id="2281782">(</span><span class="ident" id="2281783"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2281784">,</span>&nbsp;<span class="op" id="2281786">-</span><span class="num" id="2281787">1</span><span class="op" id="2281788">)</span><span class="op" id="2281789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281793">return</span>&nbsp;<span class="op" id="2281800">-</span><span class="num" id="2281801">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281808">absx</span>&nbsp;<span class="op" id="2281813">:=</span>&nbsp;<span class="ident" id="2281816"><a href="/math/expm1.go.html#2280819">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281819">sign</span>&nbsp;<span class="op" id="2281824">:=</span>&nbsp;<span class="builtintype" id="2281827">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281834">if</span>&nbsp;<span class="ident" id="2281837"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2281839">&lt;</span>&nbsp;<span class="num" id="2281841">0</span>&nbsp;<span class="op" id="2281843">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281847"><a href="/math/expm1.go.html#2281808">absx</a></span>&nbsp;<span class="op" id="2281852">=</span>&nbsp;<span class="op" id="2281854">-</span><span class="ident" id="2281855"><a href="/math/expm1.go.html#2281808">absx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281862"><a href="/math/expm1.go.html#2281819">sign</a></span>&nbsp;<span class="op" id="2281867">=</span>&nbsp;<span class="builtintype" id="2281869">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281879">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281908">if</span>&nbsp;<span class="ident" id="2281911"><a href="/math/expm1.go.html#2281808">absx</a></span>&nbsp;<span class="op" id="2281916">&gt;=</span>&nbsp;<span class="ident" id="2281919"><a href="/math/expm1.go.html#2280915">Ln2X56</a></span>&nbsp;<span class="op" id="2281926">{</span>&nbsp;<span class="comment" id="2281928">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281952">if</span>&nbsp;<span class="ident" id="2281955"><a href="/math/expm1.go.html#2281808">absx</a></span>&nbsp;<span class="op" id="2281960">&gt;=</span>&nbsp;<span class="ident" id="2281963"><a href="/math/expm1.go.html#2280851">Othreshold</a></span>&nbsp;<span class="op" id="2281974">{</span>&nbsp;<span class="comment" id="2281976">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282002">return</span>&nbsp;<span class="ident" id="2282009"><a href="/math/bits.go.html#2251765">Inf</a></span><span class="op" id="2282012">(</span><span class="num" id="2282013">1</span><span class="op" id="2282014">)</span>&nbsp;<span class="comment" id="2282016">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282034">if</span>&nbsp;<span class="ident" id="2282037"><a href="/math/expm1.go.html#2281819">sign</a></span>&nbsp;<span class="op" id="2282042">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282047">return</span>&nbsp;<span class="op" id="2282054">-</span><span class="num" id="2282055">1</span>&nbsp;<span class="comment" id="2282057">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282094">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282117">var</span>&nbsp;<span class="ident" id="2282121">c</span>&nbsp;<span class="builtintype" id="2282123">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282132">var</span>&nbsp;<span class="ident" id="2282136">k</span>&nbsp;<span class="builtintype" id="2282138">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282143">if</span>&nbsp;<span class="ident" id="2282146"><a href="/math/expm1.go.html#2281808">absx</a></span>&nbsp;<span class="op" id="2282151">&gt;</span>&nbsp;<span class="ident" id="2282153"><a href="/math/expm1.go.html#2281043">Ln2Half</a></span>&nbsp;<span class="op" id="2282161">{</span>&nbsp;<span class="comment" id="2282163">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282188">var</span>&nbsp;<span class="ident" id="2282192">hi</span><span class="op" id="2282194">,</span>&nbsp;<span class="ident" id="2282196">lo</span>&nbsp;<span class="builtintype" id="2282199">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282209">if</span>&nbsp;<span class="ident" id="2282212"><a href="/math/expm1.go.html#2281808">absx</a></span>&nbsp;<span class="op" id="2282217">&lt;</span>&nbsp;<span class="ident" id="2282219"><a href="/math/expm1.go.html#2280979">Ln2HalfX3</a></span>&nbsp;<span class="op" id="2282229">{</span>&nbsp;<span class="comment" id="2282231">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282257">if</span>&nbsp;<span class="op" id="2282260">!</span><span class="ident" id="2282261"><a href="/math/expm1.go.html#2281819">sign</a></span>&nbsp;<span class="op" id="2282266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282272"><a href="/math/expm1.go.html#2282192">hi</a></span>&nbsp;<span class="op" id="2282275">=</span>&nbsp;<span class="ident" id="2282277"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282279">-</span>&nbsp;<span class="ident" id="2282281"><a href="/math/expm1.go.html#2281107">Ln2Hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282291"><a href="/math/expm1.go.html#2282196">lo</a></span>&nbsp;<span class="op" id="2282294">=</span>&nbsp;<span class="ident" id="2282296"><a href="/math/expm1.go.html#2281171">Ln2Lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282306"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282308">=</span>&nbsp;<span class="num" id="2282310">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282315">}</span>&nbsp;<span class="keyword" id="2282317">else</span>&nbsp;<span class="op" id="2282322">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282328"><a href="/math/expm1.go.html#2282192">hi</a></span>&nbsp;<span class="op" id="2282331">=</span>&nbsp;<span class="ident" id="2282333"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282335">+</span>&nbsp;<span class="ident" id="2282337"><a href="/math/expm1.go.html#2281107">Ln2Hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282347"><a href="/math/expm1.go.html#2282196">lo</a></span>&nbsp;<span class="op" id="2282350">=</span>&nbsp;<span class="op" id="2282352">-</span><span class="ident" id="2282353"><a href="/math/expm1.go.html#2281171">Ln2Lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282363"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282365">=</span>&nbsp;<span class="op" id="2282367">-</span><span class="num" id="2282368">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282377">}</span>&nbsp;<span class="keyword" id="2282379">else</span>&nbsp;<span class="op" id="2282384">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282389">if</span>&nbsp;<span class="op" id="2282392">!</span><span class="ident" id="2282393"><a href="/math/expm1.go.html#2281819">sign</a></span>&nbsp;<span class="op" id="2282398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282404"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282406">=</span>&nbsp;<span class="builtintype" id="2282408">int</span><span class="op" id="2282411">(</span><span class="ident" id="2282412"><a href="/math/expm1.go.html#2281235">InvLn2</a></span><span class="op" id="2282418">*</span><span class="ident" id="2282419"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282421">+</span>&nbsp;<span class="num" id="2282423">0.5</span><span class="op" id="2282426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282431">}</span>&nbsp;<span class="keyword" id="2282433">else</span>&nbsp;<span class="op" id="2282438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282444"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282446">=</span>&nbsp;<span class="builtintype" id="2282448">int</span><span class="op" id="2282451">(</span><span class="ident" id="2282452"><a href="/math/expm1.go.html#2281235">InvLn2</a></span><span class="op" id="2282458">*</span><span class="ident" id="2282459"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282461">-</span>&nbsp;<span class="num" id="2282463">0.5</span><span class="op" id="2282466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282471">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282476">t</span>&nbsp;<span class="op" id="2282478">:=</span>&nbsp;<span class="builtintype" id="2282481">float64</span><span class="op" id="2282488">(</span><span class="ident" id="2282489"><a href="/math/expm1.go.html#2282136">k</a></span><span class="op" id="2282490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282495"><a href="/math/expm1.go.html#2282192">hi</a></span>&nbsp;<span class="op" id="2282498">=</span>&nbsp;<span class="ident" id="2282500"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282502">-</span>&nbsp;<span class="ident" id="2282504"><a href="/math/expm1.go.html#2282476">t</a></span><span class="op" id="2282505">*</span><span class="ident" id="2282506"><a href="/math/expm1.go.html#2281107">Ln2Hi</a></span>&nbsp;<span class="comment" id="2282512">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282542"><a href="/math/expm1.go.html#2282196">lo</a></span>&nbsp;<span class="op" id="2282545">=</span>&nbsp;<span class="ident" id="2282547"><a href="/math/expm1.go.html#2282476">t</a></span>&nbsp;<span class="op" id="2282549">*</span>&nbsp;<span class="ident" id="2282551"><a href="/math/expm1.go.html#2281171">Ln2Lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282563"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282565">=</span>&nbsp;<span class="ident" id="2282567"><a href="/math/expm1.go.html#2282192">hi</a></span>&nbsp;<span class="op" id="2282570">-</span>&nbsp;<span class="ident" id="2282572"><a href="/math/expm1.go.html#2282196">lo</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282577"><a href="/math/expm1.go.html#2282121">c</a></span>&nbsp;<span class="op" id="2282579">=</span>&nbsp;<span class="op" id="2282581">(</span><span class="ident" id="2282582"><a href="/math/expm1.go.html#2282192">hi</a></span>&nbsp;<span class="op" id="2282585">-</span>&nbsp;<span class="ident" id="2282587"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2282588">)</span>&nbsp;<span class="op" id="2282590">-</span>&nbsp;<span class="ident" id="2282592"><a href="/math/expm1.go.html#2282196">lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282596">}</span>&nbsp;<span class="keyword" id="2282598">else</span>&nbsp;<span class="keyword" id="2282603">if</span>&nbsp;<span class="ident" id="2282606"><a href="/math/expm1.go.html#2281808">absx</a></span>&nbsp;<span class="op" id="2282611">&lt;</span>&nbsp;<span class="ident" id="2282613"><a href="/math/expm1.go.html#2281299">Tiny</a></span>&nbsp;<span class="op" id="2282618">{</span>&nbsp;<span class="comment" id="2282620">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282653">return</span>&nbsp;<span class="ident" id="2282660"><a href="/math/expm1.go.html#2280819">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282663">}</span>&nbsp;<span class="keyword" id="2282665">else</span>&nbsp;<span class="op" id="2282670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282674"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282676">=</span>&nbsp;<span class="num" id="2282678">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282685">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282715">hfx</span>&nbsp;<span class="op" id="2282719">:=</span>&nbsp;<span class="num" id="2282722">0.5</span>&nbsp;<span class="op" id="2282726">*</span>&nbsp;<span class="ident" id="2282728"><a href="/math/expm1.go.html#2280819">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282731">hxs</span>&nbsp;<span class="op" id="2282735">:=</span>&nbsp;<span class="ident" id="2282738"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282740">*</span>&nbsp;<span class="ident" id="2282742"><a href="/math/expm1.go.html#2282715">hfx</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282747">r1</span>&nbsp;<span class="op" id="2282750">:=</span>&nbsp;<span class="num" id="2282753">1</span>&nbsp;<span class="op" id="2282755">+</span>&nbsp;<span class="ident" id="2282757"><a href="/math/expm1.go.html#2282731">hxs</a></span><span class="op" id="2282760">*</span><span class="op" id="2282761">(</span><span class="ident" id="2282762"><a href="/math/expm1.go.html#2281414">Q1</a></span><span class="op" id="2282764">+</span><span class="ident" id="2282765"><a href="/math/expm1.go.html#2282731">hxs</a></span><span class="op" id="2282768">*</span><span class="op" id="2282769">(</span><span class="ident" id="2282770"><a href="/math/expm1.go.html#2281471">Q2</a></span><span class="op" id="2282772">+</span><span class="ident" id="2282773"><a href="/math/expm1.go.html#2282731">hxs</a></span><span class="op" id="2282776">*</span><span class="op" id="2282777">(</span><span class="ident" id="2282778"><a href="/math/expm1.go.html#2281528">Q3</a></span><span class="op" id="2282780">+</span><span class="ident" id="2282781"><a href="/math/expm1.go.html#2282731">hxs</a></span><span class="op" id="2282784">*</span><span class="op" id="2282785">(</span><span class="ident" id="2282786"><a href="/math/expm1.go.html#2281585">Q4</a></span><span class="op" id="2282788">+</span><span class="ident" id="2282789"><a href="/math/expm1.go.html#2282731">hxs</a></span><span class="op" id="2282792">*</span><span class="ident" id="2282793"><a href="/math/expm1.go.html#2281642">Q5</a></span><span class="op" id="2282795">)</span><span class="op" id="2282796">)</span><span class="op" id="2282797">)</span><span class="op" id="2282798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282801">t</span>&nbsp;<span class="op" id="2282803">:=</span>&nbsp;<span class="num" id="2282806">3</span>&nbsp;<span class="op" id="2282808">-</span>&nbsp;<span class="ident" id="2282810"><a href="/math/expm1.go.html#2282747">r1</a></span><span class="op" id="2282812">*</span><span class="ident" id="2282813"><a href="/math/expm1.go.html#2282715">hfx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282818">e</span>&nbsp;<span class="op" id="2282820">:=</span>&nbsp;<span class="ident" id="2282823"><a href="/math/expm1.go.html#2282731">hxs</a></span>&nbsp;<span class="op" id="2282827">*</span>&nbsp;<span class="op" id="2282829">(</span><span class="op" id="2282830">(</span><span class="ident" id="2282831"><a href="/math/expm1.go.html#2282747">r1</a></span>&nbsp;<span class="op" id="2282834">-</span>&nbsp;<span class="ident" id="2282836"><a href="/math/expm1.go.html#2282801">t</a></span><span class="op" id="2282837">)</span>&nbsp;<span class="op" id="2282839">/</span>&nbsp;<span class="op" id="2282841">(</span><span class="num" id="2282842">6.0</span>&nbsp;<span class="op" id="2282846">-</span>&nbsp;<span class="ident" id="2282848"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2282849">*</span><span class="ident" id="2282850"><a href="/math/expm1.go.html#2282801">t</a></span><span class="op" id="2282851">)</span><span class="op" id="2282852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282855">if</span>&nbsp;<span class="ident" id="2282858"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282860">!=</span>&nbsp;<span class="num" id="2282863">0</span>&nbsp;<span class="op" id="2282865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282869"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2282871">=</span>&nbsp;<span class="op" id="2282873">(</span><span class="ident" id="2282874"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2282875">*</span><span class="op" id="2282876">(</span><span class="ident" id="2282877"><a href="/math/expm1.go.html#2282818">e</a></span><span class="op" id="2282878">-</span><span class="ident" id="2282879"><a href="/math/expm1.go.html#2282121">c</a></span><span class="op" id="2282880">)</span>&nbsp;<span class="op" id="2282882">-</span>&nbsp;<span class="ident" id="2282884"><a href="/math/expm1.go.html#2282121">c</a></span><span class="op" id="2282885">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282889"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2282891">-=</span>&nbsp;<span class="ident" id="2282894"><a href="/math/expm1.go.html#2282731">hxs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282900">switch</span>&nbsp;<span class="op" id="2282907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282911">case</span>&nbsp;<span class="ident" id="2282916"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282918">==</span>&nbsp;<span class="op" id="2282921">-</span><span class="num" id="2282922">1</span><span class="op" id="2282923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282928">return</span>&nbsp;<span class="num" id="2282935">0.5</span><span class="op" id="2282938">*</span><span class="op" id="2282939">(</span><span class="ident" id="2282940"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2282941">-</span><span class="ident" id="2282942"><a href="/math/expm1.go.html#2282818">e</a></span><span class="op" id="2282943">)</span>&nbsp;<span class="op" id="2282945">-</span>&nbsp;<span class="num" id="2282947">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282953">case</span>&nbsp;<span class="ident" id="2282958"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2282960">==</span>&nbsp;<span class="num" id="2282963">1</span><span class="op" id="2282964">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282969">if</span>&nbsp;<span class="ident" id="2282972"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2282974">&lt;</span>&nbsp;<span class="op" id="2282976">-</span><span class="num" id="2282977">0.25</span>&nbsp;<span class="op" id="2282982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282988">return</span>&nbsp;<span class="op" id="2282995">-</span><span class="num" id="2282996">2</span>&nbsp;<span class="op" id="2282998">*</span>&nbsp;<span class="op" id="2283000">(</span><span class="ident" id="2283001"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2283003">-</span>&nbsp;<span class="op" id="2283005">(</span><span class="ident" id="2283006"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2283008">+</span>&nbsp;<span class="num" id="2283010">0.5</span><span class="op" id="2283013">)</span><span class="op" id="2283014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283024">return</span>&nbsp;<span class="num" id="2283031">1</span>&nbsp;<span class="op" id="2283033">+</span>&nbsp;<span class="num" id="2283035">2</span><span class="op" id="2283036">*</span><span class="op" id="2283037">(</span><span class="ident" id="2283038"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2283039">-</span><span class="ident" id="2283040"><a href="/math/expm1.go.html#2282818">e</a></span><span class="op" id="2283041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283045">case</span>&nbsp;<span class="ident" id="2283050"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2283052">&lt;=</span>&nbsp;<span class="op" id="2283055">-</span><span class="num" id="2283056">2</span>&nbsp;<span class="op" id="2283058">||</span>&nbsp;<span class="ident" id="2283061"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2283063">&gt;</span>&nbsp;<span class="num" id="2283065">56</span><span class="op" id="2283067">:</span>&nbsp;<span class="comment" id="2283069">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283102">y</span>&nbsp;<span class="op" id="2283104">:=</span>&nbsp;<span class="num" id="2283107">1</span>&nbsp;<span class="op" id="2283109">-</span>&nbsp;<span class="op" id="2283111">(</span><span class="ident" id="2283112"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2283114">-</span>&nbsp;<span class="ident" id="2283116"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2283117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283122"><a href="/math/expm1.go.html#2283102">y</a></span>&nbsp;<span class="op" id="2283124">=</span>&nbsp;<span class="ident" id="2283126"><a href="/math/unsafe.go.html#2380889">Float64frombits</a></span><span class="op" id="2283141">(</span><span class="ident" id="2283142"><a href="/math/unsafe.go.html#2380703">Float64bits</a></span><span class="op" id="2283153">(</span><span class="ident" id="2283154"><a href="/math/expm1.go.html#2283102">y</a></span><span class="op" id="2283155">)</span>&nbsp;<span class="op" id="2283157">+</span>&nbsp;<span class="ident" id="2283159">uint64</span><span class="op" id="2283165">(</span><span class="ident" id="2283166"><a href="/math/expm1.go.html#2282136">k</a></span><span class="op" id="2283167">)</span><span class="op" id="2283168">&lt;&lt;</span><span class="num" id="2283170">52</span><span class="op" id="2283172">)</span>&nbsp;<span class="comment" id="2283174">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283202">return</span>&nbsp;<span class="ident" id="2283209"><a href="/math/expm1.go.html#2283102">y</a></span>&nbsp;<span class="op" id="2283211">-</span>&nbsp;<span class="num" id="2283213">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283221">if</span>&nbsp;<span class="ident" id="2283224"><a href="/math/expm1.go.html#2282136">k</a></span>&nbsp;<span class="op" id="2283226">&lt;</span>&nbsp;<span class="num" id="2283228">20</span>&nbsp;<span class="op" id="2283231">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283236">t</span>&nbsp;<span class="op" id="2283238">:=</span>&nbsp;<span class="ident" id="2283241"><a href="/math/unsafe.go.html#2380889">Float64frombits</a></span><span class="op" id="2283256">(</span><span class="num" id="2283257">0x3ff0000000000000</span>&nbsp;<span class="op" id="2283276">-</span>&nbsp;<span class="op" id="2283278">(</span><span class="num" id="2283279">0x20000000000000</span>&nbsp;<span class="op" id="2283296">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2283299">uint</span><span class="op" id="2283303">(</span><span class="ident" id="2283304"><a href="/math/expm1.go.html#2282136">k</a></span><span class="op" id="2283305">)</span><span class="op" id="2283306">)</span><span class="op" id="2283307">)</span>&nbsp;<span class="comment" id="2283309">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283325">y</span>&nbsp;<span class="op" id="2283327">:=</span>&nbsp;<span class="ident" id="2283330"><a href="/math/expm1.go.html#2283236">t</a></span>&nbsp;<span class="op" id="2283332">-</span>&nbsp;<span class="op" id="2283334">(</span><span class="ident" id="2283335"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2283337">-</span>&nbsp;<span class="ident" id="2283339"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2283340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283345"><a href="/math/expm1.go.html#2283325">y</a></span>&nbsp;<span class="op" id="2283347">=</span>&nbsp;<span class="ident" id="2283349"><a href="/math/unsafe.go.html#2380889">Float64frombits</a></span><span class="op" id="2283364">(</span><span class="ident" id="2283365"><a href="/math/unsafe.go.html#2380703">Float64bits</a></span><span class="op" id="2283376">(</span><span class="ident" id="2283377"><a href="/math/expm1.go.html#2283325">y</a></span><span class="op" id="2283378">)</span>&nbsp;<span class="op" id="2283380">+</span>&nbsp;<span class="ident" id="2283382">uint64</span><span class="op" id="2283388">(</span><span class="ident" id="2283389"><a href="/math/expm1.go.html#2282136">k</a></span><span class="op" id="2283390">)</span><span class="op" id="2283391">&lt;&lt;</span><span class="num" id="2283393">52</span><span class="op" id="2283395">)</span>&nbsp;<span class="comment" id="2283397">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283425">return</span>&nbsp;<span class="ident" id="2283432"><a href="/math/expm1.go.html#2283325">y</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283436">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283440">t</span>&nbsp;<span class="op" id="2283442">:=</span>&nbsp;<span class="ident" id="2283445"><a href="/math/unsafe.go.html#2380889">Float64frombits</a></span><span class="op" id="2283460">(</span><span class="ident" id="2283461">uint64</span><span class="op" id="2283467">(</span><span class="op" id="2283468">(</span><span class="num" id="2283469">0x3ff</span>&nbsp;<span class="op" id="2283475">-</span>&nbsp;<span class="ident" id="2283477"><a href="/math/expm1.go.html#2282136">k</a></span><span class="op" id="2283478">)</span>&nbsp;<span class="op" id="2283480">&lt;&lt;</span>&nbsp;<span class="num" id="2283483">52</span><span class="op" id="2283485">)</span><span class="op" id="2283486">)</span>&nbsp;<span class="comment" id="2283488">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283499">y</span>&nbsp;<span class="op" id="2283501">:=</span>&nbsp;<span class="ident" id="2283504"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2283506">-</span>&nbsp;<span class="op" id="2283508">(</span><span class="ident" id="2283509"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2283511">+</span>&nbsp;<span class="ident" id="2283513"><a href="/math/expm1.go.html#2283440">t</a></span><span class="op" id="2283514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283518"><a href="/math/expm1.go.html#2283499">y</a></span>&nbsp;<span class="op" id="2283520">+=</span>&nbsp;<span class="num" id="2283523">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283527"><a href="/math/expm1.go.html#2283499">y</a></span>&nbsp;<span class="op" id="2283529">=</span>&nbsp;<span class="ident" id="2283531"><a href="/math/unsafe.go.html#2380889">Float64frombits</a></span><span class="op" id="2283546">(</span><span class="ident" id="2283547"><a href="/math/unsafe.go.html#2380703">Float64bits</a></span><span class="op" id="2283558">(</span><span class="ident" id="2283559"><a href="/math/expm1.go.html#2283499">y</a></span><span class="op" id="2283560">)</span>&nbsp;<span class="op" id="2283562">+</span>&nbsp;<span class="ident" id="2283564">uint64</span><span class="op" id="2283570">(</span><span class="ident" id="2283571"><a href="/math/expm1.go.html#2282136">k</a></span><span class="op" id="2283572">)</span><span class="op" id="2283573">&lt;&lt;</span><span class="num" id="2283575">52</span><span class="op" id="2283577">)</span>&nbsp;<span class="comment" id="2283579">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283606">return</span>&nbsp;<span class="ident" id="2283613"><a href="/math/expm1.go.html#2283499">y</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283619">return</span>&nbsp;<span class="ident" id="2283626"><a href="/math/expm1.go.html#2280819">x</a></span>&nbsp;<span class="op" id="2283628">-</span>&nbsp;<span class="op" id="2283630">(</span><span class="ident" id="2283631"><a href="/math/expm1.go.html#2280819">x</a></span><span class="op" id="2283632">*</span><span class="ident" id="2283633"><a href="/math/expm1.go.html#2282818">e</a></span>&nbsp;<span class="op" id="2283635">-</span>&nbsp;<span class="ident" id="2283637"><a href="/math/expm1.go.html#2282731">hxs</a></span><span class="op" id="2283640">)</span>&nbsp;<span class="comment" id="2283642">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2283652">}</span>
</div>
</body>
</html>
