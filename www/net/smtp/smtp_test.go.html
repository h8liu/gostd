<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7097872">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7097927">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7097981">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7098032">package</span>&nbsp;<span class="ident" id="7098040">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7098046">import</span>&nbsp;<span class="op" id="7098053">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098056">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098065">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098074">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098088">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098103">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098109">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098116">&#34;net/textproto&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098133">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098144">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7098155">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7098162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7098165">type</span>&nbsp;<span class="ident" id="7098170">authTest</span>&nbsp;<span class="keyword" id="7098179">struct</span>&nbsp;<span class="op" id="7098186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098189">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7098200"><a href="/net/smtp/auth.go.html#6328425">Auth</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098206">challenges</span>&nbsp;<span class="op" id="7098217">[</span><span class="op" id="7098218">]</span><span class="builtintype" id="7098219">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098227">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7098238">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098246">responses</span>&nbsp;&nbsp;<span class="op" id="7098257">[</span><span class="op" id="7098258">]</span><span class="builtintype" id="7098259">string</span><br>
<span class="lineno">25</span><span class="op" id="7098266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7098269">var</span>&nbsp;<span class="ident" id="7098273">authTests</span>&nbsp;<span class="op" id="7098283">=</span>&nbsp;<span class="op" id="7098285">[</span><span class="op" id="7098286">]</span><span class="ident" id="7098287"><a href="/net/smtp/smtp_test.go.html#7098170">authTest</a></span><span class="op" id="7098295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098298">{</span><span class="ident" id="7098299"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7098308">(</span><span class="string" id="7098309">&#34;&#34;</span><span class="op" id="7098311">,</span>&nbsp;<span class="string" id="7098313">&#34;user&#34;</span><span class="op" id="7098319">,</span>&nbsp;<span class="string" id="7098321">&#34;pass&#34;</span><span class="op" id="7098327">,</span>&nbsp;<span class="string" id="7098329">&#34;testserver&#34;</span><span class="op" id="7098341">)</span><span class="op" id="7098342">,</span>&nbsp;<span class="op" id="7098344">[</span><span class="op" id="7098345">]</span><span class="builtintype" id="7098346">string</span><span class="op" id="7098352">{</span><span class="op" id="7098353">}</span><span class="op" id="7098354">,</span>&nbsp;<span class="string" id="7098356">&#34;PLAIN&#34;</span><span class="op" id="7098363">,</span>&nbsp;<span class="op" id="7098365">[</span><span class="op" id="7098366">]</span><span class="builtintype" id="7098367">string</span><span class="op" id="7098373">{</span><span class="string" id="7098374">&#34;\x00user\x00pass&#34;</span><span class="op" id="7098392">}</span><span class="op" id="7098393">}</span><span class="op" id="7098394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098397">{</span><span class="ident" id="7098398"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7098407">(</span><span class="string" id="7098408">&#34;foo&#34;</span><span class="op" id="7098413">,</span>&nbsp;<span class="string" id="7098415">&#34;bar&#34;</span><span class="op" id="7098420">,</span>&nbsp;<span class="string" id="7098422">&#34;baz&#34;</span><span class="op" id="7098427">,</span>&nbsp;<span class="string" id="7098429">&#34;testserver&#34;</span><span class="op" id="7098441">)</span><span class="op" id="7098442">,</span>&nbsp;<span class="op" id="7098444">[</span><span class="op" id="7098445">]</span><span class="builtintype" id="7098446">string</span><span class="op" id="7098452">{</span><span class="op" id="7098453">}</span><span class="op" id="7098454">,</span>&nbsp;<span class="string" id="7098456">&#34;PLAIN&#34;</span><span class="op" id="7098463">,</span>&nbsp;<span class="op" id="7098465">[</span><span class="op" id="7098466">]</span><span class="builtintype" id="7098467">string</span><span class="op" id="7098473">{</span><span class="string" id="7098474">&#34;foo\x00bar\x00baz&#34;</span><span class="op" id="7098493">}</span><span class="op" id="7098494">}</span><span class="op" id="7098495">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098498">{</span><span class="ident" id="7098499"><a href="/net/smtp/auth.go.html#6331057">CRAMMD5Auth</a></span><span class="op" id="7098510">(</span><span class="string" id="7098511">&#34;user&#34;</span><span class="op" id="7098517">,</span>&nbsp;<span class="string" id="7098519">&#34;pass&#34;</span><span class="op" id="7098525">)</span><span class="op" id="7098526">,</span>&nbsp;<span class="op" id="7098528">[</span><span class="op" id="7098529">]</span><span class="builtintype" id="7098530">string</span><span class="op" id="7098536">{</span><span class="string" id="7098537">&#34;&lt;123456.1322876914@testserver&gt;&#34;</span><span class="op" id="7098569">}</span><span class="op" id="7098570">,</span>&nbsp;<span class="string" id="7098572">&#34;CRAM-MD5&#34;</span><span class="op" id="7098582">,</span>&nbsp;<span class="op" id="7098584">[</span><span class="op" id="7098585">]</span><span class="builtintype" id="7098586">string</span><span class="op" id="7098592">{</span><span class="string" id="7098593">&#34;&#34;</span><span class="op" id="7098595">,</span>&nbsp;<span class="string" id="7098597">&#34;user&nbsp;287eb355114cf5c471c26a875f1ca4ae&#34;</span><span class="op" id="7098636">}</span><span class="op" id="7098637">}</span><span class="op" id="7098638">,</span><br>
<span class="lineno"></span><span class="op" id="7098640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7098643">func</span>&nbsp;<span class="ident" id="7098648">TestAuth</span><span class="op" id="7098656">(</span><span class="ident" id="7098657">t</span>&nbsp;<span class="op" id="7098659">*</span><span class="ident" id="7098660"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7098667">.</span><span class="ident" id="7098668">T</span><span class="op" id="7098669">)</span>&nbsp;<span class="op" id="7098671">{</span><br>
<span class="lineno"></span><span class="ident" id="7098673">testLoop</span><span class="op" id="7098681">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098684">for</span>&nbsp;<span class="ident" id="7098688">i</span><span class="op" id="7098689">,</span>&nbsp;<span class="ident" id="7098691">test</span>&nbsp;<span class="op" id="7098696">:=</span>&nbsp;<span class="keyword" id="7098699">range</span>&nbsp;<span class="ident" id="7098705"><a href="/net/smtp/smtp_test.go.html#7098273">authTests</a></span>&nbsp;<span class="op" id="7098715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098719">name</span><span class="op" id="7098723">,</span>&nbsp;<span class="ident" id="7098725">resp</span><span class="op" id="7098729">,</span>&nbsp;<span class="ident" id="7098731">err</span>&nbsp;<span class="op" id="7098735">:=</span>&nbsp;<span class="ident" id="7098738"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7098742">.</span><span class="ident" id="7098743">auth</span><span class="op" id="7098747">.</span><span class="ident" id="7098748">Start</span><span class="op" id="7098753">(</span><span class="op" id="7098754">&amp;</span><span class="ident" id="7098755"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="7098765">{</span><span class="string" id="7098766">&#34;testserver&#34;</span><span class="op" id="7098778">,</span>&nbsp;<span class="builtintype" id="7098780">true</span><span class="op" id="7098784">,</span>&nbsp;<span class="ident" id="7098786">nil</span><span class="op" id="7098789">}</span><span class="op" id="7098790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098794">if</span>&nbsp;<span class="ident" id="7098797"><a href="/net/smtp/smtp_test.go.html#7098719">name</a></span>&nbsp;<span class="op" id="7098802">!=</span>&nbsp;<span class="ident" id="7098805"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7098809">.</span><span class="ident" id="7098810">name</span>&nbsp;<span class="op" id="7098815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098820"><a href="/net/smtp/smtp_test.go.html#7098657">t</a></span><span class="op" id="7098821">.</span><span class="ident" id="7098822">Errorf</span><span class="op" id="7098828">(</span><span class="string" id="7098829">&#34;#%d&nbsp;got&nbsp;name&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7098859">,</span>&nbsp;<span class="ident" id="7098861"><a href="/net/smtp/smtp_test.go.html#7098688">i</a></span><span class="op" id="7098862">,</span>&nbsp;<span class="ident" id="7098864"><a href="/net/smtp/smtp_test.go.html#7098719">name</a></span><span class="op" id="7098868">,</span>&nbsp;<span class="ident" id="7098870"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7098874">.</span><span class="ident" id="7098875">name</span><span class="op" id="7098879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098883">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098887">if</span>&nbsp;<span class="op" id="7098890">!</span><span class="ident" id="7098891"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7098896">.</span><span class="ident" id="7098897">Equal</span><span class="op" id="7098902">(</span><span class="ident" id="7098903"><a href="/net/smtp/smtp_test.go.html#7098725">resp</a></span><span class="op" id="7098907">,</span>&nbsp;<span class="op" id="7098909">[</span><span class="op" id="7098910">]</span><span class="builtintype" id="7098911">byte</span><span class="op" id="7098915">(</span><span class="ident" id="7098916"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7098920">.</span><span class="ident" id="7098921">responses</span><span class="op" id="7098930">[</span><span class="num" id="7098931">0</span><span class="op" id="7098932">]</span><span class="op" id="7098933">)</span><span class="op" id="7098934">)</span>&nbsp;<span class="op" id="7098936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098941"><a href="/net/smtp/smtp_test.go.html#7098657">t</a></span><span class="op" id="7098942">.</span><span class="ident" id="7098943">Errorf</span><span class="op" id="7098949">(</span><span class="string" id="7098950">&#34;#%d&nbsp;got&nbsp;response&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7098984">,</span>&nbsp;<span class="ident" id="7098986"><a href="/net/smtp/smtp_test.go.html#7098688">i</a></span><span class="op" id="7098987">,</span>&nbsp;<span class="ident" id="7098989"><a href="/net/smtp/smtp_test.go.html#7098725">resp</a></span><span class="op" id="7098993">,</span>&nbsp;<span class="ident" id="7098995"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7098999">.</span><span class="ident" id="7099000">responses</span><span class="op" id="7099009">[</span><span class="num" id="7099010">0</span><span class="op" id="7099011">]</span><span class="op" id="7099012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099020">if</span>&nbsp;<span class="ident" id="7099023"><a href="/net/smtp/smtp_test.go.html#7098731">err</a></span>&nbsp;<span class="op" id="7099027">!=</span>&nbsp;<span class="ident" id="7099030">nil</span>&nbsp;<span class="op" id="7099034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099039"><a href="/net/smtp/smtp_test.go.html#7098657">t</a></span><span class="op" id="7099040">.</span><span class="ident" id="7099041">Errorf</span><span class="op" id="7099047">(</span><span class="string" id="7099048">&#34;#%d&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7099063">,</span>&nbsp;<span class="ident" id="7099065"><a href="/net/smtp/smtp_test.go.html#7098688">i</a></span><span class="op" id="7099066">,</span>&nbsp;<span class="ident" id="7099068"><a href="/net/smtp/smtp_test.go.html#7098731">err</a></span><span class="op" id="7099071">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099079">for</span>&nbsp;<span class="ident" id="7099083">j</span>&nbsp;<span class="op" id="7099085">:=</span>&nbsp;<span class="keyword" id="7099088">range</span>&nbsp;<span class="ident" id="7099094"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7099098">.</span><span class="ident" id="7099099">challenges</span>&nbsp;<span class="op" id="7099110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099115">challenge</span>&nbsp;<span class="op" id="7099125">:=</span>&nbsp;<span class="op" id="7099128">[</span><span class="op" id="7099129">]</span><span class="builtintype" id="7099130">byte</span><span class="op" id="7099134">(</span><span class="ident" id="7099135"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7099139">.</span><span class="ident" id="7099140">challenges</span><span class="op" id="7099150">[</span><span class="ident" id="7099151"><a href="/net/smtp/smtp_test.go.html#7099083">j</a></span><span class="op" id="7099152">]</span><span class="op" id="7099153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099158">expected</span>&nbsp;<span class="op" id="7099167">:=</span>&nbsp;<span class="op" id="7099170">[</span><span class="op" id="7099171">]</span><span class="builtintype" id="7099172">byte</span><span class="op" id="7099176">(</span><span class="ident" id="7099177"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7099181">.</span><span class="ident" id="7099182">responses</span><span class="op" id="7099191">[</span><span class="ident" id="7099192"><a href="/net/smtp/smtp_test.go.html#7099083">j</a></span><span class="op" id="7099193">+</span><span class="num" id="7099194">1</span><span class="op" id="7099195">]</span><span class="op" id="7099196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099201">resp</span><span class="op" id="7099205">,</span>&nbsp;<span class="ident" id="7099207">err</span>&nbsp;<span class="op" id="7099211">:=</span>&nbsp;<span class="ident" id="7099214"><a href="/net/smtp/smtp_test.go.html#7098691">test</a></span><span class="op" id="7099218">.</span><span class="ident" id="7099219">auth</span><span class="op" id="7099223">.</span><span class="ident" id="7099224">Next</span><span class="op" id="7099228">(</span><span class="ident" id="7099229"><a href="/net/smtp/smtp_test.go.html#7099115">challenge</a></span><span class="op" id="7099238">,</span>&nbsp;<span class="builtintype" id="7099240">true</span><span class="op" id="7099244">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099249">if</span>&nbsp;<span class="ident" id="7099252"><a href="/net/smtp/smtp_test.go.html#7099207">err</a></span>&nbsp;<span class="op" id="7099256">!=</span>&nbsp;<span class="ident" id="7099259">nil</span>&nbsp;<span class="op" id="7099263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099269"><a href="/net/smtp/smtp_test.go.html#7098657">t</a></span><span class="op" id="7099270">.</span><span class="ident" id="7099271">Errorf</span><span class="op" id="7099277">(</span><span class="string" id="7099278">&#34;#%d&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7099293">,</span>&nbsp;<span class="ident" id="7099295"><a href="/net/smtp/smtp_test.go.html#7098688">i</a></span><span class="op" id="7099296">,</span>&nbsp;<span class="ident" id="7099298"><a href="/net/smtp/smtp_test.go.html#7099207">err</a></span><span class="op" id="7099301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099307">continue</span>&nbsp;<span class="ident" id="7099316">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099333">if</span>&nbsp;<span class="op" id="7099336">!</span><span class="ident" id="7099337"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7099342">.</span><span class="ident" id="7099343">Equal</span><span class="op" id="7099348">(</span><span class="ident" id="7099349"><a href="/net/smtp/smtp_test.go.html#7099201">resp</a></span><span class="op" id="7099353">,</span>&nbsp;<span class="ident" id="7099355"><a href="/net/smtp/smtp_test.go.html#7099158">expected</a></span><span class="op" id="7099363">)</span>&nbsp;<span class="op" id="7099365">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099371"><a href="/net/smtp/smtp_test.go.html#7098657">t</a></span><span class="op" id="7099372">.</span><span class="ident" id="7099373">Errorf</span><span class="op" id="7099379">(</span><span class="string" id="7099380">&#34;#%d&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7099405">,</span>&nbsp;<span class="ident" id="7099407"><a href="/net/smtp/smtp_test.go.html#7098688">i</a></span><span class="op" id="7099408">,</span>&nbsp;<span class="ident" id="7099410"><a href="/net/smtp/smtp_test.go.html#7099201">resp</a></span><span class="op" id="7099414">,</span>&nbsp;<span class="ident" id="7099416"><a href="/net/smtp/smtp_test.go.html#7099158">expected</a></span><span class="op" id="7099424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099430">continue</span>&nbsp;<span class="ident" id="7099439">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099458">}</span><br>
<span class="lineno">60</span><span class="op" id="7099460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7099463">func</span>&nbsp;<span class="ident" id="7099468">TestAuthPlain</span><span class="op" id="7099481">(</span><span class="ident" id="7099482">t</span>&nbsp;<span class="op" id="7099484">*</span><span class="ident" id="7099485"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7099492">.</span><span class="ident" id="7099493">T</span><span class="op" id="7099494">)</span>&nbsp;<span class="op" id="7099496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099499">auth</span>&nbsp;<span class="op" id="7099504">:=</span>&nbsp;<span class="ident" id="7099507"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7099516">(</span><span class="string" id="7099517">&#34;foo&#34;</span><span class="op" id="7099522">,</span>&nbsp;<span class="string" id="7099524">&#34;bar&#34;</span><span class="op" id="7099529">,</span>&nbsp;<span class="string" id="7099531">&#34;baz&#34;</span><span class="op" id="7099536">,</span>&nbsp;<span class="string" id="7099538">&#34;servername&#34;</span><span class="op" id="7099550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099554">tests</span>&nbsp;<span class="op" id="7099560">:=</span>&nbsp;<span class="op" id="7099563">[</span><span class="op" id="7099564">]</span><span class="keyword" id="7099565">struct</span>&nbsp;<span class="op" id="7099572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099576">server</span>&nbsp;<span class="op" id="7099583">*</span><span class="ident" id="7099584"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099597">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7099604">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099612">}</span><span class="op" id="7099613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099617">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099622">server</span><span class="op" id="7099628">:</span>&nbsp;<span class="op" id="7099630">&amp;</span><span class="ident" id="7099631"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="7099641">{</span><span class="ident" id="7099642">Name</span><span class="op" id="7099646">:</span>&nbsp;<span class="string" id="7099648">&#34;servername&#34;</span><span class="op" id="7099660">,</span>&nbsp;<span class="ident" id="7099662">TLS</span><span class="op" id="7099665">:</span>&nbsp;<span class="builtintype" id="7099667">true</span><span class="op" id="7099671">}</span><span class="op" id="7099672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099676">}</span><span class="op" id="7099677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099686">//&nbsp;Okay;&nbsp;explicitly&nbsp;advertised&nbsp;by&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099731">server</span><span class="op" id="7099737">:</span>&nbsp;<span class="op" id="7099739">&amp;</span><span class="ident" id="7099740"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="7099750">{</span><span class="ident" id="7099751">Name</span><span class="op" id="7099755">:</span>&nbsp;<span class="string" id="7099757">&#34;servername&#34;</span><span class="op" id="7099769">,</span>&nbsp;<span class="ident" id="7099771">Auth</span><span class="op" id="7099775">:</span>&nbsp;<span class="op" id="7099777">[</span><span class="op" id="7099778">]</span><span class="builtintype" id="7099779">string</span><span class="op" id="7099785">{</span><span class="string" id="7099786">&#34;PLAIN&#34;</span><span class="op" id="7099793">}</span><span class="op" id="7099794">}</span><span class="op" id="7099795">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099799">}</span><span class="op" id="7099800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099809">server</span><span class="op" id="7099815">:</span>&nbsp;<span class="op" id="7099817">&amp;</span><span class="ident" id="7099818"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="7099828">{</span><span class="ident" id="7099829">Name</span><span class="op" id="7099833">:</span>&nbsp;<span class="string" id="7099835">&#34;servername&#34;</span><span class="op" id="7099847">,</span>&nbsp;<span class="ident" id="7099849">Auth</span><span class="op" id="7099853">:</span>&nbsp;<span class="op" id="7099855">[</span><span class="op" id="7099856">]</span><span class="builtintype" id="7099857">string</span><span class="op" id="7099863">{</span><span class="string" id="7099864">&#34;CRAM-MD5&#34;</span><span class="op" id="7099874">}</span><span class="op" id="7099875">}</span><span class="op" id="7099876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099881">err</span><span class="op" id="7099884">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7099889">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="7099913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099917">}</span><span class="op" id="7099918">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099927">server</span><span class="op" id="7099933">:</span>&nbsp;<span class="op" id="7099935">&amp;</span><span class="ident" id="7099936"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="7099946">{</span><span class="ident" id="7099947">Name</span><span class="op" id="7099951">:</span>&nbsp;<span class="string" id="7099953">&#34;attacker&#34;</span><span class="op" id="7099963">,</span>&nbsp;<span class="ident" id="7099965">TLS</span><span class="op" id="7099968">:</span>&nbsp;<span class="builtintype" id="7099970">true</span><span class="op" id="7099974">}</span><span class="op" id="7099975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099980">err</span><span class="op" id="7099983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7099988">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="7100005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100009">}</span><span class="op" id="7100010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100013">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100016">for</span>&nbsp;<span class="ident" id="7100020">i</span><span class="op" id="7100021">,</span>&nbsp;<span class="ident" id="7100023">tt</span>&nbsp;<span class="op" id="7100026">:=</span>&nbsp;<span class="keyword" id="7100029">range</span>&nbsp;<span class="ident" id="7100035"><a href="/net/smtp/smtp_test.go.html#7099554">tests</a></span>&nbsp;<span class="op" id="7100041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100045">_</span><span class="op" id="7100046">,</span>&nbsp;<span class="ident" id="7100048">_</span><span class="op" id="7100049">,</span>&nbsp;<span class="ident" id="7100051">err</span>&nbsp;<span class="op" id="7100055">:=</span>&nbsp;<span class="ident" id="7100058"><a href="/net/smtp/smtp_test.go.html#7099499">auth</a></span><span class="op" id="7100062">.</span><span class="ident" id="7100063">Start</span><span class="op" id="7100068">(</span><span class="ident" id="7100069"><a href="/net/smtp/smtp_test.go.html#7100023">tt</a></span><span class="op" id="7100071">.</span><span class="ident" id="7100072">server</span><span class="op" id="7100078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100082">got</span>&nbsp;<span class="op" id="7100086">:=</span>&nbsp;<span class="string" id="7100089">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100094">if</span>&nbsp;<span class="ident" id="7100097"><a href="/net/smtp/smtp_test.go.html#7100051">err</a></span>&nbsp;<span class="op" id="7100101">!=</span>&nbsp;<span class="ident" id="7100104">nil</span>&nbsp;<span class="op" id="7100108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100113"><a href="/net/smtp/smtp_test.go.html#7100082">got</a></span>&nbsp;<span class="op" id="7100117">=</span>&nbsp;<span class="ident" id="7100119"><a href="/net/smtp/smtp_test.go.html#7100051">err</a></span><span class="op" id="7100122">.</span><span class="ident" id="7100123">Error</span><span class="op" id="7100128">(</span><span class="op" id="7100129">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100137">if</span>&nbsp;<span class="ident" id="7100140"><a href="/net/smtp/smtp_test.go.html#7100082">got</a></span>&nbsp;<span class="op" id="7100144">!=</span>&nbsp;<span class="ident" id="7100147"><a href="/net/smtp/smtp_test.go.html#7100023">tt</a></span><span class="op" id="7100149">.</span><span class="ident" id="7100150">err</span>&nbsp;<span class="op" id="7100154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100159"><a href="/net/smtp/smtp_test.go.html#7099482">t</a></span><span class="op" id="7100160">.</span><span class="ident" id="7100161">Errorf</span><span class="op" id="7100167">(</span><span class="string" id="7100168">&#34;%d.&nbsp;got&nbsp;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7100197">,</span>&nbsp;<span class="ident" id="7100199"><a href="/net/smtp/smtp_test.go.html#7100020">i</a></span><span class="op" id="7100200">,</span>&nbsp;<span class="ident" id="7100202"><a href="/net/smtp/smtp_test.go.html#7100082">got</a></span><span class="op" id="7100205">,</span>&nbsp;<span class="ident" id="7100207"><a href="/net/smtp/smtp_test.go.html#7100023">tt</a></span><span class="op" id="7100209">.</span><span class="ident" id="7100210">err</span><span class="op" id="7100213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100220">}</span><br>
<span class="lineno">95</span><span class="op" id="7100222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7100225">type</span>&nbsp;<span class="ident" id="7100230">faker</span>&nbsp;<span class="keyword" id="7100236">struct</span>&nbsp;<span class="op" id="7100243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100246"><a href="/net/smtp/smtp_test.go.html#7098103">io</a></span><span class="op" id="7100248">.</span><span class="ident" id="7100249">ReadWriter</span><br>
<span class="lineno"></span><span class="op" id="7100260">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="7100263">func</span>&nbsp;<span class="op" id="7100268">(</span><span class="ident" id="7100269">f</span>&nbsp;<span class="ident" id="7100271"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><span class="op" id="7100276">)</span>&nbsp;<span class="ident" id="7100278">Close</span><span class="op" id="7100283">(</span><span class="op" id="7100284">)</span>&nbsp;<span class="builtintype" id="7100286">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100312">{</span>&nbsp;<span class="keyword" id="7100314">return</span>&nbsp;<span class="ident" id="7100321">nil</span>&nbsp;<span class="op" id="7100325">}</span><br>
<span class="lineno"></span><span class="keyword" id="7100327">func</span>&nbsp;<span class="op" id="7100332">(</span><span class="ident" id="7100333">f</span>&nbsp;<span class="ident" id="7100335"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><span class="op" id="7100340">)</span>&nbsp;<span class="ident" id="7100342">LocalAddr</span><span class="op" id="7100351">(</span><span class="op" id="7100352">)</span>&nbsp;<span class="ident" id="7100354"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7100357">.</span><span class="ident" id="7100358">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100376">{</span>&nbsp;<span class="keyword" id="7100378">return</span>&nbsp;<span class="ident" id="7100385">nil</span>&nbsp;<span class="op" id="7100389">}</span><br>
<span class="lineno"></span><span class="keyword" id="7100391">func</span>&nbsp;<span class="op" id="7100396">(</span><span class="ident" id="7100397">f</span>&nbsp;<span class="ident" id="7100399"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><span class="op" id="7100404">)</span>&nbsp;<span class="ident" id="7100406">RemoteAddr</span><span class="op" id="7100416">(</span><span class="op" id="7100417">)</span>&nbsp;<span class="ident" id="7100419"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7100422">.</span><span class="ident" id="7100423">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100440">{</span>&nbsp;<span class="keyword" id="7100442">return</span>&nbsp;<span class="ident" id="7100449">nil</span>&nbsp;<span class="op" id="7100453">}</span><br>
<span class="lineno"></span><span class="keyword" id="7100455">func</span>&nbsp;<span class="op" id="7100460">(</span><span class="ident" id="7100461">f</span>&nbsp;<span class="ident" id="7100463"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><span class="op" id="7100468">)</span>&nbsp;<span class="ident" id="7100470">SetDeadline</span><span class="op" id="7100481">(</span><span class="ident" id="7100482"><a href="/net/smtp/smtp_test.go.html#7098155">time</a></span><span class="op" id="7100486">.</span><span class="ident" id="7100487">Time</span><span class="op" id="7100491">)</span>&nbsp;<span class="builtintype" id="7100493">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7100504">{</span>&nbsp;<span class="keyword" id="7100506">return</span>&nbsp;<span class="ident" id="7100513">nil</span>&nbsp;<span class="op" id="7100517">}</span><br>
<span class="lineno">105</span><span class="keyword" id="7100519">func</span>&nbsp;<span class="op" id="7100524">(</span><span class="ident" id="7100525">f</span>&nbsp;<span class="ident" id="7100527"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><span class="op" id="7100532">)</span>&nbsp;<span class="ident" id="7100534">SetReadDeadline</span><span class="op" id="7100549">(</span><span class="ident" id="7100550"><a href="/net/smtp/smtp_test.go.html#7098155">time</a></span><span class="op" id="7100554">.</span><span class="ident" id="7100555">Time</span><span class="op" id="7100559">)</span>&nbsp;<span class="builtintype" id="7100561">error</span>&nbsp;&nbsp;<span class="op" id="7100568">{</span>&nbsp;<span class="keyword" id="7100570">return</span>&nbsp;<span class="ident" id="7100577">nil</span>&nbsp;<span class="op" id="7100581">}</span><br>
<span class="lineno"></span><span class="keyword" id="7100583">func</span>&nbsp;<span class="op" id="7100588">(</span><span class="ident" id="7100589">f</span>&nbsp;<span class="ident" id="7100591"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><span class="op" id="7100596">)</span>&nbsp;<span class="ident" id="7100598">SetWriteDeadline</span><span class="op" id="7100614">(</span><span class="ident" id="7100615"><a href="/net/smtp/smtp_test.go.html#7098155">time</a></span><span class="op" id="7100619">.</span><span class="ident" id="7100620">Time</span><span class="op" id="7100624">)</span>&nbsp;<span class="builtintype" id="7100626">error</span>&nbsp;<span class="op" id="7100632">{</span>&nbsp;<span class="keyword" id="7100634">return</span>&nbsp;<span class="ident" id="7100641">nil</span>&nbsp;<span class="op" id="7100645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7100648">func</span>&nbsp;<span class="ident" id="7100653">TestBasic</span><span class="op" id="7100662">(</span><span class="ident" id="7100663">t</span>&nbsp;<span class="op" id="7100665">*</span><span class="ident" id="7100666"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7100673">.</span><span class="ident" id="7100674">T</span><span class="op" id="7100675">)</span>&nbsp;<span class="op" id="7100677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100680">server</span>&nbsp;<span class="op" id="7100687">:=</span>&nbsp;<span class="ident" id="7100690"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7100697">.</span><span class="ident" id="7100698">Join</span><span class="op" id="7100702">(</span><span class="ident" id="7100703"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7100710">.</span><span class="ident" id="7100711">Split</span><span class="op" id="7100716">(</span><span class="ident" id="7100717"><a href="/net/smtp/smtp_test.go.html#7102811">basicServer</a></span><span class="op" id="7100728">,</span>&nbsp;<span class="string" id="7100730">&#34;\n&#34;</span><span class="op" id="7100734">)</span><span class="op" id="7100735">,</span>&nbsp;<span class="string" id="7100737">&#34;\r\n&#34;</span><span class="op" id="7100743">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100746">client</span>&nbsp;<span class="op" id="7100753">:=</span>&nbsp;<span class="ident" id="7100756"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7100763">.</span><span class="ident" id="7100764">Join</span><span class="op" id="7100768">(</span><span class="ident" id="7100769"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7100776">.</span><span class="ident" id="7100777">Split</span><span class="op" id="7100782">(</span><span class="ident" id="7100783"><a href="/net/smtp/smtp_test.go.html#7103137">basicClient</a></span><span class="op" id="7100794">,</span>&nbsp;<span class="string" id="7100796">&#34;\n&#34;</span><span class="op" id="7100800">)</span><span class="op" id="7100801">,</span>&nbsp;<span class="string" id="7100803">&#34;\r\n&#34;</span><span class="op" id="7100809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100813">var</span>&nbsp;<span class="ident" id="7100817">cmdbuf</span>&nbsp;<span class="ident" id="7100824"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7100829">.</span><span class="ident" id="7100830">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100838">bcmdbuf</span>&nbsp;<span class="op" id="7100846">:=</span>&nbsp;<span class="ident" id="7100849"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7100854">.</span><span class="ident" id="7100855">NewWriter</span><span class="op" id="7100864">(</span><span class="op" id="7100865">&amp;</span><span class="ident" id="7100866"><a href="/net/smtp/smtp_test.go.html#7100817">cmdbuf</a></span><span class="op" id="7100872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100875">var</span>&nbsp;<span class="ident" id="7100879">fake</span>&nbsp;<span class="ident" id="7100884"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100891"><a href="/net/smtp/smtp_test.go.html#7100879">fake</a></span><span class="op" id="7100895">.</span><span class="ident" id="7100896">ReadWriter</span>&nbsp;<span class="op" id="7100907">=</span>&nbsp;<span class="ident" id="7100909"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7100914">.</span><span class="ident" id="7100915">NewReadWriter</span><span class="op" id="7100928">(</span><span class="ident" id="7100929"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7100934">.</span><span class="ident" id="7100935">NewReader</span><span class="op" id="7100944">(</span><span class="ident" id="7100945"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7100952">.</span><span class="ident" id="7100953">NewReader</span><span class="op" id="7100962">(</span><span class="ident" id="7100963"><a href="/net/smtp/smtp_test.go.html#7100680">server</a></span><span class="op" id="7100969">)</span><span class="op" id="7100970">)</span><span class="op" id="7100971">,</span>&nbsp;<span class="ident" id="7100973"><a href="/net/smtp/smtp_test.go.html#7100838">bcmdbuf</a></span><span class="op" id="7100980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100983">c</span>&nbsp;<span class="op" id="7100985">:=</span>&nbsp;<span class="op" id="7100988">&amp;</span><span class="ident" id="7100989"><a href="/net/smtp/smtp.go.html#6332109">Client</a></span><span class="op" id="7100995">{</span><span class="ident" id="7100996">Text</span><span class="op" id="7101000">:</span>&nbsp;<span class="ident" id="7101002"><a href="/net/smtp/smtp_test.go.html#7098116">textproto</a></span><span class="op" id="7101011">.</span><span class="ident" id="7101012">NewConn</span><span class="op" id="7101019">(</span><span class="ident" id="7101020"><a href="/net/smtp/smtp_test.go.html#7100879">fake</a></span><span class="op" id="7101024">)</span><span class="op" id="7101025">,</span>&nbsp;<span class="ident" id="7101027">localName</span><span class="op" id="7101036">:</span>&nbsp;<span class="string" id="7101038">&#34;localhost&#34;</span><span class="op" id="7101049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101053">if</span>&nbsp;<span class="ident" id="7101056">err</span>&nbsp;<span class="op" id="7101060">:=</span>&nbsp;<span class="ident" id="7101063"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101064">.</span><span class="ident" id="7101065">helo</span><span class="op" id="7101069">(</span><span class="op" id="7101070">)</span><span class="op" id="7101071">;</span>&nbsp;<span class="ident" id="7101073"><a href="/net/smtp/smtp_test.go.html#7101056">err</a></span>&nbsp;<span class="op" id="7101077">!=</span>&nbsp;<span class="ident" id="7101080">nil</span>&nbsp;<span class="op" id="7101084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101088"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101089">.</span><span class="ident" id="7101090">Fatalf</span><span class="op" id="7101096">(</span><span class="string" id="7101097">&#34;HELO&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7101114">,</span>&nbsp;<span class="ident" id="7101116"><a href="/net/smtp/smtp_test.go.html#7101056">err</a></span><span class="op" id="7101119">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101125">if</span>&nbsp;<span class="ident" id="7101128">err</span>&nbsp;<span class="op" id="7101132">:=</span>&nbsp;<span class="ident" id="7101135"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101136">.</span><span class="ident" id="7101137">ehlo</span><span class="op" id="7101141">(</span><span class="op" id="7101142">)</span><span class="op" id="7101143">;</span>&nbsp;<span class="ident" id="7101145"><a href="/net/smtp/smtp_test.go.html#7101128">err</a></span>&nbsp;<span class="op" id="7101149">==</span>&nbsp;<span class="ident" id="7101152">nil</span>&nbsp;<span class="op" id="7101156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101160"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101161">.</span><span class="ident" id="7101162">Fatalf</span><span class="op" id="7101168">(</span><span class="string" id="7101169">&#34;Expected&nbsp;first&nbsp;EHLO&nbsp;to&nbsp;fail&#34;</span><span class="op" id="7101198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101204">if</span>&nbsp;<span class="ident" id="7101207">err</span>&nbsp;<span class="op" id="7101211">:=</span>&nbsp;<span class="ident" id="7101214"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101215">.</span><span class="ident" id="7101216">ehlo</span><span class="op" id="7101220">(</span><span class="op" id="7101221">)</span><span class="op" id="7101222">;</span>&nbsp;<span class="ident" id="7101224"><a href="/net/smtp/smtp_test.go.html#7101207">err</a></span>&nbsp;<span class="op" id="7101228">!=</span>&nbsp;<span class="ident" id="7101231">nil</span>&nbsp;<span class="op" id="7101235">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101239"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101240">.</span><span class="ident" id="7101241">Fatalf</span><span class="op" id="7101247">(</span><span class="string" id="7101248">&#34;Second&nbsp;EHLO&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7101272">,</span>&nbsp;<span class="ident" id="7101274"><a href="/net/smtp/smtp_test.go.html#7101207">err</a></span><span class="op" id="7101277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101284"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101285">.</span><span class="ident" id="7101286">didHello</span>&nbsp;<span class="op" id="7101295">=</span>&nbsp;<span class="builtintype" id="7101297">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101303">if</span>&nbsp;<span class="ident" id="7101306">ok</span><span class="op" id="7101308">,</span>&nbsp;<span class="ident" id="7101310">args</span>&nbsp;<span class="op" id="7101315">:=</span>&nbsp;<span class="ident" id="7101318"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101319">.</span><span class="ident" id="7101320">Extension</span><span class="op" id="7101329">(</span><span class="string" id="7101330">&#34;aUtH&#34;</span><span class="op" id="7101336">)</span><span class="op" id="7101337">;</span>&nbsp;<span class="op" id="7101339">!</span><span class="ident" id="7101340"><a href="/net/smtp/smtp_test.go.html#7101306">ok</a></span>&nbsp;<span class="op" id="7101343">||</span>&nbsp;<span class="ident" id="7101346"><a href="/net/smtp/smtp_test.go.html#7101310">args</a></span>&nbsp;<span class="op" id="7101351">!=</span>&nbsp;<span class="string" id="7101354">&#34;LOGIN&nbsp;PLAIN&#34;</span>&nbsp;<span class="op" id="7101368">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101372"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101373">.</span><span class="ident" id="7101374">Fatalf</span><span class="op" id="7101380">(</span><span class="string" id="7101381">&#34;Expected&nbsp;AUTH&nbsp;supported&#34;</span><span class="op" id="7101406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101412">if</span>&nbsp;<span class="ident" id="7101415">ok</span><span class="op" id="7101417">,</span>&nbsp;<span class="ident" id="7101419">_</span>&nbsp;<span class="op" id="7101421">:=</span>&nbsp;<span class="ident" id="7101424"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101425">.</span><span class="ident" id="7101426">Extension</span><span class="op" id="7101435">(</span><span class="string" id="7101436">&#34;DSN&#34;</span><span class="op" id="7101441">)</span><span class="op" id="7101442">;</span>&nbsp;<span class="ident" id="7101444"><a href="/net/smtp/smtp_test.go.html#7101415">ok</a></span>&nbsp;<span class="op" id="7101447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101451"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101452">.</span><span class="ident" id="7101453">Fatalf</span><span class="op" id="7101459">(</span><span class="string" id="7101460">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7101483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101486">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101490">if</span>&nbsp;<span class="ident" id="7101493">err</span>&nbsp;<span class="op" id="7101497">:=</span>&nbsp;<span class="ident" id="7101500"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101501">.</span><span class="ident" id="7101502">Mail</span><span class="op" id="7101506">(</span><span class="string" id="7101507">&#34;user@gmail.com&#34;</span><span class="op" id="7101523">)</span><span class="op" id="7101524">;</span>&nbsp;<span class="ident" id="7101526"><a href="/net/smtp/smtp_test.go.html#7101493">err</a></span>&nbsp;<span class="op" id="7101530">==</span>&nbsp;<span class="ident" id="7101533">nil</span>&nbsp;<span class="op" id="7101537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101541"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101542">.</span><span class="ident" id="7101543">Fatalf</span><span class="op" id="7101549">(</span><span class="string" id="7101550">&#34;MAIL&nbsp;should&nbsp;require&nbsp;authentication&#34;</span><span class="op" id="7101586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101593">if</span>&nbsp;<span class="ident" id="7101596">err</span>&nbsp;<span class="op" id="7101600">:=</span>&nbsp;<span class="ident" id="7101603"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101604">.</span><span class="ident" id="7101605">Verify</span><span class="op" id="7101611">(</span><span class="string" id="7101612">&#34;user1@gmail.com&#34;</span><span class="op" id="7101629">)</span><span class="op" id="7101630">;</span>&nbsp;<span class="ident" id="7101632"><a href="/net/smtp/smtp_test.go.html#7101596">err</a></span>&nbsp;<span class="op" id="7101636">==</span>&nbsp;<span class="ident" id="7101639">nil</span>&nbsp;<span class="op" id="7101643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101647"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101648">.</span><span class="ident" id="7101649">Fatalf</span><span class="op" id="7101655">(</span><span class="string" id="7101656">&#34;First&nbsp;VRFY:&nbsp;expected&nbsp;no&nbsp;verification&#34;</span><span class="op" id="7101694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101700">if</span>&nbsp;<span class="ident" id="7101703">err</span>&nbsp;<span class="op" id="7101707">:=</span>&nbsp;<span class="ident" id="7101710"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101711">.</span><span class="ident" id="7101712">Verify</span><span class="op" id="7101718">(</span><span class="string" id="7101719">&#34;user2@gmail.com&#34;</span><span class="op" id="7101736">)</span><span class="op" id="7101737">;</span>&nbsp;<span class="ident" id="7101739"><a href="/net/smtp/smtp_test.go.html#7101703">err</a></span>&nbsp;<span class="op" id="7101743">!=</span>&nbsp;<span class="ident" id="7101746">nil</span>&nbsp;<span class="op" id="7101750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101754"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101755">.</span><span class="ident" id="7101756">Fatalf</span><span class="op" id="7101762">(</span><span class="string" id="7101763">&#34;Second&nbsp;VRFY:&nbsp;expected&nbsp;verification,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7101807">,</span>&nbsp;<span class="ident" id="7101809"><a href="/net/smtp/smtp_test.go.html#7101703">err</a></span><span class="op" id="7101812">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7101819">//&nbsp;fake&nbsp;TLS&nbsp;so&nbsp;authentication&nbsp;won&#39;t&nbsp;complain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101865"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101866">.</span><span class="ident" id="7101867">tls</span>&nbsp;<span class="op" id="7101871">=</span>&nbsp;<span class="builtintype" id="7101873">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101879"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101880">.</span><span class="ident" id="7101881">serverName</span>&nbsp;<span class="op" id="7101892">=</span>&nbsp;<span class="string" id="7101894">&#34;smtp.google.com&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101913">if</span>&nbsp;<span class="ident" id="7101916">err</span>&nbsp;<span class="op" id="7101920">:=</span>&nbsp;<span class="ident" id="7101923"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7101924">.</span><span class="ident" id="7101925">Auth</span><span class="op" id="7101929">(</span><span class="ident" id="7101930"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7101939">(</span><span class="string" id="7101940">&#34;&#34;</span><span class="op" id="7101942">,</span>&nbsp;<span class="string" id="7101944">&#34;user&#34;</span><span class="op" id="7101950">,</span>&nbsp;<span class="string" id="7101952">&#34;pass&#34;</span><span class="op" id="7101958">,</span>&nbsp;<span class="string" id="7101960">&#34;smtp.google.com&#34;</span><span class="op" id="7101977">)</span><span class="op" id="7101978">)</span><span class="op" id="7101979">;</span>&nbsp;<span class="ident" id="7101981"><a href="/net/smtp/smtp_test.go.html#7101916">err</a></span>&nbsp;<span class="op" id="7101985">!=</span>&nbsp;<span class="ident" id="7101988">nil</span>&nbsp;<span class="op" id="7101992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101996"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7101997">.</span><span class="ident" id="7101998">Fatalf</span><span class="op" id="7102004">(</span><span class="string" id="7102005">&#34;AUTH&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7102022">,</span>&nbsp;<span class="ident" id="7102024"><a href="/net/smtp/smtp_test.go.html#7101916">err</a></span><span class="op" id="7102027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102034">if</span>&nbsp;<span class="ident" id="7102037">err</span>&nbsp;<span class="op" id="7102041">:=</span>&nbsp;<span class="ident" id="7102044"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7102045">.</span><span class="ident" id="7102046">Mail</span><span class="op" id="7102050">(</span><span class="string" id="7102051">&#34;user@gmail.com&#34;</span><span class="op" id="7102067">)</span><span class="op" id="7102068">;</span>&nbsp;<span class="ident" id="7102070"><a href="/net/smtp/smtp_test.go.html#7102037">err</a></span>&nbsp;<span class="op" id="7102074">!=</span>&nbsp;<span class="ident" id="7102077">nil</span>&nbsp;<span class="op" id="7102081">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102085"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102086">.</span><span class="ident" id="7102087">Fatalf</span><span class="op" id="7102093">(</span><span class="string" id="7102094">&#34;MAIL&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7102111">,</span>&nbsp;<span class="ident" id="7102113"><a href="/net/smtp/smtp_test.go.html#7102037">err</a></span><span class="op" id="7102116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102122">if</span>&nbsp;<span class="ident" id="7102125">err</span>&nbsp;<span class="op" id="7102129">:=</span>&nbsp;<span class="ident" id="7102132"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7102133">.</span><span class="ident" id="7102134">Rcpt</span><span class="op" id="7102138">(</span><span class="string" id="7102139">&#34;golang-nuts@googlegroups.com&#34;</span><span class="op" id="7102169">)</span><span class="op" id="7102170">;</span>&nbsp;<span class="ident" id="7102172"><a href="/net/smtp/smtp_test.go.html#7102125">err</a></span>&nbsp;<span class="op" id="7102176">!=</span>&nbsp;<span class="ident" id="7102179">nil</span>&nbsp;<span class="op" id="7102183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102187"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102188">.</span><span class="ident" id="7102189">Fatalf</span><span class="op" id="7102195">(</span><span class="string" id="7102196">&#34;RCPT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7102213">,</span>&nbsp;<span class="ident" id="7102215"><a href="/net/smtp/smtp_test.go.html#7102125">err</a></span><span class="op" id="7102218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102221">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102224">msg</span>&nbsp;<span class="op" id="7102228">:=</span>&nbsp;<span class="string" id="7102231">`From:&nbsp;user@gmail.com<br>
<span class="lineno"></span>To:&nbsp;golang-nuts@googlegroups.com<br>
<span class="lineno"></span>Subject:&nbsp;Hooray&nbsp;for&nbsp;Go<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno">165</span>.Leading&nbsp;dot&nbsp;line&nbsp;.<br>
<span class="lineno"></span>Goodbye.`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102348">w</span><span class="op" id="7102349">,</span>&nbsp;<span class="ident" id="7102351">err</span>&nbsp;<span class="op" id="7102355">:=</span>&nbsp;<span class="ident" id="7102358"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7102359">.</span><span class="ident" id="7102360">Data</span><span class="op" id="7102364">(</span><span class="op" id="7102365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102368">if</span>&nbsp;<span class="ident" id="7102371"><a href="/net/smtp/smtp_test.go.html#7102351">err</a></span>&nbsp;<span class="op" id="7102375">!=</span>&nbsp;<span class="ident" id="7102378">nil</span>&nbsp;<span class="op" id="7102382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102386"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102387">.</span><span class="ident" id="7102388">Fatalf</span><span class="op" id="7102394">(</span><span class="string" id="7102395">&#34;DATA&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7102412">,</span>&nbsp;<span class="ident" id="7102414"><a href="/net/smtp/smtp_test.go.html#7102351">err</a></span><span class="op" id="7102417">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102423">if</span>&nbsp;<span class="ident" id="7102426">_</span><span class="op" id="7102427">,</span>&nbsp;<span class="ident" id="7102429">err</span>&nbsp;<span class="op" id="7102433">:=</span>&nbsp;<span class="ident" id="7102436"><a href="/net/smtp/smtp_test.go.html#7102348">w</a></span><span class="op" id="7102437">.</span><span class="ident" id="7102438">Write</span><span class="op" id="7102443">(</span><span class="op" id="7102444">[</span><span class="op" id="7102445">]</span><span class="builtintype" id="7102446">byte</span><span class="op" id="7102450">(</span><span class="ident" id="7102451"><a href="/net/smtp/smtp_test.go.html#7102224">msg</a></span><span class="op" id="7102454">)</span><span class="op" id="7102455">)</span><span class="op" id="7102456">;</span>&nbsp;<span class="ident" id="7102458"><a href="/net/smtp/smtp_test.go.html#7102429">err</a></span>&nbsp;<span class="op" id="7102462">!=</span>&nbsp;<span class="ident" id="7102465">nil</span>&nbsp;<span class="op" id="7102469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102473"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102474">.</span><span class="ident" id="7102475">Fatalf</span><span class="op" id="7102481">(</span><span class="string" id="7102482">&#34;Data&nbsp;write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7102505">,</span>&nbsp;<span class="ident" id="7102507"><a href="/net/smtp/smtp_test.go.html#7102429">err</a></span><span class="op" id="7102510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102516">if</span>&nbsp;<span class="ident" id="7102519">err</span>&nbsp;<span class="op" id="7102523">:=</span>&nbsp;<span class="ident" id="7102526"><a href="/net/smtp/smtp_test.go.html#7102348">w</a></span><span class="op" id="7102527">.</span><span class="ident" id="7102528">Close</span><span class="op" id="7102533">(</span><span class="op" id="7102534">)</span><span class="op" id="7102535">;</span>&nbsp;<span class="ident" id="7102537"><a href="/net/smtp/smtp_test.go.html#7102519">err</a></span>&nbsp;<span class="op" id="7102541">!=</span>&nbsp;<span class="ident" id="7102544">nil</span>&nbsp;<span class="op" id="7102548">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102552"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102553">.</span><span class="ident" id="7102554">Fatalf</span><span class="op" id="7102560">(</span><span class="string" id="7102561">&#34;Bad&nbsp;data&nbsp;response:&nbsp;%s&#34;</span><span class="op" id="7102584">,</span>&nbsp;<span class="ident" id="7102586"><a href="/net/smtp/smtp_test.go.html#7102519">err</a></span><span class="op" id="7102589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102596">if</span>&nbsp;<span class="ident" id="7102599">err</span>&nbsp;<span class="op" id="7102603">:=</span>&nbsp;<span class="ident" id="7102606"><a href="/net/smtp/smtp_test.go.html#7100983">c</a></span><span class="op" id="7102607">.</span><span class="ident" id="7102608">Quit</span><span class="op" id="7102612">(</span><span class="op" id="7102613">)</span><span class="op" id="7102614">;</span>&nbsp;<span class="ident" id="7102616"><a href="/net/smtp/smtp_test.go.html#7102599">err</a></span>&nbsp;<span class="op" id="7102620">!=</span>&nbsp;<span class="ident" id="7102623">nil</span>&nbsp;<span class="op" id="7102627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102631"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102632">.</span><span class="ident" id="7102633">Fatalf</span><span class="op" id="7102639">(</span><span class="string" id="7102640">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7102657">,</span>&nbsp;<span class="ident" id="7102659"><a href="/net/smtp/smtp_test.go.html#7102599">err</a></span><span class="op" id="7102662">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102669"><a href="/net/smtp/smtp_test.go.html#7100838">bcmdbuf</a></span><span class="op" id="7102676">.</span><span class="ident" id="7102677">Flush</span><span class="op" id="7102682">(</span><span class="op" id="7102683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102686">actualcmds</span>&nbsp;<span class="op" id="7102697">:=</span>&nbsp;<span class="ident" id="7102700"><a href="/net/smtp/smtp_test.go.html#7100817">cmdbuf</a></span><span class="op" id="7102706">.</span><span class="ident" id="7102707">String</span><span class="op" id="7102713">(</span><span class="op" id="7102714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102717">if</span>&nbsp;<span class="ident" id="7102720"><a href="/net/smtp/smtp_test.go.html#7100746">client</a></span>&nbsp;<span class="op" id="7102727">!=</span>&nbsp;<span class="ident" id="7102730"><a href="/net/smtp/smtp_test.go.html#7102686">actualcmds</a></span>&nbsp;<span class="op" id="7102741">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102745"><a href="/net/smtp/smtp_test.go.html#7100663">t</a></span><span class="op" id="7102746">.</span><span class="ident" id="7102747">Fatalf</span><span class="op" id="7102753">(</span><span class="string" id="7102754">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7102779">,</span>&nbsp;<span class="ident" id="7102781"><a href="/net/smtp/smtp_test.go.html#7102686">actualcmds</a></span><span class="op" id="7102791">,</span>&nbsp;<span class="ident" id="7102793"><a href="/net/smtp/smtp_test.go.html#7100746">client</a></span><span class="op" id="7102799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102802">}</span><br>
<span class="lineno"></span><span class="op" id="7102804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7102807">var</span>&nbsp;<span class="ident" id="7102811">basicServer</span>&nbsp;<span class="op" id="7102823">=</span>&nbsp;<span class="string" id="7102825">`250&nbsp;mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno">190</span>502&nbsp;Unrecognized&nbsp;command.<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">195</span>530&nbsp;Authentication&nbsp;required<br>
<span class="lineno"></span>252&nbsp;Send&nbsp;some&nbsp;mail,&nbsp;I&#39;ll&nbsp;try&nbsp;my&nbsp;best<br>
<span class="lineno"></span>250&nbsp;User&nbsp;is&nbsp;valid<br>
<span class="lineno"></span>235&nbsp;Accepted<br>
<span class="lineno"></span>250&nbsp;Sender&nbsp;OK<br>
<span class="lineno">200</span>250&nbsp;Receiver&nbsp;OK<br>
<span class="lineno"></span>354&nbsp;Go&nbsp;ahead<br>
<span class="lineno"></span>250&nbsp;Data&nbsp;OK<br>
<span class="lineno"></span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="7103133">var</span>&nbsp;<span class="ident" id="7103137">basicClient</span>&nbsp;<span class="op" id="7103149">=</span>&nbsp;<span class="string" id="7103151">`HELO&nbsp;localhost<br>
<span class="lineno"></span>EHLO&nbsp;localhost<br>
<span class="lineno"></span>EHLO&nbsp;localhost<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;user@gmail.com&gt;&nbsp;BODY=8BITMIME<br>
<span class="lineno">210</span>VRFY&nbsp;user1@gmail.com<br>
<span class="lineno"></span>VRFY&nbsp;user2@gmail.com<br>
<span class="lineno"></span>AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;user@gmail.com&gt;&nbsp;BODY=8BITMIME<br>
<span class="lineno"></span>RCPT&nbsp;TO:&lt;golang-nuts@googlegroups.com&gt;<br>
<span class="lineno">215</span>DATA<br>
<span class="lineno"></span>From:&nbsp;user@gmail.com<br>
<span class="lineno"></span>To:&nbsp;golang-nuts@googlegroups.com<br>
<span class="lineno"></span>Subject:&nbsp;Hooray&nbsp;for&nbsp;Go<br>
<span class="lineno"></span><br>
<span class="lineno">220</span>Line&nbsp;1<br>
<span class="lineno"></span>..Leading&nbsp;dot&nbsp;line&nbsp;.<br>
<span class="lineno"></span>Goodbye.<br>
<span class="lineno"></span>.<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno">225</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7103518">func</span>&nbsp;<span class="ident" id="7103523">TestNewClient</span><span class="op" id="7103536">(</span><span class="ident" id="7103537">t</span>&nbsp;<span class="op" id="7103539">*</span><span class="ident" id="7103540"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7103547">.</span><span class="ident" id="7103548">T</span><span class="op" id="7103549">)</span>&nbsp;<span class="op" id="7103551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103554">server</span>&nbsp;<span class="op" id="7103561">:=</span>&nbsp;<span class="ident" id="7103564"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7103571">.</span><span class="ident" id="7103572">Join</span><span class="op" id="7103576">(</span><span class="ident" id="7103577"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7103584">.</span><span class="ident" id="7103585">Split</span><span class="op" id="7103590">(</span><span class="ident" id="7103591"><a href="/net/smtp/smtp_test.go.html#7104438">newClientServer</a></span><span class="op" id="7103606">,</span>&nbsp;<span class="string" id="7103608">&#34;\n&#34;</span><span class="op" id="7103612">)</span><span class="op" id="7103613">,</span>&nbsp;<span class="string" id="7103615">&#34;\r\n&#34;</span><span class="op" id="7103621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103624">client</span>&nbsp;<span class="op" id="7103631">:=</span>&nbsp;<span class="ident" id="7103634"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7103641">.</span><span class="ident" id="7103642">Join</span><span class="op" id="7103646">(</span><span class="ident" id="7103647"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7103654">.</span><span class="ident" id="7103655">Split</span><span class="op" id="7103660">(</span><span class="ident" id="7103661"><a href="/net/smtp/smtp_test.go.html#7104573">newClientClient</a></span><span class="op" id="7103676">,</span>&nbsp;<span class="string" id="7103678">&#34;\n&#34;</span><span class="op" id="7103682">)</span><span class="op" id="7103683">,</span>&nbsp;<span class="string" id="7103685">&#34;\r\n&#34;</span><span class="op" id="7103691">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103695">var</span>&nbsp;<span class="ident" id="7103699">cmdbuf</span>&nbsp;<span class="ident" id="7103706"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7103711">.</span><span class="ident" id="7103712">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103720">bcmdbuf</span>&nbsp;<span class="op" id="7103728">:=</span>&nbsp;<span class="ident" id="7103731"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7103736">.</span><span class="ident" id="7103737">NewWriter</span><span class="op" id="7103746">(</span><span class="op" id="7103747">&amp;</span><span class="ident" id="7103748"><a href="/net/smtp/smtp_test.go.html#7103699">cmdbuf</a></span><span class="op" id="7103754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103757">out</span>&nbsp;<span class="op" id="7103761">:=</span>&nbsp;<span class="keyword" id="7103764">func</span><span class="op" id="7103768">(</span><span class="op" id="7103769">)</span>&nbsp;<span class="builtintype" id="7103771">string</span>&nbsp;<span class="op" id="7103778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103782"><a href="/net/smtp/smtp_test.go.html#7103720">bcmdbuf</a></span><span class="op" id="7103789">.</span><span class="ident" id="7103790">Flush</span><span class="op" id="7103795">(</span><span class="op" id="7103796">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103800">return</span>&nbsp;<span class="ident" id="7103807"><a href="/net/smtp/smtp_test.go.html#7103699">cmdbuf</a></span><span class="op" id="7103813">.</span><span class="ident" id="7103814">String</span><span class="op" id="7103820">(</span><span class="op" id="7103821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103827">var</span>&nbsp;<span class="ident" id="7103831">fake</span>&nbsp;<span class="ident" id="7103836"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103843"><a href="/net/smtp/smtp_test.go.html#7103831">fake</a></span><span class="op" id="7103847">.</span><span class="ident" id="7103848">ReadWriter</span>&nbsp;<span class="op" id="7103859">=</span>&nbsp;<span class="ident" id="7103861"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7103866">.</span><span class="ident" id="7103867">NewReadWriter</span><span class="op" id="7103880">(</span><span class="ident" id="7103881"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7103886">.</span><span class="ident" id="7103887">NewReader</span><span class="op" id="7103896">(</span><span class="ident" id="7103897"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7103904">.</span><span class="ident" id="7103905">NewReader</span><span class="op" id="7103914">(</span><span class="ident" id="7103915"><a href="/net/smtp/smtp_test.go.html#7103554">server</a></span><span class="op" id="7103921">)</span><span class="op" id="7103922">)</span><span class="op" id="7103923">,</span>&nbsp;<span class="ident" id="7103925"><a href="/net/smtp/smtp_test.go.html#7103720">bcmdbuf</a></span><span class="op" id="7103932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103935">c</span><span class="op" id="7103936">,</span>&nbsp;<span class="ident" id="7103938">err</span>&nbsp;<span class="op" id="7103942">:=</span>&nbsp;<span class="ident" id="7103945"><a href="/net/smtp/smtp.go.html#6333119">NewClient</a></span><span class="op" id="7103954">(</span><span class="ident" id="7103955"><a href="/net/smtp/smtp_test.go.html#7103831">fake</a></span><span class="op" id="7103959">,</span>&nbsp;<span class="string" id="7103961">&#34;fake.host&#34;</span><span class="op" id="7103972">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103975">if</span>&nbsp;<span class="ident" id="7103978"><a href="/net/smtp/smtp_test.go.html#7103938">err</a></span>&nbsp;<span class="op" id="7103982">!=</span>&nbsp;<span class="ident" id="7103985">nil</span>&nbsp;<span class="op" id="7103989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103993"><a href="/net/smtp/smtp_test.go.html#7103537">t</a></span><span class="op" id="7103994">.</span><span class="ident" id="7103995">Fatalf</span><span class="op" id="7104001">(</span><span class="string" id="7104002">&#34;NewClient:&nbsp;%v\n(after&nbsp;%v)&#34;</span><span class="op" id="7104029">,</span>&nbsp;<span class="ident" id="7104031"><a href="/net/smtp/smtp_test.go.html#7103938">err</a></span><span class="op" id="7104034">,</span>&nbsp;<span class="ident" id="7104036"><a href="/net/smtp/smtp_test.go.html#7103757">out</a></span><span class="op" id="7104039">(</span><span class="op" id="7104040">)</span><span class="op" id="7104041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104047">defer</span>&nbsp;<span class="ident" id="7104053"><a href="/net/smtp/smtp_test.go.html#7103935">c</a></span><span class="op" id="7104054">.</span><span class="ident" id="7104055">Close</span><span class="op" id="7104060">(</span><span class="op" id="7104061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104064">if</span>&nbsp;<span class="ident" id="7104067">ok</span><span class="op" id="7104069">,</span>&nbsp;<span class="ident" id="7104071">args</span>&nbsp;<span class="op" id="7104076">:=</span>&nbsp;<span class="ident" id="7104079"><a href="/net/smtp/smtp_test.go.html#7103935">c</a></span><span class="op" id="7104080">.</span><span class="ident" id="7104081">Extension</span><span class="op" id="7104090">(</span><span class="string" id="7104091">&#34;aUtH&#34;</span><span class="op" id="7104097">)</span><span class="op" id="7104098">;</span>&nbsp;<span class="op" id="7104100">!</span><span class="ident" id="7104101"><a href="/net/smtp/smtp_test.go.html#7104067">ok</a></span>&nbsp;<span class="op" id="7104104">||</span>&nbsp;<span class="ident" id="7104107"><a href="/net/smtp/smtp_test.go.html#7104071">args</a></span>&nbsp;<span class="op" id="7104112">!=</span>&nbsp;<span class="string" id="7104115">&#34;LOGIN&nbsp;PLAIN&#34;</span>&nbsp;<span class="op" id="7104129">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104133"><a href="/net/smtp/smtp_test.go.html#7103537">t</a></span><span class="op" id="7104134">.</span><span class="ident" id="7104135">Fatalf</span><span class="op" id="7104141">(</span><span class="string" id="7104142">&#34;Expected&nbsp;AUTH&nbsp;supported&#34;</span><span class="op" id="7104167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104173">if</span>&nbsp;<span class="ident" id="7104176">ok</span><span class="op" id="7104178">,</span>&nbsp;<span class="ident" id="7104180">_</span>&nbsp;<span class="op" id="7104182">:=</span>&nbsp;<span class="ident" id="7104185"><a href="/net/smtp/smtp_test.go.html#7103935">c</a></span><span class="op" id="7104186">.</span><span class="ident" id="7104187">Extension</span><span class="op" id="7104196">(</span><span class="string" id="7104197">&#34;DSN&#34;</span><span class="op" id="7104202">)</span><span class="op" id="7104203">;</span>&nbsp;<span class="ident" id="7104205"><a href="/net/smtp/smtp_test.go.html#7104176">ok</a></span>&nbsp;<span class="op" id="7104208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104212"><a href="/net/smtp/smtp_test.go.html#7103537">t</a></span><span class="op" id="7104213">.</span><span class="ident" id="7104214">Fatalf</span><span class="op" id="7104220">(</span><span class="string" id="7104221">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7104244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104247">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104250">if</span>&nbsp;<span class="ident" id="7104253">err</span>&nbsp;<span class="op" id="7104257">:=</span>&nbsp;<span class="ident" id="7104260"><a href="/net/smtp/smtp_test.go.html#7103935">c</a></span><span class="op" id="7104261">.</span><span class="ident" id="7104262">Quit</span><span class="op" id="7104266">(</span><span class="op" id="7104267">)</span><span class="op" id="7104268">;</span>&nbsp;<span class="ident" id="7104270"><a href="/net/smtp/smtp_test.go.html#7104253">err</a></span>&nbsp;<span class="op" id="7104274">!=</span>&nbsp;<span class="ident" id="7104277">nil</span>&nbsp;<span class="op" id="7104281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104285"><a href="/net/smtp/smtp_test.go.html#7103537">t</a></span><span class="op" id="7104286">.</span><span class="ident" id="7104287">Fatalf</span><span class="op" id="7104293">(</span><span class="string" id="7104294">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7104311">,</span>&nbsp;<span class="ident" id="7104313"><a href="/net/smtp/smtp_test.go.html#7104253">err</a></span><span class="op" id="7104316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104323">actualcmds</span>&nbsp;<span class="op" id="7104334">:=</span>&nbsp;<span class="ident" id="7104337"><a href="/net/smtp/smtp_test.go.html#7103757">out</a></span><span class="op" id="7104340">(</span><span class="op" id="7104341">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104344">if</span>&nbsp;<span class="ident" id="7104347"><a href="/net/smtp/smtp_test.go.html#7103624">client</a></span>&nbsp;<span class="op" id="7104354">!=</span>&nbsp;<span class="ident" id="7104357"><a href="/net/smtp/smtp_test.go.html#7104323">actualcmds</a></span>&nbsp;<span class="op" id="7104368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104372"><a href="/net/smtp/smtp_test.go.html#7103537">t</a></span><span class="op" id="7104373">.</span><span class="ident" id="7104374">Fatalf</span><span class="op" id="7104380">(</span><span class="string" id="7104381">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7104406">,</span>&nbsp;<span class="ident" id="7104408"><a href="/net/smtp/smtp_test.go.html#7104323">actualcmds</a></span><span class="op" id="7104418">,</span>&nbsp;<span class="ident" id="7104420"><a href="/net/smtp/smtp_test.go.html#7103624">client</a></span><span class="op" id="7104426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104429">}</span><br>
<span class="lineno"></span><span class="op" id="7104431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7104434">var</span>&nbsp;<span class="ident" id="7104438">newClientServer</span>&nbsp;<span class="op" id="7104454">=</span>&nbsp;<span class="string" id="7104456">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">265</span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7104569">var</span>&nbsp;<span class="ident" id="7104573">newClientClient</span>&nbsp;<span class="op" id="7104589">=</span>&nbsp;<span class="string" id="7104591">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno">270</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7104615">func</span>&nbsp;<span class="ident" id="7104620">TestNewClient2</span><span class="op" id="7104634">(</span><span class="ident" id="7104635">t</span>&nbsp;<span class="op" id="7104637">*</span><span class="ident" id="7104638"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7104645">.</span><span class="ident" id="7104646">T</span><span class="op" id="7104647">)</span>&nbsp;<span class="op" id="7104649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104652">server</span>&nbsp;<span class="op" id="7104659">:=</span>&nbsp;<span class="ident" id="7104662"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7104669">.</span><span class="ident" id="7104670">Join</span><span class="op" id="7104674">(</span><span class="ident" id="7104675"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7104682">.</span><span class="ident" id="7104683">Split</span><span class="op" id="7104688">(</span><span class="ident" id="7104689"><a href="/net/smtp/smtp_test.go.html#7105367">newClient2Server</a></span><span class="op" id="7104705">,</span>&nbsp;<span class="string" id="7104707">&#34;\n&#34;</span><span class="op" id="7104711">)</span><span class="op" id="7104712">,</span>&nbsp;<span class="string" id="7104714">&#34;\r\n&#34;</span><span class="op" id="7104720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104723">client</span>&nbsp;<span class="op" id="7104730">:=</span>&nbsp;<span class="ident" id="7104733"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7104740">.</span><span class="ident" id="7104741">Join</span><span class="op" id="7104745">(</span><span class="ident" id="7104746"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7104753">.</span><span class="ident" id="7104754">Split</span><span class="op" id="7104759">(</span><span class="ident" id="7104760"><a href="/net/smtp/smtp_test.go.html#7105511">newClient2Client</a></span><span class="op" id="7104776">,</span>&nbsp;<span class="string" id="7104778">&#34;\n&#34;</span><span class="op" id="7104782">)</span><span class="op" id="7104783">,</span>&nbsp;<span class="string" id="7104785">&#34;\r\n&#34;</span><span class="op" id="7104791">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104795">var</span>&nbsp;<span class="ident" id="7104799">cmdbuf</span>&nbsp;<span class="ident" id="7104806"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7104811">.</span><span class="ident" id="7104812">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104820">bcmdbuf</span>&nbsp;<span class="op" id="7104828">:=</span>&nbsp;<span class="ident" id="7104831"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7104836">.</span><span class="ident" id="7104837">NewWriter</span><span class="op" id="7104846">(</span><span class="op" id="7104847">&amp;</span><span class="ident" id="7104848"><a href="/net/smtp/smtp_test.go.html#7104799">cmdbuf</a></span><span class="op" id="7104854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104857">var</span>&nbsp;<span class="ident" id="7104861">fake</span>&nbsp;<span class="ident" id="7104866"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104873"><a href="/net/smtp/smtp_test.go.html#7104861">fake</a></span><span class="op" id="7104877">.</span><span class="ident" id="7104878">ReadWriter</span>&nbsp;<span class="op" id="7104889">=</span>&nbsp;<span class="ident" id="7104891"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7104896">.</span><span class="ident" id="7104897">NewReadWriter</span><span class="op" id="7104910">(</span><span class="ident" id="7104911"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7104916">.</span><span class="ident" id="7104917">NewReader</span><span class="op" id="7104926">(</span><span class="ident" id="7104927"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7104934">.</span><span class="ident" id="7104935">NewReader</span><span class="op" id="7104944">(</span><span class="ident" id="7104945"><a href="/net/smtp/smtp_test.go.html#7104652">server</a></span><span class="op" id="7104951">)</span><span class="op" id="7104952">)</span><span class="op" id="7104953">,</span>&nbsp;<span class="ident" id="7104955"><a href="/net/smtp/smtp_test.go.html#7104820">bcmdbuf</a></span><span class="op" id="7104962">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104965">c</span><span class="op" id="7104966">,</span>&nbsp;<span class="ident" id="7104968">err</span>&nbsp;<span class="op" id="7104972">:=</span>&nbsp;<span class="ident" id="7104975"><a href="/net/smtp/smtp.go.html#6333119">NewClient</a></span><span class="op" id="7104984">(</span><span class="ident" id="7104985"><a href="/net/smtp/smtp_test.go.html#7104861">fake</a></span><span class="op" id="7104989">,</span>&nbsp;<span class="string" id="7104991">&#34;fake.host&#34;</span><span class="op" id="7105002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105005">if</span>&nbsp;<span class="ident" id="7105008"><a href="/net/smtp/smtp_test.go.html#7104968">err</a></span>&nbsp;<span class="op" id="7105012">!=</span>&nbsp;<span class="ident" id="7105015">nil</span>&nbsp;<span class="op" id="7105019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105023"><a href="/net/smtp/smtp_test.go.html#7104635">t</a></span><span class="op" id="7105024">.</span><span class="ident" id="7105025">Fatalf</span><span class="op" id="7105031">(</span><span class="string" id="7105032">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7105047">,</span>&nbsp;<span class="ident" id="7105049"><a href="/net/smtp/smtp_test.go.html#7104968">err</a></span><span class="op" id="7105052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105058">defer</span>&nbsp;<span class="ident" id="7105064"><a href="/net/smtp/smtp_test.go.html#7104965">c</a></span><span class="op" id="7105065">.</span><span class="ident" id="7105066">Close</span><span class="op" id="7105071">(</span><span class="op" id="7105072">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105075">if</span>&nbsp;<span class="ident" id="7105078">ok</span><span class="op" id="7105080">,</span>&nbsp;<span class="ident" id="7105082">_</span>&nbsp;<span class="op" id="7105084">:=</span>&nbsp;<span class="ident" id="7105087"><a href="/net/smtp/smtp_test.go.html#7104965">c</a></span><span class="op" id="7105088">.</span><span class="ident" id="7105089">Extension</span><span class="op" id="7105098">(</span><span class="string" id="7105099">&#34;DSN&#34;</span><span class="op" id="7105104">)</span><span class="op" id="7105105">;</span>&nbsp;<span class="ident" id="7105107"><a href="/net/smtp/smtp_test.go.html#7105078">ok</a></span>&nbsp;<span class="op" id="7105110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105114"><a href="/net/smtp/smtp_test.go.html#7104635">t</a></span><span class="op" id="7105115">.</span><span class="ident" id="7105116">Fatalf</span><span class="op" id="7105122">(</span><span class="string" id="7105123">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7105146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105152">if</span>&nbsp;<span class="ident" id="7105155">err</span>&nbsp;<span class="op" id="7105159">:=</span>&nbsp;<span class="ident" id="7105162"><a href="/net/smtp/smtp_test.go.html#7104965">c</a></span><span class="op" id="7105163">.</span><span class="ident" id="7105164">Quit</span><span class="op" id="7105168">(</span><span class="op" id="7105169">)</span><span class="op" id="7105170">;</span>&nbsp;<span class="ident" id="7105172"><a href="/net/smtp/smtp_test.go.html#7105155">err</a></span>&nbsp;<span class="op" id="7105176">!=</span>&nbsp;<span class="ident" id="7105179">nil</span>&nbsp;<span class="op" id="7105183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105187"><a href="/net/smtp/smtp_test.go.html#7104635">t</a></span><span class="op" id="7105188">.</span><span class="ident" id="7105189">Fatalf</span><span class="op" id="7105195">(</span><span class="string" id="7105196">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7105213">,</span>&nbsp;<span class="ident" id="7105215"><a href="/net/smtp/smtp_test.go.html#7105155">err</a></span><span class="op" id="7105218">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105225"><a href="/net/smtp/smtp_test.go.html#7104820">bcmdbuf</a></span><span class="op" id="7105232">.</span><span class="ident" id="7105233">Flush</span><span class="op" id="7105238">(</span><span class="op" id="7105239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105242">actualcmds</span>&nbsp;<span class="op" id="7105253">:=</span>&nbsp;<span class="ident" id="7105256"><a href="/net/smtp/smtp_test.go.html#7104799">cmdbuf</a></span><span class="op" id="7105262">.</span><span class="ident" id="7105263">String</span><span class="op" id="7105269">(</span><span class="op" id="7105270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105273">if</span>&nbsp;<span class="ident" id="7105276"><a href="/net/smtp/smtp_test.go.html#7104723">client</a></span>&nbsp;<span class="op" id="7105283">!=</span>&nbsp;<span class="ident" id="7105286"><a href="/net/smtp/smtp_test.go.html#7105242">actualcmds</a></span>&nbsp;<span class="op" id="7105297">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105301"><a href="/net/smtp/smtp_test.go.html#7104635">t</a></span><span class="op" id="7105302">.</span><span class="ident" id="7105303">Fatalf</span><span class="op" id="7105309">(</span><span class="string" id="7105310">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7105335">,</span>&nbsp;<span class="ident" id="7105337"><a href="/net/smtp/smtp_test.go.html#7105242">actualcmds</a></span><span class="op" id="7105347">,</span>&nbsp;<span class="ident" id="7105349"><a href="/net/smtp/smtp_test.go.html#7104723">client</a></span><span class="op" id="7105355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105358">}</span><br>
<span class="lineno"></span><span class="op" id="7105360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105363">var</span>&nbsp;<span class="ident" id="7105367">newClient2Server</span>&nbsp;<span class="op" id="7105384">=</span>&nbsp;<span class="string" id="7105386">`220&nbsp;hello&nbsp;world<br>
<span class="lineno">300</span>502&nbsp;EH?<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">305</span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105507">var</span>&nbsp;<span class="ident" id="7105511">newClient2Client</span>&nbsp;<span class="op" id="7105528">=</span>&nbsp;<span class="string" id="7105530">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>HELO&nbsp;localhost<br>
<span class="lineno">310</span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105569">func</span>&nbsp;<span class="ident" id="7105574">TestHello</span><span class="op" id="7105583">(</span><span class="ident" id="7105584">t</span>&nbsp;<span class="op" id="7105586">*</span><span class="ident" id="7105587"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7105594">.</span><span class="ident" id="7105595">T</span><span class="op" id="7105596">)</span>&nbsp;<span class="op" id="7105598">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105602">if</span>&nbsp;<span class="builtinfunc" id="7105605">len</span><span class="op" id="7105608">(</span><span class="ident" id="7105609"><a href="/net/smtp/smtp_test.go.html#7107322">helloServer</a></span><span class="op" id="7105620">)</span>&nbsp;<span class="op" id="7105622">!=</span>&nbsp;<span class="builtinfunc" id="7105625">len</span><span class="op" id="7105628">(</span><span class="ident" id="7105629"><a href="/net/smtp/smtp_test.go.html#7107567">helloClient</a></span><span class="op" id="7105640">)</span>&nbsp;<span class="op" id="7105642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105646"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7105647">.</span><span class="ident" id="7105648">Fatalf</span><span class="op" id="7105654">(</span><span class="string" id="7105655">&#34;Hello&nbsp;server&nbsp;and&nbsp;client&nbsp;size&nbsp;mismatch&#34;</span><span class="op" id="7105694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105701">for</span>&nbsp;<span class="ident" id="7105705">i</span>&nbsp;<span class="op" id="7105707">:=</span>&nbsp;<span class="num" id="7105710">0</span><span class="op" id="7105711">;</span>&nbsp;<span class="ident" id="7105713"><a href="/net/smtp/smtp_test.go.html#7105705">i</a></span>&nbsp;<span class="op" id="7105715">&lt;</span>&nbsp;<span class="builtinfunc" id="7105717">len</span><span class="op" id="7105720">(</span><span class="ident" id="7105721"><a href="/net/smtp/smtp_test.go.html#7107322">helloServer</a></span><span class="op" id="7105732">)</span><span class="op" id="7105733">;</span>&nbsp;<span class="ident" id="7105735"><a href="/net/smtp/smtp_test.go.html#7105705">i</a></span><span class="op" id="7105736">++</span>&nbsp;<span class="op" id="7105739">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105743">server</span>&nbsp;<span class="op" id="7105750">:=</span>&nbsp;<span class="ident" id="7105753"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7105760">.</span><span class="ident" id="7105761">Join</span><span class="op" id="7105765">(</span><span class="ident" id="7105766"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7105773">.</span><span class="ident" id="7105774">Split</span><span class="op" id="7105779">(</span><span class="ident" id="7105780"><a href="/net/smtp/smtp_test.go.html#7107226">baseHelloServer</a></span><span class="op" id="7105795">+</span><span class="ident" id="7105796"><a href="/net/smtp/smtp_test.go.html#7107322">helloServer</a></span><span class="op" id="7105807">[</span><span class="ident" id="7105808"><a href="/net/smtp/smtp_test.go.html#7105705">i</a></span><span class="op" id="7105809">]</span><span class="op" id="7105810">,</span>&nbsp;<span class="string" id="7105812">&#34;\n&#34;</span><span class="op" id="7105816">)</span><span class="op" id="7105817">,</span>&nbsp;<span class="string" id="7105819">&#34;\r\n&#34;</span><span class="op" id="7105825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105829">client</span>&nbsp;<span class="op" id="7105836">:=</span>&nbsp;<span class="ident" id="7105839"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7105846">.</span><span class="ident" id="7105847">Join</span><span class="op" id="7105851">(</span><span class="ident" id="7105852"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7105859">.</span><span class="ident" id="7105860">Split</span><span class="op" id="7105865">(</span><span class="ident" id="7105866"><a href="/net/smtp/smtp_test.go.html#7107509">baseHelloClient</a></span><span class="op" id="7105881">+</span><span class="ident" id="7105882"><a href="/net/smtp/smtp_test.go.html#7107567">helloClient</a></span><span class="op" id="7105893">[</span><span class="ident" id="7105894"><a href="/net/smtp/smtp_test.go.html#7105705">i</a></span><span class="op" id="7105895">]</span><span class="op" id="7105896">,</span>&nbsp;<span class="string" id="7105898">&#34;\n&#34;</span><span class="op" id="7105902">)</span><span class="op" id="7105903">,</span>&nbsp;<span class="string" id="7105905">&#34;\r\n&#34;</span><span class="op" id="7105911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105915">var</span>&nbsp;<span class="ident" id="7105919">cmdbuf</span>&nbsp;<span class="ident" id="7105926"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7105931">.</span><span class="ident" id="7105932">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105941">bcmdbuf</span>&nbsp;<span class="op" id="7105949">:=</span>&nbsp;<span class="ident" id="7105952"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7105957">.</span><span class="ident" id="7105958">NewWriter</span><span class="op" id="7105967">(</span><span class="op" id="7105968">&amp;</span><span class="ident" id="7105969"><a href="/net/smtp/smtp_test.go.html#7105919">cmdbuf</a></span><span class="op" id="7105975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105979">var</span>&nbsp;<span class="ident" id="7105983">fake</span>&nbsp;<span class="ident" id="7105988"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105996"><a href="/net/smtp/smtp_test.go.html#7105983">fake</a></span><span class="op" id="7106000">.</span><span class="ident" id="7106001">ReadWriter</span>&nbsp;<span class="op" id="7106012">=</span>&nbsp;<span class="ident" id="7106014"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7106019">.</span><span class="ident" id="7106020">NewReadWriter</span><span class="op" id="7106033">(</span><span class="ident" id="7106034"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7106039">.</span><span class="ident" id="7106040">NewReader</span><span class="op" id="7106049">(</span><span class="ident" id="7106050"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7106057">.</span><span class="ident" id="7106058">NewReader</span><span class="op" id="7106067">(</span><span class="ident" id="7106068"><a href="/net/smtp/smtp_test.go.html#7105743">server</a></span><span class="op" id="7106074">)</span><span class="op" id="7106075">)</span><span class="op" id="7106076">,</span>&nbsp;<span class="ident" id="7106078"><a href="/net/smtp/smtp_test.go.html#7105941">bcmdbuf</a></span><span class="op" id="7106085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106089">c</span><span class="op" id="7106090">,</span>&nbsp;<span class="ident" id="7106092">err</span>&nbsp;<span class="op" id="7106096">:=</span>&nbsp;<span class="ident" id="7106099"><a href="/net/smtp/smtp.go.html#6333119">NewClient</a></span><span class="op" id="7106108">(</span><span class="ident" id="7106109"><a href="/net/smtp/smtp_test.go.html#7105983">fake</a></span><span class="op" id="7106113">,</span>&nbsp;<span class="string" id="7106115">&#34;fake.host&#34;</span><span class="op" id="7106126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106130">if</span>&nbsp;<span class="ident" id="7106133"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106137">!=</span>&nbsp;<span class="ident" id="7106140">nil</span>&nbsp;<span class="op" id="7106144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106149"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7106150">.</span><span class="ident" id="7106151">Fatalf</span><span class="op" id="7106157">(</span><span class="string" id="7106158">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7106173">,</span>&nbsp;<span class="ident" id="7106175"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span><span class="op" id="7106178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106182">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106186">defer</span>&nbsp;<span class="ident" id="7106192"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106193">.</span><span class="ident" id="7106194">Close</span><span class="op" id="7106199">(</span><span class="op" id="7106200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106204"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106205">.</span><span class="ident" id="7106206">localName</span>&nbsp;<span class="op" id="7106216">=</span>&nbsp;<span class="string" id="7106218">&#34;customhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106233"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106237">=</span>&nbsp;<span class="ident" id="7106239">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106246">switch</span>&nbsp;<span class="ident" id="7106253"><a href="/net/smtp/smtp_test.go.html#7105705">i</a></span>&nbsp;<span class="op" id="7106255">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106259">case</span>&nbsp;<span class="num" id="7106264">0</span><span class="op" id="7106265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106270"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106274">=</span>&nbsp;<span class="ident" id="7106276"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106277">.</span><span class="ident" id="7106278">Hello</span><span class="op" id="7106283">(</span><span class="string" id="7106284">&#34;customhost&#34;</span><span class="op" id="7106296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106300">case</span>&nbsp;<span class="num" id="7106305">1</span><span class="op" id="7106306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106311"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106315">=</span>&nbsp;<span class="ident" id="7106317"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106318">.</span><span class="ident" id="7106319">StartTLS</span><span class="op" id="7106327">(</span><span class="ident" id="7106328">nil</span><span class="op" id="7106331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106336">if</span>&nbsp;<span class="ident" id="7106339"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span><span class="op" id="7106342">.</span><span class="ident" id="7106343">Error</span><span class="op" id="7106348">(</span><span class="op" id="7106349">)</span>&nbsp;<span class="op" id="7106351">==</span>&nbsp;<span class="string" id="7106354">&#34;502&nbsp;Not&nbsp;implemented&#34;</span>&nbsp;<span class="op" id="7106376">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106382"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106386">=</span>&nbsp;<span class="ident" id="7106388">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106399">case</span>&nbsp;<span class="num" id="7106404">2</span><span class="op" id="7106405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106410"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106414">=</span>&nbsp;<span class="ident" id="7106416"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106417">.</span><span class="ident" id="7106418">Verify</span><span class="op" id="7106424">(</span><span class="string" id="7106425">&#34;test@example.com&#34;</span><span class="op" id="7106443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106447">case</span>&nbsp;<span class="num" id="7106452">3</span><span class="op" id="7106453">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106458"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106459">.</span><span class="ident" id="7106460">tls</span>&nbsp;<span class="op" id="7106464">=</span>&nbsp;<span class="builtintype" id="7106466">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106474"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106475">.</span><span class="ident" id="7106476">serverName</span>&nbsp;<span class="op" id="7106487">=</span>&nbsp;<span class="string" id="7106489">&#34;smtp.google.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106510"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106514">=</span>&nbsp;<span class="ident" id="7106516"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106517">.</span><span class="ident" id="7106518">Auth</span><span class="op" id="7106522">(</span><span class="ident" id="7106523"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7106532">(</span><span class="string" id="7106533">&#34;&#34;</span><span class="op" id="7106535">,</span>&nbsp;<span class="string" id="7106537">&#34;user&#34;</span><span class="op" id="7106543">,</span>&nbsp;<span class="string" id="7106545">&#34;pass&#34;</span><span class="op" id="7106551">,</span>&nbsp;<span class="string" id="7106553">&#34;smtp.google.com&#34;</span><span class="op" id="7106570">)</span><span class="op" id="7106571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106575">case</span>&nbsp;<span class="num" id="7106580">4</span><span class="op" id="7106581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106586"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106590">=</span>&nbsp;<span class="ident" id="7106592"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106593">.</span><span class="ident" id="7106594">Mail</span><span class="op" id="7106598">(</span><span class="string" id="7106599">&#34;test@example.com&#34;</span><span class="op" id="7106617">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106621">case</span>&nbsp;<span class="num" id="7106626">5</span><span class="op" id="7106627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106632">ok</span><span class="op" id="7106634">,</span>&nbsp;<span class="ident" id="7106636">_</span>&nbsp;<span class="op" id="7106638">:=</span>&nbsp;<span class="ident" id="7106641"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106642">.</span><span class="ident" id="7106643">Extension</span><span class="op" id="7106652">(</span><span class="string" id="7106653">&#34;feature&#34;</span><span class="op" id="7106662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106667">if</span>&nbsp;<span class="ident" id="7106670"><a href="/net/smtp/smtp_test.go.html#7106632">ok</a></span>&nbsp;<span class="op" id="7106673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106679"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7106680">.</span><span class="ident" id="7106681">Errorf</span><span class="op" id="7106687">(</span><span class="string" id="7106688">&#34;Expected&nbsp;FEATURE&nbsp;not&nbsp;to&nbsp;be&nbsp;supported&#34;</span><span class="op" id="7106726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106731">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106735">case</span>&nbsp;<span class="num" id="7106740">6</span><span class="op" id="7106741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106746"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106750">=</span>&nbsp;<span class="ident" id="7106752"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106753">.</span><span class="ident" id="7106754">Reset</span><span class="op" id="7106759">(</span><span class="op" id="7106760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106764">case</span>&nbsp;<span class="num" id="7106769">7</span><span class="op" id="7106770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106775"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106779">=</span>&nbsp;<span class="ident" id="7106781"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106782">.</span><span class="ident" id="7106783">Quit</span><span class="op" id="7106787">(</span><span class="op" id="7106788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106792">case</span>&nbsp;<span class="num" id="7106797">8</span><span class="op" id="7106798">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106803"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106807">=</span>&nbsp;<span class="ident" id="7106809"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106810">.</span><span class="ident" id="7106811">Verify</span><span class="op" id="7106817">(</span><span class="string" id="7106818">&#34;test@example.com&#34;</span><span class="op" id="7106836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106841">if</span>&nbsp;<span class="ident" id="7106844"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106848">!=</span>&nbsp;<span class="ident" id="7106851">nil</span>&nbsp;<span class="op" id="7106855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106861"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106865">=</span>&nbsp;<span class="ident" id="7106867"><a href="/net/smtp/smtp_test.go.html#7106089">c</a></span><span class="op" id="7106868">.</span><span class="ident" id="7106869">Hello</span><span class="op" id="7106874">(</span><span class="string" id="7106875">&#34;customhost&#34;</span><span class="op" id="7106887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106893">if</span>&nbsp;<span class="ident" id="7106896"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7106900">!=</span>&nbsp;<span class="ident" id="7106903">nil</span>&nbsp;<span class="op" id="7106907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106914"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7106915">.</span><span class="ident" id="7106916">Errorf</span><span class="op" id="7106922">(</span><span class="string" id="7106923">&#34;Want&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="7106945">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106960">default</span><span class="op" id="7106967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106972"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7106973">.</span><span class="ident" id="7106974">Fatalf</span><span class="op" id="7106980">(</span><span class="string" id="7106981">&#34;Unhandled&nbsp;command&#34;</span><span class="op" id="7107000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107004">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107009">if</span>&nbsp;<span class="ident" id="7107012"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span>&nbsp;<span class="op" id="7107016">!=</span>&nbsp;<span class="ident" id="7107019">nil</span>&nbsp;<span class="op" id="7107023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107028"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7107029">.</span><span class="ident" id="7107030">Errorf</span><span class="op" id="7107036">(</span><span class="string" id="7107037">&#34;Command&nbsp;%d&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7107060">,</span>&nbsp;<span class="ident" id="7107062"><a href="/net/smtp/smtp_test.go.html#7105705">i</a></span><span class="op" id="7107063">,</span>&nbsp;<span class="ident" id="7107065"><a href="/net/smtp/smtp_test.go.html#7106092">err</a></span><span class="op" id="7107068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107077"><a href="/net/smtp/smtp_test.go.html#7105941">bcmdbuf</a></span><span class="op" id="7107084">.</span><span class="ident" id="7107085">Flush</span><span class="op" id="7107090">(</span><span class="op" id="7107091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107095">actualcmds</span>&nbsp;<span class="op" id="7107106">:=</span>&nbsp;<span class="ident" id="7107109"><a href="/net/smtp/smtp_test.go.html#7105919">cmdbuf</a></span><span class="op" id="7107115">.</span><span class="ident" id="7107116">String</span><span class="op" id="7107122">(</span><span class="op" id="7107123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107127">if</span>&nbsp;<span class="ident" id="7107130"><a href="/net/smtp/smtp_test.go.html#7105829">client</a></span>&nbsp;<span class="op" id="7107137">!=</span>&nbsp;<span class="ident" id="7107140"><a href="/net/smtp/smtp_test.go.html#7107095">actualcmds</a></span>&nbsp;<span class="op" id="7107151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107156"><a href="/net/smtp/smtp_test.go.html#7105584">t</a></span><span class="op" id="7107157">.</span><span class="ident" id="7107158">Errorf</span><span class="op" id="7107164">(</span><span class="string" id="7107165">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7107190">,</span>&nbsp;<span class="ident" id="7107192"><a href="/net/smtp/smtp_test.go.html#7107095">actualcmds</a></span><span class="op" id="7107202">,</span>&nbsp;<span class="ident" id="7107204"><a href="/net/smtp/smtp_test.go.html#7105829">client</a></span><span class="op" id="7107210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107214">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107217">}</span><br>
<span class="lineno"></span><span class="op" id="7107219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7107222">var</span>&nbsp;<span class="ident" id="7107226">baseHelloServer</span>&nbsp;<span class="op" id="7107242">=</span>&nbsp;<span class="string" id="7107244">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>502&nbsp;EH?<br>
<span class="lineno">385</span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;FEATURE<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7107318">var</span>&nbsp;<span class="ident" id="7107322">helloServer</span>&nbsp;<span class="op" id="7107334">=</span>&nbsp;<span class="op" id="7107336">[</span><span class="op" id="7107337">]</span><span class="builtintype" id="7107338">string</span><span class="op" id="7107344">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107347">&#34;&#34;</span><span class="op" id="7107349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107352">&#34;502&nbsp;Not&nbsp;implemented\n&#34;</span><span class="op" id="7107375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107378">&#34;250&nbsp;User&nbsp;is&nbsp;valid\n&#34;</span><span class="op" id="7107399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107402">&#34;235&nbsp;Accepted\n&#34;</span><span class="op" id="7107418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107421">&#34;250&nbsp;Sender&nbsp;ok\n&#34;</span><span class="op" id="7107438">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107441">&#34;&#34;</span><span class="op" id="7107443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107446">&#34;250&nbsp;Reset&nbsp;ok\n&#34;</span><span class="op" id="7107462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107465">&#34;221&nbsp;Goodbye\n&#34;</span><span class="op" id="7107480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107483">&#34;250&nbsp;Sender&nbsp;ok\n&#34;</span><span class="op" id="7107500">,</span><br>
<span class="lineno"></span><span class="op" id="7107502">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="7107505">var</span>&nbsp;<span class="ident" id="7107509">baseHelloClient</span>&nbsp;<span class="op" id="7107525">=</span>&nbsp;<span class="string" id="7107527">`EHLO&nbsp;customhost<br>
<span class="lineno"></span>HELO&nbsp;customhost<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="7107563">var</span>&nbsp;<span class="ident" id="7107567">helloClient</span>&nbsp;<span class="op" id="7107579">=</span>&nbsp;<span class="op" id="7107581">[</span><span class="op" id="7107582">]</span><span class="builtintype" id="7107583">string</span><span class="op" id="7107589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107592">&#34;&#34;</span><span class="op" id="7107594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107597">&#34;STARTTLS\n&#34;</span><span class="op" id="7107609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107612">&#34;VRFY&nbsp;test@example.com\n&#34;</span><span class="op" id="7107637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107640">&#34;AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==\n&#34;</span><span class="op" id="7107671">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107674">&#34;MAIL&nbsp;FROM:&lt;test@example.com&gt;\n&#34;</span><span class="op" id="7107706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107709">&#34;&#34;</span><span class="op" id="7107711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107714">&#34;RSET\n&#34;</span><span class="op" id="7107722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107725">&#34;QUIT\n&#34;</span><span class="op" id="7107733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107736">&#34;VRFY&nbsp;test@example.com\n&#34;</span><span class="op" id="7107761">,</span><br>
<span class="lineno">415</span><span class="op" id="7107763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7107766">func</span>&nbsp;<span class="ident" id="7107771">TestSendMail</span><span class="op" id="7107783">(</span><span class="ident" id="7107784">t</span>&nbsp;<span class="op" id="7107786">*</span><span class="ident" id="7107787"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7107794">.</span><span class="ident" id="7107795">T</span><span class="op" id="7107796">)</span>&nbsp;<span class="op" id="7107798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107801">server</span>&nbsp;<span class="op" id="7107808">:=</span>&nbsp;<span class="ident" id="7107811"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7107818">.</span><span class="ident" id="7107819">Join</span><span class="op" id="7107823">(</span><span class="ident" id="7107824"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7107831">.</span><span class="ident" id="7107832">Split</span><span class="op" id="7107837">(</span><span class="ident" id="7107838"><a href="/net/smtp/smtp_test.go.html#7109373">sendMailServer</a></span><span class="op" id="7107852">,</span>&nbsp;<span class="string" id="7107854">&#34;\n&#34;</span><span class="op" id="7107858">)</span><span class="op" id="7107859">,</span>&nbsp;<span class="string" id="7107861">&#34;\r\n&#34;</span><span class="op" id="7107867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107870">client</span>&nbsp;<span class="op" id="7107877">:=</span>&nbsp;<span class="ident" id="7107880"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7107887">.</span><span class="ident" id="7107888">Join</span><span class="op" id="7107892">(</span><span class="ident" id="7107893"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7107900">.</span><span class="ident" id="7107901">Split</span><span class="op" id="7107906">(</span><span class="ident" id="7107907"><a href="/net/smtp/smtp_test.go.html#7109523">sendMailClient</a></span><span class="op" id="7107921">,</span>&nbsp;<span class="string" id="7107923">&#34;\n&#34;</span><span class="op" id="7107927">)</span><span class="op" id="7107928">,</span>&nbsp;<span class="string" id="7107930">&#34;\r\n&#34;</span><span class="op" id="7107936">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107939">var</span>&nbsp;<span class="ident" id="7107943">cmdbuf</span>&nbsp;<span class="ident" id="7107950"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7107955">.</span><span class="ident" id="7107956">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107964">bcmdbuf</span>&nbsp;<span class="op" id="7107972">:=</span>&nbsp;<span class="ident" id="7107975"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7107980">.</span><span class="ident" id="7107981">NewWriter</span><span class="op" id="7107990">(</span><span class="op" id="7107991">&amp;</span><span class="ident" id="7107992"><a href="/net/smtp/smtp_test.go.html#7107943">cmdbuf</a></span><span class="op" id="7107998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108001">l</span><span class="op" id="7108002">,</span>&nbsp;<span class="ident" id="7108004">err</span>&nbsp;<span class="op" id="7108008">:=</span>&nbsp;<span class="ident" id="7108011"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7108014">.</span><span class="ident" id="7108015">Listen</span><span class="op" id="7108021">(</span><span class="string" id="7108022">&#34;tcp&#34;</span><span class="op" id="7108027">,</span>&nbsp;<span class="string" id="7108029">&#34;127.0.0.1:0&#34;</span><span class="op" id="7108042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108045">if</span>&nbsp;<span class="ident" id="7108048"><a href="/net/smtp/smtp_test.go.html#7108004">err</a></span>&nbsp;<span class="op" id="7108052">!=</span>&nbsp;<span class="ident" id="7108055">nil</span>&nbsp;<span class="op" id="7108059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108063"><a href="/net/smtp/smtp_test.go.html#7107784">t</a></span><span class="op" id="7108064">.</span><span class="ident" id="7108065">Fatalf</span><span class="op" id="7108071">(</span><span class="string" id="7108072">&#34;Unable&nbsp;to&nbsp;to&nbsp;create&nbsp;listener:&nbsp;%v&#34;</span><span class="op" id="7108106">,</span>&nbsp;<span class="ident" id="7108108"><a href="/net/smtp/smtp_test.go.html#7108004">err</a></span><span class="op" id="7108111">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108117">defer</span>&nbsp;<span class="ident" id="7108123"><a href="/net/smtp/smtp_test.go.html#7108001">l</a></span><span class="op" id="7108124">.</span><span class="ident" id="7108125">Close</span><span class="op" id="7108130">(</span><span class="op" id="7108131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7108135">//&nbsp;prevent&nbsp;data&nbsp;race&nbsp;on&nbsp;bcmdbuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108168">var</span>&nbsp;<span class="ident" id="7108172">done</span>&nbsp;<span class="op" id="7108177">=</span>&nbsp;<span class="builtinfunc" id="7108179">make</span><span class="op" id="7108183">(</span><span class="keyword" id="7108184">chan</span>&nbsp;<span class="keyword" id="7108189">struct</span><span class="op" id="7108195">{</span><span class="op" id="7108196">}</span><span class="op" id="7108197">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108200">go</span>&nbsp;<span class="keyword" id="7108203">func</span><span class="op" id="7108207">(</span><span class="ident" id="7108208">data</span>&nbsp;<span class="op" id="7108213">[</span><span class="op" id="7108214">]</span><span class="builtintype" id="7108215">string</span><span class="op" id="7108221">)</span>&nbsp;<span class="op" id="7108223">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108228">defer</span>&nbsp;<span class="builtinfunc" id="7108234">close</span><span class="op" id="7108239">(</span><span class="ident" id="7108240"><a href="/net/smtp/smtp_test.go.html#7108172">done</a></span><span class="op" id="7108244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108249">conn</span><span class="op" id="7108253">,</span>&nbsp;<span class="ident" id="7108255">err</span>&nbsp;<span class="op" id="7108259">:=</span>&nbsp;<span class="ident" id="7108262"><a href="/net/smtp/smtp_test.go.html#7108001">l</a></span><span class="op" id="7108263">.</span><span class="ident" id="7108264">Accept</span><span class="op" id="7108270">(</span><span class="op" id="7108271">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108275">if</span>&nbsp;<span class="ident" id="7108278"><a href="/net/smtp/smtp_test.go.html#7108255">err</a></span>&nbsp;<span class="op" id="7108282">!=</span>&nbsp;<span class="ident" id="7108285">nil</span>&nbsp;<span class="op" id="7108289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108294"><a href="/net/smtp/smtp_test.go.html#7107784">t</a></span><span class="op" id="7108295">.</span><span class="ident" id="7108296">Errorf</span><span class="op" id="7108302">(</span><span class="string" id="7108303">&#34;Accept&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7108321">,</span>&nbsp;<span class="ident" id="7108323"><a href="/net/smtp/smtp_test.go.html#7108255">err</a></span><span class="op" id="7108326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108344">defer</span>&nbsp;<span class="ident" id="7108350"><a href="/net/smtp/smtp_test.go.html#7108249">conn</a></span><span class="op" id="7108354">.</span><span class="ident" id="7108355">Close</span><span class="op" id="7108360">(</span><span class="op" id="7108361">)</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108366">tc</span>&nbsp;<span class="op" id="7108369">:=</span>&nbsp;<span class="ident" id="7108372"><a href="/net/smtp/smtp_test.go.html#7098116">textproto</a></span><span class="op" id="7108381">.</span><span class="ident" id="7108382">NewConn</span><span class="op" id="7108389">(</span><span class="ident" id="7108390"><a href="/net/smtp/smtp_test.go.html#7108249">conn</a></span><span class="op" id="7108394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108398">for</span>&nbsp;<span class="ident" id="7108402">i</span>&nbsp;<span class="op" id="7108404">:=</span>&nbsp;<span class="num" id="7108407">0</span><span class="op" id="7108408">;</span>&nbsp;<span class="ident" id="7108410"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span>&nbsp;<span class="op" id="7108412">&lt;</span>&nbsp;<span class="builtinfunc" id="7108414">len</span><span class="op" id="7108417">(</span><span class="ident" id="7108418"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108422">)</span>&nbsp;<span class="op" id="7108424">&amp;&amp;</span>&nbsp;<span class="ident" id="7108427"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108431">[</span><span class="ident" id="7108432"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108433">]</span>&nbsp;<span class="op" id="7108435">!=</span>&nbsp;<span class="string" id="7108438">&#34;&#34;</span><span class="op" id="7108440">;</span>&nbsp;<span class="ident" id="7108442"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108443">++</span>&nbsp;<span class="op" id="7108446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108451"><a href="/net/smtp/smtp_test.go.html#7108366">tc</a></span><span class="op" id="7108453">.</span><span class="ident" id="7108454">PrintfLine</span><span class="op" id="7108464">(</span><span class="ident" id="7108465"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108469">[</span><span class="ident" id="7108470"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108471">]</span><span class="op" id="7108472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108477">for</span>&nbsp;<span class="builtinfunc" id="7108481">len</span><span class="op" id="7108484">(</span><span class="ident" id="7108485"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108489">[</span><span class="ident" id="7108490"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108491">]</span><span class="op" id="7108492">)</span>&nbsp;<span class="op" id="7108494">&gt;=</span>&nbsp;<span class="num" id="7108497">4</span>&nbsp;<span class="op" id="7108499">&amp;&amp;</span>&nbsp;<span class="ident" id="7108502"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108506">[</span><span class="ident" id="7108507"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108508">]</span><span class="op" id="7108509">[</span><span class="num" id="7108510">3</span><span class="op" id="7108511">]</span>&nbsp;<span class="op" id="7108513">==</span>&nbsp;<span class="string" id="7108516">&#39;-&#39;</span>&nbsp;<span class="op" id="7108520">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108526"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108527">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108534"><a href="/net/smtp/smtp_test.go.html#7108366">tc</a></span><span class="op" id="7108536">.</span><span class="ident" id="7108537">PrintfLine</span><span class="op" id="7108547">(</span><span class="ident" id="7108548"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108552">[</span><span class="ident" id="7108553"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108554">]</span><span class="op" id="7108555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108565">if</span>&nbsp;<span class="ident" id="7108568"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108572">[</span><span class="ident" id="7108573"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108574">]</span>&nbsp;<span class="op" id="7108576">==</span>&nbsp;<span class="string" id="7108579">&#34;221&nbsp;Goodbye&#34;</span>&nbsp;<span class="op" id="7108593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108599">return</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108614">read</span>&nbsp;<span class="op" id="7108619">:=</span>&nbsp;<span class="builtintype" id="7108622">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108631">for</span>&nbsp;<span class="op" id="7108635">!</span><span class="ident" id="7108636"><a href="/net/smtp/smtp_test.go.html#7108614">read</a></span>&nbsp;<span class="op" id="7108641">||</span>&nbsp;<span class="ident" id="7108644"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108648">[</span><span class="ident" id="7108649"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108650">]</span>&nbsp;<span class="op" id="7108652">==</span>&nbsp;<span class="string" id="7108655">&#34;354&nbsp;Go&nbsp;ahead&#34;</span>&nbsp;<span class="op" id="7108670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108676">msg</span><span class="op" id="7108679">,</span>&nbsp;<span class="ident" id="7108681">err</span>&nbsp;<span class="op" id="7108685">:=</span>&nbsp;<span class="ident" id="7108688"><a href="/net/smtp/smtp_test.go.html#7108366">tc</a></span><span class="op" id="7108690">.</span><span class="ident" id="7108691">ReadLine</span><span class="op" id="7108699">(</span><span class="op" id="7108700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108706"><a href="/net/smtp/smtp_test.go.html#7107964">bcmdbuf</a></span><span class="op" id="7108713">.</span><span class="ident" id="7108714">Write</span><span class="op" id="7108719">(</span><span class="op" id="7108720">[</span><span class="op" id="7108721">]</span><span class="builtintype" id="7108722">byte</span><span class="op" id="7108726">(</span><span class="ident" id="7108727"><a href="/net/smtp/smtp_test.go.html#7108676">msg</a></span>&nbsp;<span class="op" id="7108731">+</span>&nbsp;<span class="string" id="7108733">&#34;\r\n&#34;</span><span class="op" id="7108739">)</span><span class="op" id="7108740">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108746"><a href="/net/smtp/smtp_test.go.html#7108614">read</a></span>&nbsp;<span class="op" id="7108751">=</span>&nbsp;<span class="builtintype" id="7108753">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108762">if</span>&nbsp;<span class="ident" id="7108765"><a href="/net/smtp/smtp_test.go.html#7108681">err</a></span>&nbsp;<span class="op" id="7108769">!=</span>&nbsp;<span class="ident" id="7108772">nil</span>&nbsp;<span class="op" id="7108776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108783"><a href="/net/smtp/smtp_test.go.html#7107784">t</a></span><span class="op" id="7108784">.</span><span class="ident" id="7108785">Errorf</span><span class="op" id="7108791">(</span><span class="string" id="7108792">&#34;Read&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7108808">,</span>&nbsp;<span class="ident" id="7108810"><a href="/net/smtp/smtp_test.go.html#7108681">err</a></span><span class="op" id="7108813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108820">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108831">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108837">if</span>&nbsp;<span class="ident" id="7108840"><a href="/net/smtp/smtp_test.go.html#7108208">data</a></span><span class="op" id="7108844">[</span><span class="ident" id="7108845"><a href="/net/smtp/smtp_test.go.html#7108402">i</a></span><span class="op" id="7108846">]</span>&nbsp;<span class="op" id="7108848">==</span>&nbsp;<span class="string" id="7108851">&#34;354&nbsp;Go&nbsp;ahead&#34;</span>&nbsp;<span class="op" id="7108866">&amp;&amp;</span>&nbsp;<span class="ident" id="7108869"><a href="/net/smtp/smtp_test.go.html#7108676">msg</a></span>&nbsp;<span class="op" id="7108873">==</span>&nbsp;<span class="string" id="7108876">&#34;.&#34;</span>&nbsp;<span class="op" id="7108880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108887">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108906">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108909">}</span><span class="op" id="7108910">(</span><span class="ident" id="7108911"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7108918">.</span><span class="ident" id="7108919">Split</span><span class="op" id="7108924">(</span><span class="ident" id="7108925"><a href="/net/smtp/smtp_test.go.html#7107801">server</a></span><span class="op" id="7108931">,</span>&nbsp;<span class="string" id="7108933">&#34;\r\n&#34;</span><span class="op" id="7108939">)</span><span class="op" id="7108940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108944"><a href="/net/smtp/smtp_test.go.html#7108004">err</a></span>&nbsp;<span class="op" id="7108948">=</span>&nbsp;<span class="ident" id="7108950"><a href="/net/smtp/smtp.go.html#6339136">SendMail</a></span><span class="op" id="7108958">(</span><span class="ident" id="7108959"><a href="/net/smtp/smtp_test.go.html#7108001">l</a></span><span class="op" id="7108960">.</span><span class="ident" id="7108961">Addr</span><span class="op" id="7108965">(</span><span class="op" id="7108966">)</span><span class="op" id="7108967">.</span><span class="ident" id="7108968">String</span><span class="op" id="7108974">(</span><span class="op" id="7108975">)</span><span class="op" id="7108976">,</span>&nbsp;<span class="ident" id="7108978">nil</span><span class="op" id="7108981">,</span>&nbsp;<span class="string" id="7108983">&#34;test@example.com&#34;</span><span class="op" id="7109001">,</span>&nbsp;<span class="op" id="7109003">[</span><span class="op" id="7109004">]</span><span class="builtintype" id="7109005">string</span><span class="op" id="7109011">{</span><span class="string" id="7109012">&#34;other@example.com&#34;</span><span class="op" id="7109031">}</span><span class="op" id="7109032">,</span>&nbsp;<span class="op" id="7109034">[</span><span class="op" id="7109035">]</span><span class="builtintype" id="7109036">byte</span><span class="op" id="7109040">(</span><span class="ident" id="7109041"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7109048">.</span><span class="ident" id="7109049">Replace</span><span class="op" id="7109056">(</span><span class="string" id="7109057">`From:&nbsp;test@example.com<br>
<span class="lineno"></span>To:&nbsp;other@example.com<br>
<span class="lineno"></span>Subject:&nbsp;SendMail&nbsp;test<br>
<span class="lineno">470</span><br>
<span class="lineno"></span>SendMail&nbsp;is&nbsp;working&nbsp;for&nbsp;me.<br>
<span class="lineno"></span>`</span><span class="op" id="7109156">,</span>&nbsp;<span class="string" id="7109158">&#34;\n&#34;</span><span class="op" id="7109162">,</span>&nbsp;<span class="string" id="7109164">&#34;\r\n&#34;</span><span class="op" id="7109170">,</span>&nbsp;<span class="op" id="7109172">-</span><span class="num" id="7109173">1</span><span class="op" id="7109174">)</span><span class="op" id="7109175">)</span><span class="op" id="7109176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109180">if</span>&nbsp;<span class="ident" id="7109183"><a href="/net/smtp/smtp_test.go.html#7108004">err</a></span>&nbsp;<span class="op" id="7109187">!=</span>&nbsp;<span class="ident" id="7109190">nil</span>&nbsp;<span class="op" id="7109194">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109198"><a href="/net/smtp/smtp_test.go.html#7107784">t</a></span><span class="op" id="7109199">.</span><span class="ident" id="7109200">Errorf</span><span class="op" id="7109206">(</span><span class="string" id="7109207">&#34;%v&#34;</span><span class="op" id="7109211">,</span>&nbsp;<span class="ident" id="7109213"><a href="/net/smtp/smtp_test.go.html#7108004">err</a></span><span class="op" id="7109216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109223">&lt;-</span><span class="ident" id="7109225"><a href="/net/smtp/smtp_test.go.html#7108172">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109231"><a href="/net/smtp/smtp_test.go.html#7107964">bcmdbuf</a></span><span class="op" id="7109238">.</span><span class="ident" id="7109239">Flush</span><span class="op" id="7109244">(</span><span class="op" id="7109245">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109248">actualcmds</span>&nbsp;<span class="op" id="7109259">:=</span>&nbsp;<span class="ident" id="7109262"><a href="/net/smtp/smtp_test.go.html#7107943">cmdbuf</a></span><span class="op" id="7109268">.</span><span class="ident" id="7109269">String</span><span class="op" id="7109275">(</span><span class="op" id="7109276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109279">if</span>&nbsp;<span class="ident" id="7109282"><a href="/net/smtp/smtp_test.go.html#7107870">client</a></span>&nbsp;<span class="op" id="7109289">!=</span>&nbsp;<span class="ident" id="7109292"><a href="/net/smtp/smtp_test.go.html#7109248">actualcmds</a></span>&nbsp;<span class="op" id="7109303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109307"><a href="/net/smtp/smtp_test.go.html#7107784">t</a></span><span class="op" id="7109308">.</span><span class="ident" id="7109309">Errorf</span><span class="op" id="7109315">(</span><span class="string" id="7109316">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7109341">,</span>&nbsp;<span class="ident" id="7109343"><a href="/net/smtp/smtp_test.go.html#7109248">actualcmds</a></span><span class="op" id="7109353">,</span>&nbsp;<span class="ident" id="7109355"><a href="/net/smtp/smtp_test.go.html#7107870">client</a></span><span class="op" id="7109361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109364">}</span><br>
<span class="lineno"></span><span class="op" id="7109366">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="keyword" id="7109369">var</span>&nbsp;<span class="ident" id="7109373">sendMailServer</span>&nbsp;<span class="op" id="7109388">=</span>&nbsp;<span class="string" id="7109390">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>502&nbsp;EH?<br>
<span class="lineno"></span>250&nbsp;mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;Sender&nbsp;ok<br>
<span class="lineno">490</span>250&nbsp;Receiver&nbsp;ok<br>
<span class="lineno"></span>354&nbsp;Go&nbsp;ahead<br>
<span class="lineno"></span>250&nbsp;Data&nbsp;ok<br>
<span class="lineno"></span>221&nbsp;Goodbye<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="7109519">var</span>&nbsp;<span class="ident" id="7109523">sendMailClient</span>&nbsp;<span class="op" id="7109538">=</span>&nbsp;<span class="string" id="7109540">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>HELO&nbsp;localhost<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;test@example.com&gt;<br>
<span class="lineno"></span>RCPT&nbsp;TO:&lt;other@example.com&gt;<br>
<span class="lineno">500</span>DATA<br>
<span class="lineno"></span>From:&nbsp;test@example.com<br>
<span class="lineno"></span>To:&nbsp;other@example.com<br>
<span class="lineno"></span>Subject:&nbsp;SendMail&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">505</span>SendMail&nbsp;is&nbsp;working&nbsp;for&nbsp;me.<br>
<span class="lineno"></span>.<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="7109740">func</span>&nbsp;<span class="ident" id="7109745">TestAuthFailed</span><span class="op" id="7109759">(</span><span class="ident" id="7109760">t</span>&nbsp;<span class="op" id="7109762">*</span><span class="ident" id="7109763"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7109770">.</span><span class="ident" id="7109771">T</span><span class="op" id="7109772">)</span>&nbsp;<span class="op" id="7109774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109777">server</span>&nbsp;<span class="op" id="7109784">:=</span>&nbsp;<span class="ident" id="7109787"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7109794">.</span><span class="ident" id="7109795">Join</span><span class="op" id="7109799">(</span><span class="ident" id="7109800"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7109807">.</span><span class="ident" id="7109808">Split</span><span class="op" id="7109813">(</span><span class="ident" id="7109814"><a href="/net/smtp/smtp_test.go.html#7110706">authFailedServer</a></span><span class="op" id="7109830">,</span>&nbsp;<span class="string" id="7109832">&#34;\n&#34;</span><span class="op" id="7109836">)</span><span class="op" id="7109837">,</span>&nbsp;<span class="string" id="7109839">&#34;\r\n&#34;</span><span class="op" id="7109845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109848">client</span>&nbsp;<span class="op" id="7109855">:=</span>&nbsp;<span class="ident" id="7109858"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7109865">.</span><span class="ident" id="7109866">Join</span><span class="op" id="7109870">(</span><span class="ident" id="7109871"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7109878">.</span><span class="ident" id="7109879">Split</span><span class="op" id="7109884">(</span><span class="ident" id="7109885"><a href="/net/smtp/smtp_test.go.html#7110871">authFailedClient</a></span><span class="op" id="7109901">,</span>&nbsp;<span class="string" id="7109903">&#34;\n&#34;</span><span class="op" id="7109907">)</span><span class="op" id="7109908">,</span>&nbsp;<span class="string" id="7109910">&#34;\r\n&#34;</span><span class="op" id="7109916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109919">var</span>&nbsp;<span class="ident" id="7109923">cmdbuf</span>&nbsp;<span class="ident" id="7109930"><a href="/net/smtp/smtp_test.go.html#7098065">bytes</a></span><span class="op" id="7109935">.</span><span class="ident" id="7109936">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109944">bcmdbuf</span>&nbsp;<span class="op" id="7109952">:=</span>&nbsp;<span class="ident" id="7109955"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7109960">.</span><span class="ident" id="7109961">NewWriter</span><span class="op" id="7109970">(</span><span class="op" id="7109971">&amp;</span><span class="ident" id="7109972"><a href="/net/smtp/smtp_test.go.html#7109923">cmdbuf</a></span><span class="op" id="7109978">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109981">var</span>&nbsp;<span class="ident" id="7109985">fake</span>&nbsp;<span class="ident" id="7109990"><a href="/net/smtp/smtp_test.go.html#7100230">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109997"><a href="/net/smtp/smtp_test.go.html#7109985">fake</a></span><span class="op" id="7110001">.</span><span class="ident" id="7110002">ReadWriter</span>&nbsp;<span class="op" id="7110013">=</span>&nbsp;<span class="ident" id="7110015"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7110020">.</span><span class="ident" id="7110021">NewReadWriter</span><span class="op" id="7110034">(</span><span class="ident" id="7110035"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7110040">.</span><span class="ident" id="7110041">NewReader</span><span class="op" id="7110050">(</span><span class="ident" id="7110051"><a href="/net/smtp/smtp_test.go.html#7098133">strings</a></span><span class="op" id="7110058">.</span><span class="ident" id="7110059">NewReader</span><span class="op" id="7110068">(</span><span class="ident" id="7110069"><a href="/net/smtp/smtp_test.go.html#7109777">server</a></span><span class="op" id="7110075">)</span><span class="op" id="7110076">)</span><span class="op" id="7110077">,</span>&nbsp;<span class="ident" id="7110079"><a href="/net/smtp/smtp_test.go.html#7109944">bcmdbuf</a></span><span class="op" id="7110086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110089">c</span><span class="op" id="7110090">,</span>&nbsp;<span class="ident" id="7110092">err</span>&nbsp;<span class="op" id="7110096">:=</span>&nbsp;<span class="ident" id="7110099"><a href="/net/smtp/smtp.go.html#6333119">NewClient</a></span><span class="op" id="7110108">(</span><span class="ident" id="7110109"><a href="/net/smtp/smtp_test.go.html#7109985">fake</a></span><span class="op" id="7110113">,</span>&nbsp;<span class="string" id="7110115">&#34;fake.host&#34;</span><span class="op" id="7110126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110129">if</span>&nbsp;<span class="ident" id="7110132"><a href="/net/smtp/smtp_test.go.html#7110092">err</a></span>&nbsp;<span class="op" id="7110136">!=</span>&nbsp;<span class="ident" id="7110139">nil</span>&nbsp;<span class="op" id="7110143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110147"><a href="/net/smtp/smtp_test.go.html#7109760">t</a></span><span class="op" id="7110148">.</span><span class="ident" id="7110149">Fatalf</span><span class="op" id="7110155">(</span><span class="string" id="7110156">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7110171">,</span>&nbsp;<span class="ident" id="7110173"><a href="/net/smtp/smtp_test.go.html#7110092">err</a></span><span class="op" id="7110176">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110182">defer</span>&nbsp;<span class="ident" id="7110188"><a href="/net/smtp/smtp_test.go.html#7110089">c</a></span><span class="op" id="7110189">.</span><span class="ident" id="7110190">Close</span><span class="op" id="7110195">(</span><span class="op" id="7110196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110200"><a href="/net/smtp/smtp_test.go.html#7110089">c</a></span><span class="op" id="7110201">.</span><span class="ident" id="7110202">tls</span>&nbsp;<span class="op" id="7110206">=</span>&nbsp;<span class="builtintype" id="7110208">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110214"><a href="/net/smtp/smtp_test.go.html#7110089">c</a></span><span class="op" id="7110215">.</span><span class="ident" id="7110216">serverName</span>&nbsp;<span class="op" id="7110227">=</span>&nbsp;<span class="string" id="7110229">&#34;smtp.google.com&#34;</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110248"><a href="/net/smtp/smtp_test.go.html#7110092">err</a></span>&nbsp;<span class="op" id="7110252">=</span>&nbsp;<span class="ident" id="7110254"><a href="/net/smtp/smtp_test.go.html#7110089">c</a></span><span class="op" id="7110255">.</span><span class="ident" id="7110256">Auth</span><span class="op" id="7110260">(</span><span class="ident" id="7110261"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7110270">(</span><span class="string" id="7110271">&#34;&#34;</span><span class="op" id="7110273">,</span>&nbsp;<span class="string" id="7110275">&#34;user&#34;</span><span class="op" id="7110281">,</span>&nbsp;<span class="string" id="7110283">&#34;pass&#34;</span><span class="op" id="7110289">,</span>&nbsp;<span class="string" id="7110291">&#34;smtp.google.com&#34;</span><span class="op" id="7110308">)</span><span class="op" id="7110309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110313">if</span>&nbsp;<span class="ident" id="7110316"><a href="/net/smtp/smtp_test.go.html#7110092">err</a></span>&nbsp;<span class="op" id="7110320">==</span>&nbsp;<span class="ident" id="7110323">nil</span>&nbsp;<span class="op" id="7110327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110331"><a href="/net/smtp/smtp_test.go.html#7109760">t</a></span><span class="op" id="7110332">.</span><span class="ident" id="7110333">Error</span><span class="op" id="7110338">(</span><span class="string" id="7110339">&#34;Auth:&nbsp;expected&nbsp;error;&nbsp;got&nbsp;none&#34;</span><span class="op" id="7110371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110374">}</span>&nbsp;<span class="keyword" id="7110376">else</span>&nbsp;<span class="keyword" id="7110381">if</span>&nbsp;<span class="ident" id="7110384"><a href="/net/smtp/smtp_test.go.html#7110092">err</a></span><span class="op" id="7110387">.</span><span class="ident" id="7110388">Error</span><span class="op" id="7110393">(</span><span class="op" id="7110394">)</span>&nbsp;<span class="op" id="7110396">!=</span>&nbsp;<span class="string" id="7110399">&#34;535&nbsp;Invalid&nbsp;credentials\nplease&nbsp;see&nbsp;www.example.com&#34;</span>&nbsp;<span class="op" id="7110453">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110457"><a href="/net/smtp/smtp_test.go.html#7109760">t</a></span><span class="op" id="7110458">.</span><span class="ident" id="7110459">Errorf</span><span class="op" id="7110465">(</span><span class="string" id="7110466">&#34;Auth:&nbsp;got&nbsp;error:&nbsp;%v,&nbsp;want:&nbsp;%s&#34;</span><span class="op" id="7110497">,</span>&nbsp;<span class="ident" id="7110499"><a href="/net/smtp/smtp_test.go.html#7110092">err</a></span><span class="op" id="7110502">,</span>&nbsp;<span class="string" id="7110504">&#34;535&nbsp;Invalid&nbsp;credentials\nplease&nbsp;see&nbsp;www.example.com&#34;</span><span class="op" id="7110557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110564"><a href="/net/smtp/smtp_test.go.html#7109944">bcmdbuf</a></span><span class="op" id="7110571">.</span><span class="ident" id="7110572">Flush</span><span class="op" id="7110577">(</span><span class="op" id="7110578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110581">actualcmds</span>&nbsp;<span class="op" id="7110592">:=</span>&nbsp;<span class="ident" id="7110595"><a href="/net/smtp/smtp_test.go.html#7109923">cmdbuf</a></span><span class="op" id="7110601">.</span><span class="ident" id="7110602">String</span><span class="op" id="7110608">(</span><span class="op" id="7110609">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110612">if</span>&nbsp;<span class="ident" id="7110615"><a href="/net/smtp/smtp_test.go.html#7109848">client</a></span>&nbsp;<span class="op" id="7110622">!=</span>&nbsp;<span class="ident" id="7110625"><a href="/net/smtp/smtp_test.go.html#7110581">actualcmds</a></span>&nbsp;<span class="op" id="7110636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110640"><a href="/net/smtp/smtp_test.go.html#7109760">t</a></span><span class="op" id="7110641">.</span><span class="ident" id="7110642">Errorf</span><span class="op" id="7110648">(</span><span class="string" id="7110649">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7110674">,</span>&nbsp;<span class="ident" id="7110676"><a href="/net/smtp/smtp_test.go.html#7110581">actualcmds</a></span><span class="op" id="7110686">,</span>&nbsp;<span class="ident" id="7110688"><a href="/net/smtp/smtp_test.go.html#7109848">client</a></span><span class="op" id="7110694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110697">}</span><br>
<span class="lineno"></span><span class="op" id="7110699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="keyword" id="7110702">var</span>&nbsp;<span class="ident" id="7110706">authFailedServer</span>&nbsp;<span class="op" id="7110723">=</span>&nbsp;<span class="string" id="7110725">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>535-Invalid&nbsp;credentials<br>
<span class="lineno"></span>535&nbsp;please&nbsp;see&nbsp;www.example.com<br>
<span class="lineno">545</span>221&nbsp;Goodbye<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7110867">var</span>&nbsp;<span class="ident" id="7110871">authFailedClient</span>&nbsp;<span class="op" id="7110888">=</span>&nbsp;<span class="string" id="7110890">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==<br>
<span class="lineno">550</span>*<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7110944">func</span>&nbsp;<span class="ident" id="7110949">TestTLSClient</span><span class="op" id="7110962">(</span><span class="ident" id="7110963">t</span>&nbsp;<span class="op" id="7110965">*</span><span class="ident" id="7110966"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7110973">.</span><span class="ident" id="7110974">T</span><span class="op" id="7110975">)</span>&nbsp;<span class="op" id="7110977">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110980">ln</span>&nbsp;<span class="op" id="7110983">:=</span>&nbsp;<span class="ident" id="7110986"><a href="/net/smtp/smtp_test.go.html#7111404">newLocalListener</a></span><span class="op" id="7111002">(</span><span class="ident" id="7111003"><a href="/net/smtp/smtp_test.go.html#7110963">t</a></span><span class="op" id="7111004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111007">defer</span>&nbsp;<span class="ident" id="7111013"><a href="/net/smtp/smtp_test.go.html#7110980">ln</a></span><span class="op" id="7111015">.</span><span class="ident" id="7111016">Close</span><span class="op" id="7111021">(</span><span class="op" id="7111022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111025">errc</span>&nbsp;<span class="op" id="7111030">:=</span>&nbsp;<span class="builtinfunc" id="7111033">make</span><span class="op" id="7111037">(</span><span class="keyword" id="7111038">chan</span>&nbsp;<span class="builtintype" id="7111043">error</span><span class="op" id="7111048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111051">go</span>&nbsp;<span class="keyword" id="7111054">func</span><span class="op" id="7111058">(</span><span class="op" id="7111059">)</span>&nbsp;<span class="op" id="7111061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111065"><a href="/net/smtp/smtp_test.go.html#7111025">errc</a></span>&nbsp;<span class="op" id="7111070">&lt;-</span>&nbsp;<span class="ident" id="7111073"><a href="/net/smtp/smtp_test.go.html#7113293">sendMail</a></span><span class="op" id="7111081">(</span><span class="ident" id="7111082"><a href="/net/smtp/smtp_test.go.html#7110980">ln</a></span><span class="op" id="7111084">.</span><span class="ident" id="7111085">Addr</span><span class="op" id="7111089">(</span><span class="op" id="7111090">)</span><span class="op" id="7111091">.</span><span class="ident" id="7111092">String</span><span class="op" id="7111098">(</span><span class="op" id="7111099">)</span><span class="op" id="7111100">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111103">}</span><span class="op" id="7111104">(</span><span class="op" id="7111105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111108">conn</span><span class="op" id="7111112">,</span>&nbsp;<span class="ident" id="7111114">err</span>&nbsp;<span class="op" id="7111118">:=</span>&nbsp;<span class="ident" id="7111121"><a href="/net/smtp/smtp_test.go.html#7110980">ln</a></span><span class="op" id="7111123">.</span><span class="ident" id="7111124">Accept</span><span class="op" id="7111130">(</span><span class="op" id="7111131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111134">if</span>&nbsp;<span class="ident" id="7111137"><a href="/net/smtp/smtp_test.go.html#7111114">err</a></span>&nbsp;<span class="op" id="7111141">!=</span>&nbsp;<span class="ident" id="7111144">nil</span>&nbsp;<span class="op" id="7111148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111152"><a href="/net/smtp/smtp_test.go.html#7110963">t</a></span><span class="op" id="7111153">.</span><span class="ident" id="7111154">Fatalf</span><span class="op" id="7111160">(</span><span class="string" id="7111161">&#34;failed&nbsp;to&nbsp;accept&nbsp;connection:&nbsp;%v&#34;</span><span class="op" id="7111194">,</span>&nbsp;<span class="ident" id="7111196"><a href="/net/smtp/smtp_test.go.html#7111114">err</a></span><span class="op" id="7111199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111202">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111205">defer</span>&nbsp;<span class="ident" id="7111211"><a href="/net/smtp/smtp_test.go.html#7111108">conn</a></span><span class="op" id="7111215">.</span><span class="ident" id="7111216">Close</span><span class="op" id="7111221">(</span><span class="op" id="7111222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111225">if</span>&nbsp;<span class="ident" id="7111228">err</span>&nbsp;<span class="op" id="7111232">:=</span>&nbsp;<span class="ident" id="7111235"><a href="/net/smtp/smtp_test.go.html#7111789">serverHandle</a></span><span class="op" id="7111247">(</span><span class="ident" id="7111248"><a href="/net/smtp/smtp_test.go.html#7111108">conn</a></span><span class="op" id="7111252">,</span>&nbsp;<span class="ident" id="7111254"><a href="/net/smtp/smtp_test.go.html#7110963">t</a></span><span class="op" id="7111255">)</span><span class="op" id="7111256">;</span>&nbsp;<span class="ident" id="7111258"><a href="/net/smtp/smtp_test.go.html#7111228">err</a></span>&nbsp;<span class="op" id="7111262">!=</span>&nbsp;<span class="ident" id="7111265">nil</span>&nbsp;<span class="op" id="7111269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111273"><a href="/net/smtp/smtp_test.go.html#7110963">t</a></span><span class="op" id="7111274">.</span><span class="ident" id="7111275">Fatalf</span><span class="op" id="7111281">(</span><span class="string" id="7111282">&#34;failed&nbsp;to&nbsp;handle&nbsp;connection:&nbsp;%v&#34;</span><span class="op" id="7111315">,</span>&nbsp;<span class="ident" id="7111317"><a href="/net/smtp/smtp_test.go.html#7111228">err</a></span><span class="op" id="7111320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111326">if</span>&nbsp;<span class="ident" id="7111329">err</span>&nbsp;<span class="op" id="7111333">:=</span>&nbsp;<span class="op" id="7111336">&lt;-</span><span class="ident" id="7111338"><a href="/net/smtp/smtp_test.go.html#7111025">errc</a></span><span class="op" id="7111342">;</span>&nbsp;<span class="ident" id="7111344"><a href="/net/smtp/smtp_test.go.html#7111329">err</a></span>&nbsp;<span class="op" id="7111348">!=</span>&nbsp;<span class="ident" id="7111351">nil</span>&nbsp;<span class="op" id="7111355">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111359"><a href="/net/smtp/smtp_test.go.html#7110963">t</a></span><span class="op" id="7111360">.</span><span class="ident" id="7111361">Fatalf</span><span class="op" id="7111367">(</span><span class="string" id="7111368">&#34;client&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7111386">,</span>&nbsp;<span class="ident" id="7111388"><a href="/net/smtp/smtp_test.go.html#7111329">err</a></span><span class="op" id="7111391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111394">}</span><br>
<span class="lineno"></span><span class="op" id="7111396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111399">func</span>&nbsp;<span class="ident" id="7111404">newLocalListener</span><span class="op" id="7111420">(</span><span class="ident" id="7111421">t</span>&nbsp;<span class="op" id="7111423">*</span><span class="ident" id="7111424"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7111431">.</span><span class="ident" id="7111432">T</span><span class="op" id="7111433">)</span>&nbsp;<span class="ident" id="7111435"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7111438">.</span><span class="ident" id="7111439">Listener</span>&nbsp;<span class="op" id="7111448">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111451">ln</span><span class="op" id="7111453">,</span>&nbsp;<span class="ident" id="7111455">err</span>&nbsp;<span class="op" id="7111459">:=</span>&nbsp;<span class="ident" id="7111462"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7111465">.</span><span class="ident" id="7111466">Listen</span><span class="op" id="7111472">(</span><span class="string" id="7111473">&#34;tcp&#34;</span><span class="op" id="7111478">,</span>&nbsp;<span class="string" id="7111480">&#34;127.0.0.1:0&#34;</span><span class="op" id="7111493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111496">if</span>&nbsp;<span class="ident" id="7111499"><a href="/net/smtp/smtp_test.go.html#7111455">err</a></span>&nbsp;<span class="op" id="7111503">!=</span>&nbsp;<span class="ident" id="7111506">nil</span>&nbsp;<span class="op" id="7111510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111514"><a href="/net/smtp/smtp_test.go.html#7111451">ln</a></span><span class="op" id="7111516">,</span>&nbsp;<span class="ident" id="7111518"><a href="/net/smtp/smtp_test.go.html#7111455">err</a></span>&nbsp;<span class="op" id="7111522">=</span>&nbsp;<span class="ident" id="7111524"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7111527">.</span><span class="ident" id="7111528">Listen</span><span class="op" id="7111534">(</span><span class="string" id="7111535">&#34;tcp6&#34;</span><span class="op" id="7111541">,</span>&nbsp;<span class="string" id="7111543">&#34;[::1]:0&#34;</span><span class="op" id="7111552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111558">if</span>&nbsp;<span class="ident" id="7111561"><a href="/net/smtp/smtp_test.go.html#7111455">err</a></span>&nbsp;<span class="op" id="7111565">!=</span>&nbsp;<span class="ident" id="7111568">nil</span>&nbsp;<span class="op" id="7111572">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111576"><a href="/net/smtp/smtp_test.go.html#7111421">t</a></span><span class="op" id="7111577">.</span><span class="ident" id="7111578">Fatal</span><span class="op" id="7111583">(</span><span class="ident" id="7111584"><a href="/net/smtp/smtp_test.go.html#7111455">err</a></span><span class="op" id="7111587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111593">return</span>&nbsp;<span class="ident" id="7111600"><a href="/net/smtp/smtp_test.go.html#7111451">ln</a></span><br>
<span class="lineno"></span><span class="op" id="7111603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="7111606">type</span>&nbsp;<span class="ident" id="7111611">smtpSender</span>&nbsp;<span class="keyword" id="7111622">struct</span>&nbsp;<span class="op" id="7111629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111632">w</span>&nbsp;<span class="ident" id="7111634"><a href="/net/smtp/smtp_test.go.html#7098103">io</a></span><span class="op" id="7111636">.</span><span class="ident" id="7111637">Writer</span><br>
<span class="lineno"></span><span class="op" id="7111644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111647">func</span>&nbsp;<span class="op" id="7111652">(</span><span class="ident" id="7111653">s</span>&nbsp;<span class="ident" id="7111655"><a href="/net/smtp/smtp_test.go.html#7111611">smtpSender</a></span><span class="op" id="7111665">)</span>&nbsp;<span class="ident" id="7111667">send</span><span class="op" id="7111671">(</span><span class="ident" id="7111672">f</span>&nbsp;<span class="builtintype" id="7111674">string</span><span class="op" id="7111680">)</span>&nbsp;<span class="op" id="7111682">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111685"><a href="/net/smtp/smtp_test.go.html#7111653">s</a></span><span class="op" id="7111686">.</span><span class="ident" id="7111687">w</span><span class="op" id="7111688">.</span><span class="ident" id="7111689">Write</span><span class="op" id="7111694">(</span><span class="op" id="7111695">[</span><span class="op" id="7111696">]</span><span class="builtintype" id="7111697">byte</span><span class="op" id="7111701">(</span><span class="ident" id="7111702"><a href="/net/smtp/smtp_test.go.html#7111672">f</a></span>&nbsp;<span class="op" id="7111704">+</span>&nbsp;<span class="string" id="7111706">&#34;\r\n&#34;</span><span class="op" id="7111712">)</span><span class="op" id="7111713">)</span><br>
<span class="lineno"></span><span class="op" id="7111715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7111718">//&nbsp;smtp&nbsp;server,&nbsp;finely&nbsp;tailored&nbsp;to&nbsp;deal&nbsp;with&nbsp;our&nbsp;own&nbsp;client&nbsp;only!</span><br>
<span class="lineno"></span><span class="keyword" id="7111784">func</span>&nbsp;<span class="ident" id="7111789">serverHandle</span><span class="op" id="7111801">(</span><span class="ident" id="7111802">c</span>&nbsp;<span class="ident" id="7111804"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7111807">.</span><span class="ident" id="7111808">Conn</span><span class="op" id="7111812">,</span>&nbsp;<span class="ident" id="7111814">t</span>&nbsp;<span class="op" id="7111816">*</span><span class="ident" id="7111817"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7111824">.</span><span class="ident" id="7111825">T</span><span class="op" id="7111826">)</span>&nbsp;<span class="builtintype" id="7111828">error</span>&nbsp;<span class="op" id="7111834">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111837">send</span>&nbsp;<span class="op" id="7111842">:=</span>&nbsp;<span class="ident" id="7111845"><a href="/net/smtp/smtp_test.go.html#7111611">smtpSender</a></span><span class="op" id="7111855">{</span><span class="ident" id="7111856"><a href="/net/smtp/smtp_test.go.html#7111802">c</a></span><span class="op" id="7111857">}</span><span class="op" id="7111858">.</span><span class="ident" id="7111859">send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111865"><a href="/net/smtp/smtp_test.go.html#7111837">send</a></span><span class="op" id="7111869">(</span><span class="string" id="7111870">&#34;220&nbsp;127.0.0.1&nbsp;ESMTP&nbsp;service&nbsp;ready&#34;</span><span class="op" id="7111905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111908">s</span>&nbsp;<span class="op" id="7111910">:=</span>&nbsp;<span class="ident" id="7111913"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7111918">.</span><span class="ident" id="7111919">NewScanner</span><span class="op" id="7111929">(</span><span class="ident" id="7111930"><a href="/net/smtp/smtp_test.go.html#7111802">c</a></span><span class="op" id="7111931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111934">for</span>&nbsp;<span class="ident" id="7111938"><a href="/net/smtp/smtp_test.go.html#7111908">s</a></span><span class="op" id="7111939">.</span><span class="ident" id="7111940">Scan</span><span class="op" id="7111944">(</span><span class="op" id="7111945">)</span>&nbsp;<span class="op" id="7111947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111951">switch</span>&nbsp;<span class="ident" id="7111958"><a href="/net/smtp/smtp_test.go.html#7111908">s</a></span><span class="op" id="7111959">.</span><span class="ident" id="7111960">Text</span><span class="op" id="7111964">(</span><span class="op" id="7111965">)</span>&nbsp;<span class="op" id="7111967">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111971">case</span>&nbsp;<span class="string" id="7111976">&#34;EHLO&nbsp;localhost&#34;</span><span class="op" id="7111992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111997"><a href="/net/smtp/smtp_test.go.html#7111837">send</a></span><span class="op" id="7112001">(</span><span class="string" id="7112002">&#34;250-127.0.0.1&nbsp;ESMTP&nbsp;offers&nbsp;a&nbsp;warm&nbsp;hug&nbsp;of&nbsp;welcome&#34;</span><span class="op" id="7112052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112057"><a href="/net/smtp/smtp_test.go.html#7111837">send</a></span><span class="op" id="7112061">(</span><span class="string" id="7112062">&#34;250-STARTTLS&#34;</span><span class="op" id="7112076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112081"><a href="/net/smtp/smtp_test.go.html#7111837">send</a></span><span class="op" id="7112085">(</span><span class="string" id="7112086">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7112094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112098">case</span>&nbsp;<span class="string" id="7112103">&#34;STARTTLS&#34;</span><span class="op" id="7112113">:</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112118"><a href="/net/smtp/smtp_test.go.html#7111837">send</a></span><span class="op" id="7112122">(</span><span class="string" id="7112123">&#34;220&nbsp;Go&nbsp;ahead&#34;</span><span class="op" id="7112137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112142">keypair</span><span class="op" id="7112149">,</span>&nbsp;<span class="ident" id="7112151">err</span>&nbsp;<span class="op" id="7112155">:=</span>&nbsp;<span class="ident" id="7112158"><a href="/net/smtp/smtp_test.go.html#7098074">tls</a></span><span class="op" id="7112161">.</span><span class="ident" id="7112162">X509KeyPair</span><span class="op" id="7112173">(</span><span class="ident" id="7112174"><a href="/net/smtp/smtp_test.go.html#7113944">localhostCert</a></span><span class="op" id="7112187">,</span>&nbsp;<span class="ident" id="7112189"><a href="/net/smtp/smtp_test.go.html#7114599">localhostKey</a></span><span class="op" id="7112201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112206">if</span>&nbsp;<span class="ident" id="7112209"><a href="/net/smtp/smtp_test.go.html#7112151">err</a></span>&nbsp;<span class="op" id="7112213">!=</span>&nbsp;<span class="ident" id="7112216">nil</span>&nbsp;<span class="op" id="7112220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112226">return</span>&nbsp;<span class="ident" id="7112233"><a href="/net/smtp/smtp_test.go.html#7112151">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112240">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112245">config</span>&nbsp;<span class="op" id="7112252">:=</span>&nbsp;<span class="op" id="7112255">&amp;</span><span class="ident" id="7112256"><a href="/net/smtp/smtp_test.go.html#7098074">tls</a></span><span class="op" id="7112259">.</span><span class="ident" id="7112260">Config</span><span class="op" id="7112266">{</span><span class="ident" id="7112267">Certificates</span><span class="op" id="7112279">:</span>&nbsp;<span class="op" id="7112281">[</span><span class="op" id="7112282">]</span><span class="ident" id="7112283"><a href="/net/smtp/smtp_test.go.html#7098074">tls</a></span><span class="op" id="7112286">.</span><span class="ident" id="7112287">Certificate</span><span class="op" id="7112298">{</span><span class="ident" id="7112299"><a href="/net/smtp/smtp_test.go.html#7112142">keypair</a></span><span class="op" id="7112306">}</span><span class="op" id="7112307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112312"><a href="/net/smtp/smtp_test.go.html#7111802">c</a></span>&nbsp;<span class="op" id="7112314">=</span>&nbsp;<span class="ident" id="7112316"><a href="/net/smtp/smtp_test.go.html#7098074">tls</a></span><span class="op" id="7112319">.</span><span class="ident" id="7112320">Server</span><span class="op" id="7112326">(</span><span class="ident" id="7112327"><a href="/net/smtp/smtp_test.go.html#7111802">c</a></span><span class="op" id="7112328">,</span>&nbsp;<span class="ident" id="7112330"><a href="/net/smtp/smtp_test.go.html#7112245">config</a></span><span class="op" id="7112336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112341">defer</span>&nbsp;<span class="ident" id="7112347"><a href="/net/smtp/smtp_test.go.html#7111802">c</a></span><span class="op" id="7112348">.</span><span class="ident" id="7112349">Close</span><span class="op" id="7112354">(</span><span class="op" id="7112355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112360">return</span>&nbsp;<span class="ident" id="7112367"><a href="/net/smtp/smtp_test.go.html#7112481">serverHandleTLS</a></span><span class="op" id="7112382">(</span><span class="ident" id="7112383"><a href="/net/smtp/smtp_test.go.html#7111802">c</a></span><span class="op" id="7112384">,</span>&nbsp;<span class="ident" id="7112386"><a href="/net/smtp/smtp_test.go.html#7111814">t</a></span><span class="op" id="7112387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112391">default</span><span class="op" id="7112398">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112403"><a href="/net/smtp/smtp_test.go.html#7111814">t</a></span><span class="op" id="7112404">.</span><span class="ident" id="7112405">Fatalf</span><span class="op" id="7112411">(</span><span class="string" id="7112412">&#34;unrecognized&nbsp;command:&nbsp;%q&#34;</span><span class="op" id="7112438">,</span>&nbsp;<span class="ident" id="7112440"><a href="/net/smtp/smtp_test.go.html#7111908">s</a></span><span class="op" id="7112441">.</span><span class="ident" id="7112442">Text</span><span class="op" id="7112446">(</span><span class="op" id="7112447">)</span><span class="op" id="7112448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112458">return</span>&nbsp;<span class="ident" id="7112465"><a href="/net/smtp/smtp_test.go.html#7111908">s</a></span><span class="op" id="7112466">.</span><span class="ident" id="7112467">Err</span><span class="op" id="7112470">(</span><span class="op" id="7112471">)</span><br>
<span class="lineno"></span><span class="op" id="7112473">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="7112476">func</span>&nbsp;<span class="ident" id="7112481">serverHandleTLS</span><span class="op" id="7112496">(</span><span class="ident" id="7112497">c</span>&nbsp;<span class="ident" id="7112499"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7112502">.</span><span class="ident" id="7112503">Conn</span><span class="op" id="7112507">,</span>&nbsp;<span class="ident" id="7112509">t</span>&nbsp;<span class="op" id="7112511">*</span><span class="ident" id="7112512"><a href="/net/smtp/smtp_test.go.html#7098144">testing</a></span><span class="op" id="7112519">.</span><span class="ident" id="7112520">T</span><span class="op" id="7112521">)</span>&nbsp;<span class="builtintype" id="7112523">error</span>&nbsp;<span class="op" id="7112529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112532">send</span>&nbsp;<span class="op" id="7112537">:=</span>&nbsp;<span class="ident" id="7112540"><a href="/net/smtp/smtp_test.go.html#7111611">smtpSender</a></span><span class="op" id="7112550">{</span><span class="ident" id="7112551"><a href="/net/smtp/smtp_test.go.html#7112497">c</a></span><span class="op" id="7112552">}</span><span class="op" id="7112553">.</span><span class="ident" id="7112554">send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112560">s</span>&nbsp;<span class="op" id="7112562">:=</span>&nbsp;<span class="ident" id="7112565"><a href="/net/smtp/smtp_test.go.html#7098056">bufio</a></span><span class="op" id="7112570">.</span><span class="ident" id="7112571">NewScanner</span><span class="op" id="7112581">(</span><span class="ident" id="7112582"><a href="/net/smtp/smtp_test.go.html#7112497">c</a></span><span class="op" id="7112583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112586">for</span>&nbsp;<span class="ident" id="7112590"><a href="/net/smtp/smtp_test.go.html#7112560">s</a></span><span class="op" id="7112591">.</span><span class="ident" id="7112592">Scan</span><span class="op" id="7112596">(</span><span class="op" id="7112597">)</span>&nbsp;<span class="op" id="7112599">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112603">switch</span>&nbsp;<span class="ident" id="7112610"><a href="/net/smtp/smtp_test.go.html#7112560">s</a></span><span class="op" id="7112611">.</span><span class="ident" id="7112612">Text</span><span class="op" id="7112616">(</span><span class="op" id="7112617">)</span>&nbsp;<span class="op" id="7112619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112623">case</span>&nbsp;<span class="string" id="7112628">&#34;EHLO&nbsp;localhost&#34;</span><span class="op" id="7112644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112649"><a href="/net/smtp/smtp_test.go.html#7112532">send</a></span><span class="op" id="7112653">(</span><span class="string" id="7112654">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7112662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112666">case</span>&nbsp;<span class="string" id="7112671">&#34;MAIL&nbsp;FROM:&lt;joe1@example.com&gt;&#34;</span><span class="op" id="7112701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112706"><a href="/net/smtp/smtp_test.go.html#7112532">send</a></span><span class="op" id="7112710">(</span><span class="string" id="7112711">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7112719">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112723">case</span>&nbsp;<span class="string" id="7112728">&#34;RCPT&nbsp;TO:&lt;joe2@example.com&gt;&#34;</span><span class="op" id="7112756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112761"><a href="/net/smtp/smtp_test.go.html#7112532">send</a></span><span class="op" id="7112765">(</span><span class="string" id="7112766">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7112774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112778">case</span>&nbsp;<span class="string" id="7112783">&#34;DATA&#34;</span><span class="op" id="7112789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112794"><a href="/net/smtp/smtp_test.go.html#7112532">send</a></span><span class="op" id="7112798">(</span><span class="string" id="7112799">&#34;354&nbsp;send&nbsp;the&nbsp;mail&nbsp;data,&nbsp;end&nbsp;with&nbsp;.&#34;</span><span class="op" id="7112835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112840"><a href="/net/smtp/smtp_test.go.html#7112532">send</a></span><span class="op" id="7112844">(</span><span class="string" id="7112845">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7112853">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112857">case</span>&nbsp;<span class="string" id="7112862">&#34;Subject:&nbsp;test&#34;</span><span class="op" id="7112877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112881">case</span>&nbsp;<span class="string" id="7112886">&#34;&#34;</span><span class="op" id="7112888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112892">case</span>&nbsp;<span class="string" id="7112897">&#34;howdy!&#34;</span><span class="op" id="7112905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112909">case</span>&nbsp;<span class="string" id="7112914">&#34;.&#34;</span><span class="op" id="7112917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112921">case</span>&nbsp;<span class="string" id="7112926">&#34;QUIT&#34;</span><span class="op" id="7112932">:</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112937"><a href="/net/smtp/smtp_test.go.html#7112532">send</a></span><span class="op" id="7112941">(</span><span class="string" id="7112942">&#34;221&nbsp;127.0.0.1&nbsp;Service&nbsp;closing&nbsp;transmission&nbsp;channel&#34;</span><span class="op" id="7112994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112999">return</span>&nbsp;<span class="ident" id="7113006">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7113012">default</span><span class="op" id="7113019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113024"><a href="/net/smtp/smtp_test.go.html#7112509">t</a></span><span class="op" id="7113025">.</span><span class="ident" id="7113026">Fatalf</span><span class="op" id="7113032">(</span><span class="string" id="7113033">&#34;unrecognized&nbsp;command&nbsp;during&nbsp;TLS:&nbsp;%q&#34;</span><span class="op" id="7113070">,</span>&nbsp;<span class="ident" id="7113072"><a href="/net/smtp/smtp_test.go.html#7112560">s</a></span><span class="op" id="7113073">.</span><span class="ident" id="7113074">Text</span><span class="op" id="7113078">(</span><span class="op" id="7113079">)</span><span class="op" id="7113080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7113084">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7113087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7113090">return</span>&nbsp;<span class="ident" id="7113097"><a href="/net/smtp/smtp_test.go.html#7112560">s</a></span><span class="op" id="7113098">.</span><span class="ident" id="7113099">Err</span><span class="op" id="7113102">(</span><span class="op" id="7113103">)</span><br>
<span class="lineno"></span><span class="op" id="7113105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7113108">func</span>&nbsp;<span class="ident" id="7113113">init</span><span class="op" id="7113117">(</span><span class="op" id="7113118">)</span>&nbsp;<span class="op" id="7113120">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113123">testRootCAs</span>&nbsp;<span class="op" id="7113135">:=</span>&nbsp;<span class="ident" id="7113138"><a href="/net/smtp/smtp_test.go.html#7098088">x509</a></span><span class="op" id="7113142">.</span><span class="ident" id="7113143">NewCertPool</span><span class="op" id="7113154">(</span><span class="op" id="7113155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113158"><a href="/net/smtp/smtp_test.go.html#7113123">testRootCAs</a></span><span class="op" id="7113169">.</span><span class="ident" id="7113170">AppendCertsFromPEM</span><span class="op" id="7113188">(</span><span class="ident" id="7113189"><a href="/net/smtp/smtp_test.go.html#7113944">localhostCert</a></span><span class="op" id="7113202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113205"><a href="/net/smtp/smtp.go.html#6338853">testHookStartTLS</a></span>&nbsp;<span class="op" id="7113222">=</span>&nbsp;<span class="keyword" id="7113224">func</span><span class="op" id="7113228">(</span><span class="ident" id="7113229">config</span>&nbsp;<span class="op" id="7113236">*</span><span class="ident" id="7113237"><a href="/net/smtp/smtp_test.go.html#7098074">tls</a></span><span class="op" id="7113240">.</span><span class="ident" id="7113241">Config</span><span class="op" id="7113247">)</span>&nbsp;<span class="op" id="7113249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113253"><a href="/net/smtp/smtp_test.go.html#7113229">config</a></span><span class="op" id="7113259">.</span><span class="ident" id="7113260">RootCAs</span>&nbsp;<span class="op" id="7113268">=</span>&nbsp;<span class="ident" id="7113270"><a href="/net/smtp/smtp_test.go.html#7113123">testRootCAs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7113283">}</span><br>
<span class="lineno">655</span><span class="op" id="7113285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7113288">func</span>&nbsp;<span class="ident" id="7113293">sendMail</span><span class="op" id="7113301">(</span><span class="ident" id="7113302">hostPort</span>&nbsp;<span class="builtintype" id="7113311">string</span><span class="op" id="7113317">)</span>&nbsp;<span class="builtintype" id="7113319">error</span>&nbsp;<span class="op" id="7113325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113328">host</span><span class="op" id="7113332">,</span>&nbsp;<span class="ident" id="7113334">_</span><span class="op" id="7113335">,</span>&nbsp;<span class="ident" id="7113337">err</span>&nbsp;<span class="op" id="7113341">:=</span>&nbsp;<span class="ident" id="7113344"><a href="/net/smtp/smtp_test.go.html#7098109">net</a></span><span class="op" id="7113347">.</span><span class="ident" id="7113348">SplitHostPort</span><span class="op" id="7113361">(</span><span class="ident" id="7113362"><a href="/net/smtp/smtp_test.go.html#7113302">hostPort</a></span><span class="op" id="7113370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7113373">if</span>&nbsp;<span class="ident" id="7113376"><a href="/net/smtp/smtp_test.go.html#7113337">err</a></span>&nbsp;<span class="op" id="7113380">!=</span>&nbsp;<span class="ident" id="7113383">nil</span>&nbsp;<span class="op" id="7113387">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7113391">return</span>&nbsp;<span class="ident" id="7113398"><a href="/net/smtp/smtp_test.go.html#7113337">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7113403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113406">auth</span>&nbsp;<span class="op" id="7113411">:=</span>&nbsp;<span class="ident" id="7113414"><a href="/net/smtp/auth.go.html#6329953">PlainAuth</a></span><span class="op" id="7113423">(</span><span class="string" id="7113424">&#34;&#34;</span><span class="op" id="7113426">,</span>&nbsp;<span class="string" id="7113428">&#34;&#34;</span><span class="op" id="7113430">,</span>&nbsp;<span class="string" id="7113432">&#34;&#34;</span><span class="op" id="7113434">,</span>&nbsp;<span class="ident" id="7113436"><a href="/net/smtp/smtp_test.go.html#7113328">host</a></span><span class="op" id="7113440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113443">from</span>&nbsp;<span class="op" id="7113448">:=</span>&nbsp;<span class="string" id="7113451">&#34;joe1@example.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113471">to</span>&nbsp;<span class="op" id="7113474">:=</span>&nbsp;<span class="op" id="7113477">[</span><span class="op" id="7113478">]</span><span class="builtintype" id="7113479">string</span><span class="op" id="7113485">{</span><span class="string" id="7113486">&#34;joe2@example.com&#34;</span><span class="op" id="7113504">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7113507">return</span>&nbsp;<span class="ident" id="7113514"><a href="/net/smtp/smtp.go.html#6339136">SendMail</a></span><span class="op" id="7113522">(</span><span class="ident" id="7113523"><a href="/net/smtp/smtp_test.go.html#7113302">hostPort</a></span><span class="op" id="7113531">,</span>&nbsp;<span class="ident" id="7113533"><a href="/net/smtp/smtp_test.go.html#7113406">auth</a></span><span class="op" id="7113537">,</span>&nbsp;<span class="ident" id="7113539"><a href="/net/smtp/smtp_test.go.html#7113443">from</a></span><span class="op" id="7113543">,</span>&nbsp;<span class="ident" id="7113545"><a href="/net/smtp/smtp_test.go.html#7113471">to</a></span><span class="op" id="7113547">,</span>&nbsp;<span class="op" id="7113549">[</span><span class="op" id="7113550">]</span><span class="builtintype" id="7113551">byte</span><span class="op" id="7113555">(</span><span class="string" id="7113556">&#34;Subject:&nbsp;test\n\nhowdy!&#34;</span><span class="op" id="7113581">)</span><span class="op" id="7113582">)</span><br>
<span class="lineno"></span><span class="op" id="7113584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7113587">//&nbsp;(copied&nbsp;from&nbsp;net/http/httptest)</span><br>
<span class="lineno"></span><span class="comment" id="7113622">//&nbsp;localhostCert&nbsp;is&nbsp;a&nbsp;PEM-encoded&nbsp;TLS&nbsp;cert&nbsp;with&nbsp;SAN&nbsp;IPs</span><br>
<span class="lineno">670</span><span class="comment" id="7113678">//&nbsp;&#34;127.0.0.1&#34;&nbsp;and&nbsp;&#34;[::1]&#34;,&nbsp;expiring&nbsp;at&nbsp;the&nbsp;last&nbsp;second&nbsp;of&nbsp;2049&nbsp;(the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="7113751">//&nbsp;of&nbsp;ASN.1&nbsp;time).</span><br>
<span class="lineno"></span><span class="comment" id="7113770">//&nbsp;generated&nbsp;from&nbsp;src/crypto/tls:</span><br>
<span class="lineno"></span><span class="comment" id="7113804">//&nbsp;go&nbsp;run&nbsp;generate_cert.go&nbsp;&nbsp;--rsa-bits&nbsp;512&nbsp;--host&nbsp;127.0.0.1,::1,example.com&nbsp;--ca&nbsp;--start-date&nbsp;&#34;Jan&nbsp;1&nbsp;00:00:00&nbsp;1970&#34;&nbsp;--duration=1000000h</span><br>
<span class="lineno"></span><span class="keyword" id="7113940">var</span>&nbsp;<span class="ident" id="7113944">localhostCert</span>&nbsp;<span class="op" id="7113958">=</span>&nbsp;<span class="op" id="7113960">[</span><span class="op" id="7113961">]</span><span class="builtintype" id="7113962">byte</span><span class="op" id="7113966">(</span><span class="string" id="7113967">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno">675</span>MIIBdzCCASOgAwIBAgIBADALBgkqhkiG9w0BAQUwEjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno"></span>bzAeFw03MDAxMDEwMDAwMDBaFw00OTEyMzEyMzU5NTlaMBIxEDAOBgNVBAoTB0Fj<br>
<span class="lineno"></span>bWUgQ28wWjALBgkqhkiG9w0BAQEDSwAwSAJBAN55NcYKZeInyTuhcCwFMhDHCmwa<br>
<span class="lineno"></span>IUSdtXdcbItRB/yfXGBhiex00IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEA<br>
<span class="lineno"></span>AaNoMGYwDgYDVR0PAQH/BAQDAgCkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA8GA1Ud<br>
<span class="lineno">680</span>EwEB/wQFMAMBAf8wLgYDVR0RBCcwJYILZXhhbXBsZS5jb22HBH8AAAGHEAAAAAAA<br>
<span class="lineno"></span>AAAAAAAAAAAAAAEwCwYJKoZIhvcNAQEFA0EAAoQn/ytgqpiLcZu9XKbCJsJcvkgk<br>
<span class="lineno"></span>Se6AbGXgSlq+ZCEVo0qIwSgeBqmsJxUu7NCSOwVJLYNEBO2DtIxoYVk+MA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><span class="op" id="7114538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span><span class="comment" id="7114541">//&nbsp;localhostKey&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;localhostCert.</span><br>
<span class="lineno"></span><span class="keyword" id="7114595">var</span>&nbsp;<span class="ident" id="7114599">localhostKey</span>&nbsp;<span class="op" id="7114612">=</span>&nbsp;<span class="op" id="7114614">[</span><span class="op" id="7114615">]</span><span class="builtintype" id="7114616">byte</span><span class="op" id="7114620">(</span><span class="string" id="7114621">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBPAIBAAJBAN55NcYKZeInyTuhcCwFMhDHCmwaIUSdtXdcbItRB/yfXGBhiex0<br>
<span class="lineno"></span>0IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEAAQJBAQdUx66rfh8sYsgfdcvV<br>
<span class="lineno"></span>NoafYpnEcB5s4m/vSVe6SU7dCK6eYec9f9wpT353ljhDUHq3EbmE4foNzJngh35d<br>
<span class="lineno">690</span>AekCIQDhRQG5Li0Wj8TM4obOnnXUXf1jRv0UkzE9AHWLG5q3AwIhAPzSjpYUDjVW<br>
<span class="lineno"></span>MCUXgckTpKCuGwbJk7424Nb8bLzf3kllAiA5mUBgjfr/WtFSJdWcPQ4Zt9KTMNKD<br>
<span class="lineno"></span>EUO0ukpTwEIl6wIhAMbGqZK3zAAFdq8DD2jPx+UJXnh0rnOkZBzDtJ6/iN69AiEA<br>
<span class="lineno"></span>1Aq8MJgTaYsDQWyU/hDq5YkDJc9e9DSCvUIzqxQWMQE=<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><span class="op" id="7115119">)</span>
</div>
</body>
</html>
