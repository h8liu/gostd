<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3101765">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3101820">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3101874">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3101925">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3101989">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3102054">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3102079">package</span>&nbsp;<span class="ident" id="3102087">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3102092">import</span>&nbsp;<span class="string" id="3102099">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3102110">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3102180">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3102228">func</span>&nbsp;<span class="ident" id="3102233">sysSocket</span><span class="op" id="3102242">(</span><span class="ident" id="3102243">family</span><span class="op" id="3102249">,</span>&nbsp;<span class="ident" id="3102251">sotype</span><span class="op" id="3102257">,</span>&nbsp;<span class="ident" id="3102259">proto</span>&nbsp;<span class="builtintype" id="3102265">int</span><span class="op" id="3102268">)</span>&nbsp;<span class="op" id="3102270">(</span><span class="builtintype" id="3102271">int</span><span class="op" id="3102274">,</span>&nbsp;<span class="builtintype" id="3102276">error</span><span class="op" id="3102281">)</span>&nbsp;<span class="op" id="3102283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102286">s</span><span class="op" id="3102287">,</span>&nbsp;<span class="ident" id="3102289">err</span>&nbsp;<span class="op" id="3102293">:=</span>&nbsp;<span class="ident" id="3102296">syscall</span><span class="op" id="3102303">.</span><span class="ident" id="3102304">Socket</span><span class="op" id="3102310">(</span><span class="ident" id="3102311">family</span><span class="op" id="3102317">,</span>&nbsp;<span class="ident" id="3102319">sotype</span><span class="op" id="3102325">|</span><span class="ident" id="3102326">syscall</span><span class="op" id="3102333">.</span><span class="ident" id="3102334">SOCK_NONBLOCK</span><span class="op" id="3102347">|</span><span class="ident" id="3102348">syscall</span><span class="op" id="3102355">.</span><span class="ident" id="3102356">SOCK_CLOEXEC</span><span class="op" id="3102368">,</span>&nbsp;<span class="ident" id="3102370">proto</span><span class="op" id="3102375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102378">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102437">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102500">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102564">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102624">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102649">if</span>&nbsp;<span class="ident" id="3102652">err</span>&nbsp;<span class="op" id="3102656">==</span>&nbsp;<span class="ident" id="3102659">nil</span>&nbsp;<span class="op" id="3102663">||</span>&nbsp;<span class="op" id="3102666">(</span><span class="ident" id="3102667">err</span>&nbsp;<span class="op" id="3102671">!=</span>&nbsp;<span class="ident" id="3102674">syscall</span><span class="op" id="3102681">.</span><span class="ident" id="3102682">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3102698">&amp;&amp;</span>&nbsp;<span class="ident" id="3102701">err</span>&nbsp;<span class="op" id="3102705">!=</span>&nbsp;<span class="ident" id="3102708">syscall</span><span class="op" id="3102715">.</span><span class="ident" id="3102716">EINVAL</span><span class="op" id="3102722">)</span>&nbsp;<span class="op" id="3102724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102728">return</span>&nbsp;<span class="ident" id="3102735">s</span><span class="op" id="3102736">,</span>&nbsp;<span class="ident" id="3102738">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3102747">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102808">syscall</span><span class="op" id="3102815">.</span><span class="ident" id="3102816">ForkLock</span><span class="op" id="3102824">.</span><span class="ident" id="3102825">RLock</span><span class="op" id="3102830">(</span><span class="op" id="3102831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102834">s</span><span class="op" id="3102835">,</span>&nbsp;<span class="ident" id="3102837">err</span>&nbsp;<span class="op" id="3102841">=</span>&nbsp;<span class="ident" id="3102843">syscall</span><span class="op" id="3102850">.</span><span class="ident" id="3102851">Socket</span><span class="op" id="3102857">(</span><span class="ident" id="3102858">family</span><span class="op" id="3102864">,</span>&nbsp;<span class="ident" id="3102866">sotype</span><span class="op" id="3102872">,</span>&nbsp;<span class="ident" id="3102874">proto</span><span class="op" id="3102879">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102882">if</span>&nbsp;<span class="ident" id="3102885">err</span>&nbsp;<span class="op" id="3102889">==</span>&nbsp;<span class="ident" id="3102892">nil</span>&nbsp;<span class="op" id="3102896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102900">syscall</span><span class="op" id="3102907">.</span><span class="ident" id="3102908">CloseOnExec</span><span class="op" id="3102919">(</span><span class="ident" id="3102920">s</span><span class="op" id="3102921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3102927">syscall</span><span class="op" id="3102934">.</span><span class="ident" id="3102935">ForkLock</span><span class="op" id="3102943">.</span><span class="ident" id="3102944">RUnlock</span><span class="op" id="3102951">(</span><span class="op" id="3102952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102955">if</span>&nbsp;<span class="ident" id="3102958">err</span>&nbsp;<span class="op" id="3102962">!=</span>&nbsp;<span class="ident" id="3102965">nil</span>&nbsp;<span class="op" id="3102969">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102973">return</span>&nbsp;<span class="op" id="3102980">-</span><span class="num" id="3102981">1</span><span class="op" id="3102982">,</span>&nbsp;<span class="ident" id="3102984">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3102989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3102992">if</span>&nbsp;<span class="ident" id="3102995">err</span>&nbsp;<span class="op" id="3102999">=</span>&nbsp;<span class="ident" id="3103001">syscall</span><span class="op" id="3103008">.</span><span class="ident" id="3103009">SetNonblock</span><span class="op" id="3103020">(</span><span class="ident" id="3103021">s</span><span class="op" id="3103022">,</span>&nbsp;<span class="builtintype" id="3103024">true</span><span class="op" id="3103028">)</span><span class="op" id="3103029">;</span>&nbsp;<span class="ident" id="3103031">err</span>&nbsp;<span class="op" id="3103035">!=</span>&nbsp;<span class="ident" id="3103038">nil</span>&nbsp;<span class="op" id="3103042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103046">syscall</span><span class="op" id="3103053">.</span><span class="ident" id="3103054">Close</span><span class="op" id="3103059">(</span><span class="ident" id="3103060">s</span><span class="op" id="3103061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103065">return</span>&nbsp;<span class="op" id="3103072">-</span><span class="num" id="3103073">1</span><span class="op" id="3103074">,</span>&nbsp;<span class="ident" id="3103076">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103084">return</span>&nbsp;<span class="ident" id="3103091">s</span><span class="op" id="3103092">,</span>&nbsp;<span class="ident" id="3103094">nil</span><br>
<span class="lineno"></span><span class="op" id="3103098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3103101">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3103171">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3103219">func</span>&nbsp;<span class="ident" id="3103224">accept</span><span class="op" id="3103230">(</span><span class="ident" id="3103231">s</span>&nbsp;<span class="builtintype" id="3103233">int</span><span class="op" id="3103236">)</span>&nbsp;<span class="op" id="3103238">(</span><span class="builtintype" id="3103239">int</span><span class="op" id="3103242">,</span>&nbsp;<span class="ident" id="3103244">syscall</span><span class="op" id="3103251">.</span><span class="ident" id="3103252">Sockaddr</span><span class="op" id="3103260">,</span>&nbsp;<span class="builtintype" id="3103262">error</span><span class="op" id="3103267">)</span>&nbsp;<span class="op" id="3103269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3103272">ns</span><span class="op" id="3103274">,</span>&nbsp;<span class="ident" id="3103276">sa</span><span class="op" id="3103278">,</span>&nbsp;<span class="ident" id="3103280">err</span>&nbsp;<span class="op" id="3103284">:=</span>&nbsp;<span class="ident" id="3103287">syscall</span><span class="op" id="3103294">.</span><span class="ident" id="3103295">Accept4</span><span class="op" id="3103302">(</span><span class="ident" id="3103303">s</span><span class="op" id="3103304">,</span>&nbsp;<span class="ident" id="3103306">syscall</span><span class="op" id="3103313">.</span><span class="ident" id="3103314">SOCK_NONBLOCK</span><span class="op" id="3103327">|</span><span class="ident" id="3103328">syscall</span><span class="op" id="3103335">.</span><span class="ident" id="3103336">SOCK_CLOEXEC</span><span class="op" id="3103348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103351">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103413">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103477">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103538">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103585">switch</span>&nbsp;<span class="ident" id="3103592">err</span>&nbsp;<span class="op" id="3103596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103599">default</span><span class="op" id="3103606">:</span>&nbsp;<span class="comment" id="3103608">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103655">return</span>&nbsp;<span class="ident" id="3103662">ns</span><span class="op" id="3103664">,</span>&nbsp;<span class="ident" id="3103666">sa</span><span class="op" id="3103668">,</span>&nbsp;<span class="ident" id="3103670">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103675">case</span>&nbsp;<span class="ident" id="3103680">syscall</span><span class="op" id="3103687">.</span><span class="ident" id="3103688">ENOSYS</span><span class="op" id="3103694">:</span>&nbsp;<span class="comment" id="3103696">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103716">case</span>&nbsp;<span class="ident" id="3103721">syscall</span><span class="op" id="3103728">.</span><span class="ident" id="3103729">EINVAL</span><span class="op" id="3103735">:</span>&nbsp;<span class="comment" id="3103737">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103779">case</span>&nbsp;<span class="ident" id="3103784">syscall</span><span class="op" id="3103791">.</span><span class="ident" id="3103792">EACCES</span><span class="op" id="3103798">:</span>&nbsp;<span class="comment" id="3103800">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3103842">case</span>&nbsp;<span class="ident" id="3103847">syscall</span><span class="op" id="3103854">.</span><span class="ident" id="3103855">EFAULT</span><span class="op" id="3103861">:</span>&nbsp;<span class="comment" id="3103863">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3103905">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103909">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3103970">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3104033">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3104090">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3104151">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104223">ns</span><span class="op" id="3104225">,</span>&nbsp;<span class="ident" id="3104227">sa</span><span class="op" id="3104229">,</span>&nbsp;<span class="ident" id="3104231">err</span>&nbsp;<span class="op" id="3104235">=</span>&nbsp;<span class="ident" id="3104237">syscall</span><span class="op" id="3104244">.</span><span class="ident" id="3104245">Accept</span><span class="op" id="3104251">(</span><span class="ident" id="3104252">s</span><span class="op" id="3104253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104256">if</span>&nbsp;<span class="ident" id="3104259">err</span>&nbsp;<span class="op" id="3104263">==</span>&nbsp;<span class="ident" id="3104266">nil</span>&nbsp;<span class="op" id="3104270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104274">syscall</span><span class="op" id="3104281">.</span><span class="ident" id="3104282">CloseOnExec</span><span class="op" id="3104293">(</span><span class="ident" id="3104294">ns</span><span class="op" id="3104296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104299">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104302">if</span>&nbsp;<span class="ident" id="3104305">err</span>&nbsp;<span class="op" id="3104309">!=</span>&nbsp;<span class="ident" id="3104312">nil</span>&nbsp;<span class="op" id="3104316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104320">return</span>&nbsp;<span class="op" id="3104327">-</span><span class="num" id="3104328">1</span><span class="op" id="3104329">,</span>&nbsp;<span class="ident" id="3104331">nil</span><span class="op" id="3104334">,</span>&nbsp;<span class="ident" id="3104336">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104344">if</span>&nbsp;<span class="ident" id="3104347">err</span>&nbsp;<span class="op" id="3104351">=</span>&nbsp;<span class="ident" id="3104353">syscall</span><span class="op" id="3104360">.</span><span class="ident" id="3104361">SetNonblock</span><span class="op" id="3104372">(</span><span class="ident" id="3104373">ns</span><span class="op" id="3104375">,</span>&nbsp;<span class="builtintype" id="3104377">true</span><span class="op" id="3104381">)</span><span class="op" id="3104382">;</span>&nbsp;<span class="ident" id="3104384">err</span>&nbsp;<span class="op" id="3104388">!=</span>&nbsp;<span class="ident" id="3104391">nil</span>&nbsp;<span class="op" id="3104395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3104399">syscall</span><span class="op" id="3104406">.</span><span class="ident" id="3104407">Close</span><span class="op" id="3104412">(</span><span class="ident" id="3104413">ns</span><span class="op" id="3104415">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104419">return</span>&nbsp;<span class="op" id="3104426">-</span><span class="num" id="3104427">1</span><span class="op" id="3104428">,</span>&nbsp;<span class="ident" id="3104430">nil</span><span class="op" id="3104433">,</span>&nbsp;<span class="ident" id="3104435">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3104440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3104443">return</span>&nbsp;<span class="ident" id="3104450">ns</span><span class="op" id="3104452">,</span>&nbsp;<span class="ident" id="3104454">sa</span><span class="op" id="3104456">,</span>&nbsp;<span class="ident" id="3104458">nil</span><br>
<span class="lineno"></span><span class="op" id="3104462">}</span>
</div>
</body>
</html>
