<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7038605">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7038661">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7038715">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7038766">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="7038835">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7038848">package</span>&nbsp;<span class="ident" id="7038856">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7038862">import</span>&nbsp;<span class="op" id="7038869">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7038872">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7038879">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7038890">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7038897">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7038900">func</span>&nbsp;<span class="ident" id="7038905">NewLoggingConn</span><span class="op" id="7038919">(</span><span class="ident" id="7038920">baseName</span>&nbsp;<span class="builtintype" id="7038929">string</span><span class="op" id="7038935">,</span>&nbsp;<span class="ident" id="7038937">c</span>&nbsp;<span class="ident" id="7038939"><a href="/net/http/export_test.go.html#7038872">net</a></span><span class="op" id="7038942">.</span><span class="ident" id="7038943">Conn</span><span class="op" id="7038947">)</span>&nbsp;<span class="ident" id="7038949"><a href="/net/http/export_test.go.html#7038872">net</a></span><span class="op" id="7038952">.</span><span class="ident" id="7038953">Conn</span>&nbsp;<span class="op" id="7038958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7038961">return</span>&nbsp;<span class="ident" id="7038968"><a href="/net/http/server.go.html#3459884">newLoggingConn</a></span><span class="op" id="7038982">(</span><span class="ident" id="7038983"><a href="/net/http/export_test.go.html#7038920">baseName</a></span><span class="op" id="7038991">,</span>&nbsp;<span class="ident" id="7038993"><a href="/net/http/export_test.go.html#7038937">c</a></span><span class="op" id="7038994">)</span><br>
<span class="lineno"></span><span class="op" id="7038996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7038999">var</span>&nbsp;<span class="ident" id="7039003">ExportAppendTime</span>&nbsp;<span class="op" id="7039020">=</span>&nbsp;<span class="ident" id="7039022"><a href="/net/http/server.go.html#3414916">appendTime</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7039034">func</span>&nbsp;<span class="op" id="7039039">(</span><span class="ident" id="7039040">t</span>&nbsp;<span class="op" id="7039042">*</span><span class="ident" id="7039043"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7039052">)</span>&nbsp;<span class="ident" id="7039054">NumPendingRequestsForTesting</span><span class="op" id="7039082">(</span><span class="op" id="7039083">)</span>&nbsp;<span class="builtintype" id="7039085">int</span>&nbsp;<span class="op" id="7039089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039092"><a href="/net/http/export_test.go.html#7039040">t</a></span><span class="op" id="7039093">.</span><span class="ident" id="7039094">reqMu</span><span class="op" id="7039099">.</span><span class="ident" id="7039100">Lock</span><span class="op" id="7039104">(</span><span class="op" id="7039105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039108">defer</span>&nbsp;<span class="ident" id="7039114"><a href="/net/http/export_test.go.html#7039040">t</a></span><span class="op" id="7039115">.</span><span class="ident" id="7039116">reqMu</span><span class="op" id="7039121">.</span><span class="ident" id="7039122">Unlock</span><span class="op" id="7039128">(</span><span class="op" id="7039129">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039132">return</span>&nbsp;<span class="builtinfunc" id="7039139">len</span><span class="op" id="7039142">(</span><span class="ident" id="7039143"><a href="/net/http/export_test.go.html#7039040">t</a></span><span class="op" id="7039144">.</span><span class="ident" id="7039145">reqCanceler</span><span class="op" id="7039156">)</span><br>
<span class="lineno"></span><span class="op" id="7039158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7039161">func</span>&nbsp;<span class="op" id="7039166">(</span><span class="ident" id="7039167">t</span>&nbsp;<span class="op" id="7039169">*</span><span class="ident" id="7039170"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7039179">)</span>&nbsp;<span class="ident" id="7039181">IdleConnKeysForTesting</span><span class="op" id="7039203">(</span><span class="op" id="7039204">)</span>&nbsp;<span class="op" id="7039206">(</span><span class="ident" id="7039207">keys</span>&nbsp;<span class="op" id="7039212">[</span><span class="op" id="7039213">]</span><span class="builtintype" id="7039214">string</span><span class="op" id="7039220">)</span>&nbsp;<span class="op" id="7039222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039225"><a href="/net/http/export_test.go.html#7039207">keys</a></span>&nbsp;<span class="op" id="7039230">=</span>&nbsp;<span class="builtinfunc" id="7039232">make</span><span class="op" id="7039236">(</span><span class="op" id="7039237">[</span><span class="op" id="7039238">]</span><span class="builtintype" id="7039239">string</span><span class="op" id="7039245">,</span>&nbsp;<span class="num" id="7039247">0</span><span class="op" id="7039248">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039251"><a href="/net/http/export_test.go.html#7039167">t</a></span><span class="op" id="7039252">.</span><span class="ident" id="7039253">idleMu</span><span class="op" id="7039259">.</span><span class="ident" id="7039260">Lock</span><span class="op" id="7039264">(</span><span class="op" id="7039265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039268">defer</span>&nbsp;<span class="ident" id="7039274"><a href="/net/http/export_test.go.html#7039167">t</a></span><span class="op" id="7039275">.</span><span class="ident" id="7039276">idleMu</span><span class="op" id="7039282">.</span><span class="ident" id="7039283">Unlock</span><span class="op" id="7039289">(</span><span class="op" id="7039290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039293">if</span>&nbsp;<span class="ident" id="7039296"><a href="/net/http/export_test.go.html#7039167">t</a></span><span class="op" id="7039297">.</span><span class="ident" id="7039298">idleConn</span>&nbsp;<span class="op" id="7039307">==</span>&nbsp;<span class="ident" id="7039310">nil</span>&nbsp;<span class="op" id="7039314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039318">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7039326">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039329">for</span>&nbsp;<span class="ident" id="7039333">key</span>&nbsp;<span class="op" id="7039337">:=</span>&nbsp;<span class="keyword" id="7039340">range</span>&nbsp;<span class="ident" id="7039346"><a href="/net/http/export_test.go.html#7039167">t</a></span><span class="op" id="7039347">.</span><span class="ident" id="7039348">idleConn</span>&nbsp;<span class="op" id="7039357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039361"><a href="/net/http/export_test.go.html#7039207">keys</a></span>&nbsp;<span class="op" id="7039366">=</span>&nbsp;<span class="builtinfunc" id="7039368">append</span><span class="op" id="7039374">(</span><span class="ident" id="7039375"><a href="/net/http/export_test.go.html#7039207">keys</a></span><span class="op" id="7039379">,</span>&nbsp;<span class="ident" id="7039381"><a href="/net/http/export_test.go.html#7039333">key</a></span><span class="op" id="7039384">.</span><span class="ident" id="7039385">String</span><span class="op" id="7039391">(</span><span class="op" id="7039392">)</span><span class="op" id="7039393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7039396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039399">return</span><br>
<span class="lineno"></span><span class="op" id="7039406">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7039409">func</span>&nbsp;<span class="op" id="7039414">(</span><span class="ident" id="7039415">t</span>&nbsp;<span class="op" id="7039417">*</span><span class="ident" id="7039418"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7039427">)</span>&nbsp;<span class="ident" id="7039429">IdleConnCountForTesting</span><span class="op" id="7039452">(</span><span class="ident" id="7039453">cacheKey</span>&nbsp;<span class="builtintype" id="7039462">string</span><span class="op" id="7039468">)</span>&nbsp;<span class="builtintype" id="7039470">int</span>&nbsp;<span class="op" id="7039474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039477"><a href="/net/http/export_test.go.html#7039415">t</a></span><span class="op" id="7039478">.</span><span class="ident" id="7039479">idleMu</span><span class="op" id="7039485">.</span><span class="ident" id="7039486">Lock</span><span class="op" id="7039490">(</span><span class="op" id="7039491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039494">defer</span>&nbsp;<span class="ident" id="7039500"><a href="/net/http/export_test.go.html#7039415">t</a></span><span class="op" id="7039501">.</span><span class="ident" id="7039502">idleMu</span><span class="op" id="7039508">.</span><span class="ident" id="7039509">Unlock</span><span class="op" id="7039515">(</span><span class="op" id="7039516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039519">if</span>&nbsp;<span class="ident" id="7039522"><a href="/net/http/export_test.go.html#7039415">t</a></span><span class="op" id="7039523">.</span><span class="ident" id="7039524">idleConn</span>&nbsp;<span class="op" id="7039533">==</span>&nbsp;<span class="ident" id="7039536">nil</span>&nbsp;<span class="op" id="7039540">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039544">return</span>&nbsp;<span class="num" id="7039551">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7039554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039557">for</span>&nbsp;<span class="ident" id="7039561">k</span><span class="op" id="7039562">,</span>&nbsp;<span class="ident" id="7039564">conns</span>&nbsp;<span class="op" id="7039570">:=</span>&nbsp;<span class="keyword" id="7039573">range</span>&nbsp;<span class="ident" id="7039579"><a href="/net/http/export_test.go.html#7039415">t</a></span><span class="op" id="7039580">.</span><span class="ident" id="7039581">idleConn</span>&nbsp;<span class="op" id="7039590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039594">if</span>&nbsp;<span class="ident" id="7039597"><a href="/net/http/export_test.go.html#7039561">k</a></span><span class="op" id="7039598">.</span><span class="ident" id="7039599">String</span><span class="op" id="7039605">(</span><span class="op" id="7039606">)</span>&nbsp;<span class="op" id="7039608">==</span>&nbsp;<span class="ident" id="7039611"><a href="/net/http/export_test.go.html#7039453">cacheKey</a></span>&nbsp;<span class="op" id="7039620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039625">return</span>&nbsp;<span class="builtinfunc" id="7039632">len</span><span class="op" id="7039635">(</span><span class="ident" id="7039636"><a href="/net/http/export_test.go.html#7039564">conns</a></span><span class="op" id="7039641">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7039645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7039648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039651">return</span>&nbsp;<span class="num" id="7039658">0</span><br>
<span class="lineno"></span><span class="op" id="7039660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7039663">func</span>&nbsp;<span class="op" id="7039668">(</span><span class="ident" id="7039669">t</span>&nbsp;<span class="op" id="7039671">*</span><span class="ident" id="7039672"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7039681">)</span>&nbsp;<span class="ident" id="7039683">IdleConnChMapSizeForTesting</span><span class="op" id="7039710">(</span><span class="op" id="7039711">)</span>&nbsp;<span class="builtintype" id="7039713">int</span>&nbsp;<span class="op" id="7039717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039720"><a href="/net/http/export_test.go.html#7039669">t</a></span><span class="op" id="7039721">.</span><span class="ident" id="7039722">idleMu</span><span class="op" id="7039728">.</span><span class="ident" id="7039729">Lock</span><span class="op" id="7039733">(</span><span class="op" id="7039734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039737">defer</span>&nbsp;<span class="ident" id="7039743"><a href="/net/http/export_test.go.html#7039669">t</a></span><span class="op" id="7039744">.</span><span class="ident" id="7039745">idleMu</span><span class="op" id="7039751">.</span><span class="ident" id="7039752">Unlock</span><span class="op" id="7039758">(</span><span class="op" id="7039759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039762">return</span>&nbsp;<span class="builtinfunc" id="7039769">len</span><span class="op" id="7039772">(</span><span class="ident" id="7039773"><a href="/net/http/export_test.go.html#7039669">t</a></span><span class="op" id="7039774">.</span><span class="ident" id="7039775">idleConnCh</span><span class="op" id="7039785">)</span><br>
<span class="lineno"></span><span class="op" id="7039787">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7039790">func</span>&nbsp;<span class="op" id="7039795">(</span><span class="ident" id="7039796">t</span>&nbsp;<span class="op" id="7039798">*</span><span class="ident" id="7039799"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7039808">)</span>&nbsp;<span class="ident" id="7039810">IsIdleForTesting</span><span class="op" id="7039826">(</span><span class="op" id="7039827">)</span>&nbsp;<span class="builtintype" id="7039829">bool</span>&nbsp;<span class="op" id="7039834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039837"><a href="/net/http/export_test.go.html#7039796">t</a></span><span class="op" id="7039838">.</span><span class="ident" id="7039839">idleMu</span><span class="op" id="7039845">.</span><span class="ident" id="7039846">Lock</span><span class="op" id="7039850">(</span><span class="op" id="7039851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039854">defer</span>&nbsp;<span class="ident" id="7039860"><a href="/net/http/export_test.go.html#7039796">t</a></span><span class="op" id="7039861">.</span><span class="ident" id="7039862">idleMu</span><span class="op" id="7039868">.</span><span class="ident" id="7039869">Unlock</span><span class="op" id="7039875">(</span><span class="op" id="7039876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7039879">return</span>&nbsp;<span class="ident" id="7039886"><a href="/net/http/export_test.go.html#7039796">t</a></span><span class="op" id="7039887">.</span><span class="ident" id="7039888">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="7039897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7039900">func</span>&nbsp;<span class="op" id="7039905">(</span><span class="ident" id="7039906">t</span>&nbsp;<span class="op" id="7039908">*</span><span class="ident" id="7039909"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7039918">)</span>&nbsp;<span class="ident" id="7039920">RequestIdleConnChForTesting</span><span class="op" id="7039947">(</span><span class="op" id="7039948">)</span>&nbsp;<span class="op" id="7039950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7039953"><a href="/net/http/export_test.go.html#7039906">t</a></span><span class="op" id="7039954">.</span><span class="ident" id="7039955">getIdleConnCh</span><span class="op" id="7039968">(</span><span class="ident" id="7039969"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="7039982">{</span><span class="ident" id="7039983">nil</span><span class="op" id="7039986">,</span>&nbsp;<span class="string" id="7039988">&#34;http&#34;</span><span class="op" id="7039994">,</span>&nbsp;<span class="string" id="7039996">&#34;example.com&#34;</span><span class="op" id="7040009">}</span><span class="op" id="7040010">)</span><br>
<span class="lineno"></span><span class="op" id="7040012">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7040015">func</span>&nbsp;<span class="op" id="7040020">(</span><span class="ident" id="7040021">t</span>&nbsp;<span class="op" id="7040023">*</span><span class="ident" id="7040024"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="7040033">)</span>&nbsp;<span class="ident" id="7040035">PutIdleTestConn</span><span class="op" id="7040050">(</span><span class="op" id="7040051">)</span>&nbsp;<span class="builtintype" id="7040053">bool</span>&nbsp;<span class="op" id="7040058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040061">c</span><span class="op" id="7040062">,</span>&nbsp;<span class="ident" id="7040064">_</span>&nbsp;<span class="op" id="7040066">:=</span>&nbsp;<span class="ident" id="7040069"><a href="/net/http/export_test.go.html#7038872">net</a></span><span class="op" id="7040072">.</span><span class="ident" id="7040073">Pipe</span><span class="op" id="7040077">(</span><span class="op" id="7040078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7040081">return</span>&nbsp;<span class="ident" id="7040088"><a href="/net/http/export_test.go.html#7040021">t</a></span><span class="op" id="7040089">.</span><span class="ident" id="7040090">putIdleConn</span><span class="op" id="7040101">(</span><span class="op" id="7040102">&amp;</span><span class="ident" id="7040103"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="7040114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040118">t</span><span class="op" id="7040119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7040128"><a href="/net/http/export_test.go.html#7040021">t</a></span><span class="op" id="7040129">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040133">conn</span><span class="op" id="7040137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7040143"><a href="/net/http/export_test.go.html#7040061">c</a></span><span class="op" id="7040144">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7040164">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040175">closech</span><span class="op" id="7040182">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="7040185">make</span><span class="op" id="7040189">(</span><span class="keyword" id="7040190">chan</span>&nbsp;<span class="keyword" id="7040195">struct</span><span class="op" id="7040201">{</span><span class="op" id="7040202">}</span><span class="op" id="7040203">)</span><span class="op" id="7040204">,</span>&nbsp;<span class="comment" id="7040206">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040231">cacheKey</span><span class="op" id="7040239">:</span>&nbsp;<span class="ident" id="7040241"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="7040257">{</span><span class="string" id="7040258">&#34;&#34;</span><span class="op" id="7040260">,</span>&nbsp;<span class="string" id="7040262">&#34;http&#34;</span><span class="op" id="7040268">,</span>&nbsp;<span class="string" id="7040270">&#34;example.com&#34;</span><span class="op" id="7040283">}</span><span class="op" id="7040284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7040287">}</span><span class="op" id="7040288">)</span><br>
<span class="lineno"></span><span class="op" id="7040290">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7040293">func</span>&nbsp;<span class="ident" id="7040298">NewTestTimeoutHandler</span><span class="op" id="7040319">(</span><span class="ident" id="7040320">handler</span>&nbsp;<span class="ident" id="7040328"><a href="/net/http/server.go.html#3400945">Handler</a></span><span class="op" id="7040335">,</span>&nbsp;<span class="ident" id="7040337">ch</span>&nbsp;<span class="op" id="7040340">&lt;-</span><span class="keyword" id="7040342">chan</span>&nbsp;<span class="ident" id="7040347"><a href="/net/http/export_test.go.html#7038890">time</a></span><span class="op" id="7040351">.</span><span class="ident" id="7040352">Time</span><span class="op" id="7040356">)</span>&nbsp;<span class="ident" id="7040358"><a href="/net/http/server.go.html#3400945">Handler</a></span>&nbsp;<span class="op" id="7040366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040369">f</span>&nbsp;<span class="op" id="7040371">:=</span>&nbsp;<span class="keyword" id="7040374">func</span><span class="op" id="7040378">(</span><span class="op" id="7040379">)</span>&nbsp;<span class="op" id="7040381">&lt;-</span><span class="keyword" id="7040383">chan</span>&nbsp;<span class="ident" id="7040388"><a href="/net/http/export_test.go.html#7038890">time</a></span><span class="op" id="7040392">.</span><span class="ident" id="7040393">Time</span>&nbsp;<span class="op" id="7040398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7040402">return</span>&nbsp;<span class="ident" id="7040409"><a href="/net/http/export_test.go.html#7040337">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7040413">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7040416">return</span>&nbsp;<span class="op" id="7040423">&amp;</span><span class="ident" id="7040424"><a href="/net/http/server.go.html#3456273">timeoutHandler</a></span><span class="op" id="7040438">{</span><span class="ident" id="7040439"><a href="/net/http/export_test.go.html#7040320">handler</a></span><span class="op" id="7040446">,</span>&nbsp;<span class="ident" id="7040448"><a href="/net/http/export_test.go.html#7040369">f</a></span><span class="op" id="7040449">,</span>&nbsp;<span class="string" id="7040451">&#34;&#34;</span><span class="op" id="7040453">}</span><br>
<span class="lineno"></span><span class="op" id="7040455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7040458">func</span>&nbsp;<span class="ident" id="7040463">ResetCachedEnvironment</span><span class="op" id="7040485">(</span><span class="op" id="7040486">)</span>&nbsp;<span class="op" id="7040488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040491"><a href="/net/http/transport.go.html#3499027">httpProxyEnv</a></span><span class="op" id="7040503">.</span><span class="ident" id="7040504">reset</span><span class="op" id="7040509">(</span><span class="op" id="7040510">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040513"><a href="/net/http/transport.go.html#3499103">httpsProxyEnv</a></span><span class="op" id="7040526">.</span><span class="ident" id="7040527">reset</span><span class="op" id="7040532">(</span><span class="op" id="7040533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040536"><a href="/net/http/transport.go.html#3499182">noProxyEnv</a></span><span class="op" id="7040546">.</span><span class="ident" id="7040547">reset</span><span class="op" id="7040552">(</span><span class="op" id="7040553">)</span><br>
<span class="lineno"></span><span class="op" id="7040555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7040558">var</span>&nbsp;<span class="ident" id="7040562">DefaultUserAgent</span>&nbsp;<span class="op" id="7040579">=</span>&nbsp;<span class="ident" id="7040581"><a href="/net/http/request.go.html#3376050">defaultUserAgent</a></span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="7040599">func</span>&nbsp;<span class="ident" id="7040604">ExportRefererForURL</span><span class="op" id="7040623">(</span><span class="ident" id="7040624">lastReq</span><span class="op" id="7040631">,</span>&nbsp;<span class="ident" id="7040633">newReq</span>&nbsp;<span class="op" id="7040640">*</span><span class="ident" id="7040641"><a href="/net/http/export_test.go.html#7038879">url</a></span><span class="op" id="7040644">.</span><span class="ident" id="7040645">URL</span><span class="op" id="7040648">)</span>&nbsp;<span class="builtintype" id="7040650">string</span>&nbsp;<span class="op" id="7040657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7040660">return</span>&nbsp;<span class="ident" id="7040667"><a href="/net/http/client.go.html#3314297">refererForURL</a></span><span class="op" id="7040680">(</span><span class="ident" id="7040681"><a href="/net/http/export_test.go.html#7040624">lastReq</a></span><span class="op" id="7040688">,</span>&nbsp;<span class="ident" id="7040690"><a href="/net/http/export_test.go.html#7040633">newReq</a></span><span class="op" id="7040696">)</span><br>
<span class="lineno"></span><span class="op" id="7040698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="7040701">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="7040774">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="7040792">func</span>&nbsp;<span class="ident" id="7040797">SetPendingDialHooks</span><span class="op" id="7040816">(</span><span class="ident" id="7040817">before</span><span class="op" id="7040823">,</span>&nbsp;<span class="ident" id="7040825">after</span>&nbsp;<span class="keyword" id="7040831">func</span><span class="op" id="7040835">(</span><span class="op" id="7040836">)</span><span class="op" id="7040837">)</span>&nbsp;<span class="op" id="7040839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7040842"><a href="/net/http/transport.go.html#3503399">prePendingDial</a></span><span class="op" id="7040856">,</span>&nbsp;<span class="ident" id="7040858"><a href="/net/http/transport.go.html#3503415">postPendingDial</a></span>&nbsp;<span class="op" id="7040874">=</span>&nbsp;<span class="ident" id="7040876"><a href="/net/http/export_test.go.html#7040817">before</a></span><span class="op" id="7040882">,</span>&nbsp;<span class="ident" id="7040884"><a href="/net/http/export_test.go.html#7040825">after</a></span><br>
<span class="lineno"></span><span class="op" id="7040890">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7040893">var</span>&nbsp;<span class="ident" id="7040897">ExportServerNewConn</span>&nbsp;<span class="op" id="7040917">=</span>&nbsp;<span class="op" id="7040919">(</span><span class="op" id="7040920">*</span><span class="ident" id="7040921"><a href="/net/http/server.go.html#3447093">Server</a></span><span class="op" id="7040927">)</span><span class="op" id="7040928">.</span><span class="ident" id="7040929">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7040938">var</span>&nbsp;<span class="ident" id="7040942">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="7040966">=</span>&nbsp;<span class="op" id="7040968">(</span><span class="op" id="7040969">*</span><span class="ident" id="7040970"><a href="/net/http/server.go.html#3403324">conn</a></span><span class="op" id="7040974">)</span><span class="op" id="7040975">.</span><span class="ident" id="7040976">closeWriteAndWait</span>
</div>
</body>
</html>
