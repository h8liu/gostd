<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4107918">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4107973">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4108027">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4108078">package</span>&nbsp;<span class="ident" id="4108086">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4108092">import</span>&nbsp;<span class="op" id="4108099">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108102">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108117">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108131">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108141">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="4108147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4108150">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="4108210">type</span>&nbsp;<span class="ident" id="4108215">Auth</span>&nbsp;<span class="keyword" id="4108220">interface</span>&nbsp;<span class="op" id="4108230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108233">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108283">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108338">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108401">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108463">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108510">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108568">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108626">Start</span><span class="op" id="4108631">(</span><span class="ident" id="4108632">server</span>&nbsp;<span class="op" id="4108639">*</span><span class="ident" id="4108640">ServerInfo</span><span class="op" id="4108650">)</span>&nbsp;<span class="op" id="4108652">(</span><span class="ident" id="4108653">proto</span>&nbsp;<span class="builtintype" id="4108659">string</span><span class="op" id="4108665">,</span>&nbsp;<span class="ident" id="4108667">toServer</span>&nbsp;<span class="op" id="4108676">[</span><span class="op" id="4108677">]</span><span class="builtintype" id="4108678">byte</span><span class="op" id="4108682">,</span>&nbsp;<span class="ident" id="4108684">err</span>&nbsp;<span class="builtintype" id="4108688">error</span><span class="op" id="4108693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108697">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108761">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108824">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108886">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108926">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108986">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109044">Next</span><span class="op" id="4109048">(</span><span class="ident" id="4109049">fromServer</span>&nbsp;<span class="op" id="4109060">[</span><span class="op" id="4109061">]</span><span class="builtintype" id="4109062">byte</span><span class="op" id="4109066">,</span>&nbsp;<span class="ident" id="4109068">more</span>&nbsp;<span class="builtintype" id="4109073">bool</span><span class="op" id="4109077">)</span>&nbsp;<span class="op" id="4109079">(</span><span class="ident" id="4109080">toServer</span>&nbsp;<span class="op" id="4109089">[</span><span class="op" id="4109090">]</span><span class="builtintype" id="4109091">byte</span><span class="op" id="4109095">,</span>&nbsp;<span class="ident" id="4109097">err</span>&nbsp;<span class="builtintype" id="4109101">error</span><span class="op" id="4109106">)</span><br>
<span class="lineno"></span><span class="op" id="4109108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4109111">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="4109167">type</span>&nbsp;<span class="ident" id="4109172">ServerInfo</span>&nbsp;<span class="keyword" id="4109183">struct</span>&nbsp;<span class="op" id="4109190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109193">Name</span>&nbsp;<span class="builtintype" id="4109198">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4109207">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109228">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="4109233">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109242">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109289">Auth</span>&nbsp;<span class="op" id="4109294">[</span><span class="op" id="4109295">]</span><span class="builtintype" id="4109296">string</span>&nbsp;<span class="comment" id="4109303">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="4109343">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4109346">type</span>&nbsp;<span class="ident" id="4109351">plainAuth</span>&nbsp;<span class="keyword" id="4109361">struct</span>&nbsp;<span class="op" id="4109368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109371">identity</span><span class="op" id="4109379">,</span>&nbsp;<span class="ident" id="4109381">username</span><span class="op" id="4109389">,</span>&nbsp;<span class="ident" id="4109391">password</span>&nbsp;<span class="builtintype" id="4109400">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109408">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4109437">string</span><br>
<span class="lineno"></span><span class="op" id="4109444">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4109447">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="4109517">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="4109554">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="4109628">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="4109704">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="4109738">func</span>&nbsp;<span class="ident" id="4109743">PlainAuth</span><span class="op" id="4109752">(</span><span class="ident" id="4109753">identity</span><span class="op" id="4109761">,</span>&nbsp;<span class="ident" id="4109763">username</span><span class="op" id="4109771">,</span>&nbsp;<span class="ident" id="4109773">password</span><span class="op" id="4109781">,</span>&nbsp;<span class="ident" id="4109783">host</span>&nbsp;<span class="builtintype" id="4109788">string</span><span class="op" id="4109794">)</span>&nbsp;<span class="ident" id="4109796">Auth</span>&nbsp;<span class="op" id="4109801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109804">return</span>&nbsp;<span class="op" id="4109811">&amp;</span><span class="ident" id="4109812">plainAuth</span><span class="op" id="4109821">{</span><span class="ident" id="4109822">identity</span><span class="op" id="4109830">,</span>&nbsp;<span class="ident" id="4109832">username</span><span class="op" id="4109840">,</span>&nbsp;<span class="ident" id="4109842">password</span><span class="op" id="4109850">,</span>&nbsp;<span class="ident" id="4109852">host</span><span class="op" id="4109856">}</span><br>
<span class="lineno"></span><span class="op" id="4109858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4109861">func</span>&nbsp;<span class="op" id="4109866">(</span><span class="ident" id="4109867">a</span>&nbsp;<span class="op" id="4109869">*</span><span class="ident" id="4109870">plainAuth</span><span class="op" id="4109879">)</span>&nbsp;<span class="ident" id="4109881">Start</span><span class="op" id="4109886">(</span><span class="ident" id="4109887">server</span>&nbsp;<span class="op" id="4109894">*</span><span class="ident" id="4109895">ServerInfo</span><span class="op" id="4109905">)</span>&nbsp;<span class="op" id="4109907">(</span><span class="builtintype" id="4109908">string</span><span class="op" id="4109914">,</span>&nbsp;<span class="op" id="4109916">[</span><span class="op" id="4109917">]</span><span class="builtintype" id="4109918">byte</span><span class="op" id="4109922">,</span>&nbsp;<span class="builtintype" id="4109924">error</span><span class="op" id="4109929">)</span>&nbsp;<span class="op" id="4109931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109934">if</span>&nbsp;<span class="op" id="4109937">!</span><span class="ident" id="4109938">server</span><span class="op" id="4109944">.</span><span class="ident" id="4109945">TLS</span>&nbsp;<span class="op" id="4109949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109953">advertised</span>&nbsp;<span class="op" id="4109964">:=</span>&nbsp;<span class="builtintype" id="4109967">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109975">for</span>&nbsp;<span class="ident" id="4109979">_</span><span class="op" id="4109980">,</span>&nbsp;<span class="ident" id="4109982">mechanism</span>&nbsp;<span class="op" id="4109992">:=</span>&nbsp;<span class="keyword" id="4109995">range</span>&nbsp;<span class="ident" id="4110001">server</span><span class="op" id="4110007">.</span><span class="ident" id="4110008">Auth</span>&nbsp;<span class="op" id="4110013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110018">if</span>&nbsp;<span class="ident" id="4110021">mechanism</span>&nbsp;<span class="op" id="4110031">==</span>&nbsp;<span class="string" id="4110034">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="4110042">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110048">advertised</span>&nbsp;<span class="op" id="4110059">=</span>&nbsp;<span class="builtintype" id="4110061">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110070">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110087">if</span>&nbsp;<span class="op" id="4110090">!</span><span class="ident" id="4110091">advertised</span>&nbsp;<span class="op" id="4110102">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110107">return</span>&nbsp;<span class="string" id="4110114">&#34;&#34;</span><span class="op" id="4110116">,</span>&nbsp;<span class="ident" id="4110118">nil</span><span class="op" id="4110121">,</span>&nbsp;<span class="ident" id="4110123">errors</span><span class="op" id="4110129">.</span><span class="ident" id="4110130">New</span><span class="op" id="4110133">(</span><span class="string" id="4110134">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="4110158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110168">if</span>&nbsp;<span class="ident" id="4110171">server</span><span class="op" id="4110177">.</span><span class="ident" id="4110178">Name</span>&nbsp;<span class="op" id="4110183">!=</span>&nbsp;<span class="ident" id="4110186">a</span><span class="op" id="4110187">.</span><span class="ident" id="4110188">host</span>&nbsp;<span class="op" id="4110193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110197">return</span>&nbsp;<span class="string" id="4110204">&#34;&#34;</span><span class="op" id="4110206">,</span>&nbsp;<span class="ident" id="4110208">nil</span><span class="op" id="4110211">,</span>&nbsp;<span class="ident" id="4110213">errors</span><span class="op" id="4110219">.</span><span class="ident" id="4110220">New</span><span class="op" id="4110223">(</span><span class="string" id="4110224">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="4110241">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110247">resp</span>&nbsp;<span class="op" id="4110252">:=</span>&nbsp;<span class="op" id="4110255">[</span><span class="op" id="4110256">]</span><span class="builtintype" id="4110257">byte</span><span class="op" id="4110261">(</span><span class="ident" id="4110262">a</span><span class="op" id="4110263">.</span><span class="ident" id="4110264">identity</span>&nbsp;<span class="op" id="4110273">+</span>&nbsp;<span class="string" id="4110275">&#34;\x00&#34;</span>&nbsp;<span class="op" id="4110282">+</span>&nbsp;<span class="ident" id="4110284">a</span><span class="op" id="4110285">.</span><span class="ident" id="4110286">username</span>&nbsp;<span class="op" id="4110295">+</span>&nbsp;<span class="string" id="4110297">&#34;\x00&#34;</span>&nbsp;<span class="op" id="4110304">+</span>&nbsp;<span class="ident" id="4110306">a</span><span class="op" id="4110307">.</span><span class="ident" id="4110308">password</span><span class="op" id="4110316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110319">return</span>&nbsp;<span class="string" id="4110326">&#34;PLAIN&#34;</span><span class="op" id="4110333">,</span>&nbsp;<span class="ident" id="4110335">resp</span><span class="op" id="4110339">,</span>&nbsp;<span class="ident" id="4110341">nil</span><br>
<span class="lineno"></span><span class="op" id="4110345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="4110348">func</span>&nbsp;<span class="op" id="4110353">(</span><span class="ident" id="4110354">a</span>&nbsp;<span class="op" id="4110356">*</span><span class="ident" id="4110357">plainAuth</span><span class="op" id="4110366">)</span>&nbsp;<span class="ident" id="4110368">Next</span><span class="op" id="4110372">(</span><span class="ident" id="4110373">fromServer</span>&nbsp;<span class="op" id="4110384">[</span><span class="op" id="4110385">]</span><span class="builtintype" id="4110386">byte</span><span class="op" id="4110390">,</span>&nbsp;<span class="ident" id="4110392">more</span>&nbsp;<span class="builtintype" id="4110397">bool</span><span class="op" id="4110401">)</span>&nbsp;<span class="op" id="4110403">(</span><span class="op" id="4110404">[</span><span class="op" id="4110405">]</span><span class="builtintype" id="4110406">byte</span><span class="op" id="4110410">,</span>&nbsp;<span class="builtintype" id="4110412">error</span><span class="op" id="4110417">)</span>&nbsp;<span class="op" id="4110419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110422">if</span>&nbsp;<span class="ident" id="4110425">more</span>&nbsp;<span class="op" id="4110430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4110434">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110470">return</span>&nbsp;<span class="ident" id="4110477">nil</span><span class="op" id="4110480">,</span>&nbsp;<span class="ident" id="4110482">errors</span><span class="op" id="4110488">.</span><span class="ident" id="4110489">New</span><span class="op" id="4110492">(</span><span class="string" id="4110493">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="4110522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110525">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110528">return</span>&nbsp;<span class="ident" id="4110535">nil</span><span class="op" id="4110538">,</span>&nbsp;<span class="ident" id="4110540">nil</span><br>
<span class="lineno"></span><span class="op" id="4110544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4110547">type</span>&nbsp;<span class="ident" id="4110552">cramMD5Auth</span>&nbsp;<span class="keyword" id="4110564">struct</span>&nbsp;<span class="op" id="4110571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110574">username</span><span class="op" id="4110582">,</span>&nbsp;<span class="ident" id="4110584">secret</span>&nbsp;<span class="builtintype" id="4110591">string</span><br>
<span class="lineno">85</span><span class="op" id="4110598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4110601">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="4110676">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="4110713">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="4110785">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="4110842">func</span>&nbsp;<span class="ident" id="4110847">CRAMMD5Auth</span><span class="op" id="4110858">(</span><span class="ident" id="4110859">username</span><span class="op" id="4110867">,</span>&nbsp;<span class="ident" id="4110869">secret</span>&nbsp;<span class="builtintype" id="4110876">string</span><span class="op" id="4110882">)</span>&nbsp;<span class="ident" id="4110884">Auth</span>&nbsp;<span class="op" id="4110889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110892">return</span>&nbsp;<span class="op" id="4110899">&amp;</span><span class="ident" id="4110900">cramMD5Auth</span><span class="op" id="4110911">{</span><span class="ident" id="4110912">username</span><span class="op" id="4110920">,</span>&nbsp;<span class="ident" id="4110922">secret</span><span class="op" id="4110928">}</span><br>
<span class="lineno"></span><span class="op" id="4110930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4110933">func</span>&nbsp;<span class="op" id="4110938">(</span><span class="ident" id="4110939">a</span>&nbsp;<span class="op" id="4110941">*</span><span class="ident" id="4110942">cramMD5Auth</span><span class="op" id="4110953">)</span>&nbsp;<span class="ident" id="4110955">Start</span><span class="op" id="4110960">(</span><span class="ident" id="4110961">server</span>&nbsp;<span class="op" id="4110968">*</span><span class="ident" id="4110969">ServerInfo</span><span class="op" id="4110979">)</span>&nbsp;<span class="op" id="4110981">(</span><span class="builtintype" id="4110982">string</span><span class="op" id="4110988">,</span>&nbsp;<span class="op" id="4110990">[</span><span class="op" id="4110991">]</span><span class="builtintype" id="4110992">byte</span><span class="op" id="4110996">,</span>&nbsp;<span class="builtintype" id="4110998">error</span><span class="op" id="4111003">)</span>&nbsp;<span class="op" id="4111005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111008">return</span>&nbsp;<span class="string" id="4111015">&#34;CRAM-MD5&#34;</span><span class="op" id="4111025">,</span>&nbsp;<span class="ident" id="4111027">nil</span><span class="op" id="4111030">,</span>&nbsp;<span class="ident" id="4111032">nil</span><br>
<span class="lineno"></span><span class="op" id="4111036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4111039">func</span>&nbsp;<span class="op" id="4111044">(</span><span class="ident" id="4111045">a</span>&nbsp;<span class="op" id="4111047">*</span><span class="ident" id="4111048">cramMD5Auth</span><span class="op" id="4111059">)</span>&nbsp;<span class="ident" id="4111061">Next</span><span class="op" id="4111065">(</span><span class="ident" id="4111066">fromServer</span>&nbsp;<span class="op" id="4111077">[</span><span class="op" id="4111078">]</span><span class="builtintype" id="4111079">byte</span><span class="op" id="4111083">,</span>&nbsp;<span class="ident" id="4111085">more</span>&nbsp;<span class="builtintype" id="4111090">bool</span><span class="op" id="4111094">)</span>&nbsp;<span class="op" id="4111096">(</span><span class="op" id="4111097">[</span><span class="op" id="4111098">]</span><span class="builtintype" id="4111099">byte</span><span class="op" id="4111103">,</span>&nbsp;<span class="builtintype" id="4111105">error</span><span class="op" id="4111110">)</span>&nbsp;<span class="op" id="4111112">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111115">if</span>&nbsp;<span class="ident" id="4111118">more</span>&nbsp;<span class="op" id="4111123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111127">d</span>&nbsp;<span class="op" id="4111129">:=</span>&nbsp;<span class="ident" id="4111132">hmac</span><span class="op" id="4111136">.</span><span class="ident" id="4111137">New</span><span class="op" id="4111140">(</span><span class="ident" id="4111141">md5</span><span class="op" id="4111144">.</span><span class="ident" id="4111145">New</span><span class="op" id="4111148">,</span>&nbsp;<span class="op" id="4111150">[</span><span class="op" id="4111151">]</span><span class="builtintype" id="4111152">byte</span><span class="op" id="4111156">(</span><span class="ident" id="4111157">a</span><span class="op" id="4111158">.</span><span class="ident" id="4111159">secret</span><span class="op" id="4111165">)</span><span class="op" id="4111166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111170">d</span><span class="op" id="4111171">.</span><span class="ident" id="4111172">Write</span><span class="op" id="4111177">(</span><span class="ident" id="4111178">fromServer</span><span class="op" id="4111188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111192">s</span>&nbsp;<span class="op" id="4111194">:=</span>&nbsp;<span class="builtinfunc" id="4111197">make</span><span class="op" id="4111201">(</span><span class="op" id="4111202">[</span><span class="op" id="4111203">]</span><span class="builtintype" id="4111204">byte</span><span class="op" id="4111208">,</span>&nbsp;<span class="num" id="4111210">0</span><span class="op" id="4111211">,</span>&nbsp;<span class="ident" id="4111213">d</span><span class="op" id="4111214">.</span><span class="ident" id="4111215">Size</span><span class="op" id="4111219">(</span><span class="op" id="4111220">)</span><span class="op" id="4111221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111225">return</span>&nbsp;<span class="op" id="4111232">[</span><span class="op" id="4111233">]</span><span class="builtintype" id="4111234">byte</span><span class="op" id="4111238">(</span><span class="ident" id="4111239">fmt</span><span class="op" id="4111242">.</span><span class="ident" id="4111243">Sprintf</span><span class="op" id="4111250">(</span><span class="string" id="4111251">&#34;%s&nbsp;%x&#34;</span><span class="op" id="4111258">,</span>&nbsp;<span class="ident" id="4111260">a</span><span class="op" id="4111261">.</span><span class="ident" id="4111262">username</span><span class="op" id="4111270">,</span>&nbsp;<span class="ident" id="4111272">d</span><span class="op" id="4111273">.</span><span class="ident" id="4111274">Sum</span><span class="op" id="4111277">(</span><span class="ident" id="4111278">s</span><span class="op" id="4111279">)</span><span class="op" id="4111280">)</span><span class="op" id="4111281">)</span><span class="op" id="4111282">,</span>&nbsp;<span class="ident" id="4111284">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111292">return</span>&nbsp;<span class="ident" id="4111299">nil</span><span class="op" id="4111302">,</span>&nbsp;<span class="ident" id="4111304">nil</span><br>
<span class="lineno"></span><span class="op" id="4111308">}</span>
</div>
</body>
</html>
