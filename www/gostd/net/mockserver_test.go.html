<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6652252">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6652307">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6652361">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6652412">package</span>&nbsp;<span class="ident" id="6652420">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6652425">import</span>&nbsp;<span class="string" id="6652432">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6652440">type</span>&nbsp;<span class="ident" id="6652445">streamListener</span>&nbsp;<span class="keyword" id="6652460">struct</span>&nbsp;<span class="op" id="6652467">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652470">net</span><span class="op" id="6652473">,</span>&nbsp;<span class="ident" id="6652475">addr</span>&nbsp;<span class="builtintype" id="6652480">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652488">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652498">Listener</span><br>
<span class="lineno"></span><span class="op" id="6652507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6652510">type</span>&nbsp;<span class="ident" id="6652515">dualStackServer</span>&nbsp;<span class="keyword" id="6652531">struct</span>&nbsp;<span class="op" id="6652538">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652541">lnmu</span>&nbsp;<span class="ident" id="6652546">sync</span><span class="op" id="6652550">.</span><span class="ident" id="6652551">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652560">lns</span>&nbsp;&nbsp;<span class="op" id="6652565">[</span><span class="op" id="6652566">]</span><span class="ident" id="6652567">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652583">port</span>&nbsp;<span class="builtintype" id="6652588">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652597">cmu</span>&nbsp;<span class="ident" id="6652601">sync</span><span class="op" id="6652605">.</span><span class="ident" id="6652606">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652615">cs</span>&nbsp;&nbsp;<span class="op" id="6652619">[</span><span class="op" id="6652620">]</span><span class="ident" id="6652621">Conn</span>&nbsp;<span class="comment" id="6652626">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="6652678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6652681">func</span>&nbsp;<span class="op" id="6652686">(</span><span class="ident" id="6652687">dss</span>&nbsp;<span class="op" id="6652691">*</span><span class="ident" id="6652692">dualStackServer</span><span class="op" id="6652707">)</span>&nbsp;<span class="ident" id="6652709">buildup</span><span class="op" id="6652716">(</span><span class="ident" id="6652717">server</span>&nbsp;<span class="keyword" id="6652724">func</span><span class="op" id="6652728">(</span><span class="op" id="6652729">*</span><span class="ident" id="6652730">dualStackServer</span><span class="op" id="6652745">,</span>&nbsp;<span class="ident" id="6652747">Listener</span><span class="op" id="6652755">)</span><span class="op" id="6652756">)</span>&nbsp;<span class="builtintype" id="6652758">error</span>&nbsp;<span class="op" id="6652764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652767">for</span>&nbsp;<span class="ident" id="6652771">i</span>&nbsp;<span class="op" id="6652773">:=</span>&nbsp;<span class="keyword" id="6652776">range</span>&nbsp;<span class="ident" id="6652782">dss</span><span class="op" id="6652785">.</span><span class="ident" id="6652786">lns</span>&nbsp;<span class="op" id="6652790">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652794">go</span>&nbsp;<span class="ident" id="6652797">server</span><span class="op" id="6652803">(</span><span class="ident" id="6652804">dss</span><span class="op" id="6652807">,</span>&nbsp;<span class="ident" id="6652809">dss</span><span class="op" id="6652812">.</span><span class="ident" id="6652813">lns</span><span class="op" id="6652816">[</span><span class="ident" id="6652817">i</span><span class="op" id="6652818">]</span><span class="op" id="6652819">.</span><span class="ident" id="6652820">ln</span><span class="op" id="6652822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6652825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652828">return</span>&nbsp;<span class="ident" id="6652835">nil</span><br>
<span class="lineno"></span><span class="op" id="6652839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6652842">func</span>&nbsp;<span class="op" id="6652847">(</span><span class="ident" id="6652848">dss</span>&nbsp;<span class="op" id="6652852">*</span><span class="ident" id="6652853">dualStackServer</span><span class="op" id="6652868">)</span>&nbsp;<span class="ident" id="6652870">putConn</span><span class="op" id="6652877">(</span><span class="ident" id="6652878">c</span>&nbsp;<span class="ident" id="6652880">Conn</span><span class="op" id="6652884">)</span>&nbsp;<span class="builtintype" id="6652886">error</span>&nbsp;<span class="op" id="6652892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652895">dss</span><span class="op" id="6652898">.</span><span class="ident" id="6652899">cmu</span><span class="op" id="6652902">.</span><span class="ident" id="6652903">Lock</span><span class="op" id="6652907">(</span><span class="op" id="6652908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652911">dss</span><span class="op" id="6652914">.</span><span class="ident" id="6652915">cs</span>&nbsp;<span class="op" id="6652918">=</span>&nbsp;<span class="builtinfunc" id="6652920">append</span><span class="op" id="6652926">(</span><span class="ident" id="6652927">dss</span><span class="op" id="6652930">.</span><span class="ident" id="6652931">cs</span><span class="op" id="6652933">,</span>&nbsp;<span class="ident" id="6652935">c</span><span class="op" id="6652936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652939">dss</span><span class="op" id="6652942">.</span><span class="ident" id="6652943">cmu</span><span class="op" id="6652946">.</span><span class="ident" id="6652947">Unlock</span><span class="op" id="6652953">(</span><span class="op" id="6652954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652957">return</span>&nbsp;<span class="ident" id="6652964">nil</span><br>
<span class="lineno">35</span><span class="op" id="6652968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6652971">func</span>&nbsp;<span class="op" id="6652976">(</span><span class="ident" id="6652977">dss</span>&nbsp;<span class="op" id="6652981">*</span><span class="ident" id="6652982">dualStackServer</span><span class="op" id="6652997">)</span>&nbsp;<span class="ident" id="6652999">teardownNetwork</span><span class="op" id="6653014">(</span><span class="ident" id="6653015">net</span>&nbsp;<span class="builtintype" id="6653019">string</span><span class="op" id="6653025">)</span>&nbsp;<span class="builtintype" id="6653027">error</span>&nbsp;<span class="op" id="6653033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653036">dss</span><span class="op" id="6653039">.</span><span class="ident" id="6653040">lnmu</span><span class="op" id="6653044">.</span><span class="ident" id="6653045">Lock</span><span class="op" id="6653049">(</span><span class="op" id="6653050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653053">for</span>&nbsp;<span class="ident" id="6653057">i</span>&nbsp;<span class="op" id="6653059">:=</span>&nbsp;<span class="keyword" id="6653062">range</span>&nbsp;<span class="ident" id="6653068">dss</span><span class="op" id="6653071">.</span><span class="ident" id="6653072">lns</span>&nbsp;<span class="op" id="6653076">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653080">if</span>&nbsp;<span class="ident" id="6653083">net</span>&nbsp;<span class="op" id="6653087">==</span>&nbsp;<span class="ident" id="6653090">dss</span><span class="op" id="6653093">.</span><span class="ident" id="6653094">lns</span><span class="op" id="6653097">[</span><span class="ident" id="6653098">i</span><span class="op" id="6653099">]</span><span class="op" id="6653100">.</span><span class="ident" id="6653101">net</span>&nbsp;<span class="op" id="6653105">&amp;&amp;</span>&nbsp;<span class="ident" id="6653108">dss</span><span class="op" id="6653111">.</span><span class="ident" id="6653112">lns</span><span class="op" id="6653115">[</span><span class="ident" id="6653116">i</span><span class="op" id="6653117">]</span><span class="op" id="6653118">.</span><span class="ident" id="6653119">ln</span>&nbsp;<span class="op" id="6653122">!=</span>&nbsp;<span class="ident" id="6653125">nil</span>&nbsp;<span class="op" id="6653129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653134">dss</span><span class="op" id="6653137">.</span><span class="ident" id="6653138">lns</span><span class="op" id="6653141">[</span><span class="ident" id="6653142">i</span><span class="op" id="6653143">]</span><span class="op" id="6653144">.</span><span class="ident" id="6653145">ln</span><span class="op" id="6653147">.</span><span class="ident" id="6653148">Close</span><span class="op" id="6653153">(</span><span class="op" id="6653154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653159">dss</span><span class="op" id="6653162">.</span><span class="ident" id="6653163">lns</span><span class="op" id="6653166">[</span><span class="ident" id="6653167">i</span><span class="op" id="6653168">]</span><span class="op" id="6653169">.</span><span class="ident" id="6653170">ln</span>&nbsp;<span class="op" id="6653173">=</span>&nbsp;<span class="ident" id="6653175">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653184">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653187">dss</span><span class="op" id="6653190">.</span><span class="ident" id="6653191">lnmu</span><span class="op" id="6653195">.</span><span class="ident" id="6653196">Unlock</span><span class="op" id="6653202">(</span><span class="op" id="6653203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653206">return</span>&nbsp;<span class="ident" id="6653213">nil</span><br>
<span class="lineno"></span><span class="op" id="6653217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653220">func</span>&nbsp;<span class="op" id="6653225">(</span><span class="ident" id="6653226">dss</span>&nbsp;<span class="op" id="6653230">*</span><span class="ident" id="6653231">dualStackServer</span><span class="op" id="6653246">)</span>&nbsp;<span class="ident" id="6653248">teardown</span><span class="op" id="6653256">(</span><span class="op" id="6653257">)</span>&nbsp;<span class="builtintype" id="6653259">error</span>&nbsp;<span class="op" id="6653265">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653268">dss</span><span class="op" id="6653271">.</span><span class="ident" id="6653272">lnmu</span><span class="op" id="6653276">.</span><span class="ident" id="6653277">Lock</span><span class="op" id="6653281">(</span><span class="op" id="6653282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653285">for</span>&nbsp;<span class="ident" id="6653289">i</span>&nbsp;<span class="op" id="6653291">:=</span>&nbsp;<span class="keyword" id="6653294">range</span>&nbsp;<span class="ident" id="6653300">dss</span><span class="op" id="6653303">.</span><span class="ident" id="6653304">lns</span>&nbsp;<span class="op" id="6653308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653312">if</span>&nbsp;<span class="ident" id="6653315">dss</span><span class="op" id="6653318">.</span><span class="ident" id="6653319">lns</span><span class="op" id="6653322">[</span><span class="ident" id="6653323">i</span><span class="op" id="6653324">]</span><span class="op" id="6653325">.</span><span class="ident" id="6653326">ln</span>&nbsp;<span class="op" id="6653329">!=</span>&nbsp;<span class="ident" id="6653332">nil</span>&nbsp;<span class="op" id="6653336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653341">dss</span><span class="op" id="6653344">.</span><span class="ident" id="6653345">lns</span><span class="op" id="6653348">[</span><span class="ident" id="6653349">i</span><span class="op" id="6653350">]</span><span class="op" id="6653351">.</span><span class="ident" id="6653352">ln</span><span class="op" id="6653354">.</span><span class="ident" id="6653355">Close</span><span class="op" id="6653360">(</span><span class="op" id="6653361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653365">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653371">dss</span><span class="op" id="6653374">.</span><span class="ident" id="6653375">lnmu</span><span class="op" id="6653379">.</span><span class="ident" id="6653380">Unlock</span><span class="op" id="6653386">(</span><span class="op" id="6653387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653390">dss</span><span class="op" id="6653393">.</span><span class="ident" id="6653394">cmu</span><span class="op" id="6653397">.</span><span class="ident" id="6653398">Lock</span><span class="op" id="6653402">(</span><span class="op" id="6653403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653406">for</span>&nbsp;<span class="ident" id="6653410">_</span><span class="op" id="6653411">,</span>&nbsp;<span class="ident" id="6653413">c</span>&nbsp;<span class="op" id="6653415">:=</span>&nbsp;<span class="keyword" id="6653418">range</span>&nbsp;<span class="ident" id="6653424">dss</span><span class="op" id="6653427">.</span><span class="ident" id="6653428">cs</span>&nbsp;<span class="op" id="6653431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653435">c</span><span class="op" id="6653436">.</span><span class="ident" id="6653437">Close</span><span class="op" id="6653442">(</span><span class="op" id="6653443">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653449">dss</span><span class="op" id="6653452">.</span><span class="ident" id="6653453">cmu</span><span class="op" id="6653456">.</span><span class="ident" id="6653457">Unlock</span><span class="op" id="6653463">(</span><span class="op" id="6653464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653467">return</span>&nbsp;<span class="ident" id="6653474">nil</span><br>
<span class="lineno"></span><span class="op" id="6653478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6653481">func</span>&nbsp;<span class="ident" id="6653486">newDualStackServer</span><span class="op" id="6653504">(</span><span class="ident" id="6653505">lns</span>&nbsp;<span class="op" id="6653509">[</span><span class="op" id="6653510">]</span><span class="ident" id="6653511">streamListener</span><span class="op" id="6653525">)</span>&nbsp;<span class="op" id="6653527">(</span><span class="op" id="6653528">*</span><span class="ident" id="6653529">dualStackServer</span><span class="op" id="6653544">,</span>&nbsp;<span class="builtintype" id="6653546">error</span><span class="op" id="6653551">)</span>&nbsp;<span class="op" id="6653553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653556">dss</span>&nbsp;<span class="op" id="6653560">:=</span>&nbsp;<span class="op" id="6653563">&amp;</span><span class="ident" id="6653564">dualStackServer</span><span class="op" id="6653579">{</span><span class="ident" id="6653580">lns</span><span class="op" id="6653583">:</span>&nbsp;<span class="ident" id="6653585">lns</span><span class="op" id="6653588">,</span>&nbsp;<span class="ident" id="6653590">port</span><span class="op" id="6653594">:</span>&nbsp;<span class="string" id="6653596">&#34;0&#34;</span><span class="op" id="6653599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653602">for</span>&nbsp;<span class="ident" id="6653606">i</span>&nbsp;<span class="op" id="6653608">:=</span>&nbsp;<span class="keyword" id="6653611">range</span>&nbsp;<span class="ident" id="6653617">dss</span><span class="op" id="6653620">.</span><span class="ident" id="6653621">lns</span>&nbsp;<span class="op" id="6653625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653629">ln</span><span class="op" id="6653631">,</span>&nbsp;<span class="ident" id="6653633">err</span>&nbsp;<span class="op" id="6653637">:=</span>&nbsp;<span class="ident" id="6653640">Listen</span><span class="op" id="6653646">(</span><span class="ident" id="6653647">dss</span><span class="op" id="6653650">.</span><span class="ident" id="6653651">lns</span><span class="op" id="6653654">[</span><span class="ident" id="6653655">i</span><span class="op" id="6653656">]</span><span class="op" id="6653657">.</span><span class="ident" id="6653658">net</span><span class="op" id="6653661">,</span>&nbsp;<span class="ident" id="6653663">dss</span><span class="op" id="6653666">.</span><span class="ident" id="6653667">lns</span><span class="op" id="6653670">[</span><span class="ident" id="6653671">i</span><span class="op" id="6653672">]</span><span class="op" id="6653673">.</span><span class="ident" id="6653674">addr</span><span class="op" id="6653678">+</span><span class="string" id="6653679">&#34;:&#34;</span><span class="op" id="6653682">+</span><span class="ident" id="6653683">dss</span><span class="op" id="6653686">.</span><span class="ident" id="6653687">port</span><span class="op" id="6653691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653695">if</span>&nbsp;<span class="ident" id="6653698">err</span>&nbsp;<span class="op" id="6653702">!=</span>&nbsp;<span class="ident" id="6653705">nil</span>&nbsp;<span class="op" id="6653709">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653714">dss</span><span class="op" id="6653717">.</span><span class="ident" id="6653718">teardown</span><span class="op" id="6653726">(</span><span class="op" id="6653727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653732">return</span>&nbsp;<span class="ident" id="6653739">nil</span><span class="op" id="6653742">,</span>&nbsp;<span class="ident" id="6653744">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653754">dss</span><span class="op" id="6653757">.</span><span class="ident" id="6653758">lns</span><span class="op" id="6653761">[</span><span class="ident" id="6653762">i</span><span class="op" id="6653763">]</span><span class="op" id="6653764">.</span><span class="ident" id="6653765">ln</span>&nbsp;<span class="op" id="6653768">=</span>&nbsp;<span class="ident" id="6653770">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653775">if</span>&nbsp;<span class="ident" id="6653778">dss</span><span class="op" id="6653781">.</span><span class="ident" id="6653782">port</span>&nbsp;<span class="op" id="6653787">==</span>&nbsp;<span class="string" id="6653790">&#34;0&#34;</span>&nbsp;<span class="op" id="6653794">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653799">if</span>&nbsp;<span class="ident" id="6653802">_</span><span class="op" id="6653803">,</span>&nbsp;<span class="ident" id="6653805">dss</span><span class="op" id="6653808">.</span><span class="ident" id="6653809">port</span><span class="op" id="6653813">,</span>&nbsp;<span class="ident" id="6653815">err</span>&nbsp;<span class="op" id="6653819">=</span>&nbsp;<span class="ident" id="6653821">SplitHostPort</span><span class="op" id="6653834">(</span><span class="ident" id="6653835">ln</span><span class="op" id="6653837">.</span><span class="ident" id="6653838">Addr</span><span class="op" id="6653842">(</span><span class="op" id="6653843">)</span><span class="op" id="6653844">.</span><span class="ident" id="6653845">String</span><span class="op" id="6653851">(</span><span class="op" id="6653852">)</span><span class="op" id="6653853">)</span><span class="op" id="6653854">;</span>&nbsp;<span class="ident" id="6653856">err</span>&nbsp;<span class="op" id="6653860">!=</span>&nbsp;<span class="ident" id="6653863">nil</span>&nbsp;<span class="op" id="6653867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653873">dss</span><span class="op" id="6653876">.</span><span class="ident" id="6653877">teardown</span><span class="op" id="6653885">(</span><span class="op" id="6653886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653892">return</span>&nbsp;<span class="ident" id="6653899">nil</span><span class="op" id="6653902">,</span>&nbsp;<span class="ident" id="6653904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653915">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6653921">return</span>&nbsp;<span class="ident" id="6653928">dss</span><span class="op" id="6653931">,</span>&nbsp;<span class="ident" id="6653933">nil</span><br>
<span class="lineno"></span><span class="op" id="6653937">}</span>
</div>
</body>
</html>
