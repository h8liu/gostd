<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2498542">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2498598">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2498652">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2498703">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2498773">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2498805">package</span>&nbsp;<span class="ident" id="2498813">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2498822">import</span>&nbsp;<span class="string" id="2498829">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2498837">var</span>&nbsp;<span class="op" id="2498841">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2498844">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498911">envOnce</span>&nbsp;<span class="ident" id="2498919">sync</span><span class="op" id="2498923">.</span><span class="ident" id="2498924">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2498931">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498964">envLock</span>&nbsp;<span class="ident" id="2498972">sync</span><span class="op" id="2498976">.</span><span class="ident" id="2498977">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2498987">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499062">env</span>&nbsp;<span class="keyword" id="2499066">map</span><span class="op" id="2499069">[</span><span class="builtintype" id="2499070">string</span><span class="op" id="2499076">]</span><span class="builtintype" id="2499077">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499083">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499145">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499207">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499243">envs</span>&nbsp;<span class="op" id="2499248">[</span><span class="op" id="2499249">]</span><span class="builtintype" id="2499250">string</span>&nbsp;<span class="op" id="2499257">=</span>&nbsp;<span class="ident" id="2499259">runtime_envs</span><span class="op" id="2499271">(</span><span class="op" id="2499272">)</span><br>
<span class="lineno"></span><span class="op" id="2499274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2499277">func</span>&nbsp;<span class="ident" id="2499282">runtime_envs</span><span class="op" id="2499294">(</span><span class="op" id="2499295">)</span>&nbsp;<span class="op" id="2499297">[</span><span class="op" id="2499298">]</span><span class="builtintype" id="2499299">string</span>&nbsp;<span class="comment" id="2499306">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2499329">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2499399">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2499423">func</span>&nbsp;<span class="ident" id="2499428">setenv_c</span><span class="op" id="2499436">(</span><span class="ident" id="2499437">k</span><span class="op" id="2499438">,</span>&nbsp;<span class="ident" id="2499440">v</span>&nbsp;<span class="builtintype" id="2499442">string</span><span class="op" id="2499448">)</span><br>
<span class="lineno"></span><span class="keyword" id="2499450">func</span>&nbsp;<span class="ident" id="2499455">unsetenv_c</span><span class="op" id="2499465">(</span><span class="ident" id="2499466">k</span>&nbsp;<span class="builtintype" id="2499468">string</span><span class="op" id="2499474">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2499477">func</span>&nbsp;<span class="ident" id="2499482">copyenv</span><span class="op" id="2499489">(</span><span class="op" id="2499490">)</span>&nbsp;<span class="op" id="2499492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499495">env</span>&nbsp;<span class="op" id="2499499">=</span>&nbsp;<span class="builtinfunc" id="2499501">make</span><span class="op" id="2499505">(</span><span class="keyword" id="2499506">map</span><span class="op" id="2499509">[</span><span class="builtintype" id="2499510">string</span><span class="op" id="2499516">]</span><span class="builtintype" id="2499517">int</span><span class="op" id="2499520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499523">for</span>&nbsp;<span class="ident" id="2499527">i</span><span class="op" id="2499528">,</span>&nbsp;<span class="ident" id="2499530">s</span>&nbsp;<span class="op" id="2499532">:=</span>&nbsp;<span class="keyword" id="2499535">range</span>&nbsp;<span class="ident" id="2499541">envs</span>&nbsp;<span class="op" id="2499546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499550">for</span>&nbsp;<span class="ident" id="2499554">j</span>&nbsp;<span class="op" id="2499556">:=</span>&nbsp;<span class="num" id="2499559">0</span><span class="op" id="2499560">;</span>&nbsp;<span class="ident" id="2499562">j</span>&nbsp;<span class="op" id="2499564">&lt;</span>&nbsp;<span class="builtinfunc" id="2499566">len</span><span class="op" id="2499569">(</span><span class="ident" id="2499570">s</span><span class="op" id="2499571">)</span><span class="op" id="2499572">;</span>&nbsp;<span class="ident" id="2499574">j</span><span class="op" id="2499575">++</span>&nbsp;<span class="op" id="2499578">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499583">if</span>&nbsp;<span class="ident" id="2499586">s</span><span class="op" id="2499587">[</span><span class="ident" id="2499588">j</span><span class="op" id="2499589">]</span>&nbsp;<span class="op" id="2499591">==</span>&nbsp;<span class="string" id="2499594">&#39;=&#39;</span>&nbsp;<span class="op" id="2499598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499604">key</span>&nbsp;<span class="op" id="2499608">:=</span>&nbsp;<span class="ident" id="2499611">s</span><span class="op" id="2499612">[</span><span class="op" id="2499613">:</span><span class="ident" id="2499614">j</span><span class="op" id="2499615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499621">if</span>&nbsp;<span class="ident" id="2499624">_</span><span class="op" id="2499625">,</span>&nbsp;<span class="ident" id="2499627">ok</span>&nbsp;<span class="op" id="2499630">:=</span>&nbsp;<span class="ident" id="2499633">env</span><span class="op" id="2499636">[</span><span class="ident" id="2499637">key</span><span class="op" id="2499640">]</span><span class="op" id="2499641">;</span>&nbsp;<span class="op" id="2499643">!</span><span class="ident" id="2499644">ok</span>&nbsp;<span class="op" id="2499647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499654">env</span><span class="op" id="2499657">[</span><span class="ident" id="2499658">key</span><span class="op" id="2499661">]</span>&nbsp;<span class="op" id="2499663">=</span>&nbsp;<span class="ident" id="2499665">i</span>&nbsp;<span class="comment" id="2499667">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499695">}</span>&nbsp;<span class="keyword" id="2499697">else</span>&nbsp;<span class="op" id="2499702">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499709">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499764">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499814">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499862">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499905">envs</span><span class="op" id="2499909">[</span><span class="ident" id="2499910">i</span><span class="op" id="2499911">]</span>&nbsp;<span class="op" id="2499913">=</span>&nbsp;<span class="string" id="2499915">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499928">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499944">}</span><br>
<span class="lineno">55</span><span class="op" id="2499946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2499949">func</span>&nbsp;<span class="ident" id="2499954">Unsetenv</span><span class="op" id="2499962">(</span><span class="ident" id="2499963">key</span>&nbsp;<span class="builtintype" id="2499967">string</span><span class="op" id="2499973">)</span>&nbsp;<span class="builtintype" id="2499975">error</span>&nbsp;<span class="op" id="2499981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499984">envOnce</span><span class="op" id="2499991">.</span><span class="ident" id="2499992">Do</span><span class="op" id="2499994">(</span><span class="ident" id="2499995">copyenv</span><span class="op" id="2500002">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500006">envLock</span><span class="op" id="2500013">.</span><span class="ident" id="2500014">Lock</span><span class="op" id="2500018">(</span><span class="op" id="2500019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500022">defer</span>&nbsp;<span class="ident" id="2500028">envLock</span><span class="op" id="2500035">.</span><span class="ident" id="2500036">Unlock</span><span class="op" id="2500042">(</span><span class="op" id="2500043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500047">if</span>&nbsp;<span class="ident" id="2500050">i</span><span class="op" id="2500051">,</span>&nbsp;<span class="ident" id="2500053">ok</span>&nbsp;<span class="op" id="2500056">:=</span>&nbsp;<span class="ident" id="2500059">env</span><span class="op" id="2500062">[</span><span class="ident" id="2500063">key</span><span class="op" id="2500066">]</span><span class="op" id="2500067">;</span>&nbsp;<span class="ident" id="2500069">ok</span>&nbsp;<span class="op" id="2500072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500076">envs</span><span class="op" id="2500080">[</span><span class="ident" id="2500081">i</span><span class="op" id="2500082">]</span>&nbsp;<span class="op" id="2500084">=</span>&nbsp;<span class="string" id="2500086">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2500091">delete</span><span class="op" id="2500097">(</span><span class="ident" id="2500098">env</span><span class="op" id="2500101">,</span>&nbsp;<span class="ident" id="2500103">key</span><span class="op" id="2500106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500112">unsetenv_c</span><span class="op" id="2500122">(</span><span class="ident" id="2500123">key</span><span class="op" id="2500126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500129">return</span>&nbsp;<span class="ident" id="2500136">nil</span><br>
<span class="lineno"></span><span class="op" id="2500140">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2500143">func</span>&nbsp;<span class="ident" id="2500148">Getenv</span><span class="op" id="2500154">(</span><span class="ident" id="2500155">key</span>&nbsp;<span class="builtintype" id="2500159">string</span><span class="op" id="2500165">)</span>&nbsp;<span class="op" id="2500167">(</span><span class="ident" id="2500168">value</span>&nbsp;<span class="builtintype" id="2500174">string</span><span class="op" id="2500180">,</span>&nbsp;<span class="ident" id="2500182">found</span>&nbsp;<span class="builtintype" id="2500188">bool</span><span class="op" id="2500192">)</span>&nbsp;<span class="op" id="2500194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500197">envOnce</span><span class="op" id="2500204">.</span><span class="ident" id="2500205">Do</span><span class="op" id="2500207">(</span><span class="ident" id="2500208">copyenv</span><span class="op" id="2500215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500218">if</span>&nbsp;<span class="builtinfunc" id="2500221">len</span><span class="op" id="2500224">(</span><span class="ident" id="2500225">key</span><span class="op" id="2500228">)</span>&nbsp;<span class="op" id="2500230">==</span>&nbsp;<span class="num" id="2500233">0</span>&nbsp;<span class="op" id="2500235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500239">return</span>&nbsp;<span class="string" id="2500246">&#34;&#34;</span><span class="op" id="2500248">,</span>&nbsp;<span class="builtintype" id="2500250">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500261">envLock</span><span class="op" id="2500268">.</span><span class="ident" id="2500269">RLock</span><span class="op" id="2500274">(</span><span class="op" id="2500275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500278">defer</span>&nbsp;<span class="ident" id="2500284">envLock</span><span class="op" id="2500291">.</span><span class="ident" id="2500292">RUnlock</span><span class="op" id="2500299">(</span><span class="op" id="2500300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500304">i</span><span class="op" id="2500305">,</span>&nbsp;<span class="ident" id="2500307">ok</span>&nbsp;<span class="op" id="2500310">:=</span>&nbsp;<span class="ident" id="2500313">env</span><span class="op" id="2500316">[</span><span class="ident" id="2500317">key</span><span class="op" id="2500320">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500323">if</span>&nbsp;<span class="op" id="2500326">!</span><span class="ident" id="2500327">ok</span>&nbsp;<span class="op" id="2500330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500334">return</span>&nbsp;<span class="string" id="2500341">&#34;&#34;</span><span class="op" id="2500343">,</span>&nbsp;<span class="builtintype" id="2500345">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500355">s</span>&nbsp;<span class="op" id="2500357">:=</span>&nbsp;<span class="ident" id="2500360">envs</span><span class="op" id="2500364">[</span><span class="ident" id="2500365">i</span><span class="op" id="2500366">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500369">for</span>&nbsp;<span class="ident" id="2500373">i</span>&nbsp;<span class="op" id="2500375">:=</span>&nbsp;<span class="num" id="2500378">0</span><span class="op" id="2500379">;</span>&nbsp;<span class="ident" id="2500381">i</span>&nbsp;<span class="op" id="2500383">&lt;</span>&nbsp;<span class="builtinfunc" id="2500385">len</span><span class="op" id="2500388">(</span><span class="ident" id="2500389">s</span><span class="op" id="2500390">)</span><span class="op" id="2500391">;</span>&nbsp;<span class="ident" id="2500393">i</span><span class="op" id="2500394">++</span>&nbsp;<span class="op" id="2500397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500401">if</span>&nbsp;<span class="ident" id="2500404">s</span><span class="op" id="2500405">[</span><span class="ident" id="2500406">i</span><span class="op" id="2500407">]</span>&nbsp;<span class="op" id="2500409">==</span>&nbsp;<span class="string" id="2500412">&#39;=&#39;</span>&nbsp;<span class="op" id="2500416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500421">return</span>&nbsp;<span class="ident" id="2500428">s</span><span class="op" id="2500429">[</span><span class="ident" id="2500430">i</span><span class="op" id="2500431">+</span><span class="num" id="2500432">1</span><span class="op" id="2500433">:</span><span class="op" id="2500434">]</span><span class="op" id="2500435">,</span>&nbsp;<span class="builtintype" id="2500437">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500447">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500450">return</span>&nbsp;<span class="string" id="2500457">&#34;&#34;</span><span class="op" id="2500459">,</span>&nbsp;<span class="builtintype" id="2500461">false</span><br>
<span class="lineno"></span><span class="op" id="2500467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2500470">func</span>&nbsp;<span class="ident" id="2500475">Setenv</span><span class="op" id="2500481">(</span><span class="ident" id="2500482">key</span><span class="op" id="2500485">,</span>&nbsp;<span class="ident" id="2500487">value</span>&nbsp;<span class="builtintype" id="2500493">string</span><span class="op" id="2500499">)</span>&nbsp;<span class="builtintype" id="2500501">error</span>&nbsp;<span class="op" id="2500507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500510">envOnce</span><span class="op" id="2500517">.</span><span class="ident" id="2500518">Do</span><span class="op" id="2500520">(</span><span class="ident" id="2500521">copyenv</span><span class="op" id="2500528">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500531">if</span>&nbsp;<span class="builtinfunc" id="2500534">len</span><span class="op" id="2500537">(</span><span class="ident" id="2500538">key</span><span class="op" id="2500541">)</span>&nbsp;<span class="op" id="2500543">==</span>&nbsp;<span class="num" id="2500546">0</span>&nbsp;<span class="op" id="2500548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500552">return</span>&nbsp;<span class="ident" id="2500559">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500570">for</span>&nbsp;<span class="ident" id="2500574">i</span>&nbsp;<span class="op" id="2500576">:=</span>&nbsp;<span class="num" id="2500579">0</span><span class="op" id="2500580">;</span>&nbsp;<span class="ident" id="2500582">i</span>&nbsp;<span class="op" id="2500584">&lt;</span>&nbsp;<span class="builtinfunc" id="2500586">len</span><span class="op" id="2500589">(</span><span class="ident" id="2500590">key</span><span class="op" id="2500593">)</span><span class="op" id="2500594">;</span>&nbsp;<span class="ident" id="2500596">i</span><span class="op" id="2500597">++</span>&nbsp;<span class="op" id="2500600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500604">if</span>&nbsp;<span class="ident" id="2500607">key</span><span class="op" id="2500610">[</span><span class="ident" id="2500611">i</span><span class="op" id="2500612">]</span>&nbsp;<span class="op" id="2500614">==</span>&nbsp;<span class="string" id="2500617">&#39;=&#39;</span>&nbsp;<span class="op" id="2500621">||</span>&nbsp;<span class="ident" id="2500624">key</span><span class="op" id="2500627">[</span><span class="ident" id="2500628">i</span><span class="op" id="2500629">]</span>&nbsp;<span class="op" id="2500631">==</span>&nbsp;<span class="num" id="2500634">0</span>&nbsp;<span class="op" id="2500636">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500641">return</span>&nbsp;<span class="ident" id="2500648">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500663">for</span>&nbsp;<span class="ident" id="2500667">i</span>&nbsp;<span class="op" id="2500669">:=</span>&nbsp;<span class="num" id="2500672">0</span><span class="op" id="2500673">;</span>&nbsp;<span class="ident" id="2500675">i</span>&nbsp;<span class="op" id="2500677">&lt;</span>&nbsp;<span class="builtinfunc" id="2500679">len</span><span class="op" id="2500682">(</span><span class="ident" id="2500683">value</span><span class="op" id="2500688">)</span><span class="op" id="2500689">;</span>&nbsp;<span class="ident" id="2500691">i</span><span class="op" id="2500692">++</span>&nbsp;<span class="op" id="2500695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500699">if</span>&nbsp;<span class="ident" id="2500702">value</span><span class="op" id="2500707">[</span><span class="ident" id="2500708">i</span><span class="op" id="2500709">]</span>&nbsp;<span class="op" id="2500711">==</span>&nbsp;<span class="num" id="2500714">0</span>&nbsp;<span class="op" id="2500716">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500721">return</span>&nbsp;<span class="ident" id="2500728">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500744">envLock</span><span class="op" id="2500751">.</span><span class="ident" id="2500752">Lock</span><span class="op" id="2500756">(</span><span class="op" id="2500757">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500760">defer</span>&nbsp;<span class="ident" id="2500766">envLock</span><span class="op" id="2500773">.</span><span class="ident" id="2500774">Unlock</span><span class="op" id="2500780">(</span><span class="op" id="2500781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500785">i</span><span class="op" id="2500786">,</span>&nbsp;<span class="ident" id="2500788">ok</span>&nbsp;<span class="op" id="2500791">:=</span>&nbsp;<span class="ident" id="2500794">env</span><span class="op" id="2500797">[</span><span class="ident" id="2500798">key</span><span class="op" id="2500801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500804">kv</span>&nbsp;<span class="op" id="2500807">:=</span>&nbsp;<span class="ident" id="2500810">key</span>&nbsp;<span class="op" id="2500814">+</span>&nbsp;<span class="string" id="2500816">&#34;=&#34;</span>&nbsp;<span class="op" id="2500820">+</span>&nbsp;<span class="ident" id="2500822">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500829">if</span>&nbsp;<span class="ident" id="2500832">ok</span>&nbsp;<span class="op" id="2500835">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500839">envs</span><span class="op" id="2500843">[</span><span class="ident" id="2500844">i</span><span class="op" id="2500845">]</span>&nbsp;<span class="op" id="2500847">=</span>&nbsp;<span class="ident" id="2500849">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500853">}</span>&nbsp;<span class="keyword" id="2500855">else</span>&nbsp;<span class="op" id="2500860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500864">i</span>&nbsp;<span class="op" id="2500866">=</span>&nbsp;<span class="builtinfunc" id="2500868">len</span><span class="op" id="2500871">(</span><span class="ident" id="2500872">envs</span><span class="op" id="2500876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500880">envs</span>&nbsp;<span class="op" id="2500885">=</span>&nbsp;<span class="builtinfunc" id="2500887">append</span><span class="op" id="2500893">(</span><span class="ident" id="2500894">envs</span><span class="op" id="2500898">,</span>&nbsp;<span class="ident" id="2500900">kv</span><span class="op" id="2500902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500905">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500908">env</span><span class="op" id="2500911">[</span><span class="ident" id="2500912">key</span><span class="op" id="2500915">]</span>&nbsp;<span class="op" id="2500917">=</span>&nbsp;<span class="ident" id="2500919">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500922">setenv_c</span><span class="op" id="2500930">(</span><span class="ident" id="2500931">key</span><span class="op" id="2500934">,</span>&nbsp;<span class="ident" id="2500936">value</span><span class="op" id="2500941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500944">return</span>&nbsp;<span class="ident" id="2500951">nil</span><br>
<span class="lineno"></span><span class="op" id="2500955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2500958">func</span>&nbsp;<span class="ident" id="2500963">Clearenv</span><span class="op" id="2500971">(</span><span class="op" id="2500972">)</span>&nbsp;<span class="op" id="2500974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500977">envOnce</span><span class="op" id="2500984">.</span><span class="ident" id="2500985">Do</span><span class="op" id="2500987">(</span><span class="ident" id="2500988">copyenv</span><span class="op" id="2500995">)</span>&nbsp;<span class="comment" id="2500997">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501035">envLock</span><span class="op" id="2501042">.</span><span class="ident" id="2501043">Lock</span><span class="op" id="2501047">(</span><span class="op" id="2501048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501051">defer</span>&nbsp;<span class="ident" id="2501057">envLock</span><span class="op" id="2501064">.</span><span class="ident" id="2501065">Unlock</span><span class="op" id="2501071">(</span><span class="op" id="2501072">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501076">for</span>&nbsp;<span class="ident" id="2501080">k</span>&nbsp;<span class="op" id="2501082">:=</span>&nbsp;<span class="keyword" id="2501085">range</span>&nbsp;<span class="ident" id="2501091">env</span>&nbsp;<span class="op" id="2501095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501099">unsetenv_c</span><span class="op" id="2501109">(</span><span class="ident" id="2501110">k</span><span class="op" id="2501111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501117">env</span>&nbsp;<span class="op" id="2501121">=</span>&nbsp;<span class="builtinfunc" id="2501123">make</span><span class="op" id="2501127">(</span><span class="keyword" id="2501128">map</span><span class="op" id="2501131">[</span><span class="builtintype" id="2501132">string</span><span class="op" id="2501138">]</span><span class="builtintype" id="2501139">int</span><span class="op" id="2501142">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501145">envs</span>&nbsp;<span class="op" id="2501150">=</span>&nbsp;<span class="op" id="2501152">[</span><span class="op" id="2501153">]</span><span class="builtintype" id="2501154">string</span><span class="op" id="2501160">{</span><span class="op" id="2501161">}</span><br>
<span class="lineno"></span><span class="op" id="2501163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2501166">func</span>&nbsp;<span class="ident" id="2501171">Environ</span><span class="op" id="2501178">(</span><span class="op" id="2501179">)</span>&nbsp;<span class="op" id="2501181">[</span><span class="op" id="2501182">]</span><span class="builtintype" id="2501183">string</span>&nbsp;<span class="op" id="2501190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501193">envOnce</span><span class="op" id="2501200">.</span><span class="ident" id="2501201">Do</span><span class="op" id="2501203">(</span><span class="ident" id="2501204">copyenv</span><span class="op" id="2501211">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501214">envLock</span><span class="op" id="2501221">.</span><span class="ident" id="2501222">RLock</span><span class="op" id="2501227">(</span><span class="op" id="2501228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501231">defer</span>&nbsp;<span class="ident" id="2501237">envLock</span><span class="op" id="2501244">.</span><span class="ident" id="2501245">RUnlock</span><span class="op" id="2501252">(</span><span class="op" id="2501253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501256">a</span>&nbsp;<span class="op" id="2501258">:=</span>&nbsp;<span class="builtinfunc" id="2501261">make</span><span class="op" id="2501265">(</span><span class="op" id="2501266">[</span><span class="op" id="2501267">]</span><span class="builtintype" id="2501268">string</span><span class="op" id="2501274">,</span>&nbsp;<span class="num" id="2501276">0</span><span class="op" id="2501277">,</span>&nbsp;<span class="builtinfunc" id="2501279">len</span><span class="op" id="2501282">(</span><span class="ident" id="2501283">envs</span><span class="op" id="2501287">)</span><span class="op" id="2501288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501291">for</span>&nbsp;<span class="ident" id="2501295">_</span><span class="op" id="2501296">,</span>&nbsp;<span class="ident" id="2501298">env</span>&nbsp;<span class="op" id="2501302">:=</span>&nbsp;<span class="keyword" id="2501305">range</span>&nbsp;<span class="ident" id="2501311">envs</span>&nbsp;<span class="op" id="2501316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501320">if</span>&nbsp;<span class="ident" id="2501323">env</span>&nbsp;<span class="op" id="2501327">!=</span>&nbsp;<span class="string" id="2501330">&#34;&#34;</span>&nbsp;<span class="op" id="2501333">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501338">a</span>&nbsp;<span class="op" id="2501340">=</span>&nbsp;<span class="builtinfunc" id="2501342">append</span><span class="op" id="2501348">(</span><span class="ident" id="2501349">a</span><span class="op" id="2501350">,</span>&nbsp;<span class="ident" id="2501352">env</span><span class="op" id="2501355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501365">return</span>&nbsp;<span class="ident" id="2501372">a</span><br>
<span class="lineno"></span><span class="op" id="2501374">}</span>
</div>
</body>
</html>
