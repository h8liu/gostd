<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html" class="current">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7046791">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7046846">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7046900">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7046951">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="7047024">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7047097">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7047170">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="7047240">//</span><br>
<span class="lineno">10</span><span class="comment" id="7047243">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="7047315">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="7047389">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="7047462">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="7047505">//</span><br>
<span class="lineno">15</span><span class="comment" id="7047508">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7047581">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="7047640">//</span><br>
<span class="lineno"></span><span class="comment" id="7047643">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="7047656">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="7047670">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="7047711">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7047717">package</span>&nbsp;<span class="ident" id="7047725">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7047733">import</span>&nbsp;<span class="op" id="7047740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047743">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047757">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047769">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047782">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047799">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047809">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7047820">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7047830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7047833">const</span>&nbsp;<span class="ident" id="7047839">testdata</span>&nbsp;<span class="op" id="7047848">=</span>&nbsp;<span class="string" id="7047850">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7047862">var</span>&nbsp;<span class="ident" id="7047866">fsetErrs</span>&nbsp;<span class="op" id="7047875">=</span>&nbsp;<span class="ident" id="7047877">token</span><span class="op" id="7047882">.</span><span class="ident" id="7047883">NewFileSet</span><span class="op" id="7047893">(</span><span class="op" id="7047894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7047897">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="7047955">func</span>&nbsp;<span class="ident" id="7047960">getFile</span><span class="op" id="7047967">(</span><span class="ident" id="7047968">filename</span>&nbsp;<span class="builtintype" id="7047977">string</span><span class="op" id="7047983">)</span>&nbsp;<span class="op" id="7047985">(</span><span class="ident" id="7047986">file</span>&nbsp;<span class="op" id="7047991">*</span><span class="ident" id="7047992">token</span><span class="op" id="7047997">.</span><span class="ident" id="7047998">File</span><span class="op" id="7048002">)</span>&nbsp;<span class="op" id="7048004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048007">fsetErrs</span><span class="op" id="7048015">.</span><span class="ident" id="7048016">Iterate</span><span class="op" id="7048023">(</span><span class="keyword" id="7048024">func</span><span class="op" id="7048028">(</span><span class="ident" id="7048029">f</span>&nbsp;<span class="op" id="7048031">*</span><span class="ident" id="7048032">token</span><span class="op" id="7048037">.</span><span class="ident" id="7048038">File</span><span class="op" id="7048042">)</span>&nbsp;<span class="builtintype" id="7048044">bool</span>&nbsp;<span class="op" id="7048049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048053">if</span>&nbsp;<span class="ident" id="7048056">f</span><span class="op" id="7048057">.</span><span class="ident" id="7048058">Name</span><span class="op" id="7048062">(</span><span class="op" id="7048063">)</span>&nbsp;<span class="op" id="7048065">==</span>&nbsp;<span class="ident" id="7048068">filename</span>&nbsp;<span class="op" id="7048077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048082">if</span>&nbsp;<span class="ident" id="7048085">file</span>&nbsp;<span class="op" id="7048090">!=</span>&nbsp;<span class="ident" id="7048093">nil</span>&nbsp;<span class="op" id="7048097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7048103">panic</span><span class="op" id="7048108">(</span><span class="ident" id="7048109">filename</span>&nbsp;<span class="op" id="7048118">+</span>&nbsp;<span class="string" id="7048120">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="7048142">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048152">file</span>&nbsp;<span class="op" id="7048157">=</span>&nbsp;<span class="ident" id="7048159">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048167">return</span>&nbsp;<span class="builtintype" id="7048174">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048180">}</span><span class="op" id="7048181">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048184">return</span>&nbsp;<span class="ident" id="7048191">file</span><br>
<span class="lineno"></span><span class="op" id="7048196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7048199">func</span>&nbsp;<span class="ident" id="7048204">getPos</span><span class="op" id="7048210">(</span><span class="ident" id="7048211">filename</span>&nbsp;<span class="builtintype" id="7048220">string</span><span class="op" id="7048226">,</span>&nbsp;<span class="ident" id="7048228">offset</span>&nbsp;<span class="builtintype" id="7048235">int</span><span class="op" id="7048238">)</span>&nbsp;<span class="ident" id="7048240">token</span><span class="op" id="7048245">.</span><span class="ident" id="7048246">Pos</span>&nbsp;<span class="op" id="7048250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048253">if</span>&nbsp;<span class="ident" id="7048256">f</span>&nbsp;<span class="op" id="7048258">:=</span>&nbsp;<span class="ident" id="7048261">getFile</span><span class="op" id="7048268">(</span><span class="ident" id="7048269">filename</span><span class="op" id="7048277">)</span><span class="op" id="7048278">;</span>&nbsp;<span class="ident" id="7048280">f</span>&nbsp;<span class="op" id="7048282">!=</span>&nbsp;<span class="ident" id="7048285">nil</span>&nbsp;<span class="op" id="7048289">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048293">return</span>&nbsp;<span class="ident" id="7048300">f</span><span class="op" id="7048301">.</span><span class="ident" id="7048302">Pos</span><span class="op" id="7048305">(</span><span class="ident" id="7048306">offset</span><span class="op" id="7048312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048318">return</span>&nbsp;<span class="ident" id="7048325">token</span><span class="op" id="7048330">.</span><span class="ident" id="7048331">NoPos</span><br>
<span class="lineno"></span><span class="op" id="7048337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7048340">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="7048405">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="7048470">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="7048535">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="7048601">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="7048624">//</span><br>
<span class="lineno"></span><span class="keyword" id="7048627">var</span>&nbsp;<span class="ident" id="7048631">errRx</span>&nbsp;<span class="op" id="7048637">=</span>&nbsp;<span class="ident" id="7048639">regexp</span><span class="op" id="7048645">.</span><span class="ident" id="7048646">MustCompile</span><span class="op" id="7048657">(</span><span class="string" id="7048658">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="7048697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7048700">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="7048775">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="7048851">//</span><br>
<span class="lineno"></span><span class="keyword" id="7048854">func</span>&nbsp;<span class="ident" id="7048859">expectedErrors</span><span class="op" id="7048873">(</span><span class="ident" id="7048874">t</span>&nbsp;<span class="op" id="7048876">*</span><span class="ident" id="7048877">testing</span><span class="op" id="7048884">.</span><span class="ident" id="7048885">T</span><span class="op" id="7048886">,</span>&nbsp;<span class="ident" id="7048888">filename</span>&nbsp;<span class="builtintype" id="7048897">string</span><span class="op" id="7048903">,</span>&nbsp;<span class="ident" id="7048905">src</span>&nbsp;<span class="op" id="7048909">[</span><span class="op" id="7048910">]</span><span class="builtintype" id="7048911">byte</span><span class="op" id="7048915">)</span>&nbsp;<span class="keyword" id="7048917">map</span><span class="op" id="7048920">[</span><span class="ident" id="7048921">token</span><span class="op" id="7048926">.</span><span class="ident" id="7048927">Pos</span><span class="op" id="7048930">]</span><span class="builtintype" id="7048931">string</span>&nbsp;<span class="op" id="7048938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048941">errors</span>&nbsp;<span class="op" id="7048948">:=</span>&nbsp;<span class="builtinfunc" id="7048951">make</span><span class="op" id="7048955">(</span><span class="keyword" id="7048956">map</span><span class="op" id="7048959">[</span><span class="ident" id="7048960">token</span><span class="op" id="7048965">.</span><span class="ident" id="7048966">Pos</span><span class="op" id="7048969">]</span><span class="builtintype" id="7048970">string</span><span class="op" id="7048976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048980">var</span>&nbsp;<span class="ident" id="7048984">s</span>&nbsp;<span class="ident" id="7048986">scanner</span><span class="op" id="7048993">.</span><span class="ident" id="7048994">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7049003">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7049065">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7049127">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049190">s</span><span class="op" id="7049191">.</span><span class="ident" id="7049192">Init</span><span class="op" id="7049196">(</span><span class="ident" id="7049197">getFile</span><span class="op" id="7049204">(</span><span class="ident" id="7049205">filename</span><span class="op" id="7049213">)</span><span class="op" id="7049214">,</span>&nbsp;<span class="ident" id="7049216">src</span><span class="op" id="7049219">,</span>&nbsp;<span class="ident" id="7049221">nil</span><span class="op" id="7049224">,</span>&nbsp;<span class="ident" id="7049226">scanner</span><span class="op" id="7049233">.</span><span class="ident" id="7049234">ScanComments</span><span class="op" id="7049246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049249">var</span>&nbsp;<span class="ident" id="7049253">prev</span>&nbsp;<span class="ident" id="7049258">token</span><span class="op" id="7049263">.</span><span class="ident" id="7049264">Pos</span>&nbsp;<span class="comment" id="7049268">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049322">var</span>&nbsp;<span class="ident" id="7049326">here</span>&nbsp;<span class="ident" id="7049331">token</span><span class="op" id="7049336">.</span><span class="ident" id="7049337">Pos</span>&nbsp;<span class="comment" id="7049341">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049400">for</span>&nbsp;<span class="op" id="7049404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049408">pos</span><span class="op" id="7049411">,</span>&nbsp;<span class="ident" id="7049413">tok</span><span class="op" id="7049416">,</span>&nbsp;<span class="ident" id="7049418">lit</span>&nbsp;<span class="op" id="7049422">:=</span>&nbsp;<span class="ident" id="7049425">s</span><span class="op" id="7049426">.</span><span class="ident" id="7049427">Scan</span><span class="op" id="7049431">(</span><span class="op" id="7049432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049436">switch</span>&nbsp;<span class="ident" id="7049443">tok</span>&nbsp;<span class="op" id="7049447">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049451">case</span>&nbsp;<span class="ident" id="7049456">token</span><span class="op" id="7049461">.</span><span class="ident" id="7049462">EOF</span><span class="op" id="7049465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049470">return</span>&nbsp;<span class="ident" id="7049477">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049486">case</span>&nbsp;<span class="ident" id="7049491">token</span><span class="op" id="7049496">.</span><span class="ident" id="7049497">COMMENT</span><span class="op" id="7049504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049509">s</span>&nbsp;<span class="op" id="7049511">:=</span>&nbsp;<span class="ident" id="7049514">errRx</span><span class="op" id="7049519">.</span><span class="ident" id="7049520">FindStringSubmatch</span><span class="op" id="7049538">(</span><span class="ident" id="7049539">lit</span><span class="op" id="7049542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049547">if</span>&nbsp;<span class="builtinfunc" id="7049550">len</span><span class="op" id="7049553">(</span><span class="ident" id="7049554">s</span><span class="op" id="7049555">)</span>&nbsp;<span class="op" id="7049557">==</span>&nbsp;<span class="num" id="7049560">3</span>&nbsp;<span class="op" id="7049562">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049568">pos</span>&nbsp;<span class="op" id="7049572">:=</span>&nbsp;<span class="ident" id="7049575">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049584">if</span>&nbsp;<span class="ident" id="7049587">s</span><span class="op" id="7049588">[</span><span class="num" id="7049589">1</span><span class="op" id="7049590">]</span>&nbsp;<span class="op" id="7049592">==</span>&nbsp;<span class="string" id="7049595">&#34;HERE&#34;</span>&nbsp;<span class="op" id="7049602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049609">pos</span>&nbsp;<span class="op" id="7049613">=</span>&nbsp;<span class="ident" id="7049615">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049630">errors</span><span class="op" id="7049636">[</span><span class="ident" id="7049637">pos</span><span class="op" id="7049640">]</span>&nbsp;<span class="op" id="7049642">=</span>&nbsp;<span class="builtintype" id="7049644">string</span><span class="op" id="7049650">(</span><span class="ident" id="7049651">s</span><span class="op" id="7049652">[</span><span class="num" id="7049653">2</span><span class="op" id="7049654">]</span><span class="op" id="7049655">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049664">default</span><span class="op" id="7049671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049676">prev</span>&nbsp;<span class="op" id="7049681">=</span>&nbsp;<span class="ident" id="7049683">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049690">var</span>&nbsp;<span class="ident" id="7049694">l</span>&nbsp;<span class="builtintype" id="7049696">int</span>&nbsp;<span class="comment" id="7049700">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049719">if</span>&nbsp;<span class="ident" id="7049722">tok</span><span class="op" id="7049725">.</span><span class="ident" id="7049726">IsLiteral</span><span class="op" id="7049735">(</span><span class="op" id="7049736">)</span>&nbsp;<span class="op" id="7049738">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049744">l</span>&nbsp;<span class="op" id="7049746">=</span>&nbsp;<span class="builtinfunc" id="7049748">len</span><span class="op" id="7049751">(</span><span class="ident" id="7049752">lit</span><span class="op" id="7049755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049760">}</span>&nbsp;<span class="keyword" id="7049762">else</span>&nbsp;<span class="op" id="7049767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049773">l</span>&nbsp;<span class="op" id="7049775">=</span>&nbsp;<span class="builtinfunc" id="7049777">len</span><span class="op" id="7049780">(</span><span class="ident" id="7049781">tok</span><span class="op" id="7049784">.</span><span class="ident" id="7049785">String</span><span class="op" id="7049791">(</span><span class="op" id="7049792">)</span><span class="op" id="7049793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049803">here</span>&nbsp;<span class="op" id="7049808">=</span>&nbsp;<span class="ident" id="7049810">prev</span>&nbsp;<span class="op" id="7049815">+</span>&nbsp;<span class="ident" id="7049817">token</span><span class="op" id="7049822">.</span><span class="ident" id="7049823">Pos</span><span class="op" id="7049826">(</span><span class="ident" id="7049827">l</span><span class="op" id="7049828">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049835">}</span><br>
<span class="lineno"></span><span class="op" id="7049837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7049840">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="7049915">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="7049961">//</span><br>
<span class="lineno"></span><span class="keyword" id="7049964">func</span>&nbsp;<span class="ident" id="7049969">compareErrors</span><span class="op" id="7049982">(</span><span class="ident" id="7049983">t</span>&nbsp;<span class="op" id="7049985">*</span><span class="ident" id="7049986">testing</span><span class="op" id="7049993">.</span><span class="ident" id="7049994">T</span><span class="op" id="7049995">,</span>&nbsp;<span class="ident" id="7049997">expected</span>&nbsp;<span class="keyword" id="7050006">map</span><span class="op" id="7050009">[</span><span class="ident" id="7050010">token</span><span class="op" id="7050015">.</span><span class="ident" id="7050016">Pos</span><span class="op" id="7050019">]</span><span class="builtintype" id="7050020">string</span><span class="op" id="7050026">,</span>&nbsp;<span class="ident" id="7050028">found</span>&nbsp;<span class="ident" id="7050034">scanner</span><span class="op" id="7050041">.</span><span class="ident" id="7050042">ErrorList</span><span class="op" id="7050051">)</span>&nbsp;<span class="op" id="7050053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050056">for</span>&nbsp;<span class="ident" id="7050060">_</span><span class="op" id="7050061">,</span>&nbsp;<span class="builtintype" id="7050063">error</span>&nbsp;<span class="op" id="7050069">:=</span>&nbsp;<span class="keyword" id="7050072">range</span>&nbsp;<span class="ident" id="7050078">found</span>&nbsp;<span class="op" id="7050084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050088">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050136">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050179">pos</span>&nbsp;<span class="op" id="7050183">:=</span>&nbsp;<span class="ident" id="7050186">getPos</span><span class="op" id="7050192">(</span><span class="builtintype" id="7050193">error</span><span class="op" id="7050198">.</span><span class="ident" id="7050199">Pos</span><span class="op" id="7050202">.</span><span class="ident" id="7050203">Filename</span><span class="op" id="7050211">,</span>&nbsp;<span class="builtintype" id="7050213">error</span><span class="op" id="7050218">.</span><span class="ident" id="7050219">Pos</span><span class="op" id="7050222">.</span><span class="ident" id="7050223">Offset</span><span class="op" id="7050229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050233">if</span>&nbsp;<span class="ident" id="7050236">msg</span><span class="op" id="7050239">,</span>&nbsp;<span class="ident" id="7050241">found</span>&nbsp;<span class="op" id="7050247">:=</span>&nbsp;<span class="ident" id="7050250">expected</span><span class="op" id="7050258">[</span><span class="ident" id="7050259">pos</span><span class="op" id="7050262">]</span><span class="op" id="7050263">;</span>&nbsp;<span class="ident" id="7050265">found</span>&nbsp;<span class="op" id="7050271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050276">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050330">rx</span><span class="op" id="7050332">,</span>&nbsp;<span class="ident" id="7050334">err</span>&nbsp;<span class="op" id="7050338">:=</span>&nbsp;<span class="ident" id="7050341">regexp</span><span class="op" id="7050347">.</span><span class="ident" id="7050348">Compile</span><span class="op" id="7050355">(</span><span class="ident" id="7050356">msg</span><span class="op" id="7050359">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050364">if</span>&nbsp;<span class="ident" id="7050367">err</span>&nbsp;<span class="op" id="7050371">!=</span>&nbsp;<span class="ident" id="7050374">nil</span>&nbsp;<span class="op" id="7050378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050384">t</span><span class="op" id="7050385">.</span><span class="ident" id="7050386">Errorf</span><span class="op" id="7050392">(</span><span class="string" id="7050393">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7050401">,</span>&nbsp;<span class="builtintype" id="7050403">error</span><span class="op" id="7050408">.</span><span class="ident" id="7050409">Pos</span><span class="op" id="7050412">,</span>&nbsp;<span class="ident" id="7050414">err</span><span class="op" id="7050417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050423">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050440">if</span>&nbsp;<span class="ident" id="7050443">match</span>&nbsp;<span class="op" id="7050449">:=</span>&nbsp;<span class="ident" id="7050452">rx</span><span class="op" id="7050454">.</span><span class="ident" id="7050455">MatchString</span><span class="op" id="7050466">(</span><span class="builtintype" id="7050467">error</span><span class="op" id="7050472">.</span><span class="ident" id="7050473">Msg</span><span class="op" id="7050476">)</span><span class="op" id="7050477">;</span>&nbsp;<span class="op" id="7050479">!</span><span class="ident" id="7050480">match</span>&nbsp;<span class="op" id="7050486">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050492">t</span><span class="op" id="7050493">.</span><span class="ident" id="7050494">Errorf</span><span class="op" id="7050500">(</span><span class="string" id="7050501">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="7050527">,</span>&nbsp;<span class="builtintype" id="7050529">error</span><span class="op" id="7050534">.</span><span class="ident" id="7050535">Pos</span><span class="op" id="7050538">,</span>&nbsp;<span class="builtintype" id="7050540">error</span><span class="op" id="7050545">.</span><span class="ident" id="7050546">Msg</span><span class="op" id="7050549">,</span>&nbsp;<span class="ident" id="7050551">msg</span><span class="op" id="7050554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050560">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050577">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7050622">delete</span><span class="op" id="7050628">(</span><span class="ident" id="7050629">expected</span><span class="op" id="7050637">,</span>&nbsp;<span class="ident" id="7050639">pos</span><span class="op" id="7050642">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050646">}</span>&nbsp;<span class="keyword" id="7050648">else</span>&nbsp;<span class="op" id="7050653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050658">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050715">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050781">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050846">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050914">t</span><span class="op" id="7050915">.</span><span class="ident" id="7050916">Errorf</span><span class="op" id="7050922">(</span><span class="string" id="7050923">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7050949">,</span>&nbsp;<span class="builtintype" id="7050951">error</span><span class="op" id="7050956">.</span><span class="ident" id="7050957">Pos</span><span class="op" id="7050960">,</span>&nbsp;<span class="builtintype" id="7050962">error</span><span class="op" id="7050967">.</span><span class="ident" id="7050968">Msg</span><span class="op" id="7050971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050982">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051026">if</span>&nbsp;<span class="builtinfunc" id="7051029">len</span><span class="op" id="7051032">(</span><span class="ident" id="7051033">expected</span><span class="op" id="7051041">)</span>&nbsp;<span class="op" id="7051043">&gt;</span>&nbsp;<span class="num" id="7051045">0</span>&nbsp;<span class="op" id="7051047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051051">t</span><span class="op" id="7051052">.</span><span class="ident" id="7051053">Errorf</span><span class="op" id="7051059">(</span><span class="string" id="7051060">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="7051085">,</span>&nbsp;<span class="builtinfunc" id="7051087">len</span><span class="op" id="7051090">(</span><span class="ident" id="7051091">expected</span><span class="op" id="7051099">)</span><span class="op" id="7051100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051104">for</span>&nbsp;<span class="ident" id="7051108">pos</span><span class="op" id="7051111">,</span>&nbsp;<span class="ident" id="7051113">msg</span>&nbsp;<span class="op" id="7051117">:=</span>&nbsp;<span class="keyword" id="7051120">range</span>&nbsp;<span class="ident" id="7051126">expected</span>&nbsp;<span class="op" id="7051135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051140">t</span><span class="op" id="7051141">.</span><span class="ident" id="7051142">Errorf</span><span class="op" id="7051148">(</span><span class="string" id="7051149">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="7051159">,</span>&nbsp;<span class="ident" id="7051161">fsetErrs</span><span class="op" id="7051169">.</span><span class="ident" id="7051170">Position</span><span class="op" id="7051178">(</span><span class="ident" id="7051179">pos</span><span class="op" id="7051182">)</span><span class="op" id="7051183">,</span>&nbsp;<span class="ident" id="7051185">msg</span><span class="op" id="7051188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051192">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051195">}</span><br>
<span class="lineno"></span><span class="op" id="7051197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7051200">func</span>&nbsp;<span class="ident" id="7051205">checkErrors</span><span class="op" id="7051216">(</span><span class="ident" id="7051217">t</span>&nbsp;<span class="op" id="7051219">*</span><span class="ident" id="7051220">testing</span><span class="op" id="7051227">.</span><span class="ident" id="7051228">T</span><span class="op" id="7051229">,</span>&nbsp;<span class="ident" id="7051231">filename</span>&nbsp;<span class="builtintype" id="7051240">string</span><span class="op" id="7051246">,</span>&nbsp;<span class="ident" id="7051248">input</span>&nbsp;<span class="keyword" id="7051254">interface</span><span class="op" id="7051263">{</span><span class="op" id="7051264">}</span><span class="op" id="7051265">)</span>&nbsp;<span class="op" id="7051267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051270">src</span><span class="op" id="7051273">,</span>&nbsp;<span class="ident" id="7051275">err</span>&nbsp;<span class="op" id="7051279">:=</span>&nbsp;<span class="ident" id="7051282">readSource</span><span class="op" id="7051292">(</span><span class="ident" id="7051293">filename</span><span class="op" id="7051301">,</span>&nbsp;<span class="ident" id="7051303">input</span><span class="op" id="7051308">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051311">if</span>&nbsp;<span class="ident" id="7051314">err</span>&nbsp;<span class="op" id="7051318">!=</span>&nbsp;<span class="ident" id="7051321">nil</span>&nbsp;<span class="op" id="7051325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051329">t</span><span class="op" id="7051330">.</span><span class="ident" id="7051331">Error</span><span class="op" id="7051336">(</span><span class="ident" id="7051337">err</span><span class="op" id="7051340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051356">_</span><span class="op" id="7051357">,</span>&nbsp;<span class="ident" id="7051359">err</span>&nbsp;<span class="op" id="7051363">=</span>&nbsp;<span class="ident" id="7051365">ParseFile</span><span class="op" id="7051374">(</span><span class="ident" id="7051375">fsetErrs</span><span class="op" id="7051383">,</span>&nbsp;<span class="ident" id="7051385">filename</span><span class="op" id="7051393">,</span>&nbsp;<span class="ident" id="7051395">src</span><span class="op" id="7051398">,</span>&nbsp;<span class="ident" id="7051400">DeclarationErrors</span><span class="op" id="7051417">|</span><span class="ident" id="7051418">AllErrors</span><span class="op" id="7051427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051430">found</span><span class="op" id="7051435">,</span>&nbsp;<span class="ident" id="7051437">ok</span>&nbsp;<span class="op" id="7051440">:=</span>&nbsp;<span class="ident" id="7051443">err</span><span class="op" id="7051446">.</span><span class="op" id="7051447">(</span><span class="ident" id="7051448">scanner</span><span class="op" id="7051455">.</span><span class="ident" id="7051456">ErrorList</span><span class="op" id="7051465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051468">if</span>&nbsp;<span class="ident" id="7051471">err</span>&nbsp;<span class="op" id="7051475">!=</span>&nbsp;<span class="ident" id="7051478">nil</span>&nbsp;<span class="op" id="7051482">&amp;&amp;</span>&nbsp;<span class="op" id="7051485">!</span><span class="ident" id="7051486">ok</span>&nbsp;<span class="op" id="7051489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051493">t</span><span class="op" id="7051494">.</span><span class="ident" id="7051495">Error</span><span class="op" id="7051500">(</span><span class="ident" id="7051501">err</span><span class="op" id="7051504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051508">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051519">found</span><span class="op" id="7051524">.</span><span class="ident" id="7051525">RemoveMultiples</span><span class="op" id="7051540">(</span><span class="op" id="7051541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7051545">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7051587">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051664">expected</span>&nbsp;<span class="op" id="7051673">:=</span>&nbsp;<span class="ident" id="7051676">expectedErrors</span><span class="op" id="7051690">(</span><span class="ident" id="7051691">t</span><span class="op" id="7051692">,</span>&nbsp;<span class="ident" id="7051694">filename</span><span class="op" id="7051702">,</span>&nbsp;<span class="ident" id="7051704">src</span><span class="op" id="7051707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7051711">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051752">compareErrors</span><span class="op" id="7051765">(</span><span class="ident" id="7051766">t</span><span class="op" id="7051767">,</span>&nbsp;<span class="ident" id="7051769">expected</span><span class="op" id="7051777">,</span>&nbsp;<span class="ident" id="7051779">found</span><span class="op" id="7051784">)</span><br>
<span class="lineno"></span><span class="op" id="7051786">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7051789">func</span>&nbsp;<span class="ident" id="7051794">TestErrors</span><span class="op" id="7051804">(</span><span class="ident" id="7051805">t</span>&nbsp;<span class="op" id="7051807">*</span><span class="ident" id="7051808">testing</span><span class="op" id="7051815">.</span><span class="ident" id="7051816">T</span><span class="op" id="7051817">)</span>&nbsp;<span class="op" id="7051819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051822">list</span><span class="op" id="7051826">,</span>&nbsp;<span class="ident" id="7051828">err</span>&nbsp;<span class="op" id="7051832">:=</span>&nbsp;<span class="ident" id="7051835">ioutil</span><span class="op" id="7051841">.</span><span class="ident" id="7051842">ReadDir</span><span class="op" id="7051849">(</span><span class="ident" id="7051850">testdata</span><span class="op" id="7051858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051861">if</span>&nbsp;<span class="ident" id="7051864">err</span>&nbsp;<span class="op" id="7051868">!=</span>&nbsp;<span class="ident" id="7051871">nil</span>&nbsp;<span class="op" id="7051875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051879">t</span><span class="op" id="7051880">.</span><span class="ident" id="7051881">Fatal</span><span class="op" id="7051886">(</span><span class="ident" id="7051887">err</span><span class="op" id="7051890">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051896">for</span>&nbsp;<span class="ident" id="7051900">_</span><span class="op" id="7051901">,</span>&nbsp;<span class="ident" id="7051903">fi</span>&nbsp;<span class="op" id="7051906">:=</span>&nbsp;<span class="keyword" id="7051909">range</span>&nbsp;<span class="ident" id="7051915">list</span>&nbsp;<span class="op" id="7051920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051924">name</span>&nbsp;<span class="op" id="7051929">:=</span>&nbsp;<span class="ident" id="7051932">fi</span><span class="op" id="7051934">.</span><span class="ident" id="7051935">Name</span><span class="op" id="7051939">(</span><span class="op" id="7051940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051944">if</span>&nbsp;<span class="op" id="7051947">!</span><span class="ident" id="7051948">fi</span><span class="op" id="7051950">.</span><span class="ident" id="7051951">IsDir</span><span class="op" id="7051956">(</span><span class="op" id="7051957">)</span>&nbsp;<span class="op" id="7051959">&amp;&amp;</span>&nbsp;<span class="op" id="7051962">!</span><span class="ident" id="7051963">strings</span><span class="op" id="7051970">.</span><span class="ident" id="7051971">HasPrefix</span><span class="op" id="7051980">(</span><span class="ident" id="7051981">name</span><span class="op" id="7051985">,</span>&nbsp;<span class="string" id="7051987">&#34;.&#34;</span><span class="op" id="7051990">)</span>&nbsp;<span class="op" id="7051992">&amp;&amp;</span>&nbsp;<span class="ident" id="7051995">strings</span><span class="op" id="7052002">.</span><span class="ident" id="7052003">HasSuffix</span><span class="op" id="7052012">(</span><span class="ident" id="7052013">name</span><span class="op" id="7052017">,</span>&nbsp;<span class="string" id="7052019">&#34;.src&#34;</span><span class="op" id="7052025">)</span>&nbsp;<span class="op" id="7052027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052032">checkErrors</span><span class="op" id="7052043">(</span><span class="ident" id="7052044">t</span><span class="op" id="7052045">,</span>&nbsp;<span class="ident" id="7052047">filepath</span><span class="op" id="7052055">.</span><span class="ident" id="7052056">Join</span><span class="op" id="7052060">(</span><span class="ident" id="7052061">testdata</span><span class="op" id="7052069">,</span>&nbsp;<span class="ident" id="7052071">name</span><span class="op" id="7052075">)</span><span class="op" id="7052076">,</span>&nbsp;<span class="ident" id="7052078">nil</span><span class="op" id="7052081">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052088">}</span><br>
<span class="lineno"></span><span class="op" id="7052090">}</span>
</div>
</body>
</html>
