<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync</h2>
<ul>
<li><a href="/gostd/sync/cond.go.html">cond.go</a></li>
<li><a href="/gostd/sync/cond_test.go.html">cond_test.go</a></li>
<li><a href="/gostd/sync/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/sync/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/sync/mutex.go.html">mutex.go</a></li>
<li><a href="/gostd/sync/mutex_test.go.html">mutex_test.go</a></li>
<li><a href="/gostd/sync/once.go.html">once.go</a></li>
<li><a href="/gostd/sync/once_test.go.html">once_test.go</a></li>
<li><a href="/gostd/sync/pool.go.html" class="current">pool.go</a></li>
<li><a href="/gostd/sync/pool_test.go.html">pool_test.go</a></li>
<li><a href="/gostd/sync/race0.go.html">race0.go</a></li>
<li><a href="/gostd/sync/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/sync/runtime_sema_test.go.html">runtime_sema_test.go</a></li>
<li><a href="/gostd/sync/rwmutex.go.html">rwmutex.go</a></li>
<li><a href="/gostd/sync/rwmutex_test.go.html">rwmutex_test.go</a></li>
<li><a href="/gostd/sync/waitgroup.go.html">waitgroup.go</a></li>
<li><a href="/gostd/sync/waitgroup_test.go.html">waitgroup_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1447291">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1447346">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1447400">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1447451">package</span>&nbsp;<span class="ident" id="1447459">sync</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1447465">import</span>&nbsp;<span class="op" id="1447472">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1447475">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1447486">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1447501">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1447510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1447513">//&nbsp;A&nbsp;Pool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;temporary&nbsp;objects&nbsp;that&nbsp;may&nbsp;be&nbsp;individually&nbsp;saved&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1447588">//&nbsp;retrieved.</span><br>
<span class="lineno">15</span><span class="comment" id="1447602">//</span><br>
<span class="lineno"></span><span class="comment" id="1447605">//&nbsp;Any&nbsp;item&nbsp;stored&nbsp;in&nbsp;the&nbsp;Pool&nbsp;may&nbsp;be&nbsp;removed&nbsp;automatically&nbsp;at&nbsp;any&nbsp;time&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="1447685">//&nbsp;notification.&nbsp;If&nbsp;the&nbsp;Pool&nbsp;holds&nbsp;the&nbsp;only&nbsp;reference&nbsp;when&nbsp;this&nbsp;happens,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1447762">//&nbsp;item&nbsp;might&nbsp;be&nbsp;deallocated.</span><br>
<span class="lineno"></span><span class="comment" id="1447792">//</span><br>
<span class="lineno">20</span><span class="comment" id="1447795">//&nbsp;A&nbsp;Pool&nbsp;is&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="1447860">//</span><br>
<span class="lineno"></span><span class="comment" id="1447863">//&nbsp;Pool&#39;s&nbsp;purpose&nbsp;is&nbsp;to&nbsp;cache&nbsp;allocated&nbsp;but&nbsp;unused&nbsp;items&nbsp;for&nbsp;later&nbsp;reuse,</span><br>
<span class="lineno"></span><span class="comment" id="1447937">//&nbsp;relieving&nbsp;pressure&nbsp;on&nbsp;the&nbsp;garbage&nbsp;collector.&nbsp;That&nbsp;is,&nbsp;it&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1448014">//&nbsp;build&nbsp;efficient,&nbsp;thread-safe&nbsp;free&nbsp;lists.&nbsp;However,&nbsp;it&nbsp;is&nbsp;not&nbsp;suitable&nbsp;for&nbsp;all</span><br>
<span class="lineno">25</span><span class="comment" id="1448094">//&nbsp;free&nbsp;lists.</span><br>
<span class="lineno"></span><span class="comment" id="1448109">//</span><br>
<span class="lineno"></span><span class="comment" id="1448112">//&nbsp;An&nbsp;appropriate&nbsp;use&nbsp;of&nbsp;a&nbsp;Pool&nbsp;is&nbsp;to&nbsp;manage&nbsp;a&nbsp;group&nbsp;of&nbsp;temporary&nbsp;items</span><br>
<span class="lineno"></span><span class="comment" id="1448184">//&nbsp;silently&nbsp;shared&nbsp;among&nbsp;and&nbsp;potentially&nbsp;reused&nbsp;by&nbsp;concurrent&nbsp;independent</span><br>
<span class="lineno"></span><span class="comment" id="1448258">//&nbsp;clients&nbsp;of&nbsp;a&nbsp;package.&nbsp;Pool&nbsp;provides&nbsp;a&nbsp;way&nbsp;to&nbsp;amortize&nbsp;allocation&nbsp;overhead</span><br>
<span class="lineno">30</span><span class="comment" id="1448335">//&nbsp;across&nbsp;many&nbsp;clients.</span><br>
<span class="lineno"></span><span class="comment" id="1448359">//</span><br>
<span class="lineno"></span><span class="comment" id="1448362">//&nbsp;An&nbsp;example&nbsp;of&nbsp;good&nbsp;use&nbsp;of&nbsp;a&nbsp;Pool&nbsp;is&nbsp;in&nbsp;the&nbsp;fmt&nbsp;package,&nbsp;which&nbsp;maintains&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1448439">//&nbsp;dynamically-sized&nbsp;store&nbsp;of&nbsp;temporary&nbsp;output&nbsp;buffers.&nbsp;The&nbsp;store&nbsp;scales&nbsp;under</span><br>
<span class="lineno"></span><span class="comment" id="1448518">//&nbsp;load&nbsp;(when&nbsp;many&nbsp;goroutines&nbsp;are&nbsp;actively&nbsp;printing)&nbsp;and&nbsp;shrinks&nbsp;when</span><br>
<span class="lineno">35</span><span class="comment" id="1448588">//&nbsp;quiescent.</span><br>
<span class="lineno"></span><span class="comment" id="1448602">//</span><br>
<span class="lineno"></span><span class="comment" id="1448605">//&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;a&nbsp;free&nbsp;list&nbsp;maintained&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;short-lived&nbsp;object&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1448685">//&nbsp;not&nbsp;a&nbsp;suitable&nbsp;use&nbsp;for&nbsp;a&nbsp;Pool,&nbsp;since&nbsp;the&nbsp;overhead&nbsp;does&nbsp;not&nbsp;amortize&nbsp;well&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1448764">//&nbsp;that&nbsp;scenario.&nbsp;It&nbsp;is&nbsp;more&nbsp;efficient&nbsp;to&nbsp;have&nbsp;such&nbsp;objects&nbsp;implement&nbsp;their&nbsp;own</span><br>
<span class="lineno">40</span><span class="comment" id="1448844">//&nbsp;free&nbsp;list.</span><br>
<span class="lineno"></span><span class="comment" id="1448858">//</span><br>
<span class="lineno"></span><span class="keyword" id="1448861">type</span>&nbsp;<span class="ident" id="1448866">Pool</span>&nbsp;<span class="keyword" id="1448871">struct</span>&nbsp;<span class="op" id="1448878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448881">local</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448891"><a href="/gostd/sync/pool.go.html#1447501">unsafe</a></span><span class="op" id="1448897">.</span><span class="ident" id="1448898">Pointer</span>&nbsp;<span class="comment" id="1448906">//&nbsp;local&nbsp;fixed-size&nbsp;per-P&nbsp;pool,&nbsp;actual&nbsp;type&nbsp;is&nbsp;[P]poolLocal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448967">localSize</span>&nbsp;<span class="builtintype" id="1448977">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448992">//&nbsp;size&nbsp;of&nbsp;the&nbsp;local&nbsp;array</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449021">//&nbsp;New&nbsp;optionally&nbsp;specifies&nbsp;a&nbsp;function&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449073">//&nbsp;a&nbsp;value&nbsp;when&nbsp;Get&nbsp;would&nbsp;otherwise&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449122">//&nbsp;It&nbsp;may&nbsp;not&nbsp;be&nbsp;changed&nbsp;concurrently&nbsp;with&nbsp;calls&nbsp;to&nbsp;Get.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449180">New</span>&nbsp;<span class="keyword" id="1449184">func</span><span class="op" id="1449188">(</span><span class="op" id="1449189">)</span>&nbsp;<span class="keyword" id="1449191">interface</span><span class="op" id="1449200">{</span><span class="op" id="1449201">}</span><br>
<span class="lineno">50</span><span class="op" id="1449203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1449206">//&nbsp;Local&nbsp;per-P&nbsp;Pool&nbsp;appendix.</span><br>
<span class="lineno"></span><span class="keyword" id="1449236">type</span>&nbsp;<span class="ident" id="1449241">poolLocal</span>&nbsp;<span class="keyword" id="1449251">struct</span>&nbsp;<span class="op" id="1449258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449261">private</span>&nbsp;<span class="keyword" id="1449269">interface</span><span class="op" id="1449278">{</span><span class="op" id="1449279">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1449283">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;only&nbsp;by&nbsp;the&nbsp;respective&nbsp;P.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449325">shared</span>&nbsp;&nbsp;<span class="op" id="1449333">[</span><span class="op" id="1449334">]</span><span class="keyword" id="1449335">interface</span><span class="op" id="1449344">{</span><span class="op" id="1449345">}</span>&nbsp;<span class="comment" id="1449347">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;by&nbsp;any&nbsp;P.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449373"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449395">//&nbsp;Protects&nbsp;shared.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449416">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449424">[</span><span class="num" id="1449425">128</span><span class="op" id="1449428">]</span><span class="builtintype" id="1449429">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449438">//&nbsp;Prevents&nbsp;false&nbsp;sharing.</span><br>
<span class="lineno"></span><span class="op" id="1449465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1449468">//&nbsp;Put&nbsp;adds&nbsp;x&nbsp;to&nbsp;the&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="1449495">func</span>&nbsp;<span class="op" id="1449500">(</span><span class="ident" id="1449501">p</span>&nbsp;<span class="op" id="1449503">*</span><span class="ident" id="1449504"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><span class="op" id="1449508">)</span>&nbsp;<span class="ident" id="1449510">Put</span><span class="op" id="1449513">(</span><span class="ident" id="1449514">x</span>&nbsp;<span class="keyword" id="1449516">interface</span><span class="op" id="1449525">{</span><span class="op" id="1449526">}</span><span class="op" id="1449527">)</span>&nbsp;<span class="op" id="1449529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449532">if</span>&nbsp;<span class="ident" id="1449535"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1449547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449551">//&nbsp;Under&nbsp;race&nbsp;detector&nbsp;the&nbsp;Pool&nbsp;degenerates&nbsp;into&nbsp;no-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449609">//&nbsp;It&#39;s&nbsp;conforming,&nbsp;simple&nbsp;and&nbsp;does&nbsp;not&nbsp;introduce&nbsp;excessive</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449671">//&nbsp;happens-before&nbsp;edges&nbsp;between&nbsp;unrelated&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449738">if</span>&nbsp;<span class="ident" id="1449741"><a href="/gostd/sync/pool.go.html#1449514">x</a></span>&nbsp;<span class="op" id="1449743">==</span>&nbsp;<span class="builtintype" id="1449746">nil</span>&nbsp;<span class="op" id="1449750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449754">return</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449765">l</span>&nbsp;<span class="op" id="1449767">:=</span>&nbsp;<span class="ident" id="1449770"><a href="/gostd/sync/pool.go.html#1449501">p</a></span><span class="op" id="1449771">.</span><span class="ident" id="1449772"><a href="/gostd/sync/pool.go.html#1451476">pin</a></span><span class="op" id="1449775">(</span><span class="op" id="1449776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449779">if</span>&nbsp;<span class="ident" id="1449782"><a href="/gostd/sync/pool.go.html#1449765">l</a></span><span class="op" id="1449783">.</span><span class="ident" id="1449784"><a href="/gostd/sync/pool.go.html#1449261">private</a></span>&nbsp;<span class="op" id="1449792">==</span>&nbsp;<span class="builtintype" id="1449795">nil</span>&nbsp;<span class="op" id="1449799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449803"><a href="/gostd/sync/pool.go.html#1449765">l</a></span><span class="op" id="1449804">.</span><span class="ident" id="1449805"><a href="/gostd/sync/pool.go.html#1449261">private</a></span>&nbsp;<span class="op" id="1449813">=</span>&nbsp;<span class="ident" id="1449815"><a href="/gostd/sync/pool.go.html#1449514">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449819"><a href="/gostd/sync/pool.go.html#1449514">x</a></span>&nbsp;<span class="op" id="1449821">=</span>&nbsp;<span class="builtintype" id="1449823">nil</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449831"><a href="/gostd/sync/pool.go.html#1453818">runtime_procUnpin</a></span><span class="op" id="1449848">(</span><span class="op" id="1449849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449852">if</span>&nbsp;<span class="ident" id="1449855"><a href="/gostd/sync/pool.go.html#1449514">x</a></span>&nbsp;<span class="op" id="1449857">==</span>&nbsp;<span class="builtintype" id="1449860">nil</span>&nbsp;<span class="op" id="1449864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449868">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449876">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449879"><a href="/gostd/sync/pool.go.html#1449765">l</a></span><span class="op" id="1449880">.</span><span class="ident" id="1449881"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1449885">(</span><span class="op" id="1449886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449889"><a href="/gostd/sync/pool.go.html#1449765">l</a></span><span class="op" id="1449890">.</span><span class="ident" id="1449891"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span>&nbsp;<span class="op" id="1449898">=</span>&nbsp;<span class="builtinfunc" id="1449900">append</span><span class="op" id="1449906">(</span><span class="ident" id="1449907"><a href="/gostd/sync/pool.go.html#1449765">l</a></span><span class="op" id="1449908">.</span><span class="ident" id="1449909"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1449915">,</span>&nbsp;<span class="ident" id="1449917"><a href="/gostd/sync/pool.go.html#1449514">x</a></span><span class="op" id="1449918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449921"><a href="/gostd/sync/pool.go.html#1449765">l</a></span><span class="op" id="1449922">.</span><span class="ident" id="1449923"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1449929">(</span><span class="op" id="1449930">)</span><br>
<span class="lineno"></span><span class="op" id="1449932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1449935">//&nbsp;Get&nbsp;selects&nbsp;an&nbsp;arbitrary&nbsp;item&nbsp;from&nbsp;the&nbsp;Pool,&nbsp;removes&nbsp;it&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1450003">//&nbsp;Pool,&nbsp;and&nbsp;returns&nbsp;it&nbsp;to&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1450042">//&nbsp;Get&nbsp;may&nbsp;choose&nbsp;to&nbsp;ignore&nbsp;the&nbsp;pool&nbsp;and&nbsp;treat&nbsp;it&nbsp;as&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="1450102">//&nbsp;Callers&nbsp;should&nbsp;not&nbsp;assume&nbsp;any&nbsp;relation&nbsp;between&nbsp;values&nbsp;passed&nbsp;to&nbsp;Put&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1450177">//&nbsp;the&nbsp;values&nbsp;returned&nbsp;by&nbsp;Get.</span><br>
<span class="lineno">90</span><span class="comment" id="1450208">//</span><br>
<span class="lineno"></span><span class="comment" id="1450211">//&nbsp;If&nbsp;Get&nbsp;would&nbsp;otherwise&nbsp;return&nbsp;nil&nbsp;and&nbsp;p.New&nbsp;is&nbsp;non-nil,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="1450282">//&nbsp;the&nbsp;result&nbsp;of&nbsp;calling&nbsp;p.New.</span><br>
<span class="lineno"></span><span class="keyword" id="1450314">func</span>&nbsp;<span class="op" id="1450319">(</span><span class="ident" id="1450320">p</span>&nbsp;<span class="op" id="1450322">*</span><span class="ident" id="1450323"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><span class="op" id="1450327">)</span>&nbsp;<span class="ident" id="1450329">Get</span><span class="op" id="1450332">(</span><span class="op" id="1450333">)</span>&nbsp;<span class="keyword" id="1450335">interface</span><span class="op" id="1450344">{</span><span class="op" id="1450345">}</span>&nbsp;<span class="op" id="1450347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450350">if</span>&nbsp;<span class="ident" id="1450353"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1450365">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450369">if</span>&nbsp;<span class="ident" id="1450372"><a href="/gostd/sync/pool.go.html#1450320">p</a></span><span class="op" id="1450373">.</span><span class="ident" id="1450374"><a href="/gostd/sync/pool.go.html#1449180">New</a></span>&nbsp;<span class="op" id="1450378">!=</span>&nbsp;<span class="builtintype" id="1450381">nil</span>&nbsp;<span class="op" id="1450385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450390">return</span>&nbsp;<span class="ident" id="1450397"><a href="/gostd/sync/pool.go.html#1450320">p</a></span><span class="op" id="1450398">.</span><span class="ident" id="1450399"><a href="/gostd/sync/pool.go.html#1449180">New</a></span><span class="op" id="1450402">(</span><span class="op" id="1450403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1450407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450411">return</span>&nbsp;<span class="builtintype" id="1450418">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1450423">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450426">l</span>&nbsp;<span class="op" id="1450428">:=</span>&nbsp;<span class="ident" id="1450431"><a href="/gostd/sync/pool.go.html#1450320">p</a></span><span class="op" id="1450432">.</span><span class="ident" id="1450433"><a href="/gostd/sync/pool.go.html#1451476">pin</a></span><span class="op" id="1450436">(</span><span class="op" id="1450437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450440">x</span>&nbsp;<span class="op" id="1450442">:=</span>&nbsp;<span class="ident" id="1450445"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450446">.</span><span class="ident" id="1450447"><a href="/gostd/sync/pool.go.html#1449261">private</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450456"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450457">.</span><span class="ident" id="1450458"><a href="/gostd/sync/pool.go.html#1449261">private</a></span>&nbsp;<span class="op" id="1450466">=</span>&nbsp;<span class="builtintype" id="1450468">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450473"><a href="/gostd/sync/pool.go.html#1453818">runtime_procUnpin</a></span><span class="op" id="1450490">(</span><span class="op" id="1450491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450494">if</span>&nbsp;<span class="ident" id="1450497"><a href="/gostd/sync/pool.go.html#1450440">x</a></span>&nbsp;<span class="op" id="1450499">!=</span>&nbsp;<span class="builtintype" id="1450502">nil</span>&nbsp;<span class="op" id="1450506">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450510">return</span>&nbsp;<span class="ident" id="1450517"><a href="/gostd/sync/pool.go.html#1450440">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1450520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450523"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450524">.</span><span class="ident" id="1450525"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1450529">(</span><span class="op" id="1450530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450533">last</span>&nbsp;<span class="op" id="1450538">:=</span>&nbsp;<span class="builtinfunc" id="1450541">len</span><span class="op" id="1450544">(</span><span class="ident" id="1450545"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450546">.</span><span class="ident" id="1450547"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1450553">)</span>&nbsp;<span class="op" id="1450555">-</span>&nbsp;<span class="num" id="1450557">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450560">if</span>&nbsp;<span class="ident" id="1450563"><a href="/gostd/sync/pool.go.html#1450533">last</a></span>&nbsp;<span class="op" id="1450568">&gt;=</span>&nbsp;<span class="num" id="1450571">0</span>&nbsp;<span class="op" id="1450573">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450577"><a href="/gostd/sync/pool.go.html#1450440">x</a></span>&nbsp;<span class="op" id="1450579">=</span>&nbsp;<span class="ident" id="1450581"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450582">.</span><span class="ident" id="1450583"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1450589">[</span><span class="ident" id="1450590"><a href="/gostd/sync/pool.go.html#1450533">last</a></span><span class="op" id="1450594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450598"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450599">.</span><span class="ident" id="1450600"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span>&nbsp;<span class="op" id="1450607">=</span>&nbsp;<span class="ident" id="1450609"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450610">.</span><span class="ident" id="1450611"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1450617">[</span><span class="op" id="1450618">:</span><span class="ident" id="1450619"><a href="/gostd/sync/pool.go.html#1450533">last</a></span><span class="op" id="1450623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1450626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450629"><a href="/gostd/sync/pool.go.html#1450426">l</a></span><span class="op" id="1450630">.</span><span class="ident" id="1450631"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1450637">(</span><span class="op" id="1450638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450641">if</span>&nbsp;<span class="ident" id="1450644"><a href="/gostd/sync/pool.go.html#1450440">x</a></span>&nbsp;<span class="op" id="1450646">!=</span>&nbsp;<span class="builtintype" id="1450649">nil</span>&nbsp;<span class="op" id="1450653">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450657">return</span>&nbsp;<span class="ident" id="1450664"><a href="/gostd/sync/pool.go.html#1450440">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1450667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1450670">return</span>&nbsp;<span class="ident" id="1450677"><a href="/gostd/sync/pool.go.html#1450320">p</a></span><span class="op" id="1450678">.</span><span class="ident" id="1450679"><a href="/gostd/sync/pool.go.html#1450707">getSlow</a></span><span class="op" id="1450686">(</span><span class="op" id="1450687">)</span><br>
<span class="lineno"></span><span class="op" id="1450689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="1450692">func</span>&nbsp;<span class="op" id="1450697">(</span><span class="ident" id="1450698">p</span>&nbsp;<span class="op" id="1450700">*</span><span class="ident" id="1450701"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><span class="op" id="1450705">)</span>&nbsp;<span class="ident" id="1450707">getSlow</span><span class="op" id="1450714">(</span><span class="op" id="1450715">)</span>&nbsp;<span class="op" id="1450717">(</span><span class="ident" id="1450718">x</span>&nbsp;<span class="keyword" id="1450720">interface</span><span class="op" id="1450729">{</span><span class="op" id="1450730">}</span><span class="op" id="1450731">)</span>&nbsp;<span class="op" id="1450733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1450736">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;pin&nbsp;regarding&nbsp;ordering&nbsp;of&nbsp;the&nbsp;loads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450796">size</span>&nbsp;<span class="op" id="1450801">:=</span>&nbsp;<span class="ident" id="1450804"><a href="/gostd/sync/pool.go.html#1447486">atomic</a></span><span class="op" id="1450810">.</span><span class="ident" id="1450811"><a href="/gostd/sync/atomic/doc.go.html#1468168">LoadUintptr</a></span><span class="op" id="1450822">(</span><span class="op" id="1450823">&amp;</span><span class="ident" id="1450824"><a href="/gostd/sync/pool.go.html#1450698">p</a></span><span class="op" id="1450825">.</span><span class="ident" id="1450826"><a href="/gostd/sync/pool.go.html#1448967">localSize</a></span><span class="op" id="1450835">)</span>&nbsp;<span class="comment" id="1450837">//&nbsp;load-acquire</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450854">local</span>&nbsp;<span class="op" id="1450860">:=</span>&nbsp;<span class="ident" id="1450863"><a href="/gostd/sync/pool.go.html#1450698">p</a></span><span class="op" id="1450864">.</span><span class="ident" id="1450865"><a href="/gostd/sync/pool.go.html#1448881">local</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1450895">//&nbsp;load-consume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1450912">//&nbsp;Try&nbsp;to&nbsp;steal&nbsp;one&nbsp;element&nbsp;from&nbsp;other&nbsp;procs.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450959">pid</span>&nbsp;<span class="op" id="1450963">:=</span>&nbsp;<span class="ident" id="1450966"><a href="/gostd/sync/pool.go.html#1453791">runtime_procPin</a></span><span class="op" id="1450981">(</span><span class="op" id="1450982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1450985"><a href="/gostd/sync/pool.go.html#1453818">runtime_procUnpin</a></span><span class="op" id="1451002">(</span><span class="op" id="1451003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451006">for</span>&nbsp;<span class="ident" id="1451010">i</span>&nbsp;<span class="op" id="1451012">:=</span>&nbsp;<span class="num" id="1451015">0</span><span class="op" id="1451016">;</span>&nbsp;<span class="ident" id="1451018"><a href="/gostd/sync/pool.go.html#1451010">i</a></span>&nbsp;<span class="op" id="1451020">&lt;</span>&nbsp;<span class="builtintype" id="1451022">int</span><span class="op" id="1451025">(</span><span class="ident" id="1451026"><a href="/gostd/sync/pool.go.html#1450796">size</a></span><span class="op" id="1451030">)</span><span class="op" id="1451031">;</span>&nbsp;<span class="ident" id="1451033"><a href="/gostd/sync/pool.go.html#1451010">i</a></span><span class="op" id="1451034">++</span>&nbsp;<span class="op" id="1451037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451041">l</span>&nbsp;<span class="op" id="1451043">:=</span>&nbsp;<span class="ident" id="1451046"><a href="/gostd/sync/pool.go.html#1453621">indexLocal</a></span><span class="op" id="1451056">(</span><span class="ident" id="1451057"><a href="/gostd/sync/pool.go.html#1450854">local</a></span><span class="op" id="1451062">,</span>&nbsp;<span class="op" id="1451064">(</span><span class="ident" id="1451065"><a href="/gostd/sync/pool.go.html#1450959">pid</a></span><span class="op" id="1451068">+</span><span class="ident" id="1451069"><a href="/gostd/sync/pool.go.html#1451010">i</a></span><span class="op" id="1451070">+</span><span class="num" id="1451071">1</span><span class="op" id="1451072">)</span><span class="op" id="1451073">%</span><span class="builtintype" id="1451074">int</span><span class="op" id="1451077">(</span><span class="ident" id="1451078"><a href="/gostd/sync/pool.go.html#1450796">size</a></span><span class="op" id="1451082">)</span><span class="op" id="1451083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451087"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451088">.</span><span class="ident" id="1451089"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1451093">(</span><span class="op" id="1451094">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451098">last</span>&nbsp;<span class="op" id="1451103">:=</span>&nbsp;<span class="builtinfunc" id="1451106">len</span><span class="op" id="1451109">(</span><span class="ident" id="1451110"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451111">.</span><span class="ident" id="1451112"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1451118">)</span>&nbsp;<span class="op" id="1451120">-</span>&nbsp;<span class="num" id="1451122">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451126">if</span>&nbsp;<span class="ident" id="1451129"><a href="/gostd/sync/pool.go.html#1451098">last</a></span>&nbsp;<span class="op" id="1451134">&gt;=</span>&nbsp;<span class="num" id="1451137">0</span>&nbsp;<span class="op" id="1451139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451144"><a href="/gostd/sync/pool.go.html#1450718">x</a></span>&nbsp;<span class="op" id="1451146">=</span>&nbsp;<span class="ident" id="1451148"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451149">.</span><span class="ident" id="1451150"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1451156">[</span><span class="ident" id="1451157"><a href="/gostd/sync/pool.go.html#1451098">last</a></span><span class="op" id="1451161">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451166"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451167">.</span><span class="ident" id="1451168"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span>&nbsp;<span class="op" id="1451175">=</span>&nbsp;<span class="ident" id="1451177"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451178">.</span><span class="ident" id="1451179"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1451185">[</span><span class="op" id="1451186">:</span><span class="ident" id="1451187"><a href="/gostd/sync/pool.go.html#1451098">last</a></span><span class="op" id="1451191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451196"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451197">.</span><span class="ident" id="1451198"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1451204">(</span><span class="op" id="1451205">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451210">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451222"><a href="/gostd/sync/pool.go.html#1451041">l</a></span><span class="op" id="1451223">.</span><span class="ident" id="1451224"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1451230">(</span><span class="op" id="1451231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451238">if</span>&nbsp;<span class="ident" id="1451241"><a href="/gostd/sync/pool.go.html#1450718">x</a></span>&nbsp;<span class="op" id="1451243">==</span>&nbsp;<span class="builtintype" id="1451246">nil</span>&nbsp;<span class="op" id="1451250">&amp;&amp;</span>&nbsp;<span class="ident" id="1451253"><a href="/gostd/sync/pool.go.html#1450698">p</a></span><span class="op" id="1451254">.</span><span class="ident" id="1451255"><a href="/gostd/sync/pool.go.html#1449180">New</a></span>&nbsp;<span class="op" id="1451259">!=</span>&nbsp;<span class="builtintype" id="1451262">nil</span>&nbsp;<span class="op" id="1451266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451270"><a href="/gostd/sync/pool.go.html#1450718">x</a></span>&nbsp;<span class="op" id="1451272">=</span>&nbsp;<span class="ident" id="1451274"><a href="/gostd/sync/pool.go.html#1450698">p</a></span><span class="op" id="1451275">.</span><span class="ident" id="1451276"><a href="/gostd/sync/pool.go.html#1449180">New</a></span><span class="op" id="1451279">(</span><span class="op" id="1451280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451286">return</span>&nbsp;<span class="ident" id="1451293"><a href="/gostd/sync/pool.go.html#1450718">x</a></span><br>
<span class="lineno"></span><span class="op" id="1451295">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1451298">//&nbsp;pin&nbsp;pins&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;to&nbsp;P,&nbsp;disables&nbsp;preemption&nbsp;and&nbsp;returns&nbsp;poolLocal&nbsp;pool&nbsp;for&nbsp;the&nbsp;P.</span><br>
<span class="lineno"></span><span class="comment" id="1451396">//&nbsp;Caller&nbsp;must&nbsp;call&nbsp;runtime_procUnpin()&nbsp;when&nbsp;done&nbsp;with&nbsp;the&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="1451461">func</span>&nbsp;<span class="op" id="1451466">(</span><span class="ident" id="1451467">p</span>&nbsp;<span class="op" id="1451469">*</span><span class="ident" id="1451470"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><span class="op" id="1451474">)</span>&nbsp;<span class="ident" id="1451476">pin</span><span class="op" id="1451479">(</span><span class="op" id="1451480">)</span>&nbsp;<span class="op" id="1451482">*</span><span class="ident" id="1451483"><a href="/gostd/sync/pool.go.html#1449241">poolLocal</a></span>&nbsp;<span class="op" id="1451493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451496">pid</span>&nbsp;<span class="op" id="1451500">:=</span>&nbsp;<span class="ident" id="1451503"><a href="/gostd/sync/pool.go.html#1453791">runtime_procPin</a></span><span class="op" id="1451518">(</span><span class="op" id="1451519">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451522">//&nbsp;In&nbsp;pinSlow&nbsp;we&nbsp;store&nbsp;to&nbsp;localSize&nbsp;and&nbsp;then&nbsp;to&nbsp;local,&nbsp;here&nbsp;we&nbsp;load&nbsp;in&nbsp;opposite&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451610">//&nbsp;Since&nbsp;we&#39;ve&nbsp;disabled&nbsp;preemption,&nbsp;GC&nbsp;can&nbsp;not&nbsp;happen&nbsp;in&nbsp;between.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451677">//&nbsp;Thus&nbsp;here&nbsp;we&nbsp;must&nbsp;observe&nbsp;local&nbsp;at&nbsp;least&nbsp;as&nbsp;large&nbsp;localSize.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451742">//&nbsp;We&nbsp;can&nbsp;observe&nbsp;a&nbsp;newer/larger&nbsp;local,&nbsp;it&nbsp;is&nbsp;fine&nbsp;(we&nbsp;must&nbsp;observe&nbsp;its&nbsp;zero-initialized-ness).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451839">s</span>&nbsp;<span class="op" id="1451841">:=</span>&nbsp;<span class="ident" id="1451844"><a href="/gostd/sync/pool.go.html#1447486">atomic</a></span><span class="op" id="1451850">.</span><span class="ident" id="1451851"><a href="/gostd/sync/atomic/doc.go.html#1468168">LoadUintptr</a></span><span class="op" id="1451862">(</span><span class="op" id="1451863">&amp;</span><span class="ident" id="1451864"><a href="/gostd/sync/pool.go.html#1451467">p</a></span><span class="op" id="1451865">.</span><span class="ident" id="1451866"><a href="/gostd/sync/pool.go.html#1448967">localSize</a></span><span class="op" id="1451875">)</span>&nbsp;<span class="comment" id="1451877">//&nbsp;load-acquire</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451894">l</span>&nbsp;<span class="op" id="1451896">:=</span>&nbsp;<span class="ident" id="1451899"><a href="/gostd/sync/pool.go.html#1451467">p</a></span><span class="op" id="1451900">.</span><span class="ident" id="1451901"><a href="/gostd/sync/pool.go.html#1448881">local</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451932">//&nbsp;load-consume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451949">if</span>&nbsp;<span class="builtintype" id="1451952">uintptr</span><span class="op" id="1451959">(</span><span class="ident" id="1451960"><a href="/gostd/sync/pool.go.html#1451496">pid</a></span><span class="op" id="1451963">)</span>&nbsp;<span class="op" id="1451965">&lt;</span>&nbsp;<span class="ident" id="1451967"><a href="/gostd/sync/pool.go.html#1451839">s</a></span>&nbsp;<span class="op" id="1451969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451973">return</span>&nbsp;<span class="ident" id="1451980"><a href="/gostd/sync/pool.go.html#1453621">indexLocal</a></span><span class="op" id="1451990">(</span><span class="ident" id="1451991"><a href="/gostd/sync/pool.go.html#1451894">l</a></span><span class="op" id="1451992">,</span>&nbsp;<span class="ident" id="1451994"><a href="/gostd/sync/pool.go.html#1451496">pid</a></span><span class="op" id="1451997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1452000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452003">return</span>&nbsp;<span class="ident" id="1452010"><a href="/gostd/sync/pool.go.html#1451467">p</a></span><span class="op" id="1452011">.</span><span class="ident" id="1452012"><a href="/gostd/sync/pool.go.html#1452040">pinSlow</a></span><span class="op" id="1452019">(</span><span class="op" id="1452020">)</span><br>
<span class="lineno">160</span><span class="op" id="1452022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1452025">func</span>&nbsp;<span class="op" id="1452030">(</span><span class="ident" id="1452031">p</span>&nbsp;<span class="op" id="1452033">*</span><span class="ident" id="1452034"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><span class="op" id="1452038">)</span>&nbsp;<span class="ident" id="1452040">pinSlow</span><span class="op" id="1452047">(</span><span class="op" id="1452048">)</span>&nbsp;<span class="op" id="1452050">*</span><span class="ident" id="1452051"><a href="/gostd/sync/pool.go.html#1449241">poolLocal</a></span>&nbsp;<span class="op" id="1452061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452064">//&nbsp;Retry&nbsp;under&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452091">//&nbsp;Can&nbsp;not&nbsp;lock&nbsp;the&nbsp;mutex&nbsp;while&nbsp;pinned.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452132"><a href="/gostd/sync/pool.go.html#1453818">runtime_procUnpin</a></span><span class="op" id="1452149">(</span><span class="op" id="1452150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452153"><a href="/gostd/sync/pool.go.html#1453517">allPoolsMu</a></span><span class="op" id="1452163">.</span><span class="ident" id="1452164"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1452168">(</span><span class="op" id="1452169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452172">defer</span>&nbsp;<span class="ident" id="1452178"><a href="/gostd/sync/pool.go.html#1453517">allPoolsMu</a></span><span class="op" id="1452188">.</span><span class="ident" id="1452189"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1452195">(</span><span class="op" id="1452196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452199">pid</span>&nbsp;<span class="op" id="1452203">:=</span>&nbsp;<span class="ident" id="1452206"><a href="/gostd/sync/pool.go.html#1453791">runtime_procPin</a></span><span class="op" id="1452221">(</span><span class="op" id="1452222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452225">//&nbsp;poolCleanup&nbsp;won&#39;t&nbsp;be&nbsp;called&nbsp;while&nbsp;we&nbsp;are&nbsp;pinned.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452278">s</span>&nbsp;<span class="op" id="1452280">:=</span>&nbsp;<span class="ident" id="1452283"><a href="/gostd/sync/pool.go.html#1452031">p</a></span><span class="op" id="1452284">.</span><span class="ident" id="1452285"><a href="/gostd/sync/pool.go.html#1448967">localSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452296">l</span>&nbsp;<span class="op" id="1452298">:=</span>&nbsp;<span class="ident" id="1452301"><a href="/gostd/sync/pool.go.html#1452031">p</a></span><span class="op" id="1452302">.</span><span class="ident" id="1452303"><a href="/gostd/sync/pool.go.html#1448881">local</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452310">if</span>&nbsp;<span class="builtintype" id="1452313">uintptr</span><span class="op" id="1452320">(</span><span class="ident" id="1452321"><a href="/gostd/sync/pool.go.html#1452199">pid</a></span><span class="op" id="1452324">)</span>&nbsp;<span class="op" id="1452326">&lt;</span>&nbsp;<span class="ident" id="1452328"><a href="/gostd/sync/pool.go.html#1452278">s</a></span>&nbsp;<span class="op" id="1452330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452334">return</span>&nbsp;<span class="ident" id="1452341"><a href="/gostd/sync/pool.go.html#1453621">indexLocal</a></span><span class="op" id="1452351">(</span><span class="ident" id="1452352"><a href="/gostd/sync/pool.go.html#1452296">l</a></span><span class="op" id="1452353">,</span>&nbsp;<span class="ident" id="1452355"><a href="/gostd/sync/pool.go.html#1452199">pid</a></span><span class="op" id="1452358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1452361">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452364">if</span>&nbsp;<span class="ident" id="1452367"><a href="/gostd/sync/pool.go.html#1452031">p</a></span><span class="op" id="1452368">.</span><span class="ident" id="1452369"><a href="/gostd/sync/pool.go.html#1448881">local</a></span>&nbsp;<span class="op" id="1452375">==</span>&nbsp;<span class="builtintype" id="1452378">nil</span>&nbsp;<span class="op" id="1452382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452386"><a href="/gostd/sync/pool.go.html#1453535">allPools</a></span>&nbsp;<span class="op" id="1452395">=</span>&nbsp;<span class="builtinfunc" id="1452397">append</span><span class="op" id="1452403">(</span><span class="ident" id="1452404"><a href="/gostd/sync/pool.go.html#1453535">allPools</a></span><span class="op" id="1452412">,</span>&nbsp;<span class="ident" id="1452414"><a href="/gostd/sync/pool.go.html#1452031">p</a></span><span class="op" id="1452415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1452418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452421">//&nbsp;If&nbsp;GOMAXPROCS&nbsp;changes&nbsp;between&nbsp;GCs,&nbsp;we&nbsp;re-allocate&nbsp;the&nbsp;array&nbsp;and&nbsp;lose&nbsp;the&nbsp;old&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452507">size</span>&nbsp;<span class="op" id="1452512">:=</span>&nbsp;<span class="ident" id="1452515"><a href="/gostd/sync/pool.go.html#1447475">runtime</a></span><span class="op" id="1452522">.</span><span class="ident" id="1452523"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="1452533">(</span><span class="num" id="1452534">0</span><span class="op" id="1452535">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452538">local</span>&nbsp;<span class="op" id="1452544">:=</span>&nbsp;<span class="builtinfunc" id="1452547">make</span><span class="op" id="1452551">(</span><span class="op" id="1452552">[</span><span class="op" id="1452553">]</span><span class="ident" id="1452554"><a href="/gostd/sync/pool.go.html#1449241">poolLocal</a></span><span class="op" id="1452563">,</span>&nbsp;<span class="ident" id="1452565"><a href="/gostd/sync/pool.go.html#1452507">size</a></span><span class="op" id="1452569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452572"><a href="/gostd/sync/pool.go.html#1447486">atomic</a></span><span class="op" id="1452578">.</span><span class="ident" id="1452579"><a href="/gostd/sync/atomic/doc.go.html#1468826">StorePointer</a></span><span class="op" id="1452591">(</span><span class="op" id="1452592">(</span><span class="op" id="1452593">*</span><span class="ident" id="1452594"><a href="/gostd/sync/pool.go.html#1447501">unsafe</a></span><span class="op" id="1452600">.</span><span class="ident" id="1452601">Pointer</span><span class="op" id="1452608">)</span><span class="op" id="1452609">(</span><span class="op" id="1452610">&amp;</span><span class="ident" id="1452611"><a href="/gostd/sync/pool.go.html#1452031">p</a></span><span class="op" id="1452612">.</span><span class="ident" id="1452613"><a href="/gostd/sync/pool.go.html#1448881">local</a></span><span class="op" id="1452618">)</span><span class="op" id="1452619">,</span>&nbsp;<span class="ident" id="1452621"><a href="/gostd/sync/pool.go.html#1447501">unsafe</a></span><span class="op" id="1452627">.</span><span class="ident" id="1452628">Pointer</span><span class="op" id="1452635">(</span><span class="op" id="1452636">&amp;</span><span class="ident" id="1452637"><a href="/gostd/sync/pool.go.html#1452538">local</a></span><span class="op" id="1452642">[</span><span class="num" id="1452643">0</span><span class="op" id="1452644">]</span><span class="op" id="1452645">)</span><span class="op" id="1452646">)</span>&nbsp;<span class="comment" id="1452648">//&nbsp;store-release</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452666"><a href="/gostd/sync/pool.go.html#1447486">atomic</a></span><span class="op" id="1452672">.</span><span class="ident" id="1452673"><a href="/gostd/sync/atomic/doc.go.html#1468729">StoreUintptr</a></span><span class="op" id="1452685">(</span><span class="op" id="1452686">&amp;</span><span class="ident" id="1452687"><a href="/gostd/sync/pool.go.html#1452031">p</a></span><span class="op" id="1452688">.</span><span class="ident" id="1452689"><a href="/gostd/sync/pool.go.html#1448967">localSize</a></span><span class="op" id="1452698">,</span>&nbsp;<span class="builtintype" id="1452700">uintptr</span><span class="op" id="1452707">(</span><span class="ident" id="1452708"><a href="/gostd/sync/pool.go.html#1452507">size</a></span><span class="op" id="1452712">)</span><span class="op" id="1452713">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452742">//&nbsp;store-release</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452760">return</span>&nbsp;<span class="op" id="1452767">&amp;</span><span class="ident" id="1452768"><a href="/gostd/sync/pool.go.html#1452538">local</a></span><span class="op" id="1452773">[</span><span class="ident" id="1452774"><a href="/gostd/sync/pool.go.html#1452199">pid</a></span><span class="op" id="1452777">]</span><br>
<span class="lineno"></span><span class="op" id="1452779">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="1452782">func</span>&nbsp;<span class="ident" id="1452787">poolCleanup</span><span class="op" id="1452798">(</span><span class="op" id="1452799">)</span>&nbsp;<span class="op" id="1452801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452804">//&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;world&nbsp;stopped,&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452898">//&nbsp;It&nbsp;must&nbsp;not&nbsp;allocate&nbsp;and&nbsp;probably&nbsp;should&nbsp;not&nbsp;call&nbsp;any&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452975">//&nbsp;Defensively&nbsp;zero&nbsp;out&nbsp;everything,&nbsp;2&nbsp;reasons:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453023">//&nbsp;1.&nbsp;To&nbsp;prevent&nbsp;false&nbsp;retention&nbsp;of&nbsp;whole&nbsp;Pools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453073">//&nbsp;2.&nbsp;If&nbsp;GC&nbsp;happens&nbsp;while&nbsp;a&nbsp;goroutine&nbsp;works&nbsp;with&nbsp;l.shared&nbsp;in&nbsp;Put/Get,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453144">//&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;will&nbsp;retain&nbsp;whole&nbsp;Pool.&nbsp;So&nbsp;next&nbsp;cycle&nbsp;memory&nbsp;consumption&nbsp;would&nbsp;be&nbsp;doubled.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453229">for</span>&nbsp;<span class="ident" id="1453233">i</span><span class="op" id="1453234">,</span>&nbsp;<span class="ident" id="1453236">p</span>&nbsp;<span class="op" id="1453238">:=</span>&nbsp;<span class="keyword" id="1453241">range</span>&nbsp;<span class="ident" id="1453247"><a href="/gostd/sync/pool.go.html#1453535">allPools</a></span>&nbsp;<span class="op" id="1453256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453260"><a href="/gostd/sync/pool.go.html#1453535">allPools</a></span><span class="op" id="1453268">[</span><span class="ident" id="1453269"><a href="/gostd/sync/pool.go.html#1453233">i</a></span><span class="op" id="1453270">]</span>&nbsp;<span class="op" id="1453272">=</span>&nbsp;<span class="builtintype" id="1453274">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453280">for</span>&nbsp;<span class="ident" id="1453284">i</span>&nbsp;<span class="op" id="1453286">:=</span>&nbsp;<span class="num" id="1453289">0</span><span class="op" id="1453290">;</span>&nbsp;<span class="ident" id="1453292"><a href="/gostd/sync/pool.go.html#1453284">i</a></span>&nbsp;<span class="op" id="1453294">&lt;</span>&nbsp;<span class="builtintype" id="1453296">int</span><span class="op" id="1453299">(</span><span class="ident" id="1453300"><a href="/gostd/sync/pool.go.html#1453236">p</a></span><span class="op" id="1453301">.</span><span class="ident" id="1453302"><a href="/gostd/sync/pool.go.html#1448967">localSize</a></span><span class="op" id="1453311">)</span><span class="op" id="1453312">;</span>&nbsp;<span class="ident" id="1453314"><a href="/gostd/sync/pool.go.html#1453284">i</a></span><span class="op" id="1453315">++</span>&nbsp;<span class="op" id="1453318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453323">l</span>&nbsp;<span class="op" id="1453325">:=</span>&nbsp;<span class="ident" id="1453328"><a href="/gostd/sync/pool.go.html#1453621">indexLocal</a></span><span class="op" id="1453338">(</span><span class="ident" id="1453339"><a href="/gostd/sync/pool.go.html#1453236">p</a></span><span class="op" id="1453340">.</span><span class="ident" id="1453341"><a href="/gostd/sync/pool.go.html#1448881">local</a></span><span class="op" id="1453346">,</span>&nbsp;<span class="ident" id="1453348"><a href="/gostd/sync/pool.go.html#1453284">i</a></span><span class="op" id="1453349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453354"><a href="/gostd/sync/pool.go.html#1453323">l</a></span><span class="op" id="1453355">.</span><span class="ident" id="1453356"><a href="/gostd/sync/pool.go.html#1449261">private</a></span>&nbsp;<span class="op" id="1453364">=</span>&nbsp;<span class="builtintype" id="1453366">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453373">for</span>&nbsp;<span class="ident" id="1453377">j</span>&nbsp;<span class="op" id="1453379">:=</span>&nbsp;<span class="keyword" id="1453382">range</span>&nbsp;<span class="ident" id="1453388"><a href="/gostd/sync/pool.go.html#1453323">l</a></span><span class="op" id="1453389">.</span><span class="ident" id="1453390"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span>&nbsp;<span class="op" id="1453397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453403"><a href="/gostd/sync/pool.go.html#1453323">l</a></span><span class="op" id="1453404">.</span><span class="ident" id="1453405"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span><span class="op" id="1453411">[</span><span class="ident" id="1453412"><a href="/gostd/sync/pool.go.html#1453377">j</a></span><span class="op" id="1453413">]</span>&nbsp;<span class="op" id="1453415">=</span>&nbsp;<span class="builtintype" id="1453417">nil</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453429"><a href="/gostd/sync/pool.go.html#1453323">l</a></span><span class="op" id="1453430">.</span><span class="ident" id="1453431"><a href="/gostd/sync/pool.go.html#1449325">shared</a></span>&nbsp;<span class="op" id="1453438">=</span>&nbsp;<span class="builtintype" id="1453440">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453450"><a href="/gostd/sync/pool.go.html#1453236">p</a></span><span class="op" id="1453451">.</span><span class="ident" id="1453452"><a href="/gostd/sync/pool.go.html#1448881">local</a></span>&nbsp;<span class="op" id="1453458">=</span>&nbsp;<span class="builtintype" id="1453460">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453466"><a href="/gostd/sync/pool.go.html#1453236">p</a></span><span class="op" id="1453467">.</span><span class="ident" id="1453468"><a href="/gostd/sync/pool.go.html#1448967">localSize</a></span>&nbsp;<span class="op" id="1453478">=</span>&nbsp;<span class="num" id="1453480">0</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453486"><a href="/gostd/sync/pool.go.html#1453535">allPools</a></span>&nbsp;<span class="op" id="1453495">=</span>&nbsp;<span class="op" id="1453497">[</span><span class="op" id="1453498">]</span><span class="op" id="1453499">*</span><span class="ident" id="1453500"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><span class="op" id="1453504">{</span><span class="op" id="1453505">}</span><br>
<span class="lineno"></span><span class="op" id="1453507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1453510">var</span>&nbsp;<span class="op" id="1453514">(</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453517">allPoolsMu</span>&nbsp;<span class="ident" id="1453528"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453535">allPools</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1453546">[</span><span class="op" id="1453547">]</span><span class="op" id="1453548">*</span><span class="ident" id="1453549"><a href="/gostd/sync/pool.go.html#1448866">Pool</a></span><br>
<span class="lineno"></span><span class="op" id="1453554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1453557">func</span>&nbsp;<span class="ident" id="1453562">init</span><span class="op" id="1453566">(</span><span class="op" id="1453567">)</span>&nbsp;<span class="op" id="1453569">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453572"><a href="/gostd/sync/pool.go.html#1453742">runtime_registerPoolCleanup</a></span><span class="op" id="1453599">(</span><span class="ident" id="1453600"><a href="/gostd/sync/pool.go.html#1452787">poolCleanup</a></span><span class="op" id="1453611">)</span><br>
<span class="lineno"></span><span class="op" id="1453613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1453616">func</span>&nbsp;<span class="ident" id="1453621">indexLocal</span><span class="op" id="1453631">(</span><span class="ident" id="1453632">l</span>&nbsp;<span class="ident" id="1453634"><a href="/gostd/sync/pool.go.html#1447501">unsafe</a></span><span class="op" id="1453640">.</span><span class="ident" id="1453641">Pointer</span><span class="op" id="1453648">,</span>&nbsp;<span class="ident" id="1453650">i</span>&nbsp;<span class="builtintype" id="1453652">int</span><span class="op" id="1453655">)</span>&nbsp;<span class="op" id="1453657">*</span><span class="ident" id="1453658"><a href="/gostd/sync/pool.go.html#1449241">poolLocal</a></span>&nbsp;<span class="op" id="1453668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453671">return</span>&nbsp;<span class="op" id="1453678">&amp;</span><span class="op" id="1453679">(</span><span class="op" id="1453680">*</span><span class="op" id="1453681">[</span><span class="num" id="1453682">1000000</span><span class="op" id="1453689">]</span><span class="ident" id="1453690"><a href="/gostd/sync/pool.go.html#1449241">poolLocal</a></span><span class="op" id="1453699">)</span><span class="op" id="1453700">(</span><span class="ident" id="1453701"><a href="/gostd/sync/pool.go.html#1453632">l</a></span><span class="op" id="1453702">)</span><span class="op" id="1453703">[</span><span class="ident" id="1453704"><a href="/gostd/sync/pool.go.html#1453650">i</a></span><span class="op" id="1453705">]</span><br>
<span class="lineno">220</span><span class="op" id="1453707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1453710">//&nbsp;Implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1453737">func</span>&nbsp;<span class="ident" id="1453742">runtime_registerPoolCleanup</span><span class="op" id="1453769">(</span><span class="ident" id="1453770">cleanup</span>&nbsp;<span class="keyword" id="1453778">func</span><span class="op" id="1453782">(</span><span class="op" id="1453783">)</span><span class="op" id="1453784">)</span><br>
<span class="lineno"></span><span class="keyword" id="1453786">func</span>&nbsp;<span class="ident" id="1453791">runtime_procPin</span><span class="op" id="1453806">(</span><span class="op" id="1453807">)</span>&nbsp;<span class="builtintype" id="1453809">int</span><br>
<span class="lineno">225</span><span class="keyword" id="1453813">func</span>&nbsp;<span class="ident" id="1453818">runtime_procUnpin</span><span class="op" id="1453835">(</span><span class="op" id="1453836">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
