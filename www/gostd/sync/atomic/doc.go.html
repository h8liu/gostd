<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html" class="current">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1428544">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1428600">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1428654">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1428705">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1428767">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1428822">//</span><br>
<span class="lineno"></span><span class="comment" id="1428825">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1428885">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1428958">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1429019">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1429053">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1429093">//</span><br>
<span class="lineno"></span><span class="comment" id="1429096">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1429169">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1429187">//</span><br>
<span class="lineno"></span><span class="comment" id="1429190">//&nbsp;&nbsp;&nbsp;&nbsp;old&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1429205">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1429220">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1429234">//</span><br>
<span class="lineno"></span><span class="comment" id="1429237">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1429307">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1429350">//</span><br>
<span class="lineno"></span><span class="comment" id="1429353">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1429374">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1429390">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1429406">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1429411">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1429427">//</span><br>
<span class="lineno">30</span><span class="comment" id="1429430">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1429501">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1429519">//</span><br>
<span class="lineno"></span><span class="comment" id="1429522">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1429540">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1429556">//</span><br>
<span class="lineno"></span><span class="comment" id="1429559">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1429629">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1429692">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1429710">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1429713">package</span>&nbsp;<span class="ident" id="1429721">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1429729">import</span>&nbsp;<span class="op" id="1429736">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1429739">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1429748">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1429751">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1429849">//</span><br>
<span class="lineno"></span><span class="comment" id="1429852">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1429947">//</span><br>
<span class="lineno">50</span><span class="comment" id="1429950">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1430033">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1430110">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1430182">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1430202">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1430286">func</span>&nbsp;<span class="ident" id="1430291">SwapInt32</span><span class="op" id="1430300">(</span><span class="ident" id="1430301">addr</span>&nbsp;<span class="op" id="1430306">*</span><span class="builtintype" id="1430307">int32</span><span class="op" id="1430312">,</span>&nbsp;<span class="builtinfunc" id="1430314">new</span>&nbsp;<span class="builtintype" id="1430318">int32</span><span class="op" id="1430323">)</span>&nbsp;<span class="op" id="1430325">(</span><span class="ident" id="1430326">old</span>&nbsp;<span class="builtintype" id="1430330">int32</span><span class="op" id="1430335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1430338">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1430422">func</span>&nbsp;<span class="ident" id="1430427">SwapInt64</span><span class="op" id="1430436">(</span><span class="ident" id="1430437">addr</span>&nbsp;<span class="op" id="1430442">*</span><span class="ident" id="1430443">int64</span><span class="op" id="1430448">,</span>&nbsp;<span class="builtinfunc" id="1430450">new</span>&nbsp;<span class="ident" id="1430454">int64</span><span class="op" id="1430459">)</span>&nbsp;<span class="op" id="1430461">(</span><span class="ident" id="1430462">old</span>&nbsp;<span class="ident" id="1430466">int64</span><span class="op" id="1430471">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1430474">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1430559">func</span>&nbsp;<span class="ident" id="1430564">SwapUint32</span><span class="op" id="1430574">(</span><span class="ident" id="1430575">addr</span>&nbsp;<span class="op" id="1430580">*</span><span class="builtintype" id="1430581">uint32</span><span class="op" id="1430587">,</span>&nbsp;<span class="builtinfunc" id="1430589">new</span>&nbsp;<span class="builtintype" id="1430593">uint32</span><span class="op" id="1430599">)</span>&nbsp;<span class="op" id="1430601">(</span><span class="ident" id="1430602">old</span>&nbsp;<span class="builtintype" id="1430606">uint32</span><span class="op" id="1430612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1430615">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1430700">func</span>&nbsp;<span class="ident" id="1430705">SwapUint64</span><span class="op" id="1430715">(</span><span class="ident" id="1430716">addr</span>&nbsp;<span class="op" id="1430721">*</span><span class="ident" id="1430722">uint64</span><span class="op" id="1430728">,</span>&nbsp;<span class="builtinfunc" id="1430730">new</span>&nbsp;<span class="ident" id="1430734">uint64</span><span class="op" id="1430740">)</span>&nbsp;<span class="op" id="1430742">(</span><span class="ident" id="1430743">old</span>&nbsp;<span class="ident" id="1430747">uint64</span><span class="op" id="1430753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1430756">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1430842">func</span>&nbsp;<span class="ident" id="1430847">SwapUintptr</span><span class="op" id="1430858">(</span><span class="ident" id="1430859">addr</span>&nbsp;<span class="op" id="1430864">*</span><span class="builtintype" id="1430865">uintptr</span><span class="op" id="1430872">,</span>&nbsp;<span class="builtinfunc" id="1430874">new</span>&nbsp;<span class="builtintype" id="1430878">uintptr</span><span class="op" id="1430885">)</span>&nbsp;<span class="op" id="1430887">(</span><span class="ident" id="1430888">old</span>&nbsp;<span class="builtintype" id="1430892">uintptr</span><span class="op" id="1430899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1430902">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1430988">func</span>&nbsp;<span class="ident" id="1430993">SwapPointer</span><span class="op" id="1431004">(</span><span class="ident" id="1431005">addr</span>&nbsp;<span class="op" id="1431010">*</span><span class="ident" id="1431011">unsafe</span><span class="op" id="1431017">.</span><span class="ident" id="1431018">Pointer</span><span class="op" id="1431025">,</span>&nbsp;<span class="builtinfunc" id="1431027">new</span>&nbsp;<span class="ident" id="1431031">unsafe</span><span class="op" id="1431037">.</span><span class="ident" id="1431038">Pointer</span><span class="op" id="1431045">)</span>&nbsp;<span class="op" id="1431047">(</span><span class="ident" id="1431048">old</span>&nbsp;<span class="ident" id="1431052">unsafe</span><span class="op" id="1431058">.</span><span class="ident" id="1431059">Pointer</span><span class="op" id="1431066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1431069">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1431152">func</span>&nbsp;<span class="ident" id="1431157">CompareAndSwapInt32</span><span class="op" id="1431176">(</span><span class="ident" id="1431177">addr</span>&nbsp;<span class="op" id="1431182">*</span><span class="builtintype" id="1431183">int32</span><span class="op" id="1431188">,</span>&nbsp;<span class="ident" id="1431190">old</span><span class="op" id="1431193">,</span>&nbsp;<span class="builtinfunc" id="1431195">new</span>&nbsp;<span class="builtintype" id="1431199">int32</span><span class="op" id="1431204">)</span>&nbsp;<span class="op" id="1431206">(</span><span class="ident" id="1431207">swapped</span>&nbsp;<span class="builtintype" id="1431215">bool</span><span class="op" id="1431219">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1431222">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1431305">func</span>&nbsp;<span class="ident" id="1431310">CompareAndSwapInt64</span><span class="op" id="1431329">(</span><span class="ident" id="1431330">addr</span>&nbsp;<span class="op" id="1431335">*</span><span class="ident" id="1431336">int64</span><span class="op" id="1431341">,</span>&nbsp;<span class="ident" id="1431343">old</span><span class="op" id="1431346">,</span>&nbsp;<span class="builtinfunc" id="1431348">new</span>&nbsp;<span class="ident" id="1431352">int64</span><span class="op" id="1431357">)</span>&nbsp;<span class="op" id="1431359">(</span><span class="ident" id="1431360">swapped</span>&nbsp;<span class="builtintype" id="1431368">bool</span><span class="op" id="1431372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1431375">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1431459">func</span>&nbsp;<span class="ident" id="1431464">CompareAndSwapUint32</span><span class="op" id="1431484">(</span><span class="ident" id="1431485">addr</span>&nbsp;<span class="op" id="1431490">*</span><span class="builtintype" id="1431491">uint32</span><span class="op" id="1431497">,</span>&nbsp;<span class="ident" id="1431499">old</span><span class="op" id="1431502">,</span>&nbsp;<span class="builtinfunc" id="1431504">new</span>&nbsp;<span class="builtintype" id="1431508">uint32</span><span class="op" id="1431514">)</span>&nbsp;<span class="op" id="1431516">(</span><span class="ident" id="1431517">swapped</span>&nbsp;<span class="builtintype" id="1431525">bool</span><span class="op" id="1431529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1431532">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1431616">func</span>&nbsp;<span class="ident" id="1431621">CompareAndSwapUint64</span><span class="op" id="1431641">(</span><span class="ident" id="1431642">addr</span>&nbsp;<span class="op" id="1431647">*</span><span class="ident" id="1431648">uint64</span><span class="op" id="1431654">,</span>&nbsp;<span class="ident" id="1431656">old</span><span class="op" id="1431659">,</span>&nbsp;<span class="builtinfunc" id="1431661">new</span>&nbsp;<span class="ident" id="1431665">uint64</span><span class="op" id="1431671">)</span>&nbsp;<span class="op" id="1431673">(</span><span class="ident" id="1431674">swapped</span>&nbsp;<span class="builtintype" id="1431682">bool</span><span class="op" id="1431686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1431689">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1431775">func</span>&nbsp;<span class="ident" id="1431780">CompareAndSwapUintptr</span><span class="op" id="1431801">(</span><span class="ident" id="1431802">addr</span>&nbsp;<span class="op" id="1431807">*</span><span class="builtintype" id="1431808">uintptr</span><span class="op" id="1431815">,</span>&nbsp;<span class="ident" id="1431817">old</span><span class="op" id="1431820">,</span>&nbsp;<span class="builtinfunc" id="1431822">new</span>&nbsp;<span class="builtintype" id="1431826">uintptr</span><span class="op" id="1431833">)</span>&nbsp;<span class="op" id="1431835">(</span><span class="ident" id="1431836">swapped</span>&nbsp;<span class="builtintype" id="1431844">bool</span><span class="op" id="1431848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1431851">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1431944">func</span>&nbsp;<span class="ident" id="1431949">CompareAndSwapPointer</span><span class="op" id="1431970">(</span><span class="ident" id="1431971">addr</span>&nbsp;<span class="op" id="1431976">*</span><span class="ident" id="1431977">unsafe</span><span class="op" id="1431983">.</span><span class="ident" id="1431984">Pointer</span><span class="op" id="1431991">,</span>&nbsp;<span class="ident" id="1431993">old</span><span class="op" id="1431996">,</span>&nbsp;<span class="builtinfunc" id="1431998">new</span>&nbsp;<span class="ident" id="1432002">unsafe</span><span class="op" id="1432008">.</span><span class="ident" id="1432009">Pointer</span><span class="op" id="1432016">)</span>&nbsp;<span class="op" id="1432018">(</span><span class="ident" id="1432019">swapped</span>&nbsp;<span class="builtintype" id="1432027">bool</span><span class="op" id="1432031">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1432034">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1432104">func</span>&nbsp;<span class="ident" id="1432109">AddInt32</span><span class="op" id="1432117">(</span><span class="ident" id="1432118">addr</span>&nbsp;<span class="op" id="1432123">*</span><span class="builtintype" id="1432124">int32</span><span class="op" id="1432129">,</span>&nbsp;<span class="ident" id="1432131">delta</span>&nbsp;<span class="builtintype" id="1432137">int32</span><span class="op" id="1432142">)</span>&nbsp;<span class="op" id="1432144">(</span><span class="builtinfunc" id="1432145">new</span>&nbsp;<span class="builtintype" id="1432149">int32</span><span class="op" id="1432154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1432157">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1432228">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1432318">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1432382">func</span>&nbsp;<span class="ident" id="1432387">AddUint32</span><span class="op" id="1432396">(</span><span class="ident" id="1432397">addr</span>&nbsp;<span class="op" id="1432402">*</span><span class="builtintype" id="1432403">uint32</span><span class="op" id="1432409">,</span>&nbsp;<span class="ident" id="1432411">delta</span>&nbsp;<span class="builtintype" id="1432417">uint32</span><span class="op" id="1432423">)</span>&nbsp;<span class="op" id="1432425">(</span><span class="builtinfunc" id="1432426">new</span>&nbsp;<span class="builtintype" id="1432430">uint32</span><span class="op" id="1432436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1432439">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1432509">func</span>&nbsp;<span class="ident" id="1432514">AddInt64</span><span class="op" id="1432522">(</span><span class="ident" id="1432523">addr</span>&nbsp;<span class="op" id="1432528">*</span><span class="ident" id="1432529">int64</span><span class="op" id="1432534">,</span>&nbsp;<span class="ident" id="1432536">delta</span>&nbsp;<span class="ident" id="1432542">int64</span><span class="op" id="1432547">)</span>&nbsp;<span class="op" id="1432549">(</span><span class="builtinfunc" id="1432550">new</span>&nbsp;<span class="ident" id="1432554">int64</span><span class="op" id="1432559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1432562">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1432633">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1432723">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1432787">func</span>&nbsp;<span class="ident" id="1432792">AddUint64</span><span class="op" id="1432801">(</span><span class="ident" id="1432802">addr</span>&nbsp;<span class="op" id="1432807">*</span><span class="ident" id="1432808">uint64</span><span class="op" id="1432814">,</span>&nbsp;<span class="ident" id="1432816">delta</span>&nbsp;<span class="ident" id="1432822">uint64</span><span class="op" id="1432828">)</span>&nbsp;<span class="op" id="1432830">(</span><span class="builtinfunc" id="1432831">new</span>&nbsp;<span class="ident" id="1432835">uint64</span><span class="op" id="1432841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1432844">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1432916">func</span>&nbsp;<span class="ident" id="1432921">AddUintptr</span><span class="op" id="1432931">(</span><span class="ident" id="1432932">addr</span>&nbsp;<span class="op" id="1432937">*</span><span class="builtintype" id="1432938">uintptr</span><span class="op" id="1432945">,</span>&nbsp;<span class="ident" id="1432947">delta</span>&nbsp;<span class="builtintype" id="1432953">uintptr</span><span class="op" id="1432960">)</span>&nbsp;<span class="op" id="1432962">(</span><span class="builtinfunc" id="1432963">new</span>&nbsp;<span class="builtintype" id="1432967">uintptr</span><span class="op" id="1432974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1432977">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433014">func</span>&nbsp;<span class="ident" id="1433019">LoadInt32</span><span class="op" id="1433028">(</span><span class="ident" id="1433029">addr</span>&nbsp;<span class="op" id="1433034">*</span><span class="builtintype" id="1433035">int32</span><span class="op" id="1433040">)</span>&nbsp;<span class="op" id="1433042">(</span><span class="ident" id="1433043">val</span>&nbsp;<span class="builtintype" id="1433047">int32</span><span class="op" id="1433052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433055">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433092">func</span>&nbsp;<span class="ident" id="1433097">LoadInt64</span><span class="op" id="1433106">(</span><span class="ident" id="1433107">addr</span>&nbsp;<span class="op" id="1433112">*</span><span class="ident" id="1433113">int64</span><span class="op" id="1433118">)</span>&nbsp;<span class="op" id="1433120">(</span><span class="ident" id="1433121">val</span>&nbsp;<span class="ident" id="1433125">int64</span><span class="op" id="1433130">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1433133">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433171">func</span>&nbsp;<span class="ident" id="1433176">LoadUint32</span><span class="op" id="1433186">(</span><span class="ident" id="1433187">addr</span>&nbsp;<span class="op" id="1433192">*</span><span class="builtintype" id="1433193">uint32</span><span class="op" id="1433199">)</span>&nbsp;<span class="op" id="1433201">(</span><span class="ident" id="1433202">val</span>&nbsp;<span class="builtintype" id="1433206">uint32</span><span class="op" id="1433212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433215">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1433253">func</span>&nbsp;<span class="ident" id="1433258">LoadUint64</span><span class="op" id="1433268">(</span><span class="ident" id="1433269">addr</span>&nbsp;<span class="op" id="1433274">*</span><span class="ident" id="1433275">uint64</span><span class="op" id="1433281">)</span>&nbsp;<span class="op" id="1433283">(</span><span class="ident" id="1433284">val</span>&nbsp;<span class="ident" id="1433288">uint64</span><span class="op" id="1433294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433297">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433336">func</span>&nbsp;<span class="ident" id="1433341">LoadUintptr</span><span class="op" id="1433352">(</span><span class="ident" id="1433353">addr</span>&nbsp;<span class="op" id="1433358">*</span><span class="builtintype" id="1433359">uintptr</span><span class="op" id="1433366">)</span>&nbsp;<span class="op" id="1433368">(</span><span class="ident" id="1433369">val</span>&nbsp;<span class="builtintype" id="1433373">uintptr</span><span class="op" id="1433380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1433383">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433422">func</span>&nbsp;<span class="ident" id="1433427">LoadPointer</span><span class="op" id="1433438">(</span><span class="ident" id="1433439">addr</span>&nbsp;<span class="op" id="1433444">*</span><span class="ident" id="1433445">unsafe</span><span class="op" id="1433451">.</span><span class="ident" id="1433452">Pointer</span><span class="op" id="1433459">)</span>&nbsp;<span class="op" id="1433461">(</span><span class="ident" id="1433462">val</span>&nbsp;<span class="ident" id="1433466">unsafe</span><span class="op" id="1433472">.</span><span class="ident" id="1433473">Pointer</span><span class="op" id="1433480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433483">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433531">func</span>&nbsp;<span class="ident" id="1433536">StoreInt32</span><span class="op" id="1433546">(</span><span class="ident" id="1433547">addr</span>&nbsp;<span class="op" id="1433552">*</span><span class="builtintype" id="1433553">int32</span><span class="op" id="1433558">,</span>&nbsp;<span class="ident" id="1433560">val</span>&nbsp;<span class="builtintype" id="1433564">int32</span><span class="op" id="1433569">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1433572">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433620">func</span>&nbsp;<span class="ident" id="1433625">StoreInt64</span><span class="op" id="1433635">(</span><span class="ident" id="1433636">addr</span>&nbsp;<span class="op" id="1433641">*</span><span class="ident" id="1433642">int64</span><span class="op" id="1433647">,</span>&nbsp;<span class="ident" id="1433649">val</span>&nbsp;<span class="ident" id="1433653">int64</span><span class="op" id="1433658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433661">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1433710">func</span>&nbsp;<span class="ident" id="1433715">StoreUint32</span><span class="op" id="1433726">(</span><span class="ident" id="1433727">addr</span>&nbsp;<span class="op" id="1433732">*</span><span class="builtintype" id="1433733">uint32</span><span class="op" id="1433739">,</span>&nbsp;<span class="ident" id="1433741">val</span>&nbsp;<span class="builtintype" id="1433745">uint32</span><span class="op" id="1433751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433754">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433803">func</span>&nbsp;<span class="ident" id="1433808">StoreUint64</span><span class="op" id="1433819">(</span><span class="ident" id="1433820">addr</span>&nbsp;<span class="op" id="1433825">*</span><span class="ident" id="1433826">uint64</span><span class="op" id="1433832">,</span>&nbsp;<span class="ident" id="1433834">val</span>&nbsp;<span class="ident" id="1433838">uint64</span><span class="op" id="1433844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1433847">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433897">func</span>&nbsp;<span class="ident" id="1433902">StoreUintptr</span><span class="op" id="1433914">(</span><span class="ident" id="1433915">addr</span>&nbsp;<span class="op" id="1433920">*</span><span class="builtintype" id="1433921">uintptr</span><span class="op" id="1433928">,</span>&nbsp;<span class="ident" id="1433930">val</span>&nbsp;<span class="builtintype" id="1433934">uintptr</span><span class="op" id="1433941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1433944">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1433994">func</span>&nbsp;<span class="ident" id="1433999">StorePointer</span><span class="op" id="1434011">(</span><span class="ident" id="1434012">addr</span>&nbsp;<span class="op" id="1434017">*</span><span class="ident" id="1434018">unsafe</span><span class="op" id="1434024">.</span><span class="ident" id="1434025">Pointer</span><span class="op" id="1434032">,</span>&nbsp;<span class="ident" id="1434034">val</span>&nbsp;<span class="ident" id="1434038">unsafe</span><span class="op" id="1434044">.</span><span class="ident" id="1434045">Pointer</span><span class="op" id="1434052">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1434055">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1434112">func</span>&nbsp;<span class="ident" id="1434117">panic64</span><span class="op" id="1434124">(</span><span class="op" id="1434125">)</span>&nbsp;<span class="op" id="1434127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1434130">panic</span><span class="op" id="1434135">(</span><span class="string" id="1434136">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1434195">)</span><br>
<span class="lineno"></span><span class="op" id="1434197">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
