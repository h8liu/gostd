<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7573941">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7573997">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7574051">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7574102">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7574120">package</span>&nbsp;<span class="ident" id="7574128">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7574133">import</span>&nbsp;<span class="op" id="7574140">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7574143">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7574154">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7574165">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7574175">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7574178">var</span>&nbsp;<span class="ident" id="7574182">listenerTests</span>&nbsp;<span class="op" id="7574196">=</span>&nbsp;<span class="op" id="7574198">[</span><span class="op" id="7574199">]</span><span class="keyword" id="7574200">struct</span>&nbsp;<span class="op" id="7574207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7574210">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7574219">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7574227">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7574236">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7574244">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7574253">bool</span>&nbsp;<span class="comment" id="7574258">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7574299">wildcard</span>&nbsp;<span class="builtintype" id="7574308">bool</span>&nbsp;<span class="comment" id="7574313">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="7574343">}</span><span class="op" id="7574344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574347">{</span><span class="ident" id="7574348">net</span><span class="op" id="7574351">:</span>&nbsp;<span class="string" id="7574353">&#34;tcp&#34;</span><span class="op" id="7574358">,</span>&nbsp;<span class="ident" id="7574360">laddr</span><span class="op" id="7574365">:</span>&nbsp;<span class="string" id="7574367">&#34;&#34;</span><span class="op" id="7574369">,</span>&nbsp;<span class="ident" id="7574371">wildcard</span><span class="op" id="7574379">:</span>&nbsp;<span class="ident" id="7574381">true</span><span class="op" id="7574385">}</span><span class="op" id="7574386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574389">{</span><span class="ident" id="7574390">net</span><span class="op" id="7574393">:</span>&nbsp;<span class="string" id="7574395">&#34;tcp&#34;</span><span class="op" id="7574400">,</span>&nbsp;<span class="ident" id="7574402">laddr</span><span class="op" id="7574407">:</span>&nbsp;<span class="string" id="7574409">&#34;0.0.0.0&#34;</span><span class="op" id="7574418">,</span>&nbsp;<span class="ident" id="7574420">wildcard</span><span class="op" id="7574428">:</span>&nbsp;<span class="ident" id="7574430">true</span><span class="op" id="7574434">}</span><span class="op" id="7574435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574438">{</span><span class="ident" id="7574439">net</span><span class="op" id="7574442">:</span>&nbsp;<span class="string" id="7574444">&#34;tcp&#34;</span><span class="op" id="7574449">,</span>&nbsp;<span class="ident" id="7574451">laddr</span><span class="op" id="7574456">:</span>&nbsp;<span class="string" id="7574458">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7574476">,</span>&nbsp;<span class="ident" id="7574478">wildcard</span><span class="op" id="7574486">:</span>&nbsp;<span class="ident" id="7574488">true</span><span class="op" id="7574492">}</span><span class="op" id="7574493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574496">{</span><span class="ident" id="7574497">net</span><span class="op" id="7574500">:</span>&nbsp;<span class="string" id="7574502">&#34;tcp&#34;</span><span class="op" id="7574507">,</span>&nbsp;<span class="ident" id="7574509">laddr</span><span class="op" id="7574514">:</span>&nbsp;<span class="string" id="7574516">&#34;[::]&#34;</span><span class="op" id="7574522">,</span>&nbsp;<span class="ident" id="7574524">ipv6</span><span class="op" id="7574528">:</span>&nbsp;<span class="ident" id="7574530">true</span><span class="op" id="7574534">,</span>&nbsp;<span class="ident" id="7574536">wildcard</span><span class="op" id="7574544">:</span>&nbsp;<span class="ident" id="7574546">true</span><span class="op" id="7574550">}</span><span class="op" id="7574551">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574555">{</span><span class="ident" id="7574556">net</span><span class="op" id="7574559">:</span>&nbsp;<span class="string" id="7574561">&#34;tcp&#34;</span><span class="op" id="7574566">,</span>&nbsp;<span class="ident" id="7574568">laddr</span><span class="op" id="7574573">:</span>&nbsp;<span class="string" id="7574575">&#34;127.0.0.1&#34;</span><span class="op" id="7574586">}</span><span class="op" id="7574587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574590">{</span><span class="ident" id="7574591">net</span><span class="op" id="7574594">:</span>&nbsp;<span class="string" id="7574596">&#34;tcp&#34;</span><span class="op" id="7574601">,</span>&nbsp;<span class="ident" id="7574603">laddr</span><span class="op" id="7574608">:</span>&nbsp;<span class="string" id="7574610">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7574630">}</span><span class="op" id="7574631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574634">{</span><span class="ident" id="7574635">net</span><span class="op" id="7574638">:</span>&nbsp;<span class="string" id="7574640">&#34;tcp&#34;</span><span class="op" id="7574645">,</span>&nbsp;<span class="ident" id="7574647">laddr</span><span class="op" id="7574652">:</span>&nbsp;<span class="string" id="7574654">&#34;[::1]&#34;</span><span class="op" id="7574661">,</span>&nbsp;<span class="ident" id="7574663">ipv6</span><span class="op" id="7574667">:</span>&nbsp;<span class="ident" id="7574669">true</span><span class="op" id="7574673">}</span><span class="op" id="7574674">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574678">{</span><span class="ident" id="7574679">net</span><span class="op" id="7574682">:</span>&nbsp;<span class="string" id="7574684">&#34;tcp4&#34;</span><span class="op" id="7574690">,</span>&nbsp;<span class="ident" id="7574692">laddr</span><span class="op" id="7574697">:</span>&nbsp;<span class="string" id="7574699">&#34;&#34;</span><span class="op" id="7574701">,</span>&nbsp;<span class="ident" id="7574703">wildcard</span><span class="op" id="7574711">:</span>&nbsp;<span class="ident" id="7574713">true</span><span class="op" id="7574717">}</span><span class="op" id="7574718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574721">{</span><span class="ident" id="7574722">net</span><span class="op" id="7574725">:</span>&nbsp;<span class="string" id="7574727">&#34;tcp4&#34;</span><span class="op" id="7574733">,</span>&nbsp;<span class="ident" id="7574735">laddr</span><span class="op" id="7574740">:</span>&nbsp;<span class="string" id="7574742">&#34;0.0.0.0&#34;</span><span class="op" id="7574751">,</span>&nbsp;<span class="ident" id="7574753">wildcard</span><span class="op" id="7574761">:</span>&nbsp;<span class="ident" id="7574763">true</span><span class="op" id="7574767">}</span><span class="op" id="7574768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574771">{</span><span class="ident" id="7574772">net</span><span class="op" id="7574775">:</span>&nbsp;<span class="string" id="7574777">&#34;tcp4&#34;</span><span class="op" id="7574783">,</span>&nbsp;<span class="ident" id="7574785">laddr</span><span class="op" id="7574790">:</span>&nbsp;<span class="string" id="7574792">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7574810">,</span>&nbsp;<span class="ident" id="7574812">wildcard</span><span class="op" id="7574820">:</span>&nbsp;<span class="ident" id="7574822">true</span><span class="op" id="7574826">}</span><span class="op" id="7574827">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574831">{</span><span class="ident" id="7574832">net</span><span class="op" id="7574835">:</span>&nbsp;<span class="string" id="7574837">&#34;tcp4&#34;</span><span class="op" id="7574843">,</span>&nbsp;<span class="ident" id="7574845">laddr</span><span class="op" id="7574850">:</span>&nbsp;<span class="string" id="7574852">&#34;127.0.0.1&#34;</span><span class="op" id="7574863">}</span><span class="op" id="7574864">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574867">{</span><span class="ident" id="7574868">net</span><span class="op" id="7574871">:</span>&nbsp;<span class="string" id="7574873">&#34;tcp4&#34;</span><span class="op" id="7574879">,</span>&nbsp;<span class="ident" id="7574881">laddr</span><span class="op" id="7574886">:</span>&nbsp;<span class="string" id="7574888">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7574908">}</span><span class="op" id="7574909">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574913">{</span><span class="ident" id="7574914">net</span><span class="op" id="7574917">:</span>&nbsp;<span class="string" id="7574919">&#34;tcp6&#34;</span><span class="op" id="7574925">,</span>&nbsp;<span class="ident" id="7574927">laddr</span><span class="op" id="7574932">:</span>&nbsp;<span class="string" id="7574934">&#34;&#34;</span><span class="op" id="7574936">,</span>&nbsp;<span class="ident" id="7574938">ipv6</span><span class="op" id="7574942">:</span>&nbsp;<span class="ident" id="7574944">true</span><span class="op" id="7574948">,</span>&nbsp;<span class="ident" id="7574950">wildcard</span><span class="op" id="7574958">:</span>&nbsp;<span class="ident" id="7574960">true</span><span class="op" id="7574964">}</span><span class="op" id="7574965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7574968">{</span><span class="ident" id="7574969">net</span><span class="op" id="7574972">:</span>&nbsp;<span class="string" id="7574974">&#34;tcp6&#34;</span><span class="op" id="7574980">,</span>&nbsp;<span class="ident" id="7574982">laddr</span><span class="op" id="7574987">:</span>&nbsp;<span class="string" id="7574989">&#34;[::]&#34;</span><span class="op" id="7574995">,</span>&nbsp;<span class="ident" id="7574997">ipv6</span><span class="op" id="7575001">:</span>&nbsp;<span class="ident" id="7575003">true</span><span class="op" id="7575007">,</span>&nbsp;<span class="ident" id="7575009">wildcard</span><span class="op" id="7575017">:</span>&nbsp;<span class="ident" id="7575019">true</span><span class="op" id="7575023">}</span><span class="op" id="7575024">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7575028">{</span><span class="ident" id="7575029">net</span><span class="op" id="7575032">:</span>&nbsp;<span class="string" id="7575034">&#34;tcp6&#34;</span><span class="op" id="7575040">,</span>&nbsp;<span class="ident" id="7575042">laddr</span><span class="op" id="7575047">:</span>&nbsp;<span class="string" id="7575049">&#34;[::1]&#34;</span><span class="op" id="7575056">,</span>&nbsp;<span class="ident" id="7575058">ipv6</span><span class="op" id="7575062">:</span>&nbsp;<span class="ident" id="7575064">true</span><span class="op" id="7575068">}</span><span class="op" id="7575069">,</span><br>
<span class="lineno"></span><span class="op" id="7575071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7575074">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7575139">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="7575204">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7575218">func</span>&nbsp;<span class="ident" id="7575223">TestTCPListener</span><span class="op" id="7575238">(</span><span class="ident" id="7575239">t</span>&nbsp;<span class="op" id="7575241">*</span><span class="ident" id="7575242">testing</span><span class="op" id="7575249">.</span><span class="ident" id="7575250">T</span><span class="op" id="7575251">)</span>&nbsp;<span class="op" id="7575253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575256">switch</span>&nbsp;<span class="ident" id="7575263">runtime</span><span class="op" id="7575270">.</span><span class="ident" id="7575271">GOOS</span>&nbsp;<span class="op" id="7575276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575279">case</span>&nbsp;<span class="string" id="7575284">&#34;plan9&#34;</span><span class="op" id="7575291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575295">t</span><span class="op" id="7575296">.</span><span class="ident" id="7575297">Skipf</span><span class="op" id="7575302">(</span><span class="string" id="7575303">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7575324">,</span>&nbsp;<span class="ident" id="7575326">runtime</span><span class="op" id="7575333">.</span><span class="ident" id="7575334">GOOS</span><span class="op" id="7575338">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7575341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575345">for</span>&nbsp;<span class="ident" id="7575349">_</span><span class="op" id="7575350">,</span>&nbsp;<span class="ident" id="7575352">tt</span>&nbsp;<span class="op" id="7575355">:=</span>&nbsp;<span class="keyword" id="7575358">range</span>&nbsp;<span class="ident" id="7575364">listenerTests</span>&nbsp;<span class="op" id="7575378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575382">if</span>&nbsp;<span class="ident" id="7575385">tt</span><span class="op" id="7575387">.</span><span class="ident" id="7575388">wildcard</span>&nbsp;<span class="op" id="7575397">&amp;&amp;</span>&nbsp;<span class="op" id="7575400">(</span><span class="ident" id="7575401">testing</span><span class="op" id="7575408">.</span><span class="ident" id="7575409">Short</span><span class="op" id="7575414">(</span><span class="op" id="7575415">)</span>&nbsp;<span class="op" id="7575417">||</span>&nbsp;<span class="op" id="7575420">!</span><span class="op" id="7575421">*</span><span class="ident" id="7575422">testExternal</span><span class="op" id="7575434">)</span>&nbsp;<span class="op" id="7575436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575441">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7575452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575456">if</span>&nbsp;<span class="ident" id="7575459">tt</span><span class="op" id="7575461">.</span><span class="ident" id="7575462">ipv6</span>&nbsp;<span class="op" id="7575467">&amp;&amp;</span>&nbsp;<span class="op" id="7575470">!</span><span class="ident" id="7575471">supportsIPv6</span>&nbsp;<span class="op" id="7575484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575489">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7575500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575504">l1</span><span class="op" id="7575506">,</span>&nbsp;<span class="ident" id="7575508">port</span>&nbsp;<span class="op" id="7575513">:=</span>&nbsp;<span class="ident" id="7575516">usableListenPort</span><span class="op" id="7575532">(</span><span class="ident" id="7575533">t</span><span class="op" id="7575534">,</span>&nbsp;<span class="ident" id="7575536">tt</span><span class="op" id="7575538">.</span><span class="ident" id="7575539">net</span><span class="op" id="7575542">,</span>&nbsp;<span class="ident" id="7575544">tt</span><span class="op" id="7575546">.</span><span class="ident" id="7575547">laddr</span><span class="op" id="7575552">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575556">checkFirstListener</span><span class="op" id="7575574">(</span><span class="ident" id="7575575">t</span><span class="op" id="7575576">,</span>&nbsp;<span class="ident" id="7575578">tt</span><span class="op" id="7575580">.</span><span class="ident" id="7575581">net</span><span class="op" id="7575584">,</span>&nbsp;<span class="ident" id="7575586">tt</span><span class="op" id="7575588">.</span><span class="ident" id="7575589">laddr</span><span class="op" id="7575594">+</span><span class="string" id="7575595">&#34;:&#34;</span><span class="op" id="7575598">+</span><span class="ident" id="7575599">port</span><span class="op" id="7575603">,</span>&nbsp;<span class="ident" id="7575605">l1</span><span class="op" id="7575607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575611">l2</span><span class="op" id="7575613">,</span>&nbsp;<span class="ident" id="7575615">err</span>&nbsp;<span class="op" id="7575619">:=</span>&nbsp;<span class="ident" id="7575622">Listen</span><span class="op" id="7575628">(</span><span class="ident" id="7575629">tt</span><span class="op" id="7575631">.</span><span class="ident" id="7575632">net</span><span class="op" id="7575635">,</span>&nbsp;<span class="ident" id="7575637">tt</span><span class="op" id="7575639">.</span><span class="ident" id="7575640">laddr</span><span class="op" id="7575645">+</span><span class="string" id="7575646">&#34;:&#34;</span><span class="op" id="7575649">+</span><span class="ident" id="7575650">port</span><span class="op" id="7575654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575658">checkSecondListener</span><span class="op" id="7575677">(</span><span class="ident" id="7575678">t</span><span class="op" id="7575679">,</span>&nbsp;<span class="ident" id="7575681">tt</span><span class="op" id="7575683">.</span><span class="ident" id="7575684">net</span><span class="op" id="7575687">,</span>&nbsp;<span class="ident" id="7575689">tt</span><span class="op" id="7575691">.</span><span class="ident" id="7575692">laddr</span><span class="op" id="7575697">+</span><span class="string" id="7575698">&#34;:&#34;</span><span class="op" id="7575701">+</span><span class="ident" id="7575702">port</span><span class="op" id="7575706">,</span>&nbsp;<span class="ident" id="7575708">err</span><span class="op" id="7575711">,</span>&nbsp;<span class="ident" id="7575713">l2</span><span class="op" id="7575715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575719">l1</span><span class="op" id="7575721">.</span><span class="ident" id="7575722">Close</span><span class="op" id="7575727">(</span><span class="op" id="7575728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7575731">}</span><br>
<span class="lineno">65</span><span class="op" id="7575733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7575736">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7575801">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7575866">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="7575880">func</span>&nbsp;<span class="ident" id="7575885">TestUDPListener</span><span class="op" id="7575900">(</span><span class="ident" id="7575901">t</span>&nbsp;<span class="op" id="7575903">*</span><span class="ident" id="7575904">testing</span><span class="op" id="7575911">.</span><span class="ident" id="7575912">T</span><span class="op" id="7575913">)</span>&nbsp;<span class="op" id="7575915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575918">switch</span>&nbsp;<span class="ident" id="7575925">runtime</span><span class="op" id="7575932">.</span><span class="ident" id="7575933">GOOS</span>&nbsp;<span class="op" id="7575938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7575941">case</span>&nbsp;<span class="string" id="7575946">&#34;plan9&#34;</span><span class="op" id="7575953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7575957">t</span><span class="op" id="7575958">.</span><span class="ident" id="7575959">Skipf</span><span class="op" id="7575964">(</span><span class="string" id="7575965">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7575986">,</span>&nbsp;<span class="ident" id="7575988">runtime</span><span class="op" id="7575995">.</span><span class="ident" id="7575996">GOOS</span><span class="op" id="7576000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7576003">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576007">toudpnet</span>&nbsp;<span class="op" id="7576016">:=</span>&nbsp;<span class="keyword" id="7576019">func</span><span class="op" id="7576023">(</span><span class="ident" id="7576024">net</span>&nbsp;<span class="builtintype" id="7576028">string</span><span class="op" id="7576034">)</span>&nbsp;<span class="builtintype" id="7576036">string</span>&nbsp;<span class="op" id="7576043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576047">switch</span>&nbsp;<span class="ident" id="7576054">net</span>&nbsp;<span class="op" id="7576058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576062">case</span>&nbsp;<span class="string" id="7576067">&#34;tcp&#34;</span><span class="op" id="7576072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576077">return</span>&nbsp;<span class="string" id="7576084">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576092">case</span>&nbsp;<span class="string" id="7576097">&#34;tcp4&#34;</span><span class="op" id="7576103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576108">return</span>&nbsp;<span class="string" id="7576115">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576124">case</span>&nbsp;<span class="string" id="7576129">&#34;tcp6&#34;</span><span class="op" id="7576135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576140">return</span>&nbsp;<span class="string" id="7576147">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7576156">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576160">return</span>&nbsp;<span class="string" id="7576167">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7576176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576180">for</span>&nbsp;<span class="ident" id="7576184">_</span><span class="op" id="7576185">,</span>&nbsp;<span class="ident" id="7576187">tt</span>&nbsp;<span class="op" id="7576190">:=</span>&nbsp;<span class="keyword" id="7576193">range</span>&nbsp;<span class="ident" id="7576199">listenerTests</span>&nbsp;<span class="op" id="7576213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576217">if</span>&nbsp;<span class="ident" id="7576220">tt</span><span class="op" id="7576222">.</span><span class="ident" id="7576223">wildcard</span>&nbsp;<span class="op" id="7576232">&amp;&amp;</span>&nbsp;<span class="op" id="7576235">(</span><span class="ident" id="7576236">testing</span><span class="op" id="7576243">.</span><span class="ident" id="7576244">Short</span><span class="op" id="7576249">(</span><span class="op" id="7576250">)</span>&nbsp;<span class="op" id="7576252">||</span>&nbsp;<span class="op" id="7576255">!</span><span class="op" id="7576256">*</span><span class="ident" id="7576257">testExternal</span><span class="op" id="7576269">)</span>&nbsp;<span class="op" id="7576271">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576276">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7576287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576291">if</span>&nbsp;<span class="ident" id="7576294">tt</span><span class="op" id="7576296">.</span><span class="ident" id="7576297">ipv6</span>&nbsp;<span class="op" id="7576302">&amp;&amp;</span>&nbsp;<span class="op" id="7576305">!</span><span class="ident" id="7576306">supportsIPv6</span>&nbsp;<span class="op" id="7576319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7576324">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7576335">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576339">tt</span><span class="op" id="7576341">.</span><span class="ident" id="7576342">net</span>&nbsp;<span class="op" id="7576346">=</span>&nbsp;<span class="ident" id="7576348">toudpnet</span><span class="op" id="7576356">(</span><span class="ident" id="7576357">tt</span><span class="op" id="7576359">.</span><span class="ident" id="7576360">net</span><span class="op" id="7576363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576367">l1</span><span class="op" id="7576369">,</span>&nbsp;<span class="ident" id="7576371">port</span>&nbsp;<span class="op" id="7576376">:=</span>&nbsp;<span class="ident" id="7576379">usableListenPacketPort</span><span class="op" id="7576401">(</span><span class="ident" id="7576402">t</span><span class="op" id="7576403">,</span>&nbsp;<span class="ident" id="7576405">tt</span><span class="op" id="7576407">.</span><span class="ident" id="7576408">net</span><span class="op" id="7576411">,</span>&nbsp;<span class="ident" id="7576413">tt</span><span class="op" id="7576415">.</span><span class="ident" id="7576416">laddr</span><span class="op" id="7576421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576425">checkFirstListener</span><span class="op" id="7576443">(</span><span class="ident" id="7576444">t</span><span class="op" id="7576445">,</span>&nbsp;<span class="ident" id="7576447">tt</span><span class="op" id="7576449">.</span><span class="ident" id="7576450">net</span><span class="op" id="7576453">,</span>&nbsp;<span class="ident" id="7576455">tt</span><span class="op" id="7576457">.</span><span class="ident" id="7576458">laddr</span><span class="op" id="7576463">+</span><span class="string" id="7576464">&#34;:&#34;</span><span class="op" id="7576467">+</span><span class="ident" id="7576468">port</span><span class="op" id="7576472">,</span>&nbsp;<span class="ident" id="7576474">l1</span><span class="op" id="7576476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576480">l2</span><span class="op" id="7576482">,</span>&nbsp;<span class="ident" id="7576484">err</span>&nbsp;<span class="op" id="7576488">:=</span>&nbsp;<span class="ident" id="7576491">ListenPacket</span><span class="op" id="7576503">(</span><span class="ident" id="7576504">tt</span><span class="op" id="7576506">.</span><span class="ident" id="7576507">net</span><span class="op" id="7576510">,</span>&nbsp;<span class="ident" id="7576512">tt</span><span class="op" id="7576514">.</span><span class="ident" id="7576515">laddr</span><span class="op" id="7576520">+</span><span class="string" id="7576521">&#34;:&#34;</span><span class="op" id="7576524">+</span><span class="ident" id="7576525">port</span><span class="op" id="7576529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576533">checkSecondListener</span><span class="op" id="7576552">(</span><span class="ident" id="7576553">t</span><span class="op" id="7576554">,</span>&nbsp;<span class="ident" id="7576556">tt</span><span class="op" id="7576558">.</span><span class="ident" id="7576559">net</span><span class="op" id="7576562">,</span>&nbsp;<span class="ident" id="7576564">tt</span><span class="op" id="7576566">.</span><span class="ident" id="7576567">laddr</span><span class="op" id="7576572">+</span><span class="string" id="7576573">&#34;:&#34;</span><span class="op" id="7576576">+</span><span class="ident" id="7576577">port</span><span class="op" id="7576581">,</span>&nbsp;<span class="ident" id="7576583">err</span><span class="op" id="7576586">,</span>&nbsp;<span class="ident" id="7576588">l2</span><span class="op" id="7576590">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576594">l1</span><span class="op" id="7576596">.</span><span class="ident" id="7576597">Close</span><span class="op" id="7576602">(</span><span class="op" id="7576603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7576606">}</span><br>
<span class="lineno"></span><span class="op" id="7576608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7576611">var</span>&nbsp;<span class="ident" id="7576615">dualStackListenerTests</span>&nbsp;<span class="op" id="7576638">=</span>&nbsp;<span class="op" id="7576640">[</span><span class="op" id="7576641">]</span><span class="keyword" id="7576642">struct</span>&nbsp;<span class="op" id="7576649">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576652">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7576661">string</span>&nbsp;<span class="comment" id="7576668">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576687">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7576696">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576704">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7576713">string</span>&nbsp;<span class="comment" id="7576720">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576740">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7576749">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576757">wildcard</span>&nbsp;<span class="builtintype" id="7576766">bool</span>&nbsp;&nbsp;<span class="comment" id="7576772">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7576803">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7576812">error</span>&nbsp;<span class="comment" id="7576818">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="7576856">}</span><span class="op" id="7576857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7576860">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7576942">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577031">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577120">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577206">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577292">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577378">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577467">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577554">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577641">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577728">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577815">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577902">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7577989">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578078">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578165">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578252">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578339">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578426">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578515">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578602">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578689">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578776">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578863">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578867">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578904">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7578938">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7579011">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7579043">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7579116">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7579148">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7579220">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7579252">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579307">{</span><span class="ident" id="7579308">net1</span><span class="op" id="7579312">:</span>&nbsp;<span class="string" id="7579314">&#34;tcp&#34;</span><span class="op" id="7579319">,</span>&nbsp;<span class="ident" id="7579321">laddr1</span><span class="op" id="7579327">:</span>&nbsp;<span class="string" id="7579329">&#34;&#34;</span><span class="op" id="7579331">,</span>&nbsp;<span class="ident" id="7579333">net2</span><span class="op" id="7579337">:</span>&nbsp;<span class="string" id="7579339">&#34;tcp&#34;</span><span class="op" id="7579344">,</span>&nbsp;<span class="ident" id="7579346">laddr2</span><span class="op" id="7579352">:</span>&nbsp;<span class="string" id="7579354">&#34;&#34;</span><span class="op" id="7579356">,</span>&nbsp;<span class="ident" id="7579358">wildcard</span><span class="op" id="7579366">:</span>&nbsp;<span class="ident" id="7579368">true</span><span class="op" id="7579372">,</span>&nbsp;<span class="ident" id="7579374">xerr</span><span class="op" id="7579378">:</span>&nbsp;<span class="ident" id="7579380">syscall</span><span class="op" id="7579387">.</span><span class="ident" id="7579388">EADDRINUSE</span><span class="op" id="7579398">}</span><span class="op" id="7579399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579402">{</span><span class="ident" id="7579403">net1</span><span class="op" id="7579407">:</span>&nbsp;<span class="string" id="7579409">&#34;tcp&#34;</span><span class="op" id="7579414">,</span>&nbsp;<span class="ident" id="7579416">laddr1</span><span class="op" id="7579422">:</span>&nbsp;<span class="string" id="7579424">&#34;&#34;</span><span class="op" id="7579426">,</span>&nbsp;<span class="ident" id="7579428">net2</span><span class="op" id="7579432">:</span>&nbsp;<span class="string" id="7579434">&#34;tcp&#34;</span><span class="op" id="7579439">,</span>&nbsp;<span class="ident" id="7579441">laddr2</span><span class="op" id="7579447">:</span>&nbsp;<span class="string" id="7579449">&#34;0.0.0.0&#34;</span><span class="op" id="7579458">,</span>&nbsp;<span class="ident" id="7579460">wildcard</span><span class="op" id="7579468">:</span>&nbsp;<span class="ident" id="7579470">true</span><span class="op" id="7579474">,</span>&nbsp;<span class="ident" id="7579476">xerr</span><span class="op" id="7579480">:</span>&nbsp;<span class="ident" id="7579482">syscall</span><span class="op" id="7579489">.</span><span class="ident" id="7579490">EADDRINUSE</span><span class="op" id="7579500">}</span><span class="op" id="7579501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579504">{</span><span class="ident" id="7579505">net1</span><span class="op" id="7579509">:</span>&nbsp;<span class="string" id="7579511">&#34;tcp&#34;</span><span class="op" id="7579516">,</span>&nbsp;<span class="ident" id="7579518">laddr1</span><span class="op" id="7579524">:</span>&nbsp;<span class="string" id="7579526">&#34;0.0.0.0&#34;</span><span class="op" id="7579535">,</span>&nbsp;<span class="ident" id="7579537">net2</span><span class="op" id="7579541">:</span>&nbsp;<span class="string" id="7579543">&#34;tcp&#34;</span><span class="op" id="7579548">,</span>&nbsp;<span class="ident" id="7579550">laddr2</span><span class="op" id="7579556">:</span>&nbsp;<span class="string" id="7579558">&#34;&#34;</span><span class="op" id="7579560">,</span>&nbsp;<span class="ident" id="7579562">wildcard</span><span class="op" id="7579570">:</span>&nbsp;<span class="ident" id="7579572">true</span><span class="op" id="7579576">,</span>&nbsp;<span class="ident" id="7579578">xerr</span><span class="op" id="7579582">:</span>&nbsp;<span class="ident" id="7579584">syscall</span><span class="op" id="7579591">.</span><span class="ident" id="7579592">EADDRINUSE</span><span class="op" id="7579602">}</span><span class="op" id="7579603">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579607">{</span><span class="ident" id="7579608">net1</span><span class="op" id="7579612">:</span>&nbsp;<span class="string" id="7579614">&#34;tcp&#34;</span><span class="op" id="7579619">,</span>&nbsp;<span class="ident" id="7579621">laddr1</span><span class="op" id="7579627">:</span>&nbsp;<span class="string" id="7579629">&#34;&#34;</span><span class="op" id="7579631">,</span>&nbsp;<span class="ident" id="7579633">net2</span><span class="op" id="7579637">:</span>&nbsp;<span class="string" id="7579639">&#34;tcp&#34;</span><span class="op" id="7579644">,</span>&nbsp;<span class="ident" id="7579646">laddr2</span><span class="op" id="7579652">:</span>&nbsp;<span class="string" id="7579654">&#34;[::]&#34;</span><span class="op" id="7579660">,</span>&nbsp;<span class="ident" id="7579662">wildcard</span><span class="op" id="7579670">:</span>&nbsp;<span class="ident" id="7579672">true</span><span class="op" id="7579676">,</span>&nbsp;<span class="ident" id="7579678">xerr</span><span class="op" id="7579682">:</span>&nbsp;<span class="ident" id="7579684">syscall</span><span class="op" id="7579691">.</span><span class="ident" id="7579692">EADDRINUSE</span><span class="op" id="7579702">}</span><span class="op" id="7579703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579706">{</span><span class="ident" id="7579707">net1</span><span class="op" id="7579711">:</span>&nbsp;<span class="string" id="7579713">&#34;tcp&#34;</span><span class="op" id="7579718">,</span>&nbsp;<span class="ident" id="7579720">laddr1</span><span class="op" id="7579726">:</span>&nbsp;<span class="string" id="7579728">&#34;[::]&#34;</span><span class="op" id="7579734">,</span>&nbsp;<span class="ident" id="7579736">net2</span><span class="op" id="7579740">:</span>&nbsp;<span class="string" id="7579742">&#34;tcp&#34;</span><span class="op" id="7579747">,</span>&nbsp;<span class="ident" id="7579749">laddr2</span><span class="op" id="7579755">:</span>&nbsp;<span class="string" id="7579757">&#34;&#34;</span><span class="op" id="7579759">,</span>&nbsp;<span class="ident" id="7579761">wildcard</span><span class="op" id="7579769">:</span>&nbsp;<span class="ident" id="7579771">true</span><span class="op" id="7579775">,</span>&nbsp;<span class="ident" id="7579777">xerr</span><span class="op" id="7579781">:</span>&nbsp;<span class="ident" id="7579783">syscall</span><span class="op" id="7579790">.</span><span class="ident" id="7579791">EADDRINUSE</span><span class="op" id="7579801">}</span><span class="op" id="7579802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579805">{</span><span class="ident" id="7579806">net1</span><span class="op" id="7579810">:</span>&nbsp;<span class="string" id="7579812">&#34;tcp&#34;</span><span class="op" id="7579817">,</span>&nbsp;<span class="ident" id="7579819">laddr1</span><span class="op" id="7579825">:</span>&nbsp;<span class="string" id="7579827">&#34;0.0.0.0&#34;</span><span class="op" id="7579836">,</span>&nbsp;<span class="ident" id="7579838">net2</span><span class="op" id="7579842">:</span>&nbsp;<span class="string" id="7579844">&#34;tcp&#34;</span><span class="op" id="7579849">,</span>&nbsp;<span class="ident" id="7579851">laddr2</span><span class="op" id="7579857">:</span>&nbsp;<span class="string" id="7579859">&#34;[::]&#34;</span><span class="op" id="7579865">,</span>&nbsp;<span class="ident" id="7579867">wildcard</span><span class="op" id="7579875">:</span>&nbsp;<span class="ident" id="7579877">true</span><span class="op" id="7579881">,</span>&nbsp;<span class="ident" id="7579883">xerr</span><span class="op" id="7579887">:</span>&nbsp;<span class="ident" id="7579889">syscall</span><span class="op" id="7579896">.</span><span class="ident" id="7579897">EADDRINUSE</span><span class="op" id="7579907">}</span><span class="op" id="7579908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579911">{</span><span class="ident" id="7579912">net1</span><span class="op" id="7579916">:</span>&nbsp;<span class="string" id="7579918">&#34;tcp&#34;</span><span class="op" id="7579923">,</span>&nbsp;<span class="ident" id="7579925">laddr1</span><span class="op" id="7579931">:</span>&nbsp;<span class="string" id="7579933">&#34;[::]&#34;</span><span class="op" id="7579939">,</span>&nbsp;<span class="ident" id="7579941">net2</span><span class="op" id="7579945">:</span>&nbsp;<span class="string" id="7579947">&#34;tcp&#34;</span><span class="op" id="7579952">,</span>&nbsp;<span class="ident" id="7579954">laddr2</span><span class="op" id="7579960">:</span>&nbsp;<span class="string" id="7579962">&#34;0.0.0.0&#34;</span><span class="op" id="7579971">,</span>&nbsp;<span class="ident" id="7579973">wildcard</span><span class="op" id="7579981">:</span>&nbsp;<span class="ident" id="7579983">true</span><span class="op" id="7579987">,</span>&nbsp;<span class="ident" id="7579989">xerr</span><span class="op" id="7579993">:</span>&nbsp;<span class="ident" id="7579995">syscall</span><span class="op" id="7580002">.</span><span class="ident" id="7580003">EADDRINUSE</span><span class="op" id="7580013">}</span><span class="op" id="7580014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580017">{</span><span class="ident" id="7580018">net1</span><span class="op" id="7580022">:</span>&nbsp;<span class="string" id="7580024">&#34;tcp&#34;</span><span class="op" id="7580029">,</span>&nbsp;<span class="ident" id="7580031">laddr1</span><span class="op" id="7580037">:</span>&nbsp;<span class="string" id="7580039">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7580057">,</span>&nbsp;<span class="ident" id="7580059">net2</span><span class="op" id="7580063">:</span>&nbsp;<span class="string" id="7580065">&#34;tcp&#34;</span><span class="op" id="7580070">,</span>&nbsp;<span class="ident" id="7580072">laddr2</span><span class="op" id="7580078">:</span>&nbsp;<span class="string" id="7580080">&#34;[::]&#34;</span><span class="op" id="7580086">,</span>&nbsp;<span class="ident" id="7580088">wildcard</span><span class="op" id="7580096">:</span>&nbsp;<span class="ident" id="7580098">true</span><span class="op" id="7580102">,</span>&nbsp;<span class="ident" id="7580104">xerr</span><span class="op" id="7580108">:</span>&nbsp;<span class="ident" id="7580110">syscall</span><span class="op" id="7580117">.</span><span class="ident" id="7580118">EADDRINUSE</span><span class="op" id="7580128">}</span><span class="op" id="7580129">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580132">{</span><span class="ident" id="7580133">net1</span><span class="op" id="7580137">:</span>&nbsp;<span class="string" id="7580139">&#34;tcp&#34;</span><span class="op" id="7580144">,</span>&nbsp;<span class="ident" id="7580146">laddr1</span><span class="op" id="7580152">:</span>&nbsp;<span class="string" id="7580154">&#34;[::]&#34;</span><span class="op" id="7580160">,</span>&nbsp;<span class="ident" id="7580162">net2</span><span class="op" id="7580166">:</span>&nbsp;<span class="string" id="7580168">&#34;tcp&#34;</span><span class="op" id="7580173">,</span>&nbsp;<span class="ident" id="7580175">laddr2</span><span class="op" id="7580181">:</span>&nbsp;<span class="string" id="7580183">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7580201">,</span>&nbsp;<span class="ident" id="7580203">wildcard</span><span class="op" id="7580211">:</span>&nbsp;<span class="ident" id="7580213">true</span><span class="op" id="7580217">,</span>&nbsp;<span class="ident" id="7580219">xerr</span><span class="op" id="7580223">:</span>&nbsp;<span class="ident" id="7580225">syscall</span><span class="op" id="7580232">.</span><span class="ident" id="7580233">EADDRINUSE</span><span class="op" id="7580243">}</span><span class="op" id="7580244">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580248">{</span><span class="ident" id="7580249">net1</span><span class="op" id="7580253">:</span>&nbsp;<span class="string" id="7580255">&#34;tcp4&#34;</span><span class="op" id="7580261">,</span>&nbsp;<span class="ident" id="7580263">laddr1</span><span class="op" id="7580269">:</span>&nbsp;<span class="string" id="7580271">&#34;&#34;</span><span class="op" id="7580273">,</span>&nbsp;<span class="ident" id="7580275">net2</span><span class="op" id="7580279">:</span>&nbsp;<span class="string" id="7580281">&#34;tcp6&#34;</span><span class="op" id="7580287">,</span>&nbsp;<span class="ident" id="7580289">laddr2</span><span class="op" id="7580295">:</span>&nbsp;<span class="string" id="7580297">&#34;&#34;</span><span class="op" id="7580299">,</span>&nbsp;<span class="ident" id="7580301">wildcard</span><span class="op" id="7580309">:</span>&nbsp;<span class="ident" id="7580311">true</span><span class="op" id="7580315">}</span><span class="op" id="7580316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580319">{</span><span class="ident" id="7580320">net1</span><span class="op" id="7580324">:</span>&nbsp;<span class="string" id="7580326">&#34;tcp6&#34;</span><span class="op" id="7580332">,</span>&nbsp;<span class="ident" id="7580334">laddr1</span><span class="op" id="7580340">:</span>&nbsp;<span class="string" id="7580342">&#34;&#34;</span><span class="op" id="7580344">,</span>&nbsp;<span class="ident" id="7580346">net2</span><span class="op" id="7580350">:</span>&nbsp;<span class="string" id="7580352">&#34;tcp4&#34;</span><span class="op" id="7580358">,</span>&nbsp;<span class="ident" id="7580360">laddr2</span><span class="op" id="7580366">:</span>&nbsp;<span class="string" id="7580368">&#34;&#34;</span><span class="op" id="7580370">,</span>&nbsp;<span class="ident" id="7580372">wildcard</span><span class="op" id="7580380">:</span>&nbsp;<span class="ident" id="7580382">true</span><span class="op" id="7580386">}</span><span class="op" id="7580387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580390">{</span><span class="ident" id="7580391">net1</span><span class="op" id="7580395">:</span>&nbsp;<span class="string" id="7580397">&#34;tcp4&#34;</span><span class="op" id="7580403">,</span>&nbsp;<span class="ident" id="7580405">laddr1</span><span class="op" id="7580411">:</span>&nbsp;<span class="string" id="7580413">&#34;0.0.0.0&#34;</span><span class="op" id="7580422">,</span>&nbsp;<span class="ident" id="7580424">net2</span><span class="op" id="7580428">:</span>&nbsp;<span class="string" id="7580430">&#34;tcp6&#34;</span><span class="op" id="7580436">,</span>&nbsp;<span class="ident" id="7580438">laddr2</span><span class="op" id="7580444">:</span>&nbsp;<span class="string" id="7580446">&#34;[::]&#34;</span><span class="op" id="7580452">,</span>&nbsp;<span class="ident" id="7580454">wildcard</span><span class="op" id="7580462">:</span>&nbsp;<span class="ident" id="7580464">true</span><span class="op" id="7580468">}</span><span class="op" id="7580469">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580472">{</span><span class="ident" id="7580473">net1</span><span class="op" id="7580477">:</span>&nbsp;<span class="string" id="7580479">&#34;tcp6&#34;</span><span class="op" id="7580485">,</span>&nbsp;<span class="ident" id="7580487">laddr1</span><span class="op" id="7580493">:</span>&nbsp;<span class="string" id="7580495">&#34;[::]&#34;</span><span class="op" id="7580501">,</span>&nbsp;<span class="ident" id="7580503">net2</span><span class="op" id="7580507">:</span>&nbsp;<span class="string" id="7580509">&#34;tcp4&#34;</span><span class="op" id="7580515">,</span>&nbsp;<span class="ident" id="7580517">laddr2</span><span class="op" id="7580523">:</span>&nbsp;<span class="string" id="7580525">&#34;0.0.0.0&#34;</span><span class="op" id="7580534">,</span>&nbsp;<span class="ident" id="7580536">wildcard</span><span class="op" id="7580544">:</span>&nbsp;<span class="ident" id="7580546">true</span><span class="op" id="7580550">}</span><span class="op" id="7580551">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580555">{</span><span class="ident" id="7580556">net1</span><span class="op" id="7580560">:</span>&nbsp;<span class="string" id="7580562">&#34;tcp&#34;</span><span class="op" id="7580567">,</span>&nbsp;<span class="ident" id="7580569">laddr1</span><span class="op" id="7580575">:</span>&nbsp;<span class="string" id="7580577">&#34;127.0.0.1&#34;</span><span class="op" id="7580588">,</span>&nbsp;<span class="ident" id="7580590">net2</span><span class="op" id="7580594">:</span>&nbsp;<span class="string" id="7580596">&#34;tcp&#34;</span><span class="op" id="7580601">,</span>&nbsp;<span class="ident" id="7580603">laddr2</span><span class="op" id="7580609">:</span>&nbsp;<span class="string" id="7580611">&#34;[::1]&#34;</span><span class="op" id="7580618">}</span><span class="op" id="7580619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580622">{</span><span class="ident" id="7580623">net1</span><span class="op" id="7580627">:</span>&nbsp;<span class="string" id="7580629">&#34;tcp&#34;</span><span class="op" id="7580634">,</span>&nbsp;<span class="ident" id="7580636">laddr1</span><span class="op" id="7580642">:</span>&nbsp;<span class="string" id="7580644">&#34;[::1]&#34;</span><span class="op" id="7580651">,</span>&nbsp;<span class="ident" id="7580653">net2</span><span class="op" id="7580657">:</span>&nbsp;<span class="string" id="7580659">&#34;tcp&#34;</span><span class="op" id="7580664">,</span>&nbsp;<span class="ident" id="7580666">laddr2</span><span class="op" id="7580672">:</span>&nbsp;<span class="string" id="7580674">&#34;127.0.0.1&#34;</span><span class="op" id="7580685">}</span><span class="op" id="7580686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580689">{</span><span class="ident" id="7580690">net1</span><span class="op" id="7580694">:</span>&nbsp;<span class="string" id="7580696">&#34;tcp4&#34;</span><span class="op" id="7580702">,</span>&nbsp;<span class="ident" id="7580704">laddr1</span><span class="op" id="7580710">:</span>&nbsp;<span class="string" id="7580712">&#34;127.0.0.1&#34;</span><span class="op" id="7580723">,</span>&nbsp;<span class="ident" id="7580725">net2</span><span class="op" id="7580729">:</span>&nbsp;<span class="string" id="7580731">&#34;tcp6&#34;</span><span class="op" id="7580737">,</span>&nbsp;<span class="ident" id="7580739">laddr2</span><span class="op" id="7580745">:</span>&nbsp;<span class="string" id="7580747">&#34;[::1]&#34;</span><span class="op" id="7580754">}</span><span class="op" id="7580755">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580758">{</span><span class="ident" id="7580759">net1</span><span class="op" id="7580763">:</span>&nbsp;<span class="string" id="7580765">&#34;tcp6&#34;</span><span class="op" id="7580771">,</span>&nbsp;<span class="ident" id="7580773">laddr1</span><span class="op" id="7580779">:</span>&nbsp;<span class="string" id="7580781">&#34;[::1]&#34;</span><span class="op" id="7580788">,</span>&nbsp;<span class="ident" id="7580790">net2</span><span class="op" id="7580794">:</span>&nbsp;<span class="string" id="7580796">&#34;tcp4&#34;</span><span class="op" id="7580802">,</span>&nbsp;<span class="ident" id="7580804">laddr2</span><span class="op" id="7580810">:</span>&nbsp;<span class="string" id="7580812">&#34;127.0.0.1&#34;</span><span class="op" id="7580823">}</span><span class="op" id="7580824">,</span><br>
<span class="lineno"></span><span class="op" id="7580826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7580829">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="7580893">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="7580956">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7580992">func</span>&nbsp;<span class="ident" id="7580997">TestDualStackTCPListener</span><span class="op" id="7581021">(</span><span class="ident" id="7581022">t</span>&nbsp;<span class="op" id="7581024">*</span><span class="ident" id="7581025">testing</span><span class="op" id="7581032">.</span><span class="ident" id="7581033">T</span><span class="op" id="7581034">)</span>&nbsp;<span class="op" id="7581036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581039">if</span>&nbsp;<span class="ident" id="7581042">testing</span><span class="op" id="7581049">.</span><span class="ident" id="7581050">Short</span><span class="op" id="7581055">(</span><span class="op" id="7581056">)</span>&nbsp;<span class="op" id="7581058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581062">t</span><span class="op" id="7581063">.</span><span class="ident" id="7581064">Skip</span><span class="op" id="7581068">(</span><span class="string" id="7581069">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="7581110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581113">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581116">switch</span>&nbsp;<span class="ident" id="7581123">runtime</span><span class="op" id="7581130">.</span><span class="ident" id="7581131">GOOS</span>&nbsp;<span class="op" id="7581136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581139">case</span>&nbsp;<span class="string" id="7581144">&#34;plan9&#34;</span><span class="op" id="7581151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581155">t</span><span class="op" id="7581156">.</span><span class="ident" id="7581157">Skipf</span><span class="op" id="7581162">(</span><span class="string" id="7581163">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7581184">,</span>&nbsp;<span class="ident" id="7581186">runtime</span><span class="op" id="7581193">.</span><span class="ident" id="7581194">GOOS</span><span class="op" id="7581198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581204">if</span>&nbsp;<span class="op" id="7581207">!</span><span class="ident" id="7581208">supportsIPv6</span>&nbsp;<span class="op" id="7581221">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581225">t</span><span class="op" id="7581226">.</span><span class="ident" id="7581227">Skip</span><span class="op" id="7581231">(</span><span class="string" id="7581232">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7581255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581262">for</span>&nbsp;<span class="ident" id="7581266">_</span><span class="op" id="7581267">,</span>&nbsp;<span class="ident" id="7581269">tt</span>&nbsp;<span class="op" id="7581272">:=</span>&nbsp;<span class="keyword" id="7581275">range</span>&nbsp;<span class="ident" id="7581281">dualStackListenerTests</span>&nbsp;<span class="op" id="7581304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581308">if</span>&nbsp;<span class="ident" id="7581311">tt</span><span class="op" id="7581313">.</span><span class="ident" id="7581314">wildcard</span>&nbsp;<span class="op" id="7581323">&amp;&amp;</span>&nbsp;<span class="op" id="7581326">!</span><span class="op" id="7581327">*</span><span class="ident" id="7581328">testExternal</span>&nbsp;<span class="op" id="7581341">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581346">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581361">switch</span>&nbsp;<span class="ident" id="7581368">runtime</span><span class="op" id="7581375">.</span><span class="ident" id="7581376">GOOS</span>&nbsp;<span class="op" id="7581381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581385">case</span>&nbsp;<span class="string" id="7581390">&#34;openbsd&#34;</span><span class="op" id="7581399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581404">if</span>&nbsp;<span class="ident" id="7581407">tt</span><span class="op" id="7581409">.</span><span class="ident" id="7581410">wildcard</span>&nbsp;<span class="op" id="7581419">&amp;&amp;</span>&nbsp;<span class="ident" id="7581422">differentWildcardAddr</span><span class="op" id="7581443">(</span><span class="ident" id="7581444">tt</span><span class="op" id="7581446">.</span><span class="ident" id="7581447">laddr1</span><span class="op" id="7581453">,</span>&nbsp;<span class="ident" id="7581455">tt</span><span class="op" id="7581457">.</span><span class="ident" id="7581458">laddr2</span><span class="op" id="7581464">)</span>&nbsp;<span class="op" id="7581466">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581472">tt</span><span class="op" id="7581474">.</span><span class="ident" id="7581475">xerr</span>&nbsp;<span class="op" id="7581480">=</span>&nbsp;<span class="ident" id="7581482">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581497">l1</span><span class="op" id="7581499">,</span>&nbsp;<span class="ident" id="7581501">port</span>&nbsp;<span class="op" id="7581506">:=</span>&nbsp;<span class="ident" id="7581509">usableListenPort</span><span class="op" id="7581525">(</span><span class="ident" id="7581526">t</span><span class="op" id="7581527">,</span>&nbsp;<span class="ident" id="7581529">tt</span><span class="op" id="7581531">.</span><span class="ident" id="7581532">net1</span><span class="op" id="7581536">,</span>&nbsp;<span class="ident" id="7581538">tt</span><span class="op" id="7581540">.</span><span class="ident" id="7581541">laddr1</span><span class="op" id="7581547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581551">laddr</span>&nbsp;<span class="op" id="7581557">:=</span>&nbsp;<span class="ident" id="7581560">tt</span><span class="op" id="7581562">.</span><span class="ident" id="7581563">laddr1</span>&nbsp;<span class="op" id="7581570">+</span>&nbsp;<span class="string" id="7581572">&#34;:&#34;</span>&nbsp;<span class="op" id="7581576">+</span>&nbsp;<span class="ident" id="7581578">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581585">checkFirstListener</span><span class="op" id="7581603">(</span><span class="ident" id="7581604">t</span><span class="op" id="7581605">,</span>&nbsp;<span class="ident" id="7581607">tt</span><span class="op" id="7581609">.</span><span class="ident" id="7581610">net1</span><span class="op" id="7581614">,</span>&nbsp;<span class="ident" id="7581616">laddr</span><span class="op" id="7581621">,</span>&nbsp;<span class="ident" id="7581623">l1</span><span class="op" id="7581625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581629">laddr</span>&nbsp;<span class="op" id="7581635">=</span>&nbsp;<span class="ident" id="7581637">tt</span><span class="op" id="7581639">.</span><span class="ident" id="7581640">laddr2</span>&nbsp;<span class="op" id="7581647">+</span>&nbsp;<span class="string" id="7581649">&#34;:&#34;</span>&nbsp;<span class="op" id="7581653">+</span>&nbsp;<span class="ident" id="7581655">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581662">l2</span><span class="op" id="7581664">,</span>&nbsp;<span class="ident" id="7581666">err</span>&nbsp;<span class="op" id="7581670">:=</span>&nbsp;<span class="ident" id="7581673">Listen</span><span class="op" id="7581679">(</span><span class="ident" id="7581680">tt</span><span class="op" id="7581682">.</span><span class="ident" id="7581683">net2</span><span class="op" id="7581687">,</span>&nbsp;<span class="ident" id="7581689">laddr</span><span class="op" id="7581694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581698">checkDualStackSecondListener</span><span class="op" id="7581726">(</span><span class="ident" id="7581727">t</span><span class="op" id="7581728">,</span>&nbsp;<span class="ident" id="7581730">tt</span><span class="op" id="7581732">.</span><span class="ident" id="7581733">net2</span><span class="op" id="7581737">,</span>&nbsp;<span class="ident" id="7581739">laddr</span><span class="op" id="7581744">,</span>&nbsp;<span class="ident" id="7581746">tt</span><span class="op" id="7581748">.</span><span class="ident" id="7581749">xerr</span><span class="op" id="7581753">,</span>&nbsp;<span class="ident" id="7581755">err</span><span class="op" id="7581758">,</span>&nbsp;<span class="ident" id="7581760">l2</span><span class="op" id="7581762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581766">l1</span><span class="op" id="7581768">.</span><span class="ident" id="7581769">Close</span><span class="op" id="7581774">(</span><span class="op" id="7581775">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581778">}</span><br>
<span class="lineno"></span><span class="op" id="7581780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7581783">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="7581847">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="7581910">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7581946">func</span>&nbsp;<span class="ident" id="7581951">TestDualStackUDPListener</span><span class="op" id="7581975">(</span><span class="ident" id="7581976">t</span>&nbsp;<span class="op" id="7581978">*</span><span class="ident" id="7581979">testing</span><span class="op" id="7581986">.</span><span class="ident" id="7581987">T</span><span class="op" id="7581988">)</span>&nbsp;<span class="op" id="7581990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581993">if</span>&nbsp;<span class="ident" id="7581996">testing</span><span class="op" id="7582003">.</span><span class="ident" id="7582004">Short</span><span class="op" id="7582009">(</span><span class="op" id="7582010">)</span>&nbsp;<span class="op" id="7582012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582016">t</span><span class="op" id="7582017">.</span><span class="ident" id="7582018">Skip</span><span class="op" id="7582022">(</span><span class="string" id="7582023">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="7582064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582067">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582070">switch</span>&nbsp;<span class="ident" id="7582077">runtime</span><span class="op" id="7582084">.</span><span class="ident" id="7582085">GOOS</span>&nbsp;<span class="op" id="7582090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582093">case</span>&nbsp;<span class="string" id="7582098">&#34;plan9&#34;</span><span class="op" id="7582105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582109">t</span><span class="op" id="7582110">.</span><span class="ident" id="7582111">Skipf</span><span class="op" id="7582116">(</span><span class="string" id="7582117">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7582138">,</span>&nbsp;<span class="ident" id="7582140">runtime</span><span class="op" id="7582147">.</span><span class="ident" id="7582148">GOOS</span><span class="op" id="7582152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582158">if</span>&nbsp;<span class="op" id="7582161">!</span><span class="ident" id="7582162">supportsIPv6</span>&nbsp;<span class="op" id="7582175">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582179">t</span><span class="op" id="7582180">.</span><span class="ident" id="7582181">Skip</span><span class="op" id="7582185">(</span><span class="string" id="7582186">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7582209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582216">toudpnet</span>&nbsp;<span class="op" id="7582225">:=</span>&nbsp;<span class="keyword" id="7582228">func</span><span class="op" id="7582232">(</span><span class="ident" id="7582233">net</span>&nbsp;<span class="builtintype" id="7582237">string</span><span class="op" id="7582243">)</span>&nbsp;<span class="builtintype" id="7582245">string</span>&nbsp;<span class="op" id="7582252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582256">switch</span>&nbsp;<span class="ident" id="7582263">net</span>&nbsp;<span class="op" id="7582267">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582271">case</span>&nbsp;<span class="string" id="7582276">&#34;tcp&#34;</span><span class="op" id="7582281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582286">return</span>&nbsp;<span class="string" id="7582293">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582301">case</span>&nbsp;<span class="string" id="7582306">&#34;tcp4&#34;</span><span class="op" id="7582312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582317">return</span>&nbsp;<span class="string" id="7582324">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582333">case</span>&nbsp;<span class="string" id="7582338">&#34;tcp6&#34;</span><span class="op" id="7582344">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582349">return</span>&nbsp;<span class="string" id="7582356">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582369">return</span>&nbsp;<span class="string" id="7582376">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582389">for</span>&nbsp;<span class="ident" id="7582393">_</span><span class="op" id="7582394">,</span>&nbsp;<span class="ident" id="7582396">tt</span>&nbsp;<span class="op" id="7582399">:=</span>&nbsp;<span class="keyword" id="7582402">range</span>&nbsp;<span class="ident" id="7582408">dualStackListenerTests</span>&nbsp;<span class="op" id="7582431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582435">if</span>&nbsp;<span class="ident" id="7582438">tt</span><span class="op" id="7582440">.</span><span class="ident" id="7582441">wildcard</span>&nbsp;<span class="op" id="7582450">&amp;&amp;</span>&nbsp;<span class="op" id="7582453">(</span><span class="ident" id="7582454">testing</span><span class="op" id="7582461">.</span><span class="ident" id="7582462">Short</span><span class="op" id="7582467">(</span><span class="op" id="7582468">)</span>&nbsp;<span class="op" id="7582470">||</span>&nbsp;<span class="op" id="7582473">!</span><span class="op" id="7582474">*</span><span class="ident" id="7582475">testExternal</span><span class="op" id="7582487">)</span>&nbsp;<span class="op" id="7582489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582494">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582509">tt</span><span class="op" id="7582511">.</span><span class="ident" id="7582512">net1</span>&nbsp;<span class="op" id="7582517">=</span>&nbsp;<span class="ident" id="7582519">toudpnet</span><span class="op" id="7582527">(</span><span class="ident" id="7582528">tt</span><span class="op" id="7582530">.</span><span class="ident" id="7582531">net1</span><span class="op" id="7582535">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582539">tt</span><span class="op" id="7582541">.</span><span class="ident" id="7582542">net2</span>&nbsp;<span class="op" id="7582547">=</span>&nbsp;<span class="ident" id="7582549">toudpnet</span><span class="op" id="7582557">(</span><span class="ident" id="7582558">tt</span><span class="op" id="7582560">.</span><span class="ident" id="7582561">net2</span><span class="op" id="7582565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582569">switch</span>&nbsp;<span class="ident" id="7582576">runtime</span><span class="op" id="7582583">.</span><span class="ident" id="7582584">GOOS</span>&nbsp;<span class="op" id="7582589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582593">case</span>&nbsp;<span class="string" id="7582598">&#34;openbsd&#34;</span><span class="op" id="7582607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582612">if</span>&nbsp;<span class="ident" id="7582615">tt</span><span class="op" id="7582617">.</span><span class="ident" id="7582618">wildcard</span>&nbsp;<span class="op" id="7582627">&amp;&amp;</span>&nbsp;<span class="ident" id="7582630">differentWildcardAddr</span><span class="op" id="7582651">(</span><span class="ident" id="7582652">tt</span><span class="op" id="7582654">.</span><span class="ident" id="7582655">laddr1</span><span class="op" id="7582661">,</span>&nbsp;<span class="ident" id="7582663">tt</span><span class="op" id="7582665">.</span><span class="ident" id="7582666">laddr2</span><span class="op" id="7582672">)</span>&nbsp;<span class="op" id="7582674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582680">tt</span><span class="op" id="7582682">.</span><span class="ident" id="7582683">xerr</span>&nbsp;<span class="op" id="7582688">=</span>&nbsp;<span class="ident" id="7582690">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582705">l1</span><span class="op" id="7582707">,</span>&nbsp;<span class="ident" id="7582709">port</span>&nbsp;<span class="op" id="7582714">:=</span>&nbsp;<span class="ident" id="7582717">usableListenPacketPort</span><span class="op" id="7582739">(</span><span class="ident" id="7582740">t</span><span class="op" id="7582741">,</span>&nbsp;<span class="ident" id="7582743">tt</span><span class="op" id="7582745">.</span><span class="ident" id="7582746">net1</span><span class="op" id="7582750">,</span>&nbsp;<span class="ident" id="7582752">tt</span><span class="op" id="7582754">.</span><span class="ident" id="7582755">laddr1</span><span class="op" id="7582761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582765">laddr</span>&nbsp;<span class="op" id="7582771">:=</span>&nbsp;<span class="ident" id="7582774">tt</span><span class="op" id="7582776">.</span><span class="ident" id="7582777">laddr1</span>&nbsp;<span class="op" id="7582784">+</span>&nbsp;<span class="string" id="7582786">&#34;:&#34;</span>&nbsp;<span class="op" id="7582790">+</span>&nbsp;<span class="ident" id="7582792">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582799">checkFirstListener</span><span class="op" id="7582817">(</span><span class="ident" id="7582818">t</span><span class="op" id="7582819">,</span>&nbsp;<span class="ident" id="7582821">tt</span><span class="op" id="7582823">.</span><span class="ident" id="7582824">net1</span><span class="op" id="7582828">,</span>&nbsp;<span class="ident" id="7582830">laddr</span><span class="op" id="7582835">,</span>&nbsp;<span class="ident" id="7582837">l1</span><span class="op" id="7582839">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582843">laddr</span>&nbsp;<span class="op" id="7582849">=</span>&nbsp;<span class="ident" id="7582851">tt</span><span class="op" id="7582853">.</span><span class="ident" id="7582854">laddr2</span>&nbsp;<span class="op" id="7582861">+</span>&nbsp;<span class="string" id="7582863">&#34;:&#34;</span>&nbsp;<span class="op" id="7582867">+</span>&nbsp;<span class="ident" id="7582869">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582876">l2</span><span class="op" id="7582878">,</span>&nbsp;<span class="ident" id="7582880">err</span>&nbsp;<span class="op" id="7582884">:=</span>&nbsp;<span class="ident" id="7582887">ListenPacket</span><span class="op" id="7582899">(</span><span class="ident" id="7582900">tt</span><span class="op" id="7582902">.</span><span class="ident" id="7582903">net2</span><span class="op" id="7582907">,</span>&nbsp;<span class="ident" id="7582909">laddr</span><span class="op" id="7582914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582918">checkDualStackSecondListener</span><span class="op" id="7582946">(</span><span class="ident" id="7582947">t</span><span class="op" id="7582948">,</span>&nbsp;<span class="ident" id="7582950">tt</span><span class="op" id="7582952">.</span><span class="ident" id="7582953">net2</span><span class="op" id="7582957">,</span>&nbsp;<span class="ident" id="7582959">laddr</span><span class="op" id="7582964">,</span>&nbsp;<span class="ident" id="7582966">tt</span><span class="op" id="7582968">.</span><span class="ident" id="7582969">xerr</span><span class="op" id="7582973">,</span>&nbsp;<span class="ident" id="7582975">err</span><span class="op" id="7582978">,</span>&nbsp;<span class="ident" id="7582980">l2</span><span class="op" id="7582982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582986">l1</span><span class="op" id="7582988">.</span><span class="ident" id="7582989">Close</span><span class="op" id="7582994">(</span><span class="op" id="7582995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582998">}</span><br>
<span class="lineno">250</span><span class="op" id="7583000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7583003">func</span>&nbsp;<span class="ident" id="7583008">usableListenPort</span><span class="op" id="7583024">(</span><span class="ident" id="7583025">t</span>&nbsp;<span class="op" id="7583027">*</span><span class="ident" id="7583028">testing</span><span class="op" id="7583035">.</span><span class="ident" id="7583036">T</span><span class="op" id="7583037">,</span>&nbsp;<span class="ident" id="7583039">net</span><span class="op" id="7583042">,</span>&nbsp;<span class="ident" id="7583044">laddr</span>&nbsp;<span class="builtintype" id="7583050">string</span><span class="op" id="7583056">)</span>&nbsp;<span class="op" id="7583058">(</span><span class="ident" id="7583059">l</span>&nbsp;<span class="ident" id="7583061">Listener</span><span class="op" id="7583069">,</span>&nbsp;<span class="ident" id="7583071">port</span>&nbsp;<span class="builtintype" id="7583076">string</span><span class="op" id="7583082">)</span>&nbsp;<span class="op" id="7583084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583087">var</span>&nbsp;<span class="ident" id="7583091">nladdr</span>&nbsp;<span class="builtintype" id="7583098">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583106">var</span>&nbsp;<span class="ident" id="7583110">err</span>&nbsp;<span class="builtintype" id="7583114">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583121">switch</span>&nbsp;<span class="ident" id="7583128">net</span>&nbsp;<span class="op" id="7583132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583135">default</span><span class="op" id="7583142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7583146">panic</span><span class="op" id="7583151">(</span><span class="string" id="7583152">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="7583176">+</span>&nbsp;<span class="ident" id="7583178">net</span><span class="op" id="7583181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583184">case</span>&nbsp;<span class="string" id="7583189">&#34;tcp&#34;</span><span class="op" id="7583194">,</span>&nbsp;<span class="string" id="7583196">&#34;tcp4&#34;</span><span class="op" id="7583202">,</span>&nbsp;<span class="string" id="7583204">&#34;tcp6&#34;</span><span class="op" id="7583210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583214">l</span><span class="op" id="7583215">,</span>&nbsp;<span class="ident" id="7583217">err</span>&nbsp;<span class="op" id="7583221">=</span>&nbsp;<span class="ident" id="7583223">Listen</span><span class="op" id="7583229">(</span><span class="ident" id="7583230">net</span><span class="op" id="7583233">,</span>&nbsp;<span class="ident" id="7583235">laddr</span><span class="op" id="7583240">+</span><span class="string" id="7583241">&#34;:0&#34;</span><span class="op" id="7583245">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583249">if</span>&nbsp;<span class="ident" id="7583252">err</span>&nbsp;<span class="op" id="7583256">!=</span>&nbsp;<span class="ident" id="7583259">nil</span>&nbsp;<span class="op" id="7583263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583268">t</span><span class="op" id="7583269">.</span><span class="ident" id="7583270">Fatalf</span><span class="op" id="7583276">(</span><span class="string" id="7583277">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7583310">,</span>&nbsp;<span class="ident" id="7583312">net</span><span class="op" id="7583315">,</span>&nbsp;<span class="ident" id="7583317">laddr</span><span class="op" id="7583322">,</span>&nbsp;<span class="ident" id="7583324">err</span><span class="op" id="7583327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583335">nladdr</span>&nbsp;<span class="op" id="7583342">=</span>&nbsp;<span class="ident" id="7583344">l</span><span class="op" id="7583345">.</span><span class="op" id="7583346">(</span><span class="op" id="7583347">*</span><span class="ident" id="7583348">TCPListener</span><span class="op" id="7583359">)</span><span class="op" id="7583360">.</span><span class="ident" id="7583361">Addr</span><span class="op" id="7583365">(</span><span class="op" id="7583366">)</span><span class="op" id="7583367">.</span><span class="ident" id="7583368">String</span><span class="op" id="7583374">(</span><span class="op" id="7583375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583378">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583381">_</span><span class="op" id="7583382">,</span>&nbsp;<span class="ident" id="7583384">port</span><span class="op" id="7583388">,</span>&nbsp;<span class="ident" id="7583390">err</span>&nbsp;<span class="op" id="7583394">=</span>&nbsp;<span class="ident" id="7583396">SplitHostPort</span><span class="op" id="7583409">(</span><span class="ident" id="7583410">nladdr</span><span class="op" id="7583416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583419">if</span>&nbsp;<span class="ident" id="7583422">err</span>&nbsp;<span class="op" id="7583426">!=</span>&nbsp;<span class="ident" id="7583429">nil</span>&nbsp;<span class="op" id="7583433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583437">t</span><span class="op" id="7583438">.</span><span class="ident" id="7583439">Fatalf</span><span class="op" id="7583445">(</span><span class="string" id="7583446">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7583472">,</span>&nbsp;<span class="ident" id="7583474">err</span><span class="op" id="7583477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583483">return</span>&nbsp;<span class="ident" id="7583490">l</span><span class="op" id="7583491">,</span>&nbsp;<span class="ident" id="7583493">port</span><br>
<span class="lineno">270</span><span class="op" id="7583498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7583501">func</span>&nbsp;<span class="ident" id="7583506">usableListenPacketPort</span><span class="op" id="7583528">(</span><span class="ident" id="7583529">t</span>&nbsp;<span class="op" id="7583531">*</span><span class="ident" id="7583532">testing</span><span class="op" id="7583539">.</span><span class="ident" id="7583540">T</span><span class="op" id="7583541">,</span>&nbsp;<span class="ident" id="7583543">net</span><span class="op" id="7583546">,</span>&nbsp;<span class="ident" id="7583548">laddr</span>&nbsp;<span class="builtintype" id="7583554">string</span><span class="op" id="7583560">)</span>&nbsp;<span class="op" id="7583562">(</span><span class="ident" id="7583563">l</span>&nbsp;<span class="ident" id="7583565">PacketConn</span><span class="op" id="7583575">,</span>&nbsp;<span class="ident" id="7583577">port</span>&nbsp;<span class="builtintype" id="7583582">string</span><span class="op" id="7583588">)</span>&nbsp;<span class="op" id="7583590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583593">var</span>&nbsp;<span class="ident" id="7583597">nladdr</span>&nbsp;<span class="builtintype" id="7583604">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583612">var</span>&nbsp;<span class="ident" id="7583616">err</span>&nbsp;<span class="builtintype" id="7583620">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583627">switch</span>&nbsp;<span class="ident" id="7583634">net</span>&nbsp;<span class="op" id="7583638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583641">default</span><span class="op" id="7583648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7583652">panic</span><span class="op" id="7583657">(</span><span class="string" id="7583658">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="7583688">+</span>&nbsp;<span class="ident" id="7583690">net</span><span class="op" id="7583693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583696">case</span>&nbsp;<span class="string" id="7583701">&#34;udp&#34;</span><span class="op" id="7583706">,</span>&nbsp;<span class="string" id="7583708">&#34;udp4&#34;</span><span class="op" id="7583714">,</span>&nbsp;<span class="string" id="7583716">&#34;udp6&#34;</span><span class="op" id="7583722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583726">l</span><span class="op" id="7583727">,</span>&nbsp;<span class="ident" id="7583729">err</span>&nbsp;<span class="op" id="7583733">=</span>&nbsp;<span class="ident" id="7583735">ListenPacket</span><span class="op" id="7583747">(</span><span class="ident" id="7583748">net</span><span class="op" id="7583751">,</span>&nbsp;<span class="ident" id="7583753">laddr</span><span class="op" id="7583758">+</span><span class="string" id="7583759">&#34;:0&#34;</span><span class="op" id="7583763">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583767">if</span>&nbsp;<span class="ident" id="7583770">err</span>&nbsp;<span class="op" id="7583774">!=</span>&nbsp;<span class="ident" id="7583777">nil</span>&nbsp;<span class="op" id="7583781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583786">t</span><span class="op" id="7583787">.</span><span class="ident" id="7583788">Fatalf</span><span class="op" id="7583794">(</span><span class="string" id="7583795">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7583834">,</span>&nbsp;<span class="ident" id="7583836">net</span><span class="op" id="7583839">,</span>&nbsp;<span class="ident" id="7583841">laddr</span><span class="op" id="7583846">,</span>&nbsp;<span class="ident" id="7583848">err</span><span class="op" id="7583851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583859">nladdr</span>&nbsp;<span class="op" id="7583866">=</span>&nbsp;<span class="ident" id="7583868">l</span><span class="op" id="7583869">.</span><span class="op" id="7583870">(</span><span class="op" id="7583871">*</span><span class="ident" id="7583872">UDPConn</span><span class="op" id="7583879">)</span><span class="op" id="7583880">.</span><span class="ident" id="7583881">LocalAddr</span><span class="op" id="7583890">(</span><span class="op" id="7583891">)</span><span class="op" id="7583892">.</span><span class="ident" id="7583893">String</span><span class="op" id="7583899">(</span><span class="op" id="7583900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583903">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583906">_</span><span class="op" id="7583907">,</span>&nbsp;<span class="ident" id="7583909">port</span><span class="op" id="7583913">,</span>&nbsp;<span class="ident" id="7583915">err</span>&nbsp;<span class="op" id="7583919">=</span>&nbsp;<span class="ident" id="7583921">SplitHostPort</span><span class="op" id="7583934">(</span><span class="ident" id="7583935">nladdr</span><span class="op" id="7583941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583944">if</span>&nbsp;<span class="ident" id="7583947">err</span>&nbsp;<span class="op" id="7583951">!=</span>&nbsp;<span class="ident" id="7583954">nil</span>&nbsp;<span class="op" id="7583958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583962">t</span><span class="op" id="7583963">.</span><span class="ident" id="7583964">Fatalf</span><span class="op" id="7583970">(</span><span class="string" id="7583971">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7583997">,</span>&nbsp;<span class="ident" id="7583999">err</span><span class="op" id="7584002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584008">return</span>&nbsp;<span class="ident" id="7584015">l</span><span class="op" id="7584016">,</span>&nbsp;<span class="ident" id="7584018">port</span><br>
<span class="lineno">290</span><span class="op" id="7584023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7584026">func</span>&nbsp;<span class="ident" id="7584031">differentWildcardAddr</span><span class="op" id="7584052">(</span><span class="ident" id="7584053">i</span><span class="op" id="7584054">,</span>&nbsp;<span class="ident" id="7584056">j</span>&nbsp;<span class="builtintype" id="7584058">string</span><span class="op" id="7584064">)</span>&nbsp;<span class="builtintype" id="7584066">bool</span>&nbsp;<span class="op" id="7584071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584074">if</span>&nbsp;<span class="op" id="7584077">(</span><span class="ident" id="7584078">i</span>&nbsp;<span class="op" id="7584080">==</span>&nbsp;<span class="string" id="7584083">&#34;&#34;</span>&nbsp;<span class="op" id="7584086">||</span>&nbsp;<span class="ident" id="7584089">i</span>&nbsp;<span class="op" id="7584091">==</span>&nbsp;<span class="string" id="7584094">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="7584104">||</span>&nbsp;<span class="ident" id="7584107">i</span>&nbsp;<span class="op" id="7584109">==</span>&nbsp;<span class="string" id="7584112">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="7584128">)</span>&nbsp;<span class="op" id="7584130">&amp;&amp;</span>&nbsp;<span class="op" id="7584133">(</span><span class="ident" id="7584134">j</span>&nbsp;<span class="op" id="7584136">==</span>&nbsp;<span class="string" id="7584139">&#34;&#34;</span>&nbsp;<span class="op" id="7584142">||</span>&nbsp;<span class="ident" id="7584145">j</span>&nbsp;<span class="op" id="7584147">==</span>&nbsp;<span class="string" id="7584150">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="7584160">||</span>&nbsp;<span class="ident" id="7584163">j</span>&nbsp;<span class="op" id="7584165">==</span>&nbsp;<span class="string" id="7584168">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="7584184">)</span>&nbsp;<span class="op" id="7584186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584190">return</span>&nbsp;<span class="ident" id="7584197">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584207">if</span>&nbsp;<span class="ident" id="7584210">i</span>&nbsp;<span class="op" id="7584212">==</span>&nbsp;<span class="string" id="7584215">&#34;[::]&#34;</span>&nbsp;<span class="op" id="7584222">&amp;&amp;</span>&nbsp;<span class="ident" id="7584225">j</span>&nbsp;<span class="op" id="7584227">==</span>&nbsp;<span class="string" id="7584230">&#34;[::]&#34;</span>&nbsp;<span class="op" id="7584237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584241">return</span>&nbsp;<span class="ident" id="7584248">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584258">return</span>&nbsp;<span class="ident" id="7584265">true</span><br>
<span class="lineno">300</span><span class="op" id="7584270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7584273">func</span>&nbsp;<span class="ident" id="7584278">checkFirstListener</span><span class="op" id="7584296">(</span><span class="ident" id="7584297">t</span>&nbsp;<span class="op" id="7584299">*</span><span class="ident" id="7584300">testing</span><span class="op" id="7584307">.</span><span class="ident" id="7584308">T</span><span class="op" id="7584309">,</span>&nbsp;<span class="ident" id="7584311">net</span><span class="op" id="7584314">,</span>&nbsp;<span class="ident" id="7584316">laddr</span>&nbsp;<span class="builtintype" id="7584322">string</span><span class="op" id="7584328">,</span>&nbsp;<span class="ident" id="7584330">l</span>&nbsp;<span class="keyword" id="7584332">interface</span><span class="op" id="7584341">{</span><span class="op" id="7584342">}</span><span class="op" id="7584343">)</span>&nbsp;<span class="op" id="7584345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584348">switch</span>&nbsp;<span class="ident" id="7584355">net</span>&nbsp;<span class="op" id="7584359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584362">case</span>&nbsp;<span class="string" id="7584367">&#34;tcp&#34;</span><span class="op" id="7584372">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584376">fd</span>&nbsp;<span class="op" id="7584379">:=</span>&nbsp;<span class="ident" id="7584382">l</span><span class="op" id="7584383">.</span><span class="op" id="7584384">(</span><span class="op" id="7584385">*</span><span class="ident" id="7584386">TCPListener</span><span class="op" id="7584397">)</span><span class="op" id="7584398">.</span><span class="ident" id="7584399">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584404">checkDualStackAddrFamily</span><span class="op" id="7584428">(</span><span class="ident" id="7584429">t</span><span class="op" id="7584430">,</span>&nbsp;<span class="ident" id="7584432">net</span><span class="op" id="7584435">,</span>&nbsp;<span class="ident" id="7584437">laddr</span><span class="op" id="7584442">,</span>&nbsp;<span class="ident" id="7584444">fd</span><span class="op" id="7584446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584449">case</span>&nbsp;<span class="string" id="7584454">&#34;tcp4&#34;</span><span class="op" id="7584460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584464">fd</span>&nbsp;<span class="op" id="7584467">:=</span>&nbsp;<span class="ident" id="7584470">l</span><span class="op" id="7584471">.</span><span class="op" id="7584472">(</span><span class="op" id="7584473">*</span><span class="ident" id="7584474">TCPListener</span><span class="op" id="7584485">)</span><span class="op" id="7584486">.</span><span class="ident" id="7584487">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584492">if</span>&nbsp;<span class="ident" id="7584495">fd</span><span class="op" id="7584497">.</span><span class="ident" id="7584498">family</span>&nbsp;<span class="op" id="7584505">!=</span>&nbsp;<span class="ident" id="7584508">syscall</span><span class="op" id="7584515">.</span><span class="ident" id="7584516">AF_INET</span>&nbsp;<span class="op" id="7584524">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584529">t</span><span class="op" id="7584530">.</span><span class="ident" id="7584531">Fatalf</span><span class="op" id="7584537">(</span><span class="string" id="7584538">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7584599">,</span>&nbsp;<span class="ident" id="7584601">net</span><span class="op" id="7584604">,</span>&nbsp;<span class="ident" id="7584606">laddr</span><span class="op" id="7584611">,</span>&nbsp;<span class="ident" id="7584613">fd</span><span class="op" id="7584615">.</span><span class="ident" id="7584616">family</span><span class="op" id="7584622">,</span>&nbsp;<span class="ident" id="7584624">syscall</span><span class="op" id="7584631">.</span><span class="ident" id="7584632">AF_INET</span><span class="op" id="7584639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584646">case</span>&nbsp;<span class="string" id="7584651">&#34;tcp6&#34;</span><span class="op" id="7584657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584661">fd</span>&nbsp;<span class="op" id="7584664">:=</span>&nbsp;<span class="ident" id="7584667">l</span><span class="op" id="7584668">.</span><span class="op" id="7584669">(</span><span class="op" id="7584670">*</span><span class="ident" id="7584671">TCPListener</span><span class="op" id="7584682">)</span><span class="op" id="7584683">.</span><span class="ident" id="7584684">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584689">if</span>&nbsp;<span class="ident" id="7584692">fd</span><span class="op" id="7584694">.</span><span class="ident" id="7584695">family</span>&nbsp;<span class="op" id="7584702">!=</span>&nbsp;<span class="ident" id="7584705">syscall</span><span class="op" id="7584712">.</span><span class="ident" id="7584713">AF_INET6</span>&nbsp;<span class="op" id="7584722">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584727">t</span><span class="op" id="7584728">.</span><span class="ident" id="7584729">Fatalf</span><span class="op" id="7584735">(</span><span class="string" id="7584736">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7584797">,</span>&nbsp;<span class="ident" id="7584799">net</span><span class="op" id="7584802">,</span>&nbsp;<span class="ident" id="7584804">laddr</span><span class="op" id="7584809">,</span>&nbsp;<span class="ident" id="7584811">fd</span><span class="op" id="7584813">.</span><span class="ident" id="7584814">family</span><span class="op" id="7584820">,</span>&nbsp;<span class="ident" id="7584822">syscall</span><span class="op" id="7584829">.</span><span class="ident" id="7584830">AF_INET6</span><span class="op" id="7584838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584845">case</span>&nbsp;<span class="string" id="7584850">&#34;udp&#34;</span><span class="op" id="7584855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584859">fd</span>&nbsp;<span class="op" id="7584862">:=</span>&nbsp;<span class="ident" id="7584865">l</span><span class="op" id="7584866">.</span><span class="op" id="7584867">(</span><span class="op" id="7584868">*</span><span class="ident" id="7584869">UDPConn</span><span class="op" id="7584876">)</span><span class="op" id="7584877">.</span><span class="ident" id="7584878">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584883">checkDualStackAddrFamily</span><span class="op" id="7584907">(</span><span class="ident" id="7584908">t</span><span class="op" id="7584909">,</span>&nbsp;<span class="ident" id="7584911">net</span><span class="op" id="7584914">,</span>&nbsp;<span class="ident" id="7584916">laddr</span><span class="op" id="7584921">,</span>&nbsp;<span class="ident" id="7584923">fd</span><span class="op" id="7584925">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584928">case</span>&nbsp;<span class="string" id="7584933">&#34;udp4&#34;</span><span class="op" id="7584939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584943">fd</span>&nbsp;<span class="op" id="7584946">:=</span>&nbsp;<span class="ident" id="7584949">l</span><span class="op" id="7584950">.</span><span class="op" id="7584951">(</span><span class="op" id="7584952">*</span><span class="ident" id="7584953">UDPConn</span><span class="op" id="7584960">)</span><span class="op" id="7584961">.</span><span class="ident" id="7584962">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584967">if</span>&nbsp;<span class="ident" id="7584970">fd</span><span class="op" id="7584972">.</span><span class="ident" id="7584973">family</span>&nbsp;<span class="op" id="7584980">!=</span>&nbsp;<span class="ident" id="7584983">syscall</span><span class="op" id="7584990">.</span><span class="ident" id="7584991">AF_INET</span>&nbsp;<span class="op" id="7584999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585004">t</span><span class="op" id="7585005">.</span><span class="ident" id="7585006">Fatalf</span><span class="op" id="7585012">(</span><span class="string" id="7585013">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7585080">,</span>&nbsp;<span class="ident" id="7585082">net</span><span class="op" id="7585085">,</span>&nbsp;<span class="ident" id="7585087">laddr</span><span class="op" id="7585092">,</span>&nbsp;<span class="ident" id="7585094">fd</span><span class="op" id="7585096">.</span><span class="ident" id="7585097">family</span><span class="op" id="7585103">,</span>&nbsp;<span class="ident" id="7585105">syscall</span><span class="op" id="7585112">.</span><span class="ident" id="7585113">AF_INET</span><span class="op" id="7585120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585124">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585127">case</span>&nbsp;<span class="string" id="7585132">&#34;udp6&#34;</span><span class="op" id="7585138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585142">fd</span>&nbsp;<span class="op" id="7585145">:=</span>&nbsp;<span class="ident" id="7585148">l</span><span class="op" id="7585149">.</span><span class="op" id="7585150">(</span><span class="op" id="7585151">*</span><span class="ident" id="7585152">UDPConn</span><span class="op" id="7585159">)</span><span class="op" id="7585160">.</span><span class="ident" id="7585161">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585166">if</span>&nbsp;<span class="ident" id="7585169">fd</span><span class="op" id="7585171">.</span><span class="ident" id="7585172">family</span>&nbsp;<span class="op" id="7585179">!=</span>&nbsp;<span class="ident" id="7585182">syscall</span><span class="op" id="7585189">.</span><span class="ident" id="7585190">AF_INET6</span>&nbsp;<span class="op" id="7585199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585204">t</span><span class="op" id="7585205">.</span><span class="ident" id="7585206">Fatalf</span><span class="op" id="7585212">(</span><span class="string" id="7585213">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7585280">,</span>&nbsp;<span class="ident" id="7585282">net</span><span class="op" id="7585285">,</span>&nbsp;<span class="ident" id="7585287">laddr</span><span class="op" id="7585292">,</span>&nbsp;<span class="ident" id="7585294">fd</span><span class="op" id="7585296">.</span><span class="ident" id="7585297">family</span><span class="op" id="7585303">,</span>&nbsp;<span class="ident" id="7585305">syscall</span><span class="op" id="7585312">.</span><span class="ident" id="7585313">AF_INET6</span><span class="op" id="7585321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585325">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585328">default</span><span class="op" id="7585335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585339">t</span><span class="op" id="7585340">.</span><span class="ident" id="7585341">Fatalf</span><span class="op" id="7585347">(</span><span class="string" id="7585348">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7585372">,</span>&nbsp;<span class="ident" id="7585374">net</span><span class="op" id="7585377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585380">}</span><br>
<span class="lineno"></span><span class="op" id="7585382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7585385">func</span>&nbsp;<span class="ident" id="7585390">checkSecondListener</span><span class="op" id="7585409">(</span><span class="ident" id="7585410">t</span>&nbsp;<span class="op" id="7585412">*</span><span class="ident" id="7585413">testing</span><span class="op" id="7585420">.</span><span class="ident" id="7585421">T</span><span class="op" id="7585422">,</span>&nbsp;<span class="ident" id="7585424">net</span><span class="op" id="7585427">,</span>&nbsp;<span class="ident" id="7585429">laddr</span>&nbsp;<span class="builtintype" id="7585435">string</span><span class="op" id="7585441">,</span>&nbsp;<span class="ident" id="7585443">err</span>&nbsp;<span class="builtintype" id="7585447">error</span><span class="op" id="7585452">,</span>&nbsp;<span class="ident" id="7585454">l</span>&nbsp;<span class="keyword" id="7585456">interface</span><span class="op" id="7585465">{</span><span class="op" id="7585466">}</span><span class="op" id="7585467">)</span>&nbsp;<span class="op" id="7585469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585472">switch</span>&nbsp;<span class="ident" id="7585479">net</span>&nbsp;<span class="op" id="7585483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585486">case</span>&nbsp;<span class="string" id="7585491">&#34;tcp&#34;</span><span class="op" id="7585496">,</span>&nbsp;<span class="string" id="7585498">&#34;tcp4&#34;</span><span class="op" id="7585504">,</span>&nbsp;<span class="string" id="7585506">&#34;tcp6&#34;</span><span class="op" id="7585512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585516">if</span>&nbsp;<span class="ident" id="7585519">err</span>&nbsp;<span class="op" id="7585523">==</span>&nbsp;<span class="ident" id="7585526">nil</span>&nbsp;<span class="op" id="7585530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585535">l</span><span class="op" id="7585536">.</span><span class="op" id="7585537">(</span><span class="op" id="7585538">*</span><span class="ident" id="7585539">TCPListener</span><span class="op" id="7585550">)</span><span class="op" id="7585551">.</span><span class="ident" id="7585552">Close</span><span class="op" id="7585557">(</span><span class="op" id="7585558">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585563">t</span><span class="op" id="7585564">.</span><span class="ident" id="7585565">Fatalf</span><span class="op" id="7585571">(</span><span class="string" id="7585572">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7585607">,</span>&nbsp;<span class="ident" id="7585609">net</span><span class="op" id="7585612">,</span>&nbsp;<span class="ident" id="7585614">laddr</span><span class="op" id="7585619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585626">case</span>&nbsp;<span class="string" id="7585631">&#34;udp&#34;</span><span class="op" id="7585636">,</span>&nbsp;<span class="string" id="7585638">&#34;udp4&#34;</span><span class="op" id="7585644">,</span>&nbsp;<span class="string" id="7585646">&#34;udp6&#34;</span><span class="op" id="7585652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585656">if</span>&nbsp;<span class="ident" id="7585659">err</span>&nbsp;<span class="op" id="7585663">==</span>&nbsp;<span class="ident" id="7585666">nil</span>&nbsp;<span class="op" id="7585670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585675">l</span><span class="op" id="7585676">.</span><span class="op" id="7585677">(</span><span class="op" id="7585678">*</span><span class="ident" id="7585679">UDPConn</span><span class="op" id="7585686">)</span><span class="op" id="7585687">.</span><span class="ident" id="7585688">Close</span><span class="op" id="7585693">(</span><span class="op" id="7585694">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585699">t</span><span class="op" id="7585700">.</span><span class="ident" id="7585701">Fatalf</span><span class="op" id="7585707">(</span><span class="string" id="7585708">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7585749">,</span>&nbsp;<span class="ident" id="7585751">net</span><span class="op" id="7585754">,</span>&nbsp;<span class="ident" id="7585756">laddr</span><span class="op" id="7585761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585768">default</span><span class="op" id="7585775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585779">t</span><span class="op" id="7585780">.</span><span class="ident" id="7585781">Fatalf</span><span class="op" id="7585787">(</span><span class="string" id="7585788">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7585812">,</span>&nbsp;<span class="ident" id="7585814">net</span><span class="op" id="7585817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585820">}</span><br>
<span class="lineno">350</span><span class="op" id="7585822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7585825">func</span>&nbsp;<span class="ident" id="7585830">checkDualStackSecondListener</span><span class="op" id="7585858">(</span><span class="ident" id="7585859">t</span>&nbsp;<span class="op" id="7585861">*</span><span class="ident" id="7585862">testing</span><span class="op" id="7585869">.</span><span class="ident" id="7585870">T</span><span class="op" id="7585871">,</span>&nbsp;<span class="ident" id="7585873">net</span><span class="op" id="7585876">,</span>&nbsp;<span class="ident" id="7585878">laddr</span>&nbsp;<span class="builtintype" id="7585884">string</span><span class="op" id="7585890">,</span>&nbsp;<span class="ident" id="7585892">xerr</span><span class="op" id="7585896">,</span>&nbsp;<span class="ident" id="7585898">err</span>&nbsp;<span class="builtintype" id="7585902">error</span><span class="op" id="7585907">,</span>&nbsp;<span class="ident" id="7585909">l</span>&nbsp;<span class="keyword" id="7585911">interface</span><span class="op" id="7585920">{</span><span class="op" id="7585921">}</span><span class="op" id="7585922">)</span>&nbsp;<span class="op" id="7585924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585927">switch</span>&nbsp;<span class="ident" id="7585934">net</span>&nbsp;<span class="op" id="7585938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585941">case</span>&nbsp;<span class="string" id="7585946">&#34;tcp&#34;</span><span class="op" id="7585951">,</span>&nbsp;<span class="string" id="7585953">&#34;tcp4&#34;</span><span class="op" id="7585959">,</span>&nbsp;<span class="string" id="7585961">&#34;tcp6&#34;</span><span class="op" id="7585967">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585971">if</span>&nbsp;<span class="ident" id="7585974">xerr</span>&nbsp;<span class="op" id="7585979">==</span>&nbsp;<span class="ident" id="7585982">nil</span>&nbsp;<span class="op" id="7585986">&amp;&amp;</span>&nbsp;<span class="ident" id="7585989">err</span>&nbsp;<span class="op" id="7585993">!=</span>&nbsp;<span class="ident" id="7585996">nil</span>&nbsp;<span class="op" id="7586000">||</span>&nbsp;<span class="ident" id="7586003">xerr</span>&nbsp;<span class="op" id="7586008">!=</span>&nbsp;<span class="ident" id="7586011">nil</span>&nbsp;<span class="op" id="7586015">&amp;&amp;</span>&nbsp;<span class="ident" id="7586018">err</span>&nbsp;<span class="op" id="7586022">==</span>&nbsp;<span class="ident" id="7586025">nil</span>&nbsp;<span class="op" id="7586029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586034">t</span><span class="op" id="7586035">.</span><span class="ident" id="7586036">Fatalf</span><span class="op" id="7586042">(</span><span class="string" id="7586043">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7586090">,</span>&nbsp;<span class="ident" id="7586092">net</span><span class="op" id="7586095">,</span>&nbsp;<span class="ident" id="7586097">laddr</span><span class="op" id="7586102">,</span>&nbsp;<span class="ident" id="7586104">err</span><span class="op" id="7586107">,</span>&nbsp;<span class="ident" id="7586109">xerr</span><span class="op" id="7586113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586121">if</span>&nbsp;<span class="ident" id="7586124">err</span>&nbsp;<span class="op" id="7586128">==</span>&nbsp;<span class="ident" id="7586131">nil</span>&nbsp;<span class="op" id="7586135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586140">l</span><span class="op" id="7586141">.</span><span class="op" id="7586142">(</span><span class="op" id="7586143">*</span><span class="ident" id="7586144">TCPListener</span><span class="op" id="7586155">)</span><span class="op" id="7586156">.</span><span class="ident" id="7586157">Close</span><span class="op" id="7586162">(</span><span class="op" id="7586163">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586170">case</span>&nbsp;<span class="string" id="7586175">&#34;udp&#34;</span><span class="op" id="7586180">,</span>&nbsp;<span class="string" id="7586182">&#34;udp4&#34;</span><span class="op" id="7586188">,</span>&nbsp;<span class="string" id="7586190">&#34;udp6&#34;</span><span class="op" id="7586196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586200">if</span>&nbsp;<span class="ident" id="7586203">xerr</span>&nbsp;<span class="op" id="7586208">==</span>&nbsp;<span class="ident" id="7586211">nil</span>&nbsp;<span class="op" id="7586215">&amp;&amp;</span>&nbsp;<span class="ident" id="7586218">err</span>&nbsp;<span class="op" id="7586222">!=</span>&nbsp;<span class="ident" id="7586225">nil</span>&nbsp;<span class="op" id="7586229">||</span>&nbsp;<span class="ident" id="7586232">xerr</span>&nbsp;<span class="op" id="7586237">!=</span>&nbsp;<span class="ident" id="7586240">nil</span>&nbsp;<span class="op" id="7586244">&amp;&amp;</span>&nbsp;<span class="ident" id="7586247">err</span>&nbsp;<span class="op" id="7586251">==</span>&nbsp;<span class="ident" id="7586254">nil</span>&nbsp;<span class="op" id="7586258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586263">t</span><span class="op" id="7586264">.</span><span class="ident" id="7586265">Fatalf</span><span class="op" id="7586271">(</span><span class="string" id="7586272">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7586325">,</span>&nbsp;<span class="ident" id="7586327">net</span><span class="op" id="7586330">,</span>&nbsp;<span class="ident" id="7586332">laddr</span><span class="op" id="7586337">,</span>&nbsp;<span class="ident" id="7586339">err</span><span class="op" id="7586342">,</span>&nbsp;<span class="ident" id="7586344">xerr</span><span class="op" id="7586348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586352">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586356">if</span>&nbsp;<span class="ident" id="7586359">err</span>&nbsp;<span class="op" id="7586363">==</span>&nbsp;<span class="ident" id="7586366">nil</span>&nbsp;<span class="op" id="7586370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586375">l</span><span class="op" id="7586376">.</span><span class="op" id="7586377">(</span><span class="op" id="7586378">*</span><span class="ident" id="7586379">UDPConn</span><span class="op" id="7586386">)</span><span class="op" id="7586387">.</span><span class="ident" id="7586388">Close</span><span class="op" id="7586393">(</span><span class="op" id="7586394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586401">default</span><span class="op" id="7586408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586412">t</span><span class="op" id="7586413">.</span><span class="ident" id="7586414">Fatalf</span><span class="op" id="7586420">(</span><span class="string" id="7586421">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7586445">,</span>&nbsp;<span class="ident" id="7586447">net</span><span class="op" id="7586450">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586453">}</span><br>
<span class="lineno"></span><span class="op" id="7586455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7586458">func</span>&nbsp;<span class="ident" id="7586463">checkDualStackAddrFamily</span><span class="op" id="7586487">(</span><span class="ident" id="7586488">t</span>&nbsp;<span class="op" id="7586490">*</span><span class="ident" id="7586491">testing</span><span class="op" id="7586498">.</span><span class="ident" id="7586499">T</span><span class="op" id="7586500">,</span>&nbsp;<span class="ident" id="7586502">net</span><span class="op" id="7586505">,</span>&nbsp;<span class="ident" id="7586507">laddr</span>&nbsp;<span class="builtintype" id="7586513">string</span><span class="op" id="7586519">,</span>&nbsp;<span class="ident" id="7586521">fd</span>&nbsp;<span class="op" id="7586524">*</span><span class="ident" id="7586525">netFD</span><span class="op" id="7586530">)</span>&nbsp;<span class="op" id="7586532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586535">switch</span>&nbsp;<span class="ident" id="7586542">a</span>&nbsp;<span class="op" id="7586544">:=</span>&nbsp;<span class="ident" id="7586547">fd</span><span class="op" id="7586549">.</span><span class="ident" id="7586550">laddr</span><span class="op" id="7586555">.</span><span class="op" id="7586556">(</span><span class="keyword" id="7586557">type</span><span class="op" id="7586561">)</span>&nbsp;<span class="op" id="7586563">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586566">case</span>&nbsp;<span class="op" id="7586571">*</span><span class="ident" id="7586572">TCPAddr</span><span class="op" id="7586579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7586583">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7586639">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7586692">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7586749">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586771">if</span>&nbsp;<span class="ident" id="7586774">supportsIPv4map</span>&nbsp;<span class="op" id="7586790">&amp;&amp;</span>&nbsp;<span class="ident" id="7586793">fd</span><span class="op" id="7586795">.</span><span class="ident" id="7586796">laddr</span><span class="op" id="7586801">.</span><span class="op" id="7586802">(</span><span class="op" id="7586803">*</span><span class="ident" id="7586804">TCPAddr</span><span class="op" id="7586811">)</span><span class="op" id="7586812">.</span><span class="ident" id="7586813">isWildcard</span><span class="op" id="7586823">(</span><span class="op" id="7586824">)</span>&nbsp;<span class="op" id="7586826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586831">if</span>&nbsp;<span class="ident" id="7586834">fd</span><span class="op" id="7586836">.</span><span class="ident" id="7586837">family</span>&nbsp;<span class="op" id="7586844">!=</span>&nbsp;<span class="ident" id="7586847">syscall</span><span class="op" id="7586854">.</span><span class="ident" id="7586855">AF_INET6</span>&nbsp;<span class="op" id="7586864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586870">t</span><span class="op" id="7586871">.</span><span class="ident" id="7586872">Fatalf</span><span class="op" id="7586878">(</span><span class="string" id="7586879">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7586934">,</span>&nbsp;<span class="ident" id="7586936">net</span><span class="op" id="7586939">,</span>&nbsp;<span class="ident" id="7586941">laddr</span><span class="op" id="7586946">,</span>&nbsp;<span class="ident" id="7586948">fd</span><span class="op" id="7586950">.</span><span class="ident" id="7586951">family</span><span class="op" id="7586957">,</span>&nbsp;<span class="ident" id="7586959">syscall</span><span class="op" id="7586966">.</span><span class="ident" id="7586967">AF_INET6</span><span class="op" id="7586975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586984">}</span>&nbsp;<span class="keyword" id="7586986">else</span>&nbsp;<span class="op" id="7586991">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586996">if</span>&nbsp;<span class="ident" id="7586999">fd</span><span class="op" id="7587001">.</span><span class="ident" id="7587002">family</span>&nbsp;<span class="op" id="7587009">!=</span>&nbsp;<span class="ident" id="7587012">a</span><span class="op" id="7587013">.</span><span class="ident" id="7587014">family</span><span class="op" id="7587020">(</span><span class="op" id="7587021">)</span>&nbsp;<span class="op" id="7587023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587029">t</span><span class="op" id="7587030">.</span><span class="ident" id="7587031">Fatalf</span><span class="op" id="7587037">(</span><span class="string" id="7587038">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7587093">,</span>&nbsp;<span class="ident" id="7587095">net</span><span class="op" id="7587098">,</span>&nbsp;<span class="ident" id="7587100">laddr</span><span class="op" id="7587105">,</span>&nbsp;<span class="ident" id="7587107">fd</span><span class="op" id="7587109">.</span><span class="ident" id="7587110">family</span><span class="op" id="7587116">,</span>&nbsp;<span class="ident" id="7587118">a</span><span class="op" id="7587119">.</span><span class="ident" id="7587120">family</span><span class="op" id="7587126">(</span><span class="op" id="7587127">)</span><span class="op" id="7587128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587140">case</span>&nbsp;<span class="op" id="7587145">*</span><span class="ident" id="7587146">UDPAddr</span><span class="op" id="7587153">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7587157">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7587213">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7587266">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7587323">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587345">if</span>&nbsp;<span class="ident" id="7587348">supportsIPv4map</span>&nbsp;<span class="op" id="7587364">&amp;&amp;</span>&nbsp;<span class="ident" id="7587367">fd</span><span class="op" id="7587369">.</span><span class="ident" id="7587370">laddr</span><span class="op" id="7587375">.</span><span class="op" id="7587376">(</span><span class="op" id="7587377">*</span><span class="ident" id="7587378">UDPAddr</span><span class="op" id="7587385">)</span><span class="op" id="7587386">.</span><span class="ident" id="7587387">isWildcard</span><span class="op" id="7587397">(</span><span class="op" id="7587398">)</span>&nbsp;<span class="op" id="7587400">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587405">if</span>&nbsp;<span class="ident" id="7587408">fd</span><span class="op" id="7587410">.</span><span class="ident" id="7587411">family</span>&nbsp;<span class="op" id="7587418">!=</span>&nbsp;<span class="ident" id="7587421">syscall</span><span class="op" id="7587428">.</span><span class="ident" id="7587429">AF_INET6</span>&nbsp;<span class="op" id="7587438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587444">t</span><span class="op" id="7587445">.</span><span class="ident" id="7587446">Fatalf</span><span class="op" id="7587452">(</span><span class="string" id="7587453">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7587514">,</span>&nbsp;<span class="ident" id="7587516">net</span><span class="op" id="7587519">,</span>&nbsp;<span class="ident" id="7587521">laddr</span><span class="op" id="7587526">,</span>&nbsp;<span class="ident" id="7587528">fd</span><span class="op" id="7587530">.</span><span class="ident" id="7587531">family</span><span class="op" id="7587537">,</span>&nbsp;<span class="ident" id="7587539">syscall</span><span class="op" id="7587546">.</span><span class="ident" id="7587547">AF_INET6</span><span class="op" id="7587555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587564">}</span>&nbsp;<span class="keyword" id="7587566">else</span>&nbsp;<span class="op" id="7587571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587576">if</span>&nbsp;<span class="ident" id="7587579">fd</span><span class="op" id="7587581">.</span><span class="ident" id="7587582">family</span>&nbsp;<span class="op" id="7587589">!=</span>&nbsp;<span class="ident" id="7587592">a</span><span class="op" id="7587593">.</span><span class="ident" id="7587594">family</span><span class="op" id="7587600">(</span><span class="op" id="7587601">)</span>&nbsp;<span class="op" id="7587603">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587609">t</span><span class="op" id="7587610">.</span><span class="ident" id="7587611">Fatalf</span><span class="op" id="7587617">(</span><span class="string" id="7587618">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7587679">,</span>&nbsp;<span class="ident" id="7587681">net</span><span class="op" id="7587684">,</span>&nbsp;<span class="ident" id="7587686">laddr</span><span class="op" id="7587691">,</span>&nbsp;<span class="ident" id="7587693">fd</span><span class="op" id="7587695">.</span><span class="ident" id="7587696">family</span><span class="op" id="7587702">,</span>&nbsp;<span class="ident" id="7587704">a</span><span class="op" id="7587705">.</span><span class="ident" id="7587706">family</span><span class="op" id="7587712">(</span><span class="op" id="7587713">)</span><span class="op" id="7587714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587726">default</span><span class="op" id="7587733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587737">t</span><span class="op" id="7587738">.</span><span class="ident" id="7587739">Fatalf</span><span class="op" id="7587745">(</span><span class="string" id="7587746">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="7587784">,</span>&nbsp;<span class="ident" id="7587786">a</span><span class="op" id="7587787">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587790">}</span><br>
<span class="lineno"></span><span class="op" id="7587792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7587795">var</span>&nbsp;<span class="ident" id="7587799">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="7587826">=</span>&nbsp;<span class="op" id="7587828">[</span><span class="op" id="7587829">]</span><span class="keyword" id="7587830">struct</span>&nbsp;<span class="op" id="7587837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587840">net</span>&nbsp;&nbsp;<span class="builtintype" id="7587845">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587853">addr</span>&nbsp;<span class="builtintype" id="7587858">string</span><br>
<span class="lineno"></span><span class="op" id="7587865">}</span><span class="op" id="7587866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587869">{</span><span class="string" id="7587870">&#34;tcp6&#34;</span><span class="op" id="7587876">,</span>&nbsp;<span class="string" id="7587878">&#34;127.0.0.1&#34;</span><span class="op" id="7587889">}</span><span class="op" id="7587890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587893">{</span><span class="string" id="7587894">&#34;tcp6&#34;</span><span class="op" id="7587900">,</span>&nbsp;<span class="string" id="7587902">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7587922">}</span><span class="op" id="7587923">,</span><br>
<span class="lineno"></span><span class="op" id="7587925">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="7587928">func</span>&nbsp;<span class="ident" id="7587933">TestProhibitionaryDialArgs</span><span class="op" id="7587959">(</span><span class="ident" id="7587960">t</span>&nbsp;<span class="op" id="7587962">*</span><span class="ident" id="7587963">testing</span><span class="op" id="7587970">.</span><span class="ident" id="7587971">T</span><span class="op" id="7587972">)</span>&nbsp;<span class="op" id="7587974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587977">switch</span>&nbsp;<span class="ident" id="7587984">runtime</span><span class="op" id="7587991">.</span><span class="ident" id="7587992">GOOS</span>&nbsp;<span class="op" id="7587997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588000">case</span>&nbsp;<span class="string" id="7588005">&#34;plan9&#34;</span><span class="op" id="7588012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588016">t</span><span class="op" id="7588017">.</span><span class="ident" id="7588018">Skipf</span><span class="op" id="7588023">(</span><span class="string" id="7588024">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7588045">,</span>&nbsp;<span class="ident" id="7588047">runtime</span><span class="op" id="7588054">.</span><span class="ident" id="7588055">GOOS</span><span class="op" id="7588059">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7588065">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588135">if</span>&nbsp;<span class="op" id="7588138">!</span><span class="ident" id="7588139">supportsIPv4map</span>&nbsp;<span class="op" id="7588155">||</span>&nbsp;<span class="ident" id="7588158">testing</span><span class="op" id="7588165">.</span><span class="ident" id="7588166">Short</span><span class="op" id="7588171">(</span><span class="op" id="7588172">)</span>&nbsp;<span class="op" id="7588174">||</span>&nbsp;<span class="op" id="7588177">!</span><span class="op" id="7588178">*</span><span class="ident" id="7588179">testExternal</span>&nbsp;<span class="op" id="7588192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588196">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588204">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588208">l</span><span class="op" id="7588209">,</span>&nbsp;<span class="ident" id="7588211">port</span>&nbsp;<span class="op" id="7588216">:=</span>&nbsp;<span class="ident" id="7588219">usableListenPort</span><span class="op" id="7588235">(</span><span class="ident" id="7588236">t</span><span class="op" id="7588237">,</span>&nbsp;<span class="string" id="7588239">&#34;tcp&#34;</span><span class="op" id="7588244">,</span>&nbsp;<span class="string" id="7588246">&#34;[::]&#34;</span><span class="op" id="7588252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588255">defer</span>&nbsp;<span class="ident" id="7588261">l</span><span class="op" id="7588262">.</span><span class="ident" id="7588263">Close</span><span class="op" id="7588268">(</span><span class="op" id="7588269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588273">for</span>&nbsp;<span class="ident" id="7588277">_</span><span class="op" id="7588278">,</span>&nbsp;<span class="ident" id="7588280">tt</span>&nbsp;<span class="op" id="7588283">:=</span>&nbsp;<span class="keyword" id="7588286">range</span>&nbsp;<span class="ident" id="7588292">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="7588319">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588323">c</span><span class="op" id="7588324">,</span>&nbsp;<span class="ident" id="7588326">err</span>&nbsp;<span class="op" id="7588330">:=</span>&nbsp;<span class="ident" id="7588333">Dial</span><span class="op" id="7588337">(</span><span class="ident" id="7588338">tt</span><span class="op" id="7588340">.</span><span class="ident" id="7588341">net</span><span class="op" id="7588344">,</span>&nbsp;<span class="ident" id="7588346">tt</span><span class="op" id="7588348">.</span><span class="ident" id="7588349">addr</span><span class="op" id="7588353">+</span><span class="string" id="7588354">&#34;:&#34;</span><span class="op" id="7588357">+</span><span class="ident" id="7588358">port</span><span class="op" id="7588362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588366">if</span>&nbsp;<span class="ident" id="7588369">err</span>&nbsp;<span class="op" id="7588373">==</span>&nbsp;<span class="ident" id="7588376">nil</span>&nbsp;<span class="op" id="7588380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588385">c</span><span class="op" id="7588386">.</span><span class="ident" id="7588387">Close</span><span class="op" id="7588392">(</span><span class="op" id="7588393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588398">t</span><span class="op" id="7588399">.</span><span class="ident" id="7588400">Fatalf</span><span class="op" id="7588406">(</span><span class="string" id="7588407">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7588433">,</span>&nbsp;<span class="ident" id="7588435">tt</span><span class="op" id="7588437">.</span><span class="ident" id="7588438">net</span><span class="op" id="7588441">,</span>&nbsp;<span class="ident" id="7588443">tt</span><span class="op" id="7588445">.</span><span class="ident" id="7588446">addr</span><span class="op" id="7588450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588454">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588457">}</span><br>
<span class="lineno"></span><span class="op" id="7588459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7588462">func</span>&nbsp;<span class="ident" id="7588467">TestWildWildcardListener</span><span class="op" id="7588491">(</span><span class="ident" id="7588492">t</span>&nbsp;<span class="op" id="7588494">*</span><span class="ident" id="7588495">testing</span><span class="op" id="7588502">.</span><span class="ident" id="7588503">T</span><span class="op" id="7588504">)</span>&nbsp;<span class="op" id="7588506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588509">switch</span>&nbsp;<span class="ident" id="7588516">runtime</span><span class="op" id="7588523">.</span><span class="ident" id="7588524">GOOS</span>&nbsp;<span class="op" id="7588529">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588532">case</span>&nbsp;<span class="string" id="7588537">&#34;plan9&#34;</span><span class="op" id="7588544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588548">t</span><span class="op" id="7588549">.</span><span class="ident" id="7588550">Skipf</span><span class="op" id="7588555">(</span><span class="string" id="7588556">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7588577">,</span>&nbsp;<span class="ident" id="7588579">runtime</span><span class="op" id="7588586">.</span><span class="ident" id="7588587">GOOS</span><span class="op" id="7588591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588598">if</span>&nbsp;<span class="ident" id="7588601">testing</span><span class="op" id="7588608">.</span><span class="ident" id="7588609">Short</span><span class="op" id="7588614">(</span><span class="op" id="7588615">)</span>&nbsp;<span class="op" id="7588617">||</span>&nbsp;<span class="op" id="7588620">!</span><span class="op" id="7588621">*</span><span class="ident" id="7588622">testExternal</span>&nbsp;<span class="op" id="7588635">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588639">t</span><span class="op" id="7588640">.</span><span class="ident" id="7588641">Skip</span><span class="op" id="7588645">(</span><span class="string" id="7588646">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7588687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588694">defer</span>&nbsp;<span class="keyword" id="7588700">func</span><span class="op" id="7588704">(</span><span class="op" id="7588705">)</span>&nbsp;<span class="op" id="7588707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588711">if</span>&nbsp;<span class="ident" id="7588714">p</span>&nbsp;<span class="op" id="7588716">:=</span>&nbsp;<span class="builtinfunc" id="7588719">recover</span><span class="op" id="7588726">(</span><span class="op" id="7588727">)</span><span class="op" id="7588728">;</span>&nbsp;<span class="ident" id="7588730">p</span>&nbsp;<span class="op" id="7588732">!=</span>&nbsp;<span class="ident" id="7588735">nil</span>&nbsp;<span class="op" id="7588739">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588744">t</span><span class="op" id="7588745">.</span><span class="ident" id="7588746">Fatalf</span><span class="op" id="7588752">(</span><span class="string" id="7588753">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7588816">,</span>&nbsp;<span class="ident" id="7588818">p</span><span class="op" id="7588819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588826">}</span><span class="op" id="7588827">(</span><span class="op" id="7588828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588832">if</span>&nbsp;<span class="ident" id="7588835">ln</span><span class="op" id="7588837">,</span>&nbsp;<span class="ident" id="7588839">err</span>&nbsp;<span class="op" id="7588843">:=</span>&nbsp;<span class="ident" id="7588846">Listen</span><span class="op" id="7588852">(</span><span class="string" id="7588853">&#34;tcp&#34;</span><span class="op" id="7588858">,</span>&nbsp;<span class="string" id="7588860">&#34;&#34;</span><span class="op" id="7588862">)</span><span class="op" id="7588863">;</span>&nbsp;<span class="ident" id="7588865">err</span>&nbsp;<span class="op" id="7588869">==</span>&nbsp;<span class="ident" id="7588872">nil</span>&nbsp;<span class="op" id="7588876">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588880">ln</span><span class="op" id="7588882">.</span><span class="ident" id="7588883">Close</span><span class="op" id="7588888">(</span><span class="op" id="7588889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588895">if</span>&nbsp;<span class="ident" id="7588898">ln</span><span class="op" id="7588900">,</span>&nbsp;<span class="ident" id="7588902">err</span>&nbsp;<span class="op" id="7588906">:=</span>&nbsp;<span class="ident" id="7588909">ListenPacket</span><span class="op" id="7588921">(</span><span class="string" id="7588922">&#34;udp&#34;</span><span class="op" id="7588927">,</span>&nbsp;<span class="string" id="7588929">&#34;&#34;</span><span class="op" id="7588931">)</span><span class="op" id="7588932">;</span>&nbsp;<span class="ident" id="7588934">err</span>&nbsp;<span class="op" id="7588938">==</span>&nbsp;<span class="ident" id="7588941">nil</span>&nbsp;<span class="op" id="7588945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588949">ln</span><span class="op" id="7588951">.</span><span class="ident" id="7588952">Close</span><span class="op" id="7588957">(</span><span class="op" id="7588958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588961">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588964">if</span>&nbsp;<span class="ident" id="7588967">ln</span><span class="op" id="7588969">,</span>&nbsp;<span class="ident" id="7588971">err</span>&nbsp;<span class="op" id="7588975">:=</span>&nbsp;<span class="ident" id="7588978">ListenTCP</span><span class="op" id="7588987">(</span><span class="string" id="7588988">&#34;tcp&#34;</span><span class="op" id="7588993">,</span>&nbsp;<span class="ident" id="7588995">nil</span><span class="op" id="7588998">)</span><span class="op" id="7588999">;</span>&nbsp;<span class="ident" id="7589001">err</span>&nbsp;<span class="op" id="7589005">==</span>&nbsp;<span class="ident" id="7589008">nil</span>&nbsp;<span class="op" id="7589012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589016">ln</span><span class="op" id="7589018">.</span><span class="ident" id="7589019">Close</span><span class="op" id="7589024">(</span><span class="op" id="7589025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7589028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589031">if</span>&nbsp;<span class="ident" id="7589034">ln</span><span class="op" id="7589036">,</span>&nbsp;<span class="ident" id="7589038">err</span>&nbsp;<span class="op" id="7589042">:=</span>&nbsp;<span class="ident" id="7589045">ListenUDP</span><span class="op" id="7589054">(</span><span class="string" id="7589055">&#34;udp&#34;</span><span class="op" id="7589060">,</span>&nbsp;<span class="ident" id="7589062">nil</span><span class="op" id="7589065">)</span><span class="op" id="7589066">;</span>&nbsp;<span class="ident" id="7589068">err</span>&nbsp;<span class="op" id="7589072">==</span>&nbsp;<span class="ident" id="7589075">nil</span>&nbsp;<span class="op" id="7589079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589083">ln</span><span class="op" id="7589085">.</span><span class="ident" id="7589086">Close</span><span class="op" id="7589091">(</span><span class="op" id="7589092">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7589095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589098">if</span>&nbsp;<span class="ident" id="7589101">ln</span><span class="op" id="7589103">,</span>&nbsp;<span class="ident" id="7589105">err</span>&nbsp;<span class="op" id="7589109">:=</span>&nbsp;<span class="ident" id="7589112">ListenIP</span><span class="op" id="7589120">(</span><span class="string" id="7589121">&#34;ip:icmp&#34;</span><span class="op" id="7589130">,</span>&nbsp;<span class="ident" id="7589132">nil</span><span class="op" id="7589135">)</span><span class="op" id="7589136">;</span>&nbsp;<span class="ident" id="7589138">err</span>&nbsp;<span class="op" id="7589142">==</span>&nbsp;<span class="ident" id="7589145">nil</span>&nbsp;<span class="op" id="7589149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589153">ln</span><span class="op" id="7589155">.</span><span class="ident" id="7589156">Close</span><span class="op" id="7589161">(</span><span class="op" id="7589162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7589165">}</span><br>
<span class="lineno"></span><span class="op" id="7589167">}</span>
</div>
</body>
</html>
