<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2907054">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2907109">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2907163">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2907214">//&nbsp;Package&nbsp;scanner&nbsp;implements&nbsp;a&nbsp;scanner&nbsp;for&nbsp;Go&nbsp;source&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="2907274">//&nbsp;It&nbsp;takes&nbsp;a&nbsp;[]byte&nbsp;as&nbsp;source&nbsp;which&nbsp;can&nbsp;then&nbsp;be&nbsp;tokenized</span><br>
<span class="lineno"></span><span class="comment" id="2907333">//&nbsp;through&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;the&nbsp;Scan&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="2907379">//</span><br>
<span class="lineno"></span><span class="keyword" id="2907382">package</span>&nbsp;<span class="ident" id="2907390">scanner</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2907399">import</span>&nbsp;<span class="op" id="2907406">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907409">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907418">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907425">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907437">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907454">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907465">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2907476">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2907491">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2907494">//&nbsp;An&nbsp;ErrorHandler&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Scanner.Init.&nbsp;If&nbsp;a&nbsp;syntax&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2907567">//&nbsp;encountered&nbsp;and&nbsp;a&nbsp;handler&nbsp;was&nbsp;installed,&nbsp;the&nbsp;handler&nbsp;is&nbsp;called&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2907640">//&nbsp;position&nbsp;and&nbsp;an&nbsp;error&nbsp;message.&nbsp;The&nbsp;position&nbsp;points&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2907714">//&nbsp;the&nbsp;offending&nbsp;token.</span><br>
<span class="lineno">25</span><span class="comment" id="2907738">//</span><br>
<span class="lineno"></span><span class="keyword" id="2907741">type</span>&nbsp;<span class="ident" id="2907746">ErrorHandler</span>&nbsp;<span class="keyword" id="2907759">func</span><span class="op" id="2907763">(</span><span class="ident" id="2907764">pos</span>&nbsp;<span class="ident" id="2907768">token</span><span class="op" id="2907773">.</span><span class="ident" id="2907774">Position</span><span class="op" id="2907782">,</span>&nbsp;<span class="ident" id="2907784">msg</span>&nbsp;<span class="builtintype" id="2907788">string</span><span class="op" id="2907794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2907797">//&nbsp;A&nbsp;Scanner&nbsp;holds&nbsp;the&nbsp;scanner&#39;s&nbsp;internal&nbsp;state&nbsp;while&nbsp;processing</span><br>
<span class="lineno"></span><span class="comment" id="2907862">//&nbsp;a&nbsp;given&nbsp;text.&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;allocated&nbsp;as&nbsp;part&nbsp;of&nbsp;another&nbsp;data</span><br>
<span class="lineno">30</span><span class="comment" id="2907924">//&nbsp;structure&nbsp;but&nbsp;must&nbsp;be&nbsp;initialized&nbsp;via&nbsp;Init&nbsp;before&nbsp;use.</span><br>
<span class="lineno"></span><span class="comment" id="2907982">//</span><br>
<span class="lineno"></span><span class="keyword" id="2907985">type</span>&nbsp;<span class="ident" id="2907990">Scanner</span>&nbsp;<span class="keyword" id="2907998">struct</span>&nbsp;<span class="op" id="2908005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2908008">//&nbsp;immutable&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908028">file</span>&nbsp;<span class="op" id="2908033">*</span><span class="ident" id="2908034">token</span><span class="op" id="2908039">.</span><span class="ident" id="2908040">File</span>&nbsp;&nbsp;<span class="comment" id="2908046">//&nbsp;source&nbsp;file&nbsp;handle</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908069">dir</span>&nbsp;&nbsp;<span class="builtintype" id="2908074">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2908087">//&nbsp;directory&nbsp;portion&nbsp;of&nbsp;file.Name()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908124">src</span>&nbsp;&nbsp;<span class="op" id="2908129">[</span><span class="op" id="2908130">]</span><span class="builtintype" id="2908131">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2908142">//&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908153">err</span>&nbsp;&nbsp;<span class="ident" id="2908158">ErrorHandler</span>&nbsp;<span class="comment" id="2908171">//&nbsp;error&nbsp;reporting;&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908199">mode</span>&nbsp;<span class="ident" id="2908204">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2908217">//&nbsp;scanning&nbsp;mode</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2908236">//&nbsp;scanning&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908255">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2908266">rune</span>&nbsp;<span class="comment" id="2908271">//&nbsp;current&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908293">offset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2908304">int</span>&nbsp;&nbsp;<span class="comment" id="2908309">//&nbsp;character&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908330">rdOffset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2908341">int</span>&nbsp;&nbsp;<span class="comment" id="2908346">//&nbsp;reading&nbsp;offset&nbsp;(position&nbsp;after&nbsp;current&nbsp;character)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908400">lineOffset</span>&nbsp;<span class="builtintype" id="2908411">int</span>&nbsp;&nbsp;<span class="comment" id="2908416">//&nbsp;current&nbsp;line&nbsp;offset</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908440">insertSemi</span>&nbsp;<span class="builtintype" id="2908451">bool</span>&nbsp;<span class="comment" id="2908456">//&nbsp;insert&nbsp;a&nbsp;semicolon&nbsp;before&nbsp;next&nbsp;newline</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2908500">//&nbsp;public&nbsp;state&nbsp;-&nbsp;ok&nbsp;to&nbsp;modify</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908532">ErrorCount</span>&nbsp;<span class="builtintype" id="2908543">int</span>&nbsp;<span class="comment" id="2908547">//&nbsp;number&nbsp;of&nbsp;errors&nbsp;encountered</span><br>
<span class="lineno"></span><span class="op" id="2908579">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="2908582">const</span>&nbsp;<span class="ident" id="2908588">bom</span>&nbsp;<span class="op" id="2908592">=</span>&nbsp;<span class="num" id="2908594">0xFEFF</span>&nbsp;<span class="comment" id="2908601">//&nbsp;byte&nbsp;order&nbsp;mark,&nbsp;only&nbsp;permitted&nbsp;as&nbsp;very&nbsp;first&nbsp;character</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2908661">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Unicode&nbsp;char&nbsp;into&nbsp;s.ch.</span><br>
<span class="lineno"></span><span class="comment" id="2908702">//&nbsp;s.ch&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;end-of-file.</span><br>
<span class="lineno">55</span><span class="comment" id="2908733">//</span><br>
<span class="lineno"></span><span class="keyword" id="2908736">func</span>&nbsp;<span class="op" id="2908741">(</span><span class="ident" id="2908742">s</span>&nbsp;<span class="op" id="2908744">*</span><span class="ident" id="2908745">Scanner</span><span class="op" id="2908752">)</span>&nbsp;<span class="ident" id="2908754">next</span><span class="op" id="2908758">(</span><span class="op" id="2908759">)</span>&nbsp;<span class="op" id="2908761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908764">if</span>&nbsp;<span class="ident" id="2908767">s</span><span class="op" id="2908768">.</span><span class="ident" id="2908769">rdOffset</span>&nbsp;<span class="op" id="2908778">&lt;</span>&nbsp;<span class="builtinfunc" id="2908780">len</span><span class="op" id="2908783">(</span><span class="ident" id="2908784">s</span><span class="op" id="2908785">.</span><span class="ident" id="2908786">src</span><span class="op" id="2908789">)</span>&nbsp;<span class="op" id="2908791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908795">s</span><span class="op" id="2908796">.</span><span class="ident" id="2908797">offset</span>&nbsp;<span class="op" id="2908804">=</span>&nbsp;<span class="ident" id="2908806">s</span><span class="op" id="2908807">.</span><span class="ident" id="2908808">rdOffset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908819">if</span>&nbsp;<span class="ident" id="2908822">s</span><span class="op" id="2908823">.</span><span class="ident" id="2908824">ch</span>&nbsp;<span class="op" id="2908827">==</span>&nbsp;<span class="string" id="2908830">&#39;\n&#39;</span>&nbsp;<span class="op" id="2908835">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908840">s</span><span class="op" id="2908841">.</span><span class="ident" id="2908842">lineOffset</span>&nbsp;<span class="op" id="2908853">=</span>&nbsp;<span class="ident" id="2908855">s</span><span class="op" id="2908856">.</span><span class="ident" id="2908857">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908867">s</span><span class="op" id="2908868">.</span><span class="ident" id="2908869">file</span><span class="op" id="2908873">.</span><span class="ident" id="2908874">AddLine</span><span class="op" id="2908881">(</span><span class="ident" id="2908882">s</span><span class="op" id="2908883">.</span><span class="ident" id="2908884">offset</span><span class="op" id="2908890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2908894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908898">r</span><span class="op" id="2908899">,</span>&nbsp;<span class="ident" id="2908901">w</span>&nbsp;<span class="op" id="2908903">:=</span>&nbsp;<span class="builtintype" id="2908906">rune</span><span class="op" id="2908910">(</span><span class="ident" id="2908911">s</span><span class="op" id="2908912">.</span><span class="ident" id="2908913">src</span><span class="op" id="2908916">[</span><span class="ident" id="2908917">s</span><span class="op" id="2908918">.</span><span class="ident" id="2908919">rdOffset</span><span class="op" id="2908927">]</span><span class="op" id="2908928">)</span><span class="op" id="2908929">,</span>&nbsp;<span class="num" id="2908931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908935">switch</span>&nbsp;<span class="op" id="2908942">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908946">case</span>&nbsp;<span class="ident" id="2908951">r</span>&nbsp;<span class="op" id="2908953">==</span>&nbsp;<span class="num" id="2908956">0</span><span class="op" id="2908957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908962">s</span><span class="op" id="2908963">.</span><span class="builtintype" id="2908964">error</span><span class="op" id="2908969">(</span><span class="ident" id="2908970">s</span><span class="op" id="2908971">.</span><span class="ident" id="2908972">offset</span><span class="op" id="2908978">,</span>&nbsp;<span class="string" id="2908980">&#34;illegal&nbsp;character&nbsp;NUL&#34;</span><span class="op" id="2909003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909007">case</span>&nbsp;<span class="ident" id="2909012">r</span>&nbsp;<span class="op" id="2909014">&gt;=</span>&nbsp;<span class="num" id="2909017">0x80</span><span class="op" id="2909021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2909026">//&nbsp;not&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909042">r</span><span class="op" id="2909043">,</span>&nbsp;<span class="ident" id="2909045">w</span>&nbsp;<span class="op" id="2909047">=</span>&nbsp;<span class="ident" id="2909049">utf8</span><span class="op" id="2909053">.</span><span class="ident" id="2909054">DecodeRune</span><span class="op" id="2909064">(</span><span class="ident" id="2909065">s</span><span class="op" id="2909066">.</span><span class="ident" id="2909067">src</span><span class="op" id="2909070">[</span><span class="ident" id="2909071">s</span><span class="op" id="2909072">.</span><span class="ident" id="2909073">rdOffset</span><span class="op" id="2909081">:</span><span class="op" id="2909082">]</span><span class="op" id="2909083">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909088">if</span>&nbsp;<span class="ident" id="2909091">r</span>&nbsp;<span class="op" id="2909093">==</span>&nbsp;<span class="ident" id="2909096">utf8</span><span class="op" id="2909100">.</span><span class="ident" id="2909101">RuneError</span>&nbsp;<span class="op" id="2909111">&amp;&amp;</span>&nbsp;<span class="ident" id="2909114">w</span>&nbsp;<span class="op" id="2909116">==</span>&nbsp;<span class="num" id="2909119">1</span>&nbsp;<span class="op" id="2909121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909127">s</span><span class="op" id="2909128">.</span><span class="builtintype" id="2909129">error</span><span class="op" id="2909134">(</span><span class="ident" id="2909135">s</span><span class="op" id="2909136">.</span><span class="ident" id="2909137">offset</span><span class="op" id="2909143">,</span>&nbsp;<span class="string" id="2909145">&#34;illegal&nbsp;UTF-8&nbsp;encoding&#34;</span><span class="op" id="2909169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909174">}</span>&nbsp;<span class="keyword" id="2909176">else</span>&nbsp;<span class="keyword" id="2909181">if</span>&nbsp;<span class="ident" id="2909184">r</span>&nbsp;<span class="op" id="2909186">==</span>&nbsp;<span class="ident" id="2909189">bom</span>&nbsp;<span class="op" id="2909193">&amp;&amp;</span>&nbsp;<span class="ident" id="2909196">s</span><span class="op" id="2909197">.</span><span class="ident" id="2909198">offset</span>&nbsp;<span class="op" id="2909205">&gt;</span>&nbsp;<span class="num" id="2909207">0</span>&nbsp;<span class="op" id="2909209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909215">s</span><span class="op" id="2909216">.</span><span class="builtintype" id="2909217">error</span><span class="op" id="2909222">(</span><span class="ident" id="2909223">s</span><span class="op" id="2909224">.</span><span class="ident" id="2909225">offset</span><span class="op" id="2909231">,</span>&nbsp;<span class="string" id="2909233">&#34;illegal&nbsp;byte&nbsp;order&nbsp;mark&#34;</span><span class="op" id="2909258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909263">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909271">s</span><span class="op" id="2909272">.</span><span class="ident" id="2909273">rdOffset</span>&nbsp;<span class="op" id="2909282">+=</span>&nbsp;<span class="ident" id="2909285">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909289">s</span><span class="op" id="2909290">.</span><span class="ident" id="2909291">ch</span>&nbsp;<span class="op" id="2909294">=</span>&nbsp;<span class="ident" id="2909296">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909299">}</span>&nbsp;<span class="keyword" id="2909301">else</span>&nbsp;<span class="op" id="2909306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909310">s</span><span class="op" id="2909311">.</span><span class="ident" id="2909312">offset</span>&nbsp;<span class="op" id="2909319">=</span>&nbsp;<span class="builtinfunc" id="2909321">len</span><span class="op" id="2909324">(</span><span class="ident" id="2909325">s</span><span class="op" id="2909326">.</span><span class="ident" id="2909327">src</span><span class="op" id="2909330">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909334">if</span>&nbsp;<span class="ident" id="2909337">s</span><span class="op" id="2909338">.</span><span class="ident" id="2909339">ch</span>&nbsp;<span class="op" id="2909342">==</span>&nbsp;<span class="string" id="2909345">&#39;\n&#39;</span>&nbsp;<span class="op" id="2909350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909355">s</span><span class="op" id="2909356">.</span><span class="ident" id="2909357">lineOffset</span>&nbsp;<span class="op" id="2909368">=</span>&nbsp;<span class="ident" id="2909370">s</span><span class="op" id="2909371">.</span><span class="ident" id="2909372">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909382">s</span><span class="op" id="2909383">.</span><span class="ident" id="2909384">file</span><span class="op" id="2909388">.</span><span class="ident" id="2909389">AddLine</span><span class="op" id="2909396">(</span><span class="ident" id="2909397">s</span><span class="op" id="2909398">.</span><span class="ident" id="2909399">offset</span><span class="op" id="2909405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909413">s</span><span class="op" id="2909414">.</span><span class="ident" id="2909415">ch</span>&nbsp;<span class="op" id="2909418">=</span>&nbsp;<span class="op" id="2909420">-</span><span class="num" id="2909421">1</span>&nbsp;<span class="comment" id="2909423">//&nbsp;eof</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909431">}</span><br>
<span class="lineno"></span><span class="op" id="2909433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2909436">//&nbsp;A&nbsp;mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="2909478">//&nbsp;They&nbsp;control&nbsp;scanner&nbsp;behavior.</span><br>
<span class="lineno">90</span><span class="comment" id="2909512">//</span><br>
<span class="lineno"></span><span class="keyword" id="2909515">type</span>&nbsp;<span class="ident" id="2909520">Mode</span>&nbsp;<span class="builtintype" id="2909525">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2909531">const</span>&nbsp;<span class="op" id="2909537">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909540">ScanComments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2909556">Mode</span>&nbsp;<span class="op" id="2909561">=</span>&nbsp;<span class="num" id="2909563">1</span>&nbsp;<span class="op" id="2909565">&lt;&lt;</span>&nbsp;<span class="ident" id="2909568">iota</span>&nbsp;<span class="comment" id="2909573">//&nbsp;return&nbsp;comments&nbsp;as&nbsp;COMMENT&nbsp;tokens</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909611">dontInsertSemis</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2909644">//&nbsp;do&nbsp;not&nbsp;automatically&nbsp;insert&nbsp;semicolons&nbsp;-&nbsp;for&nbsp;testing&nbsp;only</span><br>
<span class="lineno"></span><span class="op" id="2909705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2909708">//&nbsp;Init&nbsp;prepares&nbsp;the&nbsp;scanner&nbsp;s&nbsp;to&nbsp;tokenize&nbsp;the&nbsp;text&nbsp;src&nbsp;by&nbsp;setting&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2909779">//&nbsp;scanner&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;src.&nbsp;The&nbsp;scanner&nbsp;uses&nbsp;the&nbsp;file&nbsp;set&nbsp;file</span><br>
<span class="lineno">100</span><span class="comment" id="2909850">//&nbsp;for&nbsp;position&nbsp;information&nbsp;and&nbsp;it&nbsp;adds&nbsp;line&nbsp;information&nbsp;for&nbsp;each&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="2909922">//&nbsp;It&nbsp;is&nbsp;ok&nbsp;to&nbsp;re-use&nbsp;the&nbsp;same&nbsp;file&nbsp;when&nbsp;re-scanning&nbsp;the&nbsp;same&nbsp;file&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2909992">//&nbsp;line&nbsp;information&nbsp;which&nbsp;is&nbsp;already&nbsp;present&nbsp;is&nbsp;ignored.&nbsp;Init&nbsp;causes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2910063">//&nbsp;panic&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;src&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="2910118">//</span><br>
<span class="lineno">105</span><span class="comment" id="2910121">//&nbsp;Calls&nbsp;to&nbsp;Scan&nbsp;will&nbsp;invoke&nbsp;the&nbsp;error&nbsp;handler&nbsp;err&nbsp;if&nbsp;they&nbsp;encounter&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2910192">//&nbsp;syntax&nbsp;error&nbsp;and&nbsp;err&nbsp;is&nbsp;not&nbsp;nil.&nbsp;Also,&nbsp;for&nbsp;each&nbsp;error&nbsp;encountered,</span><br>
<span class="lineno"></span><span class="comment" id="2910262">//&nbsp;the&nbsp;Scanner&nbsp;field&nbsp;ErrorCount&nbsp;is&nbsp;incremented&nbsp;by&nbsp;one.&nbsp;The&nbsp;mode&nbsp;parameter</span><br>
<span class="lineno"></span><span class="comment" id="2910336">//&nbsp;determines&nbsp;how&nbsp;comments&nbsp;are&nbsp;handled.</span><br>
<span class="lineno"></span><span class="comment" id="2910376">//</span><br>
<span class="lineno">110</span><span class="comment" id="2910379">//&nbsp;Note&nbsp;that&nbsp;Init&nbsp;may&nbsp;call&nbsp;err&nbsp;if&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;first&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="2910454">//&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2910470">//</span><br>
<span class="lineno"></span><span class="keyword" id="2910473">func</span>&nbsp;<span class="op" id="2910478">(</span><span class="ident" id="2910479">s</span>&nbsp;<span class="op" id="2910481">*</span><span class="ident" id="2910482">Scanner</span><span class="op" id="2910489">)</span>&nbsp;<span class="ident" id="2910491">Init</span><span class="op" id="2910495">(</span><span class="ident" id="2910496">file</span>&nbsp;<span class="op" id="2910501">*</span><span class="ident" id="2910502">token</span><span class="op" id="2910507">.</span><span class="ident" id="2910508">File</span><span class="op" id="2910512">,</span>&nbsp;<span class="ident" id="2910514">src</span>&nbsp;<span class="op" id="2910518">[</span><span class="op" id="2910519">]</span><span class="builtintype" id="2910520">byte</span><span class="op" id="2910524">,</span>&nbsp;<span class="ident" id="2910526">err</span>&nbsp;<span class="ident" id="2910530">ErrorHandler</span><span class="op" id="2910542">,</span>&nbsp;<span class="ident" id="2910544">mode</span>&nbsp;<span class="ident" id="2910549">Mode</span><span class="op" id="2910553">)</span>&nbsp;<span class="op" id="2910555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2910558">//&nbsp;Explicitly&nbsp;initialize&nbsp;all&nbsp;fields&nbsp;since&nbsp;a&nbsp;scanner&nbsp;may&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910626">if</span>&nbsp;<span class="ident" id="2910629">file</span><span class="op" id="2910633">.</span><span class="ident" id="2910634">Size</span><span class="op" id="2910638">(</span><span class="op" id="2910639">)</span>&nbsp;<span class="op" id="2910641">!=</span>&nbsp;<span class="builtinfunc" id="2910644">len</span><span class="op" id="2910647">(</span><span class="ident" id="2910648">src</span><span class="op" id="2910651">)</span>&nbsp;<span class="op" id="2910653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2910657">panic</span><span class="op" id="2910662">(</span><span class="ident" id="2910663">fmt</span><span class="op" id="2910666">.</span><span class="ident" id="2910667">Sprintf</span><span class="op" id="2910674">(</span><span class="string" id="2910675">&#34;file&nbsp;size&nbsp;(%d)&nbsp;does&nbsp;not&nbsp;match&nbsp;src&nbsp;len&nbsp;(%d)&#34;</span><span class="op" id="2910719">,</span>&nbsp;<span class="ident" id="2910721">file</span><span class="op" id="2910725">.</span><span class="ident" id="2910726">Size</span><span class="op" id="2910730">(</span><span class="op" id="2910731">)</span><span class="op" id="2910732">,</span>&nbsp;<span class="builtinfunc" id="2910734">len</span><span class="op" id="2910737">(</span><span class="ident" id="2910738">src</span><span class="op" id="2910741">)</span><span class="op" id="2910742">)</span><span class="op" id="2910743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910749">s</span><span class="op" id="2910750">.</span><span class="ident" id="2910751">file</span>&nbsp;<span class="op" id="2910756">=</span>&nbsp;<span class="ident" id="2910758">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910764">s</span><span class="op" id="2910765">.</span><span class="ident" id="2910766">dir</span><span class="op" id="2910769">,</span>&nbsp;<span class="ident" id="2910771">_</span>&nbsp;<span class="op" id="2910773">=</span>&nbsp;<span class="ident" id="2910775">filepath</span><span class="op" id="2910783">.</span><span class="ident" id="2910784">Split</span><span class="op" id="2910789">(</span><span class="ident" id="2910790">file</span><span class="op" id="2910794">.</span><span class="ident" id="2910795">Name</span><span class="op" id="2910799">(</span><span class="op" id="2910800">)</span><span class="op" id="2910801">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910804">s</span><span class="op" id="2910805">.</span><span class="ident" id="2910806">src</span>&nbsp;<span class="op" id="2910810">=</span>&nbsp;<span class="ident" id="2910812">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910817">s</span><span class="op" id="2910818">.</span><span class="ident" id="2910819">err</span>&nbsp;<span class="op" id="2910823">=</span>&nbsp;<span class="ident" id="2910825">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910830">s</span><span class="op" id="2910831">.</span><span class="ident" id="2910832">mode</span>&nbsp;<span class="op" id="2910837">=</span>&nbsp;<span class="ident" id="2910839">mode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910846">s</span><span class="op" id="2910847">.</span><span class="ident" id="2910848">ch</span>&nbsp;<span class="op" id="2910851">=</span>&nbsp;<span class="string" id="2910853">&#39;&nbsp;&#39;</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910858">s</span><span class="op" id="2910859">.</span><span class="ident" id="2910860">offset</span>&nbsp;<span class="op" id="2910867">=</span>&nbsp;<span class="num" id="2910869">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910872">s</span><span class="op" id="2910873">.</span><span class="ident" id="2910874">rdOffset</span>&nbsp;<span class="op" id="2910883">=</span>&nbsp;<span class="num" id="2910885">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910888">s</span><span class="op" id="2910889">.</span><span class="ident" id="2910890">lineOffset</span>&nbsp;<span class="op" id="2910901">=</span>&nbsp;<span class="num" id="2910903">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910906">s</span><span class="op" id="2910907">.</span><span class="ident" id="2910908">insertSemi</span>&nbsp;<span class="op" id="2910919">=</span>&nbsp;<span class="builtintype" id="2910921">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910928">s</span><span class="op" id="2910929">.</span><span class="ident" id="2910930">ErrorCount</span>&nbsp;<span class="op" id="2910941">=</span>&nbsp;<span class="num" id="2910943">0</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910947">s</span><span class="op" id="2910948">.</span><span class="ident" id="2910949">next</span><span class="op" id="2910953">(</span><span class="op" id="2910954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910957">if</span>&nbsp;<span class="ident" id="2910960">s</span><span class="op" id="2910961">.</span><span class="ident" id="2910962">ch</span>&nbsp;<span class="op" id="2910965">==</span>&nbsp;<span class="ident" id="2910968">bom</span>&nbsp;<span class="op" id="2910972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910976">s</span><span class="op" id="2910977">.</span><span class="ident" id="2910978">next</span><span class="op" id="2910982">(</span><span class="op" id="2910983">)</span>&nbsp;<span class="comment" id="2910985">//&nbsp;ignore&nbsp;BOM&nbsp;at&nbsp;file&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911018">}</span><br>
<span class="lineno">135</span><span class="op" id="2911020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2911023">func</span>&nbsp;<span class="op" id="2911028">(</span><span class="ident" id="2911029">s</span>&nbsp;<span class="op" id="2911031">*</span><span class="ident" id="2911032">Scanner</span><span class="op" id="2911039">)</span>&nbsp;<span class="builtintype" id="2911041">error</span><span class="op" id="2911046">(</span><span class="ident" id="2911047">offs</span>&nbsp;<span class="builtintype" id="2911052">int</span><span class="op" id="2911055">,</span>&nbsp;<span class="ident" id="2911057">msg</span>&nbsp;<span class="builtintype" id="2911061">string</span><span class="op" id="2911067">)</span>&nbsp;<span class="op" id="2911069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2911072">if</span>&nbsp;<span class="ident" id="2911075">s</span><span class="op" id="2911076">.</span><span class="ident" id="2911077">err</span>&nbsp;<span class="op" id="2911081">!=</span>&nbsp;<span class="ident" id="2911084">nil</span>&nbsp;<span class="op" id="2911088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911092">s</span><span class="op" id="2911093">.</span><span class="ident" id="2911094">err</span><span class="op" id="2911097">(</span><span class="ident" id="2911098">s</span><span class="op" id="2911099">.</span><span class="ident" id="2911100">file</span><span class="op" id="2911104">.</span><span class="ident" id="2911105">Position</span><span class="op" id="2911113">(</span><span class="ident" id="2911114">s</span><span class="op" id="2911115">.</span><span class="ident" id="2911116">file</span><span class="op" id="2911120">.</span><span class="ident" id="2911121">Pos</span><span class="op" id="2911124">(</span><span class="ident" id="2911125">offs</span><span class="op" id="2911129">)</span><span class="op" id="2911130">)</span><span class="op" id="2911131">,</span>&nbsp;<span class="ident" id="2911133">msg</span><span class="op" id="2911136">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911142">s</span><span class="op" id="2911143">.</span><span class="ident" id="2911144">ErrorCount</span><span class="op" id="2911154">++</span><br>
<span class="lineno"></span><span class="op" id="2911157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2911160">var</span>&nbsp;<span class="ident" id="2911164">prefix</span>&nbsp;<span class="op" id="2911171">=</span>&nbsp;<span class="op" id="2911173">[</span><span class="op" id="2911174">]</span><span class="builtintype" id="2911175">byte</span><span class="op" id="2911179">(</span><span class="string" id="2911180">&#34;//line&nbsp;&#34;</span><span class="op" id="2911189">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="2911192">func</span>&nbsp;<span class="op" id="2911197">(</span><span class="ident" id="2911198">s</span>&nbsp;<span class="op" id="2911200">*</span><span class="ident" id="2911201">Scanner</span><span class="op" id="2911208">)</span>&nbsp;<span class="ident" id="2911210">interpretLineComment</span><span class="op" id="2911230">(</span><span class="ident" id="2911231">text</span>&nbsp;<span class="op" id="2911236">[</span><span class="op" id="2911237">]</span><span class="builtintype" id="2911238">byte</span><span class="op" id="2911242">)</span>&nbsp;<span class="op" id="2911244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2911247">if</span>&nbsp;<span class="ident" id="2911250">bytes</span><span class="op" id="2911255">.</span><span class="ident" id="2911256">HasPrefix</span><span class="op" id="2911265">(</span><span class="ident" id="2911266">text</span><span class="op" id="2911270">,</span>&nbsp;<span class="ident" id="2911272">prefix</span><span class="op" id="2911278">)</span>&nbsp;<span class="op" id="2911280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911284">//&nbsp;get&nbsp;filename&nbsp;and&nbsp;line&nbsp;number,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2911326">if</span>&nbsp;<span class="ident" id="2911329">i</span>&nbsp;<span class="op" id="2911331">:=</span>&nbsp;<span class="ident" id="2911334">bytes</span><span class="op" id="2911339">.</span><span class="ident" id="2911340">LastIndex</span><span class="op" id="2911349">(</span><span class="ident" id="2911350">text</span><span class="op" id="2911354">,</span>&nbsp;<span class="op" id="2911356">[</span><span class="op" id="2911357">]</span><span class="builtintype" id="2911358">byte</span><span class="op" id="2911362">{</span><span class="string" id="2911363">&#39;:&#39;</span><span class="op" id="2911366">}</span><span class="op" id="2911367">)</span><span class="op" id="2911368">;</span>&nbsp;<span class="ident" id="2911370">i</span>&nbsp;<span class="op" id="2911372">&gt;</span>&nbsp;<span class="num" id="2911374">0</span>&nbsp;<span class="op" id="2911376">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2911381">if</span>&nbsp;<span class="ident" id="2911384">line</span><span class="op" id="2911388">,</span>&nbsp;<span class="ident" id="2911390">err</span>&nbsp;<span class="op" id="2911394">:=</span>&nbsp;<span class="ident" id="2911397">strconv</span><span class="op" id="2911404">.</span><span class="ident" id="2911405">Atoi</span><span class="op" id="2911409">(</span><span class="builtintype" id="2911410">string</span><span class="op" id="2911416">(</span><span class="ident" id="2911417">text</span><span class="op" id="2911421">[</span><span class="ident" id="2911422">i</span><span class="op" id="2911423">+</span><span class="num" id="2911424">1</span><span class="op" id="2911425">:</span><span class="op" id="2911426">]</span><span class="op" id="2911427">)</span><span class="op" id="2911428">)</span><span class="op" id="2911429">;</span>&nbsp;<span class="ident" id="2911431">err</span>&nbsp;<span class="op" id="2911435">==</span>&nbsp;<span class="ident" id="2911438">nil</span>&nbsp;<span class="op" id="2911442">&amp;&amp;</span>&nbsp;<span class="ident" id="2911445">line</span>&nbsp;<span class="op" id="2911450">&gt;</span>&nbsp;<span class="num" id="2911452">0</span>&nbsp;<span class="op" id="2911454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911460">//&nbsp;valid&nbsp;//line&nbsp;filename:line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911502">filename</span>&nbsp;<span class="op" id="2911511">:=</span>&nbsp;<span class="builtintype" id="2911514">string</span><span class="op" id="2911520">(</span><span class="ident" id="2911521">bytes</span><span class="op" id="2911526">.</span><span class="ident" id="2911527">TrimSpace</span><span class="op" id="2911536">(</span><span class="ident" id="2911537">text</span><span class="op" id="2911541">[</span><span class="builtinfunc" id="2911542">len</span><span class="op" id="2911545">(</span><span class="ident" id="2911546">prefix</span><span class="op" id="2911552">)</span><span class="op" id="2911553">:</span><span class="ident" id="2911554">i</span><span class="op" id="2911555">]</span><span class="op" id="2911556">)</span><span class="op" id="2911557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2911563">if</span>&nbsp;<span class="ident" id="2911566">filename</span>&nbsp;<span class="op" id="2911575">!=</span>&nbsp;<span class="string" id="2911578">&#34;&#34;</span>&nbsp;<span class="op" id="2911581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911588">filename</span>&nbsp;<span class="op" id="2911597">=</span>&nbsp;<span class="ident" id="2911599">filepath</span><span class="op" id="2911607">.</span><span class="ident" id="2911608">Clean</span><span class="op" id="2911613">(</span><span class="ident" id="2911614">filename</span><span class="op" id="2911622">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2911629">if</span>&nbsp;<span class="op" id="2911632">!</span><span class="ident" id="2911633">filepath</span><span class="op" id="2911641">.</span><span class="ident" id="2911642">IsAbs</span><span class="op" id="2911647">(</span><span class="ident" id="2911648">filename</span><span class="op" id="2911656">)</span>&nbsp;<span class="op" id="2911658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911666">//&nbsp;make&nbsp;filename&nbsp;relative&nbsp;to&nbsp;current&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911719">filename</span>&nbsp;<span class="op" id="2911728">=</span>&nbsp;<span class="ident" id="2911730">filepath</span><span class="op" id="2911738">.</span><span class="ident" id="2911739">Join</span><span class="op" id="2911743">(</span><span class="ident" id="2911744">s</span><span class="op" id="2911745">.</span><span class="ident" id="2911746">dir</span><span class="op" id="2911749">,</span>&nbsp;<span class="ident" id="2911751">filename</span><span class="op" id="2911759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911772">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911778">//&nbsp;update&nbsp;scanner&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911809">s</span><span class="op" id="2911810">.</span><span class="ident" id="2911811">file</span><span class="op" id="2911815">.</span><span class="ident" id="2911816">AddLineInfo</span><span class="op" id="2911827">(</span><span class="ident" id="2911828">s</span><span class="op" id="2911829">.</span><span class="ident" id="2911830">lineOffset</span><span class="op" id="2911840">+</span><span class="builtinfunc" id="2911841">len</span><span class="op" id="2911844">(</span><span class="ident" id="2911845">text</span><span class="op" id="2911849">)</span><span class="op" id="2911850">+</span><span class="num" id="2911851">1</span><span class="op" id="2911852">,</span>&nbsp;<span class="ident" id="2911854">filename</span><span class="op" id="2911862">,</span>&nbsp;<span class="ident" id="2911864">line</span><span class="op" id="2911868">)</span>&nbsp;<span class="comment" id="2911870">//&nbsp;+len(text)+1&nbsp;since&nbsp;comment&nbsp;applies&nbsp;to&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2911931">}</span><br>
<span class="lineno">165</span><span class="op" id="2911933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2911936">func</span>&nbsp;<span class="op" id="2911941">(</span><span class="ident" id="2911942">s</span>&nbsp;<span class="op" id="2911944">*</span><span class="ident" id="2911945">Scanner</span><span class="op" id="2911952">)</span>&nbsp;<span class="ident" id="2911954">scanComment</span><span class="op" id="2911965">(</span><span class="op" id="2911966">)</span>&nbsp;<span class="builtintype" id="2911968">string</span>&nbsp;<span class="op" id="2911975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911978">//&nbsp;initial&nbsp;&#39;/&#39;&nbsp;already&nbsp;consumed;&nbsp;s.ch&nbsp;==&nbsp;&#39;/&#39;&nbsp;||&nbsp;s.ch&nbsp;==&nbsp;&#39;*&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912039">offs</span>&nbsp;<span class="op" id="2912044">:=</span>&nbsp;<span class="ident" id="2912047">s</span><span class="op" id="2912048">.</span><span class="ident" id="2912049">offset</span>&nbsp;<span class="op" id="2912056">-</span>&nbsp;<span class="num" id="2912058">1</span>&nbsp;<span class="comment" id="2912060">//&nbsp;position&nbsp;of&nbsp;initial&nbsp;&#39;/&#39;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912088">hasCR</span>&nbsp;<span class="op" id="2912094">:=</span>&nbsp;<span class="builtintype" id="2912097">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912105">if</span>&nbsp;<span class="ident" id="2912108">s</span><span class="op" id="2912109">.</span><span class="ident" id="2912110">ch</span>&nbsp;<span class="op" id="2912113">==</span>&nbsp;<span class="string" id="2912116">&#39;/&#39;</span>&nbsp;<span class="op" id="2912120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912124">//-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912143">s</span><span class="op" id="2912144">.</span><span class="ident" id="2912145">next</span><span class="op" id="2912149">(</span><span class="op" id="2912150">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912154">for</span>&nbsp;<span class="ident" id="2912158">s</span><span class="op" id="2912159">.</span><span class="ident" id="2912160">ch</span>&nbsp;<span class="op" id="2912163">!=</span>&nbsp;<span class="string" id="2912166">&#39;\n&#39;</span>&nbsp;<span class="op" id="2912171">&amp;&amp;</span>&nbsp;<span class="ident" id="2912174">s</span><span class="op" id="2912175">.</span><span class="ident" id="2912176">ch</span>&nbsp;<span class="op" id="2912179">&gt;=</span>&nbsp;<span class="num" id="2912182">0</span>&nbsp;<span class="op" id="2912184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912189">if</span>&nbsp;<span class="ident" id="2912192">s</span><span class="op" id="2912193">.</span><span class="ident" id="2912194">ch</span>&nbsp;<span class="op" id="2912197">==</span>&nbsp;<span class="string" id="2912200">&#39;\r&#39;</span>&nbsp;<span class="op" id="2912205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912211">hasCR</span>&nbsp;<span class="op" id="2912217">=</span>&nbsp;<span class="builtintype" id="2912219">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912232">s</span><span class="op" id="2912233">.</span><span class="ident" id="2912234">next</span><span class="op" id="2912238">(</span><span class="op" id="2912239">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912247">if</span>&nbsp;<span class="ident" id="2912250">offs</span>&nbsp;<span class="op" id="2912255">==</span>&nbsp;<span class="ident" id="2912258">s</span><span class="op" id="2912259">.</span><span class="ident" id="2912260">lineOffset</span>&nbsp;<span class="op" id="2912271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912276">//&nbsp;comment&nbsp;starts&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;current&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912334">s</span><span class="op" id="2912335">.</span><span class="ident" id="2912336">interpretLineComment</span><span class="op" id="2912356">(</span><span class="ident" id="2912357">s</span><span class="op" id="2912358">.</span><span class="ident" id="2912359">src</span><span class="op" id="2912362">[</span><span class="ident" id="2912363">offs</span><span class="op" id="2912367">:</span><span class="ident" id="2912368">s</span><span class="op" id="2912369">.</span><span class="ident" id="2912370">offset</span><span class="op" id="2912376">]</span><span class="op" id="2912377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912381">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912385">goto</span>&nbsp;<span class="ident" id="2912390">exit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912400">/*-style&nbsp;comment&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912421">s</span><span class="op" id="2912422">.</span><span class="ident" id="2912423">next</span><span class="op" id="2912427">(</span><span class="op" id="2912428">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912431">for</span>&nbsp;<span class="ident" id="2912435">s</span><span class="op" id="2912436">.</span><span class="ident" id="2912437">ch</span>&nbsp;<span class="op" id="2912440">&gt;=</span>&nbsp;<span class="num" id="2912443">0</span>&nbsp;<span class="op" id="2912445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912449">ch</span>&nbsp;<span class="op" id="2912452">:=</span>&nbsp;<span class="ident" id="2912455">s</span><span class="op" id="2912456">.</span><span class="ident" id="2912457">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912462">if</span>&nbsp;<span class="ident" id="2912465">ch</span>&nbsp;<span class="op" id="2912468">==</span>&nbsp;<span class="string" id="2912471">&#39;\r&#39;</span>&nbsp;<span class="op" id="2912476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912481">hasCR</span>&nbsp;<span class="op" id="2912487">=</span>&nbsp;<span class="builtintype" id="2912489">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912496">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912500">s</span><span class="op" id="2912501">.</span><span class="ident" id="2912502">next</span><span class="op" id="2912506">(</span><span class="op" id="2912507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912511">if</span>&nbsp;<span class="ident" id="2912514">ch</span>&nbsp;<span class="op" id="2912517">==</span>&nbsp;<span class="string" id="2912520">&#39;*&#39;</span>&nbsp;<span class="op" id="2912524">&amp;&amp;</span>&nbsp;<span class="ident" id="2912527">s</span><span class="op" id="2912528">.</span><span class="ident" id="2912529">ch</span>&nbsp;<span class="op" id="2912532">==</span>&nbsp;<span class="string" id="2912535">&#39;/&#39;</span>&nbsp;<span class="op" id="2912539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912544">s</span><span class="op" id="2912545">.</span><span class="ident" id="2912546">next</span><span class="op" id="2912550">(</span><span class="op" id="2912551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912556">goto</span>&nbsp;<span class="ident" id="2912561">exit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912568">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912575">s</span><span class="op" id="2912576">.</span><span class="builtintype" id="2912577">error</span><span class="op" id="2912582">(</span><span class="ident" id="2912583">offs</span><span class="op" id="2912587">,</span>&nbsp;<span class="string" id="2912589">&#34;comment&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="2912613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2912616">exit</span><span class="op" id="2912620">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912623">lit</span>&nbsp;<span class="op" id="2912627">:=</span>&nbsp;<span class="ident" id="2912630">s</span><span class="op" id="2912631">.</span><span class="ident" id="2912632">src</span><span class="op" id="2912635">[</span><span class="ident" id="2912636">offs</span><span class="op" id="2912640">:</span><span class="ident" id="2912641">s</span><span class="op" id="2912642">.</span><span class="ident" id="2912643">offset</span><span class="op" id="2912649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912652">if</span>&nbsp;<span class="ident" id="2912655">hasCR</span>&nbsp;<span class="op" id="2912661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912665">lit</span>&nbsp;<span class="op" id="2912669">=</span>&nbsp;<span class="ident" id="2912671">stripCR</span><span class="op" id="2912678">(</span><span class="ident" id="2912679">lit</span><span class="op" id="2912682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912689">return</span>&nbsp;<span class="builtintype" id="2912696">string</span><span class="op" id="2912702">(</span><span class="ident" id="2912703">lit</span><span class="op" id="2912706">)</span><br>
<span class="lineno"></span><span class="op" id="2912708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2912711">func</span>&nbsp;<span class="op" id="2912716">(</span><span class="ident" id="2912717">s</span>&nbsp;<span class="op" id="2912719">*</span><span class="ident" id="2912720">Scanner</span><span class="op" id="2912727">)</span>&nbsp;<span class="ident" id="2912729">findLineEnd</span><span class="op" id="2912740">(</span><span class="op" id="2912741">)</span>&nbsp;<span class="builtintype" id="2912743">bool</span>&nbsp;<span class="op" id="2912748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912751">//&nbsp;initial&nbsp;&#39;/&#39;&nbsp;already&nbsp;consumed</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912785">defer</span>&nbsp;<span class="keyword" id="2912791">func</span><span class="op" id="2912795">(</span><span class="ident" id="2912796">offs</span>&nbsp;<span class="builtintype" id="2912801">int</span><span class="op" id="2912804">)</span>&nbsp;<span class="op" id="2912806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912810">//&nbsp;reset&nbsp;scanner&nbsp;state&nbsp;to&nbsp;where&nbsp;it&nbsp;was&nbsp;upon&nbsp;calling&nbsp;findLineEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912876">s</span><span class="op" id="2912877">.</span><span class="ident" id="2912878">ch</span>&nbsp;<span class="op" id="2912881">=</span>&nbsp;<span class="string" id="2912883">&#39;/&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912889">s</span><span class="op" id="2912890">.</span><span class="ident" id="2912891">offset</span>&nbsp;<span class="op" id="2912898">=</span>&nbsp;<span class="ident" id="2912900">offs</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912907">s</span><span class="op" id="2912908">.</span><span class="ident" id="2912909">rdOffset</span>&nbsp;<span class="op" id="2912918">=</span>&nbsp;<span class="ident" id="2912920">offs</span>&nbsp;<span class="op" id="2912925">+</span>&nbsp;<span class="num" id="2912927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912931">s</span><span class="op" id="2912932">.</span><span class="ident" id="2912933">next</span><span class="op" id="2912937">(</span><span class="op" id="2912938">)</span>&nbsp;<span class="comment" id="2912940">//&nbsp;consume&nbsp;initial&nbsp;&#39;/&#39;&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912970">}</span><span class="op" id="2912971">(</span><span class="ident" id="2912972">s</span><span class="op" id="2912973">.</span><span class="ident" id="2912974">offset</span>&nbsp;<span class="op" id="2912981">-</span>&nbsp;<span class="num" id="2912983">1</span><span class="op" id="2912984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912988">//&nbsp;read&nbsp;ahead&nbsp;until&nbsp;a&nbsp;newline,&nbsp;EOF,&nbsp;or&nbsp;non-comment&nbsp;token&nbsp;is&nbsp;found</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913055">for</span>&nbsp;<span class="ident" id="2913059">s</span><span class="op" id="2913060">.</span><span class="ident" id="2913061">ch</span>&nbsp;<span class="op" id="2913064">==</span>&nbsp;<span class="string" id="2913067">&#39;/&#39;</span>&nbsp;<span class="op" id="2913071">||</span>&nbsp;<span class="ident" id="2913074">s</span><span class="op" id="2913075">.</span><span class="ident" id="2913076">ch</span>&nbsp;<span class="op" id="2913079">==</span>&nbsp;<span class="string" id="2913082">&#39;*&#39;</span>&nbsp;<span class="op" id="2913086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913090">if</span>&nbsp;<span class="ident" id="2913093">s</span><span class="op" id="2913094">.</span><span class="ident" id="2913095">ch</span>&nbsp;<span class="op" id="2913098">==</span>&nbsp;<span class="string" id="2913101">&#39;/&#39;</span>&nbsp;<span class="op" id="2913105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2913110">//-style&nbsp;comment&nbsp;always&nbsp;contains&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913156">return</span>&nbsp;<span class="builtintype" id="2913163">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913170">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2913174">/*-style&nbsp;comment:&nbsp;look&nbsp;for&nbsp;newline&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913214">s</span><span class="op" id="2913215">.</span><span class="ident" id="2913216">next</span><span class="op" id="2913220">(</span><span class="op" id="2913221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913225">for</span>&nbsp;<span class="ident" id="2913229">s</span><span class="op" id="2913230">.</span><span class="ident" id="2913231">ch</span>&nbsp;<span class="op" id="2913234">&gt;=</span>&nbsp;<span class="num" id="2913237">0</span>&nbsp;<span class="op" id="2913239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913244">ch</span>&nbsp;<span class="op" id="2913247">:=</span>&nbsp;<span class="ident" id="2913250">s</span><span class="op" id="2913251">.</span><span class="ident" id="2913252">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913258">if</span>&nbsp;<span class="ident" id="2913261">ch</span>&nbsp;<span class="op" id="2913264">==</span>&nbsp;<span class="string" id="2913267">&#39;\n&#39;</span>&nbsp;<span class="op" id="2913272">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913278">return</span>&nbsp;<span class="builtintype" id="2913285">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913298">s</span><span class="op" id="2913299">.</span><span class="ident" id="2913300">next</span><span class="op" id="2913304">(</span><span class="op" id="2913305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913310">if</span>&nbsp;<span class="ident" id="2913313">ch</span>&nbsp;<span class="op" id="2913316">==</span>&nbsp;<span class="string" id="2913319">&#39;*&#39;</span>&nbsp;<span class="op" id="2913323">&amp;&amp;</span>&nbsp;<span class="ident" id="2913326">s</span><span class="op" id="2913327">.</span><span class="ident" id="2913328">ch</span>&nbsp;<span class="op" id="2913331">==</span>&nbsp;<span class="string" id="2913334">&#39;/&#39;</span>&nbsp;<span class="op" id="2913338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913344">s</span><span class="op" id="2913345">.</span><span class="ident" id="2913346">next</span><span class="op" id="2913350">(</span><span class="op" id="2913351">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913357">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913374">s</span><span class="op" id="2913375">.</span><span class="ident" id="2913376">skipWhitespace</span><span class="op" id="2913390">(</span><span class="op" id="2913391">)</span>&nbsp;<span class="comment" id="2913393">//&nbsp;s.insertSemi&nbsp;is&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913418">if</span>&nbsp;<span class="ident" id="2913421">s</span><span class="op" id="2913422">.</span><span class="ident" id="2913423">ch</span>&nbsp;<span class="op" id="2913426">&lt;</span>&nbsp;<span class="num" id="2913428">0</span>&nbsp;<span class="op" id="2913430">||</span>&nbsp;<span class="ident" id="2913433">s</span><span class="op" id="2913434">.</span><span class="ident" id="2913435">ch</span>&nbsp;<span class="op" id="2913438">==</span>&nbsp;<span class="string" id="2913441">&#39;\n&#39;</span>&nbsp;<span class="op" id="2913446">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913451">return</span>&nbsp;<span class="builtintype" id="2913458">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913469">if</span>&nbsp;<span class="ident" id="2913472">s</span><span class="op" id="2913473">.</span><span class="ident" id="2913474">ch</span>&nbsp;<span class="op" id="2913477">!=</span>&nbsp;<span class="string" id="2913480">&#39;/&#39;</span>&nbsp;<span class="op" id="2913484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2913489">//&nbsp;non-comment&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913513">return</span>&nbsp;<span class="builtintype" id="2913520">false</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913532">s</span><span class="op" id="2913533">.</span><span class="ident" id="2913534">next</span><span class="op" id="2913538">(</span><span class="op" id="2913539">)</span>&nbsp;<span class="comment" id="2913541">//&nbsp;consume&nbsp;&#39;/&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913561">return</span>&nbsp;<span class="builtintype" id="2913568">false</span><br>
<span class="lineno">255</span><span class="op" id="2913574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2913577">func</span>&nbsp;<span class="ident" id="2913582">isLetter</span><span class="op" id="2913590">(</span><span class="ident" id="2913591">ch</span>&nbsp;<span class="builtintype" id="2913594">rune</span><span class="op" id="2913598">)</span>&nbsp;<span class="builtintype" id="2913600">bool</span>&nbsp;<span class="op" id="2913605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913608">return</span>&nbsp;<span class="string" id="2913615">&#39;a&#39;</span>&nbsp;<span class="op" id="2913619">&lt;=</span>&nbsp;<span class="ident" id="2913622">ch</span>&nbsp;<span class="op" id="2913625">&amp;&amp;</span>&nbsp;<span class="ident" id="2913628">ch</span>&nbsp;<span class="op" id="2913631">&lt;=</span>&nbsp;<span class="string" id="2913634">&#39;z&#39;</span>&nbsp;<span class="op" id="2913638">||</span>&nbsp;<span class="string" id="2913641">&#39;A&#39;</span>&nbsp;<span class="op" id="2913645">&lt;=</span>&nbsp;<span class="ident" id="2913648">ch</span>&nbsp;<span class="op" id="2913651">&amp;&amp;</span>&nbsp;<span class="ident" id="2913654">ch</span>&nbsp;<span class="op" id="2913657">&lt;=</span>&nbsp;<span class="string" id="2913660">&#39;Z&#39;</span>&nbsp;<span class="op" id="2913664">||</span>&nbsp;<span class="ident" id="2913667">ch</span>&nbsp;<span class="op" id="2913670">==</span>&nbsp;<span class="string" id="2913673">&#39;_&#39;</span>&nbsp;<span class="op" id="2913677">||</span>&nbsp;<span class="ident" id="2913680">ch</span>&nbsp;<span class="op" id="2913683">&gt;=</span>&nbsp;<span class="num" id="2913686">0x80</span>&nbsp;<span class="op" id="2913691">&amp;&amp;</span>&nbsp;<span class="ident" id="2913694">unicode</span><span class="op" id="2913701">.</span><span class="ident" id="2913702">IsLetter</span><span class="op" id="2913710">(</span><span class="ident" id="2913711">ch</span><span class="op" id="2913713">)</span><br>
<span class="lineno"></span><span class="op" id="2913715">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="2913718">func</span>&nbsp;<span class="ident" id="2913723">isDigit</span><span class="op" id="2913730">(</span><span class="ident" id="2913731">ch</span>&nbsp;<span class="builtintype" id="2913734">rune</span><span class="op" id="2913738">)</span>&nbsp;<span class="builtintype" id="2913740">bool</span>&nbsp;<span class="op" id="2913745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913748">return</span>&nbsp;<span class="string" id="2913755">&#39;0&#39;</span>&nbsp;<span class="op" id="2913759">&lt;=</span>&nbsp;<span class="ident" id="2913762">ch</span>&nbsp;<span class="op" id="2913765">&amp;&amp;</span>&nbsp;<span class="ident" id="2913768">ch</span>&nbsp;<span class="op" id="2913771">&lt;=</span>&nbsp;<span class="string" id="2913774">&#39;9&#39;</span>&nbsp;<span class="op" id="2913778">||</span>&nbsp;<span class="ident" id="2913781">ch</span>&nbsp;<span class="op" id="2913784">&gt;=</span>&nbsp;<span class="num" id="2913787">0x80</span>&nbsp;<span class="op" id="2913792">&amp;&amp;</span>&nbsp;<span class="ident" id="2913795">unicode</span><span class="op" id="2913802">.</span><span class="ident" id="2913803">IsDigit</span><span class="op" id="2913810">(</span><span class="ident" id="2913811">ch</span><span class="op" id="2913813">)</span><br>
<span class="lineno"></span><span class="op" id="2913815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="2913818">func</span>&nbsp;<span class="op" id="2913823">(</span><span class="ident" id="2913824">s</span>&nbsp;<span class="op" id="2913826">*</span><span class="ident" id="2913827">Scanner</span><span class="op" id="2913834">)</span>&nbsp;<span class="ident" id="2913836">scanIdentifier</span><span class="op" id="2913850">(</span><span class="op" id="2913851">)</span>&nbsp;<span class="builtintype" id="2913853">string</span>&nbsp;<span class="op" id="2913860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913863">offs</span>&nbsp;<span class="op" id="2913868">:=</span>&nbsp;<span class="ident" id="2913871">s</span><span class="op" id="2913872">.</span><span class="ident" id="2913873">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913881">for</span>&nbsp;<span class="ident" id="2913885">isLetter</span><span class="op" id="2913893">(</span><span class="ident" id="2913894">s</span><span class="op" id="2913895">.</span><span class="ident" id="2913896">ch</span><span class="op" id="2913898">)</span>&nbsp;<span class="op" id="2913900">||</span>&nbsp;<span class="ident" id="2913903">isDigit</span><span class="op" id="2913910">(</span><span class="ident" id="2913911">s</span><span class="op" id="2913912">.</span><span class="ident" id="2913913">ch</span><span class="op" id="2913915">)</span>&nbsp;<span class="op" id="2913917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913921">s</span><span class="op" id="2913922">.</span><span class="ident" id="2913923">next</span><span class="op" id="2913927">(</span><span class="op" id="2913928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913931">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913934">return</span>&nbsp;<span class="builtintype" id="2913941">string</span><span class="op" id="2913947">(</span><span class="ident" id="2913948">s</span><span class="op" id="2913949">.</span><span class="ident" id="2913950">src</span><span class="op" id="2913953">[</span><span class="ident" id="2913954">offs</span><span class="op" id="2913958">:</span><span class="ident" id="2913959">s</span><span class="op" id="2913960">.</span><span class="ident" id="2913961">offset</span><span class="op" id="2913967">]</span><span class="op" id="2913968">)</span><br>
<span class="lineno"></span><span class="op" id="2913970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2913973">func</span>&nbsp;<span class="ident" id="2913978">digitVal</span><span class="op" id="2913986">(</span><span class="ident" id="2913987">ch</span>&nbsp;<span class="builtintype" id="2913990">rune</span><span class="op" id="2913994">)</span>&nbsp;<span class="builtintype" id="2913996">int</span>&nbsp;<span class="op" id="2914000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914003">switch</span>&nbsp;<span class="op" id="2914010">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914013">case</span>&nbsp;<span class="string" id="2914018">&#39;0&#39;</span>&nbsp;<span class="op" id="2914022">&lt;=</span>&nbsp;<span class="ident" id="2914025">ch</span>&nbsp;<span class="op" id="2914028">&amp;&amp;</span>&nbsp;<span class="ident" id="2914031">ch</span>&nbsp;<span class="op" id="2914034">&lt;=</span>&nbsp;<span class="string" id="2914037">&#39;9&#39;</span><span class="op" id="2914040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914044">return</span>&nbsp;<span class="builtintype" id="2914051">int</span><span class="op" id="2914054">(</span><span class="ident" id="2914055">ch</span>&nbsp;<span class="op" id="2914058">-</span>&nbsp;<span class="string" id="2914060">&#39;0&#39;</span><span class="op" id="2914063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914066">case</span>&nbsp;<span class="string" id="2914071">&#39;a&#39;</span>&nbsp;<span class="op" id="2914075">&lt;=</span>&nbsp;<span class="ident" id="2914078">ch</span>&nbsp;<span class="op" id="2914081">&amp;&amp;</span>&nbsp;<span class="ident" id="2914084">ch</span>&nbsp;<span class="op" id="2914087">&lt;=</span>&nbsp;<span class="string" id="2914090">&#39;f&#39;</span><span class="op" id="2914093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914097">return</span>&nbsp;<span class="builtintype" id="2914104">int</span><span class="op" id="2914107">(</span><span class="ident" id="2914108">ch</span>&nbsp;<span class="op" id="2914111">-</span>&nbsp;<span class="string" id="2914113">&#39;a&#39;</span>&nbsp;<span class="op" id="2914117">+</span>&nbsp;<span class="num" id="2914119">10</span><span class="op" id="2914121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914124">case</span>&nbsp;<span class="string" id="2914129">&#39;A&#39;</span>&nbsp;<span class="op" id="2914133">&lt;=</span>&nbsp;<span class="ident" id="2914136">ch</span>&nbsp;<span class="op" id="2914139">&amp;&amp;</span>&nbsp;<span class="ident" id="2914142">ch</span>&nbsp;<span class="op" id="2914145">&lt;=</span>&nbsp;<span class="string" id="2914148">&#39;F&#39;</span><span class="op" id="2914151">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914155">return</span>&nbsp;<span class="builtintype" id="2914162">int</span><span class="op" id="2914165">(</span><span class="ident" id="2914166">ch</span>&nbsp;<span class="op" id="2914169">-</span>&nbsp;<span class="string" id="2914171">&#39;A&#39;</span>&nbsp;<span class="op" id="2914175">+</span>&nbsp;<span class="num" id="2914177">10</span><span class="op" id="2914179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914185">return</span>&nbsp;<span class="num" id="2914192">16</span>&nbsp;<span class="comment" id="2914195">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;legal&nbsp;digit&nbsp;val</span><br>
<span class="lineno"></span><span class="op" id="2914230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="2914233">func</span>&nbsp;<span class="op" id="2914238">(</span><span class="ident" id="2914239">s</span>&nbsp;<span class="op" id="2914241">*</span><span class="ident" id="2914242">Scanner</span><span class="op" id="2914249">)</span>&nbsp;<span class="ident" id="2914251">scanMantissa</span><span class="op" id="2914263">(</span><span class="ident" id="2914264">base</span>&nbsp;<span class="builtintype" id="2914269">int</span><span class="op" id="2914272">)</span>&nbsp;<span class="op" id="2914274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914277">for</span>&nbsp;<span class="ident" id="2914281">digitVal</span><span class="op" id="2914289">(</span><span class="ident" id="2914290">s</span><span class="op" id="2914291">.</span><span class="ident" id="2914292">ch</span><span class="op" id="2914294">)</span>&nbsp;<span class="op" id="2914296">&lt;</span>&nbsp;<span class="ident" id="2914298">base</span>&nbsp;<span class="op" id="2914303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914307">s</span><span class="op" id="2914308">.</span><span class="ident" id="2914309">next</span><span class="op" id="2914313">(</span><span class="op" id="2914314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914317">}</span><br>
<span class="lineno"></span><span class="op" id="2914319">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="keyword" id="2914322">func</span>&nbsp;<span class="op" id="2914327">(</span><span class="ident" id="2914328">s</span>&nbsp;<span class="op" id="2914330">*</span><span class="ident" id="2914331">Scanner</span><span class="op" id="2914338">)</span>&nbsp;<span class="ident" id="2914340">scanNumber</span><span class="op" id="2914350">(</span><span class="ident" id="2914351">seenDecimalPoint</span>&nbsp;<span class="builtintype" id="2914368">bool</span><span class="op" id="2914372">)</span>&nbsp;<span class="op" id="2914374">(</span><span class="ident" id="2914375">token</span><span class="op" id="2914380">.</span><span class="ident" id="2914381">Token</span><span class="op" id="2914386">,</span>&nbsp;<span class="builtintype" id="2914388">string</span><span class="op" id="2914394">)</span>&nbsp;<span class="op" id="2914396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2914399">//&nbsp;digitVal(s.ch)&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914423">offs</span>&nbsp;<span class="op" id="2914428">:=</span>&nbsp;<span class="ident" id="2914431">s</span><span class="op" id="2914432">.</span><span class="ident" id="2914433">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914441">tok</span>&nbsp;<span class="op" id="2914445">:=</span>&nbsp;<span class="ident" id="2914448">token</span><span class="op" id="2914453">.</span><span class="ident" id="2914454">INT</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914460">if</span>&nbsp;<span class="ident" id="2914463">seenDecimalPoint</span>&nbsp;<span class="op" id="2914480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914484">offs</span><span class="op" id="2914488">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914493">tok</span>&nbsp;<span class="op" id="2914497">=</span>&nbsp;<span class="ident" id="2914499">token</span><span class="op" id="2914504">.</span><span class="ident" id="2914505">FLOAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914513">s</span><span class="op" id="2914514">.</span><span class="ident" id="2914515">scanMantissa</span><span class="op" id="2914527">(</span><span class="num" id="2914528">10</span><span class="op" id="2914530">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914534">goto</span>&nbsp;<span class="ident" id="2914539">exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914553">if</span>&nbsp;<span class="ident" id="2914556">s</span><span class="op" id="2914557">.</span><span class="ident" id="2914558">ch</span>&nbsp;<span class="op" id="2914561">==</span>&nbsp;<span class="string" id="2914564">&#39;0&#39;</span>&nbsp;<span class="op" id="2914568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2914572">//&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914590">offs</span>&nbsp;<span class="op" id="2914595">:=</span>&nbsp;<span class="ident" id="2914598">s</span><span class="op" id="2914599">.</span><span class="ident" id="2914600">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914609">s</span><span class="op" id="2914610">.</span><span class="ident" id="2914611">next</span><span class="op" id="2914615">(</span><span class="op" id="2914616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914620">if</span>&nbsp;<span class="ident" id="2914623">s</span><span class="op" id="2914624">.</span><span class="ident" id="2914625">ch</span>&nbsp;<span class="op" id="2914628">==</span>&nbsp;<span class="string" id="2914631">&#39;x&#39;</span>&nbsp;<span class="op" id="2914635">||</span>&nbsp;<span class="ident" id="2914638">s</span><span class="op" id="2914639">.</span><span class="ident" id="2914640">ch</span>&nbsp;<span class="op" id="2914643">==</span>&nbsp;<span class="string" id="2914646">&#39;X&#39;</span>&nbsp;<span class="op" id="2914650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2914655">//&nbsp;hexadecimal&nbsp;int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914677">s</span><span class="op" id="2914678">.</span><span class="ident" id="2914679">next</span><span class="op" id="2914683">(</span><span class="op" id="2914684">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914689">s</span><span class="op" id="2914690">.</span><span class="ident" id="2914691">scanMantissa</span><span class="op" id="2914703">(</span><span class="num" id="2914704">16</span><span class="op" id="2914706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914711">if</span>&nbsp;<span class="ident" id="2914714">s</span><span class="op" id="2914715">.</span><span class="ident" id="2914716">offset</span><span class="op" id="2914722">-</span><span class="ident" id="2914723">offs</span>&nbsp;<span class="op" id="2914728">&lt;=</span>&nbsp;<span class="num" id="2914731">2</span>&nbsp;<span class="op" id="2914733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2914739">//&nbsp;only&nbsp;scanned&nbsp;&#34;0x&#34;&nbsp;or&nbsp;&#34;0X&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914772">s</span><span class="op" id="2914773">.</span><span class="builtintype" id="2914774">error</span><span class="op" id="2914779">(</span><span class="ident" id="2914780">offs</span><span class="op" id="2914784">,</span>&nbsp;<span class="string" id="2914786">&#34;illegal&nbsp;hexadecimal&nbsp;number&#34;</span><span class="op" id="2914814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914819">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914823">}</span>&nbsp;<span class="keyword" id="2914825">else</span>&nbsp;<span class="op" id="2914830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2914835">//&nbsp;octal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914860">seenDecimalDigit</span>&nbsp;<span class="op" id="2914877">:=</span>&nbsp;<span class="builtintype" id="2914880">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914889">s</span><span class="op" id="2914890">.</span><span class="ident" id="2914891">scanMantissa</span><span class="op" id="2914903">(</span><span class="num" id="2914904">8</span><span class="op" id="2914905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914910">if</span>&nbsp;<span class="ident" id="2914913">s</span><span class="op" id="2914914">.</span><span class="ident" id="2914915">ch</span>&nbsp;<span class="op" id="2914918">==</span>&nbsp;<span class="string" id="2914921">&#39;8&#39;</span>&nbsp;<span class="op" id="2914925">||</span>&nbsp;<span class="ident" id="2914928">s</span><span class="op" id="2914929">.</span><span class="ident" id="2914930">ch</span>&nbsp;<span class="op" id="2914933">==</span>&nbsp;<span class="string" id="2914936">&#39;9&#39;</span>&nbsp;<span class="op" id="2914940">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2914946">//&nbsp;illegal&nbsp;octal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914980">seenDecimalDigit</span>&nbsp;<span class="op" id="2914997">=</span>&nbsp;<span class="builtintype" id="2914999">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915008">s</span><span class="op" id="2915009">.</span><span class="ident" id="2915010">scanMantissa</span><span class="op" id="2915022">(</span><span class="num" id="2915023">10</span><span class="op" id="2915025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915035">if</span>&nbsp;<span class="ident" id="2915038">s</span><span class="op" id="2915039">.</span><span class="ident" id="2915040">ch</span>&nbsp;<span class="op" id="2915043">==</span>&nbsp;<span class="string" id="2915046">&#39;.&#39;</span>&nbsp;<span class="op" id="2915050">||</span>&nbsp;<span class="ident" id="2915053">s</span><span class="op" id="2915054">.</span><span class="ident" id="2915055">ch</span>&nbsp;<span class="op" id="2915058">==</span>&nbsp;<span class="string" id="2915061">&#39;e&#39;</span>&nbsp;<span class="op" id="2915065">||</span>&nbsp;<span class="ident" id="2915068">s</span><span class="op" id="2915069">.</span><span class="ident" id="2915070">ch</span>&nbsp;<span class="op" id="2915073">==</span>&nbsp;<span class="string" id="2915076">&#39;E&#39;</span>&nbsp;<span class="op" id="2915080">||</span>&nbsp;<span class="ident" id="2915083">s</span><span class="op" id="2915084">.</span><span class="ident" id="2915085">ch</span>&nbsp;<span class="op" id="2915088">==</span>&nbsp;<span class="string" id="2915091">&#39;i&#39;</span>&nbsp;<span class="op" id="2915095">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915101">goto</span>&nbsp;<span class="ident" id="2915106">fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2915123">//&nbsp;octal&nbsp;int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915139">if</span>&nbsp;<span class="ident" id="2915142">seenDecimalDigit</span>&nbsp;<span class="op" id="2915159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915165">s</span><span class="op" id="2915166">.</span><span class="builtintype" id="2915167">error</span><span class="op" id="2915172">(</span><span class="ident" id="2915173">offs</span><span class="op" id="2915177">,</span>&nbsp;<span class="string" id="2915179">&#34;illegal&nbsp;octal&nbsp;number&#34;</span><span class="op" id="2915201">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915214">goto</span>&nbsp;<span class="ident" id="2915219">exit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2915229">//&nbsp;decimal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915254">s</span><span class="op" id="2915255">.</span><span class="ident" id="2915256">scanMantissa</span><span class="op" id="2915268">(</span><span class="num" id="2915269">10</span><span class="op" id="2915271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2915274">fraction</span><span class="op" id="2915282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915285">if</span>&nbsp;<span class="ident" id="2915288">s</span><span class="op" id="2915289">.</span><span class="ident" id="2915290">ch</span>&nbsp;<span class="op" id="2915293">==</span>&nbsp;<span class="string" id="2915296">&#39;.&#39;</span>&nbsp;<span class="op" id="2915300">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915304">tok</span>&nbsp;<span class="op" id="2915308">=</span>&nbsp;<span class="ident" id="2915310">token</span><span class="op" id="2915315">.</span><span class="ident" id="2915316">FLOAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915324">s</span><span class="op" id="2915325">.</span><span class="ident" id="2915326">next</span><span class="op" id="2915330">(</span><span class="op" id="2915331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915335">s</span><span class="op" id="2915336">.</span><span class="ident" id="2915337">scanMantissa</span><span class="op" id="2915349">(</span><span class="num" id="2915350">10</span><span class="op" id="2915352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="ident" id="2915358">exponent</span><span class="op" id="2915366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915369">if</span>&nbsp;<span class="ident" id="2915372">s</span><span class="op" id="2915373">.</span><span class="ident" id="2915374">ch</span>&nbsp;<span class="op" id="2915377">==</span>&nbsp;<span class="string" id="2915380">&#39;e&#39;</span>&nbsp;<span class="op" id="2915384">||</span>&nbsp;<span class="ident" id="2915387">s</span><span class="op" id="2915388">.</span><span class="ident" id="2915389">ch</span>&nbsp;<span class="op" id="2915392">==</span>&nbsp;<span class="string" id="2915395">&#39;E&#39;</span>&nbsp;<span class="op" id="2915399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915403">tok</span>&nbsp;<span class="op" id="2915407">=</span>&nbsp;<span class="ident" id="2915409">token</span><span class="op" id="2915414">.</span><span class="ident" id="2915415">FLOAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915423">s</span><span class="op" id="2915424">.</span><span class="ident" id="2915425">next</span><span class="op" id="2915429">(</span><span class="op" id="2915430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915434">if</span>&nbsp;<span class="ident" id="2915437">s</span><span class="op" id="2915438">.</span><span class="ident" id="2915439">ch</span>&nbsp;<span class="op" id="2915442">==</span>&nbsp;<span class="string" id="2915445">&#39;-&#39;</span>&nbsp;<span class="op" id="2915449">||</span>&nbsp;<span class="ident" id="2915452">s</span><span class="op" id="2915453">.</span><span class="ident" id="2915454">ch</span>&nbsp;<span class="op" id="2915457">==</span>&nbsp;<span class="string" id="2915460">&#39;+&#39;</span>&nbsp;<span class="op" id="2915464">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915469">s</span><span class="op" id="2915470">.</span><span class="ident" id="2915471">next</span><span class="op" id="2915475">(</span><span class="op" id="2915476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915484">s</span><span class="op" id="2915485">.</span><span class="ident" id="2915486">scanMantissa</span><span class="op" id="2915498">(</span><span class="num" id="2915499">10</span><span class="op" id="2915501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915508">if</span>&nbsp;<span class="ident" id="2915511">s</span><span class="op" id="2915512">.</span><span class="ident" id="2915513">ch</span>&nbsp;<span class="op" id="2915516">==</span>&nbsp;<span class="string" id="2915519">&#39;i&#39;</span>&nbsp;<span class="op" id="2915523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915527">tok</span>&nbsp;<span class="op" id="2915531">=</span>&nbsp;<span class="ident" id="2915533">token</span><span class="op" id="2915538">.</span><span class="ident" id="2915539">IMAG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915546">s</span><span class="op" id="2915547">.</span><span class="ident" id="2915548">next</span><span class="op" id="2915552">(</span><span class="op" id="2915553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="ident" id="2915559">exit</span><span class="op" id="2915563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915566">return</span>&nbsp;<span class="ident" id="2915573">tok</span><span class="op" id="2915576">,</span>&nbsp;<span class="builtintype" id="2915578">string</span><span class="op" id="2915584">(</span><span class="ident" id="2915585">s</span><span class="op" id="2915586">.</span><span class="ident" id="2915587">src</span><span class="op" id="2915590">[</span><span class="ident" id="2915591">offs</span><span class="op" id="2915595">:</span><span class="ident" id="2915596">s</span><span class="op" id="2915597">.</span><span class="ident" id="2915598">offset</span><span class="op" id="2915604">]</span><span class="op" id="2915605">)</span><br>
<span class="lineno"></span><span class="op" id="2915607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2915610">//&nbsp;scanEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;where&nbsp;rune&nbsp;is&nbsp;the&nbsp;accepted</span><br>
<span class="lineno">365</span><span class="comment" id="2915677">//&nbsp;escaped&nbsp;quote.&nbsp;In&nbsp;case&nbsp;of&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;it&nbsp;stops&nbsp;at&nbsp;the&nbsp;offending</span><br>
<span class="lineno"></span><span class="comment" id="2915748">//&nbsp;character&nbsp;(without&nbsp;consuming&nbsp;it)&nbsp;and&nbsp;returns&nbsp;false.&nbsp;Otherwise</span><br>
<span class="lineno"></span><span class="comment" id="2915813">//&nbsp;it&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="2915833">func</span>&nbsp;<span class="op" id="2915838">(</span><span class="ident" id="2915839">s</span>&nbsp;<span class="op" id="2915841">*</span><span class="ident" id="2915842">Scanner</span><span class="op" id="2915849">)</span>&nbsp;<span class="ident" id="2915851">scanEscape</span><span class="op" id="2915861">(</span><span class="ident" id="2915862">quote</span>&nbsp;<span class="builtintype" id="2915868">rune</span><span class="op" id="2915872">)</span>&nbsp;<span class="builtintype" id="2915874">bool</span>&nbsp;<span class="op" id="2915879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915882">offs</span>&nbsp;<span class="op" id="2915887">:=</span>&nbsp;<span class="ident" id="2915890">s</span><span class="op" id="2915891">.</span><span class="ident" id="2915892">offset</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915901">var</span>&nbsp;<span class="ident" id="2915905">n</span>&nbsp;<span class="builtintype" id="2915907">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915912">var</span>&nbsp;<span class="ident" id="2915916">base</span><span class="op" id="2915920">,</span>&nbsp;<span class="ident" id="2915922">max</span>&nbsp;<span class="builtintype" id="2915926">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915934">switch</span>&nbsp;<span class="ident" id="2915941">s</span><span class="op" id="2915942">.</span><span class="ident" id="2915943">ch</span>&nbsp;<span class="op" id="2915946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915949">case</span>&nbsp;<span class="string" id="2915954">&#39;a&#39;</span><span class="op" id="2915957">,</span>&nbsp;<span class="string" id="2915959">&#39;b&#39;</span><span class="op" id="2915962">,</span>&nbsp;<span class="string" id="2915964">&#39;f&#39;</span><span class="op" id="2915967">,</span>&nbsp;<span class="string" id="2915969">&#39;n&#39;</span><span class="op" id="2915972">,</span>&nbsp;<span class="string" id="2915974">&#39;r&#39;</span><span class="op" id="2915977">,</span>&nbsp;<span class="string" id="2915979">&#39;t&#39;</span><span class="op" id="2915982">,</span>&nbsp;<span class="string" id="2915984">&#39;v&#39;</span><span class="op" id="2915987">,</span>&nbsp;<span class="string" id="2915989">&#39;\\&#39;</span><span class="op" id="2915993">,</span>&nbsp;<span class="ident" id="2915995">quote</span><span class="op" id="2916000">:</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916004">s</span><span class="op" id="2916005">.</span><span class="ident" id="2916006">next</span><span class="op" id="2916010">(</span><span class="op" id="2916011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916015">return</span>&nbsp;<span class="builtintype" id="2916022">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916028">case</span>&nbsp;<span class="string" id="2916033">&#39;0&#39;</span><span class="op" id="2916036">,</span>&nbsp;<span class="string" id="2916038">&#39;1&#39;</span><span class="op" id="2916041">,</span>&nbsp;<span class="string" id="2916043">&#39;2&#39;</span><span class="op" id="2916046">,</span>&nbsp;<span class="string" id="2916048">&#39;3&#39;</span><span class="op" id="2916051">,</span>&nbsp;<span class="string" id="2916053">&#39;4&#39;</span><span class="op" id="2916056">,</span>&nbsp;<span class="string" id="2916058">&#39;5&#39;</span><span class="op" id="2916061">,</span>&nbsp;<span class="string" id="2916063">&#39;6&#39;</span><span class="op" id="2916066">,</span>&nbsp;<span class="string" id="2916068">&#39;7&#39;</span><span class="op" id="2916071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916075">n</span><span class="op" id="2916076">,</span>&nbsp;<span class="ident" id="2916078">base</span><span class="op" id="2916082">,</span>&nbsp;<span class="ident" id="2916084">max</span>&nbsp;<span class="op" id="2916088">=</span>&nbsp;<span class="num" id="2916090">3</span><span class="op" id="2916091">,</span>&nbsp;<span class="num" id="2916093">8</span><span class="op" id="2916094">,</span>&nbsp;<span class="num" id="2916096">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916101">case</span>&nbsp;<span class="string" id="2916106">&#39;x&#39;</span><span class="op" id="2916109">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916113">s</span><span class="op" id="2916114">.</span><span class="ident" id="2916115">next</span><span class="op" id="2916119">(</span><span class="op" id="2916120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916124">n</span><span class="op" id="2916125">,</span>&nbsp;<span class="ident" id="2916127">base</span><span class="op" id="2916131">,</span>&nbsp;<span class="ident" id="2916133">max</span>&nbsp;<span class="op" id="2916137">=</span>&nbsp;<span class="num" id="2916139">2</span><span class="op" id="2916140">,</span>&nbsp;<span class="num" id="2916142">16</span><span class="op" id="2916144">,</span>&nbsp;<span class="num" id="2916146">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916151">case</span>&nbsp;<span class="string" id="2916156">&#39;u&#39;</span><span class="op" id="2916159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916163">s</span><span class="op" id="2916164">.</span><span class="ident" id="2916165">next</span><span class="op" id="2916169">(</span><span class="op" id="2916170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916174">n</span><span class="op" id="2916175">,</span>&nbsp;<span class="ident" id="2916177">base</span><span class="op" id="2916181">,</span>&nbsp;<span class="ident" id="2916183">max</span>&nbsp;<span class="op" id="2916187">=</span>&nbsp;<span class="num" id="2916189">4</span><span class="op" id="2916190">,</span>&nbsp;<span class="num" id="2916192">16</span><span class="op" id="2916194">,</span>&nbsp;<span class="ident" id="2916196">unicode</span><span class="op" id="2916203">.</span><span class="ident" id="2916204">MaxRune</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916213">case</span>&nbsp;<span class="string" id="2916218">&#39;U&#39;</span><span class="op" id="2916221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916225">s</span><span class="op" id="2916226">.</span><span class="ident" id="2916227">next</span><span class="op" id="2916231">(</span><span class="op" id="2916232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916236">n</span><span class="op" id="2916237">,</span>&nbsp;<span class="ident" id="2916239">base</span><span class="op" id="2916243">,</span>&nbsp;<span class="ident" id="2916245">max</span>&nbsp;<span class="op" id="2916249">=</span>&nbsp;<span class="num" id="2916251">8</span><span class="op" id="2916252">,</span>&nbsp;<span class="num" id="2916254">16</span><span class="op" id="2916256">,</span>&nbsp;<span class="ident" id="2916258">unicode</span><span class="op" id="2916265">.</span><span class="ident" id="2916266">MaxRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916275">default</span><span class="op" id="2916282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916286">msg</span>&nbsp;<span class="op" id="2916290">:=</span>&nbsp;<span class="string" id="2916293">&#34;unknown&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916321">if</span>&nbsp;<span class="ident" id="2916324">s</span><span class="op" id="2916325">.</span><span class="ident" id="2916326">ch</span>&nbsp;<span class="op" id="2916329">&lt;</span>&nbsp;<span class="num" id="2916331">0</span>&nbsp;<span class="op" id="2916333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916338">msg</span>&nbsp;<span class="op" id="2916342">=</span>&nbsp;<span class="string" id="2916344">&#34;escape&nbsp;sequence&nbsp;not&nbsp;terminated&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916383">s</span><span class="op" id="2916384">.</span><span class="builtintype" id="2916385">error</span><span class="op" id="2916390">(</span><span class="ident" id="2916391">offs</span><span class="op" id="2916395">,</span>&nbsp;<span class="ident" id="2916397">msg</span><span class="op" id="2916400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916404">return</span>&nbsp;<span class="builtintype" id="2916411">false</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916422">var</span>&nbsp;<span class="ident" id="2916426">x</span>&nbsp;<span class="builtintype" id="2916428">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916436">for</span>&nbsp;<span class="ident" id="2916440">n</span>&nbsp;<span class="op" id="2916442">&gt;</span>&nbsp;<span class="num" id="2916444">0</span>&nbsp;<span class="op" id="2916446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916450">d</span>&nbsp;<span class="op" id="2916452">:=</span>&nbsp;<span class="builtintype" id="2916455">uint32</span><span class="op" id="2916461">(</span><span class="ident" id="2916462">digitVal</span><span class="op" id="2916470">(</span><span class="ident" id="2916471">s</span><span class="op" id="2916472">.</span><span class="ident" id="2916473">ch</span><span class="op" id="2916475">)</span><span class="op" id="2916476">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916480">if</span>&nbsp;<span class="ident" id="2916483">d</span>&nbsp;<span class="op" id="2916485">&gt;=</span>&nbsp;<span class="ident" id="2916488">base</span>&nbsp;<span class="op" id="2916493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916498">msg</span>&nbsp;<span class="op" id="2916502">:=</span>&nbsp;<span class="ident" id="2916505">fmt</span><span class="op" id="2916508">.</span><span class="ident" id="2916509">Sprintf</span><span class="op" id="2916516">(</span><span class="string" id="2916517">&#34;illegal&nbsp;character&nbsp;%#U&nbsp;in&nbsp;escape&nbsp;sequence&#34;</span><span class="op" id="2916559">,</span>&nbsp;<span class="ident" id="2916561">s</span><span class="op" id="2916562">.</span><span class="ident" id="2916563">ch</span><span class="op" id="2916565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916570">if</span>&nbsp;<span class="ident" id="2916573">s</span><span class="op" id="2916574">.</span><span class="ident" id="2916575">ch</span>&nbsp;<span class="op" id="2916578">&lt;</span>&nbsp;<span class="num" id="2916580">0</span>&nbsp;<span class="op" id="2916582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916588">msg</span>&nbsp;<span class="op" id="2916592">=</span>&nbsp;<span class="string" id="2916594">&#34;escape&nbsp;sequence&nbsp;not&nbsp;terminated&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916630">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916635">s</span><span class="op" id="2916636">.</span><span class="builtintype" id="2916637">error</span><span class="op" id="2916642">(</span><span class="ident" id="2916643">s</span><span class="op" id="2916644">.</span><span class="ident" id="2916645">offset</span><span class="op" id="2916651">,</span>&nbsp;<span class="ident" id="2916653">msg</span><span class="op" id="2916656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916661">return</span>&nbsp;<span class="builtintype" id="2916668">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916680">x</span>&nbsp;<span class="op" id="2916682">=</span>&nbsp;<span class="ident" id="2916684">x</span><span class="op" id="2916685">*</span><span class="ident" id="2916686">base</span>&nbsp;<span class="op" id="2916691">+</span>&nbsp;<span class="ident" id="2916693">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916697">s</span><span class="op" id="2916698">.</span><span class="ident" id="2916699">next</span><span class="op" id="2916703">(</span><span class="op" id="2916704">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916708">n</span><span class="op" id="2916709">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916717">if</span>&nbsp;<span class="ident" id="2916720">x</span>&nbsp;<span class="op" id="2916722">&gt;</span>&nbsp;<span class="ident" id="2916724">max</span>&nbsp;<span class="op" id="2916728">||</span>&nbsp;<span class="num" id="2916731">0xD800</span>&nbsp;<span class="op" id="2916738">&lt;=</span>&nbsp;<span class="ident" id="2916741">x</span>&nbsp;<span class="op" id="2916743">&amp;&amp;</span>&nbsp;<span class="ident" id="2916746">x</span>&nbsp;<span class="op" id="2916748">&lt;</span>&nbsp;<span class="num" id="2916750">0xE000</span>&nbsp;<span class="op" id="2916757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916761">s</span><span class="op" id="2916762">.</span><span class="builtintype" id="2916763">error</span><span class="op" id="2916768">(</span><span class="ident" id="2916769">offs</span><span class="op" id="2916773">,</span>&nbsp;<span class="string" id="2916775">&#34;escape&nbsp;sequence&nbsp;is&nbsp;invalid&nbsp;Unicode&nbsp;code&nbsp;point&#34;</span><span class="op" id="2916822">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916826">return</span>&nbsp;<span class="builtintype" id="2916833">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916844">return</span>&nbsp;<span class="builtintype" id="2916851">true</span><br>
<span class="lineno"></span><span class="op" id="2916856">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="2916859">func</span>&nbsp;<span class="op" id="2916864">(</span><span class="ident" id="2916865">s</span>&nbsp;<span class="op" id="2916867">*</span><span class="ident" id="2916868">Scanner</span><span class="op" id="2916875">)</span>&nbsp;<span class="ident" id="2916877">scanRune</span><span class="op" id="2916885">(</span><span class="op" id="2916886">)</span>&nbsp;<span class="builtintype" id="2916888">string</span>&nbsp;<span class="op" id="2916895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2916898">//&nbsp;&#39;\&#39;&#39;&nbsp;opening&nbsp;already&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916932">offs</span>&nbsp;<span class="op" id="2916937">:=</span>&nbsp;<span class="ident" id="2916940">s</span><span class="op" id="2916941">.</span><span class="ident" id="2916942">offset</span>&nbsp;<span class="op" id="2916949">-</span>&nbsp;<span class="num" id="2916951">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916955">valid</span>&nbsp;<span class="op" id="2916961">:=</span>&nbsp;<span class="builtintype" id="2916964">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916970">n</span>&nbsp;<span class="op" id="2916972">:=</span>&nbsp;<span class="num" id="2916975">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916978">for</span>&nbsp;<span class="op" id="2916982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916986">ch</span>&nbsp;<span class="op" id="2916989">:=</span>&nbsp;<span class="ident" id="2916992">s</span><span class="op" id="2916993">.</span><span class="ident" id="2916994">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916999">if</span>&nbsp;<span class="ident" id="2917002">ch</span>&nbsp;<span class="op" id="2917005">==</span>&nbsp;<span class="string" id="2917008">&#39;\n&#39;</span>&nbsp;<span class="op" id="2917013">||</span>&nbsp;<span class="ident" id="2917016">ch</span>&nbsp;<span class="op" id="2917019">&lt;</span>&nbsp;<span class="num" id="2917021">0</span>&nbsp;<span class="op" id="2917023">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2917028">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;one&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917081">if</span>&nbsp;<span class="ident" id="2917084">valid</span>&nbsp;<span class="op" id="2917090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917096">s</span><span class="op" id="2917097">.</span><span class="builtintype" id="2917098">error</span><span class="op" id="2917103">(</span><span class="ident" id="2917104">offs</span><span class="op" id="2917108">,</span>&nbsp;<span class="string" id="2917110">&#34;rune&nbsp;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="2917139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917145">valid</span>&nbsp;<span class="op" id="2917151">=</span>&nbsp;<span class="builtintype" id="2917153">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917162">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917167">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917179">s</span><span class="op" id="2917180">.</span><span class="ident" id="2917181">next</span><span class="op" id="2917185">(</span><span class="op" id="2917186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917190">if</span>&nbsp;<span class="ident" id="2917193">ch</span>&nbsp;<span class="op" id="2917196">==</span>&nbsp;<span class="string" id="2917199">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2917204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917209">break</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917221">n</span><span class="op" id="2917222">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917227">if</span>&nbsp;<span class="ident" id="2917230">ch</span>&nbsp;<span class="op" id="2917233">==</span>&nbsp;<span class="string" id="2917236">&#39;\\&#39;</span>&nbsp;<span class="op" id="2917241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917246">if</span>&nbsp;<span class="op" id="2917249">!</span><span class="ident" id="2917250">s</span><span class="op" id="2917251">.</span><span class="ident" id="2917252">scanEscape</span><span class="op" id="2917262">(</span><span class="string" id="2917263">&#39;\&#39;&#39;</span><span class="op" id="2917267">)</span>&nbsp;<span class="op" id="2917269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917275">valid</span>&nbsp;<span class="op" id="2917281">=</span>&nbsp;<span class="builtintype" id="2917283">false</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2917297">//&nbsp;continue&nbsp;to&nbsp;read&nbsp;to&nbsp;closing&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917343">if</span>&nbsp;<span class="ident" id="2917346">valid</span>&nbsp;<span class="op" id="2917352">&amp;&amp;</span>&nbsp;<span class="ident" id="2917355">n</span>&nbsp;<span class="op" id="2917357">!=</span>&nbsp;<span class="num" id="2917360">1</span>&nbsp;<span class="op" id="2917362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917366">s</span><span class="op" id="2917367">.</span><span class="builtintype" id="2917368">error</span><span class="op" id="2917373">(</span><span class="ident" id="2917374">offs</span><span class="op" id="2917378">,</span>&nbsp;<span class="string" id="2917380">&#34;illegal&nbsp;rune&nbsp;literal&#34;</span><span class="op" id="2917402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917409">return</span>&nbsp;<span class="builtintype" id="2917416">string</span><span class="op" id="2917422">(</span><span class="ident" id="2917423">s</span><span class="op" id="2917424">.</span><span class="ident" id="2917425">src</span><span class="op" id="2917428">[</span><span class="ident" id="2917429">offs</span><span class="op" id="2917433">:</span><span class="ident" id="2917434">s</span><span class="op" id="2917435">.</span><span class="ident" id="2917436">offset</span><span class="op" id="2917442">]</span><span class="op" id="2917443">)</span><br>
<span class="lineno">455</span><span class="op" id="2917445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917448">func</span>&nbsp;<span class="op" id="2917453">(</span><span class="ident" id="2917454">s</span>&nbsp;<span class="op" id="2917456">*</span><span class="ident" id="2917457">Scanner</span><span class="op" id="2917464">)</span>&nbsp;<span class="ident" id="2917466">scanString</span><span class="op" id="2917476">(</span><span class="op" id="2917477">)</span>&nbsp;<span class="builtintype" id="2917479">string</span>&nbsp;<span class="op" id="2917486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2917489">//&nbsp;&#39;&#34;&#39;&nbsp;opening&nbsp;already&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917522">offs</span>&nbsp;<span class="op" id="2917527">:=</span>&nbsp;<span class="ident" id="2917530">s</span><span class="op" id="2917531">.</span><span class="ident" id="2917532">offset</span>&nbsp;<span class="op" id="2917539">-</span>&nbsp;<span class="num" id="2917541">1</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917545">for</span>&nbsp;<span class="op" id="2917549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917553">ch</span>&nbsp;<span class="op" id="2917556">:=</span>&nbsp;<span class="ident" id="2917559">s</span><span class="op" id="2917560">.</span><span class="ident" id="2917561">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917566">if</span>&nbsp;<span class="ident" id="2917569">ch</span>&nbsp;<span class="op" id="2917572">==</span>&nbsp;<span class="string" id="2917575">&#39;\n&#39;</span>&nbsp;<span class="op" id="2917580">||</span>&nbsp;<span class="ident" id="2917583">ch</span>&nbsp;<span class="op" id="2917586">&lt;</span>&nbsp;<span class="num" id="2917588">0</span>&nbsp;<span class="op" id="2917590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917595">s</span><span class="op" id="2917596">.</span><span class="builtintype" id="2917597">error</span><span class="op" id="2917602">(</span><span class="ident" id="2917603">offs</span><span class="op" id="2917607">,</span>&nbsp;<span class="string" id="2917609">&#34;string&nbsp;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="2917640">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917645">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917657">s</span><span class="op" id="2917658">.</span><span class="ident" id="2917659">next</span><span class="op" id="2917663">(</span><span class="op" id="2917664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917668">if</span>&nbsp;<span class="ident" id="2917671">ch</span>&nbsp;<span class="op" id="2917674">==</span>&nbsp;<span class="string" id="2917677">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2917681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917686">break</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917698">if</span>&nbsp;<span class="ident" id="2917701">ch</span>&nbsp;<span class="op" id="2917704">==</span>&nbsp;<span class="string" id="2917707">&#39;\\&#39;</span>&nbsp;<span class="op" id="2917712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917717">s</span><span class="op" id="2917718">.</span><span class="ident" id="2917719">scanEscape</span><span class="op" id="2917729">(</span><span class="string" id="2917730">&#39;&#34;&#39;</span><span class="op" id="2917733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917740">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917744">return</span>&nbsp;<span class="builtintype" id="2917751">string</span><span class="op" id="2917757">(</span><span class="ident" id="2917758">s</span><span class="op" id="2917759">.</span><span class="ident" id="2917760">src</span><span class="op" id="2917763">[</span><span class="ident" id="2917764">offs</span><span class="op" id="2917768">:</span><span class="ident" id="2917769">s</span><span class="op" id="2917770">.</span><span class="ident" id="2917771">offset</span><span class="op" id="2917777">]</span><span class="op" id="2917778">)</span><br>
<span class="lineno"></span><span class="op" id="2917780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917783">func</span>&nbsp;<span class="ident" id="2917788">stripCR</span><span class="op" id="2917795">(</span><span class="ident" id="2917796">b</span>&nbsp;<span class="op" id="2917798">[</span><span class="op" id="2917799">]</span><span class="builtintype" id="2917800">byte</span><span class="op" id="2917804">)</span>&nbsp;<span class="op" id="2917806">[</span><span class="op" id="2917807">]</span><span class="builtintype" id="2917808">byte</span>&nbsp;<span class="op" id="2917813">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917816">c</span>&nbsp;<span class="op" id="2917818">:=</span>&nbsp;<span class="builtinfunc" id="2917821">make</span><span class="op" id="2917825">(</span><span class="op" id="2917826">[</span><span class="op" id="2917827">]</span><span class="builtintype" id="2917828">byte</span><span class="op" id="2917832">,</span>&nbsp;<span class="builtinfunc" id="2917834">len</span><span class="op" id="2917837">(</span><span class="ident" id="2917838">b</span><span class="op" id="2917839">)</span><span class="op" id="2917840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917843">i</span>&nbsp;<span class="op" id="2917845">:=</span>&nbsp;<span class="num" id="2917848">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917851">for</span>&nbsp;<span class="ident" id="2917855">_</span><span class="op" id="2917856">,</span>&nbsp;<span class="ident" id="2917858">ch</span>&nbsp;<span class="op" id="2917861">:=</span>&nbsp;<span class="keyword" id="2917864">range</span>&nbsp;<span class="ident" id="2917870">b</span>&nbsp;<span class="op" id="2917872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917876">if</span>&nbsp;<span class="ident" id="2917879">ch</span>&nbsp;<span class="op" id="2917882">!=</span>&nbsp;<span class="string" id="2917885">&#39;\r&#39;</span>&nbsp;<span class="op" id="2917890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917895">c</span><span class="op" id="2917896">[</span><span class="ident" id="2917897">i</span><span class="op" id="2917898">]</span>&nbsp;<span class="op" id="2917900">=</span>&nbsp;<span class="ident" id="2917902">ch</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917908">i</span><span class="op" id="2917909">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917920">return</span>&nbsp;<span class="ident" id="2917927">c</span><span class="op" id="2917928">[</span><span class="op" id="2917929">:</span><span class="ident" id="2917930">i</span><span class="op" id="2917931">]</span><br>
<span class="lineno"></span><span class="op" id="2917933">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="2917936">func</span>&nbsp;<span class="op" id="2917941">(</span><span class="ident" id="2917942">s</span>&nbsp;<span class="op" id="2917944">*</span><span class="ident" id="2917945">Scanner</span><span class="op" id="2917952">)</span>&nbsp;<span class="ident" id="2917954">scanRawString</span><span class="op" id="2917967">(</span><span class="op" id="2917968">)</span>&nbsp;<span class="builtintype" id="2917970">string</span>&nbsp;<span class="op" id="2917977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2917980">//&nbsp;&#39;`&#39;&nbsp;opening&nbsp;already&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918013">offs</span>&nbsp;<span class="op" id="2918018">:=</span>&nbsp;<span class="ident" id="2918021">s</span><span class="op" id="2918022">.</span><span class="ident" id="2918023">offset</span>&nbsp;<span class="op" id="2918030">-</span>&nbsp;<span class="num" id="2918032">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918036">hasCR</span>&nbsp;<span class="op" id="2918042">:=</span>&nbsp;<span class="builtintype" id="2918045">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918052">for</span>&nbsp;<span class="op" id="2918056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918060">ch</span>&nbsp;<span class="op" id="2918063">:=</span>&nbsp;<span class="ident" id="2918066">s</span><span class="op" id="2918067">.</span><span class="ident" id="2918068">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918073">if</span>&nbsp;<span class="ident" id="2918076">ch</span>&nbsp;<span class="op" id="2918079">&lt;</span>&nbsp;<span class="num" id="2918081">0</span>&nbsp;<span class="op" id="2918083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918088">s</span><span class="op" id="2918089">.</span><span class="builtintype" id="2918090">error</span><span class="op" id="2918095">(</span><span class="ident" id="2918096">offs</span><span class="op" id="2918100">,</span>&nbsp;<span class="string" id="2918102">&#34;raw&nbsp;string&nbsp;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="2918137">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918142">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918154">s</span><span class="op" id="2918155">.</span><span class="ident" id="2918156">next</span><span class="op" id="2918160">(</span><span class="op" id="2918161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918165">if</span>&nbsp;<span class="ident" id="2918168">ch</span>&nbsp;<span class="op" id="2918171">==</span>&nbsp;<span class="string" id="2918174">&#39;`&#39;</span>&nbsp;<span class="op" id="2918178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918183">break</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918195">if</span>&nbsp;<span class="ident" id="2918198">ch</span>&nbsp;<span class="op" id="2918201">==</span>&nbsp;<span class="string" id="2918204">&#39;\r&#39;</span>&nbsp;<span class="op" id="2918209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918214">hasCR</span>&nbsp;<span class="op" id="2918220">=</span>&nbsp;<span class="builtintype" id="2918222">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918232">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918236">lit</span>&nbsp;<span class="op" id="2918240">:=</span>&nbsp;<span class="ident" id="2918243">s</span><span class="op" id="2918244">.</span><span class="ident" id="2918245">src</span><span class="op" id="2918248">[</span><span class="ident" id="2918249">offs</span><span class="op" id="2918253">:</span><span class="ident" id="2918254">s</span><span class="op" id="2918255">.</span><span class="ident" id="2918256">offset</span><span class="op" id="2918262">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918265">if</span>&nbsp;<span class="ident" id="2918268">hasCR</span>&nbsp;<span class="op" id="2918274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918278">lit</span>&nbsp;<span class="op" id="2918282">=</span>&nbsp;<span class="ident" id="2918284">stripCR</span><span class="op" id="2918291">(</span><span class="ident" id="2918292">lit</span><span class="op" id="2918295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918298">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918302">return</span>&nbsp;<span class="builtintype" id="2918309">string</span><span class="op" id="2918315">(</span><span class="ident" id="2918316">lit</span><span class="op" id="2918319">)</span><br>
<span class="lineno"></span><span class="op" id="2918321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2918324">func</span>&nbsp;<span class="op" id="2918329">(</span><span class="ident" id="2918330">s</span>&nbsp;<span class="op" id="2918332">*</span><span class="ident" id="2918333">Scanner</span><span class="op" id="2918340">)</span>&nbsp;<span class="ident" id="2918342">skipWhitespace</span><span class="op" id="2918356">(</span><span class="op" id="2918357">)</span>&nbsp;<span class="op" id="2918359">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918362">for</span>&nbsp;<span class="ident" id="2918366">s</span><span class="op" id="2918367">.</span><span class="ident" id="2918368">ch</span>&nbsp;<span class="op" id="2918371">==</span>&nbsp;<span class="string" id="2918374">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2918378">||</span>&nbsp;<span class="ident" id="2918381">s</span><span class="op" id="2918382">.</span><span class="ident" id="2918383">ch</span>&nbsp;<span class="op" id="2918386">==</span>&nbsp;<span class="string" id="2918389">&#39;\t&#39;</span>&nbsp;<span class="op" id="2918394">||</span>&nbsp;<span class="ident" id="2918397">s</span><span class="op" id="2918398">.</span><span class="ident" id="2918399">ch</span>&nbsp;<span class="op" id="2918402">==</span>&nbsp;<span class="string" id="2918405">&#39;\n&#39;</span>&nbsp;<span class="op" id="2918410">&amp;&amp;</span>&nbsp;<span class="op" id="2918413">!</span><span class="ident" id="2918414">s</span><span class="op" id="2918415">.</span><span class="ident" id="2918416">insertSemi</span>&nbsp;<span class="op" id="2918427">||</span>&nbsp;<span class="ident" id="2918430">s</span><span class="op" id="2918431">.</span><span class="ident" id="2918432">ch</span>&nbsp;<span class="op" id="2918435">==</span>&nbsp;<span class="string" id="2918438">&#39;\r&#39;</span>&nbsp;<span class="op" id="2918443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918447">s</span><span class="op" id="2918448">.</span><span class="ident" id="2918449">next</span><span class="op" id="2918453">(</span><span class="op" id="2918454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918457">}</span><br>
<span class="lineno"></span><span class="op" id="2918459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="2918462">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;scanning&nbsp;multi-byte&nbsp;tokens&nbsp;such&nbsp;as&nbsp;&gt;&gt;&nbsp;+=&nbsp;&gt;&gt;=&nbsp;.</span><br>
<span class="lineno"></span><span class="comment" id="2918533">//&nbsp;Different&nbsp;routines&nbsp;recognize&nbsp;different&nbsp;length&nbsp;tok_i&nbsp;based&nbsp;on&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="2918605">//&nbsp;of&nbsp;ch_i.&nbsp;If&nbsp;a&nbsp;token&nbsp;ends&nbsp;in&nbsp;&#39;=&#39;,&nbsp;the&nbsp;result&nbsp;is&nbsp;tok1&nbsp;or&nbsp;tok3</span><br>
<span class="lineno"></span><span class="comment" id="2918668">//&nbsp;respectively.&nbsp;Otherwise,&nbsp;the&nbsp;result&nbsp;is&nbsp;tok0&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="2918737">//&nbsp;matching&nbsp;character,&nbsp;or&nbsp;tok2&nbsp;if&nbsp;the&nbsp;matching&nbsp;character&nbsp;was&nbsp;ch2.</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span><span class="keyword" id="2918804">func</span>&nbsp;<span class="op" id="2918809">(</span><span class="ident" id="2918810">s</span>&nbsp;<span class="op" id="2918812">*</span><span class="ident" id="2918813">Scanner</span><span class="op" id="2918820">)</span>&nbsp;<span class="ident" id="2918822">switch2</span><span class="op" id="2918829">(</span><span class="ident" id="2918830">tok0</span><span class="op" id="2918834">,</span>&nbsp;<span class="ident" id="2918836">tok1</span>&nbsp;<span class="ident" id="2918841">token</span><span class="op" id="2918846">.</span><span class="ident" id="2918847">Token</span><span class="op" id="2918852">)</span>&nbsp;<span class="ident" id="2918854">token</span><span class="op" id="2918859">.</span><span class="ident" id="2918860">Token</span>&nbsp;<span class="op" id="2918866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918869">if</span>&nbsp;<span class="ident" id="2918872">s</span><span class="op" id="2918873">.</span><span class="ident" id="2918874">ch</span>&nbsp;<span class="op" id="2918877">==</span>&nbsp;<span class="string" id="2918880">&#39;=&#39;</span>&nbsp;<span class="op" id="2918884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2918888">s</span><span class="op" id="2918889">.</span><span class="ident" id="2918890">next</span><span class="op" id="2918894">(</span><span class="op" id="2918895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918899">return</span>&nbsp;<span class="ident" id="2918906">tok1</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2918912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2918915">return</span>&nbsp;<span class="ident" id="2918922">tok0</span><br>
<span class="lineno"></span><span class="op" id="2918927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2918930">func</span>&nbsp;<span class="op" id="2918935">(</span><span class="ident" id="2918936">s</span>&nbsp;<span class="op" id="2918938">*</span><span class="ident" id="2918939">Scanner</span><span class="op" id="2918946">)</span>&nbsp;<span class="ident" id="2918948">switch3</span><span class="op" id="2918955">(</span><span class="ident" id="2918956">tok0</span><span class="op" id="2918960">,</span>&nbsp;<span class="ident" id="2918962">tok1</span>&nbsp;<span class="ident" id="2918967">token</span><span class="op" id="2918972">.</span><span class="ident" id="2918973">Token</span><span class="op" id="2918978">,</span>&nbsp;<span class="ident" id="2918980">ch2</span>&nbsp;<span class="builtintype" id="2918984">rune</span><span class="op" id="2918988">,</span>&nbsp;<span class="ident" id="2918990">tok2</span>&nbsp;<span class="ident" id="2918995">token</span><span class="op" id="2919000">.</span><span class="ident" id="2919001">Token</span><span class="op" id="2919006">)</span>&nbsp;<span class="ident" id="2919008">token</span><span class="op" id="2919013">.</span><span class="ident" id="2919014">Token</span>&nbsp;<span class="op" id="2919020">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919023">if</span>&nbsp;<span class="ident" id="2919026">s</span><span class="op" id="2919027">.</span><span class="ident" id="2919028">ch</span>&nbsp;<span class="op" id="2919031">==</span>&nbsp;<span class="string" id="2919034">&#39;=&#39;</span>&nbsp;<span class="op" id="2919038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2919042">s</span><span class="op" id="2919043">.</span><span class="ident" id="2919044">next</span><span class="op" id="2919048">(</span><span class="op" id="2919049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919053">return</span>&nbsp;<span class="ident" id="2919060">tok1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2919066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919069">if</span>&nbsp;<span class="ident" id="2919072">s</span><span class="op" id="2919073">.</span><span class="ident" id="2919074">ch</span>&nbsp;<span class="op" id="2919077">==</span>&nbsp;<span class="ident" id="2919080">ch2</span>&nbsp;<span class="op" id="2919084">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2919088">s</span><span class="op" id="2919089">.</span><span class="ident" id="2919090">next</span><span class="op" id="2919094">(</span><span class="op" id="2919095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919099">return</span>&nbsp;<span class="ident" id="2919106">tok2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2919112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919115">return</span>&nbsp;<span class="ident" id="2919122">tok0</span><br>
<span class="lineno"></span><span class="op" id="2919127">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="2919130">func</span>&nbsp;<span class="op" id="2919135">(</span><span class="ident" id="2919136">s</span>&nbsp;<span class="op" id="2919138">*</span><span class="ident" id="2919139">Scanner</span><span class="op" id="2919146">)</span>&nbsp;<span class="ident" id="2919148">switch4</span><span class="op" id="2919155">(</span><span class="ident" id="2919156">tok0</span><span class="op" id="2919160">,</span>&nbsp;<span class="ident" id="2919162">tok1</span>&nbsp;<span class="ident" id="2919167">token</span><span class="op" id="2919172">.</span><span class="ident" id="2919173">Token</span><span class="op" id="2919178">,</span>&nbsp;<span class="ident" id="2919180">ch2</span>&nbsp;<span class="builtintype" id="2919184">rune</span><span class="op" id="2919188">,</span>&nbsp;<span class="ident" id="2919190">tok2</span><span class="op" id="2919194">,</span>&nbsp;<span class="ident" id="2919196">tok3</span>&nbsp;<span class="ident" id="2919201">token</span><span class="op" id="2919206">.</span><span class="ident" id="2919207">Token</span><span class="op" id="2919212">)</span>&nbsp;<span class="ident" id="2919214">token</span><span class="op" id="2919219">.</span><span class="ident" id="2919220">Token</span>&nbsp;<span class="op" id="2919226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919229">if</span>&nbsp;<span class="ident" id="2919232">s</span><span class="op" id="2919233">.</span><span class="ident" id="2919234">ch</span>&nbsp;<span class="op" id="2919237">==</span>&nbsp;<span class="string" id="2919240">&#39;=&#39;</span>&nbsp;<span class="op" id="2919244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2919248">s</span><span class="op" id="2919249">.</span><span class="ident" id="2919250">next</span><span class="op" id="2919254">(</span><span class="op" id="2919255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919259">return</span>&nbsp;<span class="ident" id="2919266">tok1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2919272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919275">if</span>&nbsp;<span class="ident" id="2919278">s</span><span class="op" id="2919279">.</span><span class="ident" id="2919280">ch</span>&nbsp;<span class="op" id="2919283">==</span>&nbsp;<span class="ident" id="2919286">ch2</span>&nbsp;<span class="op" id="2919290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2919294">s</span><span class="op" id="2919295">.</span><span class="ident" id="2919296">next</span><span class="op" id="2919300">(</span><span class="op" id="2919301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919305">if</span>&nbsp;<span class="ident" id="2919308">s</span><span class="op" id="2919309">.</span><span class="ident" id="2919310">ch</span>&nbsp;<span class="op" id="2919313">==</span>&nbsp;<span class="string" id="2919316">&#39;=&#39;</span>&nbsp;<span class="op" id="2919320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2919325">s</span><span class="op" id="2919326">.</span><span class="ident" id="2919327">next</span><span class="op" id="2919331">(</span><span class="op" id="2919332">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919337">return</span>&nbsp;<span class="ident" id="2919344">tok3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2919351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919355">return</span>&nbsp;<span class="ident" id="2919362">tok2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2919368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2919371">return</span>&nbsp;<span class="ident" id="2919378">tok0</span><br>
<span class="lineno">565</span><span class="op" id="2919383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2919386">//&nbsp;Scan&nbsp;scans&nbsp;the&nbsp;next&nbsp;token&nbsp;and&nbsp;returns&nbsp;the&nbsp;token&nbsp;position,&nbsp;the&nbsp;token,</span><br>
<span class="lineno"></span><span class="comment" id="2919458">//&nbsp;and&nbsp;its&nbsp;literal&nbsp;string&nbsp;if&nbsp;applicable.&nbsp;The&nbsp;source&nbsp;end&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2919530">//&nbsp;token.EOF.</span><br>
<span class="lineno">570</span><span class="comment" id="2919544">//</span><br>
<span class="lineno"></span><span class="comment" id="2919547">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;a&nbsp;literal&nbsp;(token.IDENT,&nbsp;token.INT,&nbsp;token.FLOAT,</span><br>
<span class="lineno"></span><span class="comment" id="2919623">//&nbsp;token.IMAG,&nbsp;token.CHAR,&nbsp;token.STRING)&nbsp;or&nbsp;token.COMMENT,&nbsp;the&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2919701">//&nbsp;has&nbsp;the&nbsp;corresponding&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="2919733">//</span><br>
<span class="lineno">575</span><span class="comment" id="2919736">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;a&nbsp;keyword,&nbsp;the&nbsp;literal&nbsp;string&nbsp;is&nbsp;the&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="comment" id="2919810">//</span><br>
<span class="lineno"></span><span class="comment" id="2919813">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;token.SEMICOLON,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="2919876">//&nbsp;literal&nbsp;string&nbsp;is&nbsp;&#34;;&#34;&nbsp;if&nbsp;the&nbsp;semicolon&nbsp;was&nbsp;present&nbsp;in&nbsp;the&nbsp;source,</span><br>
<span class="lineno"></span><span class="comment" id="2919945">//&nbsp;and&nbsp;&#34;\n&#34;&nbsp;if&nbsp;the&nbsp;semicolon&nbsp;was&nbsp;inserted&nbsp;because&nbsp;of&nbsp;a&nbsp;newline&nbsp;or</span><br>
<span class="lineno">580</span><span class="comment" id="2920011">//&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="comment" id="2920022">//</span><br>
<span class="lineno"></span><span class="comment" id="2920025">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;token.ILLEGAL,&nbsp;the&nbsp;literal&nbsp;string&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2920094">//&nbsp;offending&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="2920118">//</span><br>
<span class="lineno">585</span><span class="comment" id="2920121">//&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;Scan&nbsp;returns&nbsp;an&nbsp;empty&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2920182">//</span><br>
<span class="lineno"></span><span class="comment" id="2920185">//&nbsp;For&nbsp;more&nbsp;tolerant&nbsp;parsing,&nbsp;Scan&nbsp;will&nbsp;return&nbsp;a&nbsp;valid&nbsp;token&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2920249">//&nbsp;possible&nbsp;even&nbsp;if&nbsp;a&nbsp;syntax&nbsp;error&nbsp;was&nbsp;encountered.&nbsp;Thus,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="2920312">//&nbsp;if&nbsp;the&nbsp;resulting&nbsp;token&nbsp;sequence&nbsp;contains&nbsp;no&nbsp;illegal&nbsp;tokens,</span><br>
<span class="lineno">590</span><span class="comment" id="2920375">//&nbsp;a&nbsp;client&nbsp;may&nbsp;not&nbsp;assume&nbsp;that&nbsp;no&nbsp;error&nbsp;occurred.&nbsp;Instead&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2920437">//&nbsp;must&nbsp;check&nbsp;the&nbsp;scanner&#39;s&nbsp;ErrorCount&nbsp;or&nbsp;the&nbsp;number&nbsp;of&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="2920499">//&nbsp;of&nbsp;the&nbsp;error&nbsp;handler,&nbsp;if&nbsp;there&nbsp;was&nbsp;one&nbsp;installed.</span><br>
<span class="lineno"></span><span class="comment" id="2920552">//</span><br>
<span class="lineno"></span><span class="comment" id="2920555">//&nbsp;Scan&nbsp;adds&nbsp;line&nbsp;information&nbsp;to&nbsp;the&nbsp;file&nbsp;added&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno">595</span><span class="comment" id="2920615">//&nbsp;set&nbsp;with&nbsp;Init.&nbsp;Token&nbsp;positions&nbsp;are&nbsp;relative&nbsp;to&nbsp;that&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="2920675">//&nbsp;and&nbsp;thus&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="2920713">//</span><br>
<span class="lineno"></span><span class="keyword" id="2920716">func</span>&nbsp;<span class="op" id="2920721">(</span><span class="ident" id="2920722">s</span>&nbsp;<span class="op" id="2920724">*</span><span class="ident" id="2920725">Scanner</span><span class="op" id="2920732">)</span>&nbsp;<span class="ident" id="2920734">Scan</span><span class="op" id="2920738">(</span><span class="op" id="2920739">)</span>&nbsp;<span class="op" id="2920741">(</span><span class="ident" id="2920742">pos</span>&nbsp;<span class="ident" id="2920746">token</span><span class="op" id="2920751">.</span><span class="ident" id="2920752">Pos</span><span class="op" id="2920755">,</span>&nbsp;<span class="ident" id="2920757">tok</span>&nbsp;<span class="ident" id="2920761">token</span><span class="op" id="2920766">.</span><span class="ident" id="2920767">Token</span><span class="op" id="2920772">,</span>&nbsp;<span class="ident" id="2920774">lit</span>&nbsp;<span class="builtintype" id="2920778">string</span><span class="op" id="2920784">)</span>&nbsp;<span class="op" id="2920786">{</span><br>
<span class="lineno"></span><span class="ident" id="2920788">scanAgain</span><span class="op" id="2920797">:</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2920800">s</span><span class="op" id="2920801">.</span><span class="ident" id="2920802">skipWhitespace</span><span class="op" id="2920816">(</span><span class="op" id="2920817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920821">//&nbsp;current&nbsp;token&nbsp;start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2920845">pos</span>&nbsp;<span class="op" id="2920849">=</span>&nbsp;<span class="ident" id="2920851">s</span><span class="op" id="2920852">.</span><span class="ident" id="2920853">file</span><span class="op" id="2920857">.</span><span class="ident" id="2920858">Pos</span><span class="op" id="2920861">(</span><span class="ident" id="2920862">s</span><span class="op" id="2920863">.</span><span class="ident" id="2920864">offset</span><span class="op" id="2920870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920874">//&nbsp;determine&nbsp;token&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2920900">insertSemi</span>&nbsp;<span class="op" id="2920911">:=</span>&nbsp;<span class="builtintype" id="2920914">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2920921">switch</span>&nbsp;<span class="ident" id="2920928">ch</span>&nbsp;<span class="op" id="2920931">:=</span>&nbsp;<span class="ident" id="2920934">s</span><span class="op" id="2920935">.</span><span class="ident" id="2920936">ch</span><span class="op" id="2920938">;</span>&nbsp;<span class="op" id="2920940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2920943">case</span>&nbsp;<span class="ident" id="2920948">isLetter</span><span class="op" id="2920956">(</span><span class="ident" id="2920957">ch</span><span class="op" id="2920959">)</span><span class="op" id="2920960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2920964">lit</span>&nbsp;<span class="op" id="2920968">=</span>&nbsp;<span class="ident" id="2920970">s</span><span class="op" id="2920971">.</span><span class="ident" id="2920972">scanIdentifier</span><span class="op" id="2920986">(</span><span class="op" id="2920987">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2920991">if</span>&nbsp;<span class="builtinfunc" id="2920994">len</span><span class="op" id="2920997">(</span><span class="ident" id="2920998">lit</span><span class="op" id="2921001">)</span>&nbsp;<span class="op" id="2921003">&gt;</span>&nbsp;<span class="num" id="2921005">1</span>&nbsp;<span class="op" id="2921007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921012">//&nbsp;keywords&nbsp;are&nbsp;longer&nbsp;than&nbsp;one&nbsp;letter&nbsp;-&nbsp;avoid&nbsp;lookup&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921079">tok</span>&nbsp;<span class="op" id="2921083">=</span>&nbsp;<span class="ident" id="2921085">token</span><span class="op" id="2921090">.</span><span class="ident" id="2921091">Lookup</span><span class="op" id="2921097">(</span><span class="ident" id="2921098">lit</span><span class="op" id="2921101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921106">switch</span>&nbsp;<span class="ident" id="2921113">tok</span>&nbsp;<span class="op" id="2921117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921122">case</span>&nbsp;<span class="ident" id="2921127">token</span><span class="op" id="2921132">.</span><span class="ident" id="2921133">IDENT</span><span class="op" id="2921138">,</span>&nbsp;<span class="ident" id="2921140">token</span><span class="op" id="2921145">.</span><span class="ident" id="2921146">BREAK</span><span class="op" id="2921151">,</span>&nbsp;<span class="ident" id="2921153">token</span><span class="op" id="2921158">.</span><span class="ident" id="2921159">CONTINUE</span><span class="op" id="2921167">,</span>&nbsp;<span class="ident" id="2921169">token</span><span class="op" id="2921174">.</span><span class="ident" id="2921175">FALLTHROUGH</span><span class="op" id="2921186">,</span>&nbsp;<span class="ident" id="2921188">token</span><span class="op" id="2921193">.</span><span class="ident" id="2921194">RETURN</span><span class="op" id="2921200">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921206">insertSemi</span>&nbsp;<span class="op" id="2921217">=</span>&nbsp;<span class="builtintype" id="2921219">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921231">}</span>&nbsp;<span class="keyword" id="2921233">else</span>&nbsp;<span class="op" id="2921238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921243">insertSemi</span>&nbsp;<span class="op" id="2921254">=</span>&nbsp;<span class="builtintype" id="2921256">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921264">tok</span>&nbsp;<span class="op" id="2921268">=</span>&nbsp;<span class="ident" id="2921270">token</span><span class="op" id="2921275">.</span><span class="ident" id="2921276">IDENT</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921287">case</span>&nbsp;<span class="string" id="2921292">&#39;0&#39;</span>&nbsp;<span class="op" id="2921296">&lt;=</span>&nbsp;<span class="ident" id="2921299">ch</span>&nbsp;<span class="op" id="2921302">&amp;&amp;</span>&nbsp;<span class="ident" id="2921305">ch</span>&nbsp;<span class="op" id="2921308">&lt;=</span>&nbsp;<span class="string" id="2921311">&#39;9&#39;</span><span class="op" id="2921314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921318">insertSemi</span>&nbsp;<span class="op" id="2921329">=</span>&nbsp;<span class="builtintype" id="2921331">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921338">tok</span><span class="op" id="2921341">,</span>&nbsp;<span class="ident" id="2921343">lit</span>&nbsp;<span class="op" id="2921347">=</span>&nbsp;<span class="ident" id="2921349">s</span><span class="op" id="2921350">.</span><span class="ident" id="2921351">scanNumber</span><span class="op" id="2921361">(</span><span class="builtintype" id="2921362">false</span><span class="op" id="2921367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921370">default</span><span class="op" id="2921377">:</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921381">s</span><span class="op" id="2921382">.</span><span class="ident" id="2921383">next</span><span class="op" id="2921387">(</span><span class="op" id="2921388">)</span>&nbsp;<span class="comment" id="2921390">//&nbsp;always&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921416">switch</span>&nbsp;<span class="ident" id="2921423">ch</span>&nbsp;<span class="op" id="2921426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921430">case</span>&nbsp;<span class="op" id="2921435">-</span><span class="num" id="2921436">1</span><span class="op" id="2921437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921442">if</span>&nbsp;<span class="ident" id="2921445">s</span><span class="op" id="2921446">.</span><span class="ident" id="2921447">insertSemi</span>&nbsp;<span class="op" id="2921458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921464">s</span><span class="op" id="2921465">.</span><span class="ident" id="2921466">insertSemi</span>&nbsp;<span class="op" id="2921477">=</span>&nbsp;<span class="builtintype" id="2921479">false</span>&nbsp;<span class="comment" id="2921485">//&nbsp;EOF&nbsp;consumed</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921505">return</span>&nbsp;<span class="ident" id="2921512">pos</span><span class="op" id="2921515">,</span>&nbsp;<span class="ident" id="2921517">token</span><span class="op" id="2921522">.</span><span class="ident" id="2921523">SEMICOLON</span><span class="op" id="2921532">,</span>&nbsp;<span class="string" id="2921534">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921547">tok</span>&nbsp;<span class="op" id="2921551">=</span>&nbsp;<span class="ident" id="2921553">token</span><span class="op" id="2921558">.</span><span class="ident" id="2921559">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921565">case</span>&nbsp;<span class="string" id="2921570">&#39;\n&#39;</span><span class="op" id="2921574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921579">//&nbsp;we&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;s.insertSemi&nbsp;was</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921624">//&nbsp;set&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;and&nbsp;exited&nbsp;early</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921670">//&nbsp;from&nbsp;s.skipWhitespace()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921700">s</span><span class="op" id="2921701">.</span><span class="ident" id="2921702">insertSemi</span>&nbsp;<span class="op" id="2921713">=</span>&nbsp;<span class="builtintype" id="2921715">false</span>&nbsp;<span class="comment" id="2921721">//&nbsp;newline&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921744">return</span>&nbsp;<span class="ident" id="2921751">pos</span><span class="op" id="2921754">,</span>&nbsp;<span class="ident" id="2921756">token</span><span class="op" id="2921761">.</span><span class="ident" id="2921762">SEMICOLON</span><span class="op" id="2921771">,</span>&nbsp;<span class="string" id="2921773">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921780">case</span>&nbsp;<span class="string" id="2921785">&#39;&#34;&#39;</span><span class="op" id="2921788">:</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921793">insertSemi</span>&nbsp;<span class="op" id="2921804">=</span>&nbsp;<span class="builtintype" id="2921806">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921814">tok</span>&nbsp;<span class="op" id="2921818">=</span>&nbsp;<span class="ident" id="2921820">token</span><span class="op" id="2921825">.</span><span class="ident" id="2921826">STRING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921836">lit</span>&nbsp;<span class="op" id="2921840">=</span>&nbsp;<span class="ident" id="2921842">s</span><span class="op" id="2921843">.</span><span class="ident" id="2921844">scanString</span><span class="op" id="2921854">(</span><span class="op" id="2921855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921859">case</span>&nbsp;<span class="string" id="2921864">&#39;\&#39;&#39;</span><span class="op" id="2921868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921873">insertSemi</span>&nbsp;<span class="op" id="2921884">=</span>&nbsp;<span class="builtintype" id="2921886">true</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921894">tok</span>&nbsp;<span class="op" id="2921898">=</span>&nbsp;<span class="ident" id="2921900">token</span><span class="op" id="2921905">.</span><span class="ident" id="2921906">CHAR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921914">lit</span>&nbsp;<span class="op" id="2921918">=</span>&nbsp;<span class="ident" id="2921920">s</span><span class="op" id="2921921">.</span><span class="ident" id="2921922">scanRune</span><span class="op" id="2921930">(</span><span class="op" id="2921931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921935">case</span>&nbsp;<span class="string" id="2921940">&#39;`&#39;</span><span class="op" id="2921943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921948">insertSemi</span>&nbsp;<span class="op" id="2921959">=</span>&nbsp;<span class="builtintype" id="2921961">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921969">tok</span>&nbsp;<span class="op" id="2921973">=</span>&nbsp;<span class="ident" id="2921975">token</span><span class="op" id="2921980">.</span><span class="ident" id="2921981">STRING</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921991">lit</span>&nbsp;<span class="op" id="2921995">=</span>&nbsp;<span class="ident" id="2921997">s</span><span class="op" id="2921998">.</span><span class="ident" id="2921999">scanRawString</span><span class="op" id="2922012">(</span><span class="op" id="2922013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922017">case</span>&nbsp;<span class="string" id="2922022">&#39;:&#39;</span><span class="op" id="2922025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922030">tok</span>&nbsp;<span class="op" id="2922034">=</span>&nbsp;<span class="ident" id="2922036">s</span><span class="op" id="2922037">.</span><span class="ident" id="2922038">switch2</span><span class="op" id="2922045">(</span><span class="ident" id="2922046">token</span><span class="op" id="2922051">.</span><span class="ident" id="2922052">COLON</span><span class="op" id="2922057">,</span>&nbsp;<span class="ident" id="2922059">token</span><span class="op" id="2922064">.</span><span class="ident" id="2922065">DEFINE</span><span class="op" id="2922071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922075">case</span>&nbsp;<span class="string" id="2922080">&#39;.&#39;</span><span class="op" id="2922083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922088">if</span>&nbsp;<span class="string" id="2922091">&#39;0&#39;</span>&nbsp;<span class="op" id="2922095">&lt;=</span>&nbsp;<span class="ident" id="2922098">s</span><span class="op" id="2922099">.</span><span class="ident" id="2922100">ch</span>&nbsp;<span class="op" id="2922103">&amp;&amp;</span>&nbsp;<span class="ident" id="2922106">s</span><span class="op" id="2922107">.</span><span class="ident" id="2922108">ch</span>&nbsp;<span class="op" id="2922111">&lt;=</span>&nbsp;<span class="string" id="2922114">&#39;9&#39;</span>&nbsp;<span class="op" id="2922118">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922124">insertSemi</span>&nbsp;<span class="op" id="2922135">=</span>&nbsp;<span class="builtintype" id="2922137">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922146">tok</span><span class="op" id="2922149">,</span>&nbsp;<span class="ident" id="2922151">lit</span>&nbsp;<span class="op" id="2922155">=</span>&nbsp;<span class="ident" id="2922157">s</span><span class="op" id="2922158">.</span><span class="ident" id="2922159">scanNumber</span><span class="op" id="2922169">(</span><span class="builtintype" id="2922170">true</span><span class="op" id="2922174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922179">}</span>&nbsp;<span class="keyword" id="2922181">else</span>&nbsp;<span class="keyword" id="2922186">if</span>&nbsp;<span class="ident" id="2922189">s</span><span class="op" id="2922190">.</span><span class="ident" id="2922191">ch</span>&nbsp;<span class="op" id="2922194">==</span>&nbsp;<span class="string" id="2922197">&#39;.&#39;</span>&nbsp;<span class="op" id="2922201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922207">s</span><span class="op" id="2922208">.</span><span class="ident" id="2922209">next</span><span class="op" id="2922213">(</span><span class="op" id="2922214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922220">if</span>&nbsp;<span class="ident" id="2922223">s</span><span class="op" id="2922224">.</span><span class="ident" id="2922225">ch</span>&nbsp;<span class="op" id="2922228">==</span>&nbsp;<span class="string" id="2922231">&#39;.&#39;</span>&nbsp;<span class="op" id="2922235">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922242">s</span><span class="op" id="2922243">.</span><span class="ident" id="2922244">next</span><span class="op" id="2922248">(</span><span class="op" id="2922249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922256">tok</span>&nbsp;<span class="op" id="2922260">=</span>&nbsp;<span class="ident" id="2922262">token</span><span class="op" id="2922267">.</span><span class="ident" id="2922268">ELLIPSIS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922286">}</span>&nbsp;<span class="keyword" id="2922288">else</span>&nbsp;<span class="op" id="2922293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922299">tok</span>&nbsp;<span class="op" id="2922303">=</span>&nbsp;<span class="ident" id="2922305">token</span><span class="op" id="2922310">.</span><span class="ident" id="2922311">PERIOD</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922325">case</span>&nbsp;<span class="string" id="2922330">&#39;,&#39;</span><span class="op" id="2922333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922338">tok</span>&nbsp;<span class="op" id="2922342">=</span>&nbsp;<span class="ident" id="2922344">token</span><span class="op" id="2922349">.</span><span class="ident" id="2922350">COMMA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922358">case</span>&nbsp;<span class="string" id="2922363">&#39;;&#39;</span><span class="op" id="2922366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922371">tok</span>&nbsp;<span class="op" id="2922375">=</span>&nbsp;<span class="ident" id="2922377">token</span><span class="op" id="2922382">.</span><span class="ident" id="2922383">SEMICOLON</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922396">lit</span>&nbsp;<span class="op" id="2922400">=</span>&nbsp;<span class="string" id="2922402">&#34;;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922408">case</span>&nbsp;<span class="string" id="2922413">&#39;(&#39;</span><span class="op" id="2922416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922421">tok</span>&nbsp;<span class="op" id="2922425">=</span>&nbsp;<span class="ident" id="2922427">token</span><span class="op" id="2922432">.</span><span class="ident" id="2922433">LPAREN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922442">case</span>&nbsp;<span class="string" id="2922447">&#39;)&#39;</span><span class="op" id="2922450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922455">insertSemi</span>&nbsp;<span class="op" id="2922466">=</span>&nbsp;<span class="builtintype" id="2922468">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922476">tok</span>&nbsp;<span class="op" id="2922480">=</span>&nbsp;<span class="ident" id="2922482">token</span><span class="op" id="2922487">.</span><span class="ident" id="2922488">RPAREN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922497">case</span>&nbsp;<span class="string" id="2922502">&#39;[&#39;</span><span class="op" id="2922505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922510">tok</span>&nbsp;<span class="op" id="2922514">=</span>&nbsp;<span class="ident" id="2922516">token</span><span class="op" id="2922521">.</span><span class="ident" id="2922522">LBRACK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922531">case</span>&nbsp;<span class="string" id="2922536">&#39;]&#39;</span><span class="op" id="2922539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922544">insertSemi</span>&nbsp;<span class="op" id="2922555">=</span>&nbsp;<span class="builtintype" id="2922557">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922565">tok</span>&nbsp;<span class="op" id="2922569">=</span>&nbsp;<span class="ident" id="2922571">token</span><span class="op" id="2922576">.</span><span class="ident" id="2922577">RBRACK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922586">case</span>&nbsp;<span class="string" id="2922591">&#39;{&#39;</span><span class="op" id="2922594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922599">tok</span>&nbsp;<span class="op" id="2922603">=</span>&nbsp;<span class="ident" id="2922605">token</span><span class="op" id="2922610">.</span><span class="ident" id="2922611">LBRACE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922620">case</span>&nbsp;<span class="string" id="2922625">&#39;}&#39;</span><span class="op" id="2922628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922633">insertSemi</span>&nbsp;<span class="op" id="2922644">=</span>&nbsp;<span class="builtintype" id="2922646">true</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922654">tok</span>&nbsp;<span class="op" id="2922658">=</span>&nbsp;<span class="ident" id="2922660">token</span><span class="op" id="2922665">.</span><span class="ident" id="2922666">RBRACE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922675">case</span>&nbsp;<span class="string" id="2922680">&#39;+&#39;</span><span class="op" id="2922683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922688">tok</span>&nbsp;<span class="op" id="2922692">=</span>&nbsp;<span class="ident" id="2922694">s</span><span class="op" id="2922695">.</span><span class="ident" id="2922696">switch3</span><span class="op" id="2922703">(</span><span class="ident" id="2922704">token</span><span class="op" id="2922709">.</span><span class="ident" id="2922710">ADD</span><span class="op" id="2922713">,</span>&nbsp;<span class="ident" id="2922715">token</span><span class="op" id="2922720">.</span><span class="ident" id="2922721">ADD_ASSIGN</span><span class="op" id="2922731">,</span>&nbsp;<span class="string" id="2922733">&#39;+&#39;</span><span class="op" id="2922736">,</span>&nbsp;<span class="ident" id="2922738">token</span><span class="op" id="2922743">.</span><span class="ident" id="2922744">INC</span><span class="op" id="2922747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922752">if</span>&nbsp;<span class="ident" id="2922755">tok</span>&nbsp;<span class="op" id="2922759">==</span>&nbsp;<span class="ident" id="2922762">token</span><span class="op" id="2922767">.</span><span class="ident" id="2922768">INC</span>&nbsp;<span class="op" id="2922772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922778">insertSemi</span>&nbsp;<span class="op" id="2922789">=</span>&nbsp;<span class="builtintype" id="2922791">true</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922803">case</span>&nbsp;<span class="string" id="2922808">&#39;-&#39;</span><span class="op" id="2922811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922816">tok</span>&nbsp;<span class="op" id="2922820">=</span>&nbsp;<span class="ident" id="2922822">s</span><span class="op" id="2922823">.</span><span class="ident" id="2922824">switch3</span><span class="op" id="2922831">(</span><span class="ident" id="2922832">token</span><span class="op" id="2922837">.</span><span class="ident" id="2922838">SUB</span><span class="op" id="2922841">,</span>&nbsp;<span class="ident" id="2922843">token</span><span class="op" id="2922848">.</span><span class="ident" id="2922849">SUB_ASSIGN</span><span class="op" id="2922859">,</span>&nbsp;<span class="string" id="2922861">&#39;-&#39;</span><span class="op" id="2922864">,</span>&nbsp;<span class="ident" id="2922866">token</span><span class="op" id="2922871">.</span><span class="ident" id="2922872">DEC</span><span class="op" id="2922875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922880">if</span>&nbsp;<span class="ident" id="2922883">tok</span>&nbsp;<span class="op" id="2922887">==</span>&nbsp;<span class="ident" id="2922890">token</span><span class="op" id="2922895">.</span><span class="ident" id="2922896">DEC</span>&nbsp;<span class="op" id="2922900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922906">insertSemi</span>&nbsp;<span class="op" id="2922917">=</span>&nbsp;<span class="builtintype" id="2922919">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922931">case</span>&nbsp;<span class="string" id="2922936">&#39;*&#39;</span><span class="op" id="2922939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922944">tok</span>&nbsp;<span class="op" id="2922948">=</span>&nbsp;<span class="ident" id="2922950">s</span><span class="op" id="2922951">.</span><span class="ident" id="2922952">switch2</span><span class="op" id="2922959">(</span><span class="ident" id="2922960">token</span><span class="op" id="2922965">.</span><span class="ident" id="2922966">MUL</span><span class="op" id="2922969">,</span>&nbsp;<span class="ident" id="2922971">token</span><span class="op" id="2922976">.</span><span class="ident" id="2922977">MUL_ASSIGN</span><span class="op" id="2922987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922991">case</span>&nbsp;<span class="string" id="2922996">&#39;/&#39;</span><span class="op" id="2922999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923004">if</span>&nbsp;<span class="ident" id="2923007">s</span><span class="op" id="2923008">.</span><span class="ident" id="2923009">ch</span>&nbsp;<span class="op" id="2923012">==</span>&nbsp;<span class="string" id="2923015">&#39;/&#39;</span>&nbsp;<span class="op" id="2923019">||</span>&nbsp;<span class="ident" id="2923022">s</span><span class="op" id="2923023">.</span><span class="ident" id="2923024">ch</span>&nbsp;<span class="op" id="2923027">==</span>&nbsp;<span class="string" id="2923030">&#39;*&#39;</span>&nbsp;<span class="op" id="2923034">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2923040">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923055">if</span>&nbsp;<span class="ident" id="2923058">s</span><span class="op" id="2923059">.</span><span class="ident" id="2923060">insertSemi</span>&nbsp;<span class="op" id="2923071">&amp;&amp;</span>&nbsp;<span class="ident" id="2923074">s</span><span class="op" id="2923075">.</span><span class="ident" id="2923076">findLineEnd</span><span class="op" id="2923087">(</span><span class="op" id="2923088">)</span>&nbsp;<span class="op" id="2923090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2923097">//&nbsp;reset&nbsp;position&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923152">s</span><span class="op" id="2923153">.</span><span class="ident" id="2923154">ch</span>&nbsp;<span class="op" id="2923157">=</span>&nbsp;<span class="string" id="2923159">&#39;/&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923168">s</span><span class="op" id="2923169">.</span><span class="ident" id="2923170">offset</span>&nbsp;<span class="op" id="2923177">=</span>&nbsp;<span class="ident" id="2923179">s</span><span class="op" id="2923180">.</span><span class="ident" id="2923181">file</span><span class="op" id="2923185">.</span><span class="ident" id="2923186">Offset</span><span class="op" id="2923192">(</span><span class="ident" id="2923193">pos</span><span class="op" id="2923196">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923203">s</span><span class="op" id="2923204">.</span><span class="ident" id="2923205">rdOffset</span>&nbsp;<span class="op" id="2923214">=</span>&nbsp;<span class="ident" id="2923216">s</span><span class="op" id="2923217">.</span><span class="ident" id="2923218">offset</span>&nbsp;<span class="op" id="2923225">+</span>&nbsp;<span class="num" id="2923227">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923234">s</span><span class="op" id="2923235">.</span><span class="ident" id="2923236">insertSemi</span>&nbsp;<span class="op" id="2923247">=</span>&nbsp;<span class="builtintype" id="2923249">false</span>&nbsp;<span class="comment" id="2923255">//&nbsp;newline&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923280">return</span>&nbsp;<span class="ident" id="2923287">pos</span><span class="op" id="2923290">,</span>&nbsp;<span class="ident" id="2923292">token</span><span class="op" id="2923297">.</span><span class="ident" id="2923298">SEMICOLON</span><span class="op" id="2923307">,</span>&nbsp;<span class="string" id="2923309">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923324">lit</span>&nbsp;<span class="op" id="2923328">=</span>&nbsp;<span class="ident" id="2923330">s</span><span class="op" id="2923331">.</span><span class="ident" id="2923332">scanComment</span><span class="op" id="2923343">(</span><span class="op" id="2923344">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923350">if</span>&nbsp;<span class="ident" id="2923353">s</span><span class="op" id="2923354">.</span><span class="ident" id="2923355">mode</span><span class="op" id="2923359">&amp;</span><span class="ident" id="2923360">ScanComments</span>&nbsp;<span class="op" id="2923373">==</span>&nbsp;<span class="num" id="2923376">0</span>&nbsp;<span class="op" id="2923378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2923385">//&nbsp;skip&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923406">s</span><span class="op" id="2923407">.</span><span class="ident" id="2923408">insertSemi</span>&nbsp;<span class="op" id="2923419">=</span>&nbsp;<span class="builtintype" id="2923421">false</span>&nbsp;<span class="comment" id="2923427">//&nbsp;newline&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923452">goto</span>&nbsp;<span class="ident" id="2923457">scanAgain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923471">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923477">tok</span>&nbsp;<span class="op" id="2923481">=</span>&nbsp;<span class="ident" id="2923483">token</span><span class="op" id="2923488">.</span><span class="ident" id="2923489">COMMENT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923500">}</span>&nbsp;<span class="keyword" id="2923502">else</span>&nbsp;<span class="op" id="2923507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923513">tok</span>&nbsp;<span class="op" id="2923517">=</span>&nbsp;<span class="ident" id="2923519">s</span><span class="op" id="2923520">.</span><span class="ident" id="2923521">switch2</span><span class="op" id="2923528">(</span><span class="ident" id="2923529">token</span><span class="op" id="2923534">.</span><span class="ident" id="2923535">QUO</span><span class="op" id="2923538">,</span>&nbsp;<span class="ident" id="2923540">token</span><span class="op" id="2923545">.</span><span class="ident" id="2923546">QUO_ASSIGN</span><span class="op" id="2923556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923565">case</span>&nbsp;<span class="string" id="2923570">&#39;%&#39;</span><span class="op" id="2923573">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923578">tok</span>&nbsp;<span class="op" id="2923582">=</span>&nbsp;<span class="ident" id="2923584">s</span><span class="op" id="2923585">.</span><span class="ident" id="2923586">switch2</span><span class="op" id="2923593">(</span><span class="ident" id="2923594">token</span><span class="op" id="2923599">.</span><span class="ident" id="2923600">REM</span><span class="op" id="2923603">,</span>&nbsp;<span class="ident" id="2923605">token</span><span class="op" id="2923610">.</span><span class="ident" id="2923611">REM_ASSIGN</span><span class="op" id="2923621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923625">case</span>&nbsp;<span class="string" id="2923630">&#39;^&#39;</span><span class="op" id="2923633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923638">tok</span>&nbsp;<span class="op" id="2923642">=</span>&nbsp;<span class="ident" id="2923644">s</span><span class="op" id="2923645">.</span><span class="ident" id="2923646">switch2</span><span class="op" id="2923653">(</span><span class="ident" id="2923654">token</span><span class="op" id="2923659">.</span><span class="ident" id="2923660">XOR</span><span class="op" id="2923663">,</span>&nbsp;<span class="ident" id="2923665">token</span><span class="op" id="2923670">.</span><span class="ident" id="2923671">XOR_ASSIGN</span><span class="op" id="2923681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923685">case</span>&nbsp;<span class="string" id="2923690">&#39;&lt;&#39;</span><span class="op" id="2923693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923698">if</span>&nbsp;<span class="ident" id="2923701">s</span><span class="op" id="2923702">.</span><span class="ident" id="2923703">ch</span>&nbsp;<span class="op" id="2923706">==</span>&nbsp;<span class="string" id="2923709">&#39;-&#39;</span>&nbsp;<span class="op" id="2923713">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923719">s</span><span class="op" id="2923720">.</span><span class="ident" id="2923721">next</span><span class="op" id="2923725">(</span><span class="op" id="2923726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923732">tok</span>&nbsp;<span class="op" id="2923736">=</span>&nbsp;<span class="ident" id="2923738">token</span><span class="op" id="2923743">.</span><span class="ident" id="2923744">ARROW</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923753">}</span>&nbsp;<span class="keyword" id="2923755">else</span>&nbsp;<span class="op" id="2923760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923766">tok</span>&nbsp;<span class="op" id="2923770">=</span>&nbsp;<span class="ident" id="2923772">s</span><span class="op" id="2923773">.</span><span class="ident" id="2923774">switch4</span><span class="op" id="2923781">(</span><span class="ident" id="2923782">token</span><span class="op" id="2923787">.</span><span class="ident" id="2923788">LSS</span><span class="op" id="2923791">,</span>&nbsp;<span class="ident" id="2923793">token</span><span class="op" id="2923798">.</span><span class="ident" id="2923799">LEQ</span><span class="op" id="2923802">,</span>&nbsp;<span class="string" id="2923804">&#39;&lt;&#39;</span><span class="op" id="2923807">,</span>&nbsp;<span class="ident" id="2923809">token</span><span class="op" id="2923814">.</span><span class="ident" id="2923815">SHL</span><span class="op" id="2923818">,</span>&nbsp;<span class="ident" id="2923820">token</span><span class="op" id="2923825">.</span><span class="ident" id="2923826">SHL_ASSIGN</span><span class="op" id="2923836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923841">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923845">case</span>&nbsp;<span class="string" id="2923850">&#39;&gt;&#39;</span><span class="op" id="2923853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923858">tok</span>&nbsp;<span class="op" id="2923862">=</span>&nbsp;<span class="ident" id="2923864">s</span><span class="op" id="2923865">.</span><span class="ident" id="2923866">switch4</span><span class="op" id="2923873">(</span><span class="ident" id="2923874">token</span><span class="op" id="2923879">.</span><span class="ident" id="2923880">GTR</span><span class="op" id="2923883">,</span>&nbsp;<span class="ident" id="2923885">token</span><span class="op" id="2923890">.</span><span class="ident" id="2923891">GEQ</span><span class="op" id="2923894">,</span>&nbsp;<span class="string" id="2923896">&#39;&gt;&#39;</span><span class="op" id="2923899">,</span>&nbsp;<span class="ident" id="2923901">token</span><span class="op" id="2923906">.</span><span class="ident" id="2923907">SHR</span><span class="op" id="2923910">,</span>&nbsp;<span class="ident" id="2923912">token</span><span class="op" id="2923917">.</span><span class="ident" id="2923918">SHR_ASSIGN</span><span class="op" id="2923928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923932">case</span>&nbsp;<span class="string" id="2923937">&#39;=&#39;</span><span class="op" id="2923940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923945">tok</span>&nbsp;<span class="op" id="2923949">=</span>&nbsp;<span class="ident" id="2923951">s</span><span class="op" id="2923952">.</span><span class="ident" id="2923953">switch2</span><span class="op" id="2923960">(</span><span class="ident" id="2923961">token</span><span class="op" id="2923966">.</span><span class="ident" id="2923967">ASSIGN</span><span class="op" id="2923973">,</span>&nbsp;<span class="ident" id="2923975">token</span><span class="op" id="2923980">.</span><span class="ident" id="2923981">EQL</span><span class="op" id="2923984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923988">case</span>&nbsp;<span class="string" id="2923993">&#39;!&#39;</span><span class="op" id="2923996">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924001">tok</span>&nbsp;<span class="op" id="2924005">=</span>&nbsp;<span class="ident" id="2924007">s</span><span class="op" id="2924008">.</span><span class="ident" id="2924009">switch2</span><span class="op" id="2924016">(</span><span class="ident" id="2924017">token</span><span class="op" id="2924022">.</span><span class="ident" id="2924023">NOT</span><span class="op" id="2924026">,</span>&nbsp;<span class="ident" id="2924028">token</span><span class="op" id="2924033">.</span><span class="ident" id="2924034">NEQ</span><span class="op" id="2924037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924041">case</span>&nbsp;<span class="string" id="2924046">&#39;&amp;&#39;</span><span class="op" id="2924049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924054">if</span>&nbsp;<span class="ident" id="2924057">s</span><span class="op" id="2924058">.</span><span class="ident" id="2924059">ch</span>&nbsp;<span class="op" id="2924062">==</span>&nbsp;<span class="string" id="2924065">&#39;^&#39;</span>&nbsp;<span class="op" id="2924069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924075">s</span><span class="op" id="2924076">.</span><span class="ident" id="2924077">next</span><span class="op" id="2924081">(</span><span class="op" id="2924082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924088">tok</span>&nbsp;<span class="op" id="2924092">=</span>&nbsp;<span class="ident" id="2924094">s</span><span class="op" id="2924095">.</span><span class="ident" id="2924096">switch2</span><span class="op" id="2924103">(</span><span class="ident" id="2924104">token</span><span class="op" id="2924109">.</span><span class="ident" id="2924110">AND_NOT</span><span class="op" id="2924117">,</span>&nbsp;<span class="ident" id="2924119">token</span><span class="op" id="2924124">.</span><span class="ident" id="2924125">AND_NOT_ASSIGN</span><span class="op" id="2924139">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924144">}</span>&nbsp;<span class="keyword" id="2924146">else</span>&nbsp;<span class="op" id="2924151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924157">tok</span>&nbsp;<span class="op" id="2924161">=</span>&nbsp;<span class="ident" id="2924163">s</span><span class="op" id="2924164">.</span><span class="ident" id="2924165">switch3</span><span class="op" id="2924172">(</span><span class="ident" id="2924173">token</span><span class="op" id="2924178">.</span><span class="ident" id="2924179">AND</span><span class="op" id="2924182">,</span>&nbsp;<span class="ident" id="2924184">token</span><span class="op" id="2924189">.</span><span class="ident" id="2924190">AND_ASSIGN</span><span class="op" id="2924200">,</span>&nbsp;<span class="string" id="2924202">&#39;&amp;&#39;</span><span class="op" id="2924205">,</span>&nbsp;<span class="ident" id="2924207">token</span><span class="op" id="2924212">.</span><span class="ident" id="2924213">LAND</span><span class="op" id="2924217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924226">case</span>&nbsp;<span class="string" id="2924231">&#39;|&#39;</span><span class="op" id="2924234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924239">tok</span>&nbsp;<span class="op" id="2924243">=</span>&nbsp;<span class="ident" id="2924245">s</span><span class="op" id="2924246">.</span><span class="ident" id="2924247">switch3</span><span class="op" id="2924254">(</span><span class="ident" id="2924255">token</span><span class="op" id="2924260">.</span><span class="ident" id="2924261">OR</span><span class="op" id="2924263">,</span>&nbsp;<span class="ident" id="2924265">token</span><span class="op" id="2924270">.</span><span class="ident" id="2924271">OR_ASSIGN</span><span class="op" id="2924280">,</span>&nbsp;<span class="string" id="2924282">&#39;|&#39;</span><span class="op" id="2924285">,</span>&nbsp;<span class="ident" id="2924287">token</span><span class="op" id="2924292">.</span><span class="ident" id="2924293">LOR</span><span class="op" id="2924296">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924300">default</span><span class="op" id="2924307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2924312">//&nbsp;next&nbsp;reports&nbsp;unexpected&nbsp;BOMs&nbsp;-&nbsp;don&#39;t&nbsp;repeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924362">if</span>&nbsp;<span class="ident" id="2924365">ch</span>&nbsp;<span class="op" id="2924368">!=</span>&nbsp;<span class="ident" id="2924371">bom</span>&nbsp;<span class="op" id="2924375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924381">s</span><span class="op" id="2924382">.</span><span class="builtintype" id="2924383">error</span><span class="op" id="2924388">(</span><span class="ident" id="2924389">s</span><span class="op" id="2924390">.</span><span class="ident" id="2924391">file</span><span class="op" id="2924395">.</span><span class="ident" id="2924396">Offset</span><span class="op" id="2924402">(</span><span class="ident" id="2924403">pos</span><span class="op" id="2924406">)</span><span class="op" id="2924407">,</span>&nbsp;<span class="ident" id="2924409">fmt</span><span class="op" id="2924412">.</span><span class="ident" id="2924413">Sprintf</span><span class="op" id="2924420">(</span><span class="string" id="2924421">&#34;illegal&nbsp;character&nbsp;%#U&#34;</span><span class="op" id="2924444">,</span>&nbsp;<span class="ident" id="2924446">ch</span><span class="op" id="2924448">)</span><span class="op" id="2924449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924454">}</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924459">insertSemi</span>&nbsp;<span class="op" id="2924470">=</span>&nbsp;<span class="ident" id="2924472">s</span><span class="op" id="2924473">.</span><span class="ident" id="2924474">insertSemi</span>&nbsp;<span class="comment" id="2924485">//&nbsp;preserve&nbsp;insertSemi&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924516">tok</span>&nbsp;<span class="op" id="2924520">=</span>&nbsp;<span class="ident" id="2924522">token</span><span class="op" id="2924527">.</span><span class="ident" id="2924528">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924539">lit</span>&nbsp;<span class="op" id="2924543">=</span>&nbsp;<span class="builtintype" id="2924545">string</span><span class="op" id="2924551">(</span><span class="ident" id="2924552">ch</span><span class="op" id="2924554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924561">}</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924564">if</span>&nbsp;<span class="ident" id="2924567">s</span><span class="op" id="2924568">.</span><span class="ident" id="2924569">mode</span><span class="op" id="2924573">&amp;</span><span class="ident" id="2924574">dontInsertSemis</span>&nbsp;<span class="op" id="2924590">==</span>&nbsp;<span class="num" id="2924593">0</span>&nbsp;<span class="op" id="2924595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924599">s</span><span class="op" id="2924600">.</span><span class="ident" id="2924601">insertSemi</span>&nbsp;<span class="op" id="2924612">=</span>&nbsp;<span class="ident" id="2924614">insertSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924630">return</span><br>
<span class="lineno">760</span><span class="op" id="2924637">}</span>
</div>
</body>
</html>
