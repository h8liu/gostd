<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html" class="current">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="632616">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="632671">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="632725">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="632776">package</span>&nbsp;<span class="ident" id="632784">os_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="632793">import</span>&nbsp;<span class="op" id="632800">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632803">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632812">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632822">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632830">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632837">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632843">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="632856">.</span>&nbsp;<span class="string" id="632858">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="632864">osexec</span>&nbsp;<span class="string" id="632871">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632882">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632899">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632910">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632921">&#34;sort&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632929">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632940">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632948">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632959">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632970">&#34;text/template&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="632987">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="632994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="632997">var</span>&nbsp;<span class="ident" id="633001">supportsSymlinks</span>&nbsp;<span class="op" id="633018">=</span>&nbsp;<span class="builtintype" id="633020">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="633026">var</span>&nbsp;<span class="ident" id="633030">dot</span>&nbsp;<span class="op" id="633034">=</span>&nbsp;<span class="op" id="633036">[</span><span class="op" id="633037">]</span><span class="builtintype" id="633038">string</span><span class="op" id="633044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633047">&#34;dir_unix.go&#34;</span><span class="op" id="633060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633063">&#34;env.go&#34;</span><span class="op" id="633071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633074">&#34;error.go&#34;</span><span class="op" id="633084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633087">&#34;file.go&#34;</span><span class="op" id="633096">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633099">&#34;os_test.go&#34;</span><span class="op" id="633111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633114">&#34;types.go&#34;</span><span class="op" id="633124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633127">&#34;stat_darwin.go&#34;</span><span class="op" id="633143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633146">&#34;stat_linux.go&#34;</span><span class="op" id="633161">,</span><br>
<span class="lineno"></span><span class="op" id="633163">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="633166">type</span>&nbsp;<span class="ident" id="633171">sysDir</span>&nbsp;<span class="keyword" id="633178">struct</span>&nbsp;<span class="op" id="633185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633188">name</span>&nbsp;&nbsp;<span class="builtintype" id="633194">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633202">files</span>&nbsp;<span class="op" id="633208">[</span><span class="op" id="633209">]</span><span class="builtintype" id="633210">string</span><br>
<span class="lineno"></span><span class="op" id="633217">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="633220">var</span>&nbsp;<span class="ident" id="633224">sysdir</span>&nbsp;<span class="op" id="633231">=</span>&nbsp;<span class="keyword" id="633233">func</span><span class="op" id="633237">(</span><span class="op" id="633238">)</span>&nbsp;<span class="op" id="633240">(</span><span class="ident" id="633241">sd</span>&nbsp;<span class="op" id="633244">*</span><span class="ident" id="633245">sysDir</span><span class="op" id="633251">)</span>&nbsp;<span class="op" id="633253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633256">switch</span>&nbsp;<span class="ident" id="633263">runtime</span><span class="op" id="633270">.</span><span class="ident" id="633271">GOOS</span>&nbsp;<span class="op" id="633276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633279">case</span>&nbsp;<span class="string" id="633284">&#34;android&#34;</span><span class="op" id="633293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633297">sd</span>&nbsp;<span class="op" id="633300">=</span>&nbsp;<span class="op" id="633302">&amp;</span><span class="ident" id="633303">sysDir</span><span class="op" id="633309">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633314">&#34;/system/etc&#34;</span><span class="op" id="633327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633332">[</span><span class="op" id="633333">]</span><span class="builtintype" id="633334">string</span><span class="op" id="633340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633346">&#34;audio_policy.conf&#34;</span><span class="op" id="633365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633371">&#34;system_fonts.xml&#34;</span><span class="op" id="633389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633394">}</span><span class="op" id="633395">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633402">case</span>&nbsp;<span class="string" id="633407">&#34;windows&#34;</span><span class="op" id="633416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633420">sd</span>&nbsp;<span class="op" id="633423">=</span>&nbsp;<span class="op" id="633425">&amp;</span><span class="ident" id="633426">sysDir</span><span class="op" id="633432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633437">Getenv</span><span class="op" id="633443">(</span><span class="string" id="633444">&#34;SystemRoot&#34;</span><span class="op" id="633456">)</span>&nbsp;<span class="op" id="633458">+</span>&nbsp;<span class="string" id="633460">&#34;\\system32\\drivers\\etc&#34;</span><span class="op" id="633486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633491">[</span><span class="op" id="633492">]</span><span class="builtintype" id="633493">string</span><span class="op" id="633499">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633505">&#34;networks&#34;</span><span class="op" id="633515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633521">&#34;protocol&#34;</span><span class="op" id="633531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633537">&#34;services&#34;</span><span class="op" id="633547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633552">}</span><span class="op" id="633553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633557">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633560">case</span>&nbsp;<span class="string" id="633565">&#34;plan9&#34;</span><span class="op" id="633572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633576">sd</span>&nbsp;<span class="op" id="633579">=</span>&nbsp;<span class="op" id="633581">&amp;</span><span class="ident" id="633582">sysDir</span><span class="op" id="633588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633593">&#34;/lib/ndb&#34;</span><span class="op" id="633603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633608">[</span><span class="op" id="633609">]</span><span class="builtintype" id="633610">string</span><span class="op" id="633616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633622">&#34;common&#34;</span><span class="op" id="633630">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633636">&#34;local&#34;</span><span class="op" id="633643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633648">}</span><span class="op" id="633649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633656">default</span><span class="op" id="633663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633667">sd</span>&nbsp;<span class="op" id="633670">=</span>&nbsp;<span class="op" id="633672">&amp;</span><span class="ident" id="633673">sysDir</span><span class="op" id="633679">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633684">&#34;/etc&#34;</span><span class="op" id="633690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633695">[</span><span class="op" id="633696">]</span><span class="builtintype" id="633697">string</span><span class="op" id="633703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633709">&#34;group&#34;</span><span class="op" id="633716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633722">&#34;hosts&#34;</span><span class="op" id="633729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="633735">&#34;passwd&#34;</span><span class="op" id="633743">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633748">}</span><span class="op" id="633749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633759">return</span><br>
<span class="lineno"></span><span class="op" id="633766">}</span><span class="op" id="633767">(</span><span class="op" id="633768">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="633771">func</span>&nbsp;<span class="ident" id="633776">size</span><span class="op" id="633780">(</span><span class="ident" id="633781">name</span>&nbsp;<span class="builtintype" id="633786">string</span><span class="op" id="633792">,</span>&nbsp;<span class="ident" id="633794">t</span>&nbsp;<span class="op" id="633796">*</span><span class="ident" id="633797">testing</span><span class="op" id="633804">.</span><span class="ident" id="633805">T</span><span class="op" id="633806">)</span>&nbsp;<span class="ident" id="633808">int64</span>&nbsp;<span class="op" id="633814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633817">file</span><span class="op" id="633821">,</span>&nbsp;<span class="ident" id="633823">err</span>&nbsp;<span class="op" id="633827">:=</span>&nbsp;<span class="ident" id="633830">Open</span><span class="op" id="633834">(</span><span class="ident" id="633835">name</span><span class="op" id="633839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633842">if</span>&nbsp;<span class="ident" id="633845">err</span>&nbsp;<span class="op" id="633849">!=</span>&nbsp;<span class="ident" id="633852">nil</span>&nbsp;<span class="op" id="633856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633860">t</span><span class="op" id="633861">.</span><span class="ident" id="633862">Fatal</span><span class="op" id="633867">(</span><span class="string" id="633868">&#34;open&nbsp;failed:&#34;</span><span class="op" id="633882">,</span>&nbsp;<span class="ident" id="633884">err</span><span class="op" id="633887">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="633890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633893">defer</span>&nbsp;<span class="ident" id="633899">file</span><span class="op" id="633903">.</span><span class="ident" id="633904">Close</span><span class="op" id="633909">(</span><span class="op" id="633910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633913">var</span>&nbsp;<span class="ident" id="633917">buf</span>&nbsp;<span class="op" id="633921">[</span><span class="num" id="633922">100</span><span class="op" id="633925">]</span><span class="builtintype" id="633926">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="633932">len</span>&nbsp;<span class="op" id="633936">:=</span>&nbsp;<span class="num" id="633939">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633942">for</span>&nbsp;<span class="op" id="633946">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="633950">n</span><span class="op" id="633951">,</span>&nbsp;<span class="ident" id="633953">e</span>&nbsp;<span class="op" id="633955">:=</span>&nbsp;<span class="ident" id="633958">file</span><span class="op" id="633962">.</span><span class="ident" id="633963">Read</span><span class="op" id="633967">(</span><span class="ident" id="633968">buf</span><span class="op" id="633971">[</span><span class="num" id="633972">0</span><span class="op" id="633973">:</span><span class="op" id="633974">]</span><span class="op" id="633975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="633979">len</span>&nbsp;<span class="op" id="633983">+=</span>&nbsp;<span class="ident" id="633986">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="633990">if</span>&nbsp;<span class="ident" id="633993">e</span>&nbsp;<span class="op" id="633995">==</span>&nbsp;<span class="ident" id="633998">io</span><span class="op" id="634000">.</span><span class="ident" id="634001">EOF</span>&nbsp;<span class="op" id="634005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634010">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634018">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634022">if</span>&nbsp;<span class="ident" id="634025">e</span>&nbsp;<span class="op" id="634027">!=</span>&nbsp;<span class="ident" id="634030">nil</span>&nbsp;<span class="op" id="634034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634039">t</span><span class="op" id="634040">.</span><span class="ident" id="634041">Fatal</span><span class="op" id="634046">(</span><span class="string" id="634047">&#34;read&nbsp;failed:&#34;</span><span class="op" id="634061">,</span>&nbsp;<span class="ident" id="634063">err</span><span class="op" id="634066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634076">return</span>&nbsp;<span class="ident" id="634083">int64</span><span class="op" id="634088">(</span><span class="builtinfunc" id="634089">len</span><span class="op" id="634092">)</span><br>
<span class="lineno">105</span><span class="op" id="634094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="634097">func</span>&nbsp;<span class="ident" id="634102">equal</span><span class="op" id="634107">(</span><span class="ident" id="634108">name1</span><span class="op" id="634113">,</span>&nbsp;<span class="ident" id="634115">name2</span>&nbsp;<span class="builtintype" id="634121">string</span><span class="op" id="634127">)</span>&nbsp;<span class="op" id="634129">(</span><span class="ident" id="634130">r</span>&nbsp;<span class="builtintype" id="634132">bool</span><span class="op" id="634136">)</span>&nbsp;<span class="op" id="634138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634141">switch</span>&nbsp;<span class="ident" id="634148">runtime</span><span class="op" id="634155">.</span><span class="ident" id="634156">GOOS</span>&nbsp;<span class="op" id="634161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634164">case</span>&nbsp;<span class="string" id="634169">&#34;windows&#34;</span><span class="op" id="634178">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634182">r</span>&nbsp;<span class="op" id="634184">=</span>&nbsp;<span class="ident" id="634186">strings</span><span class="op" id="634193">.</span><span class="ident" id="634194">ToLower</span><span class="op" id="634201">(</span><span class="ident" id="634202">name1</span><span class="op" id="634207">)</span>&nbsp;<span class="op" id="634209">==</span>&nbsp;<span class="ident" id="634212">strings</span><span class="op" id="634219">.</span><span class="ident" id="634220">ToLower</span><span class="op" id="634227">(</span><span class="ident" id="634228">name2</span><span class="op" id="634233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634236">default</span><span class="op" id="634243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634247">r</span>&nbsp;<span class="op" id="634249">=</span>&nbsp;<span class="ident" id="634251">name1</span>&nbsp;<span class="op" id="634257">==</span>&nbsp;<span class="ident" id="634260">name2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634270">return</span><br>
<span class="lineno">115</span><span class="op" id="634277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="634280">func</span>&nbsp;<span class="ident" id="634285">newFile</span><span class="op" id="634292">(</span><span class="ident" id="634293">testName</span>&nbsp;<span class="builtintype" id="634302">string</span><span class="op" id="634308">,</span>&nbsp;<span class="ident" id="634310">t</span>&nbsp;<span class="op" id="634312">*</span><span class="ident" id="634313">testing</span><span class="op" id="634320">.</span><span class="ident" id="634321">T</span><span class="op" id="634322">)</span>&nbsp;<span class="op" id="634324">(</span><span class="ident" id="634325">f</span>&nbsp;<span class="op" id="634327">*</span><span class="ident" id="634328">File</span><span class="op" id="634332">)</span>&nbsp;<span class="op" id="634334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="634337">//&nbsp;Use&nbsp;a&nbsp;local&nbsp;file&nbsp;system,&nbsp;not&nbsp;NFS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="634375">//&nbsp;On&nbsp;Unix,&nbsp;override&nbsp;$TMPDIR&nbsp;in&nbsp;case&nbsp;the&nbsp;user</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="634422">//&nbsp;has&nbsp;it&nbsp;set&nbsp;to&nbsp;an&nbsp;NFS-mounted&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634466">dir</span>&nbsp;<span class="op" id="634470">:=</span>&nbsp;<span class="string" id="634473">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634477">if</span>&nbsp;<span class="ident" id="634480">runtime</span><span class="op" id="634487">.</span><span class="ident" id="634488">GOOS</span>&nbsp;<span class="op" id="634493">!=</span>&nbsp;<span class="string" id="634496">&#34;android&#34;</span>&nbsp;<span class="op" id="634506">&amp;&amp;</span>&nbsp;<span class="ident" id="634509">runtime</span><span class="op" id="634516">.</span><span class="ident" id="634517">GOOS</span>&nbsp;<span class="op" id="634522">!=</span>&nbsp;<span class="string" id="634525">&#34;windows&#34;</span>&nbsp;<span class="op" id="634535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634539">dir</span>&nbsp;<span class="op" id="634543">=</span>&nbsp;<span class="string" id="634545">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634553">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634556">f</span><span class="op" id="634557">,</span>&nbsp;<span class="ident" id="634559">err</span>&nbsp;<span class="op" id="634563">:=</span>&nbsp;<span class="ident" id="634566">ioutil</span><span class="op" id="634572">.</span><span class="ident" id="634573">TempFile</span><span class="op" id="634581">(</span><span class="ident" id="634582">dir</span><span class="op" id="634585">,</span>&nbsp;<span class="string" id="634587">&#34;_Go_&#34;</span><span class="op" id="634593">+</span><span class="ident" id="634594">testName</span><span class="op" id="634602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634605">if</span>&nbsp;<span class="ident" id="634608">err</span>&nbsp;<span class="op" id="634612">!=</span>&nbsp;<span class="ident" id="634615">nil</span>&nbsp;<span class="op" id="634619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634623">t</span><span class="op" id="634624">.</span><span class="ident" id="634625">Fatalf</span><span class="op" id="634631">(</span><span class="string" id="634632">&#34;TempFile&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="634649">,</span>&nbsp;<span class="ident" id="634651">testName</span><span class="op" id="634659">,</span>&nbsp;<span class="ident" id="634661">err</span><span class="op" id="634664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634670">return</span><br>
<span class="lineno">130</span><span class="op" id="634677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="634680">func</span>&nbsp;<span class="ident" id="634685">newDir</span><span class="op" id="634691">(</span><span class="ident" id="634692">testName</span>&nbsp;<span class="builtintype" id="634701">string</span><span class="op" id="634707">,</span>&nbsp;<span class="ident" id="634709">t</span>&nbsp;<span class="op" id="634711">*</span><span class="ident" id="634712">testing</span><span class="op" id="634719">.</span><span class="ident" id="634720">T</span><span class="op" id="634721">)</span>&nbsp;<span class="op" id="634723">(</span><span class="ident" id="634724">name</span>&nbsp;<span class="builtintype" id="634729">string</span><span class="op" id="634735">)</span>&nbsp;<span class="op" id="634737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="634740">//&nbsp;Use&nbsp;a&nbsp;local&nbsp;file&nbsp;system,&nbsp;not&nbsp;NFS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="634778">//&nbsp;On&nbsp;Unix,&nbsp;override&nbsp;$TMPDIR&nbsp;in&nbsp;case&nbsp;the&nbsp;user</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="634825">//&nbsp;has&nbsp;it&nbsp;set&nbsp;to&nbsp;an&nbsp;NFS-mounted&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634869">dir</span>&nbsp;<span class="op" id="634873">:=</span>&nbsp;<span class="string" id="634876">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="634880">if</span>&nbsp;<span class="ident" id="634883">runtime</span><span class="op" id="634890">.</span><span class="ident" id="634891">GOOS</span>&nbsp;<span class="op" id="634896">!=</span>&nbsp;<span class="string" id="634899">&#34;android&#34;</span>&nbsp;<span class="op" id="634909">&amp;&amp;</span>&nbsp;<span class="ident" id="634912">runtime</span><span class="op" id="634919">.</span><span class="ident" id="634920">GOOS</span>&nbsp;<span class="op" id="634925">!=</span>&nbsp;<span class="string" id="634928">&#34;windows&#34;</span>&nbsp;<span class="op" id="634938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634942">dir</span>&nbsp;<span class="op" id="634946">=</span>&nbsp;<span class="string" id="634948">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="634956">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="634959">name</span><span class="op" id="634963">,</span>&nbsp;<span class="ident" id="634965">err</span>&nbsp;<span class="op" id="634969">:=</span>&nbsp;<span class="ident" id="634972">ioutil</span><span class="op" id="634978">.</span><span class="ident" id="634979">TempDir</span><span class="op" id="634986">(</span><span class="ident" id="634987">dir</span><span class="op" id="634990">,</span>&nbsp;<span class="string" id="634992">&#34;_Go_&#34;</span><span class="op" id="634998">+</span><span class="ident" id="634999">testName</span><span class="op" id="635007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635010">if</span>&nbsp;<span class="ident" id="635013">err</span>&nbsp;<span class="op" id="635017">!=</span>&nbsp;<span class="ident" id="635020">nil</span>&nbsp;<span class="op" id="635024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635028">t</span><span class="op" id="635029">.</span><span class="ident" id="635030">Fatalf</span><span class="op" id="635036">(</span><span class="string" id="635037">&#34;TempDir&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="635053">,</span>&nbsp;<span class="ident" id="635055">testName</span><span class="op" id="635063">,</span>&nbsp;<span class="ident" id="635065">err</span><span class="op" id="635068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635074">return</span><br>
<span class="lineno">145</span><span class="op" id="635081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="635084">var</span>&nbsp;<span class="ident" id="635088">sfdir</span>&nbsp;<span class="op" id="635094">=</span>&nbsp;<span class="ident" id="635096">sysdir</span><span class="op" id="635102">.</span><span class="ident" id="635103">name</span><br>
<span class="lineno"></span><span class="keyword" id="635108">var</span>&nbsp;<span class="ident" id="635112">sfname</span>&nbsp;<span class="op" id="635119">=</span>&nbsp;<span class="ident" id="635121">sysdir</span><span class="op" id="635127">.</span><span class="ident" id="635128">files</span><span class="op" id="635133">[</span><span class="num" id="635134">0</span><span class="op" id="635135">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="635138">func</span>&nbsp;<span class="ident" id="635143">TestStat</span><span class="op" id="635151">(</span><span class="ident" id="635152">t</span>&nbsp;<span class="op" id="635154">*</span><span class="ident" id="635155">testing</span><span class="op" id="635162">.</span><span class="ident" id="635163">T</span><span class="op" id="635164">)</span>&nbsp;<span class="op" id="635166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635169">path</span>&nbsp;<span class="op" id="635174">:=</span>&nbsp;<span class="ident" id="635177">sfdir</span>&nbsp;<span class="op" id="635183">+</span>&nbsp;<span class="string" id="635185">&#34;/&#34;</span>&nbsp;<span class="op" id="635189">+</span>&nbsp;<span class="ident" id="635191">sfname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635199">dir</span><span class="op" id="635202">,</span>&nbsp;<span class="ident" id="635204">err</span>&nbsp;<span class="op" id="635208">:=</span>&nbsp;<span class="ident" id="635211">Stat</span><span class="op" id="635215">(</span><span class="ident" id="635216">path</span><span class="op" id="635220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635223">if</span>&nbsp;<span class="ident" id="635226">err</span>&nbsp;<span class="op" id="635230">!=</span>&nbsp;<span class="ident" id="635233">nil</span>&nbsp;<span class="op" id="635237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635241">t</span><span class="op" id="635242">.</span><span class="ident" id="635243">Fatal</span><span class="op" id="635248">(</span><span class="string" id="635249">&#34;stat&nbsp;failed:&#34;</span><span class="op" id="635263">,</span>&nbsp;<span class="ident" id="635265">err</span><span class="op" id="635268">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635274">if</span>&nbsp;<span class="op" id="635277">!</span><span class="ident" id="635278">equal</span><span class="op" id="635283">(</span><span class="ident" id="635284">sfname</span><span class="op" id="635290">,</span>&nbsp;<span class="ident" id="635292">dir</span><span class="op" id="635295">.</span><span class="ident" id="635296">Name</span><span class="op" id="635300">(</span><span class="op" id="635301">)</span><span class="op" id="635302">)</span>&nbsp;<span class="op" id="635304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635308">t</span><span class="op" id="635309">.</span><span class="ident" id="635310">Error</span><span class="op" id="635315">(</span><span class="string" id="635316">&#34;name&nbsp;should&nbsp;be&nbsp;&#34;</span><span class="op" id="635333">,</span>&nbsp;<span class="ident" id="635335">sfname</span><span class="op" id="635341">,</span>&nbsp;<span class="string" id="635343">&#34;;&nbsp;is&#34;</span><span class="op" id="635349">,</span>&nbsp;<span class="ident" id="635351">dir</span><span class="op" id="635354">.</span><span class="ident" id="635355">Name</span><span class="op" id="635359">(</span><span class="op" id="635360">)</span><span class="op" id="635361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635367">filesize</span>&nbsp;<span class="op" id="635376">:=</span>&nbsp;<span class="ident" id="635379">size</span><span class="op" id="635383">(</span><span class="ident" id="635384">path</span><span class="op" id="635388">,</span>&nbsp;<span class="ident" id="635390">t</span><span class="op" id="635391">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635394">if</span>&nbsp;<span class="ident" id="635397">dir</span><span class="op" id="635400">.</span><span class="ident" id="635401">Size</span><span class="op" id="635405">(</span><span class="op" id="635406">)</span>&nbsp;<span class="op" id="635408">!=</span>&nbsp;<span class="ident" id="635411">filesize</span>&nbsp;<span class="op" id="635420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635424">t</span><span class="op" id="635425">.</span><span class="ident" id="635426">Error</span><span class="op" id="635431">(</span><span class="string" id="635432">&#34;size&nbsp;should&nbsp;be&#34;</span><span class="op" id="635448">,</span>&nbsp;<span class="ident" id="635450">filesize</span><span class="op" id="635458">,</span>&nbsp;<span class="string" id="635460">&#34;;&nbsp;is&#34;</span><span class="op" id="635466">,</span>&nbsp;<span class="ident" id="635468">dir</span><span class="op" id="635471">.</span><span class="ident" id="635472">Size</span><span class="op" id="635476">(</span><span class="op" id="635477">)</span><span class="op" id="635478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635481">}</span><br>
<span class="lineno"></span><span class="op" id="635483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="635486">func</span>&nbsp;<span class="ident" id="635491">TestFstat</span><span class="op" id="635500">(</span><span class="ident" id="635501">t</span>&nbsp;<span class="op" id="635503">*</span><span class="ident" id="635504">testing</span><span class="op" id="635511">.</span><span class="ident" id="635512">T</span><span class="op" id="635513">)</span>&nbsp;<span class="op" id="635515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635518">path</span>&nbsp;<span class="op" id="635523">:=</span>&nbsp;<span class="ident" id="635526">sfdir</span>&nbsp;<span class="op" id="635532">+</span>&nbsp;<span class="string" id="635534">&#34;/&#34;</span>&nbsp;<span class="op" id="635538">+</span>&nbsp;<span class="ident" id="635540">sfname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635548">file</span><span class="op" id="635552">,</span>&nbsp;<span class="ident" id="635554">err1</span>&nbsp;<span class="op" id="635559">:=</span>&nbsp;<span class="ident" id="635562">Open</span><span class="op" id="635566">(</span><span class="ident" id="635567">path</span><span class="op" id="635571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635574">if</span>&nbsp;<span class="ident" id="635577">err1</span>&nbsp;<span class="op" id="635582">!=</span>&nbsp;<span class="ident" id="635585">nil</span>&nbsp;<span class="op" id="635589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635593">t</span><span class="op" id="635594">.</span><span class="ident" id="635595">Fatal</span><span class="op" id="635600">(</span><span class="string" id="635601">&#34;open&nbsp;failed:&#34;</span><span class="op" id="635615">,</span>&nbsp;<span class="ident" id="635617">err1</span><span class="op" id="635621">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635627">defer</span>&nbsp;<span class="ident" id="635633">file</span><span class="op" id="635637">.</span><span class="ident" id="635638">Close</span><span class="op" id="635643">(</span><span class="op" id="635644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635647">dir</span><span class="op" id="635650">,</span>&nbsp;<span class="ident" id="635652">err2</span>&nbsp;<span class="op" id="635657">:=</span>&nbsp;<span class="ident" id="635660">file</span><span class="op" id="635664">.</span><span class="ident" id="635665">Stat</span><span class="op" id="635669">(</span><span class="op" id="635670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635673">if</span>&nbsp;<span class="ident" id="635676">err2</span>&nbsp;<span class="op" id="635681">!=</span>&nbsp;<span class="ident" id="635684">nil</span>&nbsp;<span class="op" id="635688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635692">t</span><span class="op" id="635693">.</span><span class="ident" id="635694">Fatal</span><span class="op" id="635699">(</span><span class="string" id="635700">&#34;fstat&nbsp;failed:&#34;</span><span class="op" id="635715">,</span>&nbsp;<span class="ident" id="635717">err2</span><span class="op" id="635721">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635727">if</span>&nbsp;<span class="op" id="635730">!</span><span class="ident" id="635731">equal</span><span class="op" id="635736">(</span><span class="ident" id="635737">sfname</span><span class="op" id="635743">,</span>&nbsp;<span class="ident" id="635745">dir</span><span class="op" id="635748">.</span><span class="ident" id="635749">Name</span><span class="op" id="635753">(</span><span class="op" id="635754">)</span><span class="op" id="635755">)</span>&nbsp;<span class="op" id="635757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635761">t</span><span class="op" id="635762">.</span><span class="ident" id="635763">Error</span><span class="op" id="635768">(</span><span class="string" id="635769">&#34;name&nbsp;should&nbsp;be&nbsp;&#34;</span><span class="op" id="635786">,</span>&nbsp;<span class="ident" id="635788">sfname</span><span class="op" id="635794">,</span>&nbsp;<span class="string" id="635796">&#34;;&nbsp;is&#34;</span><span class="op" id="635802">,</span>&nbsp;<span class="ident" id="635804">dir</span><span class="op" id="635807">.</span><span class="ident" id="635808">Name</span><span class="op" id="635812">(</span><span class="op" id="635813">)</span><span class="op" id="635814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635820">filesize</span>&nbsp;<span class="op" id="635829">:=</span>&nbsp;<span class="ident" id="635832">size</span><span class="op" id="635836">(</span><span class="ident" id="635837">path</span><span class="op" id="635841">,</span>&nbsp;<span class="ident" id="635843">t</span><span class="op" id="635844">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="635847">if</span>&nbsp;<span class="ident" id="635850">dir</span><span class="op" id="635853">.</span><span class="ident" id="635854">Size</span><span class="op" id="635858">(</span><span class="op" id="635859">)</span>&nbsp;<span class="op" id="635861">!=</span>&nbsp;<span class="ident" id="635864">filesize</span>&nbsp;<span class="op" id="635873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635877">t</span><span class="op" id="635878">.</span><span class="ident" id="635879">Error</span><span class="op" id="635884">(</span><span class="string" id="635885">&#34;size&nbsp;should&nbsp;be&#34;</span><span class="op" id="635901">,</span>&nbsp;<span class="ident" id="635903">filesize</span><span class="op" id="635911">,</span>&nbsp;<span class="string" id="635913">&#34;;&nbsp;is&#34;</span><span class="op" id="635919">,</span>&nbsp;<span class="ident" id="635921">dir</span><span class="op" id="635924">.</span><span class="ident" id="635925">Size</span><span class="op" id="635929">(</span><span class="op" id="635930">)</span><span class="op" id="635931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="635934">}</span><br>
<span class="lineno"></span><span class="op" id="635936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="635939">func</span>&nbsp;<span class="ident" id="635944">TestLstat</span><span class="op" id="635953">(</span><span class="ident" id="635954">t</span>&nbsp;<span class="op" id="635956">*</span><span class="ident" id="635957">testing</span><span class="op" id="635964">.</span><span class="ident" id="635965">T</span><span class="op" id="635966">)</span>&nbsp;<span class="op" id="635968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="635971">path</span>&nbsp;<span class="op" id="635976">:=</span>&nbsp;<span class="ident" id="635979">sfdir</span>&nbsp;<span class="op" id="635985">+</span>&nbsp;<span class="string" id="635987">&#34;/&#34;</span>&nbsp;<span class="op" id="635991">+</span>&nbsp;<span class="ident" id="635993">sfname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636001">dir</span><span class="op" id="636004">,</span>&nbsp;<span class="ident" id="636006">err</span>&nbsp;<span class="op" id="636010">:=</span>&nbsp;<span class="ident" id="636013">Lstat</span><span class="op" id="636018">(</span><span class="ident" id="636019">path</span><span class="op" id="636023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636026">if</span>&nbsp;<span class="ident" id="636029">err</span>&nbsp;<span class="op" id="636033">!=</span>&nbsp;<span class="ident" id="636036">nil</span>&nbsp;<span class="op" id="636040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636044">t</span><span class="op" id="636045">.</span><span class="ident" id="636046">Fatal</span><span class="op" id="636051">(</span><span class="string" id="636052">&#34;lstat&nbsp;failed:&#34;</span><span class="op" id="636067">,</span>&nbsp;<span class="ident" id="636069">err</span><span class="op" id="636072">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636078">if</span>&nbsp;<span class="op" id="636081">!</span><span class="ident" id="636082">equal</span><span class="op" id="636087">(</span><span class="ident" id="636088">sfname</span><span class="op" id="636094">,</span>&nbsp;<span class="ident" id="636096">dir</span><span class="op" id="636099">.</span><span class="ident" id="636100">Name</span><span class="op" id="636104">(</span><span class="op" id="636105">)</span><span class="op" id="636106">)</span>&nbsp;<span class="op" id="636108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636112">t</span><span class="op" id="636113">.</span><span class="ident" id="636114">Error</span><span class="op" id="636119">(</span><span class="string" id="636120">&#34;name&nbsp;should&nbsp;be&nbsp;&#34;</span><span class="op" id="636137">,</span>&nbsp;<span class="ident" id="636139">sfname</span><span class="op" id="636145">,</span>&nbsp;<span class="string" id="636147">&#34;;&nbsp;is&#34;</span><span class="op" id="636153">,</span>&nbsp;<span class="ident" id="636155">dir</span><span class="op" id="636158">.</span><span class="ident" id="636159">Name</span><span class="op" id="636163">(</span><span class="op" id="636164">)</span><span class="op" id="636165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636171">filesize</span>&nbsp;<span class="op" id="636180">:=</span>&nbsp;<span class="ident" id="636183">size</span><span class="op" id="636187">(</span><span class="ident" id="636188">path</span><span class="op" id="636192">,</span>&nbsp;<span class="ident" id="636194">t</span><span class="op" id="636195">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636198">if</span>&nbsp;<span class="ident" id="636201">dir</span><span class="op" id="636204">.</span><span class="ident" id="636205">Size</span><span class="op" id="636209">(</span><span class="op" id="636210">)</span>&nbsp;<span class="op" id="636212">!=</span>&nbsp;<span class="ident" id="636215">filesize</span>&nbsp;<span class="op" id="636224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636228">t</span><span class="op" id="636229">.</span><span class="ident" id="636230">Error</span><span class="op" id="636235">(</span><span class="string" id="636236">&#34;size&nbsp;should&nbsp;be&#34;</span><span class="op" id="636252">,</span>&nbsp;<span class="ident" id="636254">filesize</span><span class="op" id="636262">,</span>&nbsp;<span class="string" id="636264">&#34;;&nbsp;is&#34;</span><span class="op" id="636270">,</span>&nbsp;<span class="ident" id="636272">dir</span><span class="op" id="636275">.</span><span class="ident" id="636276">Size</span><span class="op" id="636280">(</span><span class="op" id="636281">)</span><span class="op" id="636282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636285">}</span><br>
<span class="lineno"></span><span class="op" id="636287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="636290">//&nbsp;Read&nbsp;with&nbsp;length&nbsp;0&nbsp;should&nbsp;not&nbsp;return&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="636335">func</span>&nbsp;<span class="ident" id="636340">TestRead0</span><span class="op" id="636349">(</span><span class="ident" id="636350">t</span>&nbsp;<span class="op" id="636352">*</span><span class="ident" id="636353">testing</span><span class="op" id="636360">.</span><span class="ident" id="636361">T</span><span class="op" id="636362">)</span>&nbsp;<span class="op" id="636364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636367">path</span>&nbsp;<span class="op" id="636372">:=</span>&nbsp;<span class="ident" id="636375">sfdir</span>&nbsp;<span class="op" id="636381">+</span>&nbsp;<span class="string" id="636383">&#34;/&#34;</span>&nbsp;<span class="op" id="636387">+</span>&nbsp;<span class="ident" id="636389">sfname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636397">f</span><span class="op" id="636398">,</span>&nbsp;<span class="ident" id="636400">err</span>&nbsp;<span class="op" id="636404">:=</span>&nbsp;<span class="ident" id="636407">Open</span><span class="op" id="636411">(</span><span class="ident" id="636412">path</span><span class="op" id="636416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636419">if</span>&nbsp;<span class="ident" id="636422">err</span>&nbsp;<span class="op" id="636426">!=</span>&nbsp;<span class="ident" id="636429">nil</span>&nbsp;<span class="op" id="636433">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636437">t</span><span class="op" id="636438">.</span><span class="ident" id="636439">Fatal</span><span class="op" id="636444">(</span><span class="string" id="636445">&#34;open&nbsp;failed:&#34;</span><span class="op" id="636459">,</span>&nbsp;<span class="ident" id="636461">err</span><span class="op" id="636464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636470">defer</span>&nbsp;<span class="ident" id="636476">f</span><span class="op" id="636477">.</span><span class="ident" id="636478">Close</span><span class="op" id="636483">(</span><span class="op" id="636484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636488">b</span>&nbsp;<span class="op" id="636490">:=</span>&nbsp;<span class="builtinfunc" id="636493">make</span><span class="op" id="636497">(</span><span class="op" id="636498">[</span><span class="op" id="636499">]</span><span class="builtintype" id="636500">byte</span><span class="op" id="636504">,</span>&nbsp;<span class="num" id="636506">0</span><span class="op" id="636507">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636510">n</span><span class="op" id="636511">,</span>&nbsp;<span class="ident" id="636513">err</span>&nbsp;<span class="op" id="636517">:=</span>&nbsp;<span class="ident" id="636520">f</span><span class="op" id="636521">.</span><span class="ident" id="636522">Read</span><span class="op" id="636526">(</span><span class="ident" id="636527">b</span><span class="op" id="636528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636531">if</span>&nbsp;<span class="ident" id="636534">n</span>&nbsp;<span class="op" id="636536">!=</span>&nbsp;<span class="num" id="636539">0</span>&nbsp;<span class="op" id="636541">||</span>&nbsp;<span class="ident" id="636544">err</span>&nbsp;<span class="op" id="636548">!=</span>&nbsp;<span class="ident" id="636551">nil</span>&nbsp;<span class="op" id="636555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636559">t</span><span class="op" id="636560">.</span><span class="ident" id="636561">Errorf</span><span class="op" id="636567">(</span><span class="string" id="636568">&#34;Read(0)&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;0,&nbsp;nil&#34;</span><span class="op" id="636599">,</span>&nbsp;<span class="ident" id="636601">n</span><span class="op" id="636602">,</span>&nbsp;<span class="ident" id="636604">err</span><span class="op" id="636607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636613">b</span>&nbsp;<span class="op" id="636615">=</span>&nbsp;<span class="builtinfunc" id="636617">make</span><span class="op" id="636621">(</span><span class="op" id="636622">[</span><span class="op" id="636623">]</span><span class="builtintype" id="636624">byte</span><span class="op" id="636628">,</span>&nbsp;<span class="num" id="636630">100</span><span class="op" id="636633">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636636">n</span><span class="op" id="636637">,</span>&nbsp;<span class="ident" id="636639">err</span>&nbsp;<span class="op" id="636643">=</span>&nbsp;<span class="ident" id="636645">f</span><span class="op" id="636646">.</span><span class="ident" id="636647">Read</span><span class="op" id="636651">(</span><span class="ident" id="636652">b</span><span class="op" id="636653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636656">if</span>&nbsp;<span class="ident" id="636659">n</span>&nbsp;<span class="op" id="636661">&lt;=</span>&nbsp;<span class="num" id="636664">0</span>&nbsp;<span class="op" id="636666">||</span>&nbsp;<span class="ident" id="636669">err</span>&nbsp;<span class="op" id="636673">!=</span>&nbsp;<span class="ident" id="636676">nil</span>&nbsp;<span class="op" id="636680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636684">t</span><span class="op" id="636685">.</span><span class="ident" id="636686">Errorf</span><span class="op" id="636692">(</span><span class="string" id="636693">&#34;Read(100)&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;&gt;0,&nbsp;nil&#34;</span><span class="op" id="636727">,</span>&nbsp;<span class="ident" id="636729">n</span><span class="op" id="636730">,</span>&nbsp;<span class="ident" id="636732">err</span><span class="op" id="636735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636738">}</span><br>
<span class="lineno"></span><span class="op" id="636740">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="636743">func</span>&nbsp;<span class="ident" id="636748">testReaddirnames</span><span class="op" id="636764">(</span><span class="ident" id="636765">dir</span>&nbsp;<span class="builtintype" id="636769">string</span><span class="op" id="636775">,</span>&nbsp;<span class="ident" id="636777">contents</span>&nbsp;<span class="op" id="636786">[</span><span class="op" id="636787">]</span><span class="builtintype" id="636788">string</span><span class="op" id="636794">,</span>&nbsp;<span class="ident" id="636796">t</span>&nbsp;<span class="op" id="636798">*</span><span class="ident" id="636799">testing</span><span class="op" id="636806">.</span><span class="ident" id="636807">T</span><span class="op" id="636808">)</span>&nbsp;<span class="op" id="636810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636813">file</span><span class="op" id="636817">,</span>&nbsp;<span class="ident" id="636819">err</span>&nbsp;<span class="op" id="636823">:=</span>&nbsp;<span class="ident" id="636826">Open</span><span class="op" id="636830">(</span><span class="ident" id="636831">dir</span><span class="op" id="636834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636837">if</span>&nbsp;<span class="ident" id="636840">err</span>&nbsp;<span class="op" id="636844">!=</span>&nbsp;<span class="ident" id="636847">nil</span>&nbsp;<span class="op" id="636851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636855">t</span><span class="op" id="636856">.</span><span class="ident" id="636857">Fatalf</span><span class="op" id="636863">(</span><span class="string" id="636864">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="636884">,</span>&nbsp;<span class="ident" id="636886">dir</span><span class="op" id="636889">,</span>&nbsp;<span class="ident" id="636891">err</span><span class="op" id="636894">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="636897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636900">defer</span>&nbsp;<span class="ident" id="636906">file</span><span class="op" id="636910">.</span><span class="ident" id="636911">Close</span><span class="op" id="636916">(</span><span class="op" id="636917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636920">s</span><span class="op" id="636921">,</span>&nbsp;<span class="ident" id="636923">err2</span>&nbsp;<span class="op" id="636928">:=</span>&nbsp;<span class="ident" id="636931">file</span><span class="op" id="636935">.</span><span class="ident" id="636936">Readdirnames</span><span class="op" id="636948">(</span><span class="op" id="636949">-</span><span class="num" id="636950">1</span><span class="op" id="636951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="636954">if</span>&nbsp;<span class="ident" id="636957">err2</span>&nbsp;<span class="op" id="636962">!=</span>&nbsp;<span class="ident" id="636965">nil</span>&nbsp;<span class="op" id="636969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="636973">t</span><span class="op" id="636974">.</span><span class="ident" id="636975">Fatalf</span><span class="op" id="636981">(</span><span class="string" id="636982">&#34;readdirnames&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="637010">,</span>&nbsp;<span class="ident" id="637012">dir</span><span class="op" id="637015">,</span>&nbsp;<span class="ident" id="637017">err2</span><span class="op" id="637021">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637027">for</span>&nbsp;<span class="ident" id="637031">_</span><span class="op" id="637032">,</span>&nbsp;<span class="ident" id="637034">m</span>&nbsp;<span class="op" id="637036">:=</span>&nbsp;<span class="keyword" id="637039">range</span>&nbsp;<span class="ident" id="637045">contents</span>&nbsp;<span class="op" id="637054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637058">found</span>&nbsp;<span class="op" id="637064">:=</span>&nbsp;<span class="builtintype" id="637067">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637075">for</span>&nbsp;<span class="ident" id="637079">_</span><span class="op" id="637080">,</span>&nbsp;<span class="ident" id="637082">n</span>&nbsp;<span class="op" id="637084">:=</span>&nbsp;<span class="keyword" id="637087">range</span>&nbsp;<span class="ident" id="637093">s</span>&nbsp;<span class="op" id="637095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637100">if</span>&nbsp;<span class="ident" id="637103">n</span>&nbsp;<span class="op" id="637105">==</span>&nbsp;<span class="string" id="637108">&#34;.&#34;</span>&nbsp;<span class="op" id="637112">||</span>&nbsp;<span class="ident" id="637115">n</span>&nbsp;<span class="op" id="637117">==</span>&nbsp;<span class="string" id="637120">&#34;..&#34;</span>&nbsp;<span class="op" id="637125">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637131">t</span><span class="op" id="637132">.</span><span class="ident" id="637133">Errorf</span><span class="op" id="637139">(</span><span class="string" id="637140">&#34;got&nbsp;%s&nbsp;in&nbsp;directory&#34;</span><span class="op" id="637161">,</span>&nbsp;<span class="ident" id="637163">n</span><span class="op" id="637164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637174">if</span>&nbsp;<span class="ident" id="637177">equal</span><span class="op" id="637182">(</span><span class="ident" id="637183">m</span><span class="op" id="637184">,</span>&nbsp;<span class="ident" id="637186">n</span><span class="op" id="637187">)</span>&nbsp;<span class="op" id="637189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637195">if</span>&nbsp;<span class="ident" id="637198">found</span>&nbsp;<span class="op" id="637204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637211">t</span><span class="op" id="637212">.</span><span class="ident" id="637213">Error</span><span class="op" id="637218">(</span><span class="string" id="637219">&#34;present&nbsp;twice:&#34;</span><span class="op" id="637235">,</span>&nbsp;<span class="ident" id="637237">m</span><span class="op" id="637238">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637250">found</span>&nbsp;<span class="op" id="637256">=</span>&nbsp;<span class="builtintype" id="637258">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637274">if</span>&nbsp;<span class="op" id="637277">!</span><span class="ident" id="637278">found</span>&nbsp;<span class="op" id="637284">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637289">t</span><span class="op" id="637290">.</span><span class="ident" id="637291">Error</span><span class="op" id="637296">(</span><span class="string" id="637297">&#34;could&nbsp;not&nbsp;find&#34;</span><span class="op" id="637313">,</span>&nbsp;<span class="ident" id="637315">m</span><span class="op" id="637316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637323">}</span><br>
<span class="lineno"></span><span class="op" id="637325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="637328">func</span>&nbsp;<span class="ident" id="637333">testReaddir</span><span class="op" id="637344">(</span><span class="ident" id="637345">dir</span>&nbsp;<span class="builtintype" id="637349">string</span><span class="op" id="637355">,</span>&nbsp;<span class="ident" id="637357">contents</span>&nbsp;<span class="op" id="637366">[</span><span class="op" id="637367">]</span><span class="builtintype" id="637368">string</span><span class="op" id="637374">,</span>&nbsp;<span class="ident" id="637376">t</span>&nbsp;<span class="op" id="637378">*</span><span class="ident" id="637379">testing</span><span class="op" id="637386">.</span><span class="ident" id="637387">T</span><span class="op" id="637388">)</span>&nbsp;<span class="op" id="637390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637393">file</span><span class="op" id="637397">,</span>&nbsp;<span class="ident" id="637399">err</span>&nbsp;<span class="op" id="637403">:=</span>&nbsp;<span class="ident" id="637406">Open</span><span class="op" id="637410">(</span><span class="ident" id="637411">dir</span><span class="op" id="637414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637417">if</span>&nbsp;<span class="ident" id="637420">err</span>&nbsp;<span class="op" id="637424">!=</span>&nbsp;<span class="ident" id="637427">nil</span>&nbsp;<span class="op" id="637431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637435">t</span><span class="op" id="637436">.</span><span class="ident" id="637437">Fatalf</span><span class="op" id="637443">(</span><span class="string" id="637444">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="637464">,</span>&nbsp;<span class="ident" id="637466">dir</span><span class="op" id="637469">,</span>&nbsp;<span class="ident" id="637471">err</span><span class="op" id="637474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637477">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637480">defer</span>&nbsp;<span class="ident" id="637486">file</span><span class="op" id="637490">.</span><span class="ident" id="637491">Close</span><span class="op" id="637496">(</span><span class="op" id="637497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637500">s</span><span class="op" id="637501">,</span>&nbsp;<span class="ident" id="637503">err2</span>&nbsp;<span class="op" id="637508">:=</span>&nbsp;<span class="ident" id="637511">file</span><span class="op" id="637515">.</span><span class="ident" id="637516">Readdir</span><span class="op" id="637523">(</span><span class="op" id="637524">-</span><span class="num" id="637525">1</span><span class="op" id="637526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637529">if</span>&nbsp;<span class="ident" id="637532">err2</span>&nbsp;<span class="op" id="637537">!=</span>&nbsp;<span class="ident" id="637540">nil</span>&nbsp;<span class="op" id="637544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637548">t</span><span class="op" id="637549">.</span><span class="ident" id="637550">Fatalf</span><span class="op" id="637556">(</span><span class="string" id="637557">&#34;readdir&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="637580">,</span>&nbsp;<span class="ident" id="637582">dir</span><span class="op" id="637585">,</span>&nbsp;<span class="ident" id="637587">err2</span><span class="op" id="637591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637594">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637597">for</span>&nbsp;<span class="ident" id="637601">_</span><span class="op" id="637602">,</span>&nbsp;<span class="ident" id="637604">m</span>&nbsp;<span class="op" id="637606">:=</span>&nbsp;<span class="keyword" id="637609">range</span>&nbsp;<span class="ident" id="637615">contents</span>&nbsp;<span class="op" id="637624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637628">found</span>&nbsp;<span class="op" id="637634">:=</span>&nbsp;<span class="builtintype" id="637637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637645">for</span>&nbsp;<span class="ident" id="637649">_</span><span class="op" id="637650">,</span>&nbsp;<span class="ident" id="637652">n</span>&nbsp;<span class="op" id="637654">:=</span>&nbsp;<span class="keyword" id="637657">range</span>&nbsp;<span class="ident" id="637663">s</span>&nbsp;<span class="op" id="637665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637670">if</span>&nbsp;<span class="ident" id="637673">equal</span><span class="op" id="637678">(</span><span class="ident" id="637679">m</span><span class="op" id="637680">,</span>&nbsp;<span class="ident" id="637682">n</span><span class="op" id="637683">.</span><span class="ident" id="637684">Name</span><span class="op" id="637688">(</span><span class="op" id="637689">)</span><span class="op" id="637690">)</span>&nbsp;<span class="op" id="637692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637698">if</span>&nbsp;<span class="ident" id="637701">found</span>&nbsp;<span class="op" id="637707">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637714">t</span><span class="op" id="637715">.</span><span class="ident" id="637716">Error</span><span class="op" id="637721">(</span><span class="string" id="637722">&#34;present&nbsp;twice:&#34;</span><span class="op" id="637738">,</span>&nbsp;<span class="ident" id="637740">m</span><span class="op" id="637741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637753">found</span>&nbsp;<span class="op" id="637759">=</span>&nbsp;<span class="builtintype" id="637761">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637773">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="637777">if</span>&nbsp;<span class="op" id="637780">!</span><span class="ident" id="637781">found</span>&nbsp;<span class="op" id="637787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637792">t</span><span class="op" id="637793">.</span><span class="ident" id="637794">Error</span><span class="op" id="637799">(</span><span class="string" id="637800">&#34;could&nbsp;not&nbsp;find&#34;</span><span class="op" id="637816">,</span>&nbsp;<span class="ident" id="637818">m</span><span class="op" id="637819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="637826">}</span><br>
<span class="lineno"></span><span class="op" id="637828">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="637831">func</span>&nbsp;<span class="ident" id="637836">TestReaddirnames</span><span class="op" id="637852">(</span><span class="ident" id="637853">t</span>&nbsp;<span class="op" id="637855">*</span><span class="ident" id="637856">testing</span><span class="op" id="637863">.</span><span class="ident" id="637864">T</span><span class="op" id="637865">)</span>&nbsp;<span class="op" id="637867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637870">testReaddirnames</span><span class="op" id="637886">(</span><span class="string" id="637887">&#34;.&#34;</span><span class="op" id="637890">,</span>&nbsp;<span class="ident" id="637892">dot</span><span class="op" id="637895">,</span>&nbsp;<span class="ident" id="637897">t</span><span class="op" id="637898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637901">testReaddirnames</span><span class="op" id="637917">(</span><span class="ident" id="637918">sysdir</span><span class="op" id="637924">.</span><span class="ident" id="637925">name</span><span class="op" id="637929">,</span>&nbsp;<span class="ident" id="637931">sysdir</span><span class="op" id="637937">.</span><span class="ident" id="637938">files</span><span class="op" id="637943">,</span>&nbsp;<span class="ident" id="637945">t</span><span class="op" id="637946">)</span><br>
<span class="lineno"></span><span class="op" id="637948">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="637951">func</span>&nbsp;<span class="ident" id="637956">TestReaddir</span><span class="op" id="637967">(</span><span class="ident" id="637968">t</span>&nbsp;<span class="op" id="637970">*</span><span class="ident" id="637971">testing</span><span class="op" id="637978">.</span><span class="ident" id="637979">T</span><span class="op" id="637980">)</span>&nbsp;<span class="op" id="637982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="637985">testReaddir</span><span class="op" id="637996">(</span><span class="string" id="637997">&#34;.&#34;</span><span class="op" id="638000">,</span>&nbsp;<span class="ident" id="638002">dot</span><span class="op" id="638005">,</span>&nbsp;<span class="ident" id="638007">t</span><span class="op" id="638008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638011">testReaddir</span><span class="op" id="638022">(</span><span class="ident" id="638023">sysdir</span><span class="op" id="638029">.</span><span class="ident" id="638030">name</span><span class="op" id="638034">,</span>&nbsp;<span class="ident" id="638036">sysdir</span><span class="op" id="638042">.</span><span class="ident" id="638043">files</span><span class="op" id="638048">,</span>&nbsp;<span class="ident" id="638050">t</span><span class="op" id="638051">)</span><br>
<span class="lineno"></span><span class="op" id="638053">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="638056">//&nbsp;Read&nbsp;the&nbsp;directory&nbsp;one&nbsp;entry&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="638099">func</span>&nbsp;<span class="ident" id="638104">smallReaddirnames</span><span class="op" id="638121">(</span><span class="ident" id="638122">file</span>&nbsp;<span class="op" id="638127">*</span><span class="ident" id="638128">File</span><span class="op" id="638132">,</span>&nbsp;<span class="ident" id="638134">length</span>&nbsp;<span class="builtintype" id="638141">int</span><span class="op" id="638144">,</span>&nbsp;<span class="ident" id="638146">t</span>&nbsp;<span class="op" id="638148">*</span><span class="ident" id="638149">testing</span><span class="op" id="638156">.</span><span class="ident" id="638157">T</span><span class="op" id="638158">)</span>&nbsp;<span class="op" id="638160">[</span><span class="op" id="638161">]</span><span class="builtintype" id="638162">string</span>&nbsp;<span class="op" id="638169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638172">names</span>&nbsp;<span class="op" id="638178">:=</span>&nbsp;<span class="builtinfunc" id="638181">make</span><span class="op" id="638185">(</span><span class="op" id="638186">[</span><span class="op" id="638187">]</span><span class="builtintype" id="638188">string</span><span class="op" id="638194">,</span>&nbsp;<span class="ident" id="638196">length</span><span class="op" id="638202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638205">count</span>&nbsp;<span class="op" id="638211">:=</span>&nbsp;<span class="num" id="638214">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638217">for</span>&nbsp;<span class="op" id="638221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638225">d</span><span class="op" id="638226">,</span>&nbsp;<span class="ident" id="638228">err</span>&nbsp;<span class="op" id="638232">:=</span>&nbsp;<span class="ident" id="638235">file</span><span class="op" id="638239">.</span><span class="ident" id="638240">Readdirnames</span><span class="op" id="638252">(</span><span class="num" id="638253">1</span><span class="op" id="638254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638258">if</span>&nbsp;<span class="ident" id="638261">err</span>&nbsp;<span class="op" id="638265">==</span>&nbsp;<span class="ident" id="638268">io</span><span class="op" id="638270">.</span><span class="ident" id="638271">EOF</span>&nbsp;<span class="op" id="638275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638280">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="638288">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638292">if</span>&nbsp;<span class="ident" id="638295">err</span>&nbsp;<span class="op" id="638299">!=</span>&nbsp;<span class="ident" id="638302">nil</span>&nbsp;<span class="op" id="638306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638311">t</span><span class="op" id="638312">.</span><span class="ident" id="638313">Fatalf</span><span class="op" id="638319">(</span><span class="string" id="638320">&#34;readdirnames&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="638348">,</span>&nbsp;<span class="ident" id="638350">file</span><span class="op" id="638354">.</span><span class="ident" id="638355">Name</span><span class="op" id="638359">(</span><span class="op" id="638360">)</span><span class="op" id="638361">,</span>&nbsp;<span class="ident" id="638363">err</span><span class="op" id="638366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="638370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638374">if</span>&nbsp;<span class="builtinfunc" id="638377">len</span><span class="op" id="638380">(</span><span class="ident" id="638381">d</span><span class="op" id="638382">)</span>&nbsp;<span class="op" id="638384">==</span>&nbsp;<span class="num" id="638387">0</span>&nbsp;<span class="op" id="638389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638394">t</span><span class="op" id="638395">.</span><span class="ident" id="638396">Fatalf</span><span class="op" id="638402">(</span><span class="string" id="638403">&#34;readdirnames&nbsp;%q&nbsp;returned&nbsp;empty&nbsp;slice&nbsp;and&nbsp;no&nbsp;error&#34;</span><span class="op" id="638454">,</span>&nbsp;<span class="ident" id="638456">file</span><span class="op" id="638460">.</span><span class="ident" id="638461">Name</span><span class="op" id="638465">(</span><span class="op" id="638466">)</span><span class="op" id="638467">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="638471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638475">names</span><span class="op" id="638480">[</span><span class="ident" id="638481">count</span><span class="op" id="638486">]</span>&nbsp;<span class="op" id="638488">=</span>&nbsp;<span class="ident" id="638490">d</span><span class="op" id="638491">[</span><span class="num" id="638492">0</span><span class="op" id="638493">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638497">count</span><span class="op" id="638502">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="638506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638509">return</span>&nbsp;<span class="ident" id="638516">names</span><span class="op" id="638521">[</span><span class="num" id="638522">0</span><span class="op" id="638523">:</span><span class="ident" id="638524">count</span><span class="op" id="638529">]</span><br>
<span class="lineno">305</span><span class="op" id="638531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="638534">//&nbsp;Check&nbsp;that&nbsp;reading&nbsp;a&nbsp;directory&nbsp;one&nbsp;entry&nbsp;at&nbsp;a&nbsp;time&nbsp;gives&nbsp;the&nbsp;same&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="638610">//&nbsp;as&nbsp;reading&nbsp;it&nbsp;all&nbsp;at&nbsp;once.</span><br>
<span class="lineno"></span><span class="keyword" id="638640">func</span>&nbsp;<span class="ident" id="638645">TestReaddirnamesOneAtATime</span><span class="op" id="638671">(</span><span class="ident" id="638672">t</span>&nbsp;<span class="op" id="638674">*</span><span class="ident" id="638675">testing</span><span class="op" id="638682">.</span><span class="ident" id="638683">T</span><span class="op" id="638684">)</span>&nbsp;<span class="op" id="638686">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="638689">//&nbsp;big&nbsp;directory&nbsp;that&nbsp;doesn&#39;t&nbsp;change&nbsp;often.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638734">dir</span>&nbsp;<span class="op" id="638738">:=</span>&nbsp;<span class="string" id="638741">&#34;/usr/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638753">switch</span>&nbsp;<span class="ident" id="638760">runtime</span><span class="op" id="638767">.</span><span class="ident" id="638768">GOOS</span>&nbsp;<span class="op" id="638773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638776">case</span>&nbsp;<span class="string" id="638781">&#34;android&#34;</span><span class="op" id="638790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638794">dir</span>&nbsp;<span class="op" id="638798">=</span>&nbsp;<span class="string" id="638800">&#34;/system/bin&#34;</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638815">case</span>&nbsp;<span class="string" id="638820">&#34;plan9&#34;</span><span class="op" id="638827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638831">dir</span>&nbsp;<span class="op" id="638835">=</span>&nbsp;<span class="string" id="638837">&#34;/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638845">case</span>&nbsp;<span class="string" id="638850">&#34;windows&#34;</span><span class="op" id="638859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638863">dir</span>&nbsp;<span class="op" id="638867">=</span>&nbsp;<span class="ident" id="638869">Getenv</span><span class="op" id="638875">(</span><span class="string" id="638876">&#34;SystemRoot&#34;</span><span class="op" id="638888">)</span>&nbsp;<span class="op" id="638890">+</span>&nbsp;<span class="string" id="638892">&#34;\\system32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="638906">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638909">file</span><span class="op" id="638913">,</span>&nbsp;<span class="ident" id="638915">err</span>&nbsp;<span class="op" id="638919">:=</span>&nbsp;<span class="ident" id="638922">Open</span><span class="op" id="638926">(</span><span class="ident" id="638927">dir</span><span class="op" id="638930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638933">if</span>&nbsp;<span class="ident" id="638936">err</span>&nbsp;<span class="op" id="638940">!=</span>&nbsp;<span class="ident" id="638943">nil</span>&nbsp;<span class="op" id="638947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="638951">t</span><span class="op" id="638952">.</span><span class="ident" id="638953">Fatalf</span><span class="op" id="638959">(</span><span class="string" id="638960">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="638980">,</span>&nbsp;<span class="ident" id="638982">dir</span><span class="op" id="638985">,</span>&nbsp;<span class="ident" id="638987">err</span><span class="op" id="638990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="638993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="638996">defer</span>&nbsp;<span class="ident" id="639002">file</span><span class="op" id="639006">.</span><span class="ident" id="639007">Close</span><span class="op" id="639012">(</span><span class="op" id="639013">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639016">all</span><span class="op" id="639019">,</span>&nbsp;<span class="ident" id="639021">err1</span>&nbsp;<span class="op" id="639026">:=</span>&nbsp;<span class="ident" id="639029">file</span><span class="op" id="639033">.</span><span class="ident" id="639034">Readdirnames</span><span class="op" id="639046">(</span><span class="op" id="639047">-</span><span class="num" id="639048">1</span><span class="op" id="639049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639052">if</span>&nbsp;<span class="ident" id="639055">err1</span>&nbsp;<span class="op" id="639060">!=</span>&nbsp;<span class="ident" id="639063">nil</span>&nbsp;<span class="op" id="639067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639071">t</span><span class="op" id="639072">.</span><span class="ident" id="639073">Fatalf</span><span class="op" id="639079">(</span><span class="string" id="639080">&#34;readdirnames&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="639108">,</span>&nbsp;<span class="ident" id="639110">dir</span><span class="op" id="639113">,</span>&nbsp;<span class="ident" id="639115">err1</span><span class="op" id="639119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639125">file1</span><span class="op" id="639130">,</span>&nbsp;<span class="ident" id="639132">err2</span>&nbsp;<span class="op" id="639137">:=</span>&nbsp;<span class="ident" id="639140">Open</span><span class="op" id="639144">(</span><span class="ident" id="639145">dir</span><span class="op" id="639148">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639151">if</span>&nbsp;<span class="ident" id="639154">err2</span>&nbsp;<span class="op" id="639159">!=</span>&nbsp;<span class="ident" id="639162">nil</span>&nbsp;<span class="op" id="639166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639170">t</span><span class="op" id="639171">.</span><span class="ident" id="639172">Fatalf</span><span class="op" id="639178">(</span><span class="string" id="639179">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="639199">,</span>&nbsp;<span class="ident" id="639201">dir</span><span class="op" id="639204">,</span>&nbsp;<span class="ident" id="639206">err2</span><span class="op" id="639210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639216">defer</span>&nbsp;<span class="ident" id="639222">file1</span><span class="op" id="639227">.</span><span class="ident" id="639228">Close</span><span class="op" id="639233">(</span><span class="op" id="639234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639237">small</span>&nbsp;<span class="op" id="639243">:=</span>&nbsp;<span class="ident" id="639246">smallReaddirnames</span><span class="op" id="639263">(</span><span class="ident" id="639264">file1</span><span class="op" id="639269">,</span>&nbsp;<span class="builtinfunc" id="639271">len</span><span class="op" id="639274">(</span><span class="ident" id="639275">all</span><span class="op" id="639278">)</span><span class="op" id="639279">+</span><span class="num" id="639280">100</span><span class="op" id="639283">,</span>&nbsp;<span class="ident" id="639285">t</span><span class="op" id="639286">)</span>&nbsp;<span class="comment" id="639288">//&nbsp;+100&nbsp;in&nbsp;case&nbsp;we&nbsp;screw&nbsp;up</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639317">if</span>&nbsp;<span class="builtinfunc" id="639320">len</span><span class="op" id="639323">(</span><span class="ident" id="639324">small</span><span class="op" id="639329">)</span>&nbsp;<span class="op" id="639331">&lt;</span>&nbsp;<span class="builtinfunc" id="639333">len</span><span class="op" id="639336">(</span><span class="ident" id="639337">all</span><span class="op" id="639340">)</span>&nbsp;<span class="op" id="639342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639346">t</span><span class="op" id="639347">.</span><span class="ident" id="639348">Fatalf</span><span class="op" id="639354">(</span><span class="string" id="639355">&#34;len(small)&nbsp;is&nbsp;%d,&nbsp;less&nbsp;than&nbsp;%d&#34;</span><span class="op" id="639387">,</span>&nbsp;<span class="builtinfunc" id="639389">len</span><span class="op" id="639392">(</span><span class="ident" id="639393">small</span><span class="op" id="639398">)</span><span class="op" id="639399">,</span>&nbsp;<span class="builtinfunc" id="639401">len</span><span class="op" id="639404">(</span><span class="ident" id="639405">all</span><span class="op" id="639408">)</span><span class="op" id="639409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639415">for</span>&nbsp;<span class="ident" id="639419">i</span><span class="op" id="639420">,</span>&nbsp;<span class="ident" id="639422">n</span>&nbsp;<span class="op" id="639424">:=</span>&nbsp;<span class="keyword" id="639427">range</span>&nbsp;<span class="ident" id="639433">all</span>&nbsp;<span class="op" id="639437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639441">if</span>&nbsp;<span class="ident" id="639444">small</span><span class="op" id="639449">[</span><span class="ident" id="639450">i</span><span class="op" id="639451">]</span>&nbsp;<span class="op" id="639453">!=</span>&nbsp;<span class="ident" id="639456">n</span>&nbsp;<span class="op" id="639458">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639463">t</span><span class="op" id="639464">.</span><span class="ident" id="639465">Errorf</span><span class="op" id="639471">(</span><span class="string" id="639472">&#34;small&nbsp;read&nbsp;%q&nbsp;mismatch:&nbsp;%v&#34;</span><span class="op" id="639500">,</span>&nbsp;<span class="ident" id="639502">small</span><span class="op" id="639507">[</span><span class="ident" id="639508">i</span><span class="op" id="639509">]</span><span class="op" id="639510">,</span>&nbsp;<span class="ident" id="639512">n</span><span class="op" id="639513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639520">}</span><br>
<span class="lineno"></span><span class="op" id="639522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="639525">func</span>&nbsp;<span class="ident" id="639530">TestReaddirNValues</span><span class="op" id="639548">(</span><span class="ident" id="639549">t</span>&nbsp;<span class="op" id="639551">*</span><span class="ident" id="639552">testing</span><span class="op" id="639559">.</span><span class="ident" id="639560">T</span><span class="op" id="639561">)</span>&nbsp;<span class="op" id="639563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639566">if</span>&nbsp;<span class="ident" id="639569">testing</span><span class="op" id="639576">.</span><span class="ident" id="639577">Short</span><span class="op" id="639582">(</span><span class="op" id="639583">)</span>&nbsp;<span class="op" id="639585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639589">t</span><span class="op" id="639590">.</span><span class="ident" id="639591">Skip</span><span class="op" id="639595">(</span><span class="string" id="639596">&#34;test.short;&nbsp;skipping&#34;</span><span class="op" id="639618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639624">dir</span><span class="op" id="639627">,</span>&nbsp;<span class="ident" id="639629">err</span>&nbsp;<span class="op" id="639633">:=</span>&nbsp;<span class="ident" id="639636">ioutil</span><span class="op" id="639642">.</span><span class="ident" id="639643">TempDir</span><span class="op" id="639650">(</span><span class="string" id="639651">&#34;&#34;</span><span class="op" id="639653">,</span>&nbsp;<span class="string" id="639655">&#34;&#34;</span><span class="op" id="639657">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639660">if</span>&nbsp;<span class="ident" id="639663">err</span>&nbsp;<span class="op" id="639667">!=</span>&nbsp;<span class="ident" id="639670">nil</span>&nbsp;<span class="op" id="639674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639678">t</span><span class="op" id="639679">.</span><span class="ident" id="639680">Fatalf</span><span class="op" id="639686">(</span><span class="string" id="639687">&#34;TempDir:&nbsp;%v&#34;</span><span class="op" id="639700">,</span>&nbsp;<span class="ident" id="639702">err</span><span class="op" id="639705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639711">defer</span>&nbsp;<span class="ident" id="639717">RemoveAll</span><span class="op" id="639726">(</span><span class="ident" id="639727">dir</span><span class="op" id="639730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639733">for</span>&nbsp;<span class="ident" id="639737">i</span>&nbsp;<span class="op" id="639739">:=</span>&nbsp;<span class="num" id="639742">1</span><span class="op" id="639743">;</span>&nbsp;<span class="ident" id="639745">i</span>&nbsp;<span class="op" id="639747">&lt;=</span>&nbsp;<span class="num" id="639750">105</span><span class="op" id="639753">;</span>&nbsp;<span class="ident" id="639755">i</span><span class="op" id="639756">++</span>&nbsp;<span class="op" id="639759">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639763">f</span><span class="op" id="639764">,</span>&nbsp;<span class="ident" id="639766">err</span>&nbsp;<span class="op" id="639770">:=</span>&nbsp;<span class="ident" id="639773">Create</span><span class="op" id="639779">(</span><span class="ident" id="639780">filepath</span><span class="op" id="639788">.</span><span class="ident" id="639789">Join</span><span class="op" id="639793">(</span><span class="ident" id="639794">dir</span><span class="op" id="639797">,</span>&nbsp;<span class="ident" id="639799">fmt</span><span class="op" id="639802">.</span><span class="ident" id="639803">Sprintf</span><span class="op" id="639810">(</span><span class="string" id="639811">&#34;%d&#34;</span><span class="op" id="639815">,</span>&nbsp;<span class="ident" id="639817">i</span><span class="op" id="639818">)</span><span class="op" id="639819">)</span><span class="op" id="639820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639824">if</span>&nbsp;<span class="ident" id="639827">err</span>&nbsp;<span class="op" id="639831">!=</span>&nbsp;<span class="ident" id="639834">nil</span>&nbsp;<span class="op" id="639838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639843">t</span><span class="op" id="639844">.</span><span class="ident" id="639845">Fatalf</span><span class="op" id="639851">(</span><span class="string" id="639852">&#34;Create:&nbsp;%v&#34;</span><span class="op" id="639864">,</span>&nbsp;<span class="ident" id="639866">err</span><span class="op" id="639869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639877">f</span><span class="op" id="639878">.</span><span class="ident" id="639879">Write</span><span class="op" id="639884">(</span><span class="op" id="639885">[</span><span class="op" id="639886">]</span><span class="builtintype" id="639887">byte</span><span class="op" id="639891">(</span><span class="ident" id="639892">strings</span><span class="op" id="639899">.</span><span class="ident" id="639900">Repeat</span><span class="op" id="639906">(</span><span class="string" id="639907">&#34;X&#34;</span><span class="op" id="639910">,</span>&nbsp;<span class="ident" id="639912">i</span><span class="op" id="639913">)</span><span class="op" id="639914">)</span><span class="op" id="639915">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639919">f</span><span class="op" id="639920">.</span><span class="ident" id="639921">Close</span><span class="op" id="639926">(</span><span class="op" id="639927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="639930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639934">var</span>&nbsp;<span class="ident" id="639938">d</span>&nbsp;<span class="op" id="639940">*</span><span class="ident" id="639941">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639947">openDir</span>&nbsp;<span class="op" id="639955">:=</span>&nbsp;<span class="keyword" id="639958">func</span><span class="op" id="639962">(</span><span class="op" id="639963">)</span>&nbsp;<span class="op" id="639965">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="639969">var</span>&nbsp;<span class="ident" id="639973">err</span>&nbsp;<span class="builtintype" id="639977">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="639985">d</span><span class="op" id="639986">,</span>&nbsp;<span class="ident" id="639988">err</span>&nbsp;<span class="op" id="639992">=</span>&nbsp;<span class="ident" id="639994">Open</span><span class="op" id="639998">(</span><span class="ident" id="639999">dir</span><span class="op" id="640002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="640006">if</span>&nbsp;<span class="ident" id="640009">err</span>&nbsp;<span class="op" id="640013">!=</span>&nbsp;<span class="ident" id="640016">nil</span>&nbsp;<span class="op" id="640020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640025">t</span><span class="op" id="640026">.</span><span class="ident" id="640027">Fatalf</span><span class="op" id="640033">(</span><span class="string" id="640034">&#34;Open&nbsp;directory:&nbsp;%v&#34;</span><span class="op" id="640054">,</span>&nbsp;<span class="ident" id="640056">err</span><span class="op" id="640059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640063">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640070">readDirExpect</span>&nbsp;<span class="op" id="640084">:=</span>&nbsp;<span class="keyword" id="640087">func</span><span class="op" id="640091">(</span><span class="ident" id="640092">n</span><span class="op" id="640093">,</span>&nbsp;<span class="ident" id="640095">want</span>&nbsp;<span class="builtintype" id="640100">int</span><span class="op" id="640103">,</span>&nbsp;<span class="ident" id="640105">wantErr</span>&nbsp;<span class="builtintype" id="640113">error</span><span class="op" id="640118">)</span>&nbsp;<span class="op" id="640120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640124">fi</span><span class="op" id="640126">,</span>&nbsp;<span class="ident" id="640128">err</span>&nbsp;<span class="op" id="640132">:=</span>&nbsp;<span class="ident" id="640135">d</span><span class="op" id="640136">.</span><span class="ident" id="640137">Readdir</span><span class="op" id="640144">(</span><span class="ident" id="640145">n</span><span class="op" id="640146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="640150">if</span>&nbsp;<span class="ident" id="640153">err</span>&nbsp;<span class="op" id="640157">!=</span>&nbsp;<span class="ident" id="640160">wantErr</span>&nbsp;<span class="op" id="640168">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640173">t</span><span class="op" id="640174">.</span><span class="ident" id="640175">Fatalf</span><span class="op" id="640181">(</span><span class="string" id="640182">&#34;Readdir&nbsp;of&nbsp;%d&nbsp;got&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="640219">,</span>&nbsp;<span class="ident" id="640221">n</span><span class="op" id="640222">,</span>&nbsp;<span class="ident" id="640224">err</span><span class="op" id="640227">,</span>&nbsp;<span class="ident" id="640229">wantErr</span><span class="op" id="640236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="640244">if</span>&nbsp;<span class="ident" id="640247">g</span><span class="op" id="640248">,</span>&nbsp;<span class="ident" id="640250">e</span>&nbsp;<span class="op" id="640252">:=</span>&nbsp;<span class="builtinfunc" id="640255">len</span><span class="op" id="640258">(</span><span class="ident" id="640259">fi</span><span class="op" id="640261">)</span><span class="op" id="640262">,</span>&nbsp;<span class="ident" id="640264">want</span><span class="op" id="640268">;</span>&nbsp;<span class="ident" id="640270">g</span>&nbsp;<span class="op" id="640272">!=</span>&nbsp;<span class="ident" id="640275">e</span>&nbsp;<span class="op" id="640277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640282">t</span><span class="op" id="640283">.</span><span class="ident" id="640284">Errorf</span><span class="op" id="640290">(</span><span class="string" id="640291">&#34;Readdir&nbsp;of&nbsp;%d&nbsp;got&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="640328">,</span>&nbsp;<span class="ident" id="640330">n</span><span class="op" id="640331">,</span>&nbsp;<span class="ident" id="640333">g</span><span class="op" id="640334">,</span>&nbsp;<span class="ident" id="640336">e</span><span class="op" id="640337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640341">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640348">readDirNamesExpect</span>&nbsp;<span class="op" id="640367">:=</span>&nbsp;<span class="keyword" id="640370">func</span><span class="op" id="640374">(</span><span class="ident" id="640375">n</span><span class="op" id="640376">,</span>&nbsp;<span class="ident" id="640378">want</span>&nbsp;<span class="builtintype" id="640383">int</span><span class="op" id="640386">,</span>&nbsp;<span class="ident" id="640388">wantErr</span>&nbsp;<span class="builtintype" id="640396">error</span><span class="op" id="640401">)</span>&nbsp;<span class="op" id="640403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640407">fi</span><span class="op" id="640409">,</span>&nbsp;<span class="ident" id="640411">err</span>&nbsp;<span class="op" id="640415">:=</span>&nbsp;<span class="ident" id="640418">d</span><span class="op" id="640419">.</span><span class="ident" id="640420">Readdirnames</span><span class="op" id="640432">(</span><span class="ident" id="640433">n</span><span class="op" id="640434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="640438">if</span>&nbsp;<span class="ident" id="640441">err</span>&nbsp;<span class="op" id="640445">!=</span>&nbsp;<span class="ident" id="640448">wantErr</span>&nbsp;<span class="op" id="640456">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640461">t</span><span class="op" id="640462">.</span><span class="ident" id="640463">Fatalf</span><span class="op" id="640469">(</span><span class="string" id="640470">&#34;Readdirnames&nbsp;of&nbsp;%d&nbsp;got&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="640512">,</span>&nbsp;<span class="ident" id="640514">n</span><span class="op" id="640515">,</span>&nbsp;<span class="ident" id="640517">err</span><span class="op" id="640520">,</span>&nbsp;<span class="ident" id="640522">wantErr</span><span class="op" id="640529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="640537">if</span>&nbsp;<span class="ident" id="640540">g</span><span class="op" id="640541">,</span>&nbsp;<span class="ident" id="640543">e</span>&nbsp;<span class="op" id="640545">:=</span>&nbsp;<span class="builtinfunc" id="640548">len</span><span class="op" id="640551">(</span><span class="ident" id="640552">fi</span><span class="op" id="640554">)</span><span class="op" id="640555">,</span>&nbsp;<span class="ident" id="640557">want</span><span class="op" id="640561">;</span>&nbsp;<span class="ident" id="640563">g</span>&nbsp;<span class="op" id="640565">!=</span>&nbsp;<span class="ident" id="640568">e</span>&nbsp;<span class="op" id="640570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640575">t</span><span class="op" id="640576">.</span><span class="ident" id="640577">Errorf</span><span class="op" id="640583">(</span><span class="string" id="640584">&#34;Readdirnames&nbsp;of&nbsp;%d&nbsp;got&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="640626">,</span>&nbsp;<span class="ident" id="640628">n</span><span class="op" id="640629">,</span>&nbsp;<span class="ident" id="640631">g</span><span class="op" id="640632">,</span>&nbsp;<span class="ident" id="640634">e</span><span class="op" id="640635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640639">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="640642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="640646">for</span>&nbsp;<span class="ident" id="640650">_</span><span class="op" id="640651">,</span>&nbsp;<span class="ident" id="640653">fn</span>&nbsp;<span class="op" id="640656">:=</span>&nbsp;<span class="keyword" id="640659">range</span>&nbsp;<span class="op" id="640665">[</span><span class="op" id="640666">]</span><span class="keyword" id="640667">func</span><span class="op" id="640671">(</span><span class="builtintype" id="640672">int</span><span class="op" id="640675">,</span>&nbsp;<span class="builtintype" id="640677">int</span><span class="op" id="640680">,</span>&nbsp;<span class="builtintype" id="640682">error</span><span class="op" id="640687">)</span><span class="op" id="640688">{</span><span class="ident" id="640689">readDirExpect</span><span class="op" id="640702">,</span>&nbsp;<span class="ident" id="640704">readDirNamesExpect</span><span class="op" id="640722">}</span>&nbsp;<span class="op" id="640724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="640728">//&nbsp;Test&nbsp;the&nbsp;slurp&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640753">openDir</span><span class="op" id="640760">(</span><span class="op" id="640761">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640765">fn</span><span class="op" id="640767">(</span><span class="num" id="640768">0</span><span class="op" id="640769">,</span>&nbsp;<span class="num" id="640771">105</span><span class="op" id="640774">,</span>&nbsp;<span class="ident" id="640776">nil</span><span class="op" id="640779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640783">fn</span><span class="op" id="640785">(</span><span class="num" id="640786">0</span><span class="op" id="640787">,</span>&nbsp;<span class="num" id="640789">0</span><span class="op" id="640790">,</span>&nbsp;<span class="ident" id="640792">nil</span><span class="op" id="640795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640799">d</span><span class="op" id="640800">.</span><span class="ident" id="640801">Close</span><span class="op" id="640806">(</span><span class="op" id="640807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="640812">//&nbsp;Slurp&nbsp;with&nbsp;-1&nbsp;instead</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640839">openDir</span><span class="op" id="640846">(</span><span class="op" id="640847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640851">fn</span><span class="op" id="640853">(</span><span class="op" id="640854">-</span><span class="num" id="640855">1</span><span class="op" id="640856">,</span>&nbsp;<span class="num" id="640858">105</span><span class="op" id="640861">,</span>&nbsp;<span class="ident" id="640863">nil</span><span class="op" id="640866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640870">fn</span><span class="op" id="640872">(</span><span class="op" id="640873">-</span><span class="num" id="640874">2</span><span class="op" id="640875">,</span>&nbsp;<span class="num" id="640877">0</span><span class="op" id="640878">,</span>&nbsp;<span class="ident" id="640880">nil</span><span class="op" id="640883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640887">fn</span><span class="op" id="640889">(</span><span class="num" id="640890">0</span><span class="op" id="640891">,</span>&nbsp;<span class="num" id="640893">0</span><span class="op" id="640894">,</span>&nbsp;<span class="ident" id="640896">nil</span><span class="op" id="640899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640903">d</span><span class="op" id="640904">.</span><span class="ident" id="640905">Close</span><span class="op" id="640910">(</span><span class="op" id="640911">)</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="640916">//&nbsp;Test&nbsp;the&nbsp;bounded&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640943">openDir</span><span class="op" id="640950">(</span><span class="op" id="640951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640955">fn</span><span class="op" id="640957">(</span><span class="num" id="640958">1</span><span class="op" id="640959">,</span>&nbsp;<span class="num" id="640961">1</span><span class="op" id="640962">,</span>&nbsp;<span class="ident" id="640964">nil</span><span class="op" id="640967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640971">fn</span><span class="op" id="640973">(</span><span class="num" id="640974">2</span><span class="op" id="640975">,</span>&nbsp;<span class="num" id="640977">2</span><span class="op" id="640978">,</span>&nbsp;<span class="ident" id="640980">nil</span><span class="op" id="640983">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="640987">fn</span><span class="op" id="640989">(</span><span class="num" id="640990">105</span><span class="op" id="640993">,</span>&nbsp;<span class="num" id="640995">102</span><span class="op" id="640998">,</span>&nbsp;<span class="ident" id="641000">nil</span><span class="op" id="641003">)</span>&nbsp;<span class="comment" id="641005">//&nbsp;and&nbsp;tests&nbsp;buffer&nbsp;&gt;100&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641037">fn</span><span class="op" id="641039">(</span><span class="num" id="641040">3</span><span class="op" id="641041">,</span>&nbsp;<span class="num" id="641043">0</span><span class="op" id="641044">,</span>&nbsp;<span class="ident" id="641046">io</span><span class="op" id="641048">.</span><span class="ident" id="641049">EOF</span><span class="op" id="641052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641056">d</span><span class="op" id="641057">.</span><span class="ident" id="641058">Close</span><span class="op" id="641063">(</span><span class="op" id="641064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641067">}</span><br>
<span class="lineno"></span><span class="op" id="641069">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="641072">func</span>&nbsp;<span class="ident" id="641077">touch</span><span class="op" id="641082">(</span><span class="ident" id="641083">t</span>&nbsp;<span class="op" id="641085">*</span><span class="ident" id="641086">testing</span><span class="op" id="641093">.</span><span class="ident" id="641094">T</span><span class="op" id="641095">,</span>&nbsp;<span class="ident" id="641097">name</span>&nbsp;<span class="builtintype" id="641102">string</span><span class="op" id="641108">)</span>&nbsp;<span class="op" id="641110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641113">f</span><span class="op" id="641114">,</span>&nbsp;<span class="ident" id="641116">err</span>&nbsp;<span class="op" id="641120">:=</span>&nbsp;<span class="ident" id="641123">Create</span><span class="op" id="641129">(</span><span class="ident" id="641130">name</span><span class="op" id="641134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641137">if</span>&nbsp;<span class="ident" id="641140">err</span>&nbsp;<span class="op" id="641144">!=</span>&nbsp;<span class="ident" id="641147">nil</span>&nbsp;<span class="op" id="641151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641155">t</span><span class="op" id="641156">.</span><span class="ident" id="641157">Fatal</span><span class="op" id="641162">(</span><span class="ident" id="641163">err</span><span class="op" id="641166">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641172">if</span>&nbsp;<span class="ident" id="641175">err</span>&nbsp;<span class="op" id="641179">:=</span>&nbsp;<span class="ident" id="641182">f</span><span class="op" id="641183">.</span><span class="ident" id="641184">Close</span><span class="op" id="641189">(</span><span class="op" id="641190">)</span><span class="op" id="641191">;</span>&nbsp;<span class="ident" id="641193">err</span>&nbsp;<span class="op" id="641197">!=</span>&nbsp;<span class="ident" id="641200">nil</span>&nbsp;<span class="op" id="641204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641208">t</span><span class="op" id="641209">.</span><span class="ident" id="641210">Fatal</span><span class="op" id="641215">(</span><span class="ident" id="641216">err</span><span class="op" id="641219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641222">}</span><br>
<span class="lineno"></span><span class="op" id="641224">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="641227">func</span>&nbsp;<span class="ident" id="641232">TestReaddirStatFailures</span><span class="op" id="641255">(</span><span class="ident" id="641256">t</span>&nbsp;<span class="op" id="641258">*</span><span class="ident" id="641259">testing</span><span class="op" id="641266">.</span><span class="ident" id="641267">T</span><span class="op" id="641268">)</span>&nbsp;<span class="op" id="641270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641273">switch</span>&nbsp;<span class="ident" id="641280">runtime</span><span class="op" id="641287">.</span><span class="ident" id="641288">GOOS</span>&nbsp;<span class="op" id="641293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641296">case</span>&nbsp;<span class="string" id="641301">&#34;windows&#34;</span><span class="op" id="641310">,</span>&nbsp;<span class="string" id="641312">&#34;plan9&#34;</span><span class="op" id="641319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="641323">//&nbsp;Windows&nbsp;and&nbsp;Plan&nbsp;9&nbsp;already&nbsp;do&nbsp;this&nbsp;correctly,</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="641374">//&nbsp;but&nbsp;are&nbsp;structured&nbsp;with&nbsp;different&nbsp;syscalls&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="641427">//&nbsp;that&nbsp;they&nbsp;don&#39;t&nbsp;use&nbsp;Lstat,&nbsp;so&nbsp;the&nbsp;hook&nbsp;below&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="641481">//&nbsp;testing&nbsp;it&nbsp;wouldn&#39;t&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641512">t</span><span class="op" id="641513">.</span><span class="ident" id="641514">Skipf</span><span class="op" id="641519">(</span><span class="string" id="641520">&#34;skipping&nbsp;test&nbsp;on&nbsp;%v&#34;</span><span class="op" id="641541">,</span>&nbsp;<span class="ident" id="641543">runtime</span><span class="op" id="641550">.</span><span class="ident" id="641551">GOOS</span><span class="op" id="641555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641558">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641561">dir</span><span class="op" id="641564">,</span>&nbsp;<span class="ident" id="641566">err</span>&nbsp;<span class="op" id="641570">:=</span>&nbsp;<span class="ident" id="641573">ioutil</span><span class="op" id="641579">.</span><span class="ident" id="641580">TempDir</span><span class="op" id="641587">(</span><span class="string" id="641588">&#34;&#34;</span><span class="op" id="641590">,</span>&nbsp;<span class="string" id="641592">&#34;&#34;</span><span class="op" id="641594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641597">if</span>&nbsp;<span class="ident" id="641600">err</span>&nbsp;<span class="op" id="641604">!=</span>&nbsp;<span class="ident" id="641607">nil</span>&nbsp;<span class="op" id="641611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641615">t</span><span class="op" id="641616">.</span><span class="ident" id="641617">Fatalf</span><span class="op" id="641623">(</span><span class="string" id="641624">&#34;TempDir:&nbsp;%v&#34;</span><span class="op" id="641637">,</span>&nbsp;<span class="ident" id="641639">err</span><span class="op" id="641642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641648">defer</span>&nbsp;<span class="ident" id="641654">RemoveAll</span><span class="op" id="641663">(</span><span class="ident" id="641664">dir</span><span class="op" id="641667">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641670">touch</span><span class="op" id="641675">(</span><span class="ident" id="641676">t</span><span class="op" id="641677">,</span>&nbsp;<span class="ident" id="641679">filepath</span><span class="op" id="641687">.</span><span class="ident" id="641688">Join</span><span class="op" id="641692">(</span><span class="ident" id="641693">dir</span><span class="op" id="641696">,</span>&nbsp;<span class="string" id="641698">&#34;good1&#34;</span><span class="op" id="641705">)</span><span class="op" id="641706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641709">touch</span><span class="op" id="641714">(</span><span class="ident" id="641715">t</span><span class="op" id="641716">,</span>&nbsp;<span class="ident" id="641718">filepath</span><span class="op" id="641726">.</span><span class="ident" id="641727">Join</span><span class="op" id="641731">(</span><span class="ident" id="641732">dir</span><span class="op" id="641735">,</span>&nbsp;<span class="string" id="641737">&#34;x&#34;</span><span class="op" id="641740">)</span><span class="op" id="641741">)</span>&nbsp;<span class="comment" id="641743">//&nbsp;will&nbsp;disappear&nbsp;or&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="641779">touch</span><span class="op" id="641784">(</span><span class="ident" id="641785">t</span><span class="op" id="641786">,</span>&nbsp;<span class="ident" id="641788">filepath</span><span class="op" id="641796">.</span><span class="ident" id="641797">Join</span><span class="op" id="641801">(</span><span class="ident" id="641802">dir</span><span class="op" id="641805">,</span>&nbsp;<span class="string" id="641807">&#34;good2&#34;</span><span class="op" id="641814">)</span><span class="op" id="641815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641818">defer</span>&nbsp;<span class="keyword" id="641824">func</span><span class="op" id="641828">(</span><span class="op" id="641829">)</span>&nbsp;<span class="op" id="641831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641835">*</span><span class="ident" id="641836">LstatP</span>&nbsp;<span class="op" id="641843">=</span>&nbsp;<span class="ident" id="641845">Lstat</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641852">}</span><span class="op" id="641853">(</span><span class="op" id="641854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641857">var</span>&nbsp;<span class="ident" id="641861">xerr</span>&nbsp;<span class="builtintype" id="641866">error</span>&nbsp;<span class="comment" id="641872">//&nbsp;error&nbsp;to&nbsp;return&nbsp;for&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="641898">*</span><span class="ident" id="641899">LstatP</span>&nbsp;<span class="op" id="641906">=</span>&nbsp;<span class="keyword" id="641908">func</span><span class="op" id="641912">(</span><span class="ident" id="641913">path</span>&nbsp;<span class="builtintype" id="641918">string</span><span class="op" id="641924">)</span>&nbsp;<span class="op" id="641926">(</span><span class="ident" id="641927">FileInfo</span><span class="op" id="641935">,</span>&nbsp;<span class="builtintype" id="641937">error</span><span class="op" id="641942">)</span>&nbsp;<span class="op" id="641944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="641948">if</span>&nbsp;<span class="ident" id="641951">xerr</span>&nbsp;<span class="op" id="641956">!=</span>&nbsp;<span class="ident" id="641959">nil</span>&nbsp;<span class="op" id="641963">&amp;&amp;</span>&nbsp;<span class="ident" id="641966">strings</span><span class="op" id="641973">.</span><span class="ident" id="641974">HasSuffix</span><span class="op" id="641983">(</span><span class="ident" id="641984">path</span><span class="op" id="641988">,</span>&nbsp;<span class="string" id="641990">&#34;x&#34;</span><span class="op" id="641993">)</span>&nbsp;<span class="op" id="641995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642000">return</span>&nbsp;<span class="ident" id="642007">nil</span><span class="op" id="642010">,</span>&nbsp;<span class="ident" id="642012">xerr</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642023">return</span>&nbsp;<span class="ident" id="642030">Lstat</span><span class="op" id="642035">(</span><span class="ident" id="642036">path</span><span class="op" id="642040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642046">readDir</span>&nbsp;<span class="op" id="642054">:=</span>&nbsp;<span class="keyword" id="642057">func</span><span class="op" id="642061">(</span><span class="op" id="642062">)</span>&nbsp;<span class="op" id="642064">(</span><span class="op" id="642065">[</span><span class="op" id="642066">]</span><span class="ident" id="642067">FileInfo</span><span class="op" id="642075">,</span>&nbsp;<span class="builtintype" id="642077">error</span><span class="op" id="642082">)</span>&nbsp;<span class="op" id="642084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642088">d</span><span class="op" id="642089">,</span>&nbsp;<span class="ident" id="642091">err</span>&nbsp;<span class="op" id="642095">:=</span>&nbsp;<span class="ident" id="642098">Open</span><span class="op" id="642102">(</span><span class="ident" id="642103">dir</span><span class="op" id="642106">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642110">if</span>&nbsp;<span class="ident" id="642113">err</span>&nbsp;<span class="op" id="642117">!=</span>&nbsp;<span class="ident" id="642120">nil</span>&nbsp;<span class="op" id="642124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642129">t</span><span class="op" id="642130">.</span><span class="ident" id="642131">Fatal</span><span class="op" id="642136">(</span><span class="ident" id="642137">err</span><span class="op" id="642140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642148">defer</span>&nbsp;<span class="ident" id="642154">d</span><span class="op" id="642155">.</span><span class="ident" id="642156">Close</span><span class="op" id="642161">(</span><span class="op" id="642162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642166">return</span>&nbsp;<span class="ident" id="642173">d</span><span class="op" id="642174">.</span><span class="ident" id="642175">Readdir</span><span class="op" id="642182">(</span><span class="op" id="642183">-</span><span class="num" id="642184">1</span><span class="op" id="642185">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642191">mustReadDir</span>&nbsp;<span class="op" id="642203">:=</span>&nbsp;<span class="keyword" id="642206">func</span><span class="op" id="642210">(</span><span class="ident" id="642211">testName</span>&nbsp;<span class="builtintype" id="642220">string</span><span class="op" id="642226">)</span>&nbsp;<span class="op" id="642228">[</span><span class="op" id="642229">]</span><span class="ident" id="642230">FileInfo</span>&nbsp;<span class="op" id="642239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642243">fis</span><span class="op" id="642246">,</span>&nbsp;<span class="ident" id="642248">err</span>&nbsp;<span class="op" id="642252">:=</span>&nbsp;<span class="ident" id="642255">readDir</span><span class="op" id="642262">(</span><span class="op" id="642263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642267">if</span>&nbsp;<span class="ident" id="642270">err</span>&nbsp;<span class="op" id="642274">!=</span>&nbsp;<span class="ident" id="642277">nil</span>&nbsp;<span class="op" id="642281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642286">t</span><span class="op" id="642287">.</span><span class="ident" id="642288">Fatalf</span><span class="op" id="642294">(</span><span class="string" id="642295">&#34;%s:&nbsp;Readdir:&nbsp;%v&#34;</span><span class="op" id="642312">,</span>&nbsp;<span class="ident" id="642314">testName</span><span class="op" id="642322">,</span>&nbsp;<span class="ident" id="642324">err</span><span class="op" id="642327">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642335">return</span>&nbsp;<span class="ident" id="642342">fis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642350">names</span>&nbsp;<span class="op" id="642356">:=</span>&nbsp;<span class="keyword" id="642359">func</span><span class="op" id="642363">(</span><span class="ident" id="642364">fis</span>&nbsp;<span class="op" id="642368">[</span><span class="op" id="642369">]</span><span class="ident" id="642370">FileInfo</span><span class="op" id="642378">)</span>&nbsp;<span class="op" id="642380">[</span><span class="op" id="642381">]</span><span class="builtintype" id="642382">string</span>&nbsp;<span class="op" id="642389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642393">s</span>&nbsp;<span class="op" id="642395">:=</span>&nbsp;<span class="builtinfunc" id="642398">make</span><span class="op" id="642402">(</span><span class="op" id="642403">[</span><span class="op" id="642404">]</span><span class="builtintype" id="642405">string</span><span class="op" id="642411">,</span>&nbsp;<span class="builtinfunc" id="642413">len</span><span class="op" id="642416">(</span><span class="ident" id="642417">fis</span><span class="op" id="642420">)</span><span class="op" id="642421">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642425">for</span>&nbsp;<span class="ident" id="642429">i</span><span class="op" id="642430">,</span>&nbsp;<span class="ident" id="642432">fi</span>&nbsp;<span class="op" id="642435">:=</span>&nbsp;<span class="keyword" id="642438">range</span>&nbsp;<span class="ident" id="642444">fis</span>&nbsp;<span class="op" id="642448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642453">s</span><span class="op" id="642454">[</span><span class="ident" id="642455">i</span><span class="op" id="642456">]</span>&nbsp;<span class="op" id="642458">=</span>&nbsp;<span class="ident" id="642460">fi</span><span class="op" id="642462">.</span><span class="ident" id="642463">Name</span><span class="op" id="642467">(</span><span class="op" id="642468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642476">sort</span><span class="op" id="642480">.</span><span class="ident" id="642481">Strings</span><span class="op" id="642488">(</span><span class="ident" id="642489">s</span><span class="op" id="642490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642494">return</span>&nbsp;<span class="ident" id="642501">s</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642508">if</span>&nbsp;<span class="ident" id="642511">got</span><span class="op" id="642514">,</span>&nbsp;<span class="ident" id="642516">want</span>&nbsp;<span class="op" id="642521">:=</span>&nbsp;<span class="ident" id="642524">names</span><span class="op" id="642529">(</span><span class="ident" id="642530">mustReadDir</span><span class="op" id="642541">(</span><span class="string" id="642542">&#34;inital&nbsp;readdir&#34;</span><span class="op" id="642558">)</span><span class="op" id="642559">)</span><span class="op" id="642560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642564">[</span><span class="op" id="642565">]</span><span class="builtintype" id="642566">string</span><span class="op" id="642572">{</span><span class="string" id="642573">&#34;good1&#34;</span><span class="op" id="642580">,</span>&nbsp;<span class="string" id="642582">&#34;good2&#34;</span><span class="op" id="642589">,</span>&nbsp;<span class="string" id="642591">&#34;x&#34;</span><span class="op" id="642594">}</span><span class="op" id="642595">;</span>&nbsp;<span class="op" id="642597">!</span><span class="ident" id="642598">reflect</span><span class="op" id="642605">.</span><span class="ident" id="642606">DeepEqual</span><span class="op" id="642615">(</span><span class="ident" id="642616">got</span><span class="op" id="642619">,</span>&nbsp;<span class="ident" id="642621">want</span><span class="op" id="642625">)</span>&nbsp;<span class="op" id="642627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642631">t</span><span class="op" id="642632">.</span><span class="ident" id="642633">Errorf</span><span class="op" id="642639">(</span><span class="string" id="642640">&#34;initial&nbsp;readdir&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="642673">,</span>&nbsp;<span class="ident" id="642675">got</span><span class="op" id="642678">,</span>&nbsp;<span class="ident" id="642680">want</span><span class="op" id="642684">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642691">xerr</span>&nbsp;<span class="op" id="642696">=</span>&nbsp;<span class="ident" id="642698">ErrNotExist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642711">if</span>&nbsp;<span class="ident" id="642714">got</span><span class="op" id="642717">,</span>&nbsp;<span class="ident" id="642719">want</span>&nbsp;<span class="op" id="642724">:=</span>&nbsp;<span class="ident" id="642727">names</span><span class="op" id="642732">(</span><span class="ident" id="642733">mustReadDir</span><span class="op" id="642744">(</span><span class="string" id="642745">&#34;with&nbsp;x&nbsp;disappearing&#34;</span><span class="op" id="642766">)</span><span class="op" id="642767">)</span><span class="op" id="642768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642772">[</span><span class="op" id="642773">]</span><span class="builtintype" id="642774">string</span><span class="op" id="642780">{</span><span class="string" id="642781">&#34;good1&#34;</span><span class="op" id="642788">,</span>&nbsp;<span class="string" id="642790">&#34;good2&#34;</span><span class="op" id="642797">}</span><span class="op" id="642798">;</span>&nbsp;<span class="op" id="642800">!</span><span class="ident" id="642801">reflect</span><span class="op" id="642808">.</span><span class="ident" id="642809">DeepEqual</span><span class="op" id="642818">(</span><span class="ident" id="642819">got</span><span class="op" id="642822">,</span>&nbsp;<span class="ident" id="642824">want</span><span class="op" id="642828">)</span>&nbsp;<span class="op" id="642830">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642834">t</span><span class="op" id="642835">.</span><span class="ident" id="642836">Errorf</span><span class="op" id="642842">(</span><span class="string" id="642843">&#34;with&nbsp;x&nbsp;disappearing,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="642881">,</span>&nbsp;<span class="ident" id="642883">got</span><span class="op" id="642886">,</span>&nbsp;<span class="ident" id="642888">want</span><span class="op" id="642892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="642895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642899">xerr</span>&nbsp;<span class="op" id="642904">=</span>&nbsp;<span class="ident" id="642906">errors</span><span class="op" id="642912">.</span><span class="ident" id="642913">New</span><span class="op" id="642916">(</span><span class="string" id="642917">&#34;some&nbsp;real&nbsp;error&#34;</span><span class="op" id="642934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="642937">if</span>&nbsp;<span class="ident" id="642940">_</span><span class="op" id="642941">,</span>&nbsp;<span class="ident" id="642943">err</span>&nbsp;<span class="op" id="642947">:=</span>&nbsp;<span class="ident" id="642950">readDir</span><span class="op" id="642957">(</span><span class="op" id="642958">)</span><span class="op" id="642959">;</span>&nbsp;<span class="ident" id="642961">err</span>&nbsp;<span class="op" id="642965">!=</span>&nbsp;<span class="ident" id="642968">xerr</span>&nbsp;<span class="op" id="642973">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="642977">t</span><span class="op" id="642978">.</span><span class="ident" id="642979">Errorf</span><span class="op" id="642985">(</span><span class="string" id="642986">&#34;with&nbsp;a&nbsp;non-ErrNotExist&nbsp;error,&nbsp;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="643039">,</span>&nbsp;<span class="ident" id="643041">err</span><span class="op" id="643044">,</span>&nbsp;<span class="ident" id="643046">xerr</span><span class="op" id="643050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643053">}</span><br>
<span class="lineno"></span><span class="op" id="643055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="643058">func</span>&nbsp;<span class="ident" id="643063">TestHardLink</span><span class="op" id="643075">(</span><span class="ident" id="643076">t</span>&nbsp;<span class="op" id="643078">*</span><span class="ident" id="643079">testing</span><span class="op" id="643086">.</span><span class="ident" id="643087">T</span><span class="op" id="643088">)</span>&nbsp;<span class="op" id="643090">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="643093">//&nbsp;Hardlinks&nbsp;are&nbsp;not&nbsp;supported&nbsp;under&nbsp;windows&nbsp;or&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643150">if</span>&nbsp;<span class="ident" id="643153">runtime</span><span class="op" id="643160">.</span><span class="ident" id="643161">GOOS</span>&nbsp;<span class="op" id="643166">==</span>&nbsp;<span class="string" id="643169">&#34;plan9&#34;</span>&nbsp;<span class="op" id="643177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643181">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643192">from</span><span class="op" id="643196">,</span>&nbsp;<span class="ident" id="643198">to</span>&nbsp;<span class="op" id="643201">:=</span>&nbsp;<span class="string" id="643204">&#34;hardlinktestfrom&#34;</span><span class="op" id="643222">,</span>&nbsp;<span class="string" id="643224">&#34;hardlinktestto&#34;</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643242">Remove</span><span class="op" id="643248">(</span><span class="ident" id="643249">from</span><span class="op" id="643253">)</span>&nbsp;<span class="comment" id="643255">//&nbsp;Just&nbsp;in&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643273">file</span><span class="op" id="643277">,</span>&nbsp;<span class="ident" id="643279">err</span>&nbsp;<span class="op" id="643283">:=</span>&nbsp;<span class="ident" id="643286">Create</span><span class="op" id="643292">(</span><span class="ident" id="643293">to</span><span class="op" id="643295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643298">if</span>&nbsp;<span class="ident" id="643301">err</span>&nbsp;<span class="op" id="643305">!=</span>&nbsp;<span class="ident" id="643308">nil</span>&nbsp;<span class="op" id="643312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643316">t</span><span class="op" id="643317">.</span><span class="ident" id="643318">Fatalf</span><span class="op" id="643324">(</span><span class="string" id="643325">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="643345">,</span>&nbsp;<span class="ident" id="643347">to</span><span class="op" id="643349">,</span>&nbsp;<span class="ident" id="643351">err</span><span class="op" id="643354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643357">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643360">defer</span>&nbsp;<span class="ident" id="643366">Remove</span><span class="op" id="643372">(</span><span class="ident" id="643373">to</span><span class="op" id="643375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643378">if</span>&nbsp;<span class="ident" id="643381">err</span>&nbsp;<span class="op" id="643385">=</span>&nbsp;<span class="ident" id="643387">file</span><span class="op" id="643391">.</span><span class="ident" id="643392">Close</span><span class="op" id="643397">(</span><span class="op" id="643398">)</span><span class="op" id="643399">;</span>&nbsp;<span class="ident" id="643401">err</span>&nbsp;<span class="op" id="643405">!=</span>&nbsp;<span class="ident" id="643408">nil</span>&nbsp;<span class="op" id="643412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643416">t</span><span class="op" id="643417">.</span><span class="ident" id="643418">Errorf</span><span class="op" id="643424">(</span><span class="string" id="643425">&#34;close&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="643446">,</span>&nbsp;<span class="ident" id="643448">to</span><span class="op" id="643450">,</span>&nbsp;<span class="ident" id="643452">err</span><span class="op" id="643455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643461">err</span>&nbsp;<span class="op" id="643465">=</span>&nbsp;<span class="ident" id="643467">Link</span><span class="op" id="643471">(</span><span class="ident" id="643472">to</span><span class="op" id="643474">,</span>&nbsp;<span class="ident" id="643476">from</span><span class="op" id="643480">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643483">if</span>&nbsp;<span class="ident" id="643486">err</span>&nbsp;<span class="op" id="643490">!=</span>&nbsp;<span class="ident" id="643493">nil</span>&nbsp;<span class="op" id="643497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643501">t</span><span class="op" id="643502">.</span><span class="ident" id="643503">Fatalf</span><span class="op" id="643509">(</span><span class="string" id="643510">&#34;link&nbsp;%q,&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="643534">,</span>&nbsp;<span class="ident" id="643536">to</span><span class="op" id="643538">,</span>&nbsp;<span class="ident" id="643540">from</span><span class="op" id="643544">,</span>&nbsp;<span class="ident" id="643546">err</span><span class="op" id="643549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643555">defer</span>&nbsp;<span class="ident" id="643561">Remove</span><span class="op" id="643567">(</span><span class="ident" id="643568">from</span><span class="op" id="643572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643575">tostat</span><span class="op" id="643581">,</span>&nbsp;<span class="ident" id="643583">err</span>&nbsp;<span class="op" id="643587">:=</span>&nbsp;<span class="ident" id="643590">Stat</span><span class="op" id="643594">(</span><span class="ident" id="643595">to</span><span class="op" id="643597">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643600">if</span>&nbsp;<span class="ident" id="643603">err</span>&nbsp;<span class="op" id="643607">!=</span>&nbsp;<span class="ident" id="643610">nil</span>&nbsp;<span class="op" id="643614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643618">t</span><span class="op" id="643619">.</span><span class="ident" id="643620">Fatalf</span><span class="op" id="643626">(</span><span class="string" id="643627">&#34;stat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="643647">,</span>&nbsp;<span class="ident" id="643649">to</span><span class="op" id="643651">,</span>&nbsp;<span class="ident" id="643653">err</span><span class="op" id="643656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643662">fromstat</span><span class="op" id="643670">,</span>&nbsp;<span class="ident" id="643672">err</span>&nbsp;<span class="op" id="643676">:=</span>&nbsp;<span class="ident" id="643679">Stat</span><span class="op" id="643683">(</span><span class="ident" id="643684">from</span><span class="op" id="643688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643691">if</span>&nbsp;<span class="ident" id="643694">err</span>&nbsp;<span class="op" id="643698">!=</span>&nbsp;<span class="ident" id="643701">nil</span>&nbsp;<span class="op" id="643705">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643709">t</span><span class="op" id="643710">.</span><span class="ident" id="643711">Fatalf</span><span class="op" id="643717">(</span><span class="string" id="643718">&#34;stat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="643738">,</span>&nbsp;<span class="ident" id="643740">from</span><span class="op" id="643744">,</span>&nbsp;<span class="ident" id="643746">err</span><span class="op" id="643749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643755">if</span>&nbsp;<span class="op" id="643758">!</span><span class="ident" id="643759">SameFile</span><span class="op" id="643767">(</span><span class="ident" id="643768">tostat</span><span class="op" id="643774">,</span>&nbsp;<span class="ident" id="643776">fromstat</span><span class="op" id="643784">)</span>&nbsp;<span class="op" id="643786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643790">t</span><span class="op" id="643791">.</span><span class="ident" id="643792">Errorf</span><span class="op" id="643798">(</span><span class="string" id="643799">&#34;link&nbsp;%q,&nbsp;%q&nbsp;did&nbsp;not&nbsp;create&nbsp;hard&nbsp;link&#34;</span><span class="op" id="643837">,</span>&nbsp;<span class="ident" id="643839">to</span><span class="op" id="643841">,</span>&nbsp;<span class="ident" id="643843">from</span><span class="op" id="643847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="643850">}</span><br>
<span class="lineno">525</span><span class="op" id="643852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="643855">func</span>&nbsp;<span class="ident" id="643860">TestSymlink</span><span class="op" id="643871">(</span><span class="ident" id="643872">t</span>&nbsp;<span class="op" id="643874">*</span><span class="ident" id="643875">testing</span><span class="op" id="643882">.</span><span class="ident" id="643883">T</span><span class="op" id="643884">)</span>&nbsp;<span class="op" id="643886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643889">switch</span>&nbsp;<span class="ident" id="643896">runtime</span><span class="op" id="643903">.</span><span class="ident" id="643904">GOOS</span>&nbsp;<span class="op" id="643909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643912">case</span>&nbsp;<span class="string" id="643917">&#34;android&#34;</span><span class="op" id="643926">,</span>&nbsp;<span class="string" id="643928">&#34;nacl&#34;</span><span class="op" id="643934">,</span>&nbsp;<span class="string" id="643936">&#34;plan9&#34;</span><span class="op" id="643943">:</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="643947">t</span><span class="op" id="643948">.</span><span class="ident" id="643949">Skipf</span><span class="op" id="643954">(</span><span class="string" id="643955">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="643971">,</span>&nbsp;<span class="ident" id="643973">runtime</span><span class="op" id="643980">.</span><span class="ident" id="643981">GOOS</span><span class="op" id="643985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="643988">case</span>&nbsp;<span class="string" id="643993">&#34;windows&#34;</span><span class="op" id="644002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644006">if</span>&nbsp;<span class="op" id="644009">!</span><span class="ident" id="644010">supportsSymlinks</span>&nbsp;<span class="op" id="644027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644032">t</span><span class="op" id="644033">.</span><span class="ident" id="644034">Skipf</span><span class="op" id="644039">(</span><span class="string" id="644040">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="644056">,</span>&nbsp;<span class="ident" id="644058">runtime</span><span class="op" id="644065">.</span><span class="ident" id="644066">GOOS</span><span class="op" id="644070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644074">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644080">from</span><span class="op" id="644084">,</span>&nbsp;<span class="ident" id="644086">to</span>&nbsp;<span class="op" id="644089">:=</span>&nbsp;<span class="string" id="644092">&#34;symlinktestfrom&#34;</span><span class="op" id="644109">,</span>&nbsp;<span class="string" id="644111">&#34;symlinktestto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644128">Remove</span><span class="op" id="644134">(</span><span class="ident" id="644135">from</span><span class="op" id="644139">)</span>&nbsp;<span class="comment" id="644141">//&nbsp;Just&nbsp;in&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644159">file</span><span class="op" id="644163">,</span>&nbsp;<span class="ident" id="644165">err</span>&nbsp;<span class="op" id="644169">:=</span>&nbsp;<span class="ident" id="644172">Create</span><span class="op" id="644178">(</span><span class="ident" id="644179">to</span><span class="op" id="644181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644184">if</span>&nbsp;<span class="ident" id="644187">err</span>&nbsp;<span class="op" id="644191">!=</span>&nbsp;<span class="ident" id="644194">nil</span>&nbsp;<span class="op" id="644198">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644202">t</span><span class="op" id="644203">.</span><span class="ident" id="644204">Fatalf</span><span class="op" id="644210">(</span><span class="string" id="644211">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="644231">,</span>&nbsp;<span class="ident" id="644233">to</span><span class="op" id="644235">,</span>&nbsp;<span class="ident" id="644237">err</span><span class="op" id="644240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644246">defer</span>&nbsp;<span class="ident" id="644252">Remove</span><span class="op" id="644258">(</span><span class="ident" id="644259">to</span><span class="op" id="644261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644264">if</span>&nbsp;<span class="ident" id="644267">err</span>&nbsp;<span class="op" id="644271">=</span>&nbsp;<span class="ident" id="644273">file</span><span class="op" id="644277">.</span><span class="ident" id="644278">Close</span><span class="op" id="644283">(</span><span class="op" id="644284">)</span><span class="op" id="644285">;</span>&nbsp;<span class="ident" id="644287">err</span>&nbsp;<span class="op" id="644291">!=</span>&nbsp;<span class="ident" id="644294">nil</span>&nbsp;<span class="op" id="644298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644302">t</span><span class="op" id="644303">.</span><span class="ident" id="644304">Errorf</span><span class="op" id="644310">(</span><span class="string" id="644311">&#34;close&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="644332">,</span>&nbsp;<span class="ident" id="644334">to</span><span class="op" id="644336">,</span>&nbsp;<span class="ident" id="644338">err</span><span class="op" id="644341">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644347">err</span>&nbsp;<span class="op" id="644351">=</span>&nbsp;<span class="ident" id="644353">Symlink</span><span class="op" id="644360">(</span><span class="ident" id="644361">to</span><span class="op" id="644363">,</span>&nbsp;<span class="ident" id="644365">from</span><span class="op" id="644369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644372">if</span>&nbsp;<span class="ident" id="644375">err</span>&nbsp;<span class="op" id="644379">!=</span>&nbsp;<span class="ident" id="644382">nil</span>&nbsp;<span class="op" id="644386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644390">t</span><span class="op" id="644391">.</span><span class="ident" id="644392">Fatalf</span><span class="op" id="644398">(</span><span class="string" id="644399">&#34;symlink&nbsp;%q,&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="644426">,</span>&nbsp;<span class="ident" id="644428">to</span><span class="op" id="644430">,</span>&nbsp;<span class="ident" id="644432">from</span><span class="op" id="644436">,</span>&nbsp;<span class="ident" id="644438">err</span><span class="op" id="644441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644444">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644447">defer</span>&nbsp;<span class="ident" id="644453">Remove</span><span class="op" id="644459">(</span><span class="ident" id="644460">from</span><span class="op" id="644464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644467">tostat</span><span class="op" id="644473">,</span>&nbsp;<span class="ident" id="644475">err</span>&nbsp;<span class="op" id="644479">:=</span>&nbsp;<span class="ident" id="644482">Lstat</span><span class="op" id="644487">(</span><span class="ident" id="644488">to</span><span class="op" id="644490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644493">if</span>&nbsp;<span class="ident" id="644496">err</span>&nbsp;<span class="op" id="644500">!=</span>&nbsp;<span class="ident" id="644503">nil</span>&nbsp;<span class="op" id="644507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644511">t</span><span class="op" id="644512">.</span><span class="ident" id="644513">Fatalf</span><span class="op" id="644519">(</span><span class="string" id="644520">&#34;stat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="644540">,</span>&nbsp;<span class="ident" id="644542">to</span><span class="op" id="644544">,</span>&nbsp;<span class="ident" id="644546">err</span><span class="op" id="644549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644552">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644555">if</span>&nbsp;<span class="ident" id="644558">tostat</span><span class="op" id="644564">.</span><span class="ident" id="644565">Mode</span><span class="op" id="644569">(</span><span class="op" id="644570">)</span><span class="op" id="644571">&amp;</span><span class="ident" id="644572">ModeSymlink</span>&nbsp;<span class="op" id="644584">!=</span>&nbsp;<span class="num" id="644587">0</span>&nbsp;<span class="op" id="644589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644593">t</span><span class="op" id="644594">.</span><span class="ident" id="644595">Fatalf</span><span class="op" id="644601">(</span><span class="string" id="644602">&#34;stat&nbsp;%q&nbsp;claims&nbsp;to&nbsp;have&nbsp;found&nbsp;a&nbsp;symlink&#34;</span><span class="op" id="644642">,</span>&nbsp;<span class="ident" id="644644">to</span><span class="op" id="644646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644652">fromstat</span><span class="op" id="644660">,</span>&nbsp;<span class="ident" id="644662">err</span>&nbsp;<span class="op" id="644666">:=</span>&nbsp;<span class="ident" id="644669">Stat</span><span class="op" id="644673">(</span><span class="ident" id="644674">from</span><span class="op" id="644678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644681">if</span>&nbsp;<span class="ident" id="644684">err</span>&nbsp;<span class="op" id="644688">!=</span>&nbsp;<span class="ident" id="644691">nil</span>&nbsp;<span class="op" id="644695">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644699">t</span><span class="op" id="644700">.</span><span class="ident" id="644701">Fatalf</span><span class="op" id="644707">(</span><span class="string" id="644708">&#34;stat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="644728">,</span>&nbsp;<span class="ident" id="644730">from</span><span class="op" id="644734">,</span>&nbsp;<span class="ident" id="644736">err</span><span class="op" id="644739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644745">if</span>&nbsp;<span class="op" id="644748">!</span><span class="ident" id="644749">SameFile</span><span class="op" id="644757">(</span><span class="ident" id="644758">tostat</span><span class="op" id="644764">,</span>&nbsp;<span class="ident" id="644766">fromstat</span><span class="op" id="644774">)</span>&nbsp;<span class="op" id="644776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644780">t</span><span class="op" id="644781">.</span><span class="ident" id="644782">Errorf</span><span class="op" id="644788">(</span><span class="string" id="644789">&#34;symlink&nbsp;%q,&nbsp;%q&nbsp;did&nbsp;not&nbsp;create&nbsp;symlink&#34;</span><span class="op" id="644828">,</span>&nbsp;<span class="ident" id="644830">to</span><span class="op" id="644832">,</span>&nbsp;<span class="ident" id="644834">from</span><span class="op" id="644838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644841">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644844">fromstat</span><span class="op" id="644852">,</span>&nbsp;<span class="ident" id="644854">err</span>&nbsp;<span class="op" id="644858">=</span>&nbsp;<span class="ident" id="644860">Lstat</span><span class="op" id="644865">(</span><span class="ident" id="644866">from</span><span class="op" id="644870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644873">if</span>&nbsp;<span class="ident" id="644876">err</span>&nbsp;<span class="op" id="644880">!=</span>&nbsp;<span class="ident" id="644883">nil</span>&nbsp;<span class="op" id="644887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644891">t</span><span class="op" id="644892">.</span><span class="ident" id="644893">Fatalf</span><span class="op" id="644899">(</span><span class="string" id="644900">&#34;lstat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="644921">,</span>&nbsp;<span class="ident" id="644923">from</span><span class="op" id="644927">,</span>&nbsp;<span class="ident" id="644929">err</span><span class="op" id="644932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="644935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="644938">if</span>&nbsp;<span class="ident" id="644941">fromstat</span><span class="op" id="644949">.</span><span class="ident" id="644950">Mode</span><span class="op" id="644954">(</span><span class="op" id="644955">)</span><span class="op" id="644956">&amp;</span><span class="ident" id="644957">ModeSymlink</span>&nbsp;<span class="op" id="644969">==</span>&nbsp;<span class="num" id="644972">0</span>&nbsp;<span class="op" id="644974">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="644978">t</span><span class="op" id="644979">.</span><span class="ident" id="644980">Fatalf</span><span class="op" id="644986">(</span><span class="string" id="644987">&#34;symlink&nbsp;%q,&nbsp;%q&nbsp;did&nbsp;not&nbsp;create&nbsp;symlink&#34;</span><span class="op" id="645026">,</span>&nbsp;<span class="ident" id="645028">to</span><span class="op" id="645030">,</span>&nbsp;<span class="ident" id="645032">from</span><span class="op" id="645036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645042">fromstat</span><span class="op" id="645050">,</span>&nbsp;<span class="ident" id="645052">err</span>&nbsp;<span class="op" id="645056">=</span>&nbsp;<span class="ident" id="645058">Stat</span><span class="op" id="645062">(</span><span class="ident" id="645063">from</span><span class="op" id="645067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645070">if</span>&nbsp;<span class="ident" id="645073">err</span>&nbsp;<span class="op" id="645077">!=</span>&nbsp;<span class="ident" id="645080">nil</span>&nbsp;<span class="op" id="645084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645088">t</span><span class="op" id="645089">.</span><span class="ident" id="645090">Fatalf</span><span class="op" id="645096">(</span><span class="string" id="645097">&#34;stat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="645117">,</span>&nbsp;<span class="ident" id="645119">from</span><span class="op" id="645123">,</span>&nbsp;<span class="ident" id="645125">err</span><span class="op" id="645128">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645134">if</span>&nbsp;<span class="ident" id="645137">fromstat</span><span class="op" id="645145">.</span><span class="ident" id="645146">Mode</span><span class="op" id="645150">(</span><span class="op" id="645151">)</span><span class="op" id="645152">&amp;</span><span class="ident" id="645153">ModeSymlink</span>&nbsp;<span class="op" id="645165">!=</span>&nbsp;<span class="num" id="645168">0</span>&nbsp;<span class="op" id="645170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645174">t</span><span class="op" id="645175">.</span><span class="ident" id="645176">Fatalf</span><span class="op" id="645182">(</span><span class="string" id="645183">&#34;stat&nbsp;%q&nbsp;did&nbsp;not&nbsp;follow&nbsp;symlink&#34;</span><span class="op" id="645215">,</span>&nbsp;<span class="ident" id="645217">from</span><span class="op" id="645221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645227">s</span><span class="op" id="645228">,</span>&nbsp;<span class="ident" id="645230">err</span>&nbsp;<span class="op" id="645234">:=</span>&nbsp;<span class="ident" id="645237">Readlink</span><span class="op" id="645245">(</span><span class="ident" id="645246">from</span><span class="op" id="645250">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645253">if</span>&nbsp;<span class="ident" id="645256">err</span>&nbsp;<span class="op" id="645260">!=</span>&nbsp;<span class="ident" id="645263">nil</span>&nbsp;<span class="op" id="645267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645271">t</span><span class="op" id="645272">.</span><span class="ident" id="645273">Fatalf</span><span class="op" id="645279">(</span><span class="string" id="645280">&#34;readlink&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="645304">,</span>&nbsp;<span class="ident" id="645306">from</span><span class="op" id="645310">,</span>&nbsp;<span class="ident" id="645312">err</span><span class="op" id="645315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645321">if</span>&nbsp;<span class="ident" id="645324">s</span>&nbsp;<span class="op" id="645326">!=</span>&nbsp;<span class="ident" id="645329">to</span>&nbsp;<span class="op" id="645332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645336">t</span><span class="op" id="645337">.</span><span class="ident" id="645338">Fatalf</span><span class="op" id="645344">(</span><span class="string" id="645345">&#34;after&nbsp;symlink&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="645369">,</span>&nbsp;<span class="ident" id="645371">s</span><span class="op" id="645372">,</span>&nbsp;<span class="ident" id="645374">to</span><span class="op" id="645376">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645382">file</span><span class="op" id="645386">,</span>&nbsp;<span class="ident" id="645388">err</span>&nbsp;<span class="op" id="645392">=</span>&nbsp;<span class="ident" id="645394">Open</span><span class="op" id="645398">(</span><span class="ident" id="645399">from</span><span class="op" id="645403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645406">if</span>&nbsp;<span class="ident" id="645409">err</span>&nbsp;<span class="op" id="645413">!=</span>&nbsp;<span class="ident" id="645416">nil</span>&nbsp;<span class="op" id="645420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645424">t</span><span class="op" id="645425">.</span><span class="ident" id="645426">Fatalf</span><span class="op" id="645432">(</span><span class="string" id="645433">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="645453">,</span>&nbsp;<span class="ident" id="645455">from</span><span class="op" id="645459">,</span>&nbsp;<span class="ident" id="645461">err</span><span class="op" id="645464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645467">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645470">file</span><span class="op" id="645474">.</span><span class="ident" id="645475">Close</span><span class="op" id="645480">(</span><span class="op" id="645481">)</span><br>
<span class="lineno"></span><span class="op" id="645483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="645486">func</span>&nbsp;<span class="ident" id="645491">TestLongSymlink</span><span class="op" id="645506">(</span><span class="ident" id="645507">t</span>&nbsp;<span class="op" id="645509">*</span><span class="ident" id="645510">testing</span><span class="op" id="645517">.</span><span class="ident" id="645518">T</span><span class="op" id="645519">)</span>&nbsp;<span class="op" id="645521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645524">switch</span>&nbsp;<span class="ident" id="645531">runtime</span><span class="op" id="645538">.</span><span class="ident" id="645539">GOOS</span>&nbsp;<span class="op" id="645544">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645547">case</span>&nbsp;<span class="string" id="645552">&#34;plan9&#34;</span><span class="op" id="645559">,</span>&nbsp;<span class="string" id="645561">&#34;nacl&#34;</span><span class="op" id="645567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645571">t</span><span class="op" id="645572">.</span><span class="ident" id="645573">Skipf</span><span class="op" id="645578">(</span><span class="string" id="645579">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="645595">,</span>&nbsp;<span class="ident" id="645597">runtime</span><span class="op" id="645604">.</span><span class="ident" id="645605">GOOS</span><span class="op" id="645609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645612">case</span>&nbsp;<span class="string" id="645617">&#34;windows&#34;</span><span class="op" id="645626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645630">if</span>&nbsp;<span class="op" id="645633">!</span><span class="ident" id="645634">supportsSymlinks</span>&nbsp;<span class="op" id="645651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645656">t</span><span class="op" id="645657">.</span><span class="ident" id="645658">Skipf</span><span class="op" id="645663">(</span><span class="string" id="645664">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="645680">,</span>&nbsp;<span class="ident" id="645682">runtime</span><span class="op" id="645689">.</span><span class="ident" id="645690">GOOS</span><span class="op" id="645694">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="645701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645704">s</span>&nbsp;<span class="op" id="645706">:=</span>&nbsp;<span class="string" id="645709">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="645729">//&nbsp;Long,&nbsp;but&nbsp;not&nbsp;too&nbsp;long:&nbsp;a&nbsp;common&nbsp;limit&nbsp;is&nbsp;255.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645780">s</span>&nbsp;<span class="op" id="645782">=</span>&nbsp;<span class="ident" id="645784">s</span>&nbsp;<span class="op" id="645786">+</span>&nbsp;<span class="ident" id="645788">s</span>&nbsp;<span class="op" id="645790">+</span>&nbsp;<span class="ident" id="645792">s</span>&nbsp;<span class="op" id="645794">+</span>&nbsp;<span class="ident" id="645796">s</span>&nbsp;<span class="op" id="645798">+</span>&nbsp;<span class="ident" id="645800">s</span>&nbsp;<span class="op" id="645802">+</span>&nbsp;<span class="ident" id="645804">s</span>&nbsp;<span class="op" id="645806">+</span>&nbsp;<span class="ident" id="645808">s</span>&nbsp;<span class="op" id="645810">+</span>&nbsp;<span class="ident" id="645812">s</span>&nbsp;<span class="op" id="645814">+</span>&nbsp;<span class="ident" id="645816">s</span>&nbsp;<span class="op" id="645818">+</span>&nbsp;<span class="ident" id="645820">s</span>&nbsp;<span class="op" id="645822">+</span>&nbsp;<span class="ident" id="645824">s</span>&nbsp;<span class="op" id="645826">+</span>&nbsp;<span class="ident" id="645828">s</span>&nbsp;<span class="op" id="645830">+</span>&nbsp;<span class="ident" id="645832">s</span>&nbsp;<span class="op" id="645834">+</span>&nbsp;<span class="ident" id="645836">s</span>&nbsp;<span class="op" id="645838">+</span>&nbsp;<span class="ident" id="645840">s</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645843">from</span>&nbsp;<span class="op" id="645848">:=</span>&nbsp;<span class="string" id="645851">&#34;longsymlinktestfrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645874">Remove</span><span class="op" id="645880">(</span><span class="ident" id="645881">from</span><span class="op" id="645885">)</span>&nbsp;<span class="comment" id="645887">//&nbsp;Just&nbsp;in&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645905">err</span>&nbsp;<span class="op" id="645909">:=</span>&nbsp;<span class="ident" id="645912">Symlink</span><span class="op" id="645919">(</span><span class="ident" id="645920">s</span><span class="op" id="645921">,</span>&nbsp;<span class="ident" id="645923">from</span><span class="op" id="645927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="645930">if</span>&nbsp;<span class="ident" id="645933">err</span>&nbsp;<span class="op" id="645937">!=</span>&nbsp;<span class="ident" id="645940">nil</span>&nbsp;<span class="op" id="645944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="645948">t</span><span class="op" id="645949">.</span><span class="ident" id="645950">Fatalf</span><span class="op" id="645956">(</span><span class="string" id="645957">&#34;symlink&nbsp;%q,&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="645984">,</span>&nbsp;<span class="ident" id="645986">s</span><span class="op" id="645987">,</span>&nbsp;<span class="ident" id="645989">from</span><span class="op" id="645993">,</span>&nbsp;<span class="ident" id="645995">err</span><span class="op" id="645998">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646004">defer</span>&nbsp;<span class="ident" id="646010">Remove</span><span class="op" id="646016">(</span><span class="ident" id="646017">from</span><span class="op" id="646021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646024">r</span><span class="op" id="646025">,</span>&nbsp;<span class="ident" id="646027">err</span>&nbsp;<span class="op" id="646031">:=</span>&nbsp;<span class="ident" id="646034">Readlink</span><span class="op" id="646042">(</span><span class="ident" id="646043">from</span><span class="op" id="646047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646050">if</span>&nbsp;<span class="ident" id="646053">err</span>&nbsp;<span class="op" id="646057">!=</span>&nbsp;<span class="ident" id="646060">nil</span>&nbsp;<span class="op" id="646064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646068">t</span><span class="op" id="646069">.</span><span class="ident" id="646070">Fatalf</span><span class="op" id="646076">(</span><span class="string" id="646077">&#34;readlink&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="646101">,</span>&nbsp;<span class="ident" id="646103">from</span><span class="op" id="646107">,</span>&nbsp;<span class="ident" id="646109">err</span><span class="op" id="646112">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646118">if</span>&nbsp;<span class="ident" id="646121">r</span>&nbsp;<span class="op" id="646123">!=</span>&nbsp;<span class="ident" id="646126">s</span>&nbsp;<span class="op" id="646128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646132">t</span><span class="op" id="646133">.</span><span class="ident" id="646134">Fatalf</span><span class="op" id="646140">(</span><span class="string" id="646141">&#34;after&nbsp;symlink&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="646165">,</span>&nbsp;<span class="ident" id="646167">r</span><span class="op" id="646168">,</span>&nbsp;<span class="ident" id="646170">s</span><span class="op" id="646171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646174">}</span><br>
<span class="lineno"></span><span class="op" id="646176">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="646179">func</span>&nbsp;<span class="ident" id="646184">TestRename</span><span class="op" id="646194">(</span><span class="ident" id="646195">t</span>&nbsp;<span class="op" id="646197">*</span><span class="ident" id="646198">testing</span><span class="op" id="646205">.</span><span class="ident" id="646206">T</span><span class="op" id="646207">)</span>&nbsp;<span class="op" id="646209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646212">from</span><span class="op" id="646216">,</span>&nbsp;<span class="ident" id="646218">to</span>&nbsp;<span class="op" id="646221">:=</span>&nbsp;<span class="string" id="646224">&#34;renamefrom&#34;</span><span class="op" id="646236">,</span>&nbsp;<span class="string" id="646238">&#34;renameto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646250">Remove</span><span class="op" id="646256">(</span><span class="ident" id="646257">to</span><span class="op" id="646259">)</span>&nbsp;<span class="comment" id="646261">//&nbsp;Just&nbsp;in&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646279">file</span><span class="op" id="646283">,</span>&nbsp;<span class="ident" id="646285">err</span>&nbsp;<span class="op" id="646289">:=</span>&nbsp;<span class="ident" id="646292">Create</span><span class="op" id="646298">(</span><span class="ident" id="646299">from</span><span class="op" id="646303">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646306">if</span>&nbsp;<span class="ident" id="646309">err</span>&nbsp;<span class="op" id="646313">!=</span>&nbsp;<span class="ident" id="646316">nil</span>&nbsp;<span class="op" id="646320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646324">t</span><span class="op" id="646325">.</span><span class="ident" id="646326">Fatalf</span><span class="op" id="646332">(</span><span class="string" id="646333">&#34;open&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="646353">,</span>&nbsp;<span class="ident" id="646355">to</span><span class="op" id="646357">,</span>&nbsp;<span class="ident" id="646359">err</span><span class="op" id="646362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646368">if</span>&nbsp;<span class="ident" id="646371">err</span>&nbsp;<span class="op" id="646375">=</span>&nbsp;<span class="ident" id="646377">file</span><span class="op" id="646381">.</span><span class="ident" id="646382">Close</span><span class="op" id="646387">(</span><span class="op" id="646388">)</span><span class="op" id="646389">;</span>&nbsp;<span class="ident" id="646391">err</span>&nbsp;<span class="op" id="646395">!=</span>&nbsp;<span class="ident" id="646398">nil</span>&nbsp;<span class="op" id="646402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646406">t</span><span class="op" id="646407">.</span><span class="ident" id="646408">Errorf</span><span class="op" id="646414">(</span><span class="string" id="646415">&#34;close&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="646436">,</span>&nbsp;<span class="ident" id="646438">to</span><span class="op" id="646440">,</span>&nbsp;<span class="ident" id="646442">err</span><span class="op" id="646445">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646451">err</span>&nbsp;<span class="op" id="646455">=</span>&nbsp;<span class="ident" id="646457">Rename</span><span class="op" id="646463">(</span><span class="ident" id="646464">from</span><span class="op" id="646468">,</span>&nbsp;<span class="ident" id="646470">to</span><span class="op" id="646472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646475">if</span>&nbsp;<span class="ident" id="646478">err</span>&nbsp;<span class="op" id="646482">!=</span>&nbsp;<span class="ident" id="646485">nil</span>&nbsp;<span class="op" id="646489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646493">t</span><span class="op" id="646494">.</span><span class="ident" id="646495">Fatalf</span><span class="op" id="646501">(</span><span class="string" id="646502">&#34;rename&nbsp;%q,&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="646528">,</span>&nbsp;<span class="ident" id="646530">to</span><span class="op" id="646532">,</span>&nbsp;<span class="ident" id="646534">from</span><span class="op" id="646538">,</span>&nbsp;<span class="ident" id="646540">err</span><span class="op" id="646543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646546">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646549">defer</span>&nbsp;<span class="ident" id="646555">Remove</span><span class="op" id="646561">(</span><span class="ident" id="646562">to</span><span class="op" id="646564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646567">_</span><span class="op" id="646568">,</span>&nbsp;<span class="ident" id="646570">err</span>&nbsp;<span class="op" id="646574">=</span>&nbsp;<span class="ident" id="646576">Stat</span><span class="op" id="646580">(</span><span class="ident" id="646581">to</span><span class="op" id="646583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646586">if</span>&nbsp;<span class="ident" id="646589">err</span>&nbsp;<span class="op" id="646593">!=</span>&nbsp;<span class="ident" id="646596">nil</span>&nbsp;<span class="op" id="646600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646604">t</span><span class="op" id="646605">.</span><span class="ident" id="646606">Errorf</span><span class="op" id="646612">(</span><span class="string" id="646613">&#34;stat&nbsp;%q&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="646633">,</span>&nbsp;<span class="ident" id="646635">to</span><span class="op" id="646637">,</span>&nbsp;<span class="ident" id="646639">err</span><span class="op" id="646642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646645">}</span><br>
<span class="lineno">640</span><span class="op" id="646647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="646650">func</span>&nbsp;<span class="ident" id="646655">exec</span><span class="op" id="646659">(</span><span class="ident" id="646660">t</span>&nbsp;<span class="op" id="646662">*</span><span class="ident" id="646663">testing</span><span class="op" id="646670">.</span><span class="ident" id="646671">T</span><span class="op" id="646672">,</span>&nbsp;<span class="ident" id="646674">dir</span><span class="op" id="646677">,</span>&nbsp;<span class="ident" id="646679">cmd</span>&nbsp;<span class="builtintype" id="646683">string</span><span class="op" id="646689">,</span>&nbsp;<span class="ident" id="646691">args</span>&nbsp;<span class="op" id="646696">[</span><span class="op" id="646697">]</span><span class="builtintype" id="646698">string</span><span class="op" id="646704">,</span>&nbsp;<span class="ident" id="646706">expect</span>&nbsp;<span class="builtintype" id="646713">string</span><span class="op" id="646719">)</span>&nbsp;<span class="op" id="646721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646724">r</span><span class="op" id="646725">,</span>&nbsp;<span class="ident" id="646727">w</span><span class="op" id="646728">,</span>&nbsp;<span class="ident" id="646730">err</span>&nbsp;<span class="op" id="646734">:=</span>&nbsp;<span class="ident" id="646737">Pipe</span><span class="op" id="646741">(</span><span class="op" id="646742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646745">if</span>&nbsp;<span class="ident" id="646748">err</span>&nbsp;<span class="op" id="646752">!=</span>&nbsp;<span class="ident" id="646755">nil</span>&nbsp;<span class="op" id="646759">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646763">t</span><span class="op" id="646764">.</span><span class="ident" id="646765">Fatalf</span><span class="op" id="646771">(</span><span class="string" id="646772">&#34;Pipe:&nbsp;%v&#34;</span><span class="op" id="646782">,</span>&nbsp;<span class="ident" id="646784">err</span><span class="op" id="646787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646793">defer</span>&nbsp;<span class="ident" id="646799">r</span><span class="op" id="646800">.</span><span class="ident" id="646801">Close</span><span class="op" id="646806">(</span><span class="op" id="646807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646810">attr</span>&nbsp;<span class="op" id="646815">:=</span>&nbsp;<span class="op" id="646818">&amp;</span><span class="ident" id="646819">ProcAttr</span><span class="op" id="646827">{</span><span class="ident" id="646828">Dir</span><span class="op" id="646831">:</span>&nbsp;<span class="ident" id="646833">dir</span><span class="op" id="646836">,</span>&nbsp;<span class="ident" id="646838">Files</span><span class="op" id="646843">:</span>&nbsp;<span class="op" id="646845">[</span><span class="op" id="646846">]</span><span class="op" id="646847">*</span><span class="ident" id="646848">File</span><span class="op" id="646852">{</span><span class="ident" id="646853">nil</span><span class="op" id="646856">,</span>&nbsp;<span class="ident" id="646858">w</span><span class="op" id="646859">,</span>&nbsp;<span class="ident" id="646861">Stderr</span><span class="op" id="646867">}</span><span class="op" id="646868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646871">p</span><span class="op" id="646872">,</span>&nbsp;<span class="ident" id="646874">err</span>&nbsp;<span class="op" id="646878">:=</span>&nbsp;<span class="ident" id="646881">StartProcess</span><span class="op" id="646893">(</span><span class="ident" id="646894">cmd</span><span class="op" id="646897">,</span>&nbsp;<span class="ident" id="646899">args</span><span class="op" id="646903">,</span>&nbsp;<span class="ident" id="646905">attr</span><span class="op" id="646909">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646912">if</span>&nbsp;<span class="ident" id="646915">err</span>&nbsp;<span class="op" id="646919">!=</span>&nbsp;<span class="ident" id="646922">nil</span>&nbsp;<span class="op" id="646926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646930">t</span><span class="op" id="646931">.</span><span class="ident" id="646932">Fatalf</span><span class="op" id="646938">(</span><span class="string" id="646939">&#34;StartProcess:&nbsp;%v&#34;</span><span class="op" id="646957">,</span>&nbsp;<span class="ident" id="646959">err</span><span class="op" id="646962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="646965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="646968">w</span><span class="op" id="646969">.</span><span class="ident" id="646970">Close</span><span class="op" id="646975">(</span><span class="op" id="646976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="646980">var</span>&nbsp;<span class="ident" id="646984">b</span>&nbsp;<span class="ident" id="646986">bytes</span><span class="op" id="646991">.</span><span class="ident" id="646992">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647000">io</span><span class="op" id="647002">.</span><span class="ident" id="647003">Copy</span><span class="op" id="647007">(</span><span class="op" id="647008">&amp;</span><span class="ident" id="647009">b</span><span class="op" id="647010">,</span>&nbsp;<span class="ident" id="647012">r</span><span class="op" id="647013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647016">output</span>&nbsp;<span class="op" id="647023">:=</span>&nbsp;<span class="ident" id="647026">b</span><span class="op" id="647027">.</span><span class="ident" id="647028">String</span><span class="op" id="647034">(</span><span class="op" id="647035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647039">fi1</span><span class="op" id="647042">,</span>&nbsp;<span class="ident" id="647044">_</span>&nbsp;<span class="op" id="647046">:=</span>&nbsp;<span class="ident" id="647049">Stat</span><span class="op" id="647053">(</span><span class="ident" id="647054">strings</span><span class="op" id="647061">.</span><span class="ident" id="647062">TrimSpace</span><span class="op" id="647071">(</span><span class="ident" id="647072">output</span><span class="op" id="647078">)</span><span class="op" id="647079">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647082">fi2</span><span class="op" id="647085">,</span>&nbsp;<span class="ident" id="647087">_</span>&nbsp;<span class="op" id="647089">:=</span>&nbsp;<span class="ident" id="647092">Stat</span><span class="op" id="647096">(</span><span class="ident" id="647097">expect</span><span class="op" id="647103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647106">if</span>&nbsp;<span class="op" id="647109">!</span><span class="ident" id="647110">SameFile</span><span class="op" id="647118">(</span><span class="ident" id="647119">fi1</span><span class="op" id="647122">,</span>&nbsp;<span class="ident" id="647124">fi2</span><span class="op" id="647127">)</span>&nbsp;<span class="op" id="647129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647133">t</span><span class="op" id="647134">.</span><span class="ident" id="647135">Errorf</span><span class="op" id="647141">(</span><span class="string" id="647142">&#34;exec&nbsp;%q&nbsp;returned&nbsp;%q&nbsp;wanted&nbsp;%q&#34;</span><span class="op" id="647173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647178">strings</span><span class="op" id="647185">.</span><span class="ident" id="647186">Join</span><span class="op" id="647190">(</span><span class="builtinfunc" id="647191">append</span><span class="op" id="647197">(</span><span class="op" id="647198">[</span><span class="op" id="647199">]</span><span class="builtintype" id="647200">string</span><span class="op" id="647206">{</span><span class="ident" id="647207">cmd</span><span class="op" id="647210">}</span><span class="op" id="647211">,</span>&nbsp;<span class="ident" id="647213">args</span><span class="op" id="647217">...</span><span class="op" id="647220">)</span><span class="op" id="647221">,</span>&nbsp;<span class="string" id="647223">&#34;&nbsp;&#34;</span><span class="op" id="647226">)</span><span class="op" id="647227">,</span>&nbsp;<span class="ident" id="647229">output</span><span class="op" id="647235">,</span>&nbsp;<span class="ident" id="647237">expect</span><span class="op" id="647243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="647246">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647249">p</span><span class="op" id="647250">.</span><span class="ident" id="647251">Wait</span><span class="op" id="647255">(</span><span class="op" id="647256">)</span><br>
<span class="lineno"></span><span class="op" id="647258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="647261">func</span>&nbsp;<span class="ident" id="647266">TestStartProcess</span><span class="op" id="647282">(</span><span class="ident" id="647283">t</span>&nbsp;<span class="op" id="647285">*</span><span class="ident" id="647286">testing</span><span class="op" id="647293">.</span><span class="ident" id="647294">T</span><span class="op" id="647295">)</span>&nbsp;<span class="op" id="647297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647300">switch</span>&nbsp;<span class="ident" id="647307">runtime</span><span class="op" id="647314">.</span><span class="ident" id="647315">GOOS</span>&nbsp;<span class="op" id="647320">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647323">case</span>&nbsp;<span class="string" id="647328">&#34;android&#34;</span><span class="op" id="647337">,</span>&nbsp;<span class="string" id="647339">&#34;nacl&#34;</span><span class="op" id="647345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647349">t</span><span class="op" id="647350">.</span><span class="ident" id="647351">Skipf</span><span class="op" id="647356">(</span><span class="string" id="647357">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="647373">,</span>&nbsp;<span class="ident" id="647375">runtime</span><span class="op" id="647382">.</span><span class="ident" id="647383">GOOS</span><span class="op" id="647387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="647390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647394">var</span>&nbsp;<span class="ident" id="647398">dir</span><span class="op" id="647401">,</span>&nbsp;<span class="ident" id="647403">cmd</span>&nbsp;<span class="builtintype" id="647407">string</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647415">var</span>&nbsp;<span class="ident" id="647419">args</span>&nbsp;<span class="op" id="647424">[</span><span class="op" id="647425">]</span><span class="builtintype" id="647426">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647434">if</span>&nbsp;<span class="ident" id="647437">runtime</span><span class="op" id="647444">.</span><span class="ident" id="647445">GOOS</span>&nbsp;<span class="op" id="647450">==</span>&nbsp;<span class="string" id="647453">&#34;windows&#34;</span>&nbsp;<span class="op" id="647463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647467">cmd</span>&nbsp;<span class="op" id="647471">=</span>&nbsp;<span class="ident" id="647473">Getenv</span><span class="op" id="647479">(</span><span class="string" id="647480">&#34;COMSPEC&#34;</span><span class="op" id="647489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647493">dir</span>&nbsp;<span class="op" id="647497">=</span>&nbsp;<span class="ident" id="647499">Getenv</span><span class="op" id="647505">(</span><span class="string" id="647506">&#34;SystemRoot&#34;</span><span class="op" id="647518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647522">args</span>&nbsp;<span class="op" id="647527">=</span>&nbsp;<span class="op" id="647529">[</span><span class="op" id="647530">]</span><span class="builtintype" id="647531">string</span><span class="op" id="647537">{</span><span class="string" id="647538">&#34;/c&#34;</span><span class="op" id="647542">,</span>&nbsp;<span class="string" id="647544">&#34;cd&#34;</span><span class="op" id="647548">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="647551">}</span>&nbsp;<span class="keyword" id="647553">else</span>&nbsp;<span class="op" id="647558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647562">cmd</span>&nbsp;<span class="op" id="647566">=</span>&nbsp;<span class="string" id="647568">&#34;/bin/pwd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647581">dir</span>&nbsp;<span class="op" id="647585">=</span>&nbsp;<span class="string" id="647587">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647593">args</span>&nbsp;<span class="op" id="647598">=</span>&nbsp;<span class="op" id="647600">[</span><span class="op" id="647601">]</span><span class="builtintype" id="647602">string</span><span class="op" id="647608">{</span><span class="op" id="647609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="647612">}</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647615">cmddir</span><span class="op" id="647621">,</span>&nbsp;<span class="ident" id="647623">cmdbase</span>&nbsp;<span class="op" id="647631">:=</span>&nbsp;<span class="ident" id="647634">filepath</span><span class="op" id="647642">.</span><span class="ident" id="647643">Split</span><span class="op" id="647648">(</span><span class="ident" id="647649">cmd</span><span class="op" id="647652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647655">args</span>&nbsp;<span class="op" id="647660">=</span>&nbsp;<span class="builtinfunc" id="647662">append</span><span class="op" id="647668">(</span><span class="op" id="647669">[</span><span class="op" id="647670">]</span><span class="builtintype" id="647671">string</span><span class="op" id="647677">{</span><span class="ident" id="647678">cmdbase</span><span class="op" id="647685">}</span><span class="op" id="647686">,</span>&nbsp;<span class="ident" id="647688">args</span><span class="op" id="647692">...</span><span class="op" id="647695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="647698">//&nbsp;Test&nbsp;absolute&nbsp;executable&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647733">exec</span><span class="op" id="647737">(</span><span class="ident" id="647738">t</span><span class="op" id="647739">,</span>&nbsp;<span class="ident" id="647741">dir</span><span class="op" id="647744">,</span>&nbsp;<span class="ident" id="647746">cmd</span><span class="op" id="647749">,</span>&nbsp;<span class="ident" id="647751">args</span><span class="op" id="647755">,</span>&nbsp;<span class="ident" id="647757">dir</span><span class="op" id="647760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="647763">//&nbsp;Test&nbsp;relative&nbsp;executable&nbsp;path.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647798">exec</span><span class="op" id="647802">(</span><span class="ident" id="647803">t</span><span class="op" id="647804">,</span>&nbsp;<span class="ident" id="647806">cmddir</span><span class="op" id="647812">,</span>&nbsp;<span class="ident" id="647814">cmdbase</span><span class="op" id="647821">,</span>&nbsp;<span class="ident" id="647823">args</span><span class="op" id="647827">,</span>&nbsp;<span class="ident" id="647829">cmddir</span><span class="op" id="647835">)</span><br>
<span class="lineno"></span><span class="op" id="647837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="647840">func</span>&nbsp;<span class="ident" id="647845">checkMode</span><span class="op" id="647854">(</span><span class="ident" id="647855">t</span>&nbsp;<span class="op" id="647857">*</span><span class="ident" id="647858">testing</span><span class="op" id="647865">.</span><span class="ident" id="647866">T</span><span class="op" id="647867">,</span>&nbsp;<span class="ident" id="647869">path</span>&nbsp;<span class="builtintype" id="647874">string</span><span class="op" id="647880">,</span>&nbsp;<span class="ident" id="647882">mode</span>&nbsp;<span class="ident" id="647887">FileMode</span><span class="op" id="647895">)</span>&nbsp;<span class="op" id="647897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647900">dir</span><span class="op" id="647903">,</span>&nbsp;<span class="ident" id="647905">err</span>&nbsp;<span class="op" id="647909">:=</span>&nbsp;<span class="ident" id="647912">Stat</span><span class="op" id="647916">(</span><span class="ident" id="647917">path</span><span class="op" id="647921">)</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="647924">if</span>&nbsp;<span class="ident" id="647927">err</span>&nbsp;<span class="op" id="647931">!=</span>&nbsp;<span class="ident" id="647934">nil</span>&nbsp;<span class="op" id="647938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="647942">t</span><span class="op" id="647943">.</span><span class="ident" id="647944">Fatalf</span><span class="op" id="647950">(</span><span class="string" id="647951">&#34;Stat&nbsp;%q&nbsp;(looking&nbsp;for&nbsp;mode&nbsp;%#o):&nbsp;%s&#34;</span><span class="op" id="647987">,</span>&nbsp;<span class="ident" id="647989">path</span><span class="op" id="647993">,</span>&nbsp;<span class="ident" id="647995">mode</span><span class="op" id="647999">,</span>&nbsp;<span class="ident" id="648001">err</span><span class="op" id="648004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648010">if</span>&nbsp;<span class="ident" id="648013">dir</span><span class="op" id="648016">.</span><span class="ident" id="648017">Mode</span><span class="op" id="648021">(</span><span class="op" id="648022">)</span><span class="op" id="648023">&amp;</span><span class="num" id="648024">0777</span>&nbsp;<span class="op" id="648029">!=</span>&nbsp;<span class="ident" id="648032">mode</span>&nbsp;<span class="op" id="648037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648041">t</span><span class="op" id="648042">.</span><span class="ident" id="648043">Errorf</span><span class="op" id="648049">(</span><span class="string" id="648050">&#34;Stat&nbsp;%q:&nbsp;mode&nbsp;%#o&nbsp;want&nbsp;%#o&#34;</span><span class="op" id="648078">,</span>&nbsp;<span class="ident" id="648080">path</span><span class="op" id="648084">,</span>&nbsp;<span class="ident" id="648086">dir</span><span class="op" id="648089">.</span><span class="ident" id="648090">Mode</span><span class="op" id="648094">(</span><span class="op" id="648095">)</span><span class="op" id="648096">,</span>&nbsp;<span class="ident" id="648098">mode</span><span class="op" id="648102">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648105">}</span><br>
<span class="lineno"></span><span class="op" id="648107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="648110">func</span>&nbsp;<span class="ident" id="648115">TestChmod</span><span class="op" id="648124">(</span><span class="ident" id="648125">t</span>&nbsp;<span class="op" id="648127">*</span><span class="ident" id="648128">testing</span><span class="op" id="648135">.</span><span class="ident" id="648136">T</span><span class="op" id="648137">)</span>&nbsp;<span class="op" id="648139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="648142">//&nbsp;Chmod&nbsp;is&nbsp;not&nbsp;supported&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648184">if</span>&nbsp;<span class="ident" id="648187">runtime</span><span class="op" id="648194">.</span><span class="ident" id="648195">GOOS</span>&nbsp;<span class="op" id="648200">==</span>&nbsp;<span class="string" id="648203">&#34;windows&#34;</span>&nbsp;<span class="op" id="648213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648217">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648228">f</span>&nbsp;<span class="op" id="648230">:=</span>&nbsp;<span class="ident" id="648233">newFile</span><span class="op" id="648240">(</span><span class="string" id="648241">&#34;TestChmod&#34;</span><span class="op" id="648252">,</span>&nbsp;<span class="ident" id="648254">t</span><span class="op" id="648255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648258">defer</span>&nbsp;<span class="ident" id="648264">Remove</span><span class="op" id="648270">(</span><span class="ident" id="648271">f</span><span class="op" id="648272">.</span><span class="ident" id="648273">Name</span><span class="op" id="648277">(</span><span class="op" id="648278">)</span><span class="op" id="648279">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648282">defer</span>&nbsp;<span class="ident" id="648288">f</span><span class="op" id="648289">.</span><span class="ident" id="648290">Close</span><span class="op" id="648295">(</span><span class="op" id="648296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648300">if</span>&nbsp;<span class="ident" id="648303">err</span>&nbsp;<span class="op" id="648307">:=</span>&nbsp;<span class="ident" id="648310">Chmod</span><span class="op" id="648315">(</span><span class="ident" id="648316">f</span><span class="op" id="648317">.</span><span class="ident" id="648318">Name</span><span class="op" id="648322">(</span><span class="op" id="648323">)</span><span class="op" id="648324">,</span>&nbsp;<span class="num" id="648326">0456</span><span class="op" id="648330">)</span><span class="op" id="648331">;</span>&nbsp;<span class="ident" id="648333">err</span>&nbsp;<span class="op" id="648337">!=</span>&nbsp;<span class="ident" id="648340">nil</span>&nbsp;<span class="op" id="648344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648348">t</span><span class="op" id="648349">.</span><span class="ident" id="648350">Fatalf</span><span class="op" id="648356">(</span><span class="string" id="648357">&#34;chmod&nbsp;%s&nbsp;0456:&nbsp;%s&#34;</span><span class="op" id="648376">,</span>&nbsp;<span class="ident" id="648378">f</span><span class="op" id="648379">.</span><span class="ident" id="648380">Name</span><span class="op" id="648384">(</span><span class="op" id="648385">)</span><span class="op" id="648386">,</span>&nbsp;<span class="ident" id="648388">err</span><span class="op" id="648391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648394">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648397">checkMode</span><span class="op" id="648406">(</span><span class="ident" id="648407">t</span><span class="op" id="648408">,</span>&nbsp;<span class="ident" id="648410">f</span><span class="op" id="648411">.</span><span class="ident" id="648412">Name</span><span class="op" id="648416">(</span><span class="op" id="648417">)</span><span class="op" id="648418">,</span>&nbsp;<span class="num" id="648420">0456</span><span class="op" id="648424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648428">if</span>&nbsp;<span class="ident" id="648431">err</span>&nbsp;<span class="op" id="648435">:=</span>&nbsp;<span class="ident" id="648438">f</span><span class="op" id="648439">.</span><span class="ident" id="648440">Chmod</span><span class="op" id="648445">(</span><span class="num" id="648446">0123</span><span class="op" id="648450">)</span><span class="op" id="648451">;</span>&nbsp;<span class="ident" id="648453">err</span>&nbsp;<span class="op" id="648457">!=</span>&nbsp;<span class="ident" id="648460">nil</span>&nbsp;<span class="op" id="648464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648468">t</span><span class="op" id="648469">.</span><span class="ident" id="648470">Fatalf</span><span class="op" id="648476">(</span><span class="string" id="648477">&#34;chmod&nbsp;%s&nbsp;0123:&nbsp;%s&#34;</span><span class="op" id="648496">,</span>&nbsp;<span class="ident" id="648498">f</span><span class="op" id="648499">.</span><span class="ident" id="648500">Name</span><span class="op" id="648504">(</span><span class="op" id="648505">)</span><span class="op" id="648506">,</span>&nbsp;<span class="ident" id="648508">err</span><span class="op" id="648511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648514">}</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648517">checkMode</span><span class="op" id="648526">(</span><span class="ident" id="648527">t</span><span class="op" id="648528">,</span>&nbsp;<span class="ident" id="648530">f</span><span class="op" id="648531">.</span><span class="ident" id="648532">Name</span><span class="op" id="648536">(</span><span class="op" id="648537">)</span><span class="op" id="648538">,</span>&nbsp;<span class="num" id="648540">0123</span><span class="op" id="648544">)</span><br>
<span class="lineno"></span><span class="op" id="648546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="648549">func</span>&nbsp;<span class="ident" id="648554">checkSize</span><span class="op" id="648563">(</span><span class="ident" id="648564">t</span>&nbsp;<span class="op" id="648566">*</span><span class="ident" id="648567">testing</span><span class="op" id="648574">.</span><span class="ident" id="648575">T</span><span class="op" id="648576">,</span>&nbsp;<span class="ident" id="648578">f</span>&nbsp;<span class="op" id="648580">*</span><span class="ident" id="648581">File</span><span class="op" id="648585">,</span>&nbsp;<span class="ident" id="648587">size</span>&nbsp;<span class="ident" id="648592">int64</span><span class="op" id="648597">)</span>&nbsp;<span class="op" id="648599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648602">dir</span><span class="op" id="648605">,</span>&nbsp;<span class="ident" id="648607">err</span>&nbsp;<span class="op" id="648611">:=</span>&nbsp;<span class="ident" id="648614">f</span><span class="op" id="648615">.</span><span class="ident" id="648616">Stat</span><span class="op" id="648620">(</span><span class="op" id="648621">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648624">if</span>&nbsp;<span class="ident" id="648627">err</span>&nbsp;<span class="op" id="648631">!=</span>&nbsp;<span class="ident" id="648634">nil</span>&nbsp;<span class="op" id="648638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648642">t</span><span class="op" id="648643">.</span><span class="ident" id="648644">Fatalf</span><span class="op" id="648650">(</span><span class="string" id="648651">&#34;Stat&nbsp;%q&nbsp;(looking&nbsp;for&nbsp;size&nbsp;%d):&nbsp;%s&#34;</span><span class="op" id="648686">,</span>&nbsp;<span class="ident" id="648688">f</span><span class="op" id="648689">.</span><span class="ident" id="648690">Name</span><span class="op" id="648694">(</span><span class="op" id="648695">)</span><span class="op" id="648696">,</span>&nbsp;<span class="ident" id="648698">size</span><span class="op" id="648702">,</span>&nbsp;<span class="ident" id="648704">err</span><span class="op" id="648707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648713">if</span>&nbsp;<span class="ident" id="648716">dir</span><span class="op" id="648719">.</span><span class="ident" id="648720">Size</span><span class="op" id="648724">(</span><span class="op" id="648725">)</span>&nbsp;<span class="op" id="648727">!=</span>&nbsp;<span class="ident" id="648730">size</span>&nbsp;<span class="op" id="648735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648739">t</span><span class="op" id="648740">.</span><span class="ident" id="648741">Errorf</span><span class="op" id="648747">(</span><span class="string" id="648748">&#34;Stat&nbsp;%q:&nbsp;size&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="648774">,</span>&nbsp;<span class="ident" id="648776">f</span><span class="op" id="648777">.</span><span class="ident" id="648778">Name</span><span class="op" id="648782">(</span><span class="op" id="648783">)</span><span class="op" id="648784">,</span>&nbsp;<span class="ident" id="648786">dir</span><span class="op" id="648789">.</span><span class="ident" id="648790">Size</span><span class="op" id="648794">(</span><span class="op" id="648795">)</span><span class="op" id="648796">,</span>&nbsp;<span class="ident" id="648798">size</span><span class="op" id="648802">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="648805">}</span><br>
<span class="lineno"></span><span class="op" id="648807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="648810">func</span>&nbsp;<span class="ident" id="648815">TestFTruncate</span><span class="op" id="648828">(</span><span class="ident" id="648829">t</span>&nbsp;<span class="op" id="648831">*</span><span class="ident" id="648832">testing</span><span class="op" id="648839">.</span><span class="ident" id="648840">T</span><span class="op" id="648841">)</span>&nbsp;<span class="op" id="648843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648846">f</span>&nbsp;<span class="op" id="648848">:=</span>&nbsp;<span class="ident" id="648851">newFile</span><span class="op" id="648858">(</span><span class="string" id="648859">&#34;TestFTruncate&#34;</span><span class="op" id="648874">,</span>&nbsp;<span class="ident" id="648876">t</span><span class="op" id="648877">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648880">defer</span>&nbsp;<span class="ident" id="648886">Remove</span><span class="op" id="648892">(</span><span class="ident" id="648893">f</span><span class="op" id="648894">.</span><span class="ident" id="648895">Name</span><span class="op" id="648899">(</span><span class="op" id="648900">)</span><span class="op" id="648901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="648904">defer</span>&nbsp;<span class="ident" id="648910">f</span><span class="op" id="648911">.</span><span class="ident" id="648912">Close</span><span class="op" id="648917">(</span><span class="op" id="648918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648922">checkSize</span><span class="op" id="648931">(</span><span class="ident" id="648932">t</span><span class="op" id="648933">,</span>&nbsp;<span class="ident" id="648935">f</span><span class="op" id="648936">,</span>&nbsp;<span class="num" id="648938">0</span><span class="op" id="648939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648942">f</span><span class="op" id="648943">.</span><span class="ident" id="648944">Write</span><span class="op" id="648949">(</span><span class="op" id="648950">[</span><span class="op" id="648951">]</span><span class="builtintype" id="648952">byte</span><span class="op" id="648956">(</span><span class="string" id="648957">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="648973">)</span><span class="op" id="648974">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648977">checkSize</span><span class="op" id="648986">(</span><span class="ident" id="648987">t</span><span class="op" id="648988">,</span>&nbsp;<span class="ident" id="648990">f</span><span class="op" id="648991">,</span>&nbsp;<span class="num" id="648993">13</span><span class="op" id="648995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="648998">f</span><span class="op" id="648999">.</span><span class="ident" id="649000">Truncate</span><span class="op" id="649008">(</span><span class="num" id="649009">10</span><span class="op" id="649011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649014">checkSize</span><span class="op" id="649023">(</span><span class="ident" id="649024">t</span><span class="op" id="649025">,</span>&nbsp;<span class="ident" id="649027">f</span><span class="op" id="649028">,</span>&nbsp;<span class="num" id="649030">10</span><span class="op" id="649032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649035">f</span><span class="op" id="649036">.</span><span class="ident" id="649037">Truncate</span><span class="op" id="649045">(</span><span class="num" id="649046">1024</span><span class="op" id="649050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649053">checkSize</span><span class="op" id="649062">(</span><span class="ident" id="649063">t</span><span class="op" id="649064">,</span>&nbsp;<span class="ident" id="649066">f</span><span class="op" id="649067">,</span>&nbsp;<span class="num" id="649069">1024</span><span class="op" id="649073">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649076">f</span><span class="op" id="649077">.</span><span class="ident" id="649078">Truncate</span><span class="op" id="649086">(</span><span class="num" id="649087">0</span><span class="op" id="649088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649091">checkSize</span><span class="op" id="649100">(</span><span class="ident" id="649101">t</span><span class="op" id="649102">,</span>&nbsp;<span class="ident" id="649104">f</span><span class="op" id="649105">,</span>&nbsp;<span class="num" id="649107">0</span><span class="op" id="649108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649111">_</span><span class="op" id="649112">,</span>&nbsp;<span class="ident" id="649114">err</span>&nbsp;<span class="op" id="649118">:=</span>&nbsp;<span class="ident" id="649121">f</span><span class="op" id="649122">.</span><span class="ident" id="649123">Write</span><span class="op" id="649128">(</span><span class="op" id="649129">[</span><span class="op" id="649130">]</span><span class="builtintype" id="649131">byte</span><span class="op" id="649135">(</span><span class="string" id="649136">&#34;surprise!&#34;</span><span class="op" id="649147">)</span><span class="op" id="649148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="649151">if</span>&nbsp;<span class="ident" id="649154">err</span>&nbsp;<span class="op" id="649158">==</span>&nbsp;<span class="ident" id="649161">nil</span>&nbsp;<span class="op" id="649165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649169">checkSize</span><span class="op" id="649178">(</span><span class="ident" id="649179">t</span><span class="op" id="649180">,</span>&nbsp;<span class="ident" id="649182">f</span><span class="op" id="649183">,</span>&nbsp;<span class="num" id="649185">13</span><span class="op" id="649187">+</span><span class="num" id="649188">9</span><span class="op" id="649189">)</span>&nbsp;<span class="comment" id="649191">//&nbsp;wrote&nbsp;at&nbsp;offset&nbsp;past&nbsp;where&nbsp;hello,&nbsp;world&nbsp;was.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="649240">}</span><br>
<span class="lineno"></span><span class="op" id="649242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="649245">func</span>&nbsp;<span class="ident" id="649250">TestTruncate</span><span class="op" id="649262">(</span><span class="ident" id="649263">t</span>&nbsp;<span class="op" id="649265">*</span><span class="ident" id="649266">testing</span><span class="op" id="649273">.</span><span class="ident" id="649274">T</span><span class="op" id="649275">)</span>&nbsp;<span class="op" id="649277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649280">f</span>&nbsp;<span class="op" id="649282">:=</span>&nbsp;<span class="ident" id="649285">newFile</span><span class="op" id="649292">(</span><span class="string" id="649293">&#34;TestTruncate&#34;</span><span class="op" id="649307">,</span>&nbsp;<span class="ident" id="649309">t</span><span class="op" id="649310">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="649313">defer</span>&nbsp;<span class="ident" id="649319">Remove</span><span class="op" id="649325">(</span><span class="ident" id="649326">f</span><span class="op" id="649327">.</span><span class="ident" id="649328">Name</span><span class="op" id="649332">(</span><span class="op" id="649333">)</span><span class="op" id="649334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="649337">defer</span>&nbsp;<span class="ident" id="649343">f</span><span class="op" id="649344">.</span><span class="ident" id="649345">Close</span><span class="op" id="649350">(</span><span class="op" id="649351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649355">checkSize</span><span class="op" id="649364">(</span><span class="ident" id="649365">t</span><span class="op" id="649366">,</span>&nbsp;<span class="ident" id="649368">f</span><span class="op" id="649369">,</span>&nbsp;<span class="num" id="649371">0</span><span class="op" id="649372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649375">f</span><span class="op" id="649376">.</span><span class="ident" id="649377">Write</span><span class="op" id="649382">(</span><span class="op" id="649383">[</span><span class="op" id="649384">]</span><span class="builtintype" id="649385">byte</span><span class="op" id="649389">(</span><span class="string" id="649390">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="649406">)</span><span class="op" id="649407">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649410">checkSize</span><span class="op" id="649419">(</span><span class="ident" id="649420">t</span><span class="op" id="649421">,</span>&nbsp;<span class="ident" id="649423">f</span><span class="op" id="649424">,</span>&nbsp;<span class="num" id="649426">13</span><span class="op" id="649428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649431">Truncate</span><span class="op" id="649439">(</span><span class="ident" id="649440">f</span><span class="op" id="649441">.</span><span class="ident" id="649442">Name</span><span class="op" id="649446">(</span><span class="op" id="649447">)</span><span class="op" id="649448">,</span>&nbsp;<span class="num" id="649450">10</span><span class="op" id="649452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649455">checkSize</span><span class="op" id="649464">(</span><span class="ident" id="649465">t</span><span class="op" id="649466">,</span>&nbsp;<span class="ident" id="649468">f</span><span class="op" id="649469">,</span>&nbsp;<span class="num" id="649471">10</span><span class="op" id="649473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649476">Truncate</span><span class="op" id="649484">(</span><span class="ident" id="649485">f</span><span class="op" id="649486">.</span><span class="ident" id="649487">Name</span><span class="op" id="649491">(</span><span class="op" id="649492">)</span><span class="op" id="649493">,</span>&nbsp;<span class="num" id="649495">1024</span><span class="op" id="649499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649502">checkSize</span><span class="op" id="649511">(</span><span class="ident" id="649512">t</span><span class="op" id="649513">,</span>&nbsp;<span class="ident" id="649515">f</span><span class="op" id="649516">,</span>&nbsp;<span class="num" id="649518">1024</span><span class="op" id="649522">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649525">Truncate</span><span class="op" id="649533">(</span><span class="ident" id="649534">f</span><span class="op" id="649535">.</span><span class="ident" id="649536">Name</span><span class="op" id="649540">(</span><span class="op" id="649541">)</span><span class="op" id="649542">,</span>&nbsp;<span class="num" id="649544">0</span><span class="op" id="649545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649548">checkSize</span><span class="op" id="649557">(</span><span class="ident" id="649558">t</span><span class="op" id="649559">,</span>&nbsp;<span class="ident" id="649561">f</span><span class="op" id="649562">,</span>&nbsp;<span class="num" id="649564">0</span><span class="op" id="649565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649568">_</span><span class="op" id="649569">,</span>&nbsp;<span class="ident" id="649571">err</span>&nbsp;<span class="op" id="649575">:=</span>&nbsp;<span class="ident" id="649578">f</span><span class="op" id="649579">.</span><span class="ident" id="649580">Write</span><span class="op" id="649585">(</span><span class="op" id="649586">[</span><span class="op" id="649587">]</span><span class="builtintype" id="649588">byte</span><span class="op" id="649592">(</span><span class="string" id="649593">&#34;surprise!&#34;</span><span class="op" id="649604">)</span><span class="op" id="649605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="649608">if</span>&nbsp;<span class="ident" id="649611">err</span>&nbsp;<span class="op" id="649615">==</span>&nbsp;<span class="ident" id="649618">nil</span>&nbsp;<span class="op" id="649622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649626">checkSize</span><span class="op" id="649635">(</span><span class="ident" id="649636">t</span><span class="op" id="649637">,</span>&nbsp;<span class="ident" id="649639">f</span><span class="op" id="649640">,</span>&nbsp;<span class="num" id="649642">13</span><span class="op" id="649644">+</span><span class="num" id="649645">9</span><span class="op" id="649646">)</span>&nbsp;<span class="comment" id="649648">//&nbsp;wrote&nbsp;at&nbsp;offset&nbsp;past&nbsp;where&nbsp;hello,&nbsp;world&nbsp;was.</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="649697">}</span><br>
<span class="lineno"></span><span class="op" id="649699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="649702">//&nbsp;Use&nbsp;TempDir&nbsp;(via&nbsp;newFile)&nbsp;to&nbsp;make&nbsp;sure&nbsp;we&#39;re&nbsp;on&nbsp;a&nbsp;local&nbsp;file&nbsp;system,</span><br>
<span class="lineno"></span><span class="comment" id="649774">//&nbsp;so&nbsp;that&nbsp;timings&nbsp;are&nbsp;not&nbsp;distorted&nbsp;by&nbsp;latency&nbsp;and&nbsp;caching.</span><br>
<span class="lineno">775</span><span class="comment" id="649835">//&nbsp;On&nbsp;NFS,&nbsp;timings&nbsp;can&nbsp;be&nbsp;off&nbsp;due&nbsp;to&nbsp;caching&nbsp;of&nbsp;meta-data&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="649896">//&nbsp;NFS&nbsp;servers&nbsp;(Issue&nbsp;848).</span><br>
<span class="lineno"></span><span class="keyword" id="649924">func</span>&nbsp;<span class="ident" id="649929">TestChtimes</span><span class="op" id="649940">(</span><span class="ident" id="649941">t</span>&nbsp;<span class="op" id="649943">*</span><span class="ident" id="649944">testing</span><span class="op" id="649951">.</span><span class="ident" id="649952">T</span><span class="op" id="649953">)</span>&nbsp;<span class="op" id="649955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="649958">f</span>&nbsp;<span class="op" id="649960">:=</span>&nbsp;<span class="ident" id="649963">newFile</span><span class="op" id="649970">(</span><span class="string" id="649971">&#34;TestChtimes&#34;</span><span class="op" id="649984">,</span>&nbsp;<span class="ident" id="649986">t</span><span class="op" id="649987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="649990">defer</span>&nbsp;<span class="ident" id="649996">Remove</span><span class="op" id="650002">(</span><span class="ident" id="650003">f</span><span class="op" id="650004">.</span><span class="ident" id="650005">Name</span><span class="op" id="650009">(</span><span class="op" id="650010">)</span><span class="op" id="650011">)</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650015">f</span><span class="op" id="650016">.</span><span class="ident" id="650017">Write</span><span class="op" id="650022">(</span><span class="op" id="650023">[</span><span class="op" id="650024">]</span><span class="builtintype" id="650025">byte</span><span class="op" id="650029">(</span><span class="string" id="650030">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="650046">)</span><span class="op" id="650047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650050">f</span><span class="op" id="650051">.</span><span class="ident" id="650052">Close</span><span class="op" id="650057">(</span><span class="op" id="650058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650062">testChtimes</span><span class="op" id="650073">(</span><span class="ident" id="650074">t</span><span class="op" id="650075">,</span>&nbsp;<span class="ident" id="650077">f</span><span class="op" id="650078">.</span><span class="ident" id="650079">Name</span><span class="op" id="650083">(</span><span class="op" id="650084">)</span><span class="op" id="650085">)</span><br>
<span class="lineno">785</span><span class="op" id="650087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="650090">//&nbsp;Use&nbsp;TempDir&nbsp;(via&nbsp;newDir)&nbsp;to&nbsp;make&nbsp;sure&nbsp;we&#39;re&nbsp;on&nbsp;a&nbsp;local&nbsp;file&nbsp;system,</span><br>
<span class="lineno"></span><span class="comment" id="650161">//&nbsp;so&nbsp;that&nbsp;timings&nbsp;are&nbsp;not&nbsp;distorted&nbsp;by&nbsp;latency&nbsp;and&nbsp;caching.</span><br>
<span class="lineno"></span><span class="comment" id="650222">//&nbsp;On&nbsp;NFS,&nbsp;timings&nbsp;can&nbsp;be&nbsp;off&nbsp;due&nbsp;to&nbsp;caching&nbsp;of&nbsp;meta-data&nbsp;on</span><br>
<span class="lineno">790</span><span class="comment" id="650283">//&nbsp;NFS&nbsp;servers&nbsp;(Issue&nbsp;848).</span><br>
<span class="lineno"></span><span class="keyword" id="650311">func</span>&nbsp;<span class="ident" id="650316">TestChtimesDir</span><span class="op" id="650330">(</span><span class="ident" id="650331">t</span>&nbsp;<span class="op" id="650333">*</span><span class="ident" id="650334">testing</span><span class="op" id="650341">.</span><span class="ident" id="650342">T</span><span class="op" id="650343">)</span>&nbsp;<span class="op" id="650345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650348">name</span>&nbsp;<span class="op" id="650353">:=</span>&nbsp;<span class="ident" id="650356">newDir</span><span class="op" id="650362">(</span><span class="string" id="650363">&#34;TestChtimes&#34;</span><span class="op" id="650376">,</span>&nbsp;<span class="ident" id="650378">t</span><span class="op" id="650379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="650382">defer</span>&nbsp;<span class="ident" id="650388">RemoveAll</span><span class="op" id="650397">(</span><span class="ident" id="650398">name</span><span class="op" id="650402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650406">testChtimes</span><span class="op" id="650417">(</span><span class="ident" id="650418">t</span><span class="op" id="650419">,</span>&nbsp;<span class="ident" id="650421">name</span><span class="op" id="650425">)</span><br>
<span class="lineno"></span><span class="op" id="650427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="650430">func</span>&nbsp;<span class="ident" id="650435">testChtimes</span><span class="op" id="650446">(</span><span class="ident" id="650447">t</span>&nbsp;<span class="op" id="650449">*</span><span class="ident" id="650450">testing</span><span class="op" id="650457">.</span><span class="ident" id="650458">T</span><span class="op" id="650459">,</span>&nbsp;<span class="ident" id="650461">name</span>&nbsp;<span class="builtintype" id="650466">string</span><span class="op" id="650472">)</span>&nbsp;<span class="op" id="650474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650477">st</span><span class="op" id="650479">,</span>&nbsp;<span class="ident" id="650481">err</span>&nbsp;<span class="op" id="650485">:=</span>&nbsp;<span class="ident" id="650488">Stat</span><span class="op" id="650492">(</span><span class="ident" id="650493">name</span><span class="op" id="650497">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="650500">if</span>&nbsp;<span class="ident" id="650503">err</span>&nbsp;<span class="op" id="650507">!=</span>&nbsp;<span class="ident" id="650510">nil</span>&nbsp;<span class="op" id="650514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650518">t</span><span class="op" id="650519">.</span><span class="ident" id="650520">Fatalf</span><span class="op" id="650526">(</span><span class="string" id="650527">&#34;Stat&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="650540">,</span>&nbsp;<span class="ident" id="650542">name</span><span class="op" id="650546">,</span>&nbsp;<span class="ident" id="650548">err</span><span class="op" id="650551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="650554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650557">preStat</span>&nbsp;<span class="op" id="650565">:=</span>&nbsp;<span class="ident" id="650568">st</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="650573">//&nbsp;Move&nbsp;access&nbsp;and&nbsp;modification&nbsp;time&nbsp;back&nbsp;a&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650625">at</span>&nbsp;<span class="op" id="650628">:=</span>&nbsp;<span class="ident" id="650631">Atime</span><span class="op" id="650636">(</span><span class="ident" id="650637">preStat</span><span class="op" id="650644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650647">mt</span>&nbsp;<span class="op" id="650650">:=</span>&nbsp;<span class="ident" id="650653">preStat</span><span class="op" id="650660">.</span><span class="ident" id="650661">ModTime</span><span class="op" id="650668">(</span><span class="op" id="650669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650672">err</span>&nbsp;<span class="op" id="650676">=</span>&nbsp;<span class="ident" id="650678">Chtimes</span><span class="op" id="650685">(</span><span class="ident" id="650686">name</span><span class="op" id="650690">,</span>&nbsp;<span class="ident" id="650692">at</span><span class="op" id="650694">.</span><span class="ident" id="650695">Add</span><span class="op" id="650698">(</span><span class="op" id="650699">-</span><span class="ident" id="650700">time</span><span class="op" id="650704">.</span><span class="ident" id="650705">Second</span><span class="op" id="650711">)</span><span class="op" id="650712">,</span>&nbsp;<span class="ident" id="650714">mt</span><span class="op" id="650716">.</span><span class="ident" id="650717">Add</span><span class="op" id="650720">(</span><span class="op" id="650721">-</span><span class="ident" id="650722">time</span><span class="op" id="650726">.</span><span class="ident" id="650727">Second</span><span class="op" id="650733">)</span><span class="op" id="650734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="650737">if</span>&nbsp;<span class="ident" id="650740">err</span>&nbsp;<span class="op" id="650744">!=</span>&nbsp;<span class="ident" id="650747">nil</span>&nbsp;<span class="op" id="650751">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650755">t</span><span class="op" id="650756">.</span><span class="ident" id="650757">Fatalf</span><span class="op" id="650763">(</span><span class="string" id="650764">&#34;Chtimes&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="650780">,</span>&nbsp;<span class="ident" id="650782">name</span><span class="op" id="650786">,</span>&nbsp;<span class="ident" id="650788">err</span><span class="op" id="650791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="650794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650798">st</span><span class="op" id="650800">,</span>&nbsp;<span class="ident" id="650802">err</span>&nbsp;<span class="op" id="650806">=</span>&nbsp;<span class="ident" id="650808">Stat</span><span class="op" id="650812">(</span><span class="ident" id="650813">name</span><span class="op" id="650817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="650820">if</span>&nbsp;<span class="ident" id="650823">err</span>&nbsp;<span class="op" id="650827">!=</span>&nbsp;<span class="ident" id="650830">nil</span>&nbsp;<span class="op" id="650834">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650838">t</span><span class="op" id="650839">.</span><span class="ident" id="650840">Fatalf</span><span class="op" id="650846">(</span><span class="string" id="650847">&#34;second&nbsp;Stat&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="650867">,</span>&nbsp;<span class="ident" id="650869">name</span><span class="op" id="650873">,</span>&nbsp;<span class="ident" id="650875">err</span><span class="op" id="650878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="650881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="650884">postStat</span>&nbsp;<span class="op" id="650893">:=</span>&nbsp;<span class="ident" id="650896">st</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="650901">/*&nbsp;Plan&nbsp;9,&nbsp;NaCl:<br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mtime&nbsp;is&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;last&nbsp;change&nbsp;of&nbsp;content.&nbsp;&nbsp;Similarly,&nbsp;atime&nbsp;is&nbsp;set&nbsp;whenever&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;are&nbsp;accessed;&nbsp;also,&nbsp;it&nbsp;is&nbsp;set&nbsp;whenever&nbsp;mtime&nbsp;is&nbsp;set.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651079">pat</span>&nbsp;<span class="op" id="651083">:=</span>&nbsp;<span class="ident" id="651086">Atime</span><span class="op" id="651091">(</span><span class="ident" id="651092">postStat</span><span class="op" id="651100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651103">pmt</span>&nbsp;<span class="op" id="651107">:=</span>&nbsp;<span class="ident" id="651110">postStat</span><span class="op" id="651118">.</span><span class="ident" id="651119">ModTime</span><span class="op" id="651126">(</span><span class="op" id="651127">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651130">if</span>&nbsp;<span class="op" id="651133">!</span><span class="ident" id="651134">pat</span><span class="op" id="651137">.</span><span class="ident" id="651138">Before</span><span class="op" id="651144">(</span><span class="ident" id="651145">at</span><span class="op" id="651147">)</span>&nbsp;<span class="op" id="651149">&amp;&amp;</span>&nbsp;<span class="ident" id="651152">runtime</span><span class="op" id="651159">.</span><span class="ident" id="651160">GOOS</span>&nbsp;<span class="op" id="651165">!=</span>&nbsp;<span class="string" id="651168">&#34;plan9&#34;</span>&nbsp;<span class="op" id="651176">&amp;&amp;</span>&nbsp;<span class="ident" id="651179">runtime</span><span class="op" id="651186">.</span><span class="ident" id="651187">GOOS</span>&nbsp;<span class="op" id="651192">!=</span>&nbsp;<span class="string" id="651195">&#34;nacl&#34;</span>&nbsp;<span class="op" id="651202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651206">t</span><span class="op" id="651207">.</span><span class="ident" id="651208">Errorf</span><span class="op" id="651214">(</span><span class="string" id="651215">&#34;AccessTime&nbsp;didn&#39;t&nbsp;go&nbsp;backwards;&nbsp;was=%d,&nbsp;after=%d&#34;</span><span class="op" id="651265">,</span>&nbsp;<span class="ident" id="651267">at</span><span class="op" id="651269">,</span>&nbsp;<span class="ident" id="651271">pat</span><span class="op" id="651274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="651277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651281">if</span>&nbsp;<span class="op" id="651284">!</span><span class="ident" id="651285">pmt</span><span class="op" id="651288">.</span><span class="ident" id="651289">Before</span><span class="op" id="651295">(</span><span class="ident" id="651296">mt</span><span class="op" id="651298">)</span>&nbsp;<span class="op" id="651300">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651304">t</span><span class="op" id="651305">.</span><span class="ident" id="651306">Errorf</span><span class="op" id="651312">(</span><span class="string" id="651313">&#34;ModTime&nbsp;didn&#39;t&nbsp;go&nbsp;backwards;&nbsp;was=%d,&nbsp;after=%d&#34;</span><span class="op" id="651360">,</span>&nbsp;<span class="ident" id="651362">mt</span><span class="op" id="651364">,</span>&nbsp;<span class="ident" id="651366">pmt</span><span class="op" id="651369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="651372">}</span><br>
<span class="lineno"></span><span class="op" id="651374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="651377">func</span>&nbsp;<span class="ident" id="651382">TestChdirAndGetwd</span><span class="op" id="651399">(</span><span class="ident" id="651400">t</span>&nbsp;<span class="op" id="651402">*</span><span class="ident" id="651403">testing</span><span class="op" id="651410">.</span><span class="ident" id="651411">T</span><span class="op" id="651412">)</span>&nbsp;<span class="op" id="651414">{</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="651417">//&nbsp;TODO(brainman):&nbsp;file.Chdir()&nbsp;is&nbsp;not&nbsp;implemented&nbsp;on&nbsp;windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651481">if</span>&nbsp;<span class="ident" id="651484">runtime</span><span class="op" id="651491">.</span><span class="ident" id="651492">GOOS</span>&nbsp;<span class="op" id="651497">==</span>&nbsp;<span class="string" id="651500">&#34;windows&#34;</span>&nbsp;<span class="op" id="651510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651514">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="651522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651525">fd</span><span class="op" id="651527">,</span>&nbsp;<span class="ident" id="651529">err</span>&nbsp;<span class="op" id="651533">:=</span>&nbsp;<span class="ident" id="651536">Open</span><span class="op" id="651540">(</span><span class="string" id="651541">&#34;.&#34;</span><span class="op" id="651544">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651547">if</span>&nbsp;<span class="ident" id="651550">err</span>&nbsp;<span class="op" id="651554">!=</span>&nbsp;<span class="ident" id="651557">nil</span>&nbsp;<span class="op" id="651561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651565">t</span><span class="op" id="651566">.</span><span class="ident" id="651567">Fatalf</span><span class="op" id="651573">(</span><span class="string" id="651574">&#34;Open&nbsp;.:&nbsp;%s&#34;</span><span class="op" id="651586">,</span>&nbsp;<span class="ident" id="651588">err</span><span class="op" id="651591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="651594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="651597">//&nbsp;These&nbsp;are&nbsp;chosen&nbsp;carefully&nbsp;not&nbsp;to&nbsp;be&nbsp;symlinks&nbsp;on&nbsp;a&nbsp;Mac</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="651656">//&nbsp;(unlike,&nbsp;say,&nbsp;/var,&nbsp;/etc),&nbsp;except&nbsp;/tmp,&nbsp;which&nbsp;we&nbsp;handle&nbsp;below.</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651723">dirs</span>&nbsp;<span class="op" id="651728">:=</span>&nbsp;<span class="op" id="651731">[</span><span class="op" id="651732">]</span><span class="builtintype" id="651733">string</span><span class="op" id="651739">{</span><span class="string" id="651740">&#34;/&#34;</span><span class="op" id="651743">,</span>&nbsp;<span class="string" id="651745">&#34;/usr/bin&#34;</span><span class="op" id="651755">,</span>&nbsp;<span class="string" id="651757">&#34;/tmp&#34;</span><span class="op" id="651763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="651766">//&nbsp;/usr/bin&nbsp;does&nbsp;not&nbsp;usually&nbsp;exist&nbsp;on&nbsp;Plan&nbsp;9&nbsp;or&nbsp;Android.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651824">switch</span>&nbsp;<span class="ident" id="651831">runtime</span><span class="op" id="651838">.</span><span class="ident" id="651839">GOOS</span>&nbsp;<span class="op" id="651844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651847">case</span>&nbsp;<span class="string" id="651852">&#34;android&#34;</span><span class="op" id="651861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651865">dirs</span>&nbsp;<span class="op" id="651870">=</span>&nbsp;<span class="op" id="651872">[</span><span class="op" id="651873">]</span><span class="builtintype" id="651874">string</span><span class="op" id="651880">{</span><span class="string" id="651881">&#34;/&#34;</span><span class="op" id="651884">,</span>&nbsp;<span class="string" id="651886">&#34;/system/bin&#34;</span><span class="op" id="651899">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651902">case</span>&nbsp;<span class="string" id="651907">&#34;plan9&#34;</span><span class="op" id="651914">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651918">dirs</span>&nbsp;<span class="op" id="651923">=</span>&nbsp;<span class="op" id="651925">[</span><span class="op" id="651926">]</span><span class="builtintype" id="651927">string</span><span class="op" id="651933">{</span><span class="string" id="651934">&#34;/&#34;</span><span class="op" id="651937">,</span>&nbsp;<span class="string" id="651939">&#34;/usr&#34;</span><span class="op" id="651945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="651948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="651951">oldwd</span>&nbsp;<span class="op" id="651957">:=</span>&nbsp;<span class="ident" id="651960">Getenv</span><span class="op" id="651966">(</span><span class="string" id="651967">&#34;PWD&#34;</span><span class="op" id="651972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="651975">for</span>&nbsp;<span class="ident" id="651979">mode</span>&nbsp;<span class="op" id="651984">:=</span>&nbsp;<span class="num" id="651987">0</span><span class="op" id="651988">;</span>&nbsp;<span class="ident" id="651990">mode</span>&nbsp;<span class="op" id="651995">&lt;</span>&nbsp;<span class="num" id="651997">2</span><span class="op" id="651998">;</span>&nbsp;<span class="ident" id="652000">mode</span><span class="op" id="652004">++</span>&nbsp;<span class="op" id="652007">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652011">for</span>&nbsp;<span class="ident" id="652015">_</span><span class="op" id="652016">,</span>&nbsp;<span class="ident" id="652018">d</span>&nbsp;<span class="op" id="652020">:=</span>&nbsp;<span class="keyword" id="652023">range</span>&nbsp;<span class="ident" id="652029">dirs</span>&nbsp;<span class="op" id="652034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652039">if</span>&nbsp;<span class="ident" id="652042">mode</span>&nbsp;<span class="op" id="652047">==</span>&nbsp;<span class="num" id="652050">0</span>&nbsp;<span class="op" id="652052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652058">err</span>&nbsp;<span class="op" id="652062">=</span>&nbsp;<span class="ident" id="652064">Chdir</span><span class="op" id="652069">(</span><span class="ident" id="652070">d</span><span class="op" id="652071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652076">}</span>&nbsp;<span class="keyword" id="652078">else</span>&nbsp;<span class="op" id="652083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652089">fd1</span><span class="op" id="652092">,</span>&nbsp;<span class="ident" id="652094">err</span>&nbsp;<span class="op" id="652098">:=</span>&nbsp;<span class="ident" id="652101">Open</span><span class="op" id="652105">(</span><span class="ident" id="652106">d</span><span class="op" id="652107">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652113">if</span>&nbsp;<span class="ident" id="652116">err</span>&nbsp;<span class="op" id="652120">!=</span>&nbsp;<span class="ident" id="652123">nil</span>&nbsp;<span class="op" id="652127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652134">t</span><span class="op" id="652135">.</span><span class="ident" id="652136">Errorf</span><span class="op" id="652142">(</span><span class="string" id="652143">&#34;Open&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="652156">,</span>&nbsp;<span class="ident" id="652158">d</span><span class="op" id="652159">,</span>&nbsp;<span class="ident" id="652161">err</span><span class="op" id="652164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652171">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652190">err</span>&nbsp;<span class="op" id="652194">=</span>&nbsp;<span class="ident" id="652196">fd1</span><span class="op" id="652199">.</span><span class="ident" id="652200">Chdir</span><span class="op" id="652205">(</span><span class="op" id="652206">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652212">fd1</span><span class="op" id="652215">.</span><span class="ident" id="652216">Close</span><span class="op" id="652221">(</span><span class="op" id="652222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652232">if</span>&nbsp;<span class="ident" id="652235">d</span>&nbsp;<span class="op" id="652237">==</span>&nbsp;<span class="string" id="652240">&#34;/tmp&#34;</span>&nbsp;<span class="op" id="652247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652253">Setenv</span><span class="op" id="652259">(</span><span class="string" id="652260">&#34;PWD&#34;</span><span class="op" id="652265">,</span>&nbsp;<span class="string" id="652267">&#34;/tmp&#34;</span><span class="op" id="652273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652278">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652283">pwd</span><span class="op" id="652286">,</span>&nbsp;<span class="ident" id="652288">err1</span>&nbsp;<span class="op" id="652293">:=</span>&nbsp;<span class="ident" id="652296">Getwd</span><span class="op" id="652301">(</span><span class="op" id="652302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652307">Setenv</span><span class="op" id="652313">(</span><span class="string" id="652314">&#34;PWD&#34;</span><span class="op" id="652319">,</span>&nbsp;<span class="ident" id="652321">oldwd</span><span class="op" id="652326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652331">err2</span>&nbsp;<span class="op" id="652336">:=</span>&nbsp;<span class="ident" id="652339">fd</span><span class="op" id="652341">.</span><span class="ident" id="652342">Chdir</span><span class="op" id="652347">(</span><span class="op" id="652348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652353">if</span>&nbsp;<span class="ident" id="652356">err2</span>&nbsp;<span class="op" id="652361">!=</span>&nbsp;<span class="ident" id="652364">nil</span>&nbsp;<span class="op" id="652368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="652374">//&nbsp;We&nbsp;changed&nbsp;the&nbsp;current&nbsp;directory&nbsp;and&nbsp;cannot&nbsp;go&nbsp;back.</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="652434">//&nbsp;Don&#39;t&nbsp;let&nbsp;the&nbsp;tests&nbsp;continue;&nbsp;they&#39;ll&nbsp;scribble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="652488">//&nbsp;all&nbsp;over&nbsp;some&nbsp;other&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652526">fmt</span><span class="op" id="652529">.</span><span class="ident" id="652530">Fprintf</span><span class="op" id="652537">(</span><span class="ident" id="652538">Stderr</span><span class="op" id="652544">,</span>&nbsp;<span class="string" id="652546">&#34;fchdir&nbsp;back&nbsp;to&nbsp;dot&nbsp;failed:&nbsp;%s\n&#34;</span><span class="op" id="652579">,</span>&nbsp;<span class="ident" id="652581">err2</span><span class="op" id="652585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652591">Exit</span><span class="op" id="652595">(</span><span class="num" id="652596">1</span><span class="op" id="652597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652602">}</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652607">if</span>&nbsp;<span class="ident" id="652610">err</span>&nbsp;<span class="op" id="652614">!=</span>&nbsp;<span class="ident" id="652617">nil</span>&nbsp;<span class="op" id="652621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652627">fd</span><span class="op" id="652629">.</span><span class="ident" id="652630">Close</span><span class="op" id="652635">(</span><span class="op" id="652636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652642">t</span><span class="op" id="652643">.</span><span class="ident" id="652644">Fatalf</span><span class="op" id="652650">(</span><span class="string" id="652651">&#34;Chdir&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="652665">,</span>&nbsp;<span class="ident" id="652667">d</span><span class="op" id="652668">,</span>&nbsp;<span class="ident" id="652670">err</span><span class="op" id="652673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652683">if</span>&nbsp;<span class="ident" id="652686">err1</span>&nbsp;<span class="op" id="652691">!=</span>&nbsp;<span class="ident" id="652694">nil</span>&nbsp;<span class="op" id="652698">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652704">fd</span><span class="op" id="652706">.</span><span class="ident" id="652707">Close</span><span class="op" id="652712">(</span><span class="op" id="652713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652719">t</span><span class="op" id="652720">.</span><span class="ident" id="652721">Fatalf</span><span class="op" id="652727">(</span><span class="string" id="652728">&#34;Getwd&nbsp;in&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="652745">,</span>&nbsp;<span class="ident" id="652747">d</span><span class="op" id="652748">,</span>&nbsp;<span class="ident" id="652750">err1</span><span class="op" id="652754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652764">if</span>&nbsp;<span class="ident" id="652767">pwd</span>&nbsp;<span class="op" id="652771">!=</span>&nbsp;<span class="ident" id="652774">d</span>&nbsp;<span class="op" id="652776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652782">fd</span><span class="op" id="652784">.</span><span class="ident" id="652785">Close</span><span class="op" id="652790">(</span><span class="op" id="652791">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652797">t</span><span class="op" id="652798">.</span><span class="ident" id="652799">Fatalf</span><span class="op" id="652805">(</span><span class="string" id="652806">&#34;Getwd&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="652833">,</span>&nbsp;<span class="ident" id="652835">pwd</span><span class="op" id="652838">,</span>&nbsp;<span class="ident" id="652840">d</span><span class="op" id="652841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="652853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652856">fd</span><span class="op" id="652858">.</span><span class="ident" id="652859">Close</span><span class="op" id="652864">(</span><span class="op" id="652865">)</span><br>
<span class="lineno">895</span><span class="op" id="652867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="652870">func</span>&nbsp;<span class="ident" id="652875">TestSeek</span><span class="op" id="652883">(</span><span class="ident" id="652884">t</span>&nbsp;<span class="op" id="652886">*</span><span class="ident" id="652887">testing</span><span class="op" id="652894">.</span><span class="ident" id="652895">T</span><span class="op" id="652896">)</span>&nbsp;<span class="op" id="652898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="652901">f</span>&nbsp;<span class="op" id="652903">:=</span>&nbsp;<span class="ident" id="652906">newFile</span><span class="op" id="652913">(</span><span class="string" id="652914">&#34;TestSeek&#34;</span><span class="op" id="652924">,</span>&nbsp;<span class="ident" id="652926">t</span><span class="op" id="652927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652930">defer</span>&nbsp;<span class="ident" id="652936">Remove</span><span class="op" id="652942">(</span><span class="ident" id="652943">f</span><span class="op" id="652944">.</span><span class="ident" id="652945">Name</span><span class="op" id="652949">(</span><span class="op" id="652950">)</span><span class="op" id="652951">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652954">defer</span>&nbsp;<span class="ident" id="652960">f</span><span class="op" id="652961">.</span><span class="ident" id="652962">Close</span><span class="op" id="652967">(</span><span class="op" id="652968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="652972">const</span>&nbsp;<span class="ident" id="652978">data</span>&nbsp;<span class="op" id="652983">=</span>&nbsp;<span class="string" id="652985">&#34;hello,&nbsp;world\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653003">io</span><span class="op" id="653005">.</span><span class="ident" id="653006">WriteString</span><span class="op" id="653017">(</span><span class="ident" id="653018">f</span><span class="op" id="653019">,</span>&nbsp;<span class="ident" id="653021">data</span><span class="op" id="653025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="653029">type</span>&nbsp;<span class="ident" id="653034">test</span>&nbsp;<span class="keyword" id="653039">struct</span>&nbsp;<span class="op" id="653046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653050">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653057">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653065">whence</span>&nbsp;<span class="builtintype" id="653072">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653078">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653085">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653092">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="653095">var</span>&nbsp;<span class="ident" id="653099">tests</span>&nbsp;<span class="op" id="653105">=</span>&nbsp;<span class="op" id="653107">[</span><span class="op" id="653108">]</span><span class="ident" id="653109">test</span><span class="op" id="653113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653117">{</span><span class="num" id="653118">0</span><span class="op" id="653119">,</span>&nbsp;<span class="num" id="653121">1</span><span class="op" id="653122">,</span>&nbsp;<span class="ident" id="653124">int64</span><span class="op" id="653129">(</span><span class="builtinfunc" id="653130">len</span><span class="op" id="653133">(</span><span class="ident" id="653134">data</span><span class="op" id="653138">)</span><span class="op" id="653139">)</span><span class="op" id="653140">}</span><span class="op" id="653141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653145">{</span><span class="num" id="653146">0</span><span class="op" id="653147">,</span>&nbsp;<span class="num" id="653149">0</span><span class="op" id="653150">,</span>&nbsp;<span class="num" id="653152">0</span><span class="op" id="653153">}</span><span class="op" id="653154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653158">{</span><span class="num" id="653159">5</span><span class="op" id="653160">,</span>&nbsp;<span class="num" id="653162">0</span><span class="op" id="653163">,</span>&nbsp;<span class="num" id="653165">5</span><span class="op" id="653166">}</span><span class="op" id="653167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653171">{</span><span class="num" id="653172">0</span><span class="op" id="653173">,</span>&nbsp;<span class="num" id="653175">2</span><span class="op" id="653176">,</span>&nbsp;<span class="ident" id="653178">int64</span><span class="op" id="653183">(</span><span class="builtinfunc" id="653184">len</span><span class="op" id="653187">(</span><span class="ident" id="653188">data</span><span class="op" id="653192">)</span><span class="op" id="653193">)</span><span class="op" id="653194">}</span><span class="op" id="653195">,</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653199">{</span><span class="num" id="653200">0</span><span class="op" id="653201">,</span>&nbsp;<span class="num" id="653203">0</span><span class="op" id="653204">,</span>&nbsp;<span class="num" id="653206">0</span><span class="op" id="653207">}</span><span class="op" id="653208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653212">{</span><span class="op" id="653213">-</span><span class="num" id="653214">1</span><span class="op" id="653215">,</span>&nbsp;<span class="num" id="653217">2</span><span class="op" id="653218">,</span>&nbsp;<span class="ident" id="653220">int64</span><span class="op" id="653225">(</span><span class="builtinfunc" id="653226">len</span><span class="op" id="653229">(</span><span class="ident" id="653230">data</span><span class="op" id="653234">)</span><span class="op" id="653235">)</span>&nbsp;<span class="op" id="653237">-</span>&nbsp;<span class="num" id="653239">1</span><span class="op" id="653240">}</span><span class="op" id="653241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653245">{</span><span class="num" id="653246">1</span>&nbsp;<span class="op" id="653248">&lt;&lt;</span>&nbsp;<span class="num" id="653251">33</span><span class="op" id="653253">,</span>&nbsp;<span class="num" id="653255">0</span><span class="op" id="653256">,</span>&nbsp;<span class="num" id="653258">1</span>&nbsp;<span class="op" id="653260">&lt;&lt;</span>&nbsp;<span class="num" id="653263">33</span><span class="op" id="653265">}</span><span class="op" id="653266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653270">{</span><span class="num" id="653271">1</span>&nbsp;<span class="op" id="653273">&lt;&lt;</span>&nbsp;<span class="num" id="653276">33</span><span class="op" id="653278">,</span>&nbsp;<span class="num" id="653280">2</span><span class="op" id="653281">,</span>&nbsp;<span class="num" id="653283">1</span><span class="op" id="653284">&lt;&lt;</span><span class="num" id="653286">33</span>&nbsp;<span class="op" id="653289">+</span>&nbsp;<span class="ident" id="653291">int64</span><span class="op" id="653296">(</span><span class="builtinfunc" id="653297">len</span><span class="op" id="653300">(</span><span class="ident" id="653301">data</span><span class="op" id="653305">)</span><span class="op" id="653306">)</span><span class="op" id="653307">}</span><span class="op" id="653308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653311">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="653314">for</span>&nbsp;<span class="ident" id="653318">i</span><span class="op" id="653319">,</span>&nbsp;<span class="ident" id="653321">tt</span>&nbsp;<span class="op" id="653324">:=</span>&nbsp;<span class="keyword" id="653327">range</span>&nbsp;<span class="ident" id="653333">tests</span>&nbsp;<span class="op" id="653339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653343">off</span><span class="op" id="653346">,</span>&nbsp;<span class="ident" id="653348">err</span>&nbsp;<span class="op" id="653352">:=</span>&nbsp;<span class="ident" id="653355">f</span><span class="op" id="653356">.</span><span class="ident" id="653357">Seek</span><span class="op" id="653361">(</span><span class="ident" id="653362">tt</span><span class="op" id="653364">.</span><span class="ident" id="653365">in</span><span class="op" id="653367">,</span>&nbsp;<span class="ident" id="653369">tt</span><span class="op" id="653371">.</span><span class="ident" id="653372">whence</span><span class="op" id="653378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="653382">if</span>&nbsp;<span class="ident" id="653385">off</span>&nbsp;<span class="op" id="653389">!=</span>&nbsp;<span class="ident" id="653392">tt</span><span class="op" id="653394">.</span><span class="ident" id="653395">out</span>&nbsp;<span class="op" id="653399">||</span>&nbsp;<span class="ident" id="653402">err</span>&nbsp;<span class="op" id="653406">!=</span>&nbsp;<span class="ident" id="653409">nil</span>&nbsp;<span class="op" id="653413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="653418">if</span>&nbsp;<span class="ident" id="653421">e</span><span class="op" id="653422">,</span>&nbsp;<span class="ident" id="653424">ok</span>&nbsp;<span class="op" id="653427">:=</span>&nbsp;<span class="ident" id="653430">err</span><span class="op" id="653433">.</span><span class="op" id="653434">(</span><span class="op" id="653435">*</span><span class="ident" id="653436">PathError</span><span class="op" id="653445">)</span><span class="op" id="653446">;</span>&nbsp;<span class="ident" id="653448">ok</span>&nbsp;<span class="op" id="653451">&amp;&amp;</span>&nbsp;<span class="ident" id="653454">e</span><span class="op" id="653455">.</span><span class="ident" id="653456">Err</span>&nbsp;<span class="op" id="653460">==</span>&nbsp;<span class="ident" id="653463">syscall</span><span class="op" id="653470">.</span><span class="ident" id="653471">EINVAL</span>&nbsp;<span class="op" id="653478">&amp;&amp;</span>&nbsp;<span class="ident" id="653481">tt</span><span class="op" id="653483">.</span><span class="ident" id="653484">out</span>&nbsp;<span class="op" id="653488">&gt;</span>&nbsp;<span class="num" id="653490">1</span><span class="op" id="653491">&lt;&lt;</span><span class="num" id="653493">32</span>&nbsp;<span class="op" id="653496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="653502">//&nbsp;Reiserfs&nbsp;rejects&nbsp;the&nbsp;big&nbsp;seeks.</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="653541">//&nbsp;http://code.google.com/p/go/issues/detail?id=91</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="653596">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653610">t</span><span class="op" id="653611">.</span><span class="ident" id="653612">Errorf</span><span class="op" id="653618">(</span><span class="string" id="653619">&#34;#%d:&nbsp;Seek(%v,&nbsp;%v)&nbsp;=&nbsp;%v,&nbsp;%v&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="653660">,</span>&nbsp;<span class="ident" id="653662">i</span><span class="op" id="653663">,</span>&nbsp;<span class="ident" id="653665">tt</span><span class="op" id="653667">.</span><span class="ident" id="653668">in</span><span class="op" id="653670">,</span>&nbsp;<span class="ident" id="653672">tt</span><span class="op" id="653674">.</span><span class="ident" id="653675">whence</span><span class="op" id="653681">,</span>&nbsp;<span class="ident" id="653683">off</span><span class="op" id="653686">,</span>&nbsp;<span class="ident" id="653688">err</span><span class="op" id="653691">,</span>&nbsp;<span class="ident" id="653693">tt</span><span class="op" id="653695">.</span><span class="ident" id="653696">out</span><span class="op" id="653699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653703">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653706">}</span><br>
<span class="lineno"></span><span class="op" id="653708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="653711">type</span>&nbsp;<span class="ident" id="653716">openErrorTest</span>&nbsp;<span class="keyword" id="653730">struct</span>&nbsp;<span class="op" id="653737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653740">path</span>&nbsp;&nbsp;<span class="builtintype" id="653746">string</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653754">mode</span>&nbsp;&nbsp;<span class="builtintype" id="653760">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="653765">error</span>&nbsp;<span class="builtintype" id="653771">error</span><br>
<span class="lineno"></span><span class="op" id="653777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="653780">var</span>&nbsp;<span class="ident" id="653784">openErrorTests</span>&nbsp;<span class="op" id="653799">=</span>&nbsp;<span class="op" id="653801">[</span><span class="op" id="653802">]</span><span class="ident" id="653803">openErrorTest</span><span class="op" id="653816">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653823">sfdir</span>&nbsp;<span class="op" id="653829">+</span>&nbsp;<span class="string" id="653831">&#34;/no-such-file&#34;</span><span class="op" id="653846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653850">O_RDONLY</span><span class="op" id="653858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653862">syscall</span><span class="op" id="653869">.</span><span class="ident" id="653870">ENOENT</span><span class="op" id="653876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653879">}</span><span class="op" id="653880">,</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653887">sfdir</span><span class="op" id="653892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653896">O_WRONLY</span><span class="op" id="653904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653908">syscall</span><span class="op" id="653915">.</span><span class="ident" id="653916">EISDIR</span><span class="op" id="653922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653925">}</span><span class="op" id="653926">,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="653929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653933">sfdir</span>&nbsp;<span class="op" id="653939">+</span>&nbsp;<span class="string" id="653941">&#34;/&#34;</span>&nbsp;<span class="op" id="653945">+</span>&nbsp;<span class="ident" id="653947">sfname</span>&nbsp;<span class="op" id="653954">+</span>&nbsp;<span class="string" id="653956">&#34;/no-such-file&#34;</span><span class="op" id="653971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653975">O_WRONLY</span><span class="op" id="653983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="653987">syscall</span><span class="op" id="653994">.</span><span class="ident" id="653995">ENOTDIR</span><span class="op" id="654002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="654005">}</span><span class="op" id="654006">,</span><br>
<span class="lineno">955</span><span class="op" id="654008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="654011">func</span>&nbsp;<span class="ident" id="654016">TestOpenError</span><span class="op" id="654029">(</span><span class="ident" id="654030">t</span>&nbsp;<span class="op" id="654032">*</span><span class="ident" id="654033">testing</span><span class="op" id="654040">.</span><span class="ident" id="654041">T</span><span class="op" id="654042">)</span>&nbsp;<span class="op" id="654044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654047">for</span>&nbsp;<span class="ident" id="654051">_</span><span class="op" id="654052">,</span>&nbsp;<span class="ident" id="654054">tt</span>&nbsp;<span class="op" id="654057">:=</span>&nbsp;<span class="keyword" id="654060">range</span>&nbsp;<span class="ident" id="654066">openErrorTests</span>&nbsp;<span class="op" id="654081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654085">f</span><span class="op" id="654086">,</span>&nbsp;<span class="ident" id="654088">err</span>&nbsp;<span class="op" id="654092">:=</span>&nbsp;<span class="ident" id="654095">OpenFile</span><span class="op" id="654103">(</span><span class="ident" id="654104">tt</span><span class="op" id="654106">.</span><span class="ident" id="654107">path</span><span class="op" id="654111">,</span>&nbsp;<span class="ident" id="654113">tt</span><span class="op" id="654115">.</span><span class="ident" id="654116">mode</span><span class="op" id="654120">,</span>&nbsp;<span class="num" id="654122">0</span><span class="op" id="654123">)</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654127">if</span>&nbsp;<span class="ident" id="654130">err</span>&nbsp;<span class="op" id="654134">==</span>&nbsp;<span class="ident" id="654137">nil</span>&nbsp;<span class="op" id="654141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654146">t</span><span class="op" id="654147">.</span><span class="ident" id="654148">Errorf</span><span class="op" id="654154">(</span><span class="string" id="654155">&#34;Open(%q,&nbsp;%d)&nbsp;succeeded&#34;</span><span class="op" id="654179">,</span>&nbsp;<span class="ident" id="654181">tt</span><span class="op" id="654183">.</span><span class="ident" id="654184">path</span><span class="op" id="654188">,</span>&nbsp;<span class="ident" id="654190">tt</span><span class="op" id="654192">.</span><span class="ident" id="654193">mode</span><span class="op" id="654197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654202">f</span><span class="op" id="654203">.</span><span class="ident" id="654204">Close</span><span class="op" id="654209">(</span><span class="op" id="654210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654215">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="654226">}</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654230">perr</span><span class="op" id="654234">,</span>&nbsp;<span class="ident" id="654236">ok</span>&nbsp;<span class="op" id="654239">:=</span>&nbsp;<span class="ident" id="654242">err</span><span class="op" id="654245">.</span><span class="op" id="654246">(</span><span class="op" id="654247">*</span><span class="ident" id="654248">PathError</span><span class="op" id="654257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654261">if</span>&nbsp;<span class="op" id="654264">!</span><span class="ident" id="654265">ok</span>&nbsp;<span class="op" id="654268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654273">t</span><span class="op" id="654274">.</span><span class="ident" id="654275">Errorf</span><span class="op" id="654281">(</span><span class="string" id="654282">&#34;Open(%q,&nbsp;%d)&nbsp;returns&nbsp;error&nbsp;of&nbsp;%T&nbsp;type;&nbsp;want&nbsp;*PathError&#34;</span><span class="op" id="654338">,</span>&nbsp;<span class="ident" id="654340">tt</span><span class="op" id="654342">.</span><span class="ident" id="654343">path</span><span class="op" id="654347">,</span>&nbsp;<span class="ident" id="654349">tt</span><span class="op" id="654351">.</span><span class="ident" id="654352">mode</span><span class="op" id="654356">,</span>&nbsp;<span class="ident" id="654358">err</span><span class="op" id="654361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="654365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654369">if</span>&nbsp;<span class="ident" id="654372">perr</span><span class="op" id="654376">.</span><span class="ident" id="654377">Err</span>&nbsp;<span class="op" id="654381">!=</span>&nbsp;<span class="ident" id="654384">tt</span><span class="op" id="654386">.</span><span class="builtintype" id="654387">error</span>&nbsp;<span class="op" id="654393">{</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654398">if</span>&nbsp;<span class="ident" id="654401">runtime</span><span class="op" id="654408">.</span><span class="ident" id="654409">GOOS</span>&nbsp;<span class="op" id="654414">==</span>&nbsp;<span class="string" id="654417">&#34;plan9&#34;</span>&nbsp;<span class="op" id="654425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654431">syscallErrStr</span>&nbsp;<span class="op" id="654445">:=</span>&nbsp;<span class="ident" id="654448">perr</span><span class="op" id="654452">.</span><span class="ident" id="654453">Err</span><span class="op" id="654456">.</span><span class="ident" id="654457">Error</span><span class="op" id="654462">(</span><span class="op" id="654463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654469">expectedErrStr</span>&nbsp;<span class="op" id="654484">:=</span>&nbsp;<span class="ident" id="654487">strings</span><span class="op" id="654494">.</span><span class="ident" id="654495">Replace</span><span class="op" id="654502">(</span><span class="ident" id="654503">tt</span><span class="op" id="654505">.</span><span class="builtintype" id="654506">error</span><span class="op" id="654511">.</span><span class="ident" id="654512">Error</span><span class="op" id="654517">(</span><span class="op" id="654518">)</span><span class="op" id="654519">,</span>&nbsp;<span class="string" id="654521">&#34;file&nbsp;&#34;</span><span class="op" id="654528">,</span>&nbsp;<span class="string" id="654530">&#34;&#34;</span><span class="op" id="654532">,</span>&nbsp;<span class="num" id="654534">1</span><span class="op" id="654535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654541">if</span>&nbsp;<span class="op" id="654544">!</span><span class="ident" id="654545">strings</span><span class="op" id="654552">.</span><span class="ident" id="654553">HasSuffix</span><span class="op" id="654562">(</span><span class="ident" id="654563">syscallErrStr</span><span class="op" id="654576">,</span>&nbsp;<span class="ident" id="654578">expectedErrStr</span><span class="op" id="654592">)</span>&nbsp;<span class="op" id="654594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="654601">//&nbsp;Some&nbsp;Plan&nbsp;9&nbsp;file&nbsp;servers&nbsp;incorrectly&nbsp;return</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="654653">//&nbsp;EACCES&nbsp;rather&nbsp;than&nbsp;EISDIR&nbsp;when&nbsp;a&nbsp;directory&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="654707">//&nbsp;opened&nbsp;for&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654733">if</span>&nbsp;<span class="ident" id="654736">tt</span><span class="op" id="654738">.</span><span class="builtintype" id="654739">error</span>&nbsp;<span class="op" id="654745">==</span>&nbsp;<span class="ident" id="654748">syscall</span><span class="op" id="654755">.</span><span class="ident" id="654756">EISDIR</span>&nbsp;<span class="op" id="654763">&amp;&amp;</span>&nbsp;<span class="ident" id="654766">strings</span><span class="op" id="654773">.</span><span class="ident" id="654774">HasSuffix</span><span class="op" id="654783">(</span><span class="ident" id="654784">syscallErrStr</span><span class="op" id="654797">,</span>&nbsp;<span class="ident" id="654799">syscall</span><span class="op" id="654806">.</span><span class="ident" id="654807">EACCES</span><span class="op" id="654813">.</span><span class="ident" id="654814">Error</span><span class="op" id="654819">(</span><span class="op" id="654820">)</span><span class="op" id="654821">)</span>&nbsp;<span class="op" id="654823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654831">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="654845">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="654852">t</span><span class="op" id="654853">.</span><span class="ident" id="654854">Errorf</span><span class="op" id="654860">(</span><span class="string" id="654861">&#34;Open(%q,&nbsp;%d)&nbsp;=&nbsp;_,&nbsp;%q;&nbsp;want&nbsp;suffix&nbsp;%q&#34;</span><span class="op" id="654899">,</span>&nbsp;<span class="ident" id="654901">tt</span><span class="op" id="654903">.</span><span class="ident" id="654904">path</span><span class="op" id="654908">,</span>&nbsp;<span class="ident" id="654910">tt</span><span class="op" id="654912">.</span><span class="ident" id="654913">mode</span><span class="op" id="654917">,</span>&nbsp;<span class="ident" id="654919">syscallErrStr</span><span class="op" id="654932">,</span>&nbsp;<span class="ident" id="654934">expectedErrStr</span><span class="op" id="654948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="654954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654960">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="654972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="654977">if</span>&nbsp;<span class="ident" id="654980">runtime</span><span class="op" id="654987">.</span><span class="ident" id="654988">GOOS</span>&nbsp;<span class="op" id="654993">==</span>&nbsp;<span class="string" id="654996">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="655008">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="655014">//&nbsp;DragonFly&nbsp;incorrectly&nbsp;returns&nbsp;EACCES&nbsp;rather</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="655065">//&nbsp;EISDIR&nbsp;when&nbsp;a&nbsp;directory&nbsp;is&nbsp;opened&nbsp;for&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655117">if</span>&nbsp;<span class="ident" id="655120">tt</span><span class="op" id="655122">.</span><span class="builtintype" id="655123">error</span>&nbsp;<span class="op" id="655129">==</span>&nbsp;<span class="ident" id="655132">syscall</span><span class="op" id="655139">.</span><span class="ident" id="655140">EISDIR</span>&nbsp;<span class="op" id="655147">&amp;&amp;</span>&nbsp;<span class="ident" id="655150">perr</span><span class="op" id="655154">.</span><span class="ident" id="655155">Err</span>&nbsp;<span class="op" id="655159">==</span>&nbsp;<span class="ident" id="655162">syscall</span><span class="op" id="655169">.</span><span class="ident" id="655170">EACCES</span>&nbsp;<span class="op" id="655177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655184">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655197">}</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655207">t</span><span class="op" id="655208">.</span><span class="ident" id="655209">Errorf</span><span class="op" id="655215">(</span><span class="string" id="655216">&#34;Open(%q,&nbsp;%d)&nbsp;=&nbsp;_,&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="655247">,</span>&nbsp;<span class="ident" id="655249">tt</span><span class="op" id="655251">.</span><span class="ident" id="655252">path</span><span class="op" id="655256">,</span>&nbsp;<span class="ident" id="655258">tt</span><span class="op" id="655260">.</span><span class="ident" id="655261">mode</span><span class="op" id="655265">,</span>&nbsp;<span class="ident" id="655267">perr</span><span class="op" id="655271">.</span><span class="ident" id="655272">Err</span><span class="op" id="655275">.</span><span class="ident" id="655276">Error</span><span class="op" id="655281">(</span><span class="op" id="655282">)</span><span class="op" id="655283">,</span>&nbsp;<span class="ident" id="655285">tt</span><span class="op" id="655287">.</span><span class="builtintype" id="655288">error</span><span class="op" id="655293">.</span><span class="ident" id="655294">Error</span><span class="op" id="655299">(</span><span class="op" id="655300">)</span><span class="op" id="655301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655308">}</span><br>
<span class="lineno"></span><span class="op" id="655310">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="keyword" id="655313">func</span>&nbsp;<span class="ident" id="655318">TestOpenNoName</span><span class="op" id="655332">(</span><span class="ident" id="655333">t</span>&nbsp;<span class="op" id="655335">*</span><span class="ident" id="655336">testing</span><span class="op" id="655343">.</span><span class="ident" id="655344">T</span><span class="op" id="655345">)</span>&nbsp;<span class="op" id="655347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655350">f</span><span class="op" id="655351">,</span>&nbsp;<span class="ident" id="655353">err</span>&nbsp;<span class="op" id="655357">:=</span>&nbsp;<span class="ident" id="655360">Open</span><span class="op" id="655364">(</span><span class="string" id="655365">&#34;&#34;</span><span class="op" id="655367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655370">if</span>&nbsp;<span class="ident" id="655373">err</span>&nbsp;<span class="op" id="655377">==</span>&nbsp;<span class="ident" id="655380">nil</span>&nbsp;<span class="op" id="655384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655388">t</span><span class="op" id="655389">.</span><span class="ident" id="655390">Fatal</span><span class="op" id="655395">(</span><span class="string" id="655396">`Open(&#34;&#34;)&nbsp;succeeded`</span><span class="op" id="655416">)</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655420">f</span><span class="op" id="655421">.</span><span class="ident" id="655422">Close</span><span class="op" id="655427">(</span><span class="op" id="655428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655431">}</span><br>
<span class="lineno"></span><span class="op" id="655433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="655436">func</span>&nbsp;<span class="ident" id="655441">run</span><span class="op" id="655444">(</span><span class="ident" id="655445">t</span>&nbsp;<span class="op" id="655447">*</span><span class="ident" id="655448">testing</span><span class="op" id="655455">.</span><span class="ident" id="655456">T</span><span class="op" id="655457">,</span>&nbsp;<span class="ident" id="655459">cmd</span>&nbsp;<span class="op" id="655463">[</span><span class="op" id="655464">]</span><span class="builtintype" id="655465">string</span><span class="op" id="655471">)</span>&nbsp;<span class="builtintype" id="655473">string</span>&nbsp;<span class="op" id="655480">{</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="655483">//&nbsp;Run&nbsp;/bin/hostname&nbsp;and&nbsp;collect&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655525">r</span><span class="op" id="655526">,</span>&nbsp;<span class="ident" id="655528">w</span><span class="op" id="655529">,</span>&nbsp;<span class="ident" id="655531">err</span>&nbsp;<span class="op" id="655535">:=</span>&nbsp;<span class="ident" id="655538">Pipe</span><span class="op" id="655542">(</span><span class="op" id="655543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655546">if</span>&nbsp;<span class="ident" id="655549">err</span>&nbsp;<span class="op" id="655553">!=</span>&nbsp;<span class="ident" id="655556">nil</span>&nbsp;<span class="op" id="655560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655564">t</span><span class="op" id="655565">.</span><span class="ident" id="655566">Fatal</span><span class="op" id="655571">(</span><span class="ident" id="655572">err</span><span class="op" id="655575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655578">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655581">defer</span>&nbsp;<span class="ident" id="655587">r</span><span class="op" id="655588">.</span><span class="ident" id="655589">Close</span><span class="op" id="655594">(</span><span class="op" id="655595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655598">p</span><span class="op" id="655599">,</span>&nbsp;<span class="ident" id="655601">err</span>&nbsp;<span class="op" id="655605">:=</span>&nbsp;<span class="ident" id="655608">StartProcess</span><span class="op" id="655620">(</span><span class="string" id="655621">&#34;/bin/hostname&#34;</span><span class="op" id="655636">,</span>&nbsp;<span class="op" id="655638">[</span><span class="op" id="655639">]</span><span class="builtintype" id="655640">string</span><span class="op" id="655646">{</span><span class="string" id="655647">&#34;hostname&#34;</span><span class="op" id="655657">}</span><span class="op" id="655658">,</span>&nbsp;<span class="op" id="655660">&amp;</span><span class="ident" id="655661">ProcAttr</span><span class="op" id="655669">{</span><span class="ident" id="655670">Files</span><span class="op" id="655675">:</span>&nbsp;<span class="op" id="655677">[</span><span class="op" id="655678">]</span><span class="op" id="655679">*</span><span class="ident" id="655680">File</span><span class="op" id="655684">{</span><span class="ident" id="655685">nil</span><span class="op" id="655688">,</span>&nbsp;<span class="ident" id="655690">w</span><span class="op" id="655691">,</span>&nbsp;<span class="ident" id="655693">Stderr</span><span class="op" id="655699">}</span><span class="op" id="655700">}</span><span class="op" id="655701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655704">if</span>&nbsp;<span class="ident" id="655707">err</span>&nbsp;<span class="op" id="655711">!=</span>&nbsp;<span class="ident" id="655714">nil</span>&nbsp;<span class="op" id="655718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655722">t</span><span class="op" id="655723">.</span><span class="ident" id="655724">Fatal</span><span class="op" id="655729">(</span><span class="ident" id="655730">err</span><span class="op" id="655733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655736">}</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655739">w</span><span class="op" id="655740">.</span><span class="ident" id="655741">Close</span><span class="op" id="655746">(</span><span class="op" id="655747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655751">var</span>&nbsp;<span class="ident" id="655755">b</span>&nbsp;<span class="ident" id="655757">bytes</span><span class="op" id="655762">.</span><span class="ident" id="655763">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655771">io</span><span class="op" id="655773">.</span><span class="ident" id="655774">Copy</span><span class="op" id="655778">(</span><span class="op" id="655779">&amp;</span><span class="ident" id="655780">b</span><span class="op" id="655781">,</span>&nbsp;<span class="ident" id="655783">r</span><span class="op" id="655784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655787">_</span><span class="op" id="655788">,</span>&nbsp;<span class="ident" id="655790">err</span>&nbsp;<span class="op" id="655794">=</span>&nbsp;<span class="ident" id="655796">p</span><span class="op" id="655797">.</span><span class="ident" id="655798">Wait</span><span class="op" id="655802">(</span><span class="op" id="655803">)</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655806">if</span>&nbsp;<span class="ident" id="655809">err</span>&nbsp;<span class="op" id="655813">!=</span>&nbsp;<span class="ident" id="655816">nil</span>&nbsp;<span class="op" id="655820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655824">t</span><span class="op" id="655825">.</span><span class="ident" id="655826">Fatalf</span><span class="op" id="655832">(</span><span class="string" id="655833">&#34;run&nbsp;hostname&nbsp;Wait:&nbsp;%v&#34;</span><span class="op" id="655856">,</span>&nbsp;<span class="ident" id="655858">err</span><span class="op" id="655861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655867">err</span>&nbsp;<span class="op" id="655871">=</span>&nbsp;<span class="ident" id="655873">p</span><span class="op" id="655874">.</span><span class="ident" id="655875">Kill</span><span class="op" id="655879">(</span><span class="op" id="655880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655883">if</span>&nbsp;<span class="ident" id="655886">err</span>&nbsp;<span class="op" id="655890">==</span>&nbsp;<span class="ident" id="655893">nil</span>&nbsp;<span class="op" id="655897">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655901">t</span><span class="op" id="655902">.</span><span class="ident" id="655903">Errorf</span><span class="op" id="655909">(</span><span class="string" id="655910">&#34;expected&nbsp;an&nbsp;error&nbsp;from&nbsp;Kill&nbsp;running&nbsp;&#39;hostname&#39;&#34;</span><span class="op" id="655958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="655961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="655964">output</span>&nbsp;<span class="op" id="655971">:=</span>&nbsp;<span class="ident" id="655974">b</span><span class="op" id="655975">.</span><span class="ident" id="655976">String</span><span class="op" id="655982">(</span><span class="op" id="655983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="655986">if</span>&nbsp;<span class="ident" id="655989">n</span>&nbsp;<span class="op" id="655991">:=</span>&nbsp;<span class="builtinfunc" id="655994">len</span><span class="op" id="655997">(</span><span class="ident" id="655998">output</span><span class="op" id="656004">)</span><span class="op" id="656005">;</span>&nbsp;<span class="ident" id="656007">n</span>&nbsp;<span class="op" id="656009">&gt;</span>&nbsp;<span class="num" id="656011">0</span>&nbsp;<span class="op" id="656013">&amp;&amp;</span>&nbsp;<span class="ident" id="656016">output</span><span class="op" id="656022">[</span><span class="ident" id="656023">n</span><span class="op" id="656024">-</span><span class="num" id="656025">1</span><span class="op" id="656026">]</span>&nbsp;<span class="op" id="656028">==</span>&nbsp;<span class="string" id="656031">&#39;\n&#39;</span>&nbsp;<span class="op" id="656036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656040">output</span>&nbsp;<span class="op" id="656047">=</span>&nbsp;<span class="ident" id="656049">output</span><span class="op" id="656055">[</span><span class="num" id="656056">0</span>&nbsp;<span class="op" id="656058">:</span>&nbsp;<span class="ident" id="656060">n</span><span class="op" id="656061">-</span><span class="num" id="656062">1</span><span class="op" id="656063">]</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="656066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656069">if</span>&nbsp;<span class="ident" id="656072">output</span>&nbsp;<span class="op" id="656079">==</span>&nbsp;<span class="string" id="656082">&#34;&#34;</span>&nbsp;<span class="op" id="656085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656089">t</span><span class="op" id="656090">.</span><span class="ident" id="656091">Fatalf</span><span class="op" id="656097">(</span><span class="string" id="656098">&#34;%v&nbsp;produced&nbsp;no&nbsp;output&#34;</span><span class="op" id="656121">,</span>&nbsp;<span class="ident" id="656123">cmd</span><span class="op" id="656126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="656129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656133">return</span>&nbsp;<span class="ident" id="656140">output</span><br>
<span class="lineno"></span><span class="op" id="656147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="656150">func</span>&nbsp;<span class="ident" id="656155">TestHostname</span><span class="op" id="656167">(</span><span class="ident" id="656168">t</span>&nbsp;<span class="op" id="656170">*</span><span class="ident" id="656171">testing</span><span class="op" id="656178">.</span><span class="ident" id="656179">T</span><span class="op" id="656180">)</span>&nbsp;<span class="op" id="656182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="656185">//&nbsp;There&nbsp;is&nbsp;no&nbsp;other&nbsp;way&nbsp;to&nbsp;fetch&nbsp;hostname&nbsp;on&nbsp;windows,&nbsp;but&nbsp;via&nbsp;winapi.</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="656257">//&nbsp;On&nbsp;Plan&nbsp;9&nbsp;it&nbsp;can&nbsp;be&nbsp;taken&nbsp;from&nbsp;#c/sysname&nbsp;as&nbsp;Hostname()&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656323">switch</span>&nbsp;<span class="ident" id="656330">runtime</span><span class="op" id="656337">.</span><span class="ident" id="656338">GOOS</span>&nbsp;<span class="op" id="656343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656346">case</span>&nbsp;<span class="string" id="656351">&#34;android&#34;</span><span class="op" id="656360">,</span>&nbsp;<span class="string" id="656362">&#34;nacl&#34;</span><span class="op" id="656368">,</span>&nbsp;<span class="string" id="656370">&#34;plan9&#34;</span><span class="op" id="656377">,</span>&nbsp;<span class="string" id="656379">&#34;windows&#34;</span><span class="op" id="656388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656392">t</span><span class="op" id="656393">.</span><span class="ident" id="656394">Skipf</span><span class="op" id="656399">(</span><span class="string" id="656400">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="656416">,</span>&nbsp;<span class="ident" id="656418">runtime</span><span class="op" id="656425">.</span><span class="ident" id="656426">GOOS</span><span class="op" id="656430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="656433">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="656437">//&nbsp;Check&nbsp;internal&nbsp;Hostname()&nbsp;against&nbsp;the&nbsp;output&nbsp;of&nbsp;/bin/hostname.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="656504">//&nbsp;Allow&nbsp;that&nbsp;the&nbsp;internal&nbsp;Hostname&nbsp;returns&nbsp;a&nbsp;Fully&nbsp;Qualified&nbsp;Domain&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="656579">//&nbsp;and&nbsp;the&nbsp;/bin/hostname&nbsp;only&nbsp;returns&nbsp;the&nbsp;first&nbsp;component</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656638">hostname</span><span class="op" id="656646">,</span>&nbsp;<span class="ident" id="656648">err</span>&nbsp;<span class="op" id="656652">:=</span>&nbsp;<span class="ident" id="656655">Hostname</span><span class="op" id="656663">(</span><span class="op" id="656664">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656667">if</span>&nbsp;<span class="ident" id="656670">err</span>&nbsp;<span class="op" id="656674">!=</span>&nbsp;<span class="ident" id="656677">nil</span>&nbsp;<span class="op" id="656681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656685">t</span><span class="op" id="656686">.</span><span class="ident" id="656687">Fatalf</span><span class="op" id="656693">(</span><span class="string" id="656694">&#34;%v&#34;</span><span class="op" id="656698">,</span>&nbsp;<span class="ident" id="656700">err</span><span class="op" id="656703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="656706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656709">want</span>&nbsp;<span class="op" id="656714">:=</span>&nbsp;<span class="ident" id="656717">run</span><span class="op" id="656720">(</span><span class="ident" id="656721">t</span><span class="op" id="656722">,</span>&nbsp;<span class="op" id="656724">[</span><span class="op" id="656725">]</span><span class="builtintype" id="656726">string</span><span class="op" id="656732">{</span><span class="string" id="656733">&#34;/bin/hostname&#34;</span><span class="op" id="656748">}</span><span class="op" id="656749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656752">if</span>&nbsp;<span class="ident" id="656755">hostname</span>&nbsp;<span class="op" id="656764">!=</span>&nbsp;<span class="ident" id="656767">want</span>&nbsp;<span class="op" id="656772">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656776">i</span>&nbsp;<span class="op" id="656778">:=</span>&nbsp;<span class="ident" id="656781">strings</span><span class="op" id="656788">.</span><span class="ident" id="656789">Index</span><span class="op" id="656794">(</span><span class="ident" id="656795">hostname</span><span class="op" id="656803">,</span>&nbsp;<span class="string" id="656805">&#34;.&#34;</span><span class="op" id="656808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656812">if</span>&nbsp;<span class="ident" id="656815">i</span>&nbsp;<span class="op" id="656817">&lt;</span>&nbsp;<span class="num" id="656819">0</span>&nbsp;<span class="op" id="656821">||</span>&nbsp;<span class="ident" id="656824">hostname</span><span class="op" id="656832">[</span><span class="num" id="656833">0</span><span class="op" id="656834">:</span><span class="ident" id="656835">i</span><span class="op" id="656836">]</span>&nbsp;<span class="op" id="656838">!=</span>&nbsp;<span class="ident" id="656841">want</span>&nbsp;<span class="op" id="656846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656851">t</span><span class="op" id="656852">.</span><span class="ident" id="656853">Errorf</span><span class="op" id="656859">(</span><span class="string" id="656860">&#34;Hostname()&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="656886">,</span>&nbsp;<span class="ident" id="656888">hostname</span><span class="op" id="656896">,</span>&nbsp;<span class="ident" id="656898">want</span><span class="op" id="656902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="656906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="656909">}</span><br>
<span class="lineno">1060</span><span class="op" id="656911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="656914">func</span>&nbsp;<span class="ident" id="656919">TestReadAt</span><span class="op" id="656929">(</span><span class="ident" id="656930">t</span>&nbsp;<span class="op" id="656932">*</span><span class="ident" id="656933">testing</span><span class="op" id="656940">.</span><span class="ident" id="656941">T</span><span class="op" id="656942">)</span>&nbsp;<span class="op" id="656944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="656947">f</span>&nbsp;<span class="op" id="656949">:=</span>&nbsp;<span class="ident" id="656952">newFile</span><span class="op" id="656959">(</span><span class="string" id="656960">&#34;TestReadAt&#34;</span><span class="op" id="656972">,</span>&nbsp;<span class="ident" id="656974">t</span><span class="op" id="656975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="656978">defer</span>&nbsp;<span class="ident" id="656984">Remove</span><span class="op" id="656990">(</span><span class="ident" id="656991">f</span><span class="op" id="656992">.</span><span class="ident" id="656993">Name</span><span class="op" id="656997">(</span><span class="op" id="656998">)</span><span class="op" id="656999">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657002">defer</span>&nbsp;<span class="ident" id="657008">f</span><span class="op" id="657009">.</span><span class="ident" id="657010">Close</span><span class="op" id="657015">(</span><span class="op" id="657016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657020">const</span>&nbsp;<span class="ident" id="657026">data</span>&nbsp;<span class="op" id="657031">=</span>&nbsp;<span class="string" id="657033">&#34;hello,&nbsp;world\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657051">io</span><span class="op" id="657053">.</span><span class="ident" id="657054">WriteString</span><span class="op" id="657065">(</span><span class="ident" id="657066">f</span><span class="op" id="657067">,</span>&nbsp;<span class="ident" id="657069">data</span><span class="op" id="657073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657077">b</span>&nbsp;<span class="op" id="657079">:=</span>&nbsp;<span class="builtinfunc" id="657082">make</span><span class="op" id="657086">(</span><span class="op" id="657087">[</span><span class="op" id="657088">]</span><span class="builtintype" id="657089">byte</span><span class="op" id="657093">,</span>&nbsp;<span class="num" id="657095">5</span><span class="op" id="657096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657099">n</span><span class="op" id="657100">,</span>&nbsp;<span class="ident" id="657102">err</span>&nbsp;<span class="op" id="657106">:=</span>&nbsp;<span class="ident" id="657109">f</span><span class="op" id="657110">.</span><span class="ident" id="657111">ReadAt</span><span class="op" id="657117">(</span><span class="ident" id="657118">b</span><span class="op" id="657119">,</span>&nbsp;<span class="num" id="657121">7</span><span class="op" id="657122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657125">if</span>&nbsp;<span class="ident" id="657128">err</span>&nbsp;<span class="op" id="657132">!=</span>&nbsp;<span class="ident" id="657135">nil</span>&nbsp;<span class="op" id="657139">||</span>&nbsp;<span class="ident" id="657142">n</span>&nbsp;<span class="op" id="657144">!=</span>&nbsp;<span class="builtinfunc" id="657147">len</span><span class="op" id="657150">(</span><span class="ident" id="657151">b</span><span class="op" id="657152">)</span>&nbsp;<span class="op" id="657154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657158">t</span><span class="op" id="657159">.</span><span class="ident" id="657160">Fatalf</span><span class="op" id="657166">(</span><span class="string" id="657167">&#34;ReadAt&nbsp;7:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="657185">,</span>&nbsp;<span class="ident" id="657187">n</span><span class="op" id="657188">,</span>&nbsp;<span class="ident" id="657190">err</span><span class="op" id="657193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="657196">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657199">if</span>&nbsp;<span class="builtintype" id="657202">string</span><span class="op" id="657208">(</span><span class="ident" id="657209">b</span><span class="op" id="657210">)</span>&nbsp;<span class="op" id="657212">!=</span>&nbsp;<span class="string" id="657215">&#34;world&#34;</span>&nbsp;<span class="op" id="657223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657227">t</span><span class="op" id="657228">.</span><span class="ident" id="657229">Fatalf</span><span class="op" id="657235">(</span><span class="string" id="657236">&#34;ReadAt&nbsp;7:&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="657263">,</span>&nbsp;<span class="builtintype" id="657265">string</span><span class="op" id="657271">(</span><span class="ident" id="657272">b</span><span class="op" id="657273">)</span><span class="op" id="657274">,</span>&nbsp;<span class="string" id="657276">&#34;world&#34;</span><span class="op" id="657283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="657286">}</span><br>
<span class="lineno"></span><span class="op" id="657288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1080</span><span class="keyword" id="657291">func</span>&nbsp;<span class="ident" id="657296">TestWriteAt</span><span class="op" id="657307">(</span><span class="ident" id="657308">t</span>&nbsp;<span class="op" id="657310">*</span><span class="ident" id="657311">testing</span><span class="op" id="657318">.</span><span class="ident" id="657319">T</span><span class="op" id="657320">)</span>&nbsp;<span class="op" id="657322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657325">f</span>&nbsp;<span class="op" id="657327">:=</span>&nbsp;<span class="ident" id="657330">newFile</span><span class="op" id="657337">(</span><span class="string" id="657338">&#34;TestWriteAt&#34;</span><span class="op" id="657351">,</span>&nbsp;<span class="ident" id="657353">t</span><span class="op" id="657354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657357">defer</span>&nbsp;<span class="ident" id="657363">Remove</span><span class="op" id="657369">(</span><span class="ident" id="657370">f</span><span class="op" id="657371">.</span><span class="ident" id="657372">Name</span><span class="op" id="657376">(</span><span class="op" id="657377">)</span><span class="op" id="657378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657381">defer</span>&nbsp;<span class="ident" id="657387">f</span><span class="op" id="657388">.</span><span class="ident" id="657389">Close</span><span class="op" id="657394">(</span><span class="op" id="657395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657399">const</span>&nbsp;<span class="ident" id="657405">data</span>&nbsp;<span class="op" id="657410">=</span>&nbsp;<span class="string" id="657412">&#34;hello,&nbsp;world\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657430">io</span><span class="op" id="657432">.</span><span class="ident" id="657433">WriteString</span><span class="op" id="657444">(</span><span class="ident" id="657445">f</span><span class="op" id="657446">,</span>&nbsp;<span class="ident" id="657448">data</span><span class="op" id="657452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657456">n</span><span class="op" id="657457">,</span>&nbsp;<span class="ident" id="657459">err</span>&nbsp;<span class="op" id="657463">:=</span>&nbsp;<span class="ident" id="657466">f</span><span class="op" id="657467">.</span><span class="ident" id="657468">WriteAt</span><span class="op" id="657475">(</span><span class="op" id="657476">[</span><span class="op" id="657477">]</span><span class="builtintype" id="657478">byte</span><span class="op" id="657482">(</span><span class="string" id="657483">&#34;WORLD&#34;</span><span class="op" id="657490">)</span><span class="op" id="657491">,</span>&nbsp;<span class="num" id="657493">7</span><span class="op" id="657494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657497">if</span>&nbsp;<span class="ident" id="657500">err</span>&nbsp;<span class="op" id="657504">!=</span>&nbsp;<span class="ident" id="657507">nil</span>&nbsp;<span class="op" id="657511">||</span>&nbsp;<span class="ident" id="657514">n</span>&nbsp;<span class="op" id="657516">!=</span>&nbsp;<span class="num" id="657519">5</span>&nbsp;<span class="op" id="657521">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657525">t</span><span class="op" id="657526">.</span><span class="ident" id="657527">Fatalf</span><span class="op" id="657533">(</span><span class="string" id="657534">&#34;WriteAt&nbsp;7:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="657553">,</span>&nbsp;<span class="ident" id="657555">n</span><span class="op" id="657556">,</span>&nbsp;<span class="ident" id="657558">err</span><span class="op" id="657561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="657564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657568">b</span><span class="op" id="657569">,</span>&nbsp;<span class="ident" id="657571">err</span>&nbsp;<span class="op" id="657575">:=</span>&nbsp;<span class="ident" id="657578">ioutil</span><span class="op" id="657584">.</span><span class="ident" id="657585">ReadFile</span><span class="op" id="657593">(</span><span class="ident" id="657594">f</span><span class="op" id="657595">.</span><span class="ident" id="657596">Name</span><span class="op" id="657600">(</span><span class="op" id="657601">)</span><span class="op" id="657602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657605">if</span>&nbsp;<span class="ident" id="657608">err</span>&nbsp;<span class="op" id="657612">!=</span>&nbsp;<span class="ident" id="657615">nil</span>&nbsp;<span class="op" id="657619">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657623">t</span><span class="op" id="657624">.</span><span class="ident" id="657625">Fatalf</span><span class="op" id="657631">(</span><span class="string" id="657632">&#34;ReadFile&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="657649">,</span>&nbsp;<span class="ident" id="657651">f</span><span class="op" id="657652">.</span><span class="ident" id="657653">Name</span><span class="op" id="657657">(</span><span class="op" id="657658">)</span><span class="op" id="657659">,</span>&nbsp;<span class="ident" id="657661">err</span><span class="op" id="657664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="657667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657670">if</span>&nbsp;<span class="builtintype" id="657673">string</span><span class="op" id="657679">(</span><span class="ident" id="657680">b</span><span class="op" id="657681">)</span>&nbsp;<span class="op" id="657683">!=</span>&nbsp;<span class="string" id="657686">&#34;hello,&nbsp;WORLD\n&#34;</span>&nbsp;<span class="op" id="657703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657707">t</span><span class="op" id="657708">.</span><span class="ident" id="657709">Fatalf</span><span class="op" id="657715">(</span><span class="string" id="657716">&#34;after&nbsp;write:&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="657746">,</span>&nbsp;<span class="builtintype" id="657748">string</span><span class="op" id="657754">(</span><span class="ident" id="657755">b</span><span class="op" id="657756">)</span><span class="op" id="657757">,</span>&nbsp;<span class="string" id="657759">&#34;hello,&nbsp;WORLD\n&#34;</span><span class="op" id="657775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="657778">}</span><br>
<span class="lineno">1100</span><span class="op" id="657780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="657783">func</span>&nbsp;<span class="ident" id="657788">writeFile</span><span class="op" id="657797">(</span><span class="ident" id="657798">t</span>&nbsp;<span class="op" id="657800">*</span><span class="ident" id="657801">testing</span><span class="op" id="657808">.</span><span class="ident" id="657809">T</span><span class="op" id="657810">,</span>&nbsp;<span class="ident" id="657812">fname</span>&nbsp;<span class="builtintype" id="657818">string</span><span class="op" id="657824">,</span>&nbsp;<span class="ident" id="657826">flag</span>&nbsp;<span class="builtintype" id="657831">int</span><span class="op" id="657834">,</span>&nbsp;<span class="ident" id="657836">text</span>&nbsp;<span class="builtintype" id="657841">string</span><span class="op" id="657847">)</span>&nbsp;<span class="builtintype" id="657849">string</span>&nbsp;<span class="op" id="657856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657859">f</span><span class="op" id="657860">,</span>&nbsp;<span class="ident" id="657862">err</span>&nbsp;<span class="op" id="657866">:=</span>&nbsp;<span class="ident" id="657869">OpenFile</span><span class="op" id="657877">(</span><span class="ident" id="657878">fname</span><span class="op" id="657883">,</span>&nbsp;<span class="ident" id="657885">flag</span><span class="op" id="657889">,</span>&nbsp;<span class="num" id="657891">0666</span><span class="op" id="657895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657898">if</span>&nbsp;<span class="ident" id="657901">err</span>&nbsp;<span class="op" id="657905">!=</span>&nbsp;<span class="ident" id="657908">nil</span>&nbsp;<span class="op" id="657912">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657916">t</span><span class="op" id="657917">.</span><span class="ident" id="657918">Fatalf</span><span class="op" id="657924">(</span><span class="string" id="657925">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="657935">,</span>&nbsp;<span class="ident" id="657937">err</span><span class="op" id="657940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="657943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657946">n</span><span class="op" id="657947">,</span>&nbsp;<span class="ident" id="657949">err</span>&nbsp;<span class="op" id="657953">:=</span>&nbsp;<span class="ident" id="657956">io</span><span class="op" id="657958">.</span><span class="ident" id="657959">WriteString</span><span class="op" id="657970">(</span><span class="ident" id="657971">f</span><span class="op" id="657972">,</span>&nbsp;<span class="ident" id="657974">text</span><span class="op" id="657978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="657981">if</span>&nbsp;<span class="ident" id="657984">err</span>&nbsp;<span class="op" id="657988">!=</span>&nbsp;<span class="ident" id="657991">nil</span>&nbsp;<span class="op" id="657995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="657999">t</span><span class="op" id="658000">.</span><span class="ident" id="658001">Fatalf</span><span class="op" id="658007">(</span><span class="string" id="658008">&#34;WriteString:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="658029">,</span>&nbsp;<span class="ident" id="658031">n</span><span class="op" id="658032">,</span>&nbsp;<span class="ident" id="658034">err</span><span class="op" id="658037">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658043">f</span><span class="op" id="658044">.</span><span class="ident" id="658045">Close</span><span class="op" id="658050">(</span><span class="op" id="658051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658054">data</span><span class="op" id="658058">,</span>&nbsp;<span class="ident" id="658060">err</span>&nbsp;<span class="op" id="658064">:=</span>&nbsp;<span class="ident" id="658067">ioutil</span><span class="op" id="658073">.</span><span class="ident" id="658074">ReadFile</span><span class="op" id="658082">(</span><span class="ident" id="658083">fname</span><span class="op" id="658088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658091">if</span>&nbsp;<span class="ident" id="658094">err</span>&nbsp;<span class="op" id="658098">!=</span>&nbsp;<span class="ident" id="658101">nil</span>&nbsp;<span class="op" id="658105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658109">t</span><span class="op" id="658110">.</span><span class="ident" id="658111">Fatalf</span><span class="op" id="658117">(</span><span class="string" id="658118">&#34;ReadFile:&nbsp;%v&#34;</span><span class="op" id="658132">,</span>&nbsp;<span class="ident" id="658134">err</span><span class="op" id="658137">)</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658143">return</span>&nbsp;<span class="builtintype" id="658150">string</span><span class="op" id="658156">(</span><span class="ident" id="658157">data</span><span class="op" id="658161">)</span><br>
<span class="lineno"></span><span class="op" id="658163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="658166">func</span>&nbsp;<span class="ident" id="658171">TestAppend</span><span class="op" id="658181">(</span><span class="ident" id="658182">t</span>&nbsp;<span class="op" id="658184">*</span><span class="ident" id="658185">testing</span><span class="op" id="658192">.</span><span class="ident" id="658193">T</span><span class="op" id="658194">)</span>&nbsp;<span class="op" id="658196">{</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658199">const</span>&nbsp;<span class="ident" id="658205">f</span>&nbsp;<span class="op" id="658207">=</span>&nbsp;<span class="string" id="658209">&#34;append.txt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658223">defer</span>&nbsp;<span class="ident" id="658229">Remove</span><span class="op" id="658235">(</span><span class="ident" id="658236">f</span><span class="op" id="658237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658240">s</span>&nbsp;<span class="op" id="658242">:=</span>&nbsp;<span class="ident" id="658245">writeFile</span><span class="op" id="658254">(</span><span class="ident" id="658255">t</span><span class="op" id="658256">,</span>&nbsp;<span class="ident" id="658258">f</span><span class="op" id="658259">,</span>&nbsp;<span class="ident" id="658261">O_CREATE</span><span class="op" id="658269">|</span><span class="ident" id="658270">O_TRUNC</span><span class="op" id="658277">|</span><span class="ident" id="658278">O_RDWR</span><span class="op" id="658284">,</span>&nbsp;<span class="string" id="658286">&#34;new&#34;</span><span class="op" id="658291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658294">if</span>&nbsp;<span class="ident" id="658297">s</span>&nbsp;<span class="op" id="658299">!=</span>&nbsp;<span class="string" id="658302">&#34;new&#34;</span>&nbsp;<span class="op" id="658308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658312">t</span><span class="op" id="658313">.</span><span class="ident" id="658314">Fatalf</span><span class="op" id="658320">(</span><span class="string" id="658321">&#34;writeFile:&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="658349">,</span>&nbsp;<span class="ident" id="658351">s</span><span class="op" id="658352">,</span>&nbsp;<span class="string" id="658354">&#34;new&#34;</span><span class="op" id="658359">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658365">s</span>&nbsp;<span class="op" id="658367">=</span>&nbsp;<span class="ident" id="658369">writeFile</span><span class="op" id="658378">(</span><span class="ident" id="658379">t</span><span class="op" id="658380">,</span>&nbsp;<span class="ident" id="658382">f</span><span class="op" id="658383">,</span>&nbsp;<span class="ident" id="658385">O_APPEND</span><span class="op" id="658393">|</span><span class="ident" id="658394">O_RDWR</span><span class="op" id="658400">,</span>&nbsp;<span class="string" id="658402">&#34;|append&#34;</span><span class="op" id="658411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658414">if</span>&nbsp;<span class="ident" id="658417">s</span>&nbsp;<span class="op" id="658419">!=</span>&nbsp;<span class="string" id="658422">&#34;new|append&#34;</span>&nbsp;<span class="op" id="658435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658439">t</span><span class="op" id="658440">.</span><span class="ident" id="658441">Fatalf</span><span class="op" id="658447">(</span><span class="string" id="658448">&#34;writeFile:&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="658476">,</span>&nbsp;<span class="ident" id="658478">s</span><span class="op" id="658479">,</span>&nbsp;<span class="string" id="658481">&#34;new|append&#34;</span><span class="op" id="658493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658496">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658499">s</span>&nbsp;<span class="op" id="658501">=</span>&nbsp;<span class="ident" id="658503">writeFile</span><span class="op" id="658512">(</span><span class="ident" id="658513">t</span><span class="op" id="658514">,</span>&nbsp;<span class="ident" id="658516">f</span><span class="op" id="658517">,</span>&nbsp;<span class="ident" id="658519">O_CREATE</span><span class="op" id="658527">|</span><span class="ident" id="658528">O_APPEND</span><span class="op" id="658536">|</span><span class="ident" id="658537">O_RDWR</span><span class="op" id="658543">,</span>&nbsp;<span class="string" id="658545">&#34;|append&#34;</span><span class="op" id="658554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658557">if</span>&nbsp;<span class="ident" id="658560">s</span>&nbsp;<span class="op" id="658562">!=</span>&nbsp;<span class="string" id="658565">&#34;new|append|append&#34;</span>&nbsp;<span class="op" id="658585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658589">t</span><span class="op" id="658590">.</span><span class="ident" id="658591">Fatalf</span><span class="op" id="658597">(</span><span class="string" id="658598">&#34;writeFile:&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="658626">,</span>&nbsp;<span class="ident" id="658628">s</span><span class="op" id="658629">,</span>&nbsp;<span class="string" id="658631">&#34;new|append|append&#34;</span><span class="op" id="658650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658656">err</span>&nbsp;<span class="op" id="658660">:=</span>&nbsp;<span class="ident" id="658663">Remove</span><span class="op" id="658669">(</span><span class="ident" id="658670">f</span><span class="op" id="658671">)</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658674">if</span>&nbsp;<span class="ident" id="658677">err</span>&nbsp;<span class="op" id="658681">!=</span>&nbsp;<span class="ident" id="658684">nil</span>&nbsp;<span class="op" id="658688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658692">t</span><span class="op" id="658693">.</span><span class="ident" id="658694">Fatalf</span><span class="op" id="658700">(</span><span class="string" id="658701">&#34;Remove:&nbsp;%v&#34;</span><span class="op" id="658713">,</span>&nbsp;<span class="ident" id="658715">err</span><span class="op" id="658718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658724">s</span>&nbsp;<span class="op" id="658726">=</span>&nbsp;<span class="ident" id="658728">writeFile</span><span class="op" id="658737">(</span><span class="ident" id="658738">t</span><span class="op" id="658739">,</span>&nbsp;<span class="ident" id="658741">f</span><span class="op" id="658742">,</span>&nbsp;<span class="ident" id="658744">O_CREATE</span><span class="op" id="658752">|</span><span class="ident" id="658753">O_APPEND</span><span class="op" id="658761">|</span><span class="ident" id="658762">O_RDWR</span><span class="op" id="658768">,</span>&nbsp;<span class="string" id="658770">&#34;new&amp;append&#34;</span><span class="op" id="658782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658785">if</span>&nbsp;<span class="ident" id="658788">s</span>&nbsp;<span class="op" id="658790">!=</span>&nbsp;<span class="string" id="658793">&#34;new&amp;append&#34;</span>&nbsp;<span class="op" id="658806">{</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658810">t</span><span class="op" id="658811">.</span><span class="ident" id="658812">Fatalf</span><span class="op" id="658818">(</span><span class="string" id="658819">&#34;writeFile:&nbsp;after&nbsp;append&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="658860">,</span>&nbsp;<span class="ident" id="658862">s</span><span class="op" id="658863">,</span>&nbsp;<span class="string" id="658865">&#34;new&amp;append&#34;</span><span class="op" id="658877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="658880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658883">s</span>&nbsp;<span class="op" id="658885">=</span>&nbsp;<span class="ident" id="658887">writeFile</span><span class="op" id="658896">(</span><span class="ident" id="658897">t</span><span class="op" id="658898">,</span>&nbsp;<span class="ident" id="658900">f</span><span class="op" id="658901">,</span>&nbsp;<span class="ident" id="658903">O_CREATE</span><span class="op" id="658911">|</span><span class="ident" id="658912">O_RDWR</span><span class="op" id="658918">,</span>&nbsp;<span class="string" id="658920">&#34;old&#34;</span><span class="op" id="658925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="658928">if</span>&nbsp;<span class="ident" id="658931">s</span>&nbsp;<span class="op" id="658933">!=</span>&nbsp;<span class="string" id="658936">&#34;old&amp;append&#34;</span>&nbsp;<span class="op" id="658949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="658953">t</span><span class="op" id="658954">.</span><span class="ident" id="658955">Fatalf</span><span class="op" id="658961">(</span><span class="string" id="658962">&#34;writeFile:&nbsp;after&nbsp;create&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="659003">,</span>&nbsp;<span class="ident" id="659005">s</span><span class="op" id="659006">,</span>&nbsp;<span class="string" id="659008">&#34;old&amp;append&#34;</span><span class="op" id="659020">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659026">s</span>&nbsp;<span class="op" id="659028">=</span>&nbsp;<span class="ident" id="659030">writeFile</span><span class="op" id="659039">(</span><span class="ident" id="659040">t</span><span class="op" id="659041">,</span>&nbsp;<span class="ident" id="659043">f</span><span class="op" id="659044">,</span>&nbsp;<span class="ident" id="659046">O_CREATE</span><span class="op" id="659054">|</span><span class="ident" id="659055">O_TRUNC</span><span class="op" id="659062">|</span><span class="ident" id="659063">O_RDWR</span><span class="op" id="659069">,</span>&nbsp;<span class="string" id="659071">&#34;new&#34;</span><span class="op" id="659076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659079">if</span>&nbsp;<span class="ident" id="659082">s</span>&nbsp;<span class="op" id="659084">!=</span>&nbsp;<span class="string" id="659087">&#34;new&#34;</span>&nbsp;<span class="op" id="659093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659097">t</span><span class="op" id="659098">.</span><span class="ident" id="659099">Fatalf</span><span class="op" id="659105">(</span><span class="string" id="659106">&#34;writeFile:&nbsp;after&nbsp;truncate&nbsp;have&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="659149">,</span>&nbsp;<span class="ident" id="659151">s</span><span class="op" id="659152">,</span>&nbsp;<span class="string" id="659154">&#34;new&#34;</span><span class="op" id="659159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659162">}</span><br>
<span class="lineno">1150</span><span class="op" id="659164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="659167">func</span>&nbsp;<span class="ident" id="659172">TestStatDirWithTrailingSlash</span><span class="op" id="659200">(</span><span class="ident" id="659201">t</span>&nbsp;<span class="op" id="659203">*</span><span class="ident" id="659204">testing</span><span class="op" id="659211">.</span><span class="ident" id="659212">T</span><span class="op" id="659213">)</span>&nbsp;<span class="op" id="659215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="659218">//&nbsp;Create&nbsp;new&nbsp;temporary&nbsp;directory&nbsp;and&nbsp;arrange&nbsp;to&nbsp;clean&nbsp;it&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659281">path</span><span class="op" id="659285">,</span>&nbsp;<span class="ident" id="659287">err</span>&nbsp;<span class="op" id="659291">:=</span>&nbsp;<span class="ident" id="659294">ioutil</span><span class="op" id="659300">.</span><span class="ident" id="659301">TempDir</span><span class="op" id="659308">(</span><span class="string" id="659309">&#34;&#34;</span><span class="op" id="659311">,</span>&nbsp;<span class="string" id="659313">&#34;/_TestStatDirWithSlash_&#34;</span><span class="op" id="659338">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659341">if</span>&nbsp;<span class="ident" id="659344">err</span>&nbsp;<span class="op" id="659348">!=</span>&nbsp;<span class="ident" id="659351">nil</span>&nbsp;<span class="op" id="659355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659359">t</span><span class="op" id="659360">.</span><span class="ident" id="659361">Fatalf</span><span class="op" id="659367">(</span><span class="string" id="659368">&#34;TempDir:&nbsp;%s&#34;</span><span class="op" id="659381">,</span>&nbsp;<span class="ident" id="659383">err</span><span class="op" id="659386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659392">defer</span>&nbsp;<span class="ident" id="659398">RemoveAll</span><span class="op" id="659407">(</span><span class="ident" id="659408">path</span><span class="op" id="659412">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="659416">//&nbsp;Stat&nbsp;of&nbsp;path&nbsp;should&nbsp;succeed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659449">_</span><span class="op" id="659450">,</span>&nbsp;<span class="ident" id="659452">err</span>&nbsp;<span class="op" id="659456">=</span>&nbsp;<span class="ident" id="659458">Stat</span><span class="op" id="659462">(</span><span class="ident" id="659463">path</span><span class="op" id="659467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659470">if</span>&nbsp;<span class="ident" id="659473">err</span>&nbsp;<span class="op" id="659477">!=</span>&nbsp;<span class="ident" id="659480">nil</span>&nbsp;<span class="op" id="659484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659488">t</span><span class="op" id="659489">.</span><span class="ident" id="659490">Fatalf</span><span class="op" id="659496">(</span><span class="string" id="659497">&#34;stat&nbsp;%s&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="659517">,</span>&nbsp;<span class="ident" id="659519">path</span><span class="op" id="659523">,</span>&nbsp;<span class="ident" id="659525">err</span><span class="op" id="659528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659531">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="659535">//&nbsp;Stat&nbsp;of&nbsp;path+&#34;/&#34;&nbsp;should&nbsp;succeed&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659576">path</span>&nbsp;<span class="op" id="659581">+=</span>&nbsp;<span class="string" id="659584">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659589">_</span><span class="op" id="659590">,</span>&nbsp;<span class="ident" id="659592">err</span>&nbsp;<span class="op" id="659596">=</span>&nbsp;<span class="ident" id="659598">Stat</span><span class="op" id="659602">(</span><span class="ident" id="659603">path</span><span class="op" id="659607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659610">if</span>&nbsp;<span class="ident" id="659613">err</span>&nbsp;<span class="op" id="659617">!=</span>&nbsp;<span class="ident" id="659620">nil</span>&nbsp;<span class="op" id="659624">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659628">t</span><span class="op" id="659629">.</span><span class="ident" id="659630">Fatalf</span><span class="op" id="659636">(</span><span class="string" id="659637">&#34;stat&nbsp;%s&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="659657">,</span>&nbsp;<span class="ident" id="659659">path</span><span class="op" id="659663">,</span>&nbsp;<span class="ident" id="659665">err</span><span class="op" id="659668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659671">}</span><br>
<span class="lineno"></span><span class="op" id="659673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="659676">func</span>&nbsp;<span class="ident" id="659681">TestNilProcessStateString</span><span class="op" id="659706">(</span><span class="ident" id="659707">t</span>&nbsp;<span class="op" id="659709">*</span><span class="ident" id="659710">testing</span><span class="op" id="659717">.</span><span class="ident" id="659718">T</span><span class="op" id="659719">)</span>&nbsp;<span class="op" id="659721">{</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659724">var</span>&nbsp;<span class="ident" id="659728">ps</span>&nbsp;<span class="op" id="659731">*</span><span class="ident" id="659732">ProcessState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659746">s</span>&nbsp;<span class="op" id="659748">:=</span>&nbsp;<span class="ident" id="659751">ps</span><span class="op" id="659753">.</span><span class="ident" id="659754">String</span><span class="op" id="659760">(</span><span class="op" id="659761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659764">if</span>&nbsp;<span class="ident" id="659767">s</span>&nbsp;<span class="op" id="659769">!=</span>&nbsp;<span class="string" id="659772">&#34;&lt;nil&gt;&#34;</span>&nbsp;<span class="op" id="659780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659784">t</span><span class="op" id="659785">.</span><span class="ident" id="659786">Errorf</span><span class="op" id="659792">(</span><span class="string" id="659793">&#34;(*ProcessState)(nil).String()&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="659838">,</span>&nbsp;<span class="ident" id="659840">s</span><span class="op" id="659841">,</span>&nbsp;<span class="string" id="659843">&#34;&lt;nil&gt;&#34;</span><span class="op" id="659850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659853">}</span><br>
<span class="lineno">1180</span><span class="op" id="659855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="659858">func</span>&nbsp;<span class="ident" id="659863">TestSameFile</span><span class="op" id="659875">(</span><span class="ident" id="659876">t</span>&nbsp;<span class="op" id="659878">*</span><span class="ident" id="659879">testing</span><span class="op" id="659886">.</span><span class="ident" id="659887">T</span><span class="op" id="659888">)</span>&nbsp;<span class="op" id="659890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659893">fa</span><span class="op" id="659895">,</span>&nbsp;<span class="ident" id="659897">err</span>&nbsp;<span class="op" id="659901">:=</span>&nbsp;<span class="ident" id="659904">Create</span><span class="op" id="659910">(</span><span class="string" id="659911">&#34;a&#34;</span><span class="op" id="659914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659917">if</span>&nbsp;<span class="ident" id="659920">err</span>&nbsp;<span class="op" id="659924">!=</span>&nbsp;<span class="ident" id="659927">nil</span>&nbsp;<span class="op" id="659931">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659935">t</span><span class="op" id="659936">.</span><span class="ident" id="659937">Fatalf</span><span class="op" id="659943">(</span><span class="string" id="659944">&#34;Create(a):&nbsp;%v&#34;</span><span class="op" id="659959">,</span>&nbsp;<span class="ident" id="659961">err</span><span class="op" id="659964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="659967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="659970">defer</span>&nbsp;<span class="ident" id="659976">Remove</span><span class="op" id="659982">(</span><span class="ident" id="659983">fa</span><span class="op" id="659985">.</span><span class="ident" id="659986">Name</span><span class="op" id="659990">(</span><span class="op" id="659991">)</span><span class="op" id="659992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="659995">fa</span><span class="op" id="659997">.</span><span class="ident" id="659998">Close</span><span class="op" id="660003">(</span><span class="op" id="660004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660007">fb</span><span class="op" id="660009">,</span>&nbsp;<span class="ident" id="660011">err</span>&nbsp;<span class="op" id="660015">:=</span>&nbsp;<span class="ident" id="660018">Create</span><span class="op" id="660024">(</span><span class="string" id="660025">&#34;b&#34;</span><span class="op" id="660028">)</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660031">if</span>&nbsp;<span class="ident" id="660034">err</span>&nbsp;<span class="op" id="660038">!=</span>&nbsp;<span class="ident" id="660041">nil</span>&nbsp;<span class="op" id="660045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660049">t</span><span class="op" id="660050">.</span><span class="ident" id="660051">Fatalf</span><span class="op" id="660057">(</span><span class="string" id="660058">&#34;Create(b):&nbsp;%v&#34;</span><span class="op" id="660073">,</span>&nbsp;<span class="ident" id="660075">err</span><span class="op" id="660078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660084">defer</span>&nbsp;<span class="ident" id="660090">Remove</span><span class="op" id="660096">(</span><span class="ident" id="660097">fb</span><span class="op" id="660099">.</span><span class="ident" id="660100">Name</span><span class="op" id="660104">(</span><span class="op" id="660105">)</span><span class="op" id="660106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660109">fb</span><span class="op" id="660111">.</span><span class="ident" id="660112">Close</span><span class="op" id="660117">(</span><span class="op" id="660118">)</span><br>
<span class="lineno">1195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660122">ia1</span><span class="op" id="660125">,</span>&nbsp;<span class="ident" id="660127">err</span>&nbsp;<span class="op" id="660131">:=</span>&nbsp;<span class="ident" id="660134">Stat</span><span class="op" id="660138">(</span><span class="string" id="660139">&#34;a&#34;</span><span class="op" id="660142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660145">if</span>&nbsp;<span class="ident" id="660148">err</span>&nbsp;<span class="op" id="660152">!=</span>&nbsp;<span class="ident" id="660155">nil</span>&nbsp;<span class="op" id="660159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660163">t</span><span class="op" id="660164">.</span><span class="ident" id="660165">Fatalf</span><span class="op" id="660171">(</span><span class="string" id="660172">&#34;Stat(a):&nbsp;%v&#34;</span><span class="op" id="660185">,</span>&nbsp;<span class="ident" id="660187">err</span><span class="op" id="660190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660193">}</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660196">ia2</span><span class="op" id="660199">,</span>&nbsp;<span class="ident" id="660201">err</span>&nbsp;<span class="op" id="660205">:=</span>&nbsp;<span class="ident" id="660208">Stat</span><span class="op" id="660212">(</span><span class="string" id="660213">&#34;a&#34;</span><span class="op" id="660216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660219">if</span>&nbsp;<span class="ident" id="660222">err</span>&nbsp;<span class="op" id="660226">!=</span>&nbsp;<span class="ident" id="660229">nil</span>&nbsp;<span class="op" id="660233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660237">t</span><span class="op" id="660238">.</span><span class="ident" id="660239">Fatalf</span><span class="op" id="660245">(</span><span class="string" id="660246">&#34;Stat(a):&nbsp;%v&#34;</span><span class="op" id="660259">,</span>&nbsp;<span class="ident" id="660261">err</span><span class="op" id="660264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660270">if</span>&nbsp;<span class="op" id="660273">!</span><span class="ident" id="660274">SameFile</span><span class="op" id="660282">(</span><span class="ident" id="660283">ia1</span><span class="op" id="660286">,</span>&nbsp;<span class="ident" id="660288">ia2</span><span class="op" id="660291">)</span>&nbsp;<span class="op" id="660293">{</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660297">t</span><span class="op" id="660298">.</span><span class="ident" id="660299">Errorf</span><span class="op" id="660305">(</span><span class="string" id="660306">&#34;files&nbsp;should&nbsp;be&nbsp;same&#34;</span><span class="op" id="660328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660335">ib</span><span class="op" id="660337">,</span>&nbsp;<span class="ident" id="660339">err</span>&nbsp;<span class="op" id="660343">:=</span>&nbsp;<span class="ident" id="660346">Stat</span><span class="op" id="660350">(</span><span class="string" id="660351">&#34;b&#34;</span><span class="op" id="660354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660357">if</span>&nbsp;<span class="ident" id="660360">err</span>&nbsp;<span class="op" id="660364">!=</span>&nbsp;<span class="ident" id="660367">nil</span>&nbsp;<span class="op" id="660371">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660375">t</span><span class="op" id="660376">.</span><span class="ident" id="660377">Fatalf</span><span class="op" id="660383">(</span><span class="string" id="660384">&#34;Stat(b):&nbsp;%v&#34;</span><span class="op" id="660397">,</span>&nbsp;<span class="ident" id="660399">err</span><span class="op" id="660402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660408">if</span>&nbsp;<span class="ident" id="660411">SameFile</span><span class="op" id="660419">(</span><span class="ident" id="660420">ia1</span><span class="op" id="660423">,</span>&nbsp;<span class="ident" id="660425">ib</span><span class="op" id="660427">)</span>&nbsp;<span class="op" id="660429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660433">t</span><span class="op" id="660434">.</span><span class="ident" id="660435">Errorf</span><span class="op" id="660441">(</span><span class="string" id="660442">&#34;files&nbsp;should&nbsp;be&nbsp;different&#34;</span><span class="op" id="660469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660472">}</span><br>
<span class="lineno">1215</span><span class="op" id="660474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="660477">func</span>&nbsp;<span class="ident" id="660482">TestDevNullFile</span><span class="op" id="660497">(</span><span class="ident" id="660498">t</span>&nbsp;<span class="op" id="660500">*</span><span class="ident" id="660501">testing</span><span class="op" id="660508">.</span><span class="ident" id="660509">T</span><span class="op" id="660510">)</span>&nbsp;<span class="op" id="660512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660515">f</span><span class="op" id="660516">,</span>&nbsp;<span class="ident" id="660518">err</span>&nbsp;<span class="op" id="660522">:=</span>&nbsp;<span class="ident" id="660525">Open</span><span class="op" id="660529">(</span><span class="ident" id="660530">DevNull</span><span class="op" id="660537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660540">if</span>&nbsp;<span class="ident" id="660543">err</span>&nbsp;<span class="op" id="660547">!=</span>&nbsp;<span class="ident" id="660550">nil</span>&nbsp;<span class="op" id="660554">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660558">t</span><span class="op" id="660559">.</span><span class="ident" id="660560">Fatalf</span><span class="op" id="660566">(</span><span class="string" id="660567">&#34;Open(%s):&nbsp;%v&#34;</span><span class="op" id="660581">,</span>&nbsp;<span class="ident" id="660583">DevNull</span><span class="op" id="660590">,</span>&nbsp;<span class="ident" id="660592">err</span><span class="op" id="660595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660601">defer</span>&nbsp;<span class="ident" id="660607">f</span><span class="op" id="660608">.</span><span class="ident" id="660609">Close</span><span class="op" id="660614">(</span><span class="op" id="660615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660618">fi</span><span class="op" id="660620">,</span>&nbsp;<span class="ident" id="660622">err</span>&nbsp;<span class="op" id="660626">:=</span>&nbsp;<span class="ident" id="660629">f</span><span class="op" id="660630">.</span><span class="ident" id="660631">Stat</span><span class="op" id="660635">(</span><span class="op" id="660636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660639">if</span>&nbsp;<span class="ident" id="660642">err</span>&nbsp;<span class="op" id="660646">!=</span>&nbsp;<span class="ident" id="660649">nil</span>&nbsp;<span class="op" id="660653">{</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660657">t</span><span class="op" id="660658">.</span><span class="ident" id="660659">Fatalf</span><span class="op" id="660665">(</span><span class="string" id="660666">&#34;Stat(%s):&nbsp;%v&#34;</span><span class="op" id="660680">,</span>&nbsp;<span class="ident" id="660682">DevNull</span><span class="op" id="660689">,</span>&nbsp;<span class="ident" id="660691">err</span><span class="op" id="660694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660700">name</span>&nbsp;<span class="op" id="660705">:=</span>&nbsp;<span class="ident" id="660708">filepath</span><span class="op" id="660716">.</span><span class="ident" id="660717">Base</span><span class="op" id="660721">(</span><span class="ident" id="660722">DevNull</span><span class="op" id="660729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660732">if</span>&nbsp;<span class="ident" id="660735">fi</span><span class="op" id="660737">.</span><span class="ident" id="660738">Name</span><span class="op" id="660742">(</span><span class="op" id="660743">)</span>&nbsp;<span class="op" id="660745">!=</span>&nbsp;<span class="ident" id="660748">name</span>&nbsp;<span class="op" id="660753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660757">t</span><span class="op" id="660758">.</span><span class="ident" id="660759">Fatalf</span><span class="op" id="660765">(</span><span class="string" id="660766">&#34;wrong&nbsp;file&nbsp;name&nbsp;have&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="660799">,</span>&nbsp;<span class="ident" id="660801">fi</span><span class="op" id="660803">.</span><span class="ident" id="660804">Name</span><span class="op" id="660808">(</span><span class="op" id="660809">)</span><span class="op" id="660810">,</span>&nbsp;<span class="ident" id="660812">name</span><span class="op" id="660816">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="660822">if</span>&nbsp;<span class="ident" id="660825">fi</span><span class="op" id="660827">.</span><span class="ident" id="660828">Size</span><span class="op" id="660832">(</span><span class="op" id="660833">)</span>&nbsp;<span class="op" id="660835">!=</span>&nbsp;<span class="num" id="660838">0</span>&nbsp;<span class="op" id="660840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="660844">t</span><span class="op" id="660845">.</span><span class="ident" id="660846">Fatalf</span><span class="op" id="660852">(</span><span class="string" id="660853">&#34;wrong&nbsp;file&nbsp;size&nbsp;have&nbsp;%d&nbsp;want&nbsp;0&#34;</span><span class="op" id="660885">,</span>&nbsp;<span class="ident" id="660887">fi</span><span class="op" id="660889">.</span><span class="ident" id="660890">Size</span><span class="op" id="660894">(</span><span class="op" id="660895">)</span><span class="op" id="660896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="660899">}</span><br>
<span class="lineno"></span><span class="op" id="660901">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="660904">var</span>&nbsp;<span class="ident" id="660908">testLargeWrite</span>&nbsp;<span class="op" id="660923">=</span>&nbsp;<span class="ident" id="660925">flag</span><span class="op" id="660929">.</span><span class="ident" id="660930">Bool</span><span class="op" id="660934">(</span><span class="string" id="660935">&#34;large_write&#34;</span><span class="op" id="660948">,</span>&nbsp;<span class="builtintype" id="660950">false</span><span class="op" id="660955">,</span>&nbsp;<span class="string" id="660957">&#34;run&nbsp;TestLargeWriteToConsole&nbsp;test&nbsp;that&nbsp;floods&nbsp;console&nbsp;with&nbsp;output&#34;</span><span class="op" id="661023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="661026">func</span>&nbsp;<span class="ident" id="661031">TestLargeWriteToConsole</span><span class="op" id="661054">(</span><span class="ident" id="661055">t</span>&nbsp;<span class="op" id="661057">*</span><span class="ident" id="661058">testing</span><span class="op" id="661065">.</span><span class="ident" id="661066">T</span><span class="op" id="661067">)</span>&nbsp;<span class="op" id="661069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661072">if</span>&nbsp;<span class="op" id="661075">!</span><span class="op" id="661076">*</span><span class="ident" id="661077">testLargeWrite</span>&nbsp;<span class="op" id="661092">{</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661096">t</span><span class="op" id="661097">.</span><span class="ident" id="661098">Skip</span><span class="op" id="661102">(</span><span class="string" id="661103">&#34;skipping&nbsp;console-flooding&nbsp;test;&nbsp;enable&nbsp;with&nbsp;-large_write&#34;</span><span class="op" id="661161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661167">b</span>&nbsp;<span class="op" id="661169">:=</span>&nbsp;<span class="builtinfunc" id="661172">make</span><span class="op" id="661176">(</span><span class="op" id="661177">[</span><span class="op" id="661178">]</span><span class="builtintype" id="661179">byte</span><span class="op" id="661183">,</span>&nbsp;<span class="num" id="661185">32000</span><span class="op" id="661190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661193">for</span>&nbsp;<span class="ident" id="661197">i</span>&nbsp;<span class="op" id="661199">:=</span>&nbsp;<span class="keyword" id="661202">range</span>&nbsp;<span class="ident" id="661208">b</span>&nbsp;<span class="op" id="661210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661214">b</span><span class="op" id="661215">[</span><span class="ident" id="661216">i</span><span class="op" id="661217">]</span>&nbsp;<span class="op" id="661219">=</span>&nbsp;<span class="string" id="661221">&#39;.&#39;</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661229">b</span><span class="op" id="661230">[</span><span class="builtinfunc" id="661231">len</span><span class="op" id="661234">(</span><span class="ident" id="661235">b</span><span class="op" id="661236">)</span><span class="op" id="661237">-</span><span class="num" id="661238">1</span><span class="op" id="661239">]</span>&nbsp;<span class="op" id="661241">=</span>&nbsp;<span class="string" id="661243">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661249">n</span><span class="op" id="661250">,</span>&nbsp;<span class="ident" id="661252">err</span>&nbsp;<span class="op" id="661256">:=</span>&nbsp;<span class="ident" id="661259">Stdout</span><span class="op" id="661265">.</span><span class="ident" id="661266">Write</span><span class="op" id="661271">(</span><span class="ident" id="661272">b</span><span class="op" id="661273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661276">if</span>&nbsp;<span class="ident" id="661279">err</span>&nbsp;<span class="op" id="661283">!=</span>&nbsp;<span class="ident" id="661286">nil</span>&nbsp;<span class="op" id="661290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661294">t</span><span class="op" id="661295">.</span><span class="ident" id="661296">Fatalf</span><span class="op" id="661302">(</span><span class="string" id="661303">&#34;Write&nbsp;to&nbsp;os.Stdout&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="661334">,</span>&nbsp;<span class="ident" id="661336">err</span><span class="op" id="661339">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661345">if</span>&nbsp;<span class="ident" id="661348">n</span>&nbsp;<span class="op" id="661350">!=</span>&nbsp;<span class="builtinfunc" id="661353">len</span><span class="op" id="661356">(</span><span class="ident" id="661357">b</span><span class="op" id="661358">)</span>&nbsp;<span class="op" id="661360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661364">t</span><span class="op" id="661365">.</span><span class="ident" id="661366">Errorf</span><span class="op" id="661372">(</span><span class="string" id="661373">&#34;Write&nbsp;to&nbsp;os.Stdout&nbsp;should&nbsp;return&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="661418">,</span>&nbsp;<span class="builtinfunc" id="661420">len</span><span class="op" id="661423">(</span><span class="ident" id="661424">b</span><span class="op" id="661425">)</span><span class="op" id="661426">,</span>&nbsp;<span class="ident" id="661428">n</span><span class="op" id="661429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661435">n</span><span class="op" id="661436">,</span>&nbsp;<span class="ident" id="661438">err</span>&nbsp;<span class="op" id="661442">=</span>&nbsp;<span class="ident" id="661444">Stderr</span><span class="op" id="661450">.</span><span class="ident" id="661451">Write</span><span class="op" id="661456">(</span><span class="ident" id="661457">b</span><span class="op" id="661458">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661461">if</span>&nbsp;<span class="ident" id="661464">err</span>&nbsp;<span class="op" id="661468">!=</span>&nbsp;<span class="ident" id="661471">nil</span>&nbsp;<span class="op" id="661475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661479">t</span><span class="op" id="661480">.</span><span class="ident" id="661481">Fatalf</span><span class="op" id="661487">(</span><span class="string" id="661488">&#34;Write&nbsp;to&nbsp;os.Stderr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="661519">,</span>&nbsp;<span class="ident" id="661521">err</span><span class="op" id="661524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661530">if</span>&nbsp;<span class="ident" id="661533">n</span>&nbsp;<span class="op" id="661535">!=</span>&nbsp;<span class="builtinfunc" id="661538">len</span><span class="op" id="661541">(</span><span class="ident" id="661542">b</span><span class="op" id="661543">)</span>&nbsp;<span class="op" id="661545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661549">t</span><span class="op" id="661550">.</span><span class="ident" id="661551">Errorf</span><span class="op" id="661557">(</span><span class="string" id="661558">&#34;Write&nbsp;to&nbsp;os.Stderr&nbsp;should&nbsp;return&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="661603">,</span>&nbsp;<span class="builtinfunc" id="661605">len</span><span class="op" id="661608">(</span><span class="ident" id="661609">b</span><span class="op" id="661610">)</span><span class="op" id="661611">,</span>&nbsp;<span class="ident" id="661613">n</span><span class="op" id="661614">)</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661617">}</span><br>
<span class="lineno"></span><span class="op" id="661619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="661622">func</span>&nbsp;<span class="ident" id="661627">TestStatDirModeExec</span><span class="op" id="661646">(</span><span class="ident" id="661647">t</span>&nbsp;<span class="op" id="661649">*</span><span class="ident" id="661650">testing</span><span class="op" id="661657">.</span><span class="ident" id="661658">T</span><span class="op" id="661659">)</span>&nbsp;<span class="op" id="661661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661664">const</span>&nbsp;<span class="ident" id="661670">mode</span>&nbsp;<span class="op" id="661675">=</span>&nbsp;<span class="num" id="661677">0111</span><br>
<span class="lineno">1265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661684">path</span><span class="op" id="661688">,</span>&nbsp;<span class="ident" id="661690">err</span>&nbsp;<span class="op" id="661694">:=</span>&nbsp;<span class="ident" id="661697">ioutil</span><span class="op" id="661703">.</span><span class="ident" id="661704">TempDir</span><span class="op" id="661711">(</span><span class="string" id="661712">&#34;&#34;</span><span class="op" id="661714">,</span>&nbsp;<span class="string" id="661716">&#34;go-build&#34;</span><span class="op" id="661726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661729">if</span>&nbsp;<span class="ident" id="661732">err</span>&nbsp;<span class="op" id="661736">!=</span>&nbsp;<span class="ident" id="661739">nil</span>&nbsp;<span class="op" id="661743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661747">t</span><span class="op" id="661748">.</span><span class="ident" id="661749">Fatalf</span><span class="op" id="661755">(</span><span class="string" id="661756">&#34;Failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;directory:&nbsp;%v&#34;</span><span class="op" id="661793">,</span>&nbsp;<span class="ident" id="661795">err</span><span class="op" id="661798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661801">}</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661804">defer</span>&nbsp;<span class="ident" id="661810">RemoveAll</span><span class="op" id="661819">(</span><span class="ident" id="661820">path</span><span class="op" id="661824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661828">if</span>&nbsp;<span class="ident" id="661831">err</span>&nbsp;<span class="op" id="661835">:=</span>&nbsp;<span class="ident" id="661838">Chmod</span><span class="op" id="661843">(</span><span class="ident" id="661844">path</span><span class="op" id="661848">,</span>&nbsp;<span class="num" id="661850">0777</span><span class="op" id="661854">)</span><span class="op" id="661855">;</span>&nbsp;<span class="ident" id="661857">err</span>&nbsp;<span class="op" id="661861">!=</span>&nbsp;<span class="ident" id="661864">nil</span>&nbsp;<span class="op" id="661868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661872">t</span><span class="op" id="661873">.</span><span class="ident" id="661874">Fatalf</span><span class="op" id="661880">(</span><span class="string" id="661881">&#34;Chmod&nbsp;%q&nbsp;0777:&nbsp;%v&#34;</span><span class="op" id="661900">,</span>&nbsp;<span class="ident" id="661902">path</span><span class="op" id="661906">,</span>&nbsp;<span class="ident" id="661908">err</span><span class="op" id="661911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="661914">}</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661918">dir</span><span class="op" id="661921">,</span>&nbsp;<span class="ident" id="661923">err</span>&nbsp;<span class="op" id="661927">:=</span>&nbsp;<span class="ident" id="661930">Stat</span><span class="op" id="661934">(</span><span class="ident" id="661935">path</span><span class="op" id="661939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="661942">if</span>&nbsp;<span class="ident" id="661945">err</span>&nbsp;<span class="op" id="661949">!=</span>&nbsp;<span class="ident" id="661952">nil</span>&nbsp;<span class="op" id="661956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="661960">t</span><span class="op" id="661961">.</span><span class="ident" id="661962">Fatalf</span><span class="op" id="661968">(</span><span class="string" id="661969">&#34;Stat&nbsp;%q&nbsp;(looking&nbsp;for&nbsp;mode&nbsp;%#o):&nbsp;%s&#34;</span><span class="op" id="662005">,</span>&nbsp;<span class="ident" id="662007">path</span><span class="op" id="662011">,</span>&nbsp;<span class="ident" id="662013">mode</span><span class="op" id="662017">,</span>&nbsp;<span class="ident" id="662019">err</span><span class="op" id="662022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="662025">}</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662028">if</span>&nbsp;<span class="ident" id="662031">dir</span><span class="op" id="662034">.</span><span class="ident" id="662035">Mode</span><span class="op" id="662039">(</span><span class="op" id="662040">)</span><span class="op" id="662041">&amp;</span><span class="ident" id="662042">mode</span>&nbsp;<span class="op" id="662047">!=</span>&nbsp;<span class="ident" id="662050">mode</span>&nbsp;<span class="op" id="662055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662059">t</span><span class="op" id="662060">.</span><span class="ident" id="662061">Errorf</span><span class="op" id="662067">(</span><span class="string" id="662068">&#34;Stat&nbsp;%q:&nbsp;mode&nbsp;%#o&nbsp;want&nbsp;%#o&#34;</span><span class="op" id="662096">,</span>&nbsp;<span class="ident" id="662098">path</span><span class="op" id="662102">,</span>&nbsp;<span class="ident" id="662104">dir</span><span class="op" id="662107">.</span><span class="ident" id="662108">Mode</span><span class="op" id="662112">(</span><span class="op" id="662113">)</span><span class="op" id="662114">&amp;</span><span class="ident" id="662115">mode</span><span class="op" id="662119">,</span>&nbsp;<span class="ident" id="662121">mode</span><span class="op" id="662125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="662128">}</span><br>
<span class="lineno"></span><span class="op" id="662130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1285</span><span class="keyword" id="662133">func</span>&nbsp;<span class="ident" id="662138">TestReadAtEOF</span><span class="op" id="662151">(</span><span class="ident" id="662152">t</span>&nbsp;<span class="op" id="662154">*</span><span class="ident" id="662155">testing</span><span class="op" id="662162">.</span><span class="ident" id="662163">T</span><span class="op" id="662164">)</span>&nbsp;<span class="op" id="662166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662169">f</span>&nbsp;<span class="op" id="662171">:=</span>&nbsp;<span class="ident" id="662174">newFile</span><span class="op" id="662181">(</span><span class="string" id="662182">&#34;TestReadAtEOF&#34;</span><span class="op" id="662197">,</span>&nbsp;<span class="ident" id="662199">t</span><span class="op" id="662200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662203">defer</span>&nbsp;<span class="ident" id="662209">Remove</span><span class="op" id="662215">(</span><span class="ident" id="662216">f</span><span class="op" id="662217">.</span><span class="ident" id="662218">Name</span><span class="op" id="662222">(</span><span class="op" id="662223">)</span><span class="op" id="662224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662227">defer</span>&nbsp;<span class="ident" id="662233">f</span><span class="op" id="662234">.</span><span class="ident" id="662235">Close</span><span class="op" id="662240">(</span><span class="op" id="662241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662245">_</span><span class="op" id="662246">,</span>&nbsp;<span class="ident" id="662248">err</span>&nbsp;<span class="op" id="662252">:=</span>&nbsp;<span class="ident" id="662255">f</span><span class="op" id="662256">.</span><span class="ident" id="662257">ReadAt</span><span class="op" id="662263">(</span><span class="builtinfunc" id="662264">make</span><span class="op" id="662268">(</span><span class="op" id="662269">[</span><span class="op" id="662270">]</span><span class="builtintype" id="662271">byte</span><span class="op" id="662275">,</span>&nbsp;<span class="num" id="662277">10</span><span class="op" id="662279">)</span><span class="op" id="662280">,</span>&nbsp;<span class="num" id="662282">0</span><span class="op" id="662283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662286">switch</span>&nbsp;<span class="ident" id="662293">err</span>&nbsp;<span class="op" id="662297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662300">case</span>&nbsp;<span class="ident" id="662305">io</span><span class="op" id="662307">.</span><span class="ident" id="662308">EOF</span><span class="op" id="662311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="662315">//&nbsp;all&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662328">case</span>&nbsp;<span class="ident" id="662333">nil</span><span class="op" id="662336">:</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662340">t</span><span class="op" id="662341">.</span><span class="ident" id="662342">Fatalf</span><span class="op" id="662348">(</span><span class="string" id="662349">&#34;ReadAt&nbsp;succeeded&#34;</span><span class="op" id="662367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662370">default</span><span class="op" id="662377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662381">t</span><span class="op" id="662382">.</span><span class="ident" id="662383">Fatalf</span><span class="op" id="662389">(</span><span class="string" id="662390">&#34;ReadAt&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="662409">,</span>&nbsp;<span class="ident" id="662411">err</span><span class="op" id="662414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="662417">}</span><br>
<span class="lineno"></span><span class="op" id="662419">}</span><br>
<span class="lineno">1300</span><br>
<span class="lineno"></span><span class="keyword" id="662422">func</span>&nbsp;<span class="ident" id="662427">testKillProcess</span><span class="op" id="662442">(</span><span class="ident" id="662443">t</span>&nbsp;<span class="op" id="662445">*</span><span class="ident" id="662446">testing</span><span class="op" id="662453">.</span><span class="ident" id="662454">T</span><span class="op" id="662455">,</span>&nbsp;<span class="ident" id="662457">processKiller</span>&nbsp;<span class="keyword" id="662471">func</span><span class="op" id="662475">(</span><span class="ident" id="662476">p</span>&nbsp;<span class="op" id="662478">*</span><span class="ident" id="662479">Process</span><span class="op" id="662486">)</span><span class="op" id="662487">)</span>&nbsp;<span class="op" id="662489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662492">switch</span>&nbsp;<span class="ident" id="662499">runtime</span><span class="op" id="662506">.</span><span class="ident" id="662507">GOOS</span>&nbsp;<span class="op" id="662512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662515">case</span>&nbsp;<span class="string" id="662520">&#34;android&#34;</span><span class="op" id="662529">,</span>&nbsp;<span class="string" id="662531">&#34;nacl&#34;</span><span class="op" id="662537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662541">t</span><span class="op" id="662542">.</span><span class="ident" id="662543">Skipf</span><span class="op" id="662548">(</span><span class="string" id="662549">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="662565">,</span>&nbsp;<span class="ident" id="662567">runtime</span><span class="op" id="662574">.</span><span class="ident" id="662575">GOOS</span><span class="op" id="662579">)</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="662582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662586">dir</span><span class="op" id="662589">,</span>&nbsp;<span class="ident" id="662591">err</span>&nbsp;<span class="op" id="662595">:=</span>&nbsp;<span class="ident" id="662598">ioutil</span><span class="op" id="662604">.</span><span class="ident" id="662605">TempDir</span><span class="op" id="662612">(</span><span class="string" id="662613">&#34;&#34;</span><span class="op" id="662615">,</span>&nbsp;<span class="string" id="662617">&#34;go-build&#34;</span><span class="op" id="662627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662630">if</span>&nbsp;<span class="ident" id="662633">err</span>&nbsp;<span class="op" id="662637">!=</span>&nbsp;<span class="ident" id="662640">nil</span>&nbsp;<span class="op" id="662644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662648">t</span><span class="op" id="662649">.</span><span class="ident" id="662650">Fatalf</span><span class="op" id="662656">(</span><span class="string" id="662657">&#34;Failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;directory:&nbsp;%v&#34;</span><span class="op" id="662694">,</span>&nbsp;<span class="ident" id="662696">err</span><span class="op" id="662699">)</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="662702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662705">defer</span>&nbsp;<span class="ident" id="662711">RemoveAll</span><span class="op" id="662720">(</span><span class="ident" id="662721">dir</span><span class="op" id="662724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662728">src</span>&nbsp;<span class="op" id="662732">:=</span>&nbsp;<span class="ident" id="662735">filepath</span><span class="op" id="662743">.</span><span class="ident" id="662744">Join</span><span class="op" id="662748">(</span><span class="ident" id="662749">dir</span><span class="op" id="662752">,</span>&nbsp;<span class="string" id="662754">&#34;main.go&#34;</span><span class="op" id="662763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662766">f</span><span class="op" id="662767">,</span>&nbsp;<span class="ident" id="662769">err</span>&nbsp;<span class="op" id="662773">:=</span>&nbsp;<span class="ident" id="662776">Create</span><span class="op" id="662782">(</span><span class="ident" id="662783">src</span><span class="op" id="662786">)</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="662789">if</span>&nbsp;<span class="ident" id="662792">err</span>&nbsp;<span class="op" id="662796">!=</span>&nbsp;<span class="ident" id="662799">nil</span>&nbsp;<span class="op" id="662803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662807">t</span><span class="op" id="662808">.</span><span class="ident" id="662809">Fatalf</span><span class="op" id="662815">(</span><span class="string" id="662816">&#34;Failed&nbsp;to&nbsp;create&nbsp;%v:&nbsp;%v&#34;</span><span class="op" id="662841">,</span>&nbsp;<span class="ident" id="662843">src</span><span class="op" id="662846">,</span>&nbsp;<span class="ident" id="662848">err</span><span class="op" id="662851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="662854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662857">st</span>&nbsp;<span class="op" id="662860">:=</span>&nbsp;<span class="ident" id="662863">template</span><span class="op" id="662871">.</span><span class="ident" id="662872">Must</span><span class="op" id="662876">(</span><span class="ident" id="662877">template</span><span class="op" id="662885">.</span><span class="ident" id="662886">New</span><span class="op" id="662889">(</span><span class="string" id="662890">&#34;source&#34;</span><span class="op" id="662898">)</span><span class="op" id="662899">.</span><span class="ident" id="662900">Parse</span><span class="op" id="662905">(</span><span class="string" id="662906">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno">1320</span>import&nbsp;&#34;time&#34;<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;time.Sleep(time.Second)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><span class="op" id="662977">)</span><span class="op" id="662978">)</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="662981">err</span>&nbsp;<span class="op" id="662985">=</span>&nbsp;<span class="ident" id="662987">st</span><span class="op" id="662989">.</span><span class="ident" id="662990">Execute</span><span class="op" id="662997">(</span><span class="ident" id="662998">f</span><span class="op" id="662999">,</span>&nbsp;<span class="ident" id="663001">nil</span><span class="op" id="663004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663007">if</span>&nbsp;<span class="ident" id="663010">err</span>&nbsp;<span class="op" id="663014">!=</span>&nbsp;<span class="ident" id="663017">nil</span>&nbsp;<span class="op" id="663021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663025">f</span><span class="op" id="663026">.</span><span class="ident" id="663027">Close</span><span class="op" id="663032">(</span><span class="op" id="663033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663037">t</span><span class="op" id="663038">.</span><span class="ident" id="663039">Fatalf</span><span class="op" id="663045">(</span><span class="string" id="663046">&#34;Failed&nbsp;to&nbsp;execute&nbsp;template:&nbsp;%v&#34;</span><span class="op" id="663078">,</span>&nbsp;<span class="ident" id="663080">err</span><span class="op" id="663083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663086">}</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663089">f</span><span class="op" id="663090">.</span><span class="ident" id="663091">Close</span><span class="op" id="663096">(</span><span class="op" id="663097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663101">exe</span>&nbsp;<span class="op" id="663105">:=</span>&nbsp;<span class="ident" id="663108">filepath</span><span class="op" id="663116">.</span><span class="ident" id="663117">Join</span><span class="op" id="663121">(</span><span class="ident" id="663122">dir</span><span class="op" id="663125">,</span>&nbsp;<span class="string" id="663127">&#34;main.exe&#34;</span><span class="op" id="663137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663140">output</span><span class="op" id="663146">,</span>&nbsp;<span class="ident" id="663148">err</span>&nbsp;<span class="op" id="663152">:=</span>&nbsp;<span class="ident" id="663155">osexec</span><span class="op" id="663161">.</span><span class="ident" id="663162">Command</span><span class="op" id="663169">(</span><span class="string" id="663170">&#34;go&#34;</span><span class="op" id="663174">,</span>&nbsp;<span class="string" id="663176">&#34;build&#34;</span><span class="op" id="663183">,</span>&nbsp;<span class="string" id="663185">&#34;-o&#34;</span><span class="op" id="663189">,</span>&nbsp;<span class="ident" id="663191">exe</span><span class="op" id="663194">,</span>&nbsp;<span class="ident" id="663196">src</span><span class="op" id="663199">)</span><span class="op" id="663200">.</span><span class="ident" id="663201">CombinedOutput</span><span class="op" id="663215">(</span><span class="op" id="663216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663219">if</span>&nbsp;<span class="ident" id="663222">err</span>&nbsp;<span class="op" id="663226">!=</span>&nbsp;<span class="ident" id="663229">nil</span>&nbsp;<span class="op" id="663233">{</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663237">t</span><span class="op" id="663238">.</span><span class="ident" id="663239">Fatalf</span><span class="op" id="663245">(</span><span class="string" id="663246">&#34;Failed&nbsp;to&nbsp;build&nbsp;exe&nbsp;%v:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="663277">,</span>&nbsp;<span class="ident" id="663279">exe</span><span class="op" id="663282">,</span>&nbsp;<span class="ident" id="663284">err</span><span class="op" id="663287">,</span>&nbsp;<span class="builtintype" id="663289">string</span><span class="op" id="663295">(</span><span class="ident" id="663296">output</span><span class="op" id="663302">)</span><span class="op" id="663303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663310">cmd</span>&nbsp;<span class="op" id="663314">:=</span>&nbsp;<span class="ident" id="663317">osexec</span><span class="op" id="663323">.</span><span class="ident" id="663324">Command</span><span class="op" id="663331">(</span><span class="ident" id="663332">exe</span><span class="op" id="663335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663338">err</span>&nbsp;<span class="op" id="663342">=</span>&nbsp;<span class="ident" id="663344">cmd</span><span class="op" id="663347">.</span><span class="ident" id="663348">Start</span><span class="op" id="663353">(</span><span class="op" id="663354">)</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663357">if</span>&nbsp;<span class="ident" id="663360">err</span>&nbsp;<span class="op" id="663364">!=</span>&nbsp;<span class="ident" id="663367">nil</span>&nbsp;<span class="op" id="663371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663375">t</span><span class="op" id="663376">.</span><span class="ident" id="663377">Fatalf</span><span class="op" id="663383">(</span><span class="string" id="663384">&#34;Failed&nbsp;to&nbsp;start&nbsp;test&nbsp;process:&nbsp;%v&#34;</span><span class="op" id="663418">,</span>&nbsp;<span class="ident" id="663420">err</span><span class="op" id="663423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663429">go</span>&nbsp;<span class="keyword" id="663432">func</span><span class="op" id="663436">(</span><span class="op" id="663437">)</span>&nbsp;<span class="op" id="663439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663443">time</span><span class="op" id="663447">.</span><span class="ident" id="663448">Sleep</span><span class="op" id="663453">(</span><span class="num" id="663454">100</span>&nbsp;<span class="op" id="663458">*</span>&nbsp;<span class="ident" id="663460">time</span><span class="op" id="663464">.</span><span class="ident" id="663465">Millisecond</span><span class="op" id="663476">)</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663480">processKiller</span><span class="op" id="663493">(</span><span class="ident" id="663494">cmd</span><span class="op" id="663497">.</span><span class="ident" id="663498">Process</span><span class="op" id="663505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663508">}</span><span class="op" id="663509">(</span><span class="op" id="663510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663513">err</span>&nbsp;<span class="op" id="663517">=</span>&nbsp;<span class="ident" id="663519">cmd</span><span class="op" id="663522">.</span><span class="ident" id="663523">Wait</span><span class="op" id="663527">(</span><span class="op" id="663528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663531">if</span>&nbsp;<span class="ident" id="663534">err</span>&nbsp;<span class="op" id="663538">==</span>&nbsp;<span class="ident" id="663541">nil</span>&nbsp;<span class="op" id="663545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663549">t</span><span class="op" id="663550">.</span><span class="ident" id="663551">Errorf</span><span class="op" id="663557">(</span><span class="string" id="663558">&#34;Test&nbsp;process&nbsp;succeeded,&nbsp;but&nbsp;expected&nbsp;to&nbsp;fail&#34;</span><span class="op" id="663604">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663607">}</span><br>
<span class="lineno"></span><span class="op" id="663609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="663612">func</span>&nbsp;<span class="ident" id="663617">TestKillStartProcess</span><span class="op" id="663637">(</span><span class="ident" id="663638">t</span>&nbsp;<span class="op" id="663640">*</span><span class="ident" id="663641">testing</span><span class="op" id="663648">.</span><span class="ident" id="663649">T</span><span class="op" id="663650">)</span>&nbsp;<span class="op" id="663652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663655">testKillProcess</span><span class="op" id="663670">(</span><span class="ident" id="663671">t</span><span class="op" id="663672">,</span>&nbsp;<span class="keyword" id="663674">func</span><span class="op" id="663678">(</span><span class="ident" id="663679">p</span>&nbsp;<span class="op" id="663681">*</span><span class="ident" id="663682">Process</span><span class="op" id="663689">)</span>&nbsp;<span class="op" id="663691">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663695">err</span>&nbsp;<span class="op" id="663699">:=</span>&nbsp;<span class="ident" id="663702">p</span><span class="op" id="663703">.</span><span class="ident" id="663704">Kill</span><span class="op" id="663708">(</span><span class="op" id="663709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663713">if</span>&nbsp;<span class="ident" id="663716">err</span>&nbsp;<span class="op" id="663720">!=</span>&nbsp;<span class="ident" id="663723">nil</span>&nbsp;<span class="op" id="663727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663732">t</span><span class="op" id="663733">.</span><span class="ident" id="663734">Fatalf</span><span class="op" id="663740">(</span><span class="string" id="663741">&#34;Failed&nbsp;to&nbsp;kill&nbsp;test&nbsp;process:&nbsp;%v&#34;</span><span class="op" id="663774">,</span>&nbsp;<span class="ident" id="663776">err</span><span class="op" id="663779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663786">}</span><span class="op" id="663787">)</span><br>
<span class="lineno">1360</span><span class="op" id="663789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="663792">func</span>&nbsp;<span class="ident" id="663797">TestGetppid</span><span class="op" id="663808">(</span><span class="ident" id="663809">t</span>&nbsp;<span class="op" id="663811">*</span><span class="ident" id="663812">testing</span><span class="op" id="663819">.</span><span class="ident" id="663820">T</span><span class="op" id="663821">)</span>&nbsp;<span class="op" id="663823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663826">switch</span>&nbsp;<span class="ident" id="663833">runtime</span><span class="op" id="663840">.</span><span class="ident" id="663841">GOOS</span>&nbsp;<span class="op" id="663846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663849">case</span>&nbsp;<span class="string" id="663854">&#34;nacl&#34;</span><span class="op" id="663860">:</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663864">t</span><span class="op" id="663865">.</span><span class="ident" id="663866">Skip</span><span class="op" id="663870">(</span><span class="string" id="663871">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="663889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663892">case</span>&nbsp;<span class="string" id="663897">&#34;plan9&#34;</span><span class="op" id="663904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="663908">//&nbsp;TODO:&nbsp;golang.org/issue/8206</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="663941">t</span><span class="op" id="663942">.</span><span class="ident" id="663943">Skipf</span><span class="op" id="663948">(</span><span class="string" id="663949">&#34;skipping&nbsp;test&nbsp;on&nbsp;plan9;&nbsp;see&nbsp;issue&nbsp;8206&#34;</span><span class="op" id="663989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="663992">}</span><br>
<span class="lineno">1370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="663996">if</span>&nbsp;<span class="ident" id="663999">Getenv</span><span class="op" id="664005">(</span><span class="string" id="664006">&#34;GO_WANT_HELPER_PROCESS&#34;</span><span class="op" id="664030">)</span>&nbsp;<span class="op" id="664032">==</span>&nbsp;<span class="string" id="664035">&#34;1&#34;</span>&nbsp;<span class="op" id="664039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664043">fmt</span><span class="op" id="664046">.</span><span class="ident" id="664047">Print</span><span class="op" id="664052">(</span><span class="ident" id="664053">Getppid</span><span class="op" id="664060">(</span><span class="op" id="664061">)</span><span class="op" id="664062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664066">Exit</span><span class="op" id="664070">(</span><span class="num" id="664071">0</span><span class="op" id="664072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664075">}</span><br>
<span class="lineno">1375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664079">cmd</span>&nbsp;<span class="op" id="664083">:=</span>&nbsp;<span class="ident" id="664086">osexec</span><span class="op" id="664092">.</span><span class="ident" id="664093">Command</span><span class="op" id="664100">(</span><span class="ident" id="664101">Args</span><span class="op" id="664105">[</span><span class="num" id="664106">0</span><span class="op" id="664107">]</span><span class="op" id="664108">,</span>&nbsp;<span class="string" id="664110">&#34;-test.run=TestGetppid&#34;</span><span class="op" id="664133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664136">cmd</span><span class="op" id="664139">.</span><span class="ident" id="664140">Env</span>&nbsp;<span class="op" id="664144">=</span>&nbsp;<span class="builtinfunc" id="664146">append</span><span class="op" id="664152">(</span><span class="ident" id="664153">Environ</span><span class="op" id="664160">(</span><span class="op" id="664161">)</span><span class="op" id="664162">,</span>&nbsp;<span class="string" id="664164">&#34;GO_WANT_HELPER_PROCESS=1&#34;</span><span class="op" id="664190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="664194">//&nbsp;verify&nbsp;that&nbsp;Getppid()&nbsp;from&nbsp;the&nbsp;forked&nbsp;process&nbsp;reports&nbsp;our&nbsp;process&nbsp;id</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664267">output</span><span class="op" id="664273">,</span>&nbsp;<span class="ident" id="664275">err</span>&nbsp;<span class="op" id="664279">:=</span>&nbsp;<span class="ident" id="664282">cmd</span><span class="op" id="664285">.</span><span class="ident" id="664286">CombinedOutput</span><span class="op" id="664300">(</span><span class="op" id="664301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="664304">if</span>&nbsp;<span class="ident" id="664307">err</span>&nbsp;<span class="op" id="664311">!=</span>&nbsp;<span class="ident" id="664314">nil</span>&nbsp;<span class="op" id="664318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664322">t</span><span class="op" id="664323">.</span><span class="ident" id="664324">Fatalf</span><span class="op" id="664330">(</span><span class="string" id="664331">&#34;Failed&nbsp;to&nbsp;spawn&nbsp;child&nbsp;process:&nbsp;%v&nbsp;%q&#34;</span><span class="op" id="664369">,</span>&nbsp;<span class="ident" id="664371">err</span><span class="op" id="664374">,</span>&nbsp;<span class="builtintype" id="664376">string</span><span class="op" id="664382">(</span><span class="ident" id="664383">output</span><span class="op" id="664389">)</span><span class="op" id="664390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664397">childPpid</span>&nbsp;<span class="op" id="664407">:=</span>&nbsp;<span class="builtintype" id="664410">string</span><span class="op" id="664416">(</span><span class="ident" id="664417">output</span><span class="op" id="664423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664426">ourPid</span>&nbsp;<span class="op" id="664433">:=</span>&nbsp;<span class="ident" id="664436">fmt</span><span class="op" id="664439">.</span><span class="ident" id="664440">Sprintf</span><span class="op" id="664447">(</span><span class="string" id="664448">&#34;%d&#34;</span><span class="op" id="664452">,</span>&nbsp;<span class="ident" id="664454">Getpid</span><span class="op" id="664460">(</span><span class="op" id="664461">)</span><span class="op" id="664462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="664465">if</span>&nbsp;<span class="ident" id="664468">childPpid</span>&nbsp;<span class="op" id="664478">!=</span>&nbsp;<span class="ident" id="664481">ourPid</span>&nbsp;<span class="op" id="664488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664492">t</span><span class="op" id="664493">.</span><span class="ident" id="664494">Fatalf</span><span class="op" id="664500">(</span><span class="string" id="664501">&#34;Child&nbsp;process&nbsp;reports&nbsp;parent&nbsp;process&nbsp;id&nbsp;&#39;%v&#39;,&nbsp;expected&nbsp;&#39;%v&#39;&#34;</span><span class="op" id="664562">,</span>&nbsp;<span class="ident" id="664564">childPpid</span><span class="op" id="664573">,</span>&nbsp;<span class="ident" id="664575">ourPid</span><span class="op" id="664581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664584">}</span><br>
<span class="lineno">1390</span><span class="op" id="664586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="664589">func</span>&nbsp;<span class="ident" id="664594">TestKillFindProcess</span><span class="op" id="664613">(</span><span class="ident" id="664614">t</span>&nbsp;<span class="op" id="664616">*</span><span class="ident" id="664617">testing</span><span class="op" id="664624">.</span><span class="ident" id="664625">T</span><span class="op" id="664626">)</span>&nbsp;<span class="op" id="664628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664631">testKillProcess</span><span class="op" id="664646">(</span><span class="ident" id="664647">t</span><span class="op" id="664648">,</span>&nbsp;<span class="keyword" id="664650">func</span><span class="op" id="664654">(</span><span class="ident" id="664655">p</span>&nbsp;<span class="op" id="664657">*</span><span class="ident" id="664658">Process</span><span class="op" id="664665">)</span>&nbsp;<span class="op" id="664667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664671">p2</span><span class="op" id="664673">,</span>&nbsp;<span class="ident" id="664675">err</span>&nbsp;<span class="op" id="664679">:=</span>&nbsp;<span class="ident" id="664682">FindProcess</span><span class="op" id="664693">(</span><span class="ident" id="664694">p</span><span class="op" id="664695">.</span><span class="ident" id="664696">Pid</span><span class="op" id="664699">)</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="664703">if</span>&nbsp;<span class="ident" id="664706">err</span>&nbsp;<span class="op" id="664710">!=</span>&nbsp;<span class="ident" id="664713">nil</span>&nbsp;<span class="op" id="664717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664722">t</span><span class="op" id="664723">.</span><span class="ident" id="664724">Fatalf</span><span class="op" id="664730">(</span><span class="string" id="664731">&#34;Failed&nbsp;to&nbsp;find&nbsp;test&nbsp;process:&nbsp;%v&#34;</span><span class="op" id="664764">,</span>&nbsp;<span class="ident" id="664766">err</span><span class="op" id="664769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664777">err</span>&nbsp;<span class="op" id="664781">=</span>&nbsp;<span class="ident" id="664783">p2</span><span class="op" id="664785">.</span><span class="ident" id="664786">Kill</span><span class="op" id="664790">(</span><span class="op" id="664791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="664795">if</span>&nbsp;<span class="ident" id="664798">err</span>&nbsp;<span class="op" id="664802">!=</span>&nbsp;<span class="ident" id="664805">nil</span>&nbsp;<span class="op" id="664809">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664814">t</span><span class="op" id="664815">.</span><span class="ident" id="664816">Fatalf</span><span class="op" id="664822">(</span><span class="string" id="664823">&#34;Failed&nbsp;to&nbsp;kill&nbsp;test&nbsp;process:&nbsp;%v&#34;</span><span class="op" id="664856">,</span>&nbsp;<span class="ident" id="664858">err</span><span class="op" id="664861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664868">}</span><span class="op" id="664869">)</span><br>
<span class="lineno"></span><span class="op" id="664871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1405</span><span class="keyword" id="664874">var</span>&nbsp;<span class="ident" id="664878">nilFileMethodTests</span>&nbsp;<span class="op" id="664897">=</span>&nbsp;<span class="op" id="664899">[</span><span class="op" id="664900">]</span><span class="keyword" id="664901">struct</span>&nbsp;<span class="op" id="664908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664911">name</span>&nbsp;<span class="builtintype" id="664916">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="664924">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="664929">func</span><span class="op" id="664933">(</span><span class="op" id="664934">*</span><span class="ident" id="664935">File</span><span class="op" id="664939">)</span>&nbsp;<span class="builtintype" id="664941">error</span><br>
<span class="lineno"></span><span class="op" id="664947">}</span><span class="op" id="664948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="664951">{</span><span class="string" id="664952">&#34;Chdir&#34;</span><span class="op" id="664959">,</span>&nbsp;<span class="keyword" id="664961">func</span><span class="op" id="664965">(</span><span class="ident" id="664966">f</span>&nbsp;<span class="op" id="664968">*</span><span class="ident" id="664969">File</span><span class="op" id="664973">)</span>&nbsp;<span class="builtintype" id="664975">error</span>&nbsp;<span class="op" id="664981">{</span>&nbsp;<span class="keyword" id="664983">return</span>&nbsp;<span class="ident" id="664990">f</span><span class="op" id="664991">.</span><span class="ident" id="664992">Chdir</span><span class="op" id="664997">(</span><span class="op" id="664998">)</span>&nbsp;<span class="op" id="665000">}</span><span class="op" id="665001">}</span><span class="op" id="665002">,</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665005">{</span><span class="string" id="665006">&#34;Close&#34;</span><span class="op" id="665013">,</span>&nbsp;<span class="keyword" id="665015">func</span><span class="op" id="665019">(</span><span class="ident" id="665020">f</span>&nbsp;<span class="op" id="665022">*</span><span class="ident" id="665023">File</span><span class="op" id="665027">)</span>&nbsp;<span class="builtintype" id="665029">error</span>&nbsp;<span class="op" id="665035">{</span>&nbsp;<span class="keyword" id="665037">return</span>&nbsp;<span class="ident" id="665044">f</span><span class="op" id="665045">.</span><span class="ident" id="665046">Close</span><span class="op" id="665051">(</span><span class="op" id="665052">)</span>&nbsp;<span class="op" id="665054">}</span><span class="op" id="665055">}</span><span class="op" id="665056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665059">{</span><span class="string" id="665060">&#34;Chmod&#34;</span><span class="op" id="665067">,</span>&nbsp;<span class="keyword" id="665069">func</span><span class="op" id="665073">(</span><span class="ident" id="665074">f</span>&nbsp;<span class="op" id="665076">*</span><span class="ident" id="665077">File</span><span class="op" id="665081">)</span>&nbsp;<span class="builtintype" id="665083">error</span>&nbsp;<span class="op" id="665089">{</span>&nbsp;<span class="keyword" id="665091">return</span>&nbsp;<span class="ident" id="665098">f</span><span class="op" id="665099">.</span><span class="ident" id="665100">Chmod</span><span class="op" id="665105">(</span><span class="num" id="665106">0</span><span class="op" id="665107">)</span>&nbsp;<span class="op" id="665109">}</span><span class="op" id="665110">}</span><span class="op" id="665111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665114">{</span><span class="string" id="665115">&#34;Chown&#34;</span><span class="op" id="665122">,</span>&nbsp;<span class="keyword" id="665124">func</span><span class="op" id="665128">(</span><span class="ident" id="665129">f</span>&nbsp;<span class="op" id="665131">*</span><span class="ident" id="665132">File</span><span class="op" id="665136">)</span>&nbsp;<span class="builtintype" id="665138">error</span>&nbsp;<span class="op" id="665144">{</span>&nbsp;<span class="keyword" id="665146">return</span>&nbsp;<span class="ident" id="665153">f</span><span class="op" id="665154">.</span><span class="ident" id="665155">Chown</span><span class="op" id="665160">(</span><span class="num" id="665161">0</span><span class="op" id="665162">,</span>&nbsp;<span class="num" id="665164">0</span><span class="op" id="665165">)</span>&nbsp;<span class="op" id="665167">}</span><span class="op" id="665168">}</span><span class="op" id="665169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665172">{</span><span class="string" id="665173">&#34;Read&#34;</span><span class="op" id="665179">,</span>&nbsp;<span class="keyword" id="665181">func</span><span class="op" id="665185">(</span><span class="ident" id="665186">f</span>&nbsp;<span class="op" id="665188">*</span><span class="ident" id="665189">File</span><span class="op" id="665193">)</span>&nbsp;<span class="builtintype" id="665195">error</span>&nbsp;<span class="op" id="665201">{</span>&nbsp;<span class="ident" id="665203">_</span><span class="op" id="665204">,</span>&nbsp;<span class="ident" id="665206">err</span>&nbsp;<span class="op" id="665210">:=</span>&nbsp;<span class="ident" id="665213">f</span><span class="op" id="665214">.</span><span class="ident" id="665215">Read</span><span class="op" id="665219">(</span><span class="builtinfunc" id="665220">make</span><span class="op" id="665224">(</span><span class="op" id="665225">[</span><span class="op" id="665226">]</span><span class="builtintype" id="665227">byte</span><span class="op" id="665231">,</span>&nbsp;<span class="num" id="665233">0</span><span class="op" id="665234">)</span><span class="op" id="665235">)</span><span class="op" id="665236">;</span>&nbsp;<span class="keyword" id="665238">return</span>&nbsp;<span class="ident" id="665245">err</span>&nbsp;<span class="op" id="665249">}</span><span class="op" id="665250">}</span><span class="op" id="665251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665254">{</span><span class="string" id="665255">&#34;ReadAt&#34;</span><span class="op" id="665263">,</span>&nbsp;<span class="keyword" id="665265">func</span><span class="op" id="665269">(</span><span class="ident" id="665270">f</span>&nbsp;<span class="op" id="665272">*</span><span class="ident" id="665273">File</span><span class="op" id="665277">)</span>&nbsp;<span class="builtintype" id="665279">error</span>&nbsp;<span class="op" id="665285">{</span>&nbsp;<span class="ident" id="665287">_</span><span class="op" id="665288">,</span>&nbsp;<span class="ident" id="665290">err</span>&nbsp;<span class="op" id="665294">:=</span>&nbsp;<span class="ident" id="665297">f</span><span class="op" id="665298">.</span><span class="ident" id="665299">ReadAt</span><span class="op" id="665305">(</span><span class="builtinfunc" id="665306">make</span><span class="op" id="665310">(</span><span class="op" id="665311">[</span><span class="op" id="665312">]</span><span class="builtintype" id="665313">byte</span><span class="op" id="665317">,</span>&nbsp;<span class="num" id="665319">0</span><span class="op" id="665320">)</span><span class="op" id="665321">,</span>&nbsp;<span class="num" id="665323">0</span><span class="op" id="665324">)</span><span class="op" id="665325">;</span>&nbsp;<span class="keyword" id="665327">return</span>&nbsp;<span class="ident" id="665334">err</span>&nbsp;<span class="op" id="665338">}</span><span class="op" id="665339">}</span><span class="op" id="665340">,</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665343">{</span><span class="string" id="665344">&#34;Readdir&#34;</span><span class="op" id="665353">,</span>&nbsp;<span class="keyword" id="665355">func</span><span class="op" id="665359">(</span><span class="ident" id="665360">f</span>&nbsp;<span class="op" id="665362">*</span><span class="ident" id="665363">File</span><span class="op" id="665367">)</span>&nbsp;<span class="builtintype" id="665369">error</span>&nbsp;<span class="op" id="665375">{</span>&nbsp;<span class="ident" id="665377">_</span><span class="op" id="665378">,</span>&nbsp;<span class="ident" id="665380">err</span>&nbsp;<span class="op" id="665384">:=</span>&nbsp;<span class="ident" id="665387">f</span><span class="op" id="665388">.</span><span class="ident" id="665389">Readdir</span><span class="op" id="665396">(</span><span class="num" id="665397">1</span><span class="op" id="665398">)</span><span class="op" id="665399">;</span>&nbsp;<span class="keyword" id="665401">return</span>&nbsp;<span class="ident" id="665408">err</span>&nbsp;<span class="op" id="665412">}</span><span class="op" id="665413">}</span><span class="op" id="665414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665417">{</span><span class="string" id="665418">&#34;Readdirnames&#34;</span><span class="op" id="665432">,</span>&nbsp;<span class="keyword" id="665434">func</span><span class="op" id="665438">(</span><span class="ident" id="665439">f</span>&nbsp;<span class="op" id="665441">*</span><span class="ident" id="665442">File</span><span class="op" id="665446">)</span>&nbsp;<span class="builtintype" id="665448">error</span>&nbsp;<span class="op" id="665454">{</span>&nbsp;<span class="ident" id="665456">_</span><span class="op" id="665457">,</span>&nbsp;<span class="ident" id="665459">err</span>&nbsp;<span class="op" id="665463">:=</span>&nbsp;<span class="ident" id="665466">f</span><span class="op" id="665467">.</span><span class="ident" id="665468">Readdirnames</span><span class="op" id="665480">(</span><span class="num" id="665481">1</span><span class="op" id="665482">)</span><span class="op" id="665483">;</span>&nbsp;<span class="keyword" id="665485">return</span>&nbsp;<span class="ident" id="665492">err</span>&nbsp;<span class="op" id="665496">}</span><span class="op" id="665497">}</span><span class="op" id="665498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665501">{</span><span class="string" id="665502">&#34;Seek&#34;</span><span class="op" id="665508">,</span>&nbsp;<span class="keyword" id="665510">func</span><span class="op" id="665514">(</span><span class="ident" id="665515">f</span>&nbsp;<span class="op" id="665517">*</span><span class="ident" id="665518">File</span><span class="op" id="665522">)</span>&nbsp;<span class="builtintype" id="665524">error</span>&nbsp;<span class="op" id="665530">{</span>&nbsp;<span class="ident" id="665532">_</span><span class="op" id="665533">,</span>&nbsp;<span class="ident" id="665535">err</span>&nbsp;<span class="op" id="665539">:=</span>&nbsp;<span class="ident" id="665542">f</span><span class="op" id="665543">.</span><span class="ident" id="665544">Seek</span><span class="op" id="665548">(</span><span class="num" id="665549">0</span><span class="op" id="665550">,</span>&nbsp;<span class="num" id="665552">0</span><span class="op" id="665553">)</span><span class="op" id="665554">;</span>&nbsp;<span class="keyword" id="665556">return</span>&nbsp;<span class="ident" id="665563">err</span>&nbsp;<span class="op" id="665567">}</span><span class="op" id="665568">}</span><span class="op" id="665569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665572">{</span><span class="string" id="665573">&#34;Stat&#34;</span><span class="op" id="665579">,</span>&nbsp;<span class="keyword" id="665581">func</span><span class="op" id="665585">(</span><span class="ident" id="665586">f</span>&nbsp;<span class="op" id="665588">*</span><span class="ident" id="665589">File</span><span class="op" id="665593">)</span>&nbsp;<span class="builtintype" id="665595">error</span>&nbsp;<span class="op" id="665601">{</span>&nbsp;<span class="ident" id="665603">_</span><span class="op" id="665604">,</span>&nbsp;<span class="ident" id="665606">err</span>&nbsp;<span class="op" id="665610">:=</span>&nbsp;<span class="ident" id="665613">f</span><span class="op" id="665614">.</span><span class="ident" id="665615">Stat</span><span class="op" id="665619">(</span><span class="op" id="665620">)</span><span class="op" id="665621">;</span>&nbsp;<span class="keyword" id="665623">return</span>&nbsp;<span class="ident" id="665630">err</span>&nbsp;<span class="op" id="665634">}</span><span class="op" id="665635">}</span><span class="op" id="665636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665639">{</span><span class="string" id="665640">&#34;Sync&#34;</span><span class="op" id="665646">,</span>&nbsp;<span class="keyword" id="665648">func</span><span class="op" id="665652">(</span><span class="ident" id="665653">f</span>&nbsp;<span class="op" id="665655">*</span><span class="ident" id="665656">File</span><span class="op" id="665660">)</span>&nbsp;<span class="builtintype" id="665662">error</span>&nbsp;<span class="op" id="665668">{</span>&nbsp;<span class="keyword" id="665670">return</span>&nbsp;<span class="ident" id="665677">f</span><span class="op" id="665678">.</span><span class="ident" id="665679">Sync</span><span class="op" id="665683">(</span><span class="op" id="665684">)</span>&nbsp;<span class="op" id="665686">}</span><span class="op" id="665687">}</span><span class="op" id="665688">,</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665691">{</span><span class="string" id="665692">&#34;Truncate&#34;</span><span class="op" id="665702">,</span>&nbsp;<span class="keyword" id="665704">func</span><span class="op" id="665708">(</span><span class="ident" id="665709">f</span>&nbsp;<span class="op" id="665711">*</span><span class="ident" id="665712">File</span><span class="op" id="665716">)</span>&nbsp;<span class="builtintype" id="665718">error</span>&nbsp;<span class="op" id="665724">{</span>&nbsp;<span class="keyword" id="665726">return</span>&nbsp;<span class="ident" id="665733">f</span><span class="op" id="665734">.</span><span class="ident" id="665735">Truncate</span><span class="op" id="665743">(</span><span class="num" id="665744">0</span><span class="op" id="665745">)</span>&nbsp;<span class="op" id="665747">}</span><span class="op" id="665748">}</span><span class="op" id="665749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665752">{</span><span class="string" id="665753">&#34;Write&#34;</span><span class="op" id="665760">,</span>&nbsp;<span class="keyword" id="665762">func</span><span class="op" id="665766">(</span><span class="ident" id="665767">f</span>&nbsp;<span class="op" id="665769">*</span><span class="ident" id="665770">File</span><span class="op" id="665774">)</span>&nbsp;<span class="builtintype" id="665776">error</span>&nbsp;<span class="op" id="665782">{</span>&nbsp;<span class="ident" id="665784">_</span><span class="op" id="665785">,</span>&nbsp;<span class="ident" id="665787">err</span>&nbsp;<span class="op" id="665791">:=</span>&nbsp;<span class="ident" id="665794">f</span><span class="op" id="665795">.</span><span class="ident" id="665796">Write</span><span class="op" id="665801">(</span><span class="builtinfunc" id="665802">make</span><span class="op" id="665806">(</span><span class="op" id="665807">[</span><span class="op" id="665808">]</span><span class="builtintype" id="665809">byte</span><span class="op" id="665813">,</span>&nbsp;<span class="num" id="665815">0</span><span class="op" id="665816">)</span><span class="op" id="665817">)</span><span class="op" id="665818">;</span>&nbsp;<span class="keyword" id="665820">return</span>&nbsp;<span class="ident" id="665827">err</span>&nbsp;<span class="op" id="665831">}</span><span class="op" id="665832">}</span><span class="op" id="665833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665836">{</span><span class="string" id="665837">&#34;WriteAt&#34;</span><span class="op" id="665846">,</span>&nbsp;<span class="keyword" id="665848">func</span><span class="op" id="665852">(</span><span class="ident" id="665853">f</span>&nbsp;<span class="op" id="665855">*</span><span class="ident" id="665856">File</span><span class="op" id="665860">)</span>&nbsp;<span class="builtintype" id="665862">error</span>&nbsp;<span class="op" id="665868">{</span>&nbsp;<span class="ident" id="665870">_</span><span class="op" id="665871">,</span>&nbsp;<span class="ident" id="665873">err</span>&nbsp;<span class="op" id="665877">:=</span>&nbsp;<span class="ident" id="665880">f</span><span class="op" id="665881">.</span><span class="ident" id="665882">WriteAt</span><span class="op" id="665889">(</span><span class="builtinfunc" id="665890">make</span><span class="op" id="665894">(</span><span class="op" id="665895">[</span><span class="op" id="665896">]</span><span class="builtintype" id="665897">byte</span><span class="op" id="665901">,</span>&nbsp;<span class="num" id="665903">0</span><span class="op" id="665904">)</span><span class="op" id="665905">,</span>&nbsp;<span class="num" id="665907">0</span><span class="op" id="665908">)</span><span class="op" id="665909">;</span>&nbsp;<span class="keyword" id="665911">return</span>&nbsp;<span class="ident" id="665918">err</span>&nbsp;<span class="op" id="665922">}</span><span class="op" id="665923">}</span><span class="op" id="665924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="665927">{</span><span class="string" id="665928">&#34;WriteString&#34;</span><span class="op" id="665941">,</span>&nbsp;<span class="keyword" id="665943">func</span><span class="op" id="665947">(</span><span class="ident" id="665948">f</span>&nbsp;<span class="op" id="665950">*</span><span class="ident" id="665951">File</span><span class="op" id="665955">)</span>&nbsp;<span class="builtintype" id="665957">error</span>&nbsp;<span class="op" id="665963">{</span>&nbsp;<span class="ident" id="665965">_</span><span class="op" id="665966">,</span>&nbsp;<span class="ident" id="665968">err</span>&nbsp;<span class="op" id="665972">:=</span>&nbsp;<span class="ident" id="665975">f</span><span class="op" id="665976">.</span><span class="ident" id="665977">WriteString</span><span class="op" id="665988">(</span><span class="string" id="665989">&#34;&#34;</span><span class="op" id="665991">)</span><span class="op" id="665992">;</span>&nbsp;<span class="keyword" id="665994">return</span>&nbsp;<span class="ident" id="666001">err</span>&nbsp;<span class="op" id="666005">}</span><span class="op" id="666006">}</span><span class="op" id="666007">,</span><br>
<span class="lineno"></span><span class="op" id="666009">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="666012">//&nbsp;Test&nbsp;that&nbsp;all&nbsp;File&nbsp;methods&nbsp;give&nbsp;ErrInvalid&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="666082">func</span>&nbsp;<span class="ident" id="666087">TestNilFileMethods</span><span class="op" id="666105">(</span><span class="ident" id="666106">t</span>&nbsp;<span class="op" id="666108">*</span><span class="ident" id="666109">testing</span><span class="op" id="666116">.</span><span class="ident" id="666117">T</span><span class="op" id="666118">)</span>&nbsp;<span class="op" id="666120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666123">for</span>&nbsp;<span class="ident" id="666127">_</span><span class="op" id="666128">,</span>&nbsp;<span class="ident" id="666130">tt</span>&nbsp;<span class="op" id="666133">:=</span>&nbsp;<span class="keyword" id="666136">range</span>&nbsp;<span class="ident" id="666142">nilFileMethodTests</span>&nbsp;<span class="op" id="666161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666165">var</span>&nbsp;<span class="ident" id="666169">file</span>&nbsp;<span class="op" id="666174">*</span><span class="ident" id="666175">File</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666182">got</span>&nbsp;<span class="op" id="666186">:=</span>&nbsp;<span class="ident" id="666189">tt</span><span class="op" id="666191">.</span><span class="ident" id="666192">f</span><span class="op" id="666193">(</span><span class="ident" id="666194">file</span><span class="op" id="666198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666202">if</span>&nbsp;<span class="ident" id="666205">got</span>&nbsp;<span class="op" id="666209">!=</span>&nbsp;<span class="ident" id="666212">ErrInvalid</span>&nbsp;<span class="op" id="666223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666228">t</span><span class="op" id="666229">.</span><span class="ident" id="666230">Errorf</span><span class="op" id="666236">(</span><span class="string" id="666237">&#34;%v&nbsp;should&nbsp;fail&nbsp;when&nbsp;f&nbsp;is&nbsp;nil;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="666275">,</span>&nbsp;<span class="ident" id="666277">tt</span><span class="op" id="666279">.</span><span class="ident" id="666280">name</span><span class="op" id="666284">,</span>&nbsp;<span class="ident" id="666286">got</span><span class="op" id="666289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="666293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="666296">}</span><br>
<span class="lineno">1435</span><span class="op" id="666298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="666301">func</span>&nbsp;<span class="ident" id="666306">mkdirTree</span><span class="op" id="666315">(</span><span class="ident" id="666316">t</span>&nbsp;<span class="op" id="666318">*</span><span class="ident" id="666319">testing</span><span class="op" id="666326">.</span><span class="ident" id="666327">T</span><span class="op" id="666328">,</span>&nbsp;<span class="ident" id="666330">root</span>&nbsp;<span class="builtintype" id="666335">string</span><span class="op" id="666341">,</span>&nbsp;<span class="ident" id="666343">level</span><span class="op" id="666348">,</span>&nbsp;<span class="ident" id="666350">max</span>&nbsp;<span class="builtintype" id="666354">int</span><span class="op" id="666357">)</span>&nbsp;<span class="op" id="666359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666362">if</span>&nbsp;<span class="ident" id="666365">level</span>&nbsp;<span class="op" id="666371">&gt;=</span>&nbsp;<span class="ident" id="666374">max</span>&nbsp;<span class="op" id="666378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666382">return</span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="666390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666393">level</span><span class="op" id="666398">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666402">for</span>&nbsp;<span class="ident" id="666406">i</span>&nbsp;<span class="op" id="666408">:=</span>&nbsp;<span class="string" id="666411">&#39;a&#39;</span><span class="op" id="666414">;</span>&nbsp;<span class="ident" id="666416">i</span>&nbsp;<span class="op" id="666418">&lt;</span>&nbsp;<span class="string" id="666420">&#39;c&#39;</span><span class="op" id="666423">;</span>&nbsp;<span class="ident" id="666425">i</span><span class="op" id="666426">++</span>&nbsp;<span class="op" id="666429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666433">dir</span>&nbsp;<span class="op" id="666437">:=</span>&nbsp;<span class="ident" id="666440">filepath</span><span class="op" id="666448">.</span><span class="ident" id="666449">Join</span><span class="op" id="666453">(</span><span class="ident" id="666454">root</span><span class="op" id="666458">,</span>&nbsp;<span class="builtintype" id="666460">string</span><span class="op" id="666466">(</span><span class="ident" id="666467">i</span><span class="op" id="666468">)</span><span class="op" id="666469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666473">if</span>&nbsp;<span class="ident" id="666476">err</span>&nbsp;<span class="op" id="666480">:=</span>&nbsp;<span class="ident" id="666483">Mkdir</span><span class="op" id="666488">(</span><span class="ident" id="666489">dir</span><span class="op" id="666492">,</span>&nbsp;<span class="num" id="666494">0700</span><span class="op" id="666498">)</span><span class="op" id="666499">;</span>&nbsp;<span class="ident" id="666501">err</span>&nbsp;<span class="op" id="666505">!=</span>&nbsp;<span class="ident" id="666508">nil</span>&nbsp;<span class="op" id="666512">{</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666517">t</span><span class="op" id="666518">.</span><span class="ident" id="666519">Fatal</span><span class="op" id="666524">(</span><span class="ident" id="666525">err</span><span class="op" id="666528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="666532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666536">mkdirTree</span><span class="op" id="666545">(</span><span class="ident" id="666546">t</span><span class="op" id="666547">,</span>&nbsp;<span class="ident" id="666549">dir</span><span class="op" id="666552">,</span>&nbsp;<span class="ident" id="666554">level</span><span class="op" id="666559">,</span>&nbsp;<span class="ident" id="666561">max</span><span class="op" id="666564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="666567">}</span><br>
<span class="lineno"></span><span class="op" id="666569">}</span><br>
<span class="lineno">1450</span><br>
<span class="lineno"></span><span class="comment" id="666572">//&nbsp;Test&nbsp;that&nbsp;simultaneous&nbsp;RemoveAll&nbsp;do&nbsp;not&nbsp;report&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="666632">//&nbsp;As&nbsp;long&nbsp;as&nbsp;it&nbsp;gets&nbsp;removed,&nbsp;we&nbsp;should&nbsp;be&nbsp;happy.</span><br>
<span class="lineno"></span><span class="keyword" id="666683">func</span>&nbsp;<span class="ident" id="666688">TestRemoveAllRace</span><span class="op" id="666705">(</span><span class="ident" id="666706">t</span>&nbsp;<span class="op" id="666708">*</span><span class="ident" id="666709">testing</span><span class="op" id="666716">.</span><span class="ident" id="666717">T</span><span class="op" id="666718">)</span>&nbsp;<span class="op" id="666720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="666723">if</span>&nbsp;<span class="ident" id="666726">runtime</span><span class="op" id="666733">.</span><span class="ident" id="666734">GOOS</span>&nbsp;<span class="op" id="666739">==</span>&nbsp;<span class="string" id="666742">&#34;windows&#34;</span>&nbsp;<span class="op" id="666752">{</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="666756">//&nbsp;Windows&nbsp;has&nbsp;very&nbsp;strict&nbsp;rules&nbsp;about&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="666809">//&nbsp;removing&nbsp;directories&nbsp;while&nbsp;someone&nbsp;else&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="666858">//&nbsp;them&nbsp;open.&nbsp;The&nbsp;racing&nbsp;doesn&#39;t&nbsp;work&nbsp;out&nbsp;nicely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="666909">//&nbsp;like&nbsp;it&nbsp;does&nbsp;on&nbsp;Unix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666936">t</span><span class="op" id="666937">.</span><span class="ident" id="666938">Skip</span><span class="op" id="666942">(</span><span class="string" id="666943">&#34;skipping&nbsp;on&nbsp;windows&#34;</span><span class="op" id="666964">)</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="666967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="666971">n</span>&nbsp;<span class="op" id="666973">:=</span>&nbsp;<span class="ident" id="666976">runtime</span><span class="op" id="666983">.</span><span class="ident" id="666984">GOMAXPROCS</span><span class="op" id="666994">(</span><span class="num" id="666995">16</span><span class="op" id="666997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667000">defer</span>&nbsp;<span class="ident" id="667006">runtime</span><span class="op" id="667013">.</span><span class="ident" id="667014">GOMAXPROCS</span><span class="op" id="667024">(</span><span class="ident" id="667025">n</span><span class="op" id="667026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667029">root</span><span class="op" id="667033">,</span>&nbsp;<span class="ident" id="667035">err</span>&nbsp;<span class="op" id="667039">:=</span>&nbsp;<span class="ident" id="667042">ioutil</span><span class="op" id="667048">.</span><span class="ident" id="667049">TempDir</span><span class="op" id="667056">(</span><span class="string" id="667057">&#34;&#34;</span><span class="op" id="667059">,</span>&nbsp;<span class="string" id="667061">&#34;issue&#34;</span><span class="op" id="667068">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667071">if</span>&nbsp;<span class="ident" id="667074">err</span>&nbsp;<span class="op" id="667078">!=</span>&nbsp;<span class="ident" id="667081">nil</span>&nbsp;<span class="op" id="667085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667089">t</span><span class="op" id="667090">.</span><span class="ident" id="667091">Fatal</span><span class="op" id="667096">(</span><span class="ident" id="667097">err</span><span class="op" id="667100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="667103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667106">mkdirTree</span><span class="op" id="667115">(</span><span class="ident" id="667116">t</span><span class="op" id="667117">,</span>&nbsp;<span class="ident" id="667119">root</span><span class="op" id="667123">,</span>&nbsp;<span class="num" id="667125">1</span><span class="op" id="667126">,</span>&nbsp;<span class="num" id="667128">6</span><span class="op" id="667129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667132">hold</span>&nbsp;<span class="op" id="667137">:=</span>&nbsp;<span class="builtinfunc" id="667140">make</span><span class="op" id="667144">(</span><span class="keyword" id="667145">chan</span>&nbsp;<span class="keyword" id="667150">struct</span><span class="op" id="667156">{</span><span class="op" id="667157">}</span><span class="op" id="667158">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667161">var</span>&nbsp;<span class="ident" id="667165">wg</span>&nbsp;<span class="ident" id="667168">sync</span><span class="op" id="667172">.</span><span class="ident" id="667173">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667184">for</span>&nbsp;<span class="ident" id="667188">i</span>&nbsp;<span class="op" id="667190">:=</span>&nbsp;<span class="num" id="667193">0</span><span class="op" id="667194">;</span>&nbsp;<span class="ident" id="667196">i</span>&nbsp;<span class="op" id="667198">&lt;</span>&nbsp;<span class="num" id="667200">4</span><span class="op" id="667201">;</span>&nbsp;<span class="ident" id="667203">i</span><span class="op" id="667204">++</span>&nbsp;<span class="op" id="667207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667211">wg</span><span class="op" id="667213">.</span><span class="ident" id="667214">Add</span><span class="op" id="667217">(</span><span class="num" id="667218">1</span><span class="op" id="667219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667223">go</span>&nbsp;<span class="keyword" id="667226">func</span><span class="op" id="667230">(</span><span class="op" id="667231">)</span>&nbsp;<span class="op" id="667233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667238">defer</span>&nbsp;<span class="ident" id="667244">wg</span><span class="op" id="667246">.</span><span class="ident" id="667247">Done</span><span class="op" id="667251">(</span><span class="op" id="667252">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="667257">&lt;-</span><span class="ident" id="667259">hold</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667267">err</span>&nbsp;<span class="op" id="667271">:=</span>&nbsp;<span class="ident" id="667274">RemoveAll</span><span class="op" id="667283">(</span><span class="ident" id="667284">root</span><span class="op" id="667288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="667293">if</span>&nbsp;<span class="ident" id="667296">err</span>&nbsp;<span class="op" id="667300">!=</span>&nbsp;<span class="ident" id="667303">nil</span>&nbsp;<span class="op" id="667307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667313">t</span><span class="op" id="667314">.</span><span class="ident" id="667315">Errorf</span><span class="op" id="667321">(</span><span class="string" id="667322">&#34;unexpected&nbsp;error:&nbsp;%T,&nbsp;%q&#34;</span><span class="op" id="667348">,</span>&nbsp;<span class="ident" id="667350">err</span><span class="op" id="667353">,</span>&nbsp;<span class="ident" id="667355">err</span><span class="op" id="667358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="667363">}</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="667367">}</span><span class="op" id="667368">(</span><span class="op" id="667369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="667372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="667375">close</span><span class="op" id="667380">(</span><span class="ident" id="667381">hold</span><span class="op" id="667385">)</span>&nbsp;<span class="comment" id="667387">//&nbsp;let&nbsp;workers&nbsp;race&nbsp;to&nbsp;remove&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="667423">wg</span><span class="op" id="667425">.</span><span class="ident" id="667426">Wait</span><span class="op" id="667430">(</span><span class="op" id="667431">)</span><br>
<span class="lineno"></span><span class="op" id="667433">}</span>
</div>
</body>
</html>
