<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html" class="current">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6397789">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6397844">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6397898">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6397949">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6398005">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6398082">package</span>&nbsp;<span class="ident" id="6398090">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6398099">import</span>&nbsp;<span class="op" id="6398106">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6398109">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6398115">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6398125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6398128">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6398147">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6398206">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6398269">//</span><br>
<span class="lineno"></span><span class="comment" id="6398272">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6398336">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6398402">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6398474">//</span><br>
<span class="lineno">25</span><span class="comment" id="6398477">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6398541">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6398571">func</span>&nbsp;<span class="ident" id="6398576">Encode</span><span class="op" id="6398582">(</span><span class="ident" id="6398583">dst</span><span class="op" id="6398586">,</span>&nbsp;<span class="ident" id="6398588">src</span>&nbsp;<span class="op" id="6398592">[</span><span class="op" id="6398593">]</span><span class="builtintype" id="6398594">byte</span><span class="op" id="6398598">)</span>&nbsp;<span class="builtintype" id="6398600">int</span>&nbsp;<span class="op" id="6398604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398607">if</span>&nbsp;<span class="builtinfunc" id="6398610">len</span><span class="op" id="6398613">(</span><span class="ident" id="6398614">src</span><span class="op" id="6398617">)</span>&nbsp;<span class="op" id="6398619">==</span>&nbsp;<span class="num" id="6398622">0</span>&nbsp;<span class="op" id="6398624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398628">return</span>&nbsp;<span class="num" id="6398635">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398642">n</span>&nbsp;<span class="op" id="6398644">:=</span>&nbsp;<span class="num" id="6398647">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398650">for</span>&nbsp;<span class="builtinfunc" id="6398654">len</span><span class="op" id="6398657">(</span><span class="ident" id="6398658">src</span><span class="op" id="6398661">)</span>&nbsp;<span class="op" id="6398663">&gt;</span>&nbsp;<span class="num" id="6398665">0</span>&nbsp;<span class="op" id="6398667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398671">dst</span><span class="op" id="6398674">[</span><span class="num" id="6398675">0</span><span class="op" id="6398676">]</span>&nbsp;<span class="op" id="6398678">=</span>&nbsp;<span class="num" id="6398680">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398684">dst</span><span class="op" id="6398687">[</span><span class="num" id="6398688">1</span><span class="op" id="6398689">]</span>&nbsp;<span class="op" id="6398691">=</span>&nbsp;<span class="num" id="6398693">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398697">dst</span><span class="op" id="6398700">[</span><span class="num" id="6398701">2</span><span class="op" id="6398702">]</span>&nbsp;<span class="op" id="6398704">=</span>&nbsp;<span class="num" id="6398706">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398710">dst</span><span class="op" id="6398713">[</span><span class="num" id="6398714">3</span><span class="op" id="6398715">]</span>&nbsp;<span class="op" id="6398717">=</span>&nbsp;<span class="num" id="6398719">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398723">dst</span><span class="op" id="6398726">[</span><span class="num" id="6398727">4</span><span class="op" id="6398728">]</span>&nbsp;<span class="op" id="6398730">=</span>&nbsp;<span class="num" id="6398732">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398737">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398800">var</span>&nbsp;<span class="ident" id="6398804">v</span>&nbsp;<span class="builtintype" id="6398806">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398815">switch</span>&nbsp;<span class="builtinfunc" id="6398822">len</span><span class="op" id="6398825">(</span><span class="ident" id="6398826">src</span><span class="op" id="6398829">)</span>&nbsp;<span class="op" id="6398831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398835">default</span><span class="op" id="6398842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398847">v</span>&nbsp;<span class="op" id="6398849">|=</span>&nbsp;<span class="builtintype" id="6398852">uint32</span><span class="op" id="6398858">(</span><span class="ident" id="6398859">src</span><span class="op" id="6398862">[</span><span class="num" id="6398863">3</span><span class="op" id="6398864">]</span><span class="op" id="6398865">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398870">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398884">case</span>&nbsp;<span class="num" id="6398889">3</span><span class="op" id="6398890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398895">v</span>&nbsp;<span class="op" id="6398897">|=</span>&nbsp;<span class="builtintype" id="6398900">uint32</span><span class="op" id="6398906">(</span><span class="ident" id="6398907">src</span><span class="op" id="6398910">[</span><span class="num" id="6398911">2</span><span class="op" id="6398912">]</span><span class="op" id="6398913">)</span>&nbsp;<span class="op" id="6398915">&lt;&lt;</span>&nbsp;<span class="num" id="6398918">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398923">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398937">case</span>&nbsp;<span class="num" id="6398942">2</span><span class="op" id="6398943">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398948">v</span>&nbsp;<span class="op" id="6398950">|=</span>&nbsp;<span class="builtintype" id="6398953">uint32</span><span class="op" id="6398959">(</span><span class="ident" id="6398960">src</span><span class="op" id="6398963">[</span><span class="num" id="6398964">1</span><span class="op" id="6398965">]</span><span class="op" id="6398966">)</span>&nbsp;<span class="op" id="6398968">&lt;&lt;</span>&nbsp;<span class="num" id="6398971">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398977">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398991">case</span>&nbsp;<span class="num" id="6398996">1</span><span class="op" id="6398997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399002">v</span>&nbsp;<span class="op" id="6399004">|=</span>&nbsp;<span class="builtintype" id="6399007">uint32</span><span class="op" id="6399013">(</span><span class="ident" id="6399014">src</span><span class="op" id="6399017">[</span><span class="num" id="6399018">0</span><span class="op" id="6399019">]</span><span class="op" id="6399020">)</span>&nbsp;<span class="op" id="6399022">&lt;&lt;</span>&nbsp;<span class="num" id="6399025">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399030">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399035">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399082">if</span>&nbsp;<span class="ident" id="6399085">v</span>&nbsp;<span class="op" id="6399087">==</span>&nbsp;<span class="num" id="6399090">0</span>&nbsp;<span class="op" id="6399092">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6399095">len</span><span class="op" id="6399098">(</span><span class="ident" id="6399099">src</span><span class="op" id="6399102">)</span>&nbsp;<span class="op" id="6399104">&gt;=</span>&nbsp;<span class="num" id="6399107">4</span>&nbsp;<span class="op" id="6399109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399114">dst</span><span class="op" id="6399117">[</span><span class="num" id="6399118">0</span><span class="op" id="6399119">]</span>&nbsp;<span class="op" id="6399121">=</span>&nbsp;<span class="string" id="6399123">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399130">dst</span>&nbsp;<span class="op" id="6399134">=</span>&nbsp;<span class="ident" id="6399136">dst</span><span class="op" id="6399139">[</span><span class="num" id="6399140">1</span><span class="op" id="6399141">:</span><span class="op" id="6399142">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399147">src</span>&nbsp;<span class="op" id="6399151">=</span>&nbsp;<span class="ident" id="6399153">src</span><span class="op" id="6399156">[</span><span class="num" id="6399157">4</span><span class="op" id="6399158">:</span><span class="op" id="6399159">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399164">n</span><span class="op" id="6399165">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399171">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399187">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399235">for</span>&nbsp;<span class="ident" id="6399239">i</span>&nbsp;<span class="op" id="6399241">:=</span>&nbsp;<span class="num" id="6399244">4</span><span class="op" id="6399245">;</span>&nbsp;<span class="ident" id="6399247">i</span>&nbsp;<span class="op" id="6399249">&gt;=</span>&nbsp;<span class="num" id="6399252">0</span><span class="op" id="6399253">;</span>&nbsp;<span class="ident" id="6399255">i</span><span class="op" id="6399256">--</span>&nbsp;<span class="op" id="6399259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399264">dst</span><span class="op" id="6399267">[</span><span class="ident" id="6399268">i</span><span class="op" id="6399269">]</span>&nbsp;<span class="op" id="6399271">=</span>&nbsp;<span class="string" id="6399273">&#39;!&#39;</span>&nbsp;<span class="op" id="6399277">+</span>&nbsp;<span class="builtintype" id="6399279">byte</span><span class="op" id="6399283">(</span><span class="ident" id="6399284">v</span><span class="op" id="6399285">%</span><span class="num" id="6399286">85</span><span class="op" id="6399288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399293">v</span>&nbsp;<span class="op" id="6399295">/=</span>&nbsp;<span class="num" id="6399298">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399303">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6399308">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399366">m</span>&nbsp;<span class="op" id="6399368">:=</span>&nbsp;<span class="num" id="6399371">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399375">if</span>&nbsp;<span class="builtinfunc" id="6399378">len</span><span class="op" id="6399381">(</span><span class="ident" id="6399382">src</span><span class="op" id="6399385">)</span>&nbsp;<span class="op" id="6399387">&lt;</span>&nbsp;<span class="num" id="6399389">4</span>&nbsp;<span class="op" id="6399391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399396">m</span>&nbsp;<span class="op" id="6399398">-=</span>&nbsp;<span class="num" id="6399401">4</span>&nbsp;<span class="op" id="6399403">-</span>&nbsp;<span class="builtinfunc" id="6399405">len</span><span class="op" id="6399408">(</span><span class="ident" id="6399409">src</span><span class="op" id="6399412">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399417">src</span>&nbsp;<span class="op" id="6399421">=</span>&nbsp;<span class="ident" id="6399423">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399429">}</span>&nbsp;<span class="keyword" id="6399431">else</span>&nbsp;<span class="op" id="6399436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399441">src</span>&nbsp;<span class="op" id="6399445">=</span>&nbsp;<span class="ident" id="6399447">src</span><span class="op" id="6399450">[</span><span class="num" id="6399451">4</span><span class="op" id="6399452">:</span><span class="op" id="6399453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399461">dst</span>&nbsp;<span class="op" id="6399465">=</span>&nbsp;<span class="ident" id="6399467">dst</span><span class="op" id="6399470">[</span><span class="ident" id="6399471">m</span><span class="op" id="6399472">:</span><span class="op" id="6399473">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399477">n</span>&nbsp;<span class="op" id="6399479">+=</span>&nbsp;<span class="ident" id="6399482">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399488">return</span>&nbsp;<span class="ident" id="6399495">n</span><br>
<span class="lineno"></span><span class="op" id="6399497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6399500">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6399578">func</span>&nbsp;<span class="ident" id="6399583">MaxEncodedLen</span><span class="op" id="6399596">(</span><span class="ident" id="6399597">n</span>&nbsp;<span class="builtintype" id="6399599">int</span><span class="op" id="6399602">)</span>&nbsp;<span class="builtintype" id="6399604">int</span>&nbsp;<span class="op" id="6399608">{</span>&nbsp;<span class="keyword" id="6399610">return</span>&nbsp;<span class="op" id="6399617">(</span><span class="ident" id="6399618">n</span>&nbsp;<span class="op" id="6399620">+</span>&nbsp;<span class="num" id="6399622">3</span><span class="op" id="6399623">)</span>&nbsp;<span class="op" id="6399625">/</span>&nbsp;<span class="num" id="6399627">4</span>&nbsp;<span class="op" id="6399629">*</span>&nbsp;<span class="num" id="6399631">5</span>&nbsp;<span class="op" id="6399633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6399636">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6399705">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6399767">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6399828">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6399896">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6399923">func</span>&nbsp;<span class="ident" id="6399928">NewEncoder</span><span class="op" id="6399938">(</span><span class="ident" id="6399939">w</span>&nbsp;<span class="ident" id="6399941">io</span><span class="op" id="6399943">.</span><span class="ident" id="6399944">Writer</span><span class="op" id="6399950">)</span>&nbsp;<span class="ident" id="6399952">io</span><span class="op" id="6399954">.</span><span class="ident" id="6399955">WriteCloser</span>&nbsp;<span class="op" id="6399967">{</span>&nbsp;<span class="keyword" id="6399969">return</span>&nbsp;<span class="op" id="6399976">&amp;</span><span class="ident" id="6399977">encoder</span><span class="op" id="6399984">{</span><span class="ident" id="6399985">w</span><span class="op" id="6399986">:</span>&nbsp;<span class="ident" id="6399988">w</span><span class="op" id="6399989">}</span>&nbsp;<span class="op" id="6399991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6399994">type</span>&nbsp;<span class="ident" id="6399999">encoder</span>&nbsp;<span class="keyword" id="6400007">struct</span>&nbsp;<span class="op" id="6400014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400017">err</span>&nbsp;&nbsp;<span class="builtintype" id="6400022">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400029">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6400034">io</span><span class="op" id="6400036">.</span><span class="ident" id="6400037">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400045">buf</span>&nbsp;&nbsp;<span class="op" id="6400050">[</span><span class="num" id="6400051">4</span><span class="op" id="6400052">]</span><span class="builtintype" id="6400053">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6400061">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400101">nbuf</span>&nbsp;<span class="builtintype" id="6400106">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6400117">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400144">out</span>&nbsp;&nbsp;<span class="op" id="6400149">[</span><span class="num" id="6400150">1024</span><span class="op" id="6400154">]</span><span class="builtintype" id="6400155">byte</span>&nbsp;<span class="comment" id="6400160">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6400177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6400180">func</span>&nbsp;<span class="op" id="6400185">(</span><span class="ident" id="6400186">e</span>&nbsp;<span class="op" id="6400188">*</span><span class="ident" id="6400189">encoder</span><span class="op" id="6400196">)</span>&nbsp;<span class="ident" id="6400198">Write</span><span class="op" id="6400203">(</span><span class="ident" id="6400204">p</span>&nbsp;<span class="op" id="6400206">[</span><span class="op" id="6400207">]</span><span class="builtintype" id="6400208">byte</span><span class="op" id="6400212">)</span>&nbsp;<span class="op" id="6400214">(</span><span class="ident" id="6400215">n</span>&nbsp;<span class="builtintype" id="6400217">int</span><span class="op" id="6400220">,</span>&nbsp;<span class="ident" id="6400222">err</span>&nbsp;<span class="builtintype" id="6400226">error</span><span class="op" id="6400231">)</span>&nbsp;<span class="op" id="6400233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400236">if</span>&nbsp;<span class="ident" id="6400239">e</span><span class="op" id="6400240">.</span><span class="ident" id="6400241">err</span>&nbsp;<span class="op" id="6400245">!=</span>&nbsp;<span class="ident" id="6400248">nil</span>&nbsp;<span class="op" id="6400252">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400256">return</span>&nbsp;<span class="num" id="6400263">0</span><span class="op" id="6400264">,</span>&nbsp;<span class="ident" id="6400266">e</span><span class="op" id="6400267">.</span><span class="ident" id="6400268">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6400277">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400297">if</span>&nbsp;<span class="ident" id="6400300">e</span><span class="op" id="6400301">.</span><span class="ident" id="6400302">nbuf</span>&nbsp;<span class="op" id="6400307">&gt;</span>&nbsp;<span class="num" id="6400309">0</span>&nbsp;<span class="op" id="6400311">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400315">var</span>&nbsp;<span class="ident" id="6400319">i</span>&nbsp;<span class="builtintype" id="6400321">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400327">for</span>&nbsp;<span class="ident" id="6400331">i</span>&nbsp;<span class="op" id="6400333">=</span>&nbsp;<span class="num" id="6400335">0</span><span class="op" id="6400336">;</span>&nbsp;<span class="ident" id="6400338">i</span>&nbsp;<span class="op" id="6400340">&lt;</span>&nbsp;<span class="builtinfunc" id="6400342">len</span><span class="op" id="6400345">(</span><span class="ident" id="6400346">p</span><span class="op" id="6400347">)</span>&nbsp;<span class="op" id="6400349">&amp;&amp;</span>&nbsp;<span class="ident" id="6400352">e</span><span class="op" id="6400353">.</span><span class="ident" id="6400354">nbuf</span>&nbsp;<span class="op" id="6400359">&lt;</span>&nbsp;<span class="num" id="6400361">4</span><span class="op" id="6400362">;</span>&nbsp;<span class="ident" id="6400364">i</span><span class="op" id="6400365">++</span>&nbsp;<span class="op" id="6400368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400373">e</span><span class="op" id="6400374">.</span><span class="ident" id="6400375">buf</span><span class="op" id="6400378">[</span><span class="ident" id="6400379">e</span><span class="op" id="6400380">.</span><span class="ident" id="6400381">nbuf</span><span class="op" id="6400385">]</span>&nbsp;<span class="op" id="6400387">=</span>&nbsp;<span class="ident" id="6400389">p</span><span class="op" id="6400390">[</span><span class="ident" id="6400391">i</span><span class="op" id="6400392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400397">e</span><span class="op" id="6400398">.</span><span class="ident" id="6400399">nbuf</span><span class="op" id="6400403">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400408">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400412">n</span>&nbsp;<span class="op" id="6400414">+=</span>&nbsp;<span class="ident" id="6400417">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400421">p</span>&nbsp;<span class="op" id="6400423">=</span>&nbsp;<span class="ident" id="6400425">p</span><span class="op" id="6400426">[</span><span class="ident" id="6400427">i</span><span class="op" id="6400428">:</span><span class="op" id="6400429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400433">if</span>&nbsp;<span class="ident" id="6400436">e</span><span class="op" id="6400437">.</span><span class="ident" id="6400438">nbuf</span>&nbsp;<span class="op" id="6400443">&lt;</span>&nbsp;<span class="num" id="6400445">4</span>&nbsp;<span class="op" id="6400447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400452">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400461">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400465">nout</span>&nbsp;<span class="op" id="6400470">:=</span>&nbsp;<span class="ident" id="6400473">Encode</span><span class="op" id="6400479">(</span><span class="ident" id="6400480">e</span><span class="op" id="6400481">.</span><span class="ident" id="6400482">out</span><span class="op" id="6400485">[</span><span class="num" id="6400486">0</span><span class="op" id="6400487">:</span><span class="op" id="6400488">]</span><span class="op" id="6400489">,</span>&nbsp;<span class="ident" id="6400491">e</span><span class="op" id="6400492">.</span><span class="ident" id="6400493">buf</span><span class="op" id="6400496">[</span><span class="num" id="6400497">0</span><span class="op" id="6400498">:</span><span class="op" id="6400499">]</span><span class="op" id="6400500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400504">if</span>&nbsp;<span class="ident" id="6400507">_</span><span class="op" id="6400508">,</span>&nbsp;<span class="ident" id="6400510">e</span><span class="op" id="6400511">.</span><span class="ident" id="6400512">err</span>&nbsp;<span class="op" id="6400516">=</span>&nbsp;<span class="ident" id="6400518">e</span><span class="op" id="6400519">.</span><span class="ident" id="6400520">w</span><span class="op" id="6400521">.</span><span class="ident" id="6400522">Write</span><span class="op" id="6400527">(</span><span class="ident" id="6400528">e</span><span class="op" id="6400529">.</span><span class="ident" id="6400530">out</span><span class="op" id="6400533">[</span><span class="num" id="6400534">0</span><span class="op" id="6400535">:</span><span class="ident" id="6400536">nout</span><span class="op" id="6400540">]</span><span class="op" id="6400541">)</span><span class="op" id="6400542">;</span>&nbsp;<span class="ident" id="6400544">e</span><span class="op" id="6400545">.</span><span class="ident" id="6400546">err</span>&nbsp;<span class="op" id="6400550">!=</span>&nbsp;<span class="ident" id="6400553">nil</span>&nbsp;<span class="op" id="6400557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400562">return</span>&nbsp;<span class="ident" id="6400569">n</span><span class="op" id="6400570">,</span>&nbsp;<span class="ident" id="6400572">e</span><span class="op" id="6400573">.</span><span class="ident" id="6400574">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400584">e</span><span class="op" id="6400585">.</span><span class="ident" id="6400586">nbuf</span>&nbsp;<span class="op" id="6400591">=</span>&nbsp;<span class="num" id="6400593">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6400600">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400627">for</span>&nbsp;<span class="builtinfunc" id="6400631">len</span><span class="op" id="6400634">(</span><span class="ident" id="6400635">p</span><span class="op" id="6400636">)</span>&nbsp;<span class="op" id="6400638">&gt;=</span>&nbsp;<span class="num" id="6400641">4</span>&nbsp;<span class="op" id="6400643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400647">nn</span>&nbsp;<span class="op" id="6400650">:=</span>&nbsp;<span class="builtinfunc" id="6400653">len</span><span class="op" id="6400656">(</span><span class="ident" id="6400657">e</span><span class="op" id="6400658">.</span><span class="ident" id="6400659">out</span><span class="op" id="6400662">)</span>&nbsp;<span class="op" id="6400664">/</span>&nbsp;<span class="num" id="6400666">5</span>&nbsp;<span class="op" id="6400668">*</span>&nbsp;<span class="num" id="6400670">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400674">if</span>&nbsp;<span class="ident" id="6400677">nn</span>&nbsp;<span class="op" id="6400680">&gt;</span>&nbsp;<span class="builtinfunc" id="6400682">len</span><span class="op" id="6400685">(</span><span class="ident" id="6400686">p</span><span class="op" id="6400687">)</span>&nbsp;<span class="op" id="6400689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400694">nn</span>&nbsp;<span class="op" id="6400697">=</span>&nbsp;<span class="builtinfunc" id="6400699">len</span><span class="op" id="6400702">(</span><span class="ident" id="6400703">p</span><span class="op" id="6400704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400712">nn</span>&nbsp;<span class="op" id="6400715">-=</span>&nbsp;<span class="ident" id="6400718">nn</span>&nbsp;<span class="op" id="6400721">%</span>&nbsp;<span class="num" id="6400723">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400727">if</span>&nbsp;<span class="ident" id="6400730">nn</span>&nbsp;<span class="op" id="6400733">&gt;</span>&nbsp;<span class="num" id="6400735">0</span>&nbsp;<span class="op" id="6400737">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400742">nout</span>&nbsp;<span class="op" id="6400747">:=</span>&nbsp;<span class="ident" id="6400750">Encode</span><span class="op" id="6400756">(</span><span class="ident" id="6400757">e</span><span class="op" id="6400758">.</span><span class="ident" id="6400759">out</span><span class="op" id="6400762">[</span><span class="num" id="6400763">0</span><span class="op" id="6400764">:</span><span class="op" id="6400765">]</span><span class="op" id="6400766">,</span>&nbsp;<span class="ident" id="6400768">p</span><span class="op" id="6400769">[</span><span class="num" id="6400770">0</span><span class="op" id="6400771">:</span><span class="ident" id="6400772">nn</span><span class="op" id="6400774">]</span><span class="op" id="6400775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400780">if</span>&nbsp;<span class="ident" id="6400783">_</span><span class="op" id="6400784">,</span>&nbsp;<span class="ident" id="6400786">e</span><span class="op" id="6400787">.</span><span class="ident" id="6400788">err</span>&nbsp;<span class="op" id="6400792">=</span>&nbsp;<span class="ident" id="6400794">e</span><span class="op" id="6400795">.</span><span class="ident" id="6400796">w</span><span class="op" id="6400797">.</span><span class="ident" id="6400798">Write</span><span class="op" id="6400803">(</span><span class="ident" id="6400804">e</span><span class="op" id="6400805">.</span><span class="ident" id="6400806">out</span><span class="op" id="6400809">[</span><span class="num" id="6400810">0</span><span class="op" id="6400811">:</span><span class="ident" id="6400812">nout</span><span class="op" id="6400816">]</span><span class="op" id="6400817">)</span><span class="op" id="6400818">;</span>&nbsp;<span class="ident" id="6400820">e</span><span class="op" id="6400821">.</span><span class="ident" id="6400822">err</span>&nbsp;<span class="op" id="6400826">!=</span>&nbsp;<span class="ident" id="6400829">nil</span>&nbsp;<span class="op" id="6400833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400839">return</span>&nbsp;<span class="ident" id="6400846">n</span><span class="op" id="6400847">,</span>&nbsp;<span class="ident" id="6400849">e</span><span class="op" id="6400850">.</span><span class="ident" id="6400851">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400862">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400866">n</span>&nbsp;<span class="op" id="6400868">+=</span>&nbsp;<span class="ident" id="6400871">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400876">p</span>&nbsp;<span class="op" id="6400878">=</span>&nbsp;<span class="ident" id="6400880">p</span><span class="op" id="6400881">[</span><span class="ident" id="6400882">nn</span><span class="op" id="6400884">:</span><span class="op" id="6400885">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6400892">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400913">for</span>&nbsp;<span class="ident" id="6400917">i</span>&nbsp;<span class="op" id="6400919">:=</span>&nbsp;<span class="num" id="6400922">0</span><span class="op" id="6400923">;</span>&nbsp;<span class="ident" id="6400925">i</span>&nbsp;<span class="op" id="6400927">&lt;</span>&nbsp;<span class="builtinfunc" id="6400929">len</span><span class="op" id="6400932">(</span><span class="ident" id="6400933">p</span><span class="op" id="6400934">)</span><span class="op" id="6400935">;</span>&nbsp;<span class="ident" id="6400937">i</span><span class="op" id="6400938">++</span>&nbsp;<span class="op" id="6400941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400945">e</span><span class="op" id="6400946">.</span><span class="ident" id="6400947">buf</span><span class="op" id="6400950">[</span><span class="ident" id="6400951">i</span><span class="op" id="6400952">]</span>&nbsp;<span class="op" id="6400954">=</span>&nbsp;<span class="ident" id="6400956">p</span><span class="op" id="6400957">[</span><span class="ident" id="6400958">i</span><span class="op" id="6400959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400965">e</span><span class="op" id="6400966">.</span><span class="ident" id="6400967">nbuf</span>&nbsp;<span class="op" id="6400972">=</span>&nbsp;<span class="builtinfunc" id="6400974">len</span><span class="op" id="6400977">(</span><span class="ident" id="6400978">p</span><span class="op" id="6400979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400982">n</span>&nbsp;<span class="op" id="6400984">+=</span>&nbsp;<span class="builtinfunc" id="6400987">len</span><span class="op" id="6400990">(</span><span class="ident" id="6400991">p</span><span class="op" id="6400992">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400995">return</span><br>
<span class="lineno"></span><span class="op" id="6401002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401005">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6401059">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6401112">func</span>&nbsp;<span class="op" id="6401117">(</span><span class="ident" id="6401118">e</span>&nbsp;<span class="op" id="6401120">*</span><span class="ident" id="6401121">encoder</span><span class="op" id="6401128">)</span>&nbsp;<span class="ident" id="6401130">Close</span><span class="op" id="6401135">(</span><span class="op" id="6401136">)</span>&nbsp;<span class="builtintype" id="6401138">error</span>&nbsp;<span class="op" id="6401144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6401147">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401204">if</span>&nbsp;<span class="ident" id="6401207">e</span><span class="op" id="6401208">.</span><span class="ident" id="6401209">err</span>&nbsp;<span class="op" id="6401213">==</span>&nbsp;<span class="ident" id="6401216">nil</span>&nbsp;<span class="op" id="6401220">&amp;&amp;</span>&nbsp;<span class="ident" id="6401223">e</span><span class="op" id="6401224">.</span><span class="ident" id="6401225">nbuf</span>&nbsp;<span class="op" id="6401230">&gt;</span>&nbsp;<span class="num" id="6401232">0</span>&nbsp;<span class="op" id="6401234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401238">nout</span>&nbsp;<span class="op" id="6401243">:=</span>&nbsp;<span class="ident" id="6401246">Encode</span><span class="op" id="6401252">(</span><span class="ident" id="6401253">e</span><span class="op" id="6401254">.</span><span class="ident" id="6401255">out</span><span class="op" id="6401258">[</span><span class="num" id="6401259">0</span><span class="op" id="6401260">:</span><span class="op" id="6401261">]</span><span class="op" id="6401262">,</span>&nbsp;<span class="ident" id="6401264">e</span><span class="op" id="6401265">.</span><span class="ident" id="6401266">buf</span><span class="op" id="6401269">[</span><span class="num" id="6401270">0</span><span class="op" id="6401271">:</span><span class="ident" id="6401272">e</span><span class="op" id="6401273">.</span><span class="ident" id="6401274">nbuf</span><span class="op" id="6401278">]</span><span class="op" id="6401279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401283">e</span><span class="op" id="6401284">.</span><span class="ident" id="6401285">nbuf</span>&nbsp;<span class="op" id="6401290">=</span>&nbsp;<span class="num" id="6401292">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401296">_</span><span class="op" id="6401297">,</span>&nbsp;<span class="ident" id="6401299">e</span><span class="op" id="6401300">.</span><span class="ident" id="6401301">err</span>&nbsp;<span class="op" id="6401305">=</span>&nbsp;<span class="ident" id="6401307">e</span><span class="op" id="6401308">.</span><span class="ident" id="6401309">w</span><span class="op" id="6401310">.</span><span class="ident" id="6401311">Write</span><span class="op" id="6401316">(</span><span class="ident" id="6401317">e</span><span class="op" id="6401318">.</span><span class="ident" id="6401319">out</span><span class="op" id="6401322">[</span><span class="num" id="6401323">0</span><span class="op" id="6401324">:</span><span class="ident" id="6401325">nout</span><span class="op" id="6401329">]</span><span class="op" id="6401330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401336">return</span>&nbsp;<span class="ident" id="6401343">e</span><span class="op" id="6401344">.</span><span class="ident" id="6401345">err</span><br>
<span class="lineno"></span><span class="op" id="6401349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6401352">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6401371">type</span>&nbsp;<span class="ident" id="6401376">CorruptInputError</span>&nbsp;<span class="ident" id="6401394">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6401401">func</span>&nbsp;<span class="op" id="6401406">(</span><span class="ident" id="6401407">e</span>&nbsp;<span class="ident" id="6401409">CorruptInputError</span><span class="op" id="6401426">)</span>&nbsp;<span class="ident" id="6401428">Error</span><span class="op" id="6401433">(</span><span class="op" id="6401434">)</span>&nbsp;<span class="builtintype" id="6401436">string</span>&nbsp;<span class="op" id="6401443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401446">return</span>&nbsp;<span class="string" id="6401453">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6401491">+</span>&nbsp;<span class="ident" id="6401493">strconv</span><span class="op" id="6401500">.</span><span class="ident" id="6401501">FormatInt</span><span class="op" id="6401510">(</span><span class="ident" id="6401511">int64</span><span class="op" id="6401516">(</span><span class="ident" id="6401517">e</span><span class="op" id="6401518">)</span><span class="op" id="6401519">,</span>&nbsp;<span class="num" id="6401521">10</span><span class="op" id="6401523">)</span><br>
<span class="lineno"></span><span class="op" id="6401525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6401528">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6401586">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6401647">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6401711">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6401776">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6401831">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6401895">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6401956">//</span><br>
<span class="lineno"></span><span class="comment" id="6401959">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6402019">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6402081">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6402138">//</span><br>
<span class="lineno"></span><span class="comment" id="6402141">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6402199">//</span><br>
<span class="lineno"></span><span class="keyword" id="6402202">func</span>&nbsp;<span class="ident" id="6402207">Decode</span><span class="op" id="6402213">(</span><span class="ident" id="6402214">dst</span><span class="op" id="6402217">,</span>&nbsp;<span class="ident" id="6402219">src</span>&nbsp;<span class="op" id="6402223">[</span><span class="op" id="6402224">]</span><span class="builtintype" id="6402225">byte</span><span class="op" id="6402229">,</span>&nbsp;<span class="ident" id="6402231">flush</span>&nbsp;<span class="builtintype" id="6402237">bool</span><span class="op" id="6402241">)</span>&nbsp;<span class="op" id="6402243">(</span><span class="ident" id="6402244">ndst</span><span class="op" id="6402248">,</span>&nbsp;<span class="ident" id="6402250">nsrc</span>&nbsp;<span class="builtintype" id="6402255">int</span><span class="op" id="6402258">,</span>&nbsp;<span class="ident" id="6402260">err</span>&nbsp;<span class="builtintype" id="6402264">error</span><span class="op" id="6402269">)</span>&nbsp;<span class="op" id="6402271">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402274">var</span>&nbsp;<span class="ident" id="6402278">v</span>&nbsp;<span class="builtintype" id="6402280">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402288">var</span>&nbsp;<span class="ident" id="6402292">nb</span>&nbsp;<span class="builtintype" id="6402295">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402300">for</span>&nbsp;<span class="ident" id="6402304">i</span><span class="op" id="6402305">,</span>&nbsp;<span class="ident" id="6402307">b</span>&nbsp;<span class="op" id="6402309">:=</span>&nbsp;<span class="keyword" id="6402312">range</span>&nbsp;<span class="ident" id="6402318">src</span>&nbsp;<span class="op" id="6402322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402326">if</span>&nbsp;<span class="builtinfunc" id="6402329">len</span><span class="op" id="6402332">(</span><span class="ident" id="6402333">dst</span><span class="op" id="6402336">)</span><span class="op" id="6402337">-</span><span class="ident" id="6402338">ndst</span>&nbsp;<span class="op" id="6402343">&lt;</span>&nbsp;<span class="num" id="6402345">4</span>&nbsp;<span class="op" id="6402347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402352">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402365">switch</span>&nbsp;<span class="op" id="6402372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402376">case</span>&nbsp;<span class="ident" id="6402381">b</span>&nbsp;<span class="op" id="6402383">&lt;=</span>&nbsp;<span class="string" id="6402386">&#39;&nbsp;&#39;</span><span class="op" id="6402389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402394">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402405">case</span>&nbsp;<span class="ident" id="6402410">b</span>&nbsp;<span class="op" id="6402412">==</span>&nbsp;<span class="string" id="6402415">&#39;z&#39;</span>&nbsp;<span class="op" id="6402419">&amp;&amp;</span>&nbsp;<span class="ident" id="6402422">nb</span>&nbsp;<span class="op" id="6402425">==</span>&nbsp;<span class="num" id="6402428">0</span><span class="op" id="6402429">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402434">nb</span>&nbsp;<span class="op" id="6402437">=</span>&nbsp;<span class="num" id="6402439">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402444">v</span>&nbsp;<span class="op" id="6402446">=</span>&nbsp;<span class="num" id="6402448">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402452">case</span>&nbsp;<span class="string" id="6402457">&#39;!&#39;</span>&nbsp;<span class="op" id="6402461">&lt;=</span>&nbsp;<span class="ident" id="6402464">b</span>&nbsp;<span class="op" id="6402466">&amp;&amp;</span>&nbsp;<span class="ident" id="6402469">b</span>&nbsp;<span class="op" id="6402471">&lt;=</span>&nbsp;<span class="string" id="6402474">&#39;u&#39;</span><span class="op" id="6402477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402482">v</span>&nbsp;<span class="op" id="6402484">=</span>&nbsp;<span class="ident" id="6402486">v</span><span class="op" id="6402487">*</span><span class="num" id="6402488">85</span>&nbsp;<span class="op" id="6402491">+</span>&nbsp;<span class="builtintype" id="6402493">uint32</span><span class="op" id="6402499">(</span><span class="ident" id="6402500">b</span><span class="op" id="6402501">-</span><span class="string" id="6402502">&#39;!&#39;</span><span class="op" id="6402505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402510">nb</span><span class="op" id="6402512">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402517">default</span><span class="op" id="6402524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402529">return</span>&nbsp;<span class="num" id="6402536">0</span><span class="op" id="6402537">,</span>&nbsp;<span class="num" id="6402539">0</span><span class="op" id="6402540">,</span>&nbsp;<span class="ident" id="6402542">CorruptInputError</span><span class="op" id="6402559">(</span><span class="ident" id="6402560">i</span><span class="op" id="6402561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402569">if</span>&nbsp;<span class="ident" id="6402572">nb</span>&nbsp;<span class="op" id="6402575">==</span>&nbsp;<span class="num" id="6402578">5</span>&nbsp;<span class="op" id="6402580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402585">nsrc</span>&nbsp;<span class="op" id="6402590">=</span>&nbsp;<span class="ident" id="6402592">i</span>&nbsp;<span class="op" id="6402594">+</span>&nbsp;<span class="num" id="6402596">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402601">dst</span><span class="op" id="6402604">[</span><span class="ident" id="6402605">ndst</span><span class="op" id="6402609">]</span>&nbsp;<span class="op" id="6402611">=</span>&nbsp;<span class="builtintype" id="6402613">byte</span><span class="op" id="6402617">(</span><span class="ident" id="6402618">v</span>&nbsp;<span class="op" id="6402620">&gt;&gt;</span>&nbsp;<span class="num" id="6402623">24</span><span class="op" id="6402625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402630">dst</span><span class="op" id="6402633">[</span><span class="ident" id="6402634">ndst</span><span class="op" id="6402638">+</span><span class="num" id="6402639">1</span><span class="op" id="6402640">]</span>&nbsp;<span class="op" id="6402642">=</span>&nbsp;<span class="builtintype" id="6402644">byte</span><span class="op" id="6402648">(</span><span class="ident" id="6402649">v</span>&nbsp;<span class="op" id="6402651">&gt;&gt;</span>&nbsp;<span class="num" id="6402654">16</span><span class="op" id="6402656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402661">dst</span><span class="op" id="6402664">[</span><span class="ident" id="6402665">ndst</span><span class="op" id="6402669">+</span><span class="num" id="6402670">2</span><span class="op" id="6402671">]</span>&nbsp;<span class="op" id="6402673">=</span>&nbsp;<span class="builtintype" id="6402675">byte</span><span class="op" id="6402679">(</span><span class="ident" id="6402680">v</span>&nbsp;<span class="op" id="6402682">&gt;&gt;</span>&nbsp;<span class="num" id="6402685">8</span><span class="op" id="6402686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402691">dst</span><span class="op" id="6402694">[</span><span class="ident" id="6402695">ndst</span><span class="op" id="6402699">+</span><span class="num" id="6402700">3</span><span class="op" id="6402701">]</span>&nbsp;<span class="op" id="6402703">=</span>&nbsp;<span class="builtintype" id="6402705">byte</span><span class="op" id="6402709">(</span><span class="ident" id="6402710">v</span><span class="op" id="6402711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402716">ndst</span>&nbsp;<span class="op" id="6402721">+=</span>&nbsp;<span class="num" id="6402724">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402729">nb</span>&nbsp;<span class="op" id="6402732">=</span>&nbsp;<span class="num" id="6402734">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402739">v</span>&nbsp;<span class="op" id="6402741">=</span>&nbsp;<span class="num" id="6402743">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402753">if</span>&nbsp;<span class="ident" id="6402756">flush</span>&nbsp;<span class="op" id="6402762">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402766">nsrc</span>&nbsp;<span class="op" id="6402771">=</span>&nbsp;<span class="builtinfunc" id="6402773">len</span><span class="op" id="6402776">(</span><span class="ident" id="6402777">src</span><span class="op" id="6402780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402784">if</span>&nbsp;<span class="ident" id="6402787">nb</span>&nbsp;<span class="op" id="6402790">&gt;</span>&nbsp;<span class="num" id="6402792">0</span>&nbsp;<span class="op" id="6402794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6402799">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6402853">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6402902">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6402953">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403007">if</span>&nbsp;<span class="ident" id="6403010">nb</span>&nbsp;<span class="op" id="6403013">==</span>&nbsp;<span class="num" id="6403016">1</span>&nbsp;<span class="op" id="6403018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403024">return</span>&nbsp;<span class="num" id="6403031">0</span><span class="op" id="6403032">,</span>&nbsp;<span class="num" id="6403034">0</span><span class="op" id="6403035">,</span>&nbsp;<span class="ident" id="6403037">CorruptInputError</span><span class="op" id="6403054">(</span><span class="builtinfunc" id="6403055">len</span><span class="op" id="6403058">(</span><span class="ident" id="6403059">src</span><span class="op" id="6403062">)</span><span class="op" id="6403063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403073">for</span>&nbsp;<span class="ident" id="6403077">i</span>&nbsp;<span class="op" id="6403079">:=</span>&nbsp;<span class="ident" id="6403082">nb</span><span class="op" id="6403084">;</span>&nbsp;<span class="ident" id="6403086">i</span>&nbsp;<span class="op" id="6403088">&lt;</span>&nbsp;<span class="num" id="6403090">5</span><span class="op" id="6403091">;</span>&nbsp;<span class="ident" id="6403093">i</span><span class="op" id="6403094">++</span>&nbsp;<span class="op" id="6403097">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403103">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403157">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403215">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403272">v</span>&nbsp;<span class="op" id="6403274">=</span>&nbsp;<span class="ident" id="6403276">v</span><span class="op" id="6403277">*</span><span class="num" id="6403278">85</span>&nbsp;<span class="op" id="6403281">+</span>&nbsp;<span class="num" id="6403283">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403289">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403294">for</span>&nbsp;<span class="ident" id="6403298">i</span>&nbsp;<span class="op" id="6403300">:=</span>&nbsp;<span class="num" id="6403303">0</span><span class="op" id="6403304">;</span>&nbsp;<span class="ident" id="6403306">i</span>&nbsp;<span class="op" id="6403308">&lt;</span>&nbsp;<span class="ident" id="6403310">nb</span><span class="op" id="6403312">-</span><span class="num" id="6403313">1</span><span class="op" id="6403314">;</span>&nbsp;<span class="ident" id="6403316">i</span><span class="op" id="6403317">++</span>&nbsp;<span class="op" id="6403320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403326">dst</span><span class="op" id="6403329">[</span><span class="ident" id="6403330">ndst</span><span class="op" id="6403334">]</span>&nbsp;<span class="op" id="6403336">=</span>&nbsp;<span class="builtintype" id="6403338">byte</span><span class="op" id="6403342">(</span><span class="ident" id="6403343">v</span>&nbsp;<span class="op" id="6403345">&gt;&gt;</span>&nbsp;<span class="num" id="6403348">24</span><span class="op" id="6403350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403356">v</span>&nbsp;<span class="op" id="6403358">&lt;&lt;=</span>&nbsp;<span class="num" id="6403362">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403368">ndst</span><span class="op" id="6403372">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403378">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403388">return</span><br>
<span class="lineno"></span><span class="op" id="6403395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6403398">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6403453">func</span>&nbsp;<span class="ident" id="6403458">NewDecoder</span><span class="op" id="6403468">(</span><span class="ident" id="6403469">r</span>&nbsp;<span class="ident" id="6403471">io</span><span class="op" id="6403473">.</span><span class="ident" id="6403474">Reader</span><span class="op" id="6403480">)</span>&nbsp;<span class="ident" id="6403482">io</span><span class="op" id="6403484">.</span><span class="ident" id="6403485">Reader</span>&nbsp;<span class="op" id="6403492">{</span>&nbsp;<span class="keyword" id="6403494">return</span>&nbsp;<span class="op" id="6403501">&amp;</span><span class="ident" id="6403502">decoder</span><span class="op" id="6403509">{</span><span class="ident" id="6403510">r</span><span class="op" id="6403511">:</span>&nbsp;<span class="ident" id="6403513">r</span><span class="op" id="6403514">}</span>&nbsp;<span class="op" id="6403516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6403519">type</span>&nbsp;<span class="ident" id="6403524">decoder</span>&nbsp;<span class="keyword" id="6403532">struct</span>&nbsp;<span class="op" id="6403539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403542">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6403550">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403557">readErr</span>&nbsp;<span class="builtintype" id="6403565">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403572">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6403580">io</span><span class="op" id="6403582">.</span><span class="ident" id="6403583">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403591">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6403599">[</span><span class="num" id="6403600">1024</span><span class="op" id="6403604">]</span><span class="builtintype" id="6403605">byte</span>&nbsp;<span class="comment" id="6403610">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403629">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6403637">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403642">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6403650">[</span><span class="op" id="6403651">]</span><span class="builtintype" id="6403652">byte</span>&nbsp;<span class="comment" id="6403657">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403685">outbuf</span>&nbsp;&nbsp;<span class="op" id="6403693">[</span><span class="num" id="6403694">1024</span><span class="op" id="6403698">]</span><span class="builtintype" id="6403699">byte</span><br>
<span class="lineno"></span><span class="op" id="6403704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6403707">func</span>&nbsp;<span class="op" id="6403712">(</span><span class="ident" id="6403713">d</span>&nbsp;<span class="op" id="6403715">*</span><span class="ident" id="6403716">decoder</span><span class="op" id="6403723">)</span>&nbsp;<span class="ident" id="6403725">Read</span><span class="op" id="6403729">(</span><span class="ident" id="6403730">p</span>&nbsp;<span class="op" id="6403732">[</span><span class="op" id="6403733">]</span><span class="builtintype" id="6403734">byte</span><span class="op" id="6403738">)</span>&nbsp;<span class="op" id="6403740">(</span><span class="ident" id="6403741">n</span>&nbsp;<span class="builtintype" id="6403743">int</span><span class="op" id="6403746">,</span>&nbsp;<span class="ident" id="6403748">err</span>&nbsp;<span class="builtintype" id="6403752">error</span><span class="op" id="6403757">)</span>&nbsp;<span class="op" id="6403759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403762">if</span>&nbsp;<span class="builtinfunc" id="6403765">len</span><span class="op" id="6403768">(</span><span class="ident" id="6403769">p</span><span class="op" id="6403770">)</span>&nbsp;<span class="op" id="6403772">==</span>&nbsp;<span class="num" id="6403775">0</span>&nbsp;<span class="op" id="6403777">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403781">return</span>&nbsp;<span class="num" id="6403788">0</span><span class="op" id="6403789">,</span>&nbsp;<span class="ident" id="6403791">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403799">if</span>&nbsp;<span class="ident" id="6403802">d</span><span class="op" id="6403803">.</span><span class="ident" id="6403804">err</span>&nbsp;<span class="op" id="6403808">!=</span>&nbsp;<span class="ident" id="6403811">nil</span>&nbsp;<span class="op" id="6403815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403819">return</span>&nbsp;<span class="num" id="6403826">0</span><span class="op" id="6403827">,</span>&nbsp;<span class="ident" id="6403829">d</span><span class="op" id="6403830">.</span><span class="ident" id="6403831">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403836">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403840">for</span>&nbsp;<span class="op" id="6403844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403848">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403892">if</span>&nbsp;<span class="builtinfunc" id="6403895">len</span><span class="op" id="6403898">(</span><span class="ident" id="6403899">d</span><span class="op" id="6403900">.</span><span class="ident" id="6403901">out</span><span class="op" id="6403904">)</span>&nbsp;<span class="op" id="6403906">&gt;</span>&nbsp;<span class="num" id="6403908">0</span>&nbsp;<span class="op" id="6403910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403915">n</span>&nbsp;<span class="op" id="6403917">=</span>&nbsp;<span class="builtinfunc" id="6403919">copy</span><span class="op" id="6403923">(</span><span class="ident" id="6403924">p</span><span class="op" id="6403925">,</span>&nbsp;<span class="ident" id="6403927">d</span><span class="op" id="6403928">.</span><span class="ident" id="6403929">out</span><span class="op" id="6403932">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403937">d</span><span class="op" id="6403938">.</span><span class="ident" id="6403939">out</span>&nbsp;<span class="op" id="6403943">=</span>&nbsp;<span class="ident" id="6403945">d</span><span class="op" id="6403946">.</span><span class="ident" id="6403947">out</span><span class="op" id="6403950">[</span><span class="ident" id="6403951">n</span><span class="op" id="6403952">:</span><span class="op" id="6403953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403958">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403972">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404015">var</span>&nbsp;<span class="ident" id="6404019">nn</span><span class="op" id="6404021">,</span>&nbsp;<span class="ident" id="6404023">nsrc</span><span class="op" id="6404027">,</span>&nbsp;<span class="ident" id="6404029">ndst</span>&nbsp;<span class="builtintype" id="6404034">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404040">if</span>&nbsp;<span class="ident" id="6404043">d</span><span class="op" id="6404044">.</span><span class="ident" id="6404045">nbuf</span>&nbsp;<span class="op" id="6404050">&gt;</span>&nbsp;<span class="num" id="6404052">0</span>&nbsp;<span class="op" id="6404054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404059">ndst</span><span class="op" id="6404063">,</span>&nbsp;<span class="ident" id="6404065">nsrc</span><span class="op" id="6404069">,</span>&nbsp;<span class="ident" id="6404071">d</span><span class="op" id="6404072">.</span><span class="ident" id="6404073">err</span>&nbsp;<span class="op" id="6404077">=</span>&nbsp;<span class="ident" id="6404079">Decode</span><span class="op" id="6404085">(</span><span class="ident" id="6404086">d</span><span class="op" id="6404087">.</span><span class="ident" id="6404088">outbuf</span><span class="op" id="6404094">[</span><span class="num" id="6404095">0</span><span class="op" id="6404096">:</span><span class="op" id="6404097">]</span><span class="op" id="6404098">,</span>&nbsp;<span class="ident" id="6404100">d</span><span class="op" id="6404101">.</span><span class="ident" id="6404102">buf</span><span class="op" id="6404105">[</span><span class="num" id="6404106">0</span><span class="op" id="6404107">:</span><span class="ident" id="6404108">d</span><span class="op" id="6404109">.</span><span class="ident" id="6404110">nbuf</span><span class="op" id="6404114">]</span><span class="op" id="6404115">,</span>&nbsp;<span class="ident" id="6404117">d</span><span class="op" id="6404118">.</span><span class="ident" id="6404119">readErr</span>&nbsp;<span class="op" id="6404127">!=</span>&nbsp;<span class="ident" id="6404130">nil</span><span class="op" id="6404133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404138">if</span>&nbsp;<span class="ident" id="6404141">ndst</span>&nbsp;<span class="op" id="6404146">&gt;</span>&nbsp;<span class="num" id="6404148">0</span>&nbsp;<span class="op" id="6404150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404156">d</span><span class="op" id="6404157">.</span><span class="ident" id="6404158">out</span>&nbsp;<span class="op" id="6404162">=</span>&nbsp;<span class="ident" id="6404164">d</span><span class="op" id="6404165">.</span><span class="ident" id="6404166">outbuf</span><span class="op" id="6404172">[</span><span class="num" id="6404173">0</span><span class="op" id="6404174">:</span><span class="ident" id="6404175">ndst</span><span class="op" id="6404179">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404185">d</span><span class="op" id="6404186">.</span><span class="ident" id="6404187">nbuf</span>&nbsp;<span class="op" id="6404192">=</span>&nbsp;<span class="builtinfunc" id="6404194">copy</span><span class="op" id="6404198">(</span><span class="ident" id="6404199">d</span><span class="op" id="6404200">.</span><span class="ident" id="6404201">buf</span><span class="op" id="6404204">[</span><span class="num" id="6404205">0</span><span class="op" id="6404206">:</span><span class="op" id="6404207">]</span><span class="op" id="6404208">,</span>&nbsp;<span class="ident" id="6404210">d</span><span class="op" id="6404211">.</span><span class="ident" id="6404212">buf</span><span class="op" id="6404215">[</span><span class="ident" id="6404216">nsrc</span><span class="op" id="6404220">:</span><span class="ident" id="6404221">d</span><span class="op" id="6404222">.</span><span class="ident" id="6404223">nbuf</span><span class="op" id="6404227">]</span><span class="op" id="6404228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404234">continue</span>&nbsp;<span class="comment" id="6404243">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404274">if</span>&nbsp;<span class="ident" id="6404277">ndst</span>&nbsp;<span class="op" id="6404282">==</span>&nbsp;<span class="num" id="6404285">0</span>&nbsp;<span class="op" id="6404287">&amp;&amp;</span>&nbsp;<span class="ident" id="6404290">d</span><span class="op" id="6404291">.</span><span class="ident" id="6404292">err</span>&nbsp;<span class="op" id="6404296">==</span>&nbsp;<span class="ident" id="6404299">nil</span>&nbsp;<span class="op" id="6404303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404309">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404381">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404439">off</span>&nbsp;<span class="op" id="6404443">:=</span>&nbsp;<span class="num" id="6404446">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404452">for</span>&nbsp;<span class="ident" id="6404456">i</span>&nbsp;<span class="op" id="6404458">:=</span>&nbsp;<span class="num" id="6404461">0</span><span class="op" id="6404462">;</span>&nbsp;<span class="ident" id="6404464">i</span>&nbsp;<span class="op" id="6404466">&lt;</span>&nbsp;<span class="ident" id="6404468">d</span><span class="op" id="6404469">.</span><span class="ident" id="6404470">nbuf</span><span class="op" id="6404474">;</span>&nbsp;<span class="ident" id="6404476">i</span><span class="op" id="6404477">++</span>&nbsp;<span class="op" id="6404480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404487">if</span>&nbsp;<span class="ident" id="6404490">d</span><span class="op" id="6404491">.</span><span class="ident" id="6404492">buf</span><span class="op" id="6404495">[</span><span class="ident" id="6404496">i</span><span class="op" id="6404497">]</span>&nbsp;<span class="op" id="6404499">&gt;</span>&nbsp;<span class="string" id="6404501">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6404505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404513">d</span><span class="op" id="6404514">.</span><span class="ident" id="6404515">buf</span><span class="op" id="6404518">[</span><span class="ident" id="6404519">off</span><span class="op" id="6404522">]</span>&nbsp;<span class="op" id="6404524">=</span>&nbsp;<span class="ident" id="6404526">d</span><span class="op" id="6404527">.</span><span class="ident" id="6404528">buf</span><span class="op" id="6404531">[</span><span class="ident" id="6404532">i</span><span class="op" id="6404533">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404541">off</span><span class="op" id="6404544">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404564">d</span><span class="op" id="6404565">.</span><span class="ident" id="6404566">nbuf</span>&nbsp;<span class="op" id="6404571">=</span>&nbsp;<span class="ident" id="6404573">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404580">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404589">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404646">if</span>&nbsp;<span class="ident" id="6404649">d</span><span class="op" id="6404650">.</span><span class="ident" id="6404651">err</span>&nbsp;<span class="op" id="6404655">!=</span>&nbsp;<span class="ident" id="6404658">nil</span>&nbsp;<span class="op" id="6404662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404667">return</span>&nbsp;<span class="num" id="6404674">0</span><span class="op" id="6404675">,</span>&nbsp;<span class="ident" id="6404677">d</span><span class="op" id="6404678">.</span><span class="ident" id="6404679">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404689">if</span>&nbsp;<span class="ident" id="6404692">d</span><span class="op" id="6404693">.</span><span class="ident" id="6404694">readErr</span>&nbsp;<span class="op" id="6404702">!=</span>&nbsp;<span class="ident" id="6404705">nil</span>&nbsp;<span class="op" id="6404709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404714">d</span><span class="op" id="6404715">.</span><span class="ident" id="6404716">err</span>&nbsp;<span class="op" id="6404720">=</span>&nbsp;<span class="ident" id="6404722">d</span><span class="op" id="6404723">.</span><span class="ident" id="6404724">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404735">return</span>&nbsp;<span class="num" id="6404742">0</span><span class="op" id="6404743">,</span>&nbsp;<span class="ident" id="6404745">d</span><span class="op" id="6404746">.</span><span class="ident" id="6404747">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404753">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404758">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404779">nn</span><span class="op" id="6404781">,</span>&nbsp;<span class="ident" id="6404783">d</span><span class="op" id="6404784">.</span><span class="ident" id="6404785">readErr</span>&nbsp;<span class="op" id="6404793">=</span>&nbsp;<span class="ident" id="6404795">d</span><span class="op" id="6404796">.</span><span class="ident" id="6404797">r</span><span class="op" id="6404798">.</span><span class="ident" id="6404799">Read</span><span class="op" id="6404803">(</span><span class="ident" id="6404804">d</span><span class="op" id="6404805">.</span><span class="ident" id="6404806">buf</span><span class="op" id="6404809">[</span><span class="ident" id="6404810">d</span><span class="op" id="6404811">.</span><span class="ident" id="6404812">nbuf</span><span class="op" id="6404816">:</span><span class="op" id="6404817">]</span><span class="op" id="6404818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404822">d</span><span class="op" id="6404823">.</span><span class="ident" id="6404824">nbuf</span>&nbsp;<span class="op" id="6404829">+=</span>&nbsp;<span class="ident" id="6404832">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404836">}</span><br>
<span class="lineno">310</span><span class="op" id="6404838">}</span>
</div>
</body>
</html>
