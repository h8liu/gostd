<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1853157">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1853212">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1853266">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1853317">package</span>&nbsp;<span class="ident" id="1853325">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1853334">import</span>&nbsp;<span class="string" id="1853341">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1853351">//&nbsp;Breakpoint&nbsp;executes&nbsp;a&nbsp;breakpoint&nbsp;trap.</span><br>
<span class="lineno">10</span><span class="keyword" id="1853393">func</span>&nbsp;<span class="ident" id="1853398">Breakpoint</span><span class="op" id="1853408">(</span><span class="op" id="1853409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1853412">//&nbsp;LockOSThread&nbsp;wires&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;to&nbsp;its&nbsp;current&nbsp;operating&nbsp;system&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1853496">//&nbsp;Until&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;exits&nbsp;or&nbsp;calls&nbsp;UnlockOSThread,&nbsp;it&nbsp;will&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="1853573">//&nbsp;execute&nbsp;in&nbsp;that&nbsp;thread,&nbsp;and&nbsp;no&nbsp;other&nbsp;goroutine&nbsp;can.</span><br>
<span class="lineno">15</span><span class="keyword" id="1853628">func</span>&nbsp;<span class="ident" id="1853633">LockOSThread</span><span class="op" id="1853645">(</span><span class="op" id="1853646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1853649">//&nbsp;UnlockOSThread&nbsp;unwires&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;from&nbsp;its&nbsp;fixed&nbsp;operating&nbsp;system&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1853737">//&nbsp;If&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;has&nbsp;not&nbsp;called&nbsp;LockOSThread,&nbsp;UnlockOSThread&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="keyword" id="1853821">func</span>&nbsp;<span class="ident" id="1853826">UnlockOSThread</span><span class="op" id="1853840">(</span><span class="op" id="1853841">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1853844">//&nbsp;GOMAXPROCS&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;that&nbsp;can&nbsp;be&nbsp;executing</span><br>
<span class="lineno"></span><span class="comment" id="1853912">//&nbsp;simultaneously&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.&nbsp;&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;1,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1853987">//&nbsp;change&nbsp;the&nbsp;current&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="1854018">//&nbsp;The&nbsp;number&nbsp;of&nbsp;logical&nbsp;CPUs&nbsp;on&nbsp;the&nbsp;local&nbsp;machine&nbsp;can&nbsp;be&nbsp;queried&nbsp;with&nbsp;NumCPU.</span><br>
<span class="lineno">25</span><span class="comment" id="1854097">//&nbsp;This&nbsp;call&nbsp;will&nbsp;go&nbsp;away&nbsp;when&nbsp;the&nbsp;scheduler&nbsp;improves.</span><br>
<span class="lineno"></span><span class="keyword" id="1854152">func</span>&nbsp;<span class="ident" id="1854157">GOMAXPROCS</span><span class="op" id="1854167">(</span><span class="ident" id="1854168">n</span>&nbsp;<span class="builtintype" id="1854170">int</span><span class="op" id="1854173">)</span>&nbsp;<span class="builtintype" id="1854175">int</span>&nbsp;<span class="op" id="1854179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854182">if</span>&nbsp;<span class="ident" id="1854185">n</span>&nbsp;<span class="op" id="1854187">&gt;</span>&nbsp;<span class="ident" id="1854189">_MaxGomaxprocs</span>&nbsp;<span class="op" id="1854204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854208">n</span>&nbsp;<span class="op" id="1854210">=</span>&nbsp;<span class="ident" id="1854212">_MaxGomaxprocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854228">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854231">lock</span><span class="op" id="1854235">(</span><span class="op" id="1854236">&amp;</span><span class="ident" id="1854237">sched</span><span class="op" id="1854242">.</span><span class="ident" id="1854243">lock</span><span class="op" id="1854247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854250">ret</span>&nbsp;<span class="op" id="1854254">:=</span>&nbsp;<span class="builtintype" id="1854257">int</span><span class="op" id="1854260">(</span><span class="ident" id="1854261">gomaxprocs</span><span class="op" id="1854271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854274">unlock</span><span class="op" id="1854280">(</span><span class="op" id="1854281">&amp;</span><span class="ident" id="1854282">sched</span><span class="op" id="1854287">.</span><span class="ident" id="1854288">lock</span><span class="op" id="1854292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854295">if</span>&nbsp;<span class="ident" id="1854298">n</span>&nbsp;<span class="op" id="1854300">&lt;=</span>&nbsp;<span class="num" id="1854303">0</span>&nbsp;<span class="op" id="1854305">||</span>&nbsp;<span class="ident" id="1854308">n</span>&nbsp;<span class="op" id="1854310">==</span>&nbsp;<span class="ident" id="1854313">ret</span>&nbsp;<span class="op" id="1854317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854321">return</span>&nbsp;<span class="ident" id="1854328">ret</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854337">semacquire</span><span class="op" id="1854347">(</span><span class="op" id="1854348">&amp;</span><span class="ident" id="1854349">worldsema</span><span class="op" id="1854358">,</span>&nbsp;<span class="builtintype" id="1854360">false</span><span class="op" id="1854365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854368">gp</span>&nbsp;<span class="op" id="1854371">:=</span>&nbsp;<span class="ident" id="1854374">getg</span><span class="op" id="1854378">(</span><span class="op" id="1854379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854382">gp</span><span class="op" id="1854384">.</span><span class="ident" id="1854385">m</span><span class="op" id="1854386">.</span><span class="ident" id="1854387">gcing</span>&nbsp;<span class="op" id="1854393">=</span>&nbsp;<span class="num" id="1854395">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854398">onM</span><span class="op" id="1854401">(</span><span class="ident" id="1854402">stoptheworld</span><span class="op" id="1854414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1854418">//&nbsp;newprocs&nbsp;will&nbsp;be&nbsp;processed&nbsp;by&nbsp;starttheworld</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854466">newprocs</span>&nbsp;<span class="op" id="1854475">=</span>&nbsp;<span class="builtintype" id="1854477">int32</span><span class="op" id="1854482">(</span><span class="ident" id="1854483">n</span><span class="op" id="1854484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854488">gp</span><span class="op" id="1854490">.</span><span class="ident" id="1854491">m</span><span class="op" id="1854492">.</span><span class="ident" id="1854493">gcing</span>&nbsp;<span class="op" id="1854499">=</span>&nbsp;<span class="num" id="1854501">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854504">semrelease</span><span class="op" id="1854514">(</span><span class="op" id="1854515">&amp;</span><span class="ident" id="1854516">worldsema</span><span class="op" id="1854525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854528">onM</span><span class="op" id="1854531">(</span><span class="ident" id="1854532">starttheworld</span><span class="op" id="1854545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854548">return</span>&nbsp;<span class="ident" id="1854555">ret</span><br>
<span class="lineno"></span><span class="op" id="1854559">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="1854562">//&nbsp;NumCPU&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;logical&nbsp;CPUs&nbsp;on&nbsp;the&nbsp;local&nbsp;machine.</span><br>
<span class="lineno"></span><span class="keyword" id="1854629">func</span>&nbsp;<span class="ident" id="1854634">NumCPU</span><span class="op" id="1854640">(</span><span class="op" id="1854641">)</span>&nbsp;<span class="builtintype" id="1854643">int</span>&nbsp;<span class="op" id="1854647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854650">return</span>&nbsp;<span class="builtintype" id="1854657">int</span><span class="op" id="1854660">(</span><span class="ident" id="1854661">ncpu</span><span class="op" id="1854665">)</span><br>
<span class="lineno"></span><span class="op" id="1854667">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1854670">//&nbsp;NumCgoCall&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cgo&nbsp;calls&nbsp;made&nbsp;by&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="1854745">func</span>&nbsp;<span class="ident" id="1854750">NumCgoCall</span><span class="op" id="1854760">(</span><span class="op" id="1854761">)</span>&nbsp;<span class="ident" id="1854763">int64</span>&nbsp;<span class="op" id="1854769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854772">var</span>&nbsp;<span class="ident" id="1854776">n</span>&nbsp;<span class="ident" id="1854778">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854785">for</span>&nbsp;<span class="ident" id="1854789">mp</span>&nbsp;<span class="op" id="1854792">:=</span>&nbsp;<span class="op" id="1854795">(</span><span class="op" id="1854796">*</span><span class="ident" id="1854797">m</span><span class="op" id="1854798">)</span><span class="op" id="1854799">(</span><span class="ident" id="1854800">atomicloadp</span><span class="op" id="1854811">(</span><span class="ident" id="1854812">unsafe</span><span class="op" id="1854818">.</span><span class="ident" id="1854819">Pointer</span><span class="op" id="1854826">(</span><span class="op" id="1854827">&amp;</span><span class="ident" id="1854828">allm</span><span class="op" id="1854832">)</span><span class="op" id="1854833">)</span><span class="op" id="1854834">)</span><span class="op" id="1854835">;</span>&nbsp;<span class="ident" id="1854837">mp</span>&nbsp;<span class="op" id="1854840">!=</span>&nbsp;<span class="ident" id="1854843">nil</span><span class="op" id="1854846">;</span>&nbsp;<span class="ident" id="1854848">mp</span>&nbsp;<span class="op" id="1854851">=</span>&nbsp;<span class="ident" id="1854853">mp</span><span class="op" id="1854855">.</span><span class="ident" id="1854856">alllink</span>&nbsp;<span class="op" id="1854864">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854868">n</span>&nbsp;<span class="op" id="1854870">+=</span>&nbsp;<span class="ident" id="1854873">int64</span><span class="op" id="1854878">(</span><span class="ident" id="1854879">mp</span><span class="op" id="1854881">.</span><span class="ident" id="1854882">ncgocall</span><span class="op" id="1854890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854896">return</span>&nbsp;<span class="ident" id="1854903">n</span><br>
<span class="lineno"></span><span class="op" id="1854905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1854908">//&nbsp;NumGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;currently&nbsp;exist.</span><br>
<span class="lineno"></span><span class="keyword" id="1854979">func</span>&nbsp;<span class="ident" id="1854984">NumGoroutine</span><span class="op" id="1854996">(</span><span class="op" id="1854997">)</span>&nbsp;<span class="builtintype" id="1854999">int</span>&nbsp;<span class="op" id="1855003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855006">return</span>&nbsp;<span class="builtintype" id="1855013">int</span><span class="op" id="1855016">(</span><span class="ident" id="1855017">gcount</span><span class="op" id="1855023">(</span><span class="op" id="1855024">)</span><span class="op" id="1855025">)</span><br>
<span class="lineno"></span><span class="op" id="1855027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="1855030">func</span>&nbsp;<span class="ident" id="1855035">gcount</span><span class="op" id="1855041">(</span><span class="op" id="1855042">)</span>&nbsp;<span class="builtintype" id="1855044">int32</span>
</div>
</body>
</html>
