<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6065910">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6065965">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6066019">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6066070">package</span>&nbsp;<span class="ident" id="6066078">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6066084">import</span>&nbsp;<span class="op" id="6066091">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6066094">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6066109">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6066123">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6066133">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6066139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066142">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6066202">type</span>&nbsp;<span class="ident" id="6066207">Auth</span>&nbsp;<span class="keyword" id="6066212">interface</span>&nbsp;<span class="op" id="6066222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066225">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066275">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066330">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066393">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066455">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066502">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066560">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066618">Start</span><span class="op" id="6066623">(</span><span class="ident" id="6066624">server</span>&nbsp;<span class="op" id="6066631">*</span><span class="ident" id="6066632">ServerInfo</span><span class="op" id="6066642">)</span>&nbsp;<span class="op" id="6066644">(</span><span class="ident" id="6066645">proto</span>&nbsp;<span class="builtintype" id="6066651">string</span><span class="op" id="6066657">,</span>&nbsp;<span class="ident" id="6066659">toServer</span>&nbsp;<span class="op" id="6066668">[</span><span class="op" id="6066669">]</span><span class="builtintype" id="6066670">byte</span><span class="op" id="6066674">,</span>&nbsp;<span class="ident" id="6066676">err</span>&nbsp;<span class="builtintype" id="6066680">error</span><span class="op" id="6066685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066689">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066753">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066816">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066878">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066918">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066978">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067036">Next</span><span class="op" id="6067040">(</span><span class="ident" id="6067041">fromServer</span>&nbsp;<span class="op" id="6067052">[</span><span class="op" id="6067053">]</span><span class="builtintype" id="6067054">byte</span><span class="op" id="6067058">,</span>&nbsp;<span class="ident" id="6067060">more</span>&nbsp;<span class="builtintype" id="6067065">bool</span><span class="op" id="6067069">)</span>&nbsp;<span class="op" id="6067071">(</span><span class="ident" id="6067072">toServer</span>&nbsp;<span class="op" id="6067081">[</span><span class="op" id="6067082">]</span><span class="builtintype" id="6067083">byte</span><span class="op" id="6067087">,</span>&nbsp;<span class="ident" id="6067089">err</span>&nbsp;<span class="builtintype" id="6067093">error</span><span class="op" id="6067098">)</span><br>
<span class="lineno"></span><span class="op" id="6067100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6067103">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6067159">type</span>&nbsp;<span class="ident" id="6067164">ServerInfo</span>&nbsp;<span class="keyword" id="6067175">struct</span>&nbsp;<span class="op" id="6067182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067185">Name</span>&nbsp;<span class="builtintype" id="6067190">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6067199">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067220">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6067225">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6067234">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067281">Auth</span>&nbsp;<span class="op" id="6067286">[</span><span class="op" id="6067287">]</span><span class="builtintype" id="6067288">string</span>&nbsp;<span class="comment" id="6067295">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6067335">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6067338">type</span>&nbsp;<span class="ident" id="6067343">plainAuth</span>&nbsp;<span class="keyword" id="6067353">struct</span>&nbsp;<span class="op" id="6067360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067363">identity</span><span class="op" id="6067371">,</span>&nbsp;<span class="ident" id="6067373">username</span><span class="op" id="6067381">,</span>&nbsp;<span class="ident" id="6067383">password</span>&nbsp;<span class="builtintype" id="6067392">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067400">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6067429">string</span><br>
<span class="lineno"></span><span class="op" id="6067436">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6067439">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6067509">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6067546">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6067620">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6067696">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6067730">func</span>&nbsp;<span class="ident" id="6067735">PlainAuth</span><span class="op" id="6067744">(</span><span class="ident" id="6067745">identity</span><span class="op" id="6067753">,</span>&nbsp;<span class="ident" id="6067755">username</span><span class="op" id="6067763">,</span>&nbsp;<span class="ident" id="6067765">password</span><span class="op" id="6067773">,</span>&nbsp;<span class="ident" id="6067775">host</span>&nbsp;<span class="builtintype" id="6067780">string</span><span class="op" id="6067786">)</span>&nbsp;<span class="ident" id="6067788">Auth</span>&nbsp;<span class="op" id="6067793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067796">return</span>&nbsp;<span class="op" id="6067803">&amp;</span><span class="ident" id="6067804">plainAuth</span><span class="op" id="6067813">{</span><span class="ident" id="6067814">identity</span><span class="op" id="6067822">,</span>&nbsp;<span class="ident" id="6067824">username</span><span class="op" id="6067832">,</span>&nbsp;<span class="ident" id="6067834">password</span><span class="op" id="6067842">,</span>&nbsp;<span class="ident" id="6067844">host</span><span class="op" id="6067848">}</span><br>
<span class="lineno"></span><span class="op" id="6067850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6067853">func</span>&nbsp;<span class="op" id="6067858">(</span><span class="ident" id="6067859">a</span>&nbsp;<span class="op" id="6067861">*</span><span class="ident" id="6067862">plainAuth</span><span class="op" id="6067871">)</span>&nbsp;<span class="ident" id="6067873">Start</span><span class="op" id="6067878">(</span><span class="ident" id="6067879">server</span>&nbsp;<span class="op" id="6067886">*</span><span class="ident" id="6067887">ServerInfo</span><span class="op" id="6067897">)</span>&nbsp;<span class="op" id="6067899">(</span><span class="builtintype" id="6067900">string</span><span class="op" id="6067906">,</span>&nbsp;<span class="op" id="6067908">[</span><span class="op" id="6067909">]</span><span class="builtintype" id="6067910">byte</span><span class="op" id="6067914">,</span>&nbsp;<span class="builtintype" id="6067916">error</span><span class="op" id="6067921">)</span>&nbsp;<span class="op" id="6067923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067926">if</span>&nbsp;<span class="op" id="6067929">!</span><span class="ident" id="6067930">server</span><span class="op" id="6067936">.</span><span class="ident" id="6067937">TLS</span>&nbsp;<span class="op" id="6067941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067945">advertised</span>&nbsp;<span class="op" id="6067956">:=</span>&nbsp;<span class="builtintype" id="6067959">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067967">for</span>&nbsp;<span class="ident" id="6067971">_</span><span class="op" id="6067972">,</span>&nbsp;<span class="ident" id="6067974">mechanism</span>&nbsp;<span class="op" id="6067984">:=</span>&nbsp;<span class="keyword" id="6067987">range</span>&nbsp;<span class="ident" id="6067993">server</span><span class="op" id="6067999">.</span><span class="ident" id="6068000">Auth</span>&nbsp;<span class="op" id="6068005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068010">if</span>&nbsp;<span class="ident" id="6068013">mechanism</span>&nbsp;<span class="op" id="6068023">==</span>&nbsp;<span class="string" id="6068026">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6068034">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068040">advertised</span>&nbsp;<span class="op" id="6068051">=</span>&nbsp;<span class="builtintype" id="6068053">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068062">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068079">if</span>&nbsp;<span class="op" id="6068082">!</span><span class="ident" id="6068083">advertised</span>&nbsp;<span class="op" id="6068094">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068099">return</span>&nbsp;<span class="string" id="6068106">&#34;&#34;</span><span class="op" id="6068108">,</span>&nbsp;<span class="ident" id="6068110">nil</span><span class="op" id="6068113">,</span>&nbsp;<span class="ident" id="6068115">errors</span><span class="op" id="6068121">.</span><span class="ident" id="6068122">New</span><span class="op" id="6068125">(</span><span class="string" id="6068126">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6068150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068160">if</span>&nbsp;<span class="ident" id="6068163">server</span><span class="op" id="6068169">.</span><span class="ident" id="6068170">Name</span>&nbsp;<span class="op" id="6068175">!=</span>&nbsp;<span class="ident" id="6068178">a</span><span class="op" id="6068179">.</span><span class="ident" id="6068180">host</span>&nbsp;<span class="op" id="6068185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068189">return</span>&nbsp;<span class="string" id="6068196">&#34;&#34;</span><span class="op" id="6068198">,</span>&nbsp;<span class="ident" id="6068200">nil</span><span class="op" id="6068203">,</span>&nbsp;<span class="ident" id="6068205">errors</span><span class="op" id="6068211">.</span><span class="ident" id="6068212">New</span><span class="op" id="6068215">(</span><span class="string" id="6068216">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6068233">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068239">resp</span>&nbsp;<span class="op" id="6068244">:=</span>&nbsp;<span class="op" id="6068247">[</span><span class="op" id="6068248">]</span><span class="builtintype" id="6068249">byte</span><span class="op" id="6068253">(</span><span class="ident" id="6068254">a</span><span class="op" id="6068255">.</span><span class="ident" id="6068256">identity</span>&nbsp;<span class="op" id="6068265">+</span>&nbsp;<span class="string" id="6068267">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6068274">+</span>&nbsp;<span class="ident" id="6068276">a</span><span class="op" id="6068277">.</span><span class="ident" id="6068278">username</span>&nbsp;<span class="op" id="6068287">+</span>&nbsp;<span class="string" id="6068289">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6068296">+</span>&nbsp;<span class="ident" id="6068298">a</span><span class="op" id="6068299">.</span><span class="ident" id="6068300">password</span><span class="op" id="6068308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068311">return</span>&nbsp;<span class="string" id="6068318">&#34;PLAIN&#34;</span><span class="op" id="6068325">,</span>&nbsp;<span class="ident" id="6068327">resp</span><span class="op" id="6068331">,</span>&nbsp;<span class="ident" id="6068333">nil</span><br>
<span class="lineno"></span><span class="op" id="6068337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6068340">func</span>&nbsp;<span class="op" id="6068345">(</span><span class="ident" id="6068346">a</span>&nbsp;<span class="op" id="6068348">*</span><span class="ident" id="6068349">plainAuth</span><span class="op" id="6068358">)</span>&nbsp;<span class="ident" id="6068360">Next</span><span class="op" id="6068364">(</span><span class="ident" id="6068365">fromServer</span>&nbsp;<span class="op" id="6068376">[</span><span class="op" id="6068377">]</span><span class="builtintype" id="6068378">byte</span><span class="op" id="6068382">,</span>&nbsp;<span class="ident" id="6068384">more</span>&nbsp;<span class="builtintype" id="6068389">bool</span><span class="op" id="6068393">)</span>&nbsp;<span class="op" id="6068395">(</span><span class="op" id="6068396">[</span><span class="op" id="6068397">]</span><span class="builtintype" id="6068398">byte</span><span class="op" id="6068402">,</span>&nbsp;<span class="builtintype" id="6068404">error</span><span class="op" id="6068409">)</span>&nbsp;<span class="op" id="6068411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068414">if</span>&nbsp;<span class="ident" id="6068417">more</span>&nbsp;<span class="op" id="6068422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068426">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068462">return</span>&nbsp;<span class="ident" id="6068469">nil</span><span class="op" id="6068472">,</span>&nbsp;<span class="ident" id="6068474">errors</span><span class="op" id="6068480">.</span><span class="ident" id="6068481">New</span><span class="op" id="6068484">(</span><span class="string" id="6068485">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6068514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068517">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068520">return</span>&nbsp;<span class="ident" id="6068527">nil</span><span class="op" id="6068530">,</span>&nbsp;<span class="ident" id="6068532">nil</span><br>
<span class="lineno"></span><span class="op" id="6068536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6068539">type</span>&nbsp;<span class="ident" id="6068544">cramMD5Auth</span>&nbsp;<span class="keyword" id="6068556">struct</span>&nbsp;<span class="op" id="6068563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068566">username</span><span class="op" id="6068574">,</span>&nbsp;<span class="ident" id="6068576">secret</span>&nbsp;<span class="builtintype" id="6068583">string</span><br>
<span class="lineno">85</span><span class="op" id="6068590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6068593">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6068668">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6068705">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6068777">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6068834">func</span>&nbsp;<span class="ident" id="6068839">CRAMMD5Auth</span><span class="op" id="6068850">(</span><span class="ident" id="6068851">username</span><span class="op" id="6068859">,</span>&nbsp;<span class="ident" id="6068861">secret</span>&nbsp;<span class="builtintype" id="6068868">string</span><span class="op" id="6068874">)</span>&nbsp;<span class="ident" id="6068876">Auth</span>&nbsp;<span class="op" id="6068881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068884">return</span>&nbsp;<span class="op" id="6068891">&amp;</span><span class="ident" id="6068892">cramMD5Auth</span><span class="op" id="6068903">{</span><span class="ident" id="6068904">username</span><span class="op" id="6068912">,</span>&nbsp;<span class="ident" id="6068914">secret</span><span class="op" id="6068920">}</span><br>
<span class="lineno"></span><span class="op" id="6068922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6068925">func</span>&nbsp;<span class="op" id="6068930">(</span><span class="ident" id="6068931">a</span>&nbsp;<span class="op" id="6068933">*</span><span class="ident" id="6068934">cramMD5Auth</span><span class="op" id="6068945">)</span>&nbsp;<span class="ident" id="6068947">Start</span><span class="op" id="6068952">(</span><span class="ident" id="6068953">server</span>&nbsp;<span class="op" id="6068960">*</span><span class="ident" id="6068961">ServerInfo</span><span class="op" id="6068971">)</span>&nbsp;<span class="op" id="6068973">(</span><span class="builtintype" id="6068974">string</span><span class="op" id="6068980">,</span>&nbsp;<span class="op" id="6068982">[</span><span class="op" id="6068983">]</span><span class="builtintype" id="6068984">byte</span><span class="op" id="6068988">,</span>&nbsp;<span class="builtintype" id="6068990">error</span><span class="op" id="6068995">)</span>&nbsp;<span class="op" id="6068997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069000">return</span>&nbsp;<span class="string" id="6069007">&#34;CRAM-MD5&#34;</span><span class="op" id="6069017">,</span>&nbsp;<span class="ident" id="6069019">nil</span><span class="op" id="6069022">,</span>&nbsp;<span class="ident" id="6069024">nil</span><br>
<span class="lineno"></span><span class="op" id="6069028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6069031">func</span>&nbsp;<span class="op" id="6069036">(</span><span class="ident" id="6069037">a</span>&nbsp;<span class="op" id="6069039">*</span><span class="ident" id="6069040">cramMD5Auth</span><span class="op" id="6069051">)</span>&nbsp;<span class="ident" id="6069053">Next</span><span class="op" id="6069057">(</span><span class="ident" id="6069058">fromServer</span>&nbsp;<span class="op" id="6069069">[</span><span class="op" id="6069070">]</span><span class="builtintype" id="6069071">byte</span><span class="op" id="6069075">,</span>&nbsp;<span class="ident" id="6069077">more</span>&nbsp;<span class="builtintype" id="6069082">bool</span><span class="op" id="6069086">)</span>&nbsp;<span class="op" id="6069088">(</span><span class="op" id="6069089">[</span><span class="op" id="6069090">]</span><span class="builtintype" id="6069091">byte</span><span class="op" id="6069095">,</span>&nbsp;<span class="builtintype" id="6069097">error</span><span class="op" id="6069102">)</span>&nbsp;<span class="op" id="6069104">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069107">if</span>&nbsp;<span class="ident" id="6069110">more</span>&nbsp;<span class="op" id="6069115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069119">d</span>&nbsp;<span class="op" id="6069121">:=</span>&nbsp;<span class="ident" id="6069124">hmac</span><span class="op" id="6069128">.</span><span class="ident" id="6069129">New</span><span class="op" id="6069132">(</span><span class="ident" id="6069133">md5</span><span class="op" id="6069136">.</span><span class="ident" id="6069137">New</span><span class="op" id="6069140">,</span>&nbsp;<span class="op" id="6069142">[</span><span class="op" id="6069143">]</span><span class="builtintype" id="6069144">byte</span><span class="op" id="6069148">(</span><span class="ident" id="6069149">a</span><span class="op" id="6069150">.</span><span class="ident" id="6069151">secret</span><span class="op" id="6069157">)</span><span class="op" id="6069158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069162">d</span><span class="op" id="6069163">.</span><span class="ident" id="6069164">Write</span><span class="op" id="6069169">(</span><span class="ident" id="6069170">fromServer</span><span class="op" id="6069180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069184">s</span>&nbsp;<span class="op" id="6069186">:=</span>&nbsp;<span class="builtinfunc" id="6069189">make</span><span class="op" id="6069193">(</span><span class="op" id="6069194">[</span><span class="op" id="6069195">]</span><span class="builtintype" id="6069196">byte</span><span class="op" id="6069200">,</span>&nbsp;<span class="num" id="6069202">0</span><span class="op" id="6069203">,</span>&nbsp;<span class="ident" id="6069205">d</span><span class="op" id="6069206">.</span><span class="ident" id="6069207">Size</span><span class="op" id="6069211">(</span><span class="op" id="6069212">)</span><span class="op" id="6069213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069217">return</span>&nbsp;<span class="op" id="6069224">[</span><span class="op" id="6069225">]</span><span class="builtintype" id="6069226">byte</span><span class="op" id="6069230">(</span><span class="ident" id="6069231">fmt</span><span class="op" id="6069234">.</span><span class="ident" id="6069235">Sprintf</span><span class="op" id="6069242">(</span><span class="string" id="6069243">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6069250">,</span>&nbsp;<span class="ident" id="6069252">a</span><span class="op" id="6069253">.</span><span class="ident" id="6069254">username</span><span class="op" id="6069262">,</span>&nbsp;<span class="ident" id="6069264">d</span><span class="op" id="6069265">.</span><span class="ident" id="6069266">Sum</span><span class="op" id="6069269">(</span><span class="ident" id="6069270">s</span><span class="op" id="6069271">)</span><span class="op" id="6069272">)</span><span class="op" id="6069273">)</span><span class="op" id="6069274">,</span>&nbsp;<span class="ident" id="6069276">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069284">return</span>&nbsp;<span class="ident" id="6069291">nil</span><span class="op" id="6069294">,</span>&nbsp;<span class="ident" id="6069296">nil</span><br>
<span class="lineno"></span><span class="op" id="6069300">}</span>
</div>
</body>
</html>
