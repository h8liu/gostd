<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6514483">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6514538">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6514592">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6514643">package</span>&nbsp;<span class="ident" id="6514651">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6514656">import</span>&nbsp;<span class="op" id="6514663">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514666">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514675">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514691">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514710">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514724">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514740">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514756">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514766">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514773">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514779">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514791">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514798">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514804">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514815">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514832">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514843">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6514854">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6514861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6514864">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6514942">type</span>&nbsp;<span class="ident" id="6514947">zeroSource</span>&nbsp;<span class="keyword" id="6514958">struct</span><span class="op" id="6514964">{</span><span class="op" id="6514965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6514968">func</span>&nbsp;<span class="op" id="6514973">(</span><span class="ident" id="6514974">zeroSource</span><span class="op" id="6514984">)</span>&nbsp;<span class="ident" id="6514986">Read</span><span class="op" id="6514990">(</span><span class="ident" id="6514991">b</span>&nbsp;<span class="op" id="6514993">[</span><span class="op" id="6514994">]</span><span class="builtintype" id="6514995">byte</span><span class="op" id="6514999">)</span>&nbsp;<span class="op" id="6515001">(</span><span class="ident" id="6515002">n</span>&nbsp;<span class="builtintype" id="6515004">int</span><span class="op" id="6515007">,</span>&nbsp;<span class="ident" id="6515009">err</span>&nbsp;<span class="builtintype" id="6515013">error</span><span class="op" id="6515018">)</span>&nbsp;<span class="op" id="6515020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6515023">for</span>&nbsp;<span class="ident" id="6515027">i</span>&nbsp;<span class="op" id="6515029">:=</span>&nbsp;<span class="keyword" id="6515032">range</span>&nbsp;<span class="ident" id="6515038">b</span>&nbsp;<span class="op" id="6515040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515044">b</span><span class="op" id="6515045">[</span><span class="ident" id="6515046">i</span><span class="op" id="6515047">]</span>&nbsp;<span class="op" id="6515049">=</span>&nbsp;<span class="num" id="6515051">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6515054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6515058">return</span>&nbsp;<span class="builtinfunc" id="6515065">len</span><span class="op" id="6515068">(</span><span class="ident" id="6515069">b</span><span class="op" id="6515070">)</span><span class="op" id="6515071">,</span>&nbsp;<span class="ident" id="6515073">nil</span><br>
<span class="lineno"></span><span class="op" id="6515077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6515080">var</span>&nbsp;<span class="ident" id="6515084">testConfig</span>&nbsp;<span class="op" id="6515095">*</span><span class="ident" id="6515096">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6515104">func</span>&nbsp;<span class="ident" id="6515109">init</span><span class="op" id="6515113">(</span><span class="op" id="6515114">)</span>&nbsp;<span class="op" id="6515116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515119">testConfig</span>&nbsp;<span class="op" id="6515130">=</span>&nbsp;<span class="op" id="6515132">&amp;</span><span class="ident" id="6515133">Config</span><span class="op" id="6515139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515143">Time</span><span class="op" id="6515147">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6515163">func</span><span class="op" id="6515167">(</span><span class="op" id="6515168">)</span>&nbsp;<span class="ident" id="6515170">time</span><span class="op" id="6515174">.</span><span class="ident" id="6515175">Time</span>&nbsp;<span class="op" id="6515180">{</span>&nbsp;<span class="keyword" id="6515182">return</span>&nbsp;<span class="ident" id="6515189">time</span><span class="op" id="6515193">.</span><span class="ident" id="6515194">Unix</span><span class="op" id="6515198">(</span><span class="num" id="6515199">0</span><span class="op" id="6515200">,</span>&nbsp;<span class="num" id="6515202">0</span><span class="op" id="6515203">)</span>&nbsp;<span class="op" id="6515205">}</span><span class="op" id="6515206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515210">Rand</span><span class="op" id="6515214">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515230">zeroSource</span><span class="op" id="6515240">{</span><span class="op" id="6515241">}</span><span class="op" id="6515242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515246">Certificates</span><span class="op" id="6515258">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6515266">make</span><span class="op" id="6515270">(</span><span class="op" id="6515271">[</span><span class="op" id="6515272">]</span><span class="ident" id="6515273">Certificate</span><span class="op" id="6515284">,</span>&nbsp;<span class="num" id="6515286">2</span><span class="op" id="6515287">)</span><span class="op" id="6515288">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515292">InsecureSkipVerify</span><span class="op" id="6515310">:</span>&nbsp;<span class="builtintype" id="6515312">true</span><span class="op" id="6515316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515320">MinVersion</span><span class="op" id="6515330">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515340">VersionSSL30</span><span class="op" id="6515352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515356">MaxVersion</span><span class="op" id="6515366">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515376">VersionTLS12</span><span class="op" id="6515388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6515391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515394">testConfig</span><span class="op" id="6515404">.</span><span class="ident" id="6515405">Certificates</span><span class="op" id="6515417">[</span><span class="num" id="6515418">0</span><span class="op" id="6515419">]</span><span class="op" id="6515420">.</span><span class="ident" id="6515421">Certificate</span>&nbsp;<span class="op" id="6515433">=</span>&nbsp;<span class="op" id="6515435">[</span><span class="op" id="6515436">]</span><span class="op" id="6515437">[</span><span class="op" id="6515438">]</span><span class="builtintype" id="6515439">byte</span><span class="op" id="6515443">{</span><span class="ident" id="6515444">testRSACertificate</span><span class="op" id="6515462">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515465">testConfig</span><span class="op" id="6515475">.</span><span class="ident" id="6515476">Certificates</span><span class="op" id="6515488">[</span><span class="num" id="6515489">0</span><span class="op" id="6515490">]</span><span class="op" id="6515491">.</span><span class="ident" id="6515492">PrivateKey</span>&nbsp;<span class="op" id="6515503">=</span>&nbsp;<span class="ident" id="6515505">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515524">testConfig</span><span class="op" id="6515534">.</span><span class="ident" id="6515535">Certificates</span><span class="op" id="6515547">[</span><span class="num" id="6515548">1</span><span class="op" id="6515549">]</span><span class="op" id="6515550">.</span><span class="ident" id="6515551">Certificate</span>&nbsp;<span class="op" id="6515563">=</span>&nbsp;<span class="op" id="6515565">[</span><span class="op" id="6515566">]</span><span class="op" id="6515567">[</span><span class="op" id="6515568">]</span><span class="builtintype" id="6515569">byte</span><span class="op" id="6515573">{</span><span class="ident" id="6515574">testSNICertificate</span><span class="op" id="6515592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515595">testConfig</span><span class="op" id="6515605">.</span><span class="ident" id="6515606">Certificates</span><span class="op" id="6515618">[</span><span class="num" id="6515619">1</span><span class="op" id="6515620">]</span><span class="op" id="6515621">.</span><span class="ident" id="6515622">PrivateKey</span>&nbsp;<span class="op" id="6515633">=</span>&nbsp;<span class="ident" id="6515635">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515654">testConfig</span><span class="op" id="6515664">.</span><span class="ident" id="6515665">BuildNameToCertificate</span><span class="op" id="6515687">(</span><span class="op" id="6515688">)</span><br>
<span class="lineno"></span><span class="op" id="6515690">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6515693">func</span>&nbsp;<span class="ident" id="6515698">testClientHelloFailure</span><span class="op" id="6515720">(</span><span class="ident" id="6515721">t</span>&nbsp;<span class="op" id="6515723">*</span><span class="ident" id="6515724">testing</span><span class="op" id="6515731">.</span><span class="ident" id="6515732">T</span><span class="op" id="6515733">,</span>&nbsp;<span class="ident" id="6515735">m</span>&nbsp;<span class="ident" id="6515737">handshakeMessage</span><span class="op" id="6515753">,</span>&nbsp;<span class="ident" id="6515755">expectedSubStr</span>&nbsp;<span class="builtintype" id="6515770">string</span><span class="op" id="6515776">)</span>&nbsp;<span class="op" id="6515778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6515781">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6515822">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6515865">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515885">c</span><span class="op" id="6515886">,</span>&nbsp;<span class="ident" id="6515888">s</span>&nbsp;<span class="op" id="6515890">:=</span>&nbsp;<span class="ident" id="6515893">net</span><span class="op" id="6515896">.</span><span class="ident" id="6515897">Pipe</span><span class="op" id="6515901">(</span><span class="op" id="6515902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6515905">go</span>&nbsp;<span class="keyword" id="6515908">func</span><span class="op" id="6515912">(</span><span class="op" id="6515913">)</span>&nbsp;<span class="op" id="6515915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515919">cli</span>&nbsp;<span class="op" id="6515923">:=</span>&nbsp;<span class="ident" id="6515926">Client</span><span class="op" id="6515932">(</span><span class="ident" id="6515933">c</span><span class="op" id="6515934">,</span>&nbsp;<span class="ident" id="6515936">testConfig</span><span class="op" id="6515946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6515950">if</span>&nbsp;<span class="ident" id="6515953">ch</span><span class="op" id="6515955">,</span>&nbsp;<span class="ident" id="6515957">ok</span>&nbsp;<span class="op" id="6515960">:=</span>&nbsp;<span class="ident" id="6515963">m</span><span class="op" id="6515964">.</span><span class="op" id="6515965">(</span><span class="op" id="6515966">*</span><span class="ident" id="6515967">clientHelloMsg</span><span class="op" id="6515981">)</span><span class="op" id="6515982">;</span>&nbsp;<span class="ident" id="6515984">ok</span>&nbsp;<span class="op" id="6515987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6515992">cli</span><span class="op" id="6515995">.</span><span class="ident" id="6515996">vers</span>&nbsp;<span class="op" id="6516001">=</span>&nbsp;<span class="ident" id="6516003">ch</span><span class="op" id="6516005">.</span><span class="ident" id="6516006">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6516013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516017">cli</span><span class="op" id="6516020">.</span><span class="ident" id="6516021">writeRecord</span><span class="op" id="6516032">(</span><span class="ident" id="6516033">recordTypeHandshake</span><span class="op" id="6516052">,</span>&nbsp;<span class="ident" id="6516054">m</span><span class="op" id="6516055">.</span><span class="ident" id="6516056">marshal</span><span class="op" id="6516063">(</span><span class="op" id="6516064">)</span><span class="op" id="6516065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516069">c</span><span class="op" id="6516070">.</span><span class="ident" id="6516071">Close</span><span class="op" id="6516076">(</span><span class="op" id="6516077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6516080">}</span><span class="op" id="6516081">(</span><span class="op" id="6516082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516085">err</span>&nbsp;<span class="op" id="6516089">:=</span>&nbsp;<span class="ident" id="6516092">Server</span><span class="op" id="6516098">(</span><span class="ident" id="6516099">s</span><span class="op" id="6516100">,</span>&nbsp;<span class="ident" id="6516102">testConfig</span><span class="op" id="6516112">)</span><span class="op" id="6516113">.</span><span class="ident" id="6516114">Handshake</span><span class="op" id="6516123">(</span><span class="op" id="6516124">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516127">s</span><span class="op" id="6516128">.</span><span class="ident" id="6516129">Close</span><span class="op" id="6516134">(</span><span class="op" id="6516135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6516138">if</span>&nbsp;<span class="ident" id="6516141">err</span>&nbsp;<span class="op" id="6516145">==</span>&nbsp;<span class="ident" id="6516148">nil</span>&nbsp;<span class="op" id="6516152">||</span>&nbsp;<span class="op" id="6516155">!</span><span class="ident" id="6516156">strings</span><span class="op" id="6516163">.</span><span class="ident" id="6516164">Contains</span><span class="op" id="6516172">(</span><span class="ident" id="6516173">err</span><span class="op" id="6516176">.</span><span class="ident" id="6516177">Error</span><span class="op" id="6516182">(</span><span class="op" id="6516183">)</span><span class="op" id="6516184">,</span>&nbsp;<span class="ident" id="6516186">expectedSubStr</span><span class="op" id="6516200">)</span>&nbsp;<span class="op" id="6516202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516206">t</span><span class="op" id="6516207">.</span><span class="ident" id="6516208">Errorf</span><span class="op" id="6516214">(</span><span class="string" id="6516215">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="6516264">,</span>&nbsp;<span class="ident" id="6516266">err</span><span class="op" id="6516269">,</span>&nbsp;<span class="ident" id="6516271">expectedSubStr</span><span class="op" id="6516285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6516288">}</span><br>
<span class="lineno"></span><span class="op" id="6516290">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="6516293">func</span>&nbsp;<span class="ident" id="6516298">TestSimpleError</span><span class="op" id="6516313">(</span><span class="ident" id="6516314">t</span>&nbsp;<span class="op" id="6516316">*</span><span class="ident" id="6516317">testing</span><span class="op" id="6516324">.</span><span class="ident" id="6516325">T</span><span class="op" id="6516326">)</span>&nbsp;<span class="op" id="6516328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516331">testClientHelloFailure</span><span class="op" id="6516353">(</span><span class="ident" id="6516354">t</span><span class="op" id="6516355">,</span>&nbsp;<span class="op" id="6516357">&amp;</span><span class="ident" id="6516358">serverHelloDoneMsg</span><span class="op" id="6516376">{</span><span class="op" id="6516377">}</span><span class="op" id="6516378">,</span>&nbsp;<span class="string" id="6516380">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="6516410">)</span><br>
<span class="lineno"></span><span class="op" id="6516412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6516415">var</span>&nbsp;<span class="ident" id="6516419">badProtocolVersions</span>&nbsp;<span class="op" id="6516439">=</span>&nbsp;<span class="op" id="6516441">[</span><span class="op" id="6516442">]</span><span class="builtintype" id="6516443">uint16</span><span class="op" id="6516449">{</span><span class="num" id="6516450">0x0000</span><span class="op" id="6516456">,</span>&nbsp;<span class="num" id="6516458">0x0005</span><span class="op" id="6516464">,</span>&nbsp;<span class="num" id="6516466">0x0100</span><span class="op" id="6516472">,</span>&nbsp;<span class="num" id="6516474">0x0105</span><span class="op" id="6516480">,</span>&nbsp;<span class="num" id="6516482">0x0200</span><span class="op" id="6516488">,</span>&nbsp;<span class="num" id="6516490">0x0205</span><span class="op" id="6516496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6516499">func</span>&nbsp;<span class="ident" id="6516504">TestRejectBadProtocolVersion</span><span class="op" id="6516532">(</span><span class="ident" id="6516533">t</span>&nbsp;<span class="op" id="6516535">*</span><span class="ident" id="6516536">testing</span><span class="op" id="6516543">.</span><span class="ident" id="6516544">T</span><span class="op" id="6516545">)</span>&nbsp;<span class="op" id="6516547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6516550">for</span>&nbsp;<span class="ident" id="6516554">_</span><span class="op" id="6516555">,</span>&nbsp;<span class="ident" id="6516557">v</span>&nbsp;<span class="op" id="6516559">:=</span>&nbsp;<span class="keyword" id="6516562">range</span>&nbsp;<span class="ident" id="6516568">badProtocolVersions</span>&nbsp;<span class="op" id="6516588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516592">testClientHelloFailure</span><span class="op" id="6516614">(</span><span class="ident" id="6516615">t</span><span class="op" id="6516616">,</span>&nbsp;<span class="op" id="6516618">&amp;</span><span class="ident" id="6516619">clientHelloMsg</span><span class="op" id="6516633">{</span><span class="ident" id="6516634">vers</span><span class="op" id="6516638">:</span>&nbsp;<span class="ident" id="6516640">v</span><span class="op" id="6516641">}</span><span class="op" id="6516642">,</span>&nbsp;<span class="string" id="6516644">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="6516683">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6516686">}</span><br>
<span class="lineno"></span><span class="op" id="6516688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6516691">func</span>&nbsp;<span class="ident" id="6516696">TestNoSuiteOverlap</span><span class="op" id="6516714">(</span><span class="ident" id="6516715">t</span>&nbsp;<span class="op" id="6516717">*</span><span class="ident" id="6516718">testing</span><span class="op" id="6516725">.</span><span class="ident" id="6516726">T</span><span class="op" id="6516727">)</span>&nbsp;<span class="op" id="6516729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516732">clientHello</span>&nbsp;<span class="op" id="6516744">:=</span>&nbsp;<span class="op" id="6516747">&amp;</span><span class="ident" id="6516748">clientHelloMsg</span><span class="op" id="6516762">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516766">vers</span><span class="op" id="6516770">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6516786">0x0301</span><span class="op" id="6516792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516796">cipherSuites</span><span class="op" id="6516808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6516816">[</span><span class="op" id="6516817">]</span><span class="builtintype" id="6516818">uint16</span><span class="op" id="6516824">{</span><span class="num" id="6516825">0xff00</span><span class="op" id="6516831">}</span><span class="op" id="6516832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516836">compressionMethods</span><span class="op" id="6516854">:</span>&nbsp;<span class="op" id="6516856">[</span><span class="op" id="6516857">]</span><span class="builtintype" id="6516858">uint8</span><span class="op" id="6516863">{</span><span class="num" id="6516864">0</span><span class="op" id="6516865">}</span><span class="op" id="6516866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6516869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6516872">testClientHelloFailure</span><span class="op" id="6516894">(</span><span class="ident" id="6516895">t</span><span class="op" id="6516896">,</span>&nbsp;<span class="ident" id="6516898">clientHello</span><span class="op" id="6516909">,</span>&nbsp;<span class="string" id="6516911">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="6516964">)</span><br>
<span class="lineno">95</span><span class="op" id="6516966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6516969">func</span>&nbsp;<span class="ident" id="6516974">TestNoCompressionOverlap</span><span class="op" id="6516998">(</span><span class="ident" id="6516999">t</span>&nbsp;<span class="op" id="6517001">*</span><span class="ident" id="6517002">testing</span><span class="op" id="6517009">.</span><span class="ident" id="6517010">T</span><span class="op" id="6517011">)</span>&nbsp;<span class="op" id="6517013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517016">clientHello</span>&nbsp;<span class="op" id="6517028">:=</span>&nbsp;<span class="op" id="6517031">&amp;</span><span class="ident" id="6517032">clientHelloMsg</span><span class="op" id="6517046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517050">vers</span><span class="op" id="6517054">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6517070">0x0301</span><span class="op" id="6517076">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517080">cipherSuites</span><span class="op" id="6517092">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6517100">[</span><span class="op" id="6517101">]</span><span class="builtintype" id="6517102">uint16</span><span class="op" id="6517108">{</span><span class="ident" id="6517109">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6517133">}</span><span class="op" id="6517134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517138">compressionMethods</span><span class="op" id="6517156">:</span>&nbsp;<span class="op" id="6517158">[</span><span class="op" id="6517159">]</span><span class="builtintype" id="6517160">uint8</span><span class="op" id="6517165">{</span><span class="num" id="6517166">0xff</span><span class="op" id="6517170">}</span><span class="op" id="6517171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6517174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517177">testClientHelloFailure</span><span class="op" id="6517199">(</span><span class="ident" id="6517200">t</span><span class="op" id="6517201">,</span>&nbsp;<span class="ident" id="6517203">clientHello</span><span class="op" id="6517214">,</span>&nbsp;<span class="string" id="6517216">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="6517266">)</span><br>
<span class="lineno"></span><span class="op" id="6517268">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6517271">func</span>&nbsp;<span class="ident" id="6517276">TestTLS12OnlyCipherSuites</span><span class="op" id="6517301">(</span><span class="ident" id="6517302">t</span>&nbsp;<span class="op" id="6517304">*</span><span class="ident" id="6517305">testing</span><span class="op" id="6517312">.</span><span class="ident" id="6517313">T</span><span class="op" id="6517314">)</span>&nbsp;<span class="op" id="6517316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6517319">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6517390">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6517425">var</span>&nbsp;<span class="ident" id="6517429">zeros</span>&nbsp;<span class="op" id="6517435">[</span><span class="num" id="6517436">32</span><span class="op" id="6517438">]</span><span class="builtintype" id="6517439">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517446">clientHello</span>&nbsp;<span class="op" id="6517458">:=</span>&nbsp;<span class="op" id="6517461">&amp;</span><span class="ident" id="6517462">clientHelloMsg</span><span class="op" id="6517476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517480">vers</span><span class="op" id="6517484">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6517488">VersionTLS11</span><span class="op" id="6517500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517504">random</span><span class="op" id="6517510">:</span>&nbsp;<span class="ident" id="6517512">zeros</span><span class="op" id="6517517">[</span><span class="op" id="6517518">:</span><span class="op" id="6517519">]</span><span class="op" id="6517520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517524">cipherSuites</span><span class="op" id="6517536">:</span>&nbsp;<span class="op" id="6517538">[</span><span class="op" id="6517539">]</span><span class="builtintype" id="6517540">uint16</span><span class="op" id="6517546">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6517551">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6517603">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6517651">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6517703">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517745">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="6517782">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517787">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6517811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6517815">}</span><span class="op" id="6517816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517820">compressionMethods</span><span class="op" id="6517838">:</span>&nbsp;<span class="op" id="6517840">[</span><span class="op" id="6517841">]</span><span class="builtintype" id="6517842">uint8</span><span class="op" id="6517847">{</span><span class="ident" id="6517848">compressionNone</span><span class="op" id="6517863">}</span><span class="op" id="6517864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517868">supportedCurves</span><span class="op" id="6517883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6517888">[</span><span class="op" id="6517889">]</span><span class="ident" id="6517890">CurveID</span><span class="op" id="6517897">{</span><span class="ident" id="6517898">CurveP256</span><span class="op" id="6517907">,</span>&nbsp;<span class="ident" id="6517909">CurveP384</span><span class="op" id="6517918">,</span>&nbsp;<span class="ident" id="6517920">CurveP521</span><span class="op" id="6517929">}</span><span class="op" id="6517930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517934">supportedPoints</span><span class="op" id="6517949">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6517954">[</span><span class="op" id="6517955">]</span><span class="builtintype" id="6517956">uint8</span><span class="op" id="6517961">{</span><span class="ident" id="6517962">pointFormatUncompressed</span><span class="op" id="6517985">}</span><span class="op" id="6517986">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6517989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6517993">c</span><span class="op" id="6517994">,</span>&nbsp;<span class="ident" id="6517996">s</span>&nbsp;<span class="op" id="6517998">:=</span>&nbsp;<span class="ident" id="6518001">net</span><span class="op" id="6518004">.</span><span class="ident" id="6518005">Pipe</span><span class="op" id="6518009">(</span><span class="op" id="6518010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518013">var</span>&nbsp;<span class="ident" id="6518017">reply</span>&nbsp;<span class="keyword" id="6518023">interface</span><span class="op" id="6518032">{</span><span class="op" id="6518033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518036">var</span>&nbsp;<span class="ident" id="6518040">clientErr</span>&nbsp;<span class="builtintype" id="6518050">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518057">go</span>&nbsp;<span class="keyword" id="6518060">func</span><span class="op" id="6518064">(</span><span class="op" id="6518065">)</span>&nbsp;<span class="op" id="6518067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518071">cli</span>&nbsp;<span class="op" id="6518075">:=</span>&nbsp;<span class="ident" id="6518078">Client</span><span class="op" id="6518084">(</span><span class="ident" id="6518085">c</span><span class="op" id="6518086">,</span>&nbsp;<span class="ident" id="6518088">testConfig</span><span class="op" id="6518098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518102">cli</span><span class="op" id="6518105">.</span><span class="ident" id="6518106">vers</span>&nbsp;<span class="op" id="6518111">=</span>&nbsp;<span class="ident" id="6518113">clientHello</span><span class="op" id="6518124">.</span><span class="ident" id="6518125">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518132">cli</span><span class="op" id="6518135">.</span><span class="ident" id="6518136">writeRecord</span><span class="op" id="6518147">(</span><span class="ident" id="6518148">recordTypeHandshake</span><span class="op" id="6518167">,</span>&nbsp;<span class="ident" id="6518169">clientHello</span><span class="op" id="6518180">.</span><span class="ident" id="6518181">marshal</span><span class="op" id="6518188">(</span><span class="op" id="6518189">)</span><span class="op" id="6518190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518194">reply</span><span class="op" id="6518199">,</span>&nbsp;<span class="ident" id="6518201">clientErr</span>&nbsp;<span class="op" id="6518211">=</span>&nbsp;<span class="ident" id="6518213">cli</span><span class="op" id="6518216">.</span><span class="ident" id="6518217">readHandshake</span><span class="op" id="6518230">(</span><span class="op" id="6518231">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518235">c</span><span class="op" id="6518236">.</span><span class="ident" id="6518237">Close</span><span class="op" id="6518242">(</span><span class="op" id="6518243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6518246">}</span><span class="op" id="6518247">(</span><span class="op" id="6518248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518251">config</span>&nbsp;<span class="op" id="6518258">:=</span>&nbsp;<span class="op" id="6518261">*</span><span class="ident" id="6518262">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518274">config</span><span class="op" id="6518280">.</span><span class="ident" id="6518281">CipherSuites</span>&nbsp;<span class="op" id="6518294">=</span>&nbsp;<span class="ident" id="6518296">clientHello</span><span class="op" id="6518307">.</span><span class="ident" id="6518308">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518322">Server</span><span class="op" id="6518328">(</span><span class="ident" id="6518329">s</span><span class="op" id="6518330">,</span>&nbsp;<span class="op" id="6518332">&amp;</span><span class="ident" id="6518333">config</span><span class="op" id="6518339">)</span><span class="op" id="6518340">.</span><span class="ident" id="6518341">Handshake</span><span class="op" id="6518350">(</span><span class="op" id="6518351">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518354">s</span><span class="op" id="6518355">.</span><span class="ident" id="6518356">Close</span><span class="op" id="6518361">(</span><span class="op" id="6518362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518365">if</span>&nbsp;<span class="ident" id="6518368">clientErr</span>&nbsp;<span class="op" id="6518378">!=</span>&nbsp;<span class="ident" id="6518381">nil</span>&nbsp;<span class="op" id="6518385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518389">t</span><span class="op" id="6518390">.</span><span class="ident" id="6518391">Fatal</span><span class="op" id="6518396">(</span><span class="ident" id="6518397">clientErr</span><span class="op" id="6518406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6518409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518412">serverHello</span><span class="op" id="6518423">,</span>&nbsp;<span class="ident" id="6518425">ok</span>&nbsp;<span class="op" id="6518428">:=</span>&nbsp;<span class="ident" id="6518431">reply</span><span class="op" id="6518436">.</span><span class="op" id="6518437">(</span><span class="op" id="6518438">*</span><span class="ident" id="6518439">serverHelloMsg</span><span class="op" id="6518453">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518456">if</span>&nbsp;<span class="op" id="6518459">!</span><span class="ident" id="6518460">ok</span>&nbsp;<span class="op" id="6518463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518467">t</span><span class="op" id="6518468">.</span><span class="ident" id="6518469">Fatalf</span><span class="op" id="6518475">(</span><span class="string" id="6518476">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="6518527">,</span>&nbsp;<span class="ident" id="6518529">reply</span><span class="op" id="6518534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6518537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518540">if</span>&nbsp;<span class="ident" id="6518543">s</span>&nbsp;<span class="op" id="6518545">:=</span>&nbsp;<span class="ident" id="6518548">serverHello</span><span class="op" id="6518559">.</span><span class="ident" id="6518560">cipherSuite</span><span class="op" id="6518571">;</span>&nbsp;<span class="ident" id="6518573">s</span>&nbsp;<span class="op" id="6518575">!=</span>&nbsp;<span class="ident" id="6518578">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="6518603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518607">t</span><span class="op" id="6518608">.</span><span class="ident" id="6518609">Fatalf</span><span class="op" id="6518615">(</span><span class="string" id="6518616">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="6518650">,</span>&nbsp;<span class="ident" id="6518652">s</span><span class="op" id="6518653">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6518656">}</span><br>
<span class="lineno"></span><span class="op" id="6518658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6518661">func</span>&nbsp;<span class="ident" id="6518666">TestAlertForwarding</span><span class="op" id="6518685">(</span><span class="ident" id="6518686">t</span>&nbsp;<span class="op" id="6518688">*</span><span class="ident" id="6518689">testing</span><span class="op" id="6518696">.</span><span class="ident" id="6518697">T</span><span class="op" id="6518698">)</span>&nbsp;<span class="op" id="6518700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518703">c</span><span class="op" id="6518704">,</span>&nbsp;<span class="ident" id="6518706">s</span>&nbsp;<span class="op" id="6518708">:=</span>&nbsp;<span class="ident" id="6518711">net</span><span class="op" id="6518714">.</span><span class="ident" id="6518715">Pipe</span><span class="op" id="6518719">(</span><span class="op" id="6518720">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518723">go</span>&nbsp;<span class="keyword" id="6518726">func</span><span class="op" id="6518730">(</span><span class="op" id="6518731">)</span>&nbsp;<span class="op" id="6518733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518737">Client</span><span class="op" id="6518743">(</span><span class="ident" id="6518744">c</span><span class="op" id="6518745">,</span>&nbsp;<span class="ident" id="6518747">testConfig</span><span class="op" id="6518757">)</span><span class="op" id="6518758">.</span><span class="ident" id="6518759">sendAlert</span><span class="op" id="6518768">(</span><span class="ident" id="6518769">alertUnknownCA</span><span class="op" id="6518783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518787">c</span><span class="op" id="6518788">.</span><span class="ident" id="6518789">Close</span><span class="op" id="6518794">(</span><span class="op" id="6518795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6518798">}</span><span class="op" id="6518799">(</span><span class="op" id="6518800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518804">err</span>&nbsp;<span class="op" id="6518808">:=</span>&nbsp;<span class="ident" id="6518811">Server</span><span class="op" id="6518817">(</span><span class="ident" id="6518818">s</span><span class="op" id="6518819">,</span>&nbsp;<span class="ident" id="6518821">testConfig</span><span class="op" id="6518831">)</span><span class="op" id="6518832">.</span><span class="ident" id="6518833">Handshake</span><span class="op" id="6518842">(</span><span class="op" id="6518843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518846">s</span><span class="op" id="6518847">.</span><span class="ident" id="6518848">Close</span><span class="op" id="6518853">(</span><span class="op" id="6518854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6518857">if</span>&nbsp;<span class="ident" id="6518860">e</span><span class="op" id="6518861">,</span>&nbsp;<span class="ident" id="6518863">ok</span>&nbsp;<span class="op" id="6518866">:=</span>&nbsp;<span class="ident" id="6518869">err</span><span class="op" id="6518872">.</span><span class="op" id="6518873">(</span><span class="op" id="6518874">*</span><span class="ident" id="6518875">net</span><span class="op" id="6518878">.</span><span class="ident" id="6518879">OpError</span><span class="op" id="6518886">)</span><span class="op" id="6518887">;</span>&nbsp;<span class="op" id="6518889">!</span><span class="ident" id="6518890">ok</span>&nbsp;<span class="op" id="6518893">||</span>&nbsp;<span class="ident" id="6518896">e</span><span class="op" id="6518897">.</span><span class="ident" id="6518898">Err</span>&nbsp;<span class="op" id="6518902">!=</span>&nbsp;<span class="builtintype" id="6518905">error</span><span class="op" id="6518910">(</span><span class="ident" id="6518911">alertUnknownCA</span><span class="op" id="6518925">)</span>&nbsp;<span class="op" id="6518927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6518931">t</span><span class="op" id="6518932">.</span><span class="ident" id="6518933">Errorf</span><span class="op" id="6518939">(</span><span class="string" id="6518940">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="6518969">,</span>&nbsp;<span class="ident" id="6518971">err</span><span class="op" id="6518974">,</span>&nbsp;<span class="builtintype" id="6518976">error</span><span class="op" id="6518981">(</span><span class="ident" id="6518982">alertUnknownCA</span><span class="op" id="6518996">)</span><span class="op" id="6518997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519000">}</span><br>
<span class="lineno">165</span><span class="op" id="6519002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6519005">func</span>&nbsp;<span class="ident" id="6519010">TestClose</span><span class="op" id="6519019">(</span><span class="ident" id="6519020">t</span>&nbsp;<span class="op" id="6519022">*</span><span class="ident" id="6519023">testing</span><span class="op" id="6519030">.</span><span class="ident" id="6519031">T</span><span class="op" id="6519032">)</span>&nbsp;<span class="op" id="6519034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519037">c</span><span class="op" id="6519038">,</span>&nbsp;<span class="ident" id="6519040">s</span>&nbsp;<span class="op" id="6519042">:=</span>&nbsp;<span class="ident" id="6519045">net</span><span class="op" id="6519048">.</span><span class="ident" id="6519049">Pipe</span><span class="op" id="6519053">(</span><span class="op" id="6519054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519057">go</span>&nbsp;<span class="ident" id="6519060">c</span><span class="op" id="6519061">.</span><span class="ident" id="6519062">Close</span><span class="op" id="6519067">(</span><span class="op" id="6519068">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519072">err</span>&nbsp;<span class="op" id="6519076">:=</span>&nbsp;<span class="ident" id="6519079">Server</span><span class="op" id="6519085">(</span><span class="ident" id="6519086">s</span><span class="op" id="6519087">,</span>&nbsp;<span class="ident" id="6519089">testConfig</span><span class="op" id="6519099">)</span><span class="op" id="6519100">.</span><span class="ident" id="6519101">Handshake</span><span class="op" id="6519110">(</span><span class="op" id="6519111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519114">s</span><span class="op" id="6519115">.</span><span class="ident" id="6519116">Close</span><span class="op" id="6519121">(</span><span class="op" id="6519122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519125">if</span>&nbsp;<span class="ident" id="6519128">err</span>&nbsp;<span class="op" id="6519132">!=</span>&nbsp;<span class="ident" id="6519135">io</span><span class="op" id="6519137">.</span><span class="ident" id="6519138">EOF</span>&nbsp;<span class="op" id="6519142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519146">t</span><span class="op" id="6519147">.</span><span class="ident" id="6519148">Errorf</span><span class="op" id="6519154">(</span><span class="string" id="6519155">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="6519184">,</span>&nbsp;<span class="ident" id="6519186">err</span><span class="op" id="6519189">,</span>&nbsp;<span class="ident" id="6519191">io</span><span class="op" id="6519193">.</span><span class="ident" id="6519194">EOF</span><span class="op" id="6519197">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519200">}</span><br>
<span class="lineno"></span><span class="op" id="6519202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6519205">func</span>&nbsp;<span class="ident" id="6519210">testHandshake</span><span class="op" id="6519223">(</span><span class="ident" id="6519224">clientConfig</span><span class="op" id="6519236">,</span>&nbsp;<span class="ident" id="6519238">serverConfig</span>&nbsp;<span class="op" id="6519251">*</span><span class="ident" id="6519252">Config</span><span class="op" id="6519258">)</span>&nbsp;<span class="op" id="6519260">(</span><span class="ident" id="6519261">state</span>&nbsp;<span class="ident" id="6519267">ConnectionState</span><span class="op" id="6519282">,</span>&nbsp;<span class="ident" id="6519284">err</span>&nbsp;<span class="builtintype" id="6519288">error</span><span class="op" id="6519293">)</span>&nbsp;<span class="op" id="6519295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519298">c</span><span class="op" id="6519299">,</span>&nbsp;<span class="ident" id="6519301">s</span>&nbsp;<span class="op" id="6519303">:=</span>&nbsp;<span class="ident" id="6519306">net</span><span class="op" id="6519309">.</span><span class="ident" id="6519310">Pipe</span><span class="op" id="6519314">(</span><span class="op" id="6519315">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519318">done</span>&nbsp;<span class="op" id="6519323">:=</span>&nbsp;<span class="builtinfunc" id="6519326">make</span><span class="op" id="6519330">(</span><span class="keyword" id="6519331">chan</span>&nbsp;<span class="builtintype" id="6519336">bool</span><span class="op" id="6519340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519343">go</span>&nbsp;<span class="keyword" id="6519346">func</span><span class="op" id="6519350">(</span><span class="op" id="6519351">)</span>&nbsp;<span class="op" id="6519353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519357">cli</span>&nbsp;<span class="op" id="6519361">:=</span>&nbsp;<span class="ident" id="6519364">Client</span><span class="op" id="6519370">(</span><span class="ident" id="6519371">c</span><span class="op" id="6519372">,</span>&nbsp;<span class="ident" id="6519374">clientConfig</span><span class="op" id="6519386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519390">cli</span><span class="op" id="6519393">.</span><span class="ident" id="6519394">Handshake</span><span class="op" id="6519403">(</span><span class="op" id="6519404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519408">c</span><span class="op" id="6519409">.</span><span class="ident" id="6519410">Close</span><span class="op" id="6519415">(</span><span class="op" id="6519416">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519420">done</span>&nbsp;<span class="op" id="6519425">&lt;-</span>&nbsp;<span class="builtintype" id="6519428">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519434">}</span><span class="op" id="6519435">(</span><span class="op" id="6519436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519439">server</span>&nbsp;<span class="op" id="6519446">:=</span>&nbsp;<span class="ident" id="6519449">Server</span><span class="op" id="6519455">(</span><span class="ident" id="6519456">s</span><span class="op" id="6519457">,</span>&nbsp;<span class="ident" id="6519459">serverConfig</span><span class="op" id="6519471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519474">err</span>&nbsp;<span class="op" id="6519478">=</span>&nbsp;<span class="ident" id="6519480">server</span><span class="op" id="6519486">.</span><span class="ident" id="6519487">Handshake</span><span class="op" id="6519496">(</span><span class="op" id="6519497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519500">if</span>&nbsp;<span class="ident" id="6519503">err</span>&nbsp;<span class="op" id="6519507">==</span>&nbsp;<span class="ident" id="6519510">nil</span>&nbsp;<span class="op" id="6519514">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519518">state</span>&nbsp;<span class="op" id="6519524">=</span>&nbsp;<span class="ident" id="6519526">server</span><span class="op" id="6519532">.</span><span class="ident" id="6519533">ConnectionState</span><span class="op" id="6519548">(</span><span class="op" id="6519549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519555">s</span><span class="op" id="6519556">.</span><span class="ident" id="6519557">Close</span><span class="op" id="6519562">(</span><span class="op" id="6519563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519566">&lt;-</span><span class="ident" id="6519568">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519574">return</span><br>
<span class="lineno">195</span><span class="op" id="6519581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6519584">func</span>&nbsp;<span class="ident" id="6519589">TestVersion</span><span class="op" id="6519600">(</span><span class="ident" id="6519601">t</span>&nbsp;<span class="op" id="6519603">*</span><span class="ident" id="6519604">testing</span><span class="op" id="6519611">.</span><span class="ident" id="6519612">T</span><span class="op" id="6519613">)</span>&nbsp;<span class="op" id="6519615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519618">serverConfig</span>&nbsp;<span class="op" id="6519631">:=</span>&nbsp;<span class="op" id="6519634">&amp;</span><span class="ident" id="6519635">Config</span><span class="op" id="6519641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519645">Certificates</span><span class="op" id="6519657">:</span>&nbsp;<span class="ident" id="6519659">testConfig</span><span class="op" id="6519669">.</span><span class="ident" id="6519670">Certificates</span><span class="op" id="6519682">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519686">MaxVersion</span><span class="op" id="6519696">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6519700">VersionTLS11</span><span class="op" id="6519712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519718">clientConfig</span>&nbsp;<span class="op" id="6519731">:=</span>&nbsp;<span class="op" id="6519734">&amp;</span><span class="ident" id="6519735">Config</span><span class="op" id="6519741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519745">InsecureSkipVerify</span><span class="op" id="6519763">:</span>&nbsp;<span class="builtintype" id="6519765">true</span><span class="op" id="6519769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519772">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519775">state</span><span class="op" id="6519780">,</span>&nbsp;<span class="ident" id="6519782">err</span>&nbsp;<span class="op" id="6519786">:=</span>&nbsp;<span class="ident" id="6519789">testHandshake</span><span class="op" id="6519802">(</span><span class="ident" id="6519803">clientConfig</span><span class="op" id="6519815">,</span>&nbsp;<span class="ident" id="6519817">serverConfig</span><span class="op" id="6519829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519832">if</span>&nbsp;<span class="ident" id="6519835">err</span>&nbsp;<span class="op" id="6519839">!=</span>&nbsp;<span class="ident" id="6519842">nil</span>&nbsp;<span class="op" id="6519846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519850">t</span><span class="op" id="6519851">.</span><span class="ident" id="6519852">Fatalf</span><span class="op" id="6519858">(</span><span class="string" id="6519859">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6519881">,</span>&nbsp;<span class="ident" id="6519883">err</span><span class="op" id="6519886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6519889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6519892">if</span>&nbsp;<span class="ident" id="6519895">state</span><span class="op" id="6519900">.</span><span class="ident" id="6519901">Version</span>&nbsp;<span class="op" id="6519909">!=</span>&nbsp;<span class="ident" id="6519912">VersionTLS11</span>&nbsp;<span class="op" id="6519925">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6519929">t</span><span class="op" id="6519930">.</span><span class="ident" id="6519931">Fatalf</span><span class="op" id="6519937">(</span><span class="string" id="6519938">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="6519974">,</span>&nbsp;<span class="ident" id="6519976">state</span><span class="op" id="6519981">.</span><span class="ident" id="6519982">Version</span><span class="op" id="6519989">,</span>&nbsp;<span class="ident" id="6519991">VersionTLS11</span><span class="op" id="6520003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520006">}</span><br>
<span class="lineno"></span><span class="op" id="6520008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6520011">func</span>&nbsp;<span class="ident" id="6520016">TestCipherSuitePreference</span><span class="op" id="6520041">(</span><span class="ident" id="6520042">t</span>&nbsp;<span class="op" id="6520044">*</span><span class="ident" id="6520045">testing</span><span class="op" id="6520052">.</span><span class="ident" id="6520053">T</span><span class="op" id="6520054">)</span>&nbsp;<span class="op" id="6520056">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520059">serverConfig</span>&nbsp;<span class="op" id="6520072">:=</span>&nbsp;<span class="op" id="6520075">&amp;</span><span class="ident" id="6520076">Config</span><span class="op" id="6520082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520086">CipherSuites</span><span class="op" id="6520098">:</span>&nbsp;<span class="op" id="6520100">[</span><span class="op" id="6520101">]</span><span class="builtintype" id="6520102">uint16</span><span class="op" id="6520108">{</span><span class="ident" id="6520109">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6520133">,</span>&nbsp;<span class="ident" id="6520135">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="6520163">,</span>&nbsp;<span class="ident" id="6520165">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6520195">}</span><span class="op" id="6520196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520200">Certificates</span><span class="op" id="6520212">:</span>&nbsp;<span class="ident" id="6520214">testConfig</span><span class="op" id="6520224">.</span><span class="ident" id="6520225">Certificates</span><span class="op" id="6520237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520241">MaxVersion</span><span class="op" id="6520251">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6520255">VersionTLS11</span><span class="op" id="6520267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520270">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520273">clientConfig</span>&nbsp;<span class="op" id="6520286">:=</span>&nbsp;<span class="op" id="6520289">&amp;</span><span class="ident" id="6520290">Config</span><span class="op" id="6520296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520300">CipherSuites</span><span class="op" id="6520312">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520320">[</span><span class="op" id="6520321">]</span><span class="builtintype" id="6520322">uint16</span><span class="op" id="6520328">{</span><span class="ident" id="6520329">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="6520357">,</span>&nbsp;<span class="ident" id="6520359">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6520383">}</span><span class="op" id="6520384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520388">InsecureSkipVerify</span><span class="op" id="6520406">:</span>&nbsp;<span class="builtintype" id="6520408">true</span><span class="op" id="6520412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520418">state</span><span class="op" id="6520423">,</span>&nbsp;<span class="ident" id="6520425">err</span>&nbsp;<span class="op" id="6520429">:=</span>&nbsp;<span class="ident" id="6520432">testHandshake</span><span class="op" id="6520445">(</span><span class="ident" id="6520446">clientConfig</span><span class="op" id="6520458">,</span>&nbsp;<span class="ident" id="6520460">serverConfig</span><span class="op" id="6520472">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6520475">if</span>&nbsp;<span class="ident" id="6520478">err</span>&nbsp;<span class="op" id="6520482">!=</span>&nbsp;<span class="ident" id="6520485">nil</span>&nbsp;<span class="op" id="6520489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520493">t</span><span class="op" id="6520494">.</span><span class="ident" id="6520495">Fatalf</span><span class="op" id="6520501">(</span><span class="string" id="6520502">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6520524">,</span>&nbsp;<span class="ident" id="6520526">err</span><span class="op" id="6520529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6520535">if</span>&nbsp;<span class="ident" id="6520538">state</span><span class="op" id="6520543">.</span><span class="ident" id="6520544">CipherSuite</span>&nbsp;<span class="op" id="6520556">!=</span>&nbsp;<span class="ident" id="6520559">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="6520588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6520592">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520655">t</span><span class="op" id="6520656">.</span><span class="ident" id="6520657">Fatalf</span><span class="op" id="6520663">(</span><span class="string" id="6520664">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="6520706">,</span>&nbsp;<span class="ident" id="6520708">state</span><span class="op" id="6520713">.</span><span class="ident" id="6520714">CipherSuite</span><span class="op" id="6520725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520732">serverConfig</span><span class="op" id="6520744">.</span><span class="ident" id="6520745">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6520770">=</span>&nbsp;<span class="builtintype" id="6520772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520778">state</span><span class="op" id="6520783">,</span>&nbsp;<span class="ident" id="6520785">err</span>&nbsp;<span class="op" id="6520789">=</span>&nbsp;<span class="ident" id="6520791">testHandshake</span><span class="op" id="6520804">(</span><span class="ident" id="6520805">clientConfig</span><span class="op" id="6520817">,</span>&nbsp;<span class="ident" id="6520819">serverConfig</span><span class="op" id="6520831">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6520834">if</span>&nbsp;<span class="ident" id="6520837">err</span>&nbsp;<span class="op" id="6520841">!=</span>&nbsp;<span class="ident" id="6520844">nil</span>&nbsp;<span class="op" id="6520848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520852">t</span><span class="op" id="6520853">.</span><span class="ident" id="6520854">Fatalf</span><span class="op" id="6520860">(</span><span class="string" id="6520861">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6520883">,</span>&nbsp;<span class="ident" id="6520885">err</span><span class="op" id="6520888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6520891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6520894">if</span>&nbsp;<span class="ident" id="6520897">state</span><span class="op" id="6520902">.</span><span class="ident" id="6520903">CipherSuite</span>&nbsp;<span class="op" id="6520915">!=</span>&nbsp;<span class="ident" id="6520918">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="6520943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6520947">t</span><span class="op" id="6520948">.</span><span class="ident" id="6520949">Fatalf</span><span class="op" id="6520955">(</span><span class="string" id="6520956">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="6520998">,</span>&nbsp;<span class="ident" id="6521000">state</span><span class="op" id="6521005">.</span><span class="ident" id="6521006">CipherSuite</span><span class="op" id="6521017">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6521020">}</span><br>
<span class="lineno"></span><span class="op" id="6521022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6521025">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6521100">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6521116">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6521196">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6521215">type</span>&nbsp;<span class="ident" id="6521220">serverTest</span>&nbsp;<span class="keyword" id="6521231">struct</span>&nbsp;<span class="op" id="6521238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521241">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521314">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6521355">name</span>&nbsp;<span class="builtintype" id="6521360">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521368">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521434">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6521479">command</span>&nbsp;<span class="op" id="6521487">[</span><span class="op" id="6521488">]</span><span class="builtintype" id="6521489">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521497">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521561">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6521595">expectedPeerCerts</span>&nbsp;<span class="op" id="6521613">[</span><span class="op" id="6521614">]</span><span class="builtintype" id="6521615">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521623">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6521694">config</span>&nbsp;<span class="op" id="6521701">*</span><span class="ident" id="6521702">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521710">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521784">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6521822">expectAlert</span>&nbsp;<span class="builtintype" id="6521834">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521840">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6521909">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6521981">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="6522011">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6522019">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6522088">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6522161">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522198">validate</span>&nbsp;<span class="keyword" id="6522207">func</span><span class="op" id="6522211">(</span><span class="ident" id="6522212">ConnectionState</span><span class="op" id="6522227">)</span>&nbsp;<span class="builtintype" id="6522229">error</span><br>
<span class="lineno">270</span><span class="op" id="6522235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6522238">var</span>&nbsp;<span class="ident" id="6522242">defaultClientCommand</span>&nbsp;<span class="op" id="6522263">=</span>&nbsp;<span class="op" id="6522265">[</span><span class="op" id="6522266">]</span><span class="builtintype" id="6522267">string</span><span class="op" id="6522273">{</span><span class="string" id="6522274">&#34;openssl&#34;</span><span class="op" id="6522283">,</span>&nbsp;<span class="string" id="6522285">&#34;s_client&#34;</span><span class="op" id="6522295">,</span>&nbsp;<span class="string" id="6522297">&#34;-no_ticket&#34;</span><span class="op" id="6522309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6522312">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="6522388">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="6522468">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6522483">func</span>&nbsp;<span class="op" id="6522488">(</span><span class="ident" id="6522489">test</span>&nbsp;<span class="op" id="6522494">*</span><span class="ident" id="6522495">serverTest</span><span class="op" id="6522505">)</span>&nbsp;<span class="ident" id="6522507">connFromCommand</span><span class="op" id="6522522">(</span><span class="op" id="6522523">)</span>&nbsp;<span class="op" id="6522525">(</span><span class="ident" id="6522526">conn</span>&nbsp;<span class="op" id="6522531">*</span><span class="ident" id="6522532">recordingConn</span><span class="op" id="6522545">,</span>&nbsp;<span class="ident" id="6522547">child</span>&nbsp;<span class="op" id="6522553">*</span><span class="ident" id="6522554">exec</span><span class="op" id="6522558">.</span><span class="ident" id="6522559">Cmd</span><span class="op" id="6522562">,</span>&nbsp;<span class="ident" id="6522564">err</span>&nbsp;<span class="builtintype" id="6522568">error</span><span class="op" id="6522573">)</span>&nbsp;<span class="op" id="6522575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522578">l</span><span class="op" id="6522579">,</span>&nbsp;<span class="ident" id="6522581">err</span>&nbsp;<span class="op" id="6522585">:=</span>&nbsp;<span class="ident" id="6522588">net</span><span class="op" id="6522591">.</span><span class="ident" id="6522592">ListenTCP</span><span class="op" id="6522601">(</span><span class="string" id="6522602">&#34;tcp&#34;</span><span class="op" id="6522607">,</span>&nbsp;<span class="op" id="6522609">&amp;</span><span class="ident" id="6522610">net</span><span class="op" id="6522613">.</span><span class="ident" id="6522614">TCPAddr</span><span class="op" id="6522621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522625">IP</span><span class="op" id="6522627">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6522631">net</span><span class="op" id="6522634">.</span><span class="ident" id="6522635">IPv4</span><span class="op" id="6522639">(</span><span class="num" id="6522640">127</span><span class="op" id="6522643">,</span>&nbsp;<span class="num" id="6522645">0</span><span class="op" id="6522646">,</span>&nbsp;<span class="num" id="6522648">0</span><span class="op" id="6522649">,</span>&nbsp;<span class="num" id="6522651">1</span><span class="op" id="6522652">)</span><span class="op" id="6522653">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522657">Port</span><span class="op" id="6522661">:</span>&nbsp;<span class="num" id="6522663">0</span><span class="op" id="6522664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6522667">}</span><span class="op" id="6522668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6522671">if</span>&nbsp;<span class="ident" id="6522674">err</span>&nbsp;<span class="op" id="6522678">!=</span>&nbsp;<span class="ident" id="6522681">nil</span>&nbsp;<span class="op" id="6522685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6522689">return</span>&nbsp;<span class="ident" id="6522696">nil</span><span class="op" id="6522699">,</span>&nbsp;<span class="ident" id="6522701">nil</span><span class="op" id="6522704">,</span>&nbsp;<span class="ident" id="6522706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6522711">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6522714">defer</span>&nbsp;<span class="ident" id="6522720">l</span><span class="op" id="6522721">.</span><span class="ident" id="6522722">Close</span><span class="op" id="6522727">(</span><span class="op" id="6522728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522732">port</span>&nbsp;<span class="op" id="6522737">:=</span>&nbsp;<span class="ident" id="6522740">l</span><span class="op" id="6522741">.</span><span class="ident" id="6522742">Addr</span><span class="op" id="6522746">(</span><span class="op" id="6522747">)</span><span class="op" id="6522748">.</span><span class="op" id="6522749">(</span><span class="op" id="6522750">*</span><span class="ident" id="6522751">net</span><span class="op" id="6522754">.</span><span class="ident" id="6522755">TCPAddr</span><span class="op" id="6522762">)</span><span class="op" id="6522763">.</span><span class="ident" id="6522764">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6522771">var</span>&nbsp;<span class="ident" id="6522775">command</span>&nbsp;<span class="op" id="6522783">[</span><span class="op" id="6522784">]</span><span class="builtintype" id="6522785">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522793">command</span>&nbsp;<span class="op" id="6522801">=</span>&nbsp;<span class="builtinfunc" id="6522803">append</span><span class="op" id="6522809">(</span><span class="ident" id="6522810">command</span><span class="op" id="6522817">,</span>&nbsp;<span class="ident" id="6522819">test</span><span class="op" id="6522823">.</span><span class="ident" id="6522824">command</span><span class="op" id="6522831">...</span><span class="op" id="6522834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6522837">if</span>&nbsp;<span class="builtinfunc" id="6522840">len</span><span class="op" id="6522843">(</span><span class="ident" id="6522844">command</span><span class="op" id="6522851">)</span>&nbsp;<span class="op" id="6522853">==</span>&nbsp;<span class="num" id="6522856">0</span>&nbsp;<span class="op" id="6522858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522862">command</span>&nbsp;<span class="op" id="6522870">=</span>&nbsp;<span class="ident" id="6522872">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6522894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522897">command</span>&nbsp;<span class="op" id="6522905">=</span>&nbsp;<span class="builtinfunc" id="6522907">append</span><span class="op" id="6522913">(</span><span class="ident" id="6522914">command</span><span class="op" id="6522921">,</span>&nbsp;<span class="string" id="6522923">&#34;-connect&#34;</span><span class="op" id="6522933">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522936">command</span>&nbsp;<span class="op" id="6522944">=</span>&nbsp;<span class="builtinfunc" id="6522946">append</span><span class="op" id="6522952">(</span><span class="ident" id="6522953">command</span><span class="op" id="6522960">,</span>&nbsp;<span class="ident" id="6522962">fmt</span><span class="op" id="6522965">.</span><span class="ident" id="6522966">Sprintf</span><span class="op" id="6522973">(</span><span class="string" id="6522974">&#34;127.0.0.1:%d&#34;</span><span class="op" id="6522988">,</span>&nbsp;<span class="ident" id="6522990">port</span><span class="op" id="6522994">)</span><span class="op" id="6522995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6522998">cmd</span>&nbsp;<span class="op" id="6523002">:=</span>&nbsp;<span class="ident" id="6523005">exec</span><span class="op" id="6523009">.</span><span class="ident" id="6523010">Command</span><span class="op" id="6523017">(</span><span class="ident" id="6523018">command</span><span class="op" id="6523025">[</span><span class="num" id="6523026">0</span><span class="op" id="6523027">]</span><span class="op" id="6523028">,</span>&nbsp;<span class="ident" id="6523030">command</span><span class="op" id="6523037">[</span><span class="num" id="6523038">1</span><span class="op" id="6523039">:</span><span class="op" id="6523040">]</span><span class="op" id="6523041">...</span><span class="op" id="6523044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523047">cmd</span><span class="op" id="6523050">.</span><span class="ident" id="6523051">Stdin</span>&nbsp;<span class="op" id="6523057">=</span>&nbsp;<span class="ident" id="6523059">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523064">var</span>&nbsp;<span class="ident" id="6523068">output</span>&nbsp;<span class="ident" id="6523075">bytes</span><span class="op" id="6523080">.</span><span class="ident" id="6523081">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523089">cmd</span><span class="op" id="6523092">.</span><span class="ident" id="6523093">Stdout</span>&nbsp;<span class="op" id="6523100">=</span>&nbsp;<span class="op" id="6523102">&amp;</span><span class="ident" id="6523103">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523111">cmd</span><span class="op" id="6523114">.</span><span class="ident" id="6523115">Stderr</span>&nbsp;<span class="op" id="6523122">=</span>&nbsp;<span class="op" id="6523124">&amp;</span><span class="ident" id="6523125">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523133">if</span>&nbsp;<span class="ident" id="6523136">err</span>&nbsp;<span class="op" id="6523140">:=</span>&nbsp;<span class="ident" id="6523143">cmd</span><span class="op" id="6523146">.</span><span class="ident" id="6523147">Start</span><span class="op" id="6523152">(</span><span class="op" id="6523153">)</span><span class="op" id="6523154">;</span>&nbsp;<span class="ident" id="6523156">err</span>&nbsp;<span class="op" id="6523160">!=</span>&nbsp;<span class="ident" id="6523163">nil</span>&nbsp;<span class="op" id="6523167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523171">return</span>&nbsp;<span class="ident" id="6523178">nil</span><span class="op" id="6523181">,</span>&nbsp;<span class="ident" id="6523183">nil</span><span class="op" id="6523186">,</span>&nbsp;<span class="ident" id="6523188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523197">connChan</span>&nbsp;<span class="op" id="6523206">:=</span>&nbsp;<span class="builtinfunc" id="6523209">make</span><span class="op" id="6523213">(</span><span class="keyword" id="6523214">chan</span>&nbsp;<span class="keyword" id="6523219">interface</span><span class="op" id="6523228">{</span><span class="op" id="6523229">}</span><span class="op" id="6523230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523233">go</span>&nbsp;<span class="keyword" id="6523236">func</span><span class="op" id="6523240">(</span><span class="op" id="6523241">)</span>&nbsp;<span class="op" id="6523243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523247">tcpConn</span><span class="op" id="6523254">,</span>&nbsp;<span class="ident" id="6523256">err</span>&nbsp;<span class="op" id="6523260">:=</span>&nbsp;<span class="ident" id="6523263">l</span><span class="op" id="6523264">.</span><span class="ident" id="6523265">Accept</span><span class="op" id="6523271">(</span><span class="op" id="6523272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523276">if</span>&nbsp;<span class="ident" id="6523279">err</span>&nbsp;<span class="op" id="6523283">!=</span>&nbsp;<span class="ident" id="6523286">nil</span>&nbsp;<span class="op" id="6523290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523295">connChan</span>&nbsp;<span class="op" id="6523304">&lt;-</span>&nbsp;<span class="ident" id="6523307">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523317">connChan</span>&nbsp;<span class="op" id="6523326">&lt;-</span>&nbsp;<span class="ident" id="6523329">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523338">}</span><span class="op" id="6523339">(</span><span class="op" id="6523340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523344">var</span>&nbsp;<span class="ident" id="6523348">tcpConn</span>&nbsp;<span class="ident" id="6523356">net</span><span class="op" id="6523359">.</span><span class="ident" id="6523360">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523366">select</span>&nbsp;<span class="op" id="6523373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523376">case</span>&nbsp;<span class="ident" id="6523381">connOrError</span>&nbsp;<span class="op" id="6523393">:=</span>&nbsp;<span class="op" id="6523396">&lt;-</span><span class="ident" id="6523398">connChan</span><span class="op" id="6523406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523410">if</span>&nbsp;<span class="ident" id="6523413">err</span><span class="op" id="6523416">,</span>&nbsp;<span class="ident" id="6523418">ok</span>&nbsp;<span class="op" id="6523421">:=</span>&nbsp;<span class="ident" id="6523424">connOrError</span><span class="op" id="6523435">.</span><span class="op" id="6523436">(</span><span class="builtintype" id="6523437">error</span><span class="op" id="6523442">)</span><span class="op" id="6523443">;</span>&nbsp;<span class="ident" id="6523445">ok</span>&nbsp;<span class="op" id="6523448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523453">return</span>&nbsp;<span class="ident" id="6523460">nil</span><span class="op" id="6523463">,</span>&nbsp;<span class="ident" id="6523465">nil</span><span class="op" id="6523468">,</span>&nbsp;<span class="ident" id="6523470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523476">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523480">tcpConn</span>&nbsp;<span class="op" id="6523488">=</span>&nbsp;<span class="ident" id="6523490">connOrError</span><span class="op" id="6523501">.</span><span class="op" id="6523502">(</span><span class="ident" id="6523503">net</span><span class="op" id="6523506">.</span><span class="ident" id="6523507">Conn</span><span class="op" id="6523511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523514">case</span>&nbsp;<span class="op" id="6523519">&lt;-</span><span class="ident" id="6523521">time</span><span class="op" id="6523525">.</span><span class="ident" id="6523526">After</span><span class="op" id="6523531">(</span><span class="num" id="6523532">2</span>&nbsp;<span class="op" id="6523534">*</span>&nbsp;<span class="ident" id="6523536">time</span><span class="op" id="6523540">.</span><span class="ident" id="6523541">Second</span><span class="op" id="6523547">)</span><span class="op" id="6523548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523552">output</span><span class="op" id="6523558">.</span><span class="ident" id="6523559">WriteTo</span><span class="op" id="6523566">(</span><span class="ident" id="6523567">os</span><span class="op" id="6523569">.</span><span class="ident" id="6523570">Stdout</span><span class="op" id="6523576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523580">return</span>&nbsp;<span class="ident" id="6523587">nil</span><span class="op" id="6523590">,</span>&nbsp;<span class="ident" id="6523592">nil</span><span class="op" id="6523595">,</span>&nbsp;<span class="ident" id="6523597">errors</span><span class="op" id="6523603">.</span><span class="ident" id="6523604">New</span><span class="op" id="6523607">(</span><span class="string" id="6523608">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="6523661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523664">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523668">record</span>&nbsp;<span class="op" id="6523675">:=</span>&nbsp;<span class="op" id="6523678">&amp;</span><span class="ident" id="6523679">recordingConn</span><span class="op" id="6523692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523696">Conn</span><span class="op" id="6523700">:</span>&nbsp;<span class="ident" id="6523702">tcpConn</span><span class="op" id="6523709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523716">return</span>&nbsp;<span class="ident" id="6523723">record</span><span class="op" id="6523729">,</span>&nbsp;<span class="ident" id="6523731">cmd</span><span class="op" id="6523734">,</span>&nbsp;<span class="ident" id="6523736">nil</span><br>
<span class="lineno"></span><span class="op" id="6523740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6523743">func</span>&nbsp;<span class="op" id="6523748">(</span><span class="ident" id="6523749">test</span>&nbsp;<span class="op" id="6523754">*</span><span class="ident" id="6523755">serverTest</span><span class="op" id="6523765">)</span>&nbsp;<span class="ident" id="6523767">dataPath</span><span class="op" id="6523775">(</span><span class="op" id="6523776">)</span>&nbsp;<span class="builtintype" id="6523778">string</span>&nbsp;<span class="op" id="6523785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523788">return</span>&nbsp;<span class="ident" id="6523795">filepath</span><span class="op" id="6523803">.</span><span class="ident" id="6523804">Join</span><span class="op" id="6523808">(</span><span class="string" id="6523809">&#34;testdata&#34;</span><span class="op" id="6523819">,</span>&nbsp;<span class="string" id="6523821">&#34;Server-&#34;</span><span class="op" id="6523830">+</span><span class="ident" id="6523831">test</span><span class="op" id="6523835">.</span><span class="ident" id="6523836">name</span><span class="op" id="6523840">)</span><br>
<span class="lineno">335</span><span class="op" id="6523842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6523845">func</span>&nbsp;<span class="op" id="6523850">(</span><span class="ident" id="6523851">test</span>&nbsp;<span class="op" id="6523856">*</span><span class="ident" id="6523857">serverTest</span><span class="op" id="6523867">)</span>&nbsp;<span class="ident" id="6523869">loadData</span><span class="op" id="6523877">(</span><span class="op" id="6523878">)</span>&nbsp;<span class="op" id="6523880">(</span><span class="ident" id="6523881">flows</span>&nbsp;<span class="op" id="6523887">[</span><span class="op" id="6523888">]</span><span class="op" id="6523889">[</span><span class="op" id="6523890">]</span><span class="builtintype" id="6523891">byte</span><span class="op" id="6523895">,</span>&nbsp;<span class="ident" id="6523897">err</span>&nbsp;<span class="builtintype" id="6523901">error</span><span class="op" id="6523906">)</span>&nbsp;<span class="op" id="6523908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6523911">in</span><span class="op" id="6523913">,</span>&nbsp;<span class="ident" id="6523915">err</span>&nbsp;<span class="op" id="6523919">:=</span>&nbsp;<span class="ident" id="6523922">os</span><span class="op" id="6523924">.</span><span class="ident" id="6523925">Open</span><span class="op" id="6523929">(</span><span class="ident" id="6523930">test</span><span class="op" id="6523934">.</span><span class="ident" id="6523935">dataPath</span><span class="op" id="6523943">(</span><span class="op" id="6523944">)</span><span class="op" id="6523945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523948">if</span>&nbsp;<span class="ident" id="6523951">err</span>&nbsp;<span class="op" id="6523955">!=</span>&nbsp;<span class="ident" id="6523958">nil</span>&nbsp;<span class="op" id="6523962">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523966">return</span>&nbsp;<span class="ident" id="6523973">nil</span><span class="op" id="6523976">,</span>&nbsp;<span class="ident" id="6523978">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6523983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6523986">defer</span>&nbsp;<span class="ident" id="6523992">in</span><span class="op" id="6523994">.</span><span class="ident" id="6523995">Close</span><span class="op" id="6524000">(</span><span class="op" id="6524001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524004">return</span>&nbsp;<span class="ident" id="6524011">parseTestData</span><span class="op" id="6524024">(</span><span class="ident" id="6524025">in</span><span class="op" id="6524027">)</span><br>
<span class="lineno"></span><span class="op" id="6524029">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6524032">func</span>&nbsp;<span class="op" id="6524037">(</span><span class="ident" id="6524038">test</span>&nbsp;<span class="op" id="6524043">*</span><span class="ident" id="6524044">serverTest</span><span class="op" id="6524054">)</span>&nbsp;<span class="ident" id="6524056">run</span><span class="op" id="6524059">(</span><span class="ident" id="6524060">t</span>&nbsp;<span class="op" id="6524062">*</span><span class="ident" id="6524063">testing</span><span class="op" id="6524070">.</span><span class="ident" id="6524071">T</span><span class="op" id="6524072">,</span>&nbsp;<span class="ident" id="6524074">write</span>&nbsp;<span class="builtintype" id="6524080">bool</span><span class="op" id="6524084">)</span>&nbsp;<span class="op" id="6524086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524089">var</span>&nbsp;<span class="ident" id="6524093">clientConn</span><span class="op" id="6524103">,</span>&nbsp;<span class="ident" id="6524105">serverConn</span>&nbsp;<span class="ident" id="6524116">net</span><span class="op" id="6524119">.</span><span class="ident" id="6524120">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524126">var</span>&nbsp;<span class="ident" id="6524130">recordingConn</span>&nbsp;<span class="op" id="6524144">*</span><span class="ident" id="6524145">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524160">var</span>&nbsp;<span class="ident" id="6524164">childProcess</span>&nbsp;<span class="op" id="6524177">*</span><span class="ident" id="6524178">exec</span><span class="op" id="6524182">.</span><span class="ident" id="6524183">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524189">if</span>&nbsp;<span class="ident" id="6524192">write</span>&nbsp;<span class="op" id="6524198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524202">var</span>&nbsp;<span class="ident" id="6524206">err</span>&nbsp;<span class="builtintype" id="6524210">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524218">recordingConn</span><span class="op" id="6524231">,</span>&nbsp;<span class="ident" id="6524233">childProcess</span><span class="op" id="6524245">,</span>&nbsp;<span class="ident" id="6524247">err</span>&nbsp;<span class="op" id="6524251">=</span>&nbsp;<span class="ident" id="6524253">test</span><span class="op" id="6524257">.</span><span class="ident" id="6524258">connFromCommand</span><span class="op" id="6524273">(</span><span class="op" id="6524274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524278">if</span>&nbsp;<span class="ident" id="6524281">err</span>&nbsp;<span class="op" id="6524285">!=</span>&nbsp;<span class="ident" id="6524288">nil</span>&nbsp;<span class="op" id="6524292">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524297">t</span><span class="op" id="6524298">.</span><span class="ident" id="6524299">Fatalf</span><span class="op" id="6524305">(</span><span class="string" id="6524306">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="6524338">,</span>&nbsp;<span class="ident" id="6524340">err</span><span class="op" id="6524343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6524347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524351">serverConn</span>&nbsp;<span class="op" id="6524362">=</span>&nbsp;<span class="ident" id="6524364">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6524379">}</span>&nbsp;<span class="keyword" id="6524381">else</span>&nbsp;<span class="op" id="6524386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524390">clientConn</span><span class="op" id="6524400">,</span>&nbsp;<span class="ident" id="6524402">serverConn</span>&nbsp;<span class="op" id="6524413">=</span>&nbsp;<span class="ident" id="6524415">net</span><span class="op" id="6524418">.</span><span class="ident" id="6524419">Pipe</span><span class="op" id="6524423">(</span><span class="op" id="6524424">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6524427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524430">config</span>&nbsp;<span class="op" id="6524437">:=</span>&nbsp;<span class="ident" id="6524440">test</span><span class="op" id="6524444">.</span><span class="ident" id="6524445">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524453">if</span>&nbsp;<span class="ident" id="6524456">config</span>&nbsp;<span class="op" id="6524463">==</span>&nbsp;<span class="ident" id="6524466">nil</span>&nbsp;<span class="op" id="6524470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524474">config</span>&nbsp;<span class="op" id="6524481">=</span>&nbsp;<span class="ident" id="6524483">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6524495">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524498">server</span>&nbsp;<span class="op" id="6524505">:=</span>&nbsp;<span class="ident" id="6524508">Server</span><span class="op" id="6524514">(</span><span class="ident" id="6524515">serverConn</span><span class="op" id="6524525">,</span>&nbsp;<span class="ident" id="6524527">config</span><span class="op" id="6524533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524536">connStateChan</span>&nbsp;<span class="op" id="6524550">:=</span>&nbsp;<span class="builtinfunc" id="6524553">make</span><span class="op" id="6524557">(</span><span class="keyword" id="6524558">chan</span>&nbsp;<span class="ident" id="6524563">ConnectionState</span><span class="op" id="6524578">,</span>&nbsp;<span class="num" id="6524580">1</span><span class="op" id="6524581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524584">go</span>&nbsp;<span class="keyword" id="6524587">func</span><span class="op" id="6524591">(</span><span class="op" id="6524592">)</span>&nbsp;<span class="op" id="6524594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524598">var</span>&nbsp;<span class="ident" id="6524602">err</span>&nbsp;<span class="builtintype" id="6524606">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524614">if</span>&nbsp;<span class="ident" id="6524617">_</span><span class="op" id="6524618">,</span>&nbsp;<span class="ident" id="6524620">err</span>&nbsp;<span class="op" id="6524624">=</span>&nbsp;<span class="ident" id="6524626">server</span><span class="op" id="6524632">.</span><span class="ident" id="6524633">Write</span><span class="op" id="6524638">(</span><span class="op" id="6524639">[</span><span class="op" id="6524640">]</span><span class="builtintype" id="6524641">byte</span><span class="op" id="6524645">(</span><span class="string" id="6524646">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="6524662">)</span><span class="op" id="6524663">)</span><span class="op" id="6524664">;</span>&nbsp;<span class="ident" id="6524666">err</span>&nbsp;<span class="op" id="6524670">!=</span>&nbsp;<span class="ident" id="6524673">nil</span>&nbsp;<span class="op" id="6524677">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524682">t</span><span class="op" id="6524683">.</span><span class="ident" id="6524684">Logf</span><span class="op" id="6524688">(</span><span class="string" id="6524689">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="6524718">,</span>&nbsp;<span class="ident" id="6524720">err</span><span class="op" id="6524723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6524727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524731">if</span>&nbsp;<span class="builtinfunc" id="6524734">len</span><span class="op" id="6524737">(</span><span class="ident" id="6524738">test</span><span class="op" id="6524742">.</span><span class="ident" id="6524743">expectHandshakeErrorIncluding</span><span class="op" id="6524772">)</span>&nbsp;<span class="op" id="6524774">&gt;</span>&nbsp;<span class="num" id="6524776">0</span>&nbsp;<span class="op" id="6524778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6524783">if</span>&nbsp;<span class="ident" id="6524786">err</span>&nbsp;<span class="op" id="6524790">==</span>&nbsp;<span class="ident" id="6524793">nil</span>&nbsp;<span class="op" id="6524797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524803">t</span><span class="op" id="6524804">.</span><span class="ident" id="6524805">Errorf</span><span class="op" id="6524811">(</span><span class="string" id="6524812">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="6524851">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6524856">}</span>&nbsp;<span class="keyword" id="6524858">else</span>&nbsp;<span class="keyword" id="6524863">if</span>&nbsp;<span class="ident" id="6524866">s</span>&nbsp;<span class="op" id="6524868">:=</span>&nbsp;<span class="ident" id="6524871">err</span><span class="op" id="6524874">.</span><span class="ident" id="6524875">Error</span><span class="op" id="6524880">(</span><span class="op" id="6524881">)</span><span class="op" id="6524882">;</span>&nbsp;<span class="op" id="6524884">!</span><span class="ident" id="6524885">strings</span><span class="op" id="6524892">.</span><span class="ident" id="6524893">Contains</span><span class="op" id="6524901">(</span><span class="ident" id="6524902">s</span><span class="op" id="6524903">,</span>&nbsp;<span class="ident" id="6524905">test</span><span class="op" id="6524909">.</span><span class="ident" id="6524910">expectHandshakeErrorIncluding</span><span class="op" id="6524939">)</span>&nbsp;<span class="op" id="6524941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6524947">t</span><span class="op" id="6524948">.</span><span class="ident" id="6524949">Errorf</span><span class="op" id="6524955">(</span><span class="string" id="6524956">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="6525001">,</span>&nbsp;<span class="ident" id="6525003">test</span><span class="op" id="6525007">.</span><span class="ident" id="6525008">expectHandshakeErrorIncluding</span><span class="op" id="6525037">,</span>&nbsp;<span class="ident" id="6525039">s</span><span class="op" id="6525040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525053">server</span><span class="op" id="6525059">.</span><span class="ident" id="6525060">Close</span><span class="op" id="6525065">(</span><span class="op" id="6525066">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525070">serverConn</span><span class="op" id="6525080">.</span><span class="ident" id="6525081">Close</span><span class="op" id="6525086">(</span><span class="op" id="6525087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525091">connStateChan</span>&nbsp;<span class="op" id="6525105">&lt;-</span>&nbsp;<span class="ident" id="6525108">server</span><span class="op" id="6525114">.</span><span class="ident" id="6525115">ConnectionState</span><span class="op" id="6525130">(</span><span class="op" id="6525131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525134">}</span><span class="op" id="6525135">(</span><span class="op" id="6525136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525140">if</span>&nbsp;<span class="op" id="6525143">!</span><span class="ident" id="6525144">write</span>&nbsp;<span class="op" id="6525150">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525154">flows</span><span class="op" id="6525159">,</span>&nbsp;<span class="ident" id="6525161">err</span>&nbsp;<span class="op" id="6525165">:=</span>&nbsp;<span class="ident" id="6525168">test</span><span class="op" id="6525172">.</span><span class="ident" id="6525173">loadData</span><span class="op" id="6525181">(</span><span class="op" id="6525182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525186">if</span>&nbsp;<span class="ident" id="6525189">err</span>&nbsp;<span class="op" id="6525193">!=</span>&nbsp;<span class="ident" id="6525196">nil</span>&nbsp;<span class="op" id="6525200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525205">if</span>&nbsp;<span class="op" id="6525208">!</span><span class="ident" id="6525209">test</span><span class="op" id="6525213">.</span><span class="ident" id="6525214">expectAlert</span>&nbsp;<span class="op" id="6525226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525232">t</span><span class="op" id="6525233">.</span><span class="ident" id="6525234">Fatalf</span><span class="op" id="6525240">(</span><span class="string" id="6525241">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="6525274">,</span>&nbsp;<span class="ident" id="6525276">test</span><span class="op" id="6525280">.</span><span class="ident" id="6525281">name</span><span class="op" id="6525285">,</span>&nbsp;<span class="ident" id="6525287">test</span><span class="op" id="6525291">.</span><span class="ident" id="6525292">dataPath</span><span class="op" id="6525300">(</span><span class="op" id="6525301">)</span><span class="op" id="6525302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525307">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525315">for</span>&nbsp;<span class="ident" id="6525319">i</span><span class="op" id="6525320">,</span>&nbsp;<span class="ident" id="6525322">b</span>&nbsp;<span class="op" id="6525324">:=</span>&nbsp;<span class="keyword" id="6525327">range</span>&nbsp;<span class="ident" id="6525333">flows</span>&nbsp;<span class="op" id="6525339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525344">if</span>&nbsp;<span class="ident" id="6525347">i</span><span class="op" id="6525348">%</span><span class="num" id="6525349">2</span>&nbsp;<span class="op" id="6525351">==</span>&nbsp;<span class="num" id="6525354">0</span>&nbsp;<span class="op" id="6525356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525362">clientConn</span><span class="op" id="6525372">.</span><span class="ident" id="6525373">Write</span><span class="op" id="6525378">(</span><span class="ident" id="6525379">b</span><span class="op" id="6525380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525386">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525403">bb</span>&nbsp;<span class="op" id="6525406">:=</span>&nbsp;<span class="builtinfunc" id="6525409">make</span><span class="op" id="6525413">(</span><span class="op" id="6525414">[</span><span class="op" id="6525415">]</span><span class="builtintype" id="6525416">byte</span><span class="op" id="6525420">,</span>&nbsp;<span class="builtinfunc" id="6525422">len</span><span class="op" id="6525425">(</span><span class="ident" id="6525426">b</span><span class="op" id="6525427">)</span><span class="op" id="6525428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525433">n</span><span class="op" id="6525434">,</span>&nbsp;<span class="ident" id="6525436">err</span>&nbsp;<span class="op" id="6525440">:=</span>&nbsp;<span class="ident" id="6525443">io</span><span class="op" id="6525445">.</span><span class="ident" id="6525446">ReadFull</span><span class="op" id="6525454">(</span><span class="ident" id="6525455">clientConn</span><span class="op" id="6525465">,</span>&nbsp;<span class="ident" id="6525467">bb</span><span class="op" id="6525469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525474">if</span>&nbsp;<span class="ident" id="6525477">test</span><span class="op" id="6525481">.</span><span class="ident" id="6525482">expectAlert</span>&nbsp;<span class="op" id="6525494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525500">if</span>&nbsp;<span class="ident" id="6525503">err</span>&nbsp;<span class="op" id="6525507">==</span>&nbsp;<span class="ident" id="6525510">nil</span>&nbsp;<span class="op" id="6525514">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525521">t</span><span class="op" id="6525522">.</span><span class="ident" id="6525523">Fatal</span><span class="op" id="6525528">(</span><span class="string" id="6525529">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="6525571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525582">}</span>&nbsp;<span class="keyword" id="6525584">else</span>&nbsp;<span class="op" id="6525589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525595">if</span>&nbsp;<span class="ident" id="6525598">err</span>&nbsp;<span class="op" id="6525602">!=</span>&nbsp;<span class="ident" id="6525605">nil</span>&nbsp;<span class="op" id="6525609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525616">t</span><span class="op" id="6525617">.</span><span class="ident" id="6525618">Fatalf</span><span class="op" id="6525624">(</span><span class="string" id="6525625">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="6525678">,</span>&nbsp;<span class="ident" id="6525680">test</span><span class="op" id="6525684">.</span><span class="ident" id="6525685">name</span><span class="op" id="6525689">,</span>&nbsp;<span class="ident" id="6525691">i</span><span class="op" id="6525692">+</span><span class="num" id="6525693">1</span><span class="op" id="6525694">,</span>&nbsp;<span class="ident" id="6525696">err</span><span class="op" id="6525699">,</span>&nbsp;<span class="ident" id="6525701">n</span><span class="op" id="6525702">,</span>&nbsp;<span class="builtinfunc" id="6525704">len</span><span class="op" id="6525707">(</span><span class="ident" id="6525708">bb</span><span class="op" id="6525710">)</span><span class="op" id="6525711">,</span>&nbsp;<span class="ident" id="6525713">bb</span><span class="op" id="6525715">[</span><span class="op" id="6525716">:</span><span class="ident" id="6525717">n</span><span class="op" id="6525718">]</span><span class="op" id="6525719">,</span>&nbsp;<span class="ident" id="6525721">b</span><span class="op" id="6525722">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525734">if</span>&nbsp;<span class="op" id="6525737">!</span><span class="ident" id="6525738">bytes</span><span class="op" id="6525743">.</span><span class="ident" id="6525744">Equal</span><span class="op" id="6525749">(</span><span class="ident" id="6525750">b</span><span class="op" id="6525751">,</span>&nbsp;<span class="ident" id="6525753">bb</span><span class="op" id="6525755">)</span>&nbsp;<span class="op" id="6525757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525764">t</span><span class="op" id="6525765">.</span><span class="ident" id="6525766">Fatalf</span><span class="op" id="6525772">(</span><span class="string" id="6525773">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="6525815">,</span>&nbsp;<span class="ident" id="6525817">test</span><span class="op" id="6525821">.</span><span class="ident" id="6525822">name</span><span class="op" id="6525826">,</span>&nbsp;<span class="ident" id="6525828">i</span><span class="op" id="6525829">+</span><span class="num" id="6525830">1</span><span class="op" id="6525831">,</span>&nbsp;<span class="ident" id="6525833">bb</span><span class="op" id="6525835">,</span>&nbsp;<span class="ident" id="6525837">b</span><span class="op" id="6525838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525849">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525857">clientConn</span><span class="op" id="6525867">.</span><span class="ident" id="6525868">Close</span><span class="op" id="6525873">(</span><span class="op" id="6525874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6525877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525881">connState</span>&nbsp;<span class="op" id="6525891">:=</span>&nbsp;<span class="op" id="6525894">&lt;-</span><span class="ident" id="6525896">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6525911">peerCerts</span>&nbsp;<span class="op" id="6525921">:=</span>&nbsp;<span class="ident" id="6525924">connState</span><span class="op" id="6525933">.</span><span class="ident" id="6525934">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6525952">if</span>&nbsp;<span class="builtinfunc" id="6525955">len</span><span class="op" id="6525958">(</span><span class="ident" id="6525959">peerCerts</span><span class="op" id="6525968">)</span>&nbsp;<span class="op" id="6525970">==</span>&nbsp;<span class="builtinfunc" id="6525973">len</span><span class="op" id="6525976">(</span><span class="ident" id="6525977">test</span><span class="op" id="6525981">.</span><span class="ident" id="6525982">expectedPeerCerts</span><span class="op" id="6525999">)</span>&nbsp;<span class="op" id="6526001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526005">for</span>&nbsp;<span class="ident" id="6526009">i</span><span class="op" id="6526010">,</span>&nbsp;<span class="ident" id="6526012">peerCert</span>&nbsp;<span class="op" id="6526021">:=</span>&nbsp;<span class="keyword" id="6526024">range</span>&nbsp;<span class="ident" id="6526030">peerCerts</span>&nbsp;<span class="op" id="6526040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526045">block</span><span class="op" id="6526050">,</span>&nbsp;<span class="ident" id="6526052">_</span>&nbsp;<span class="op" id="6526054">:=</span>&nbsp;<span class="ident" id="6526057">pem</span><span class="op" id="6526060">.</span><span class="ident" id="6526061">Decode</span><span class="op" id="6526067">(</span><span class="op" id="6526068">[</span><span class="op" id="6526069">]</span><span class="builtintype" id="6526070">byte</span><span class="op" id="6526074">(</span><span class="ident" id="6526075">test</span><span class="op" id="6526079">.</span><span class="ident" id="6526080">expectedPeerCerts</span><span class="op" id="6526097">[</span><span class="ident" id="6526098">i</span><span class="op" id="6526099">]</span><span class="op" id="6526100">)</span><span class="op" id="6526101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526106">if</span>&nbsp;<span class="op" id="6526109">!</span><span class="ident" id="6526110">bytes</span><span class="op" id="6526115">.</span><span class="ident" id="6526116">Equal</span><span class="op" id="6526121">(</span><span class="ident" id="6526122">block</span><span class="op" id="6526127">.</span><span class="ident" id="6526128">Bytes</span><span class="op" id="6526133">,</span>&nbsp;<span class="ident" id="6526135">peerCert</span><span class="op" id="6526143">.</span><span class="ident" id="6526144">Raw</span><span class="op" id="6526147">)</span>&nbsp;<span class="op" id="6526149">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526155">t</span><span class="op" id="6526156">.</span><span class="ident" id="6526157">Fatalf</span><span class="op" id="6526163">(</span><span class="string" id="6526164">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="6526194">,</span>&nbsp;<span class="ident" id="6526196">test</span><span class="op" id="6526200">.</span><span class="ident" id="6526201">name</span><span class="op" id="6526205">,</span>&nbsp;<span class="ident" id="6526207">i</span><span class="op" id="6526208">+</span><span class="num" id="6526209">1</span><span class="op" id="6526210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526222">}</span>&nbsp;<span class="keyword" id="6526224">else</span>&nbsp;<span class="op" id="6526229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526233">t</span><span class="op" id="6526234">.</span><span class="ident" id="6526235">Fatalf</span><span class="op" id="6526241">(</span><span class="string" id="6526242">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="6526301">,</span>&nbsp;<span class="ident" id="6526303">test</span><span class="op" id="6526307">.</span><span class="ident" id="6526308">name</span><span class="op" id="6526312">,</span>&nbsp;<span class="builtinfunc" id="6526314">len</span><span class="op" id="6526317">(</span><span class="ident" id="6526318">test</span><span class="op" id="6526322">.</span><span class="ident" id="6526323">expectedPeerCerts</span><span class="op" id="6526340">)</span><span class="op" id="6526341">,</span>&nbsp;<span class="builtinfunc" id="6526343">len</span><span class="op" id="6526346">(</span><span class="ident" id="6526347">peerCerts</span><span class="op" id="6526356">)</span><span class="op" id="6526357">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526364">if</span>&nbsp;<span class="ident" id="6526367">test</span><span class="op" id="6526371">.</span><span class="ident" id="6526372">validate</span>&nbsp;<span class="op" id="6526381">!=</span>&nbsp;<span class="ident" id="6526384">nil</span>&nbsp;<span class="op" id="6526388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526392">if</span>&nbsp;<span class="ident" id="6526395">err</span>&nbsp;<span class="op" id="6526399">:=</span>&nbsp;<span class="ident" id="6526402">test</span><span class="op" id="6526406">.</span><span class="ident" id="6526407">validate</span><span class="op" id="6526415">(</span><span class="ident" id="6526416">connState</span><span class="op" id="6526425">)</span><span class="op" id="6526426">;</span>&nbsp;<span class="ident" id="6526428">err</span>&nbsp;<span class="op" id="6526432">!=</span>&nbsp;<span class="ident" id="6526435">nil</span>&nbsp;<span class="op" id="6526439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526444">t</span><span class="op" id="6526445">.</span><span class="ident" id="6526446">Fatalf</span><span class="op" id="6526452">(</span><span class="string" id="6526453">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6526491">,</span>&nbsp;<span class="ident" id="6526493">err</span><span class="op" id="6526496">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526507">if</span>&nbsp;<span class="ident" id="6526510">write</span>&nbsp;<span class="op" id="6526516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526520">path</span>&nbsp;<span class="op" id="6526525">:=</span>&nbsp;<span class="ident" id="6526528">test</span><span class="op" id="6526532">.</span><span class="ident" id="6526533">dataPath</span><span class="op" id="6526541">(</span><span class="op" id="6526542">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526546">out</span><span class="op" id="6526549">,</span>&nbsp;<span class="ident" id="6526551">err</span>&nbsp;<span class="op" id="6526555">:=</span>&nbsp;<span class="ident" id="6526558">os</span><span class="op" id="6526560">.</span><span class="ident" id="6526561">OpenFile</span><span class="op" id="6526569">(</span><span class="ident" id="6526570">path</span><span class="op" id="6526574">,</span>&nbsp;<span class="ident" id="6526576">os</span><span class="op" id="6526578">.</span><span class="ident" id="6526579">O_WRONLY</span><span class="op" id="6526587">|</span><span class="ident" id="6526588">os</span><span class="op" id="6526590">.</span><span class="ident" id="6526591">O_CREATE</span><span class="op" id="6526599">|</span><span class="ident" id="6526600">os</span><span class="op" id="6526602">.</span><span class="ident" id="6526603">O_TRUNC</span><span class="op" id="6526610">,</span>&nbsp;<span class="num" id="6526612">0644</span><span class="op" id="6526616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526620">if</span>&nbsp;<span class="ident" id="6526623">err</span>&nbsp;<span class="op" id="6526627">!=</span>&nbsp;<span class="ident" id="6526630">nil</span>&nbsp;<span class="op" id="6526634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526639">t</span><span class="op" id="6526640">.</span><span class="ident" id="6526641">Fatalf</span><span class="op" id="6526647">(</span><span class="string" id="6526648">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="6526682">,</span>&nbsp;<span class="ident" id="6526684">err</span><span class="op" id="6526687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526695">defer</span>&nbsp;<span class="ident" id="6526701">out</span><span class="op" id="6526704">.</span><span class="ident" id="6526705">Close</span><span class="op" id="6526710">(</span><span class="op" id="6526711">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526715">recordingConn</span><span class="op" id="6526728">.</span><span class="ident" id="6526729">Close</span><span class="op" id="6526734">(</span><span class="op" id="6526735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526739">if</span>&nbsp;<span class="builtinfunc" id="6526742">len</span><span class="op" id="6526745">(</span><span class="ident" id="6526746">recordingConn</span><span class="op" id="6526759">.</span><span class="ident" id="6526760">flows</span><span class="op" id="6526765">)</span>&nbsp;<span class="op" id="6526767">&lt;</span>&nbsp;<span class="num" id="6526769">3</span>&nbsp;<span class="op" id="6526771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526776">childProcess</span><span class="op" id="6526788">.</span><span class="ident" id="6526789">Stdout</span><span class="op" id="6526795">.</span><span class="op" id="6526796">(</span><span class="op" id="6526797">*</span><span class="ident" id="6526798">bytes</span><span class="op" id="6526803">.</span><span class="ident" id="6526804">Buffer</span><span class="op" id="6526810">)</span><span class="op" id="6526811">.</span><span class="ident" id="6526812">WriteTo</span><span class="op" id="6526819">(</span><span class="ident" id="6526820">os</span><span class="op" id="6526822">.</span><span class="ident" id="6526823">Stdout</span><span class="op" id="6526829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6526834">if</span>&nbsp;<span class="builtinfunc" id="6526837">len</span><span class="op" id="6526840">(</span><span class="ident" id="6526841">test</span><span class="op" id="6526845">.</span><span class="ident" id="6526846">expectHandshakeErrorIncluding</span><span class="op" id="6526875">)</span>&nbsp;<span class="op" id="6526877">==</span>&nbsp;<span class="num" id="6526880">0</span>&nbsp;<span class="op" id="6526882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526888">t</span><span class="op" id="6526889">.</span><span class="ident" id="6526890">Fatalf</span><span class="op" id="6526896">(</span><span class="string" id="6526897">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="6526915">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6526924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526928">recordingConn</span><span class="op" id="6526941">.</span><span class="ident" id="6526942">WriteTo</span><span class="op" id="6526949">(</span><span class="ident" id="6526950">out</span><span class="op" id="6526953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526957">fmt</span><span class="op" id="6526960">.</span><span class="ident" id="6526961">Printf</span><span class="op" id="6526967">(</span><span class="string" id="6526968">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="6526980">,</span>&nbsp;<span class="ident" id="6526982">path</span><span class="op" id="6526986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6526990">childProcess</span><span class="op" id="6527002">.</span><span class="ident" id="6527003">Wait</span><span class="op" id="6527007">(</span><span class="op" id="6527008">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527011">}</span><br>
<span class="lineno"></span><span class="op" id="6527013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527016">func</span>&nbsp;<span class="ident" id="6527021">runServerTestForVersion</span><span class="op" id="6527044">(</span><span class="ident" id="6527045">t</span>&nbsp;<span class="op" id="6527047">*</span><span class="ident" id="6527048">testing</span><span class="op" id="6527055">.</span><span class="ident" id="6527056">T</span><span class="op" id="6527057">,</span>&nbsp;<span class="ident" id="6527059">template</span>&nbsp;<span class="op" id="6527068">*</span><span class="ident" id="6527069">serverTest</span><span class="op" id="6527079">,</span>&nbsp;<span class="ident" id="6527081">prefix</span><span class="op" id="6527087">,</span>&nbsp;<span class="ident" id="6527089">option</span>&nbsp;<span class="builtintype" id="6527096">string</span><span class="op" id="6527102">)</span>&nbsp;<span class="op" id="6527104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527107">test</span>&nbsp;<span class="op" id="6527112">:=</span>&nbsp;<span class="op" id="6527115">*</span><span class="ident" id="6527116">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527126">test</span><span class="op" id="6527130">.</span><span class="ident" id="6527131">name</span>&nbsp;<span class="op" id="6527136">=</span>&nbsp;<span class="ident" id="6527138">prefix</span>&nbsp;<span class="op" id="6527145">+</span>&nbsp;<span class="ident" id="6527147">test</span><span class="op" id="6527151">.</span><span class="ident" id="6527152">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6527158">if</span>&nbsp;<span class="builtinfunc" id="6527161">len</span><span class="op" id="6527164">(</span><span class="ident" id="6527165">test</span><span class="op" id="6527169">.</span><span class="ident" id="6527170">command</span><span class="op" id="6527177">)</span>&nbsp;<span class="op" id="6527179">==</span>&nbsp;<span class="num" id="6527182">0</span>&nbsp;<span class="op" id="6527184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527188">test</span><span class="op" id="6527192">.</span><span class="ident" id="6527193">command</span>&nbsp;<span class="op" id="6527201">=</span>&nbsp;<span class="ident" id="6527203">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6527225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527228">test</span><span class="op" id="6527232">.</span><span class="ident" id="6527233">command</span>&nbsp;<span class="op" id="6527241">=</span>&nbsp;<span class="builtinfunc" id="6527243">append</span><span class="op" id="6527249">(</span><span class="op" id="6527250">[</span><span class="op" id="6527251">]</span><span class="builtintype" id="6527252">string</span><span class="op" id="6527258">(</span><span class="ident" id="6527259">nil</span><span class="op" id="6527262">)</span><span class="op" id="6527263">,</span>&nbsp;<span class="ident" id="6527265">test</span><span class="op" id="6527269">.</span><span class="ident" id="6527270">command</span><span class="op" id="6527277">...</span><span class="op" id="6527280">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527283">test</span><span class="op" id="6527287">.</span><span class="ident" id="6527288">command</span>&nbsp;<span class="op" id="6527296">=</span>&nbsp;<span class="builtinfunc" id="6527298">append</span><span class="op" id="6527304">(</span><span class="ident" id="6527305">test</span><span class="op" id="6527309">.</span><span class="ident" id="6527310">command</span><span class="op" id="6527317">,</span>&nbsp;<span class="ident" id="6527319">option</span><span class="op" id="6527325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527328">test</span><span class="op" id="6527332">.</span><span class="ident" id="6527333">run</span><span class="op" id="6527336">(</span><span class="ident" id="6527337">t</span><span class="op" id="6527338">,</span>&nbsp;<span class="op" id="6527340">*</span><span class="ident" id="6527341">update</span><span class="op" id="6527347">)</span><br>
<span class="lineno"></span><span class="op" id="6527349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527352">func</span>&nbsp;<span class="ident" id="6527357">runServerTestSSLv3</span><span class="op" id="6527375">(</span><span class="ident" id="6527376">t</span>&nbsp;<span class="op" id="6527378">*</span><span class="ident" id="6527379">testing</span><span class="op" id="6527386">.</span><span class="ident" id="6527387">T</span><span class="op" id="6527388">,</span>&nbsp;<span class="ident" id="6527390">template</span>&nbsp;<span class="op" id="6527399">*</span><span class="ident" id="6527400">serverTest</span><span class="op" id="6527410">)</span>&nbsp;<span class="op" id="6527412">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527415">runServerTestForVersion</span><span class="op" id="6527438">(</span><span class="ident" id="6527439">t</span><span class="op" id="6527440">,</span>&nbsp;<span class="ident" id="6527442">template</span><span class="op" id="6527450">,</span>&nbsp;<span class="string" id="6527452">&#34;SSLv3-&#34;</span><span class="op" id="6527460">,</span>&nbsp;<span class="string" id="6527462">&#34;-ssl3&#34;</span><span class="op" id="6527469">)</span><br>
<span class="lineno"></span><span class="op" id="6527471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527474">func</span>&nbsp;<span class="ident" id="6527479">runServerTestTLS10</span><span class="op" id="6527497">(</span><span class="ident" id="6527498">t</span>&nbsp;<span class="op" id="6527500">*</span><span class="ident" id="6527501">testing</span><span class="op" id="6527508">.</span><span class="ident" id="6527509">T</span><span class="op" id="6527510">,</span>&nbsp;<span class="ident" id="6527512">template</span>&nbsp;<span class="op" id="6527521">*</span><span class="ident" id="6527522">serverTest</span><span class="op" id="6527532">)</span>&nbsp;<span class="op" id="6527534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527537">runServerTestForVersion</span><span class="op" id="6527560">(</span><span class="ident" id="6527561">t</span><span class="op" id="6527562">,</span>&nbsp;<span class="ident" id="6527564">template</span><span class="op" id="6527572">,</span>&nbsp;<span class="string" id="6527574">&#34;TLSv10-&#34;</span><span class="op" id="6527583">,</span>&nbsp;<span class="string" id="6527585">&#34;-tls1&#34;</span><span class="op" id="6527592">)</span><br>
<span class="lineno">470</span><span class="op" id="6527594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527597">func</span>&nbsp;<span class="ident" id="6527602">runServerTestTLS11</span><span class="op" id="6527620">(</span><span class="ident" id="6527621">t</span>&nbsp;<span class="op" id="6527623">*</span><span class="ident" id="6527624">testing</span><span class="op" id="6527631">.</span><span class="ident" id="6527632">T</span><span class="op" id="6527633">,</span>&nbsp;<span class="ident" id="6527635">template</span>&nbsp;<span class="op" id="6527644">*</span><span class="ident" id="6527645">serverTest</span><span class="op" id="6527655">)</span>&nbsp;<span class="op" id="6527657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527660">runServerTestForVersion</span><span class="op" id="6527683">(</span><span class="ident" id="6527684">t</span><span class="op" id="6527685">,</span>&nbsp;<span class="ident" id="6527687">template</span><span class="op" id="6527695">,</span>&nbsp;<span class="string" id="6527697">&#34;TLSv11-&#34;</span><span class="op" id="6527706">,</span>&nbsp;<span class="string" id="6527708">&#34;-tls1_1&#34;</span><span class="op" id="6527717">)</span><br>
<span class="lineno"></span><span class="op" id="6527719">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6527722">func</span>&nbsp;<span class="ident" id="6527727">runServerTestTLS12</span><span class="op" id="6527745">(</span><span class="ident" id="6527746">t</span>&nbsp;<span class="op" id="6527748">*</span><span class="ident" id="6527749">testing</span><span class="op" id="6527756">.</span><span class="ident" id="6527757">T</span><span class="op" id="6527758">,</span>&nbsp;<span class="ident" id="6527760">template</span>&nbsp;<span class="op" id="6527769">*</span><span class="ident" id="6527770">serverTest</span><span class="op" id="6527780">)</span>&nbsp;<span class="op" id="6527782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527785">runServerTestForVersion</span><span class="op" id="6527808">(</span><span class="ident" id="6527809">t</span><span class="op" id="6527810">,</span>&nbsp;<span class="ident" id="6527812">template</span><span class="op" id="6527820">,</span>&nbsp;<span class="string" id="6527822">&#34;TLSv12-&#34;</span><span class="op" id="6527831">,</span>&nbsp;<span class="string" id="6527833">&#34;-tls1_2&#34;</span><span class="op" id="6527842">)</span><br>
<span class="lineno"></span><span class="op" id="6527844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6527847">func</span>&nbsp;<span class="ident" id="6527852">TestHandshakeServerRSARC4</span><span class="op" id="6527877">(</span><span class="ident" id="6527878">t</span>&nbsp;<span class="op" id="6527880">*</span><span class="ident" id="6527881">testing</span><span class="op" id="6527888">.</span><span class="ident" id="6527889">T</span><span class="op" id="6527890">)</span>&nbsp;<span class="op" id="6527892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527895">test</span>&nbsp;<span class="op" id="6527900">:=</span>&nbsp;<span class="op" id="6527903">&amp;</span><span class="ident" id="6527904">serverTest</span><span class="op" id="6527914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527918">name</span><span class="op" id="6527922">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6527927">&#34;RSA-RC4&#34;</span><span class="op" id="6527936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6527940">command</span><span class="op" id="6527947">:</span>&nbsp;<span class="op" id="6527949">[</span><span class="op" id="6527950">]</span><span class="builtintype" id="6527951">string</span><span class="op" id="6527957">{</span><span class="string" id="6527958">&#34;openssl&#34;</span><span class="op" id="6527967">,</span>&nbsp;<span class="string" id="6527969">&#34;s_client&#34;</span><span class="op" id="6527979">,</span>&nbsp;<span class="string" id="6527981">&#34;-no_ticket&#34;</span><span class="op" id="6527993">,</span>&nbsp;<span class="string" id="6527995">&#34;-cipher&#34;</span><span class="op" id="6528004">,</span>&nbsp;<span class="string" id="6528006">&#34;RC4-SHA&#34;</span><span class="op" id="6528015">}</span><span class="op" id="6528016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528019">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528022">runServerTestSSLv3</span><span class="op" id="6528040">(</span><span class="ident" id="6528041">t</span><span class="op" id="6528042">,</span>&nbsp;<span class="ident" id="6528044">test</span><span class="op" id="6528048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528051">runServerTestTLS10</span><span class="op" id="6528069">(</span><span class="ident" id="6528070">t</span><span class="op" id="6528071">,</span>&nbsp;<span class="ident" id="6528073">test</span><span class="op" id="6528077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528080">runServerTestTLS11</span><span class="op" id="6528098">(</span><span class="ident" id="6528099">t</span><span class="op" id="6528100">,</span>&nbsp;<span class="ident" id="6528102">test</span><span class="op" id="6528106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528109">runServerTestTLS12</span><span class="op" id="6528127">(</span><span class="ident" id="6528128">t</span><span class="op" id="6528129">,</span>&nbsp;<span class="ident" id="6528131">test</span><span class="op" id="6528135">)</span><br>
<span class="lineno"></span><span class="op" id="6528137">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="6528140">func</span>&nbsp;<span class="ident" id="6528145">TestHandshakeServerRSA3DES</span><span class="op" id="6528171">(</span><span class="ident" id="6528172">t</span>&nbsp;<span class="op" id="6528174">*</span><span class="ident" id="6528175">testing</span><span class="op" id="6528182">.</span><span class="ident" id="6528183">T</span><span class="op" id="6528184">)</span>&nbsp;<span class="op" id="6528186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528189">test</span>&nbsp;<span class="op" id="6528194">:=</span>&nbsp;<span class="op" id="6528197">&amp;</span><span class="ident" id="6528198">serverTest</span><span class="op" id="6528208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528212">name</span><span class="op" id="6528216">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6528221">&#34;RSA-3DES&#34;</span><span class="op" id="6528231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528235">command</span><span class="op" id="6528242">:</span>&nbsp;<span class="op" id="6528244">[</span><span class="op" id="6528245">]</span><span class="builtintype" id="6528246">string</span><span class="op" id="6528252">{</span><span class="string" id="6528253">&#34;openssl&#34;</span><span class="op" id="6528262">,</span>&nbsp;<span class="string" id="6528264">&#34;s_client&#34;</span><span class="op" id="6528274">,</span>&nbsp;<span class="string" id="6528276">&#34;-no_ticket&#34;</span><span class="op" id="6528288">,</span>&nbsp;<span class="string" id="6528290">&#34;-cipher&#34;</span><span class="op" id="6528299">,</span>&nbsp;<span class="string" id="6528301">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="6528315">}</span><span class="op" id="6528316">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528322">runServerTestSSLv3</span><span class="op" id="6528340">(</span><span class="ident" id="6528341">t</span><span class="op" id="6528342">,</span>&nbsp;<span class="ident" id="6528344">test</span><span class="op" id="6528348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528351">runServerTestTLS10</span><span class="op" id="6528369">(</span><span class="ident" id="6528370">t</span><span class="op" id="6528371">,</span>&nbsp;<span class="ident" id="6528373">test</span><span class="op" id="6528377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528380">runServerTestTLS12</span><span class="op" id="6528398">(</span><span class="ident" id="6528399">t</span><span class="op" id="6528400">,</span>&nbsp;<span class="ident" id="6528402">test</span><span class="op" id="6528406">)</span><br>
<span class="lineno"></span><span class="op" id="6528408">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="6528411">func</span>&nbsp;<span class="ident" id="6528416">TestHandshakeServerRSAAES</span><span class="op" id="6528441">(</span><span class="ident" id="6528442">t</span>&nbsp;<span class="op" id="6528444">*</span><span class="ident" id="6528445">testing</span><span class="op" id="6528452">.</span><span class="ident" id="6528453">T</span><span class="op" id="6528454">)</span>&nbsp;<span class="op" id="6528456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528459">test</span>&nbsp;<span class="op" id="6528464">:=</span>&nbsp;<span class="op" id="6528467">&amp;</span><span class="ident" id="6528468">serverTest</span><span class="op" id="6528478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528482">name</span><span class="op" id="6528486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6528491">&#34;RSA-AES&#34;</span><span class="op" id="6528500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528504">command</span><span class="op" id="6528511">:</span>&nbsp;<span class="op" id="6528513">[</span><span class="op" id="6528514">]</span><span class="builtintype" id="6528515">string</span><span class="op" id="6528521">{</span><span class="string" id="6528522">&#34;openssl&#34;</span><span class="op" id="6528531">,</span>&nbsp;<span class="string" id="6528533">&#34;s_client&#34;</span><span class="op" id="6528543">,</span>&nbsp;<span class="string" id="6528545">&#34;-no_ticket&#34;</span><span class="op" id="6528557">,</span>&nbsp;<span class="string" id="6528559">&#34;-cipher&#34;</span><span class="op" id="6528568">,</span>&nbsp;<span class="string" id="6528570">&#34;AES128-SHA&#34;</span><span class="op" id="6528582">}</span><span class="op" id="6528583">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528589">runServerTestSSLv3</span><span class="op" id="6528607">(</span><span class="ident" id="6528608">t</span><span class="op" id="6528609">,</span>&nbsp;<span class="ident" id="6528611">test</span><span class="op" id="6528615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528618">runServerTestTLS10</span><span class="op" id="6528636">(</span><span class="ident" id="6528637">t</span><span class="op" id="6528638">,</span>&nbsp;<span class="ident" id="6528640">test</span><span class="op" id="6528644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528647">runServerTestTLS12</span><span class="op" id="6528665">(</span><span class="ident" id="6528666">t</span><span class="op" id="6528667">,</span>&nbsp;<span class="ident" id="6528669">test</span><span class="op" id="6528673">)</span><br>
<span class="lineno"></span><span class="op" id="6528675">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="6528678">func</span>&nbsp;<span class="ident" id="6528683">TestHandshakeServerAESGCM</span><span class="op" id="6528708">(</span><span class="ident" id="6528709">t</span>&nbsp;<span class="op" id="6528711">*</span><span class="ident" id="6528712">testing</span><span class="op" id="6528719">.</span><span class="ident" id="6528720">T</span><span class="op" id="6528721">)</span>&nbsp;<span class="op" id="6528723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528726">test</span>&nbsp;<span class="op" id="6528731">:=</span>&nbsp;<span class="op" id="6528734">&amp;</span><span class="ident" id="6528735">serverTest</span><span class="op" id="6528745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528749">name</span><span class="op" id="6528753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6528758">&#34;RSA-AES-GCM&#34;</span><span class="op" id="6528771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528775">command</span><span class="op" id="6528782">:</span>&nbsp;<span class="op" id="6528784">[</span><span class="op" id="6528785">]</span><span class="builtintype" id="6528786">string</span><span class="op" id="6528792">{</span><span class="string" id="6528793">&#34;openssl&#34;</span><span class="op" id="6528802">,</span>&nbsp;<span class="string" id="6528804">&#34;s_client&#34;</span><span class="op" id="6528814">,</span>&nbsp;<span class="string" id="6528816">&#34;-no_ticket&#34;</span><span class="op" id="6528828">,</span>&nbsp;<span class="string" id="6528830">&#34;-cipher&#34;</span><span class="op" id="6528839">,</span>&nbsp;<span class="string" id="6528841">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="6528870">}</span><span class="op" id="6528871">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6528874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528877">runServerTestTLS12</span><span class="op" id="6528895">(</span><span class="ident" id="6528896">t</span><span class="op" id="6528897">,</span>&nbsp;<span class="ident" id="6528899">test</span><span class="op" id="6528903">)</span><br>
<span class="lineno"></span><span class="op" id="6528905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6528908">func</span>&nbsp;<span class="ident" id="6528913">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="6528945">(</span><span class="ident" id="6528946">t</span>&nbsp;<span class="op" id="6528948">*</span><span class="ident" id="6528949">testing</span><span class="op" id="6528956">.</span><span class="ident" id="6528957">T</span><span class="op" id="6528958">)</span>&nbsp;<span class="op" id="6528960">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528963">config</span>&nbsp;<span class="op" id="6528970">:=</span>&nbsp;<span class="op" id="6528973">*</span><span class="ident" id="6528974">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6528986">config</span><span class="op" id="6528992">.</span><span class="ident" id="6528993">Certificates</span>&nbsp;<span class="op" id="6529006">=</span>&nbsp;<span class="builtinfunc" id="6529008">make</span><span class="op" id="6529012">(</span><span class="op" id="6529013">[</span><span class="op" id="6529014">]</span><span class="ident" id="6529015">Certificate</span><span class="op" id="6529026">,</span>&nbsp;<span class="num" id="6529028">1</span><span class="op" id="6529029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529032">config</span><span class="op" id="6529038">.</span><span class="ident" id="6529039">Certificates</span><span class="op" id="6529051">[</span><span class="num" id="6529052">0</span><span class="op" id="6529053">]</span><span class="op" id="6529054">.</span><span class="ident" id="6529055">Certificate</span>&nbsp;<span class="op" id="6529067">=</span>&nbsp;<span class="op" id="6529069">[</span><span class="op" id="6529070">]</span><span class="op" id="6529071">[</span><span class="op" id="6529072">]</span><span class="builtintype" id="6529073">byte</span><span class="op" id="6529077">{</span><span class="ident" id="6529078">testECDSACertificate</span><span class="op" id="6529098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529101">config</span><span class="op" id="6529107">.</span><span class="ident" id="6529108">Certificates</span><span class="op" id="6529120">[</span><span class="num" id="6529121">0</span><span class="op" id="6529122">]</span><span class="op" id="6529123">.</span><span class="ident" id="6529124">PrivateKey</span>&nbsp;<span class="op" id="6529135">=</span>&nbsp;<span class="ident" id="6529137">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529158">config</span><span class="op" id="6529164">.</span><span class="ident" id="6529165">BuildNameToCertificate</span><span class="op" id="6529187">(</span><span class="op" id="6529188">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529192">test</span>&nbsp;<span class="op" id="6529197">:=</span>&nbsp;<span class="op" id="6529200">&amp;</span><span class="ident" id="6529201">serverTest</span><span class="op" id="6529211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529215">name</span><span class="op" id="6529219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6529224">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="6529241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529245">command</span><span class="op" id="6529252">:</span>&nbsp;<span class="op" id="6529254">[</span><span class="op" id="6529255">]</span><span class="builtintype" id="6529256">string</span><span class="op" id="6529262">{</span><span class="string" id="6529263">&#34;openssl&#34;</span><span class="op" id="6529272">,</span>&nbsp;<span class="string" id="6529274">&#34;s_client&#34;</span><span class="op" id="6529284">,</span>&nbsp;<span class="string" id="6529286">&#34;-no_ticket&#34;</span><span class="op" id="6529298">,</span>&nbsp;<span class="string" id="6529300">&#34;-cipher&#34;</span><span class="op" id="6529309">,</span>&nbsp;<span class="string" id="6529311">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="6529335">}</span><span class="op" id="6529336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529340">config</span><span class="op" id="6529346">:</span>&nbsp;&nbsp;<span class="op" id="6529349">&amp;</span><span class="ident" id="6529350">config</span><span class="op" id="6529356">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6529359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529362">runServerTestTLS10</span><span class="op" id="6529380">(</span><span class="ident" id="6529381">t</span><span class="op" id="6529382">,</span>&nbsp;<span class="ident" id="6529384">test</span><span class="op" id="6529388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529391">runServerTestTLS12</span><span class="op" id="6529409">(</span><span class="ident" id="6529410">t</span><span class="op" id="6529411">,</span>&nbsp;<span class="ident" id="6529413">test</span><span class="op" id="6529417">)</span><br>
<span class="lineno"></span><span class="op" id="6529419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="6529422">func</span>&nbsp;<span class="ident" id="6529427">TestHandshakeServerALPN</span><span class="op" id="6529450">(</span><span class="ident" id="6529451">t</span>&nbsp;<span class="op" id="6529453">*</span><span class="ident" id="6529454">testing</span><span class="op" id="6529461">.</span><span class="ident" id="6529462">T</span><span class="op" id="6529463">)</span>&nbsp;<span class="op" id="6529465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529468">config</span>&nbsp;<span class="op" id="6529475">:=</span>&nbsp;<span class="op" id="6529478">*</span><span class="ident" id="6529479">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529491">config</span><span class="op" id="6529497">.</span><span class="ident" id="6529498">NextProtos</span>&nbsp;<span class="op" id="6529509">=</span>&nbsp;<span class="op" id="6529511">[</span><span class="op" id="6529512">]</span><span class="builtintype" id="6529513">string</span><span class="op" id="6529519">{</span><span class="string" id="6529520">&#34;proto1&#34;</span><span class="op" id="6529528">,</span>&nbsp;<span class="string" id="6529530">&#34;proto2&#34;</span><span class="op" id="6529538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529542">test</span>&nbsp;<span class="op" id="6529547">:=</span>&nbsp;<span class="op" id="6529550">&amp;</span><span class="ident" id="6529551">serverTest</span><span class="op" id="6529561">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529565">name</span><span class="op" id="6529569">:</span>&nbsp;<span class="string" id="6529571">&#34;ALPN&#34;</span><span class="op" id="6529577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6529581">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6529647">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529690">command</span><span class="op" id="6529697">:</span>&nbsp;<span class="op" id="6529699">[</span><span class="op" id="6529700">]</span><span class="builtintype" id="6529701">string</span><span class="op" id="6529707">{</span><span class="string" id="6529708">&#34;openssl&#34;</span><span class="op" id="6529717">,</span>&nbsp;<span class="string" id="6529719">&#34;s_client&#34;</span><span class="op" id="6529729">,</span>&nbsp;<span class="string" id="6529731">&#34;-alpn&#34;</span><span class="op" id="6529738">,</span>&nbsp;<span class="string" id="6529740">&#34;proto2,proto1&#34;</span><span class="op" id="6529755">}</span><span class="op" id="6529756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529760">config</span><span class="op" id="6529766">:</span>&nbsp;&nbsp;<span class="op" id="6529769">&amp;</span><span class="ident" id="6529770">config</span><span class="op" id="6529776">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6529780">validate</span><span class="op" id="6529788">:</span>&nbsp;<span class="keyword" id="6529790">func</span><span class="op" id="6529794">(</span><span class="ident" id="6529795">state</span>&nbsp;<span class="ident" id="6529801">ConnectionState</span><span class="op" id="6529816">)</span>&nbsp;<span class="builtintype" id="6529818">error</span>&nbsp;<span class="op" id="6529824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6529829">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529888">if</span>&nbsp;<span class="ident" id="6529891">state</span><span class="op" id="6529896">.</span><span class="ident" id="6529897">NegotiatedProtocol</span>&nbsp;<span class="op" id="6529916">!=</span>&nbsp;<span class="string" id="6529919">&#34;proto1&#34;</span>&nbsp;<span class="op" id="6529928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6529934">return</span>&nbsp;<span class="ident" id="6529941">fmt</span><span class="op" id="6529944">.</span><span class="ident" id="6529945">Errorf</span><span class="op" id="6529951">(</span><span class="string" id="6529952">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="6529984">,</span>&nbsp;<span class="ident" id="6529986">state</span><span class="op" id="6529991">.</span><span class="ident" id="6529992">NegotiatedProtocol</span><span class="op" id="6530010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530015">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530020">return</span>&nbsp;<span class="ident" id="6530027">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530033">}</span><span class="op" id="6530034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530040">runServerTestTLS12</span><span class="op" id="6530058">(</span><span class="ident" id="6530059">t</span><span class="op" id="6530060">,</span>&nbsp;<span class="ident" id="6530062">test</span><span class="op" id="6530066">)</span><br>
<span class="lineno"></span><span class="op" id="6530068">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="6530071">func</span>&nbsp;<span class="ident" id="6530076">TestHandshakeServerALPNNoMatch</span><span class="op" id="6530106">(</span><span class="ident" id="6530107">t</span>&nbsp;<span class="op" id="6530109">*</span><span class="ident" id="6530110">testing</span><span class="op" id="6530117">.</span><span class="ident" id="6530118">T</span><span class="op" id="6530119">)</span>&nbsp;<span class="op" id="6530121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530124">config</span>&nbsp;<span class="op" id="6530131">:=</span>&nbsp;<span class="op" id="6530134">*</span><span class="ident" id="6530135">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530147">config</span><span class="op" id="6530153">.</span><span class="ident" id="6530154">NextProtos</span>&nbsp;<span class="op" id="6530165">=</span>&nbsp;<span class="op" id="6530167">[</span><span class="op" id="6530168">]</span><span class="builtintype" id="6530169">string</span><span class="op" id="6530175">{</span><span class="string" id="6530176">&#34;proto3&#34;</span><span class="op" id="6530184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530188">test</span>&nbsp;<span class="op" id="6530193">:=</span>&nbsp;<span class="op" id="6530196">&amp;</span><span class="ident" id="6530197">serverTest</span><span class="op" id="6530207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530211">name</span><span class="op" id="6530215">:</span>&nbsp;<span class="string" id="6530217">&#34;ALPN-NoMatch&#34;</span><span class="op" id="6530231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6530235">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6530301">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530344">command</span><span class="op" id="6530351">:</span>&nbsp;<span class="op" id="6530353">[</span><span class="op" id="6530354">]</span><span class="builtintype" id="6530355">string</span><span class="op" id="6530361">{</span><span class="string" id="6530362">&#34;openssl&#34;</span><span class="op" id="6530371">,</span>&nbsp;<span class="string" id="6530373">&#34;s_client&#34;</span><span class="op" id="6530383">,</span>&nbsp;<span class="string" id="6530385">&#34;-alpn&#34;</span><span class="op" id="6530392">,</span>&nbsp;<span class="string" id="6530394">&#34;proto2,proto1&#34;</span><span class="op" id="6530409">}</span><span class="op" id="6530410">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530414">config</span><span class="op" id="6530420">:</span>&nbsp;&nbsp;<span class="op" id="6530423">&amp;</span><span class="ident" id="6530424">config</span><span class="op" id="6530430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530434">validate</span><span class="op" id="6530442">:</span>&nbsp;<span class="keyword" id="6530444">func</span><span class="op" id="6530448">(</span><span class="ident" id="6530449">state</span>&nbsp;<span class="ident" id="6530455">ConnectionState</span><span class="op" id="6530470">)</span>&nbsp;<span class="builtintype" id="6530472">error</span>&nbsp;<span class="op" id="6530478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6530483">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6530542">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530585">if</span>&nbsp;<span class="ident" id="6530588">state</span><span class="op" id="6530593">.</span><span class="ident" id="6530594">NegotiatedProtocol</span>&nbsp;<span class="op" id="6530613">!=</span>&nbsp;<span class="string" id="6530616">&#34;&#34;</span>&nbsp;<span class="op" id="6530619">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530625">return</span>&nbsp;<span class="ident" id="6530632">fmt</span><span class="op" id="6530635">.</span><span class="ident" id="6530636">Errorf</span><span class="op" id="6530642">(</span><span class="string" id="6530643">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="6530671">,</span>&nbsp;<span class="ident" id="6530673">state</span><span class="op" id="6530678">.</span><span class="ident" id="6530679">NegotiatedProtocol</span><span class="op" id="6530697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6530707">return</span>&nbsp;<span class="ident" id="6530714">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530720">}</span><span class="op" id="6530721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6530724">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6530727">runServerTestTLS12</span><span class="op" id="6530745">(</span><span class="ident" id="6530746">t</span><span class="op" id="6530747">,</span>&nbsp;<span class="ident" id="6530749">test</span><span class="op" id="6530753">)</span><br>
<span class="lineno"></span><span class="op" id="6530755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6530758">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6530830">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="6530910">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="6530974">func</span>&nbsp;<span class="ident" id="6530979">TestHandshakeServerSNI</span><span class="op" id="6531001">(</span><span class="ident" id="6531002">t</span>&nbsp;<span class="op" id="6531004">*</span><span class="ident" id="6531005">testing</span><span class="op" id="6531012">.</span><span class="ident" id="6531013">T</span><span class="op" id="6531014">)</span>&nbsp;<span class="op" id="6531016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531019">test</span>&nbsp;<span class="op" id="6531024">:=</span>&nbsp;<span class="op" id="6531027">&amp;</span><span class="ident" id="6531028">serverTest</span><span class="op" id="6531038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531042">name</span><span class="op" id="6531046">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6531051">&#34;SNI&#34;</span><span class="op" id="6531056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531060">command</span><span class="op" id="6531067">:</span>&nbsp;<span class="op" id="6531069">[</span><span class="op" id="6531070">]</span><span class="builtintype" id="6531071">string</span><span class="op" id="6531077">{</span><span class="string" id="6531078">&#34;openssl&#34;</span><span class="op" id="6531087">,</span>&nbsp;<span class="string" id="6531089">&#34;s_client&#34;</span><span class="op" id="6531099">,</span>&nbsp;<span class="string" id="6531101">&#34;-no_ticket&#34;</span><span class="op" id="6531113">,</span>&nbsp;<span class="string" id="6531115">&#34;-cipher&#34;</span><span class="op" id="6531124">,</span>&nbsp;<span class="string" id="6531126">&#34;AES128-SHA&#34;</span><span class="op" id="6531138">,</span>&nbsp;<span class="string" id="6531140">&#34;-servername&#34;</span><span class="op" id="6531153">,</span>&nbsp;<span class="string" id="6531155">&#34;snitest.com&#34;</span><span class="op" id="6531168">}</span><span class="op" id="6531169">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531175">runServerTestTLS12</span><span class="op" id="6531193">(</span><span class="ident" id="6531194">t</span><span class="op" id="6531195">,</span>&nbsp;<span class="ident" id="6531197">test</span><span class="op" id="6531201">)</span><br>
<span class="lineno"></span><span class="op" id="6531203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6531206">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="6531285">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="6531328">func</span>&nbsp;<span class="ident" id="6531333">TestHandshakeServerSNIGetCertificate</span><span class="op" id="6531369">(</span><span class="ident" id="6531370">t</span>&nbsp;<span class="op" id="6531372">*</span><span class="ident" id="6531373">testing</span><span class="op" id="6531380">.</span><span class="ident" id="6531381">T</span><span class="op" id="6531382">)</span>&nbsp;<span class="op" id="6531384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531387">config</span>&nbsp;<span class="op" id="6531394">:=</span>&nbsp;<span class="op" id="6531397">*</span><span class="ident" id="6531398">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6531411">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531480">nameToCert</span>&nbsp;<span class="op" id="6531491">:=</span>&nbsp;<span class="ident" id="6531494">config</span><span class="op" id="6531500">.</span><span class="ident" id="6531501">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531520">config</span><span class="op" id="6531526">.</span><span class="ident" id="6531527">NameToCertificate</span>&nbsp;<span class="op" id="6531545">=</span>&nbsp;<span class="ident" id="6531547">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531552">config</span><span class="op" id="6531558">.</span><span class="ident" id="6531559">GetCertificate</span>&nbsp;<span class="op" id="6531574">=</span>&nbsp;<span class="keyword" id="6531576">func</span><span class="op" id="6531580">(</span><span class="ident" id="6531581">clientHello</span>&nbsp;<span class="op" id="6531593">*</span><span class="ident" id="6531594">ClientHelloInfo</span><span class="op" id="6531609">)</span>&nbsp;<span class="op" id="6531611">(</span><span class="op" id="6531612">*</span><span class="ident" id="6531613">Certificate</span><span class="op" id="6531624">,</span>&nbsp;<span class="builtintype" id="6531626">error</span><span class="op" id="6531631">)</span>&nbsp;<span class="op" id="6531633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531637">cert</span><span class="op" id="6531641">,</span>&nbsp;<span class="ident" id="6531643">_</span>&nbsp;<span class="op" id="6531645">:=</span>&nbsp;<span class="ident" id="6531648">nameToCert</span><span class="op" id="6531658">[</span><span class="ident" id="6531659">clientHello</span><span class="op" id="6531670">.</span><span class="ident" id="6531671">ServerName</span><span class="op" id="6531681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6531685">return</span>&nbsp;<span class="ident" id="6531692">cert</span><span class="op" id="6531696">,</span>&nbsp;<span class="ident" id="6531698">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531706">test</span>&nbsp;<span class="op" id="6531711">:=</span>&nbsp;<span class="op" id="6531714">&amp;</span><span class="ident" id="6531715">serverTest</span><span class="op" id="6531725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531729">name</span><span class="op" id="6531733">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6531738">&#34;SNI&#34;</span><span class="op" id="6531743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531747">command</span><span class="op" id="6531754">:</span>&nbsp;<span class="op" id="6531756">[</span><span class="op" id="6531757">]</span><span class="builtintype" id="6531758">string</span><span class="op" id="6531764">{</span><span class="string" id="6531765">&#34;openssl&#34;</span><span class="op" id="6531774">,</span>&nbsp;<span class="string" id="6531776">&#34;s_client&#34;</span><span class="op" id="6531786">,</span>&nbsp;<span class="string" id="6531788">&#34;-no_ticket&#34;</span><span class="op" id="6531800">,</span>&nbsp;<span class="string" id="6531802">&#34;-cipher&#34;</span><span class="op" id="6531811">,</span>&nbsp;<span class="string" id="6531813">&#34;AES128-SHA&#34;</span><span class="op" id="6531825">,</span>&nbsp;<span class="string" id="6531827">&#34;-servername&#34;</span><span class="op" id="6531840">,</span>&nbsp;<span class="string" id="6531842">&#34;snitest.com&#34;</span><span class="op" id="6531855">}</span><span class="op" id="6531856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531860">config</span><span class="op" id="6531866">:</span>&nbsp;&nbsp;<span class="op" id="6531869">&amp;</span><span class="ident" id="6531870">config</span><span class="op" id="6531876">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6531879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6531882">runServerTestTLS12</span><span class="op" id="6531900">(</span><span class="ident" id="6531901">t</span><span class="op" id="6531902">,</span>&nbsp;<span class="ident" id="6531904">test</span><span class="op" id="6531908">)</span><br>
<span class="lineno"></span><span class="op" id="6531910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6531913">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="6531972">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6532047">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6532121">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="6532151">func</span>&nbsp;<span class="ident" id="6532156">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="6532200">(</span><span class="ident" id="6532201">t</span>&nbsp;<span class="op" id="6532203">*</span><span class="ident" id="6532204">testing</span><span class="op" id="6532211">.</span><span class="ident" id="6532212">T</span><span class="op" id="6532213">)</span>&nbsp;<span class="op" id="6532215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532218">config</span>&nbsp;<span class="op" id="6532225">:=</span>&nbsp;<span class="op" id="6532228">*</span><span class="ident" id="6532229">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532242">config</span><span class="op" id="6532248">.</span><span class="ident" id="6532249">GetCertificate</span>&nbsp;<span class="op" id="6532264">=</span>&nbsp;<span class="keyword" id="6532266">func</span><span class="op" id="6532270">(</span><span class="ident" id="6532271">clientHello</span>&nbsp;<span class="op" id="6532283">*</span><span class="ident" id="6532284">ClientHelloInfo</span><span class="op" id="6532299">)</span>&nbsp;<span class="op" id="6532301">(</span><span class="op" id="6532302">*</span><span class="ident" id="6532303">Certificate</span><span class="op" id="6532314">,</span>&nbsp;<span class="builtintype" id="6532316">error</span><span class="op" id="6532321">)</span>&nbsp;<span class="op" id="6532323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532327">return</span>&nbsp;<span class="ident" id="6532334">nil</span><span class="op" id="6532337">,</span>&nbsp;<span class="ident" id="6532339">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532347">test</span>&nbsp;<span class="op" id="6532352">:=</span>&nbsp;<span class="op" id="6532355">&amp;</span><span class="ident" id="6532356">serverTest</span><span class="op" id="6532366">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532370">name</span><span class="op" id="6532374">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6532379">&#34;SNI&#34;</span><span class="op" id="6532384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532388">command</span><span class="op" id="6532395">:</span>&nbsp;<span class="op" id="6532397">[</span><span class="op" id="6532398">]</span><span class="builtintype" id="6532399">string</span><span class="op" id="6532405">{</span><span class="string" id="6532406">&#34;openssl&#34;</span><span class="op" id="6532415">,</span>&nbsp;<span class="string" id="6532417">&#34;s_client&#34;</span><span class="op" id="6532427">,</span>&nbsp;<span class="string" id="6532429">&#34;-no_ticket&#34;</span><span class="op" id="6532441">,</span>&nbsp;<span class="string" id="6532443">&#34;-cipher&#34;</span><span class="op" id="6532452">,</span>&nbsp;<span class="string" id="6532454">&#34;AES128-SHA&#34;</span><span class="op" id="6532466">,</span>&nbsp;<span class="string" id="6532468">&#34;-servername&#34;</span><span class="op" id="6532481">,</span>&nbsp;<span class="string" id="6532483">&#34;snitest.com&#34;</span><span class="op" id="6532496">}</span><span class="op" id="6532497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532501">config</span><span class="op" id="6532507">:</span>&nbsp;&nbsp;<span class="op" id="6532510">&amp;</span><span class="ident" id="6532511">config</span><span class="op" id="6532517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532523">runServerTestTLS12</span><span class="op" id="6532541">(</span><span class="ident" id="6532542">t</span><span class="op" id="6532543">,</span>&nbsp;<span class="ident" id="6532545">test</span><span class="op" id="6532549">)</span><br>
<span class="lineno">625</span><span class="op" id="6532551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6532554">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6532630">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="6532671">func</span>&nbsp;<span class="ident" id="6532676">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="6532717">(</span><span class="ident" id="6532718">t</span>&nbsp;<span class="op" id="6532720">*</span><span class="ident" id="6532721">testing</span><span class="op" id="6532728">.</span><span class="ident" id="6532729">T</span><span class="op" id="6532730">)</span>&nbsp;<span class="op" id="6532732">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532735">config</span>&nbsp;<span class="op" id="6532742">:=</span>&nbsp;<span class="op" id="6532745">*</span><span class="ident" id="6532746">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532759">config</span><span class="op" id="6532765">.</span><span class="ident" id="6532766">GetCertificate</span>&nbsp;<span class="op" id="6532781">=</span>&nbsp;<span class="keyword" id="6532783">func</span><span class="op" id="6532787">(</span><span class="ident" id="6532788">clientHello</span>&nbsp;<span class="op" id="6532800">*</span><span class="ident" id="6532801">ClientHelloInfo</span><span class="op" id="6532816">)</span>&nbsp;<span class="op" id="6532818">(</span><span class="op" id="6532819">*</span><span class="ident" id="6532820">Certificate</span><span class="op" id="6532831">,</span>&nbsp;<span class="builtintype" id="6532833">error</span><span class="op" id="6532838">)</span>&nbsp;<span class="op" id="6532840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6532844">return</span>&nbsp;<span class="ident" id="6532851">nil</span><span class="op" id="6532854">,</span>&nbsp;<span class="ident" id="6532856">fmt</span><span class="op" id="6532859">.</span><span class="ident" id="6532860">Errorf</span><span class="op" id="6532866">(</span><span class="string" id="6532867">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="6532897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532900">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532903">test</span>&nbsp;<span class="op" id="6532908">:=</span>&nbsp;<span class="op" id="6532911">&amp;</span><span class="ident" id="6532912">serverTest</span><span class="op" id="6532922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532926">name</span><span class="op" id="6532930">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6532939">&#34;SNI&#34;</span><span class="op" id="6532944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6532948">command</span><span class="op" id="6532955">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6532961">[</span><span class="op" id="6532962">]</span><span class="builtintype" id="6532963">string</span><span class="op" id="6532969">{</span><span class="string" id="6532970">&#34;openssl&#34;</span><span class="op" id="6532979">,</span>&nbsp;<span class="string" id="6532981">&#34;s_client&#34;</span><span class="op" id="6532991">,</span>&nbsp;<span class="string" id="6532993">&#34;-no_ticket&#34;</span><span class="op" id="6533005">,</span>&nbsp;<span class="string" id="6533007">&#34;-cipher&#34;</span><span class="op" id="6533016">,</span>&nbsp;<span class="string" id="6533018">&#34;AES128-SHA&#34;</span><span class="op" id="6533030">,</span>&nbsp;<span class="string" id="6533032">&#34;-servername&#34;</span><span class="op" id="6533045">,</span>&nbsp;<span class="string" id="6533047">&#34;snitest.com&#34;</span><span class="op" id="6533060">}</span><span class="op" id="6533061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533065">config</span><span class="op" id="6533071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533078">&amp;</span><span class="ident" id="6533079">config</span><span class="op" id="6533085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533089">expectAlert</span><span class="op" id="6533100">:</span>&nbsp;<span class="builtintype" id="6533102">true</span><span class="op" id="6533106">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533112">runServerTestTLS12</span><span class="op" id="6533130">(</span><span class="ident" id="6533131">t</span><span class="op" id="6533132">,</span>&nbsp;<span class="ident" id="6533134">test</span><span class="op" id="6533138">)</span><br>
<span class="lineno"></span><span class="op" id="6533140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6533143">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="6533223">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="6533297">func</span>&nbsp;<span class="ident" id="6533302">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="6533336">(</span><span class="ident" id="6533337">t</span>&nbsp;<span class="op" id="6533339">*</span><span class="ident" id="6533340">testing</span><span class="op" id="6533347">.</span><span class="ident" id="6533348">T</span><span class="op" id="6533349">)</span>&nbsp;<span class="op" id="6533351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533354">config</span>&nbsp;<span class="op" id="6533361">:=</span>&nbsp;<span class="op" id="6533364">*</span><span class="ident" id="6533365">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533377">config</span><span class="op" id="6533383">.</span><span class="ident" id="6533384">CipherSuites</span>&nbsp;<span class="op" id="6533397">=</span>&nbsp;<span class="op" id="6533399">[</span><span class="op" id="6533400">]</span><span class="builtintype" id="6533401">uint16</span><span class="op" id="6533407">{</span><span class="ident" id="6533408">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6533444">,</span>&nbsp;<span class="ident" id="6533446">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6533480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533483">config</span><span class="op" id="6533489">.</span><span class="ident" id="6533490">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6533515">=</span>&nbsp;<span class="builtintype" id="6533517">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533524">test</span>&nbsp;<span class="op" id="6533529">:=</span>&nbsp;<span class="op" id="6533532">&amp;</span><span class="ident" id="6533533">serverTest</span><span class="op" id="6533543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533547">name</span><span class="op" id="6533551">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6533555">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="6533585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533589">config</span><span class="op" id="6533595">:</span>&nbsp;<span class="op" id="6533597">&amp;</span><span class="ident" id="6533598">config</span><span class="op" id="6533604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533607">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533610">runServerTestTLS12</span><span class="op" id="6533628">(</span><span class="ident" id="6533629">t</span><span class="op" id="6533630">,</span>&nbsp;<span class="ident" id="6533632">test</span><span class="op" id="6533636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533640">config</span>&nbsp;<span class="op" id="6533647">=</span>&nbsp;<span class="op" id="6533649">*</span><span class="ident" id="6533650">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533662">config</span><span class="op" id="6533668">.</span><span class="ident" id="6533669">CipherSuites</span>&nbsp;<span class="op" id="6533682">=</span>&nbsp;<span class="op" id="6533684">[</span><span class="op" id="6533685">]</span><span class="builtintype" id="6533686">uint16</span><span class="op" id="6533692">{</span><span class="ident" id="6533693">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6533727">,</span>&nbsp;<span class="ident" id="6533729">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6533765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533768">config</span><span class="op" id="6533774">.</span><span class="ident" id="6533775">Certificates</span>&nbsp;<span class="op" id="6533788">=</span>&nbsp;<span class="op" id="6533790">[</span><span class="op" id="6533791">]</span><span class="ident" id="6533792">Certificate</span><span class="op" id="6533803">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533812">Certificate</span><span class="op" id="6533823">:</span>&nbsp;<span class="op" id="6533825">[</span><span class="op" id="6533826">]</span><span class="op" id="6533827">[</span><span class="op" id="6533828">]</span><span class="builtintype" id="6533829">byte</span><span class="op" id="6533833">{</span><span class="ident" id="6533834">testECDSACertificate</span><span class="op" id="6533854">}</span><span class="op" id="6533855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533860">PrivateKey</span><span class="op" id="6533870">:</span>&nbsp;&nbsp;<span class="ident" id="6533873">testECDSAPrivateKey</span><span class="op" id="6533892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533896">}</span><span class="op" id="6533897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533900">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533903">config</span><span class="op" id="6533909">.</span><span class="ident" id="6533910">BuildNameToCertificate</span><span class="op" id="6533932">(</span><span class="op" id="6533933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533936">config</span><span class="op" id="6533942">.</span><span class="ident" id="6533943">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6533968">=</span>&nbsp;<span class="builtintype" id="6533970">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533977">test</span>&nbsp;<span class="op" id="6533982">=</span>&nbsp;<span class="op" id="6533984">&amp;</span><span class="ident" id="6533985">serverTest</span><span class="op" id="6533995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6533999">name</span><span class="op" id="6534003">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6534007">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="6534039">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534043">config</span><span class="op" id="6534049">:</span>&nbsp;<span class="op" id="6534051">&amp;</span><span class="ident" id="6534052">config</span><span class="op" id="6534058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534064">runServerTestTLS12</span><span class="op" id="6534082">(</span><span class="ident" id="6534083">t</span><span class="op" id="6534084">,</span>&nbsp;<span class="ident" id="6534086">test</span><span class="op" id="6534090">)</span><br>
<span class="lineno"></span><span class="op" id="6534092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6534095">func</span>&nbsp;<span class="ident" id="6534100">TestResumption</span><span class="op" id="6534114">(</span><span class="ident" id="6534115">t</span>&nbsp;<span class="op" id="6534117">*</span><span class="ident" id="6534118">testing</span><span class="op" id="6534125">.</span><span class="ident" id="6534126">T</span><span class="op" id="6534127">)</span>&nbsp;<span class="op" id="6534129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534132">sessionFilePath</span>&nbsp;<span class="op" id="6534148">:=</span>&nbsp;<span class="ident" id="6534151">tempFile</span><span class="op" id="6534159">(</span><span class="string" id="6534160">&#34;&#34;</span><span class="op" id="6534162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534165">defer</span>&nbsp;<span class="ident" id="6534171">os</span><span class="op" id="6534173">.</span><span class="ident" id="6534174">Remove</span><span class="op" id="6534180">(</span><span class="ident" id="6534181">sessionFilePath</span><span class="op" id="6534196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534200">test</span>&nbsp;<span class="op" id="6534205">:=</span>&nbsp;<span class="op" id="6534208">&amp;</span><span class="ident" id="6534209">serverTest</span><span class="op" id="6534219">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534223">name</span><span class="op" id="6534227">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6534232">&#34;IssueTicket&#34;</span><span class="op" id="6534245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534249">command</span><span class="op" id="6534256">:</span>&nbsp;<span class="op" id="6534258">[</span><span class="op" id="6534259">]</span><span class="builtintype" id="6534260">string</span><span class="op" id="6534266">{</span><span class="string" id="6534267">&#34;openssl&#34;</span><span class="op" id="6534276">,</span>&nbsp;<span class="string" id="6534278">&#34;s_client&#34;</span><span class="op" id="6534288">,</span>&nbsp;<span class="string" id="6534290">&#34;-cipher&#34;</span><span class="op" id="6534299">,</span>&nbsp;<span class="string" id="6534301">&#34;RC4-SHA&#34;</span><span class="op" id="6534310">,</span>&nbsp;<span class="string" id="6534312">&#34;-sess_out&#34;</span><span class="op" id="6534323">,</span>&nbsp;<span class="ident" id="6534325">sessionFilePath</span><span class="op" id="6534340">}</span><span class="op" id="6534341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534347">runServerTestTLS12</span><span class="op" id="6534365">(</span><span class="ident" id="6534366">t</span><span class="op" id="6534367">,</span>&nbsp;<span class="ident" id="6534369">test</span><span class="op" id="6534373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534377">test</span>&nbsp;<span class="op" id="6534382">=</span>&nbsp;<span class="op" id="6534384">&amp;</span><span class="ident" id="6534385">serverTest</span><span class="op" id="6534395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534399">name</span><span class="op" id="6534403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6534408">&#34;Resume&#34;</span><span class="op" id="6534416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534420">command</span><span class="op" id="6534427">:</span>&nbsp;<span class="op" id="6534429">[</span><span class="op" id="6534430">]</span><span class="builtintype" id="6534431">string</span><span class="op" id="6534437">{</span><span class="string" id="6534438">&#34;openssl&#34;</span><span class="op" id="6534447">,</span>&nbsp;<span class="string" id="6534449">&#34;s_client&#34;</span><span class="op" id="6534459">,</span>&nbsp;<span class="string" id="6534461">&#34;-cipher&#34;</span><span class="op" id="6534470">,</span>&nbsp;<span class="string" id="6534472">&#34;RC4-SHA&#34;</span><span class="op" id="6534481">,</span>&nbsp;<span class="string" id="6534483">&#34;-sess_in&#34;</span><span class="op" id="6534493">,</span>&nbsp;<span class="ident" id="6534495">sessionFilePath</span><span class="op" id="6534510">}</span><span class="op" id="6534511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534517">runServerTestTLS12</span><span class="op" id="6534535">(</span><span class="ident" id="6534536">t</span><span class="op" id="6534537">,</span>&nbsp;<span class="ident" id="6534539">test</span><span class="op" id="6534543">)</span><br>
<span class="lineno">690</span><span class="op" id="6534545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534548">func</span>&nbsp;<span class="ident" id="6534553">TestResumptionDisabled</span><span class="op" id="6534575">(</span><span class="ident" id="6534576">t</span>&nbsp;<span class="op" id="6534578">*</span><span class="ident" id="6534579">testing</span><span class="op" id="6534586">.</span><span class="ident" id="6534587">T</span><span class="op" id="6534588">)</span>&nbsp;<span class="op" id="6534590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534593">sessionFilePath</span>&nbsp;<span class="op" id="6534609">:=</span>&nbsp;<span class="ident" id="6534612">tempFile</span><span class="op" id="6534620">(</span><span class="string" id="6534621">&#34;&#34;</span><span class="op" id="6534623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6534626">defer</span>&nbsp;<span class="ident" id="6534632">os</span><span class="op" id="6534634">.</span><span class="ident" id="6534635">Remove</span><span class="op" id="6534641">(</span><span class="ident" id="6534642">sessionFilePath</span><span class="op" id="6534657">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534661">config</span>&nbsp;<span class="op" id="6534668">:=</span>&nbsp;<span class="op" id="6534671">*</span><span class="ident" id="6534672">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534685">test</span>&nbsp;<span class="op" id="6534690">:=</span>&nbsp;<span class="op" id="6534693">&amp;</span><span class="ident" id="6534694">serverTest</span><span class="op" id="6534704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534708">name</span><span class="op" id="6534712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6534717">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="6534740">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534744">command</span><span class="op" id="6534751">:</span>&nbsp;<span class="op" id="6534753">[</span><span class="op" id="6534754">]</span><span class="builtintype" id="6534755">string</span><span class="op" id="6534761">{</span><span class="string" id="6534762">&#34;openssl&#34;</span><span class="op" id="6534771">,</span>&nbsp;<span class="string" id="6534773">&#34;s_client&#34;</span><span class="op" id="6534783">,</span>&nbsp;<span class="string" id="6534785">&#34;-cipher&#34;</span><span class="op" id="6534794">,</span>&nbsp;<span class="string" id="6534796">&#34;RC4-SHA&#34;</span><span class="op" id="6534805">,</span>&nbsp;<span class="string" id="6534807">&#34;-sess_out&#34;</span><span class="op" id="6534818">,</span>&nbsp;<span class="ident" id="6534820">sessionFilePath</span><span class="op" id="6534835">}</span><span class="op" id="6534836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534840">config</span><span class="op" id="6534846">:</span>&nbsp;&nbsp;<span class="op" id="6534849">&amp;</span><span class="ident" id="6534850">config</span><span class="op" id="6534856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6534859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534862">runServerTestTLS12</span><span class="op" id="6534880">(</span><span class="ident" id="6534881">t</span><span class="op" id="6534882">,</span>&nbsp;<span class="ident" id="6534884">test</span><span class="op" id="6534888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534892">config</span><span class="op" id="6534898">.</span><span class="ident" id="6534899">SessionTicketsDisabled</span>&nbsp;<span class="op" id="6534922">=</span>&nbsp;<span class="builtintype" id="6534924">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534931">test</span>&nbsp;<span class="op" id="6534936">=</span>&nbsp;<span class="op" id="6534938">&amp;</span><span class="ident" id="6534939">serverTest</span><span class="op" id="6534949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534953">name</span><span class="op" id="6534957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6534962">&#34;ResumeDisabled&#34;</span><span class="op" id="6534978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6534982">command</span><span class="op" id="6534989">:</span>&nbsp;<span class="op" id="6534991">[</span><span class="op" id="6534992">]</span><span class="builtintype" id="6534993">string</span><span class="op" id="6534999">{</span><span class="string" id="6535000">&#34;openssl&#34;</span><span class="op" id="6535009">,</span>&nbsp;<span class="string" id="6535011">&#34;s_client&#34;</span><span class="op" id="6535021">,</span>&nbsp;<span class="string" id="6535023">&#34;-cipher&#34;</span><span class="op" id="6535032">,</span>&nbsp;<span class="string" id="6535034">&#34;RC4-SHA&#34;</span><span class="op" id="6535043">,</span>&nbsp;<span class="string" id="6535045">&#34;-sess_in&#34;</span><span class="op" id="6535055">,</span>&nbsp;<span class="ident" id="6535057">sessionFilePath</span><span class="op" id="6535072">}</span><span class="op" id="6535073">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535077">config</span><span class="op" id="6535083">:</span>&nbsp;&nbsp;<span class="op" id="6535086">&amp;</span><span class="ident" id="6535087">config</span><span class="op" id="6535093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535099">runServerTestTLS12</span><span class="op" id="6535117">(</span><span class="ident" id="6535118">t</span><span class="op" id="6535119">,</span>&nbsp;<span class="ident" id="6535121">test</span><span class="op" id="6535125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6535129">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6535201">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="6535269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535272">func</span>&nbsp;<span class="ident" id="6535277">TestFallbackSCSV</span><span class="op" id="6535293">(</span><span class="ident" id="6535294">t</span>&nbsp;<span class="op" id="6535296">*</span><span class="ident" id="6535297">testing</span><span class="op" id="6535304">.</span><span class="ident" id="6535305">T</span><span class="op" id="6535306">)</span>&nbsp;<span class="op" id="6535308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535311">test</span>&nbsp;<span class="op" id="6535316">:=</span>&nbsp;<span class="op" id="6535319">&amp;</span><span class="ident" id="6535320">serverTest</span><span class="op" id="6535330">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535334">name</span><span class="op" id="6535338">:</span>&nbsp;<span class="string" id="6535340">&#34;FallbackSCSV&#34;</span><span class="op" id="6535354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6535358">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535419">command</span><span class="op" id="6535426">:</span>&nbsp;<span class="op" id="6535428">[</span><span class="op" id="6535429">]</span><span class="builtintype" id="6535430">string</span><span class="op" id="6535436">{</span><span class="string" id="6535437">&#34;openssl&#34;</span><span class="op" id="6535446">,</span>&nbsp;<span class="string" id="6535448">&#34;s_client&#34;</span><span class="op" id="6535458">,</span>&nbsp;<span class="string" id="6535460">&#34;-fallback_scsv&#34;</span><span class="op" id="6535476">}</span><span class="op" id="6535477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535481">expectHandshakeErrorIncluding</span><span class="op" id="6535510">:</span>&nbsp;<span class="string" id="6535512">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="6535544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6535547">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6535550">runServerTestTLS11</span><span class="op" id="6535568">(</span><span class="ident" id="6535569">t</span><span class="op" id="6535570">,</span>&nbsp;<span class="ident" id="6535572">test</span><span class="op" id="6535576">)</span><br>
<span class="lineno"></span><span class="op" id="6535578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6535581">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="6535642">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="6535704">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535740">const</span>&nbsp;<span class="ident" id="6535746">clientCertificatePEM</span>&nbsp;<span class="op" id="6535767">=</span>&nbsp;<span class="string" id="6535769">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6536502">const</span>&nbsp;<span class="ident" id="6536508">clientKeyPEM</span>&nbsp;<span class="op" id="6536521">=</span>&nbsp;<span class="string" id="6536523">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6537410">const</span>&nbsp;<span class="ident" id="6537416">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="6537442">=</span>&nbsp;<span class="string" id="6537444">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538197">const</span>&nbsp;<span class="ident" id="6538203">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="6538221">=</span>&nbsp;<span class="string" id="6538223">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="6538663">func</span>&nbsp;<span class="ident" id="6538668">TestClientAuth</span><span class="op" id="6538682">(</span><span class="ident" id="6538683">t</span>&nbsp;<span class="op" id="6538685">*</span><span class="ident" id="6538686">testing</span><span class="op" id="6538693">.</span><span class="ident" id="6538694">T</span><span class="op" id="6538695">)</span>&nbsp;<span class="op" id="6538697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6538700">var</span>&nbsp;<span class="ident" id="6538704">certPath</span><span class="op" id="6538712">,</span>&nbsp;<span class="ident" id="6538714">keyPath</span><span class="op" id="6538721">,</span>&nbsp;<span class="ident" id="6538723">ecdsaCertPath</span><span class="op" id="6538736">,</span>&nbsp;<span class="ident" id="6538738">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="6538751">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6538760">if</span>&nbsp;<span class="op" id="6538763">*</span><span class="ident" id="6538764">update</span>&nbsp;<span class="op" id="6538771">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6538775">certPath</span>&nbsp;<span class="op" id="6538784">=</span>&nbsp;<span class="ident" id="6538786">tempFile</span><span class="op" id="6538794">(</span><span class="ident" id="6538795">clientCertificatePEM</span><span class="op" id="6538815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6538819">defer</span>&nbsp;<span class="ident" id="6538825">os</span><span class="op" id="6538827">.</span><span class="ident" id="6538828">Remove</span><span class="op" id="6538834">(</span><span class="ident" id="6538835">certPath</span><span class="op" id="6538843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6538847">keyPath</span>&nbsp;<span class="op" id="6538855">=</span>&nbsp;<span class="ident" id="6538857">tempFile</span><span class="op" id="6538865">(</span><span class="ident" id="6538866">clientKeyPEM</span><span class="op" id="6538878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6538882">defer</span>&nbsp;<span class="ident" id="6538888">os</span><span class="op" id="6538890">.</span><span class="ident" id="6538891">Remove</span><span class="op" id="6538897">(</span><span class="ident" id="6538898">keyPath</span><span class="op" id="6538905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6538909">ecdsaCertPath</span>&nbsp;<span class="op" id="6538923">=</span>&nbsp;<span class="ident" id="6538925">tempFile</span><span class="op" id="6538933">(</span><span class="ident" id="6538934">clientECDSACertificatePEM</span><span class="op" id="6538959">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6538963">defer</span>&nbsp;<span class="ident" id="6538969">os</span><span class="op" id="6538971">.</span><span class="ident" id="6538972">Remove</span><span class="op" id="6538978">(</span><span class="ident" id="6538979">ecdsaCertPath</span><span class="op" id="6538992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6538996">ecdsaKeyPath</span>&nbsp;<span class="op" id="6539009">=</span>&nbsp;<span class="ident" id="6539011">tempFile</span><span class="op" id="6539019">(</span><span class="ident" id="6539020">clientECDSAKeyPEM</span><span class="op" id="6539037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6539041">defer</span>&nbsp;<span class="ident" id="6539047">os</span><span class="op" id="6539049">.</span><span class="ident" id="6539050">Remove</span><span class="op" id="6539056">(</span><span class="ident" id="6539057">ecdsaKeyPath</span><span class="op" id="6539069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539076">config</span>&nbsp;<span class="op" id="6539083">:=</span>&nbsp;<span class="op" id="6539086">*</span><span class="ident" id="6539087">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539099">config</span><span class="op" id="6539105">.</span><span class="ident" id="6539106">ClientAuth</span>&nbsp;<span class="op" id="6539117">=</span>&nbsp;<span class="ident" id="6539119">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539139">test</span>&nbsp;<span class="op" id="6539144">:=</span>&nbsp;<span class="op" id="6539147">&amp;</span><span class="ident" id="6539148">serverTest</span><span class="op" id="6539158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539162">name</span><span class="op" id="6539166">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6539171">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="6539200">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539204">command</span><span class="op" id="6539211">:</span>&nbsp;<span class="op" id="6539213">[</span><span class="op" id="6539214">]</span><span class="builtintype" id="6539215">string</span><span class="op" id="6539221">{</span><span class="string" id="6539222">&#34;openssl&#34;</span><span class="op" id="6539231">,</span>&nbsp;<span class="string" id="6539233">&#34;s_client&#34;</span><span class="op" id="6539243">,</span>&nbsp;<span class="string" id="6539245">&#34;-no_ticket&#34;</span><span class="op" id="6539257">,</span>&nbsp;<span class="string" id="6539259">&#34;-cipher&#34;</span><span class="op" id="6539268">,</span>&nbsp;<span class="string" id="6539270">&#34;RC4-SHA&#34;</span><span class="op" id="6539279">}</span><span class="op" id="6539280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539284">config</span><span class="op" id="6539290">:</span>&nbsp;&nbsp;<span class="op" id="6539293">&amp;</span><span class="ident" id="6539294">config</span><span class="op" id="6539300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539306">runServerTestTLS12</span><span class="op" id="6539324">(</span><span class="ident" id="6539325">t</span><span class="op" id="6539326">,</span>&nbsp;<span class="ident" id="6539328">test</span><span class="op" id="6539332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539336">test</span>&nbsp;<span class="op" id="6539341">=</span>&nbsp;<span class="op" id="6539343">&amp;</span><span class="ident" id="6539344">serverTest</span><span class="op" id="6539354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539358">name</span><span class="op" id="6539362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6539377">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="6539406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539410">command</span><span class="op" id="6539417">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539429">[</span><span class="op" id="6539430">]</span><span class="builtintype" id="6539431">string</span><span class="op" id="6539437">{</span><span class="string" id="6539438">&#34;openssl&#34;</span><span class="op" id="6539447">,</span>&nbsp;<span class="string" id="6539449">&#34;s_client&#34;</span><span class="op" id="6539459">,</span>&nbsp;<span class="string" id="6539461">&#34;-no_ticket&#34;</span><span class="op" id="6539473">,</span>&nbsp;<span class="string" id="6539475">&#34;-cipher&#34;</span><span class="op" id="6539484">,</span>&nbsp;<span class="string" id="6539486">&#34;RC4-SHA&#34;</span><span class="op" id="6539495">,</span>&nbsp;<span class="string" id="6539497">&#34;-cert&#34;</span><span class="op" id="6539504">,</span>&nbsp;<span class="ident" id="6539506">certPath</span><span class="op" id="6539514">,</span>&nbsp;<span class="string" id="6539516">&#34;-key&#34;</span><span class="op" id="6539522">,</span>&nbsp;<span class="ident" id="6539524">keyPath</span><span class="op" id="6539531">}</span><span class="op" id="6539532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539536">config</span><span class="op" id="6539542">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539555">&amp;</span><span class="ident" id="6539556">config</span><span class="op" id="6539562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539566">expectedPeerCerts</span><span class="op" id="6539583">:</span>&nbsp;<span class="op" id="6539585">[</span><span class="op" id="6539586">]</span><span class="builtintype" id="6539587">string</span><span class="op" id="6539593">{</span><span class="ident" id="6539594">clientCertificatePEM</span><span class="op" id="6539614">}</span><span class="op" id="6539615">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539621">runServerTestTLS12</span><span class="op" id="6539639">(</span><span class="ident" id="6539640">t</span><span class="op" id="6539641">,</span>&nbsp;<span class="ident" id="6539643">test</span><span class="op" id="6539647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539651">test</span>&nbsp;<span class="op" id="6539656">=</span>&nbsp;<span class="op" id="6539658">&amp;</span><span class="ident" id="6539659">serverTest</span><span class="op" id="6539669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539673">name</span><span class="op" id="6539677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6539692">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="6539726">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539730">command</span><span class="op" id="6539737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539749">[</span><span class="op" id="6539750">]</span><span class="builtintype" id="6539751">string</span><span class="op" id="6539757">{</span><span class="string" id="6539758">&#34;openssl&#34;</span><span class="op" id="6539767">,</span>&nbsp;<span class="string" id="6539769">&#34;s_client&#34;</span><span class="op" id="6539779">,</span>&nbsp;<span class="string" id="6539781">&#34;-no_ticket&#34;</span><span class="op" id="6539793">,</span>&nbsp;<span class="string" id="6539795">&#34;-cipher&#34;</span><span class="op" id="6539804">,</span>&nbsp;<span class="string" id="6539806">&#34;RC4-SHA&#34;</span><span class="op" id="6539815">,</span>&nbsp;<span class="string" id="6539817">&#34;-cert&#34;</span><span class="op" id="6539824">,</span>&nbsp;<span class="ident" id="6539826">ecdsaCertPath</span><span class="op" id="6539839">,</span>&nbsp;<span class="string" id="6539841">&#34;-key&#34;</span><span class="op" id="6539847">,</span>&nbsp;<span class="ident" id="6539849">ecdsaKeyPath</span><span class="op" id="6539861">}</span><span class="op" id="6539862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539866">config</span><span class="op" id="6539872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539885">&amp;</span><span class="ident" id="6539886">config</span><span class="op" id="6539892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539896">expectedPeerCerts</span><span class="op" id="6539913">:</span>&nbsp;<span class="op" id="6539915">[</span><span class="op" id="6539916">]</span><span class="builtintype" id="6539917">string</span><span class="op" id="6539923">{</span><span class="ident" id="6539924">clientECDSACertificatePEM</span><span class="op" id="6539949">}</span><span class="op" id="6539950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6539953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6539956">runServerTestTLS12</span><span class="op" id="6539974">(</span><span class="ident" id="6539975">t</span><span class="op" id="6539976">,</span>&nbsp;<span class="ident" id="6539978">test</span><span class="op" id="6539982">)</span><br>
<span class="lineno">830</span><span class="op" id="6539984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539987">func</span>&nbsp;<span class="ident" id="6539992">bigFromString</span><span class="op" id="6540005">(</span><span class="ident" id="6540006">s</span>&nbsp;<span class="builtintype" id="6540008">string</span><span class="op" id="6540014">)</span>&nbsp;<span class="op" id="6540016">*</span><span class="ident" id="6540017">big</span><span class="op" id="6540020">.</span><span class="ident" id="6540021">Int</span>&nbsp;<span class="op" id="6540025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6540028">ret</span>&nbsp;<span class="op" id="6540032">:=</span>&nbsp;<span class="builtinfunc" id="6540035">new</span><span class="op" id="6540038">(</span><span class="ident" id="6540039">big</span><span class="op" id="6540042">.</span><span class="ident" id="6540043">Int</span><span class="op" id="6540046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6540049">ret</span><span class="op" id="6540052">.</span><span class="ident" id="6540053">SetString</span><span class="op" id="6540062">(</span><span class="ident" id="6540063">s</span><span class="op" id="6540064">,</span>&nbsp;<span class="num" id="6540066">10</span><span class="op" id="6540068">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6540071">return</span>&nbsp;<span class="ident" id="6540078">ret</span><br>
<span class="lineno"></span><span class="op" id="6540082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6540085">func</span>&nbsp;<span class="ident" id="6540090">fromHex</span><span class="op" id="6540097">(</span><span class="ident" id="6540098">s</span>&nbsp;<span class="builtintype" id="6540100">string</span><span class="op" id="6540106">)</span>&nbsp;<span class="op" id="6540108">[</span><span class="op" id="6540109">]</span><span class="builtintype" id="6540110">byte</span>&nbsp;<span class="op" id="6540115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6540118">b</span><span class="op" id="6540119">,</span>&nbsp;<span class="ident" id="6540121">_</span>&nbsp;<span class="op" id="6540123">:=</span>&nbsp;<span class="ident" id="6540126">hex</span><span class="op" id="6540129">.</span><span class="ident" id="6540130">DecodeString</span><span class="op" id="6540142">(</span><span class="ident" id="6540143">s</span><span class="op" id="6540144">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6540147">return</span>&nbsp;<span class="ident" id="6540154">b</span><br>
<span class="lineno"></span><span class="op" id="6540156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6540159">var</span>&nbsp;<span class="ident" id="6540163">testRSACertificate</span>&nbsp;<span class="op" id="6540182">=</span>&nbsp;<span class="ident" id="6540184">fromHex</span><span class="op" id="6540191">(</span><span class="string" id="6540192">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="6541578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="6541581">var</span>&nbsp;<span class="ident" id="6541585">testECDSACertificate</span>&nbsp;<span class="op" id="6541606">=</span>&nbsp;<span class="ident" id="6541608">fromHex</span><span class="op" id="6541615">(</span><span class="string" id="6541616">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="6542650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6542653">var</span>&nbsp;<span class="ident" id="6542657">testSNICertificate</span>&nbsp;<span class="op" id="6542676">=</span>&nbsp;<span class="ident" id="6542678">fromHex</span><span class="op" id="6542685">(</span><span class="string" id="6542686">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="6543692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6543695">var</span>&nbsp;<span class="ident" id="6543699">testRSAPrivateKey</span>&nbsp;<span class="op" id="6543717">=</span>&nbsp;<span class="op" id="6543719">&amp;</span><span class="ident" id="6543720">rsa</span><span class="op" id="6543723">.</span><span class="ident" id="6543724">PrivateKey</span><span class="op" id="6543734">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6543737">PublicKey</span><span class="op" id="6543746">:</span>&nbsp;<span class="ident" id="6543748">rsa</span><span class="op" id="6543751">.</span><span class="ident" id="6543752">PublicKey</span><span class="op" id="6543761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6543765">N</span><span class="op" id="6543766">:</span>&nbsp;<span class="ident" id="6543768">bigFromString</span><span class="op" id="6543781">(</span><span class="string" id="6543782">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="6544093">)</span><span class="op" id="6544094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544098">E</span><span class="op" id="6544099">:</span>&nbsp;<span class="num" id="6544101">65537</span><span class="op" id="6544106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6544109">}</span><span class="op" id="6544110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544113">D</span><span class="op" id="6544114">:</span>&nbsp;<span class="ident" id="6544116">bigFromString</span><span class="op" id="6544129">(</span><span class="string" id="6544130">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="6544440">)</span><span class="op" id="6544441">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544444">Primes</span><span class="op" id="6544450">:</span>&nbsp;<span class="op" id="6544452">[</span><span class="op" id="6544453">]</span><span class="op" id="6544454">*</span><span class="ident" id="6544455">big</span><span class="op" id="6544458">.</span><span class="ident" id="6544459">Int</span><span class="op" id="6544462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544466">bigFromString</span><span class="op" id="6544479">(</span><span class="string" id="6544480">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="6544637">)</span><span class="op" id="6544638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544642">bigFromString</span><span class="op" id="6544655">(</span><span class="string" id="6544656">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="6544813">)</span><span class="op" id="6544814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6544817">}</span><span class="op" id="6544818">,</span><br>
<span class="lineno"></span><span class="op" id="6544820">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="6544823">var</span>&nbsp;<span class="ident" id="6544827">testECDSAPrivateKey</span>&nbsp;<span class="op" id="6544847">=</span>&nbsp;<span class="op" id="6544849">&amp;</span><span class="ident" id="6544850">ecdsa</span><span class="op" id="6544855">.</span><span class="ident" id="6544856">PrivateKey</span><span class="op" id="6544866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544869">PublicKey</span><span class="op" id="6544878">:</span>&nbsp;<span class="ident" id="6544880">ecdsa</span><span class="op" id="6544885">.</span><span class="ident" id="6544886">PublicKey</span><span class="op" id="6544895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544899">Curve</span><span class="op" id="6544904">:</span>&nbsp;<span class="ident" id="6544906">elliptic</span><span class="op" id="6544914">.</span><span class="ident" id="6544915">P521</span><span class="op" id="6544919">(</span><span class="op" id="6544920">)</span><span class="op" id="6544921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544925">X</span><span class="op" id="6544926">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6544932">bigFromString</span><span class="op" id="6544945">(</span><span class="string" id="6544946">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="6545105">)</span><span class="op" id="6545106">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6545110">Y</span><span class="op" id="6545111">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6545117">bigFromString</span><span class="op" id="6545130">(</span><span class="string" id="6545131">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="6545290">)</span><span class="op" id="6545291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6545294">}</span><span class="op" id="6545295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6545298">D</span><span class="op" id="6545299">:</span>&nbsp;<span class="ident" id="6545301">bigFromString</span><span class="op" id="6545314">(</span><span class="string" id="6545315">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="6545474">)</span><span class="op" id="6545475">,</span><br>
<span class="lineno"></span><span class="op" id="6545477">}</span>
</div>
</body>
</html>
