<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2168107">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2168162">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2168216">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2168267">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2168337">package</span>&nbsp;<span class="ident" id="2168345">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2168349">import</span>&nbsp;<span class="op" id="2168356">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2168359">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2168370">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2168385">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2168395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2168398">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2168442">type</span>&nbsp;<span class="ident" id="2168447">File</span>&nbsp;<span class="keyword" id="2168452">struct</span>&nbsp;<span class="op" id="2168459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2168462">*</span><span class="ident" id="2168463">file</span><br>
<span class="lineno"></span><span class="op" id="2168468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2168471">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2168516">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2168580">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2168640">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2168679">type</span>&nbsp;<span class="ident" id="2168684">file</span>&nbsp;<span class="keyword" id="2168689">struct</span>&nbsp;<span class="op" id="2168696">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2168699">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2168707">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2168712">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2168720">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2168728">dirinfo</span>&nbsp;<span class="op" id="2168736">*</span><span class="ident" id="2168737">dirInfo</span>&nbsp;<span class="comment" id="2168745">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2168781">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2168789">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2168798">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2168838">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2168841">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2168915">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2169003">func</span>&nbsp;<span class="op" id="2169008">(</span><span class="ident" id="2169009">f</span>&nbsp;<span class="op" id="2169011">*</span><span class="ident" id="2169012">File</span><span class="op" id="2169016">)</span>&nbsp;<span class="ident" id="2169018">Fd</span><span class="op" id="2169020">(</span><span class="op" id="2169021">)</span>&nbsp;<span class="builtintype" id="2169023">uintptr</span>&nbsp;<span class="op" id="2169031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169034">if</span>&nbsp;<span class="ident" id="2169037">f</span>&nbsp;<span class="op" id="2169039">==</span>&nbsp;<span class="ident" id="2169042">nil</span>&nbsp;<span class="op" id="2169046">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169050">return</span>&nbsp;<span class="op" id="2169057">^</span><span class="op" id="2169058">(</span><span class="builtintype" id="2169059">uintptr</span><span class="op" id="2169066">(</span><span class="num" id="2169067">0</span><span class="op" id="2169068">)</span><span class="op" id="2169069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2169072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169075">return</span>&nbsp;<span class="builtintype" id="2169082">uintptr</span><span class="op" id="2169089">(</span><span class="ident" id="2169090">f</span><span class="op" id="2169091">.</span><span class="ident" id="2169092">fd</span><span class="op" id="2169094">)</span><br>
<span class="lineno"></span><span class="op" id="2169096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2169099">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2169170">func</span>&nbsp;<span class="ident" id="2169175">NewFile</span><span class="op" id="2169182">(</span><span class="ident" id="2169183">fd</span>&nbsp;<span class="builtintype" id="2169186">uintptr</span><span class="op" id="2169193">,</span>&nbsp;<span class="ident" id="2169195">name</span>&nbsp;<span class="builtintype" id="2169200">string</span><span class="op" id="2169206">)</span>&nbsp;<span class="op" id="2169208">*</span><span class="ident" id="2169209">File</span>&nbsp;<span class="op" id="2169214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169217">fdi</span>&nbsp;<span class="op" id="2169221">:=</span>&nbsp;<span class="builtintype" id="2169224">int</span><span class="op" id="2169227">(</span><span class="ident" id="2169228">fd</span><span class="op" id="2169230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169233">if</span>&nbsp;<span class="ident" id="2169236">fdi</span>&nbsp;<span class="op" id="2169240">&lt;</span>&nbsp;<span class="num" id="2169242">0</span>&nbsp;<span class="op" id="2169244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169248">return</span>&nbsp;<span class="ident" id="2169255">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2169260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169263">f</span>&nbsp;<span class="op" id="2169265">:=</span>&nbsp;<span class="op" id="2169268">&amp;</span><span class="ident" id="2169269">File</span><span class="op" id="2169273">{</span><span class="op" id="2169274">&amp;</span><span class="ident" id="2169275">file</span><span class="op" id="2169279">{</span><span class="ident" id="2169280">fd</span><span class="op" id="2169282">:</span>&nbsp;<span class="ident" id="2169284">fdi</span><span class="op" id="2169287">,</span>&nbsp;<span class="ident" id="2169289">name</span><span class="op" id="2169293">:</span>&nbsp;<span class="ident" id="2169295">name</span><span class="op" id="2169299">}</span><span class="op" id="2169300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169303">runtime</span><span class="op" id="2169310">.</span><span class="ident" id="2169311">SetFinalizer</span><span class="op" id="2169323">(</span><span class="ident" id="2169324">f</span><span class="op" id="2169325">.</span><span class="ident" id="2169326">file</span><span class="op" id="2169330">,</span>&nbsp;<span class="op" id="2169332">(</span><span class="op" id="2169333">*</span><span class="ident" id="2169334">file</span><span class="op" id="2169338">)</span><span class="op" id="2169339">.</span><span class="builtinfunc" id="2169340">close</span><span class="op" id="2169345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169348">return</span>&nbsp;<span class="ident" id="2169355">f</span><br>
<span class="lineno"></span><span class="op" id="2169357">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2169360">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2169419">type</span>&nbsp;<span class="ident" id="2169424">dirInfo</span>&nbsp;<span class="keyword" id="2169432">struct</span>&nbsp;<span class="op" id="2169439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169442">buf</span>&nbsp;&nbsp;<span class="op" id="2169447">[</span><span class="op" id="2169448">]</span><span class="builtintype" id="2169449">byte</span>&nbsp;<span class="comment" id="2169454">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169483">nbuf</span>&nbsp;<span class="builtintype" id="2169488">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2169495">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169546">bufp</span>&nbsp;<span class="builtintype" id="2169551">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2169558">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2169593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2169596">func</span>&nbsp;<span class="ident" id="2169601">epipecheck</span><span class="op" id="2169611">(</span><span class="ident" id="2169612">file</span>&nbsp;<span class="op" id="2169617">*</span><span class="ident" id="2169618">File</span><span class="op" id="2169622">,</span>&nbsp;<span class="ident" id="2169624">e</span>&nbsp;<span class="builtintype" id="2169626">error</span><span class="op" id="2169631">)</span>&nbsp;<span class="op" id="2169633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169636">if</span>&nbsp;<span class="ident" id="2169639">e</span>&nbsp;<span class="op" id="2169641">==</span>&nbsp;<span class="ident" id="2169644">syscall</span><span class="op" id="2169651">.</span><span class="ident" id="2169652">EPIPE</span>&nbsp;<span class="op" id="2169658">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2169662">if</span>&nbsp;<span class="ident" id="2169665">atomic</span><span class="op" id="2169671">.</span><span class="ident" id="2169672">AddInt32</span><span class="op" id="2169680">(</span><span class="op" id="2169681">&amp;</span><span class="ident" id="2169682">file</span><span class="op" id="2169686">.</span><span class="ident" id="2169687">nepipe</span><span class="op" id="2169693">,</span>&nbsp;<span class="num" id="2169695">1</span><span class="op" id="2169696">)</span>&nbsp;<span class="op" id="2169698">&gt;=</span>&nbsp;<span class="num" id="2169701">10</span>&nbsp;<span class="op" id="2169704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169709">sigpipe</span><span class="op" id="2169716">(</span><span class="op" id="2169717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2169721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2169724">}</span>&nbsp;<span class="keyword" id="2169726">else</span>&nbsp;<span class="op" id="2169731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2169735">atomic</span><span class="op" id="2169741">.</span><span class="ident" id="2169742">StoreInt32</span><span class="op" id="2169752">(</span><span class="op" id="2169753">&amp;</span><span class="ident" id="2169754">file</span><span class="op" id="2169758">.</span><span class="ident" id="2169759">nepipe</span><span class="op" id="2169765">,</span>&nbsp;<span class="num" id="2169767">0</span><span class="op" id="2169768">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2169771">}</span><br>
<span class="lineno"></span><span class="op" id="2169773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2169776">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2169842">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2169905">const</span>&nbsp;<span class="ident" id="2169911">DevNull</span>&nbsp;<span class="op" id="2169919">=</span>&nbsp;<span class="string" id="2169921">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2169934">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2170001">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2170068">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2170140">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2170193">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2170249">func</span>&nbsp;<span class="ident" id="2170254">OpenFile</span><span class="op" id="2170262">(</span><span class="ident" id="2170263">name</span>&nbsp;<span class="builtintype" id="2170268">string</span><span class="op" id="2170274">,</span>&nbsp;<span class="ident" id="2170276">flag</span>&nbsp;<span class="builtintype" id="2170281">int</span><span class="op" id="2170284">,</span>&nbsp;<span class="ident" id="2170286">perm</span>&nbsp;<span class="ident" id="2170291">FileMode</span><span class="op" id="2170299">)</span>&nbsp;<span class="op" id="2170301">(</span><span class="ident" id="2170302">file</span>&nbsp;<span class="op" id="2170307">*</span><span class="ident" id="2170308">File</span><span class="op" id="2170312">,</span>&nbsp;<span class="ident" id="2170314">err</span>&nbsp;<span class="builtintype" id="2170318">error</span><span class="op" id="2170323">)</span>&nbsp;<span class="op" id="2170325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2170328">r</span><span class="op" id="2170329">,</span>&nbsp;<span class="ident" id="2170331">e</span>&nbsp;<span class="op" id="2170333">:=</span>&nbsp;<span class="ident" id="2170336">syscall</span><span class="op" id="2170343">.</span><span class="ident" id="2170344">Open</span><span class="op" id="2170348">(</span><span class="ident" id="2170349">name</span><span class="op" id="2170353">,</span>&nbsp;<span class="ident" id="2170355">flag</span><span class="op" id="2170359">|</span><span class="ident" id="2170360">syscall</span><span class="op" id="2170367">.</span><span class="ident" id="2170368">O_CLOEXEC</span><span class="op" id="2170377">,</span>&nbsp;<span class="ident" id="2170379">syscallMode</span><span class="op" id="2170390">(</span><span class="ident" id="2170391">perm</span><span class="op" id="2170395">)</span><span class="op" id="2170396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170399">if</span>&nbsp;<span class="ident" id="2170402">e</span>&nbsp;<span class="op" id="2170404">!=</span>&nbsp;<span class="ident" id="2170407">nil</span>&nbsp;<span class="op" id="2170411">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170415">return</span>&nbsp;<span class="ident" id="2170422">nil</span><span class="op" id="2170425">,</span>&nbsp;<span class="op" id="2170427">&amp;</span><span class="ident" id="2170428">PathError</span><span class="op" id="2170437">{</span><span class="string" id="2170438">&#34;open&#34;</span><span class="op" id="2170444">,</span>&nbsp;<span class="ident" id="2170446">name</span><span class="op" id="2170450">,</span>&nbsp;<span class="ident" id="2170452">e</span><span class="op" id="2170453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2170456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2170460">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2170513">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170569">if</span>&nbsp;<span class="op" id="2170572">!</span><span class="ident" id="2170573">supportsCloseOnExec</span>&nbsp;<span class="op" id="2170593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2170597">syscall</span><span class="op" id="2170604">.</span><span class="ident" id="2170605">CloseOnExec</span><span class="op" id="2170616">(</span><span class="ident" id="2170617">r</span><span class="op" id="2170618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2170621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170625">return</span>&nbsp;<span class="ident" id="2170632">NewFile</span><span class="op" id="2170639">(</span><span class="builtintype" id="2170640">uintptr</span><span class="op" id="2170647">(</span><span class="ident" id="2170648">r</span><span class="op" id="2170649">)</span><span class="op" id="2170650">,</span>&nbsp;<span class="ident" id="2170652">name</span><span class="op" id="2170656">)</span><span class="op" id="2170657">,</span>&nbsp;<span class="ident" id="2170659">nil</span><br>
<span class="lineno">90</span><span class="op" id="2170663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2170666">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2170723">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2170755">func</span>&nbsp;<span class="op" id="2170760">(</span><span class="ident" id="2170761">f</span>&nbsp;<span class="op" id="2170763">*</span><span class="ident" id="2170764">File</span><span class="op" id="2170768">)</span>&nbsp;<span class="ident" id="2170770">Close</span><span class="op" id="2170775">(</span><span class="op" id="2170776">)</span>&nbsp;<span class="builtintype" id="2170778">error</span>&nbsp;<span class="op" id="2170784">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170787">if</span>&nbsp;<span class="ident" id="2170790">f</span>&nbsp;<span class="op" id="2170792">==</span>&nbsp;<span class="ident" id="2170795">nil</span>&nbsp;<span class="op" id="2170799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170803">return</span>&nbsp;<span class="ident" id="2170810">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2170822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170825">return</span>&nbsp;<span class="ident" id="2170832">f</span><span class="op" id="2170833">.</span><span class="ident" id="2170834">file</span><span class="op" id="2170838">.</span><span class="builtinfunc" id="2170839">close</span><span class="op" id="2170844">(</span><span class="op" id="2170845">)</span><br>
<span class="lineno"></span><span class="op" id="2170847">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2170850">func</span>&nbsp;<span class="op" id="2170855">(</span><span class="ident" id="2170856">file</span>&nbsp;<span class="op" id="2170861">*</span><span class="ident" id="2170862">file</span><span class="op" id="2170866">)</span>&nbsp;<span class="builtinfunc" id="2170868">close</span><span class="op" id="2170873">(</span><span class="op" id="2170874">)</span>&nbsp;<span class="builtintype" id="2170876">error</span>&nbsp;<span class="op" id="2170882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170885">if</span>&nbsp;<span class="ident" id="2170888">file</span>&nbsp;<span class="op" id="2170893">==</span>&nbsp;<span class="ident" id="2170896">nil</span>&nbsp;<span class="op" id="2170900">||</span>&nbsp;<span class="ident" id="2170903">file</span><span class="op" id="2170907">.</span><span class="ident" id="2170908">fd</span>&nbsp;<span class="op" id="2170911">&lt;</span>&nbsp;<span class="num" id="2170913">0</span>&nbsp;<span class="op" id="2170915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170919">return</span>&nbsp;<span class="ident" id="2170926">syscall</span><span class="op" id="2170933">.</span><span class="ident" id="2170934">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2170942">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170945">var</span>&nbsp;<span class="ident" id="2170949">err</span>&nbsp;<span class="builtintype" id="2170953">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2170960">if</span>&nbsp;<span class="ident" id="2170963">e</span>&nbsp;<span class="op" id="2170965">:=</span>&nbsp;<span class="ident" id="2170968">syscall</span><span class="op" id="2170975">.</span><span class="ident" id="2170976">Close</span><span class="op" id="2170981">(</span><span class="ident" id="2170982">file</span><span class="op" id="2170986">.</span><span class="ident" id="2170987">fd</span><span class="op" id="2170989">)</span><span class="op" id="2170990">;</span>&nbsp;<span class="ident" id="2170992">e</span>&nbsp;<span class="op" id="2170994">!=</span>&nbsp;<span class="ident" id="2170997">nil</span>&nbsp;<span class="op" id="2171001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171005">err</span>&nbsp;<span class="op" id="2171009">=</span>&nbsp;<span class="op" id="2171011">&amp;</span><span class="ident" id="2171012">PathError</span><span class="op" id="2171021">{</span><span class="string" id="2171022">&#34;close&#34;</span><span class="op" id="2171029">,</span>&nbsp;<span class="ident" id="2171031">file</span><span class="op" id="2171035">.</span><span class="ident" id="2171036">name</span><span class="op" id="2171040">,</span>&nbsp;<span class="ident" id="2171042">e</span><span class="op" id="2171043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2171046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171049">file</span><span class="op" id="2171053">.</span><span class="ident" id="2171054">fd</span>&nbsp;<span class="op" id="2171057">=</span>&nbsp;<span class="op" id="2171059">-</span><span class="num" id="2171060">1</span>&nbsp;<span class="comment" id="2171062">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2171095">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171131">runtime</span><span class="op" id="2171138">.</span><span class="ident" id="2171139">SetFinalizer</span><span class="op" id="2171151">(</span><span class="ident" id="2171152">file</span><span class="op" id="2171156">,</span>&nbsp;<span class="ident" id="2171158">nil</span><span class="op" id="2171161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171164">return</span>&nbsp;<span class="ident" id="2171171">err</span><br>
<span class="lineno"></span><span class="op" id="2171175">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2171178">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2171234">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2171290">func</span>&nbsp;<span class="op" id="2171295">(</span><span class="ident" id="2171296">f</span>&nbsp;<span class="op" id="2171298">*</span><span class="ident" id="2171299">File</span><span class="op" id="2171303">)</span>&nbsp;<span class="ident" id="2171305">Stat</span><span class="op" id="2171309">(</span><span class="op" id="2171310">)</span>&nbsp;<span class="op" id="2171312">(</span><span class="ident" id="2171313">fi</span>&nbsp;<span class="ident" id="2171316">FileInfo</span><span class="op" id="2171324">,</span>&nbsp;<span class="ident" id="2171326">err</span>&nbsp;<span class="builtintype" id="2171330">error</span><span class="op" id="2171335">)</span>&nbsp;<span class="op" id="2171337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171340">if</span>&nbsp;<span class="ident" id="2171343">f</span>&nbsp;<span class="op" id="2171345">==</span>&nbsp;<span class="ident" id="2171348">nil</span>&nbsp;<span class="op" id="2171352">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171356">return</span>&nbsp;<span class="ident" id="2171363">nil</span><span class="op" id="2171366">,</span>&nbsp;<span class="ident" id="2171368">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2171380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171383">var</span>&nbsp;<span class="ident" id="2171387">stat</span>&nbsp;<span class="ident" id="2171392">syscall</span><span class="op" id="2171399">.</span><span class="ident" id="2171400">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171408">err</span>&nbsp;<span class="op" id="2171412">=</span>&nbsp;<span class="ident" id="2171414">syscall</span><span class="op" id="2171421">.</span><span class="ident" id="2171422">Fstat</span><span class="op" id="2171427">(</span><span class="ident" id="2171428">f</span><span class="op" id="2171429">.</span><span class="ident" id="2171430">fd</span><span class="op" id="2171432">,</span>&nbsp;<span class="op" id="2171434">&amp;</span><span class="ident" id="2171435">stat</span><span class="op" id="2171439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171442">if</span>&nbsp;<span class="ident" id="2171445">err</span>&nbsp;<span class="op" id="2171449">!=</span>&nbsp;<span class="ident" id="2171452">nil</span>&nbsp;<span class="op" id="2171456">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171460">return</span>&nbsp;<span class="ident" id="2171467">nil</span><span class="op" id="2171470">,</span>&nbsp;<span class="op" id="2171472">&amp;</span><span class="ident" id="2171473">PathError</span><span class="op" id="2171482">{</span><span class="string" id="2171483">&#34;stat&#34;</span><span class="op" id="2171489">,</span>&nbsp;<span class="ident" id="2171491">f</span><span class="op" id="2171492">.</span><span class="ident" id="2171493">name</span><span class="op" id="2171497">,</span>&nbsp;<span class="ident" id="2171499">err</span><span class="op" id="2171502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2171505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171508">return</span>&nbsp;<span class="ident" id="2171515">fileInfoFromStat</span><span class="op" id="2171531">(</span><span class="op" id="2171532">&amp;</span><span class="ident" id="2171533">stat</span><span class="op" id="2171537">,</span>&nbsp;<span class="ident" id="2171539">f</span><span class="op" id="2171540">.</span><span class="ident" id="2171541">name</span><span class="op" id="2171545">)</span><span class="op" id="2171546">,</span>&nbsp;<span class="ident" id="2171548">nil</span><br>
<span class="lineno"></span><span class="op" id="2171552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2171555">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2171609">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2171665">func</span>&nbsp;<span class="ident" id="2171670">Stat</span><span class="op" id="2171674">(</span><span class="ident" id="2171675">name</span>&nbsp;<span class="builtintype" id="2171680">string</span><span class="op" id="2171686">)</span>&nbsp;<span class="op" id="2171688">(</span><span class="ident" id="2171689">fi</span>&nbsp;<span class="ident" id="2171692">FileInfo</span><span class="op" id="2171700">,</span>&nbsp;<span class="ident" id="2171702">err</span>&nbsp;<span class="builtintype" id="2171706">error</span><span class="op" id="2171711">)</span>&nbsp;<span class="op" id="2171713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171716">var</span>&nbsp;<span class="ident" id="2171720">stat</span>&nbsp;<span class="ident" id="2171725">syscall</span><span class="op" id="2171732">.</span><span class="ident" id="2171733">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171741">err</span>&nbsp;<span class="op" id="2171745">=</span>&nbsp;<span class="ident" id="2171747">syscall</span><span class="op" id="2171754">.</span><span class="ident" id="2171755">Stat</span><span class="op" id="2171759">(</span><span class="ident" id="2171760">name</span><span class="op" id="2171764">,</span>&nbsp;<span class="op" id="2171766">&amp;</span><span class="ident" id="2171767">stat</span><span class="op" id="2171771">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171774">if</span>&nbsp;<span class="ident" id="2171777">err</span>&nbsp;<span class="op" id="2171781">!=</span>&nbsp;<span class="ident" id="2171784">nil</span>&nbsp;<span class="op" id="2171788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171792">return</span>&nbsp;<span class="ident" id="2171799">nil</span><span class="op" id="2171802">,</span>&nbsp;<span class="op" id="2171804">&amp;</span><span class="ident" id="2171805">PathError</span><span class="op" id="2171814">{</span><span class="string" id="2171815">&#34;stat&#34;</span><span class="op" id="2171821">,</span>&nbsp;<span class="ident" id="2171823">name</span><span class="op" id="2171827">,</span>&nbsp;<span class="ident" id="2171829">err</span><span class="op" id="2171832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2171835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171838">return</span>&nbsp;<span class="ident" id="2171845">fileInfoFromStat</span><span class="op" id="2171861">(</span><span class="op" id="2171862">&amp;</span><span class="ident" id="2171863">stat</span><span class="op" id="2171867">,</span>&nbsp;<span class="ident" id="2171869">name</span><span class="op" id="2171873">)</span><span class="op" id="2171874">,</span>&nbsp;<span class="ident" id="2171876">nil</span><br>
<span class="lineno"></span><span class="op" id="2171880">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2171883">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2171938">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2171995">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2172071">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2172127">func</span>&nbsp;<span class="ident" id="2172132">Lstat</span><span class="op" id="2172137">(</span><span class="ident" id="2172138">name</span>&nbsp;<span class="builtintype" id="2172143">string</span><span class="op" id="2172149">)</span>&nbsp;<span class="op" id="2172151">(</span><span class="ident" id="2172152">fi</span>&nbsp;<span class="ident" id="2172155">FileInfo</span><span class="op" id="2172163">,</span>&nbsp;<span class="ident" id="2172165">err</span>&nbsp;<span class="builtintype" id="2172169">error</span><span class="op" id="2172174">)</span>&nbsp;<span class="op" id="2172176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172179">var</span>&nbsp;<span class="ident" id="2172183">stat</span>&nbsp;<span class="ident" id="2172188">syscall</span><span class="op" id="2172195">.</span><span class="ident" id="2172196">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172204">err</span>&nbsp;<span class="op" id="2172208">=</span>&nbsp;<span class="ident" id="2172210">syscall</span><span class="op" id="2172217">.</span><span class="ident" id="2172218">Lstat</span><span class="op" id="2172223">(</span><span class="ident" id="2172224">name</span><span class="op" id="2172228">,</span>&nbsp;<span class="op" id="2172230">&amp;</span><span class="ident" id="2172231">stat</span><span class="op" id="2172235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172238">if</span>&nbsp;<span class="ident" id="2172241">err</span>&nbsp;<span class="op" id="2172245">!=</span>&nbsp;<span class="ident" id="2172248">nil</span>&nbsp;<span class="op" id="2172252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172256">return</span>&nbsp;<span class="ident" id="2172263">nil</span><span class="op" id="2172266">,</span>&nbsp;<span class="op" id="2172268">&amp;</span><span class="ident" id="2172269">PathError</span><span class="op" id="2172278">{</span><span class="string" id="2172279">&#34;lstat&#34;</span><span class="op" id="2172286">,</span>&nbsp;<span class="ident" id="2172288">name</span><span class="op" id="2172292">,</span>&nbsp;<span class="ident" id="2172294">err</span><span class="op" id="2172297">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172303">return</span>&nbsp;<span class="ident" id="2172310">fileInfoFromStat</span><span class="op" id="2172326">(</span><span class="op" id="2172327">&amp;</span><span class="ident" id="2172328">stat</span><span class="op" id="2172332">,</span>&nbsp;<span class="ident" id="2172334">name</span><span class="op" id="2172338">)</span><span class="op" id="2172339">,</span>&nbsp;<span class="ident" id="2172341">nil</span><br>
<span class="lineno"></span><span class="op" id="2172345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2172348">func</span>&nbsp;<span class="op" id="2172353">(</span><span class="ident" id="2172354">f</span>&nbsp;<span class="op" id="2172356">*</span><span class="ident" id="2172357">File</span><span class="op" id="2172361">)</span>&nbsp;<span class="ident" id="2172363">readdir</span><span class="op" id="2172370">(</span><span class="ident" id="2172371">n</span>&nbsp;<span class="builtintype" id="2172373">int</span><span class="op" id="2172376">)</span>&nbsp;<span class="op" id="2172378">(</span><span class="ident" id="2172379">fi</span>&nbsp;<span class="op" id="2172382">[</span><span class="op" id="2172383">]</span><span class="ident" id="2172384">FileInfo</span><span class="op" id="2172392">,</span>&nbsp;<span class="ident" id="2172394">err</span>&nbsp;<span class="builtintype" id="2172398">error</span><span class="op" id="2172403">)</span>&nbsp;<span class="op" id="2172405">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172408">dirname</span>&nbsp;<span class="op" id="2172416">:=</span>&nbsp;<span class="ident" id="2172419">f</span><span class="op" id="2172420">.</span><span class="ident" id="2172421">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172427">if</span>&nbsp;<span class="ident" id="2172430">dirname</span>&nbsp;<span class="op" id="2172438">==</span>&nbsp;<span class="string" id="2172441">&#34;&#34;</span>&nbsp;<span class="op" id="2172444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172448">dirname</span>&nbsp;<span class="op" id="2172456">=</span>&nbsp;<span class="string" id="2172458">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172466">names</span><span class="op" id="2172471">,</span>&nbsp;<span class="ident" id="2172473">err</span>&nbsp;<span class="op" id="2172477">:=</span>&nbsp;<span class="ident" id="2172480">f</span><span class="op" id="2172481">.</span><span class="ident" id="2172482">Readdirnames</span><span class="op" id="2172494">(</span><span class="ident" id="2172495">n</span><span class="op" id="2172496">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172499">fi</span>&nbsp;<span class="op" id="2172502">=</span>&nbsp;<span class="builtinfunc" id="2172504">make</span><span class="op" id="2172508">(</span><span class="op" id="2172509">[</span><span class="op" id="2172510">]</span><span class="ident" id="2172511">FileInfo</span><span class="op" id="2172519">,</span>&nbsp;<span class="num" id="2172521">0</span><span class="op" id="2172522">,</span>&nbsp;<span class="builtinfunc" id="2172524">len</span><span class="op" id="2172527">(</span><span class="ident" id="2172528">names</span><span class="op" id="2172533">)</span><span class="op" id="2172534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172537">for</span>&nbsp;<span class="ident" id="2172541">_</span><span class="op" id="2172542">,</span>&nbsp;<span class="ident" id="2172544">filename</span>&nbsp;<span class="op" id="2172553">:=</span>&nbsp;<span class="keyword" id="2172556">range</span>&nbsp;<span class="ident" id="2172562">names</span>&nbsp;<span class="op" id="2172568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172572">fip</span><span class="op" id="2172575">,</span>&nbsp;<span class="ident" id="2172577">lerr</span>&nbsp;<span class="op" id="2172582">:=</span>&nbsp;<span class="ident" id="2172585">lstat</span><span class="op" id="2172590">(</span><span class="ident" id="2172591">dirname</span>&nbsp;<span class="op" id="2172599">+</span>&nbsp;<span class="string" id="2172601">&#34;/&#34;</span>&nbsp;<span class="op" id="2172605">+</span>&nbsp;<span class="ident" id="2172607">filename</span><span class="op" id="2172615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172619">if</span>&nbsp;<span class="ident" id="2172622">IsNotExist</span><span class="op" id="2172632">(</span><span class="ident" id="2172633">lerr</span><span class="op" id="2172637">)</span>&nbsp;<span class="op" id="2172639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2172644">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2172691">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172734">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172749">if</span>&nbsp;<span class="ident" id="2172752">lerr</span>&nbsp;<span class="op" id="2172757">!=</span>&nbsp;<span class="ident" id="2172760">nil</span>&nbsp;<span class="op" id="2172764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172769">return</span>&nbsp;<span class="ident" id="2172776">fi</span><span class="op" id="2172778">,</span>&nbsp;<span class="ident" id="2172780">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172791">fi</span>&nbsp;<span class="op" id="2172794">=</span>&nbsp;<span class="builtinfunc" id="2172796">append</span><span class="op" id="2172802">(</span><span class="ident" id="2172803">fi</span><span class="op" id="2172805">,</span>&nbsp;<span class="ident" id="2172807">fip</span><span class="op" id="2172810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172816">return</span>&nbsp;<span class="ident" id="2172823">fi</span><span class="op" id="2172825">,</span>&nbsp;<span class="ident" id="2172827">err</span><br>
<span class="lineno"></span><span class="op" id="2172831">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2172834">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2172892">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2172946">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2173000">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2173018">const</span>&nbsp;<span class="op" id="2173024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173027">needsMaxRW</span>&nbsp;<span class="op" id="2173038">=</span>&nbsp;<span class="ident" id="2173040">runtime</span><span class="op" id="2173047">.</span><span class="ident" id="2173048">GOOS</span>&nbsp;<span class="op" id="2173053">==</span>&nbsp;<span class="string" id="2173056">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2173065">||</span>&nbsp;<span class="ident" id="2173068">runtime</span><span class="op" id="2173075">.</span><span class="ident" id="2173076">GOOS</span>&nbsp;<span class="op" id="2173081">==</span>&nbsp;<span class="string" id="2173084">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173095">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2173106">=</span>&nbsp;<span class="num" id="2173108">1</span>&nbsp;<span class="op" id="2173110">&lt;&lt;</span>&nbsp;<span class="num" id="2173113">30</span><br>
<span class="lineno"></span><span class="op" id="2173116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2173119">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2173167">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2173228">func</span>&nbsp;<span class="op" id="2173233">(</span><span class="ident" id="2173234">f</span>&nbsp;<span class="op" id="2173236">*</span><span class="ident" id="2173237">File</span><span class="op" id="2173241">)</span>&nbsp;<span class="ident" id="2173243">read</span><span class="op" id="2173247">(</span><span class="ident" id="2173248">b</span>&nbsp;<span class="op" id="2173250">[</span><span class="op" id="2173251">]</span><span class="builtintype" id="2173252">byte</span><span class="op" id="2173256">)</span>&nbsp;<span class="op" id="2173258">(</span><span class="ident" id="2173259">n</span>&nbsp;<span class="builtintype" id="2173261">int</span><span class="op" id="2173264">,</span>&nbsp;<span class="ident" id="2173266">err</span>&nbsp;<span class="builtintype" id="2173270">error</span><span class="op" id="2173275">)</span>&nbsp;<span class="op" id="2173277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173280">if</span>&nbsp;<span class="ident" id="2173283">needsMaxRW</span>&nbsp;<span class="op" id="2173294">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2173297">len</span><span class="op" id="2173300">(</span><span class="ident" id="2173301">b</span><span class="op" id="2173302">)</span>&nbsp;<span class="op" id="2173304">&gt;</span>&nbsp;<span class="ident" id="2173306">maxRW</span>&nbsp;<span class="op" id="2173312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173316">b</span>&nbsp;<span class="op" id="2173318">=</span>&nbsp;<span class="ident" id="2173320">b</span><span class="op" id="2173321">[</span><span class="op" id="2173322">:</span><span class="ident" id="2173323">maxRW</span><span class="op" id="2173328">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173334">return</span>&nbsp;<span class="ident" id="2173341">fixCount</span><span class="op" id="2173349">(</span><span class="ident" id="2173350">syscall</span><span class="op" id="2173357">.</span><span class="ident" id="2173358">Read</span><span class="op" id="2173362">(</span><span class="ident" id="2173363">f</span><span class="op" id="2173364">.</span><span class="ident" id="2173365">fd</span><span class="op" id="2173367">,</span>&nbsp;<span class="ident" id="2173369">b</span><span class="op" id="2173370">)</span><span class="op" id="2173371">)</span><br>
<span class="lineno"></span><span class="op" id="2173373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2173376">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2173447">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2173509">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2173565">func</span>&nbsp;<span class="op" id="2173570">(</span><span class="ident" id="2173571">f</span>&nbsp;<span class="op" id="2173573">*</span><span class="ident" id="2173574">File</span><span class="op" id="2173578">)</span>&nbsp;<span class="ident" id="2173580">pread</span><span class="op" id="2173585">(</span><span class="ident" id="2173586">b</span>&nbsp;<span class="op" id="2173588">[</span><span class="op" id="2173589">]</span><span class="builtintype" id="2173590">byte</span><span class="op" id="2173594">,</span>&nbsp;<span class="ident" id="2173596">off</span>&nbsp;<span class="ident" id="2173600">int64</span><span class="op" id="2173605">)</span>&nbsp;<span class="op" id="2173607">(</span><span class="ident" id="2173608">n</span>&nbsp;<span class="builtintype" id="2173610">int</span><span class="op" id="2173613">,</span>&nbsp;<span class="ident" id="2173615">err</span>&nbsp;<span class="builtintype" id="2173619">error</span><span class="op" id="2173624">)</span>&nbsp;<span class="op" id="2173626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173629">if</span>&nbsp;<span class="ident" id="2173632">needsMaxRW</span>&nbsp;<span class="op" id="2173643">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2173646">len</span><span class="op" id="2173649">(</span><span class="ident" id="2173650">b</span><span class="op" id="2173651">)</span>&nbsp;<span class="op" id="2173653">&gt;</span>&nbsp;<span class="ident" id="2173655">maxRW</span>&nbsp;<span class="op" id="2173661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173665">b</span>&nbsp;<span class="op" id="2173667">=</span>&nbsp;<span class="ident" id="2173669">b</span><span class="op" id="2173670">[</span><span class="op" id="2173671">:</span><span class="ident" id="2173672">maxRW</span><span class="op" id="2173677">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173683">return</span>&nbsp;<span class="ident" id="2173690">fixCount</span><span class="op" id="2173698">(</span><span class="ident" id="2173699">syscall</span><span class="op" id="2173706">.</span><span class="ident" id="2173707">Pread</span><span class="op" id="2173712">(</span><span class="ident" id="2173713">f</span><span class="op" id="2173714">.</span><span class="ident" id="2173715">fd</span><span class="op" id="2173717">,</span>&nbsp;<span class="ident" id="2173719">b</span><span class="op" id="2173720">,</span>&nbsp;<span class="ident" id="2173722">off</span><span class="op" id="2173725">)</span><span class="op" id="2173726">)</span><br>
<span class="lineno"></span><span class="op" id="2173728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2173731">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2173773">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2173837">func</span>&nbsp;<span class="op" id="2173842">(</span><span class="ident" id="2173843">f</span>&nbsp;<span class="op" id="2173845">*</span><span class="ident" id="2173846">File</span><span class="op" id="2173850">)</span>&nbsp;<span class="ident" id="2173852">write</span><span class="op" id="2173857">(</span><span class="ident" id="2173858">b</span>&nbsp;<span class="op" id="2173860">[</span><span class="op" id="2173861">]</span><span class="builtintype" id="2173862">byte</span><span class="op" id="2173866">)</span>&nbsp;<span class="op" id="2173868">(</span><span class="ident" id="2173869">n</span>&nbsp;<span class="builtintype" id="2173871">int</span><span class="op" id="2173874">,</span>&nbsp;<span class="ident" id="2173876">err</span>&nbsp;<span class="builtintype" id="2173880">error</span><span class="op" id="2173885">)</span>&nbsp;<span class="op" id="2173887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173890">for</span>&nbsp;<span class="op" id="2173894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173898">bcap</span>&nbsp;<span class="op" id="2173903">:=</span>&nbsp;<span class="ident" id="2173906">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173910">if</span>&nbsp;<span class="ident" id="2173913">needsMaxRW</span>&nbsp;<span class="op" id="2173924">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2173927">len</span><span class="op" id="2173930">(</span><span class="ident" id="2173931">bcap</span><span class="op" id="2173935">)</span>&nbsp;<span class="op" id="2173937">&gt;</span>&nbsp;<span class="ident" id="2173939">maxRW</span>&nbsp;<span class="op" id="2173945">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173950">bcap</span>&nbsp;<span class="op" id="2173955">=</span>&nbsp;<span class="ident" id="2173957">bcap</span><span class="op" id="2173961">[</span><span class="op" id="2173962">:</span><span class="ident" id="2173963">maxRW</span><span class="op" id="2173968">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173976">m</span><span class="op" id="2173977">,</span>&nbsp;<span class="ident" id="2173979">err</span>&nbsp;<span class="op" id="2173983">:=</span>&nbsp;<span class="ident" id="2173986">fixCount</span><span class="op" id="2173994">(</span><span class="ident" id="2173995">syscall</span><span class="op" id="2174002">.</span><span class="ident" id="2174003">Write</span><span class="op" id="2174008">(</span><span class="ident" id="2174009">f</span><span class="op" id="2174010">.</span><span class="ident" id="2174011">fd</span><span class="op" id="2174013">,</span>&nbsp;<span class="ident" id="2174015">bcap</span><span class="op" id="2174019">)</span><span class="op" id="2174020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2174024">n</span>&nbsp;<span class="op" id="2174026">+=</span>&nbsp;<span class="ident" id="2174029">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2174034">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2174096">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2174156">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174222">if</span>&nbsp;<span class="num" id="2174225">0</span>&nbsp;<span class="op" id="2174227">&lt;</span>&nbsp;<span class="ident" id="2174229">m</span>&nbsp;<span class="op" id="2174231">&amp;&amp;</span>&nbsp;<span class="ident" id="2174234">m</span>&nbsp;<span class="op" id="2174236">&lt;</span>&nbsp;<span class="builtinfunc" id="2174238">len</span><span class="op" id="2174241">(</span><span class="ident" id="2174242">bcap</span><span class="op" id="2174246">)</span>&nbsp;<span class="op" id="2174248">||</span>&nbsp;<span class="ident" id="2174251">err</span>&nbsp;<span class="op" id="2174255">==</span>&nbsp;<span class="ident" id="2174258">syscall</span><span class="op" id="2174265">.</span><span class="ident" id="2174266">EINTR</span>&nbsp;<span class="op" id="2174272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2174277">b</span>&nbsp;<span class="op" id="2174279">=</span>&nbsp;<span class="ident" id="2174281">b</span><span class="op" id="2174282">[</span><span class="ident" id="2174283">m</span><span class="op" id="2174284">:</span><span class="op" id="2174285">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174290">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2174301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174306">if</span>&nbsp;<span class="ident" id="2174309">needsMaxRW</span>&nbsp;<span class="op" id="2174320">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2174323">len</span><span class="op" id="2174326">(</span><span class="ident" id="2174327">bcap</span><span class="op" id="2174331">)</span>&nbsp;<span class="op" id="2174333">!=</span>&nbsp;<span class="builtinfunc" id="2174336">len</span><span class="op" id="2174339">(</span><span class="ident" id="2174340">b</span><span class="op" id="2174341">)</span>&nbsp;<span class="op" id="2174343">&amp;&amp;</span>&nbsp;<span class="ident" id="2174346">err</span>&nbsp;<span class="op" id="2174350">==</span>&nbsp;<span class="ident" id="2174353">nil</span>&nbsp;<span class="op" id="2174357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2174362">b</span>&nbsp;<span class="op" id="2174364">=</span>&nbsp;<span class="ident" id="2174366">b</span><span class="op" id="2174367">[</span><span class="ident" id="2174368">m</span><span class="op" id="2174369">:</span><span class="op" id="2174370">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174375">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2174386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174391">return</span>&nbsp;<span class="ident" id="2174398">n</span><span class="op" id="2174399">,</span>&nbsp;<span class="ident" id="2174401">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2174406">}</span><br>
<span class="lineno">230</span><span class="op" id="2174408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2174411">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2174482">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2174546">func</span>&nbsp;<span class="op" id="2174551">(</span><span class="ident" id="2174552">f</span>&nbsp;<span class="op" id="2174554">*</span><span class="ident" id="2174555">File</span><span class="op" id="2174559">)</span>&nbsp;<span class="ident" id="2174561">pwrite</span><span class="op" id="2174567">(</span><span class="ident" id="2174568">b</span>&nbsp;<span class="op" id="2174570">[</span><span class="op" id="2174571">]</span><span class="builtintype" id="2174572">byte</span><span class="op" id="2174576">,</span>&nbsp;<span class="ident" id="2174578">off</span>&nbsp;<span class="ident" id="2174582">int64</span><span class="op" id="2174587">)</span>&nbsp;<span class="op" id="2174589">(</span><span class="ident" id="2174590">n</span>&nbsp;<span class="builtintype" id="2174592">int</span><span class="op" id="2174595">,</span>&nbsp;<span class="ident" id="2174597">err</span>&nbsp;<span class="builtintype" id="2174601">error</span><span class="op" id="2174606">)</span>&nbsp;<span class="op" id="2174608">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174611">if</span>&nbsp;<span class="ident" id="2174614">needsMaxRW</span>&nbsp;<span class="op" id="2174625">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2174628">len</span><span class="op" id="2174631">(</span><span class="ident" id="2174632">b</span><span class="op" id="2174633">)</span>&nbsp;<span class="op" id="2174635">&gt;</span>&nbsp;<span class="ident" id="2174637">maxRW</span>&nbsp;<span class="op" id="2174643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2174647">b</span>&nbsp;<span class="op" id="2174649">=</span>&nbsp;<span class="ident" id="2174651">b</span><span class="op" id="2174652">[</span><span class="op" id="2174653">:</span><span class="ident" id="2174654">maxRW</span><span class="op" id="2174659">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2174662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174665">return</span>&nbsp;<span class="ident" id="2174672">fixCount</span><span class="op" id="2174680">(</span><span class="ident" id="2174681">syscall</span><span class="op" id="2174688">.</span><span class="ident" id="2174689">Pwrite</span><span class="op" id="2174695">(</span><span class="ident" id="2174696">f</span><span class="op" id="2174697">.</span><span class="ident" id="2174698">fd</span><span class="op" id="2174700">,</span>&nbsp;<span class="ident" id="2174702">b</span><span class="op" id="2174703">,</span>&nbsp;<span class="ident" id="2174705">off</span><span class="op" id="2174708">)</span><span class="op" id="2174709">)</span><br>
<span class="lineno"></span><span class="op" id="2174711">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2174714">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2174796">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2174872">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2174940">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2174991">func</span>&nbsp;<span class="op" id="2174996">(</span><span class="ident" id="2174997">f</span>&nbsp;<span class="op" id="2174999">*</span><span class="ident" id="2175000">File</span><span class="op" id="2175004">)</span>&nbsp;<span class="ident" id="2175006">seek</span><span class="op" id="2175010">(</span><span class="ident" id="2175011">offset</span>&nbsp;<span class="ident" id="2175018">int64</span><span class="op" id="2175023">,</span>&nbsp;<span class="ident" id="2175025">whence</span>&nbsp;<span class="builtintype" id="2175032">int</span><span class="op" id="2175035">)</span>&nbsp;<span class="op" id="2175037">(</span><span class="ident" id="2175038">ret</span>&nbsp;<span class="ident" id="2175042">int64</span><span class="op" id="2175047">,</span>&nbsp;<span class="ident" id="2175049">err</span>&nbsp;<span class="builtintype" id="2175053">error</span><span class="op" id="2175058">)</span>&nbsp;<span class="op" id="2175060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175063">return</span>&nbsp;<span class="ident" id="2175070">syscall</span><span class="op" id="2175077">.</span><span class="ident" id="2175078">Seek</span><span class="op" id="2175082">(</span><span class="ident" id="2175083">f</span><span class="op" id="2175084">.</span><span class="ident" id="2175085">fd</span><span class="op" id="2175087">,</span>&nbsp;<span class="ident" id="2175089">offset</span><span class="op" id="2175095">,</span>&nbsp;<span class="ident" id="2175097">whence</span><span class="op" id="2175103">)</span><br>
<span class="lineno"></span><span class="op" id="2175105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2175108">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2175156">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2175233">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2175289">func</span>&nbsp;<span class="ident" id="2175294">Truncate</span><span class="op" id="2175302">(</span><span class="ident" id="2175303">name</span>&nbsp;<span class="builtintype" id="2175308">string</span><span class="op" id="2175314">,</span>&nbsp;<span class="ident" id="2175316">size</span>&nbsp;<span class="ident" id="2175321">int64</span><span class="op" id="2175326">)</span>&nbsp;<span class="builtintype" id="2175328">error</span>&nbsp;<span class="op" id="2175334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175337">if</span>&nbsp;<span class="ident" id="2175340">e</span>&nbsp;<span class="op" id="2175342">:=</span>&nbsp;<span class="ident" id="2175345">syscall</span><span class="op" id="2175352">.</span><span class="ident" id="2175353">Truncate</span><span class="op" id="2175361">(</span><span class="ident" id="2175362">name</span><span class="op" id="2175366">,</span>&nbsp;<span class="ident" id="2175368">size</span><span class="op" id="2175372">)</span><span class="op" id="2175373">;</span>&nbsp;<span class="ident" id="2175375">e</span>&nbsp;<span class="op" id="2175377">!=</span>&nbsp;<span class="ident" id="2175380">nil</span>&nbsp;<span class="op" id="2175384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175388">return</span>&nbsp;<span class="op" id="2175395">&amp;</span><span class="ident" id="2175396">PathError</span><span class="op" id="2175405">{</span><span class="string" id="2175406">&#34;truncate&#34;</span><span class="op" id="2175416">,</span>&nbsp;<span class="ident" id="2175418">name</span><span class="op" id="2175422">,</span>&nbsp;<span class="ident" id="2175424">e</span><span class="op" id="2175425">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2175428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175431">return</span>&nbsp;<span class="ident" id="2175438">nil</span><br>
<span class="lineno"></span><span class="op" id="2175442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2175445">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2175492">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2175548">func</span>&nbsp;<span class="ident" id="2175553">Remove</span><span class="op" id="2175559">(</span><span class="ident" id="2175560">name</span>&nbsp;<span class="builtintype" id="2175565">string</span><span class="op" id="2175571">)</span>&nbsp;<span class="builtintype" id="2175573">error</span>&nbsp;<span class="op" id="2175579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175582">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175626">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175667">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175711">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2175748">e</span>&nbsp;<span class="op" id="2175750">:=</span>&nbsp;<span class="ident" id="2175753">syscall</span><span class="op" id="2175760">.</span><span class="ident" id="2175761">Unlink</span><span class="op" id="2175767">(</span><span class="ident" id="2175768">name</span><span class="op" id="2175772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175775">if</span>&nbsp;<span class="ident" id="2175778">e</span>&nbsp;<span class="op" id="2175780">==</span>&nbsp;<span class="ident" id="2175783">nil</span>&nbsp;<span class="op" id="2175787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175791">return</span>&nbsp;<span class="ident" id="2175798">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2175803">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2175806">e1</span>&nbsp;<span class="op" id="2175809">:=</span>&nbsp;<span class="ident" id="2175812">syscall</span><span class="op" id="2175819">.</span><span class="ident" id="2175820">Rmdir</span><span class="op" id="2175825">(</span><span class="ident" id="2175826">name</span><span class="op" id="2175830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175833">if</span>&nbsp;<span class="ident" id="2175836">e1</span>&nbsp;<span class="op" id="2175839">==</span>&nbsp;<span class="ident" id="2175842">nil</span>&nbsp;<span class="op" id="2175846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175850">return</span>&nbsp;<span class="ident" id="2175857">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2175862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175866">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175917">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175966">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176015">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176064">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176118">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176169">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176224">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176273">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176304">if</span>&nbsp;<span class="ident" id="2176307">e1</span>&nbsp;<span class="op" id="2176310">!=</span>&nbsp;<span class="ident" id="2176313">syscall</span><span class="op" id="2176320">.</span><span class="ident" id="2176321">ENOTDIR</span>&nbsp;<span class="op" id="2176329">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176333">e</span>&nbsp;<span class="op" id="2176335">=</span>&nbsp;<span class="ident" id="2176337">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176344">return</span>&nbsp;<span class="op" id="2176351">&amp;</span><span class="ident" id="2176352">PathError</span><span class="op" id="2176361">{</span><span class="string" id="2176362">&#34;remove&#34;</span><span class="op" id="2176370">,</span>&nbsp;<span class="ident" id="2176372">name</span><span class="op" id="2176376">,</span>&nbsp;<span class="ident" id="2176378">e</span><span class="op" id="2176379">}</span><br>
<span class="lineno"></span><span class="op" id="2176381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2176384">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2176467">func</span>&nbsp;<span class="ident" id="2176472">basename</span><span class="op" id="2176480">(</span><span class="ident" id="2176481">name</span>&nbsp;<span class="builtintype" id="2176486">string</span><span class="op" id="2176492">)</span>&nbsp;<span class="builtintype" id="2176494">string</span>&nbsp;<span class="op" id="2176501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176504">i</span>&nbsp;<span class="op" id="2176506">:=</span>&nbsp;<span class="builtinfunc" id="2176509">len</span><span class="op" id="2176512">(</span><span class="ident" id="2176513">name</span><span class="op" id="2176517">)</span>&nbsp;<span class="op" id="2176519">-</span>&nbsp;<span class="num" id="2176521">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176524">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176552">for</span>&nbsp;<span class="op" id="2176556">;</span>&nbsp;<span class="ident" id="2176558">i</span>&nbsp;<span class="op" id="2176560">&gt;</span>&nbsp;<span class="num" id="2176562">0</span>&nbsp;<span class="op" id="2176564">&amp;&amp;</span>&nbsp;<span class="ident" id="2176567">name</span><span class="op" id="2176571">[</span><span class="ident" id="2176572">i</span><span class="op" id="2176573">]</span>&nbsp;<span class="op" id="2176575">==</span>&nbsp;<span class="string" id="2176578">&#39;/&#39;</span><span class="op" id="2176581">;</span>&nbsp;<span class="ident" id="2176583">i</span><span class="op" id="2176584">--</span>&nbsp;<span class="op" id="2176587">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176591">name</span>&nbsp;<span class="op" id="2176596">=</span>&nbsp;<span class="ident" id="2176598">name</span><span class="op" id="2176602">[</span><span class="op" id="2176603">:</span><span class="ident" id="2176604">i</span><span class="op" id="2176605">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2176611">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176645">for</span>&nbsp;<span class="ident" id="2176649">i</span><span class="op" id="2176650">--</span><span class="op" id="2176652">;</span>&nbsp;<span class="ident" id="2176654">i</span>&nbsp;<span class="op" id="2176656">&gt;=</span>&nbsp;<span class="num" id="2176659">0</span><span class="op" id="2176660">;</span>&nbsp;<span class="ident" id="2176662">i</span><span class="op" id="2176663">--</span>&nbsp;<span class="op" id="2176666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176670">if</span>&nbsp;<span class="ident" id="2176673">name</span><span class="op" id="2176677">[</span><span class="ident" id="2176678">i</span><span class="op" id="2176679">]</span>&nbsp;<span class="op" id="2176681">==</span>&nbsp;<span class="string" id="2176684">&#39;/&#39;</span>&nbsp;<span class="op" id="2176688">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176693">name</span>&nbsp;<span class="op" id="2176698">=</span>&nbsp;<span class="ident" id="2176700">name</span><span class="op" id="2176704">[</span><span class="ident" id="2176705">i</span><span class="op" id="2176706">+</span><span class="num" id="2176707">1</span><span class="op" id="2176708">:</span><span class="op" id="2176709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176714">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176729">return</span>&nbsp;<span class="ident" id="2176736">name</span><br>
<span class="lineno"></span><span class="op" id="2176741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2176744">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2176813">func</span>&nbsp;<span class="ident" id="2176818">TempDir</span><span class="op" id="2176825">(</span><span class="op" id="2176826">)</span>&nbsp;<span class="builtintype" id="2176828">string</span>&nbsp;<span class="op" id="2176835">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176838">dir</span>&nbsp;<span class="op" id="2176842">:=</span>&nbsp;<span class="ident" id="2176845">Getenv</span><span class="op" id="2176851">(</span><span class="string" id="2176852">&#34;TMPDIR&#34;</span><span class="op" id="2176860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176863">if</span>&nbsp;<span class="ident" id="2176866">dir</span>&nbsp;<span class="op" id="2176870">==</span>&nbsp;<span class="string" id="2176873">&#34;&#34;</span>&nbsp;<span class="op" id="2176876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176880">if</span>&nbsp;<span class="ident" id="2176883">runtime</span><span class="op" id="2176890">.</span><span class="ident" id="2176891">GOOS</span>&nbsp;<span class="op" id="2176896">==</span>&nbsp;<span class="string" id="2176899">&#34;android&#34;</span>&nbsp;<span class="op" id="2176909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176914">dir</span>&nbsp;<span class="op" id="2176918">=</span>&nbsp;<span class="string" id="2176920">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176940">}</span>&nbsp;<span class="keyword" id="2176942">else</span>&nbsp;<span class="op" id="2176947">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176952">dir</span>&nbsp;<span class="op" id="2176956">=</span>&nbsp;<span class="string" id="2176958">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176973">return</span>&nbsp;<span class="ident" id="2176980">dir</span><br>
<span class="lineno"></span><span class="op" id="2176984">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2176987">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2177047">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2177103">func</span>&nbsp;<span class="ident" id="2177108">Link</span><span class="op" id="2177112">(</span><span class="ident" id="2177113">oldname</span><span class="op" id="2177120">,</span>&nbsp;<span class="ident" id="2177122">newname</span>&nbsp;<span class="builtintype" id="2177130">string</span><span class="op" id="2177136">)</span>&nbsp;<span class="builtintype" id="2177138">error</span>&nbsp;<span class="op" id="2177144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177147">e</span>&nbsp;<span class="op" id="2177149">:=</span>&nbsp;<span class="ident" id="2177152">syscall</span><span class="op" id="2177159">.</span><span class="ident" id="2177160">Link</span><span class="op" id="2177164">(</span><span class="ident" id="2177165">oldname</span><span class="op" id="2177172">,</span>&nbsp;<span class="ident" id="2177174">newname</span><span class="op" id="2177181">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177184">if</span>&nbsp;<span class="ident" id="2177187">e</span>&nbsp;<span class="op" id="2177189">!=</span>&nbsp;<span class="ident" id="2177192">nil</span>&nbsp;<span class="op" id="2177196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177200">return</span>&nbsp;<span class="op" id="2177207">&amp;</span><span class="ident" id="2177208">LinkError</span><span class="op" id="2177217">{</span><span class="string" id="2177218">&#34;link&#34;</span><span class="op" id="2177224">,</span>&nbsp;<span class="ident" id="2177226">oldname</span><span class="op" id="2177233">,</span>&nbsp;<span class="ident" id="2177235">newname</span><span class="op" id="2177242">,</span>&nbsp;<span class="ident" id="2177244">e</span><span class="op" id="2177245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2177248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177251">return</span>&nbsp;<span class="ident" id="2177258">nil</span><br>
<span class="lineno"></span><span class="op" id="2177262">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2177265">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2177323">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2177379">func</span>&nbsp;<span class="ident" id="2177384">Symlink</span><span class="op" id="2177391">(</span><span class="ident" id="2177392">oldname</span><span class="op" id="2177399">,</span>&nbsp;<span class="ident" id="2177401">newname</span>&nbsp;<span class="builtintype" id="2177409">string</span><span class="op" id="2177415">)</span>&nbsp;<span class="builtintype" id="2177417">error</span>&nbsp;<span class="op" id="2177423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177426">e</span>&nbsp;<span class="op" id="2177428">:=</span>&nbsp;<span class="ident" id="2177431">syscall</span><span class="op" id="2177438">.</span><span class="ident" id="2177439">Symlink</span><span class="op" id="2177446">(</span><span class="ident" id="2177447">oldname</span><span class="op" id="2177454">,</span>&nbsp;<span class="ident" id="2177456">newname</span><span class="op" id="2177463">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177466">if</span>&nbsp;<span class="ident" id="2177469">e</span>&nbsp;<span class="op" id="2177471">!=</span>&nbsp;<span class="ident" id="2177474">nil</span>&nbsp;<span class="op" id="2177478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177482">return</span>&nbsp;<span class="op" id="2177489">&amp;</span><span class="ident" id="2177490">LinkError</span><span class="op" id="2177499">{</span><span class="string" id="2177500">&#34;symlink&#34;</span><span class="op" id="2177509">,</span>&nbsp;<span class="ident" id="2177511">oldname</span><span class="op" id="2177518">,</span>&nbsp;<span class="ident" id="2177520">newname</span><span class="op" id="2177527">,</span>&nbsp;<span class="ident" id="2177529">e</span><span class="op" id="2177530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2177533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177536">return</span>&nbsp;<span class="ident" id="2177543">nil</span><br>
<span class="lineno"></span><span class="op" id="2177547">}</span>
</div>
</body>
</html>
