<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5679375">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5679430">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5679484">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5679535">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5679594">//</span><br>
<span class="lineno"></span><span class="comment" id="5679597">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5679655">package</span>&nbsp;<span class="ident" id="5679663">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5679668">import</span>&nbsp;<span class="op" id="5679675">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679678">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679695">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679714">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679721">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679729">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679743">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679752">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5679767">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5679772">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5679775">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5679811">const</span>&nbsp;<span class="op" id="5679817">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679820">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679837">=</span>&nbsp;<span class="num" id="5679839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679842">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679859">=</span>&nbsp;<span class="num" id="5679861">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679864">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679881">=</span>&nbsp;<span class="num" id="5679883">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679886">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5679903">=</span>&nbsp;<span class="num" id="5679905">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679908">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5679925">=</span>&nbsp;<span class="num" id="5679927">6</span><br>
<span class="lineno"></span><span class="op" id="5679929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5679932">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5679986">const</span>&nbsp;<span class="op" id="5679992">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679995">cbInvalid</span>&nbsp;<span class="op" id="5680005">=</span>&nbsp;<span class="ident" id="5680007">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680013">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680019">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680025">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680031">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680037">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680044">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680051">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680057">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680063">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680069">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680075">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680083">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680090">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680098">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680106">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5680114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5680117">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5680154">const</span>&nbsp;<span class="op" id="5680160">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680163">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680173">=</span>&nbsp;<span class="num" id="5680175">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680178">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680188">=</span>&nbsp;<span class="num" id="5680190">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680193">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5680203">=</span>&nbsp;<span class="num" id="5680205">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680208">ftAverage</span>&nbsp;<span class="op" id="5680218">=</span>&nbsp;<span class="num" id="5680220">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680223">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5680233">=</span>&nbsp;<span class="num" id="5680235">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680238">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5680248">=</span>&nbsp;<span class="num" id="5680250">5</span><br>
<span class="lineno"></span><span class="op" id="5680252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5680255">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5680274">const</span>&nbsp;<span class="op" id="5680280">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680283">itNone</span>&nbsp;&nbsp;<span class="op" id="5680291">=</span>&nbsp;<span class="num" id="5680293">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680296">itAdam7</span>&nbsp;<span class="op" id="5680304">=</span>&nbsp;<span class="num" id="5680306">1</span><br>
<span class="lineno"></span><span class="op" id="5680308">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5680311">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5680392">type</span>&nbsp;<span class="ident" id="5680397">interlaceScan</span>&nbsp;<span class="keyword" id="5680411">struct</span>&nbsp;<span class="op" id="5680418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680421">xFactor</span><span class="op" id="5680428">,</span>&nbsp;<span class="ident" id="5680430">yFactor</span><span class="op" id="5680437">,</span>&nbsp;<span class="ident" id="5680439">xOffset</span><span class="op" id="5680446">,</span>&nbsp;<span class="ident" id="5680448">yOffset</span>&nbsp;<span class="builtintype" id="5680456">int</span><br>
<span class="lineno"></span><span class="op" id="5680460">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5680463">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5680538">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5680582">var</span>&nbsp;<span class="ident" id="5680586">interlacing</span>&nbsp;<span class="op" id="5680598">=</span>&nbsp;<span class="op" id="5680600">[</span><span class="op" id="5680601">]</span><span class="ident" id="5680602">interlaceScan</span><span class="op" id="5680615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680618">{</span><span class="num" id="5680619">8</span><span class="op" id="5680620">,</span>&nbsp;<span class="num" id="5680622">8</span><span class="op" id="5680623">,</span>&nbsp;<span class="num" id="5680625">0</span><span class="op" id="5680626">,</span>&nbsp;<span class="num" id="5680628">0</span><span class="op" id="5680629">}</span><span class="op" id="5680630">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680633">{</span><span class="num" id="5680634">8</span><span class="op" id="5680635">,</span>&nbsp;<span class="num" id="5680637">8</span><span class="op" id="5680638">,</span>&nbsp;<span class="num" id="5680640">4</span><span class="op" id="5680641">,</span>&nbsp;<span class="num" id="5680643">0</span><span class="op" id="5680644">}</span><span class="op" id="5680645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680648">{</span><span class="num" id="5680649">4</span><span class="op" id="5680650">,</span>&nbsp;<span class="num" id="5680652">8</span><span class="op" id="5680653">,</span>&nbsp;<span class="num" id="5680655">0</span><span class="op" id="5680656">,</span>&nbsp;<span class="num" id="5680658">4</span><span class="op" id="5680659">}</span><span class="op" id="5680660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680663">{</span><span class="num" id="5680664">4</span><span class="op" id="5680665">,</span>&nbsp;<span class="num" id="5680667">4</span><span class="op" id="5680668">,</span>&nbsp;<span class="num" id="5680670">2</span><span class="op" id="5680671">,</span>&nbsp;<span class="num" id="5680673">0</span><span class="op" id="5680674">}</span><span class="op" id="5680675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680678">{</span><span class="num" id="5680679">2</span><span class="op" id="5680680">,</span>&nbsp;<span class="num" id="5680682">4</span><span class="op" id="5680683">,</span>&nbsp;<span class="num" id="5680685">0</span><span class="op" id="5680686">,</span>&nbsp;<span class="num" id="5680688">2</span><span class="op" id="5680689">}</span><span class="op" id="5680690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680693">{</span><span class="num" id="5680694">2</span><span class="op" id="5680695">,</span>&nbsp;<span class="num" id="5680697">2</span><span class="op" id="5680698">,</span>&nbsp;<span class="num" id="5680700">1</span><span class="op" id="5680701">,</span>&nbsp;<span class="num" id="5680703">0</span><span class="op" id="5680704">}</span><span class="op" id="5680705">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680708">{</span><span class="num" id="5680709">1</span><span class="op" id="5680710">,</span>&nbsp;<span class="num" id="5680712">2</span><span class="op" id="5680713">,</span>&nbsp;<span class="num" id="5680715">0</span><span class="op" id="5680716">,</span>&nbsp;<span class="num" id="5680718">1</span><span class="op" id="5680719">}</span><span class="op" id="5680720">,</span><br>
<span class="lineno"></span><span class="op" id="5680722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5680725">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5680744">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5680822">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5680898">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5680973">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5680991">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5681035">const</span>&nbsp;<span class="op" id="5681041">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681044">dsStart</span>&nbsp;<span class="op" id="5681052">=</span>&nbsp;<span class="ident" id="5681054">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681060">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681072">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681084">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681096">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5681107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681110">const</span>&nbsp;<span class="ident" id="5681116">pngHeader</span>&nbsp;<span class="op" id="5681126">=</span>&nbsp;<span class="string" id="5681128">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681149">type</span>&nbsp;<span class="ident" id="5681154">decoder</span>&nbsp;<span class="keyword" id="5681162">struct</span>&nbsp;<span class="op" id="5681169">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681172">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681186">io</span><span class="op" id="5681188">.</span><span class="ident" id="5681189">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681197">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681211">image</span><span class="op" id="5681216">.</span><span class="ident" id="5681217">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681224">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681238">hash</span><span class="op" id="5681242">.</span><span class="ident" id="5681243">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681251">width</span><span class="op" id="5681256">,</span>&nbsp;<span class="ident" id="5681258">height</span>&nbsp;<span class="builtintype" id="5681265">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681270">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5681284">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681289">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681303">color</span><span class="op" id="5681308">.</span><span class="ident" id="5681309">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681318">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5681332">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681337">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5681351">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681356">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5681370">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681378">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5681392">[</span><span class="num" id="5681393">3</span>&nbsp;<span class="op" id="5681395">*</span>&nbsp;<span class="num" id="5681397">256</span><span class="op" id="5681400">]</span><span class="builtintype" id="5681401">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681407">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5681421">int</span><br>
<span class="lineno"></span><span class="op" id="5681425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5681428">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5681488">type</span>&nbsp;<span class="ident" id="5681493">FormatError</span>&nbsp;<span class="builtintype" id="5681505">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5681513">func</span>&nbsp;<span class="op" id="5681518">(</span><span class="ident" id="5681519">e</span>&nbsp;<span class="ident" id="5681521">FormatError</span><span class="op" id="5681532">)</span>&nbsp;<span class="ident" id="5681534">Error</span><span class="op" id="5681539">(</span><span class="op" id="5681540">)</span>&nbsp;<span class="builtintype" id="5681542">string</span>&nbsp;<span class="op" id="5681549">{</span>&nbsp;<span class="keyword" id="5681551">return</span>&nbsp;<span class="string" id="5681558">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5681582">+</span>&nbsp;<span class="builtintype" id="5681584">string</span><span class="op" id="5681590">(</span><span class="ident" id="5681591">e</span><span class="op" id="5681592">)</span>&nbsp;<span class="op" id="5681594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681597">var</span>&nbsp;<span class="ident" id="5681601">chunkOrderError</span>&nbsp;<span class="op" id="5681617">=</span>&nbsp;<span class="ident" id="5681619">FormatError</span><span class="op" id="5681630">(</span><span class="string" id="5681631">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5681651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5681654">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5681744">type</span>&nbsp;<span class="ident" id="5681749">UnsupportedError</span>&nbsp;<span class="builtintype" id="5681766">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681774">func</span>&nbsp;<span class="op" id="5681779">(</span><span class="ident" id="5681780">e</span>&nbsp;<span class="ident" id="5681782">UnsupportedError</span><span class="op" id="5681798">)</span>&nbsp;<span class="ident" id="5681800">Error</span><span class="op" id="5681805">(</span><span class="op" id="5681806">)</span>&nbsp;<span class="builtintype" id="5681808">string</span>&nbsp;<span class="op" id="5681815">{</span>&nbsp;<span class="keyword" id="5681817">return</span>&nbsp;<span class="string" id="5681824">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5681853">+</span>&nbsp;<span class="builtintype" id="5681855">string</span><span class="op" id="5681861">(</span><span class="ident" id="5681862">e</span><span class="op" id="5681863">)</span>&nbsp;<span class="op" id="5681865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5681868">func</span>&nbsp;<span class="ident" id="5681873">min</span><span class="op" id="5681876">(</span><span class="ident" id="5681877">a</span><span class="op" id="5681878">,</span>&nbsp;<span class="ident" id="5681880">b</span>&nbsp;<span class="builtintype" id="5681882">int</span><span class="op" id="5681885">)</span>&nbsp;<span class="builtintype" id="5681887">int</span>&nbsp;<span class="op" id="5681891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681894">if</span>&nbsp;<span class="ident" id="5681897">a</span>&nbsp;<span class="op" id="5681899">&lt;</span>&nbsp;<span class="ident" id="5681901">b</span>&nbsp;<span class="op" id="5681903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681907">return</span>&nbsp;<span class="ident" id="5681914">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681920">return</span>&nbsp;<span class="ident" id="5681927">b</span><br>
<span class="lineno">130</span><span class="op" id="5681929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681932">func</span>&nbsp;<span class="op" id="5681937">(</span><span class="ident" id="5681938">d</span>&nbsp;<span class="op" id="5681940">*</span><span class="ident" id="5681941">decoder</span><span class="op" id="5681948">)</span>&nbsp;<span class="ident" id="5681950">parseIHDR</span><span class="op" id="5681959">(</span><span class="ident" id="5681960">length</span>&nbsp;<span class="builtintype" id="5681967">uint32</span><span class="op" id="5681973">)</span>&nbsp;<span class="builtintype" id="5681975">error</span>&nbsp;<span class="op" id="5681981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681984">if</span>&nbsp;<span class="ident" id="5681987">length</span>&nbsp;<span class="op" id="5681994">!=</span>&nbsp;<span class="num" id="5681997">13</span>&nbsp;<span class="op" id="5682000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682004">return</span>&nbsp;<span class="ident" id="5682011">FormatError</span><span class="op" id="5682022">(</span><span class="string" id="5682023">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5682040">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682046">if</span>&nbsp;<span class="ident" id="5682049">_</span><span class="op" id="5682050">,</span>&nbsp;<span class="ident" id="5682052">err</span>&nbsp;<span class="op" id="5682056">:=</span>&nbsp;<span class="ident" id="5682059">io</span><span class="op" id="5682061">.</span><span class="ident" id="5682062">ReadFull</span><span class="op" id="5682070">(</span><span class="ident" id="5682071">d</span><span class="op" id="5682072">.</span><span class="ident" id="5682073">r</span><span class="op" id="5682074">,</span>&nbsp;<span class="ident" id="5682076">d</span><span class="op" id="5682077">.</span><span class="ident" id="5682078">tmp</span><span class="op" id="5682081">[</span><span class="op" id="5682082">:</span><span class="num" id="5682083">13</span><span class="op" id="5682085">]</span><span class="op" id="5682086">)</span><span class="op" id="5682087">;</span>&nbsp;<span class="ident" id="5682089">err</span>&nbsp;<span class="op" id="5682093">!=</span>&nbsp;<span class="ident" id="5682096">nil</span>&nbsp;<span class="op" id="5682100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682104">return</span>&nbsp;<span class="ident" id="5682111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682119">d</span><span class="op" id="5682120">.</span><span class="ident" id="5682121">crc</span><span class="op" id="5682124">.</span><span class="ident" id="5682125">Write</span><span class="op" id="5682130">(</span><span class="ident" id="5682131">d</span><span class="op" id="5682132">.</span><span class="ident" id="5682133">tmp</span><span class="op" id="5682136">[</span><span class="op" id="5682137">:</span><span class="num" id="5682138">13</span><span class="op" id="5682140">]</span><span class="op" id="5682141">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682144">if</span>&nbsp;<span class="ident" id="5682147">d</span><span class="op" id="5682148">.</span><span class="ident" id="5682149">tmp</span><span class="op" id="5682152">[</span><span class="num" id="5682153">10</span><span class="op" id="5682155">]</span>&nbsp;<span class="op" id="5682157">!=</span>&nbsp;<span class="num" id="5682160">0</span>&nbsp;<span class="op" id="5682162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682166">return</span>&nbsp;<span class="ident" id="5682173">UnsupportedError</span><span class="op" id="5682189">(</span><span class="string" id="5682190">&#34;compression&nbsp;method&#34;</span><span class="op" id="5682210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682216">if</span>&nbsp;<span class="ident" id="5682219">d</span><span class="op" id="5682220">.</span><span class="ident" id="5682221">tmp</span><span class="op" id="5682224">[</span><span class="num" id="5682225">11</span><span class="op" id="5682227">]</span>&nbsp;<span class="op" id="5682229">!=</span>&nbsp;<span class="num" id="5682232">0</span>&nbsp;<span class="op" id="5682234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682238">return</span>&nbsp;<span class="ident" id="5682245">UnsupportedError</span><span class="op" id="5682261">(</span><span class="string" id="5682262">&#34;filter&nbsp;method&#34;</span><span class="op" id="5682277">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682283">if</span>&nbsp;<span class="ident" id="5682286">d</span><span class="op" id="5682287">.</span><span class="ident" id="5682288">tmp</span><span class="op" id="5682291">[</span><span class="num" id="5682292">12</span><span class="op" id="5682294">]</span>&nbsp;<span class="op" id="5682296">!=</span>&nbsp;<span class="ident" id="5682299">itNone</span>&nbsp;<span class="op" id="5682306">&amp;&amp;</span>&nbsp;<span class="ident" id="5682309">d</span><span class="op" id="5682310">.</span><span class="ident" id="5682311">tmp</span><span class="op" id="5682314">[</span><span class="num" id="5682315">12</span><span class="op" id="5682317">]</span>&nbsp;<span class="op" id="5682319">!=</span>&nbsp;<span class="ident" id="5682322">itAdam7</span>&nbsp;<span class="op" id="5682330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682334">return</span>&nbsp;<span class="ident" id="5682341">FormatError</span><span class="op" id="5682352">(</span><span class="string" id="5682353">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5682379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682385">d</span><span class="op" id="5682386">.</span><span class="ident" id="5682387">interlace</span>&nbsp;<span class="op" id="5682397">=</span>&nbsp;<span class="builtintype" id="5682399">int</span><span class="op" id="5682402">(</span><span class="ident" id="5682403">d</span><span class="op" id="5682404">.</span><span class="ident" id="5682405">tmp</span><span class="op" id="5682408">[</span><span class="num" id="5682409">12</span><span class="op" id="5682411">]</span><span class="op" id="5682412">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682415">w</span>&nbsp;<span class="op" id="5682417">:=</span>&nbsp;<span class="builtintype" id="5682420">int32</span><span class="op" id="5682425">(</span><span class="ident" id="5682426">binary</span><span class="op" id="5682432">.</span><span class="ident" id="5682433">BigEndian</span><span class="op" id="5682442">.</span><span class="ident" id="5682443">Uint32</span><span class="op" id="5682449">(</span><span class="ident" id="5682450">d</span><span class="op" id="5682451">.</span><span class="ident" id="5682452">tmp</span><span class="op" id="5682455">[</span><span class="num" id="5682456">0</span><span class="op" id="5682457">:</span><span class="num" id="5682458">4</span><span class="op" id="5682459">]</span><span class="op" id="5682460">)</span><span class="op" id="5682461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682464">h</span>&nbsp;<span class="op" id="5682466">:=</span>&nbsp;<span class="builtintype" id="5682469">int32</span><span class="op" id="5682474">(</span><span class="ident" id="5682475">binary</span><span class="op" id="5682481">.</span><span class="ident" id="5682482">BigEndian</span><span class="op" id="5682491">.</span><span class="ident" id="5682492">Uint32</span><span class="op" id="5682498">(</span><span class="ident" id="5682499">d</span><span class="op" id="5682500">.</span><span class="ident" id="5682501">tmp</span><span class="op" id="5682504">[</span><span class="num" id="5682505">4</span><span class="op" id="5682506">:</span><span class="num" id="5682507">8</span><span class="op" id="5682508">]</span><span class="op" id="5682509">)</span><span class="op" id="5682510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682513">if</span>&nbsp;<span class="ident" id="5682516">w</span>&nbsp;<span class="op" id="5682518">&lt;</span>&nbsp;<span class="num" id="5682520">0</span>&nbsp;<span class="op" id="5682522">||</span>&nbsp;<span class="ident" id="5682525">h</span>&nbsp;<span class="op" id="5682527">&lt;</span>&nbsp;<span class="num" id="5682529">0</span>&nbsp;<span class="op" id="5682531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682535">return</span>&nbsp;<span class="ident" id="5682542">FormatError</span><span class="op" id="5682553">(</span><span class="string" id="5682554">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5682574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682577">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682580">nPixels</span>&nbsp;<span class="op" id="5682588">:=</span>&nbsp;<span class="ident" id="5682591">int64</span><span class="op" id="5682596">(</span><span class="ident" id="5682597">w</span><span class="op" id="5682598">)</span>&nbsp;<span class="op" id="5682600">*</span>&nbsp;<span class="ident" id="5682602">int64</span><span class="op" id="5682607">(</span><span class="ident" id="5682608">h</span><span class="op" id="5682609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682612">if</span>&nbsp;<span class="ident" id="5682615">nPixels</span>&nbsp;<span class="op" id="5682623">!=</span>&nbsp;<span class="ident" id="5682626">int64</span><span class="op" id="5682631">(</span><span class="builtintype" id="5682632">int</span><span class="op" id="5682635">(</span><span class="ident" id="5682636">nPixels</span><span class="op" id="5682643">)</span><span class="op" id="5682644">)</span>&nbsp;<span class="op" id="5682646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682650">return</span>&nbsp;<span class="ident" id="5682657">UnsupportedError</span><span class="op" id="5682673">(</span><span class="string" id="5682674">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5682694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682700">d</span><span class="op" id="5682701">.</span><span class="ident" id="5682702">cb</span>&nbsp;<span class="op" id="5682705">=</span>&nbsp;<span class="ident" id="5682707">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682718">d</span><span class="op" id="5682719">.</span><span class="ident" id="5682720">depth</span>&nbsp;<span class="op" id="5682726">=</span>&nbsp;<span class="builtintype" id="5682728">int</span><span class="op" id="5682731">(</span><span class="ident" id="5682732">d</span><span class="op" id="5682733">.</span><span class="ident" id="5682734">tmp</span><span class="op" id="5682737">[</span><span class="num" id="5682738">8</span><span class="op" id="5682739">]</span><span class="op" id="5682740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682743">switch</span>&nbsp;<span class="ident" id="5682750">d</span><span class="op" id="5682751">.</span><span class="ident" id="5682752">depth</span>&nbsp;<span class="op" id="5682758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682761">case</span>&nbsp;<span class="num" id="5682766">1</span><span class="op" id="5682767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682771">switch</span>&nbsp;<span class="ident" id="5682778">d</span><span class="op" id="5682779">.</span><span class="ident" id="5682780">tmp</span><span class="op" id="5682783">[</span><span class="num" id="5682784">9</span><span class="op" id="5682785">]</span>&nbsp;<span class="op" id="5682787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682791">case</span>&nbsp;<span class="ident" id="5682796">ctGrayscale</span><span class="op" id="5682807">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682812">d</span><span class="op" id="5682813">.</span><span class="ident" id="5682814">cb</span>&nbsp;<span class="op" id="5682817">=</span>&nbsp;<span class="ident" id="5682819">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682826">case</span>&nbsp;<span class="ident" id="5682831">ctPaletted</span><span class="op" id="5682841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682846">d</span><span class="op" id="5682847">.</span><span class="ident" id="5682848">cb</span>&nbsp;<span class="op" id="5682851">=</span>&nbsp;<span class="ident" id="5682853">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682863">case</span>&nbsp;<span class="num" id="5682868">2</span><span class="op" id="5682869">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682873">switch</span>&nbsp;<span class="ident" id="5682880">d</span><span class="op" id="5682881">.</span><span class="ident" id="5682882">tmp</span><span class="op" id="5682885">[</span><span class="num" id="5682886">9</span><span class="op" id="5682887">]</span>&nbsp;<span class="op" id="5682889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682893">case</span>&nbsp;<span class="ident" id="5682898">ctGrayscale</span><span class="op" id="5682909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682914">d</span><span class="op" id="5682915">.</span><span class="ident" id="5682916">cb</span>&nbsp;<span class="op" id="5682919">=</span>&nbsp;<span class="ident" id="5682921">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682928">case</span>&nbsp;<span class="ident" id="5682933">ctPaletted</span><span class="op" id="5682943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682948">d</span><span class="op" id="5682949">.</span><span class="ident" id="5682950">cb</span>&nbsp;<span class="op" id="5682953">=</span>&nbsp;<span class="ident" id="5682955">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682965">case</span>&nbsp;<span class="num" id="5682970">4</span><span class="op" id="5682971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682975">switch</span>&nbsp;<span class="ident" id="5682982">d</span><span class="op" id="5682983">.</span><span class="ident" id="5682984">tmp</span><span class="op" id="5682987">[</span><span class="num" id="5682988">9</span><span class="op" id="5682989">]</span>&nbsp;<span class="op" id="5682991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682995">case</span>&nbsp;<span class="ident" id="5683000">ctGrayscale</span><span class="op" id="5683011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683016">d</span><span class="op" id="5683017">.</span><span class="ident" id="5683018">cb</span>&nbsp;<span class="op" id="5683021">=</span>&nbsp;<span class="ident" id="5683023">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683030">case</span>&nbsp;<span class="ident" id="5683035">ctPaletted</span><span class="op" id="5683045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683050">d</span><span class="op" id="5683051">.</span><span class="ident" id="5683052">cb</span>&nbsp;<span class="op" id="5683055">=</span>&nbsp;<span class="ident" id="5683057">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683067">case</span>&nbsp;<span class="num" id="5683072">8</span><span class="op" id="5683073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683077">switch</span>&nbsp;<span class="ident" id="5683084">d</span><span class="op" id="5683085">.</span><span class="ident" id="5683086">tmp</span><span class="op" id="5683089">[</span><span class="num" id="5683090">9</span><span class="op" id="5683091">]</span>&nbsp;<span class="op" id="5683093">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683097">case</span>&nbsp;<span class="ident" id="5683102">ctGrayscale</span><span class="op" id="5683113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683118">d</span><span class="op" id="5683119">.</span><span class="ident" id="5683120">cb</span>&nbsp;<span class="op" id="5683123">=</span>&nbsp;<span class="ident" id="5683125">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683132">case</span>&nbsp;<span class="ident" id="5683137">ctTrueColor</span><span class="op" id="5683148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683153">d</span><span class="op" id="5683154">.</span><span class="ident" id="5683155">cb</span>&nbsp;<span class="op" id="5683158">=</span>&nbsp;<span class="ident" id="5683160">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683168">case</span>&nbsp;<span class="ident" id="5683173">ctPaletted</span><span class="op" id="5683183">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683188">d</span><span class="op" id="5683189">.</span><span class="ident" id="5683190">cb</span>&nbsp;<span class="op" id="5683193">=</span>&nbsp;<span class="ident" id="5683195">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683202">case</span>&nbsp;<span class="ident" id="5683207">ctGrayscaleAlpha</span><span class="op" id="5683223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683228">d</span><span class="op" id="5683229">.</span><span class="ident" id="5683230">cb</span>&nbsp;<span class="op" id="5683233">=</span>&nbsp;<span class="ident" id="5683235">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683243">case</span>&nbsp;<span class="ident" id="5683248">ctTrueColorAlpha</span><span class="op" id="5683264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683269">d</span><span class="op" id="5683270">.</span><span class="ident" id="5683271">cb</span>&nbsp;<span class="op" id="5683274">=</span>&nbsp;<span class="ident" id="5683276">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683288">case</span>&nbsp;<span class="num" id="5683293">16</span><span class="op" id="5683295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683299">switch</span>&nbsp;<span class="ident" id="5683306">d</span><span class="op" id="5683307">.</span><span class="ident" id="5683308">tmp</span><span class="op" id="5683311">[</span><span class="num" id="5683312">9</span><span class="op" id="5683313">]</span>&nbsp;<span class="op" id="5683315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683319">case</span>&nbsp;<span class="ident" id="5683324">ctGrayscale</span><span class="op" id="5683335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683340">d</span><span class="op" id="5683341">.</span><span class="ident" id="5683342">cb</span>&nbsp;<span class="op" id="5683345">=</span>&nbsp;<span class="ident" id="5683347">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683355">case</span>&nbsp;<span class="ident" id="5683360">ctTrueColor</span><span class="op" id="5683371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683376">d</span><span class="op" id="5683377">.</span><span class="ident" id="5683378">cb</span>&nbsp;<span class="op" id="5683381">=</span>&nbsp;<span class="ident" id="5683383">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683392">case</span>&nbsp;<span class="ident" id="5683397">ctGrayscaleAlpha</span><span class="op" id="5683413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683418">d</span><span class="op" id="5683419">.</span><span class="ident" id="5683420">cb</span>&nbsp;<span class="op" id="5683423">=</span>&nbsp;<span class="ident" id="5683425">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683434">case</span>&nbsp;<span class="ident" id="5683439">ctTrueColorAlpha</span><span class="op" id="5683455">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683460">d</span><span class="op" id="5683461">.</span><span class="ident" id="5683462">cb</span>&nbsp;<span class="op" id="5683465">=</span>&nbsp;<span class="ident" id="5683467">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683483">if</span>&nbsp;<span class="ident" id="5683486">d</span><span class="op" id="5683487">.</span><span class="ident" id="5683488">cb</span>&nbsp;<span class="op" id="5683491">==</span>&nbsp;<span class="ident" id="5683494">cbInvalid</span>&nbsp;<span class="op" id="5683504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683508">return</span>&nbsp;<span class="ident" id="5683515">UnsupportedError</span><span class="op" id="5683531">(</span><span class="ident" id="5683532">fmt</span><span class="op" id="5683535">.</span><span class="ident" id="5683536">Sprintf</span><span class="op" id="5683543">(</span><span class="string" id="5683544">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5683573">,</span>&nbsp;<span class="ident" id="5683575">d</span><span class="op" id="5683576">.</span><span class="ident" id="5683577">tmp</span><span class="op" id="5683580">[</span><span class="num" id="5683581">8</span><span class="op" id="5683582">]</span><span class="op" id="5683583">,</span>&nbsp;<span class="ident" id="5683585">d</span><span class="op" id="5683586">.</span><span class="ident" id="5683587">tmp</span><span class="op" id="5683590">[</span><span class="num" id="5683591">9</span><span class="op" id="5683592">]</span><span class="op" id="5683593">)</span><span class="op" id="5683594">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683600">d</span><span class="op" id="5683601">.</span><span class="ident" id="5683602">width</span><span class="op" id="5683607">,</span>&nbsp;<span class="ident" id="5683609">d</span><span class="op" id="5683610">.</span><span class="ident" id="5683611">height</span>&nbsp;<span class="op" id="5683618">=</span>&nbsp;<span class="builtintype" id="5683620">int</span><span class="op" id="5683623">(</span><span class="ident" id="5683624">w</span><span class="op" id="5683625">)</span><span class="op" id="5683626">,</span>&nbsp;<span class="builtintype" id="5683628">int</span><span class="op" id="5683631">(</span><span class="ident" id="5683632">h</span><span class="op" id="5683633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683636">return</span>&nbsp;<span class="ident" id="5683643">d</span><span class="op" id="5683644">.</span><span class="ident" id="5683645">verifyChecksum</span><span class="op" id="5683659">(</span><span class="op" id="5683660">)</span><br>
<span class="lineno"></span><span class="op" id="5683662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5683665">func</span>&nbsp;<span class="op" id="5683670">(</span><span class="ident" id="5683671">d</span>&nbsp;<span class="op" id="5683673">*</span><span class="ident" id="5683674">decoder</span><span class="op" id="5683681">)</span>&nbsp;<span class="ident" id="5683683">parsePLTE</span><span class="op" id="5683692">(</span><span class="ident" id="5683693">length</span>&nbsp;<span class="builtintype" id="5683700">uint32</span><span class="op" id="5683706">)</span>&nbsp;<span class="builtintype" id="5683708">error</span>&nbsp;<span class="op" id="5683714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683717">np</span>&nbsp;<span class="op" id="5683720">:=</span>&nbsp;<span class="builtintype" id="5683723">int</span><span class="op" id="5683726">(</span><span class="ident" id="5683727">length</span>&nbsp;<span class="op" id="5683734">/</span>&nbsp;<span class="num" id="5683736">3</span><span class="op" id="5683737">)</span>&nbsp;<span class="comment" id="5683739">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683774">if</span>&nbsp;<span class="ident" id="5683777">length</span><span class="op" id="5683783">%</span><span class="num" id="5683784">3</span>&nbsp;<span class="op" id="5683786">!=</span>&nbsp;<span class="num" id="5683789">0</span>&nbsp;<span class="op" id="5683791">||</span>&nbsp;<span class="ident" id="5683794">np</span>&nbsp;<span class="op" id="5683797">&lt;=</span>&nbsp;<span class="num" id="5683800">0</span>&nbsp;<span class="op" id="5683802">||</span>&nbsp;<span class="ident" id="5683805">np</span>&nbsp;<span class="op" id="5683808">&gt;</span>&nbsp;<span class="num" id="5683810">256</span>&nbsp;<span class="op" id="5683814">||</span>&nbsp;<span class="ident" id="5683817">np</span>&nbsp;<span class="op" id="5683820">&gt;</span>&nbsp;<span class="num" id="5683822">1</span><span class="op" id="5683823">&lt;&lt;</span><span class="builtintype" id="5683825">uint</span><span class="op" id="5683829">(</span><span class="ident" id="5683830">d</span><span class="op" id="5683831">.</span><span class="ident" id="5683832">depth</span><span class="op" id="5683837">)</span>&nbsp;<span class="op" id="5683839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683843">return</span>&nbsp;<span class="ident" id="5683850">FormatError</span><span class="op" id="5683861">(</span><span class="string" id="5683862">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5683879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683882">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683885">n</span><span class="op" id="5683886">,</span>&nbsp;<span class="ident" id="5683888">err</span>&nbsp;<span class="op" id="5683892">:=</span>&nbsp;<span class="ident" id="5683895">io</span><span class="op" id="5683897">.</span><span class="ident" id="5683898">ReadFull</span><span class="op" id="5683906">(</span><span class="ident" id="5683907">d</span><span class="op" id="5683908">.</span><span class="ident" id="5683909">r</span><span class="op" id="5683910">,</span>&nbsp;<span class="ident" id="5683912">d</span><span class="op" id="5683913">.</span><span class="ident" id="5683914">tmp</span><span class="op" id="5683917">[</span><span class="op" id="5683918">:</span><span class="num" id="5683919">3</span><span class="op" id="5683920">*</span><span class="ident" id="5683921">np</span><span class="op" id="5683923">]</span><span class="op" id="5683924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683927">if</span>&nbsp;<span class="ident" id="5683930">err</span>&nbsp;<span class="op" id="5683934">!=</span>&nbsp;<span class="ident" id="5683937">nil</span>&nbsp;<span class="op" id="5683941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683945">return</span>&nbsp;<span class="ident" id="5683952">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683960">d</span><span class="op" id="5683961">.</span><span class="ident" id="5683962">crc</span><span class="op" id="5683965">.</span><span class="ident" id="5683966">Write</span><span class="op" id="5683971">(</span><span class="ident" id="5683972">d</span><span class="op" id="5683973">.</span><span class="ident" id="5683974">tmp</span><span class="op" id="5683977">[</span><span class="op" id="5683978">:</span><span class="ident" id="5683979">n</span><span class="op" id="5683980">]</span><span class="op" id="5683981">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683984">switch</span>&nbsp;<span class="ident" id="5683991">d</span><span class="op" id="5683992">.</span><span class="ident" id="5683993">cb</span>&nbsp;<span class="op" id="5683996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683999">case</span>&nbsp;<span class="ident" id="5684004">cbP1</span><span class="op" id="5684008">,</span>&nbsp;<span class="ident" id="5684010">cbP2</span><span class="op" id="5684014">,</span>&nbsp;<span class="ident" id="5684016">cbP4</span><span class="op" id="5684020">,</span>&nbsp;<span class="ident" id="5684022">cbP8</span><span class="op" id="5684026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684030">d</span><span class="op" id="5684031">.</span><span class="ident" id="5684032">palette</span>&nbsp;<span class="op" id="5684040">=</span>&nbsp;<span class="builtinfunc" id="5684042">make</span><span class="op" id="5684046">(</span><span class="ident" id="5684047">color</span><span class="op" id="5684052">.</span><span class="ident" id="5684053">Palette</span><span class="op" id="5684060">,</span>&nbsp;<span class="num" id="5684062">256</span><span class="op" id="5684065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684069">for</span>&nbsp;<span class="ident" id="5684073">i</span>&nbsp;<span class="op" id="5684075">:=</span>&nbsp;<span class="num" id="5684078">0</span><span class="op" id="5684079">;</span>&nbsp;<span class="ident" id="5684081">i</span>&nbsp;<span class="op" id="5684083">&lt;</span>&nbsp;<span class="ident" id="5684085">np</span><span class="op" id="5684087">;</span>&nbsp;<span class="ident" id="5684089">i</span><span class="op" id="5684090">++</span>&nbsp;<span class="op" id="5684093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684098">d</span><span class="op" id="5684099">.</span><span class="ident" id="5684100">palette</span><span class="op" id="5684107">[</span><span class="ident" id="5684108">i</span><span class="op" id="5684109">]</span>&nbsp;<span class="op" id="5684111">=</span>&nbsp;<span class="ident" id="5684113">color</span><span class="op" id="5684118">.</span><span class="ident" id="5684119">RGBA</span><span class="op" id="5684123">{</span><span class="ident" id="5684124">d</span><span class="op" id="5684125">.</span><span class="ident" id="5684126">tmp</span><span class="op" id="5684129">[</span><span class="num" id="5684130">3</span><span class="op" id="5684131">*</span><span class="ident" id="5684132">i</span><span class="op" id="5684133">+</span><span class="num" id="5684134">0</span><span class="op" id="5684135">]</span><span class="op" id="5684136">,</span>&nbsp;<span class="ident" id="5684138">d</span><span class="op" id="5684139">.</span><span class="ident" id="5684140">tmp</span><span class="op" id="5684143">[</span><span class="num" id="5684144">3</span><span class="op" id="5684145">*</span><span class="ident" id="5684146">i</span><span class="op" id="5684147">+</span><span class="num" id="5684148">1</span><span class="op" id="5684149">]</span><span class="op" id="5684150">,</span>&nbsp;<span class="ident" id="5684152">d</span><span class="op" id="5684153">.</span><span class="ident" id="5684154">tmp</span><span class="op" id="5684157">[</span><span class="num" id="5684158">3</span><span class="op" id="5684159">*</span><span class="ident" id="5684160">i</span><span class="op" id="5684161">+</span><span class="num" id="5684162">2</span><span class="op" id="5684163">]</span><span class="op" id="5684164">,</span>&nbsp;<span class="num" id="5684166">0xff</span><span class="op" id="5684170">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684178">for</span>&nbsp;<span class="ident" id="5684182">i</span>&nbsp;<span class="op" id="5684184">:=</span>&nbsp;<span class="ident" id="5684187">np</span><span class="op" id="5684189">;</span>&nbsp;<span class="ident" id="5684191">i</span>&nbsp;<span class="op" id="5684193">&lt;</span>&nbsp;<span class="num" id="5684195">256</span><span class="op" id="5684198">;</span>&nbsp;<span class="ident" id="5684200">i</span><span class="op" id="5684201">++</span>&nbsp;<span class="op" id="5684204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684209">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684285">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684363">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684437">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684508">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684550">d</span><span class="op" id="5684551">.</span><span class="ident" id="5684552">palette</span><span class="op" id="5684559">[</span><span class="ident" id="5684560">i</span><span class="op" id="5684561">]</span>&nbsp;<span class="op" id="5684563">=</span>&nbsp;<span class="ident" id="5684565">color</span><span class="op" id="5684570">.</span><span class="ident" id="5684571">RGBA</span><span class="op" id="5684575">{</span><span class="num" id="5684576">0x00</span><span class="op" id="5684580">,</span>&nbsp;<span class="num" id="5684582">0x00</span><span class="op" id="5684586">,</span>&nbsp;<span class="num" id="5684588">0x00</span><span class="op" id="5684592">,</span>&nbsp;<span class="num" id="5684594">0xff</span><span class="op" id="5684598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684606">d</span><span class="op" id="5684607">.</span><span class="ident" id="5684608">palette</span>&nbsp;<span class="op" id="5684616">=</span>&nbsp;<span class="ident" id="5684618">d</span><span class="op" id="5684619">.</span><span class="ident" id="5684620">palette</span><span class="op" id="5684627">[</span><span class="op" id="5684628">:</span><span class="ident" id="5684629">np</span><span class="op" id="5684631">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684634">case</span>&nbsp;<span class="ident" id="5684639">cbTC8</span><span class="op" id="5684644">,</span>&nbsp;<span class="ident" id="5684646">cbTCA8</span><span class="op" id="5684652">,</span>&nbsp;<span class="ident" id="5684654">cbTC16</span><span class="op" id="5684660">,</span>&nbsp;<span class="ident" id="5684662">cbTCA16</span><span class="op" id="5684669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684673">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684753">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684838">default</span><span class="op" id="5684845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684849">return</span>&nbsp;<span class="ident" id="5684856">FormatError</span><span class="op" id="5684867">(</span><span class="string" id="5684868">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5684895">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684901">return</span>&nbsp;<span class="ident" id="5684908">d</span><span class="op" id="5684909">.</span><span class="ident" id="5684910">verifyChecksum</span><span class="op" id="5684924">(</span><span class="op" id="5684925">)</span><br>
<span class="lineno"></span><span class="op" id="5684927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5684930">func</span>&nbsp;<span class="op" id="5684935">(</span><span class="ident" id="5684936">d</span>&nbsp;<span class="op" id="5684938">*</span><span class="ident" id="5684939">decoder</span><span class="op" id="5684946">)</span>&nbsp;<span class="ident" id="5684948">parsetRNS</span><span class="op" id="5684957">(</span><span class="ident" id="5684958">length</span>&nbsp;<span class="builtintype" id="5684965">uint32</span><span class="op" id="5684971">)</span>&nbsp;<span class="builtintype" id="5684973">error</span>&nbsp;<span class="op" id="5684979">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684982">if</span>&nbsp;<span class="ident" id="5684985">length</span>&nbsp;<span class="op" id="5684992">&gt;</span>&nbsp;<span class="num" id="5684994">256</span>&nbsp;<span class="op" id="5684998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685002">return</span>&nbsp;<span class="ident" id="5685009">FormatError</span><span class="op" id="5685020">(</span><span class="string" id="5685021">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5685038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685044">n</span><span class="op" id="5685045">,</span>&nbsp;<span class="ident" id="5685047">err</span>&nbsp;<span class="op" id="5685051">:=</span>&nbsp;<span class="ident" id="5685054">io</span><span class="op" id="5685056">.</span><span class="ident" id="5685057">ReadFull</span><span class="op" id="5685065">(</span><span class="ident" id="5685066">d</span><span class="op" id="5685067">.</span><span class="ident" id="5685068">r</span><span class="op" id="5685069">,</span>&nbsp;<span class="ident" id="5685071">d</span><span class="op" id="5685072">.</span><span class="ident" id="5685073">tmp</span><span class="op" id="5685076">[</span><span class="op" id="5685077">:</span><span class="ident" id="5685078">length</span><span class="op" id="5685084">]</span><span class="op" id="5685085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685088">if</span>&nbsp;<span class="ident" id="5685091">err</span>&nbsp;<span class="op" id="5685095">!=</span>&nbsp;<span class="ident" id="5685098">nil</span>&nbsp;<span class="op" id="5685102">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685106">return</span>&nbsp;<span class="ident" id="5685113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685121">d</span><span class="op" id="5685122">.</span><span class="ident" id="5685123">crc</span><span class="op" id="5685126">.</span><span class="ident" id="5685127">Write</span><span class="op" id="5685132">(</span><span class="ident" id="5685133">d</span><span class="op" id="5685134">.</span><span class="ident" id="5685135">tmp</span><span class="op" id="5685138">[</span><span class="op" id="5685139">:</span><span class="ident" id="5685140">n</span><span class="op" id="5685141">]</span><span class="op" id="5685142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685145">switch</span>&nbsp;<span class="ident" id="5685152">d</span><span class="op" id="5685153">.</span><span class="ident" id="5685154">cb</span>&nbsp;<span class="op" id="5685157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685160">case</span>&nbsp;<span class="ident" id="5685165">cbG8</span><span class="op" id="5685169">,</span>&nbsp;<span class="ident" id="5685171">cbG16</span><span class="op" id="5685176">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685180">return</span>&nbsp;<span class="ident" id="5685187">UnsupportedError</span><span class="op" id="5685203">(</span><span class="string" id="5685204">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5685228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685231">case</span>&nbsp;<span class="ident" id="5685236">cbTC8</span><span class="op" id="5685241">,</span>&nbsp;<span class="ident" id="5685243">cbTC16</span><span class="op" id="5685249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685253">return</span>&nbsp;<span class="ident" id="5685260">UnsupportedError</span><span class="op" id="5685276">(</span><span class="string" id="5685277">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5685301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685304">case</span>&nbsp;<span class="ident" id="5685309">cbP1</span><span class="op" id="5685313">,</span>&nbsp;<span class="ident" id="5685315">cbP2</span><span class="op" id="5685319">,</span>&nbsp;<span class="ident" id="5685321">cbP4</span><span class="op" id="5685325">,</span>&nbsp;<span class="ident" id="5685327">cbP8</span><span class="op" id="5685331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685335">if</span>&nbsp;<span class="builtinfunc" id="5685338">len</span><span class="op" id="5685341">(</span><span class="ident" id="5685342">d</span><span class="op" id="5685343">.</span><span class="ident" id="5685344">palette</span><span class="op" id="5685351">)</span>&nbsp;<span class="op" id="5685353">&lt;</span>&nbsp;<span class="ident" id="5685355">n</span>&nbsp;<span class="op" id="5685357">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685362">d</span><span class="op" id="5685363">.</span><span class="ident" id="5685364">palette</span>&nbsp;<span class="op" id="5685372">=</span>&nbsp;<span class="ident" id="5685374">d</span><span class="op" id="5685375">.</span><span class="ident" id="5685376">palette</span><span class="op" id="5685383">[</span><span class="op" id="5685384">:</span><span class="ident" id="5685385">n</span><span class="op" id="5685386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685394">for</span>&nbsp;<span class="ident" id="5685398">i</span>&nbsp;<span class="op" id="5685400">:=</span>&nbsp;<span class="num" id="5685403">0</span><span class="op" id="5685404">;</span>&nbsp;<span class="ident" id="5685406">i</span>&nbsp;<span class="op" id="5685408">&lt;</span>&nbsp;<span class="ident" id="5685410">n</span><span class="op" id="5685411">;</span>&nbsp;<span class="ident" id="5685413">i</span><span class="op" id="5685414">++</span>&nbsp;<span class="op" id="5685417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685422">rgba</span>&nbsp;<span class="op" id="5685427">:=</span>&nbsp;<span class="ident" id="5685430">d</span><span class="op" id="5685431">.</span><span class="ident" id="5685432">palette</span><span class="op" id="5685439">[</span><span class="ident" id="5685440">i</span><span class="op" id="5685441">]</span><span class="op" id="5685442">.</span><span class="op" id="5685443">(</span><span class="ident" id="5685444">color</span><span class="op" id="5685449">.</span><span class="ident" id="5685450">RGBA</span><span class="op" id="5685454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685459">d</span><span class="op" id="5685460">.</span><span class="ident" id="5685461">palette</span><span class="op" id="5685468">[</span><span class="ident" id="5685469">i</span><span class="op" id="5685470">]</span>&nbsp;<span class="op" id="5685472">=</span>&nbsp;<span class="ident" id="5685474">color</span><span class="op" id="5685479">.</span><span class="ident" id="5685480">NRGBA</span><span class="op" id="5685485">{</span><span class="ident" id="5685486">rgba</span><span class="op" id="5685490">.</span><span class="ident" id="5685491">R</span><span class="op" id="5685492">,</span>&nbsp;<span class="ident" id="5685494">rgba</span><span class="op" id="5685498">.</span><span class="ident" id="5685499">G</span><span class="op" id="5685500">,</span>&nbsp;<span class="ident" id="5685502">rgba</span><span class="op" id="5685506">.</span><span class="ident" id="5685507">B</span><span class="op" id="5685508">,</span>&nbsp;<span class="ident" id="5685510">d</span><span class="op" id="5685511">.</span><span class="ident" id="5685512">tmp</span><span class="op" id="5685515">[</span><span class="ident" id="5685516">i</span><span class="op" id="5685517">]</span><span class="op" id="5685518">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685525">case</span>&nbsp;<span class="ident" id="5685530">cbGA8</span><span class="op" id="5685535">,</span>&nbsp;<span class="ident" id="5685537">cbGA16</span><span class="op" id="5685543">,</span>&nbsp;<span class="ident" id="5685545">cbTCA8</span><span class="op" id="5685551">,</span>&nbsp;<span class="ident" id="5685553">cbTCA16</span><span class="op" id="5685560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685564">return</span>&nbsp;<span class="ident" id="5685571">FormatError</span><span class="op" id="5685582">(</span><span class="string" id="5685583">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5685610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685616">return</span>&nbsp;<span class="ident" id="5685623">d</span><span class="op" id="5685624">.</span><span class="ident" id="5685625">verifyChecksum</span><span class="op" id="5685639">(</span><span class="op" id="5685640">)</span><br>
<span class="lineno">275</span><span class="op" id="5685642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5685645">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5685722">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5685795">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5685856">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5685936">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5686016">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5686093">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5686148">func</span>&nbsp;<span class="op" id="5686153">(</span><span class="ident" id="5686154">d</span>&nbsp;<span class="op" id="5686156">*</span><span class="ident" id="5686157">decoder</span><span class="op" id="5686164">)</span>&nbsp;<span class="ident" id="5686166">Read</span><span class="op" id="5686170">(</span><span class="ident" id="5686171">p</span>&nbsp;<span class="op" id="5686173">[</span><span class="op" id="5686174">]</span><span class="builtintype" id="5686175">byte</span><span class="op" id="5686179">)</span>&nbsp;<span class="op" id="5686181">(</span><span class="builtintype" id="5686182">int</span><span class="op" id="5686185">,</span>&nbsp;<span class="builtintype" id="5686187">error</span><span class="op" id="5686192">)</span>&nbsp;<span class="op" id="5686194">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686197">if</span>&nbsp;<span class="builtinfunc" id="5686200">len</span><span class="op" id="5686203">(</span><span class="ident" id="5686204">p</span><span class="op" id="5686205">)</span>&nbsp;<span class="op" id="5686207">==</span>&nbsp;<span class="num" id="5686210">0</span>&nbsp;<span class="op" id="5686212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686216">return</span>&nbsp;<span class="num" id="5686223">0</span><span class="op" id="5686224">,</span>&nbsp;<span class="ident" id="5686226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686234">for</span>&nbsp;<span class="ident" id="5686238">d</span><span class="op" id="5686239">.</span><span class="ident" id="5686240">idatLength</span>&nbsp;<span class="op" id="5686251">==</span>&nbsp;<span class="num" id="5686254">0</span>&nbsp;<span class="op" id="5686256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686260">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686333">if</span>&nbsp;<span class="ident" id="5686336">err</span>&nbsp;<span class="op" id="5686340">:=</span>&nbsp;<span class="ident" id="5686343">d</span><span class="op" id="5686344">.</span><span class="ident" id="5686345">verifyChecksum</span><span class="op" id="5686359">(</span><span class="op" id="5686360">)</span><span class="op" id="5686361">;</span>&nbsp;<span class="ident" id="5686363">err</span>&nbsp;<span class="op" id="5686367">!=</span>&nbsp;<span class="ident" id="5686370">nil</span>&nbsp;<span class="op" id="5686374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686379">return</span>&nbsp;<span class="num" id="5686386">0</span><span class="op" id="5686387">,</span>&nbsp;<span class="ident" id="5686389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686399">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686469">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686495">if</span>&nbsp;<span class="ident" id="5686498">_</span><span class="op" id="5686499">,</span>&nbsp;<span class="ident" id="5686501">err</span>&nbsp;<span class="op" id="5686505">:=</span>&nbsp;<span class="ident" id="5686508">io</span><span class="op" id="5686510">.</span><span class="ident" id="5686511">ReadFull</span><span class="op" id="5686519">(</span><span class="ident" id="5686520">d</span><span class="op" id="5686521">.</span><span class="ident" id="5686522">r</span><span class="op" id="5686523">,</span>&nbsp;<span class="ident" id="5686525">d</span><span class="op" id="5686526">.</span><span class="ident" id="5686527">tmp</span><span class="op" id="5686530">[</span><span class="op" id="5686531">:</span><span class="num" id="5686532">8</span><span class="op" id="5686533">]</span><span class="op" id="5686534">)</span><span class="op" id="5686535">;</span>&nbsp;<span class="ident" id="5686537">err</span>&nbsp;<span class="op" id="5686541">!=</span>&nbsp;<span class="ident" id="5686544">nil</span>&nbsp;<span class="op" id="5686548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686553">return</span>&nbsp;<span class="num" id="5686560">0</span><span class="op" id="5686561">,</span>&nbsp;<span class="ident" id="5686563">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686573">d</span><span class="op" id="5686574">.</span><span class="ident" id="5686575">idatLength</span>&nbsp;<span class="op" id="5686586">=</span>&nbsp;<span class="ident" id="5686588">binary</span><span class="op" id="5686594">.</span><span class="ident" id="5686595">BigEndian</span><span class="op" id="5686604">.</span><span class="ident" id="5686605">Uint32</span><span class="op" id="5686611">(</span><span class="ident" id="5686612">d</span><span class="op" id="5686613">.</span><span class="ident" id="5686614">tmp</span><span class="op" id="5686617">[</span><span class="op" id="5686618">:</span><span class="num" id="5686619">4</span><span class="op" id="5686620">]</span><span class="op" id="5686621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686625">if</span>&nbsp;<span class="builtintype" id="5686628">string</span><span class="op" id="5686634">(</span><span class="ident" id="5686635">d</span><span class="op" id="5686636">.</span><span class="ident" id="5686637">tmp</span><span class="op" id="5686640">[</span><span class="num" id="5686641">4</span><span class="op" id="5686642">:</span><span class="num" id="5686643">8</span><span class="op" id="5686644">]</span><span class="op" id="5686645">)</span>&nbsp;<span class="op" id="5686647">!=</span>&nbsp;<span class="string" id="5686650">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5686657">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686662">return</span>&nbsp;<span class="num" id="5686669">0</span><span class="op" id="5686670">,</span>&nbsp;<span class="ident" id="5686672">FormatError</span><span class="op" id="5686683">(</span><span class="string" id="5686684">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5686707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686715">d</span><span class="op" id="5686716">.</span><span class="ident" id="5686717">crc</span><span class="op" id="5686720">.</span><span class="ident" id="5686721">Reset</span><span class="op" id="5686726">(</span><span class="op" id="5686727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686731">d</span><span class="op" id="5686732">.</span><span class="ident" id="5686733">crc</span><span class="op" id="5686736">.</span><span class="ident" id="5686737">Write</span><span class="op" id="5686742">(</span><span class="ident" id="5686743">d</span><span class="op" id="5686744">.</span><span class="ident" id="5686745">tmp</span><span class="op" id="5686748">[</span><span class="num" id="5686749">4</span><span class="op" id="5686750">:</span><span class="num" id="5686751">8</span><span class="op" id="5686752">]</span><span class="op" id="5686753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686756">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686759">if</span>&nbsp;<span class="builtintype" id="5686762">int</span><span class="op" id="5686765">(</span><span class="ident" id="5686766">d</span><span class="op" id="5686767">.</span><span class="ident" id="5686768">idatLength</span><span class="op" id="5686778">)</span>&nbsp;<span class="op" id="5686780">&lt;</span>&nbsp;<span class="num" id="5686782">0</span>&nbsp;<span class="op" id="5686784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686788">return</span>&nbsp;<span class="num" id="5686795">0</span><span class="op" id="5686796">,</span>&nbsp;<span class="ident" id="5686798">UnsupportedError</span><span class="op" id="5686814">(</span><span class="string" id="5686815">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5686843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686849">n</span><span class="op" id="5686850">,</span>&nbsp;<span class="ident" id="5686852">err</span>&nbsp;<span class="op" id="5686856">:=</span>&nbsp;<span class="ident" id="5686859">d</span><span class="op" id="5686860">.</span><span class="ident" id="5686861">r</span><span class="op" id="5686862">.</span><span class="ident" id="5686863">Read</span><span class="op" id="5686867">(</span><span class="ident" id="5686868">p</span><span class="op" id="5686869">[</span><span class="op" id="5686870">:</span><span class="ident" id="5686871">min</span><span class="op" id="5686874">(</span><span class="builtinfunc" id="5686875">len</span><span class="op" id="5686878">(</span><span class="ident" id="5686879">p</span><span class="op" id="5686880">)</span><span class="op" id="5686881">,</span>&nbsp;<span class="builtintype" id="5686883">int</span><span class="op" id="5686886">(</span><span class="ident" id="5686887">d</span><span class="op" id="5686888">.</span><span class="ident" id="5686889">idatLength</span><span class="op" id="5686899">)</span><span class="op" id="5686900">)</span><span class="op" id="5686901">]</span><span class="op" id="5686902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686905">d</span><span class="op" id="5686906">.</span><span class="ident" id="5686907">crc</span><span class="op" id="5686910">.</span><span class="ident" id="5686911">Write</span><span class="op" id="5686916">(</span><span class="ident" id="5686917">p</span><span class="op" id="5686918">[</span><span class="op" id="5686919">:</span><span class="ident" id="5686920">n</span><span class="op" id="5686921">]</span><span class="op" id="5686922">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686925">d</span><span class="op" id="5686926">.</span><span class="ident" id="5686927">idatLength</span>&nbsp;<span class="op" id="5686938">-=</span>&nbsp;<span class="builtintype" id="5686941">uint32</span><span class="op" id="5686947">(</span><span class="ident" id="5686948">n</span><span class="op" id="5686949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686952">return</span>&nbsp;<span class="ident" id="5686959">n</span><span class="op" id="5686960">,</span>&nbsp;<span class="ident" id="5686962">err</span><br>
<span class="lineno"></span><span class="op" id="5686966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5686969">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5687016">func</span>&nbsp;<span class="op" id="5687021">(</span><span class="ident" id="5687022">d</span>&nbsp;<span class="op" id="5687024">*</span><span class="ident" id="5687025">decoder</span><span class="op" id="5687032">)</span>&nbsp;<span class="ident" id="5687034">decode</span><span class="op" id="5687040">(</span><span class="op" id="5687041">)</span>&nbsp;<span class="op" id="5687043">(</span><span class="ident" id="5687044">image</span><span class="op" id="5687049">.</span><span class="ident" id="5687050">Image</span><span class="op" id="5687055">,</span>&nbsp;<span class="builtintype" id="5687057">error</span><span class="op" id="5687062">)</span>&nbsp;<span class="op" id="5687064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687067">r</span><span class="op" id="5687068">,</span>&nbsp;<span class="ident" id="5687070">err</span>&nbsp;<span class="op" id="5687074">:=</span>&nbsp;<span class="ident" id="5687077">zlib</span><span class="op" id="5687081">.</span><span class="ident" id="5687082">NewReader</span><span class="op" id="5687091">(</span><span class="ident" id="5687092">d</span><span class="op" id="5687093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687096">if</span>&nbsp;<span class="ident" id="5687099">err</span>&nbsp;<span class="op" id="5687103">!=</span>&nbsp;<span class="ident" id="5687106">nil</span>&nbsp;<span class="op" id="5687110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687114">return</span>&nbsp;<span class="ident" id="5687121">nil</span><span class="op" id="5687124">,</span>&nbsp;<span class="ident" id="5687126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687131">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687134">defer</span>&nbsp;<span class="ident" id="5687140">r</span><span class="op" id="5687141">.</span><span class="ident" id="5687142">Close</span><span class="op" id="5687147">(</span><span class="op" id="5687148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687151">var</span>&nbsp;<span class="ident" id="5687155">img</span>&nbsp;<span class="ident" id="5687159">image</span><span class="op" id="5687164">.</span><span class="ident" id="5687165">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687172">if</span>&nbsp;<span class="ident" id="5687175">d</span><span class="op" id="5687176">.</span><span class="ident" id="5687177">interlace</span>&nbsp;<span class="op" id="5687187">==</span>&nbsp;<span class="ident" id="5687190">itNone</span>&nbsp;<span class="op" id="5687197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687201">img</span><span class="op" id="5687204">,</span>&nbsp;<span class="ident" id="5687206">err</span>&nbsp;<span class="op" id="5687210">=</span>&nbsp;<span class="ident" id="5687212">d</span><span class="op" id="5687213">.</span><span class="ident" id="5687214">readImagePass</span><span class="op" id="5687227">(</span><span class="ident" id="5687228">r</span><span class="op" id="5687229">,</span>&nbsp;<span class="num" id="5687231">0</span><span class="op" id="5687232">,</span>&nbsp;<span class="builtintype" id="5687234">false</span><span class="op" id="5687239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687242">}</span>&nbsp;<span class="keyword" id="5687244">else</span>&nbsp;<span class="keyword" id="5687249">if</span>&nbsp;<span class="ident" id="5687252">d</span><span class="op" id="5687253">.</span><span class="ident" id="5687254">interlace</span>&nbsp;<span class="op" id="5687264">==</span>&nbsp;<span class="ident" id="5687267">itAdam7</span>&nbsp;<span class="op" id="5687275">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687279">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687325">img</span><span class="op" id="5687328">,</span>&nbsp;<span class="ident" id="5687330">err</span>&nbsp;<span class="op" id="5687334">=</span>&nbsp;<span class="ident" id="5687336">d</span><span class="op" id="5687337">.</span><span class="ident" id="5687338">readImagePass</span><span class="op" id="5687351">(</span><span class="ident" id="5687352">nil</span><span class="op" id="5687355">,</span>&nbsp;<span class="num" id="5687357">0</span><span class="op" id="5687358">,</span>&nbsp;<span class="builtintype" id="5687360">true</span><span class="op" id="5687364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687368">for</span>&nbsp;<span class="ident" id="5687372">pass</span>&nbsp;<span class="op" id="5687377">:=</span>&nbsp;<span class="num" id="5687380">0</span><span class="op" id="5687381">;</span>&nbsp;<span class="ident" id="5687383">pass</span>&nbsp;<span class="op" id="5687388">&lt;</span>&nbsp;<span class="num" id="5687390">7</span><span class="op" id="5687391">;</span>&nbsp;<span class="ident" id="5687393">pass</span><span class="op" id="5687397">++</span>&nbsp;<span class="op" id="5687400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687405">imagePass</span><span class="op" id="5687414">,</span>&nbsp;<span class="ident" id="5687416">err</span>&nbsp;<span class="op" id="5687420">:=</span>&nbsp;<span class="ident" id="5687423">d</span><span class="op" id="5687424">.</span><span class="ident" id="5687425">readImagePass</span><span class="op" id="5687438">(</span><span class="ident" id="5687439">r</span><span class="op" id="5687440">,</span>&nbsp;<span class="ident" id="5687442">pass</span><span class="op" id="5687446">,</span>&nbsp;<span class="builtintype" id="5687448">false</span><span class="op" id="5687453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687458">if</span>&nbsp;<span class="ident" id="5687461">err</span>&nbsp;<span class="op" id="5687465">!=</span>&nbsp;<span class="ident" id="5687468">nil</span>&nbsp;<span class="op" id="5687472">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687478">return</span>&nbsp;<span class="ident" id="5687485">nil</span><span class="op" id="5687488">,</span>&nbsp;<span class="ident" id="5687490">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687502">d</span><span class="op" id="5687503">.</span><span class="ident" id="5687504">mergePassInto</span><span class="op" id="5687517">(</span><span class="ident" id="5687518">img</span><span class="op" id="5687521">,</span>&nbsp;<span class="ident" id="5687523">imagePass</span><span class="op" id="5687532">,</span>&nbsp;<span class="ident" id="5687534">pass</span><span class="op" id="5687538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687545">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5687549">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687597">n</span>&nbsp;<span class="op" id="5687599">:=</span>&nbsp;<span class="num" id="5687602">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687605">for</span>&nbsp;<span class="ident" id="5687609">i</span>&nbsp;<span class="op" id="5687611">:=</span>&nbsp;<span class="num" id="5687614">0</span><span class="op" id="5687615">;</span>&nbsp;<span class="ident" id="5687617">n</span>&nbsp;<span class="op" id="5687619">==</span>&nbsp;<span class="num" id="5687622">0</span>&nbsp;<span class="op" id="5687624">&amp;&amp;</span>&nbsp;<span class="ident" id="5687627">err</span>&nbsp;<span class="op" id="5687631">==</span>&nbsp;<span class="ident" id="5687634">nil</span><span class="op" id="5687637">;</span>&nbsp;<span class="ident" id="5687639">i</span><span class="op" id="5687640">++</span>&nbsp;<span class="op" id="5687643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687647">if</span>&nbsp;<span class="ident" id="5687650">i</span>&nbsp;<span class="op" id="5687652">==</span>&nbsp;<span class="num" id="5687655">100</span>&nbsp;<span class="op" id="5687659">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687664">return</span>&nbsp;<span class="ident" id="5687671">nil</span><span class="op" id="5687674">,</span>&nbsp;<span class="ident" id="5687676">io</span><span class="op" id="5687678">.</span><span class="ident" id="5687679">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687699">n</span><span class="op" id="5687700">,</span>&nbsp;<span class="ident" id="5687702">err</span>&nbsp;<span class="op" id="5687706">=</span>&nbsp;<span class="ident" id="5687708">r</span><span class="op" id="5687709">.</span><span class="ident" id="5687710">Read</span><span class="op" id="5687714">(</span><span class="ident" id="5687715">d</span><span class="op" id="5687716">.</span><span class="ident" id="5687717">tmp</span><span class="op" id="5687720">[</span><span class="op" id="5687721">:</span><span class="num" id="5687722">1</span><span class="op" id="5687723">]</span><span class="op" id="5687724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687730">if</span>&nbsp;<span class="ident" id="5687733">err</span>&nbsp;<span class="op" id="5687737">!=</span>&nbsp;<span class="ident" id="5687740">nil</span>&nbsp;<span class="op" id="5687744">&amp;&amp;</span>&nbsp;<span class="ident" id="5687747">err</span>&nbsp;<span class="op" id="5687751">!=</span>&nbsp;<span class="ident" id="5687754">io</span><span class="op" id="5687756">.</span><span class="ident" id="5687757">EOF</span>&nbsp;<span class="op" id="5687761">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687765">return</span>&nbsp;<span class="ident" id="5687772">nil</span><span class="op" id="5687775">,</span>&nbsp;<span class="ident" id="5687777">FormatError</span><span class="op" id="5687788">(</span><span class="ident" id="5687789">err</span><span class="op" id="5687792">.</span><span class="ident" id="5687793">Error</span><span class="op" id="5687798">(</span><span class="op" id="5687799">)</span><span class="op" id="5687800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687806">if</span>&nbsp;<span class="ident" id="5687809">n</span>&nbsp;<span class="op" id="5687811">!=</span>&nbsp;<span class="num" id="5687814">0</span>&nbsp;<span class="op" id="5687816">||</span>&nbsp;<span class="ident" id="5687819">d</span><span class="op" id="5687820">.</span><span class="ident" id="5687821">idatLength</span>&nbsp;<span class="op" id="5687832">!=</span>&nbsp;<span class="num" id="5687835">0</span>&nbsp;<span class="op" id="5687837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687841">return</span>&nbsp;<span class="ident" id="5687848">nil</span><span class="op" id="5687851">,</span>&nbsp;<span class="ident" id="5687853">FormatError</span><span class="op" id="5687864">(</span><span class="string" id="5687865">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5687886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687889">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687893">return</span>&nbsp;<span class="ident" id="5687900">img</span><span class="op" id="5687903">,</span>&nbsp;<span class="ident" id="5687905">nil</span><br>
<span class="lineno"></span><span class="op" id="5687909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5687912">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5687992">func</span>&nbsp;<span class="op" id="5687997">(</span><span class="ident" id="5687998">d</span>&nbsp;<span class="op" id="5688000">*</span><span class="ident" id="5688001">decoder</span><span class="op" id="5688008">)</span>&nbsp;<span class="ident" id="5688010">readImagePass</span><span class="op" id="5688023">(</span><span class="ident" id="5688024">r</span>&nbsp;<span class="ident" id="5688026">io</span><span class="op" id="5688028">.</span><span class="ident" id="5688029">Reader</span><span class="op" id="5688035">,</span>&nbsp;<span class="ident" id="5688037">pass</span>&nbsp;<span class="builtintype" id="5688042">int</span><span class="op" id="5688045">,</span>&nbsp;<span class="ident" id="5688047">allocateOnly</span>&nbsp;<span class="builtintype" id="5688060">bool</span><span class="op" id="5688064">)</span>&nbsp;<span class="op" id="5688066">(</span><span class="ident" id="5688067">image</span><span class="op" id="5688072">.</span><span class="ident" id="5688073">Image</span><span class="op" id="5688078">,</span>&nbsp;<span class="builtintype" id="5688080">error</span><span class="op" id="5688085">)</span>&nbsp;<span class="op" id="5688087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688090">var</span>&nbsp;<span class="ident" id="5688094">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5688107">int</span>&nbsp;<span class="op" id="5688111">=</span>&nbsp;<span class="num" id="5688113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688116">pixOffset</span>&nbsp;<span class="op" id="5688126">:=</span>&nbsp;<span class="num" id="5688129">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688132">var</span>&nbsp;<span class="op" id="5688136">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688140">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688149">*</span><span class="ident" id="5688150">image</span><span class="op" id="5688155">.</span><span class="ident" id="5688156">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688163">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688172">*</span><span class="ident" id="5688173">image</span><span class="op" id="5688178">.</span><span class="ident" id="5688179">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688186">paletted</span>&nbsp;<span class="op" id="5688195">*</span><span class="ident" id="5688196">image</span><span class="op" id="5688201">.</span><span class="ident" id="5688202">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688213">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5688222">*</span><span class="ident" id="5688223">image</span><span class="op" id="5688228">.</span><span class="ident" id="5688229">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688237">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5688246">*</span><span class="ident" id="5688247">image</span><span class="op" id="5688252">.</span><span class="ident" id="5688253">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688262">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5688271">*</span><span class="ident" id="5688272">image</span><span class="op" id="5688277">.</span><span class="ident" id="5688278">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688287">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5688296">*</span><span class="ident" id="5688297">image</span><span class="op" id="5688302">.</span><span class="ident" id="5688303">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688313">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5688322">image</span><span class="op" id="5688327">.</span><span class="ident" id="5688328">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688338">width</span><span class="op" id="5688343">,</span>&nbsp;<span class="ident" id="5688345">height</span>&nbsp;<span class="op" id="5688352">:=</span>&nbsp;<span class="ident" id="5688355">d</span><span class="op" id="5688356">.</span><span class="ident" id="5688357">width</span><span class="op" id="5688362">,</span>&nbsp;<span class="ident" id="5688364">d</span><span class="op" id="5688365">.</span><span class="ident" id="5688366">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688374">if</span>&nbsp;<span class="ident" id="5688377">d</span><span class="op" id="5688378">.</span><span class="ident" id="5688379">interlace</span>&nbsp;<span class="op" id="5688389">==</span>&nbsp;<span class="ident" id="5688392">itAdam7</span>&nbsp;<span class="op" id="5688400">&amp;&amp;</span>&nbsp;<span class="op" id="5688403">!</span><span class="ident" id="5688404">allocateOnly</span>&nbsp;<span class="op" id="5688417">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688421">p</span>&nbsp;<span class="op" id="5688423">:=</span>&nbsp;<span class="ident" id="5688426">interlacing</span><span class="op" id="5688437">[</span><span class="ident" id="5688438">pass</span><span class="op" id="5688442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688446">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688524">width</span>&nbsp;<span class="op" id="5688530">=</span>&nbsp;<span class="op" id="5688532">(</span><span class="ident" id="5688533">width</span>&nbsp;<span class="op" id="5688539">-</span>&nbsp;<span class="ident" id="5688541">p</span><span class="op" id="5688542">.</span><span class="ident" id="5688543">xOffset</span>&nbsp;<span class="op" id="5688551">+</span>&nbsp;<span class="ident" id="5688553">p</span><span class="op" id="5688554">.</span><span class="ident" id="5688555">xFactor</span>&nbsp;<span class="op" id="5688563">-</span>&nbsp;<span class="num" id="5688565">1</span><span class="op" id="5688566">)</span>&nbsp;<span class="op" id="5688568">/</span>&nbsp;<span class="ident" id="5688570">p</span><span class="op" id="5688571">.</span><span class="ident" id="5688572">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688582">height</span>&nbsp;<span class="op" id="5688589">=</span>&nbsp;<span class="op" id="5688591">(</span><span class="ident" id="5688592">height</span>&nbsp;<span class="op" id="5688599">-</span>&nbsp;<span class="ident" id="5688601">p</span><span class="op" id="5688602">.</span><span class="ident" id="5688603">yOffset</span>&nbsp;<span class="op" id="5688611">+</span>&nbsp;<span class="ident" id="5688613">p</span><span class="op" id="5688614">.</span><span class="ident" id="5688615">yFactor</span>&nbsp;<span class="op" id="5688623">-</span>&nbsp;<span class="num" id="5688625">1</span><span class="op" id="5688626">)</span>&nbsp;<span class="op" id="5688628">/</span>&nbsp;<span class="ident" id="5688630">p</span><span class="op" id="5688631">.</span><span class="ident" id="5688632">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688641">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688644">switch</span>&nbsp;<span class="ident" id="5688651">d</span><span class="op" id="5688652">.</span><span class="ident" id="5688653">cb</span>&nbsp;<span class="op" id="5688656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688659">case</span>&nbsp;<span class="ident" id="5688664">cbG1</span><span class="op" id="5688668">,</span>&nbsp;<span class="ident" id="5688670">cbG2</span><span class="op" id="5688674">,</span>&nbsp;<span class="ident" id="5688676">cbG4</span><span class="op" id="5688680">,</span>&nbsp;<span class="ident" id="5688682">cbG8</span><span class="op" id="5688686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688690">bitsPerPixel</span>&nbsp;<span class="op" id="5688703">=</span>&nbsp;<span class="ident" id="5688705">d</span><span class="op" id="5688706">.</span><span class="ident" id="5688707">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688715">gray</span>&nbsp;<span class="op" id="5688720">=</span>&nbsp;<span class="ident" id="5688722">image</span><span class="op" id="5688727">.</span><span class="ident" id="5688728">NewGray</span><span class="op" id="5688735">(</span><span class="ident" id="5688736">image</span><span class="op" id="5688741">.</span><span class="ident" id="5688742">Rect</span><span class="op" id="5688746">(</span><span class="num" id="5688747">0</span><span class="op" id="5688748">,</span>&nbsp;<span class="num" id="5688750">0</span><span class="op" id="5688751">,</span>&nbsp;<span class="ident" id="5688753">width</span><span class="op" id="5688758">,</span>&nbsp;<span class="ident" id="5688760">height</span><span class="op" id="5688766">)</span><span class="op" id="5688767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688771">img</span>&nbsp;<span class="op" id="5688775">=</span>&nbsp;<span class="ident" id="5688777">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688783">case</span>&nbsp;<span class="ident" id="5688788">cbGA8</span><span class="op" id="5688793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688797">bitsPerPixel</span>&nbsp;<span class="op" id="5688810">=</span>&nbsp;<span class="num" id="5688812">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688817">nrgba</span>&nbsp;<span class="op" id="5688823">=</span>&nbsp;<span class="ident" id="5688825">image</span><span class="op" id="5688830">.</span><span class="ident" id="5688831">NewNRGBA</span><span class="op" id="5688839">(</span><span class="ident" id="5688840">image</span><span class="op" id="5688845">.</span><span class="ident" id="5688846">Rect</span><span class="op" id="5688850">(</span><span class="num" id="5688851">0</span><span class="op" id="5688852">,</span>&nbsp;<span class="num" id="5688854">0</span><span class="op" id="5688855">,</span>&nbsp;<span class="ident" id="5688857">width</span><span class="op" id="5688862">,</span>&nbsp;<span class="ident" id="5688864">height</span><span class="op" id="5688870">)</span><span class="op" id="5688871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688875">img</span>&nbsp;<span class="op" id="5688879">=</span>&nbsp;<span class="ident" id="5688881">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688888">case</span>&nbsp;<span class="ident" id="5688893">cbTC8</span><span class="op" id="5688898">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688902">bitsPerPixel</span>&nbsp;<span class="op" id="5688915">=</span>&nbsp;<span class="num" id="5688917">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688922">rgba</span>&nbsp;<span class="op" id="5688927">=</span>&nbsp;<span class="ident" id="5688929">image</span><span class="op" id="5688934">.</span><span class="ident" id="5688935">NewRGBA</span><span class="op" id="5688942">(</span><span class="ident" id="5688943">image</span><span class="op" id="5688948">.</span><span class="ident" id="5688949">Rect</span><span class="op" id="5688953">(</span><span class="num" id="5688954">0</span><span class="op" id="5688955">,</span>&nbsp;<span class="num" id="5688957">0</span><span class="op" id="5688958">,</span>&nbsp;<span class="ident" id="5688960">width</span><span class="op" id="5688965">,</span>&nbsp;<span class="ident" id="5688967">height</span><span class="op" id="5688973">)</span><span class="op" id="5688974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688978">img</span>&nbsp;<span class="op" id="5688982">=</span>&nbsp;<span class="ident" id="5688984">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688990">case</span>&nbsp;<span class="ident" id="5688995">cbP1</span><span class="op" id="5688999">,</span>&nbsp;<span class="ident" id="5689001">cbP2</span><span class="op" id="5689005">,</span>&nbsp;<span class="ident" id="5689007">cbP4</span><span class="op" id="5689011">,</span>&nbsp;<span class="ident" id="5689013">cbP8</span><span class="op" id="5689017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689021">bitsPerPixel</span>&nbsp;<span class="op" id="5689034">=</span>&nbsp;<span class="ident" id="5689036">d</span><span class="op" id="5689037">.</span><span class="ident" id="5689038">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689046">paletted</span>&nbsp;<span class="op" id="5689055">=</span>&nbsp;<span class="ident" id="5689057">image</span><span class="op" id="5689062">.</span><span class="ident" id="5689063">NewPaletted</span><span class="op" id="5689074">(</span><span class="ident" id="5689075">image</span><span class="op" id="5689080">.</span><span class="ident" id="5689081">Rect</span><span class="op" id="5689085">(</span><span class="num" id="5689086">0</span><span class="op" id="5689087">,</span>&nbsp;<span class="num" id="5689089">0</span><span class="op" id="5689090">,</span>&nbsp;<span class="ident" id="5689092">width</span><span class="op" id="5689097">,</span>&nbsp;<span class="ident" id="5689099">height</span><span class="op" id="5689105">)</span><span class="op" id="5689106">,</span>&nbsp;<span class="ident" id="5689108">d</span><span class="op" id="5689109">.</span><span class="ident" id="5689110">palette</span><span class="op" id="5689117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689121">img</span>&nbsp;<span class="op" id="5689125">=</span>&nbsp;<span class="ident" id="5689127">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689137">case</span>&nbsp;<span class="ident" id="5689142">cbTCA8</span><span class="op" id="5689148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689152">bitsPerPixel</span>&nbsp;<span class="op" id="5689165">=</span>&nbsp;<span class="num" id="5689167">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689172">nrgba</span>&nbsp;<span class="op" id="5689178">=</span>&nbsp;<span class="ident" id="5689180">image</span><span class="op" id="5689185">.</span><span class="ident" id="5689186">NewNRGBA</span><span class="op" id="5689194">(</span><span class="ident" id="5689195">image</span><span class="op" id="5689200">.</span><span class="ident" id="5689201">Rect</span><span class="op" id="5689205">(</span><span class="num" id="5689206">0</span><span class="op" id="5689207">,</span>&nbsp;<span class="num" id="5689209">0</span><span class="op" id="5689210">,</span>&nbsp;<span class="ident" id="5689212">width</span><span class="op" id="5689217">,</span>&nbsp;<span class="ident" id="5689219">height</span><span class="op" id="5689225">)</span><span class="op" id="5689226">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689230">img</span>&nbsp;<span class="op" id="5689234">=</span>&nbsp;<span class="ident" id="5689236">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689243">case</span>&nbsp;<span class="ident" id="5689248">cbG16</span><span class="op" id="5689253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689257">bitsPerPixel</span>&nbsp;<span class="op" id="5689270">=</span>&nbsp;<span class="num" id="5689272">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689277">gray16</span>&nbsp;<span class="op" id="5689284">=</span>&nbsp;<span class="ident" id="5689286">image</span><span class="op" id="5689291">.</span><span class="ident" id="5689292">NewGray16</span><span class="op" id="5689301">(</span><span class="ident" id="5689302">image</span><span class="op" id="5689307">.</span><span class="ident" id="5689308">Rect</span><span class="op" id="5689312">(</span><span class="num" id="5689313">0</span><span class="op" id="5689314">,</span>&nbsp;<span class="num" id="5689316">0</span><span class="op" id="5689317">,</span>&nbsp;<span class="ident" id="5689319">width</span><span class="op" id="5689324">,</span>&nbsp;<span class="ident" id="5689326">height</span><span class="op" id="5689332">)</span><span class="op" id="5689333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689337">img</span>&nbsp;<span class="op" id="5689341">=</span>&nbsp;<span class="ident" id="5689343">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689351">case</span>&nbsp;<span class="ident" id="5689356">cbGA16</span><span class="op" id="5689362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689366">bitsPerPixel</span>&nbsp;<span class="op" id="5689379">=</span>&nbsp;<span class="num" id="5689381">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689386">nrgba64</span>&nbsp;<span class="op" id="5689394">=</span>&nbsp;<span class="ident" id="5689396">image</span><span class="op" id="5689401">.</span><span class="ident" id="5689402">NewNRGBA64</span><span class="op" id="5689412">(</span><span class="ident" id="5689413">image</span><span class="op" id="5689418">.</span><span class="ident" id="5689419">Rect</span><span class="op" id="5689423">(</span><span class="num" id="5689424">0</span><span class="op" id="5689425">,</span>&nbsp;<span class="num" id="5689427">0</span><span class="op" id="5689428">,</span>&nbsp;<span class="ident" id="5689430">width</span><span class="op" id="5689435">,</span>&nbsp;<span class="ident" id="5689437">height</span><span class="op" id="5689443">)</span><span class="op" id="5689444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689448">img</span>&nbsp;<span class="op" id="5689452">=</span>&nbsp;<span class="ident" id="5689454">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689463">case</span>&nbsp;<span class="ident" id="5689468">cbTC16</span><span class="op" id="5689474">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689478">bitsPerPixel</span>&nbsp;<span class="op" id="5689491">=</span>&nbsp;<span class="num" id="5689493">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689498">rgba64</span>&nbsp;<span class="op" id="5689505">=</span>&nbsp;<span class="ident" id="5689507">image</span><span class="op" id="5689512">.</span><span class="ident" id="5689513">NewRGBA64</span><span class="op" id="5689522">(</span><span class="ident" id="5689523">image</span><span class="op" id="5689528">.</span><span class="ident" id="5689529">Rect</span><span class="op" id="5689533">(</span><span class="num" id="5689534">0</span><span class="op" id="5689535">,</span>&nbsp;<span class="num" id="5689537">0</span><span class="op" id="5689538">,</span>&nbsp;<span class="ident" id="5689540">width</span><span class="op" id="5689545">,</span>&nbsp;<span class="ident" id="5689547">height</span><span class="op" id="5689553">)</span><span class="op" id="5689554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689558">img</span>&nbsp;<span class="op" id="5689562">=</span>&nbsp;<span class="ident" id="5689564">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689572">case</span>&nbsp;<span class="ident" id="5689577">cbTCA16</span><span class="op" id="5689584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689588">bitsPerPixel</span>&nbsp;<span class="op" id="5689601">=</span>&nbsp;<span class="num" id="5689603">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689608">nrgba64</span>&nbsp;<span class="op" id="5689616">=</span>&nbsp;<span class="ident" id="5689618">image</span><span class="op" id="5689623">.</span><span class="ident" id="5689624">NewNRGBA64</span><span class="op" id="5689634">(</span><span class="ident" id="5689635">image</span><span class="op" id="5689640">.</span><span class="ident" id="5689641">Rect</span><span class="op" id="5689645">(</span><span class="num" id="5689646">0</span><span class="op" id="5689647">,</span>&nbsp;<span class="num" id="5689649">0</span><span class="op" id="5689650">,</span>&nbsp;<span class="ident" id="5689652">width</span><span class="op" id="5689657">,</span>&nbsp;<span class="ident" id="5689659">height</span><span class="op" id="5689665">)</span><span class="op" id="5689666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689670">img</span>&nbsp;<span class="op" id="5689674">=</span>&nbsp;<span class="ident" id="5689676">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689688">if</span>&nbsp;<span class="ident" id="5689691">allocateOnly</span>&nbsp;<span class="op" id="5689704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689708">return</span>&nbsp;<span class="ident" id="5689715">img</span><span class="op" id="5689718">,</span>&nbsp;<span class="ident" id="5689720">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689728">bytesPerPixel</span>&nbsp;<span class="op" id="5689742">:=</span>&nbsp;<span class="op" id="5689745">(</span><span class="ident" id="5689746">bitsPerPixel</span>&nbsp;<span class="op" id="5689759">+</span>&nbsp;<span class="num" id="5689761">7</span><span class="op" id="5689762">)</span>&nbsp;<span class="op" id="5689764">/</span>&nbsp;<span class="num" id="5689766">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689770">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689832">rowSize</span>&nbsp;<span class="op" id="5689840">:=</span>&nbsp;<span class="num" id="5689843">1</span>&nbsp;<span class="op" id="5689845">+</span>&nbsp;<span class="op" id="5689847">(</span><span class="ident" id="5689848">bitsPerPixel</span><span class="op" id="5689860">*</span><span class="ident" id="5689861">width</span><span class="op" id="5689866">+</span><span class="num" id="5689867">7</span><span class="op" id="5689868">)</span><span class="op" id="5689869">/</span><span class="num" id="5689870">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5689873">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689935">cr</span>&nbsp;<span class="op" id="5689938">:=</span>&nbsp;<span class="builtinfunc" id="5689941">make</span><span class="op" id="5689945">(</span><span class="op" id="5689946">[</span><span class="op" id="5689947">]</span><span class="builtintype" id="5689948">uint8</span><span class="op" id="5689953">,</span>&nbsp;<span class="ident" id="5689955">rowSize</span><span class="op" id="5689962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689965">pr</span>&nbsp;<span class="op" id="5689968">:=</span>&nbsp;<span class="builtinfunc" id="5689971">make</span><span class="op" id="5689975">(</span><span class="op" id="5689976">[</span><span class="op" id="5689977">]</span><span class="builtintype" id="5689978">uint8</span><span class="op" id="5689983">,</span>&nbsp;<span class="ident" id="5689985">rowSize</span><span class="op" id="5689992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689996">for</span>&nbsp;<span class="ident" id="5690000">y</span>&nbsp;<span class="op" id="5690002">:=</span>&nbsp;<span class="num" id="5690005">0</span><span class="op" id="5690006">;</span>&nbsp;<span class="ident" id="5690008">y</span>&nbsp;<span class="op" id="5690010">&lt;</span>&nbsp;<span class="ident" id="5690012">height</span><span class="op" id="5690018">;</span>&nbsp;<span class="ident" id="5690020">y</span><span class="op" id="5690021">++</span>&nbsp;<span class="op" id="5690024">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690028">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690062">_</span><span class="op" id="5690063">,</span>&nbsp;<span class="ident" id="5690065">err</span>&nbsp;<span class="op" id="5690069">:=</span>&nbsp;<span class="ident" id="5690072">io</span><span class="op" id="5690074">.</span><span class="ident" id="5690075">ReadFull</span><span class="op" id="5690083">(</span><span class="ident" id="5690084">r</span><span class="op" id="5690085">,</span>&nbsp;<span class="ident" id="5690087">cr</span><span class="op" id="5690089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690093">if</span>&nbsp;<span class="ident" id="5690096">err</span>&nbsp;<span class="op" id="5690100">!=</span>&nbsp;<span class="ident" id="5690103">nil</span>&nbsp;<span class="op" id="5690107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690112">return</span>&nbsp;<span class="ident" id="5690119">nil</span><span class="op" id="5690122">,</span>&nbsp;<span class="ident" id="5690124">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690130">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690135">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690158">cdat</span>&nbsp;<span class="op" id="5690163">:=</span>&nbsp;<span class="ident" id="5690166">cr</span><span class="op" id="5690168">[</span><span class="num" id="5690169">1</span><span class="op" id="5690170">:</span><span class="op" id="5690171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690175">pdat</span>&nbsp;<span class="op" id="5690180">:=</span>&nbsp;<span class="ident" id="5690183">pr</span><span class="op" id="5690185">[</span><span class="num" id="5690186">1</span><span class="op" id="5690187">:</span><span class="op" id="5690188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690192">switch</span>&nbsp;<span class="ident" id="5690199">cr</span><span class="op" id="5690201">[</span><span class="num" id="5690202">0</span><span class="op" id="5690203">]</span>&nbsp;<span class="op" id="5690205">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690209">case</span>&nbsp;<span class="ident" id="5690214">ftNone</span><span class="op" id="5690220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690225">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690237">case</span>&nbsp;<span class="ident" id="5690242">ftSub</span><span class="op" id="5690247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690252">for</span>&nbsp;<span class="ident" id="5690256">i</span>&nbsp;<span class="op" id="5690258">:=</span>&nbsp;<span class="ident" id="5690261">bytesPerPixel</span><span class="op" id="5690274">;</span>&nbsp;<span class="ident" id="5690276">i</span>&nbsp;<span class="op" id="5690278">&lt;</span>&nbsp;<span class="builtinfunc" id="5690280">len</span><span class="op" id="5690283">(</span><span class="ident" id="5690284">cdat</span><span class="op" id="5690288">)</span><span class="op" id="5690289">;</span>&nbsp;<span class="ident" id="5690291">i</span><span class="op" id="5690292">++</span>&nbsp;<span class="op" id="5690295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690301">cdat</span><span class="op" id="5690305">[</span><span class="ident" id="5690306">i</span><span class="op" id="5690307">]</span>&nbsp;<span class="op" id="5690309">+=</span>&nbsp;<span class="ident" id="5690312">cdat</span><span class="op" id="5690316">[</span><span class="ident" id="5690317">i</span><span class="op" id="5690318">-</span><span class="ident" id="5690319">bytesPerPixel</span><span class="op" id="5690332">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690341">case</span>&nbsp;<span class="ident" id="5690346">ftUp</span><span class="op" id="5690350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690355">for</span>&nbsp;<span class="ident" id="5690359">i</span><span class="op" id="5690360">,</span>&nbsp;<span class="ident" id="5690362">p</span>&nbsp;<span class="op" id="5690364">:=</span>&nbsp;<span class="keyword" id="5690367">range</span>&nbsp;<span class="ident" id="5690373">pdat</span>&nbsp;<span class="op" id="5690378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690384">cdat</span><span class="op" id="5690388">[</span><span class="ident" id="5690389">i</span><span class="op" id="5690390">]</span>&nbsp;<span class="op" id="5690392">+=</span>&nbsp;<span class="ident" id="5690395">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690400">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690404">case</span>&nbsp;<span class="ident" id="5690409">ftAverage</span><span class="op" id="5690418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690423">for</span>&nbsp;<span class="ident" id="5690427">i</span>&nbsp;<span class="op" id="5690429">:=</span>&nbsp;<span class="num" id="5690432">0</span><span class="op" id="5690433">;</span>&nbsp;<span class="ident" id="5690435">i</span>&nbsp;<span class="op" id="5690437">&lt;</span>&nbsp;<span class="ident" id="5690439">bytesPerPixel</span><span class="op" id="5690452">;</span>&nbsp;<span class="ident" id="5690454">i</span><span class="op" id="5690455">++</span>&nbsp;<span class="op" id="5690458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690464">cdat</span><span class="op" id="5690468">[</span><span class="ident" id="5690469">i</span><span class="op" id="5690470">]</span>&nbsp;<span class="op" id="5690472">+=</span>&nbsp;<span class="ident" id="5690475">pdat</span><span class="op" id="5690479">[</span><span class="ident" id="5690480">i</span><span class="op" id="5690481">]</span>&nbsp;<span class="op" id="5690483">/</span>&nbsp;<span class="num" id="5690485">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690495">for</span>&nbsp;<span class="ident" id="5690499">i</span>&nbsp;<span class="op" id="5690501">:=</span>&nbsp;<span class="ident" id="5690504">bytesPerPixel</span><span class="op" id="5690517">;</span>&nbsp;<span class="ident" id="5690519">i</span>&nbsp;<span class="op" id="5690521">&lt;</span>&nbsp;<span class="builtinfunc" id="5690523">len</span><span class="op" id="5690526">(</span><span class="ident" id="5690527">cdat</span><span class="op" id="5690531">)</span><span class="op" id="5690532">;</span>&nbsp;<span class="ident" id="5690534">i</span><span class="op" id="5690535">++</span>&nbsp;<span class="op" id="5690538">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690544">cdat</span><span class="op" id="5690548">[</span><span class="ident" id="5690549">i</span><span class="op" id="5690550">]</span>&nbsp;<span class="op" id="5690552">+=</span>&nbsp;<span class="builtintype" id="5690555">uint8</span><span class="op" id="5690560">(</span><span class="op" id="5690561">(</span><span class="builtintype" id="5690562">int</span><span class="op" id="5690565">(</span><span class="ident" id="5690566">cdat</span><span class="op" id="5690570">[</span><span class="ident" id="5690571">i</span><span class="op" id="5690572">-</span><span class="ident" id="5690573">bytesPerPixel</span><span class="op" id="5690586">]</span><span class="op" id="5690587">)</span>&nbsp;<span class="op" id="5690589">+</span>&nbsp;<span class="builtintype" id="5690591">int</span><span class="op" id="5690594">(</span><span class="ident" id="5690595">pdat</span><span class="op" id="5690599">[</span><span class="ident" id="5690600">i</span><span class="op" id="5690601">]</span><span class="op" id="5690602">)</span><span class="op" id="5690603">)</span>&nbsp;<span class="op" id="5690605">/</span>&nbsp;<span class="num" id="5690607">2</span><span class="op" id="5690608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690617">case</span>&nbsp;<span class="ident" id="5690622">ftPaeth</span><span class="op" id="5690629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690634">filterPaeth</span><span class="op" id="5690645">(</span><span class="ident" id="5690646">cdat</span><span class="op" id="5690650">,</span>&nbsp;<span class="ident" id="5690652">pdat</span><span class="op" id="5690656">,</span>&nbsp;<span class="ident" id="5690658">bytesPerPixel</span><span class="op" id="5690671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690675">default</span><span class="op" id="5690682">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690687">return</span>&nbsp;<span class="ident" id="5690694">nil</span><span class="op" id="5690697">,</span>&nbsp;<span class="ident" id="5690699">FormatError</span><span class="op" id="5690710">(</span><span class="string" id="5690711">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5690728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690737">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690772">switch</span>&nbsp;<span class="ident" id="5690779">d</span><span class="op" id="5690780">.</span><span class="ident" id="5690781">cb</span>&nbsp;<span class="op" id="5690784">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690788">case</span>&nbsp;<span class="ident" id="5690793">cbG1</span><span class="op" id="5690797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690802">for</span>&nbsp;<span class="ident" id="5690806">x</span>&nbsp;<span class="op" id="5690808">:=</span>&nbsp;<span class="num" id="5690811">0</span><span class="op" id="5690812">;</span>&nbsp;<span class="ident" id="5690814">x</span>&nbsp;<span class="op" id="5690816">&lt;</span>&nbsp;<span class="ident" id="5690818">width</span><span class="op" id="5690823">;</span>&nbsp;<span class="ident" id="5690825">x</span>&nbsp;<span class="op" id="5690827">+=</span>&nbsp;<span class="num" id="5690830">8</span>&nbsp;<span class="op" id="5690832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690838">b</span>&nbsp;<span class="op" id="5690840">:=</span>&nbsp;<span class="ident" id="5690843">cdat</span><span class="op" id="5690847">[</span><span class="ident" id="5690848">x</span><span class="op" id="5690849">/</span><span class="num" id="5690850">8</span><span class="op" id="5690851">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690857">for</span>&nbsp;<span class="ident" id="5690861">x2</span>&nbsp;<span class="op" id="5690864">:=</span>&nbsp;<span class="num" id="5690867">0</span><span class="op" id="5690868">;</span>&nbsp;<span class="ident" id="5690870">x2</span>&nbsp;<span class="op" id="5690873">&lt;</span>&nbsp;<span class="num" id="5690875">8</span>&nbsp;<span class="op" id="5690877">&amp;&amp;</span>&nbsp;<span class="ident" id="5690880">x</span><span class="op" id="5690881">+</span><span class="ident" id="5690882">x2</span>&nbsp;<span class="op" id="5690885">&lt;</span>&nbsp;<span class="ident" id="5690887">width</span><span class="op" id="5690892">;</span>&nbsp;<span class="ident" id="5690894">x2</span><span class="op" id="5690896">++</span>&nbsp;<span class="op" id="5690899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690906">gray</span><span class="op" id="5690910">.</span><span class="ident" id="5690911">SetGray</span><span class="op" id="5690918">(</span><span class="ident" id="5690919">x</span><span class="op" id="5690920">+</span><span class="ident" id="5690921">x2</span><span class="op" id="5690923">,</span>&nbsp;<span class="ident" id="5690925">y</span><span class="op" id="5690926">,</span>&nbsp;<span class="ident" id="5690928">color</span><span class="op" id="5690933">.</span><span class="ident" id="5690934">Gray</span><span class="op" id="5690938">{</span><span class="op" id="5690939">(</span><span class="ident" id="5690940">b</span>&nbsp;<span class="op" id="5690942">&gt;&gt;</span>&nbsp;<span class="num" id="5690945">7</span><span class="op" id="5690946">)</span>&nbsp;<span class="op" id="5690948">*</span>&nbsp;<span class="num" id="5690950">0xff</span><span class="op" id="5690954">}</span><span class="op" id="5690955">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690962">b</span>&nbsp;<span class="op" id="5690964">&lt;&lt;=</span>&nbsp;<span class="num" id="5690968">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690983">case</span>&nbsp;<span class="ident" id="5690988">cbG2</span><span class="op" id="5690992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690997">for</span>&nbsp;<span class="ident" id="5691001">x</span>&nbsp;<span class="op" id="5691003">:=</span>&nbsp;<span class="num" id="5691006">0</span><span class="op" id="5691007">;</span>&nbsp;<span class="ident" id="5691009">x</span>&nbsp;<span class="op" id="5691011">&lt;</span>&nbsp;<span class="ident" id="5691013">width</span><span class="op" id="5691018">;</span>&nbsp;<span class="ident" id="5691020">x</span>&nbsp;<span class="op" id="5691022">+=</span>&nbsp;<span class="num" id="5691025">4</span>&nbsp;<span class="op" id="5691027">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691033">b</span>&nbsp;<span class="op" id="5691035">:=</span>&nbsp;<span class="ident" id="5691038">cdat</span><span class="op" id="5691042">[</span><span class="ident" id="5691043">x</span><span class="op" id="5691044">/</span><span class="num" id="5691045">4</span><span class="op" id="5691046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691052">for</span>&nbsp;<span class="ident" id="5691056">x2</span>&nbsp;<span class="op" id="5691059">:=</span>&nbsp;<span class="num" id="5691062">0</span><span class="op" id="5691063">;</span>&nbsp;<span class="ident" id="5691065">x2</span>&nbsp;<span class="op" id="5691068">&lt;</span>&nbsp;<span class="num" id="5691070">4</span>&nbsp;<span class="op" id="5691072">&amp;&amp;</span>&nbsp;<span class="ident" id="5691075">x</span><span class="op" id="5691076">+</span><span class="ident" id="5691077">x2</span>&nbsp;<span class="op" id="5691080">&lt;</span>&nbsp;<span class="ident" id="5691082">width</span><span class="op" id="5691087">;</span>&nbsp;<span class="ident" id="5691089">x2</span><span class="op" id="5691091">++</span>&nbsp;<span class="op" id="5691094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691101">gray</span><span class="op" id="5691105">.</span><span class="ident" id="5691106">SetGray</span><span class="op" id="5691113">(</span><span class="ident" id="5691114">x</span><span class="op" id="5691115">+</span><span class="ident" id="5691116">x2</span><span class="op" id="5691118">,</span>&nbsp;<span class="ident" id="5691120">y</span><span class="op" id="5691121">,</span>&nbsp;<span class="ident" id="5691123">color</span><span class="op" id="5691128">.</span><span class="ident" id="5691129">Gray</span><span class="op" id="5691133">{</span><span class="op" id="5691134">(</span><span class="ident" id="5691135">b</span>&nbsp;<span class="op" id="5691137">&gt;&gt;</span>&nbsp;<span class="num" id="5691140">6</span><span class="op" id="5691141">)</span>&nbsp;<span class="op" id="5691143">*</span>&nbsp;<span class="num" id="5691145">0x55</span><span class="op" id="5691149">}</span><span class="op" id="5691150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691157">b</span>&nbsp;<span class="op" id="5691159">&lt;&lt;=</span>&nbsp;<span class="num" id="5691163">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691169">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691178">case</span>&nbsp;<span class="ident" id="5691183">cbG4</span><span class="op" id="5691187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691192">for</span>&nbsp;<span class="ident" id="5691196">x</span>&nbsp;<span class="op" id="5691198">:=</span>&nbsp;<span class="num" id="5691201">0</span><span class="op" id="5691202">;</span>&nbsp;<span class="ident" id="5691204">x</span>&nbsp;<span class="op" id="5691206">&lt;</span>&nbsp;<span class="ident" id="5691208">width</span><span class="op" id="5691213">;</span>&nbsp;<span class="ident" id="5691215">x</span>&nbsp;<span class="op" id="5691217">+=</span>&nbsp;<span class="num" id="5691220">2</span>&nbsp;<span class="op" id="5691222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691228">b</span>&nbsp;<span class="op" id="5691230">:=</span>&nbsp;<span class="ident" id="5691233">cdat</span><span class="op" id="5691237">[</span><span class="ident" id="5691238">x</span><span class="op" id="5691239">/</span><span class="num" id="5691240">2</span><span class="op" id="5691241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691247">for</span>&nbsp;<span class="ident" id="5691251">x2</span>&nbsp;<span class="op" id="5691254">:=</span>&nbsp;<span class="num" id="5691257">0</span><span class="op" id="5691258">;</span>&nbsp;<span class="ident" id="5691260">x2</span>&nbsp;<span class="op" id="5691263">&lt;</span>&nbsp;<span class="num" id="5691265">2</span>&nbsp;<span class="op" id="5691267">&amp;&amp;</span>&nbsp;<span class="ident" id="5691270">x</span><span class="op" id="5691271">+</span><span class="ident" id="5691272">x2</span>&nbsp;<span class="op" id="5691275">&lt;</span>&nbsp;<span class="ident" id="5691277">width</span><span class="op" id="5691282">;</span>&nbsp;<span class="ident" id="5691284">x2</span><span class="op" id="5691286">++</span>&nbsp;<span class="op" id="5691289">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691296">gray</span><span class="op" id="5691300">.</span><span class="ident" id="5691301">SetGray</span><span class="op" id="5691308">(</span><span class="ident" id="5691309">x</span><span class="op" id="5691310">+</span><span class="ident" id="5691311">x2</span><span class="op" id="5691313">,</span>&nbsp;<span class="ident" id="5691315">y</span><span class="op" id="5691316">,</span>&nbsp;<span class="ident" id="5691318">color</span><span class="op" id="5691323">.</span><span class="ident" id="5691324">Gray</span><span class="op" id="5691328">{</span><span class="op" id="5691329">(</span><span class="ident" id="5691330">b</span>&nbsp;<span class="op" id="5691332">&gt;&gt;</span>&nbsp;<span class="num" id="5691335">4</span><span class="op" id="5691336">)</span>&nbsp;<span class="op" id="5691338">*</span>&nbsp;<span class="num" id="5691340">0x11</span><span class="op" id="5691344">}</span><span class="op" id="5691345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691352">b</span>&nbsp;<span class="op" id="5691354">&lt;&lt;=</span>&nbsp;<span class="num" id="5691358">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691373">case</span>&nbsp;<span class="ident" id="5691378">cbG8</span><span class="op" id="5691382">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5691387">copy</span><span class="op" id="5691391">(</span><span class="ident" id="5691392">gray</span><span class="op" id="5691396">.</span><span class="ident" id="5691397">Pix</span><span class="op" id="5691400">[</span><span class="ident" id="5691401">pixOffset</span><span class="op" id="5691410">:</span><span class="op" id="5691411">]</span><span class="op" id="5691412">,</span>&nbsp;<span class="ident" id="5691414">cdat</span><span class="op" id="5691418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691423">pixOffset</span>&nbsp;<span class="op" id="5691433">+=</span>&nbsp;<span class="ident" id="5691436">gray</span><span class="op" id="5691440">.</span><span class="ident" id="5691441">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691450">case</span>&nbsp;<span class="ident" id="5691455">cbGA8</span><span class="op" id="5691460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691465">for</span>&nbsp;<span class="ident" id="5691469">x</span>&nbsp;<span class="op" id="5691471">:=</span>&nbsp;<span class="num" id="5691474">0</span><span class="op" id="5691475">;</span>&nbsp;<span class="ident" id="5691477">x</span>&nbsp;<span class="op" id="5691479">&lt;</span>&nbsp;<span class="ident" id="5691481">width</span><span class="op" id="5691486">;</span>&nbsp;<span class="ident" id="5691488">x</span><span class="op" id="5691489">++</span>&nbsp;<span class="op" id="5691492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691498">ycol</span>&nbsp;<span class="op" id="5691503">:=</span>&nbsp;<span class="ident" id="5691506">cdat</span><span class="op" id="5691510">[</span><span class="num" id="5691511">2</span><span class="op" id="5691512">*</span><span class="ident" id="5691513">x</span><span class="op" id="5691514">+</span><span class="num" id="5691515">0</span><span class="op" id="5691516">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691522">nrgba</span><span class="op" id="5691527">.</span><span class="ident" id="5691528">SetNRGBA</span><span class="op" id="5691536">(</span><span class="ident" id="5691537">x</span><span class="op" id="5691538">,</span>&nbsp;<span class="ident" id="5691540">y</span><span class="op" id="5691541">,</span>&nbsp;<span class="ident" id="5691543">color</span><span class="op" id="5691548">.</span><span class="ident" id="5691549">NRGBA</span><span class="op" id="5691554">{</span><span class="ident" id="5691555">ycol</span><span class="op" id="5691559">,</span>&nbsp;<span class="ident" id="5691561">ycol</span><span class="op" id="5691565">,</span>&nbsp;<span class="ident" id="5691567">ycol</span><span class="op" id="5691571">,</span>&nbsp;<span class="ident" id="5691573">cdat</span><span class="op" id="5691577">[</span><span class="num" id="5691578">2</span><span class="op" id="5691579">*</span><span class="ident" id="5691580">x</span><span class="op" id="5691581">+</span><span class="num" id="5691582">1</span><span class="op" id="5691583">]</span><span class="op" id="5691584">}</span><span class="op" id="5691585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691594">case</span>&nbsp;<span class="ident" id="5691599">cbTC8</span><span class="op" id="5691604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691609">pix</span><span class="op" id="5691612">,</span>&nbsp;<span class="ident" id="5691614">i</span><span class="op" id="5691615">,</span>&nbsp;<span class="ident" id="5691617">j</span>&nbsp;<span class="op" id="5691619">:=</span>&nbsp;<span class="ident" id="5691622">rgba</span><span class="op" id="5691626">.</span><span class="ident" id="5691627">Pix</span><span class="op" id="5691630">,</span>&nbsp;<span class="ident" id="5691632">pixOffset</span><span class="op" id="5691641">,</span>&nbsp;<span class="num" id="5691643">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691648">for</span>&nbsp;<span class="ident" id="5691652">x</span>&nbsp;<span class="op" id="5691654">:=</span>&nbsp;<span class="num" id="5691657">0</span><span class="op" id="5691658">;</span>&nbsp;<span class="ident" id="5691660">x</span>&nbsp;<span class="op" id="5691662">&lt;</span>&nbsp;<span class="ident" id="5691664">width</span><span class="op" id="5691669">;</span>&nbsp;<span class="ident" id="5691671">x</span><span class="op" id="5691672">++</span>&nbsp;<span class="op" id="5691675">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691681">pix</span><span class="op" id="5691684">[</span><span class="ident" id="5691685">i</span><span class="op" id="5691686">+</span><span class="num" id="5691687">0</span><span class="op" id="5691688">]</span>&nbsp;<span class="op" id="5691690">=</span>&nbsp;<span class="ident" id="5691692">cdat</span><span class="op" id="5691696">[</span><span class="ident" id="5691697">j</span><span class="op" id="5691698">+</span><span class="num" id="5691699">0</span><span class="op" id="5691700">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691706">pix</span><span class="op" id="5691709">[</span><span class="ident" id="5691710">i</span><span class="op" id="5691711">+</span><span class="num" id="5691712">1</span><span class="op" id="5691713">]</span>&nbsp;<span class="op" id="5691715">=</span>&nbsp;<span class="ident" id="5691717">cdat</span><span class="op" id="5691721">[</span><span class="ident" id="5691722">j</span><span class="op" id="5691723">+</span><span class="num" id="5691724">1</span><span class="op" id="5691725">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691731">pix</span><span class="op" id="5691734">[</span><span class="ident" id="5691735">i</span><span class="op" id="5691736">+</span><span class="num" id="5691737">2</span><span class="op" id="5691738">]</span>&nbsp;<span class="op" id="5691740">=</span>&nbsp;<span class="ident" id="5691742">cdat</span><span class="op" id="5691746">[</span><span class="ident" id="5691747">j</span><span class="op" id="5691748">+</span><span class="num" id="5691749">2</span><span class="op" id="5691750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691756">pix</span><span class="op" id="5691759">[</span><span class="ident" id="5691760">i</span><span class="op" id="5691761">+</span><span class="num" id="5691762">3</span><span class="op" id="5691763">]</span>&nbsp;<span class="op" id="5691765">=</span>&nbsp;<span class="num" id="5691767">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691776">i</span>&nbsp;<span class="op" id="5691778">+=</span>&nbsp;<span class="num" id="5691781">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691787">j</span>&nbsp;<span class="op" id="5691789">+=</span>&nbsp;<span class="num" id="5691792">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691802">pixOffset</span>&nbsp;<span class="op" id="5691812">+=</span>&nbsp;<span class="ident" id="5691815">rgba</span><span class="op" id="5691819">.</span><span class="ident" id="5691820">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691829">case</span>&nbsp;<span class="ident" id="5691834">cbP1</span><span class="op" id="5691838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691843">for</span>&nbsp;<span class="ident" id="5691847">x</span>&nbsp;<span class="op" id="5691849">:=</span>&nbsp;<span class="num" id="5691852">0</span><span class="op" id="5691853">;</span>&nbsp;<span class="ident" id="5691855">x</span>&nbsp;<span class="op" id="5691857">&lt;</span>&nbsp;<span class="ident" id="5691859">width</span><span class="op" id="5691864">;</span>&nbsp;<span class="ident" id="5691866">x</span>&nbsp;<span class="op" id="5691868">+=</span>&nbsp;<span class="num" id="5691871">8</span>&nbsp;<span class="op" id="5691873">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691879">b</span>&nbsp;<span class="op" id="5691881">:=</span>&nbsp;<span class="ident" id="5691884">cdat</span><span class="op" id="5691888">[</span><span class="ident" id="5691889">x</span><span class="op" id="5691890">/</span><span class="num" id="5691891">8</span><span class="op" id="5691892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691898">for</span>&nbsp;<span class="ident" id="5691902">x2</span>&nbsp;<span class="op" id="5691905">:=</span>&nbsp;<span class="num" id="5691908">0</span><span class="op" id="5691909">;</span>&nbsp;<span class="ident" id="5691911">x2</span>&nbsp;<span class="op" id="5691914">&lt;</span>&nbsp;<span class="num" id="5691916">8</span>&nbsp;<span class="op" id="5691918">&amp;&amp;</span>&nbsp;<span class="ident" id="5691921">x</span><span class="op" id="5691922">+</span><span class="ident" id="5691923">x2</span>&nbsp;<span class="op" id="5691926">&lt;</span>&nbsp;<span class="ident" id="5691928">width</span><span class="op" id="5691933">;</span>&nbsp;<span class="ident" id="5691935">x2</span><span class="op" id="5691937">++</span>&nbsp;<span class="op" id="5691940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691947">idx</span>&nbsp;<span class="op" id="5691951">:=</span>&nbsp;<span class="ident" id="5691954">b</span>&nbsp;<span class="op" id="5691956">&gt;&gt;</span>&nbsp;<span class="num" id="5691959">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691966">if</span>&nbsp;<span class="builtinfunc" id="5691969">len</span><span class="op" id="5691972">(</span><span class="ident" id="5691973">paletted</span><span class="op" id="5691981">.</span><span class="ident" id="5691982">Palette</span><span class="op" id="5691989">)</span>&nbsp;<span class="op" id="5691991">&lt;=</span>&nbsp;<span class="builtintype" id="5691994">int</span><span class="op" id="5691997">(</span><span class="ident" id="5691998">idx</span><span class="op" id="5692001">)</span>&nbsp;<span class="op" id="5692003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692011">paletted</span><span class="op" id="5692019">.</span><span class="ident" id="5692020">Palette</span>&nbsp;<span class="op" id="5692028">=</span>&nbsp;<span class="ident" id="5692030">paletted</span><span class="op" id="5692038">.</span><span class="ident" id="5692039">Palette</span><span class="op" id="5692046">[</span><span class="op" id="5692047">:</span><span class="builtintype" id="5692048">int</span><span class="op" id="5692051">(</span><span class="ident" id="5692052">idx</span><span class="op" id="5692055">)</span><span class="op" id="5692056">+</span><span class="num" id="5692057">1</span><span class="op" id="5692058">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692072">paletted</span><span class="op" id="5692080">.</span><span class="ident" id="5692081">SetColorIndex</span><span class="op" id="5692094">(</span><span class="ident" id="5692095">x</span><span class="op" id="5692096">+</span><span class="ident" id="5692097">x2</span><span class="op" id="5692099">,</span>&nbsp;<span class="ident" id="5692101">y</span><span class="op" id="5692102">,</span>&nbsp;<span class="ident" id="5692104">idx</span><span class="op" id="5692107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692114">b</span>&nbsp;<span class="op" id="5692116">&lt;&lt;=</span>&nbsp;<span class="num" id="5692120">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692131">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692135">case</span>&nbsp;<span class="ident" id="5692140">cbP2</span><span class="op" id="5692144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692149">for</span>&nbsp;<span class="ident" id="5692153">x</span>&nbsp;<span class="op" id="5692155">:=</span>&nbsp;<span class="num" id="5692158">0</span><span class="op" id="5692159">;</span>&nbsp;<span class="ident" id="5692161">x</span>&nbsp;<span class="op" id="5692163">&lt;</span>&nbsp;<span class="ident" id="5692165">width</span><span class="op" id="5692170">;</span>&nbsp;<span class="ident" id="5692172">x</span>&nbsp;<span class="op" id="5692174">+=</span>&nbsp;<span class="num" id="5692177">4</span>&nbsp;<span class="op" id="5692179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692185">b</span>&nbsp;<span class="op" id="5692187">:=</span>&nbsp;<span class="ident" id="5692190">cdat</span><span class="op" id="5692194">[</span><span class="ident" id="5692195">x</span><span class="op" id="5692196">/</span><span class="num" id="5692197">4</span><span class="op" id="5692198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692204">for</span>&nbsp;<span class="ident" id="5692208">x2</span>&nbsp;<span class="op" id="5692211">:=</span>&nbsp;<span class="num" id="5692214">0</span><span class="op" id="5692215">;</span>&nbsp;<span class="ident" id="5692217">x2</span>&nbsp;<span class="op" id="5692220">&lt;</span>&nbsp;<span class="num" id="5692222">4</span>&nbsp;<span class="op" id="5692224">&amp;&amp;</span>&nbsp;<span class="ident" id="5692227">x</span><span class="op" id="5692228">+</span><span class="ident" id="5692229">x2</span>&nbsp;<span class="op" id="5692232">&lt;</span>&nbsp;<span class="ident" id="5692234">width</span><span class="op" id="5692239">;</span>&nbsp;<span class="ident" id="5692241">x2</span><span class="op" id="5692243">++</span>&nbsp;<span class="op" id="5692246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692253">idx</span>&nbsp;<span class="op" id="5692257">:=</span>&nbsp;<span class="ident" id="5692260">b</span>&nbsp;<span class="op" id="5692262">&gt;&gt;</span>&nbsp;<span class="num" id="5692265">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692272">if</span>&nbsp;<span class="builtinfunc" id="5692275">len</span><span class="op" id="5692278">(</span><span class="ident" id="5692279">paletted</span><span class="op" id="5692287">.</span><span class="ident" id="5692288">Palette</span><span class="op" id="5692295">)</span>&nbsp;<span class="op" id="5692297">&lt;=</span>&nbsp;<span class="builtintype" id="5692300">int</span><span class="op" id="5692303">(</span><span class="ident" id="5692304">idx</span><span class="op" id="5692307">)</span>&nbsp;<span class="op" id="5692309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692317">paletted</span><span class="op" id="5692325">.</span><span class="ident" id="5692326">Palette</span>&nbsp;<span class="op" id="5692334">=</span>&nbsp;<span class="ident" id="5692336">paletted</span><span class="op" id="5692344">.</span><span class="ident" id="5692345">Palette</span><span class="op" id="5692352">[</span><span class="op" id="5692353">:</span><span class="builtintype" id="5692354">int</span><span class="op" id="5692357">(</span><span class="ident" id="5692358">idx</span><span class="op" id="5692361">)</span><span class="op" id="5692362">+</span><span class="num" id="5692363">1</span><span class="op" id="5692364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692378">paletted</span><span class="op" id="5692386">.</span><span class="ident" id="5692387">SetColorIndex</span><span class="op" id="5692400">(</span><span class="ident" id="5692401">x</span><span class="op" id="5692402">+</span><span class="ident" id="5692403">x2</span><span class="op" id="5692405">,</span>&nbsp;<span class="ident" id="5692407">y</span><span class="op" id="5692408">,</span>&nbsp;<span class="ident" id="5692410">idx</span><span class="op" id="5692413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692420">b</span>&nbsp;<span class="op" id="5692422">&lt;&lt;=</span>&nbsp;<span class="num" id="5692426">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692441">case</span>&nbsp;<span class="ident" id="5692446">cbP4</span><span class="op" id="5692450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692455">for</span>&nbsp;<span class="ident" id="5692459">x</span>&nbsp;<span class="op" id="5692461">:=</span>&nbsp;<span class="num" id="5692464">0</span><span class="op" id="5692465">;</span>&nbsp;<span class="ident" id="5692467">x</span>&nbsp;<span class="op" id="5692469">&lt;</span>&nbsp;<span class="ident" id="5692471">width</span><span class="op" id="5692476">;</span>&nbsp;<span class="ident" id="5692478">x</span>&nbsp;<span class="op" id="5692480">+=</span>&nbsp;<span class="num" id="5692483">2</span>&nbsp;<span class="op" id="5692485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692491">b</span>&nbsp;<span class="op" id="5692493">:=</span>&nbsp;<span class="ident" id="5692496">cdat</span><span class="op" id="5692500">[</span><span class="ident" id="5692501">x</span><span class="op" id="5692502">/</span><span class="num" id="5692503">2</span><span class="op" id="5692504">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692510">for</span>&nbsp;<span class="ident" id="5692514">x2</span>&nbsp;<span class="op" id="5692517">:=</span>&nbsp;<span class="num" id="5692520">0</span><span class="op" id="5692521">;</span>&nbsp;<span class="ident" id="5692523">x2</span>&nbsp;<span class="op" id="5692526">&lt;</span>&nbsp;<span class="num" id="5692528">2</span>&nbsp;<span class="op" id="5692530">&amp;&amp;</span>&nbsp;<span class="ident" id="5692533">x</span><span class="op" id="5692534">+</span><span class="ident" id="5692535">x2</span>&nbsp;<span class="op" id="5692538">&lt;</span>&nbsp;<span class="ident" id="5692540">width</span><span class="op" id="5692545">;</span>&nbsp;<span class="ident" id="5692547">x2</span><span class="op" id="5692549">++</span>&nbsp;<span class="op" id="5692552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692559">idx</span>&nbsp;<span class="op" id="5692563">:=</span>&nbsp;<span class="ident" id="5692566">b</span>&nbsp;<span class="op" id="5692568">&gt;&gt;</span>&nbsp;<span class="num" id="5692571">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692578">if</span>&nbsp;<span class="builtinfunc" id="5692581">len</span><span class="op" id="5692584">(</span><span class="ident" id="5692585">paletted</span><span class="op" id="5692593">.</span><span class="ident" id="5692594">Palette</span><span class="op" id="5692601">)</span>&nbsp;<span class="op" id="5692603">&lt;=</span>&nbsp;<span class="builtintype" id="5692606">int</span><span class="op" id="5692609">(</span><span class="ident" id="5692610">idx</span><span class="op" id="5692613">)</span>&nbsp;<span class="op" id="5692615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692623">paletted</span><span class="op" id="5692631">.</span><span class="ident" id="5692632">Palette</span>&nbsp;<span class="op" id="5692640">=</span>&nbsp;<span class="ident" id="5692642">paletted</span><span class="op" id="5692650">.</span><span class="ident" id="5692651">Palette</span><span class="op" id="5692658">[</span><span class="op" id="5692659">:</span><span class="builtintype" id="5692660">int</span><span class="op" id="5692663">(</span><span class="ident" id="5692664">idx</span><span class="op" id="5692667">)</span><span class="op" id="5692668">+</span><span class="num" id="5692669">1</span><span class="op" id="5692670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692677">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692684">paletted</span><span class="op" id="5692692">.</span><span class="ident" id="5692693">SetColorIndex</span><span class="op" id="5692706">(</span><span class="ident" id="5692707">x</span><span class="op" id="5692708">+</span><span class="ident" id="5692709">x2</span><span class="op" id="5692711">,</span>&nbsp;<span class="ident" id="5692713">y</span><span class="op" id="5692714">,</span>&nbsp;<span class="ident" id="5692716">idx</span><span class="op" id="5692719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692726">b</span>&nbsp;<span class="op" id="5692728">&lt;&lt;=</span>&nbsp;<span class="num" id="5692732">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692747">case</span>&nbsp;<span class="ident" id="5692752">cbP8</span><span class="op" id="5692756">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692761">if</span>&nbsp;<span class="builtinfunc" id="5692764">len</span><span class="op" id="5692767">(</span><span class="ident" id="5692768">paletted</span><span class="op" id="5692776">.</span><span class="ident" id="5692777">Palette</span><span class="op" id="5692784">)</span>&nbsp;<span class="op" id="5692786">!=</span>&nbsp;<span class="num" id="5692789">255</span>&nbsp;<span class="op" id="5692793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692799">for</span>&nbsp;<span class="ident" id="5692803">x</span>&nbsp;<span class="op" id="5692805">:=</span>&nbsp;<span class="num" id="5692808">0</span><span class="op" id="5692809">;</span>&nbsp;<span class="ident" id="5692811">x</span>&nbsp;<span class="op" id="5692813">&lt;</span>&nbsp;<span class="ident" id="5692815">width</span><span class="op" id="5692820">;</span>&nbsp;<span class="ident" id="5692822">x</span><span class="op" id="5692823">++</span>&nbsp;<span class="op" id="5692826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692833">if</span>&nbsp;<span class="builtinfunc" id="5692836">len</span><span class="op" id="5692839">(</span><span class="ident" id="5692840">paletted</span><span class="op" id="5692848">.</span><span class="ident" id="5692849">Palette</span><span class="op" id="5692856">)</span>&nbsp;<span class="op" id="5692858">&lt;=</span>&nbsp;<span class="builtintype" id="5692861">int</span><span class="op" id="5692864">(</span><span class="ident" id="5692865">cdat</span><span class="op" id="5692869">[</span><span class="ident" id="5692870">x</span><span class="op" id="5692871">]</span><span class="op" id="5692872">)</span>&nbsp;<span class="op" id="5692874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692882">paletted</span><span class="op" id="5692890">.</span><span class="ident" id="5692891">Palette</span>&nbsp;<span class="op" id="5692899">=</span>&nbsp;<span class="ident" id="5692901">paletted</span><span class="op" id="5692909">.</span><span class="ident" id="5692910">Palette</span><span class="op" id="5692917">[</span><span class="op" id="5692918">:</span><span class="builtintype" id="5692919">int</span><span class="op" id="5692922">(</span><span class="ident" id="5692923">cdat</span><span class="op" id="5692927">[</span><span class="ident" id="5692928">x</span><span class="op" id="5692929">]</span><span class="op" id="5692930">)</span><span class="op" id="5692931">+</span><span class="num" id="5692932">1</span><span class="op" id="5692933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692940">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5692956">copy</span><span class="op" id="5692960">(</span><span class="ident" id="5692961">paletted</span><span class="op" id="5692969">.</span><span class="ident" id="5692970">Pix</span><span class="op" id="5692973">[</span><span class="ident" id="5692974">pixOffset</span><span class="op" id="5692983">:</span><span class="op" id="5692984">]</span><span class="op" id="5692985">,</span>&nbsp;<span class="ident" id="5692987">cdat</span><span class="op" id="5692991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692996">pixOffset</span>&nbsp;<span class="op" id="5693006">+=</span>&nbsp;<span class="ident" id="5693009">paletted</span><span class="op" id="5693017">.</span><span class="ident" id="5693018">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693027">case</span>&nbsp;<span class="ident" id="5693032">cbTCA8</span><span class="op" id="5693038">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5693043">copy</span><span class="op" id="5693047">(</span><span class="ident" id="5693048">nrgba</span><span class="op" id="5693053">.</span><span class="ident" id="5693054">Pix</span><span class="op" id="5693057">[</span><span class="ident" id="5693058">pixOffset</span><span class="op" id="5693067">:</span><span class="op" id="5693068">]</span><span class="op" id="5693069">,</span>&nbsp;<span class="ident" id="5693071">cdat</span><span class="op" id="5693075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693080">pixOffset</span>&nbsp;<span class="op" id="5693090">+=</span>&nbsp;<span class="ident" id="5693093">nrgba</span><span class="op" id="5693098">.</span><span class="ident" id="5693099">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693108">case</span>&nbsp;<span class="ident" id="5693113">cbG16</span><span class="op" id="5693118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693123">for</span>&nbsp;<span class="ident" id="5693127">x</span>&nbsp;<span class="op" id="5693129">:=</span>&nbsp;<span class="num" id="5693132">0</span><span class="op" id="5693133">;</span>&nbsp;<span class="ident" id="5693135">x</span>&nbsp;<span class="op" id="5693137">&lt;</span>&nbsp;<span class="ident" id="5693139">width</span><span class="op" id="5693144">;</span>&nbsp;<span class="ident" id="5693146">x</span><span class="op" id="5693147">++</span>&nbsp;<span class="op" id="5693150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693156">ycol</span>&nbsp;<span class="op" id="5693161">:=</span>&nbsp;<span class="builtintype" id="5693164">uint16</span><span class="op" id="5693170">(</span><span class="ident" id="5693171">cdat</span><span class="op" id="5693175">[</span><span class="num" id="5693176">2</span><span class="op" id="5693177">*</span><span class="ident" id="5693178">x</span><span class="op" id="5693179">+</span><span class="num" id="5693180">0</span><span class="op" id="5693181">]</span><span class="op" id="5693182">)</span><span class="op" id="5693183">&lt;&lt;</span><span class="num" id="5693185">8</span>&nbsp;<span class="op" id="5693187">|</span>&nbsp;<span class="builtintype" id="5693189">uint16</span><span class="op" id="5693195">(</span><span class="ident" id="5693196">cdat</span><span class="op" id="5693200">[</span><span class="num" id="5693201">2</span><span class="op" id="5693202">*</span><span class="ident" id="5693203">x</span><span class="op" id="5693204">+</span><span class="num" id="5693205">1</span><span class="op" id="5693206">]</span><span class="op" id="5693207">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693213">gray16</span><span class="op" id="5693219">.</span><span class="ident" id="5693220">SetGray16</span><span class="op" id="5693229">(</span><span class="ident" id="5693230">x</span><span class="op" id="5693231">,</span>&nbsp;<span class="ident" id="5693233">y</span><span class="op" id="5693234">,</span>&nbsp;<span class="ident" id="5693236">color</span><span class="op" id="5693241">.</span><span class="ident" id="5693242">Gray16</span><span class="op" id="5693248">{</span><span class="ident" id="5693249">ycol</span><span class="op" id="5693253">}</span><span class="op" id="5693254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693263">case</span>&nbsp;<span class="ident" id="5693268">cbGA16</span><span class="op" id="5693274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693279">for</span>&nbsp;<span class="ident" id="5693283">x</span>&nbsp;<span class="op" id="5693285">:=</span>&nbsp;<span class="num" id="5693288">0</span><span class="op" id="5693289">;</span>&nbsp;<span class="ident" id="5693291">x</span>&nbsp;<span class="op" id="5693293">&lt;</span>&nbsp;<span class="ident" id="5693295">width</span><span class="op" id="5693300">;</span>&nbsp;<span class="ident" id="5693302">x</span><span class="op" id="5693303">++</span>&nbsp;<span class="op" id="5693306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693312">ycol</span>&nbsp;<span class="op" id="5693317">:=</span>&nbsp;<span class="builtintype" id="5693320">uint16</span><span class="op" id="5693326">(</span><span class="ident" id="5693327">cdat</span><span class="op" id="5693331">[</span><span class="num" id="5693332">4</span><span class="op" id="5693333">*</span><span class="ident" id="5693334">x</span><span class="op" id="5693335">+</span><span class="num" id="5693336">0</span><span class="op" id="5693337">]</span><span class="op" id="5693338">)</span><span class="op" id="5693339">&lt;&lt;</span><span class="num" id="5693341">8</span>&nbsp;<span class="op" id="5693343">|</span>&nbsp;<span class="builtintype" id="5693345">uint16</span><span class="op" id="5693351">(</span><span class="ident" id="5693352">cdat</span><span class="op" id="5693356">[</span><span class="num" id="5693357">4</span><span class="op" id="5693358">*</span><span class="ident" id="5693359">x</span><span class="op" id="5693360">+</span><span class="num" id="5693361">1</span><span class="op" id="5693362">]</span><span class="op" id="5693363">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693369">acol</span>&nbsp;<span class="op" id="5693374">:=</span>&nbsp;<span class="builtintype" id="5693377">uint16</span><span class="op" id="5693383">(</span><span class="ident" id="5693384">cdat</span><span class="op" id="5693388">[</span><span class="num" id="5693389">4</span><span class="op" id="5693390">*</span><span class="ident" id="5693391">x</span><span class="op" id="5693392">+</span><span class="num" id="5693393">2</span><span class="op" id="5693394">]</span><span class="op" id="5693395">)</span><span class="op" id="5693396">&lt;&lt;</span><span class="num" id="5693398">8</span>&nbsp;<span class="op" id="5693400">|</span>&nbsp;<span class="builtintype" id="5693402">uint16</span><span class="op" id="5693408">(</span><span class="ident" id="5693409">cdat</span><span class="op" id="5693413">[</span><span class="num" id="5693414">4</span><span class="op" id="5693415">*</span><span class="ident" id="5693416">x</span><span class="op" id="5693417">+</span><span class="num" id="5693418">3</span><span class="op" id="5693419">]</span><span class="op" id="5693420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693426">nrgba64</span><span class="op" id="5693433">.</span><span class="ident" id="5693434">SetNRGBA64</span><span class="op" id="5693444">(</span><span class="ident" id="5693445">x</span><span class="op" id="5693446">,</span>&nbsp;<span class="ident" id="5693448">y</span><span class="op" id="5693449">,</span>&nbsp;<span class="ident" id="5693451">color</span><span class="op" id="5693456">.</span><span class="ident" id="5693457">NRGBA64</span><span class="op" id="5693464">{</span><span class="ident" id="5693465">ycol</span><span class="op" id="5693469">,</span>&nbsp;<span class="ident" id="5693471">ycol</span><span class="op" id="5693475">,</span>&nbsp;<span class="ident" id="5693477">ycol</span><span class="op" id="5693481">,</span>&nbsp;<span class="ident" id="5693483">acol</span><span class="op" id="5693487">}</span><span class="op" id="5693488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693497">case</span>&nbsp;<span class="ident" id="5693502">cbTC16</span><span class="op" id="5693508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693513">for</span>&nbsp;<span class="ident" id="5693517">x</span>&nbsp;<span class="op" id="5693519">:=</span>&nbsp;<span class="num" id="5693522">0</span><span class="op" id="5693523">;</span>&nbsp;<span class="ident" id="5693525">x</span>&nbsp;<span class="op" id="5693527">&lt;</span>&nbsp;<span class="ident" id="5693529">width</span><span class="op" id="5693534">;</span>&nbsp;<span class="ident" id="5693536">x</span><span class="op" id="5693537">++</span>&nbsp;<span class="op" id="5693540">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693546">rcol</span>&nbsp;<span class="op" id="5693551">:=</span>&nbsp;<span class="builtintype" id="5693554">uint16</span><span class="op" id="5693560">(</span><span class="ident" id="5693561">cdat</span><span class="op" id="5693565">[</span><span class="num" id="5693566">6</span><span class="op" id="5693567">*</span><span class="ident" id="5693568">x</span><span class="op" id="5693569">+</span><span class="num" id="5693570">0</span><span class="op" id="5693571">]</span><span class="op" id="5693572">)</span><span class="op" id="5693573">&lt;&lt;</span><span class="num" id="5693575">8</span>&nbsp;<span class="op" id="5693577">|</span>&nbsp;<span class="builtintype" id="5693579">uint16</span><span class="op" id="5693585">(</span><span class="ident" id="5693586">cdat</span><span class="op" id="5693590">[</span><span class="num" id="5693591">6</span><span class="op" id="5693592">*</span><span class="ident" id="5693593">x</span><span class="op" id="5693594">+</span><span class="num" id="5693595">1</span><span class="op" id="5693596">]</span><span class="op" id="5693597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693603">gcol</span>&nbsp;<span class="op" id="5693608">:=</span>&nbsp;<span class="builtintype" id="5693611">uint16</span><span class="op" id="5693617">(</span><span class="ident" id="5693618">cdat</span><span class="op" id="5693622">[</span><span class="num" id="5693623">6</span><span class="op" id="5693624">*</span><span class="ident" id="5693625">x</span><span class="op" id="5693626">+</span><span class="num" id="5693627">2</span><span class="op" id="5693628">]</span><span class="op" id="5693629">)</span><span class="op" id="5693630">&lt;&lt;</span><span class="num" id="5693632">8</span>&nbsp;<span class="op" id="5693634">|</span>&nbsp;<span class="builtintype" id="5693636">uint16</span><span class="op" id="5693642">(</span><span class="ident" id="5693643">cdat</span><span class="op" id="5693647">[</span><span class="num" id="5693648">6</span><span class="op" id="5693649">*</span><span class="ident" id="5693650">x</span><span class="op" id="5693651">+</span><span class="num" id="5693652">3</span><span class="op" id="5693653">]</span><span class="op" id="5693654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693660">bcol</span>&nbsp;<span class="op" id="5693665">:=</span>&nbsp;<span class="builtintype" id="5693668">uint16</span><span class="op" id="5693674">(</span><span class="ident" id="5693675">cdat</span><span class="op" id="5693679">[</span><span class="num" id="5693680">6</span><span class="op" id="5693681">*</span><span class="ident" id="5693682">x</span><span class="op" id="5693683">+</span><span class="num" id="5693684">4</span><span class="op" id="5693685">]</span><span class="op" id="5693686">)</span><span class="op" id="5693687">&lt;&lt;</span><span class="num" id="5693689">8</span>&nbsp;<span class="op" id="5693691">|</span>&nbsp;<span class="builtintype" id="5693693">uint16</span><span class="op" id="5693699">(</span><span class="ident" id="5693700">cdat</span><span class="op" id="5693704">[</span><span class="num" id="5693705">6</span><span class="op" id="5693706">*</span><span class="ident" id="5693707">x</span><span class="op" id="5693708">+</span><span class="num" id="5693709">5</span><span class="op" id="5693710">]</span><span class="op" id="5693711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693717">rgba64</span><span class="op" id="5693723">.</span><span class="ident" id="5693724">SetRGBA64</span><span class="op" id="5693733">(</span><span class="ident" id="5693734">x</span><span class="op" id="5693735">,</span>&nbsp;<span class="ident" id="5693737">y</span><span class="op" id="5693738">,</span>&nbsp;<span class="ident" id="5693740">color</span><span class="op" id="5693745">.</span><span class="ident" id="5693746">RGBA64</span><span class="op" id="5693752">{</span><span class="ident" id="5693753">rcol</span><span class="op" id="5693757">,</span>&nbsp;<span class="ident" id="5693759">gcol</span><span class="op" id="5693763">,</span>&nbsp;<span class="ident" id="5693765">bcol</span><span class="op" id="5693769">,</span>&nbsp;<span class="num" id="5693771">0xffff</span><span class="op" id="5693777">}</span><span class="op" id="5693778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693783">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693787">case</span>&nbsp;<span class="ident" id="5693792">cbTCA16</span><span class="op" id="5693799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693804">for</span>&nbsp;<span class="ident" id="5693808">x</span>&nbsp;<span class="op" id="5693810">:=</span>&nbsp;<span class="num" id="5693813">0</span><span class="op" id="5693814">;</span>&nbsp;<span class="ident" id="5693816">x</span>&nbsp;<span class="op" id="5693818">&lt;</span>&nbsp;<span class="ident" id="5693820">width</span><span class="op" id="5693825">;</span>&nbsp;<span class="ident" id="5693827">x</span><span class="op" id="5693828">++</span>&nbsp;<span class="op" id="5693831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693837">rcol</span>&nbsp;<span class="op" id="5693842">:=</span>&nbsp;<span class="builtintype" id="5693845">uint16</span><span class="op" id="5693851">(</span><span class="ident" id="5693852">cdat</span><span class="op" id="5693856">[</span><span class="num" id="5693857">8</span><span class="op" id="5693858">*</span><span class="ident" id="5693859">x</span><span class="op" id="5693860">+</span><span class="num" id="5693861">0</span><span class="op" id="5693862">]</span><span class="op" id="5693863">)</span><span class="op" id="5693864">&lt;&lt;</span><span class="num" id="5693866">8</span>&nbsp;<span class="op" id="5693868">|</span>&nbsp;<span class="builtintype" id="5693870">uint16</span><span class="op" id="5693876">(</span><span class="ident" id="5693877">cdat</span><span class="op" id="5693881">[</span><span class="num" id="5693882">8</span><span class="op" id="5693883">*</span><span class="ident" id="5693884">x</span><span class="op" id="5693885">+</span><span class="num" id="5693886">1</span><span class="op" id="5693887">]</span><span class="op" id="5693888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693894">gcol</span>&nbsp;<span class="op" id="5693899">:=</span>&nbsp;<span class="builtintype" id="5693902">uint16</span><span class="op" id="5693908">(</span><span class="ident" id="5693909">cdat</span><span class="op" id="5693913">[</span><span class="num" id="5693914">8</span><span class="op" id="5693915">*</span><span class="ident" id="5693916">x</span><span class="op" id="5693917">+</span><span class="num" id="5693918">2</span><span class="op" id="5693919">]</span><span class="op" id="5693920">)</span><span class="op" id="5693921">&lt;&lt;</span><span class="num" id="5693923">8</span>&nbsp;<span class="op" id="5693925">|</span>&nbsp;<span class="builtintype" id="5693927">uint16</span><span class="op" id="5693933">(</span><span class="ident" id="5693934">cdat</span><span class="op" id="5693938">[</span><span class="num" id="5693939">8</span><span class="op" id="5693940">*</span><span class="ident" id="5693941">x</span><span class="op" id="5693942">+</span><span class="num" id="5693943">3</span><span class="op" id="5693944">]</span><span class="op" id="5693945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693951">bcol</span>&nbsp;<span class="op" id="5693956">:=</span>&nbsp;<span class="builtintype" id="5693959">uint16</span><span class="op" id="5693965">(</span><span class="ident" id="5693966">cdat</span><span class="op" id="5693970">[</span><span class="num" id="5693971">8</span><span class="op" id="5693972">*</span><span class="ident" id="5693973">x</span><span class="op" id="5693974">+</span><span class="num" id="5693975">4</span><span class="op" id="5693976">]</span><span class="op" id="5693977">)</span><span class="op" id="5693978">&lt;&lt;</span><span class="num" id="5693980">8</span>&nbsp;<span class="op" id="5693982">|</span>&nbsp;<span class="builtintype" id="5693984">uint16</span><span class="op" id="5693990">(</span><span class="ident" id="5693991">cdat</span><span class="op" id="5693995">[</span><span class="num" id="5693996">8</span><span class="op" id="5693997">*</span><span class="ident" id="5693998">x</span><span class="op" id="5693999">+</span><span class="num" id="5694000">5</span><span class="op" id="5694001">]</span><span class="op" id="5694002">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694008">acol</span>&nbsp;<span class="op" id="5694013">:=</span>&nbsp;<span class="builtintype" id="5694016">uint16</span><span class="op" id="5694022">(</span><span class="ident" id="5694023">cdat</span><span class="op" id="5694027">[</span><span class="num" id="5694028">8</span><span class="op" id="5694029">*</span><span class="ident" id="5694030">x</span><span class="op" id="5694031">+</span><span class="num" id="5694032">6</span><span class="op" id="5694033">]</span><span class="op" id="5694034">)</span><span class="op" id="5694035">&lt;&lt;</span><span class="num" id="5694037">8</span>&nbsp;<span class="op" id="5694039">|</span>&nbsp;<span class="builtintype" id="5694041">uint16</span><span class="op" id="5694047">(</span><span class="ident" id="5694048">cdat</span><span class="op" id="5694052">[</span><span class="num" id="5694053">8</span><span class="op" id="5694054">*</span><span class="ident" id="5694055">x</span><span class="op" id="5694056">+</span><span class="num" id="5694057">7</span><span class="op" id="5694058">]</span><span class="op" id="5694059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694065">nrgba64</span><span class="op" id="5694072">.</span><span class="ident" id="5694073">SetNRGBA64</span><span class="op" id="5694083">(</span><span class="ident" id="5694084">x</span><span class="op" id="5694085">,</span>&nbsp;<span class="ident" id="5694087">y</span><span class="op" id="5694088">,</span>&nbsp;<span class="ident" id="5694090">color</span><span class="op" id="5694095">.</span><span class="ident" id="5694096">NRGBA64</span><span class="op" id="5694103">{</span><span class="ident" id="5694104">rcol</span><span class="op" id="5694108">,</span>&nbsp;<span class="ident" id="5694110">gcol</span><span class="op" id="5694114">,</span>&nbsp;<span class="ident" id="5694116">bcol</span><span class="op" id="5694120">,</span>&nbsp;<span class="ident" id="5694122">acol</span><span class="op" id="5694126">}</span><span class="op" id="5694127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5694141">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694197">pr</span><span class="op" id="5694199">,</span>&nbsp;<span class="ident" id="5694201">cr</span>&nbsp;<span class="op" id="5694204">=</span>&nbsp;<span class="ident" id="5694206">cr</span><span class="op" id="5694208">,</span>&nbsp;<span class="ident" id="5694210">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694218">return</span>&nbsp;<span class="ident" id="5694225">img</span><span class="op" id="5694228">,</span>&nbsp;<span class="ident" id="5694230">nil</span><br>
<span class="lineno">585</span><span class="op" id="5694234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5694237">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5694300">func</span>&nbsp;<span class="op" id="5694305">(</span><span class="ident" id="5694306">d</span>&nbsp;<span class="op" id="5694308">*</span><span class="ident" id="5694309">decoder</span><span class="op" id="5694316">)</span>&nbsp;<span class="ident" id="5694318">mergePassInto</span><span class="op" id="5694331">(</span><span class="ident" id="5694332">dst</span>&nbsp;<span class="ident" id="5694336">image</span><span class="op" id="5694341">.</span><span class="ident" id="5694342">Image</span><span class="op" id="5694347">,</span>&nbsp;<span class="ident" id="5694349">src</span>&nbsp;<span class="ident" id="5694353">image</span><span class="op" id="5694358">.</span><span class="ident" id="5694359">Image</span><span class="op" id="5694364">,</span>&nbsp;<span class="ident" id="5694366">pass</span>&nbsp;<span class="builtintype" id="5694371">int</span><span class="op" id="5694374">)</span>&nbsp;<span class="op" id="5694376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694379">p</span>&nbsp;<span class="op" id="5694381">:=</span>&nbsp;<span class="ident" id="5694384">interlacing</span><span class="op" id="5694395">[</span><span class="ident" id="5694396">pass</span><span class="op" id="5694400">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694403">var</span>&nbsp;<span class="op" id="5694407">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694411">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5694425">[</span><span class="op" id="5694426">]</span><span class="builtintype" id="5694427">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694435">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5694449">[</span><span class="op" id="5694450">]</span><span class="builtintype" id="5694451">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694459">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5694473">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694479">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694493">image</span><span class="op" id="5694498">.</span><span class="ident" id="5694499">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694511">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5694525">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694533">switch</span>&nbsp;<span class="ident" id="5694540">target</span>&nbsp;<span class="op" id="5694547">:=</span>&nbsp;<span class="ident" id="5694550">dst</span><span class="op" id="5694553">.</span><span class="op" id="5694554">(</span><span class="keyword" id="5694555">type</span><span class="op" id="5694559">)</span>&nbsp;<span class="op" id="5694561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694564">case</span>&nbsp;<span class="op" id="5694569">*</span><span class="ident" id="5694570">image</span><span class="op" id="5694575">.</span><span class="ident" id="5694576">Alpha</span><span class="op" id="5694581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694585">srcPix</span>&nbsp;<span class="op" id="5694592">=</span>&nbsp;<span class="ident" id="5694594">src</span><span class="op" id="5694597">.</span><span class="op" id="5694598">(</span><span class="op" id="5694599">*</span><span class="ident" id="5694600">image</span><span class="op" id="5694605">.</span><span class="ident" id="5694606">Alpha</span><span class="op" id="5694611">)</span><span class="op" id="5694612">.</span><span class="ident" id="5694613">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694619">dstPix</span><span class="op" id="5694625">,</span>&nbsp;<span class="ident" id="5694627">stride</span><span class="op" id="5694633">,</span>&nbsp;<span class="ident" id="5694635">rect</span>&nbsp;<span class="op" id="5694640">=</span>&nbsp;<span class="ident" id="5694642">target</span><span class="op" id="5694648">.</span><span class="ident" id="5694649">Pix</span><span class="op" id="5694652">,</span>&nbsp;<span class="ident" id="5694654">target</span><span class="op" id="5694660">.</span><span class="ident" id="5694661">Stride</span><span class="op" id="5694667">,</span>&nbsp;<span class="ident" id="5694669">target</span><span class="op" id="5694675">.</span><span class="ident" id="5694676">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694683">bytesPerPixel</span>&nbsp;<span class="op" id="5694697">=</span>&nbsp;<span class="num" id="5694699">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694702">case</span>&nbsp;<span class="op" id="5694707">*</span><span class="ident" id="5694708">image</span><span class="op" id="5694713">.</span><span class="ident" id="5694714">Alpha16</span><span class="op" id="5694721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694725">srcPix</span>&nbsp;<span class="op" id="5694732">=</span>&nbsp;<span class="ident" id="5694734">src</span><span class="op" id="5694737">.</span><span class="op" id="5694738">(</span><span class="op" id="5694739">*</span><span class="ident" id="5694740">image</span><span class="op" id="5694745">.</span><span class="ident" id="5694746">Alpha16</span><span class="op" id="5694753">)</span><span class="op" id="5694754">.</span><span class="ident" id="5694755">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694761">dstPix</span><span class="op" id="5694767">,</span>&nbsp;<span class="ident" id="5694769">stride</span><span class="op" id="5694775">,</span>&nbsp;<span class="ident" id="5694777">rect</span>&nbsp;<span class="op" id="5694782">=</span>&nbsp;<span class="ident" id="5694784">target</span><span class="op" id="5694790">.</span><span class="ident" id="5694791">Pix</span><span class="op" id="5694794">,</span>&nbsp;<span class="ident" id="5694796">target</span><span class="op" id="5694802">.</span><span class="ident" id="5694803">Stride</span><span class="op" id="5694809">,</span>&nbsp;<span class="ident" id="5694811">target</span><span class="op" id="5694817">.</span><span class="ident" id="5694818">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694825">bytesPerPixel</span>&nbsp;<span class="op" id="5694839">=</span>&nbsp;<span class="num" id="5694841">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694844">case</span>&nbsp;<span class="op" id="5694849">*</span><span class="ident" id="5694850">image</span><span class="op" id="5694855">.</span><span class="ident" id="5694856">Gray</span><span class="op" id="5694860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694864">srcPix</span>&nbsp;<span class="op" id="5694871">=</span>&nbsp;<span class="ident" id="5694873">src</span><span class="op" id="5694876">.</span><span class="op" id="5694877">(</span><span class="op" id="5694878">*</span><span class="ident" id="5694879">image</span><span class="op" id="5694884">.</span><span class="ident" id="5694885">Gray</span><span class="op" id="5694889">)</span><span class="op" id="5694890">.</span><span class="ident" id="5694891">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694897">dstPix</span><span class="op" id="5694903">,</span>&nbsp;<span class="ident" id="5694905">stride</span><span class="op" id="5694911">,</span>&nbsp;<span class="ident" id="5694913">rect</span>&nbsp;<span class="op" id="5694918">=</span>&nbsp;<span class="ident" id="5694920">target</span><span class="op" id="5694926">.</span><span class="ident" id="5694927">Pix</span><span class="op" id="5694930">,</span>&nbsp;<span class="ident" id="5694932">target</span><span class="op" id="5694938">.</span><span class="ident" id="5694939">Stride</span><span class="op" id="5694945">,</span>&nbsp;<span class="ident" id="5694947">target</span><span class="op" id="5694953">.</span><span class="ident" id="5694954">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694961">bytesPerPixel</span>&nbsp;<span class="op" id="5694975">=</span>&nbsp;<span class="num" id="5694977">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694980">case</span>&nbsp;<span class="op" id="5694985">*</span><span class="ident" id="5694986">image</span><span class="op" id="5694991">.</span><span class="ident" id="5694992">Gray16</span><span class="op" id="5694998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695002">srcPix</span>&nbsp;<span class="op" id="5695009">=</span>&nbsp;<span class="ident" id="5695011">src</span><span class="op" id="5695014">.</span><span class="op" id="5695015">(</span><span class="op" id="5695016">*</span><span class="ident" id="5695017">image</span><span class="op" id="5695022">.</span><span class="ident" id="5695023">Gray16</span><span class="op" id="5695029">)</span><span class="op" id="5695030">.</span><span class="ident" id="5695031">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695037">dstPix</span><span class="op" id="5695043">,</span>&nbsp;<span class="ident" id="5695045">stride</span><span class="op" id="5695051">,</span>&nbsp;<span class="ident" id="5695053">rect</span>&nbsp;<span class="op" id="5695058">=</span>&nbsp;<span class="ident" id="5695060">target</span><span class="op" id="5695066">.</span><span class="ident" id="5695067">Pix</span><span class="op" id="5695070">,</span>&nbsp;<span class="ident" id="5695072">target</span><span class="op" id="5695078">.</span><span class="ident" id="5695079">Stride</span><span class="op" id="5695085">,</span>&nbsp;<span class="ident" id="5695087">target</span><span class="op" id="5695093">.</span><span class="ident" id="5695094">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695101">bytesPerPixel</span>&nbsp;<span class="op" id="5695115">=</span>&nbsp;<span class="num" id="5695117">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695120">case</span>&nbsp;<span class="op" id="5695125">*</span><span class="ident" id="5695126">image</span><span class="op" id="5695131">.</span><span class="ident" id="5695132">NRGBA</span><span class="op" id="5695137">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695141">srcPix</span>&nbsp;<span class="op" id="5695148">=</span>&nbsp;<span class="ident" id="5695150">src</span><span class="op" id="5695153">.</span><span class="op" id="5695154">(</span><span class="op" id="5695155">*</span><span class="ident" id="5695156">image</span><span class="op" id="5695161">.</span><span class="ident" id="5695162">NRGBA</span><span class="op" id="5695167">)</span><span class="op" id="5695168">.</span><span class="ident" id="5695169">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695175">dstPix</span><span class="op" id="5695181">,</span>&nbsp;<span class="ident" id="5695183">stride</span><span class="op" id="5695189">,</span>&nbsp;<span class="ident" id="5695191">rect</span>&nbsp;<span class="op" id="5695196">=</span>&nbsp;<span class="ident" id="5695198">target</span><span class="op" id="5695204">.</span><span class="ident" id="5695205">Pix</span><span class="op" id="5695208">,</span>&nbsp;<span class="ident" id="5695210">target</span><span class="op" id="5695216">.</span><span class="ident" id="5695217">Stride</span><span class="op" id="5695223">,</span>&nbsp;<span class="ident" id="5695225">target</span><span class="op" id="5695231">.</span><span class="ident" id="5695232">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695239">bytesPerPixel</span>&nbsp;<span class="op" id="5695253">=</span>&nbsp;<span class="num" id="5695255">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695258">case</span>&nbsp;<span class="op" id="5695263">*</span><span class="ident" id="5695264">image</span><span class="op" id="5695269">.</span><span class="ident" id="5695270">NRGBA64</span><span class="op" id="5695277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695281">srcPix</span>&nbsp;<span class="op" id="5695288">=</span>&nbsp;<span class="ident" id="5695290">src</span><span class="op" id="5695293">.</span><span class="op" id="5695294">(</span><span class="op" id="5695295">*</span><span class="ident" id="5695296">image</span><span class="op" id="5695301">.</span><span class="ident" id="5695302">NRGBA64</span><span class="op" id="5695309">)</span><span class="op" id="5695310">.</span><span class="ident" id="5695311">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695317">dstPix</span><span class="op" id="5695323">,</span>&nbsp;<span class="ident" id="5695325">stride</span><span class="op" id="5695331">,</span>&nbsp;<span class="ident" id="5695333">rect</span>&nbsp;<span class="op" id="5695338">=</span>&nbsp;<span class="ident" id="5695340">target</span><span class="op" id="5695346">.</span><span class="ident" id="5695347">Pix</span><span class="op" id="5695350">,</span>&nbsp;<span class="ident" id="5695352">target</span><span class="op" id="5695358">.</span><span class="ident" id="5695359">Stride</span><span class="op" id="5695365">,</span>&nbsp;<span class="ident" id="5695367">target</span><span class="op" id="5695373">.</span><span class="ident" id="5695374">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695381">bytesPerPixel</span>&nbsp;<span class="op" id="5695395">=</span>&nbsp;<span class="num" id="5695397">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695400">case</span>&nbsp;<span class="op" id="5695405">*</span><span class="ident" id="5695406">image</span><span class="op" id="5695411">.</span><span class="ident" id="5695412">Paletted</span><span class="op" id="5695420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695424">srcPix</span>&nbsp;<span class="op" id="5695431">=</span>&nbsp;<span class="ident" id="5695433">src</span><span class="op" id="5695436">.</span><span class="op" id="5695437">(</span><span class="op" id="5695438">*</span><span class="ident" id="5695439">image</span><span class="op" id="5695444">.</span><span class="ident" id="5695445">Paletted</span><span class="op" id="5695453">)</span><span class="op" id="5695454">.</span><span class="ident" id="5695455">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695461">dstPix</span><span class="op" id="5695467">,</span>&nbsp;<span class="ident" id="5695469">stride</span><span class="op" id="5695475">,</span>&nbsp;<span class="ident" id="5695477">rect</span>&nbsp;<span class="op" id="5695482">=</span>&nbsp;<span class="ident" id="5695484">target</span><span class="op" id="5695490">.</span><span class="ident" id="5695491">Pix</span><span class="op" id="5695494">,</span>&nbsp;<span class="ident" id="5695496">target</span><span class="op" id="5695502">.</span><span class="ident" id="5695503">Stride</span><span class="op" id="5695509">,</span>&nbsp;<span class="ident" id="5695511">target</span><span class="op" id="5695517">.</span><span class="ident" id="5695518">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695525">bytesPerPixel</span>&nbsp;<span class="op" id="5695539">=</span>&nbsp;<span class="num" id="5695541">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695544">case</span>&nbsp;<span class="op" id="5695549">*</span><span class="ident" id="5695550">image</span><span class="op" id="5695555">.</span><span class="ident" id="5695556">RGBA</span><span class="op" id="5695560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695564">srcPix</span>&nbsp;<span class="op" id="5695571">=</span>&nbsp;<span class="ident" id="5695573">src</span><span class="op" id="5695576">.</span><span class="op" id="5695577">(</span><span class="op" id="5695578">*</span><span class="ident" id="5695579">image</span><span class="op" id="5695584">.</span><span class="ident" id="5695585">RGBA</span><span class="op" id="5695589">)</span><span class="op" id="5695590">.</span><span class="ident" id="5695591">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695597">dstPix</span><span class="op" id="5695603">,</span>&nbsp;<span class="ident" id="5695605">stride</span><span class="op" id="5695611">,</span>&nbsp;<span class="ident" id="5695613">rect</span>&nbsp;<span class="op" id="5695618">=</span>&nbsp;<span class="ident" id="5695620">target</span><span class="op" id="5695626">.</span><span class="ident" id="5695627">Pix</span><span class="op" id="5695630">,</span>&nbsp;<span class="ident" id="5695632">target</span><span class="op" id="5695638">.</span><span class="ident" id="5695639">Stride</span><span class="op" id="5695645">,</span>&nbsp;<span class="ident" id="5695647">target</span><span class="op" id="5695653">.</span><span class="ident" id="5695654">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695661">bytesPerPixel</span>&nbsp;<span class="op" id="5695675">=</span>&nbsp;<span class="num" id="5695677">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695680">case</span>&nbsp;<span class="op" id="5695685">*</span><span class="ident" id="5695686">image</span><span class="op" id="5695691">.</span><span class="ident" id="5695692">RGBA64</span><span class="op" id="5695698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695702">srcPix</span>&nbsp;<span class="op" id="5695709">=</span>&nbsp;<span class="ident" id="5695711">src</span><span class="op" id="5695714">.</span><span class="op" id="5695715">(</span><span class="op" id="5695716">*</span><span class="ident" id="5695717">image</span><span class="op" id="5695722">.</span><span class="ident" id="5695723">RGBA64</span><span class="op" id="5695729">)</span><span class="op" id="5695730">.</span><span class="ident" id="5695731">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695737">dstPix</span><span class="op" id="5695743">,</span>&nbsp;<span class="ident" id="5695745">stride</span><span class="op" id="5695751">,</span>&nbsp;<span class="ident" id="5695753">rect</span>&nbsp;<span class="op" id="5695758">=</span>&nbsp;<span class="ident" id="5695760">target</span><span class="op" id="5695766">.</span><span class="ident" id="5695767">Pix</span><span class="op" id="5695770">,</span>&nbsp;<span class="ident" id="5695772">target</span><span class="op" id="5695778">.</span><span class="ident" id="5695779">Stride</span><span class="op" id="5695785">,</span>&nbsp;<span class="ident" id="5695787">target</span><span class="op" id="5695793">.</span><span class="ident" id="5695794">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695801">bytesPerPixel</span>&nbsp;<span class="op" id="5695815">=</span>&nbsp;<span class="num" id="5695817">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695820">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695823">s</span><span class="op" id="5695824">,</span>&nbsp;<span class="ident" id="5695826">bounds</span>&nbsp;<span class="op" id="5695833">:=</span>&nbsp;<span class="num" id="5695836">0</span><span class="op" id="5695837">,</span>&nbsp;<span class="ident" id="5695839">src</span><span class="op" id="5695842">.</span><span class="ident" id="5695843">Bounds</span><span class="op" id="5695849">(</span><span class="op" id="5695850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695853">for</span>&nbsp;<span class="ident" id="5695857">y</span>&nbsp;<span class="op" id="5695859">:=</span>&nbsp;<span class="ident" id="5695862">bounds</span><span class="op" id="5695868">.</span><span class="ident" id="5695869">Min</span><span class="op" id="5695872">.</span><span class="ident" id="5695873">Y</span><span class="op" id="5695874">;</span>&nbsp;<span class="ident" id="5695876">y</span>&nbsp;<span class="op" id="5695878">&lt;</span>&nbsp;<span class="ident" id="5695880">bounds</span><span class="op" id="5695886">.</span><span class="ident" id="5695887">Max</span><span class="op" id="5695890">.</span><span class="ident" id="5695891">Y</span><span class="op" id="5695892">;</span>&nbsp;<span class="ident" id="5695894">y</span><span class="op" id="5695895">++</span>&nbsp;<span class="op" id="5695898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695902">dBase</span>&nbsp;<span class="op" id="5695908">:=</span>&nbsp;<span class="op" id="5695911">(</span><span class="ident" id="5695912">y</span><span class="op" id="5695913">*</span><span class="ident" id="5695914">p</span><span class="op" id="5695915">.</span><span class="ident" id="5695916">yFactor</span><span class="op" id="5695923">+</span><span class="ident" id="5695924">p</span><span class="op" id="5695925">.</span><span class="ident" id="5695926">yOffset</span><span class="op" id="5695933">-</span><span class="ident" id="5695934">rect</span><span class="op" id="5695938">.</span><span class="ident" id="5695939">Min</span><span class="op" id="5695942">.</span><span class="ident" id="5695943">Y</span><span class="op" id="5695944">)</span><span class="op" id="5695945">*</span><span class="ident" id="5695946">stride</span>&nbsp;<span class="op" id="5695953">+</span>&nbsp;<span class="op" id="5695955">(</span><span class="ident" id="5695956">p</span><span class="op" id="5695957">.</span><span class="ident" id="5695958">xOffset</span><span class="op" id="5695965">-</span><span class="ident" id="5695966">rect</span><span class="op" id="5695970">.</span><span class="ident" id="5695971">Min</span><span class="op" id="5695974">.</span><span class="ident" id="5695975">X</span><span class="op" id="5695976">)</span><span class="op" id="5695977">*</span><span class="ident" id="5695978">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695994">for</span>&nbsp;<span class="ident" id="5695998">x</span>&nbsp;<span class="op" id="5696000">:=</span>&nbsp;<span class="ident" id="5696003">bounds</span><span class="op" id="5696009">.</span><span class="ident" id="5696010">Min</span><span class="op" id="5696013">.</span><span class="ident" id="5696014">X</span><span class="op" id="5696015">;</span>&nbsp;<span class="ident" id="5696017">x</span>&nbsp;<span class="op" id="5696019">&lt;</span>&nbsp;<span class="ident" id="5696021">bounds</span><span class="op" id="5696027">.</span><span class="ident" id="5696028">Max</span><span class="op" id="5696031">.</span><span class="ident" id="5696032">X</span><span class="op" id="5696033">;</span>&nbsp;<span class="ident" id="5696035">x</span><span class="op" id="5696036">++</span>&nbsp;<span class="op" id="5696039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696044">d</span>&nbsp;<span class="op" id="5696046">:=</span>&nbsp;<span class="ident" id="5696049">dBase</span>&nbsp;<span class="op" id="5696055">+</span>&nbsp;<span class="ident" id="5696057">x</span><span class="op" id="5696058">*</span><span class="ident" id="5696059">p</span><span class="op" id="5696060">.</span><span class="ident" id="5696061">xFactor</span><span class="op" id="5696068">*</span><span class="ident" id="5696069">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5696086">copy</span><span class="op" id="5696090">(</span><span class="ident" id="5696091">dstPix</span><span class="op" id="5696097">[</span><span class="ident" id="5696098">d</span><span class="op" id="5696099">:</span><span class="op" id="5696100">]</span><span class="op" id="5696101">,</span>&nbsp;<span class="ident" id="5696103">srcPix</span><span class="op" id="5696109">[</span><span class="ident" id="5696110">s</span><span class="op" id="5696111">:</span><span class="ident" id="5696112">s</span><span class="op" id="5696113">+</span><span class="ident" id="5696114">bytesPerPixel</span><span class="op" id="5696127">]</span><span class="op" id="5696128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696133">s</span>&nbsp;<span class="op" id="5696135">+=</span>&nbsp;<span class="ident" id="5696138">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696157">}</span><br>
<span class="lineno"></span><span class="op" id="5696159">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5696162">func</span>&nbsp;<span class="op" id="5696167">(</span><span class="ident" id="5696168">d</span>&nbsp;<span class="op" id="5696170">*</span><span class="ident" id="5696171">decoder</span><span class="op" id="5696178">)</span>&nbsp;<span class="ident" id="5696180">parseIDAT</span><span class="op" id="5696189">(</span><span class="ident" id="5696190">length</span>&nbsp;<span class="builtintype" id="5696197">uint32</span><span class="op" id="5696203">)</span>&nbsp;<span class="op" id="5696205">(</span><span class="ident" id="5696206">err</span>&nbsp;<span class="builtintype" id="5696210">error</span><span class="op" id="5696215">)</span>&nbsp;<span class="op" id="5696217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696220">d</span><span class="op" id="5696221">.</span><span class="ident" id="5696222">idatLength</span>&nbsp;<span class="op" id="5696233">=</span>&nbsp;<span class="ident" id="5696235">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696243">d</span><span class="op" id="5696244">.</span><span class="ident" id="5696245">img</span><span class="op" id="5696248">,</span>&nbsp;<span class="ident" id="5696250">err</span>&nbsp;<span class="op" id="5696254">=</span>&nbsp;<span class="ident" id="5696256">d</span><span class="op" id="5696257">.</span><span class="ident" id="5696258">decode</span><span class="op" id="5696264">(</span><span class="op" id="5696265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696268">if</span>&nbsp;<span class="ident" id="5696271">err</span>&nbsp;<span class="op" id="5696275">!=</span>&nbsp;<span class="ident" id="5696278">nil</span>&nbsp;<span class="op" id="5696282">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696286">return</span>&nbsp;<span class="ident" id="5696293">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696301">return</span>&nbsp;<span class="ident" id="5696308">d</span><span class="op" id="5696309">.</span><span class="ident" id="5696310">verifyChecksum</span><span class="op" id="5696324">(</span><span class="op" id="5696325">)</span><br>
<span class="lineno"></span><span class="op" id="5696327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5696330">func</span>&nbsp;<span class="op" id="5696335">(</span><span class="ident" id="5696336">d</span>&nbsp;<span class="op" id="5696338">*</span><span class="ident" id="5696339">decoder</span><span class="op" id="5696346">)</span>&nbsp;<span class="ident" id="5696348">parseIEND</span><span class="op" id="5696357">(</span><span class="ident" id="5696358">length</span>&nbsp;<span class="builtintype" id="5696365">uint32</span><span class="op" id="5696371">)</span>&nbsp;<span class="builtintype" id="5696373">error</span>&nbsp;<span class="op" id="5696379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696382">if</span>&nbsp;<span class="ident" id="5696385">length</span>&nbsp;<span class="op" id="5696392">!=</span>&nbsp;<span class="num" id="5696395">0</span>&nbsp;<span class="op" id="5696397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696401">return</span>&nbsp;<span class="ident" id="5696408">FormatError</span><span class="op" id="5696419">(</span><span class="string" id="5696420">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5696437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696443">return</span>&nbsp;<span class="ident" id="5696450">d</span><span class="op" id="5696451">.</span><span class="ident" id="5696452">verifyChecksum</span><span class="op" id="5696466">(</span><span class="op" id="5696467">)</span><br>
<span class="lineno">660</span><span class="op" id="5696469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5696472">func</span>&nbsp;<span class="op" id="5696477">(</span><span class="ident" id="5696478">d</span>&nbsp;<span class="op" id="5696480">*</span><span class="ident" id="5696481">decoder</span><span class="op" id="5696488">)</span>&nbsp;<span class="ident" id="5696490">parseChunk</span><span class="op" id="5696500">(</span><span class="op" id="5696501">)</span>&nbsp;<span class="builtintype" id="5696503">error</span>&nbsp;<span class="op" id="5696509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696512">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696548">n</span><span class="op" id="5696549">,</span>&nbsp;<span class="ident" id="5696551">err</span>&nbsp;<span class="op" id="5696555">:=</span>&nbsp;<span class="ident" id="5696558">io</span><span class="op" id="5696560">.</span><span class="ident" id="5696561">ReadFull</span><span class="op" id="5696569">(</span><span class="ident" id="5696570">d</span><span class="op" id="5696571">.</span><span class="ident" id="5696572">r</span><span class="op" id="5696573">,</span>&nbsp;<span class="ident" id="5696575">d</span><span class="op" id="5696576">.</span><span class="ident" id="5696577">tmp</span><span class="op" id="5696580">[</span><span class="op" id="5696581">:</span><span class="num" id="5696582">8</span><span class="op" id="5696583">]</span><span class="op" id="5696584">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696587">if</span>&nbsp;<span class="ident" id="5696590">err</span>&nbsp;<span class="op" id="5696594">!=</span>&nbsp;<span class="ident" id="5696597">nil</span>&nbsp;<span class="op" id="5696601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696605">return</span>&nbsp;<span class="ident" id="5696612">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696620">length</span>&nbsp;<span class="op" id="5696627">:=</span>&nbsp;<span class="ident" id="5696630">binary</span><span class="op" id="5696636">.</span><span class="ident" id="5696637">BigEndian</span><span class="op" id="5696646">.</span><span class="ident" id="5696647">Uint32</span><span class="op" id="5696653">(</span><span class="ident" id="5696654">d</span><span class="op" id="5696655">.</span><span class="ident" id="5696656">tmp</span><span class="op" id="5696659">[</span><span class="op" id="5696660">:</span><span class="num" id="5696661">4</span><span class="op" id="5696662">]</span><span class="op" id="5696663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696666">d</span><span class="op" id="5696667">.</span><span class="ident" id="5696668">crc</span><span class="op" id="5696671">.</span><span class="ident" id="5696672">Reset</span><span class="op" id="5696677">(</span><span class="op" id="5696678">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696681">d</span><span class="op" id="5696682">.</span><span class="ident" id="5696683">crc</span><span class="op" id="5696686">.</span><span class="ident" id="5696687">Write</span><span class="op" id="5696692">(</span><span class="ident" id="5696693">d</span><span class="op" id="5696694">.</span><span class="ident" id="5696695">tmp</span><span class="op" id="5696698">[</span><span class="num" id="5696699">4</span><span class="op" id="5696700">:</span><span class="num" id="5696701">8</span><span class="op" id="5696702">]</span><span class="op" id="5696703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696707">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696732">switch</span>&nbsp;<span class="builtintype" id="5696739">string</span><span class="op" id="5696745">(</span><span class="ident" id="5696746">d</span><span class="op" id="5696747">.</span><span class="ident" id="5696748">tmp</span><span class="op" id="5696751">[</span><span class="num" id="5696752">4</span><span class="op" id="5696753">:</span><span class="num" id="5696754">8</span><span class="op" id="5696755">]</span><span class="op" id="5696756">)</span>&nbsp;<span class="op" id="5696758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696761">case</span>&nbsp;<span class="string" id="5696766">&#34;IHDR&#34;</span><span class="op" id="5696772">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696776">if</span>&nbsp;<span class="ident" id="5696779">d</span><span class="op" id="5696780">.</span><span class="ident" id="5696781">stage</span>&nbsp;<span class="op" id="5696787">!=</span>&nbsp;<span class="ident" id="5696790">dsStart</span>&nbsp;<span class="op" id="5696798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696803">return</span>&nbsp;<span class="ident" id="5696810">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696832">d</span><span class="op" id="5696833">.</span><span class="ident" id="5696834">stage</span>&nbsp;<span class="op" id="5696840">=</span>&nbsp;<span class="ident" id="5696842">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696855">return</span>&nbsp;<span class="ident" id="5696862">d</span><span class="op" id="5696863">.</span><span class="ident" id="5696864">parseIHDR</span><span class="op" id="5696873">(</span><span class="ident" id="5696874">length</span><span class="op" id="5696880">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696883">case</span>&nbsp;<span class="string" id="5696888">&#34;PLTE&#34;</span><span class="op" id="5696894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696898">if</span>&nbsp;<span class="ident" id="5696901">d</span><span class="op" id="5696902">.</span><span class="ident" id="5696903">stage</span>&nbsp;<span class="op" id="5696909">!=</span>&nbsp;<span class="ident" id="5696912">dsSeenIHDR</span>&nbsp;<span class="op" id="5696923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696928">return</span>&nbsp;<span class="ident" id="5696935">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696957">d</span><span class="op" id="5696958">.</span><span class="ident" id="5696959">stage</span>&nbsp;<span class="op" id="5696965">=</span>&nbsp;<span class="ident" id="5696967">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696980">return</span>&nbsp;<span class="ident" id="5696987">d</span><span class="op" id="5696988">.</span><span class="ident" id="5696989">parsePLTE</span><span class="op" id="5696998">(</span><span class="ident" id="5696999">length</span><span class="op" id="5697005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697008">case</span>&nbsp;<span class="string" id="5697013">&#34;tRNS&#34;</span><span class="op" id="5697019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697023">if</span>&nbsp;<span class="ident" id="5697026">d</span><span class="op" id="5697027">.</span><span class="ident" id="5697028">stage</span>&nbsp;<span class="op" id="5697034">!=</span>&nbsp;<span class="ident" id="5697037">dsSeenPLTE</span>&nbsp;<span class="op" id="5697048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697053">return</span>&nbsp;<span class="ident" id="5697060">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697078">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697082">return</span>&nbsp;<span class="ident" id="5697089">d</span><span class="op" id="5697090">.</span><span class="ident" id="5697091">parsetRNS</span><span class="op" id="5697100">(</span><span class="ident" id="5697101">length</span><span class="op" id="5697107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697110">case</span>&nbsp;<span class="string" id="5697115">&#34;IDAT&#34;</span><span class="op" id="5697121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697125">if</span>&nbsp;<span class="ident" id="5697128">d</span><span class="op" id="5697129">.</span><span class="ident" id="5697130">stage</span>&nbsp;<span class="op" id="5697136">&lt;</span>&nbsp;<span class="ident" id="5697138">dsSeenIHDR</span>&nbsp;<span class="op" id="5697149">||</span>&nbsp;<span class="ident" id="5697152">d</span><span class="op" id="5697153">.</span><span class="ident" id="5697154">stage</span>&nbsp;<span class="op" id="5697160">&gt;</span>&nbsp;<span class="ident" id="5697162">dsSeenIDAT</span>&nbsp;<span class="op" id="5697173">||</span>&nbsp;<span class="op" id="5697176">(</span><span class="ident" id="5697177">d</span><span class="op" id="5697178">.</span><span class="ident" id="5697179">cb</span>&nbsp;<span class="op" id="5697182">==</span>&nbsp;<span class="ident" id="5697185">cbP8</span>&nbsp;<span class="op" id="5697190">&amp;&amp;</span>&nbsp;<span class="ident" id="5697193">d</span><span class="op" id="5697194">.</span><span class="ident" id="5697195">stage</span>&nbsp;<span class="op" id="5697201">==</span>&nbsp;<span class="ident" id="5697204">dsSeenIHDR</span><span class="op" id="5697214">)</span>&nbsp;<span class="op" id="5697216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697221">return</span>&nbsp;<span class="ident" id="5697228">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697246">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697250">d</span><span class="op" id="5697251">.</span><span class="ident" id="5697252">stage</span>&nbsp;<span class="op" id="5697258">=</span>&nbsp;<span class="ident" id="5697260">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697273">return</span>&nbsp;<span class="ident" id="5697280">d</span><span class="op" id="5697281">.</span><span class="ident" id="5697282">parseIDAT</span><span class="op" id="5697291">(</span><span class="ident" id="5697292">length</span><span class="op" id="5697298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697301">case</span>&nbsp;<span class="string" id="5697306">&#34;IEND&#34;</span><span class="op" id="5697312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697316">if</span>&nbsp;<span class="ident" id="5697319">d</span><span class="op" id="5697320">.</span><span class="ident" id="5697321">stage</span>&nbsp;<span class="op" id="5697327">!=</span>&nbsp;<span class="ident" id="5697330">dsSeenIDAT</span>&nbsp;<span class="op" id="5697341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697346">return</span>&nbsp;<span class="ident" id="5697353">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697375">d</span><span class="op" id="5697376">.</span><span class="ident" id="5697377">stage</span>&nbsp;<span class="op" id="5697383">=</span>&nbsp;<span class="ident" id="5697385">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697398">return</span>&nbsp;<span class="ident" id="5697405">d</span><span class="op" id="5697406">.</span><span class="ident" id="5697407">parseIEND</span><span class="op" id="5697416">(</span><span class="ident" id="5697417">length</span><span class="op" id="5697423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697429">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697472">var</span>&nbsp;<span class="ident" id="5697476">ignored</span>&nbsp;<span class="op" id="5697484">[</span><span class="num" id="5697485">4096</span><span class="op" id="5697489">]</span><span class="builtintype" id="5697490">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697496">for</span>&nbsp;<span class="ident" id="5697500">length</span>&nbsp;<span class="op" id="5697507">&gt;</span>&nbsp;<span class="num" id="5697509">0</span>&nbsp;<span class="op" id="5697511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697515">n</span><span class="op" id="5697516">,</span>&nbsp;<span class="ident" id="5697518">err</span>&nbsp;<span class="op" id="5697522">=</span>&nbsp;<span class="ident" id="5697524">io</span><span class="op" id="5697526">.</span><span class="ident" id="5697527">ReadFull</span><span class="op" id="5697535">(</span><span class="ident" id="5697536">d</span><span class="op" id="5697537">.</span><span class="ident" id="5697538">r</span><span class="op" id="5697539">,</span>&nbsp;<span class="ident" id="5697541">ignored</span><span class="op" id="5697548">[</span><span class="op" id="5697549">:</span><span class="ident" id="5697550">min</span><span class="op" id="5697553">(</span><span class="builtinfunc" id="5697554">len</span><span class="op" id="5697557">(</span><span class="ident" id="5697558">ignored</span><span class="op" id="5697565">)</span><span class="op" id="5697566">,</span>&nbsp;<span class="builtintype" id="5697568">int</span><span class="op" id="5697571">(</span><span class="ident" id="5697572">length</span><span class="op" id="5697578">)</span><span class="op" id="5697579">)</span><span class="op" id="5697580">]</span><span class="op" id="5697581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697585">if</span>&nbsp;<span class="ident" id="5697588">err</span>&nbsp;<span class="op" id="5697592">!=</span>&nbsp;<span class="ident" id="5697595">nil</span>&nbsp;<span class="op" id="5697599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697604">return</span>&nbsp;<span class="ident" id="5697611">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697621">d</span><span class="op" id="5697622">.</span><span class="ident" id="5697623">crc</span><span class="op" id="5697626">.</span><span class="ident" id="5697627">Write</span><span class="op" id="5697632">(</span><span class="ident" id="5697633">ignored</span><span class="op" id="5697640">[</span><span class="op" id="5697641">:</span><span class="ident" id="5697642">n</span><span class="op" id="5697643">]</span><span class="op" id="5697644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697648">length</span>&nbsp;<span class="op" id="5697655">-=</span>&nbsp;<span class="builtintype" id="5697658">uint32</span><span class="op" id="5697664">(</span><span class="ident" id="5697665">n</span><span class="op" id="5697666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697672">return</span>&nbsp;<span class="ident" id="5697679">d</span><span class="op" id="5697680">.</span><span class="ident" id="5697681">verifyChecksum</span><span class="op" id="5697695">(</span><span class="op" id="5697696">)</span><br>
<span class="lineno">715</span><span class="op" id="5697698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5697701">func</span>&nbsp;<span class="op" id="5697706">(</span><span class="ident" id="5697707">d</span>&nbsp;<span class="op" id="5697709">*</span><span class="ident" id="5697710">decoder</span><span class="op" id="5697717">)</span>&nbsp;<span class="ident" id="5697719">verifyChecksum</span><span class="op" id="5697733">(</span><span class="op" id="5697734">)</span>&nbsp;<span class="builtintype" id="5697736">error</span>&nbsp;<span class="op" id="5697742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697745">if</span>&nbsp;<span class="ident" id="5697748">_</span><span class="op" id="5697749">,</span>&nbsp;<span class="ident" id="5697751">err</span>&nbsp;<span class="op" id="5697755">:=</span>&nbsp;<span class="ident" id="5697758">io</span><span class="op" id="5697760">.</span><span class="ident" id="5697761">ReadFull</span><span class="op" id="5697769">(</span><span class="ident" id="5697770">d</span><span class="op" id="5697771">.</span><span class="ident" id="5697772">r</span><span class="op" id="5697773">,</span>&nbsp;<span class="ident" id="5697775">d</span><span class="op" id="5697776">.</span><span class="ident" id="5697777">tmp</span><span class="op" id="5697780">[</span><span class="op" id="5697781">:</span><span class="num" id="5697782">4</span><span class="op" id="5697783">]</span><span class="op" id="5697784">)</span><span class="op" id="5697785">;</span>&nbsp;<span class="ident" id="5697787">err</span>&nbsp;<span class="op" id="5697791">!=</span>&nbsp;<span class="ident" id="5697794">nil</span>&nbsp;<span class="op" id="5697798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697802">return</span>&nbsp;<span class="ident" id="5697809">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697817">if</span>&nbsp;<span class="ident" id="5697820">binary</span><span class="op" id="5697826">.</span><span class="ident" id="5697827">BigEndian</span><span class="op" id="5697836">.</span><span class="ident" id="5697837">Uint32</span><span class="op" id="5697843">(</span><span class="ident" id="5697844">d</span><span class="op" id="5697845">.</span><span class="ident" id="5697846">tmp</span><span class="op" id="5697849">[</span><span class="op" id="5697850">:</span><span class="num" id="5697851">4</span><span class="op" id="5697852">]</span><span class="op" id="5697853">)</span>&nbsp;<span class="op" id="5697855">!=</span>&nbsp;<span class="ident" id="5697858">d</span><span class="op" id="5697859">.</span><span class="ident" id="5697860">crc</span><span class="op" id="5697863">.</span><span class="ident" id="5697864">Sum32</span><span class="op" id="5697869">(</span><span class="op" id="5697870">)</span>&nbsp;<span class="op" id="5697872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697876">return</span>&nbsp;<span class="ident" id="5697883">FormatError</span><span class="op" id="5697894">(</span><span class="string" id="5697895">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5697913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697919">return</span>&nbsp;<span class="ident" id="5697926">nil</span><br>
<span class="lineno">725</span><span class="op" id="5697930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5697933">func</span>&nbsp;<span class="op" id="5697938">(</span><span class="ident" id="5697939">d</span>&nbsp;<span class="op" id="5697941">*</span><span class="ident" id="5697942">decoder</span><span class="op" id="5697949">)</span>&nbsp;<span class="ident" id="5697951">checkHeader</span><span class="op" id="5697962">(</span><span class="op" id="5697963">)</span>&nbsp;<span class="builtintype" id="5697965">error</span>&nbsp;<span class="op" id="5697971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697974">_</span><span class="op" id="5697975">,</span>&nbsp;<span class="ident" id="5697977">err</span>&nbsp;<span class="op" id="5697981">:=</span>&nbsp;<span class="ident" id="5697984">io</span><span class="op" id="5697986">.</span><span class="ident" id="5697987">ReadFull</span><span class="op" id="5697995">(</span><span class="ident" id="5697996">d</span><span class="op" id="5697997">.</span><span class="ident" id="5697998">r</span><span class="op" id="5697999">,</span>&nbsp;<span class="ident" id="5698001">d</span><span class="op" id="5698002">.</span><span class="ident" id="5698003">tmp</span><span class="op" id="5698006">[</span><span class="op" id="5698007">:</span><span class="builtinfunc" id="5698008">len</span><span class="op" id="5698011">(</span><span class="ident" id="5698012">pngHeader</span><span class="op" id="5698021">)</span><span class="op" id="5698022">]</span><span class="op" id="5698023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698026">if</span>&nbsp;<span class="ident" id="5698029">err</span>&nbsp;<span class="op" id="5698033">!=</span>&nbsp;<span class="ident" id="5698036">nil</span>&nbsp;<span class="op" id="5698040">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698044">return</span>&nbsp;<span class="ident" id="5698051">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698059">if</span>&nbsp;<span class="builtintype" id="5698062">string</span><span class="op" id="5698068">(</span><span class="ident" id="5698069">d</span><span class="op" id="5698070">.</span><span class="ident" id="5698071">tmp</span><span class="op" id="5698074">[</span><span class="op" id="5698075">:</span><span class="builtinfunc" id="5698076">len</span><span class="op" id="5698079">(</span><span class="ident" id="5698080">pngHeader</span><span class="op" id="5698089">)</span><span class="op" id="5698090">]</span><span class="op" id="5698091">)</span>&nbsp;<span class="op" id="5698093">!=</span>&nbsp;<span class="ident" id="5698096">pngHeader</span>&nbsp;<span class="op" id="5698106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698110">return</span>&nbsp;<span class="ident" id="5698117">FormatError</span><span class="op" id="5698128">(</span><span class="string" id="5698129">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5698145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698148">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698151">return</span>&nbsp;<span class="ident" id="5698158">nil</span><br>
<span class="lineno"></span><span class="op" id="5698162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5698165">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5698234">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5698293">func</span>&nbsp;<span class="ident" id="5698298">Decode</span><span class="op" id="5698304">(</span><span class="ident" id="5698305">r</span>&nbsp;<span class="ident" id="5698307">io</span><span class="op" id="5698309">.</span><span class="ident" id="5698310">Reader</span><span class="op" id="5698316">)</span>&nbsp;<span class="op" id="5698318">(</span><span class="ident" id="5698319">image</span><span class="op" id="5698324">.</span><span class="ident" id="5698325">Image</span><span class="op" id="5698330">,</span>&nbsp;<span class="builtintype" id="5698332">error</span><span class="op" id="5698337">)</span>&nbsp;<span class="op" id="5698339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698342">d</span>&nbsp;<span class="op" id="5698344">:=</span>&nbsp;<span class="op" id="5698347">&amp;</span><span class="ident" id="5698348">decoder</span><span class="op" id="5698355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698359">r</span><span class="op" id="5698360">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5698364">r</span><span class="op" id="5698365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698369">crc</span><span class="op" id="5698372">:</span>&nbsp;<span class="ident" id="5698374">crc32</span><span class="op" id="5698379">.</span><span class="ident" id="5698380">NewIEEE</span><span class="op" id="5698387">(</span><span class="op" id="5698388">)</span><span class="op" id="5698389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698392">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698395">if</span>&nbsp;<span class="ident" id="5698398">err</span>&nbsp;<span class="op" id="5698402">:=</span>&nbsp;<span class="ident" id="5698405">d</span><span class="op" id="5698406">.</span><span class="ident" id="5698407">checkHeader</span><span class="op" id="5698418">(</span><span class="op" id="5698419">)</span><span class="op" id="5698420">;</span>&nbsp;<span class="ident" id="5698422">err</span>&nbsp;<span class="op" id="5698426">!=</span>&nbsp;<span class="ident" id="5698429">nil</span>&nbsp;<span class="op" id="5698433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698437">if</span>&nbsp;<span class="ident" id="5698440">err</span>&nbsp;<span class="op" id="5698444">==</span>&nbsp;<span class="ident" id="5698447">io</span><span class="op" id="5698449">.</span><span class="ident" id="5698450">EOF</span>&nbsp;<span class="op" id="5698454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698459">err</span>&nbsp;<span class="op" id="5698463">=</span>&nbsp;<span class="ident" id="5698465">io</span><span class="op" id="5698467">.</span><span class="ident" id="5698468">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698491">return</span>&nbsp;<span class="ident" id="5698498">nil</span><span class="op" id="5698501">,</span>&nbsp;<span class="ident" id="5698503">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698511">for</span>&nbsp;<span class="ident" id="5698515">d</span><span class="op" id="5698516">.</span><span class="ident" id="5698517">stage</span>&nbsp;<span class="op" id="5698523">!=</span>&nbsp;<span class="ident" id="5698526">dsSeenIEND</span>&nbsp;<span class="op" id="5698537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698541">if</span>&nbsp;<span class="ident" id="5698544">err</span>&nbsp;<span class="op" id="5698548">:=</span>&nbsp;<span class="ident" id="5698551">d</span><span class="op" id="5698552">.</span><span class="ident" id="5698553">parseChunk</span><span class="op" id="5698563">(</span><span class="op" id="5698564">)</span><span class="op" id="5698565">;</span>&nbsp;<span class="ident" id="5698567">err</span>&nbsp;<span class="op" id="5698571">!=</span>&nbsp;<span class="ident" id="5698574">nil</span>&nbsp;<span class="op" id="5698578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698583">if</span>&nbsp;<span class="ident" id="5698586">err</span>&nbsp;<span class="op" id="5698590">==</span>&nbsp;<span class="ident" id="5698593">io</span><span class="op" id="5698595">.</span><span class="ident" id="5698596">EOF</span>&nbsp;<span class="op" id="5698600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698606">err</span>&nbsp;<span class="op" id="5698610">=</span>&nbsp;<span class="ident" id="5698612">io</span><span class="op" id="5698614">.</span><span class="ident" id="5698615">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698640">return</span>&nbsp;<span class="ident" id="5698647">nil</span><span class="op" id="5698650">,</span>&nbsp;<span class="ident" id="5698652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698664">return</span>&nbsp;<span class="ident" id="5698671">d</span><span class="op" id="5698672">.</span><span class="ident" id="5698673">img</span><span class="op" id="5698676">,</span>&nbsp;<span class="ident" id="5698678">nil</span><br>
<span class="lineno">760</span><span class="op" id="5698682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5698685">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5698763">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5698793">func</span>&nbsp;<span class="ident" id="5698798">DecodeConfig</span><span class="op" id="5698810">(</span><span class="ident" id="5698811">r</span>&nbsp;<span class="ident" id="5698813">io</span><span class="op" id="5698815">.</span><span class="ident" id="5698816">Reader</span><span class="op" id="5698822">)</span>&nbsp;<span class="op" id="5698824">(</span><span class="ident" id="5698825">image</span><span class="op" id="5698830">.</span><span class="ident" id="5698831">Config</span><span class="op" id="5698837">,</span>&nbsp;<span class="builtintype" id="5698839">error</span><span class="op" id="5698844">)</span>&nbsp;<span class="op" id="5698846">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698849">d</span>&nbsp;<span class="op" id="5698851">:=</span>&nbsp;<span class="op" id="5698854">&amp;</span><span class="ident" id="5698855">decoder</span><span class="op" id="5698862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698866">r</span><span class="op" id="5698867">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5698871">r</span><span class="op" id="5698872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698876">crc</span><span class="op" id="5698879">:</span>&nbsp;<span class="ident" id="5698881">crc32</span><span class="op" id="5698886">.</span><span class="ident" id="5698887">NewIEEE</span><span class="op" id="5698894">(</span><span class="op" id="5698895">)</span><span class="op" id="5698896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698902">if</span>&nbsp;<span class="ident" id="5698905">err</span>&nbsp;<span class="op" id="5698909">:=</span>&nbsp;<span class="ident" id="5698912">d</span><span class="op" id="5698913">.</span><span class="ident" id="5698914">checkHeader</span><span class="op" id="5698925">(</span><span class="op" id="5698926">)</span><span class="op" id="5698927">;</span>&nbsp;<span class="ident" id="5698929">err</span>&nbsp;<span class="op" id="5698933">!=</span>&nbsp;<span class="ident" id="5698936">nil</span>&nbsp;<span class="op" id="5698940">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698944">if</span>&nbsp;<span class="ident" id="5698947">err</span>&nbsp;<span class="op" id="5698951">==</span>&nbsp;<span class="ident" id="5698954">io</span><span class="op" id="5698956">.</span><span class="ident" id="5698957">EOF</span>&nbsp;<span class="op" id="5698961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698966">err</span>&nbsp;<span class="op" id="5698970">=</span>&nbsp;<span class="ident" id="5698972">io</span><span class="op" id="5698974">.</span><span class="ident" id="5698975">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698998">return</span>&nbsp;<span class="ident" id="5699005">image</span><span class="op" id="5699010">.</span><span class="ident" id="5699011">Config</span><span class="op" id="5699017">{</span><span class="op" id="5699018">}</span><span class="op" id="5699019">,</span>&nbsp;<span class="ident" id="5699021">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699026">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699029">for</span>&nbsp;<span class="op" id="5699033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699037">if</span>&nbsp;<span class="ident" id="5699040">err</span>&nbsp;<span class="op" id="5699044">:=</span>&nbsp;<span class="ident" id="5699047">d</span><span class="op" id="5699048">.</span><span class="ident" id="5699049">parseChunk</span><span class="op" id="5699059">(</span><span class="op" id="5699060">)</span><span class="op" id="5699061">;</span>&nbsp;<span class="ident" id="5699063">err</span>&nbsp;<span class="op" id="5699067">!=</span>&nbsp;<span class="ident" id="5699070">nil</span>&nbsp;<span class="op" id="5699074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699079">if</span>&nbsp;<span class="ident" id="5699082">err</span>&nbsp;<span class="op" id="5699086">==</span>&nbsp;<span class="ident" id="5699089">io</span><span class="op" id="5699091">.</span><span class="ident" id="5699092">EOF</span>&nbsp;<span class="op" id="5699096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699102">err</span>&nbsp;<span class="op" id="5699106">=</span>&nbsp;<span class="ident" id="5699108">io</span><span class="op" id="5699110">.</span><span class="ident" id="5699111">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699131">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699136">return</span>&nbsp;<span class="ident" id="5699143">image</span><span class="op" id="5699148">.</span><span class="ident" id="5699149">Config</span><span class="op" id="5699155">{</span><span class="op" id="5699156">}</span><span class="op" id="5699157">,</span>&nbsp;<span class="ident" id="5699159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699169">paletted</span>&nbsp;<span class="op" id="5699178">:=</span>&nbsp;<span class="ident" id="5699181">d</span><span class="op" id="5699182">.</span><span class="ident" id="5699183">cb</span>&nbsp;<span class="op" id="5699186">==</span>&nbsp;<span class="ident" id="5699189">cbP8</span>&nbsp;<span class="op" id="5699194">||</span>&nbsp;<span class="ident" id="5699197">d</span><span class="op" id="5699198">.</span><span class="ident" id="5699199">cb</span>&nbsp;<span class="op" id="5699202">==</span>&nbsp;<span class="ident" id="5699205">cbP4</span>&nbsp;<span class="op" id="5699210">||</span>&nbsp;<span class="ident" id="5699213">d</span><span class="op" id="5699214">.</span><span class="ident" id="5699215">cb</span>&nbsp;<span class="op" id="5699218">==</span>&nbsp;<span class="ident" id="5699221">cbP2</span>&nbsp;<span class="op" id="5699226">||</span>&nbsp;<span class="ident" id="5699229">d</span><span class="op" id="5699230">.</span><span class="ident" id="5699231">cb</span>&nbsp;<span class="op" id="5699234">==</span>&nbsp;<span class="ident" id="5699237">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699244">if</span>&nbsp;<span class="ident" id="5699247">d</span><span class="op" id="5699248">.</span><span class="ident" id="5699249">stage</span>&nbsp;<span class="op" id="5699255">==</span>&nbsp;<span class="ident" id="5699258">dsSeenIHDR</span>&nbsp;<span class="op" id="5699269">&amp;&amp;</span>&nbsp;<span class="op" id="5699272">!</span><span class="ident" id="5699273">paletted</span>&nbsp;<span class="op" id="5699282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699287">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699299">if</span>&nbsp;<span class="ident" id="5699302">d</span><span class="op" id="5699303">.</span><span class="ident" id="5699304">stage</span>&nbsp;<span class="op" id="5699310">==</span>&nbsp;<span class="ident" id="5699313">dsSeenPLTE</span>&nbsp;<span class="op" id="5699324">&amp;&amp;</span>&nbsp;<span class="ident" id="5699327">paletted</span>&nbsp;<span class="op" id="5699336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699341">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699352">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699355">var</span>&nbsp;<span class="ident" id="5699359">cm</span>&nbsp;<span class="ident" id="5699362">color</span><span class="op" id="5699367">.</span><span class="ident" id="5699368">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699375">switch</span>&nbsp;<span class="ident" id="5699382">d</span><span class="op" id="5699383">.</span><span class="ident" id="5699384">cb</span>&nbsp;<span class="op" id="5699387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699390">case</span>&nbsp;<span class="ident" id="5699395">cbG1</span><span class="op" id="5699399">,</span>&nbsp;<span class="ident" id="5699401">cbG2</span><span class="op" id="5699405">,</span>&nbsp;<span class="ident" id="5699407">cbG4</span><span class="op" id="5699411">,</span>&nbsp;<span class="ident" id="5699413">cbG8</span><span class="op" id="5699417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699421">cm</span>&nbsp;<span class="op" id="5699424">=</span>&nbsp;<span class="ident" id="5699426">color</span><span class="op" id="5699431">.</span><span class="ident" id="5699432">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699443">case</span>&nbsp;<span class="ident" id="5699448">cbGA8</span><span class="op" id="5699453">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699457">cm</span>&nbsp;<span class="op" id="5699460">=</span>&nbsp;<span class="ident" id="5699462">color</span><span class="op" id="5699467">.</span><span class="ident" id="5699468">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699480">case</span>&nbsp;<span class="ident" id="5699485">cbTC8</span><span class="op" id="5699490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699494">cm</span>&nbsp;<span class="op" id="5699497">=</span>&nbsp;<span class="ident" id="5699499">color</span><span class="op" id="5699504">.</span><span class="ident" id="5699505">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699516">case</span>&nbsp;<span class="ident" id="5699521">cbP1</span><span class="op" id="5699525">,</span>&nbsp;<span class="ident" id="5699527">cbP2</span><span class="op" id="5699531">,</span>&nbsp;<span class="ident" id="5699533">cbP4</span><span class="op" id="5699537">,</span>&nbsp;<span class="ident" id="5699539">cbP8</span><span class="op" id="5699543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699547">cm</span>&nbsp;<span class="op" id="5699550">=</span>&nbsp;<span class="ident" id="5699552">d</span><span class="op" id="5699553">.</span><span class="ident" id="5699554">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699563">case</span>&nbsp;<span class="ident" id="5699568">cbTCA8</span><span class="op" id="5699574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699578">cm</span>&nbsp;<span class="op" id="5699581">=</span>&nbsp;<span class="ident" id="5699583">color</span><span class="op" id="5699588">.</span><span class="ident" id="5699589">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699601">case</span>&nbsp;<span class="ident" id="5699606">cbG16</span><span class="op" id="5699611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699615">cm</span>&nbsp;<span class="op" id="5699618">=</span>&nbsp;<span class="ident" id="5699620">color</span><span class="op" id="5699625">.</span><span class="ident" id="5699626">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699639">case</span>&nbsp;<span class="ident" id="5699644">cbGA16</span><span class="op" id="5699650">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699654">cm</span>&nbsp;<span class="op" id="5699657">=</span>&nbsp;<span class="ident" id="5699659">color</span><span class="op" id="5699664">.</span><span class="ident" id="5699665">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699679">case</span>&nbsp;<span class="ident" id="5699684">cbTC16</span><span class="op" id="5699690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699694">cm</span>&nbsp;<span class="op" id="5699697">=</span>&nbsp;<span class="ident" id="5699699">color</span><span class="op" id="5699704">.</span><span class="ident" id="5699705">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699718">case</span>&nbsp;<span class="ident" id="5699723">cbTCA16</span><span class="op" id="5699730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699734">cm</span>&nbsp;<span class="op" id="5699737">=</span>&nbsp;<span class="ident" id="5699739">color</span><span class="op" id="5699744">.</span><span class="ident" id="5699745">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699762">return</span>&nbsp;<span class="ident" id="5699769">image</span><span class="op" id="5699774">.</span><span class="ident" id="5699775">Config</span><span class="op" id="5699781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699785">ColorModel</span><span class="op" id="5699795">:</span>&nbsp;<span class="ident" id="5699797">cm</span><span class="op" id="5699799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699803">Width</span><span class="op" id="5699808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5699815">d</span><span class="op" id="5699816">.</span><span class="ident" id="5699817">width</span><span class="op" id="5699822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699826">Height</span><span class="op" id="5699832">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5699838">d</span><span class="op" id="5699839">.</span><span class="ident" id="5699840">height</span><span class="op" id="5699846">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699849">}</span><span class="op" id="5699850">,</span>&nbsp;<span class="ident" id="5699852">nil</span><br>
<span class="lineno"></span><span class="op" id="5699856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5699859">func</span>&nbsp;<span class="ident" id="5699864">init</span><span class="op" id="5699868">(</span><span class="op" id="5699869">)</span>&nbsp;<span class="op" id="5699871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699874">image</span><span class="op" id="5699879">.</span><span class="ident" id="5699880">RegisterFormat</span><span class="op" id="5699894">(</span><span class="string" id="5699895">&#34;png&#34;</span><span class="op" id="5699900">,</span>&nbsp;<span class="ident" id="5699902">pngHeader</span><span class="op" id="5699911">,</span>&nbsp;<span class="ident" id="5699913">Decode</span><span class="op" id="5699919">,</span>&nbsp;<span class="ident" id="5699921">DecodeConfig</span><span class="op" id="5699933">)</span><br>
<span class="lineno">820</span><span class="op" id="5699935">}</span>
</div>
</body>
</html>
