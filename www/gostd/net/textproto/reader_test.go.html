<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7456562">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7456618">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7456672">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7456723">package</span>&nbsp;<span class="ident" id="7456731">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7456742">import</span>&nbsp;<span class="op" id="7456749">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7456752">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7456761">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7456770">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7456776">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7456787">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7456798">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7456808">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7456811">type</span>&nbsp;<span class="ident" id="7456816">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="7456839">struct</span>&nbsp;<span class="op" id="7456846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456849">in</span><span class="op" id="7456851">,</span>&nbsp;<span class="ident" id="7456853">out</span>&nbsp;<span class="builtintype" id="7456857">string</span><br>
<span class="lineno"></span><span class="op" id="7456864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7456867">var</span>&nbsp;<span class="ident" id="7456871">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7456895">=</span>&nbsp;<span class="op" id="7456897">[</span><span class="op" id="7456898">]</span><span class="ident" id="7456899">canonicalHeaderKeyTest</span><span class="op" id="7456921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456924">{</span><span class="string" id="7456925">&#34;a-b-c&#34;</span><span class="op" id="7456932">,</span>&nbsp;<span class="string" id="7456934">&#34;A-B-C&#34;</span><span class="op" id="7456941">}</span><span class="op" id="7456942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456945">{</span><span class="string" id="7456946">&#34;a-1-c&#34;</span><span class="op" id="7456953">,</span>&nbsp;<span class="string" id="7456955">&#34;A-1-C&#34;</span><span class="op" id="7456962">}</span><span class="op" id="7456963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456966">{</span><span class="string" id="7456967">&#34;User-Agent&#34;</span><span class="op" id="7456979">,</span>&nbsp;<span class="string" id="7456981">&#34;User-Agent&#34;</span><span class="op" id="7456993">}</span><span class="op" id="7456994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456997">{</span><span class="string" id="7456998">&#34;uSER-aGENT&#34;</span><span class="op" id="7457010">,</span>&nbsp;<span class="string" id="7457012">&#34;User-Agent&#34;</span><span class="op" id="7457024">}</span><span class="op" id="7457025">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457028">{</span><span class="string" id="7457029">&#34;user-agent&#34;</span><span class="op" id="7457041">,</span>&nbsp;<span class="string" id="7457043">&#34;User-Agent&#34;</span><span class="op" id="7457055">}</span><span class="op" id="7457056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457059">{</span><span class="string" id="7457060">&#34;USER-AGENT&#34;</span><span class="op" id="7457072">,</span>&nbsp;<span class="string" id="7457074">&#34;User-Agent&#34;</span><span class="op" id="7457086">}</span><span class="op" id="7457087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457090">{</span><span class="string" id="7457091">&#34;üser-agenT&#34;</span><span class="op" id="7457104">,</span>&nbsp;<span class="string" id="7457106">&#34;üser-Agent&#34;</span><span class="op" id="7457119">}</span><span class="op" id="7457120">,</span>&nbsp;<span class="comment" id="7457122">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7457147">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457202">{</span><span class="string" id="7457203">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="7457231">,</span>&nbsp;<span class="string" id="7457233">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="7457261">}</span><span class="op" id="7457262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457265">{</span><span class="string" id="7457266">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7457275">,</span>&nbsp;<span class="string" id="7457277">&#34;Foo-Bar&#34;</span><span class="op" id="7457286">}</span><span class="op" id="7457287">,</span><br>
<span class="lineno"></span><span class="op" id="7457289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457292">func</span>&nbsp;<span class="ident" id="7457297">TestCanonicalMIMEHeaderKey</span><span class="op" id="7457323">(</span><span class="ident" id="7457324">t</span>&nbsp;<span class="op" id="7457326">*</span><span class="ident" id="7457327">testing</span><span class="op" id="7457334">.</span><span class="ident" id="7457335">T</span><span class="op" id="7457336">)</span>&nbsp;<span class="op" id="7457338">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457341">for</span>&nbsp;<span class="ident" id="7457345">_</span><span class="op" id="7457346">,</span>&nbsp;<span class="ident" id="7457348">tt</span>&nbsp;<span class="op" id="7457351">:=</span>&nbsp;<span class="keyword" id="7457354">range</span>&nbsp;<span class="ident" id="7457360">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7457384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457388">if</span>&nbsp;<span class="ident" id="7457391">s</span>&nbsp;<span class="op" id="7457393">:=</span>&nbsp;<span class="ident" id="7457396">CanonicalMIMEHeaderKey</span><span class="op" id="7457418">(</span><span class="ident" id="7457419">tt</span><span class="op" id="7457421">.</span><span class="ident" id="7457422">in</span><span class="op" id="7457424">)</span><span class="op" id="7457425">;</span>&nbsp;<span class="ident" id="7457427">s</span>&nbsp;<span class="op" id="7457429">!=</span>&nbsp;<span class="ident" id="7457432">tt</span><span class="op" id="7457434">.</span><span class="ident" id="7457435">out</span>&nbsp;<span class="op" id="7457439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457444">t</span><span class="op" id="7457445">.</span><span class="ident" id="7457446">Errorf</span><span class="op" id="7457452">(</span><span class="string" id="7457453">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7457495">,</span>&nbsp;<span class="ident" id="7457497">tt</span><span class="op" id="7457499">.</span><span class="ident" id="7457500">in</span><span class="op" id="7457502">,</span>&nbsp;<span class="ident" id="7457504">s</span><span class="op" id="7457505">,</span>&nbsp;<span class="ident" id="7457507">tt</span><span class="op" id="7457509">.</span><span class="ident" id="7457510">out</span><span class="op" id="7457513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457520">}</span><br>
<span class="lineno">40</span><span class="op" id="7457522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457525">func</span>&nbsp;<span class="ident" id="7457530">reader</span><span class="op" id="7457536">(</span><span class="ident" id="7457537">s</span>&nbsp;<span class="builtintype" id="7457539">string</span><span class="op" id="7457545">)</span>&nbsp;<span class="op" id="7457547">*</span><span class="ident" id="7457548">Reader</span>&nbsp;<span class="op" id="7457555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457558">return</span>&nbsp;<span class="ident" id="7457565">NewReader</span><span class="op" id="7457574">(</span><span class="ident" id="7457575">bufio</span><span class="op" id="7457580">.</span><span class="ident" id="7457581">NewReader</span><span class="op" id="7457590">(</span><span class="ident" id="7457591">strings</span><span class="op" id="7457598">.</span><span class="ident" id="7457599">NewReader</span><span class="op" id="7457608">(</span><span class="ident" id="7457609">s</span><span class="op" id="7457610">)</span><span class="op" id="7457611">)</span><span class="op" id="7457612">)</span><br>
<span class="lineno"></span><span class="op" id="7457614">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7457617">func</span>&nbsp;<span class="ident" id="7457622">TestReadLine</span><span class="op" id="7457634">(</span><span class="ident" id="7457635">t</span>&nbsp;<span class="op" id="7457637">*</span><span class="ident" id="7457638">testing</span><span class="op" id="7457645">.</span><span class="ident" id="7457646">T</span><span class="op" id="7457647">)</span>&nbsp;<span class="op" id="7457649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457652">r</span>&nbsp;<span class="op" id="7457654">:=</span>&nbsp;<span class="ident" id="7457657">reader</span><span class="op" id="7457663">(</span><span class="string" id="7457664">&#34;line1\nline2\n&#34;</span><span class="op" id="7457680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457683">s</span><span class="op" id="7457684">,</span>&nbsp;<span class="ident" id="7457686">err</span>&nbsp;<span class="op" id="7457690">:=</span>&nbsp;<span class="ident" id="7457693">r</span><span class="op" id="7457694">.</span><span class="ident" id="7457695">ReadLine</span><span class="op" id="7457703">(</span><span class="op" id="7457704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457707">if</span>&nbsp;<span class="ident" id="7457710">s</span>&nbsp;<span class="op" id="7457712">!=</span>&nbsp;<span class="string" id="7457715">&#34;line1&#34;</span>&nbsp;<span class="op" id="7457723">||</span>&nbsp;<span class="ident" id="7457726">err</span>&nbsp;<span class="op" id="7457730">!=</span>&nbsp;<span class="ident" id="7457733">nil</span>&nbsp;<span class="op" id="7457737">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457741">t</span><span class="op" id="7457742">.</span><span class="ident" id="7457743">Fatalf</span><span class="op" id="7457749">(</span><span class="string" id="7457750">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7457766">,</span>&nbsp;<span class="ident" id="7457768">s</span><span class="op" id="7457769">,</span>&nbsp;<span class="ident" id="7457771">err</span><span class="op" id="7457774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457780">s</span><span class="op" id="7457781">,</span>&nbsp;<span class="ident" id="7457783">err</span>&nbsp;<span class="op" id="7457787">=</span>&nbsp;<span class="ident" id="7457789">r</span><span class="op" id="7457790">.</span><span class="ident" id="7457791">ReadLine</span><span class="op" id="7457799">(</span><span class="op" id="7457800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457803">if</span>&nbsp;<span class="ident" id="7457806">s</span>&nbsp;<span class="op" id="7457808">!=</span>&nbsp;<span class="string" id="7457811">&#34;line2&#34;</span>&nbsp;<span class="op" id="7457819">||</span>&nbsp;<span class="ident" id="7457822">err</span>&nbsp;<span class="op" id="7457826">!=</span>&nbsp;<span class="ident" id="7457829">nil</span>&nbsp;<span class="op" id="7457833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457837">t</span><span class="op" id="7457838">.</span><span class="ident" id="7457839">Fatalf</span><span class="op" id="7457845">(</span><span class="string" id="7457846">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7457862">,</span>&nbsp;<span class="ident" id="7457864">s</span><span class="op" id="7457865">,</span>&nbsp;<span class="ident" id="7457867">err</span><span class="op" id="7457870">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457876">s</span><span class="op" id="7457877">,</span>&nbsp;<span class="ident" id="7457879">err</span>&nbsp;<span class="op" id="7457883">=</span>&nbsp;<span class="ident" id="7457885">r</span><span class="op" id="7457886">.</span><span class="ident" id="7457887">ReadLine</span><span class="op" id="7457895">(</span><span class="op" id="7457896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457899">if</span>&nbsp;<span class="ident" id="7457902">s</span>&nbsp;<span class="op" id="7457904">!=</span>&nbsp;<span class="string" id="7457907">&#34;&#34;</span>&nbsp;<span class="op" id="7457910">||</span>&nbsp;<span class="ident" id="7457913">err</span>&nbsp;<span class="op" id="7457917">!=</span>&nbsp;<span class="ident" id="7457920">io</span><span class="op" id="7457922">.</span><span class="ident" id="7457923">EOF</span>&nbsp;<span class="op" id="7457927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457931">t</span><span class="op" id="7457932">.</span><span class="ident" id="7457933">Fatalf</span><span class="op" id="7457939">(</span><span class="string" id="7457940">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7457953">,</span>&nbsp;<span class="ident" id="7457955">s</span><span class="op" id="7457956">,</span>&nbsp;<span class="ident" id="7457958">err</span><span class="op" id="7457961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457964">}</span><br>
<span class="lineno">60</span><span class="op" id="7457966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457969">func</span>&nbsp;<span class="ident" id="7457974">TestReadContinuedLine</span><span class="op" id="7457995">(</span><span class="ident" id="7457996">t</span>&nbsp;<span class="op" id="7457998">*</span><span class="ident" id="7457999">testing</span><span class="op" id="7458006">.</span><span class="ident" id="7458007">T</span><span class="op" id="7458008">)</span>&nbsp;<span class="op" id="7458010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458013">r</span>&nbsp;<span class="op" id="7458015">:=</span>&nbsp;<span class="ident" id="7458018">reader</span><span class="op" id="7458024">(</span><span class="string" id="7458025">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="7458051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458054">s</span><span class="op" id="7458055">,</span>&nbsp;<span class="ident" id="7458057">err</span>&nbsp;<span class="op" id="7458061">:=</span>&nbsp;<span class="ident" id="7458064">r</span><span class="op" id="7458065">.</span><span class="ident" id="7458066">ReadContinuedLine</span><span class="op" id="7458083">(</span><span class="op" id="7458084">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458087">if</span>&nbsp;<span class="ident" id="7458090">s</span>&nbsp;<span class="op" id="7458092">!=</span>&nbsp;<span class="string" id="7458095">&#34;line1&#34;</span>&nbsp;<span class="op" id="7458103">||</span>&nbsp;<span class="ident" id="7458106">err</span>&nbsp;<span class="op" id="7458110">!=</span>&nbsp;<span class="ident" id="7458113">nil</span>&nbsp;<span class="op" id="7458117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458121">t</span><span class="op" id="7458122">.</span><span class="ident" id="7458123">Fatalf</span><span class="op" id="7458129">(</span><span class="string" id="7458130">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458146">,</span>&nbsp;<span class="ident" id="7458148">s</span><span class="op" id="7458149">,</span>&nbsp;<span class="ident" id="7458151">err</span><span class="op" id="7458154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458160">s</span><span class="op" id="7458161">,</span>&nbsp;<span class="ident" id="7458163">err</span>&nbsp;<span class="op" id="7458167">=</span>&nbsp;<span class="ident" id="7458169">r</span><span class="op" id="7458170">.</span><span class="ident" id="7458171">ReadContinuedLine</span><span class="op" id="7458188">(</span><span class="op" id="7458189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458192">if</span>&nbsp;<span class="ident" id="7458195">s</span>&nbsp;<span class="op" id="7458197">!=</span>&nbsp;<span class="string" id="7458200">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="7458209">||</span>&nbsp;<span class="ident" id="7458212">err</span>&nbsp;<span class="op" id="7458216">!=</span>&nbsp;<span class="ident" id="7458219">nil</span>&nbsp;<span class="op" id="7458223">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458227">t</span><span class="op" id="7458228">.</span><span class="ident" id="7458229">Fatalf</span><span class="op" id="7458235">(</span><span class="string" id="7458236">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458252">,</span>&nbsp;<span class="ident" id="7458254">s</span><span class="op" id="7458255">,</span>&nbsp;<span class="ident" id="7458257">err</span><span class="op" id="7458260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458266">s</span><span class="op" id="7458267">,</span>&nbsp;<span class="ident" id="7458269">err</span>&nbsp;<span class="op" id="7458273">=</span>&nbsp;<span class="ident" id="7458275">r</span><span class="op" id="7458276">.</span><span class="ident" id="7458277">ReadContinuedLine</span><span class="op" id="7458294">(</span><span class="op" id="7458295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458298">if</span>&nbsp;<span class="ident" id="7458301">s</span>&nbsp;<span class="op" id="7458303">!=</span>&nbsp;<span class="string" id="7458306">&#34;line3&#34;</span>&nbsp;<span class="op" id="7458314">||</span>&nbsp;<span class="ident" id="7458317">err</span>&nbsp;<span class="op" id="7458321">!=</span>&nbsp;<span class="ident" id="7458324">nil</span>&nbsp;<span class="op" id="7458328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458332">t</span><span class="op" id="7458333">.</span><span class="ident" id="7458334">Fatalf</span><span class="op" id="7458340">(</span><span class="string" id="7458341">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458357">,</span>&nbsp;<span class="ident" id="7458359">s</span><span class="op" id="7458360">,</span>&nbsp;<span class="ident" id="7458362">err</span><span class="op" id="7458365">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458371">s</span><span class="op" id="7458372">,</span>&nbsp;<span class="ident" id="7458374">err</span>&nbsp;<span class="op" id="7458378">=</span>&nbsp;<span class="ident" id="7458380">r</span><span class="op" id="7458381">.</span><span class="ident" id="7458382">ReadContinuedLine</span><span class="op" id="7458399">(</span><span class="op" id="7458400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458403">if</span>&nbsp;<span class="ident" id="7458406">s</span>&nbsp;<span class="op" id="7458408">!=</span>&nbsp;<span class="string" id="7458411">&#34;&#34;</span>&nbsp;<span class="op" id="7458414">||</span>&nbsp;<span class="ident" id="7458417">err</span>&nbsp;<span class="op" id="7458421">!=</span>&nbsp;<span class="ident" id="7458424">io</span><span class="op" id="7458426">.</span><span class="ident" id="7458427">EOF</span>&nbsp;<span class="op" id="7458431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458435">t</span><span class="op" id="7458436">.</span><span class="ident" id="7458437">Fatalf</span><span class="op" id="7458443">(</span><span class="string" id="7458444">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458457">,</span>&nbsp;<span class="ident" id="7458459">s</span><span class="op" id="7458460">,</span>&nbsp;<span class="ident" id="7458462">err</span><span class="op" id="7458465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458468">}</span><br>
<span class="lineno">80</span><span class="op" id="7458470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7458473">func</span>&nbsp;<span class="ident" id="7458478">TestReadCodeLine</span><span class="op" id="7458494">(</span><span class="ident" id="7458495">t</span>&nbsp;<span class="op" id="7458497">*</span><span class="ident" id="7458498">testing</span><span class="op" id="7458505">.</span><span class="ident" id="7458506">T</span><span class="op" id="7458507">)</span>&nbsp;<span class="op" id="7458509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458512">r</span>&nbsp;<span class="op" id="7458514">:=</span>&nbsp;<span class="ident" id="7458517">reader</span><span class="op" id="7458523">(</span><span class="string" id="7458524">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="7458555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458558">code</span><span class="op" id="7458562">,</span>&nbsp;<span class="ident" id="7458564">msg</span><span class="op" id="7458567">,</span>&nbsp;<span class="ident" id="7458569">err</span>&nbsp;<span class="op" id="7458573">:=</span>&nbsp;<span class="ident" id="7458576">r</span><span class="op" id="7458577">.</span><span class="ident" id="7458578">ReadCodeLine</span><span class="op" id="7458590">(</span><span class="num" id="7458591">0</span><span class="op" id="7458592">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458595">if</span>&nbsp;<span class="ident" id="7458598">code</span>&nbsp;<span class="op" id="7458603">!=</span>&nbsp;<span class="num" id="7458606">123</span>&nbsp;<span class="op" id="7458610">||</span>&nbsp;<span class="ident" id="7458613">msg</span>&nbsp;<span class="op" id="7458617">!=</span>&nbsp;<span class="string" id="7458620">&#34;hi&#34;</span>&nbsp;<span class="op" id="7458625">||</span>&nbsp;<span class="ident" id="7458628">err</span>&nbsp;<span class="op" id="7458632">!=</span>&nbsp;<span class="ident" id="7458635">nil</span>&nbsp;<span class="op" id="7458639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458643">t</span><span class="op" id="7458644">.</span><span class="ident" id="7458645">Fatalf</span><span class="op" id="7458651">(</span><span class="string" id="7458652">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458672">,</span>&nbsp;<span class="ident" id="7458674">code</span><span class="op" id="7458678">,</span>&nbsp;<span class="ident" id="7458680">msg</span><span class="op" id="7458683">,</span>&nbsp;<span class="ident" id="7458685">err</span><span class="op" id="7458688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458694">code</span><span class="op" id="7458698">,</span>&nbsp;<span class="ident" id="7458700">msg</span><span class="op" id="7458703">,</span>&nbsp;<span class="ident" id="7458705">err</span>&nbsp;<span class="op" id="7458709">=</span>&nbsp;<span class="ident" id="7458711">r</span><span class="op" id="7458712">.</span><span class="ident" id="7458713">ReadCodeLine</span><span class="op" id="7458725">(</span><span class="num" id="7458726">23</span><span class="op" id="7458728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458731">if</span>&nbsp;<span class="ident" id="7458734">code</span>&nbsp;<span class="op" id="7458739">!=</span>&nbsp;<span class="num" id="7458742">234</span>&nbsp;<span class="op" id="7458746">||</span>&nbsp;<span class="ident" id="7458749">msg</span>&nbsp;<span class="op" id="7458753">!=</span>&nbsp;<span class="string" id="7458756">&#34;bye&#34;</span>&nbsp;<span class="op" id="7458762">||</span>&nbsp;<span class="ident" id="7458765">err</span>&nbsp;<span class="op" id="7458769">!=</span>&nbsp;<span class="ident" id="7458772">nil</span>&nbsp;<span class="op" id="7458776">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458780">t</span><span class="op" id="7458781">.</span><span class="ident" id="7458782">Fatalf</span><span class="op" id="7458788">(</span><span class="string" id="7458789">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458809">,</span>&nbsp;<span class="ident" id="7458811">code</span><span class="op" id="7458815">,</span>&nbsp;<span class="ident" id="7458817">msg</span><span class="op" id="7458820">,</span>&nbsp;<span class="ident" id="7458822">err</span><span class="op" id="7458825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458831">code</span><span class="op" id="7458835">,</span>&nbsp;<span class="ident" id="7458837">msg</span><span class="op" id="7458840">,</span>&nbsp;<span class="ident" id="7458842">err</span>&nbsp;<span class="op" id="7458846">=</span>&nbsp;<span class="ident" id="7458848">r</span><span class="op" id="7458849">.</span><span class="ident" id="7458850">ReadCodeLine</span><span class="op" id="7458862">(</span><span class="num" id="7458863">346</span><span class="op" id="7458866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458869">if</span>&nbsp;<span class="ident" id="7458872">code</span>&nbsp;<span class="op" id="7458877">!=</span>&nbsp;<span class="num" id="7458880">345</span>&nbsp;<span class="op" id="7458884">||</span>&nbsp;<span class="ident" id="7458887">msg</span>&nbsp;<span class="op" id="7458891">!=</span>&nbsp;<span class="string" id="7458894">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="7458903">||</span>&nbsp;<span class="ident" id="7458906">err</span>&nbsp;<span class="op" id="7458910">==</span>&nbsp;<span class="ident" id="7458913">nil</span>&nbsp;<span class="op" id="7458917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7458921">t</span><span class="op" id="7458922">.</span><span class="ident" id="7458923">Fatalf</span><span class="op" id="7458929">(</span><span class="string" id="7458930">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7458950">,</span>&nbsp;<span class="ident" id="7458952">code</span><span class="op" id="7458956">,</span>&nbsp;<span class="ident" id="7458958">msg</span><span class="op" id="7458961">,</span>&nbsp;<span class="ident" id="7458963">err</span><span class="op" id="7458966">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7458969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458972">if</span>&nbsp;<span class="ident" id="7458975">e</span><span class="op" id="7458976">,</span>&nbsp;<span class="ident" id="7458978">ok</span>&nbsp;<span class="op" id="7458981">:=</span>&nbsp;<span class="ident" id="7458984">err</span><span class="op" id="7458987">.</span><span class="op" id="7458988">(</span><span class="op" id="7458989">*</span><span class="ident" id="7458990">Error</span><span class="op" id="7458995">)</span><span class="op" id="7458996">;</span>&nbsp;<span class="op" id="7458998">!</span><span class="ident" id="7458999">ok</span>&nbsp;<span class="op" id="7459002">||</span>&nbsp;<span class="ident" id="7459005">e</span><span class="op" id="7459006">.</span><span class="ident" id="7459007">Code</span>&nbsp;<span class="op" id="7459012">!=</span>&nbsp;<span class="ident" id="7459015">code</span>&nbsp;<span class="op" id="7459020">||</span>&nbsp;<span class="ident" id="7459023">e</span><span class="op" id="7459024">.</span><span class="ident" id="7459025">Msg</span>&nbsp;<span class="op" id="7459029">!=</span>&nbsp;<span class="ident" id="7459032">msg</span>&nbsp;<span class="op" id="7459036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459040">t</span><span class="op" id="7459041">.</span><span class="ident" id="7459042">Fatalf</span><span class="op" id="7459048">(</span><span class="string" id="7459049">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="7459075">,</span>&nbsp;<span class="ident" id="7459077">err</span><span class="op" id="7459080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459086">code</span><span class="op" id="7459090">,</span>&nbsp;<span class="ident" id="7459092">msg</span><span class="op" id="7459095">,</span>&nbsp;<span class="ident" id="7459097">err</span>&nbsp;<span class="op" id="7459101">=</span>&nbsp;<span class="ident" id="7459103">r</span><span class="op" id="7459104">.</span><span class="ident" id="7459105">ReadCodeLine</span><span class="op" id="7459117">(</span><span class="num" id="7459118">1</span><span class="op" id="7459119">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459122">if</span>&nbsp;<span class="ident" id="7459125">code</span>&nbsp;<span class="op" id="7459130">!=</span>&nbsp;<span class="num" id="7459133">0</span>&nbsp;<span class="op" id="7459135">||</span>&nbsp;<span class="ident" id="7459138">msg</span>&nbsp;<span class="op" id="7459142">!=</span>&nbsp;<span class="string" id="7459145">&#34;&#34;</span>&nbsp;<span class="op" id="7459148">||</span>&nbsp;<span class="ident" id="7459151">err</span>&nbsp;<span class="op" id="7459155">!=</span>&nbsp;<span class="ident" id="7459158">io</span><span class="op" id="7459160">.</span><span class="ident" id="7459161">EOF</span>&nbsp;<span class="op" id="7459165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459169">t</span><span class="op" id="7459170">.</span><span class="ident" id="7459171">Fatalf</span><span class="op" id="7459177">(</span><span class="string" id="7459178">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7459195">,</span>&nbsp;<span class="ident" id="7459197">code</span><span class="op" id="7459201">,</span>&nbsp;<span class="ident" id="7459203">msg</span><span class="op" id="7459206">,</span>&nbsp;<span class="ident" id="7459208">err</span><span class="op" id="7459211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459214">}</span><br>
<span class="lineno"></span><span class="op" id="7459216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7459219">func</span>&nbsp;<span class="ident" id="7459224">TestReadDotLines</span><span class="op" id="7459240">(</span><span class="ident" id="7459241">t</span>&nbsp;<span class="op" id="7459243">*</span><span class="ident" id="7459244">testing</span><span class="op" id="7459251">.</span><span class="ident" id="7459252">T</span><span class="op" id="7459253">)</span>&nbsp;<span class="op" id="7459255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459258">r</span>&nbsp;<span class="op" id="7459260">:=</span>&nbsp;<span class="ident" id="7459263">reader</span><span class="op" id="7459269">(</span><span class="string" id="7459270">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="7459333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459336">s</span><span class="op" id="7459337">,</span>&nbsp;<span class="ident" id="7459339">err</span>&nbsp;<span class="op" id="7459343">:=</span>&nbsp;<span class="ident" id="7459346">r</span><span class="op" id="7459347">.</span><span class="ident" id="7459348">ReadDotLines</span><span class="op" id="7459360">(</span><span class="op" id="7459361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459364">want</span>&nbsp;<span class="op" id="7459369">:=</span>&nbsp;<span class="op" id="7459372">[</span><span class="op" id="7459373">]</span><span class="builtintype" id="7459374">string</span><span class="op" id="7459380">{</span><span class="string" id="7459381">&#34;dotlines&#34;</span><span class="op" id="7459391">,</span>&nbsp;<span class="string" id="7459393">&#34;foo&#34;</span><span class="op" id="7459398">,</span>&nbsp;<span class="string" id="7459400">&#34;.bar&#34;</span><span class="op" id="7459406">,</span>&nbsp;<span class="string" id="7459408">&#34;..baz&#34;</span><span class="op" id="7459415">,</span>&nbsp;<span class="string" id="7459417">&#34;quux&#34;</span><span class="op" id="7459423">,</span>&nbsp;<span class="string" id="7459425">&#34;&#34;</span><span class="op" id="7459427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459430">if</span>&nbsp;<span class="op" id="7459433">!</span><span class="ident" id="7459434">reflect</span><span class="op" id="7459441">.</span><span class="ident" id="7459442">DeepEqual</span><span class="op" id="7459451">(</span><span class="ident" id="7459452">s</span><span class="op" id="7459453">,</span>&nbsp;<span class="ident" id="7459455">want</span><span class="op" id="7459459">)</span>&nbsp;<span class="op" id="7459461">||</span>&nbsp;<span class="ident" id="7459464">err</span>&nbsp;<span class="op" id="7459468">!=</span>&nbsp;<span class="ident" id="7459471">nil</span>&nbsp;<span class="op" id="7459475">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459479">t</span><span class="op" id="7459480">.</span><span class="ident" id="7459481">Fatalf</span><span class="op" id="7459487">(</span><span class="string" id="7459488">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7459510">,</span>&nbsp;<span class="ident" id="7459512">s</span><span class="op" id="7459513">,</span>&nbsp;<span class="ident" id="7459515">err</span><span class="op" id="7459518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459525">s</span><span class="op" id="7459526">,</span>&nbsp;<span class="ident" id="7459528">err</span>&nbsp;<span class="op" id="7459532">=</span>&nbsp;<span class="ident" id="7459534">r</span><span class="op" id="7459535">.</span><span class="ident" id="7459536">ReadDotLines</span><span class="op" id="7459548">(</span><span class="op" id="7459549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459552">want</span>&nbsp;<span class="op" id="7459557">=</span>&nbsp;<span class="op" id="7459559">[</span><span class="op" id="7459560">]</span><span class="builtintype" id="7459561">string</span><span class="op" id="7459567">{</span><span class="string" id="7459568">&#34;another&#34;</span><span class="op" id="7459577">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459580">if</span>&nbsp;<span class="op" id="7459583">!</span><span class="ident" id="7459584">reflect</span><span class="op" id="7459591">.</span><span class="ident" id="7459592">DeepEqual</span><span class="op" id="7459601">(</span><span class="ident" id="7459602">s</span><span class="op" id="7459603">,</span>&nbsp;<span class="ident" id="7459605">want</span><span class="op" id="7459609">)</span>&nbsp;<span class="op" id="7459611">||</span>&nbsp;<span class="ident" id="7459614">err</span>&nbsp;<span class="op" id="7459618">!=</span>&nbsp;<span class="ident" id="7459621">io</span><span class="op" id="7459623">.</span><span class="ident" id="7459624">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7459641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459645">t</span><span class="op" id="7459646">.</span><span class="ident" id="7459647">Fatalf</span><span class="op" id="7459653">(</span><span class="string" id="7459654">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7459677">,</span>&nbsp;<span class="ident" id="7459679">s</span><span class="op" id="7459680">,</span>&nbsp;<span class="ident" id="7459682">err</span><span class="op" id="7459685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459688">}</span><br>
<span class="lineno"></span><span class="op" id="7459690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7459693">func</span>&nbsp;<span class="ident" id="7459698">TestReadDotBytes</span><span class="op" id="7459714">(</span><span class="ident" id="7459715">t</span>&nbsp;<span class="op" id="7459717">*</span><span class="ident" id="7459718">testing</span><span class="op" id="7459725">.</span><span class="ident" id="7459726">T</span><span class="op" id="7459727">)</span>&nbsp;<span class="op" id="7459729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459732">r</span>&nbsp;<span class="op" id="7459734">:=</span>&nbsp;<span class="ident" id="7459737">reader</span><span class="op" id="7459743">(</span><span class="string" id="7459744">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="7459810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459813">b</span><span class="op" id="7459814">,</span>&nbsp;<span class="ident" id="7459816">err</span>&nbsp;<span class="op" id="7459820">:=</span>&nbsp;<span class="ident" id="7459823">r</span><span class="op" id="7459824">.</span><span class="ident" id="7459825">ReadDotBytes</span><span class="op" id="7459837">(</span><span class="op" id="7459838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459841">want</span>&nbsp;<span class="op" id="7459846">:=</span>&nbsp;<span class="op" id="7459849">[</span><span class="op" id="7459850">]</span><span class="builtintype" id="7459851">byte</span><span class="op" id="7459855">(</span><span class="string" id="7459856">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="7459894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7459897">if</span>&nbsp;<span class="op" id="7459900">!</span><span class="ident" id="7459901">reflect</span><span class="op" id="7459908">.</span><span class="ident" id="7459909">DeepEqual</span><span class="op" id="7459918">(</span><span class="ident" id="7459919">b</span><span class="op" id="7459920">,</span>&nbsp;<span class="ident" id="7459922">want</span><span class="op" id="7459926">)</span>&nbsp;<span class="op" id="7459928">||</span>&nbsp;<span class="ident" id="7459931">err</span>&nbsp;<span class="op" id="7459935">!=</span>&nbsp;<span class="ident" id="7459938">nil</span>&nbsp;<span class="op" id="7459942">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459946">t</span><span class="op" id="7459947">.</span><span class="ident" id="7459948">Fatalf</span><span class="op" id="7459954">(</span><span class="string" id="7459955">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7459977">,</span>&nbsp;<span class="ident" id="7459979">b</span><span class="op" id="7459980">,</span>&nbsp;<span class="ident" id="7459982">err</span><span class="op" id="7459985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7459988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7459992">b</span><span class="op" id="7459993">,</span>&nbsp;<span class="ident" id="7459995">err</span>&nbsp;<span class="op" id="7459999">=</span>&nbsp;<span class="ident" id="7460001">r</span><span class="op" id="7460002">.</span><span class="ident" id="7460003">ReadDotBytes</span><span class="op" id="7460015">(</span><span class="op" id="7460016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460019">want</span>&nbsp;<span class="op" id="7460024">=</span>&nbsp;<span class="op" id="7460026">[</span><span class="op" id="7460027">]</span><span class="builtintype" id="7460028">byte</span><span class="op" id="7460032">(</span><span class="string" id="7460033">&#34;anot.her\n&#34;</span><span class="op" id="7460045">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7460048">if</span>&nbsp;<span class="op" id="7460051">!</span><span class="ident" id="7460052">reflect</span><span class="op" id="7460059">.</span><span class="ident" id="7460060">DeepEqual</span><span class="op" id="7460069">(</span><span class="ident" id="7460070">b</span><span class="op" id="7460071">,</span>&nbsp;<span class="ident" id="7460073">want</span><span class="op" id="7460077">)</span>&nbsp;<span class="op" id="7460079">||</span>&nbsp;<span class="ident" id="7460082">err</span>&nbsp;<span class="op" id="7460086">!=</span>&nbsp;<span class="ident" id="7460089">io</span><span class="op" id="7460091">.</span><span class="ident" id="7460092">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7460109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460113">t</span><span class="op" id="7460114">.</span><span class="ident" id="7460115">Fatalf</span><span class="op" id="7460121">(</span><span class="string" id="7460122">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7460145">,</span>&nbsp;<span class="ident" id="7460147">b</span><span class="op" id="7460148">,</span>&nbsp;<span class="ident" id="7460150">err</span><span class="op" id="7460153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460156">}</span><br>
<span class="lineno"></span><span class="op" id="7460158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="7460161">func</span>&nbsp;<span class="ident" id="7460166">TestReadMIMEHeader</span><span class="op" id="7460184">(</span><span class="ident" id="7460185">t</span>&nbsp;<span class="op" id="7460187">*</span><span class="ident" id="7460188">testing</span><span class="op" id="7460195">.</span><span class="ident" id="7460196">T</span><span class="op" id="7460197">)</span>&nbsp;<span class="op" id="7460199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460202">r</span>&nbsp;<span class="op" id="7460204">:=</span>&nbsp;<span class="ident" id="7460207">reader</span><span class="op" id="7460213">(</span><span class="string" id="7460214">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="7460292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460295">m</span><span class="op" id="7460296">,</span>&nbsp;<span class="ident" id="7460298">err</span>&nbsp;<span class="op" id="7460302">:=</span>&nbsp;<span class="ident" id="7460305">r</span><span class="op" id="7460306">.</span><span class="ident" id="7460307">ReadMIMEHeader</span><span class="op" id="7460321">(</span><span class="op" id="7460322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460325">want</span>&nbsp;<span class="op" id="7460330">:=</span>&nbsp;<span class="ident" id="7460333">MIMEHeader</span><span class="op" id="7460343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7460347">&#34;My-Key&#34;</span><span class="op" id="7460355">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7460359">{</span><span class="string" id="7460360">&#34;Value&nbsp;1&#34;</span><span class="op" id="7460369">,</span>&nbsp;<span class="string" id="7460371">&#34;Value&nbsp;2&#34;</span><span class="op" id="7460380">}</span><span class="op" id="7460381">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7460385">&#34;Long-Key&#34;</span><span class="op" id="7460395">:</span>&nbsp;<span class="op" id="7460397">{</span><span class="string" id="7460398">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="7460417">}</span><span class="op" id="7460418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7460424">if</span>&nbsp;<span class="op" id="7460427">!</span><span class="ident" id="7460428">reflect</span><span class="op" id="7460435">.</span><span class="ident" id="7460436">DeepEqual</span><span class="op" id="7460445">(</span><span class="ident" id="7460446">m</span><span class="op" id="7460447">,</span>&nbsp;<span class="ident" id="7460449">want</span><span class="op" id="7460453">)</span>&nbsp;<span class="op" id="7460455">||</span>&nbsp;<span class="ident" id="7460458">err</span>&nbsp;<span class="op" id="7460462">!=</span>&nbsp;<span class="ident" id="7460465">nil</span>&nbsp;<span class="op" id="7460469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460473">t</span><span class="op" id="7460474">.</span><span class="ident" id="7460475">Fatalf</span><span class="op" id="7460481">(</span><span class="string" id="7460482">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7460515">,</span>&nbsp;<span class="ident" id="7460517">m</span><span class="op" id="7460518">,</span>&nbsp;<span class="ident" id="7460520">err</span><span class="op" id="7460523">,</span>&nbsp;<span class="ident" id="7460525">want</span><span class="op" id="7460529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460532">}</span><br>
<span class="lineno">145</span><span class="op" id="7460534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7460537">func</span>&nbsp;<span class="ident" id="7460542">TestReadMIMEHeaderSingle</span><span class="op" id="7460566">(</span><span class="ident" id="7460567">t</span>&nbsp;<span class="op" id="7460569">*</span><span class="ident" id="7460570">testing</span><span class="op" id="7460577">.</span><span class="ident" id="7460578">T</span><span class="op" id="7460579">)</span>&nbsp;<span class="op" id="7460581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460584">r</span>&nbsp;<span class="op" id="7460586">:=</span>&nbsp;<span class="ident" id="7460589">reader</span><span class="op" id="7460595">(</span><span class="string" id="7460596">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="7460610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460613">m</span><span class="op" id="7460614">,</span>&nbsp;<span class="ident" id="7460616">err</span>&nbsp;<span class="op" id="7460620">:=</span>&nbsp;<span class="ident" id="7460623">r</span><span class="op" id="7460624">.</span><span class="ident" id="7460625">ReadMIMEHeader</span><span class="op" id="7460639">(</span><span class="op" id="7460640">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460643">want</span>&nbsp;<span class="op" id="7460648">:=</span>&nbsp;<span class="ident" id="7460651">MIMEHeader</span><span class="op" id="7460661">{</span><span class="string" id="7460662">&#34;Foo&#34;</span><span class="op" id="7460667">:</span>&nbsp;<span class="op" id="7460669">{</span><span class="string" id="7460670">&#34;bar&#34;</span><span class="op" id="7460675">}</span><span class="op" id="7460676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7460679">if</span>&nbsp;<span class="op" id="7460682">!</span><span class="ident" id="7460683">reflect</span><span class="op" id="7460690">.</span><span class="ident" id="7460691">DeepEqual</span><span class="op" id="7460700">(</span><span class="ident" id="7460701">m</span><span class="op" id="7460702">,</span>&nbsp;<span class="ident" id="7460704">want</span><span class="op" id="7460708">)</span>&nbsp;<span class="op" id="7460710">||</span>&nbsp;<span class="ident" id="7460713">err</span>&nbsp;<span class="op" id="7460717">!=</span>&nbsp;<span class="ident" id="7460720">nil</span>&nbsp;<span class="op" id="7460724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460728">t</span><span class="op" id="7460729">.</span><span class="ident" id="7460730">Fatalf</span><span class="op" id="7460736">(</span><span class="string" id="7460737">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7460770">,</span>&nbsp;<span class="ident" id="7460772">m</span><span class="op" id="7460773">,</span>&nbsp;<span class="ident" id="7460775">err</span><span class="op" id="7460778">,</span>&nbsp;<span class="ident" id="7460780">want</span><span class="op" id="7460784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460787">}</span><br>
<span class="lineno"></span><span class="op" id="7460789">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7460792">func</span>&nbsp;<span class="ident" id="7460797">TestLargeReadMIMEHeader</span><span class="op" id="7460820">(</span><span class="ident" id="7460821">t</span>&nbsp;<span class="op" id="7460823">*</span><span class="ident" id="7460824">testing</span><span class="op" id="7460831">.</span><span class="ident" id="7460832">T</span><span class="op" id="7460833">)</span>&nbsp;<span class="op" id="7460835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460838">data</span>&nbsp;<span class="op" id="7460843">:=</span>&nbsp;<span class="builtinfunc" id="7460846">make</span><span class="op" id="7460850">(</span><span class="op" id="7460851">[</span><span class="op" id="7460852">]</span><span class="builtintype" id="7460853">byte</span><span class="op" id="7460857">,</span>&nbsp;<span class="num" id="7460859">16</span><span class="op" id="7460861">*</span><span class="num" id="7460862">1024</span><span class="op" id="7460866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7460869">for</span>&nbsp;<span class="ident" id="7460873">i</span>&nbsp;<span class="op" id="7460875">:=</span>&nbsp;<span class="num" id="7460878">0</span><span class="op" id="7460879">;</span>&nbsp;<span class="ident" id="7460881">i</span>&nbsp;<span class="op" id="7460883">&lt;</span>&nbsp;<span class="builtinfunc" id="7460885">len</span><span class="op" id="7460888">(</span><span class="ident" id="7460889">data</span><span class="op" id="7460893">)</span><span class="op" id="7460894">;</span>&nbsp;<span class="ident" id="7460896">i</span><span class="op" id="7460897">++</span>&nbsp;<span class="op" id="7460900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460904">data</span><span class="op" id="7460908">[</span><span class="ident" id="7460909">i</span><span class="op" id="7460910">]</span>&nbsp;<span class="op" id="7460912">=</span>&nbsp;<span class="string" id="7460914">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7460919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460922">sdata</span>&nbsp;<span class="op" id="7460928">:=</span>&nbsp;<span class="builtintype" id="7460931">string</span><span class="op" id="7460937">(</span><span class="ident" id="7460938">data</span><span class="op" id="7460942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460945">r</span>&nbsp;<span class="op" id="7460947">:=</span>&nbsp;<span class="ident" id="7460950">reader</span><span class="op" id="7460956">(</span><span class="string" id="7460957">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="7460968">+</span>&nbsp;<span class="ident" id="7460970">sdata</span>&nbsp;<span class="op" id="7460976">+</span>&nbsp;<span class="string" id="7460978">&#34;\r\n\n&#34;</span><span class="op" id="7460986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7460989">m</span><span class="op" id="7460990">,</span>&nbsp;<span class="ident" id="7460992">err</span>&nbsp;<span class="op" id="7460996">:=</span>&nbsp;<span class="ident" id="7460999">r</span><span class="op" id="7461000">.</span><span class="ident" id="7461001">ReadMIMEHeader</span><span class="op" id="7461015">(</span><span class="op" id="7461016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7461019">if</span>&nbsp;<span class="ident" id="7461022">err</span>&nbsp;<span class="op" id="7461026">!=</span>&nbsp;<span class="ident" id="7461029">nil</span>&nbsp;<span class="op" id="7461033">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461037">t</span><span class="op" id="7461038">.</span><span class="ident" id="7461039">Fatalf</span><span class="op" id="7461045">(</span><span class="string" id="7461046">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="7461066">,</span>&nbsp;<span class="ident" id="7461068">err</span><span class="op" id="7461071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461077">cookie</span>&nbsp;<span class="op" id="7461084">:=</span>&nbsp;<span class="ident" id="7461087">m</span><span class="op" id="7461088">.</span><span class="ident" id="7461089">Get</span><span class="op" id="7461092">(</span><span class="string" id="7461093">&#34;Cookie&#34;</span><span class="op" id="7461101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7461104">if</span>&nbsp;<span class="ident" id="7461107">cookie</span>&nbsp;<span class="op" id="7461114">!=</span>&nbsp;<span class="ident" id="7461117">sdata</span>&nbsp;<span class="op" id="7461123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461127">t</span><span class="op" id="7461128">.</span><span class="ident" id="7461129">Fatalf</span><span class="op" id="7461135">(</span><span class="string" id="7461136">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="7461177">,</span>&nbsp;<span class="builtinfunc" id="7461179">len</span><span class="op" id="7461182">(</span><span class="ident" id="7461183">cookie</span><span class="op" id="7461189">)</span><span class="op" id="7461190">,</span>&nbsp;<span class="builtinfunc" id="7461192">len</span><span class="op" id="7461195">(</span><span class="ident" id="7461196">sdata</span><span class="op" id="7461201">)</span><span class="op" id="7461202">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461205">}</span><br>
<span class="lineno"></span><span class="op" id="7461207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7461210">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="7461277">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="7461327">func</span>&nbsp;<span class="ident" id="7461332">TestReadMIMEHeaderNonCompliant</span><span class="op" id="7461362">(</span><span class="ident" id="7461363">t</span>&nbsp;<span class="op" id="7461365">*</span><span class="ident" id="7461366">testing</span><span class="op" id="7461373">.</span><span class="ident" id="7461374">T</span><span class="op" id="7461375">)</span>&nbsp;<span class="op" id="7461377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7461380">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7461441">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461506">r</span>&nbsp;<span class="op" id="7461508">:=</span>&nbsp;<span class="ident" id="7461511">reader</span><span class="op" id="7461517">(</span><span class="string" id="7461518">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="7461533">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461537">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="7461564">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461568">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7461582">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461586">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="7461610">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461614">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="7461639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461642">m</span><span class="op" id="7461643">,</span>&nbsp;<span class="ident" id="7461645">err</span>&nbsp;<span class="op" id="7461649">:=</span>&nbsp;<span class="ident" id="7461652">r</span><span class="op" id="7461653">.</span><span class="ident" id="7461654">ReadMIMEHeader</span><span class="op" id="7461668">(</span><span class="op" id="7461669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461672">want</span>&nbsp;<span class="op" id="7461677">:=</span>&nbsp;<span class="ident" id="7461680">MIMEHeader</span><span class="op" id="7461690">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461694">&#34;Foo&#34;</span><span class="op" id="7461699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7461714">{</span><span class="string" id="7461715">&#34;bar&#34;</span><span class="op" id="7461720">}</span><span class="op" id="7461721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461725">&#34;Content-Language&#34;</span><span class="op" id="7461743">:</span>&nbsp;<span class="op" id="7461745">{</span><span class="string" id="7461746">&#34;en&#34;</span><span class="op" id="7461750">}</span><span class="op" id="7461751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461755">&#34;Sid&#34;</span><span class="op" id="7461760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7461775">{</span><span class="string" id="7461776">&#34;0&#34;</span><span class="op" id="7461779">}</span><span class="op" id="7461780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461784">&#34;Audio-Mode&#34;</span><span class="op" id="7461796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7461804">{</span><span class="string" id="7461805">&#34;None&#34;</span><span class="op" id="7461811">}</span><span class="op" id="7461812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7461816">&#34;Privilege&#34;</span><span class="op" id="7461827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7461836">{</span><span class="string" id="7461837">&#34;127&#34;</span><span class="op" id="7461842">}</span><span class="op" id="7461843">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7461849">if</span>&nbsp;<span class="op" id="7461852">!</span><span class="ident" id="7461853">reflect</span><span class="op" id="7461860">.</span><span class="ident" id="7461861">DeepEqual</span><span class="op" id="7461870">(</span><span class="ident" id="7461871">m</span><span class="op" id="7461872">,</span>&nbsp;<span class="ident" id="7461874">want</span><span class="op" id="7461878">)</span>&nbsp;<span class="op" id="7461880">||</span>&nbsp;<span class="ident" id="7461883">err</span>&nbsp;<span class="op" id="7461887">!=</span>&nbsp;<span class="ident" id="7461890">nil</span>&nbsp;<span class="op" id="7461894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461898">t</span><span class="op" id="7461899">.</span><span class="ident" id="7461900">Fatalf</span><span class="op" id="7461906">(</span><span class="string" id="7461907">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="7461944">,</span>&nbsp;<span class="ident" id="7461946">m</span><span class="op" id="7461947">,</span>&nbsp;<span class="ident" id="7461949">err</span><span class="op" id="7461952">,</span>&nbsp;<span class="ident" id="7461954">want</span><span class="op" id="7461958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7461961">}</span><br>
<span class="lineno"></span><span class="op" id="7461963">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7461966">type</span>&nbsp;<span class="ident" id="7461971">readResponseTest</span>&nbsp;<span class="keyword" id="7461988">struct</span>&nbsp;<span class="op" id="7461995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7461998">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7462007">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462015">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7462024">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462029">wantCode</span>&nbsp;<span class="builtintype" id="7462038">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462043">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="7462052">string</span><br>
<span class="lineno"></span><span class="op" id="7462059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7462062">var</span>&nbsp;<span class="ident" id="7462066">readResponseTests</span>&nbsp;<span class="op" id="7462084">=</span>&nbsp;<span class="op" id="7462086">[</span><span class="op" id="7462087">]</span><span class="ident" id="7462088">readResponseTest</span><span class="op" id="7462104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462107">{</span><span class="string" id="7462108">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="7462161">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462165">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="7462195">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462199">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="7462212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462216">23</span><span class="op" id="7462218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462222">230</span><span class="op" id="7462225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462229">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="7462311">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462314">}</span><span class="op" id="7462315">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462319">{</span><span class="string" id="7462320">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="7462372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462376">23</span><span class="op" id="7462378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462382">230</span><span class="op" id="7462385">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462389">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="7462435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462438">}</span><span class="op" id="7462439">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462443">{</span><span class="string" id="7462444">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="7462465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462469">4</span><span class="op" id="7462470">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462474">400</span><span class="op" id="7462477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462481">&#34;A\nB\nC&#34;</span><span class="op" id="7462490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462493">}</span><span class="op" id="7462494">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462498">{</span><span class="string" id="7462499">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="7462528">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462532">4</span><span class="op" id="7462533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7462537">400</span><span class="op" id="7462540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462544">&#34;A\nB\nC&#34;</span><span class="op" id="7462553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462556">}</span><span class="op" id="7462557">,</span><br>
<span class="lineno"></span><span class="op" id="7462559">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="7462562">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="7462613">func</span>&nbsp;<span class="ident" id="7462618">TestRFC959Lines</span><span class="op" id="7462633">(</span><span class="ident" id="7462634">t</span>&nbsp;<span class="op" id="7462636">*</span><span class="ident" id="7462637">testing</span><span class="op" id="7462644">.</span><span class="ident" id="7462645">T</span><span class="op" id="7462646">)</span>&nbsp;<span class="op" id="7462648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7462651">for</span>&nbsp;<span class="ident" id="7462655">i</span><span class="op" id="7462656">,</span>&nbsp;<span class="ident" id="7462658">tt</span>&nbsp;<span class="op" id="7462661">:=</span>&nbsp;<span class="keyword" id="7462664">range</span>&nbsp;<span class="ident" id="7462670">readResponseTests</span>&nbsp;<span class="op" id="7462688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462692">r</span>&nbsp;<span class="op" id="7462694">:=</span>&nbsp;<span class="ident" id="7462697">reader</span><span class="op" id="7462703">(</span><span class="ident" id="7462704">tt</span><span class="op" id="7462706">.</span><span class="ident" id="7462707">in</span>&nbsp;<span class="op" id="7462710">+</span>&nbsp;<span class="string" id="7462712">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="7462730">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462734">code</span><span class="op" id="7462738">,</span>&nbsp;<span class="ident" id="7462740">msg</span><span class="op" id="7462743">,</span>&nbsp;<span class="ident" id="7462745">err</span>&nbsp;<span class="op" id="7462749">:=</span>&nbsp;<span class="ident" id="7462752">r</span><span class="op" id="7462753">.</span><span class="ident" id="7462754">ReadResponse</span><span class="op" id="7462766">(</span><span class="ident" id="7462767">tt</span><span class="op" id="7462769">.</span><span class="ident" id="7462770">inCode</span><span class="op" id="7462776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7462780">if</span>&nbsp;<span class="ident" id="7462783">err</span>&nbsp;<span class="op" id="7462787">!=</span>&nbsp;<span class="ident" id="7462790">nil</span>&nbsp;<span class="op" id="7462794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462799">t</span><span class="op" id="7462800">.</span><span class="ident" id="7462801">Errorf</span><span class="op" id="7462807">(</span><span class="string" id="7462808">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7462831">,</span>&nbsp;<span class="ident" id="7462833">i</span><span class="op" id="7462834">,</span>&nbsp;<span class="ident" id="7462836">err</span><span class="op" id="7462839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7462844">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462855">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7462859">if</span>&nbsp;<span class="ident" id="7462862">code</span>&nbsp;<span class="op" id="7462867">!=</span>&nbsp;<span class="ident" id="7462870">tt</span><span class="op" id="7462872">.</span><span class="ident" id="7462873">wantCode</span>&nbsp;<span class="op" id="7462882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462887">t</span><span class="op" id="7462888">.</span><span class="ident" id="7462889">Errorf</span><span class="op" id="7462895">(</span><span class="string" id="7462896">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7462919">,</span>&nbsp;<span class="ident" id="7462921">i</span><span class="op" id="7462922">,</span>&nbsp;<span class="ident" id="7462924">code</span><span class="op" id="7462928">,</span>&nbsp;<span class="ident" id="7462930">tt</span><span class="op" id="7462932">.</span><span class="ident" id="7462933">wantCode</span><span class="op" id="7462941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7462945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7462949">if</span>&nbsp;<span class="ident" id="7462952">msg</span>&nbsp;<span class="op" id="7462956">!=</span>&nbsp;<span class="ident" id="7462959">tt</span><span class="op" id="7462961">.</span><span class="ident" id="7462962">wantMsg</span>&nbsp;<span class="op" id="7462970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462975">t</span><span class="op" id="7462976">.</span><span class="ident" id="7462977">Errorf</span><span class="op" id="7462983">(</span><span class="string" id="7462984">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7463006">,</span>&nbsp;<span class="ident" id="7463008">i</span><span class="op" id="7463009">,</span>&nbsp;<span class="ident" id="7463011">msg</span><span class="op" id="7463014">,</span>&nbsp;<span class="ident" id="7463016">tt</span><span class="op" id="7463018">.</span><span class="ident" id="7463019">wantMsg</span><span class="op" id="7463026">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463033">}</span><br>
<span class="lineno"></span><span class="op" id="7463035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7463038">func</span>&nbsp;<span class="ident" id="7463043">TestCommonHeaders</span><span class="op" id="7463060">(</span><span class="ident" id="7463061">t</span>&nbsp;<span class="op" id="7463063">*</span><span class="ident" id="7463064">testing</span><span class="op" id="7463071">.</span><span class="ident" id="7463072">T</span><span class="op" id="7463073">)</span>&nbsp;<span class="op" id="7463075">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463078">for</span>&nbsp;<span class="ident" id="7463082">h</span>&nbsp;<span class="op" id="7463084">:=</span>&nbsp;<span class="keyword" id="7463087">range</span>&nbsp;<span class="ident" id="7463093">commonHeader</span>&nbsp;<span class="op" id="7463106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463110">if</span>&nbsp;<span class="ident" id="7463113">h</span>&nbsp;<span class="op" id="7463115">!=</span>&nbsp;<span class="ident" id="7463118">CanonicalMIMEHeaderKey</span><span class="op" id="7463140">(</span><span class="ident" id="7463141">h</span><span class="op" id="7463142">)</span>&nbsp;<span class="op" id="7463144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463149">t</span><span class="op" id="7463150">.</span><span class="ident" id="7463151">Errorf</span><span class="op" id="7463157">(</span><span class="string" id="7463158">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="7463199">,</span>&nbsp;<span class="ident" id="7463201">h</span><span class="op" id="7463202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463209">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463212">b</span>&nbsp;<span class="op" id="7463214">:=</span>&nbsp;<span class="op" id="7463217">[</span><span class="op" id="7463218">]</span><span class="builtintype" id="7463219">byte</span><span class="op" id="7463223">(</span><span class="string" id="7463224">&#34;content-Length&#34;</span><span class="op" id="7463240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463243">want</span>&nbsp;<span class="op" id="7463248">:=</span>&nbsp;<span class="string" id="7463251">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463269">n</span>&nbsp;<span class="op" id="7463271">:=</span>&nbsp;<span class="ident" id="7463274">testing</span><span class="op" id="7463281">.</span><span class="ident" id="7463282">AllocsPerRun</span><span class="op" id="7463294">(</span><span class="num" id="7463295">200</span><span class="op" id="7463298">,</span>&nbsp;<span class="keyword" id="7463300">func</span><span class="op" id="7463304">(</span><span class="op" id="7463305">)</span>&nbsp;<span class="op" id="7463307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463311">if</span>&nbsp;<span class="ident" id="7463314">x</span>&nbsp;<span class="op" id="7463316">:=</span>&nbsp;<span class="ident" id="7463319">canonicalMIMEHeaderKey</span><span class="op" id="7463341">(</span><span class="ident" id="7463342">b</span><span class="op" id="7463343">)</span><span class="op" id="7463344">;</span>&nbsp;<span class="ident" id="7463346">x</span>&nbsp;<span class="op" id="7463348">!=</span>&nbsp;<span class="ident" id="7463351">want</span>&nbsp;<span class="op" id="7463356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463361">t</span><span class="op" id="7463362">.</span><span class="ident" id="7463363">Fatalf</span><span class="op" id="7463369">(</span><span class="string" id="7463370">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7463412">,</span>&nbsp;<span class="ident" id="7463414">b</span><span class="op" id="7463415">,</span>&nbsp;<span class="ident" id="7463417">x</span><span class="op" id="7463418">,</span>&nbsp;<span class="ident" id="7463420">want</span><span class="op" id="7463424">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463431">}</span><span class="op" id="7463432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463435">if</span>&nbsp;<span class="ident" id="7463438">n</span>&nbsp;<span class="op" id="7463440">&gt;</span>&nbsp;<span class="num" id="7463442">0</span>&nbsp;<span class="op" id="7463444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463448">t</span><span class="op" id="7463449">.</span><span class="ident" id="7463450">Errorf</span><span class="op" id="7463456">(</span><span class="string" id="7463457">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7463501">,</span>&nbsp;<span class="ident" id="7463503">n</span><span class="op" id="7463504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463507">}</span><br>
<span class="lineno">265</span><span class="op" id="7463509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7463512">var</span>&nbsp;<span class="ident" id="7463516">clientHeaders</span>&nbsp;<span class="op" id="7463530">=</span>&nbsp;<span class="ident" id="7463532">strings</span><span class="op" id="7463539">.</span><span class="ident" id="7463540">Replace</span><span class="op" id="7463547">(</span><span class="string" id="7463548">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="7464225">,</span>&nbsp;<span class="string" id="7464227">&#34;\n&#34;</span><span class="op" id="7464231">,</span>&nbsp;<span class="string" id="7464233">&#34;\r\n&#34;</span><span class="op" id="7464239">,</span>&nbsp;<span class="op" id="7464241">-</span><span class="num" id="7464242">1</span><span class="op" id="7464243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7464246">var</span>&nbsp;<span class="ident" id="7464250">serverHeaders</span>&nbsp;<span class="op" id="7464264">=</span>&nbsp;<span class="ident" id="7464266">strings</span><span class="op" id="7464273">.</span><span class="ident" id="7464274">Replace</span><span class="op" id="7464281">(</span><span class="string" id="7464282">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="7464534">,</span>&nbsp;<span class="string" id="7464536">&#34;\n&#34;</span><span class="op" id="7464540">,</span>&nbsp;<span class="string" id="7464542">&#34;\r\n&#34;</span><span class="op" id="7464548">,</span>&nbsp;<span class="op" id="7464550">-</span><span class="num" id="7464551">1</span><span class="op" id="7464552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7464555">func</span>&nbsp;<span class="ident" id="7464560">BenchmarkReadMIMEHeader</span><span class="op" id="7464583">(</span><span class="ident" id="7464584">b</span>&nbsp;<span class="op" id="7464586">*</span><span class="ident" id="7464587">testing</span><span class="op" id="7464594">.</span><span class="ident" id="7464595">B</span><span class="op" id="7464596">)</span>&nbsp;<span class="op" id="7464598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464601">b</span><span class="op" id="7464602">.</span><span class="ident" id="7464603">ReportAllocs</span><span class="op" id="7464615">(</span><span class="op" id="7464616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464619">var</span>&nbsp;<span class="ident" id="7464623">buf</span>&nbsp;<span class="ident" id="7464627">bytes</span><span class="op" id="7464632">.</span><span class="ident" id="7464633">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464641">br</span>&nbsp;<span class="op" id="7464644">:=</span>&nbsp;<span class="ident" id="7464647">bufio</span><span class="op" id="7464652">.</span><span class="ident" id="7464653">NewReader</span><span class="op" id="7464662">(</span><span class="op" id="7464663">&amp;</span><span class="ident" id="7464664">buf</span><span class="op" id="7464667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464670">r</span>&nbsp;<span class="op" id="7464672">:=</span>&nbsp;<span class="ident" id="7464675">NewReader</span><span class="op" id="7464684">(</span><span class="ident" id="7464685">br</span><span class="op" id="7464687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464690">for</span>&nbsp;<span class="ident" id="7464694">i</span>&nbsp;<span class="op" id="7464696">:=</span>&nbsp;<span class="num" id="7464699">0</span><span class="op" id="7464700">;</span>&nbsp;<span class="ident" id="7464702">i</span>&nbsp;<span class="op" id="7464704">&lt;</span>&nbsp;<span class="ident" id="7464706">b</span><span class="op" id="7464707">.</span><span class="ident" id="7464708">N</span><span class="op" id="7464709">;</span>&nbsp;<span class="ident" id="7464711">i</span><span class="op" id="7464712">++</span>&nbsp;<span class="op" id="7464715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464719">var</span>&nbsp;<span class="ident" id="7464723">want</span>&nbsp;<span class="builtintype" id="7464728">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464734">var</span>&nbsp;<span class="ident" id="7464738">find</span>&nbsp;<span class="builtintype" id="7464743">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464752">if</span>&nbsp;<span class="op" id="7464755">(</span><span class="ident" id="7464756">i</span>&nbsp;<span class="op" id="7464758">&amp;</span>&nbsp;<span class="num" id="7464760">1</span><span class="op" id="7464761">)</span>&nbsp;<span class="op" id="7464763">==</span>&nbsp;<span class="num" id="7464766">1</span>&nbsp;<span class="op" id="7464768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464773">buf</span><span class="op" id="7464776">.</span><span class="ident" id="7464777">WriteString</span><span class="op" id="7464788">(</span><span class="ident" id="7464789">clientHeaders</span><span class="op" id="7464802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464807">want</span>&nbsp;<span class="op" id="7464812">=</span>&nbsp;<span class="num" id="7464814">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464820">find</span>&nbsp;<span class="op" id="7464825">=</span>&nbsp;<span class="string" id="7464827">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464838">}</span>&nbsp;<span class="keyword" id="7464840">else</span>&nbsp;<span class="op" id="7464845">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464850">buf</span><span class="op" id="7464853">.</span><span class="ident" id="7464854">WriteString</span><span class="op" id="7464865">(</span><span class="ident" id="7464866">serverHeaders</span><span class="op" id="7464879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464884">want</span>&nbsp;<span class="op" id="7464889">=</span>&nbsp;<span class="num" id="7464891">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464896">find</span>&nbsp;<span class="op" id="7464901">=</span>&nbsp;<span class="string" id="7464903">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464915">h</span><span class="op" id="7464916">,</span>&nbsp;<span class="ident" id="7464918">err</span>&nbsp;<span class="op" id="7464922">:=</span>&nbsp;<span class="ident" id="7464925">r</span><span class="op" id="7464926">.</span><span class="ident" id="7464927">ReadMIMEHeader</span><span class="op" id="7464941">(</span><span class="op" id="7464942">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464946">if</span>&nbsp;<span class="ident" id="7464949">err</span>&nbsp;<span class="op" id="7464953">!=</span>&nbsp;<span class="ident" id="7464956">nil</span>&nbsp;<span class="op" id="7464960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464965">b</span><span class="op" id="7464966">.</span><span class="ident" id="7464967">Fatal</span><span class="op" id="7464972">(</span><span class="ident" id="7464973">err</span><span class="op" id="7464976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464984">if</span>&nbsp;<span class="builtinfunc" id="7464987">len</span><span class="op" id="7464990">(</span><span class="ident" id="7464991">h</span><span class="op" id="7464992">)</span>&nbsp;<span class="op" id="7464994">!=</span>&nbsp;<span class="ident" id="7464997">want</span>&nbsp;<span class="op" id="7465002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465007">b</span><span class="op" id="7465008">.</span><span class="ident" id="7465009">Fatalf</span><span class="op" id="7465015">(</span><span class="string" id="7465016">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7465058">,</span>&nbsp;<span class="builtinfunc" id="7465060">len</span><span class="op" id="7465063">(</span><span class="ident" id="7465064">h</span><span class="op" id="7465065">)</span><span class="op" id="7465066">,</span>&nbsp;<span class="ident" id="7465068">want</span><span class="op" id="7465072">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465080">if</span>&nbsp;<span class="ident" id="7465083">_</span><span class="op" id="7465084">,</span>&nbsp;<span class="ident" id="7465086">ok</span>&nbsp;<span class="op" id="7465089">:=</span>&nbsp;<span class="ident" id="7465092">h</span><span class="op" id="7465093">[</span><span class="ident" id="7465094">find</span><span class="op" id="7465098">]</span><span class="op" id="7465099">;</span>&nbsp;<span class="op" id="7465101">!</span><span class="ident" id="7465102">ok</span>&nbsp;<span class="op" id="7465105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465110">b</span><span class="op" id="7465111">.</span><span class="ident" id="7465112">Fatalf</span><span class="op" id="7465118">(</span><span class="string" id="7465119">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="7465140">,</span>&nbsp;<span class="ident" id="7465142">find</span><span class="op" id="7465146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465153">}</span><br>
<span class="lineno">320</span><span class="op" id="7465155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7465158">func</span>&nbsp;<span class="ident" id="7465163">BenchmarkUncommon</span><span class="op" id="7465180">(</span><span class="ident" id="7465181">b</span>&nbsp;<span class="op" id="7465183">*</span><span class="ident" id="7465184">testing</span><span class="op" id="7465191">.</span><span class="ident" id="7465192">B</span><span class="op" id="7465193">)</span>&nbsp;<span class="op" id="7465195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465198">b</span><span class="op" id="7465199">.</span><span class="ident" id="7465200">ReportAllocs</span><span class="op" id="7465212">(</span><span class="op" id="7465213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465216">var</span>&nbsp;<span class="ident" id="7465220">buf</span>&nbsp;<span class="ident" id="7465224">bytes</span><span class="op" id="7465229">.</span><span class="ident" id="7465230">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465238">br</span>&nbsp;<span class="op" id="7465241">:=</span>&nbsp;<span class="ident" id="7465244">bufio</span><span class="op" id="7465249">.</span><span class="ident" id="7465250">NewReader</span><span class="op" id="7465259">(</span><span class="op" id="7465260">&amp;</span><span class="ident" id="7465261">buf</span><span class="op" id="7465264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465267">r</span>&nbsp;<span class="op" id="7465269">:=</span>&nbsp;<span class="ident" id="7465272">NewReader</span><span class="op" id="7465281">(</span><span class="ident" id="7465282">br</span><span class="op" id="7465284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465287">for</span>&nbsp;<span class="ident" id="7465291">i</span>&nbsp;<span class="op" id="7465293">:=</span>&nbsp;<span class="num" id="7465296">0</span><span class="op" id="7465297">;</span>&nbsp;<span class="ident" id="7465299">i</span>&nbsp;<span class="op" id="7465301">&lt;</span>&nbsp;<span class="ident" id="7465303">b</span><span class="op" id="7465304">.</span><span class="ident" id="7465305">N</span><span class="op" id="7465306">;</span>&nbsp;<span class="ident" id="7465308">i</span><span class="op" id="7465309">++</span>&nbsp;<span class="op" id="7465312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465316">buf</span><span class="op" id="7465319">.</span><span class="ident" id="7465320">WriteString</span><span class="op" id="7465331">(</span><span class="string" id="7465332">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="7465376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465380">h</span><span class="op" id="7465381">,</span>&nbsp;<span class="ident" id="7465383">err</span>&nbsp;<span class="op" id="7465387">:=</span>&nbsp;<span class="ident" id="7465390">r</span><span class="op" id="7465391">.</span><span class="ident" id="7465392">ReadMIMEHeader</span><span class="op" id="7465406">(</span><span class="op" id="7465407">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465411">if</span>&nbsp;<span class="ident" id="7465414">err</span>&nbsp;<span class="op" id="7465418">!=</span>&nbsp;<span class="ident" id="7465421">nil</span>&nbsp;<span class="op" id="7465425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465430">b</span><span class="op" id="7465431">.</span><span class="ident" id="7465432">Fatal</span><span class="op" id="7465437">(</span><span class="ident" id="7465438">err</span><span class="op" id="7465441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465449">if</span>&nbsp;<span class="ident" id="7465452">_</span><span class="op" id="7465453">,</span>&nbsp;<span class="ident" id="7465455">ok</span>&nbsp;<span class="op" id="7465458">:=</span>&nbsp;<span class="ident" id="7465461">h</span><span class="op" id="7465462">[</span><span class="string" id="7465463">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="7465494">]</span><span class="op" id="7465495">;</span>&nbsp;<span class="op" id="7465497">!</span><span class="ident" id="7465498">ok</span>&nbsp;<span class="op" id="7465501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465506">b</span><span class="op" id="7465507">.</span><span class="ident" id="7465508">Fatal</span><span class="op" id="7465513">(</span><span class="string" id="7465514">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="7465538">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465545">}</span><br>
<span class="lineno"></span><span class="op" id="7465547">}</span>
</div>
</body>
</html>
