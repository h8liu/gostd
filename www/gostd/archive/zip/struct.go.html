<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6313321">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6313376">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6313430">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6313481">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="6313990">package</span>&nbsp;<span class="ident" id="6313998">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6314003">import</span>&nbsp;<span class="op" id="6314010">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6314013">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6314019">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6314027">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6314034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6314037">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6314061">const</span>&nbsp;<span class="op" id="6314067">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314070">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6314078">uint16</span>&nbsp;<span class="op" id="6314085">=</span>&nbsp;<span class="num" id="6314087">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314090">Deflate</span>&nbsp;<span class="builtintype" id="6314098">uint16</span>&nbsp;<span class="op" id="6314105">=</span>&nbsp;<span class="num" id="6314107">8</span><br>
<span class="lineno"></span><span class="op" id="6314109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6314112">const</span>&nbsp;<span class="op" id="6314118">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314121">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314146">=</span>&nbsp;<span class="num" id="6314148">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314160">directoryHeaderSignature</span>&nbsp;<span class="op" id="6314185">=</span>&nbsp;<span class="num" id="6314187">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314199">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314224">=</span>&nbsp;<span class="num" id="6314226">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314238">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="6314263">=</span>&nbsp;<span class="num" id="6314265">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314277">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="6314302">=</span>&nbsp;<span class="num" id="6314304">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314316">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="6314341">=</span>&nbsp;<span class="num" id="6314343">0x08074b50</span>&nbsp;<span class="comment" id="6314354">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314401">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314426">=</span>&nbsp;<span class="num" id="6314428">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314439">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314462">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314487">=</span>&nbsp;<span class="num" id="6314489">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314500">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314533">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314558">=</span>&nbsp;<span class="num" id="6314560">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314571">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314585">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314610">=</span>&nbsp;<span class="num" id="6314612">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314623">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314691">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314716">=</span>&nbsp;<span class="num" id="6314718">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314729">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314762">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314787">=</span>&nbsp;<span class="num" id="6314789">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314800">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314804">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314829">=</span>&nbsp;<span class="num" id="6314831">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6314842">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6314855">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314906">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314920">=</span>&nbsp;<span class="num" id="6314922">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314925">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6314939">=</span>&nbsp;<span class="num" id="6314941">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314944">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6314958">=</span>&nbsp;<span class="num" id="6314960">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314964">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6314978">=</span>&nbsp;<span class="num" id="6314980">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314984">creatorMacOSX</span>&nbsp;<span class="op" id="6314998">=</span>&nbsp;<span class="num" id="6315000">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315005">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315025">zipVersion20</span>&nbsp;<span class="op" id="6315038">=</span>&nbsp;<span class="num" id="6315040">20</span>&nbsp;<span class="comment" id="6315043">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315051">zipVersion45</span>&nbsp;<span class="op" id="6315064">=</span>&nbsp;<span class="num" id="6315066">45</span>&nbsp;<span class="comment" id="6315069">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315112">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315143">uint16max</span>&nbsp;<span class="op" id="6315153">=</span>&nbsp;<span class="op" id="6315155">(</span><span class="num" id="6315156">1</span>&nbsp;<span class="op" id="6315158">&lt;&lt;</span>&nbsp;<span class="num" id="6315161">16</span><span class="op" id="6315163">)</span>&nbsp;<span class="op" id="6315165">-</span>&nbsp;<span class="num" id="6315167">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315170">uint32max</span>&nbsp;<span class="op" id="6315180">=</span>&nbsp;<span class="op" id="6315182">(</span><span class="num" id="6315183">1</span>&nbsp;<span class="op" id="6315185">&lt;&lt;</span>&nbsp;<span class="num" id="6315188">32</span><span class="op" id="6315190">)</span>&nbsp;<span class="op" id="6315192">-</span>&nbsp;<span class="num" id="6315194">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315198">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315220">zip64ExtraId</span>&nbsp;<span class="op" id="6315233">=</span>&nbsp;<span class="num" id="6315235">0x0001</span>&nbsp;<span class="comment" id="6315242">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="6315284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6315287">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6315337">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="6315370">type</span>&nbsp;<span class="ident" id="6315375">FileHeader</span>&nbsp;<span class="keyword" id="6315386">struct</span>&nbsp;<span class="op" id="6315393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315396">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315430">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315493">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315557">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315574">Name</span>&nbsp;<span class="builtintype" id="6315579">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315588">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315607">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315615">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315634">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315642">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315661">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315669">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315688">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315696">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315715">uint16</span>&nbsp;<span class="comment" id="6315722">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315738">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315757">uint16</span>&nbsp;<span class="comment" id="6315764">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315780">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315799">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315807">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315826">uint32</span>&nbsp;<span class="comment" id="6315833">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315870">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6315889">uint32</span>&nbsp;<span class="comment" id="6315896">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315935">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6315954">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315962">UncompressedSize64</span>&nbsp;<span class="ident" id="6315981">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315989">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316008">[</span><span class="op" id="6316009">]</span><span class="builtintype" id="6316010">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316016">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6316035">uint32</span>&nbsp;<span class="comment" id="6316042">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316080">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6316099">string</span><br>
<span class="lineno"></span><span class="op" id="6316106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6316109">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6316164">func</span>&nbsp;<span class="op" id="6316169">(</span><span class="ident" id="6316170">h</span>&nbsp;<span class="op" id="6316172">*</span><span class="ident" id="6316173">FileHeader</span><span class="op" id="6316183">)</span>&nbsp;<span class="ident" id="6316185">FileInfo</span><span class="op" id="6316193">(</span><span class="op" id="6316194">)</span>&nbsp;<span class="ident" id="6316196">os</span><span class="op" id="6316198">.</span><span class="ident" id="6316199">FileInfo</span>&nbsp;<span class="op" id="6316208">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316211">return</span>&nbsp;<span class="ident" id="6316218">headerFileInfo</span><span class="op" id="6316232">{</span><span class="ident" id="6316233">h</span><span class="op" id="6316234">}</span><br>
<span class="lineno"></span><span class="op" id="6316236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6316239">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6316281">type</span>&nbsp;<span class="ident" id="6316286">headerFileInfo</span>&nbsp;<span class="keyword" id="6316301">struct</span>&nbsp;<span class="op" id="6316308">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316311">fh</span>&nbsp;<span class="op" id="6316314">*</span><span class="ident" id="6316315">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="6316326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6316329">func</span>&nbsp;<span class="op" id="6316334">(</span><span class="ident" id="6316335">fi</span>&nbsp;<span class="ident" id="6316338">headerFileInfo</span><span class="op" id="6316352">)</span>&nbsp;<span class="ident" id="6316354">Name</span><span class="op" id="6316358">(</span><span class="op" id="6316359">)</span>&nbsp;<span class="builtintype" id="6316361">string</span>&nbsp;<span class="op" id="6316368">{</span>&nbsp;<span class="keyword" id="6316370">return</span>&nbsp;<span class="ident" id="6316377">path</span><span class="op" id="6316381">.</span><span class="ident" id="6316382">Base</span><span class="op" id="6316386">(</span><span class="ident" id="6316387">fi</span><span class="op" id="6316389">.</span><span class="ident" id="6316390">fh</span><span class="op" id="6316392">.</span><span class="ident" id="6316393">Name</span><span class="op" id="6316397">)</span>&nbsp;<span class="op" id="6316399">}</span><br>
<span class="lineno"></span><span class="keyword" id="6316401">func</span>&nbsp;<span class="op" id="6316406">(</span><span class="ident" id="6316407">fi</span>&nbsp;<span class="ident" id="6316410">headerFileInfo</span><span class="op" id="6316424">)</span>&nbsp;<span class="ident" id="6316426">Size</span><span class="op" id="6316430">(</span><span class="op" id="6316431">)</span>&nbsp;<span class="ident" id="6316433">int64</span>&nbsp;<span class="op" id="6316439">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316442">if</span>&nbsp;<span class="ident" id="6316445">fi</span><span class="op" id="6316447">.</span><span class="ident" id="6316448">fh</span><span class="op" id="6316450">.</span><span class="ident" id="6316451">UncompressedSize64</span>&nbsp;<span class="op" id="6316470">&gt;</span>&nbsp;<span class="num" id="6316472">0</span>&nbsp;<span class="op" id="6316474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316478">return</span>&nbsp;<span class="ident" id="6316485">int64</span><span class="op" id="6316490">(</span><span class="ident" id="6316491">fi</span><span class="op" id="6316493">.</span><span class="ident" id="6316494">fh</span><span class="op" id="6316496">.</span><span class="ident" id="6316497">UncompressedSize64</span><span class="op" id="6316515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316521">return</span>&nbsp;<span class="ident" id="6316528">int64</span><span class="op" id="6316533">(</span><span class="ident" id="6316534">fi</span><span class="op" id="6316536">.</span><span class="ident" id="6316537">fh</span><span class="op" id="6316539">.</span><span class="ident" id="6316540">UncompressedSize</span><span class="op" id="6316556">)</span><br>
<span class="lineno"></span><span class="op" id="6316558">}</span><br>
<span class="lineno">110</span><span class="keyword" id="6316560">func</span>&nbsp;<span class="op" id="6316565">(</span><span class="ident" id="6316566">fi</span>&nbsp;<span class="ident" id="6316569">headerFileInfo</span><span class="op" id="6316583">)</span>&nbsp;<span class="ident" id="6316585">IsDir</span><span class="op" id="6316590">(</span><span class="op" id="6316591">)</span>&nbsp;<span class="builtintype" id="6316593">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316605">{</span>&nbsp;<span class="keyword" id="6316607">return</span>&nbsp;<span class="ident" id="6316614">fi</span><span class="op" id="6316616">.</span><span class="ident" id="6316617">Mode</span><span class="op" id="6316621">(</span><span class="op" id="6316622">)</span><span class="op" id="6316623">.</span><span class="ident" id="6316624">IsDir</span><span class="op" id="6316629">(</span><span class="op" id="6316630">)</span>&nbsp;<span class="op" id="6316632">}</span><br>
<span class="lineno"></span><span class="keyword" id="6316634">func</span>&nbsp;<span class="op" id="6316639">(</span><span class="ident" id="6316640">fi</span>&nbsp;<span class="ident" id="6316643">headerFileInfo</span><span class="op" id="6316657">)</span>&nbsp;<span class="ident" id="6316659">ModTime</span><span class="op" id="6316666">(</span><span class="op" id="6316667">)</span>&nbsp;<span class="ident" id="6316669">time</span><span class="op" id="6316673">.</span><span class="ident" id="6316674">Time</span>&nbsp;<span class="op" id="6316679">{</span>&nbsp;<span class="keyword" id="6316681">return</span>&nbsp;<span class="ident" id="6316688">fi</span><span class="op" id="6316690">.</span><span class="ident" id="6316691">fh</span><span class="op" id="6316693">.</span><span class="ident" id="6316694">ModTime</span><span class="op" id="6316701">(</span><span class="op" id="6316702">)</span>&nbsp;<span class="op" id="6316704">}</span><br>
<span class="lineno"></span><span class="keyword" id="6316706">func</span>&nbsp;<span class="op" id="6316711">(</span><span class="ident" id="6316712">fi</span>&nbsp;<span class="ident" id="6316715">headerFileInfo</span><span class="op" id="6316729">)</span>&nbsp;<span class="ident" id="6316731">Mode</span><span class="op" id="6316735">(</span><span class="op" id="6316736">)</span>&nbsp;<span class="ident" id="6316738">os</span><span class="op" id="6316740">.</span><span class="ident" id="6316741">FileMode</span>&nbsp;&nbsp;<span class="op" id="6316751">{</span>&nbsp;<span class="keyword" id="6316753">return</span>&nbsp;<span class="ident" id="6316760">fi</span><span class="op" id="6316762">.</span><span class="ident" id="6316763">fh</span><span class="op" id="6316765">.</span><span class="ident" id="6316766">Mode</span><span class="op" id="6316770">(</span><span class="op" id="6316771">)</span>&nbsp;<span class="op" id="6316773">}</span><br>
<span class="lineno"></span><span class="keyword" id="6316775">func</span>&nbsp;<span class="op" id="6316780">(</span><span class="ident" id="6316781">fi</span>&nbsp;<span class="ident" id="6316784">headerFileInfo</span><span class="op" id="6316798">)</span>&nbsp;<span class="ident" id="6316800">Sys</span><span class="op" id="6316803">(</span><span class="op" id="6316804">)</span>&nbsp;<span class="keyword" id="6316806">interface</span><span class="op" id="6316815">{</span><span class="op" id="6316816">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6316820">{</span>&nbsp;<span class="keyword" id="6316822">return</span>&nbsp;<span class="ident" id="6316829">fi</span><span class="op" id="6316831">.</span><span class="ident" id="6316832">fh</span>&nbsp;<span class="op" id="6316835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6316838">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6316905">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="6316921">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6316988">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6317059">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="6317128">func</span>&nbsp;<span class="ident" id="6317133">FileInfoHeader</span><span class="op" id="6317147">(</span><span class="ident" id="6317148">fi</span>&nbsp;<span class="ident" id="6317151">os</span><span class="op" id="6317153">.</span><span class="ident" id="6317154">FileInfo</span><span class="op" id="6317162">)</span>&nbsp;<span class="op" id="6317164">(</span><span class="op" id="6317165">*</span><span class="ident" id="6317166">FileHeader</span><span class="op" id="6317176">,</span>&nbsp;<span class="builtintype" id="6317178">error</span><span class="op" id="6317183">)</span>&nbsp;<span class="op" id="6317185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317188">size</span>&nbsp;<span class="op" id="6317193">:=</span>&nbsp;<span class="ident" id="6317196">fi</span><span class="op" id="6317198">.</span><span class="ident" id="6317199">Size</span><span class="op" id="6317203">(</span><span class="op" id="6317204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317207">fh</span>&nbsp;<span class="op" id="6317210">:=</span>&nbsp;<span class="op" id="6317213">&amp;</span><span class="ident" id="6317214">FileHeader</span><span class="op" id="6317224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317228">Name</span><span class="op" id="6317232">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317248">fi</span><span class="op" id="6317250">.</span><span class="ident" id="6317251">Name</span><span class="op" id="6317255">(</span><span class="op" id="6317256">)</span><span class="op" id="6317257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317261">UncompressedSize64</span><span class="op" id="6317279">:</span>&nbsp;<span class="ident" id="6317281">uint64</span><span class="op" id="6317287">(</span><span class="ident" id="6317288">size</span><span class="op" id="6317292">)</span><span class="op" id="6317293">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317299">fh</span><span class="op" id="6317301">.</span><span class="ident" id="6317302">SetModTime</span><span class="op" id="6317312">(</span><span class="ident" id="6317313">fi</span><span class="op" id="6317315">.</span><span class="ident" id="6317316">ModTime</span><span class="op" id="6317323">(</span><span class="op" id="6317324">)</span><span class="op" id="6317325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317328">fh</span><span class="op" id="6317330">.</span><span class="ident" id="6317331">SetMode</span><span class="op" id="6317338">(</span><span class="ident" id="6317339">fi</span><span class="op" id="6317341">.</span><span class="ident" id="6317342">Mode</span><span class="op" id="6317346">(</span><span class="op" id="6317347">)</span><span class="op" id="6317348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317351">if</span>&nbsp;<span class="ident" id="6317354">fh</span><span class="op" id="6317356">.</span><span class="ident" id="6317357">UncompressedSize64</span>&nbsp;<span class="op" id="6317376">&gt;</span>&nbsp;<span class="ident" id="6317378">uint32max</span>&nbsp;<span class="op" id="6317388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317392">fh</span><span class="op" id="6317394">.</span><span class="ident" id="6317395">UncompressedSize</span>&nbsp;<span class="op" id="6317412">=</span>&nbsp;<span class="ident" id="6317414">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317425">}</span>&nbsp;<span class="keyword" id="6317427">else</span>&nbsp;<span class="op" id="6317432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317436">fh</span><span class="op" id="6317438">.</span><span class="ident" id="6317439">UncompressedSize</span>&nbsp;<span class="op" id="6317456">=</span>&nbsp;<span class="builtintype" id="6317458">uint32</span><span class="op" id="6317464">(</span><span class="ident" id="6317465">fh</span><span class="op" id="6317467">.</span><span class="ident" id="6317468">UncompressedSize64</span><span class="op" id="6317486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317492">return</span>&nbsp;<span class="ident" id="6317499">fh</span><span class="op" id="6317501">,</span>&nbsp;<span class="ident" id="6317503">nil</span><br>
<span class="lineno"></span><span class="op" id="6317507">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6317510">type</span>&nbsp;<span class="ident" id="6317515">directoryEnd</span>&nbsp;<span class="keyword" id="6317528">struct</span>&nbsp;<span class="op" id="6317535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317538">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6317557">uint32</span>&nbsp;<span class="comment" id="6317564">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317575">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6317594">uint32</span>&nbsp;<span class="comment" id="6317601">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317612">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="6317631">uint64</span>&nbsp;<span class="comment" id="6317638">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317649">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6317668">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317676">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317695">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317703">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317722">uint64</span>&nbsp;<span class="comment" id="6317729">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317750">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6317769">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317777">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6317796">string</span><br>
<span class="lineno">145</span><span class="op" id="6317803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317806">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="6317876">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6317901">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="6317972">func</span>&nbsp;<span class="ident" id="6317977">msDosTimeToTime</span><span class="op" id="6317992">(</span><span class="ident" id="6317993">dosDate</span><span class="op" id="6318000">,</span>&nbsp;<span class="ident" id="6318002">dosTime</span>&nbsp;<span class="builtintype" id="6318010">uint16</span><span class="op" id="6318016">)</span>&nbsp;<span class="ident" id="6318018">time</span><span class="op" id="6318022">.</span><span class="ident" id="6318023">Time</span>&nbsp;<span class="op" id="6318028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318031">return</span>&nbsp;<span class="ident" id="6318038">time</span><span class="op" id="6318042">.</span><span class="ident" id="6318043">Date</span><span class="op" id="6318047">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318051">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6318120">int</span><span class="op" id="6318123">(</span><span class="ident" id="6318124">dosDate</span><span class="op" id="6318131">&gt;&gt;</span><span class="num" id="6318133">9</span><span class="op" id="6318134">+</span><span class="num" id="6318135">1980</span><span class="op" id="6318139">)</span><span class="op" id="6318140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318144">time</span><span class="op" id="6318148">.</span><span class="ident" id="6318149">Month</span><span class="op" id="6318154">(</span><span class="ident" id="6318155">dosDate</span><span class="op" id="6318162">&gt;&gt;</span><span class="num" id="6318164">5</span><span class="op" id="6318165">&amp;</span><span class="num" id="6318166">0xf</span><span class="op" id="6318169">)</span><span class="op" id="6318170">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6318174">int</span><span class="op" id="6318177">(</span><span class="ident" id="6318178">dosDate</span><span class="op" id="6318185">&amp;</span><span class="num" id="6318186">0x1f</span><span class="op" id="6318190">)</span><span class="op" id="6318191">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318196">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6318252">int</span><span class="op" id="6318255">(</span><span class="ident" id="6318256">dosTime</span><span class="op" id="6318263">&gt;&gt;</span><span class="num" id="6318265">11</span><span class="op" id="6318267">)</span><span class="op" id="6318268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6318272">int</span><span class="op" id="6318275">(</span><span class="ident" id="6318276">dosTime</span><span class="op" id="6318283">&gt;&gt;</span><span class="num" id="6318285">5</span><span class="op" id="6318286">&amp;</span><span class="num" id="6318287">0x3f</span><span class="op" id="6318291">)</span><span class="op" id="6318292">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6318296">int</span><span class="op" id="6318299">(</span><span class="ident" id="6318300">dosTime</span><span class="op" id="6318307">&amp;</span><span class="num" id="6318308">0x1f</span><span class="op" id="6318312">*</span><span class="num" id="6318313">2</span><span class="op" id="6318314">)</span><span class="op" id="6318315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6318319">0</span><span class="op" id="6318320">,</span>&nbsp;<span class="comment" id="6318322">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318340">time</span><span class="op" id="6318344">.</span><span class="ident" id="6318345">UTC</span><span class="op" id="6318348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318351">)</span><br>
<span class="lineno">165</span><span class="op" id="6318353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318356">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6318424">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6318449">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="6318520">func</span>&nbsp;<span class="ident" id="6318525">timeToMsDosTime</span><span class="op" id="6318540">(</span><span class="ident" id="6318541">t</span>&nbsp;<span class="ident" id="6318543">time</span><span class="op" id="6318547">.</span><span class="ident" id="6318548">Time</span><span class="op" id="6318552">)</span>&nbsp;<span class="op" id="6318554">(</span><span class="ident" id="6318555">fDate</span>&nbsp;<span class="builtintype" id="6318561">uint16</span><span class="op" id="6318567">,</span>&nbsp;<span class="ident" id="6318569">fTime</span>&nbsp;<span class="builtintype" id="6318575">uint16</span><span class="op" id="6318581">)</span>&nbsp;<span class="op" id="6318583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318586">t</span>&nbsp;<span class="op" id="6318588">=</span>&nbsp;<span class="ident" id="6318590">t</span><span class="op" id="6318591">.</span><span class="ident" id="6318592">In</span><span class="op" id="6318594">(</span><span class="ident" id="6318595">time</span><span class="op" id="6318599">.</span><span class="ident" id="6318600">UTC</span><span class="op" id="6318603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318606">fDate</span>&nbsp;<span class="op" id="6318612">=</span>&nbsp;<span class="builtintype" id="6318614">uint16</span><span class="op" id="6318620">(</span><span class="ident" id="6318621">t</span><span class="op" id="6318622">.</span><span class="ident" id="6318623">Day</span><span class="op" id="6318626">(</span><span class="op" id="6318627">)</span>&nbsp;<span class="op" id="6318629">+</span>&nbsp;<span class="builtintype" id="6318631">int</span><span class="op" id="6318634">(</span><span class="ident" id="6318635">t</span><span class="op" id="6318636">.</span><span class="ident" id="6318637">Month</span><span class="op" id="6318642">(</span><span class="op" id="6318643">)</span><span class="op" id="6318644">)</span><span class="op" id="6318645">&lt;&lt;</span><span class="num" id="6318647">5</span>&nbsp;<span class="op" id="6318649">+</span>&nbsp;<span class="op" id="6318651">(</span><span class="ident" id="6318652">t</span><span class="op" id="6318653">.</span><span class="ident" id="6318654">Year</span><span class="op" id="6318658">(</span><span class="op" id="6318659">)</span><span class="op" id="6318660">-</span><span class="num" id="6318661">1980</span><span class="op" id="6318665">)</span><span class="op" id="6318666">&lt;&lt;</span><span class="num" id="6318668">9</span><span class="op" id="6318669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318672">fTime</span>&nbsp;<span class="op" id="6318678">=</span>&nbsp;<span class="builtintype" id="6318680">uint16</span><span class="op" id="6318686">(</span><span class="ident" id="6318687">t</span><span class="op" id="6318688">.</span><span class="ident" id="6318689">Second</span><span class="op" id="6318695">(</span><span class="op" id="6318696">)</span><span class="op" id="6318697">/</span><span class="num" id="6318698">2</span>&nbsp;<span class="op" id="6318700">+</span>&nbsp;<span class="ident" id="6318702">t</span><span class="op" id="6318703">.</span><span class="ident" id="6318704">Minute</span><span class="op" id="6318710">(</span><span class="op" id="6318711">)</span><span class="op" id="6318712">&lt;&lt;</span><span class="num" id="6318714">5</span>&nbsp;<span class="op" id="6318716">+</span>&nbsp;<span class="ident" id="6318718">t</span><span class="op" id="6318719">.</span><span class="ident" id="6318720">Hour</span><span class="op" id="6318724">(</span><span class="op" id="6318725">)</span><span class="op" id="6318726">&lt;&lt;</span><span class="num" id="6318728">11</span><span class="op" id="6318730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318733">return</span><br>
<span class="lineno">175</span><span class="op" id="6318740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318743">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6318792">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="6318817">func</span>&nbsp;<span class="op" id="6318822">(</span><span class="ident" id="6318823">h</span>&nbsp;<span class="op" id="6318825">*</span><span class="ident" id="6318826">FileHeader</span><span class="op" id="6318836">)</span>&nbsp;<span class="ident" id="6318838">ModTime</span><span class="op" id="6318845">(</span><span class="op" id="6318846">)</span>&nbsp;<span class="ident" id="6318848">time</span><span class="op" id="6318852">.</span><span class="ident" id="6318853">Time</span>&nbsp;<span class="op" id="6318858">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318861">return</span>&nbsp;<span class="ident" id="6318868">msDosTimeToTime</span><span class="op" id="6318883">(</span><span class="ident" id="6318884">h</span><span class="op" id="6318885">.</span><span class="ident" id="6318886">ModifiedDate</span><span class="op" id="6318898">,</span>&nbsp;<span class="ident" id="6318900">h</span><span class="op" id="6318901">.</span><span class="ident" id="6318902">ModifiedTime</span><span class="op" id="6318914">)</span><br>
<span class="lineno"></span><span class="op" id="6318916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318919">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6319005">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="6319030">func</span>&nbsp;<span class="op" id="6319035">(</span><span class="ident" id="6319036">h</span>&nbsp;<span class="op" id="6319038">*</span><span class="ident" id="6319039">FileHeader</span><span class="op" id="6319049">)</span>&nbsp;<span class="ident" id="6319051">SetModTime</span><span class="op" id="6319061">(</span><span class="ident" id="6319062">t</span>&nbsp;<span class="ident" id="6319064">time</span><span class="op" id="6319068">.</span><span class="ident" id="6319069">Time</span><span class="op" id="6319073">)</span>&nbsp;<span class="op" id="6319075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319078">h</span><span class="op" id="6319079">.</span><span class="ident" id="6319080">ModifiedDate</span><span class="op" id="6319092">,</span>&nbsp;<span class="ident" id="6319094">h</span><span class="op" id="6319095">.</span><span class="ident" id="6319096">ModifiedTime</span>&nbsp;<span class="op" id="6319109">=</span>&nbsp;<span class="ident" id="6319111">timeToMsDosTime</span><span class="op" id="6319126">(</span><span class="ident" id="6319127">t</span><span class="op" id="6319128">)</span><br>
<span class="lineno"></span><span class="op" id="6319130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6319133">const</span>&nbsp;<span class="op" id="6319139">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319142">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6319202">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319258">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6319267">=</span>&nbsp;<span class="num" id="6319269">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319277">s_IFSOCK</span>&nbsp;<span class="op" id="6319286">=</span>&nbsp;<span class="num" id="6319288">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319296">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="6319305">=</span>&nbsp;<span class="num" id="6319307">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319315">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="6319324">=</span>&nbsp;<span class="num" id="6319326">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319334">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="6319343">=</span>&nbsp;<span class="num" id="6319345">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319353">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="6319362">=</span>&nbsp;<span class="num" id="6319364">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319372">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="6319381">=</span>&nbsp;<span class="num" id="6319383">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319391">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="6319400">=</span>&nbsp;<span class="num" id="6319402">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319410">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="6319419">=</span>&nbsp;<span class="num" id="6319421">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319428">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="6319437">=</span>&nbsp;<span class="num" id="6319439">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319446">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6319455">=</span>&nbsp;<span class="num" id="6319457">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319465">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319479">=</span>&nbsp;<span class="num" id="6319481">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319487">msdosReadOnly</span>&nbsp;<span class="op" id="6319501">=</span>&nbsp;<span class="num" id="6319503">0x01</span><br>
<span class="lineno"></span><span class="op" id="6319508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6319511">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6319576">func</span>&nbsp;<span class="op" id="6319581">(</span><span class="ident" id="6319582">h</span>&nbsp;<span class="op" id="6319584">*</span><span class="ident" id="6319585">FileHeader</span><span class="op" id="6319595">)</span>&nbsp;<span class="ident" id="6319597">Mode</span><span class="op" id="6319601">(</span><span class="op" id="6319602">)</span>&nbsp;<span class="op" id="6319604">(</span><span class="ident" id="6319605">mode</span>&nbsp;<span class="ident" id="6319610">os</span><span class="op" id="6319612">.</span><span class="ident" id="6319613">FileMode</span><span class="op" id="6319621">)</span>&nbsp;<span class="op" id="6319623">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319626">switch</span>&nbsp;<span class="ident" id="6319633">h</span><span class="op" id="6319634">.</span><span class="ident" id="6319635">CreatorVersion</span>&nbsp;<span class="op" id="6319650">&gt;&gt;</span>&nbsp;<span class="num" id="6319653">8</span>&nbsp;<span class="op" id="6319655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319658">case</span>&nbsp;<span class="ident" id="6319663">creatorUnix</span><span class="op" id="6319674">,</span>&nbsp;<span class="ident" id="6319676">creatorMacOSX</span><span class="op" id="6319689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319693">mode</span>&nbsp;<span class="op" id="6319698">=</span>&nbsp;<span class="ident" id="6319700">unixModeToFileMode</span><span class="op" id="6319718">(</span><span class="ident" id="6319719">h</span><span class="op" id="6319720">.</span><span class="ident" id="6319721">ExternalAttrs</span>&nbsp;<span class="op" id="6319735">&gt;&gt;</span>&nbsp;<span class="num" id="6319738">16</span><span class="op" id="6319740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319743">case</span>&nbsp;<span class="ident" id="6319748">creatorNTFS</span><span class="op" id="6319759">,</span>&nbsp;<span class="ident" id="6319761">creatorVFAT</span><span class="op" id="6319772">,</span>&nbsp;<span class="ident" id="6319774">creatorFAT</span><span class="op" id="6319784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319788">mode</span>&nbsp;<span class="op" id="6319793">=</span>&nbsp;<span class="ident" id="6319795">msdosModeToFileMode</span><span class="op" id="6319814">(</span><span class="ident" id="6319815">h</span><span class="op" id="6319816">.</span><span class="ident" id="6319817">ExternalAttrs</span><span class="op" id="6319830">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319836">if</span>&nbsp;<span class="builtinfunc" id="6319839">len</span><span class="op" id="6319842">(</span><span class="ident" id="6319843">h</span><span class="op" id="6319844">.</span><span class="ident" id="6319845">Name</span><span class="op" id="6319849">)</span>&nbsp;<span class="op" id="6319851">&gt;</span>&nbsp;<span class="num" id="6319853">0</span>&nbsp;<span class="op" id="6319855">&amp;&amp;</span>&nbsp;<span class="ident" id="6319858">h</span><span class="op" id="6319859">.</span><span class="ident" id="6319860">Name</span><span class="op" id="6319864">[</span><span class="builtinfunc" id="6319865">len</span><span class="op" id="6319868">(</span><span class="ident" id="6319869">h</span><span class="op" id="6319870">.</span><span class="ident" id="6319871">Name</span><span class="op" id="6319875">)</span><span class="op" id="6319876">-</span><span class="num" id="6319877">1</span><span class="op" id="6319878">]</span>&nbsp;<span class="op" id="6319880">==</span>&nbsp;<span class="string" id="6319883">&#39;/&#39;</span>&nbsp;<span class="op" id="6319887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319891">mode</span>&nbsp;<span class="op" id="6319896">|=</span>&nbsp;<span class="ident" id="6319899">os</span><span class="op" id="6319901">.</span><span class="ident" id="6319902">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319914">return</span>&nbsp;<span class="ident" id="6319921">mode</span><br>
<span class="lineno">220</span><span class="op" id="6319926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6319929">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6319997">func</span>&nbsp;<span class="op" id="6320002">(</span><span class="ident" id="6320003">h</span>&nbsp;<span class="op" id="6320005">*</span><span class="ident" id="6320006">FileHeader</span><span class="op" id="6320016">)</span>&nbsp;<span class="ident" id="6320018">SetMode</span><span class="op" id="6320025">(</span><span class="ident" id="6320026">mode</span>&nbsp;<span class="ident" id="6320031">os</span><span class="op" id="6320033">.</span><span class="ident" id="6320034">FileMode</span><span class="op" id="6320042">)</span>&nbsp;<span class="op" id="6320044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320047">h</span><span class="op" id="6320048">.</span><span class="ident" id="6320049">CreatorVersion</span>&nbsp;<span class="op" id="6320064">=</span>&nbsp;<span class="ident" id="6320066">h</span><span class="op" id="6320067">.</span><span class="ident" id="6320068">CreatorVersion</span><span class="op" id="6320082">&amp;</span><span class="num" id="6320083">0xff</span>&nbsp;<span class="op" id="6320088">|</span>&nbsp;<span class="ident" id="6320090">creatorUnix</span><span class="op" id="6320101">&lt;&lt;</span><span class="num" id="6320103">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320106">h</span><span class="op" id="6320107">.</span><span class="ident" id="6320108">ExternalAttrs</span>&nbsp;<span class="op" id="6320122">=</span>&nbsp;<span class="ident" id="6320124">fileModeToUnixMode</span><span class="op" id="6320142">(</span><span class="ident" id="6320143">mode</span><span class="op" id="6320147">)</span>&nbsp;<span class="op" id="6320149">&lt;&lt;</span>&nbsp;<span class="num" id="6320152">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6320157">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320213">if</span>&nbsp;<span class="ident" id="6320216">mode</span><span class="op" id="6320220">&amp;</span><span class="ident" id="6320221">os</span><span class="op" id="6320223">.</span><span class="ident" id="6320224">ModeDir</span>&nbsp;<span class="op" id="6320232">!=</span>&nbsp;<span class="num" id="6320235">0</span>&nbsp;<span class="op" id="6320237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320241">h</span><span class="op" id="6320242">.</span><span class="ident" id="6320243">ExternalAttrs</span>&nbsp;<span class="op" id="6320257">|=</span>&nbsp;<span class="ident" id="6320260">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320273">if</span>&nbsp;<span class="ident" id="6320276">mode</span><span class="op" id="6320280">&amp;</span><span class="num" id="6320281">0200</span>&nbsp;<span class="op" id="6320286">==</span>&nbsp;<span class="num" id="6320289">0</span>&nbsp;<span class="op" id="6320291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320295">h</span><span class="op" id="6320296">.</span><span class="ident" id="6320297">ExternalAttrs</span>&nbsp;<span class="op" id="6320311">|=</span>&nbsp;<span class="ident" id="6320314">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320329">}</span><br>
<span class="lineno"></span><span class="op" id="6320331">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6320334">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="6320400">func</span>&nbsp;<span class="op" id="6320405">(</span><span class="ident" id="6320406">fh</span>&nbsp;<span class="op" id="6320409">*</span><span class="ident" id="6320410">FileHeader</span><span class="op" id="6320420">)</span>&nbsp;<span class="ident" id="6320422">isZip64</span><span class="op" id="6320429">(</span><span class="op" id="6320430">)</span>&nbsp;<span class="builtintype" id="6320432">bool</span>&nbsp;<span class="op" id="6320437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320440">return</span>&nbsp;<span class="ident" id="6320447">fh</span><span class="op" id="6320449">.</span><span class="ident" id="6320450">CompressedSize64</span>&nbsp;<span class="op" id="6320467">&gt;</span>&nbsp;<span class="ident" id="6320469">uint32max</span>&nbsp;<span class="op" id="6320479">||</span>&nbsp;<span class="ident" id="6320482">fh</span><span class="op" id="6320484">.</span><span class="ident" id="6320485">UncompressedSize64</span>&nbsp;<span class="op" id="6320504">&gt;</span>&nbsp;<span class="ident" id="6320506">uint32max</span><br>
<span class="lineno"></span><span class="op" id="6320516">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="6320519">func</span>&nbsp;<span class="ident" id="6320524">msdosModeToFileMode</span><span class="op" id="6320543">(</span><span class="ident" id="6320544">m</span>&nbsp;<span class="builtintype" id="6320546">uint32</span><span class="op" id="6320552">)</span>&nbsp;<span class="op" id="6320554">(</span><span class="ident" id="6320555">mode</span>&nbsp;<span class="ident" id="6320560">os</span><span class="op" id="6320562">.</span><span class="ident" id="6320563">FileMode</span><span class="op" id="6320571">)</span>&nbsp;<span class="op" id="6320573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320576">if</span>&nbsp;<span class="ident" id="6320579">m</span><span class="op" id="6320580">&amp;</span><span class="ident" id="6320581">msdosDir</span>&nbsp;<span class="op" id="6320590">!=</span>&nbsp;<span class="num" id="6320593">0</span>&nbsp;<span class="op" id="6320595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320599">mode</span>&nbsp;<span class="op" id="6320604">=</span>&nbsp;<span class="ident" id="6320606">os</span><span class="op" id="6320608">.</span><span class="ident" id="6320609">ModeDir</span>&nbsp;<span class="op" id="6320617">|</span>&nbsp;<span class="num" id="6320619">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320625">}</span>&nbsp;<span class="keyword" id="6320627">else</span>&nbsp;<span class="op" id="6320632">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320636">mode</span>&nbsp;<span class="op" id="6320641">=</span>&nbsp;<span class="num" id="6320643">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320652">if</span>&nbsp;<span class="ident" id="6320655">m</span><span class="op" id="6320656">&amp;</span><span class="ident" id="6320657">msdosReadOnly</span>&nbsp;<span class="op" id="6320671">!=</span>&nbsp;<span class="num" id="6320674">0</span>&nbsp;<span class="op" id="6320676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320680">mode</span>&nbsp;<span class="op" id="6320685">&amp;^=</span>&nbsp;<span class="num" id="6320689">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320695">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320698">return</span>&nbsp;<span class="ident" id="6320705">mode</span><br>
<span class="lineno"></span><span class="op" id="6320710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6320713">func</span>&nbsp;<span class="ident" id="6320718">fileModeToUnixMode</span><span class="op" id="6320736">(</span><span class="ident" id="6320737">mode</span>&nbsp;<span class="ident" id="6320742">os</span><span class="op" id="6320744">.</span><span class="ident" id="6320745">FileMode</span><span class="op" id="6320753">)</span>&nbsp;<span class="builtintype" id="6320755">uint32</span>&nbsp;<span class="op" id="6320762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320765">var</span>&nbsp;<span class="ident" id="6320769">m</span>&nbsp;<span class="builtintype" id="6320771">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320779">switch</span>&nbsp;<span class="ident" id="6320786">mode</span>&nbsp;<span class="op" id="6320791">&amp;</span>&nbsp;<span class="ident" id="6320793">os</span><span class="op" id="6320795">.</span><span class="ident" id="6320796">ModeType</span>&nbsp;<span class="op" id="6320805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320808">default</span><span class="op" id="6320815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320819">m</span>&nbsp;<span class="op" id="6320821">=</span>&nbsp;<span class="ident" id="6320823">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320832">case</span>&nbsp;<span class="ident" id="6320837">os</span><span class="op" id="6320839">.</span><span class="ident" id="6320840">ModeDir</span><span class="op" id="6320847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320851">m</span>&nbsp;<span class="op" id="6320853">=</span>&nbsp;<span class="ident" id="6320855">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320864">case</span>&nbsp;<span class="ident" id="6320869">os</span><span class="op" id="6320871">.</span><span class="ident" id="6320872">ModeSymlink</span><span class="op" id="6320883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320887">m</span>&nbsp;<span class="op" id="6320889">=</span>&nbsp;<span class="ident" id="6320891">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320900">case</span>&nbsp;<span class="ident" id="6320905">os</span><span class="op" id="6320907">.</span><span class="ident" id="6320908">ModeNamedPipe</span><span class="op" id="6320921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320925">m</span>&nbsp;<span class="op" id="6320927">=</span>&nbsp;<span class="ident" id="6320929">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320938">case</span>&nbsp;<span class="ident" id="6320943">os</span><span class="op" id="6320945">.</span><span class="ident" id="6320946">ModeSocket</span><span class="op" id="6320956">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6320960">m</span>&nbsp;<span class="op" id="6320962">=</span>&nbsp;<span class="ident" id="6320964">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320974">case</span>&nbsp;<span class="ident" id="6320979">os</span><span class="op" id="6320981">.</span><span class="ident" id="6320982">ModeDevice</span><span class="op" id="6320992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320996">if</span>&nbsp;<span class="ident" id="6320999">mode</span><span class="op" id="6321003">&amp;</span><span class="ident" id="6321004">os</span><span class="op" id="6321006">.</span><span class="ident" id="6321007">ModeCharDevice</span>&nbsp;<span class="op" id="6321022">!=</span>&nbsp;<span class="num" id="6321025">0</span>&nbsp;<span class="op" id="6321027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321032">m</span>&nbsp;<span class="op" id="6321034">=</span>&nbsp;<span class="ident" id="6321036">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321046">}</span>&nbsp;<span class="keyword" id="6321048">else</span>&nbsp;<span class="op" id="6321053">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321058">m</span>&nbsp;<span class="op" id="6321060">=</span>&nbsp;<span class="ident" id="6321062">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321078">if</span>&nbsp;<span class="ident" id="6321081">mode</span><span class="op" id="6321085">&amp;</span><span class="ident" id="6321086">os</span><span class="op" id="6321088">.</span><span class="ident" id="6321089">ModeSetuid</span>&nbsp;<span class="op" id="6321100">!=</span>&nbsp;<span class="num" id="6321103">0</span>&nbsp;<span class="op" id="6321105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321109">m</span>&nbsp;<span class="op" id="6321111">|=</span>&nbsp;<span class="ident" id="6321114">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321126">if</span>&nbsp;<span class="ident" id="6321129">mode</span><span class="op" id="6321133">&amp;</span><span class="ident" id="6321134">os</span><span class="op" id="6321136">.</span><span class="ident" id="6321137">ModeSetgid</span>&nbsp;<span class="op" id="6321148">!=</span>&nbsp;<span class="num" id="6321151">0</span>&nbsp;<span class="op" id="6321153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321157">m</span>&nbsp;<span class="op" id="6321159">|=</span>&nbsp;<span class="ident" id="6321162">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321174">if</span>&nbsp;<span class="ident" id="6321177">mode</span><span class="op" id="6321181">&amp;</span><span class="ident" id="6321182">os</span><span class="op" id="6321184">.</span><span class="ident" id="6321185">ModeSticky</span>&nbsp;<span class="op" id="6321196">!=</span>&nbsp;<span class="num" id="6321199">0</span>&nbsp;<span class="op" id="6321201">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321205">m</span>&nbsp;<span class="op" id="6321207">|=</span>&nbsp;<span class="ident" id="6321210">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321222">return</span>&nbsp;<span class="ident" id="6321229">m</span>&nbsp;<span class="op" id="6321231">|</span>&nbsp;<span class="builtintype" id="6321233">uint32</span><span class="op" id="6321239">(</span><span class="ident" id="6321240">mode</span><span class="op" id="6321244">&amp;</span><span class="num" id="6321245">0777</span><span class="op" id="6321249">)</span><br>
<span class="lineno"></span><span class="op" id="6321251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6321254">func</span>&nbsp;<span class="ident" id="6321259">unixModeToFileMode</span><span class="op" id="6321277">(</span><span class="ident" id="6321278">m</span>&nbsp;<span class="builtintype" id="6321280">uint32</span><span class="op" id="6321286">)</span>&nbsp;<span class="ident" id="6321288">os</span><span class="op" id="6321290">.</span><span class="ident" id="6321291">FileMode</span>&nbsp;<span class="op" id="6321300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321303">mode</span>&nbsp;<span class="op" id="6321308">:=</span>&nbsp;<span class="ident" id="6321311">os</span><span class="op" id="6321313">.</span><span class="ident" id="6321314">FileMode</span><span class="op" id="6321322">(</span><span class="ident" id="6321323">m</span>&nbsp;<span class="op" id="6321325">&amp;</span>&nbsp;<span class="num" id="6321327">0777</span><span class="op" id="6321331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321334">switch</span>&nbsp;<span class="ident" id="6321341">m</span>&nbsp;<span class="op" id="6321343">&amp;</span>&nbsp;<span class="ident" id="6321345">s_IFMT</span>&nbsp;<span class="op" id="6321352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321355">case</span>&nbsp;<span class="ident" id="6321360">s_IFBLK</span><span class="op" id="6321367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321371">mode</span>&nbsp;<span class="op" id="6321376">|=</span>&nbsp;<span class="ident" id="6321379">os</span><span class="op" id="6321381">.</span><span class="ident" id="6321382">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321394">case</span>&nbsp;<span class="ident" id="6321399">s_IFCHR</span><span class="op" id="6321406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321410">mode</span>&nbsp;<span class="op" id="6321415">|=</span>&nbsp;<span class="ident" id="6321418">os</span><span class="op" id="6321420">.</span><span class="ident" id="6321421">ModeDevice</span>&nbsp;<span class="op" id="6321432">|</span>&nbsp;<span class="ident" id="6321434">os</span><span class="op" id="6321436">.</span><span class="ident" id="6321437">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321453">case</span>&nbsp;<span class="ident" id="6321458">s_IFDIR</span><span class="op" id="6321465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321469">mode</span>&nbsp;<span class="op" id="6321474">|=</span>&nbsp;<span class="ident" id="6321477">os</span><span class="op" id="6321479">.</span><span class="ident" id="6321480">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321489">case</span>&nbsp;<span class="ident" id="6321494">s_IFIFO</span><span class="op" id="6321501">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321505">mode</span>&nbsp;<span class="op" id="6321510">|=</span>&nbsp;<span class="ident" id="6321513">os</span><span class="op" id="6321515">.</span><span class="ident" id="6321516">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321531">case</span>&nbsp;<span class="ident" id="6321536">s_IFLNK</span><span class="op" id="6321543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321547">mode</span>&nbsp;<span class="op" id="6321552">|=</span>&nbsp;<span class="ident" id="6321555">os</span><span class="op" id="6321557">.</span><span class="ident" id="6321558">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321571">case</span>&nbsp;<span class="ident" id="6321576">s_IFREG</span><span class="op" id="6321583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6321587">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321605">case</span>&nbsp;<span class="ident" id="6321610">s_IFSOCK</span><span class="op" id="6321618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321622">mode</span>&nbsp;<span class="op" id="6321627">|=</span>&nbsp;<span class="ident" id="6321630">os</span><span class="op" id="6321632">.</span><span class="ident" id="6321633">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321648">if</span>&nbsp;<span class="ident" id="6321651">m</span><span class="op" id="6321652">&amp;</span><span class="ident" id="6321653">s_ISGID</span>&nbsp;<span class="op" id="6321661">!=</span>&nbsp;<span class="num" id="6321664">0</span>&nbsp;<span class="op" id="6321666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321670">mode</span>&nbsp;<span class="op" id="6321675">|=</span>&nbsp;<span class="ident" id="6321678">os</span><span class="op" id="6321680">.</span><span class="ident" id="6321681">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321696">if</span>&nbsp;<span class="ident" id="6321699">m</span><span class="op" id="6321700">&amp;</span><span class="ident" id="6321701">s_ISUID</span>&nbsp;<span class="op" id="6321709">!=</span>&nbsp;<span class="num" id="6321712">0</span>&nbsp;<span class="op" id="6321714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321718">mode</span>&nbsp;<span class="op" id="6321723">|=</span>&nbsp;<span class="ident" id="6321726">os</span><span class="op" id="6321728">.</span><span class="ident" id="6321729">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321744">if</span>&nbsp;<span class="ident" id="6321747">m</span><span class="op" id="6321748">&amp;</span><span class="ident" id="6321749">s_ISVTX</span>&nbsp;<span class="op" id="6321757">!=</span>&nbsp;<span class="num" id="6321760">0</span>&nbsp;<span class="op" id="6321762">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321766">mode</span>&nbsp;<span class="op" id="6321771">|=</span>&nbsp;<span class="ident" id="6321774">os</span><span class="op" id="6321776">.</span><span class="ident" id="6321777">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6321792">return</span>&nbsp;<span class="ident" id="6321799">mode</span><br>
<span class="lineno"></span><span class="op" id="6321804">}</span>
</div>
</body>
</html>
