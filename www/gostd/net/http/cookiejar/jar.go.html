<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html" class="current">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5559027">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5559082">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5559136">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5559187">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5559267">package</span>&nbsp;<span class="ident" id="5559275">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5559286">import</span>&nbsp;<span class="op" id="5559293">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559296">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559306">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559313">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559320">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559332">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559343">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559351">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559362">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5559370">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5559377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5559380">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5559453">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5559508">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5559578">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5559649">//</span><br>
<span class="lineno">25</span><span class="comment" id="5559652">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5559726">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5559750">//</span><br>
<span class="lineno"></span><span class="comment" id="5559753">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5559828">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5559907">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5559936">//</span><br>
<span class="lineno"></span><span class="comment" id="5559939">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5559996">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5560030">type</span>&nbsp;<span class="ident" id="5560035">PublicSuffixList</span>&nbsp;<span class="keyword" id="5560052">interface</span>&nbsp;<span class="op" id="5560062">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560065">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560119">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560123">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560194">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560266">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560288">PublicSuffix</span><span class="op" id="5560300">(</span><span class="ident" id="5560301">domain</span>&nbsp;<span class="builtintype" id="5560308">string</span><span class="op" id="5560314">)</span>&nbsp;<span class="builtintype" id="5560316">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560325">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560394">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560465">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560494">String</span><span class="op" id="5560500">(</span><span class="op" id="5560501">)</span>&nbsp;<span class="builtintype" id="5560503">string</span><br>
<span class="lineno"></span><span class="op" id="5560510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5560513">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5560564">type</span>&nbsp;<span class="ident" id="5560569">Options</span>&nbsp;<span class="keyword" id="5560577">struct</span>&nbsp;<span class="op" id="5560584">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560587">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560658">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560708">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560712">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560781">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5560854">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560873">PublicSuffixList</span>&nbsp;<span class="ident" id="5560890">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5560907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5560910">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5560984">type</span>&nbsp;<span class="ident" id="5560989">Jar</span>&nbsp;<span class="keyword" id="5560993">struct</span>&nbsp;<span class="op" id="5561000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561003">psList</span>&nbsp;<span class="ident" id="5561010">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561029">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561064">mu</span>&nbsp;<span class="ident" id="5561067">sync</span><span class="op" id="5561071">.</span><span class="ident" id="5561072">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561080">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561151">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561179">entries</span>&nbsp;<span class="keyword" id="5561187">map</span><span class="op" id="5561190">[</span><span class="builtintype" id="5561191">string</span><span class="op" id="5561197">]</span><span class="keyword" id="5561198">map</span><span class="op" id="5561201">[</span><span class="builtintype" id="5561202">string</span><span class="op" id="5561208">]</span><span class="ident" id="5561209">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561217">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561285">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561309">nextSeqNum</span>&nbsp;<span class="ident" id="5561320">uint64</span><br>
<span class="lineno"></span><span class="op" id="5561327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5561330">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5561402">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5561414">func</span>&nbsp;<span class="ident" id="5561419">New</span><span class="op" id="5561422">(</span><span class="ident" id="5561423">o</span>&nbsp;<span class="op" id="5561425">*</span><span class="ident" id="5561426">Options</span><span class="op" id="5561433">)</span>&nbsp;<span class="op" id="5561435">(</span><span class="op" id="5561436">*</span><span class="ident" id="5561437">Jar</span><span class="op" id="5561440">,</span>&nbsp;<span class="builtintype" id="5561442">error</span><span class="op" id="5561447">)</span>&nbsp;<span class="op" id="5561449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561452">jar</span>&nbsp;<span class="op" id="5561456">:=</span>&nbsp;<span class="op" id="5561459">&amp;</span><span class="ident" id="5561460">Jar</span><span class="op" id="5561463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561467">entries</span><span class="op" id="5561474">:</span>&nbsp;<span class="builtinfunc" id="5561476">make</span><span class="op" id="5561480">(</span><span class="keyword" id="5561481">map</span><span class="op" id="5561484">[</span><span class="builtintype" id="5561485">string</span><span class="op" id="5561491">]</span><span class="keyword" id="5561492">map</span><span class="op" id="5561495">[</span><span class="builtintype" id="5561496">string</span><span class="op" id="5561502">]</span><span class="ident" id="5561503">entry</span><span class="op" id="5561508">)</span><span class="op" id="5561509">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561515">if</span>&nbsp;<span class="ident" id="5561518">o</span>&nbsp;<span class="op" id="5561520">!=</span>&nbsp;<span class="ident" id="5561523">nil</span>&nbsp;<span class="op" id="5561527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561531">jar</span><span class="op" id="5561534">.</span><span class="ident" id="5561535">psList</span>&nbsp;<span class="op" id="5561542">=</span>&nbsp;<span class="ident" id="5561544">o</span><span class="op" id="5561545">.</span><span class="ident" id="5561546">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561567">return</span>&nbsp;<span class="ident" id="5561574">jar</span><span class="op" id="5561577">,</span>&nbsp;<span class="ident" id="5561579">nil</span><br>
<span class="lineno">85</span><span class="op" id="5561583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5561586">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5561639">//</span><br>
<span class="lineno"></span><span class="comment" id="5561642">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5561723">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5561756">type</span>&nbsp;<span class="ident" id="5561761">entry</span>&nbsp;<span class="keyword" id="5561767">struct</span>&nbsp;<span class="op" id="5561774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561777">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561788">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561796">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561807">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561815">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561826">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561834">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561845">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561853">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561864">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561870">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561881">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561887">Persistent</span>&nbsp;<span class="builtintype" id="5561898">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561904">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5561915">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561921">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561932">time</span><span class="op" id="5561936">.</span><span class="ident" id="5561937">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561943">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5561954">time</span><span class="op" id="5561958">.</span><span class="ident" id="5561959">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561965">LastAccess</span>&nbsp;<span class="ident" id="5561976">time</span><span class="op" id="5561980">.</span><span class="ident" id="5561981">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561988">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5562057">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5562131">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562181">seqNum</span>&nbsp;<span class="ident" id="5562188">uint64</span><br>
<span class="lineno"></span><span class="op" id="5562195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5562198">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5562255">func</span>&nbsp;<span class="op" id="5562260">(</span><span class="ident" id="5562261">e</span>&nbsp;<span class="op" id="5562263">*</span><span class="ident" id="5562264">entry</span><span class="op" id="5562269">)</span>&nbsp;<span class="ident" id="5562271">id</span><span class="op" id="5562273">(</span><span class="op" id="5562274">)</span>&nbsp;<span class="builtintype" id="5562276">string</span>&nbsp;<span class="op" id="5562283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562286">return</span>&nbsp;<span class="ident" id="5562293">fmt</span><span class="op" id="5562296">.</span><span class="ident" id="5562297">Sprintf</span><span class="op" id="5562304">(</span><span class="string" id="5562305">&#34;%s;%s;%s&#34;</span><span class="op" id="5562315">,</span>&nbsp;<span class="ident" id="5562317">e</span><span class="op" id="5562318">.</span><span class="ident" id="5562319">Domain</span><span class="op" id="5562325">,</span>&nbsp;<span class="ident" id="5562327">e</span><span class="op" id="5562328">.</span><span class="ident" id="5562329">Path</span><span class="op" id="5562333">,</span>&nbsp;<span class="ident" id="5562335">e</span><span class="op" id="5562336">.</span><span class="ident" id="5562337">Name</span><span class="op" id="5562341">)</span><br>
<span class="lineno"></span><span class="op" id="5562343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5562346">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5562420">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5562495">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5562517">func</span>&nbsp;<span class="op" id="5562522">(</span><span class="ident" id="5562523">e</span>&nbsp;<span class="op" id="5562525">*</span><span class="ident" id="5562526">entry</span><span class="op" id="5562531">)</span>&nbsp;<span class="ident" id="5562533">shouldSend</span><span class="op" id="5562543">(</span><span class="ident" id="5562544">https</span>&nbsp;<span class="builtintype" id="5562550">bool</span><span class="op" id="5562554">,</span>&nbsp;<span class="ident" id="5562556">host</span><span class="op" id="5562560">,</span>&nbsp;<span class="ident" id="5562562">path</span>&nbsp;<span class="builtintype" id="5562567">string</span><span class="op" id="5562573">)</span>&nbsp;<span class="builtintype" id="5562575">bool</span>&nbsp;<span class="op" id="5562580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562583">return</span>&nbsp;<span class="ident" id="5562590">e</span><span class="op" id="5562591">.</span><span class="ident" id="5562592">domainMatch</span><span class="op" id="5562603">(</span><span class="ident" id="5562604">host</span><span class="op" id="5562608">)</span>&nbsp;<span class="op" id="5562610">&amp;&amp;</span>&nbsp;<span class="ident" id="5562613">e</span><span class="op" id="5562614">.</span><span class="ident" id="5562615">pathMatch</span><span class="op" id="5562624">(</span><span class="ident" id="5562625">path</span><span class="op" id="5562629">)</span>&nbsp;<span class="op" id="5562631">&amp;&amp;</span>&nbsp;<span class="op" id="5562634">(</span><span class="ident" id="5562635">https</span>&nbsp;<span class="op" id="5562641">||</span>&nbsp;<span class="op" id="5562644">!</span><span class="ident" id="5562645">e</span><span class="op" id="5562646">.</span><span class="ident" id="5562647">Secure</span><span class="op" id="5562653">)</span><br>
<span class="lineno">120</span><span class="op" id="5562655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5562658">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5562726">func</span>&nbsp;<span class="op" id="5562731">(</span><span class="ident" id="5562732">e</span>&nbsp;<span class="op" id="5562734">*</span><span class="ident" id="5562735">entry</span><span class="op" id="5562740">)</span>&nbsp;<span class="ident" id="5562742">domainMatch</span><span class="op" id="5562753">(</span><span class="ident" id="5562754">host</span>&nbsp;<span class="builtintype" id="5562759">string</span><span class="op" id="5562765">)</span>&nbsp;<span class="builtintype" id="5562767">bool</span>&nbsp;<span class="op" id="5562772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562775">if</span>&nbsp;<span class="ident" id="5562778">e</span><span class="op" id="5562779">.</span><span class="ident" id="5562780">Domain</span>&nbsp;<span class="op" id="5562787">==</span>&nbsp;<span class="ident" id="5562790">host</span>&nbsp;<span class="op" id="5562795">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562799">return</span>&nbsp;<span class="builtintype" id="5562806">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562815">return</span>&nbsp;<span class="op" id="5562822">!</span><span class="ident" id="5562823">e</span><span class="op" id="5562824">.</span><span class="ident" id="5562825">HostOnly</span>&nbsp;<span class="op" id="5562834">&amp;&amp;</span>&nbsp;<span class="ident" id="5562837">hasDotSuffix</span><span class="op" id="5562849">(</span><span class="ident" id="5562850">host</span><span class="op" id="5562854">,</span>&nbsp;<span class="ident" id="5562856">e</span><span class="op" id="5562857">.</span><span class="ident" id="5562858">Domain</span><span class="op" id="5562864">)</span><br>
<span class="lineno"></span><span class="op" id="5562866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5562869">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5562943">func</span>&nbsp;<span class="op" id="5562948">(</span><span class="ident" id="5562949">e</span>&nbsp;<span class="op" id="5562951">*</span><span class="ident" id="5562952">entry</span><span class="op" id="5562957">)</span>&nbsp;<span class="ident" id="5562959">pathMatch</span><span class="op" id="5562968">(</span><span class="ident" id="5562969">requestPath</span>&nbsp;<span class="builtintype" id="5562981">string</span><span class="op" id="5562987">)</span>&nbsp;<span class="builtintype" id="5562989">bool</span>&nbsp;<span class="op" id="5562994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562997">if</span>&nbsp;<span class="ident" id="5563000">requestPath</span>&nbsp;<span class="op" id="5563012">==</span>&nbsp;<span class="ident" id="5563015">e</span><span class="op" id="5563016">.</span><span class="ident" id="5563017">Path</span>&nbsp;<span class="op" id="5563022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563026">return</span>&nbsp;<span class="builtintype" id="5563033">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563039">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563042">if</span>&nbsp;<span class="ident" id="5563045">strings</span><span class="op" id="5563052">.</span><span class="ident" id="5563053">HasPrefix</span><span class="op" id="5563062">(</span><span class="ident" id="5563063">requestPath</span><span class="op" id="5563074">,</span>&nbsp;<span class="ident" id="5563076">e</span><span class="op" id="5563077">.</span><span class="ident" id="5563078">Path</span><span class="op" id="5563082">)</span>&nbsp;<span class="op" id="5563084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563088">if</span>&nbsp;<span class="ident" id="5563091">e</span><span class="op" id="5563092">.</span><span class="ident" id="5563093">Path</span><span class="op" id="5563097">[</span><span class="builtinfunc" id="5563098">len</span><span class="op" id="5563101">(</span><span class="ident" id="5563102">e</span><span class="op" id="5563103">.</span><span class="ident" id="5563104">Path</span><span class="op" id="5563108">)</span><span class="op" id="5563109">-</span><span class="num" id="5563110">1</span><span class="op" id="5563111">]</span>&nbsp;<span class="op" id="5563113">==</span>&nbsp;<span class="string" id="5563116">&#39;/&#39;</span>&nbsp;<span class="op" id="5563120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563125">return</span>&nbsp;<span class="builtintype" id="5563132">true</span>&nbsp;<span class="comment" id="5563137">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563180">}</span>&nbsp;<span class="keyword" id="5563182">else</span>&nbsp;<span class="keyword" id="5563187">if</span>&nbsp;<span class="ident" id="5563190">requestPath</span><span class="op" id="5563201">[</span><span class="builtinfunc" id="5563202">len</span><span class="op" id="5563205">(</span><span class="ident" id="5563206">e</span><span class="op" id="5563207">.</span><span class="ident" id="5563208">Path</span><span class="op" id="5563212">)</span><span class="op" id="5563213">]</span>&nbsp;<span class="op" id="5563215">==</span>&nbsp;<span class="string" id="5563218">&#39;/&#39;</span>&nbsp;<span class="op" id="5563222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563227">return</span>&nbsp;<span class="builtintype" id="5563234">true</span>&nbsp;<span class="comment" id="5563239">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563287">return</span>&nbsp;<span class="builtintype" id="5563294">false</span><br>
<span class="lineno"></span><span class="op" id="5563300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5563303">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5563357">func</span>&nbsp;<span class="ident" id="5563362">hasDotSuffix</span><span class="op" id="5563374">(</span><span class="ident" id="5563375">s</span><span class="op" id="5563376">,</span>&nbsp;<span class="ident" id="5563378">suffix</span>&nbsp;<span class="builtintype" id="5563385">string</span><span class="op" id="5563391">)</span>&nbsp;<span class="builtintype" id="5563393">bool</span>&nbsp;<span class="op" id="5563398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563401">return</span>&nbsp;<span class="builtinfunc" id="5563408">len</span><span class="op" id="5563411">(</span><span class="ident" id="5563412">s</span><span class="op" id="5563413">)</span>&nbsp;<span class="op" id="5563415">&gt;</span>&nbsp;<span class="builtinfunc" id="5563417">len</span><span class="op" id="5563420">(</span><span class="ident" id="5563421">suffix</span><span class="op" id="5563427">)</span>&nbsp;<span class="op" id="5563429">&amp;&amp;</span>&nbsp;<span class="ident" id="5563432">s</span><span class="op" id="5563433">[</span><span class="builtinfunc" id="5563434">len</span><span class="op" id="5563437">(</span><span class="ident" id="5563438">s</span><span class="op" id="5563439">)</span><span class="op" id="5563440">-</span><span class="builtinfunc" id="5563441">len</span><span class="op" id="5563444">(</span><span class="ident" id="5563445">suffix</span><span class="op" id="5563451">)</span><span class="op" id="5563452">-</span><span class="num" id="5563453">1</span><span class="op" id="5563454">]</span>&nbsp;<span class="op" id="5563456">==</span>&nbsp;<span class="string" id="5563459">&#39;.&#39;</span>&nbsp;<span class="op" id="5563463">&amp;&amp;</span>&nbsp;<span class="ident" id="5563466">s</span><span class="op" id="5563467">[</span><span class="builtinfunc" id="5563468">len</span><span class="op" id="5563471">(</span><span class="ident" id="5563472">s</span><span class="op" id="5563473">)</span><span class="op" id="5563474">-</span><span class="builtinfunc" id="5563475">len</span><span class="op" id="5563478">(</span><span class="ident" id="5563479">suffix</span><span class="op" id="5563485">)</span><span class="op" id="5563486">:</span><span class="op" id="5563487">]</span>&nbsp;<span class="op" id="5563489">==</span>&nbsp;<span class="ident" id="5563492">suffix</span><br>
<span class="lineno"></span><span class="op" id="5563499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5563502">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5563579">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5563655">type</span>&nbsp;<span class="ident" id="5563660">byPathLength</span>&nbsp;<span class="op" id="5563673">[</span><span class="op" id="5563674">]</span><span class="ident" id="5563675">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5563682">func</span>&nbsp;<span class="op" id="5563687">(</span><span class="ident" id="5563688">s</span>&nbsp;<span class="ident" id="5563690">byPathLength</span><span class="op" id="5563702">)</span>&nbsp;<span class="ident" id="5563704">Len</span><span class="op" id="5563707">(</span><span class="op" id="5563708">)</span>&nbsp;<span class="builtintype" id="5563710">int</span>&nbsp;<span class="op" id="5563714">{</span>&nbsp;<span class="keyword" id="5563716">return</span>&nbsp;<span class="builtinfunc" id="5563723">len</span><span class="op" id="5563726">(</span><span class="ident" id="5563727">s</span><span class="op" id="5563728">)</span>&nbsp;<span class="op" id="5563730">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5563733">func</span>&nbsp;<span class="op" id="5563738">(</span><span class="ident" id="5563739">s</span>&nbsp;<span class="ident" id="5563741">byPathLength</span><span class="op" id="5563753">)</span>&nbsp;<span class="ident" id="5563755">Less</span><span class="op" id="5563759">(</span><span class="ident" id="5563760">i</span><span class="op" id="5563761">,</span>&nbsp;<span class="ident" id="5563763">j</span>&nbsp;<span class="builtintype" id="5563765">int</span><span class="op" id="5563768">)</span>&nbsp;<span class="builtintype" id="5563770">bool</span>&nbsp;<span class="op" id="5563775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563778">if</span>&nbsp;<span class="builtinfunc" id="5563781">len</span><span class="op" id="5563784">(</span><span class="ident" id="5563785">s</span><span class="op" id="5563786">[</span><span class="ident" id="5563787">i</span><span class="op" id="5563788">]</span><span class="op" id="5563789">.</span><span class="ident" id="5563790">Path</span><span class="op" id="5563794">)</span>&nbsp;<span class="op" id="5563796">!=</span>&nbsp;<span class="builtinfunc" id="5563799">len</span><span class="op" id="5563802">(</span><span class="ident" id="5563803">s</span><span class="op" id="5563804">[</span><span class="ident" id="5563805">j</span><span class="op" id="5563806">]</span><span class="op" id="5563807">.</span><span class="ident" id="5563808">Path</span><span class="op" id="5563812">)</span>&nbsp;<span class="op" id="5563814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563818">return</span>&nbsp;<span class="builtinfunc" id="5563825">len</span><span class="op" id="5563828">(</span><span class="ident" id="5563829">s</span><span class="op" id="5563830">[</span><span class="ident" id="5563831">i</span><span class="op" id="5563832">]</span><span class="op" id="5563833">.</span><span class="ident" id="5563834">Path</span><span class="op" id="5563838">)</span>&nbsp;<span class="op" id="5563840">&gt;</span>&nbsp;<span class="builtinfunc" id="5563842">len</span><span class="op" id="5563845">(</span><span class="ident" id="5563846">s</span><span class="op" id="5563847">[</span><span class="ident" id="5563848">j</span><span class="op" id="5563849">]</span><span class="op" id="5563850">.</span><span class="ident" id="5563851">Path</span><span class="op" id="5563855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563858">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563861">if</span>&nbsp;<span class="op" id="5563864">!</span><span class="ident" id="5563865">s</span><span class="op" id="5563866">[</span><span class="ident" id="5563867">i</span><span class="op" id="5563868">]</span><span class="op" id="5563869">.</span><span class="ident" id="5563870">Creation</span><span class="op" id="5563878">.</span><span class="ident" id="5563879">Equal</span><span class="op" id="5563884">(</span><span class="ident" id="5563885">s</span><span class="op" id="5563886">[</span><span class="ident" id="5563887">j</span><span class="op" id="5563888">]</span><span class="op" id="5563889">.</span><span class="ident" id="5563890">Creation</span><span class="op" id="5563898">)</span>&nbsp;<span class="op" id="5563900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563904">return</span>&nbsp;<span class="ident" id="5563911">s</span><span class="op" id="5563912">[</span><span class="ident" id="5563913">i</span><span class="op" id="5563914">]</span><span class="op" id="5563915">.</span><span class="ident" id="5563916">Creation</span><span class="op" id="5563924">.</span><span class="ident" id="5563925">Before</span><span class="op" id="5563931">(</span><span class="ident" id="5563932">s</span><span class="op" id="5563933">[</span><span class="ident" id="5563934">j</span><span class="op" id="5563935">]</span><span class="op" id="5563936">.</span><span class="ident" id="5563937">Creation</span><span class="op" id="5563945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563951">return</span>&nbsp;<span class="ident" id="5563958">s</span><span class="op" id="5563959">[</span><span class="ident" id="5563960">i</span><span class="op" id="5563961">]</span><span class="op" id="5563962">.</span><span class="ident" id="5563963">seqNum</span>&nbsp;<span class="op" id="5563970">&lt;</span>&nbsp;<span class="ident" id="5563972">s</span><span class="op" id="5563973">[</span><span class="ident" id="5563974">j</span><span class="op" id="5563975">]</span><span class="op" id="5563976">.</span><span class="ident" id="5563977">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5563984">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5563987">func</span>&nbsp;<span class="op" id="5563992">(</span><span class="ident" id="5563993">s</span>&nbsp;<span class="ident" id="5563995">byPathLength</span><span class="op" id="5564007">)</span>&nbsp;<span class="ident" id="5564009">Swap</span><span class="op" id="5564013">(</span><span class="ident" id="5564014">i</span><span class="op" id="5564015">,</span>&nbsp;<span class="ident" id="5564017">j</span>&nbsp;<span class="builtintype" id="5564019">int</span><span class="op" id="5564022">)</span>&nbsp;<span class="op" id="5564024">{</span>&nbsp;<span class="ident" id="5564026">s</span><span class="op" id="5564027">[</span><span class="ident" id="5564028">i</span><span class="op" id="5564029">]</span><span class="op" id="5564030">,</span>&nbsp;<span class="ident" id="5564032">s</span><span class="op" id="5564033">[</span><span class="ident" id="5564034">j</span><span class="op" id="5564035">]</span>&nbsp;<span class="op" id="5564037">=</span>&nbsp;<span class="ident" id="5564039">s</span><span class="op" id="5564040">[</span><span class="ident" id="5564041">j</span><span class="op" id="5564042">]</span><span class="op" id="5564043">,</span>&nbsp;<span class="ident" id="5564045">s</span><span class="op" id="5564046">[</span><span class="ident" id="5564047">i</span><span class="op" id="5564048">]</span>&nbsp;<span class="op" id="5564050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5564053">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5564127">//</span><br>
<span class="lineno">170</span><span class="comment" id="5564130">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5564201">func</span>&nbsp;<span class="op" id="5564206">(</span><span class="ident" id="5564207">j</span>&nbsp;<span class="op" id="5564209">*</span><span class="ident" id="5564210">Jar</span><span class="op" id="5564213">)</span>&nbsp;<span class="ident" id="5564215">Cookies</span><span class="op" id="5564222">(</span><span class="ident" id="5564223">u</span>&nbsp;<span class="op" id="5564225">*</span><span class="ident" id="5564226">url</span><span class="op" id="5564229">.</span><span class="ident" id="5564230">URL</span><span class="op" id="5564233">)</span>&nbsp;<span class="op" id="5564235">(</span><span class="ident" id="5564236">cookies</span>&nbsp;<span class="op" id="5564244">[</span><span class="op" id="5564245">]</span><span class="op" id="5564246">*</span><span class="ident" id="5564247">http</span><span class="op" id="5564251">.</span><span class="ident" id="5564252">Cookie</span><span class="op" id="5564258">)</span>&nbsp;<span class="op" id="5564260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564263">return</span>&nbsp;<span class="ident" id="5564270">j</span><span class="op" id="5564271">.</span><span class="ident" id="5564272">cookies</span><span class="op" id="5564279">(</span><span class="ident" id="5564280">u</span><span class="op" id="5564281">,</span>&nbsp;<span class="ident" id="5564283">time</span><span class="op" id="5564287">.</span><span class="ident" id="5564288">Now</span><span class="op" id="5564291">(</span><span class="op" id="5564292">)</span><span class="op" id="5564293">)</span><br>
<span class="lineno"></span><span class="op" id="5564295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5564298">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5564368">func</span>&nbsp;<span class="op" id="5564373">(</span><span class="ident" id="5564374">j</span>&nbsp;<span class="op" id="5564376">*</span><span class="ident" id="5564377">Jar</span><span class="op" id="5564380">)</span>&nbsp;<span class="ident" id="5564382">cookies</span><span class="op" id="5564389">(</span><span class="ident" id="5564390">u</span>&nbsp;<span class="op" id="5564392">*</span><span class="ident" id="5564393">url</span><span class="op" id="5564396">.</span><span class="ident" id="5564397">URL</span><span class="op" id="5564400">,</span>&nbsp;<span class="ident" id="5564402">now</span>&nbsp;<span class="ident" id="5564406">time</span><span class="op" id="5564410">.</span><span class="ident" id="5564411">Time</span><span class="op" id="5564415">)</span>&nbsp;<span class="op" id="5564417">(</span><span class="ident" id="5564418">cookies</span>&nbsp;<span class="op" id="5564426">[</span><span class="op" id="5564427">]</span><span class="op" id="5564428">*</span><span class="ident" id="5564429">http</span><span class="op" id="5564433">.</span><span class="ident" id="5564434">Cookie</span><span class="op" id="5564440">)</span>&nbsp;<span class="op" id="5564442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564445">if</span>&nbsp;<span class="ident" id="5564448">u</span><span class="op" id="5564449">.</span><span class="ident" id="5564450">Scheme</span>&nbsp;<span class="op" id="5564457">!=</span>&nbsp;<span class="string" id="5564460">&#34;http&#34;</span>&nbsp;<span class="op" id="5564467">&amp;&amp;</span>&nbsp;<span class="ident" id="5564470">u</span><span class="op" id="5564471">.</span><span class="ident" id="5564472">Scheme</span>&nbsp;<span class="op" id="5564479">!=</span>&nbsp;<span class="string" id="5564482">&#34;https&#34;</span>&nbsp;<span class="op" id="5564490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564494">return</span>&nbsp;<span class="ident" id="5564501">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564510">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564513">host</span><span class="op" id="5564517">,</span>&nbsp;<span class="ident" id="5564519">err</span>&nbsp;<span class="op" id="5564523">:=</span>&nbsp;<span class="ident" id="5564526">canonicalHost</span><span class="op" id="5564539">(</span><span class="ident" id="5564540">u</span><span class="op" id="5564541">.</span><span class="ident" id="5564542">Host</span><span class="op" id="5564546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564549">if</span>&nbsp;<span class="ident" id="5564552">err</span>&nbsp;<span class="op" id="5564556">!=</span>&nbsp;<span class="ident" id="5564559">nil</span>&nbsp;<span class="op" id="5564563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564567">return</span>&nbsp;<span class="ident" id="5564574">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564586">key</span>&nbsp;<span class="op" id="5564590">:=</span>&nbsp;<span class="ident" id="5564593">jarKey</span><span class="op" id="5564599">(</span><span class="ident" id="5564600">host</span><span class="op" id="5564604">,</span>&nbsp;<span class="ident" id="5564606">j</span><span class="op" id="5564607">.</span><span class="ident" id="5564608">psList</span><span class="op" id="5564614">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564618">j</span><span class="op" id="5564619">.</span><span class="ident" id="5564620">mu</span><span class="op" id="5564622">.</span><span class="ident" id="5564623">Lock</span><span class="op" id="5564627">(</span><span class="op" id="5564628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564631">defer</span>&nbsp;<span class="ident" id="5564637">j</span><span class="op" id="5564638">.</span><span class="ident" id="5564639">mu</span><span class="op" id="5564641">.</span><span class="ident" id="5564642">Unlock</span><span class="op" id="5564648">(</span><span class="op" id="5564649">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564653">submap</span>&nbsp;<span class="op" id="5564660">:=</span>&nbsp;<span class="ident" id="5564663">j</span><span class="op" id="5564664">.</span><span class="ident" id="5564665">entries</span><span class="op" id="5564672">[</span><span class="ident" id="5564673">key</span><span class="op" id="5564676">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564679">if</span>&nbsp;<span class="ident" id="5564682">submap</span>&nbsp;<span class="op" id="5564689">==</span>&nbsp;<span class="ident" id="5564692">nil</span>&nbsp;<span class="op" id="5564696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564700">return</span>&nbsp;<span class="ident" id="5564707">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564720">https</span>&nbsp;<span class="op" id="5564726">:=</span>&nbsp;<span class="ident" id="5564729">u</span><span class="op" id="5564730">.</span><span class="ident" id="5564731">Scheme</span>&nbsp;<span class="op" id="5564738">==</span>&nbsp;<span class="string" id="5564741">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564750">path</span>&nbsp;<span class="op" id="5564755">:=</span>&nbsp;<span class="ident" id="5564758">u</span><span class="op" id="5564759">.</span><span class="ident" id="5564760">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564766">if</span>&nbsp;<span class="ident" id="5564769">path</span>&nbsp;<span class="op" id="5564774">==</span>&nbsp;<span class="string" id="5564777">&#34;&#34;</span>&nbsp;<span class="op" id="5564780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564784">path</span>&nbsp;<span class="op" id="5564789">=</span>&nbsp;<span class="string" id="5564791">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564800">modified</span>&nbsp;<span class="op" id="5564809">:=</span>&nbsp;<span class="builtintype" id="5564812">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564819">var</span>&nbsp;<span class="ident" id="5564823">selected</span>&nbsp;<span class="op" id="5564832">[</span><span class="op" id="5564833">]</span><span class="ident" id="5564834">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564841">for</span>&nbsp;<span class="ident" id="5564845">id</span><span class="op" id="5564847">,</span>&nbsp;<span class="ident" id="5564849">e</span>&nbsp;<span class="op" id="5564851">:=</span>&nbsp;<span class="keyword" id="5564854">range</span>&nbsp;<span class="ident" id="5564860">submap</span>&nbsp;<span class="op" id="5564867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564871">if</span>&nbsp;<span class="ident" id="5564874">e</span><span class="op" id="5564875">.</span><span class="ident" id="5564876">Persistent</span>&nbsp;<span class="op" id="5564887">&amp;&amp;</span>&nbsp;<span class="op" id="5564890">!</span><span class="ident" id="5564891">e</span><span class="op" id="5564892">.</span><span class="ident" id="5564893">Expires</span><span class="op" id="5564900">.</span><span class="ident" id="5564901">After</span><span class="op" id="5564906">(</span><span class="ident" id="5564907">now</span><span class="op" id="5564910">)</span>&nbsp;<span class="op" id="5564912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5564917">delete</span><span class="op" id="5564923">(</span><span class="ident" id="5564924">submap</span><span class="op" id="5564930">,</span>&nbsp;<span class="ident" id="5564932">id</span><span class="op" id="5564934">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564939">modified</span>&nbsp;<span class="op" id="5564948">=</span>&nbsp;<span class="builtintype" id="5564950">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564958">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564973">if</span>&nbsp;<span class="op" id="5564976">!</span><span class="ident" id="5564977">e</span><span class="op" id="5564978">.</span><span class="ident" id="5564979">shouldSend</span><span class="op" id="5564989">(</span><span class="ident" id="5564990">https</span><span class="op" id="5564995">,</span>&nbsp;<span class="ident" id="5564997">host</span><span class="op" id="5565001">,</span>&nbsp;<span class="ident" id="5565003">path</span><span class="op" id="5565007">)</span>&nbsp;<span class="op" id="5565009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565014">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565029">e</span><span class="op" id="5565030">.</span><span class="ident" id="5565031">LastAccess</span>&nbsp;<span class="op" id="5565042">=</span>&nbsp;<span class="ident" id="5565044">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565050">submap</span><span class="op" id="5565056">[</span><span class="ident" id="5565057">id</span><span class="op" id="5565059">]</span>&nbsp;<span class="op" id="5565061">=</span>&nbsp;<span class="ident" id="5565063">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565067">selected</span>&nbsp;<span class="op" id="5565076">=</span>&nbsp;<span class="builtinfunc" id="5565078">append</span><span class="op" id="5565084">(</span><span class="ident" id="5565085">selected</span><span class="op" id="5565093">,</span>&nbsp;<span class="ident" id="5565095">e</span><span class="op" id="5565096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565100">modified</span>&nbsp;<span class="op" id="5565109">=</span>&nbsp;<span class="builtintype" id="5565111">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565120">if</span>&nbsp;<span class="ident" id="5565123">modified</span>&nbsp;<span class="op" id="5565132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565136">if</span>&nbsp;<span class="builtinfunc" id="5565139">len</span><span class="op" id="5565142">(</span><span class="ident" id="5565143">submap</span><span class="op" id="5565149">)</span>&nbsp;<span class="op" id="5565151">==</span>&nbsp;<span class="num" id="5565154">0</span>&nbsp;<span class="op" id="5565156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5565161">delete</span><span class="op" id="5565167">(</span><span class="ident" id="5565168">j</span><span class="op" id="5565169">.</span><span class="ident" id="5565170">entries</span><span class="op" id="5565177">,</span>&nbsp;<span class="ident" id="5565179">key</span><span class="op" id="5565182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565186">}</span>&nbsp;<span class="keyword" id="5565188">else</span>&nbsp;<span class="op" id="5565193">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565198">j</span><span class="op" id="5565199">.</span><span class="ident" id="5565200">entries</span><span class="op" id="5565207">[</span><span class="ident" id="5565208">key</span><span class="op" id="5565211">]</span>&nbsp;<span class="op" id="5565213">=</span>&nbsp;<span class="ident" id="5565215">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565231">sort</span><span class="op" id="5565235">.</span><span class="ident" id="5565236">Sort</span><span class="op" id="5565240">(</span><span class="ident" id="5565241">byPathLength</span><span class="op" id="5565253">(</span><span class="ident" id="5565254">selected</span><span class="op" id="5565262">)</span><span class="op" id="5565263">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565266">for</span>&nbsp;<span class="ident" id="5565270">_</span><span class="op" id="5565271">,</span>&nbsp;<span class="ident" id="5565273">e</span>&nbsp;<span class="op" id="5565275">:=</span>&nbsp;<span class="keyword" id="5565278">range</span>&nbsp;<span class="ident" id="5565284">selected</span>&nbsp;<span class="op" id="5565293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565297">cookies</span>&nbsp;<span class="op" id="5565305">=</span>&nbsp;<span class="builtinfunc" id="5565307">append</span><span class="op" id="5565313">(</span><span class="ident" id="5565314">cookies</span><span class="op" id="5565321">,</span>&nbsp;<span class="op" id="5565323">&amp;</span><span class="ident" id="5565324">http</span><span class="op" id="5565328">.</span><span class="ident" id="5565329">Cookie</span><span class="op" id="5565335">{</span><span class="ident" id="5565336">Name</span><span class="op" id="5565340">:</span>&nbsp;<span class="ident" id="5565342">e</span><span class="op" id="5565343">.</span><span class="ident" id="5565344">Name</span><span class="op" id="5565348">,</span>&nbsp;<span class="ident" id="5565350">Value</span><span class="op" id="5565355">:</span>&nbsp;<span class="ident" id="5565357">e</span><span class="op" id="5565358">.</span><span class="ident" id="5565359">Value</span><span class="op" id="5565364">}</span><span class="op" id="5565365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565372">return</span>&nbsp;<span class="ident" id="5565379">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5565387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5565390">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5565470">//</span><br>
<span class="lineno"></span><span class="comment" id="5565473">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5565534">func</span>&nbsp;<span class="op" id="5565539">(</span><span class="ident" id="5565540">j</span>&nbsp;<span class="op" id="5565542">*</span><span class="ident" id="5565543">Jar</span><span class="op" id="5565546">)</span>&nbsp;<span class="ident" id="5565548">SetCookies</span><span class="op" id="5565558">(</span><span class="ident" id="5565559">u</span>&nbsp;<span class="op" id="5565561">*</span><span class="ident" id="5565562">url</span><span class="op" id="5565565">.</span><span class="ident" id="5565566">URL</span><span class="op" id="5565569">,</span>&nbsp;<span class="ident" id="5565571">cookies</span>&nbsp;<span class="op" id="5565579">[</span><span class="op" id="5565580">]</span><span class="op" id="5565581">*</span><span class="ident" id="5565582">http</span><span class="op" id="5565586">.</span><span class="ident" id="5565587">Cookie</span><span class="op" id="5565593">)</span>&nbsp;<span class="op" id="5565595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565598">j</span><span class="op" id="5565599">.</span><span class="ident" id="5565600">setCookies</span><span class="op" id="5565610">(</span><span class="ident" id="5565611">u</span><span class="op" id="5565612">,</span>&nbsp;<span class="ident" id="5565614">cookies</span><span class="op" id="5565621">,</span>&nbsp;<span class="ident" id="5565623">time</span><span class="op" id="5565627">.</span><span class="ident" id="5565628">Now</span><span class="op" id="5565631">(</span><span class="op" id="5565632">)</span><span class="op" id="5565633">)</span><br>
<span class="lineno"></span><span class="op" id="5565635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5565638">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5565712">func</span>&nbsp;<span class="op" id="5565717">(</span><span class="ident" id="5565718">j</span>&nbsp;<span class="op" id="5565720">*</span><span class="ident" id="5565721">Jar</span><span class="op" id="5565724">)</span>&nbsp;<span class="ident" id="5565726">setCookies</span><span class="op" id="5565736">(</span><span class="ident" id="5565737">u</span>&nbsp;<span class="op" id="5565739">*</span><span class="ident" id="5565740">url</span><span class="op" id="5565743">.</span><span class="ident" id="5565744">URL</span><span class="op" id="5565747">,</span>&nbsp;<span class="ident" id="5565749">cookies</span>&nbsp;<span class="op" id="5565757">[</span><span class="op" id="5565758">]</span><span class="op" id="5565759">*</span><span class="ident" id="5565760">http</span><span class="op" id="5565764">.</span><span class="ident" id="5565765">Cookie</span><span class="op" id="5565771">,</span>&nbsp;<span class="ident" id="5565773">now</span>&nbsp;<span class="ident" id="5565777">time</span><span class="op" id="5565781">.</span><span class="ident" id="5565782">Time</span><span class="op" id="5565786">)</span>&nbsp;<span class="op" id="5565788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565791">if</span>&nbsp;<span class="builtinfunc" id="5565794">len</span><span class="op" id="5565797">(</span><span class="ident" id="5565798">cookies</span><span class="op" id="5565805">)</span>&nbsp;<span class="op" id="5565807">==</span>&nbsp;<span class="num" id="5565810">0</span>&nbsp;<span class="op" id="5565812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565816">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565827">if</span>&nbsp;<span class="ident" id="5565830">u</span><span class="op" id="5565831">.</span><span class="ident" id="5565832">Scheme</span>&nbsp;<span class="op" id="5565839">!=</span>&nbsp;<span class="string" id="5565842">&#34;http&#34;</span>&nbsp;<span class="op" id="5565849">&amp;&amp;</span>&nbsp;<span class="ident" id="5565852">u</span><span class="op" id="5565853">.</span><span class="ident" id="5565854">Scheme</span>&nbsp;<span class="op" id="5565861">!=</span>&nbsp;<span class="string" id="5565864">&#34;https&#34;</span>&nbsp;<span class="op" id="5565872">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565876">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565887">host</span><span class="op" id="5565891">,</span>&nbsp;<span class="ident" id="5565893">err</span>&nbsp;<span class="op" id="5565897">:=</span>&nbsp;<span class="ident" id="5565900">canonicalHost</span><span class="op" id="5565913">(</span><span class="ident" id="5565914">u</span><span class="op" id="5565915">.</span><span class="ident" id="5565916">Host</span><span class="op" id="5565920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565923">if</span>&nbsp;<span class="ident" id="5565926">err</span>&nbsp;<span class="op" id="5565930">!=</span>&nbsp;<span class="ident" id="5565933">nil</span>&nbsp;<span class="op" id="5565937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565941">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565952">key</span>&nbsp;<span class="op" id="5565956">:=</span>&nbsp;<span class="ident" id="5565959">jarKey</span><span class="op" id="5565965">(</span><span class="ident" id="5565966">host</span><span class="op" id="5565970">,</span>&nbsp;<span class="ident" id="5565972">j</span><span class="op" id="5565973">.</span><span class="ident" id="5565974">psList</span><span class="op" id="5565980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565983">defPath</span>&nbsp;<span class="op" id="5565991">:=</span>&nbsp;<span class="ident" id="5565994">defaultPath</span><span class="op" id="5566005">(</span><span class="ident" id="5566006">u</span><span class="op" id="5566007">.</span><span class="ident" id="5566008">Path</span><span class="op" id="5566012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566016">j</span><span class="op" id="5566017">.</span><span class="ident" id="5566018">mu</span><span class="op" id="5566020">.</span><span class="ident" id="5566021">Lock</span><span class="op" id="5566025">(</span><span class="op" id="5566026">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566029">defer</span>&nbsp;<span class="ident" id="5566035">j</span><span class="op" id="5566036">.</span><span class="ident" id="5566037">mu</span><span class="op" id="5566039">.</span><span class="ident" id="5566040">Unlock</span><span class="op" id="5566046">(</span><span class="op" id="5566047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566051">submap</span>&nbsp;<span class="op" id="5566058">:=</span>&nbsp;<span class="ident" id="5566061">j</span><span class="op" id="5566062">.</span><span class="ident" id="5566063">entries</span><span class="op" id="5566070">[</span><span class="ident" id="5566071">key</span><span class="op" id="5566074">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566078">modified</span>&nbsp;<span class="op" id="5566087">:=</span>&nbsp;<span class="builtintype" id="5566090">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566097">for</span>&nbsp;<span class="ident" id="5566101">_</span><span class="op" id="5566102">,</span>&nbsp;<span class="ident" id="5566104">cookie</span>&nbsp;<span class="op" id="5566111">:=</span>&nbsp;<span class="keyword" id="5566114">range</span>&nbsp;<span class="ident" id="5566120">cookies</span>&nbsp;<span class="op" id="5566128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566132">e</span><span class="op" id="5566133">,</span>&nbsp;<span class="ident" id="5566135">remove</span><span class="op" id="5566141">,</span>&nbsp;<span class="ident" id="5566143">err</span>&nbsp;<span class="op" id="5566147">:=</span>&nbsp;<span class="ident" id="5566150">j</span><span class="op" id="5566151">.</span><span class="ident" id="5566152">newEntry</span><span class="op" id="5566160">(</span><span class="ident" id="5566161">cookie</span><span class="op" id="5566167">,</span>&nbsp;<span class="ident" id="5566169">now</span><span class="op" id="5566172">,</span>&nbsp;<span class="ident" id="5566174">defPath</span><span class="op" id="5566181">,</span>&nbsp;<span class="ident" id="5566183">host</span><span class="op" id="5566187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566191">if</span>&nbsp;<span class="ident" id="5566194">err</span>&nbsp;<span class="op" id="5566198">!=</span>&nbsp;<span class="ident" id="5566201">nil</span>&nbsp;<span class="op" id="5566205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566210">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566221">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566225">id</span>&nbsp;<span class="op" id="5566228">:=</span>&nbsp;<span class="ident" id="5566231">e</span><span class="op" id="5566232">.</span><span class="ident" id="5566233">id</span><span class="op" id="5566235">(</span><span class="op" id="5566236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566240">if</span>&nbsp;<span class="ident" id="5566243">remove</span>&nbsp;<span class="op" id="5566250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566255">if</span>&nbsp;<span class="ident" id="5566258">submap</span>&nbsp;<span class="op" id="5566265">!=</span>&nbsp;<span class="ident" id="5566268">nil</span>&nbsp;<span class="op" id="5566272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566278">if</span>&nbsp;<span class="ident" id="5566281">_</span><span class="op" id="5566282">,</span>&nbsp;<span class="ident" id="5566284">ok</span>&nbsp;<span class="op" id="5566287">:=</span>&nbsp;<span class="ident" id="5566290">submap</span><span class="op" id="5566296">[</span><span class="ident" id="5566297">id</span><span class="op" id="5566299">]</span><span class="op" id="5566300">;</span>&nbsp;<span class="ident" id="5566302">ok</span>&nbsp;<span class="op" id="5566305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5566312">delete</span><span class="op" id="5566318">(</span><span class="ident" id="5566319">submap</span><span class="op" id="5566325">,</span>&nbsp;<span class="ident" id="5566327">id</span><span class="op" id="5566329">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566336">modified</span>&nbsp;<span class="op" id="5566345">=</span>&nbsp;<span class="builtintype" id="5566347">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566366">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566377">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566381">if</span>&nbsp;<span class="ident" id="5566384">submap</span>&nbsp;<span class="op" id="5566391">==</span>&nbsp;<span class="ident" id="5566394">nil</span>&nbsp;<span class="op" id="5566398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566403">submap</span>&nbsp;<span class="op" id="5566410">=</span>&nbsp;<span class="builtinfunc" id="5566412">make</span><span class="op" id="5566416">(</span><span class="keyword" id="5566417">map</span><span class="op" id="5566420">[</span><span class="builtintype" id="5566421">string</span><span class="op" id="5566427">]</span><span class="ident" id="5566428">entry</span><span class="op" id="5566433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566442">if</span>&nbsp;<span class="ident" id="5566445">old</span><span class="op" id="5566448">,</span>&nbsp;<span class="ident" id="5566450">ok</span>&nbsp;<span class="op" id="5566453">:=</span>&nbsp;<span class="ident" id="5566456">submap</span><span class="op" id="5566462">[</span><span class="ident" id="5566463">id</span><span class="op" id="5566465">]</span><span class="op" id="5566466">;</span>&nbsp;<span class="ident" id="5566468">ok</span>&nbsp;<span class="op" id="5566471">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566476">e</span><span class="op" id="5566477">.</span><span class="ident" id="5566478">Creation</span>&nbsp;<span class="op" id="5566487">=</span>&nbsp;<span class="ident" id="5566489">old</span><span class="op" id="5566492">.</span><span class="ident" id="5566493">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566505">e</span><span class="op" id="5566506">.</span><span class="ident" id="5566507">seqNum</span>&nbsp;<span class="op" id="5566514">=</span>&nbsp;<span class="ident" id="5566516">old</span><span class="op" id="5566519">.</span><span class="ident" id="5566520">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566529">}</span>&nbsp;<span class="keyword" id="5566531">else</span>&nbsp;<span class="op" id="5566536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566541">e</span><span class="op" id="5566542">.</span><span class="ident" id="5566543">Creation</span>&nbsp;<span class="op" id="5566552">=</span>&nbsp;<span class="ident" id="5566554">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566561">e</span><span class="op" id="5566562">.</span><span class="ident" id="5566563">seqNum</span>&nbsp;<span class="op" id="5566570">=</span>&nbsp;<span class="ident" id="5566572">j</span><span class="op" id="5566573">.</span><span class="ident" id="5566574">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566588">j</span><span class="op" id="5566589">.</span><span class="ident" id="5566590">nextSeqNum</span><span class="op" id="5566600">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566609">e</span><span class="op" id="5566610">.</span><span class="ident" id="5566611">LastAccess</span>&nbsp;<span class="op" id="5566622">=</span>&nbsp;<span class="ident" id="5566624">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566630">submap</span><span class="op" id="5566636">[</span><span class="ident" id="5566637">id</span><span class="op" id="5566639">]</span>&nbsp;<span class="op" id="5566641">=</span>&nbsp;<span class="ident" id="5566643">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566647">modified</span>&nbsp;<span class="op" id="5566656">=</span>&nbsp;<span class="builtintype" id="5566658">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566668">if</span>&nbsp;<span class="ident" id="5566671">modified</span>&nbsp;<span class="op" id="5566680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566684">if</span>&nbsp;<span class="builtinfunc" id="5566687">len</span><span class="op" id="5566690">(</span><span class="ident" id="5566691">submap</span><span class="op" id="5566697">)</span>&nbsp;<span class="op" id="5566699">==</span>&nbsp;<span class="num" id="5566702">0</span>&nbsp;<span class="op" id="5566704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5566709">delete</span><span class="op" id="5566715">(</span><span class="ident" id="5566716">j</span><span class="op" id="5566717">.</span><span class="ident" id="5566718">entries</span><span class="op" id="5566725">,</span>&nbsp;<span class="ident" id="5566727">key</span><span class="op" id="5566730">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566734">}</span>&nbsp;<span class="keyword" id="5566736">else</span>&nbsp;<span class="op" id="5566741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566746">j</span><span class="op" id="5566747">.</span><span class="ident" id="5566748">entries</span><span class="op" id="5566755">[</span><span class="ident" id="5566756">key</span><span class="op" id="5566759">]</span>&nbsp;<span class="op" id="5566761">=</span>&nbsp;<span class="ident" id="5566763">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566775">}</span><br>
<span class="lineno"></span><span class="op" id="5566777">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5566780">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5566860">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5566874">func</span>&nbsp;<span class="ident" id="5566879">canonicalHost</span><span class="op" id="5566892">(</span><span class="ident" id="5566893">host</span>&nbsp;<span class="builtintype" id="5566898">string</span><span class="op" id="5566904">)</span>&nbsp;<span class="op" id="5566906">(</span><span class="builtintype" id="5566907">string</span><span class="op" id="5566913">,</span>&nbsp;<span class="builtintype" id="5566915">error</span><span class="op" id="5566920">)</span>&nbsp;<span class="op" id="5566922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566925">var</span>&nbsp;<span class="ident" id="5566929">err</span>&nbsp;<span class="builtintype" id="5566933">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566940">host</span>&nbsp;<span class="op" id="5566945">=</span>&nbsp;<span class="ident" id="5566947">strings</span><span class="op" id="5566954">.</span><span class="ident" id="5566955">ToLower</span><span class="op" id="5566962">(</span><span class="ident" id="5566963">host</span><span class="op" id="5566967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566970">if</span>&nbsp;<span class="ident" id="5566973">hasPort</span><span class="op" id="5566980">(</span><span class="ident" id="5566981">host</span><span class="op" id="5566985">)</span>&nbsp;<span class="op" id="5566987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566991">host</span><span class="op" id="5566995">,</span>&nbsp;<span class="ident" id="5566997">_</span><span class="op" id="5566998">,</span>&nbsp;<span class="ident" id="5567000">err</span>&nbsp;<span class="op" id="5567004">=</span>&nbsp;<span class="ident" id="5567006">net</span><span class="op" id="5567009">.</span><span class="ident" id="5567010">SplitHostPort</span><span class="op" id="5567023">(</span><span class="ident" id="5567024">host</span><span class="op" id="5567028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567032">if</span>&nbsp;<span class="ident" id="5567035">err</span>&nbsp;<span class="op" id="5567039">!=</span>&nbsp;<span class="ident" id="5567042">nil</span>&nbsp;<span class="op" id="5567046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567051">return</span>&nbsp;<span class="string" id="5567058">&#34;&#34;</span><span class="op" id="5567060">,</span>&nbsp;<span class="ident" id="5567062">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567074">if</span>&nbsp;<span class="ident" id="5567077">strings</span><span class="op" id="5567084">.</span><span class="ident" id="5567085">HasSuffix</span><span class="op" id="5567094">(</span><span class="ident" id="5567095">host</span><span class="op" id="5567099">,</span>&nbsp;<span class="string" id="5567101">&#34;.&#34;</span><span class="op" id="5567104">)</span>&nbsp;<span class="op" id="5567106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567110">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567169">host</span>&nbsp;<span class="op" id="5567174">=</span>&nbsp;<span class="ident" id="5567176">host</span><span class="op" id="5567180">[</span><span class="op" id="5567181">:</span><span class="builtinfunc" id="5567182">len</span><span class="op" id="5567185">(</span><span class="ident" id="5567186">host</span><span class="op" id="5567190">)</span><span class="op" id="5567191">-</span><span class="num" id="5567192">1</span><span class="op" id="5567193">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567199">return</span>&nbsp;<span class="ident" id="5567206">toASCII</span><span class="op" id="5567213">(</span><span class="ident" id="5567214">host</span><span class="op" id="5567218">)</span><br>
<span class="lineno"></span><span class="op" id="5567220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5567223">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5567298">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5567335">func</span>&nbsp;<span class="ident" id="5567340">hasPort</span><span class="op" id="5567347">(</span><span class="ident" id="5567348">host</span>&nbsp;<span class="builtintype" id="5567353">string</span><span class="op" id="5567359">)</span>&nbsp;<span class="builtintype" id="5567361">bool</span>&nbsp;<span class="op" id="5567366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567369">colons</span>&nbsp;<span class="op" id="5567376">:=</span>&nbsp;<span class="ident" id="5567379">strings</span><span class="op" id="5567386">.</span><span class="ident" id="5567387">Count</span><span class="op" id="5567392">(</span><span class="ident" id="5567393">host</span><span class="op" id="5567397">,</span>&nbsp;<span class="string" id="5567399">&#34;:&#34;</span><span class="op" id="5567402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567405">if</span>&nbsp;<span class="ident" id="5567408">colons</span>&nbsp;<span class="op" id="5567415">==</span>&nbsp;<span class="num" id="5567418">0</span>&nbsp;<span class="op" id="5567420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567424">return</span>&nbsp;<span class="builtintype" id="5567431">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567441">if</span>&nbsp;<span class="ident" id="5567444">colons</span>&nbsp;<span class="op" id="5567451">==</span>&nbsp;<span class="num" id="5567454">1</span>&nbsp;<span class="op" id="5567456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567460">return</span>&nbsp;<span class="builtintype" id="5567467">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567476">return</span>&nbsp;<span class="ident" id="5567483">host</span><span class="op" id="5567487">[</span><span class="num" id="5567488">0</span><span class="op" id="5567489">]</span>&nbsp;<span class="op" id="5567491">==</span>&nbsp;<span class="string" id="5567494">&#39;[&#39;</span>&nbsp;<span class="op" id="5567498">&amp;&amp;</span>&nbsp;<span class="ident" id="5567501">strings</span><span class="op" id="5567508">.</span><span class="ident" id="5567509">Contains</span><span class="op" id="5567517">(</span><span class="ident" id="5567518">host</span><span class="op" id="5567522">,</span>&nbsp;<span class="string" id="5567524">&#34;]:&#34;</span><span class="op" id="5567528">)</span><br>
<span class="lineno">330</span><span class="op" id="5567530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5567533">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5567577">func</span>&nbsp;<span class="ident" id="5567582">jarKey</span><span class="op" id="5567588">(</span><span class="ident" id="5567589">host</span>&nbsp;<span class="builtintype" id="5567594">string</span><span class="op" id="5567600">,</span>&nbsp;<span class="ident" id="5567602">psl</span>&nbsp;<span class="ident" id="5567606">PublicSuffixList</span><span class="op" id="5567622">)</span>&nbsp;<span class="builtintype" id="5567624">string</span>&nbsp;<span class="op" id="5567631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567634">if</span>&nbsp;<span class="ident" id="5567637">isIP</span><span class="op" id="5567641">(</span><span class="ident" id="5567642">host</span><span class="op" id="5567646">)</span>&nbsp;<span class="op" id="5567648">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567652">return</span>&nbsp;<span class="ident" id="5567659">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567669">var</span>&nbsp;<span class="ident" id="5567673">i</span>&nbsp;<span class="builtintype" id="5567675">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567680">if</span>&nbsp;<span class="ident" id="5567683">psl</span>&nbsp;<span class="op" id="5567687">==</span>&nbsp;<span class="ident" id="5567690">nil</span>&nbsp;<span class="op" id="5567694">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567698">i</span>&nbsp;<span class="op" id="5567700">=</span>&nbsp;<span class="ident" id="5567702">strings</span><span class="op" id="5567709">.</span><span class="ident" id="5567710">LastIndex</span><span class="op" id="5567719">(</span><span class="ident" id="5567720">host</span><span class="op" id="5567724">,</span>&nbsp;<span class="string" id="5567726">&#34;.&#34;</span><span class="op" id="5567729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567733">if</span>&nbsp;<span class="ident" id="5567736">i</span>&nbsp;<span class="op" id="5567738">==</span>&nbsp;<span class="op" id="5567741">-</span><span class="num" id="5567742">1</span>&nbsp;<span class="op" id="5567744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567749">return</span>&nbsp;<span class="ident" id="5567756">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567766">}</span>&nbsp;<span class="keyword" id="5567768">else</span>&nbsp;<span class="op" id="5567773">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567777">suffix</span>&nbsp;<span class="op" id="5567784">:=</span>&nbsp;<span class="ident" id="5567787">psl</span><span class="op" id="5567790">.</span><span class="ident" id="5567791">PublicSuffix</span><span class="op" id="5567803">(</span><span class="ident" id="5567804">host</span><span class="op" id="5567808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567812">if</span>&nbsp;<span class="ident" id="5567815">suffix</span>&nbsp;<span class="op" id="5567822">==</span>&nbsp;<span class="ident" id="5567825">host</span>&nbsp;<span class="op" id="5567830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567835">return</span>&nbsp;<span class="ident" id="5567842">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567853">i</span>&nbsp;<span class="op" id="5567855">=</span>&nbsp;<span class="builtinfunc" id="5567857">len</span><span class="op" id="5567860">(</span><span class="ident" id="5567861">host</span><span class="op" id="5567865">)</span>&nbsp;<span class="op" id="5567867">-</span>&nbsp;<span class="builtinfunc" id="5567869">len</span><span class="op" id="5567872">(</span><span class="ident" id="5567873">suffix</span><span class="op" id="5567879">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567883">if</span>&nbsp;<span class="ident" id="5567886">i</span>&nbsp;<span class="op" id="5567888">&lt;=</span>&nbsp;<span class="num" id="5567891">0</span>&nbsp;<span class="op" id="5567893">||</span>&nbsp;<span class="ident" id="5567896">host</span><span class="op" id="5567900">[</span><span class="ident" id="5567901">i</span><span class="op" id="5567902">-</span><span class="num" id="5567903">1</span><span class="op" id="5567904">]</span>&nbsp;<span class="op" id="5567906">!=</span>&nbsp;<span class="string" id="5567909">&#39;.&#39;</span>&nbsp;<span class="op" id="5567913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567918">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567971">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568023">return</span>&nbsp;<span class="ident" id="5568030">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568037">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568043">prevDot</span>&nbsp;<span class="op" id="5568051">:=</span>&nbsp;<span class="ident" id="5568054">strings</span><span class="op" id="5568061">.</span><span class="ident" id="5568062">LastIndex</span><span class="op" id="5568071">(</span><span class="ident" id="5568072">host</span><span class="op" id="5568076">[</span><span class="op" id="5568077">:</span><span class="ident" id="5568078">i</span><span class="op" id="5568079">-</span><span class="num" id="5568080">1</span><span class="op" id="5568081">]</span><span class="op" id="5568082">,</span>&nbsp;<span class="string" id="5568084">&#34;.&#34;</span><span class="op" id="5568087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568090">return</span>&nbsp;<span class="ident" id="5568097">host</span><span class="op" id="5568101">[</span><span class="ident" id="5568102">prevDot</span><span class="op" id="5568109">+</span><span class="num" id="5568110">1</span><span class="op" id="5568111">:</span><span class="op" id="5568112">]</span><br>
<span class="lineno"></span><span class="op" id="5568114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5568117">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5568164">func</span>&nbsp;<span class="ident" id="5568169">isIP</span><span class="op" id="5568173">(</span><span class="ident" id="5568174">host</span>&nbsp;<span class="builtintype" id="5568179">string</span><span class="op" id="5568185">)</span>&nbsp;<span class="builtintype" id="5568187">bool</span>&nbsp;<span class="op" id="5568192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568195">return</span>&nbsp;<span class="ident" id="5568202">net</span><span class="op" id="5568205">.</span><span class="ident" id="5568206">ParseIP</span><span class="op" id="5568213">(</span><span class="ident" id="5568214">host</span><span class="op" id="5568218">)</span>&nbsp;<span class="op" id="5568220">!=</span>&nbsp;<span class="ident" id="5568223">nil</span><br>
<span class="lineno"></span><span class="op" id="5568227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5568230">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5568302">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5568329">func</span>&nbsp;<span class="ident" id="5568334">defaultPath</span><span class="op" id="5568345">(</span><span class="ident" id="5568346">path</span>&nbsp;<span class="builtintype" id="5568351">string</span><span class="op" id="5568357">)</span>&nbsp;<span class="builtintype" id="5568359">string</span>&nbsp;<span class="op" id="5568366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568369">if</span>&nbsp;<span class="builtinfunc" id="5568372">len</span><span class="op" id="5568375">(</span><span class="ident" id="5568376">path</span><span class="op" id="5568380">)</span>&nbsp;<span class="op" id="5568382">==</span>&nbsp;<span class="num" id="5568385">0</span>&nbsp;<span class="op" id="5568387">||</span>&nbsp;<span class="ident" id="5568390">path</span><span class="op" id="5568394">[</span><span class="num" id="5568395">0</span><span class="op" id="5568396">]</span>&nbsp;<span class="op" id="5568398">!=</span>&nbsp;<span class="string" id="5568401">&#39;/&#39;</span>&nbsp;<span class="op" id="5568405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568409">return</span>&nbsp;<span class="string" id="5568416">&#34;/&#34;</span>&nbsp;<span class="comment" id="5568420">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568456">i</span>&nbsp;<span class="op" id="5568458">:=</span>&nbsp;<span class="ident" id="5568461">strings</span><span class="op" id="5568468">.</span><span class="ident" id="5568469">LastIndex</span><span class="op" id="5568478">(</span><span class="ident" id="5568479">path</span><span class="op" id="5568483">,</span>&nbsp;<span class="string" id="5568485">&#34;/&#34;</span><span class="op" id="5568488">)</span>&nbsp;<span class="comment" id="5568490">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568528">if</span>&nbsp;<span class="ident" id="5568531">i</span>&nbsp;<span class="op" id="5568533">==</span>&nbsp;<span class="num" id="5568536">0</span>&nbsp;<span class="op" id="5568538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568542">return</span>&nbsp;<span class="string" id="5568549">&#34;/&#34;</span>&nbsp;<span class="comment" id="5568553">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568586">return</span>&nbsp;<span class="ident" id="5568593">path</span><span class="op" id="5568597">[</span><span class="op" id="5568598">:</span><span class="ident" id="5568599">i</span><span class="op" id="5568600">]</span>&nbsp;<span class="comment" id="5568602">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5568655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5568658">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5568737">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5568818">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5568894">//</span><br>
<span class="lineno"></span><span class="comment" id="5568897">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5568976">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5569055">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5569126">//</span><br>
<span class="lineno"></span><span class="comment" id="5569129">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5569178">func</span>&nbsp;<span class="op" id="5569183">(</span><span class="ident" id="5569184">j</span>&nbsp;<span class="op" id="5569186">*</span><span class="ident" id="5569187">Jar</span><span class="op" id="5569190">)</span>&nbsp;<span class="ident" id="5569192">newEntry</span><span class="op" id="5569200">(</span><span class="ident" id="5569201">c</span>&nbsp;<span class="op" id="5569203">*</span><span class="ident" id="5569204">http</span><span class="op" id="5569208">.</span><span class="ident" id="5569209">Cookie</span><span class="op" id="5569215">,</span>&nbsp;<span class="ident" id="5569217">now</span>&nbsp;<span class="ident" id="5569221">time</span><span class="op" id="5569225">.</span><span class="ident" id="5569226">Time</span><span class="op" id="5569230">,</span>&nbsp;<span class="ident" id="5569232">defPath</span><span class="op" id="5569239">,</span>&nbsp;<span class="ident" id="5569241">host</span>&nbsp;<span class="builtintype" id="5569246">string</span><span class="op" id="5569252">)</span>&nbsp;<span class="op" id="5569254">(</span><span class="ident" id="5569255">e</span>&nbsp;<span class="ident" id="5569257">entry</span><span class="op" id="5569262">,</span>&nbsp;<span class="ident" id="5569264">remove</span>&nbsp;<span class="builtintype" id="5569271">bool</span><span class="op" id="5569275">,</span>&nbsp;<span class="ident" id="5569277">err</span>&nbsp;<span class="builtintype" id="5569281">error</span><span class="op" id="5569286">)</span>&nbsp;<span class="op" id="5569288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569291">e</span><span class="op" id="5569292">.</span><span class="ident" id="5569293">Name</span>&nbsp;<span class="op" id="5569298">=</span>&nbsp;<span class="ident" id="5569300">c</span><span class="op" id="5569301">.</span><span class="ident" id="5569302">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569309">if</span>&nbsp;<span class="ident" id="5569312">c</span><span class="op" id="5569313">.</span><span class="ident" id="5569314">Path</span>&nbsp;<span class="op" id="5569319">==</span>&nbsp;<span class="string" id="5569322">&#34;&#34;</span>&nbsp;<span class="op" id="5569325">||</span>&nbsp;<span class="ident" id="5569328">c</span><span class="op" id="5569329">.</span><span class="ident" id="5569330">Path</span><span class="op" id="5569334">[</span><span class="num" id="5569335">0</span><span class="op" id="5569336">]</span>&nbsp;<span class="op" id="5569338">!=</span>&nbsp;<span class="string" id="5569341">&#39;/&#39;</span>&nbsp;<span class="op" id="5569345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569349">e</span><span class="op" id="5569350">.</span><span class="ident" id="5569351">Path</span>&nbsp;<span class="op" id="5569356">=</span>&nbsp;<span class="ident" id="5569358">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569367">}</span>&nbsp;<span class="keyword" id="5569369">else</span>&nbsp;<span class="op" id="5569374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569378">e</span><span class="op" id="5569379">.</span><span class="ident" id="5569380">Path</span>&nbsp;<span class="op" id="5569385">=</span>&nbsp;<span class="ident" id="5569387">c</span><span class="op" id="5569388">.</span><span class="ident" id="5569389">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569399">e</span><span class="op" id="5569400">.</span><span class="ident" id="5569401">Domain</span><span class="op" id="5569407">,</span>&nbsp;<span class="ident" id="5569409">e</span><span class="op" id="5569410">.</span><span class="ident" id="5569411">HostOnly</span><span class="op" id="5569419">,</span>&nbsp;<span class="ident" id="5569421">err</span>&nbsp;<span class="op" id="5569425">=</span>&nbsp;<span class="ident" id="5569427">j</span><span class="op" id="5569428">.</span><span class="ident" id="5569429">domainAndType</span><span class="op" id="5569442">(</span><span class="ident" id="5569443">host</span><span class="op" id="5569447">,</span>&nbsp;<span class="ident" id="5569449">c</span><span class="op" id="5569450">.</span><span class="ident" id="5569451">Domain</span><span class="op" id="5569457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569460">if</span>&nbsp;<span class="ident" id="5569463">err</span>&nbsp;<span class="op" id="5569467">!=</span>&nbsp;<span class="ident" id="5569470">nil</span>&nbsp;<span class="op" id="5569474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569478">return</span>&nbsp;<span class="ident" id="5569485">e</span><span class="op" id="5569486">,</span>&nbsp;<span class="builtintype" id="5569488">false</span><span class="op" id="5569493">,</span>&nbsp;<span class="ident" id="5569495">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569504">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569546">if</span>&nbsp;<span class="ident" id="5569549">c</span><span class="op" id="5569550">.</span><span class="ident" id="5569551">MaxAge</span>&nbsp;<span class="op" id="5569558">&lt;</span>&nbsp;<span class="num" id="5569560">0</span>&nbsp;<span class="op" id="5569562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569566">return</span>&nbsp;<span class="ident" id="5569573">e</span><span class="op" id="5569574">,</span>&nbsp;<span class="builtintype" id="5569576">true</span><span class="op" id="5569580">,</span>&nbsp;<span class="ident" id="5569582">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569587">}</span>&nbsp;<span class="keyword" id="5569589">else</span>&nbsp;<span class="keyword" id="5569594">if</span>&nbsp;<span class="ident" id="5569597">c</span><span class="op" id="5569598">.</span><span class="ident" id="5569599">MaxAge</span>&nbsp;<span class="op" id="5569606">&gt;</span>&nbsp;<span class="num" id="5569608">0</span>&nbsp;<span class="op" id="5569610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569614">e</span><span class="op" id="5569615">.</span><span class="ident" id="5569616">Expires</span>&nbsp;<span class="op" id="5569624">=</span>&nbsp;<span class="ident" id="5569626">now</span><span class="op" id="5569629">.</span><span class="ident" id="5569630">Add</span><span class="op" id="5569633">(</span><span class="ident" id="5569634">time</span><span class="op" id="5569638">.</span><span class="ident" id="5569639">Duration</span><span class="op" id="5569647">(</span><span class="ident" id="5569648">c</span><span class="op" id="5569649">.</span><span class="ident" id="5569650">MaxAge</span><span class="op" id="5569656">)</span>&nbsp;<span class="op" id="5569658">*</span>&nbsp;<span class="ident" id="5569660">time</span><span class="op" id="5569664">.</span><span class="ident" id="5569665">Second</span><span class="op" id="5569671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569675">e</span><span class="op" id="5569676">.</span><span class="ident" id="5569677">Persistent</span>&nbsp;<span class="op" id="5569688">=</span>&nbsp;<span class="builtintype" id="5569690">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569696">}</span>&nbsp;<span class="keyword" id="5569698">else</span>&nbsp;<span class="op" id="5569703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569707">if</span>&nbsp;<span class="ident" id="5569710">c</span><span class="op" id="5569711">.</span><span class="ident" id="5569712">Expires</span><span class="op" id="5569719">.</span><span class="ident" id="5569720">IsZero</span><span class="op" id="5569726">(</span><span class="op" id="5569727">)</span>&nbsp;<span class="op" id="5569729">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569734">e</span><span class="op" id="5569735">.</span><span class="ident" id="5569736">Expires</span>&nbsp;<span class="op" id="5569744">=</span>&nbsp;<span class="ident" id="5569746">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569759">e</span><span class="op" id="5569760">.</span><span class="ident" id="5569761">Persistent</span>&nbsp;<span class="op" id="5569772">=</span>&nbsp;<span class="builtintype" id="5569774">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569782">}</span>&nbsp;<span class="keyword" id="5569784">else</span>&nbsp;<span class="op" id="5569789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569794">if</span>&nbsp;<span class="op" id="5569797">!</span><span class="ident" id="5569798">c</span><span class="op" id="5569799">.</span><span class="ident" id="5569800">Expires</span><span class="op" id="5569807">.</span><span class="ident" id="5569808">After</span><span class="op" id="5569813">(</span><span class="ident" id="5569814">now</span><span class="op" id="5569817">)</span>&nbsp;<span class="op" id="5569819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569825">return</span>&nbsp;<span class="ident" id="5569832">e</span><span class="op" id="5569833">,</span>&nbsp;<span class="builtintype" id="5569835">true</span><span class="op" id="5569839">,</span>&nbsp;<span class="ident" id="5569841">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569853">e</span><span class="op" id="5569854">.</span><span class="ident" id="5569855">Expires</span>&nbsp;<span class="op" id="5569863">=</span>&nbsp;<span class="ident" id="5569865">c</span><span class="op" id="5569866">.</span><span class="ident" id="5569867">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569878">e</span><span class="op" id="5569879">.</span><span class="ident" id="5569880">Persistent</span>&nbsp;<span class="op" id="5569891">=</span>&nbsp;<span class="builtintype" id="5569893">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569903">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569907">e</span><span class="op" id="5569908">.</span><span class="ident" id="5569909">Value</span>&nbsp;<span class="op" id="5569915">=</span>&nbsp;<span class="ident" id="5569917">c</span><span class="op" id="5569918">.</span><span class="ident" id="5569919">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569926">e</span><span class="op" id="5569927">.</span><span class="ident" id="5569928">Secure</span>&nbsp;<span class="op" id="5569935">=</span>&nbsp;<span class="ident" id="5569937">c</span><span class="op" id="5569938">.</span><span class="ident" id="5569939">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569947">e</span><span class="op" id="5569948">.</span><span class="ident" id="5569949">HttpOnly</span>&nbsp;<span class="op" id="5569958">=</span>&nbsp;<span class="ident" id="5569960">c</span><span class="op" id="5569961">.</span><span class="ident" id="5569962">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569973">return</span>&nbsp;<span class="ident" id="5569980">e</span><span class="op" id="5569981">,</span>&nbsp;<span class="builtintype" id="5569983">false</span><span class="op" id="5569988">,</span>&nbsp;<span class="ident" id="5569990">nil</span><br>
<span class="lineno"></span><span class="op" id="5569994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5569997">var</span>&nbsp;<span class="op" id="5570001">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570004">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5570023">=</span>&nbsp;<span class="ident" id="5570025">errors</span><span class="op" id="5570031">.</span><span class="ident" id="5570032">New</span><span class="op" id="5570035">(</span><span class="string" id="5570036">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5570080">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570083">errMalformedDomain</span>&nbsp;<span class="op" id="5570102">=</span>&nbsp;<span class="ident" id="5570104">errors</span><span class="op" id="5570110">.</span><span class="ident" id="5570111">New</span><span class="op" id="5570114">(</span><span class="string" id="5570115">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5570161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570164">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570183">=</span>&nbsp;<span class="ident" id="5570185">errors</span><span class="op" id="5570191">.</span><span class="ident" id="5570192">New</span><span class="op" id="5570195">(</span><span class="string" id="5570196">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5570241">)</span><br>
<span class="lineno"></span><span class="op" id="5570243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5570246">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5570317">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5570386">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5570445">var</span>&nbsp;<span class="ident" id="5570449">endOfTime</span>&nbsp;<span class="op" id="5570459">=</span>&nbsp;<span class="ident" id="5570461">time</span><span class="op" id="5570465">.</span><span class="ident" id="5570466">Date</span><span class="op" id="5570470">(</span><span class="num" id="5570471">9999</span><span class="op" id="5570475">,</span>&nbsp;<span class="num" id="5570477">12</span><span class="op" id="5570479">,</span>&nbsp;<span class="num" id="5570481">31</span><span class="op" id="5570483">,</span>&nbsp;<span class="num" id="5570485">23</span><span class="op" id="5570487">,</span>&nbsp;<span class="num" id="5570489">59</span><span class="op" id="5570491">,</span>&nbsp;<span class="num" id="5570493">59</span><span class="op" id="5570495">,</span>&nbsp;<span class="num" id="5570497">0</span><span class="op" id="5570498">,</span>&nbsp;<span class="ident" id="5570500">time</span><span class="op" id="5570504">.</span><span class="ident" id="5570505">UTC</span><span class="op" id="5570508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5570511">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5570583">func</span>&nbsp;<span class="op" id="5570588">(</span><span class="ident" id="5570589">j</span>&nbsp;<span class="op" id="5570591">*</span><span class="ident" id="5570592">Jar</span><span class="op" id="5570595">)</span>&nbsp;<span class="ident" id="5570597">domainAndType</span><span class="op" id="5570610">(</span><span class="ident" id="5570611">host</span><span class="op" id="5570615">,</span>&nbsp;<span class="ident" id="5570617">domain</span>&nbsp;<span class="builtintype" id="5570624">string</span><span class="op" id="5570630">)</span>&nbsp;<span class="op" id="5570632">(</span><span class="builtintype" id="5570633">string</span><span class="op" id="5570639">,</span>&nbsp;<span class="builtintype" id="5570641">bool</span><span class="op" id="5570645">,</span>&nbsp;<span class="builtintype" id="5570647">error</span><span class="op" id="5570652">)</span>&nbsp;<span class="op" id="5570654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570657">if</span>&nbsp;<span class="ident" id="5570660">domain</span>&nbsp;<span class="op" id="5570667">==</span>&nbsp;<span class="string" id="5570670">&#34;&#34;</span>&nbsp;<span class="op" id="5570673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570677">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570738">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570756">return</span>&nbsp;<span class="ident" id="5570763">host</span><span class="op" id="5570767">,</span>&nbsp;<span class="builtintype" id="5570769">true</span><span class="op" id="5570773">,</span>&nbsp;<span class="ident" id="5570775">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570784">if</span>&nbsp;<span class="ident" id="5570787">isIP</span><span class="op" id="5570791">(</span><span class="ident" id="5570792">host</span><span class="op" id="5570796">)</span>&nbsp;<span class="op" id="5570798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570802">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570864">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570884">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570940">return</span>&nbsp;<span class="string" id="5570947">&#34;&#34;</span><span class="op" id="5570949">,</span>&nbsp;<span class="builtintype" id="5570951">false</span><span class="op" id="5570956">,</span>&nbsp;<span class="ident" id="5570958">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570977">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571047">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571096">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571128">if</span>&nbsp;<span class="ident" id="5571131">domain</span><span class="op" id="5571137">[</span><span class="num" id="5571138">0</span><span class="op" id="5571139">]</span>&nbsp;<span class="op" id="5571141">==</span>&nbsp;<span class="string" id="5571144">&#39;.&#39;</span>&nbsp;<span class="op" id="5571148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571152">domain</span>&nbsp;<span class="op" id="5571159">=</span>&nbsp;<span class="ident" id="5571161">domain</span><span class="op" id="5571167">[</span><span class="num" id="5571168">1</span><span class="op" id="5571169">:</span><span class="op" id="5571170">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571173">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571177">if</span>&nbsp;<span class="builtinfunc" id="5571180">len</span><span class="op" id="5571183">(</span><span class="ident" id="5571184">domain</span><span class="op" id="5571190">)</span>&nbsp;<span class="op" id="5571192">==</span>&nbsp;<span class="num" id="5571195">0</span>&nbsp;<span class="op" id="5571197">||</span>&nbsp;<span class="ident" id="5571200">domain</span><span class="op" id="5571206">[</span><span class="num" id="5571207">0</span><span class="op" id="5571208">]</span>&nbsp;<span class="op" id="5571210">==</span>&nbsp;<span class="string" id="5571213">&#39;.&#39;</span>&nbsp;<span class="op" id="5571217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571221">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571279">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571302">return</span>&nbsp;<span class="string" id="5571309">&#34;&#34;</span><span class="op" id="5571311">,</span>&nbsp;<span class="builtintype" id="5571313">false</span><span class="op" id="5571318">,</span>&nbsp;<span class="ident" id="5571320">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571343">domain</span>&nbsp;<span class="op" id="5571350">=</span>&nbsp;<span class="ident" id="5571352">strings</span><span class="op" id="5571359">.</span><span class="ident" id="5571360">ToLower</span><span class="op" id="5571367">(</span><span class="ident" id="5571368">domain</span><span class="op" id="5571374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571378">if</span>&nbsp;<span class="ident" id="5571381">domain</span><span class="op" id="5571387">[</span><span class="builtinfunc" id="5571388">len</span><span class="op" id="5571391">(</span><span class="ident" id="5571392">domain</span><span class="op" id="5571398">)</span><span class="op" id="5571399">-</span><span class="num" id="5571400">1</span><span class="op" id="5571401">]</span>&nbsp;<span class="op" id="5571403">==</span>&nbsp;<span class="string" id="5571406">&#39;.&#39;</span>&nbsp;<span class="op" id="5571410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571414">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571469">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571531">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571594">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571650">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571712">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571730">return</span>&nbsp;<span class="string" id="5571737">&#34;&#34;</span><span class="op" id="5571739">,</span>&nbsp;<span class="builtintype" id="5571741">false</span><span class="op" id="5571746">,</span>&nbsp;<span class="ident" id="5571748">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571772">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571805">if</span>&nbsp;<span class="ident" id="5571808">j</span><span class="op" id="5571809">.</span><span class="ident" id="5571810">psList</span>&nbsp;<span class="op" id="5571817">!=</span>&nbsp;<span class="ident" id="5571820">nil</span>&nbsp;<span class="op" id="5571824">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571828">if</span>&nbsp;<span class="ident" id="5571831">ps</span>&nbsp;<span class="op" id="5571834">:=</span>&nbsp;<span class="ident" id="5571837">j</span><span class="op" id="5571838">.</span><span class="ident" id="5571839">psList</span><span class="op" id="5571845">.</span><span class="ident" id="5571846">PublicSuffix</span><span class="op" id="5571858">(</span><span class="ident" id="5571859">domain</span><span class="op" id="5571865">)</span><span class="op" id="5571866">;</span>&nbsp;<span class="ident" id="5571868">ps</span>&nbsp;<span class="op" id="5571871">!=</span>&nbsp;<span class="string" id="5571874">&#34;&#34;</span>&nbsp;<span class="op" id="5571877">&amp;&amp;</span>&nbsp;<span class="op" id="5571880">!</span><span class="ident" id="5571881">hasDotSuffix</span><span class="op" id="5571893">(</span><span class="ident" id="5571894">domain</span><span class="op" id="5571900">,</span>&nbsp;<span class="ident" id="5571902">ps</span><span class="op" id="5571904">)</span>&nbsp;<span class="op" id="5571906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571911">if</span>&nbsp;<span class="ident" id="5571914">host</span>&nbsp;<span class="op" id="5571919">==</span>&nbsp;<span class="ident" id="5571922">domain</span>&nbsp;<span class="op" id="5571929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571935">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571986">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572035">return</span>&nbsp;<span class="ident" id="5572042">host</span><span class="op" id="5572046">,</span>&nbsp;<span class="builtintype" id="5572048">true</span><span class="op" id="5572052">,</span>&nbsp;<span class="ident" id="5572054">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572066">return</span>&nbsp;<span class="string" id="5572073">&#34;&#34;</span><span class="op" id="5572075">,</span>&nbsp;<span class="builtintype" id="5572077">false</span><span class="op" id="5572082">,</span>&nbsp;<span class="ident" id="5572084">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572110">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572174">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572215">if</span>&nbsp;<span class="ident" id="5572218">host</span>&nbsp;<span class="op" id="5572223">!=</span>&nbsp;<span class="ident" id="5572226">domain</span>&nbsp;<span class="op" id="5572233">&amp;&amp;</span>&nbsp;<span class="op" id="5572236">!</span><span class="ident" id="5572237">hasDotSuffix</span><span class="op" id="5572249">(</span><span class="ident" id="5572250">host</span><span class="op" id="5572254">,</span>&nbsp;<span class="ident" id="5572256">domain</span><span class="op" id="5572262">)</span>&nbsp;<span class="op" id="5572264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572268">return</span>&nbsp;<span class="string" id="5572275">&#34;&#34;</span><span class="op" id="5572277">,</span>&nbsp;<span class="builtintype" id="5572279">false</span><span class="op" id="5572284">,</span>&nbsp;<span class="ident" id="5572286">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572304">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572308">return</span>&nbsp;<span class="ident" id="5572315">domain</span><span class="op" id="5572321">,</span>&nbsp;<span class="builtintype" id="5572323">false</span><span class="op" id="5572328">,</span>&nbsp;<span class="ident" id="5572330">nil</span><br>
<span class="lineno"></span><span class="op" id="5572334">}</span>
</div>
</body>
</html>
