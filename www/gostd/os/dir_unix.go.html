<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html" class="current">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2311341">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2311396">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2311450">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2311501">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2311571">package</span>&nbsp;<span class="ident" id="2311579">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2311583">import</span>&nbsp;<span class="op" id="2311590">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2311593">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2311599">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2311609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2311612">const</span>&nbsp;<span class="op" id="2311618">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311621">blockSize</span>&nbsp;<span class="op" id="2311631">=</span>&nbsp;<span class="num" id="2311633">4096</span><br>
<span class="lineno"></span><span class="op" id="2311638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2311641">func</span>&nbsp;<span class="op" id="2311646">(</span><span class="ident" id="2311647">f</span>&nbsp;<span class="op" id="2311649">*</span><span class="ident" id="2311650">File</span><span class="op" id="2311654">)</span>&nbsp;<span class="ident" id="2311656">readdirnames</span><span class="op" id="2311668">(</span><span class="ident" id="2311669">n</span>&nbsp;<span class="builtintype" id="2311671">int</span><span class="op" id="2311674">)</span>&nbsp;<span class="op" id="2311676">(</span><span class="ident" id="2311677">names</span>&nbsp;<span class="op" id="2311683">[</span><span class="op" id="2311684">]</span><span class="builtintype" id="2311685">string</span><span class="op" id="2311691">,</span>&nbsp;<span class="ident" id="2311693">err</span>&nbsp;<span class="builtintype" id="2311697">error</span><span class="op" id="2311702">)</span>&nbsp;<span class="op" id="2311704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2311707">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311752">if</span>&nbsp;<span class="ident" id="2311755">f</span><span class="op" id="2311756">.</span><span class="ident" id="2311757">dirinfo</span>&nbsp;<span class="op" id="2311765">==</span>&nbsp;<span class="ident" id="2311768">nil</span>&nbsp;<span class="op" id="2311772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311776">f</span><span class="op" id="2311777">.</span><span class="ident" id="2311778">dirinfo</span>&nbsp;<span class="op" id="2311786">=</span>&nbsp;<span class="builtinfunc" id="2311788">new</span><span class="op" id="2311791">(</span><span class="ident" id="2311792">dirInfo</span><span class="op" id="2311799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2311803">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311850">f</span><span class="op" id="2311851">.</span><span class="ident" id="2311852">dirinfo</span><span class="op" id="2311859">.</span><span class="ident" id="2311860">buf</span>&nbsp;<span class="op" id="2311864">=</span>&nbsp;<span class="builtinfunc" id="2311866">make</span><span class="op" id="2311870">(</span><span class="op" id="2311871">[</span><span class="op" id="2311872">]</span><span class="builtintype" id="2311873">byte</span><span class="op" id="2311877">,</span>&nbsp;<span class="ident" id="2311879">blockSize</span><span class="op" id="2311888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2311891">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311894">d</span>&nbsp;<span class="op" id="2311896">:=</span>&nbsp;<span class="ident" id="2311899">f</span><span class="op" id="2311900">.</span><span class="ident" id="2311901">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311911">size</span>&nbsp;<span class="op" id="2311916">:=</span>&nbsp;<span class="ident" id="2311919">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311922">if</span>&nbsp;<span class="ident" id="2311925">size</span>&nbsp;<span class="op" id="2311930">&lt;=</span>&nbsp;<span class="num" id="2311933">0</span>&nbsp;<span class="op" id="2311935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311939">size</span>&nbsp;<span class="op" id="2311944">=</span>&nbsp;<span class="num" id="2311946">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311952">n</span>&nbsp;<span class="op" id="2311954">=</span>&nbsp;<span class="op" id="2311956">-</span><span class="num" id="2311957">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2311960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311964">names</span>&nbsp;<span class="op" id="2311970">=</span>&nbsp;<span class="builtinfunc" id="2311972">make</span><span class="op" id="2311976">(</span><span class="op" id="2311977">[</span><span class="op" id="2311978">]</span><span class="builtintype" id="2311979">string</span><span class="op" id="2311985">,</span>&nbsp;<span class="num" id="2311987">0</span><span class="op" id="2311988">,</span>&nbsp;<span class="ident" id="2311990">size</span><span class="op" id="2311994">)</span>&nbsp;<span class="comment" id="2311996">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312025">for</span>&nbsp;<span class="ident" id="2312029">n</span>&nbsp;<span class="op" id="2312031">!=</span>&nbsp;<span class="num" id="2312034">0</span>&nbsp;<span class="op" id="2312036">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2312040">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312076">if</span>&nbsp;<span class="ident" id="2312079">d</span><span class="op" id="2312080">.</span><span class="ident" id="2312081">bufp</span>&nbsp;<span class="op" id="2312086">&gt;=</span>&nbsp;<span class="ident" id="2312089">d</span><span class="op" id="2312090">.</span><span class="ident" id="2312091">nbuf</span>&nbsp;<span class="op" id="2312096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312101">d</span><span class="op" id="2312102">.</span><span class="ident" id="2312103">bufp</span>&nbsp;<span class="op" id="2312108">=</span>&nbsp;<span class="num" id="2312110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312115">var</span>&nbsp;<span class="ident" id="2312119">errno</span>&nbsp;<span class="builtintype" id="2312125">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312134">d</span><span class="op" id="2312135">.</span><span class="ident" id="2312136">nbuf</span><span class="op" id="2312140">,</span>&nbsp;<span class="ident" id="2312142">errno</span>&nbsp;<span class="op" id="2312148">=</span>&nbsp;<span class="ident" id="2312150">fixCount</span><span class="op" id="2312158">(</span><span class="ident" id="2312159">syscall</span><span class="op" id="2312166">.</span><span class="ident" id="2312167">ReadDirent</span><span class="op" id="2312177">(</span><span class="ident" id="2312178">f</span><span class="op" id="2312179">.</span><span class="ident" id="2312180">fd</span><span class="op" id="2312182">,</span>&nbsp;<span class="ident" id="2312184">d</span><span class="op" id="2312185">.</span><span class="ident" id="2312186">buf</span><span class="op" id="2312189">)</span><span class="op" id="2312190">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312195">if</span>&nbsp;<span class="ident" id="2312198">errno</span>&nbsp;<span class="op" id="2312204">!=</span>&nbsp;<span class="ident" id="2312207">nil</span>&nbsp;<span class="op" id="2312211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312217">return</span>&nbsp;<span class="ident" id="2312224">names</span><span class="op" id="2312229">,</span>&nbsp;<span class="ident" id="2312231">NewSyscallError</span><span class="op" id="2312246">(</span><span class="string" id="2312247">&#34;readdirent&#34;</span><span class="op" id="2312259">,</span>&nbsp;<span class="ident" id="2312261">errno</span><span class="op" id="2312266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312276">if</span>&nbsp;<span class="ident" id="2312279">d</span><span class="op" id="2312280">.</span><span class="ident" id="2312281">nbuf</span>&nbsp;<span class="op" id="2312286">&lt;=</span>&nbsp;<span class="num" id="2312289">0</span>&nbsp;<span class="op" id="2312291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312297">break</span>&nbsp;<span class="comment" id="2312303">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2312322">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312344">var</span>&nbsp;<span class="ident" id="2312348">nb</span><span class="op" id="2312350">,</span>&nbsp;<span class="ident" id="2312352">nc</span>&nbsp;<span class="builtintype" id="2312355">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312361">nb</span><span class="op" id="2312363">,</span>&nbsp;<span class="ident" id="2312365">nc</span><span class="op" id="2312367">,</span>&nbsp;<span class="ident" id="2312369">names</span>&nbsp;<span class="op" id="2312375">=</span>&nbsp;<span class="ident" id="2312377">syscall</span><span class="op" id="2312384">.</span><span class="ident" id="2312385">ParseDirent</span><span class="op" id="2312396">(</span><span class="ident" id="2312397">d</span><span class="op" id="2312398">.</span><span class="ident" id="2312399">buf</span><span class="op" id="2312402">[</span><span class="ident" id="2312403">d</span><span class="op" id="2312404">.</span><span class="ident" id="2312405">bufp</span><span class="op" id="2312409">:</span><span class="ident" id="2312410">d</span><span class="op" id="2312411">.</span><span class="ident" id="2312412">nbuf</span><span class="op" id="2312416">]</span><span class="op" id="2312417">,</span>&nbsp;<span class="ident" id="2312419">n</span><span class="op" id="2312420">,</span>&nbsp;<span class="ident" id="2312422">names</span><span class="op" id="2312427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312431">d</span><span class="op" id="2312432">.</span><span class="ident" id="2312433">bufp</span>&nbsp;<span class="op" id="2312438">+=</span>&nbsp;<span class="ident" id="2312441">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312446">n</span>&nbsp;<span class="op" id="2312448">-=</span>&nbsp;<span class="ident" id="2312451">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312458">if</span>&nbsp;<span class="ident" id="2312461">n</span>&nbsp;<span class="op" id="2312463">&gt;=</span>&nbsp;<span class="num" id="2312466">0</span>&nbsp;<span class="op" id="2312468">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2312471">len</span><span class="op" id="2312474">(</span><span class="ident" id="2312475">names</span><span class="op" id="2312480">)</span>&nbsp;<span class="op" id="2312482">==</span>&nbsp;<span class="num" id="2312485">0</span>&nbsp;<span class="op" id="2312487">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312491">return</span>&nbsp;<span class="ident" id="2312498">names</span><span class="op" id="2312503">,</span>&nbsp;<span class="ident" id="2312505">io</span><span class="op" id="2312507">.</span><span class="ident" id="2312508">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312516">return</span>&nbsp;<span class="ident" id="2312523">names</span><span class="op" id="2312528">,</span>&nbsp;<span class="ident" id="2312530">nil</span><br>
<span class="lineno"></span><span class="op" id="2312534">}</span>
</div>
</body>
</html>
