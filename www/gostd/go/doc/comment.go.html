<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html" class="current">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5083660">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5083715">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5083769">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5083820">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5083881">package</span>&nbsp;<span class="ident" id="5083889">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5083894">import</span>&nbsp;<span class="op" id="5083901">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083904">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083910">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083920">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083931">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5083947">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083966">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083977">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5083992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5083995">var</span>&nbsp;<span class="op" id="5083999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084002">ldquo</span>&nbsp;<span class="op" id="5084008">=</span>&nbsp;<span class="op" id="5084010">[</span><span class="op" id="5084011">]</span><span class="builtintype" id="5084012">byte</span><span class="op" id="5084016">(</span><span class="string" id="5084017">&#34;&amp;ldquo;&#34;</span><span class="op" id="5084026">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084029">rdquo</span>&nbsp;<span class="op" id="5084035">=</span>&nbsp;<span class="op" id="5084037">[</span><span class="op" id="5084038">]</span><span class="builtintype" id="5084039">byte</span><span class="op" id="5084043">(</span><span class="string" id="5084044">&#34;&amp;rdquo;&#34;</span><span class="op" id="5084053">)</span><br>
<span class="lineno"></span><span class="op" id="5084055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5084058">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5084107">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5084157">func</span>&nbsp;<span class="ident" id="5084162">commentEscape</span><span class="op" id="5084175">(</span><span class="ident" id="5084176">w</span>&nbsp;<span class="ident" id="5084178">io</span><span class="op" id="5084180">.</span><span class="ident" id="5084181">Writer</span><span class="op" id="5084187">,</span>&nbsp;<span class="ident" id="5084189">text</span>&nbsp;<span class="builtintype" id="5084194">string</span><span class="op" id="5084200">,</span>&nbsp;<span class="ident" id="5084202">nice</span>&nbsp;<span class="builtintype" id="5084207">bool</span><span class="op" id="5084211">)</span>&nbsp;<span class="op" id="5084213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084216">last</span>&nbsp;<span class="op" id="5084221">:=</span>&nbsp;<span class="num" id="5084224">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084227">if</span>&nbsp;<span class="ident" id="5084230">nice</span>&nbsp;<span class="op" id="5084235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084239">for</span>&nbsp;<span class="ident" id="5084243">i</span>&nbsp;<span class="op" id="5084245">:=</span>&nbsp;<span class="num" id="5084248">0</span><span class="op" id="5084249">;</span>&nbsp;<span class="ident" id="5084251">i</span>&nbsp;<span class="op" id="5084253">&lt;</span>&nbsp;<span class="builtinfunc" id="5084255">len</span><span class="op" id="5084258">(</span><span class="ident" id="5084259">text</span><span class="op" id="5084263">)</span><span class="op" id="5084264">-</span><span class="num" id="5084265">1</span><span class="op" id="5084266">;</span>&nbsp;<span class="ident" id="5084268">i</span><span class="op" id="5084269">++</span>&nbsp;<span class="op" id="5084272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084277">ch</span>&nbsp;<span class="op" id="5084280">:=</span>&nbsp;<span class="ident" id="5084283">text</span><span class="op" id="5084287">[</span><span class="ident" id="5084288">i</span><span class="op" id="5084289">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084294">if</span>&nbsp;<span class="ident" id="5084297">ch</span>&nbsp;<span class="op" id="5084300">==</span>&nbsp;<span class="ident" id="5084303">text</span><span class="op" id="5084307">[</span><span class="ident" id="5084308">i</span><span class="op" id="5084309">+</span><span class="num" id="5084310">1</span><span class="op" id="5084311">]</span>&nbsp;<span class="op" id="5084313">&amp;&amp;</span>&nbsp;<span class="op" id="5084316">(</span><span class="ident" id="5084317">ch</span>&nbsp;<span class="op" id="5084320">==</span>&nbsp;<span class="string" id="5084323">&#39;`&#39;</span>&nbsp;<span class="op" id="5084327">||</span>&nbsp;<span class="ident" id="5084330">ch</span>&nbsp;<span class="op" id="5084333">==</span>&nbsp;<span class="string" id="5084336">&#39;\&#39;&#39;</span><span class="op" id="5084340">)</span>&nbsp;<span class="op" id="5084342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084348">template</span><span class="op" id="5084356">.</span><span class="ident" id="5084357">HTMLEscape</span><span class="op" id="5084367">(</span><span class="ident" id="5084368">w</span><span class="op" id="5084369">,</span>&nbsp;<span class="op" id="5084371">[</span><span class="op" id="5084372">]</span><span class="builtintype" id="5084373">byte</span><span class="op" id="5084377">(</span><span class="ident" id="5084378">text</span><span class="op" id="5084382">[</span><span class="ident" id="5084383">last</span><span class="op" id="5084387">:</span><span class="ident" id="5084388">i</span><span class="op" id="5084389">]</span><span class="op" id="5084390">)</span><span class="op" id="5084391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084397">last</span>&nbsp;<span class="op" id="5084402">=</span>&nbsp;<span class="ident" id="5084404">i</span>&nbsp;<span class="op" id="5084406">+</span>&nbsp;<span class="num" id="5084408">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084414">switch</span>&nbsp;<span class="ident" id="5084421">ch</span>&nbsp;<span class="op" id="5084424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084430">case</span>&nbsp;<span class="string" id="5084435">&#39;`&#39;</span><span class="op" id="5084438">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084445">w</span><span class="op" id="5084446">.</span><span class="ident" id="5084447">Write</span><span class="op" id="5084452">(</span><span class="ident" id="5084453">ldquo</span><span class="op" id="5084458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084464">case</span>&nbsp;<span class="string" id="5084469">&#39;\&#39;&#39;</span><span class="op" id="5084473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084480">w</span><span class="op" id="5084481">.</span><span class="ident" id="5084482">Write</span><span class="op" id="5084487">(</span><span class="ident" id="5084488">rdquo</span><span class="op" id="5084493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084505">i</span><span class="op" id="5084506">++</span>&nbsp;<span class="comment" id="5084509">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084548">template</span><span class="op" id="5084556">.</span><span class="ident" id="5084557">HTMLEscape</span><span class="op" id="5084567">(</span><span class="ident" id="5084568">w</span><span class="op" id="5084569">,</span>&nbsp;<span class="op" id="5084571">[</span><span class="op" id="5084572">]</span><span class="builtintype" id="5084573">byte</span><span class="op" id="5084577">(</span><span class="ident" id="5084578">text</span><span class="op" id="5084582">[</span><span class="ident" id="5084583">last</span><span class="op" id="5084587">:</span><span class="op" id="5084588">]</span><span class="op" id="5084589">)</span><span class="op" id="5084590">)</span><br>
<span class="lineno"></span><span class="op" id="5084592">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5084595">const</span>&nbsp;<span class="op" id="5084601">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084604">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084634">identRx</span>&nbsp;<span class="op" id="5084642">=</span>&nbsp;<span class="string" id="5084644">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084665">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084685">protocol</span>&nbsp;<span class="op" id="5084694">=</span>&nbsp;<span class="string" id="5084696">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084760">hostPart</span>&nbsp;<span class="op" id="5084769">=</span>&nbsp;<span class="string" id="5084771">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084791">filePart</span>&nbsp;<span class="op" id="5084800">=</span>&nbsp;<span class="string" id="5084802">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5084830">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084893">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084902">=</span>&nbsp;<span class="string" id="5084904">`(`</span>&nbsp;<span class="op" id="5084908">+</span>&nbsp;<span class="ident" id="5084910">protocol</span>&nbsp;<span class="op" id="5084919">+</span>&nbsp;<span class="string" id="5084921">`)://`</span>&nbsp;<span class="op" id="5084928">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5084932">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084945">hostPart</span>&nbsp;<span class="op" id="5084954">+</span>&nbsp;<span class="string" id="5084956">`([.:]`</span>&nbsp;<span class="op" id="5084964">+</span>&nbsp;<span class="ident" id="5084966">hostPart</span>&nbsp;<span class="op" id="5084975">+</span>&nbsp;<span class="string" id="5084977">`)*/?`</span>&nbsp;<span class="op" id="5084984">+</span>&nbsp;<span class="comment" id="5084986">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085014">filePart</span>&nbsp;<span class="op" id="5085023">+</span>&nbsp;<span class="string" id="5085025">`([:.,]`</span>&nbsp;<span class="op" id="5085034">+</span>&nbsp;<span class="ident" id="5085036">filePart</span>&nbsp;<span class="op" id="5085045">+</span>&nbsp;<span class="string" id="5085047">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5085052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5085055">var</span>&nbsp;<span class="ident" id="5085059">matchRx</span>&nbsp;<span class="op" id="5085067">=</span>&nbsp;<span class="ident" id="5085069">regexp</span><span class="op" id="5085075">.</span><span class="ident" id="5085076">MustCompile</span><span class="op" id="5085087">(</span><span class="string" id="5085088">`(`</span>&nbsp;<span class="op" id="5085092">+</span>&nbsp;<span class="ident" id="5085094">urlRx</span>&nbsp;<span class="op" id="5085100">+</span>&nbsp;<span class="string" id="5085102">`)|(`</span>&nbsp;<span class="op" id="5085108">+</span>&nbsp;<span class="ident" id="5085110">identRx</span>&nbsp;<span class="op" id="5085118">+</span>&nbsp;<span class="string" id="5085120">`)`</span><span class="op" id="5085123">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5085126">var</span>&nbsp;<span class="op" id="5085130">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085133">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085145">=</span>&nbsp;<span class="op" id="5085147">[</span><span class="op" id="5085148">]</span><span class="builtintype" id="5085149">byte</span><span class="op" id="5085153">(</span><span class="string" id="5085154">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5085165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085168">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085180">=</span>&nbsp;<span class="op" id="5085182">[</span><span class="op" id="5085183">]</span><span class="builtintype" id="5085184">byte</span><span class="op" id="5085188">(</span><span class="string" id="5085189">`&#34;&gt;`</span><span class="op" id="5085193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085196">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5085208">=</span>&nbsp;<span class="op" id="5085210">[</span><span class="op" id="5085211">]</span><span class="builtintype" id="5085212">byte</span><span class="op" id="5085216">(</span><span class="string" id="5085217">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5085223">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085226">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085238">=</span>&nbsp;<span class="op" id="5085240">[</span><span class="op" id="5085241">]</span><span class="builtintype" id="5085242">byte</span><span class="op" id="5085246">(</span><span class="string" id="5085247">&#34;&lt;i&gt;&#34;</span><span class="op" id="5085252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085255">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5085267">=</span>&nbsp;<span class="op" id="5085269">[</span><span class="op" id="5085270">]</span><span class="builtintype" id="5085271">byte</span><span class="op" id="5085275">(</span><span class="string" id="5085276">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5085282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085285">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085297">=</span>&nbsp;<span class="op" id="5085299">[</span><span class="op" id="5085300">]</span><span class="builtintype" id="5085301">byte</span><span class="op" id="5085305">(</span><span class="string" id="5085306">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5085313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085316">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5085328">=</span>&nbsp;<span class="op" id="5085330">[</span><span class="op" id="5085331">]</span><span class="builtintype" id="5085332">byte</span><span class="op" id="5085336">(</span><span class="string" id="5085337">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5085345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085348">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085360">=</span>&nbsp;<span class="op" id="5085362">[</span><span class="op" id="5085363">]</span><span class="builtintype" id="5085364">byte</span><span class="op" id="5085368">(</span><span class="string" id="5085369">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5085376">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085379">html_endpre</span>&nbsp;<span class="op" id="5085391">=</span>&nbsp;<span class="op" id="5085393">[</span><span class="op" id="5085394">]</span><span class="builtintype" id="5085395">byte</span><span class="op" id="5085399">(</span><span class="string" id="5085400">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5085410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085413">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085425">=</span>&nbsp;<span class="op" id="5085427">[</span><span class="op" id="5085428">]</span><span class="builtintype" id="5085429">byte</span><span class="op" id="5085433">(</span><span class="string" id="5085434">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5085444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085447">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085459">=</span>&nbsp;<span class="op" id="5085461">[</span><span class="op" id="5085462">]</span><span class="builtintype" id="5085463">byte</span><span class="op" id="5085467">(</span><span class="string" id="5085468">`&#34;&gt;`</span><span class="op" id="5085472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085475">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5085487">=</span>&nbsp;<span class="op" id="5085489">[</span><span class="op" id="5085490">]</span><span class="builtintype" id="5085491">byte</span><span class="op" id="5085495">(</span><span class="string" id="5085496">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5085505">)</span><br>
<span class="lineno"></span><span class="op" id="5085507">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5085510">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5085612">func</span>&nbsp;<span class="ident" id="5085617">pairedParensPrefixLen</span><span class="op" id="5085638">(</span><span class="ident" id="5085639">s</span>&nbsp;<span class="builtintype" id="5085641">string</span><span class="op" id="5085647">)</span>&nbsp;<span class="builtintype" id="5085649">int</span>&nbsp;<span class="op" id="5085653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085656">parens</span>&nbsp;<span class="op" id="5085663">:=</span>&nbsp;<span class="num" id="5085666">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085669">l</span>&nbsp;<span class="op" id="5085671">:=</span>&nbsp;<span class="builtinfunc" id="5085674">len</span><span class="op" id="5085677">(</span><span class="ident" id="5085678">s</span><span class="op" id="5085679">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085682">for</span>&nbsp;<span class="ident" id="5085686">i</span><span class="op" id="5085687">,</span>&nbsp;<span class="ident" id="5085689">ch</span>&nbsp;<span class="op" id="5085692">:=</span>&nbsp;<span class="keyword" id="5085695">range</span>&nbsp;<span class="ident" id="5085701">s</span>&nbsp;<span class="op" id="5085703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085707">switch</span>&nbsp;<span class="ident" id="5085714">ch</span>&nbsp;<span class="op" id="5085717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085721">case</span>&nbsp;<span class="string" id="5085726">&#39;(&#39;</span><span class="op" id="5085729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085734">if</span>&nbsp;<span class="ident" id="5085737">parens</span>&nbsp;<span class="op" id="5085744">==</span>&nbsp;<span class="num" id="5085747">0</span>&nbsp;<span class="op" id="5085749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085755">l</span>&nbsp;<span class="op" id="5085757">=</span>&nbsp;<span class="ident" id="5085759">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085769">parens</span><span class="op" id="5085775">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085780">case</span>&nbsp;<span class="string" id="5085785">&#39;)&#39;</span><span class="op" id="5085788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085793">parens</span><span class="op" id="5085799">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085805">if</span>&nbsp;<span class="ident" id="5085808">parens</span>&nbsp;<span class="op" id="5085815">==</span>&nbsp;<span class="num" id="5085818">0</span>&nbsp;<span class="op" id="5085820">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085826">l</span>&nbsp;<span class="op" id="5085828">=</span>&nbsp;<span class="builtinfunc" id="5085830">len</span><span class="op" id="5085833">(</span><span class="ident" id="5085834">s</span><span class="op" id="5085835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085840">}</span>&nbsp;<span class="keyword" id="5085842">else</span>&nbsp;<span class="keyword" id="5085847">if</span>&nbsp;<span class="ident" id="5085850">parens</span>&nbsp;<span class="op" id="5085857">&lt;</span>&nbsp;<span class="num" id="5085859">0</span>&nbsp;<span class="op" id="5085861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085867">return</span>&nbsp;<span class="ident" id="5085874">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085883">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085889">return</span>&nbsp;<span class="ident" id="5085896">l</span><br>
<span class="lineno"></span><span class="op" id="5085898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5085901">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5085981">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5086061">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5086138">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5086218">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5086297">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5086376">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5086456">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5086481">func</span>&nbsp;<span class="ident" id="5086486">emphasize</span><span class="op" id="5086495">(</span><span class="ident" id="5086496">w</span>&nbsp;<span class="ident" id="5086498">io</span><span class="op" id="5086500">.</span><span class="ident" id="5086501">Writer</span><span class="op" id="5086507">,</span>&nbsp;<span class="ident" id="5086509">line</span>&nbsp;<span class="builtintype" id="5086514">string</span><span class="op" id="5086520">,</span>&nbsp;<span class="ident" id="5086522">words</span>&nbsp;<span class="keyword" id="5086528">map</span><span class="op" id="5086531">[</span><span class="builtintype" id="5086532">string</span><span class="op" id="5086538">]</span><span class="builtintype" id="5086539">string</span><span class="op" id="5086545">,</span>&nbsp;<span class="ident" id="5086547">nice</span>&nbsp;<span class="builtintype" id="5086552">bool</span><span class="op" id="5086556">)</span>&nbsp;<span class="op" id="5086558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086561">for</span>&nbsp;<span class="op" id="5086565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086569">m</span>&nbsp;<span class="op" id="5086571">:=</span>&nbsp;<span class="ident" id="5086574">matchRx</span><span class="op" id="5086581">.</span><span class="ident" id="5086582">FindStringSubmatchIndex</span><span class="op" id="5086605">(</span><span class="ident" id="5086606">line</span><span class="op" id="5086610">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086614">if</span>&nbsp;<span class="ident" id="5086617">m</span>&nbsp;<span class="op" id="5086619">==</span>&nbsp;<span class="builtintype" id="5086622">nil</span>&nbsp;<span class="op" id="5086626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086631">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086643">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086717">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086746">commentEscape</span><span class="op" id="5086759">(</span><span class="ident" id="5086760">w</span><span class="op" id="5086761">,</span>&nbsp;<span class="ident" id="5086763">line</span><span class="op" id="5086767">[</span><span class="num" id="5086768">0</span><span class="op" id="5086769">:</span><span class="ident" id="5086770">m</span><span class="op" id="5086771">[</span><span class="num" id="5086772">0</span><span class="op" id="5086773">]</span><span class="op" id="5086774">]</span><span class="op" id="5086775">,</span>&nbsp;<span class="ident" id="5086777">nice</span><span class="op" id="5086781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086786">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086817">match</span>&nbsp;<span class="op" id="5086823">:=</span>&nbsp;<span class="ident" id="5086826">line</span><span class="op" id="5086830">[</span><span class="ident" id="5086831">m</span><span class="op" id="5086832">[</span><span class="num" id="5086833">0</span><span class="op" id="5086834">]</span><span class="op" id="5086835">:</span><span class="ident" id="5086836">m</span><span class="op" id="5086837">[</span><span class="num" id="5086838">1</span><span class="op" id="5086839">]</span><span class="op" id="5086840">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086844">if</span>&nbsp;<span class="ident" id="5086847">n</span>&nbsp;<span class="op" id="5086849">:=</span>&nbsp;<span class="ident" id="5086852">pairedParensPrefixLen</span><span class="op" id="5086873">(</span><span class="ident" id="5086874">match</span><span class="op" id="5086879">)</span><span class="op" id="5086880">;</span>&nbsp;<span class="ident" id="5086882">n</span>&nbsp;<span class="op" id="5086884">&lt;</span>&nbsp;<span class="builtinfunc" id="5086886">len</span><span class="op" id="5086889">(</span><span class="ident" id="5086890">match</span><span class="op" id="5086895">)</span>&nbsp;<span class="op" id="5086897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086902">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086952">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087012">m</span>&nbsp;<span class="op" id="5087014">=</span>&nbsp;<span class="ident" id="5087016">matchRx</span><span class="op" id="5087023">.</span><span class="ident" id="5087024">FindStringSubmatchIndex</span><span class="op" id="5087047">(</span><span class="ident" id="5087048">line</span><span class="op" id="5087052">[</span><span class="op" id="5087053">:</span><span class="ident" id="5087054">m</span><span class="op" id="5087055">[</span><span class="num" id="5087056">0</span><span class="op" id="5087057">]</span><span class="op" id="5087058">+</span><span class="ident" id="5087059">n</span><span class="op" id="5087060">]</span><span class="op" id="5087061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087066">match</span>&nbsp;<span class="op" id="5087072">=</span>&nbsp;<span class="ident" id="5087074">match</span><span class="op" id="5087079">[</span><span class="op" id="5087080">:</span><span class="ident" id="5087081">n</span><span class="op" id="5087082">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087091">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087110">url</span>&nbsp;<span class="op" id="5087114">:=</span>&nbsp;<span class="string" id="5087117">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087122">italics</span>&nbsp;<span class="op" id="5087130">:=</span>&nbsp;<span class="builtintype" id="5087133">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087141">if</span>&nbsp;<span class="ident" id="5087144">words</span>&nbsp;<span class="op" id="5087150">!=</span>&nbsp;<span class="builtintype" id="5087153">nil</span>&nbsp;<span class="op" id="5087157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087162">url</span><span class="op" id="5087165">,</span>&nbsp;<span class="ident" id="5087167">italics</span>&nbsp;<span class="op" id="5087175">=</span>&nbsp;<span class="ident" id="5087177">words</span><span class="op" id="5087182">[</span><span class="ident" id="5087183">match</span><span class="op" id="5087188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087196">if</span>&nbsp;<span class="ident" id="5087199">m</span><span class="op" id="5087200">[</span><span class="num" id="5087201">2</span><span class="op" id="5087202">]</span>&nbsp;<span class="op" id="5087204">&gt;=</span>&nbsp;<span class="num" id="5087207">0</span>&nbsp;<span class="op" id="5087209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087214">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087294">if</span>&nbsp;<span class="op" id="5087297">!</span><span class="ident" id="5087298">italics</span>&nbsp;<span class="op" id="5087306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087312">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087371">url</span>&nbsp;<span class="op" id="5087375">=</span>&nbsp;<span class="ident" id="5087377">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087391">italics</span>&nbsp;<span class="op" id="5087399">=</span>&nbsp;<span class="builtintype" id="5087401">false</span>&nbsp;<span class="comment" id="5087407">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087438">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087455">if</span>&nbsp;<span class="builtinfunc" id="5087458">len</span><span class="op" id="5087461">(</span><span class="ident" id="5087462">url</span><span class="op" id="5087465">)</span>&nbsp;<span class="op" id="5087467">&gt;</span>&nbsp;<span class="num" id="5087469">0</span>&nbsp;<span class="op" id="5087471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087476">w</span><span class="op" id="5087477">.</span><span class="ident" id="5087478">Write</span><span class="op" id="5087483">(</span><span class="ident" id="5087484">html_a</span><span class="op" id="5087490">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087495">template</span><span class="op" id="5087503">.</span><span class="ident" id="5087504">HTMLEscape</span><span class="op" id="5087514">(</span><span class="ident" id="5087515">w</span><span class="op" id="5087516">,</span>&nbsp;<span class="op" id="5087518">[</span><span class="op" id="5087519">]</span><span class="builtintype" id="5087520">byte</span><span class="op" id="5087524">(</span><span class="ident" id="5087525">url</span><span class="op" id="5087528">)</span><span class="op" id="5087529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087534">w</span><span class="op" id="5087535">.</span><span class="ident" id="5087536">Write</span><span class="op" id="5087541">(</span><span class="ident" id="5087542">html_aq</span><span class="op" id="5087549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087557">if</span>&nbsp;<span class="ident" id="5087560">italics</span>&nbsp;<span class="op" id="5087568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087573">w</span><span class="op" id="5087574">.</span><span class="ident" id="5087575">Write</span><span class="op" id="5087580">(</span><span class="ident" id="5087581">html_i</span><span class="op" id="5087587">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087595">commentEscape</span><span class="op" id="5087608">(</span><span class="ident" id="5087609">w</span><span class="op" id="5087610">,</span>&nbsp;<span class="ident" id="5087612">match</span><span class="op" id="5087617">,</span>&nbsp;<span class="ident" id="5087619">nice</span><span class="op" id="5087623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087627">if</span>&nbsp;<span class="ident" id="5087630">italics</span>&nbsp;<span class="op" id="5087638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087643">w</span><span class="op" id="5087644">.</span><span class="ident" id="5087645">Write</span><span class="op" id="5087650">(</span><span class="ident" id="5087651">html_endi</span><span class="op" id="5087660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087664">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087668">if</span>&nbsp;<span class="builtinfunc" id="5087671">len</span><span class="op" id="5087674">(</span><span class="ident" id="5087675">url</span><span class="op" id="5087678">)</span>&nbsp;<span class="op" id="5087680">&gt;</span>&nbsp;<span class="num" id="5087682">0</span>&nbsp;<span class="op" id="5087684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087689">w</span><span class="op" id="5087690">.</span><span class="ident" id="5087691">Write</span><span class="op" id="5087696">(</span><span class="ident" id="5087697">html_enda</span><span class="op" id="5087706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087715">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087728">line</span>&nbsp;<span class="op" id="5087733">=</span>&nbsp;<span class="ident" id="5087735">line</span><span class="op" id="5087739">[</span><span class="ident" id="5087740">m</span><span class="op" id="5087741">[</span><span class="num" id="5087742">1</span><span class="op" id="5087743">]</span><span class="op" id="5087744">:</span><span class="op" id="5087745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087751">commentEscape</span><span class="op" id="5087764">(</span><span class="ident" id="5087765">w</span><span class="op" id="5087766">,</span>&nbsp;<span class="ident" id="5087768">line</span><span class="op" id="5087772">,</span>&nbsp;<span class="ident" id="5087774">nice</span><span class="op" id="5087778">)</span><br>
<span class="lineno"></span><span class="op" id="5087780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5087783">func</span>&nbsp;<span class="ident" id="5087788">indentLen</span><span class="op" id="5087797">(</span><span class="ident" id="5087798">s</span>&nbsp;<span class="builtintype" id="5087800">string</span><span class="op" id="5087806">)</span>&nbsp;<span class="builtintype" id="5087808">int</span>&nbsp;<span class="op" id="5087812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087815">i</span>&nbsp;<span class="op" id="5087817">:=</span>&nbsp;<span class="num" id="5087820">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087823">for</span>&nbsp;<span class="ident" id="5087827">i</span>&nbsp;<span class="op" id="5087829">&lt;</span>&nbsp;<span class="builtinfunc" id="5087831">len</span><span class="op" id="5087834">(</span><span class="ident" id="5087835">s</span><span class="op" id="5087836">)</span>&nbsp;<span class="op" id="5087838">&amp;&amp;</span>&nbsp;<span class="op" id="5087841">(</span><span class="ident" id="5087842">s</span><span class="op" id="5087843">[</span><span class="ident" id="5087844">i</span><span class="op" id="5087845">]</span>&nbsp;<span class="op" id="5087847">==</span>&nbsp;<span class="string" id="5087850">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5087854">||</span>&nbsp;<span class="ident" id="5087857">s</span><span class="op" id="5087858">[</span><span class="ident" id="5087859">i</span><span class="op" id="5087860">]</span>&nbsp;<span class="op" id="5087862">==</span>&nbsp;<span class="string" id="5087865">&#39;\t&#39;</span><span class="op" id="5087869">)</span>&nbsp;<span class="op" id="5087871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087875">i</span><span class="op" id="5087876">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087880">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087883">return</span>&nbsp;<span class="ident" id="5087890">i</span><br>
<span class="lineno"></span><span class="op" id="5087892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087895">func</span>&nbsp;<span class="ident" id="5087900">isBlank</span><span class="op" id="5087907">(</span><span class="ident" id="5087908">s</span>&nbsp;<span class="builtintype" id="5087910">string</span><span class="op" id="5087916">)</span>&nbsp;<span class="builtintype" id="5087918">bool</span>&nbsp;<span class="op" id="5087923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087926">return</span>&nbsp;<span class="builtinfunc" id="5087933">len</span><span class="op" id="5087936">(</span><span class="ident" id="5087937">s</span><span class="op" id="5087938">)</span>&nbsp;<span class="op" id="5087940">==</span>&nbsp;<span class="num" id="5087943">0</span>&nbsp;<span class="op" id="5087945">||</span>&nbsp;<span class="op" id="5087948">(</span><span class="builtinfunc" id="5087949">len</span><span class="op" id="5087952">(</span><span class="ident" id="5087953">s</span><span class="op" id="5087954">)</span>&nbsp;<span class="op" id="5087956">==</span>&nbsp;<span class="num" id="5087959">1</span>&nbsp;<span class="op" id="5087961">&amp;&amp;</span>&nbsp;<span class="ident" id="5087964">s</span><span class="op" id="5087965">[</span><span class="num" id="5087966">0</span><span class="op" id="5087967">]</span>&nbsp;<span class="op" id="5087969">==</span>&nbsp;<span class="string" id="5087972">&#39;\n&#39;</span><span class="op" id="5087976">)</span><br>
<span class="lineno">175</span><span class="op" id="5087978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087981">func</span>&nbsp;<span class="ident" id="5087986">commonPrefix</span><span class="op" id="5087998">(</span><span class="ident" id="5087999">a</span><span class="op" id="5088000">,</span>&nbsp;<span class="ident" id="5088002">b</span>&nbsp;<span class="builtintype" id="5088004">string</span><span class="op" id="5088010">)</span>&nbsp;<span class="builtintype" id="5088012">string</span>&nbsp;<span class="op" id="5088019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088022">i</span>&nbsp;<span class="op" id="5088024">:=</span>&nbsp;<span class="num" id="5088027">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088030">for</span>&nbsp;<span class="ident" id="5088034">i</span>&nbsp;<span class="op" id="5088036">&lt;</span>&nbsp;<span class="builtinfunc" id="5088038">len</span><span class="op" id="5088041">(</span><span class="ident" id="5088042">a</span><span class="op" id="5088043">)</span>&nbsp;<span class="op" id="5088045">&amp;&amp;</span>&nbsp;<span class="ident" id="5088048">i</span>&nbsp;<span class="op" id="5088050">&lt;</span>&nbsp;<span class="builtinfunc" id="5088052">len</span><span class="op" id="5088055">(</span><span class="ident" id="5088056">b</span><span class="op" id="5088057">)</span>&nbsp;<span class="op" id="5088059">&amp;&amp;</span>&nbsp;<span class="ident" id="5088062">a</span><span class="op" id="5088063">[</span><span class="ident" id="5088064">i</span><span class="op" id="5088065">]</span>&nbsp;<span class="op" id="5088067">==</span>&nbsp;<span class="ident" id="5088070">b</span><span class="op" id="5088071">[</span><span class="ident" id="5088072">i</span><span class="op" id="5088073">]</span>&nbsp;<span class="op" id="5088075">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088079">i</span><span class="op" id="5088080">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088087">return</span>&nbsp;<span class="ident" id="5088094">a</span><span class="op" id="5088095">[</span><span class="num" id="5088096">0</span><span class="op" id="5088097">:</span><span class="ident" id="5088098">i</span><span class="op" id="5088099">]</span><br>
<span class="lineno"></span><span class="op" id="5088101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5088104">func</span>&nbsp;<span class="ident" id="5088109">unindent</span><span class="op" id="5088117">(</span><span class="ident" id="5088118">block</span>&nbsp;<span class="op" id="5088124">[</span><span class="op" id="5088125">]</span><span class="builtintype" id="5088126">string</span><span class="op" id="5088132">)</span>&nbsp;<span class="op" id="5088134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088137">if</span>&nbsp;<span class="builtinfunc" id="5088140">len</span><span class="op" id="5088143">(</span><span class="ident" id="5088144">block</span><span class="op" id="5088149">)</span>&nbsp;<span class="op" id="5088151">==</span>&nbsp;<span class="num" id="5088154">0</span>&nbsp;<span class="op" id="5088156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088160">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088172">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088212">prefix</span>&nbsp;<span class="op" id="5088219">:=</span>&nbsp;<span class="ident" id="5088222">block</span><span class="op" id="5088227">[</span><span class="num" id="5088228">0</span><span class="op" id="5088229">]</span><span class="op" id="5088230">[</span><span class="num" id="5088231">0</span><span class="op" id="5088232">:</span><span class="ident" id="5088233">indentLen</span><span class="op" id="5088242">(</span><span class="ident" id="5088243">block</span><span class="op" id="5088248">[</span><span class="num" id="5088249">0</span><span class="op" id="5088250">]</span><span class="op" id="5088251">)</span><span class="op" id="5088252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088255">for</span>&nbsp;<span class="ident" id="5088259">_</span><span class="op" id="5088260">,</span>&nbsp;<span class="ident" id="5088262">line</span>&nbsp;<span class="op" id="5088267">:=</span>&nbsp;<span class="keyword" id="5088270">range</span>&nbsp;<span class="ident" id="5088276">block</span>&nbsp;<span class="op" id="5088282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088286">if</span>&nbsp;<span class="op" id="5088289">!</span><span class="ident" id="5088290">isBlank</span><span class="op" id="5088297">(</span><span class="ident" id="5088298">line</span><span class="op" id="5088302">)</span>&nbsp;<span class="op" id="5088304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088309">prefix</span>&nbsp;<span class="op" id="5088316">=</span>&nbsp;<span class="ident" id="5088318">commonPrefix</span><span class="op" id="5088330">(</span><span class="ident" id="5088331">prefix</span><span class="op" id="5088337">,</span>&nbsp;<span class="ident" id="5088339">line</span><span class="op" id="5088343">[</span><span class="num" id="5088344">0</span><span class="op" id="5088345">:</span><span class="ident" id="5088346">indentLen</span><span class="op" id="5088355">(</span><span class="ident" id="5088356">line</span><span class="op" id="5088360">)</span><span class="op" id="5088361">]</span><span class="op" id="5088362">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088372">n</span>&nbsp;<span class="op" id="5088374">:=</span>&nbsp;<span class="builtinfunc" id="5088377">len</span><span class="op" id="5088380">(</span><span class="ident" id="5088381">prefix</span><span class="op" id="5088387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088391">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088402">for</span>&nbsp;<span class="ident" id="5088406">i</span><span class="op" id="5088407">,</span>&nbsp;<span class="ident" id="5088409">line</span>&nbsp;<span class="op" id="5088414">:=</span>&nbsp;<span class="keyword" id="5088417">range</span>&nbsp;<span class="ident" id="5088423">block</span>&nbsp;<span class="op" id="5088429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088433">if</span>&nbsp;<span class="op" id="5088436">!</span><span class="ident" id="5088437">isBlank</span><span class="op" id="5088444">(</span><span class="ident" id="5088445">line</span><span class="op" id="5088449">)</span>&nbsp;<span class="op" id="5088451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088456">block</span><span class="op" id="5088461">[</span><span class="ident" id="5088462">i</span><span class="op" id="5088463">]</span>&nbsp;<span class="op" id="5088465">=</span>&nbsp;<span class="ident" id="5088467">line</span><span class="op" id="5088471">[</span><span class="ident" id="5088472">n</span><span class="op" id="5088473">:</span><span class="op" id="5088474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088481">}</span><br>
<span class="lineno">205</span><span class="op" id="5088483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5088486">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5088557">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5088599">func</span>&nbsp;<span class="ident" id="5088604">heading</span><span class="op" id="5088611">(</span><span class="ident" id="5088612">line</span>&nbsp;<span class="builtintype" id="5088617">string</span><span class="op" id="5088623">)</span>&nbsp;<span class="builtintype" id="5088625">string</span>&nbsp;<span class="op" id="5088632">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088635">line</span>&nbsp;<span class="op" id="5088640">=</span>&nbsp;<span class="ident" id="5088642">strings</span><span class="op" id="5088649">.</span><span class="ident" id="5088650">TrimSpace</span><span class="op" id="5088659">(</span><span class="ident" id="5088660">line</span><span class="op" id="5088664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088667">if</span>&nbsp;<span class="builtinfunc" id="5088670">len</span><span class="op" id="5088673">(</span><span class="ident" id="5088674">line</span><span class="op" id="5088678">)</span>&nbsp;<span class="op" id="5088680">==</span>&nbsp;<span class="num" id="5088683">0</span>&nbsp;<span class="op" id="5088685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088689">return</span>&nbsp;<span class="string" id="5088696">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088704">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088754">r</span><span class="op" id="5088755">,</span>&nbsp;<span class="ident" id="5088757">_</span>&nbsp;<span class="op" id="5088759">:=</span>&nbsp;<span class="ident" id="5088762">utf8</span><span class="op" id="5088766">.</span><span class="ident" id="5088767">DecodeRuneInString</span><span class="op" id="5088785">(</span><span class="ident" id="5088786">line</span><span class="op" id="5088790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088793">if</span>&nbsp;<span class="op" id="5088796">!</span><span class="ident" id="5088797">unicode</span><span class="op" id="5088804">.</span><span class="ident" id="5088805">IsLetter</span><span class="op" id="5088813">(</span><span class="ident" id="5088814">r</span><span class="op" id="5088815">)</span>&nbsp;<span class="op" id="5088817">||</span>&nbsp;<span class="op" id="5088820">!</span><span class="ident" id="5088821">unicode</span><span class="op" id="5088828">.</span><span class="ident" id="5088829">IsUpper</span><span class="op" id="5088836">(</span><span class="ident" id="5088837">r</span><span class="op" id="5088838">)</span>&nbsp;<span class="op" id="5088840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088844">return</span>&nbsp;<span class="string" id="5088851">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088855">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088859">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088897">r</span><span class="op" id="5088898">,</span>&nbsp;<span class="ident" id="5088900">_</span>&nbsp;<span class="op" id="5088902">=</span>&nbsp;<span class="ident" id="5088904">utf8</span><span class="op" id="5088908">.</span><span class="ident" id="5088909">DecodeLastRuneInString</span><span class="op" id="5088931">(</span><span class="ident" id="5088932">line</span><span class="op" id="5088936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088939">if</span>&nbsp;<span class="op" id="5088942">!</span><span class="ident" id="5088943">unicode</span><span class="op" id="5088950">.</span><span class="ident" id="5088951">IsLetter</span><span class="op" id="5088959">(</span><span class="ident" id="5088960">r</span><span class="op" id="5088961">)</span>&nbsp;<span class="op" id="5088963">&amp;&amp;</span>&nbsp;<span class="op" id="5088966">!</span><span class="ident" id="5088967">unicode</span><span class="op" id="5088974">.</span><span class="ident" id="5088975">IsDigit</span><span class="op" id="5088982">(</span><span class="ident" id="5088983">r</span><span class="op" id="5088984">)</span>&nbsp;<span class="op" id="5088986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088990">return</span>&nbsp;<span class="string" id="5088997">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089005">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089047">if</span>&nbsp;<span class="ident" id="5089050">strings</span><span class="op" id="5089057">.</span><span class="ident" id="5089058">IndexAny</span><span class="op" id="5089066">(</span><span class="ident" id="5089067">line</span><span class="op" id="5089071">,</span>&nbsp;<span class="string" id="5089073">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5089108">)</span>&nbsp;<span class="op" id="5089110">&gt;=</span>&nbsp;<span class="num" id="5089113">0</span>&nbsp;<span class="op" id="5089115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089119">return</span>&nbsp;<span class="string" id="5089126">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089134">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089173">for</span>&nbsp;<span class="ident" id="5089177">b</span>&nbsp;<span class="op" id="5089179">:=</span>&nbsp;<span class="ident" id="5089182">line</span><span class="op" id="5089186">;</span>&nbsp;<span class="op" id="5089188">;</span>&nbsp;<span class="op" id="5089190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089194">i</span>&nbsp;<span class="op" id="5089196">:=</span>&nbsp;<span class="ident" id="5089199">strings</span><span class="op" id="5089206">.</span><span class="ident" id="5089207">IndexRune</span><span class="op" id="5089216">(</span><span class="ident" id="5089217">b</span><span class="op" id="5089218">,</span>&nbsp;<span class="string" id="5089220">&#39;\&#39;&#39;</span><span class="op" id="5089224">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089228">if</span>&nbsp;<span class="ident" id="5089231">i</span>&nbsp;<span class="op" id="5089233">&lt;</span>&nbsp;<span class="num" id="5089235">0</span>&nbsp;<span class="op" id="5089237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089242">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089254">if</span>&nbsp;<span class="ident" id="5089257">i</span><span class="op" id="5089258">+</span><span class="num" id="5089259">1</span>&nbsp;<span class="op" id="5089261">&gt;=</span>&nbsp;<span class="builtinfunc" id="5089264">len</span><span class="op" id="5089267">(</span><span class="ident" id="5089268">b</span><span class="op" id="5089269">)</span>&nbsp;<span class="op" id="5089271">||</span>&nbsp;<span class="ident" id="5089274">b</span><span class="op" id="5089275">[</span><span class="ident" id="5089276">i</span><span class="op" id="5089277">+</span><span class="num" id="5089278">1</span><span class="op" id="5089279">]</span>&nbsp;<span class="op" id="5089281">!=</span>&nbsp;<span class="string" id="5089284">&#39;s&#39;</span>&nbsp;<span class="op" id="5089288">||</span>&nbsp;<span class="op" id="5089291">(</span><span class="ident" id="5089292">i</span><span class="op" id="5089293">+</span><span class="num" id="5089294">2</span>&nbsp;<span class="op" id="5089296">&lt;</span>&nbsp;<span class="builtinfunc" id="5089298">len</span><span class="op" id="5089301">(</span><span class="ident" id="5089302">b</span><span class="op" id="5089303">)</span>&nbsp;<span class="op" id="5089305">&amp;&amp;</span>&nbsp;<span class="ident" id="5089308">b</span><span class="op" id="5089309">[</span><span class="ident" id="5089310">i</span><span class="op" id="5089311">+</span><span class="num" id="5089312">2</span><span class="op" id="5089313">]</span>&nbsp;<span class="op" id="5089315">!=</span>&nbsp;<span class="string" id="5089318">&#39;&nbsp;&#39;</span><span class="op" id="5089321">)</span>&nbsp;<span class="op" id="5089323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089328">return</span>&nbsp;<span class="string" id="5089335">&#34;&#34;</span>&nbsp;<span class="comment" id="5089338">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089368">b</span>&nbsp;<span class="op" id="5089370">=</span>&nbsp;<span class="ident" id="5089372">b</span><span class="op" id="5089373">[</span><span class="ident" id="5089374">i</span><span class="op" id="5089375">+</span><span class="num" id="5089376">2</span><span class="op" id="5089377">:</span><span class="op" id="5089378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089385">return</span>&nbsp;<span class="ident" id="5089392">line</span><br>
<span class="lineno">245</span><span class="op" id="5089397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5089400">type</span>&nbsp;<span class="ident" id="5089405">op</span>&nbsp;<span class="builtintype" id="5089408">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5089413">const</span>&nbsp;<span class="op" id="5089419">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089422">opPara</span>&nbsp;<span class="ident" id="5089429">op</span>&nbsp;<span class="op" id="5089432">=</span>&nbsp;<span class="ident" id="5089434">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089440">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089448">opPre</span><br>
<span class="lineno"></span><span class="op" id="5089454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5089457">type</span>&nbsp;<span class="ident" id="5089462">block</span>&nbsp;<span class="keyword" id="5089468">struct</span>&nbsp;<span class="op" id="5089475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089478">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089484">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089488">lines</span>&nbsp;<span class="op" id="5089494">[</span><span class="op" id="5089495">]</span><span class="builtintype" id="5089496">string</span><br>
<span class="lineno"></span><span class="op" id="5089503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5089506">var</span>&nbsp;<span class="ident" id="5089510">nonAlphaNumRx</span>&nbsp;<span class="op" id="5089524">=</span>&nbsp;<span class="ident" id="5089526">regexp</span><span class="op" id="5089532">.</span><span class="ident" id="5089533">MustCompile</span><span class="op" id="5089544">(</span><span class="string" id="5089545">`[^a-zA-Z0-9]`</span><span class="op" id="5089559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5089562">func</span>&nbsp;<span class="ident" id="5089567">anchorID</span><span class="op" id="5089575">(</span><span class="ident" id="5089576">line</span>&nbsp;<span class="builtintype" id="5089581">string</span><span class="op" id="5089587">)</span>&nbsp;<span class="builtintype" id="5089589">string</span>&nbsp;<span class="op" id="5089596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089599">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089679">return</span>&nbsp;<span class="string" id="5089686">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5089693">+</span>&nbsp;<span class="ident" id="5089695">nonAlphaNumRx</span><span class="op" id="5089708">.</span><span class="ident" id="5089709">ReplaceAllString</span><span class="op" id="5089725">(</span><span class="ident" id="5089726">line</span><span class="op" id="5089730">,</span>&nbsp;<span class="string" id="5089732">&#34;_&#34;</span><span class="op" id="5089735">)</span><br>
<span class="lineno">265</span><span class="op" id="5089737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5089740">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5089791">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5089833">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5089893">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5089945">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5089995">//</span><br>
<span class="lineno"></span><span class="comment" id="5089998">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5090059">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5090130">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5090199">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5090260">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5090290">//</span><br>
<span class="lineno"></span><span class="comment" id="5090293">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5090354">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5090396">//</span><br>
<span class="lineno"></span><span class="comment" id="5090399">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5090477">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5090555">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5090624">//</span><br>
<span class="lineno"></span><span class="comment" id="5090627">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5090711">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5090798">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5090814">func</span>&nbsp;<span class="ident" id="5090819">ToHTML</span><span class="op" id="5090825">(</span><span class="ident" id="5090826">w</span>&nbsp;<span class="ident" id="5090828">io</span><span class="op" id="5090830">.</span><span class="ident" id="5090831">Writer</span><span class="op" id="5090837">,</span>&nbsp;<span class="ident" id="5090839">text</span>&nbsp;<span class="builtintype" id="5090844">string</span><span class="op" id="5090850">,</span>&nbsp;<span class="ident" id="5090852">words</span>&nbsp;<span class="keyword" id="5090858">map</span><span class="op" id="5090861">[</span><span class="builtintype" id="5090862">string</span><span class="op" id="5090868">]</span><span class="builtintype" id="5090869">string</span><span class="op" id="5090875">)</span>&nbsp;<span class="op" id="5090877">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090880">for</span>&nbsp;<span class="ident" id="5090884">_</span><span class="op" id="5090885">,</span>&nbsp;<span class="ident" id="5090887">b</span>&nbsp;<span class="op" id="5090889">:=</span>&nbsp;<span class="keyword" id="5090892">range</span>&nbsp;<span class="ident" id="5090898">blocks</span><span class="op" id="5090904">(</span><span class="ident" id="5090905">text</span><span class="op" id="5090909">)</span>&nbsp;<span class="op" id="5090911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090915">switch</span>&nbsp;<span class="ident" id="5090922">b</span><span class="op" id="5090923">.</span><span class="ident" id="5090924">op</span>&nbsp;<span class="op" id="5090927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090931">case</span>&nbsp;<span class="ident" id="5090936">opPara</span><span class="op" id="5090942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090947">w</span><span class="op" id="5090948">.</span><span class="ident" id="5090949">Write</span><span class="op" id="5090954">(</span><span class="ident" id="5090955">html_p</span><span class="op" id="5090961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090966">for</span>&nbsp;<span class="ident" id="5090970">_</span><span class="op" id="5090971">,</span>&nbsp;<span class="ident" id="5090973">line</span>&nbsp;<span class="op" id="5090978">:=</span>&nbsp;<span class="keyword" id="5090981">range</span>&nbsp;<span class="ident" id="5090987">b</span><span class="op" id="5090988">.</span><span class="ident" id="5090989">lines</span>&nbsp;<span class="op" id="5090995">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091001">emphasize</span><span class="op" id="5091010">(</span><span class="ident" id="5091011">w</span><span class="op" id="5091012">,</span>&nbsp;<span class="ident" id="5091014">line</span><span class="op" id="5091018">,</span>&nbsp;<span class="ident" id="5091020">words</span><span class="op" id="5091025">,</span>&nbsp;<span class="builtintype" id="5091027">true</span><span class="op" id="5091031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091041">w</span><span class="op" id="5091042">.</span><span class="ident" id="5091043">Write</span><span class="op" id="5091048">(</span><span class="ident" id="5091049">html_endp</span><span class="op" id="5091058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091062">case</span>&nbsp;<span class="ident" id="5091067">opHead</span><span class="op" id="5091073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091078">w</span><span class="op" id="5091079">.</span><span class="ident" id="5091080">Write</span><span class="op" id="5091085">(</span><span class="ident" id="5091086">html_h</span><span class="op" id="5091092">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091097">id</span>&nbsp;<span class="op" id="5091100">:=</span>&nbsp;<span class="string" id="5091103">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091109">for</span>&nbsp;<span class="ident" id="5091113">_</span><span class="op" id="5091114">,</span>&nbsp;<span class="ident" id="5091116">line</span>&nbsp;<span class="op" id="5091121">:=</span>&nbsp;<span class="keyword" id="5091124">range</span>&nbsp;<span class="ident" id="5091130">b</span><span class="op" id="5091131">.</span><span class="ident" id="5091132">lines</span>&nbsp;<span class="op" id="5091138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091144">if</span>&nbsp;<span class="ident" id="5091147">id</span>&nbsp;<span class="op" id="5091150">==</span>&nbsp;<span class="string" id="5091153">&#34;&#34;</span>&nbsp;<span class="op" id="5091156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091163">id</span>&nbsp;<span class="op" id="5091166">=</span>&nbsp;<span class="ident" id="5091168">anchorID</span><span class="op" id="5091176">(</span><span class="ident" id="5091177">line</span><span class="op" id="5091181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091188">w</span><span class="op" id="5091189">.</span><span class="ident" id="5091190">Write</span><span class="op" id="5091195">(</span><span class="op" id="5091196">[</span><span class="op" id="5091197">]</span><span class="builtintype" id="5091198">byte</span><span class="op" id="5091202">(</span><span class="ident" id="5091203">id</span><span class="op" id="5091205">)</span><span class="op" id="5091206">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091213">w</span><span class="op" id="5091214">.</span><span class="ident" id="5091215">Write</span><span class="op" id="5091220">(</span><span class="ident" id="5091221">html_hq</span><span class="op" id="5091228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091240">commentEscape</span><span class="op" id="5091253">(</span><span class="ident" id="5091254">w</span><span class="op" id="5091255">,</span>&nbsp;<span class="ident" id="5091257">line</span><span class="op" id="5091261">,</span>&nbsp;<span class="builtintype" id="5091263">true</span><span class="op" id="5091267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091277">if</span>&nbsp;<span class="ident" id="5091280">id</span>&nbsp;<span class="op" id="5091283">==</span>&nbsp;<span class="string" id="5091286">&#34;&#34;</span>&nbsp;<span class="op" id="5091289">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091295">w</span><span class="op" id="5091296">.</span><span class="ident" id="5091297">Write</span><span class="op" id="5091302">(</span><span class="ident" id="5091303">html_hq</span><span class="op" id="5091310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091320">w</span><span class="op" id="5091321">.</span><span class="ident" id="5091322">Write</span><span class="op" id="5091327">(</span><span class="ident" id="5091328">html_endh</span><span class="op" id="5091337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091341">case</span>&nbsp;<span class="ident" id="5091346">opPre</span><span class="op" id="5091351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091356">w</span><span class="op" id="5091357">.</span><span class="ident" id="5091358">Write</span><span class="op" id="5091363">(</span><span class="ident" id="5091364">html_pre</span><span class="op" id="5091372">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091377">for</span>&nbsp;<span class="ident" id="5091381">_</span><span class="op" id="5091382">,</span>&nbsp;<span class="ident" id="5091384">line</span>&nbsp;<span class="op" id="5091389">:=</span>&nbsp;<span class="keyword" id="5091392">range</span>&nbsp;<span class="ident" id="5091398">b</span><span class="op" id="5091399">.</span><span class="ident" id="5091400">lines</span>&nbsp;<span class="op" id="5091406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091412">emphasize</span><span class="op" id="5091421">(</span><span class="ident" id="5091422">w</span><span class="op" id="5091423">,</span>&nbsp;<span class="ident" id="5091425">line</span><span class="op" id="5091429">,</span>&nbsp;<span class="builtintype" id="5091431">nil</span><span class="op" id="5091434">,</span>&nbsp;<span class="builtintype" id="5091436">false</span><span class="op" id="5091441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091451">w</span><span class="op" id="5091452">.</span><span class="ident" id="5091453">Write</span><span class="op" id="5091458">(</span><span class="ident" id="5091459">html_endpre</span><span class="op" id="5091470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091474">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091477">}</span><br>
<span class="lineno"></span><span class="op" id="5091479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5091482">func</span>&nbsp;<span class="ident" id="5091487">blocks</span><span class="op" id="5091493">(</span><span class="ident" id="5091494">text</span>&nbsp;<span class="builtintype" id="5091499">string</span><span class="op" id="5091505">)</span>&nbsp;<span class="op" id="5091507">[</span><span class="op" id="5091508">]</span><span class="ident" id="5091509">block</span>&nbsp;<span class="op" id="5091515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091518">var</span>&nbsp;<span class="op" id="5091522">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091526">out</span>&nbsp;&nbsp;<span class="op" id="5091531">[</span><span class="op" id="5091532">]</span><span class="ident" id="5091533">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091541">para</span>&nbsp;<span class="op" id="5091546">[</span><span class="op" id="5091547">]</span><span class="builtintype" id="5091548">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091558">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5091573">=</span>&nbsp;<span class="builtintype" id="5091575">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091583">lastWasHeading</span>&nbsp;<span class="op" id="5091598">=</span>&nbsp;<span class="builtintype" id="5091600">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5091611">close</span>&nbsp;<span class="op" id="5091617">:=</span>&nbsp;<span class="keyword" id="5091620">func</span><span class="op" id="5091624">(</span><span class="op" id="5091625">)</span>&nbsp;<span class="op" id="5091627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091631">if</span>&nbsp;<span class="ident" id="5091634">para</span>&nbsp;<span class="op" id="5091639">!=</span>&nbsp;<span class="builtintype" id="5091642">nil</span>&nbsp;<span class="op" id="5091646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091651">out</span>&nbsp;<span class="op" id="5091655">=</span>&nbsp;<span class="builtinfunc" id="5091657">append</span><span class="op" id="5091663">(</span><span class="ident" id="5091664">out</span><span class="op" id="5091667">,</span>&nbsp;<span class="ident" id="5091669">block</span><span class="op" id="5091674">{</span><span class="ident" id="5091675">opPara</span><span class="op" id="5091681">,</span>&nbsp;<span class="ident" id="5091683">para</span><span class="op" id="5091687">}</span><span class="op" id="5091688">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091693">para</span>&nbsp;<span class="op" id="5091698">=</span>&nbsp;<span class="builtintype" id="5091700">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091713">lines</span>&nbsp;<span class="op" id="5091719">:=</span>&nbsp;<span class="ident" id="5091722">strings</span><span class="op" id="5091729">.</span><span class="ident" id="5091730">SplitAfter</span><span class="op" id="5091740">(</span><span class="ident" id="5091741">text</span><span class="op" id="5091745">,</span>&nbsp;<span class="string" id="5091747">&#34;\n&#34;</span><span class="op" id="5091751">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091754">unindent</span><span class="op" id="5091762">(</span><span class="ident" id="5091763">lines</span><span class="op" id="5091768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091771">for</span>&nbsp;<span class="ident" id="5091775">i</span>&nbsp;<span class="op" id="5091777">:=</span>&nbsp;<span class="num" id="5091780">0</span><span class="op" id="5091781">;</span>&nbsp;<span class="ident" id="5091783">i</span>&nbsp;<span class="op" id="5091785">&lt;</span>&nbsp;<span class="builtinfunc" id="5091787">len</span><span class="op" id="5091790">(</span><span class="ident" id="5091791">lines</span><span class="op" id="5091796">)</span><span class="op" id="5091797">;</span>&nbsp;<span class="op" id="5091799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091803">line</span>&nbsp;<span class="op" id="5091808">:=</span>&nbsp;<span class="ident" id="5091811">lines</span><span class="op" id="5091816">[</span><span class="ident" id="5091817">i</span><span class="op" id="5091818">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091822">if</span>&nbsp;<span class="ident" id="5091825">isBlank</span><span class="op" id="5091832">(</span><span class="ident" id="5091833">line</span><span class="op" id="5091837">)</span>&nbsp;<span class="op" id="5091839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091844">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5091866">close</span><span class="op" id="5091871">(</span><span class="op" id="5091872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091877">i</span><span class="op" id="5091878">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091884">lastWasBlank</span>&nbsp;<span class="op" id="5091897">=</span>&nbsp;<span class="builtintype" id="5091899">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091907">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091918">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091922">if</span>&nbsp;<span class="ident" id="5091925">indentLen</span><span class="op" id="5091934">(</span><span class="ident" id="5091935">line</span><span class="op" id="5091939">)</span>&nbsp;<span class="op" id="5091941">&gt;</span>&nbsp;<span class="num" id="5091943">0</span>&nbsp;<span class="op" id="5091945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091950">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5091972">close</span><span class="op" id="5091977">(</span><span class="op" id="5091978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091984">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092020">j</span>&nbsp;<span class="op" id="5092022">:=</span>&nbsp;<span class="ident" id="5092025">i</span>&nbsp;<span class="op" id="5092027">+</span>&nbsp;<span class="num" id="5092029">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092034">for</span>&nbsp;<span class="ident" id="5092038">j</span>&nbsp;<span class="op" id="5092040">&lt;</span>&nbsp;<span class="builtinfunc" id="5092042">len</span><span class="op" id="5092045">(</span><span class="ident" id="5092046">lines</span><span class="op" id="5092051">)</span>&nbsp;<span class="op" id="5092053">&amp;&amp;</span>&nbsp;<span class="op" id="5092056">(</span><span class="ident" id="5092057">isBlank</span><span class="op" id="5092064">(</span><span class="ident" id="5092065">lines</span><span class="op" id="5092070">[</span><span class="ident" id="5092071">j</span><span class="op" id="5092072">]</span><span class="op" id="5092073">)</span>&nbsp;<span class="op" id="5092075">||</span>&nbsp;<span class="ident" id="5092078">indentLen</span><span class="op" id="5092087">(</span><span class="ident" id="5092088">lines</span><span class="op" id="5092093">[</span><span class="ident" id="5092094">j</span><span class="op" id="5092095">]</span><span class="op" id="5092096">)</span>&nbsp;<span class="op" id="5092098">&gt;</span>&nbsp;<span class="num" id="5092100">0</span><span class="op" id="5092101">)</span>&nbsp;<span class="op" id="5092103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092109">j</span><span class="op" id="5092110">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092121">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092156">for</span>&nbsp;<span class="ident" id="5092160">j</span>&nbsp;<span class="op" id="5092162">&gt;</span>&nbsp;<span class="ident" id="5092164">i</span>&nbsp;<span class="op" id="5092166">&amp;&amp;</span>&nbsp;<span class="ident" id="5092169">isBlank</span><span class="op" id="5092176">(</span><span class="ident" id="5092177">lines</span><span class="op" id="5092182">[</span><span class="ident" id="5092183">j</span><span class="op" id="5092184">-</span><span class="num" id="5092185">1</span><span class="op" id="5092186">]</span><span class="op" id="5092187">)</span>&nbsp;<span class="op" id="5092189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092195">j</span><span class="op" id="5092196">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092207">pre</span>&nbsp;<span class="op" id="5092211">:=</span>&nbsp;<span class="ident" id="5092214">lines</span><span class="op" id="5092219">[</span><span class="ident" id="5092220">i</span><span class="op" id="5092221">:</span><span class="ident" id="5092222">j</span><span class="op" id="5092223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092228">i</span>&nbsp;<span class="op" id="5092230">=</span>&nbsp;<span class="ident" id="5092232">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092238">unindent</span><span class="op" id="5092246">(</span><span class="ident" id="5092247">pre</span><span class="op" id="5092250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092256">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092293">out</span>&nbsp;<span class="op" id="5092297">=</span>&nbsp;<span class="builtinfunc" id="5092299">append</span><span class="op" id="5092305">(</span><span class="ident" id="5092306">out</span><span class="op" id="5092309">,</span>&nbsp;<span class="ident" id="5092311">block</span><span class="op" id="5092316">{</span><span class="ident" id="5092317">opPre</span><span class="op" id="5092322">,</span>&nbsp;<span class="ident" id="5092324">pre</span><span class="op" id="5092327">}</span><span class="op" id="5092328">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092333">lastWasHeading</span>&nbsp;<span class="op" id="5092348">=</span>&nbsp;<span class="builtintype" id="5092350">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092359">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092375">if</span>&nbsp;<span class="ident" id="5092378">lastWasBlank</span>&nbsp;<span class="op" id="5092391">&amp;&amp;</span>&nbsp;<span class="op" id="5092394">!</span><span class="ident" id="5092395">lastWasHeading</span>&nbsp;<span class="op" id="5092410">&amp;&amp;</span>&nbsp;<span class="ident" id="5092413">i</span><span class="op" id="5092414">+</span><span class="num" id="5092415">2</span>&nbsp;<span class="op" id="5092417">&lt;</span>&nbsp;<span class="builtinfunc" id="5092419">len</span><span class="op" id="5092422">(</span><span class="ident" id="5092423">lines</span><span class="op" id="5092428">)</span>&nbsp;<span class="op" id="5092430">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092436">isBlank</span><span class="op" id="5092443">(</span><span class="ident" id="5092444">lines</span><span class="op" id="5092449">[</span><span class="ident" id="5092450">i</span><span class="op" id="5092451">+</span><span class="num" id="5092452">1</span><span class="op" id="5092453">]</span><span class="op" id="5092454">)</span>&nbsp;<span class="op" id="5092456">&amp;&amp;</span>&nbsp;<span class="op" id="5092459">!</span><span class="ident" id="5092460">isBlank</span><span class="op" id="5092467">(</span><span class="ident" id="5092468">lines</span><span class="op" id="5092473">[</span><span class="ident" id="5092474">i</span><span class="op" id="5092475">+</span><span class="num" id="5092476">2</span><span class="op" id="5092477">]</span><span class="op" id="5092478">)</span>&nbsp;<span class="op" id="5092480">&amp;&amp;</span>&nbsp;<span class="ident" id="5092483">indentLen</span><span class="op" id="5092492">(</span><span class="ident" id="5092493">lines</span><span class="op" id="5092498">[</span><span class="ident" id="5092499">i</span><span class="op" id="5092500">+</span><span class="num" id="5092501">2</span><span class="op" id="5092502">]</span><span class="op" id="5092503">)</span>&nbsp;<span class="op" id="5092505">==</span>&nbsp;<span class="num" id="5092508">0</span>&nbsp;<span class="op" id="5092510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092515">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092574">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092630">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092656">if</span>&nbsp;<span class="ident" id="5092659">head</span>&nbsp;<span class="op" id="5092664">:=</span>&nbsp;<span class="ident" id="5092667">heading</span><span class="op" id="5092674">(</span><span class="ident" id="5092675">line</span><span class="op" id="5092679">)</span><span class="op" id="5092680">;</span>&nbsp;<span class="ident" id="5092682">head</span>&nbsp;<span class="op" id="5092687">!=</span>&nbsp;<span class="string" id="5092690">&#34;&#34;</span>&nbsp;<span class="op" id="5092693">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5092699">close</span><span class="op" id="5092704">(</span><span class="op" id="5092705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092711">out</span>&nbsp;<span class="op" id="5092715">=</span>&nbsp;<span class="builtinfunc" id="5092717">append</span><span class="op" id="5092723">(</span><span class="ident" id="5092724">out</span><span class="op" id="5092727">,</span>&nbsp;<span class="ident" id="5092729">block</span><span class="op" id="5092734">{</span><span class="ident" id="5092735">opHead</span><span class="op" id="5092741">,</span>&nbsp;<span class="op" id="5092743">[</span><span class="op" id="5092744">]</span><span class="builtintype" id="5092745">string</span><span class="op" id="5092751">{</span><span class="ident" id="5092752">head</span><span class="op" id="5092756">}</span><span class="op" id="5092757">}</span><span class="op" id="5092758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092764">i</span>&nbsp;<span class="op" id="5092766">+=</span>&nbsp;<span class="num" id="5092769">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092775">lastWasHeading</span>&nbsp;<span class="op" id="5092790">=</span>&nbsp;<span class="builtintype" id="5092792">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092801">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092822">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092842">lastWasBlank</span>&nbsp;<span class="op" id="5092855">=</span>&nbsp;<span class="builtintype" id="5092857">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092865">lastWasHeading</span>&nbsp;<span class="op" id="5092880">=</span>&nbsp;<span class="builtintype" id="5092882">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092890">para</span>&nbsp;<span class="op" id="5092895">=</span>&nbsp;<span class="builtinfunc" id="5092897">append</span><span class="op" id="5092903">(</span><span class="ident" id="5092904">para</span><span class="op" id="5092908">,</span>&nbsp;<span class="ident" id="5092910">lines</span><span class="op" id="5092915">[</span><span class="ident" id="5092916">i</span><span class="op" id="5092917">]</span><span class="op" id="5092918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092922">i</span><span class="op" id="5092923">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5092930">close</span><span class="op" id="5092935">(</span><span class="op" id="5092936">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092940">return</span>&nbsp;<span class="ident" id="5092947">out</span><br>
<span class="lineno"></span><span class="op" id="5092951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092954">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5093022">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5093091">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5093165">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5093240">func</span>&nbsp;<span class="ident" id="5093245">ToText</span><span class="op" id="5093251">(</span><span class="ident" id="5093252">w</span>&nbsp;<span class="ident" id="5093254">io</span><span class="op" id="5093256">.</span><span class="ident" id="5093257">Writer</span><span class="op" id="5093263">,</span>&nbsp;<span class="ident" id="5093265">text</span>&nbsp;<span class="builtintype" id="5093270">string</span><span class="op" id="5093276">,</span>&nbsp;<span class="ident" id="5093278">indent</span><span class="op" id="5093284">,</span>&nbsp;<span class="ident" id="5093286">preIndent</span>&nbsp;<span class="builtintype" id="5093296">string</span><span class="op" id="5093302">,</span>&nbsp;<span class="ident" id="5093304">width</span>&nbsp;<span class="builtintype" id="5093310">int</span><span class="op" id="5093313">)</span>&nbsp;<span class="op" id="5093315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093318">l</span>&nbsp;<span class="op" id="5093320">:=</span>&nbsp;<span class="ident" id="5093323">lineWrapper</span><span class="op" id="5093334">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093338">out</span><span class="op" id="5093341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093346">w</span><span class="op" id="5093347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093351">width</span><span class="op" id="5093356">:</span>&nbsp;&nbsp;<span class="ident" id="5093359">width</span><span class="op" id="5093364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093368">indent</span><span class="op" id="5093374">:</span>&nbsp;<span class="ident" id="5093376">indent</span><span class="op" id="5093382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093388">for</span>&nbsp;<span class="ident" id="5093392">_</span><span class="op" id="5093393">,</span>&nbsp;<span class="ident" id="5093395">b</span>&nbsp;<span class="op" id="5093397">:=</span>&nbsp;<span class="keyword" id="5093400">range</span>&nbsp;<span class="ident" id="5093406">blocks</span><span class="op" id="5093412">(</span><span class="ident" id="5093413">text</span><span class="op" id="5093417">)</span>&nbsp;<span class="op" id="5093419">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093423">switch</span>&nbsp;<span class="ident" id="5093430">b</span><span class="op" id="5093431">.</span><span class="ident" id="5093432">op</span>&nbsp;<span class="op" id="5093435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093439">case</span>&nbsp;<span class="ident" id="5093444">opPara</span><span class="op" id="5093450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093455">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093506">for</span>&nbsp;<span class="ident" id="5093510">_</span><span class="op" id="5093511">,</span>&nbsp;<span class="ident" id="5093513">line</span>&nbsp;<span class="op" id="5093518">:=</span>&nbsp;<span class="keyword" id="5093521">range</span>&nbsp;<span class="ident" id="5093527">b</span><span class="op" id="5093528">.</span><span class="ident" id="5093529">lines</span>&nbsp;<span class="op" id="5093535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093541">l</span><span class="op" id="5093542">.</span><span class="ident" id="5093543">write</span><span class="op" id="5093548">(</span><span class="ident" id="5093549">line</span><span class="op" id="5093553">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093563">l</span><span class="op" id="5093564">.</span><span class="ident" id="5093565">flush</span><span class="op" id="5093570">(</span><span class="op" id="5093571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093575">case</span>&nbsp;<span class="ident" id="5093580">opHead</span><span class="op" id="5093586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093591">w</span><span class="op" id="5093592">.</span><span class="ident" id="5093593">Write</span><span class="op" id="5093598">(</span><span class="ident" id="5093599">nl</span><span class="op" id="5093601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093606">for</span>&nbsp;<span class="ident" id="5093610">_</span><span class="op" id="5093611">,</span>&nbsp;<span class="ident" id="5093613">line</span>&nbsp;<span class="op" id="5093618">:=</span>&nbsp;<span class="keyword" id="5093621">range</span>&nbsp;<span class="ident" id="5093627">b</span><span class="op" id="5093628">.</span><span class="ident" id="5093629">lines</span>&nbsp;<span class="op" id="5093635">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093641">l</span><span class="op" id="5093642">.</span><span class="ident" id="5093643">write</span><span class="op" id="5093648">(</span><span class="ident" id="5093649">line</span>&nbsp;<span class="op" id="5093654">+</span>&nbsp;<span class="string" id="5093656">&#34;\n&#34;</span><span class="op" id="5093660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093670">l</span><span class="op" id="5093671">.</span><span class="ident" id="5093672">flush</span><span class="op" id="5093677">(</span><span class="op" id="5093678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093682">case</span>&nbsp;<span class="ident" id="5093687">opPre</span><span class="op" id="5093692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093697">w</span><span class="op" id="5093698">.</span><span class="ident" id="5093699">Write</span><span class="op" id="5093704">(</span><span class="ident" id="5093705">nl</span><span class="op" id="5093707">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093712">for</span>&nbsp;<span class="ident" id="5093716">_</span><span class="op" id="5093717">,</span>&nbsp;<span class="ident" id="5093719">line</span>&nbsp;<span class="op" id="5093724">:=</span>&nbsp;<span class="keyword" id="5093727">range</span>&nbsp;<span class="ident" id="5093733">b</span><span class="op" id="5093734">.</span><span class="ident" id="5093735">lines</span>&nbsp;<span class="op" id="5093741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093747">if</span>&nbsp;<span class="ident" id="5093750">isBlank</span><span class="op" id="5093757">(</span><span class="ident" id="5093758">line</span><span class="op" id="5093762">)</span>&nbsp;<span class="op" id="5093764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093771">w</span><span class="op" id="5093772">.</span><span class="ident" id="5093773">Write</span><span class="op" id="5093778">(</span><span class="op" id="5093779">[</span><span class="op" id="5093780">]</span><span class="builtintype" id="5093781">byte</span><span class="op" id="5093785">(</span><span class="string" id="5093786">&#34;\n&#34;</span><span class="op" id="5093790">)</span><span class="op" id="5093791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093797">}</span>&nbsp;<span class="keyword" id="5093799">else</span>&nbsp;<span class="op" id="5093804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093811">w</span><span class="op" id="5093812">.</span><span class="ident" id="5093813">Write</span><span class="op" id="5093818">(</span><span class="op" id="5093819">[</span><span class="op" id="5093820">]</span><span class="builtintype" id="5093821">byte</span><span class="op" id="5093825">(</span><span class="ident" id="5093826">preIndent</span><span class="op" id="5093835">)</span><span class="op" id="5093836">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093843">w</span><span class="op" id="5093844">.</span><span class="ident" id="5093845">Write</span><span class="op" id="5093850">(</span><span class="op" id="5093851">[</span><span class="op" id="5093852">]</span><span class="builtintype" id="5093853">byte</span><span class="op" id="5093857">(</span><span class="ident" id="5093858">line</span><span class="op" id="5093862">)</span><span class="op" id="5093863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093881">}</span><br>
<span class="lineno">435</span><span class="op" id="5093883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5093886">type</span>&nbsp;<span class="ident" id="5093891">lineWrapper</span>&nbsp;<span class="keyword" id="5093903">struct</span>&nbsp;<span class="op" id="5093910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093913">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093923">io</span><span class="op" id="5093925">.</span><span class="ident" id="5093926">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093934">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5093944">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093950">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5093960">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093965">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5093975">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093983">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5093993">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093998">pendSpace</span>&nbsp;<span class="builtintype" id="5094008">int</span><br>
<span class="lineno"></span><span class="op" id="5094012">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5094015">var</span>&nbsp;<span class="ident" id="5094019">nl</span>&nbsp;<span class="op" id="5094022">=</span>&nbsp;<span class="op" id="5094024">[</span><span class="op" id="5094025">]</span><span class="builtintype" id="5094026">byte</span><span class="op" id="5094030">(</span><span class="string" id="5094031">&#34;\n&#34;</span><span class="op" id="5094035">)</span><br>
<span class="lineno"></span><span class="keyword" id="5094037">var</span>&nbsp;<span class="ident" id="5094041">space</span>&nbsp;<span class="op" id="5094047">=</span>&nbsp;<span class="op" id="5094049">[</span><span class="op" id="5094050">]</span><span class="builtintype" id="5094051">byte</span><span class="op" id="5094055">(</span><span class="string" id="5094056">&#34;&nbsp;&#34;</span><span class="op" id="5094059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5094062">func</span>&nbsp;<span class="op" id="5094067">(</span><span class="ident" id="5094068">l</span>&nbsp;<span class="op" id="5094070">*</span><span class="ident" id="5094071">lineWrapper</span><span class="op" id="5094082">)</span>&nbsp;<span class="ident" id="5094084">write</span><span class="op" id="5094089">(</span><span class="ident" id="5094090">text</span>&nbsp;<span class="builtintype" id="5094095">string</span><span class="op" id="5094101">)</span>&nbsp;<span class="op" id="5094103">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094106">if</span>&nbsp;<span class="ident" id="5094109">l</span><span class="op" id="5094110">.</span><span class="ident" id="5094111">n</span>&nbsp;<span class="op" id="5094113">==</span>&nbsp;<span class="num" id="5094116">0</span>&nbsp;<span class="op" id="5094118">&amp;&amp;</span>&nbsp;<span class="ident" id="5094121">l</span><span class="op" id="5094122">.</span><span class="ident" id="5094123">printed</span>&nbsp;<span class="op" id="5094131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094135">l</span><span class="op" id="5094136">.</span><span class="ident" id="5094137">out</span><span class="op" id="5094140">.</span><span class="ident" id="5094141">Write</span><span class="op" id="5094146">(</span><span class="ident" id="5094147">nl</span><span class="op" id="5094149">)</span>&nbsp;<span class="comment" id="5094151">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094190">l</span><span class="op" id="5094191">.</span><span class="ident" id="5094192">printed</span>&nbsp;<span class="op" id="5094200">=</span>&nbsp;<span class="builtintype" id="5094202">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094209">for</span>&nbsp;<span class="ident" id="5094213">_</span><span class="op" id="5094214">,</span>&nbsp;<span class="ident" id="5094216">f</span>&nbsp;<span class="op" id="5094218">:=</span>&nbsp;<span class="keyword" id="5094221">range</span>&nbsp;<span class="ident" id="5094227">strings</span><span class="op" id="5094234">.</span><span class="ident" id="5094235">Fields</span><span class="op" id="5094241">(</span><span class="ident" id="5094242">text</span><span class="op" id="5094246">)</span>&nbsp;<span class="op" id="5094248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094252">w</span>&nbsp;<span class="op" id="5094254">:=</span>&nbsp;<span class="ident" id="5094257">utf8</span><span class="op" id="5094261">.</span><span class="ident" id="5094262">RuneCountInString</span><span class="op" id="5094279">(</span><span class="ident" id="5094280">f</span><span class="op" id="5094281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094285">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094315">if</span>&nbsp;<span class="ident" id="5094318">l</span><span class="op" id="5094319">.</span><span class="ident" id="5094320">n</span>&nbsp;<span class="op" id="5094322">&gt;</span>&nbsp;<span class="num" id="5094324">0</span>&nbsp;<span class="op" id="5094326">&amp;&amp;</span>&nbsp;<span class="ident" id="5094329">l</span><span class="op" id="5094330">.</span><span class="ident" id="5094331">n</span><span class="op" id="5094332">+</span><span class="ident" id="5094333">l</span><span class="op" id="5094334">.</span><span class="ident" id="5094335">pendSpace</span><span class="op" id="5094344">+</span><span class="ident" id="5094345">w</span>&nbsp;<span class="op" id="5094347">&gt;</span>&nbsp;<span class="ident" id="5094349">l</span><span class="op" id="5094350">.</span><span class="ident" id="5094351">width</span>&nbsp;<span class="op" id="5094357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094362">l</span><span class="op" id="5094363">.</span><span class="ident" id="5094364">out</span><span class="op" id="5094367">.</span><span class="ident" id="5094368">Write</span><span class="op" id="5094373">(</span><span class="ident" id="5094374">nl</span><span class="op" id="5094376">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094381">l</span><span class="op" id="5094382">.</span><span class="ident" id="5094383">n</span>&nbsp;<span class="op" id="5094385">=</span>&nbsp;<span class="num" id="5094387">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094392">l</span><span class="op" id="5094393">.</span><span class="ident" id="5094394">pendSpace</span>&nbsp;<span class="op" id="5094404">=</span>&nbsp;<span class="num" id="5094406">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094414">if</span>&nbsp;<span class="ident" id="5094417">l</span><span class="op" id="5094418">.</span><span class="ident" id="5094419">n</span>&nbsp;<span class="op" id="5094421">==</span>&nbsp;<span class="num" id="5094424">0</span>&nbsp;<span class="op" id="5094426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094431">l</span><span class="op" id="5094432">.</span><span class="ident" id="5094433">out</span><span class="op" id="5094436">.</span><span class="ident" id="5094437">Write</span><span class="op" id="5094442">(</span><span class="op" id="5094443">[</span><span class="op" id="5094444">]</span><span class="builtintype" id="5094445">byte</span><span class="op" id="5094449">(</span><span class="ident" id="5094450">l</span><span class="op" id="5094451">.</span><span class="ident" id="5094452">indent</span><span class="op" id="5094458">)</span><span class="op" id="5094459">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094467">l</span><span class="op" id="5094468">.</span><span class="ident" id="5094469">out</span><span class="op" id="5094472">.</span><span class="ident" id="5094473">Write</span><span class="op" id="5094478">(</span><span class="ident" id="5094479">space</span><span class="op" id="5094484">[</span><span class="op" id="5094485">:</span><span class="ident" id="5094486">l</span><span class="op" id="5094487">.</span><span class="ident" id="5094488">pendSpace</span><span class="op" id="5094497">]</span><span class="op" id="5094498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094502">l</span><span class="op" id="5094503">.</span><span class="ident" id="5094504">out</span><span class="op" id="5094507">.</span><span class="ident" id="5094508">Write</span><span class="op" id="5094513">(</span><span class="op" id="5094514">[</span><span class="op" id="5094515">]</span><span class="builtintype" id="5094516">byte</span><span class="op" id="5094520">(</span><span class="ident" id="5094521">f</span><span class="op" id="5094522">)</span><span class="op" id="5094523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094527">l</span><span class="op" id="5094528">.</span><span class="ident" id="5094529">n</span>&nbsp;<span class="op" id="5094531">+=</span>&nbsp;<span class="ident" id="5094534">l</span><span class="op" id="5094535">.</span><span class="ident" id="5094536">pendSpace</span>&nbsp;<span class="op" id="5094546">+</span>&nbsp;<span class="ident" id="5094548">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094552">l</span><span class="op" id="5094553">.</span><span class="ident" id="5094554">pendSpace</span>&nbsp;<span class="op" id="5094564">=</span>&nbsp;<span class="num" id="5094566">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094569">}</span><br>
<span class="lineno"></span><span class="op" id="5094571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5094574">func</span>&nbsp;<span class="op" id="5094579">(</span><span class="ident" id="5094580">l</span>&nbsp;<span class="op" id="5094582">*</span><span class="ident" id="5094583">lineWrapper</span><span class="op" id="5094594">)</span>&nbsp;<span class="ident" id="5094596">flush</span><span class="op" id="5094601">(</span><span class="op" id="5094602">)</span>&nbsp;<span class="op" id="5094604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094607">if</span>&nbsp;<span class="ident" id="5094610">l</span><span class="op" id="5094611">.</span><span class="ident" id="5094612">n</span>&nbsp;<span class="op" id="5094614">==</span>&nbsp;<span class="num" id="5094617">0</span>&nbsp;<span class="op" id="5094619">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094634">l</span><span class="op" id="5094635">.</span><span class="ident" id="5094636">out</span><span class="op" id="5094639">.</span><span class="ident" id="5094640">Write</span><span class="op" id="5094645">(</span><span class="ident" id="5094646">nl</span><span class="op" id="5094648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094651">l</span><span class="op" id="5094652">.</span><span class="ident" id="5094653">pendSpace</span>&nbsp;<span class="op" id="5094663">=</span>&nbsp;<span class="num" id="5094665">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094668">l</span><span class="op" id="5094669">.</span><span class="ident" id="5094670">n</span>&nbsp;<span class="op" id="5094672">=</span>&nbsp;<span class="num" id="5094674">0</span><br>
<span class="lineno">480</span><span class="op" id="5094676">}</span>
</div>
</body>
</html>
