<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html" class="current">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6278088">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6278143">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6278197">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6278248">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6278333">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6278381">//&nbsp;&nbsp;&nbsp;&nbsp;8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6278403">//&nbsp;&nbsp;&nbsp;&nbsp;AUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6278425">//&nbsp;&nbsp;&nbsp;&nbsp;STARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6278447">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6278499">package</span>&nbsp;<span class="ident" id="6278507">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6278513">import</span>&nbsp;<span class="op" id="6278520">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278523">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278537">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278556">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278566">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278572">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278579">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6278596">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6278606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6278609">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6278671">type</span>&nbsp;<span class="ident" id="6278676">Client</span>&nbsp;<span class="keyword" id="6278683">struct</span>&nbsp;<span class="op" id="6278690">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6278693">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6278772">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278803">Text</span>&nbsp;<span class="op" id="6278808">*</span><span class="ident" id="6278809">textproto</span><span class="op" id="6278818">.</span><span class="ident" id="6278819">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6278825">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6278898">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278919">conn</span>&nbsp;<span class="ident" id="6278924">net</span><span class="op" id="6278927">.</span><span class="ident" id="6278928">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6278934">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278970">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6278981">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278987">serverName</span>&nbsp;<span class="builtintype" id="6278998">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6279006">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279038">ext</span>&nbsp;<span class="keyword" id="6279042">map</span><span class="op" id="6279045">[</span><span class="builtintype" id="6279046">string</span><span class="op" id="6279052">]</span><span class="builtintype" id="6279053">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6279061">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279091">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279102">[</span><span class="op" id="6279103">]</span><span class="builtintype" id="6279104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279112">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6279123">string</span>&nbsp;<span class="comment" id="6279130">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279163">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6279174">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6279181">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279214">helloError</span>&nbsp;<span class="builtintype" id="6279225">error</span>&nbsp;&nbsp;<span class="comment" id="6279232">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6279260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6279263">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6279329">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6279369">func</span>&nbsp;<span class="ident" id="6279374">Dial</span><span class="op" id="6279378">(</span><span class="ident" id="6279379">addr</span>&nbsp;<span class="builtintype" id="6279384">string</span><span class="op" id="6279390">)</span>&nbsp;<span class="op" id="6279392">(</span><span class="op" id="6279393">*</span><span class="ident" id="6279394">Client</span><span class="op" id="6279400">,</span>&nbsp;<span class="builtintype" id="6279402">error</span><span class="op" id="6279407">)</span>&nbsp;<span class="op" id="6279409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279412">conn</span><span class="op" id="6279416">,</span>&nbsp;<span class="ident" id="6279418">err</span>&nbsp;<span class="op" id="6279422">:=</span>&nbsp;<span class="ident" id="6279425">net</span><span class="op" id="6279428">.</span><span class="ident" id="6279429">Dial</span><span class="op" id="6279433">(</span><span class="string" id="6279434">&#34;tcp&#34;</span><span class="op" id="6279439">,</span>&nbsp;<span class="ident" id="6279441">addr</span><span class="op" id="6279445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279448">if</span>&nbsp;<span class="ident" id="6279451">err</span>&nbsp;<span class="op" id="6279455">!=</span>&nbsp;<span class="ident" id="6279458">nil</span>&nbsp;<span class="op" id="6279462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279466">return</span>&nbsp;<span class="ident" id="6279473">nil</span><span class="op" id="6279476">,</span>&nbsp;<span class="ident" id="6279478">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279483">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279486">host</span><span class="op" id="6279490">,</span>&nbsp;<span class="ident" id="6279492">_</span><span class="op" id="6279493">,</span>&nbsp;<span class="ident" id="6279495">_</span>&nbsp;<span class="op" id="6279497">:=</span>&nbsp;<span class="ident" id="6279500">net</span><span class="op" id="6279503">.</span><span class="ident" id="6279504">SplitHostPort</span><span class="op" id="6279517">(</span><span class="ident" id="6279518">addr</span><span class="op" id="6279522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279525">return</span>&nbsp;<span class="ident" id="6279532">NewClient</span><span class="op" id="6279541">(</span><span class="ident" id="6279542">conn</span><span class="op" id="6279546">,</span>&nbsp;<span class="ident" id="6279548">host</span><span class="op" id="6279552">)</span><br>
<span class="lineno"></span><span class="op" id="6279554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6279557">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6279634">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6279681">func</span>&nbsp;<span class="ident" id="6279686">NewClient</span><span class="op" id="6279695">(</span><span class="ident" id="6279696">conn</span>&nbsp;<span class="ident" id="6279701">net</span><span class="op" id="6279704">.</span><span class="ident" id="6279705">Conn</span><span class="op" id="6279709">,</span>&nbsp;<span class="ident" id="6279711">host</span>&nbsp;<span class="builtintype" id="6279716">string</span><span class="op" id="6279722">)</span>&nbsp;<span class="op" id="6279724">(</span><span class="op" id="6279725">*</span><span class="ident" id="6279726">Client</span><span class="op" id="6279732">,</span>&nbsp;<span class="builtintype" id="6279734">error</span><span class="op" id="6279739">)</span>&nbsp;<span class="op" id="6279741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279744">text</span>&nbsp;<span class="op" id="6279749">:=</span>&nbsp;<span class="ident" id="6279752">textproto</span><span class="op" id="6279761">.</span><span class="ident" id="6279762">NewConn</span><span class="op" id="6279769">(</span><span class="ident" id="6279770">conn</span><span class="op" id="6279774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279777">_</span><span class="op" id="6279778">,</span>&nbsp;<span class="ident" id="6279780">_</span><span class="op" id="6279781">,</span>&nbsp;<span class="ident" id="6279783">err</span>&nbsp;<span class="op" id="6279787">:=</span>&nbsp;<span class="ident" id="6279790">text</span><span class="op" id="6279794">.</span><span class="ident" id="6279795">ReadResponse</span><span class="op" id="6279807">(</span><span class="num" id="6279808">220</span><span class="op" id="6279811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279814">if</span>&nbsp;<span class="ident" id="6279817">err</span>&nbsp;<span class="op" id="6279821">!=</span>&nbsp;<span class="ident" id="6279824">nil</span>&nbsp;<span class="op" id="6279828">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279832">text</span><span class="op" id="6279836">.</span><span class="ident" id="6279837">Close</span><span class="op" id="6279842">(</span><span class="op" id="6279843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279847">return</span>&nbsp;<span class="ident" id="6279854">nil</span><span class="op" id="6279857">,</span>&nbsp;<span class="ident" id="6279859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279867">c</span>&nbsp;<span class="op" id="6279869">:=</span>&nbsp;<span class="op" id="6279872">&amp;</span><span class="ident" id="6279873">Client</span><span class="op" id="6279879">{</span><span class="ident" id="6279880">Text</span><span class="op" id="6279884">:</span>&nbsp;<span class="ident" id="6279886">text</span><span class="op" id="6279890">,</span>&nbsp;<span class="ident" id="6279892">conn</span><span class="op" id="6279896">:</span>&nbsp;<span class="ident" id="6279898">conn</span><span class="op" id="6279902">,</span>&nbsp;<span class="ident" id="6279904">serverName</span><span class="op" id="6279914">:</span>&nbsp;<span class="ident" id="6279916">host</span><span class="op" id="6279920">,</span>&nbsp;<span class="ident" id="6279922">localName</span><span class="op" id="6279931">:</span>&nbsp;<span class="string" id="6279933">&#34;localhost&#34;</span><span class="op" id="6279944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279947">return</span>&nbsp;<span class="ident" id="6279954">c</span><span class="op" id="6279955">,</span>&nbsp;<span class="ident" id="6279957">nil</span><br>
<span class="lineno">65</span><span class="op" id="6279961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6279964">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6279996">func</span>&nbsp;<span class="op" id="6280001">(</span><span class="ident" id="6280002">c</span>&nbsp;<span class="op" id="6280004">*</span><span class="ident" id="6280005">Client</span><span class="op" id="6280011">)</span>&nbsp;<span class="ident" id="6280013">Close</span><span class="op" id="6280018">(</span><span class="op" id="6280019">)</span>&nbsp;<span class="builtintype" id="6280021">error</span>&nbsp;<span class="op" id="6280027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280030">return</span>&nbsp;<span class="ident" id="6280037">c</span><span class="op" id="6280038">.</span><span class="ident" id="6280039">Text</span><span class="op" id="6280043">.</span><span class="ident" id="6280044">Close</span><span class="op" id="6280049">(</span><span class="op" id="6280050">)</span><br>
<span class="lineno">70</span><span class="op" id="6280052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6280055">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6280097">func</span>&nbsp;<span class="op" id="6280102">(</span><span class="ident" id="6280103">c</span>&nbsp;<span class="op" id="6280105">*</span><span class="ident" id="6280106">Client</span><span class="op" id="6280112">)</span>&nbsp;<span class="ident" id="6280114">hello</span><span class="op" id="6280119">(</span><span class="op" id="6280120">)</span>&nbsp;<span class="builtintype" id="6280122">error</span>&nbsp;<span class="op" id="6280128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280131">if</span>&nbsp;<span class="op" id="6280134">!</span><span class="ident" id="6280135">c</span><span class="op" id="6280136">.</span><span class="ident" id="6280137">didHello</span>&nbsp;<span class="op" id="6280146">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280150">c</span><span class="op" id="6280151">.</span><span class="ident" id="6280152">didHello</span>&nbsp;<span class="op" id="6280161">=</span>&nbsp;<span class="builtintype" id="6280163">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280170">err</span>&nbsp;<span class="op" id="6280174">:=</span>&nbsp;<span class="ident" id="6280177">c</span><span class="op" id="6280178">.</span><span class="ident" id="6280179">ehlo</span><span class="op" id="6280183">(</span><span class="op" id="6280184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280188">if</span>&nbsp;<span class="ident" id="6280191">err</span>&nbsp;<span class="op" id="6280195">!=</span>&nbsp;<span class="ident" id="6280198">nil</span>&nbsp;<span class="op" id="6280202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280207">c</span><span class="op" id="6280208">.</span><span class="ident" id="6280209">helloError</span>&nbsp;<span class="op" id="6280220">=</span>&nbsp;<span class="ident" id="6280222">c</span><span class="op" id="6280223">.</span><span class="ident" id="6280224">helo</span><span class="op" id="6280228">(</span><span class="op" id="6280229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6280233">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6280236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280239">return</span>&nbsp;<span class="ident" id="6280246">c</span><span class="op" id="6280247">.</span><span class="ident" id="6280248">helloError</span><br>
<span class="lineno"></span><span class="op" id="6280259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6280262">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6280330">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6280399">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6280476">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6280550">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6280579">func</span>&nbsp;<span class="op" id="6280584">(</span><span class="ident" id="6280585">c</span>&nbsp;<span class="op" id="6280587">*</span><span class="ident" id="6280588">Client</span><span class="op" id="6280594">)</span>&nbsp;<span class="ident" id="6280596">Hello</span><span class="op" id="6280601">(</span><span class="ident" id="6280602">localName</span>&nbsp;<span class="builtintype" id="6280612">string</span><span class="op" id="6280618">)</span>&nbsp;<span class="builtintype" id="6280620">error</span>&nbsp;<span class="op" id="6280626">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280629">if</span>&nbsp;<span class="ident" id="6280632">c</span><span class="op" id="6280633">.</span><span class="ident" id="6280634">didHello</span>&nbsp;<span class="op" id="6280643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280647">return</span>&nbsp;<span class="ident" id="6280654">errors</span><span class="op" id="6280660">.</span><span class="ident" id="6280661">New</span><span class="op" id="6280664">(</span><span class="string" id="6280665">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6280705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6280708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280711">c</span><span class="op" id="6280712">.</span><span class="ident" id="6280713">localName</span>&nbsp;<span class="op" id="6280723">=</span>&nbsp;<span class="ident" id="6280725">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280736">return</span>&nbsp;<span class="ident" id="6280743">c</span><span class="op" id="6280744">.</span><span class="ident" id="6280745">hello</span><span class="op" id="6280750">(</span><span class="op" id="6280751">)</span><br>
<span class="lineno">95</span><span class="op" id="6280753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6280756">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6280835">func</span>&nbsp;<span class="op" id="6280840">(</span><span class="ident" id="6280841">c</span>&nbsp;<span class="op" id="6280843">*</span><span class="ident" id="6280844">Client</span><span class="op" id="6280850">)</span>&nbsp;<span class="ident" id="6280852">cmd</span><span class="op" id="6280855">(</span><span class="ident" id="6280856">expectCode</span>&nbsp;<span class="builtintype" id="6280867">int</span><span class="op" id="6280870">,</span>&nbsp;<span class="ident" id="6280872">format</span>&nbsp;<span class="builtintype" id="6280879">string</span><span class="op" id="6280885">,</span>&nbsp;<span class="ident" id="6280887">args</span>&nbsp;<span class="op" id="6280892">...</span><span class="keyword" id="6280895">interface</span><span class="op" id="6280904">{</span><span class="op" id="6280905">}</span><span class="op" id="6280906">)</span>&nbsp;<span class="op" id="6280908">(</span><span class="builtintype" id="6280909">int</span><span class="op" id="6280912">,</span>&nbsp;<span class="builtintype" id="6280914">string</span><span class="op" id="6280920">,</span>&nbsp;<span class="builtintype" id="6280922">error</span><span class="op" id="6280927">)</span>&nbsp;<span class="op" id="6280929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280932">id</span><span class="op" id="6280934">,</span>&nbsp;<span class="ident" id="6280936">err</span>&nbsp;<span class="op" id="6280940">:=</span>&nbsp;<span class="ident" id="6280943">c</span><span class="op" id="6280944">.</span><span class="ident" id="6280945">Text</span><span class="op" id="6280949">.</span><span class="ident" id="6280950">Cmd</span><span class="op" id="6280953">(</span><span class="ident" id="6280954">format</span><span class="op" id="6280960">,</span>&nbsp;<span class="ident" id="6280962">args</span><span class="op" id="6280966">...</span><span class="op" id="6280969">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280972">if</span>&nbsp;<span class="ident" id="6280975">err</span>&nbsp;<span class="op" id="6280979">!=</span>&nbsp;<span class="ident" id="6280982">nil</span>&nbsp;<span class="op" id="6280986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280990">return</span>&nbsp;<span class="num" id="6280997">0</span><span class="op" id="6280998">,</span>&nbsp;<span class="string" id="6281000">&#34;&#34;</span><span class="op" id="6281002">,</span>&nbsp;<span class="ident" id="6281004">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281012">c</span><span class="op" id="6281013">.</span><span class="ident" id="6281014">Text</span><span class="op" id="6281018">.</span><span class="ident" id="6281019">StartResponse</span><span class="op" id="6281032">(</span><span class="ident" id="6281033">id</span><span class="op" id="6281035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281038">defer</span>&nbsp;<span class="ident" id="6281044">c</span><span class="op" id="6281045">.</span><span class="ident" id="6281046">Text</span><span class="op" id="6281050">.</span><span class="ident" id="6281051">EndResponse</span><span class="op" id="6281062">(</span><span class="ident" id="6281063">id</span><span class="op" id="6281065">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281068">code</span><span class="op" id="6281072">,</span>&nbsp;<span class="ident" id="6281074">msg</span><span class="op" id="6281077">,</span>&nbsp;<span class="ident" id="6281079">err</span>&nbsp;<span class="op" id="6281083">:=</span>&nbsp;<span class="ident" id="6281086">c</span><span class="op" id="6281087">.</span><span class="ident" id="6281088">Text</span><span class="op" id="6281092">.</span><span class="ident" id="6281093">ReadResponse</span><span class="op" id="6281105">(</span><span class="ident" id="6281106">expectCode</span><span class="op" id="6281116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281119">return</span>&nbsp;<span class="ident" id="6281126">code</span><span class="op" id="6281130">,</span>&nbsp;<span class="ident" id="6281132">msg</span><span class="op" id="6281135">,</span>&nbsp;<span class="ident" id="6281137">err</span><br>
<span class="lineno"></span><span class="op" id="6281141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6281144">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6281223">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6281256">func</span>&nbsp;<span class="op" id="6281261">(</span><span class="ident" id="6281262">c</span>&nbsp;<span class="op" id="6281264">*</span><span class="ident" id="6281265">Client</span><span class="op" id="6281271">)</span>&nbsp;<span class="ident" id="6281273">helo</span><span class="op" id="6281277">(</span><span class="op" id="6281278">)</span>&nbsp;<span class="builtintype" id="6281280">error</span>&nbsp;<span class="op" id="6281286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281289">c</span><span class="op" id="6281290">.</span><span class="ident" id="6281291">ext</span>&nbsp;<span class="op" id="6281295">=</span>&nbsp;<span class="ident" id="6281297">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281302">_</span><span class="op" id="6281303">,</span>&nbsp;<span class="ident" id="6281305">_</span><span class="op" id="6281306">,</span>&nbsp;<span class="ident" id="6281308">err</span>&nbsp;<span class="op" id="6281312">:=</span>&nbsp;<span class="ident" id="6281315">c</span><span class="op" id="6281316">.</span><span class="ident" id="6281317">cmd</span><span class="op" id="6281320">(</span><span class="num" id="6281321">250</span><span class="op" id="6281324">,</span>&nbsp;<span class="string" id="6281326">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6281335">,</span>&nbsp;<span class="ident" id="6281337">c</span><span class="op" id="6281338">.</span><span class="ident" id="6281339">localName</span><span class="op" id="6281348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281351">return</span>&nbsp;<span class="ident" id="6281358">err</span><br>
<span class="lineno">115</span><span class="op" id="6281362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6281365">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6281432">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6281497">func</span>&nbsp;<span class="op" id="6281502">(</span><span class="ident" id="6281503">c</span>&nbsp;<span class="op" id="6281505">*</span><span class="ident" id="6281506">Client</span><span class="op" id="6281512">)</span>&nbsp;<span class="ident" id="6281514">ehlo</span><span class="op" id="6281518">(</span><span class="op" id="6281519">)</span>&nbsp;<span class="builtintype" id="6281521">error</span>&nbsp;<span class="op" id="6281527">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281530">_</span><span class="op" id="6281531">,</span>&nbsp;<span class="ident" id="6281533">msg</span><span class="op" id="6281536">,</span>&nbsp;<span class="ident" id="6281538">err</span>&nbsp;<span class="op" id="6281542">:=</span>&nbsp;<span class="ident" id="6281545">c</span><span class="op" id="6281546">.</span><span class="ident" id="6281547">cmd</span><span class="op" id="6281550">(</span><span class="num" id="6281551">250</span><span class="op" id="6281554">,</span>&nbsp;<span class="string" id="6281556">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6281565">,</span>&nbsp;<span class="ident" id="6281567">c</span><span class="op" id="6281568">.</span><span class="ident" id="6281569">localName</span><span class="op" id="6281578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281581">if</span>&nbsp;<span class="ident" id="6281584">err</span>&nbsp;<span class="op" id="6281588">!=</span>&nbsp;<span class="ident" id="6281591">nil</span>&nbsp;<span class="op" id="6281595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281599">return</span>&nbsp;<span class="ident" id="6281606">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281614">ext</span>&nbsp;<span class="op" id="6281618">:=</span>&nbsp;<span class="builtinfunc" id="6281621">make</span><span class="op" id="6281625">(</span><span class="keyword" id="6281626">map</span><span class="op" id="6281629">[</span><span class="builtintype" id="6281630">string</span><span class="op" id="6281636">]</span><span class="builtintype" id="6281637">string</span><span class="op" id="6281643">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281646">extList</span>&nbsp;<span class="op" id="6281654">:=</span>&nbsp;<span class="ident" id="6281657">strings</span><span class="op" id="6281664">.</span><span class="ident" id="6281665">Split</span><span class="op" id="6281670">(</span><span class="ident" id="6281671">msg</span><span class="op" id="6281674">,</span>&nbsp;<span class="string" id="6281676">&#34;\n&#34;</span><span class="op" id="6281680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281683">if</span>&nbsp;<span class="builtinfunc" id="6281686">len</span><span class="op" id="6281689">(</span><span class="ident" id="6281690">extList</span><span class="op" id="6281697">)</span>&nbsp;<span class="op" id="6281699">&gt;</span>&nbsp;<span class="num" id="6281701">1</span>&nbsp;<span class="op" id="6281703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281707">extList</span>&nbsp;<span class="op" id="6281715">=</span>&nbsp;<span class="ident" id="6281717">extList</span><span class="op" id="6281724">[</span><span class="num" id="6281725">1</span><span class="op" id="6281726">:</span><span class="op" id="6281727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281731">for</span>&nbsp;<span class="ident" id="6281735">_</span><span class="op" id="6281736">,</span>&nbsp;<span class="ident" id="6281738">line</span>&nbsp;<span class="op" id="6281743">:=</span>&nbsp;<span class="keyword" id="6281746">range</span>&nbsp;<span class="ident" id="6281752">extList</span>&nbsp;<span class="op" id="6281760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281765">args</span>&nbsp;<span class="op" id="6281770">:=</span>&nbsp;<span class="ident" id="6281773">strings</span><span class="op" id="6281780">.</span><span class="ident" id="6281781">SplitN</span><span class="op" id="6281787">(</span><span class="ident" id="6281788">line</span><span class="op" id="6281792">,</span>&nbsp;<span class="string" id="6281794">&#34;&nbsp;&#34;</span><span class="op" id="6281797">,</span>&nbsp;<span class="num" id="6281799">2</span><span class="op" id="6281800">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281805">if</span>&nbsp;<span class="builtinfunc" id="6281808">len</span><span class="op" id="6281811">(</span><span class="ident" id="6281812">args</span><span class="op" id="6281816">)</span>&nbsp;<span class="op" id="6281818">&gt;</span>&nbsp;<span class="num" id="6281820">1</span>&nbsp;<span class="op" id="6281822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281828">ext</span><span class="op" id="6281831">[</span><span class="ident" id="6281832">args</span><span class="op" id="6281836">[</span><span class="num" id="6281837">0</span><span class="op" id="6281838">]</span><span class="op" id="6281839">]</span>&nbsp;<span class="op" id="6281841">=</span>&nbsp;<span class="ident" id="6281843">args</span><span class="op" id="6281847">[</span><span class="num" id="6281848">1</span><span class="op" id="6281849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281854">}</span>&nbsp;<span class="keyword" id="6281856">else</span>&nbsp;<span class="op" id="6281861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281867">ext</span><span class="op" id="6281870">[</span><span class="ident" id="6281871">args</span><span class="op" id="6281875">[</span><span class="num" id="6281876">0</span><span class="op" id="6281877">]</span><span class="op" id="6281878">]</span>&nbsp;<span class="op" id="6281880">=</span>&nbsp;<span class="string" id="6281882">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281888">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281898">if</span>&nbsp;<span class="ident" id="6281901">mechs</span><span class="op" id="6281906">,</span>&nbsp;<span class="ident" id="6281908">ok</span>&nbsp;<span class="op" id="6281911">:=</span>&nbsp;<span class="ident" id="6281914">ext</span><span class="op" id="6281917">[</span><span class="string" id="6281918">&#34;AUTH&#34;</span><span class="op" id="6281924">]</span><span class="op" id="6281925">;</span>&nbsp;<span class="ident" id="6281927">ok</span>&nbsp;<span class="op" id="6281930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281934">c</span><span class="op" id="6281935">.</span><span class="ident" id="6281936">auth</span>&nbsp;<span class="op" id="6281941">=</span>&nbsp;<span class="ident" id="6281943">strings</span><span class="op" id="6281950">.</span><span class="ident" id="6281951">Split</span><span class="op" id="6281956">(</span><span class="ident" id="6281957">mechs</span><span class="op" id="6281962">,</span>&nbsp;<span class="string" id="6281964">&#34;&nbsp;&#34;</span><span class="op" id="6281967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281970">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281973">c</span><span class="op" id="6281974">.</span><span class="ident" id="6281975">ext</span>&nbsp;<span class="op" id="6281979">=</span>&nbsp;<span class="ident" id="6281981">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281986">return</span>&nbsp;<span class="ident" id="6281993">err</span><br>
<span class="lineno"></span><span class="op" id="6281997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6282000">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6282079">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6282156">func</span>&nbsp;<span class="op" id="6282161">(</span><span class="ident" id="6282162">c</span>&nbsp;<span class="op" id="6282164">*</span><span class="ident" id="6282165">Client</span><span class="op" id="6282171">)</span>&nbsp;<span class="ident" id="6282173">StartTLS</span><span class="op" id="6282181">(</span><span class="ident" id="6282182">config</span>&nbsp;<span class="op" id="6282189">*</span><span class="ident" id="6282190">tls</span><span class="op" id="6282193">.</span><span class="ident" id="6282194">Config</span><span class="op" id="6282200">)</span>&nbsp;<span class="builtintype" id="6282202">error</span>&nbsp;<span class="op" id="6282208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282211">if</span>&nbsp;<span class="ident" id="6282214">err</span>&nbsp;<span class="op" id="6282218">:=</span>&nbsp;<span class="ident" id="6282221">c</span><span class="op" id="6282222">.</span><span class="ident" id="6282223">hello</span><span class="op" id="6282228">(</span><span class="op" id="6282229">)</span><span class="op" id="6282230">;</span>&nbsp;<span class="ident" id="6282232">err</span>&nbsp;<span class="op" id="6282236">!=</span>&nbsp;<span class="ident" id="6282239">nil</span>&nbsp;<span class="op" id="6282243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282247">return</span>&nbsp;<span class="ident" id="6282254">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6282259">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282262">_</span><span class="op" id="6282263">,</span>&nbsp;<span class="ident" id="6282265">_</span><span class="op" id="6282266">,</span>&nbsp;<span class="ident" id="6282268">err</span>&nbsp;<span class="op" id="6282272">:=</span>&nbsp;<span class="ident" id="6282275">c</span><span class="op" id="6282276">.</span><span class="ident" id="6282277">cmd</span><span class="op" id="6282280">(</span><span class="num" id="6282281">220</span><span class="op" id="6282284">,</span>&nbsp;<span class="string" id="6282286">&#34;STARTTLS&#34;</span><span class="op" id="6282296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282299">if</span>&nbsp;<span class="ident" id="6282302">err</span>&nbsp;<span class="op" id="6282306">!=</span>&nbsp;<span class="ident" id="6282309">nil</span>&nbsp;<span class="op" id="6282313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282317">return</span>&nbsp;<span class="ident" id="6282324">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6282329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282332">c</span><span class="op" id="6282333">.</span><span class="ident" id="6282334">conn</span>&nbsp;<span class="op" id="6282339">=</span>&nbsp;<span class="ident" id="6282341">tls</span><span class="op" id="6282344">.</span><span class="ident" id="6282345">Client</span><span class="op" id="6282351">(</span><span class="ident" id="6282352">c</span><span class="op" id="6282353">.</span><span class="ident" id="6282354">conn</span><span class="op" id="6282358">,</span>&nbsp;<span class="ident" id="6282360">config</span><span class="op" id="6282366">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282369">c</span><span class="op" id="6282370">.</span><span class="ident" id="6282371">Text</span>&nbsp;<span class="op" id="6282376">=</span>&nbsp;<span class="ident" id="6282378">textproto</span><span class="op" id="6282387">.</span><span class="ident" id="6282388">NewConn</span><span class="op" id="6282395">(</span><span class="ident" id="6282396">c</span><span class="op" id="6282397">.</span><span class="ident" id="6282398">conn</span><span class="op" id="6282402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282405">c</span><span class="op" id="6282406">.</span><span class="ident" id="6282407">tls</span>&nbsp;<span class="op" id="6282411">=</span>&nbsp;<span class="builtintype" id="6282413">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282419">return</span>&nbsp;<span class="ident" id="6282426">c</span><span class="op" id="6282427">.</span><span class="ident" id="6282428">ehlo</span><span class="op" id="6282432">(</span><span class="op" id="6282433">)</span><br>
<span class="lineno"></span><span class="op" id="6282435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6282438">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6282503">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6282568">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6282634">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6282685">func</span>&nbsp;<span class="op" id="6282690">(</span><span class="ident" id="6282691">c</span>&nbsp;<span class="op" id="6282693">*</span><span class="ident" id="6282694">Client</span><span class="op" id="6282700">)</span>&nbsp;<span class="ident" id="6282702">Verify</span><span class="op" id="6282708">(</span><span class="ident" id="6282709">addr</span>&nbsp;<span class="builtintype" id="6282714">string</span><span class="op" id="6282720">)</span>&nbsp;<span class="builtintype" id="6282722">error</span>&nbsp;<span class="op" id="6282728">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282731">if</span>&nbsp;<span class="ident" id="6282734">err</span>&nbsp;<span class="op" id="6282738">:=</span>&nbsp;<span class="ident" id="6282741">c</span><span class="op" id="6282742">.</span><span class="ident" id="6282743">hello</span><span class="op" id="6282748">(</span><span class="op" id="6282749">)</span><span class="op" id="6282750">;</span>&nbsp;<span class="ident" id="6282752">err</span>&nbsp;<span class="op" id="6282756">!=</span>&nbsp;<span class="ident" id="6282759">nil</span>&nbsp;<span class="op" id="6282763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282767">return</span>&nbsp;<span class="ident" id="6282774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6282779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282782">_</span><span class="op" id="6282783">,</span>&nbsp;<span class="ident" id="6282785">_</span><span class="op" id="6282786">,</span>&nbsp;<span class="ident" id="6282788">err</span>&nbsp;<span class="op" id="6282792">:=</span>&nbsp;<span class="ident" id="6282795">c</span><span class="op" id="6282796">.</span><span class="ident" id="6282797">cmd</span><span class="op" id="6282800">(</span><span class="num" id="6282801">250</span><span class="op" id="6282804">,</span>&nbsp;<span class="string" id="6282806">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6282815">,</span>&nbsp;<span class="ident" id="6282817">addr</span><span class="op" id="6282821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282824">return</span>&nbsp;<span class="ident" id="6282831">err</span><br>
<span class="lineno">170</span><span class="op" id="6282835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6282838">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6282914">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6282964">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6283037">func</span>&nbsp;<span class="op" id="6283042">(</span><span class="ident" id="6283043">c</span>&nbsp;<span class="op" id="6283045">*</span><span class="ident" id="6283046">Client</span><span class="op" id="6283052">)</span>&nbsp;<span class="ident" id="6283054">Auth</span><span class="op" id="6283058">(</span><span class="ident" id="6283059">a</span>&nbsp;<span class="ident" id="6283061">Auth</span><span class="op" id="6283065">)</span>&nbsp;<span class="builtintype" id="6283067">error</span>&nbsp;<span class="op" id="6283073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283076">if</span>&nbsp;<span class="ident" id="6283079">err</span>&nbsp;<span class="op" id="6283083">:=</span>&nbsp;<span class="ident" id="6283086">c</span><span class="op" id="6283087">.</span><span class="ident" id="6283088">hello</span><span class="op" id="6283093">(</span><span class="op" id="6283094">)</span><span class="op" id="6283095">;</span>&nbsp;<span class="ident" id="6283097">err</span>&nbsp;<span class="op" id="6283101">!=</span>&nbsp;<span class="ident" id="6283104">nil</span>&nbsp;<span class="op" id="6283108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283112">return</span>&nbsp;<span class="ident" id="6283119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283127">encoding</span>&nbsp;<span class="op" id="6283136">:=</span>&nbsp;<span class="ident" id="6283139">base64</span><span class="op" id="6283145">.</span><span class="ident" id="6283146">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283159">mech</span><span class="op" id="6283163">,</span>&nbsp;<span class="ident" id="6283165">resp</span><span class="op" id="6283169">,</span>&nbsp;<span class="ident" id="6283171">err</span>&nbsp;<span class="op" id="6283175">:=</span>&nbsp;<span class="ident" id="6283178">a</span><span class="op" id="6283179">.</span><span class="ident" id="6283180">Start</span><span class="op" id="6283185">(</span><span class="op" id="6283186">&amp;</span><span class="ident" id="6283187">ServerInfo</span><span class="op" id="6283197">{</span><span class="ident" id="6283198">c</span><span class="op" id="6283199">.</span><span class="ident" id="6283200">serverName</span><span class="op" id="6283210">,</span>&nbsp;<span class="ident" id="6283212">c</span><span class="op" id="6283213">.</span><span class="ident" id="6283214">tls</span><span class="op" id="6283217">,</span>&nbsp;<span class="ident" id="6283219">c</span><span class="op" id="6283220">.</span><span class="ident" id="6283221">auth</span><span class="op" id="6283225">}</span><span class="op" id="6283226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283229">if</span>&nbsp;<span class="ident" id="6283232">err</span>&nbsp;<span class="op" id="6283236">!=</span>&nbsp;<span class="ident" id="6283239">nil</span>&nbsp;<span class="op" id="6283243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283247">c</span><span class="op" id="6283248">.</span><span class="ident" id="6283249">Quit</span><span class="op" id="6283253">(</span><span class="op" id="6283254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283258">return</span>&nbsp;<span class="ident" id="6283265">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283270">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283273">resp64</span>&nbsp;<span class="op" id="6283280">:=</span>&nbsp;<span class="builtinfunc" id="6283283">make</span><span class="op" id="6283287">(</span><span class="op" id="6283288">[</span><span class="op" id="6283289">]</span><span class="builtintype" id="6283290">byte</span><span class="op" id="6283294">,</span>&nbsp;<span class="ident" id="6283296">encoding</span><span class="op" id="6283304">.</span><span class="ident" id="6283305">EncodedLen</span><span class="op" id="6283315">(</span><span class="builtinfunc" id="6283316">len</span><span class="op" id="6283319">(</span><span class="ident" id="6283320">resp</span><span class="op" id="6283324">)</span><span class="op" id="6283325">)</span><span class="op" id="6283326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283329">encoding</span><span class="op" id="6283337">.</span><span class="ident" id="6283338">Encode</span><span class="op" id="6283344">(</span><span class="ident" id="6283345">resp64</span><span class="op" id="6283351">,</span>&nbsp;<span class="ident" id="6283353">resp</span><span class="op" id="6283357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283360">code</span><span class="op" id="6283364">,</span>&nbsp;<span class="ident" id="6283366">msg64</span><span class="op" id="6283371">,</span>&nbsp;<span class="ident" id="6283373">err</span>&nbsp;<span class="op" id="6283377">:=</span>&nbsp;<span class="ident" id="6283380">c</span><span class="op" id="6283381">.</span><span class="ident" id="6283382">cmd</span><span class="op" id="6283385">(</span><span class="num" id="6283386">0</span><span class="op" id="6283387">,</span>&nbsp;<span class="string" id="6283389">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6283401">,</span>&nbsp;<span class="ident" id="6283403">mech</span><span class="op" id="6283407">,</span>&nbsp;<span class="ident" id="6283409">resp64</span><span class="op" id="6283415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283418">for</span>&nbsp;<span class="ident" id="6283422">err</span>&nbsp;<span class="op" id="6283426">==</span>&nbsp;<span class="ident" id="6283429">nil</span>&nbsp;<span class="op" id="6283433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283437">var</span>&nbsp;<span class="ident" id="6283441">msg</span>&nbsp;<span class="op" id="6283445">[</span><span class="op" id="6283446">]</span><span class="builtintype" id="6283447">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283454">switch</span>&nbsp;<span class="ident" id="6283461">code</span>&nbsp;<span class="op" id="6283466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283470">case</span>&nbsp;<span class="num" id="6283475">334</span><span class="op" id="6283478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283483">msg</span><span class="op" id="6283486">,</span>&nbsp;<span class="ident" id="6283488">err</span>&nbsp;<span class="op" id="6283492">=</span>&nbsp;<span class="ident" id="6283494">encoding</span><span class="op" id="6283502">.</span><span class="ident" id="6283503">DecodeString</span><span class="op" id="6283515">(</span><span class="ident" id="6283516">msg64</span><span class="op" id="6283521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283525">case</span>&nbsp;<span class="num" id="6283530">235</span><span class="op" id="6283533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283538">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283603">msg</span>&nbsp;<span class="op" id="6283607">=</span>&nbsp;<span class="op" id="6283609">[</span><span class="op" id="6283610">]</span><span class="builtintype" id="6283611">byte</span><span class="op" id="6283615">(</span><span class="ident" id="6283616">msg64</span><span class="op" id="6283621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283625">default</span><span class="op" id="6283632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283637">err</span>&nbsp;<span class="op" id="6283641">=</span>&nbsp;<span class="op" id="6283643">&amp;</span><span class="ident" id="6283644">textproto</span><span class="op" id="6283653">.</span><span class="ident" id="6283654">Error</span><span class="op" id="6283659">{</span><span class="ident" id="6283660">Code</span><span class="op" id="6283664">:</span>&nbsp;<span class="ident" id="6283666">code</span><span class="op" id="6283670">,</span>&nbsp;<span class="ident" id="6283672">Msg</span><span class="op" id="6283675">:</span>&nbsp;<span class="ident" id="6283677">msg64</span><span class="op" id="6283682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283690">if</span>&nbsp;<span class="ident" id="6283693">err</span>&nbsp;<span class="op" id="6283697">==</span>&nbsp;<span class="ident" id="6283700">nil</span>&nbsp;<span class="op" id="6283704">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283709">resp</span><span class="op" id="6283713">,</span>&nbsp;<span class="ident" id="6283715">err</span>&nbsp;<span class="op" id="6283719">=</span>&nbsp;<span class="ident" id="6283721">a</span><span class="op" id="6283722">.</span><span class="ident" id="6283723">Next</span><span class="op" id="6283727">(</span><span class="ident" id="6283728">msg</span><span class="op" id="6283731">,</span>&nbsp;<span class="ident" id="6283733">code</span>&nbsp;<span class="op" id="6283738">==</span>&nbsp;<span class="num" id="6283741">334</span><span class="op" id="6283744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283752">if</span>&nbsp;<span class="ident" id="6283755">err</span>&nbsp;<span class="op" id="6283759">!=</span>&nbsp;<span class="ident" id="6283762">nil</span>&nbsp;<span class="op" id="6283766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283771">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283792">c</span><span class="op" id="6283793">.</span><span class="ident" id="6283794">cmd</span><span class="op" id="6283797">(</span><span class="num" id="6283798">501</span><span class="op" id="6283801">,</span>&nbsp;<span class="string" id="6283803">&#34;*&#34;</span><span class="op" id="6283806">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283811">c</span><span class="op" id="6283812">.</span><span class="ident" id="6283813">Quit</span><span class="op" id="6283817">(</span><span class="op" id="6283818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283823">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283835">if</span>&nbsp;<span class="ident" id="6283838">resp</span>&nbsp;<span class="op" id="6283843">==</span>&nbsp;<span class="ident" id="6283846">nil</span>&nbsp;<span class="op" id="6283850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283855">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283867">resp64</span>&nbsp;<span class="op" id="6283874">=</span>&nbsp;<span class="builtinfunc" id="6283876">make</span><span class="op" id="6283880">(</span><span class="op" id="6283881">[</span><span class="op" id="6283882">]</span><span class="builtintype" id="6283883">byte</span><span class="op" id="6283887">,</span>&nbsp;<span class="ident" id="6283889">encoding</span><span class="op" id="6283897">.</span><span class="ident" id="6283898">EncodedLen</span><span class="op" id="6283908">(</span><span class="builtinfunc" id="6283909">len</span><span class="op" id="6283912">(</span><span class="ident" id="6283913">resp</span><span class="op" id="6283917">)</span><span class="op" id="6283918">)</span><span class="op" id="6283919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283923">encoding</span><span class="op" id="6283931">.</span><span class="ident" id="6283932">Encode</span><span class="op" id="6283938">(</span><span class="ident" id="6283939">resp64</span><span class="op" id="6283945">,</span>&nbsp;<span class="ident" id="6283947">resp</span><span class="op" id="6283951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283955">code</span><span class="op" id="6283959">,</span>&nbsp;<span class="ident" id="6283961">msg64</span><span class="op" id="6283966">,</span>&nbsp;<span class="ident" id="6283968">err</span>&nbsp;<span class="op" id="6283972">=</span>&nbsp;<span class="ident" id="6283974">c</span><span class="op" id="6283975">.</span><span class="ident" id="6283976">cmd</span><span class="op" id="6283979">(</span><span class="num" id="6283980">0</span><span class="op" id="6283981">,</span>&nbsp;<span class="builtintype" id="6283983">string</span><span class="op" id="6283989">(</span><span class="ident" id="6283990">resp64</span><span class="op" id="6283996">)</span><span class="op" id="6283997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284000">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284003">return</span>&nbsp;<span class="ident" id="6284010">err</span><br>
<span class="lineno"></span><span class="op" id="6284014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6284017">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6284095">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6284173">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6284187">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6284267">func</span>&nbsp;<span class="op" id="6284272">(</span><span class="ident" id="6284273">c</span>&nbsp;<span class="op" id="6284275">*</span><span class="ident" id="6284276">Client</span><span class="op" id="6284282">)</span>&nbsp;<span class="ident" id="6284284">Mail</span><span class="op" id="6284288">(</span><span class="ident" id="6284289">from</span>&nbsp;<span class="builtintype" id="6284294">string</span><span class="op" id="6284300">)</span>&nbsp;<span class="builtintype" id="6284302">error</span>&nbsp;<span class="op" id="6284308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284311">if</span>&nbsp;<span class="ident" id="6284314">err</span>&nbsp;<span class="op" id="6284318">:=</span>&nbsp;<span class="ident" id="6284321">c</span><span class="op" id="6284322">.</span><span class="ident" id="6284323">hello</span><span class="op" id="6284328">(</span><span class="op" id="6284329">)</span><span class="op" id="6284330">;</span>&nbsp;<span class="ident" id="6284332">err</span>&nbsp;<span class="op" id="6284336">!=</span>&nbsp;<span class="ident" id="6284339">nil</span>&nbsp;<span class="op" id="6284343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284347">return</span>&nbsp;<span class="ident" id="6284354">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284362">cmdStr</span>&nbsp;<span class="op" id="6284369">:=</span>&nbsp;<span class="string" id="6284372">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284390">if</span>&nbsp;<span class="ident" id="6284393">c</span><span class="op" id="6284394">.</span><span class="ident" id="6284395">ext</span>&nbsp;<span class="op" id="6284399">!=</span>&nbsp;<span class="ident" id="6284402">nil</span>&nbsp;<span class="op" id="6284406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284410">if</span>&nbsp;<span class="ident" id="6284413">_</span><span class="op" id="6284414">,</span>&nbsp;<span class="ident" id="6284416">ok</span>&nbsp;<span class="op" id="6284419">:=</span>&nbsp;<span class="ident" id="6284422">c</span><span class="op" id="6284423">.</span><span class="ident" id="6284424">ext</span><span class="op" id="6284427">[</span><span class="string" id="6284428">&#34;8BITMIME&#34;</span><span class="op" id="6284438">]</span><span class="op" id="6284439">;</span>&nbsp;<span class="ident" id="6284441">ok</span>&nbsp;<span class="op" id="6284444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284449">cmdStr</span>&nbsp;<span class="op" id="6284456">+=</span>&nbsp;<span class="string" id="6284459">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284484">_</span><span class="op" id="6284485">,</span>&nbsp;<span class="ident" id="6284487">_</span><span class="op" id="6284488">,</span>&nbsp;<span class="ident" id="6284490">err</span>&nbsp;<span class="op" id="6284494">:=</span>&nbsp;<span class="ident" id="6284497">c</span><span class="op" id="6284498">.</span><span class="ident" id="6284499">cmd</span><span class="op" id="6284502">(</span><span class="num" id="6284503">250</span><span class="op" id="6284506">,</span>&nbsp;<span class="ident" id="6284508">cmdStr</span><span class="op" id="6284514">,</span>&nbsp;<span class="ident" id="6284516">from</span><span class="op" id="6284520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284523">return</span>&nbsp;<span class="ident" id="6284530">err</span><br>
<span class="lineno"></span><span class="op" id="6284534">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6284537">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6284615">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6284691">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6284728">func</span>&nbsp;<span class="op" id="6284733">(</span><span class="ident" id="6284734">c</span>&nbsp;<span class="op" id="6284736">*</span><span class="ident" id="6284737">Client</span><span class="op" id="6284743">)</span>&nbsp;<span class="ident" id="6284745">Rcpt</span><span class="op" id="6284749">(</span><span class="ident" id="6284750">to</span>&nbsp;<span class="builtintype" id="6284753">string</span><span class="op" id="6284759">)</span>&nbsp;<span class="builtintype" id="6284761">error</span>&nbsp;<span class="op" id="6284767">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284770">_</span><span class="op" id="6284771">,</span>&nbsp;<span class="ident" id="6284773">_</span><span class="op" id="6284774">,</span>&nbsp;<span class="ident" id="6284776">err</span>&nbsp;<span class="op" id="6284780">:=</span>&nbsp;<span class="ident" id="6284783">c</span><span class="op" id="6284784">.</span><span class="ident" id="6284785">cmd</span><span class="op" id="6284788">(</span><span class="num" id="6284789">25</span><span class="op" id="6284791">,</span>&nbsp;<span class="string" id="6284793">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6284807">,</span>&nbsp;<span class="ident" id="6284809">to</span><span class="op" id="6284811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284814">return</span>&nbsp;<span class="ident" id="6284821">err</span><br>
<span class="lineno"></span><span class="op" id="6284825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6284828">type</span>&nbsp;<span class="ident" id="6284833">dataCloser</span>&nbsp;<span class="keyword" id="6284844">struct</span>&nbsp;<span class="op" id="6284851">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284854">c</span>&nbsp;<span class="op" id="6284856">*</span><span class="ident" id="6284857">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284865">io</span><span class="op" id="6284867">.</span><span class="ident" id="6284868">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6284880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6284883">func</span>&nbsp;<span class="op" id="6284888">(</span><span class="ident" id="6284889">d</span>&nbsp;<span class="op" id="6284891">*</span><span class="ident" id="6284892">dataCloser</span><span class="op" id="6284902">)</span>&nbsp;<span class="ident" id="6284904">Close</span><span class="op" id="6284909">(</span><span class="op" id="6284910">)</span>&nbsp;<span class="builtintype" id="6284912">error</span>&nbsp;<span class="op" id="6284918">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284921">d</span><span class="op" id="6284922">.</span><span class="ident" id="6284923">WriteCloser</span><span class="op" id="6284934">.</span><span class="ident" id="6284935">Close</span><span class="op" id="6284940">(</span><span class="op" id="6284941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6284944">_</span><span class="op" id="6284945">,</span>&nbsp;<span class="ident" id="6284947">_</span><span class="op" id="6284948">,</span>&nbsp;<span class="ident" id="6284950">err</span>&nbsp;<span class="op" id="6284954">:=</span>&nbsp;<span class="ident" id="6284957">d</span><span class="op" id="6284958">.</span><span class="ident" id="6284959">c</span><span class="op" id="6284960">.</span><span class="ident" id="6284961">Text</span><span class="op" id="6284965">.</span><span class="ident" id="6284966">ReadResponse</span><span class="op" id="6284978">(</span><span class="num" id="6284979">250</span><span class="op" id="6284982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284985">return</span>&nbsp;<span class="ident" id="6284992">err</span><br>
<span class="lineno"></span><span class="op" id="6284996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6284999">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6285069">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6285138">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6285179">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6285244">func</span>&nbsp;<span class="op" id="6285249">(</span><span class="ident" id="6285250">c</span>&nbsp;<span class="op" id="6285252">*</span><span class="ident" id="6285253">Client</span><span class="op" id="6285259">)</span>&nbsp;<span class="ident" id="6285261">Data</span><span class="op" id="6285265">(</span><span class="op" id="6285266">)</span>&nbsp;<span class="op" id="6285268">(</span><span class="ident" id="6285269">io</span><span class="op" id="6285271">.</span><span class="ident" id="6285272">WriteCloser</span><span class="op" id="6285283">,</span>&nbsp;<span class="builtintype" id="6285285">error</span><span class="op" id="6285290">)</span>&nbsp;<span class="op" id="6285292">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6285295">_</span><span class="op" id="6285296">,</span>&nbsp;<span class="ident" id="6285298">_</span><span class="op" id="6285299">,</span>&nbsp;<span class="ident" id="6285301">err</span>&nbsp;<span class="op" id="6285305">:=</span>&nbsp;<span class="ident" id="6285308">c</span><span class="op" id="6285309">.</span><span class="ident" id="6285310">cmd</span><span class="op" id="6285313">(</span><span class="num" id="6285314">354</span><span class="op" id="6285317">,</span>&nbsp;<span class="string" id="6285319">&#34;DATA&#34;</span><span class="op" id="6285325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285328">if</span>&nbsp;<span class="ident" id="6285331">err</span>&nbsp;<span class="op" id="6285335">!=</span>&nbsp;<span class="ident" id="6285338">nil</span>&nbsp;<span class="op" id="6285342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285346">return</span>&nbsp;<span class="ident" id="6285353">nil</span><span class="op" id="6285356">,</span>&nbsp;<span class="ident" id="6285358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6285363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285366">return</span>&nbsp;<span class="op" id="6285373">&amp;</span><span class="ident" id="6285374">dataCloser</span><span class="op" id="6285384">{</span><span class="ident" id="6285385">c</span><span class="op" id="6285386">,</span>&nbsp;<span class="ident" id="6285388">c</span><span class="op" id="6285389">.</span><span class="ident" id="6285390">Text</span><span class="op" id="6285394">.</span><span class="ident" id="6285395">DotWriter</span><span class="op" id="6285404">(</span><span class="op" id="6285405">)</span><span class="op" id="6285406">}</span><span class="op" id="6285407">,</span>&nbsp;<span class="ident" id="6285409">nil</span><br>
<span class="lineno">265</span><span class="op" id="6285413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285416">var</span>&nbsp;<span class="ident" id="6285420">testHookStartTLS</span>&nbsp;<span class="keyword" id="6285437">func</span><span class="op" id="6285441">(</span><span class="op" id="6285442">*</span><span class="ident" id="6285443">tls</span><span class="op" id="6285446">.</span><span class="ident" id="6285447">Config</span><span class="op" id="6285453">)</span>&nbsp;<span class="comment" id="6285455">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6285481">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6285544">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6285614">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6285682">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6285698">func</span>&nbsp;<span class="ident" id="6285703">SendMail</span><span class="op" id="6285711">(</span><span class="ident" id="6285712">addr</span>&nbsp;<span class="builtintype" id="6285717">string</span><span class="op" id="6285723">,</span>&nbsp;<span class="ident" id="6285725">a</span>&nbsp;<span class="ident" id="6285727">Auth</span><span class="op" id="6285731">,</span>&nbsp;<span class="ident" id="6285733">from</span>&nbsp;<span class="builtintype" id="6285738">string</span><span class="op" id="6285744">,</span>&nbsp;<span class="ident" id="6285746">to</span>&nbsp;<span class="op" id="6285749">[</span><span class="op" id="6285750">]</span><span class="builtintype" id="6285751">string</span><span class="op" id="6285757">,</span>&nbsp;<span class="ident" id="6285759">msg</span>&nbsp;<span class="op" id="6285763">[</span><span class="op" id="6285764">]</span><span class="builtintype" id="6285765">byte</span><span class="op" id="6285769">)</span>&nbsp;<span class="builtintype" id="6285771">error</span>&nbsp;<span class="op" id="6285777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6285780">c</span><span class="op" id="6285781">,</span>&nbsp;<span class="ident" id="6285783">err</span>&nbsp;<span class="op" id="6285787">:=</span>&nbsp;<span class="ident" id="6285790">Dial</span><span class="op" id="6285794">(</span><span class="ident" id="6285795">addr</span><span class="op" id="6285799">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285802">if</span>&nbsp;<span class="ident" id="6285805">err</span>&nbsp;<span class="op" id="6285809">!=</span>&nbsp;<span class="ident" id="6285812">nil</span>&nbsp;<span class="op" id="6285816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285820">return</span>&nbsp;<span class="ident" id="6285827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6285832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285835">defer</span>&nbsp;<span class="ident" id="6285841">c</span><span class="op" id="6285842">.</span><span class="ident" id="6285843">Close</span><span class="op" id="6285848">(</span><span class="op" id="6285849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285852">if</span>&nbsp;<span class="ident" id="6285855">err</span>&nbsp;<span class="op" id="6285859">=</span>&nbsp;<span class="ident" id="6285861">c</span><span class="op" id="6285862">.</span><span class="ident" id="6285863">hello</span><span class="op" id="6285868">(</span><span class="op" id="6285869">)</span><span class="op" id="6285870">;</span>&nbsp;<span class="ident" id="6285872">err</span>&nbsp;<span class="op" id="6285876">!=</span>&nbsp;<span class="ident" id="6285879">nil</span>&nbsp;<span class="op" id="6285883">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285887">return</span>&nbsp;<span class="ident" id="6285894">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6285899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285902">if</span>&nbsp;<span class="ident" id="6285905">ok</span><span class="op" id="6285907">,</span>&nbsp;<span class="ident" id="6285909">_</span>&nbsp;<span class="op" id="6285911">:=</span>&nbsp;<span class="ident" id="6285914">c</span><span class="op" id="6285915">.</span><span class="ident" id="6285916">Extension</span><span class="op" id="6285925">(</span><span class="string" id="6285926">&#34;STARTTLS&#34;</span><span class="op" id="6285936">)</span><span class="op" id="6285937">;</span>&nbsp;<span class="ident" id="6285939">ok</span>&nbsp;<span class="op" id="6285942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6285946">config</span>&nbsp;<span class="op" id="6285953">:=</span>&nbsp;<span class="op" id="6285956">&amp;</span><span class="ident" id="6285957">tls</span><span class="op" id="6285960">.</span><span class="ident" id="6285961">Config</span><span class="op" id="6285967">{</span><span class="ident" id="6285968">ServerName</span><span class="op" id="6285978">:</span>&nbsp;<span class="ident" id="6285980">c</span><span class="op" id="6285981">.</span><span class="ident" id="6285982">serverName</span><span class="op" id="6285992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6285996">if</span>&nbsp;<span class="ident" id="6285999">testHookStartTLS</span>&nbsp;<span class="op" id="6286016">!=</span>&nbsp;<span class="ident" id="6286019">nil</span>&nbsp;<span class="op" id="6286023">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6286028">testHookStartTLS</span><span class="op" id="6286044">(</span><span class="ident" id="6286045">config</span><span class="op" id="6286051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286059">if</span>&nbsp;<span class="ident" id="6286062">err</span>&nbsp;<span class="op" id="6286066">=</span>&nbsp;<span class="ident" id="6286068">c</span><span class="op" id="6286069">.</span><span class="ident" id="6286070">StartTLS</span><span class="op" id="6286078">(</span><span class="ident" id="6286079">config</span><span class="op" id="6286085">)</span><span class="op" id="6286086">;</span>&nbsp;<span class="ident" id="6286088">err</span>&nbsp;<span class="op" id="6286092">!=</span>&nbsp;<span class="ident" id="6286095">nil</span>&nbsp;<span class="op" id="6286099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286104">return</span>&nbsp;<span class="ident" id="6286111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286117">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286123">if</span>&nbsp;<span class="ident" id="6286126">a</span>&nbsp;<span class="op" id="6286128">!=</span>&nbsp;<span class="ident" id="6286131">nil</span>&nbsp;<span class="op" id="6286135">&amp;&amp;</span>&nbsp;<span class="ident" id="6286138">c</span><span class="op" id="6286139">.</span><span class="ident" id="6286140">ext</span>&nbsp;<span class="op" id="6286144">!=</span>&nbsp;<span class="ident" id="6286147">nil</span>&nbsp;<span class="op" id="6286151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286155">if</span>&nbsp;<span class="ident" id="6286158">_</span><span class="op" id="6286159">,</span>&nbsp;<span class="ident" id="6286161">ok</span>&nbsp;<span class="op" id="6286164">:=</span>&nbsp;<span class="ident" id="6286167">c</span><span class="op" id="6286168">.</span><span class="ident" id="6286169">ext</span><span class="op" id="6286172">[</span><span class="string" id="6286173">&#34;AUTH&#34;</span><span class="op" id="6286179">]</span><span class="op" id="6286180">;</span>&nbsp;<span class="ident" id="6286182">ok</span>&nbsp;<span class="op" id="6286185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286190">if</span>&nbsp;<span class="ident" id="6286193">err</span>&nbsp;<span class="op" id="6286197">=</span>&nbsp;<span class="ident" id="6286199">c</span><span class="op" id="6286200">.</span><span class="ident" id="6286201">Auth</span><span class="op" id="6286205">(</span><span class="ident" id="6286206">a</span><span class="op" id="6286207">)</span><span class="op" id="6286208">;</span>&nbsp;<span class="ident" id="6286210">err</span>&nbsp;<span class="op" id="6286214">!=</span>&nbsp;<span class="ident" id="6286217">nil</span>&nbsp;<span class="op" id="6286221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286227">return</span>&nbsp;<span class="ident" id="6286234">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286251">if</span>&nbsp;<span class="ident" id="6286254">err</span>&nbsp;<span class="op" id="6286258">=</span>&nbsp;<span class="ident" id="6286260">c</span><span class="op" id="6286261">.</span><span class="ident" id="6286262">Mail</span><span class="op" id="6286266">(</span><span class="ident" id="6286267">from</span><span class="op" id="6286271">)</span><span class="op" id="6286272">;</span>&nbsp;<span class="ident" id="6286274">err</span>&nbsp;<span class="op" id="6286278">!=</span>&nbsp;<span class="ident" id="6286281">nil</span>&nbsp;<span class="op" id="6286285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286289">return</span>&nbsp;<span class="ident" id="6286296">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286304">for</span>&nbsp;<span class="ident" id="6286308">_</span><span class="op" id="6286309">,</span>&nbsp;<span class="ident" id="6286311">addr</span>&nbsp;<span class="op" id="6286316">:=</span>&nbsp;<span class="keyword" id="6286319">range</span>&nbsp;<span class="ident" id="6286325">to</span>&nbsp;<span class="op" id="6286328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286332">if</span>&nbsp;<span class="ident" id="6286335">err</span>&nbsp;<span class="op" id="6286339">=</span>&nbsp;<span class="ident" id="6286341">c</span><span class="op" id="6286342">.</span><span class="ident" id="6286343">Rcpt</span><span class="op" id="6286347">(</span><span class="ident" id="6286348">addr</span><span class="op" id="6286352">)</span><span class="op" id="6286353">;</span>&nbsp;<span class="ident" id="6286355">err</span>&nbsp;<span class="op" id="6286359">!=</span>&nbsp;<span class="ident" id="6286362">nil</span>&nbsp;<span class="op" id="6286366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286371">return</span>&nbsp;<span class="ident" id="6286378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286384">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6286390">w</span><span class="op" id="6286391">,</span>&nbsp;<span class="ident" id="6286393">err</span>&nbsp;<span class="op" id="6286397">:=</span>&nbsp;<span class="ident" id="6286400">c</span><span class="op" id="6286401">.</span><span class="ident" id="6286402">Data</span><span class="op" id="6286406">(</span><span class="op" id="6286407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286410">if</span>&nbsp;<span class="ident" id="6286413">err</span>&nbsp;<span class="op" id="6286417">!=</span>&nbsp;<span class="ident" id="6286420">nil</span>&nbsp;<span class="op" id="6286424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286428">return</span>&nbsp;<span class="ident" id="6286435">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286440">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6286443">_</span><span class="op" id="6286444">,</span>&nbsp;<span class="ident" id="6286446">err</span>&nbsp;<span class="op" id="6286450">=</span>&nbsp;<span class="ident" id="6286452">w</span><span class="op" id="6286453">.</span><span class="ident" id="6286454">Write</span><span class="op" id="6286459">(</span><span class="ident" id="6286460">msg</span><span class="op" id="6286463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286466">if</span>&nbsp;<span class="ident" id="6286469">err</span>&nbsp;<span class="op" id="6286473">!=</span>&nbsp;<span class="ident" id="6286476">nil</span>&nbsp;<span class="op" id="6286480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286484">return</span>&nbsp;<span class="ident" id="6286491">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6286499">err</span>&nbsp;<span class="op" id="6286503">=</span>&nbsp;<span class="ident" id="6286505">w</span><span class="op" id="6286506">.</span><span class="ident" id="6286507">Close</span><span class="op" id="6286512">(</span><span class="op" id="6286513">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286516">if</span>&nbsp;<span class="ident" id="6286519">err</span>&nbsp;<span class="op" id="6286523">!=</span>&nbsp;<span class="ident" id="6286526">nil</span>&nbsp;<span class="op" id="6286530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286534">return</span>&nbsp;<span class="ident" id="6286541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286549">return</span>&nbsp;<span class="ident" id="6286556">c</span><span class="op" id="6286557">.</span><span class="ident" id="6286558">Quit</span><span class="op" id="6286562">(</span><span class="op" id="6286563">)</span><br>
<span class="lineno"></span><span class="op" id="6286565">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6286568">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6286636">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6286710">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6286778">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6286817">func</span>&nbsp;<span class="op" id="6286822">(</span><span class="ident" id="6286823">c</span>&nbsp;<span class="op" id="6286825">*</span><span class="ident" id="6286826">Client</span><span class="op" id="6286832">)</span>&nbsp;<span class="ident" id="6286834">Extension</span><span class="op" id="6286843">(</span><span class="ident" id="6286844">ext</span>&nbsp;<span class="builtintype" id="6286848">string</span><span class="op" id="6286854">)</span>&nbsp;<span class="op" id="6286856">(</span><span class="builtintype" id="6286857">bool</span><span class="op" id="6286861">,</span>&nbsp;<span class="builtintype" id="6286863">string</span><span class="op" id="6286869">)</span>&nbsp;<span class="op" id="6286871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286874">if</span>&nbsp;<span class="ident" id="6286877">err</span>&nbsp;<span class="op" id="6286881">:=</span>&nbsp;<span class="ident" id="6286884">c</span><span class="op" id="6286885">.</span><span class="ident" id="6286886">hello</span><span class="op" id="6286891">(</span><span class="op" id="6286892">)</span><span class="op" id="6286893">;</span>&nbsp;<span class="ident" id="6286895">err</span>&nbsp;<span class="op" id="6286899">!=</span>&nbsp;<span class="ident" id="6286902">nil</span>&nbsp;<span class="op" id="6286906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286910">return</span>&nbsp;<span class="builtintype" id="6286917">false</span><span class="op" id="6286922">,</span>&nbsp;<span class="string" id="6286924">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286931">if</span>&nbsp;<span class="ident" id="6286934">c</span><span class="op" id="6286935">.</span><span class="ident" id="6286936">ext</span>&nbsp;<span class="op" id="6286940">==</span>&nbsp;<span class="ident" id="6286943">nil</span>&nbsp;<span class="op" id="6286947">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6286951">return</span>&nbsp;<span class="builtintype" id="6286958">false</span><span class="op" id="6286963">,</span>&nbsp;<span class="string" id="6286965">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6286969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6286972">ext</span>&nbsp;<span class="op" id="6286976">=</span>&nbsp;<span class="ident" id="6286978">strings</span><span class="op" id="6286985">.</span><span class="ident" id="6286986">ToUpper</span><span class="op" id="6286993">(</span><span class="ident" id="6286994">ext</span><span class="op" id="6286997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6287000">param</span><span class="op" id="6287005">,</span>&nbsp;<span class="ident" id="6287007">ok</span>&nbsp;<span class="op" id="6287010">:=</span>&nbsp;<span class="ident" id="6287013">c</span><span class="op" id="6287014">.</span><span class="ident" id="6287015">ext</span><span class="op" id="6287018">[</span><span class="ident" id="6287019">ext</span><span class="op" id="6287022">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287025">return</span>&nbsp;<span class="ident" id="6287032">ok</span><span class="op" id="6287034">,</span>&nbsp;<span class="ident" id="6287036">param</span><br>
<span class="lineno">335</span><span class="op" id="6287042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6287045">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6287118">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6287134">func</span>&nbsp;<span class="op" id="6287139">(</span><span class="ident" id="6287140">c</span>&nbsp;<span class="op" id="6287142">*</span><span class="ident" id="6287143">Client</span><span class="op" id="6287149">)</span>&nbsp;<span class="ident" id="6287151">Reset</span><span class="op" id="6287156">(</span><span class="op" id="6287157">)</span>&nbsp;<span class="builtintype" id="6287159">error</span>&nbsp;<span class="op" id="6287165">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287168">if</span>&nbsp;<span class="ident" id="6287171">err</span>&nbsp;<span class="op" id="6287175">:=</span>&nbsp;<span class="ident" id="6287178">c</span><span class="op" id="6287179">.</span><span class="ident" id="6287180">hello</span><span class="op" id="6287185">(</span><span class="op" id="6287186">)</span><span class="op" id="6287187">;</span>&nbsp;<span class="ident" id="6287189">err</span>&nbsp;<span class="op" id="6287193">!=</span>&nbsp;<span class="ident" id="6287196">nil</span>&nbsp;<span class="op" id="6287200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287204">return</span>&nbsp;<span class="ident" id="6287211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6287216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6287219">_</span><span class="op" id="6287220">,</span>&nbsp;<span class="ident" id="6287222">_</span><span class="op" id="6287223">,</span>&nbsp;<span class="ident" id="6287225">err</span>&nbsp;<span class="op" id="6287229">:=</span>&nbsp;<span class="ident" id="6287232">c</span><span class="op" id="6287233">.</span><span class="ident" id="6287234">cmd</span><span class="op" id="6287237">(</span><span class="num" id="6287238">250</span><span class="op" id="6287241">,</span>&nbsp;<span class="string" id="6287243">&#34;RSET&#34;</span><span class="op" id="6287249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287252">return</span>&nbsp;<span class="ident" id="6287259">err</span><br>
<span class="lineno">345</span><span class="op" id="6287263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6287266">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6287338">func</span>&nbsp;<span class="op" id="6287343">(</span><span class="ident" id="6287344">c</span>&nbsp;<span class="op" id="6287346">*</span><span class="ident" id="6287347">Client</span><span class="op" id="6287353">)</span>&nbsp;<span class="ident" id="6287355">Quit</span><span class="op" id="6287359">(</span><span class="op" id="6287360">)</span>&nbsp;<span class="builtintype" id="6287362">error</span>&nbsp;<span class="op" id="6287368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287371">if</span>&nbsp;<span class="ident" id="6287374">err</span>&nbsp;<span class="op" id="6287378">:=</span>&nbsp;<span class="ident" id="6287381">c</span><span class="op" id="6287382">.</span><span class="ident" id="6287383">hello</span><span class="op" id="6287388">(</span><span class="op" id="6287389">)</span><span class="op" id="6287390">;</span>&nbsp;<span class="ident" id="6287392">err</span>&nbsp;<span class="op" id="6287396">!=</span>&nbsp;<span class="ident" id="6287399">nil</span>&nbsp;<span class="op" id="6287403">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287407">return</span>&nbsp;<span class="ident" id="6287414">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6287419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6287422">_</span><span class="op" id="6287423">,</span>&nbsp;<span class="ident" id="6287425">_</span><span class="op" id="6287426">,</span>&nbsp;<span class="ident" id="6287428">err</span>&nbsp;<span class="op" id="6287432">:=</span>&nbsp;<span class="ident" id="6287435">c</span><span class="op" id="6287436">.</span><span class="ident" id="6287437">cmd</span><span class="op" id="6287440">(</span><span class="num" id="6287441">221</span><span class="op" id="6287444">,</span>&nbsp;<span class="string" id="6287446">&#34;QUIT&#34;</span><span class="op" id="6287452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287455">if</span>&nbsp;<span class="ident" id="6287458">err</span>&nbsp;<span class="op" id="6287462">!=</span>&nbsp;<span class="ident" id="6287465">nil</span>&nbsp;<span class="op" id="6287469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287473">return</span>&nbsp;<span class="ident" id="6287480">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6287485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6287488">return</span>&nbsp;<span class="ident" id="6287495">c</span><span class="op" id="6287496">.</span><span class="ident" id="6287497">Text</span><span class="op" id="6287501">.</span><span class="ident" id="6287502">Close</span><span class="op" id="6287507">(</span><span class="op" id="6287508">)</span><br>
<span class="lineno"></span><span class="op" id="6287510">}</span>
</div>
</body>
</html>
