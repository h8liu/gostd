<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3523671">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3523727">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3523781">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3523832">package</span>&nbsp;<span class="ident" id="3523840">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523851">import</span>&nbsp;<span class="op" id="3523858">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3523861">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3523870">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3523877">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3523882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523885">//&nbsp;A&nbsp;Writer&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3523940">//&nbsp;requests&nbsp;or&nbsp;responses&nbsp;to&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="3524004">type</span>&nbsp;<span class="ident" id="3524009">Writer</span>&nbsp;<span class="keyword" id="3524016">struct</span>&nbsp;<span class="op" id="3524023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524026">W</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3524030">*</span><span class="ident" id="3524031">bufio</span><span class="op" id="3524036">.</span><span class="ident" id="3524037">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524045">dot</span>&nbsp;<span class="op" id="3524049">*</span><span class="ident" id="3524050">dotWriter</span><br>
<span class="lineno"></span><span class="op" id="3524060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3524063">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3524111">func</span>&nbsp;<span class="ident" id="3524116">NewWriter</span><span class="op" id="3524125">(</span><span class="ident" id="3524126">w</span>&nbsp;<span class="op" id="3524128">*</span><span class="ident" id="3524129">bufio</span><span class="op" id="3524134">.</span><span class="ident" id="3524135">Writer</span><span class="op" id="3524141">)</span>&nbsp;<span class="op" id="3524143">*</span><span class="ident" id="3524144">Writer</span>&nbsp;<span class="op" id="3524151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3524154">return</span>&nbsp;<span class="op" id="3524161">&amp;</span><span class="ident" id="3524162">Writer</span><span class="op" id="3524168">{</span><span class="ident" id="3524169">W</span><span class="op" id="3524170">:</span>&nbsp;<span class="ident" id="3524172">w</span><span class="op" id="3524173">}</span><br>
<span class="lineno"></span><span class="op" id="3524175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3524178">var</span>&nbsp;<span class="ident" id="3524182">crnl</span>&nbsp;<span class="op" id="3524187">=</span>&nbsp;<span class="op" id="3524189">[</span><span class="op" id="3524190">]</span><span class="builtintype" id="3524191">byte</span><span class="op" id="3524195">{</span><span class="string" id="3524196">&#39;\r&#39;</span><span class="op" id="3524200">,</span>&nbsp;<span class="string" id="3524202">&#39;\n&#39;</span><span class="op" id="3524206">}</span><br>
<span class="lineno"></span><span class="keyword" id="3524208">var</span>&nbsp;<span class="ident" id="3524212">dotcrnl</span>&nbsp;<span class="op" id="3524220">=</span>&nbsp;<span class="op" id="3524222">[</span><span class="op" id="3524223">]</span><span class="builtintype" id="3524224">byte</span><span class="op" id="3524228">{</span><span class="string" id="3524229">&#39;.&#39;</span><span class="op" id="3524232">,</span>&nbsp;<span class="string" id="3524234">&#39;\r&#39;</span><span class="op" id="3524238">,</span>&nbsp;<span class="string" id="3524240">&#39;\n&#39;</span><span class="op" id="3524244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3524247">//&nbsp;PrintfLine&nbsp;writes&nbsp;the&nbsp;formatted&nbsp;output&nbsp;followed&nbsp;by&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="keyword" id="3524307">func</span>&nbsp;<span class="op" id="3524312">(</span><span class="ident" id="3524313">w</span>&nbsp;<span class="op" id="3524315">*</span><span class="ident" id="3524316">Writer</span><span class="op" id="3524322">)</span>&nbsp;<span class="ident" id="3524324">PrintfLine</span><span class="op" id="3524334">(</span><span class="ident" id="3524335">format</span>&nbsp;<span class="builtintype" id="3524342">string</span><span class="op" id="3524348">,</span>&nbsp;<span class="ident" id="3524350">args</span>&nbsp;<span class="op" id="3524355">...</span><span class="keyword" id="3524358">interface</span><span class="op" id="3524367">{</span><span class="op" id="3524368">}</span><span class="op" id="3524369">)</span>&nbsp;<span class="builtintype" id="3524371">error</span>&nbsp;<span class="op" id="3524377">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524380">w</span><span class="op" id="3524381">.</span><span class="ident" id="3524382">closeDot</span><span class="op" id="3524390">(</span><span class="op" id="3524391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524394">fmt</span><span class="op" id="3524397">.</span><span class="ident" id="3524398">Fprintf</span><span class="op" id="3524405">(</span><span class="ident" id="3524406">w</span><span class="op" id="3524407">.</span><span class="ident" id="3524408">W</span><span class="op" id="3524409">,</span>&nbsp;<span class="ident" id="3524411">format</span><span class="op" id="3524417">,</span>&nbsp;<span class="ident" id="3524419">args</span><span class="op" id="3524423">...</span><span class="op" id="3524426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524429">w</span><span class="op" id="3524430">.</span><span class="ident" id="3524431">W</span><span class="op" id="3524432">.</span><span class="ident" id="3524433">Write</span><span class="op" id="3524438">(</span><span class="ident" id="3524439">crnl</span><span class="op" id="3524443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3524446">return</span>&nbsp;<span class="ident" id="3524453">w</span><span class="op" id="3524454">.</span><span class="ident" id="3524455">W</span><span class="op" id="3524456">.</span><span class="ident" id="3524457">Flush</span><span class="op" id="3524462">(</span><span class="op" id="3524463">)</span><br>
<span class="lineno"></span><span class="op" id="3524465">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3524468">//&nbsp;DotWriter&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;a&nbsp;dot-encoding&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3524545">//&nbsp;It&nbsp;takes&nbsp;care&nbsp;of&nbsp;inserting&nbsp;leading&nbsp;dots&nbsp;when&nbsp;necessary,</span><br>
<span class="lineno"></span><span class="comment" id="3524604">//&nbsp;translating&nbsp;line-ending&nbsp;\n&nbsp;into&nbsp;\r\n,&nbsp;and&nbsp;adding&nbsp;the&nbsp;final&nbsp;.\r\n&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3524677">//&nbsp;when&nbsp;the&nbsp;DotWriter&nbsp;is&nbsp;closed.&nbsp;&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="3524739">//&nbsp;DotWriter&nbsp;before&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3524791">//</span><br>
<span class="lineno"></span><span class="comment" id="3524794">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Reader&#39;s&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3524881">func</span>&nbsp;<span class="op" id="3524886">(</span><span class="ident" id="3524887">w</span>&nbsp;<span class="op" id="3524889">*</span><span class="ident" id="3524890">Writer</span><span class="op" id="3524896">)</span>&nbsp;<span class="ident" id="3524898">DotWriter</span><span class="op" id="3524907">(</span><span class="op" id="3524908">)</span>&nbsp;<span class="ident" id="3524910">io</span><span class="op" id="3524912">.</span><span class="ident" id="3524913">WriteCloser</span>&nbsp;<span class="op" id="3524925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524928">w</span><span class="op" id="3524929">.</span><span class="ident" id="3524930">closeDot</span><span class="op" id="3524938">(</span><span class="op" id="3524939">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524942">w</span><span class="op" id="3524943">.</span><span class="ident" id="3524944">dot</span>&nbsp;<span class="op" id="3524948">=</span>&nbsp;<span class="op" id="3524950">&amp;</span><span class="ident" id="3524951">dotWriter</span><span class="op" id="3524960">{</span><span class="ident" id="3524961">w</span><span class="op" id="3524962">:</span>&nbsp;<span class="ident" id="3524964">w</span><span class="op" id="3524965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3524968">return</span>&nbsp;<span class="ident" id="3524975">w</span><span class="op" id="3524976">.</span><span class="ident" id="3524977">dot</span><br>
<span class="lineno"></span><span class="op" id="3524981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3524984">func</span>&nbsp;<span class="op" id="3524989">(</span><span class="ident" id="3524990">w</span>&nbsp;<span class="op" id="3524992">*</span><span class="ident" id="3524993">Writer</span><span class="op" id="3524999">)</span>&nbsp;<span class="ident" id="3525001">closeDot</span><span class="op" id="3525009">(</span><span class="op" id="3525010">)</span>&nbsp;<span class="op" id="3525012">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525015">if</span>&nbsp;<span class="ident" id="3525018">w</span><span class="op" id="3525019">.</span><span class="ident" id="3525020">dot</span>&nbsp;<span class="op" id="3525024">!=</span>&nbsp;<span class="builtintype" id="3525027">nil</span>&nbsp;<span class="op" id="3525031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525035">w</span><span class="op" id="3525036">.</span><span class="ident" id="3525037">dot</span><span class="op" id="3525040">.</span><span class="ident" id="3525041">Close</span><span class="op" id="3525046">(</span><span class="op" id="3525047">)</span>&nbsp;<span class="comment" id="3525049">//&nbsp;sets&nbsp;w.dot&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525070">}</span><br>
<span class="lineno"></span><span class="op" id="3525072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3525075">type</span>&nbsp;<span class="ident" id="3525080">dotWriter</span>&nbsp;<span class="keyword" id="3525090">struct</span>&nbsp;<span class="op" id="3525097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525100">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525106">*</span><span class="ident" id="3525107">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525115">state</span>&nbsp;<span class="builtintype" id="3525121">int</span><br>
<span class="lineno"></span><span class="op" id="3525125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3525128">const</span>&nbsp;<span class="op" id="3525134">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525137">wstateBeginLine</span>&nbsp;<span class="op" id="3525153">=</span>&nbsp;<span class="ident" id="3525155">iota</span>&nbsp;<span class="comment" id="3525160">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525211">wstateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3525234">//&nbsp;wrote&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525273">wstateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3525296">//&nbsp;writing&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span><span class="op" id="3525330">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3525333">func</span>&nbsp;<span class="op" id="3525338">(</span><span class="ident" id="3525339">d</span>&nbsp;<span class="op" id="3525341">*</span><span class="ident" id="3525342">dotWriter</span><span class="op" id="3525351">)</span>&nbsp;<span class="ident" id="3525353">Write</span><span class="op" id="3525358">(</span><span class="ident" id="3525359">b</span>&nbsp;<span class="op" id="3525361">[</span><span class="op" id="3525362">]</span><span class="builtintype" id="3525363">byte</span><span class="op" id="3525367">)</span>&nbsp;<span class="op" id="3525369">(</span><span class="ident" id="3525370">n</span>&nbsp;<span class="builtintype" id="3525372">int</span><span class="op" id="3525375">,</span>&nbsp;<span class="ident" id="3525377">err</span>&nbsp;<span class="builtintype" id="3525381">error</span><span class="op" id="3525386">)</span>&nbsp;<span class="op" id="3525388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525391">bw</span>&nbsp;<span class="op" id="3525394">:=</span>&nbsp;<span class="ident" id="3525397">d</span><span class="op" id="3525398">.</span><span class="ident" id="3525399">w</span><span class="op" id="3525400">.</span><span class="ident" id="3525401">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525404">for</span>&nbsp;<span class="ident" id="3525408">n</span>&nbsp;<span class="op" id="3525410">&lt;</span>&nbsp;<span class="builtinfunc" id="3525412">len</span><span class="op" id="3525415">(</span><span class="ident" id="3525416">b</span><span class="op" id="3525417">)</span>&nbsp;<span class="op" id="3525419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525423">c</span>&nbsp;<span class="op" id="3525425">:=</span>&nbsp;<span class="ident" id="3525428">b</span><span class="op" id="3525429">[</span><span class="ident" id="3525430">n</span><span class="op" id="3525431">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525435">switch</span>&nbsp;<span class="ident" id="3525442">d</span><span class="op" id="3525443">.</span><span class="ident" id="3525444">state</span>&nbsp;<span class="op" id="3525450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525454">case</span>&nbsp;<span class="ident" id="3525459">wstateBeginLine</span><span class="op" id="3525474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525479">d</span><span class="op" id="3525480">.</span><span class="ident" id="3525481">state</span>&nbsp;<span class="op" id="3525487">=</span>&nbsp;<span class="ident" id="3525489">wstateData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525503">if</span>&nbsp;<span class="ident" id="3525506">c</span>&nbsp;<span class="op" id="3525508">==</span>&nbsp;<span class="string" id="3525511">&#39;.&#39;</span>&nbsp;<span class="op" id="3525515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3525521">//&nbsp;escape&nbsp;leading&nbsp;dot</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525547">bw</span><span class="op" id="3525549">.</span><span class="ident" id="3525550">WriteByte</span><span class="op" id="3525559">(</span><span class="string" id="3525560">&#39;.&#39;</span><span class="op" id="3525563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525573">fallthrough</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525588">case</span>&nbsp;<span class="ident" id="3525593">wstateData</span><span class="op" id="3525603">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525608">if</span>&nbsp;<span class="ident" id="3525611">c</span>&nbsp;<span class="op" id="3525613">==</span>&nbsp;<span class="string" id="3525616">&#39;\r&#39;</span>&nbsp;<span class="op" id="3525621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525627">d</span><span class="op" id="3525628">.</span><span class="ident" id="3525629">state</span>&nbsp;<span class="op" id="3525635">=</span>&nbsp;<span class="ident" id="3525637">wstateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525654">if</span>&nbsp;<span class="ident" id="3525657">c</span>&nbsp;<span class="op" id="3525659">==</span>&nbsp;<span class="string" id="3525662">&#39;\n&#39;</span>&nbsp;<span class="op" id="3525667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525673">bw</span><span class="op" id="3525675">.</span><span class="ident" id="3525676">WriteByte</span><span class="op" id="3525685">(</span><span class="string" id="3525686">&#39;\r&#39;</span><span class="op" id="3525690">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525696">d</span><span class="op" id="3525697">.</span><span class="ident" id="3525698">state</span>&nbsp;<span class="op" id="3525704">=</span>&nbsp;<span class="ident" id="3525706">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525730">case</span>&nbsp;<span class="ident" id="3525735">wstateCR</span><span class="op" id="3525743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525748">d</span><span class="op" id="3525749">.</span><span class="ident" id="3525750">state</span>&nbsp;<span class="op" id="3525756">=</span>&nbsp;<span class="ident" id="3525758">wstateData</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525772">if</span>&nbsp;<span class="ident" id="3525775">c</span>&nbsp;<span class="op" id="3525777">==</span>&nbsp;<span class="string" id="3525780">&#39;\n&#39;</span>&nbsp;<span class="op" id="3525785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525791">d</span><span class="op" id="3525792">.</span><span class="ident" id="3525793">state</span>&nbsp;<span class="op" id="3525799">=</span>&nbsp;<span class="ident" id="3525801">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525828">if</span>&nbsp;<span class="ident" id="3525831">err</span>&nbsp;<span class="op" id="3525835">=</span>&nbsp;<span class="ident" id="3525837">bw</span><span class="op" id="3525839">.</span><span class="ident" id="3525840">WriteByte</span><span class="op" id="3525849">(</span><span class="ident" id="3525850">c</span><span class="op" id="3525851">)</span><span class="op" id="3525852">;</span>&nbsp;<span class="ident" id="3525854">err</span>&nbsp;<span class="op" id="3525858">!=</span>&nbsp;<span class="builtintype" id="3525861">nil</span>&nbsp;<span class="op" id="3525865">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525870">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525882">n</span><span class="op" id="3525883">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525890">return</span><br>
<span class="lineno">100</span><span class="op" id="3525897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3525900">func</span>&nbsp;<span class="op" id="3525905">(</span><span class="ident" id="3525906">d</span>&nbsp;<span class="op" id="3525908">*</span><span class="ident" id="3525909">dotWriter</span><span class="op" id="3525918">)</span>&nbsp;<span class="ident" id="3525920">Close</span><span class="op" id="3525925">(</span><span class="op" id="3525926">)</span>&nbsp;<span class="builtintype" id="3525928">error</span>&nbsp;<span class="op" id="3525934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525937">if</span>&nbsp;<span class="ident" id="3525940">d</span><span class="op" id="3525941">.</span><span class="ident" id="3525942">w</span><span class="op" id="3525943">.</span><span class="ident" id="3525944">dot</span>&nbsp;<span class="op" id="3525948">==</span>&nbsp;<span class="ident" id="3525951">d</span>&nbsp;<span class="op" id="3525953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525957">d</span><span class="op" id="3525958">.</span><span class="ident" id="3525959">w</span><span class="op" id="3525960">.</span><span class="ident" id="3525961">dot</span>&nbsp;<span class="op" id="3525965">=</span>&nbsp;<span class="builtintype" id="3525967">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525975">bw</span>&nbsp;<span class="op" id="3525978">:=</span>&nbsp;<span class="ident" id="3525981">d</span><span class="op" id="3525982">.</span><span class="ident" id="3525983">w</span><span class="op" id="3525984">.</span><span class="ident" id="3525985">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525988">switch</span>&nbsp;<span class="ident" id="3525995">d</span><span class="op" id="3525996">.</span><span class="ident" id="3525997">state</span>&nbsp;<span class="op" id="3526003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526006">default</span><span class="op" id="3526013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3526017">bw</span><span class="op" id="3526019">.</span><span class="ident" id="3526020">WriteByte</span><span class="op" id="3526029">(</span><span class="string" id="3526030">&#39;\r&#39;</span><span class="op" id="3526034">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526038">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526051">case</span>&nbsp;<span class="ident" id="3526056">wstateCR</span><span class="op" id="3526064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3526068">bw</span><span class="op" id="3526070">.</span><span class="ident" id="3526071">WriteByte</span><span class="op" id="3526080">(</span><span class="string" id="3526081">&#39;\n&#39;</span><span class="op" id="3526085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526089">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526102">case</span>&nbsp;<span class="ident" id="3526107">wstateBeginLine</span><span class="op" id="3526122">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3526126">bw</span><span class="op" id="3526128">.</span><span class="ident" id="3526129">Write</span><span class="op" id="3526134">(</span><span class="ident" id="3526135">dotcrnl</span><span class="op" id="3526142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3526145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526148">return</span>&nbsp;<span class="ident" id="3526155">bw</span><span class="op" id="3526157">.</span><span class="ident" id="3526158">Flush</span><span class="op" id="3526163">(</span><span class="op" id="3526164">)</span><br>
<span class="lineno"></span><span class="op" id="3526166">}</span>
</div>
</body>
</html>
