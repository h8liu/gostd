<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6715044">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6715099">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6715153">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6715204">package</span>&nbsp;<span class="ident" id="6715212">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6715217">import</span>&nbsp;<span class="op" id="6715224">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715227">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715236">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715252">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715262">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715270">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715277">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715283">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715296">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715303">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715314">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6715325">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6715332">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6715335">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6715410">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="6715487">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6715566">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="6715625">//</span><br>
<span class="lineno"></span><span class="comment" id="6715628">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6715702">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6715780">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="6715856">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="6715923">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="6715942">//</span><br>
<span class="lineno"></span><span class="comment" id="6715945">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="6716024">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="6716104">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="6716182">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="6716261">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716280">var</span>&nbsp;<span class="ident" id="6716284">update</span>&nbsp;<span class="op" id="6716291">=</span>&nbsp;<span class="ident" id="6716293">flag</span><span class="op" id="6716297">.</span><span class="ident" id="6716298">Bool</span><span class="op" id="6716302">(</span><span class="string" id="6716303">&#34;update&#34;</span><span class="op" id="6716311">,</span>&nbsp;<span class="builtintype" id="6716313">false</span><span class="op" id="6716318">,</span>&nbsp;<span class="string" id="6716320">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="6716349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="6716352">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6716432">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6716506">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="6716524">type</span>&nbsp;<span class="ident" id="6716529">recordingConn</span>&nbsp;<span class="keyword" id="6716543">struct</span>&nbsp;<span class="op" id="6716550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716553">net</span><span class="op" id="6716556">.</span><span class="ident" id="6716557">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716563">sync</span><span class="op" id="6716567">.</span><span class="ident" id="6716568">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716575">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6716583">[</span><span class="op" id="6716584">]</span><span class="op" id="6716585">[</span><span class="op" id="6716586">]</span><span class="builtintype" id="6716587">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716593">reading</span>&nbsp;<span class="builtintype" id="6716601">bool</span><br>
<span class="lineno"></span><span class="op" id="6716606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6716609">func</span>&nbsp;<span class="op" id="6716614">(</span><span class="ident" id="6716615">r</span>&nbsp;<span class="op" id="6716617">*</span><span class="ident" id="6716618">recordingConn</span><span class="op" id="6716631">)</span>&nbsp;<span class="ident" id="6716633">Read</span><span class="op" id="6716637">(</span><span class="ident" id="6716638">b</span>&nbsp;<span class="op" id="6716640">[</span><span class="op" id="6716641">]</span><span class="builtintype" id="6716642">byte</span><span class="op" id="6716646">)</span>&nbsp;<span class="op" id="6716648">(</span><span class="ident" id="6716649">n</span>&nbsp;<span class="builtintype" id="6716651">int</span><span class="op" id="6716654">,</span>&nbsp;<span class="ident" id="6716656">err</span>&nbsp;<span class="builtintype" id="6716660">error</span><span class="op" id="6716665">)</span>&nbsp;<span class="op" id="6716667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716670">if</span>&nbsp;<span class="ident" id="6716673">n</span><span class="op" id="6716674">,</span>&nbsp;<span class="ident" id="6716676">err</span>&nbsp;<span class="op" id="6716680">=</span>&nbsp;<span class="ident" id="6716682">r</span><span class="op" id="6716683">.</span><span class="ident" id="6716684">Conn</span><span class="op" id="6716688">.</span><span class="ident" id="6716689">Read</span><span class="op" id="6716693">(</span><span class="ident" id="6716694">b</span><span class="op" id="6716695">)</span><span class="op" id="6716696">;</span>&nbsp;<span class="ident" id="6716698">n</span>&nbsp;<span class="op" id="6716700">==</span>&nbsp;<span class="num" id="6716703">0</span>&nbsp;<span class="op" id="6716705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716709">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716720">b</span>&nbsp;<span class="op" id="6716722">=</span>&nbsp;<span class="ident" id="6716724">b</span><span class="op" id="6716725">[</span><span class="op" id="6716726">:</span><span class="ident" id="6716727">n</span><span class="op" id="6716728">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716732">r</span><span class="op" id="6716733">.</span><span class="ident" id="6716734">Lock</span><span class="op" id="6716738">(</span><span class="op" id="6716739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716742">defer</span>&nbsp;<span class="ident" id="6716748">r</span><span class="op" id="6716749">.</span><span class="ident" id="6716750">Unlock</span><span class="op" id="6716756">(</span><span class="op" id="6716757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716761">if</span>&nbsp;<span class="ident" id="6716764">l</span>&nbsp;<span class="op" id="6716766">:=</span>&nbsp;<span class="builtinfunc" id="6716769">len</span><span class="op" id="6716772">(</span><span class="ident" id="6716773">r</span><span class="op" id="6716774">.</span><span class="ident" id="6716775">flows</span><span class="op" id="6716780">)</span><span class="op" id="6716781">;</span>&nbsp;<span class="ident" id="6716783">l</span>&nbsp;<span class="op" id="6716785">==</span>&nbsp;<span class="num" id="6716788">0</span>&nbsp;<span class="op" id="6716790">||</span>&nbsp;<span class="op" id="6716793">!</span><span class="ident" id="6716794">r</span><span class="op" id="6716795">.</span><span class="ident" id="6716796">reading</span>&nbsp;<span class="op" id="6716804">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716808">buf</span>&nbsp;<span class="op" id="6716812">:=</span>&nbsp;<span class="builtinfunc" id="6716815">make</span><span class="op" id="6716819">(</span><span class="op" id="6716820">[</span><span class="op" id="6716821">]</span><span class="builtintype" id="6716822">byte</span><span class="op" id="6716826">,</span>&nbsp;<span class="builtinfunc" id="6716828">len</span><span class="op" id="6716831">(</span><span class="ident" id="6716832">b</span><span class="op" id="6716833">)</span><span class="op" id="6716834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6716838">copy</span><span class="op" id="6716842">(</span><span class="ident" id="6716843">buf</span><span class="op" id="6716846">,</span>&nbsp;<span class="ident" id="6716848">b</span><span class="op" id="6716849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716853">r</span><span class="op" id="6716854">.</span><span class="ident" id="6716855">flows</span>&nbsp;<span class="op" id="6716861">=</span>&nbsp;<span class="builtinfunc" id="6716863">append</span><span class="op" id="6716869">(</span><span class="ident" id="6716870">r</span><span class="op" id="6716871">.</span><span class="ident" id="6716872">flows</span><span class="op" id="6716877">,</span>&nbsp;<span class="ident" id="6716879">buf</span><span class="op" id="6716882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716885">}</span>&nbsp;<span class="keyword" id="6716887">else</span>&nbsp;<span class="op" id="6716892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716896">r</span><span class="op" id="6716897">.</span><span class="ident" id="6716898">flows</span><span class="op" id="6716903">[</span><span class="ident" id="6716904">l</span><span class="op" id="6716905">-</span><span class="num" id="6716906">1</span><span class="op" id="6716907">]</span>&nbsp;<span class="op" id="6716909">=</span>&nbsp;<span class="builtinfunc" id="6716911">append</span><span class="op" id="6716917">(</span><span class="ident" id="6716918">r</span><span class="op" id="6716919">.</span><span class="ident" id="6716920">flows</span><span class="op" id="6716925">[</span><span class="ident" id="6716926">l</span><span class="op" id="6716927">-</span><span class="num" id="6716928">1</span><span class="op" id="6716929">]</span><span class="op" id="6716930">,</span>&nbsp;<span class="ident" id="6716932">b</span><span class="op" id="6716933">[</span><span class="op" id="6716934">:</span><span class="ident" id="6716935">n</span><span class="op" id="6716936">]</span><span class="op" id="6716937">...</span><span class="op" id="6716940">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716946">r</span><span class="op" id="6716947">.</span><span class="ident" id="6716948">reading</span>&nbsp;<span class="op" id="6716956">=</span>&nbsp;<span class="builtintype" id="6716958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716964">return</span><br>
<span class="lineno"></span><span class="op" id="6716971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6716974">func</span>&nbsp;<span class="op" id="6716979">(</span><span class="ident" id="6716980">r</span>&nbsp;<span class="op" id="6716982">*</span><span class="ident" id="6716983">recordingConn</span><span class="op" id="6716996">)</span>&nbsp;<span class="ident" id="6716998">Write</span><span class="op" id="6717003">(</span><span class="ident" id="6717004">b</span>&nbsp;<span class="op" id="6717006">[</span><span class="op" id="6717007">]</span><span class="builtintype" id="6717008">byte</span><span class="op" id="6717012">)</span>&nbsp;<span class="op" id="6717014">(</span><span class="ident" id="6717015">n</span>&nbsp;<span class="builtintype" id="6717017">int</span><span class="op" id="6717020">,</span>&nbsp;<span class="ident" id="6717022">err</span>&nbsp;<span class="builtintype" id="6717026">error</span><span class="op" id="6717031">)</span>&nbsp;<span class="op" id="6717033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717036">if</span>&nbsp;<span class="ident" id="6717039">n</span><span class="op" id="6717040">,</span>&nbsp;<span class="ident" id="6717042">err</span>&nbsp;<span class="op" id="6717046">=</span>&nbsp;<span class="ident" id="6717048">r</span><span class="op" id="6717049">.</span><span class="ident" id="6717050">Conn</span><span class="op" id="6717054">.</span><span class="ident" id="6717055">Write</span><span class="op" id="6717060">(</span><span class="ident" id="6717061">b</span><span class="op" id="6717062">)</span><span class="op" id="6717063">;</span>&nbsp;<span class="ident" id="6717065">n</span>&nbsp;<span class="op" id="6717067">==</span>&nbsp;<span class="num" id="6717070">0</span>&nbsp;<span class="op" id="6717072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717076">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717087">b</span>&nbsp;<span class="op" id="6717089">=</span>&nbsp;<span class="ident" id="6717091">b</span><span class="op" id="6717092">[</span><span class="op" id="6717093">:</span><span class="ident" id="6717094">n</span><span class="op" id="6717095">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717099">r</span><span class="op" id="6717100">.</span><span class="ident" id="6717101">Lock</span><span class="op" id="6717105">(</span><span class="op" id="6717106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717109">defer</span>&nbsp;<span class="ident" id="6717115">r</span><span class="op" id="6717116">.</span><span class="ident" id="6717117">Unlock</span><span class="op" id="6717123">(</span><span class="op" id="6717124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717128">if</span>&nbsp;<span class="ident" id="6717131">l</span>&nbsp;<span class="op" id="6717133">:=</span>&nbsp;<span class="builtinfunc" id="6717136">len</span><span class="op" id="6717139">(</span><span class="ident" id="6717140">r</span><span class="op" id="6717141">.</span><span class="ident" id="6717142">flows</span><span class="op" id="6717147">)</span><span class="op" id="6717148">;</span>&nbsp;<span class="ident" id="6717150">l</span>&nbsp;<span class="op" id="6717152">==</span>&nbsp;<span class="num" id="6717155">0</span>&nbsp;<span class="op" id="6717157">||</span>&nbsp;<span class="ident" id="6717160">r</span><span class="op" id="6717161">.</span><span class="ident" id="6717162">reading</span>&nbsp;<span class="op" id="6717170">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717174">buf</span>&nbsp;<span class="op" id="6717178">:=</span>&nbsp;<span class="builtinfunc" id="6717181">make</span><span class="op" id="6717185">(</span><span class="op" id="6717186">[</span><span class="op" id="6717187">]</span><span class="builtintype" id="6717188">byte</span><span class="op" id="6717192">,</span>&nbsp;<span class="builtinfunc" id="6717194">len</span><span class="op" id="6717197">(</span><span class="ident" id="6717198">b</span><span class="op" id="6717199">)</span><span class="op" id="6717200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6717204">copy</span><span class="op" id="6717208">(</span><span class="ident" id="6717209">buf</span><span class="op" id="6717212">,</span>&nbsp;<span class="ident" id="6717214">b</span><span class="op" id="6717215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717219">r</span><span class="op" id="6717220">.</span><span class="ident" id="6717221">flows</span>&nbsp;<span class="op" id="6717227">=</span>&nbsp;<span class="builtinfunc" id="6717229">append</span><span class="op" id="6717235">(</span><span class="ident" id="6717236">r</span><span class="op" id="6717237">.</span><span class="ident" id="6717238">flows</span><span class="op" id="6717243">,</span>&nbsp;<span class="ident" id="6717245">buf</span><span class="op" id="6717248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717251">}</span>&nbsp;<span class="keyword" id="6717253">else</span>&nbsp;<span class="op" id="6717258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717262">r</span><span class="op" id="6717263">.</span><span class="ident" id="6717264">flows</span><span class="op" id="6717269">[</span><span class="ident" id="6717270">l</span><span class="op" id="6717271">-</span><span class="num" id="6717272">1</span><span class="op" id="6717273">]</span>&nbsp;<span class="op" id="6717275">=</span>&nbsp;<span class="builtinfunc" id="6717277">append</span><span class="op" id="6717283">(</span><span class="ident" id="6717284">r</span><span class="op" id="6717285">.</span><span class="ident" id="6717286">flows</span><span class="op" id="6717291">[</span><span class="ident" id="6717292">l</span><span class="op" id="6717293">-</span><span class="num" id="6717294">1</span><span class="op" id="6717295">]</span><span class="op" id="6717296">,</span>&nbsp;<span class="ident" id="6717298">b</span><span class="op" id="6717299">[</span><span class="op" id="6717300">:</span><span class="ident" id="6717301">n</span><span class="op" id="6717302">]</span><span class="op" id="6717303">...</span><span class="op" id="6717306">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717312">r</span><span class="op" id="6717313">.</span><span class="ident" id="6717314">reading</span>&nbsp;<span class="op" id="6717322">=</span>&nbsp;<span class="builtintype" id="6717324">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717331">return</span><br>
<span class="lineno"></span><span class="op" id="6717338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6717341">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="6717415">func</span>&nbsp;<span class="op" id="6717420">(</span><span class="ident" id="6717421">r</span>&nbsp;<span class="op" id="6717423">*</span><span class="ident" id="6717424">recordingConn</span><span class="op" id="6717437">)</span>&nbsp;<span class="ident" id="6717439">WriteTo</span><span class="op" id="6717446">(</span><span class="ident" id="6717447">w</span>&nbsp;<span class="ident" id="6717449">io</span><span class="op" id="6717451">.</span><span class="ident" id="6717452">Writer</span><span class="op" id="6717458">)</span>&nbsp;<span class="op" id="6717460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717463">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717515">clientToServer</span>&nbsp;<span class="op" id="6717530">:=</span>&nbsp;<span class="builtintype" id="6717533">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717540">for</span>&nbsp;<span class="ident" id="6717544">i</span><span class="op" id="6717545">,</span>&nbsp;<span class="ident" id="6717547">flow</span>&nbsp;<span class="op" id="6717552">:=</span>&nbsp;<span class="keyword" id="6717555">range</span>&nbsp;<span class="ident" id="6717561">r</span><span class="op" id="6717562">.</span><span class="ident" id="6717563">flows</span>&nbsp;<span class="op" id="6717569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717573">source</span><span class="op" id="6717579">,</span>&nbsp;<span class="ident" id="6717581">dest</span>&nbsp;<span class="op" id="6717586">:=</span>&nbsp;<span class="string" id="6717589">&#34;client&#34;</span><span class="op" id="6717597">,</span>&nbsp;<span class="string" id="6717599">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717610">if</span>&nbsp;<span class="op" id="6717613">!</span><span class="ident" id="6717614">clientToServer</span>&nbsp;<span class="op" id="6717629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717634">source</span><span class="op" id="6717640">,</span>&nbsp;<span class="ident" id="6717642">dest</span>&nbsp;<span class="op" id="6717647">=</span>&nbsp;<span class="ident" id="6717649">dest</span><span class="op" id="6717653">,</span>&nbsp;<span class="ident" id="6717655">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717664">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717668">fmt</span><span class="op" id="6717671">.</span><span class="ident" id="6717672">Fprintf</span><span class="op" id="6717679">(</span><span class="ident" id="6717680">w</span><span class="op" id="6717681">,</span>&nbsp;<span class="string" id="6717683">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="6717709">,</span>&nbsp;<span class="ident" id="6717711">i</span><span class="op" id="6717712">+</span><span class="num" id="6717713">1</span><span class="op" id="6717714">,</span>&nbsp;<span class="ident" id="6717716">source</span><span class="op" id="6717722">,</span>&nbsp;<span class="ident" id="6717724">dest</span><span class="op" id="6717728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717732">dumper</span>&nbsp;<span class="op" id="6717739">:=</span>&nbsp;<span class="ident" id="6717742">hex</span><span class="op" id="6717745">.</span><span class="ident" id="6717746">Dumper</span><span class="op" id="6717752">(</span><span class="ident" id="6717753">w</span><span class="op" id="6717754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717758">dumper</span><span class="op" id="6717764">.</span><span class="ident" id="6717765">Write</span><span class="op" id="6717770">(</span><span class="ident" id="6717771">flow</span><span class="op" id="6717775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717779">dumper</span><span class="op" id="6717785">.</span><span class="ident" id="6717786">Close</span><span class="op" id="6717791">(</span><span class="op" id="6717792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717796">clientToServer</span>&nbsp;<span class="op" id="6717811">=</span>&nbsp;<span class="op" id="6717813">!</span><span class="ident" id="6717814">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717830">}</span><br>
<span class="lineno"></span><span class="op" id="6717832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6717835">func</span>&nbsp;<span class="ident" id="6717840">parseTestData</span><span class="op" id="6717853">(</span><span class="ident" id="6717854">r</span>&nbsp;<span class="ident" id="6717856">io</span><span class="op" id="6717858">.</span><span class="ident" id="6717859">Reader</span><span class="op" id="6717865">)</span>&nbsp;<span class="op" id="6717867">(</span><span class="ident" id="6717868">flows</span>&nbsp;<span class="op" id="6717874">[</span><span class="op" id="6717875">]</span><span class="op" id="6717876">[</span><span class="op" id="6717877">]</span><span class="builtintype" id="6717878">byte</span><span class="op" id="6717882">,</span>&nbsp;<span class="ident" id="6717884">err</span>&nbsp;<span class="builtintype" id="6717888">error</span><span class="op" id="6717893">)</span>&nbsp;<span class="op" id="6717895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717898">var</span>&nbsp;<span class="ident" id="6717902">currentFlow</span>&nbsp;<span class="op" id="6717914">[</span><span class="op" id="6717915">]</span><span class="builtintype" id="6717916">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717923">scanner</span>&nbsp;<span class="op" id="6717931">:=</span>&nbsp;<span class="ident" id="6717934">bufio</span><span class="op" id="6717939">.</span><span class="ident" id="6717940">NewScanner</span><span class="op" id="6717950">(</span><span class="ident" id="6717951">r</span><span class="op" id="6717952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717955">for</span>&nbsp;<span class="ident" id="6717959">scanner</span><span class="op" id="6717966">.</span><span class="ident" id="6717967">Scan</span><span class="op" id="6717971">(</span><span class="op" id="6717972">)</span>&nbsp;<span class="op" id="6717974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717978">line</span>&nbsp;<span class="op" id="6717983">:=</span>&nbsp;<span class="ident" id="6717986">scanner</span><span class="op" id="6717993">.</span><span class="ident" id="6717994">Text</span><span class="op" id="6717998">(</span><span class="op" id="6717999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718003">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718067">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718087">if</span>&nbsp;<span class="ident" id="6718090">strings</span><span class="op" id="6718097">.</span><span class="ident" id="6718098">HasPrefix</span><span class="op" id="6718107">(</span><span class="ident" id="6718108">line</span><span class="op" id="6718112">,</span>&nbsp;<span class="string" id="6718114">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="6718120">)</span>&nbsp;<span class="op" id="6718122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718127">if</span>&nbsp;<span class="builtinfunc" id="6718130">len</span><span class="op" id="6718133">(</span><span class="ident" id="6718134">currentFlow</span><span class="op" id="6718145">)</span>&nbsp;<span class="op" id="6718147">&gt;</span>&nbsp;<span class="num" id="6718149">0</span>&nbsp;<span class="op" id="6718151">||</span>&nbsp;<span class="builtinfunc" id="6718154">len</span><span class="op" id="6718157">(</span><span class="ident" id="6718158">flows</span><span class="op" id="6718163">)</span>&nbsp;<span class="op" id="6718165">&gt;</span>&nbsp;<span class="num" id="6718167">0</span>&nbsp;<span class="op" id="6718169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718175">flows</span>&nbsp;<span class="op" id="6718181">=</span>&nbsp;<span class="builtinfunc" id="6718183">append</span><span class="op" id="6718189">(</span><span class="ident" id="6718190">flows</span><span class="op" id="6718195">,</span>&nbsp;<span class="ident" id="6718197">currentFlow</span><span class="op" id="6718208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718214">currentFlow</span>&nbsp;<span class="op" id="6718226">=</span>&nbsp;<span class="ident" id="6718228">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718240">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718256">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718319">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718372">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718434">if</span>&nbsp;<span class="ident" id="6718437">i</span>&nbsp;<span class="op" id="6718439">:=</span>&nbsp;<span class="ident" id="6718442">strings</span><span class="op" id="6718449">.</span><span class="ident" id="6718450">IndexByte</span><span class="op" id="6718459">(</span><span class="ident" id="6718460">line</span><span class="op" id="6718464">,</span>&nbsp;<span class="string" id="6718466">&#39;&nbsp;&#39;</span><span class="op" id="6718469">)</span><span class="op" id="6718470">;</span>&nbsp;<span class="ident" id="6718472">i</span>&nbsp;<span class="op" id="6718474">&gt;=</span>&nbsp;<span class="num" id="6718477">0</span>&nbsp;<span class="op" id="6718479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718484">line</span>&nbsp;<span class="op" id="6718489">=</span>&nbsp;<span class="ident" id="6718491">line</span><span class="op" id="6718495">[</span><span class="ident" id="6718496">i</span><span class="op" id="6718497">:</span><span class="op" id="6718498">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718502">}</span>&nbsp;<span class="keyword" id="6718504">else</span>&nbsp;<span class="op" id="6718509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718514">return</span>&nbsp;<span class="ident" id="6718521">nil</span><span class="op" id="6718524">,</span>&nbsp;<span class="ident" id="6718526">errors</span><span class="op" id="6718532">.</span><span class="ident" id="6718533">New</span><span class="op" id="6718536">(</span><span class="string" id="6718537">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="6718556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718565">if</span>&nbsp;<span class="ident" id="6718568">i</span>&nbsp;<span class="op" id="6718570">:=</span>&nbsp;<span class="ident" id="6718573">strings</span><span class="op" id="6718580">.</span><span class="ident" id="6718581">IndexByte</span><span class="op" id="6718590">(</span><span class="ident" id="6718591">line</span><span class="op" id="6718595">,</span>&nbsp;<span class="string" id="6718597">&#39;|&#39;</span><span class="op" id="6718600">)</span><span class="op" id="6718601">;</span>&nbsp;<span class="ident" id="6718603">i</span>&nbsp;<span class="op" id="6718605">&gt;=</span>&nbsp;<span class="num" id="6718608">0</span>&nbsp;<span class="op" id="6718610">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718615">line</span>&nbsp;<span class="op" id="6718620">=</span>&nbsp;<span class="ident" id="6718622">line</span><span class="op" id="6718626">[</span><span class="op" id="6718627">:</span><span class="ident" id="6718628">i</span><span class="op" id="6718629">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718633">}</span>&nbsp;<span class="keyword" id="6718635">else</span>&nbsp;<span class="op" id="6718640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718645">return</span>&nbsp;<span class="ident" id="6718652">nil</span><span class="op" id="6718655">,</span>&nbsp;<span class="ident" id="6718657">errors</span><span class="op" id="6718663">.</span><span class="ident" id="6718664">New</span><span class="op" id="6718667">(</span><span class="string" id="6718668">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="6718687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718696">hexBytes</span>&nbsp;<span class="op" id="6718705">:=</span>&nbsp;<span class="ident" id="6718708">strings</span><span class="op" id="6718715">.</span><span class="ident" id="6718716">Fields</span><span class="op" id="6718722">(</span><span class="ident" id="6718723">line</span><span class="op" id="6718727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718731">for</span>&nbsp;<span class="ident" id="6718735">_</span><span class="op" id="6718736">,</span>&nbsp;<span class="ident" id="6718738">hexByte</span>&nbsp;<span class="op" id="6718746">:=</span>&nbsp;<span class="keyword" id="6718749">range</span>&nbsp;<span class="ident" id="6718755">hexBytes</span>&nbsp;<span class="op" id="6718764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718769">val</span><span class="op" id="6718772">,</span>&nbsp;<span class="ident" id="6718774">err</span>&nbsp;<span class="op" id="6718778">:=</span>&nbsp;<span class="ident" id="6718781">strconv</span><span class="op" id="6718788">.</span><span class="ident" id="6718789">ParseUint</span><span class="op" id="6718798">(</span><span class="ident" id="6718799">hexByte</span><span class="op" id="6718806">,</span>&nbsp;<span class="num" id="6718808">16</span><span class="op" id="6718810">,</span>&nbsp;<span class="num" id="6718812">8</span><span class="op" id="6718813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718818">if</span>&nbsp;<span class="ident" id="6718821">err</span>&nbsp;<span class="op" id="6718825">!=</span>&nbsp;<span class="ident" id="6718828">nil</span>&nbsp;<span class="op" id="6718832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718838">return</span>&nbsp;<span class="ident" id="6718845">nil</span><span class="op" id="6718848">,</span>&nbsp;<span class="ident" id="6718850">errors</span><span class="op" id="6718856">.</span><span class="ident" id="6718857">New</span><span class="op" id="6718860">(</span><span class="string" id="6718861">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="6718895">+</span>&nbsp;<span class="ident" id="6718897">err</span><span class="op" id="6718900">.</span><span class="ident" id="6718901">Error</span><span class="op" id="6718906">(</span><span class="op" id="6718907">)</span><span class="op" id="6718908">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718918">currentFlow</span>&nbsp;<span class="op" id="6718930">=</span>&nbsp;<span class="builtinfunc" id="6718932">append</span><span class="op" id="6718938">(</span><span class="ident" id="6718939">currentFlow</span><span class="op" id="6718950">,</span>&nbsp;<span class="builtintype" id="6718952">byte</span><span class="op" id="6718956">(</span><span class="ident" id="6718957">val</span><span class="op" id="6718960">)</span><span class="op" id="6718961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718972">if</span>&nbsp;<span class="builtinfunc" id="6718975">len</span><span class="op" id="6718978">(</span><span class="ident" id="6718979">currentFlow</span><span class="op" id="6718990">)</span>&nbsp;<span class="op" id="6718992">&gt;</span>&nbsp;<span class="num" id="6718994">0</span>&nbsp;<span class="op" id="6718996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719000">flows</span>&nbsp;<span class="op" id="6719006">=</span>&nbsp;<span class="builtinfunc" id="6719008">append</span><span class="op" id="6719014">(</span><span class="ident" id="6719015">flows</span><span class="op" id="6719020">,</span>&nbsp;<span class="ident" id="6719022">currentFlow</span><span class="op" id="6719033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719040">return</span>&nbsp;<span class="ident" id="6719047">flows</span><span class="op" id="6719052">,</span>&nbsp;<span class="ident" id="6719054">nil</span><br>
<span class="lineno">155</span><span class="op" id="6719058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6719061">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="6719135">func</span>&nbsp;<span class="ident" id="6719140">tempFile</span><span class="op" id="6719148">(</span><span class="ident" id="6719149">contents</span>&nbsp;<span class="builtintype" id="6719158">string</span><span class="op" id="6719164">)</span>&nbsp;<span class="builtintype" id="6719166">string</span>&nbsp;<span class="op" id="6719173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719176">file</span><span class="op" id="6719180">,</span>&nbsp;<span class="ident" id="6719182">err</span>&nbsp;<span class="op" id="6719186">:=</span>&nbsp;<span class="ident" id="6719189">ioutil</span><span class="op" id="6719195">.</span><span class="ident" id="6719196">TempFile</span><span class="op" id="6719204">(</span><span class="string" id="6719205">&#34;&#34;</span><span class="op" id="6719207">,</span>&nbsp;<span class="string" id="6719209">&#34;go-tls-test&#34;</span><span class="op" id="6719222">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719225">if</span>&nbsp;<span class="ident" id="6719228">err</span>&nbsp;<span class="op" id="6719232">!=</span>&nbsp;<span class="ident" id="6719235">nil</span>&nbsp;<span class="op" id="6719239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6719243">panic</span><span class="op" id="6719248">(</span><span class="string" id="6719249">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="6719280">+</span>&nbsp;<span class="ident" id="6719282">err</span><span class="op" id="6719285">.</span><span class="ident" id="6719286">Error</span><span class="op" id="6719291">(</span><span class="op" id="6719292">)</span><span class="op" id="6719293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719299">path</span>&nbsp;<span class="op" id="6719304">:=</span>&nbsp;<span class="ident" id="6719307">file</span><span class="op" id="6719311">.</span><span class="ident" id="6719312">Name</span><span class="op" id="6719316">(</span><span class="op" id="6719317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719320">file</span><span class="op" id="6719324">.</span><span class="ident" id="6719325">WriteString</span><span class="op" id="6719336">(</span><span class="ident" id="6719337">contents</span><span class="op" id="6719345">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719348">file</span><span class="op" id="6719352">.</span><span class="ident" id="6719353">Close</span><span class="op" id="6719358">(</span><span class="op" id="6719359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719362">return</span>&nbsp;<span class="ident" id="6719369">path</span><br>
<span class="lineno"></span><span class="op" id="6719374">}</span>
</div>
</body>
</html>
