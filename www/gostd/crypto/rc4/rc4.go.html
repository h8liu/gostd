<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html" class="current">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4488780">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4488835">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4488889">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4488940">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4489013">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4489038">package</span>&nbsp;<span class="ident" id="4489046">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4489051">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4489121">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4489161">import</span>&nbsp;<span class="string" id="4489168">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4489179">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4489237">type</span>&nbsp;<span class="ident" id="4489242">Cipher</span>&nbsp;<span class="keyword" id="4489249">struct</span>&nbsp;<span class="op" id="4489256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489259">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489264">[</span><span class="num" id="4489265">256</span><span class="op" id="4489268">]</span><span class="builtintype" id="4489269">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489277">i</span><span class="op" id="4489278">,</span>&nbsp;<span class="ident" id="4489280">j</span>&nbsp;<span class="builtintype" id="4489282">uint8</span><br>
<span class="lineno"></span><span class="op" id="4489288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4489291">type</span>&nbsp;<span class="ident" id="4489296">KeySizeError</span>&nbsp;<span class="builtintype" id="4489309">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4489314">func</span>&nbsp;<span class="op" id="4489319">(</span><span class="ident" id="4489320">k</span>&nbsp;<span class="ident" id="4489322">KeySizeError</span><span class="op" id="4489334">)</span>&nbsp;<span class="ident" id="4489336">Error</span><span class="op" id="4489341">(</span><span class="op" id="4489342">)</span>&nbsp;<span class="builtintype" id="4489344">string</span>&nbsp;<span class="op" id="4489351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489354">return</span>&nbsp;<span class="string" id="4489361">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4489393">+</span>&nbsp;<span class="ident" id="4489395">strconv</span><span class="op" id="4489402">.</span><span class="ident" id="4489403">Itoa</span><span class="op" id="4489407">(</span><span class="builtintype" id="4489408">int</span><span class="op" id="4489411">(</span><span class="ident" id="4489412">k</span><span class="op" id="4489413">)</span><span class="op" id="4489414">)</span><br>
<span class="lineno"></span><span class="op" id="4489416">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4489419">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4489498">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4489549">func</span>&nbsp;<span class="ident" id="4489554">NewCipher</span><span class="op" id="4489563">(</span><span class="ident" id="4489564">key</span>&nbsp;<span class="op" id="4489568">[</span><span class="op" id="4489569">]</span><span class="builtintype" id="4489570">byte</span><span class="op" id="4489574">)</span>&nbsp;<span class="op" id="4489576">(</span><span class="op" id="4489577">*</span><span class="ident" id="4489578">Cipher</span><span class="op" id="4489584">,</span>&nbsp;<span class="builtintype" id="4489586">error</span><span class="op" id="4489591">)</span>&nbsp;<span class="op" id="4489593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489596">k</span>&nbsp;<span class="op" id="4489598">:=</span>&nbsp;<span class="builtinfunc" id="4489601">len</span><span class="op" id="4489604">(</span><span class="ident" id="4489605">key</span><span class="op" id="4489608">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489611">if</span>&nbsp;<span class="ident" id="4489614">k</span>&nbsp;<span class="op" id="4489616">&lt;</span>&nbsp;<span class="num" id="4489618">1</span>&nbsp;<span class="op" id="4489620">||</span>&nbsp;<span class="ident" id="4489623">k</span>&nbsp;<span class="op" id="4489625">&gt;</span>&nbsp;<span class="num" id="4489627">256</span>&nbsp;<span class="op" id="4489631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489635">return</span>&nbsp;<span class="builtintype" id="4489642">nil</span><span class="op" id="4489645">,</span>&nbsp;<span class="ident" id="4489647">KeySizeError</span><span class="op" id="4489659">(</span><span class="ident" id="4489660">k</span><span class="op" id="4489661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489667">var</span>&nbsp;<span class="ident" id="4489671">c</span>&nbsp;<span class="ident" id="4489673">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489681">for</span>&nbsp;<span class="ident" id="4489685">i</span>&nbsp;<span class="op" id="4489687">:=</span>&nbsp;<span class="num" id="4489690">0</span><span class="op" id="4489691">;</span>&nbsp;<span class="ident" id="4489693">i</span>&nbsp;<span class="op" id="4489695">&lt;</span>&nbsp;<span class="num" id="4489697">256</span><span class="op" id="4489700">;</span>&nbsp;<span class="ident" id="4489702">i</span><span class="op" id="4489703">++</span>&nbsp;<span class="op" id="4489706">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489710">c</span><span class="op" id="4489711">.</span><span class="ident" id="4489712">s</span><span class="op" id="4489713">[</span><span class="ident" id="4489714">i</span><span class="op" id="4489715">]</span>&nbsp;<span class="op" id="4489717">=</span>&nbsp;<span class="builtintype" id="4489719">uint32</span><span class="op" id="4489725">(</span><span class="ident" id="4489726">i</span><span class="op" id="4489727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489733">var</span>&nbsp;<span class="ident" id="4489737">j</span>&nbsp;<span class="builtintype" id="4489739">uint8</span>&nbsp;<span class="op" id="4489745">=</span>&nbsp;<span class="num" id="4489747">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489750">for</span>&nbsp;<span class="ident" id="4489754">i</span>&nbsp;<span class="op" id="4489756">:=</span>&nbsp;<span class="num" id="4489759">0</span><span class="op" id="4489760">;</span>&nbsp;<span class="ident" id="4489762">i</span>&nbsp;<span class="op" id="4489764">&lt;</span>&nbsp;<span class="num" id="4489766">256</span><span class="op" id="4489769">;</span>&nbsp;<span class="ident" id="4489771">i</span><span class="op" id="4489772">++</span>&nbsp;<span class="op" id="4489775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489779">j</span>&nbsp;<span class="op" id="4489781">+=</span>&nbsp;<span class="builtintype" id="4489784">uint8</span><span class="op" id="4489789">(</span><span class="ident" id="4489790">c</span><span class="op" id="4489791">.</span><span class="ident" id="4489792">s</span><span class="op" id="4489793">[</span><span class="ident" id="4489794">i</span><span class="op" id="4489795">]</span><span class="op" id="4489796">)</span>&nbsp;<span class="op" id="4489798">+</span>&nbsp;<span class="ident" id="4489800">key</span><span class="op" id="4489803">[</span><span class="ident" id="4489804">i</span><span class="op" id="4489805">%</span><span class="ident" id="4489806">k</span><span class="op" id="4489807">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489811">c</span><span class="op" id="4489812">.</span><span class="ident" id="4489813">s</span><span class="op" id="4489814">[</span><span class="ident" id="4489815">i</span><span class="op" id="4489816">]</span><span class="op" id="4489817">,</span>&nbsp;<span class="ident" id="4489819">c</span><span class="op" id="4489820">.</span><span class="ident" id="4489821">s</span><span class="op" id="4489822">[</span><span class="ident" id="4489823">j</span><span class="op" id="4489824">]</span>&nbsp;<span class="op" id="4489826">=</span>&nbsp;<span class="ident" id="4489828">c</span><span class="op" id="4489829">.</span><span class="ident" id="4489830">s</span><span class="op" id="4489831">[</span><span class="ident" id="4489832">j</span><span class="op" id="4489833">]</span><span class="op" id="4489834">,</span>&nbsp;<span class="ident" id="4489836">c</span><span class="op" id="4489837">.</span><span class="ident" id="4489838">s</span><span class="op" id="4489839">[</span><span class="ident" id="4489840">i</span><span class="op" id="4489841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489847">return</span>&nbsp;<span class="op" id="4489854">&amp;</span><span class="ident" id="4489855">c</span><span class="op" id="4489856">,</span>&nbsp;<span class="builtintype" id="4489858">nil</span><br>
<span class="lineno"></span><span class="op" id="4489862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4489865">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4489933">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4489954">func</span>&nbsp;<span class="op" id="4489959">(</span><span class="ident" id="4489960">c</span>&nbsp;<span class="op" id="4489962">*</span><span class="ident" id="4489963">Cipher</span><span class="op" id="4489969">)</span>&nbsp;<span class="ident" id="4489971">Reset</span><span class="op" id="4489976">(</span><span class="op" id="4489977">)</span>&nbsp;<span class="op" id="4489979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489982">for</span>&nbsp;<span class="ident" id="4489986">i</span>&nbsp;<span class="op" id="4489988">:=</span>&nbsp;<span class="keyword" id="4489991">range</span>&nbsp;<span class="ident" id="4489997">c</span><span class="op" id="4489998">.</span><span class="ident" id="4489999">s</span>&nbsp;<span class="op" id="4490001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490005">c</span><span class="op" id="4490006">.</span><span class="ident" id="4490007">s</span><span class="op" id="4490008">[</span><span class="ident" id="4490009">i</span><span class="op" id="4490010">]</span>&nbsp;<span class="op" id="4490012">=</span>&nbsp;<span class="num" id="4490014">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490020">c</span><span class="op" id="4490021">.</span><span class="ident" id="4490022">i</span><span class="op" id="4490023">,</span>&nbsp;<span class="ident" id="4490025">c</span><span class="op" id="4490026">.</span><span class="ident" id="4490027">j</span>&nbsp;<span class="op" id="4490029">=</span>&nbsp;<span class="num" id="4490031">0</span><span class="op" id="4490032">,</span>&nbsp;<span class="num" id="4490034">0</span><br>
<span class="lineno"></span><span class="op" id="4490036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4490039">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4490108">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4490179">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4490195">//</span><br>
<span class="lineno"></span><span class="comment" id="4490198">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4490268">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4490334">func</span>&nbsp;<span class="op" id="4490339">(</span><span class="ident" id="4490340">c</span>&nbsp;<span class="op" id="4490342">*</span><span class="ident" id="4490343">Cipher</span><span class="op" id="4490349">)</span>&nbsp;<span class="ident" id="4490351">xorKeyStreamGeneric</span><span class="op" id="4490370">(</span><span class="ident" id="4490371">dst</span><span class="op" id="4490374">,</span>&nbsp;<span class="ident" id="4490376">src</span>&nbsp;<span class="op" id="4490380">[</span><span class="op" id="4490381">]</span><span class="builtintype" id="4490382">byte</span><span class="op" id="4490386">)</span>&nbsp;<span class="op" id="4490388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490391">i</span><span class="op" id="4490392">,</span>&nbsp;<span class="ident" id="4490394">j</span>&nbsp;<span class="op" id="4490396">:=</span>&nbsp;<span class="ident" id="4490399">c</span><span class="op" id="4490400">.</span><span class="ident" id="4490401">i</span><span class="op" id="4490402">,</span>&nbsp;<span class="ident" id="4490404">c</span><span class="op" id="4490405">.</span><span class="ident" id="4490406">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490409">for</span>&nbsp;<span class="ident" id="4490413">k</span><span class="op" id="4490414">,</span>&nbsp;<span class="ident" id="4490416">v</span>&nbsp;<span class="op" id="4490418">:=</span>&nbsp;<span class="keyword" id="4490421">range</span>&nbsp;<span class="ident" id="4490427">src</span>&nbsp;<span class="op" id="4490431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490435">i</span>&nbsp;<span class="op" id="4490437">+=</span>&nbsp;<span class="num" id="4490440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490444">j</span>&nbsp;<span class="op" id="4490446">+=</span>&nbsp;<span class="builtintype" id="4490449">uint8</span><span class="op" id="4490454">(</span><span class="ident" id="4490455">c</span><span class="op" id="4490456">.</span><span class="ident" id="4490457">s</span><span class="op" id="4490458">[</span><span class="ident" id="4490459">i</span><span class="op" id="4490460">]</span><span class="op" id="4490461">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490465">c</span><span class="op" id="4490466">.</span><span class="ident" id="4490467">s</span><span class="op" id="4490468">[</span><span class="ident" id="4490469">i</span><span class="op" id="4490470">]</span><span class="op" id="4490471">,</span>&nbsp;<span class="ident" id="4490473">c</span><span class="op" id="4490474">.</span><span class="ident" id="4490475">s</span><span class="op" id="4490476">[</span><span class="ident" id="4490477">j</span><span class="op" id="4490478">]</span>&nbsp;<span class="op" id="4490480">=</span>&nbsp;<span class="ident" id="4490482">c</span><span class="op" id="4490483">.</span><span class="ident" id="4490484">s</span><span class="op" id="4490485">[</span><span class="ident" id="4490486">j</span><span class="op" id="4490487">]</span><span class="op" id="4490488">,</span>&nbsp;<span class="ident" id="4490490">c</span><span class="op" id="4490491">.</span><span class="ident" id="4490492">s</span><span class="op" id="4490493">[</span><span class="ident" id="4490494">i</span><span class="op" id="4490495">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490499">dst</span><span class="op" id="4490502">[</span><span class="ident" id="4490503">k</span><span class="op" id="4490504">]</span>&nbsp;<span class="op" id="4490506">=</span>&nbsp;<span class="ident" id="4490508">v</span>&nbsp;<span class="op" id="4490510">^</span>&nbsp;<span class="builtintype" id="4490512">uint8</span><span class="op" id="4490517">(</span><span class="ident" id="4490518">c</span><span class="op" id="4490519">.</span><span class="ident" id="4490520">s</span><span class="op" id="4490521">[</span><span class="builtintype" id="4490522">uint8</span><span class="op" id="4490527">(</span><span class="ident" id="4490528">c</span><span class="op" id="4490529">.</span><span class="ident" id="4490530">s</span><span class="op" id="4490531">[</span><span class="ident" id="4490532">i</span><span class="op" id="4490533">]</span><span class="op" id="4490534">+</span><span class="ident" id="4490535">c</span><span class="op" id="4490536">.</span><span class="ident" id="4490537">s</span><span class="op" id="4490538">[</span><span class="ident" id="4490539">j</span><span class="op" id="4490540">]</span><span class="op" id="4490541">)</span><span class="op" id="4490542">]</span><span class="op" id="4490543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490549">c</span><span class="op" id="4490550">.</span><span class="ident" id="4490551">i</span><span class="op" id="4490552">,</span>&nbsp;<span class="ident" id="4490554">c</span><span class="op" id="4490555">.</span><span class="ident" id="4490556">j</span>&nbsp;<span class="op" id="4490558">=</span>&nbsp;<span class="ident" id="4490560">i</span><span class="op" id="4490561">,</span>&nbsp;<span class="ident" id="4490563">j</span><br>
<span class="lineno"></span><span class="op" id="4490565">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
