<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7863551">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7863607">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7863661">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7863712">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="7863791">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863800">package</span>&nbsp;<span class="ident" id="7863808">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7863813">import</span>&nbsp;<span class="op" id="7863820">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863823">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863836">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863842">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863853">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863864">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7863871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7863874">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="7863944">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="7864012">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="7864034">func</span>&nbsp;<span class="ident" id="7864039">testUnixAddr</span><span class="op" id="7864051">(</span><span class="op" id="7864052">)</span>&nbsp;<span class="builtintype" id="7864054">string</span>&nbsp;<span class="op" id="7864061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864064">f</span><span class="op" id="7864065">,</span>&nbsp;<span class="ident" id="7864067">err</span>&nbsp;<span class="op" id="7864071">:=</span>&nbsp;<span class="ident" id="7864074">ioutil</span><span class="op" id="7864080">.</span><span class="ident" id="7864081">TempFile</span><span class="op" id="7864089">(</span><span class="string" id="7864090">&#34;&#34;</span><span class="op" id="7864092">,</span>&nbsp;<span class="string" id="7864094">&#34;nettest&#34;</span><span class="op" id="7864103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864106">if</span>&nbsp;<span class="ident" id="7864109">err</span>&nbsp;<span class="op" id="7864113">!=</span>&nbsp;<span class="ident" id="7864116">nil</span>&nbsp;<span class="op" id="7864120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7864124">panic</span><span class="op" id="7864129">(</span><span class="ident" id="7864130">err</span><span class="op" id="7864133">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864139">addr</span>&nbsp;<span class="op" id="7864144">:=</span>&nbsp;<span class="ident" id="7864147">f</span><span class="op" id="7864148">.</span><span class="ident" id="7864149">Name</span><span class="op" id="7864153">(</span><span class="op" id="7864154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864157">f</span><span class="op" id="7864158">.</span><span class="ident" id="7864159">Close</span><span class="op" id="7864164">(</span><span class="op" id="7864165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864168">os</span><span class="op" id="7864170">.</span><span class="ident" id="7864171">Remove</span><span class="op" id="7864177">(</span><span class="ident" id="7864178">addr</span><span class="op" id="7864182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864185">return</span>&nbsp;<span class="ident" id="7864192">addr</span><br>
<span class="lineno">30</span><span class="op" id="7864197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7864200">var</span>&nbsp;<span class="ident" id="7864204">condFatalf</span>&nbsp;<span class="op" id="7864215">=</span>&nbsp;<span class="keyword" id="7864217">func</span><span class="op" id="7864221">(</span><span class="op" id="7864222">)</span>&nbsp;<span class="keyword" id="7864224">func</span><span class="op" id="7864228">(</span><span class="op" id="7864229">*</span><span class="ident" id="7864230">testing</span><span class="op" id="7864237">.</span><span class="ident" id="7864238">T</span><span class="op" id="7864239">,</span>&nbsp;<span class="builtintype" id="7864241">string</span><span class="op" id="7864247">,</span>&nbsp;<span class="op" id="7864249">...</span><span class="keyword" id="7864252">interface</span><span class="op" id="7864261">{</span><span class="op" id="7864262">}</span><span class="op" id="7864263">)</span>&nbsp;<span class="op" id="7864265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7864268">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864335">switch</span>&nbsp;<span class="ident" id="7864342">runtime</span><span class="op" id="7864349">.</span><span class="ident" id="7864350">GOOS</span>&nbsp;<span class="op" id="7864355">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864358">case</span>&nbsp;<span class="string" id="7864363">&#34;plan9&#34;</span><span class="op" id="7864370">,</span>&nbsp;<span class="string" id="7864372">&#34;windows&#34;</span><span class="op" id="7864381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864385">return</span>&nbsp;<span class="op" id="7864392">(</span><span class="op" id="7864393">*</span><span class="ident" id="7864394">testing</span><span class="op" id="7864401">.</span><span class="ident" id="7864402">T</span><span class="op" id="7864403">)</span><span class="op" id="7864404">.</span><span class="ident" id="7864405">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864414">return</span>&nbsp;<span class="op" id="7864421">(</span><span class="op" id="7864422">*</span><span class="ident" id="7864423">testing</span><span class="op" id="7864430">.</span><span class="ident" id="7864431">T</span><span class="op" id="7864432">)</span><span class="op" id="7864433">.</span><span class="ident" id="7864434">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="7864441">}</span><span class="op" id="7864442">(</span><span class="op" id="7864443">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7864446">func</span>&nbsp;<span class="ident" id="7864451">TestTCPListenerSpecificMethods</span><span class="op" id="7864481">(</span><span class="ident" id="7864482">t</span>&nbsp;<span class="op" id="7864484">*</span><span class="ident" id="7864485">testing</span><span class="op" id="7864492">.</span><span class="ident" id="7864493">T</span><span class="op" id="7864494">)</span>&nbsp;<span class="op" id="7864496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864499">switch</span>&nbsp;<span class="ident" id="7864506">runtime</span><span class="op" id="7864513">.</span><span class="ident" id="7864514">GOOS</span>&nbsp;<span class="op" id="7864519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864522">case</span>&nbsp;<span class="string" id="7864527">&#34;plan9&#34;</span><span class="op" id="7864534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864538">t</span><span class="op" id="7864539">.</span><span class="ident" id="7864540">Skipf</span><span class="op" id="7864545">(</span><span class="string" id="7864546">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7864567">,</span>&nbsp;<span class="ident" id="7864569">runtime</span><span class="op" id="7864576">.</span><span class="ident" id="7864577">GOOS</span><span class="op" id="7864581">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864588">la</span><span class="op" id="7864590">,</span>&nbsp;<span class="ident" id="7864592">err</span>&nbsp;<span class="op" id="7864596">:=</span>&nbsp;<span class="ident" id="7864599">ResolveTCPAddr</span><span class="op" id="7864613">(</span><span class="string" id="7864614">&#34;tcp4&#34;</span><span class="op" id="7864620">,</span>&nbsp;<span class="string" id="7864622">&#34;127.0.0.1:0&#34;</span><span class="op" id="7864635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864638">if</span>&nbsp;<span class="ident" id="7864641">err</span>&nbsp;<span class="op" id="7864645">!=</span>&nbsp;<span class="ident" id="7864648">nil</span>&nbsp;<span class="op" id="7864652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864656">t</span><span class="op" id="7864657">.</span><span class="ident" id="7864658">Fatalf</span><span class="op" id="7864664">(</span><span class="string" id="7864665">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864692">,</span>&nbsp;<span class="ident" id="7864694">err</span><span class="op" id="7864697">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864703">ln</span><span class="op" id="7864705">,</span>&nbsp;<span class="ident" id="7864707">err</span>&nbsp;<span class="op" id="7864711">:=</span>&nbsp;<span class="ident" id="7864714">ListenTCP</span><span class="op" id="7864723">(</span><span class="string" id="7864724">&#34;tcp4&#34;</span><span class="op" id="7864730">,</span>&nbsp;<span class="ident" id="7864732">la</span><span class="op" id="7864734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864737">if</span>&nbsp;<span class="ident" id="7864740">err</span>&nbsp;<span class="op" id="7864744">!=</span>&nbsp;<span class="ident" id="7864747">nil</span>&nbsp;<span class="op" id="7864751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864755">t</span><span class="op" id="7864756">.</span><span class="ident" id="7864757">Fatalf</span><span class="op" id="7864763">(</span><span class="string" id="7864764">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864786">,</span>&nbsp;<span class="ident" id="7864788">err</span><span class="op" id="7864791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864794">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864797">defer</span>&nbsp;<span class="ident" id="7864803">ln</span><span class="op" id="7864805">.</span><span class="ident" id="7864806">Close</span><span class="op" id="7864811">(</span><span class="op" id="7864812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864815">ln</span><span class="op" id="7864817">.</span><span class="ident" id="7864818">Addr</span><span class="op" id="7864822">(</span><span class="op" id="7864823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864826">ln</span><span class="op" id="7864828">.</span><span class="ident" id="7864829">SetDeadline</span><span class="op" id="7864840">(</span><span class="ident" id="7864841">time</span><span class="op" id="7864845">.</span><span class="ident" id="7864846">Now</span><span class="op" id="7864849">(</span><span class="op" id="7864850">)</span><span class="op" id="7864851">.</span><span class="ident" id="7864852">Add</span><span class="op" id="7864855">(</span><span class="num" id="7864856">30</span>&nbsp;<span class="op" id="7864859">*</span>&nbsp;<span class="ident" id="7864861">time</span><span class="op" id="7864865">.</span><span class="ident" id="7864866">Nanosecond</span><span class="op" id="7864876">)</span><span class="op" id="7864877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864881">if</span>&nbsp;<span class="ident" id="7864884">c</span><span class="op" id="7864885">,</span>&nbsp;<span class="ident" id="7864887">err</span>&nbsp;<span class="op" id="7864891">:=</span>&nbsp;<span class="ident" id="7864894">ln</span><span class="op" id="7864896">.</span><span class="ident" id="7864897">Accept</span><span class="op" id="7864903">(</span><span class="op" id="7864904">)</span><span class="op" id="7864905">;</span>&nbsp;<span class="ident" id="7864907">err</span>&nbsp;<span class="op" id="7864911">!=</span>&nbsp;<span class="ident" id="7864914">nil</span>&nbsp;<span class="op" id="7864918">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864922">if</span>&nbsp;<span class="op" id="7864925">!</span><span class="ident" id="7864926">err</span><span class="op" id="7864929">.</span><span class="op" id="7864930">(</span><span class="ident" id="7864931">Error</span><span class="op" id="7864936">)</span><span class="op" id="7864937">.</span><span class="ident" id="7864938">Timeout</span><span class="op" id="7864945">(</span><span class="op" id="7864946">)</span>&nbsp;<span class="op" id="7864948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864953">t</span><span class="op" id="7864954">.</span><span class="ident" id="7864955">Fatalf</span><span class="op" id="7864961">(</span><span class="string" id="7864962">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864993">,</span>&nbsp;<span class="ident" id="7864995">err</span><span class="op" id="7864998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865005">}</span>&nbsp;<span class="keyword" id="7865007">else</span>&nbsp;<span class="op" id="7865012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865016">c</span><span class="op" id="7865017">.</span><span class="ident" id="7865018">Close</span><span class="op" id="7865023">(</span><span class="op" id="7865024">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865030">if</span>&nbsp;<span class="ident" id="7865033">c</span><span class="op" id="7865034">,</span>&nbsp;<span class="ident" id="7865036">err</span>&nbsp;<span class="op" id="7865040">:=</span>&nbsp;<span class="ident" id="7865043">ln</span><span class="op" id="7865045">.</span><span class="ident" id="7865046">AcceptTCP</span><span class="op" id="7865055">(</span><span class="op" id="7865056">)</span><span class="op" id="7865057">;</span>&nbsp;<span class="ident" id="7865059">err</span>&nbsp;<span class="op" id="7865063">!=</span>&nbsp;<span class="ident" id="7865066">nil</span>&nbsp;<span class="op" id="7865070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865074">if</span>&nbsp;<span class="op" id="7865077">!</span><span class="ident" id="7865078">err</span><span class="op" id="7865081">.</span><span class="op" id="7865082">(</span><span class="ident" id="7865083">Error</span><span class="op" id="7865088">)</span><span class="op" id="7865089">.</span><span class="ident" id="7865090">Timeout</span><span class="op" id="7865097">(</span><span class="op" id="7865098">)</span>&nbsp;<span class="op" id="7865100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865105">t</span><span class="op" id="7865106">.</span><span class="ident" id="7865107">Fatalf</span><span class="op" id="7865113">(</span><span class="string" id="7865114">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865148">,</span>&nbsp;<span class="ident" id="7865150">err</span><span class="op" id="7865153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865157">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865160">}</span>&nbsp;<span class="keyword" id="7865162">else</span>&nbsp;<span class="op" id="7865167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865171">c</span><span class="op" id="7865172">.</span><span class="ident" id="7865173">Close</span><span class="op" id="7865178">(</span><span class="op" id="7865179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865186">if</span>&nbsp;<span class="ident" id="7865189">f</span><span class="op" id="7865190">,</span>&nbsp;<span class="ident" id="7865192">err</span>&nbsp;<span class="op" id="7865196">:=</span>&nbsp;<span class="ident" id="7865199">ln</span><span class="op" id="7865201">.</span><span class="ident" id="7865202">File</span><span class="op" id="7865206">(</span><span class="op" id="7865207">)</span><span class="op" id="7865208">;</span>&nbsp;<span class="ident" id="7865210">err</span>&nbsp;<span class="op" id="7865214">!=</span>&nbsp;<span class="ident" id="7865217">nil</span>&nbsp;<span class="op" id="7865221">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865225">condFatalf</span><span class="op" id="7865235">(</span><span class="ident" id="7865236">t</span><span class="op" id="7865237">,</span>&nbsp;<span class="string" id="7865239">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865268">,</span>&nbsp;<span class="ident" id="7865270">err</span><span class="op" id="7865273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865276">}</span>&nbsp;<span class="keyword" id="7865278">else</span>&nbsp;<span class="op" id="7865283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865287">f</span><span class="op" id="7865288">.</span><span class="ident" id="7865289">Close</span><span class="op" id="7865294">(</span><span class="op" id="7865295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865298">}</span><br>
<span class="lineno"></span><span class="op" id="7865300">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7865303">func</span>&nbsp;<span class="ident" id="7865308">TestTCPConnSpecificMethods</span><span class="op" id="7865334">(</span><span class="ident" id="7865335">t</span>&nbsp;<span class="op" id="7865337">*</span><span class="ident" id="7865338">testing</span><span class="op" id="7865345">.</span><span class="ident" id="7865346">T</span><span class="op" id="7865347">)</span>&nbsp;<span class="op" id="7865349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865352">la</span><span class="op" id="7865354">,</span>&nbsp;<span class="ident" id="7865356">err</span>&nbsp;<span class="op" id="7865360">:=</span>&nbsp;<span class="ident" id="7865363">ResolveTCPAddr</span><span class="op" id="7865377">(</span><span class="string" id="7865378">&#34;tcp4&#34;</span><span class="op" id="7865384">,</span>&nbsp;<span class="string" id="7865386">&#34;127.0.0.1:0&#34;</span><span class="op" id="7865399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865402">if</span>&nbsp;<span class="ident" id="7865405">err</span>&nbsp;<span class="op" id="7865409">!=</span>&nbsp;<span class="ident" id="7865412">nil</span>&nbsp;<span class="op" id="7865416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865420">t</span><span class="op" id="7865421">.</span><span class="ident" id="7865422">Fatalf</span><span class="op" id="7865428">(</span><span class="string" id="7865429">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865456">,</span>&nbsp;<span class="ident" id="7865458">err</span><span class="op" id="7865461">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865467">ln</span><span class="op" id="7865469">,</span>&nbsp;<span class="ident" id="7865471">err</span>&nbsp;<span class="op" id="7865475">:=</span>&nbsp;<span class="ident" id="7865478">ListenTCP</span><span class="op" id="7865487">(</span><span class="string" id="7865488">&#34;tcp4&#34;</span><span class="op" id="7865494">,</span>&nbsp;<span class="ident" id="7865496">la</span><span class="op" id="7865498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865501">if</span>&nbsp;<span class="ident" id="7865504">err</span>&nbsp;<span class="op" id="7865508">!=</span>&nbsp;<span class="ident" id="7865511">nil</span>&nbsp;<span class="op" id="7865515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865519">t</span><span class="op" id="7865520">.</span><span class="ident" id="7865521">Fatalf</span><span class="op" id="7865527">(</span><span class="string" id="7865528">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865550">,</span>&nbsp;<span class="ident" id="7865552">err</span><span class="op" id="7865555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865558">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865561">defer</span>&nbsp;<span class="ident" id="7865567">ln</span><span class="op" id="7865569">.</span><span class="ident" id="7865570">Close</span><span class="op" id="7865575">(</span><span class="op" id="7865576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865579">ln</span><span class="op" id="7865581">.</span><span class="ident" id="7865582">Addr</span><span class="op" id="7865586">(</span><span class="op" id="7865587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865591">done</span>&nbsp;<span class="op" id="7865596">:=</span>&nbsp;<span class="builtinfunc" id="7865599">make</span><span class="op" id="7865603">(</span><span class="keyword" id="7865604">chan</span>&nbsp;<span class="builtintype" id="7865609">int</span><span class="op" id="7865612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865615">go</span>&nbsp;<span class="ident" id="7865618">transponder</span><span class="op" id="7865629">(</span><span class="ident" id="7865630">t</span><span class="op" id="7865631">,</span>&nbsp;<span class="ident" id="7865633">ln</span><span class="op" id="7865635">,</span>&nbsp;<span class="ident" id="7865637">done</span><span class="op" id="7865641">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865645">ra</span><span class="op" id="7865647">,</span>&nbsp;<span class="ident" id="7865649">err</span>&nbsp;<span class="op" id="7865653">:=</span>&nbsp;<span class="ident" id="7865656">ResolveTCPAddr</span><span class="op" id="7865670">(</span><span class="string" id="7865671">&#34;tcp4&#34;</span><span class="op" id="7865677">,</span>&nbsp;<span class="ident" id="7865679">ln</span><span class="op" id="7865681">.</span><span class="ident" id="7865682">Addr</span><span class="op" id="7865686">(</span><span class="op" id="7865687">)</span><span class="op" id="7865688">.</span><span class="ident" id="7865689">String</span><span class="op" id="7865695">(</span><span class="op" id="7865696">)</span><span class="op" id="7865697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865700">if</span>&nbsp;<span class="ident" id="7865703">err</span>&nbsp;<span class="op" id="7865707">!=</span>&nbsp;<span class="ident" id="7865710">nil</span>&nbsp;<span class="op" id="7865714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865718">t</span><span class="op" id="7865719">.</span><span class="ident" id="7865720">Fatalf</span><span class="op" id="7865726">(</span><span class="string" id="7865727">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865754">,</span>&nbsp;<span class="ident" id="7865756">err</span><span class="op" id="7865759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865762">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865765">c</span><span class="op" id="7865766">,</span>&nbsp;<span class="ident" id="7865768">err</span>&nbsp;<span class="op" id="7865772">:=</span>&nbsp;<span class="ident" id="7865775">DialTCP</span><span class="op" id="7865782">(</span><span class="string" id="7865783">&#34;tcp4&#34;</span><span class="op" id="7865789">,</span>&nbsp;<span class="ident" id="7865791">nil</span><span class="op" id="7865794">,</span>&nbsp;<span class="ident" id="7865796">ra</span><span class="op" id="7865798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865801">if</span>&nbsp;<span class="ident" id="7865804">err</span>&nbsp;<span class="op" id="7865808">!=</span>&nbsp;<span class="ident" id="7865811">nil</span>&nbsp;<span class="op" id="7865815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865819">t</span><span class="op" id="7865820">.</span><span class="ident" id="7865821">Fatalf</span><span class="op" id="7865827">(</span><span class="string" id="7865828">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865848">,</span>&nbsp;<span class="ident" id="7865850">err</span><span class="op" id="7865853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865859">defer</span>&nbsp;<span class="ident" id="7865865">c</span><span class="op" id="7865866">.</span><span class="ident" id="7865867">Close</span><span class="op" id="7865872">(</span><span class="op" id="7865873">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865876">c</span><span class="op" id="7865877">.</span><span class="ident" id="7865878">SetKeepAlive</span><span class="op" id="7865890">(</span><span class="builtintype" id="7865891">false</span><span class="op" id="7865896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865899">c</span><span class="op" id="7865900">.</span><span class="ident" id="7865901">SetKeepAlivePeriod</span><span class="op" id="7865919">(</span><span class="num" id="7865920">3</span>&nbsp;<span class="op" id="7865922">*</span>&nbsp;<span class="ident" id="7865924">time</span><span class="op" id="7865928">.</span><span class="ident" id="7865929">Second</span><span class="op" id="7865935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865938">c</span><span class="op" id="7865939">.</span><span class="ident" id="7865940">SetLinger</span><span class="op" id="7865949">(</span><span class="num" id="7865950">0</span><span class="op" id="7865951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865954">c</span><span class="op" id="7865955">.</span><span class="ident" id="7865956">SetNoDelay</span><span class="op" id="7865966">(</span><span class="builtintype" id="7865967">false</span><span class="op" id="7865972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865975">c</span><span class="op" id="7865976">.</span><span class="ident" id="7865977">LocalAddr</span><span class="op" id="7865986">(</span><span class="op" id="7865987">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865990">c</span><span class="op" id="7865991">.</span><span class="ident" id="7865992">RemoteAddr</span><span class="op" id="7866002">(</span><span class="op" id="7866003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866006">c</span><span class="op" id="7866007">.</span><span class="ident" id="7866008">SetDeadline</span><span class="op" id="7866019">(</span><span class="ident" id="7866020">time</span><span class="op" id="7866024">.</span><span class="ident" id="7866025">Now</span><span class="op" id="7866028">(</span><span class="op" id="7866029">)</span><span class="op" id="7866030">.</span><span class="ident" id="7866031">Add</span><span class="op" id="7866034">(</span><span class="ident" id="7866035">someTimeout</span><span class="op" id="7866046">)</span><span class="op" id="7866047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866050">c</span><span class="op" id="7866051">.</span><span class="ident" id="7866052">SetReadDeadline</span><span class="op" id="7866067">(</span><span class="ident" id="7866068">time</span><span class="op" id="7866072">.</span><span class="ident" id="7866073">Now</span><span class="op" id="7866076">(</span><span class="op" id="7866077">)</span><span class="op" id="7866078">.</span><span class="ident" id="7866079">Add</span><span class="op" id="7866082">(</span><span class="ident" id="7866083">someTimeout</span><span class="op" id="7866094">)</span><span class="op" id="7866095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866098">c</span><span class="op" id="7866099">.</span><span class="ident" id="7866100">SetWriteDeadline</span><span class="op" id="7866116">(</span><span class="ident" id="7866117">time</span><span class="op" id="7866121">.</span><span class="ident" id="7866122">Now</span><span class="op" id="7866125">(</span><span class="op" id="7866126">)</span><span class="op" id="7866127">.</span><span class="ident" id="7866128">Add</span><span class="op" id="7866131">(</span><span class="ident" id="7866132">someTimeout</span><span class="op" id="7866143">)</span><span class="op" id="7866144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866148">if</span>&nbsp;<span class="ident" id="7866151">_</span><span class="op" id="7866152">,</span>&nbsp;<span class="ident" id="7866154">err</span>&nbsp;<span class="op" id="7866158">:=</span>&nbsp;<span class="ident" id="7866161">c</span><span class="op" id="7866162">.</span><span class="ident" id="7866163">Write</span><span class="op" id="7866168">(</span><span class="op" id="7866169">[</span><span class="op" id="7866170">]</span><span class="builtintype" id="7866171">byte</span><span class="op" id="7866175">(</span><span class="string" id="7866176">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="7866190">)</span><span class="op" id="7866191">)</span><span class="op" id="7866192">;</span>&nbsp;<span class="ident" id="7866194">err</span>&nbsp;<span class="op" id="7866198">!=</span>&nbsp;<span class="ident" id="7866201">nil</span>&nbsp;<span class="op" id="7866205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866209">t</span><span class="op" id="7866210">.</span><span class="ident" id="7866211">Fatalf</span><span class="op" id="7866217">(</span><span class="string" id="7866218">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866244">,</span>&nbsp;<span class="ident" id="7866246">err</span><span class="op" id="7866249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866255">rb</span>&nbsp;<span class="op" id="7866258">:=</span>&nbsp;<span class="builtinfunc" id="7866261">make</span><span class="op" id="7866265">(</span><span class="op" id="7866266">[</span><span class="op" id="7866267">]</span><span class="builtintype" id="7866268">byte</span><span class="op" id="7866272">,</span>&nbsp;<span class="num" id="7866274">128</span><span class="op" id="7866277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866280">if</span>&nbsp;<span class="ident" id="7866283">_</span><span class="op" id="7866284">,</span>&nbsp;<span class="ident" id="7866286">err</span>&nbsp;<span class="op" id="7866290">:=</span>&nbsp;<span class="ident" id="7866293">c</span><span class="op" id="7866294">.</span><span class="ident" id="7866295">Read</span><span class="op" id="7866299">(</span><span class="ident" id="7866300">rb</span><span class="op" id="7866302">)</span><span class="op" id="7866303">;</span>&nbsp;<span class="ident" id="7866305">err</span>&nbsp;<span class="op" id="7866309">!=</span>&nbsp;<span class="ident" id="7866312">nil</span>&nbsp;<span class="op" id="7866316">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866320">t</span><span class="op" id="7866321">.</span><span class="ident" id="7866322">Fatalf</span><span class="op" id="7866328">(</span><span class="string" id="7866329">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866354">,</span>&nbsp;<span class="ident" id="7866356">err</span><span class="op" id="7866359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866366">&lt;-</span><span class="ident" id="7866368">done</span><br>
<span class="lineno"></span><span class="op" id="7866373">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7866376">func</span>&nbsp;<span class="ident" id="7866381">TestUDPConnSpecificMethods</span><span class="op" id="7866407">(</span><span class="ident" id="7866408">t</span>&nbsp;<span class="op" id="7866410">*</span><span class="ident" id="7866411">testing</span><span class="op" id="7866418">.</span><span class="ident" id="7866419">T</span><span class="op" id="7866420">)</span>&nbsp;<span class="op" id="7866422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866425">la</span><span class="op" id="7866427">,</span>&nbsp;<span class="ident" id="7866429">err</span>&nbsp;<span class="op" id="7866433">:=</span>&nbsp;<span class="ident" id="7866436">ResolveUDPAddr</span><span class="op" id="7866450">(</span><span class="string" id="7866451">&#34;udp4&#34;</span><span class="op" id="7866457">,</span>&nbsp;<span class="string" id="7866459">&#34;127.0.0.1:0&#34;</span><span class="op" id="7866472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866475">if</span>&nbsp;<span class="ident" id="7866478">err</span>&nbsp;<span class="op" id="7866482">!=</span>&nbsp;<span class="ident" id="7866485">nil</span>&nbsp;<span class="op" id="7866489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866493">t</span><span class="op" id="7866494">.</span><span class="ident" id="7866495">Fatalf</span><span class="op" id="7866501">(</span><span class="string" id="7866502">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866529">,</span>&nbsp;<span class="ident" id="7866531">err</span><span class="op" id="7866534">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866540">c</span><span class="op" id="7866541">,</span>&nbsp;<span class="ident" id="7866543">err</span>&nbsp;<span class="op" id="7866547">:=</span>&nbsp;<span class="ident" id="7866550">ListenUDP</span><span class="op" id="7866559">(</span><span class="string" id="7866560">&#34;udp4&#34;</span><span class="op" id="7866566">,</span>&nbsp;<span class="ident" id="7866568">la</span><span class="op" id="7866570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866573">if</span>&nbsp;<span class="ident" id="7866576">err</span>&nbsp;<span class="op" id="7866580">!=</span>&nbsp;<span class="ident" id="7866583">nil</span>&nbsp;<span class="op" id="7866587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866591">t</span><span class="op" id="7866592">.</span><span class="ident" id="7866593">Fatalf</span><span class="op" id="7866599">(</span><span class="string" id="7866600">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866622">,</span>&nbsp;<span class="ident" id="7866624">err</span><span class="op" id="7866627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866630">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866633">defer</span>&nbsp;<span class="ident" id="7866639">c</span><span class="op" id="7866640">.</span><span class="ident" id="7866641">Close</span><span class="op" id="7866646">(</span><span class="op" id="7866647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866650">c</span><span class="op" id="7866651">.</span><span class="ident" id="7866652">LocalAddr</span><span class="op" id="7866661">(</span><span class="op" id="7866662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866665">c</span><span class="op" id="7866666">.</span><span class="ident" id="7866667">RemoteAddr</span><span class="op" id="7866677">(</span><span class="op" id="7866678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866681">c</span><span class="op" id="7866682">.</span><span class="ident" id="7866683">SetDeadline</span><span class="op" id="7866694">(</span><span class="ident" id="7866695">time</span><span class="op" id="7866699">.</span><span class="ident" id="7866700">Now</span><span class="op" id="7866703">(</span><span class="op" id="7866704">)</span><span class="op" id="7866705">.</span><span class="ident" id="7866706">Add</span><span class="op" id="7866709">(</span><span class="ident" id="7866710">someTimeout</span><span class="op" id="7866721">)</span><span class="op" id="7866722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866725">c</span><span class="op" id="7866726">.</span><span class="ident" id="7866727">SetReadDeadline</span><span class="op" id="7866742">(</span><span class="ident" id="7866743">time</span><span class="op" id="7866747">.</span><span class="ident" id="7866748">Now</span><span class="op" id="7866751">(</span><span class="op" id="7866752">)</span><span class="op" id="7866753">.</span><span class="ident" id="7866754">Add</span><span class="op" id="7866757">(</span><span class="ident" id="7866758">someTimeout</span><span class="op" id="7866769">)</span><span class="op" id="7866770">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866773">c</span><span class="op" id="7866774">.</span><span class="ident" id="7866775">SetWriteDeadline</span><span class="op" id="7866791">(</span><span class="ident" id="7866792">time</span><span class="op" id="7866796">.</span><span class="ident" id="7866797">Now</span><span class="op" id="7866800">(</span><span class="op" id="7866801">)</span><span class="op" id="7866802">.</span><span class="ident" id="7866803">Add</span><span class="op" id="7866806">(</span><span class="ident" id="7866807">someTimeout</span><span class="op" id="7866818">)</span><span class="op" id="7866819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866822">c</span><span class="op" id="7866823">.</span><span class="ident" id="7866824">SetReadBuffer</span><span class="op" id="7866837">(</span><span class="num" id="7866838">2048</span><span class="op" id="7866842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866845">c</span><span class="op" id="7866846">.</span><span class="ident" id="7866847">SetWriteBuffer</span><span class="op" id="7866861">(</span><span class="num" id="7866862">2048</span><span class="op" id="7866866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866870">wb</span>&nbsp;<span class="op" id="7866873">:=</span>&nbsp;<span class="op" id="7866876">[</span><span class="op" id="7866877">]</span><span class="builtintype" id="7866878">byte</span><span class="op" id="7866882">(</span><span class="string" id="7866883">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="7866897">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866900">rb</span>&nbsp;<span class="op" id="7866903">:=</span>&nbsp;<span class="builtinfunc" id="7866906">make</span><span class="op" id="7866910">(</span><span class="op" id="7866911">[</span><span class="op" id="7866912">]</span><span class="builtintype" id="7866913">byte</span><span class="op" id="7866917">,</span>&nbsp;<span class="num" id="7866919">128</span><span class="op" id="7866922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866925">if</span>&nbsp;<span class="ident" id="7866928">_</span><span class="op" id="7866929">,</span>&nbsp;<span class="ident" id="7866931">err</span>&nbsp;<span class="op" id="7866935">:=</span>&nbsp;<span class="ident" id="7866938">c</span><span class="op" id="7866939">.</span><span class="ident" id="7866940">WriteToUDP</span><span class="op" id="7866950">(</span><span class="ident" id="7866951">wb</span><span class="op" id="7866953">,</span>&nbsp;<span class="ident" id="7866955">c</span><span class="op" id="7866956">.</span><span class="ident" id="7866957">LocalAddr</span><span class="op" id="7866966">(</span><span class="op" id="7866967">)</span><span class="op" id="7866968">.</span><span class="op" id="7866969">(</span><span class="op" id="7866970">*</span><span class="ident" id="7866971">UDPAddr</span><span class="op" id="7866978">)</span><span class="op" id="7866979">)</span><span class="op" id="7866980">;</span>&nbsp;<span class="ident" id="7866982">err</span>&nbsp;<span class="op" id="7866986">!=</span>&nbsp;<span class="ident" id="7866989">nil</span>&nbsp;<span class="op" id="7866993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866997">t</span><span class="op" id="7866998">.</span><span class="ident" id="7866999">Fatalf</span><span class="op" id="7867005">(</span><span class="string" id="7867006">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867037">,</span>&nbsp;<span class="ident" id="7867039">err</span><span class="op" id="7867042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867048">if</span>&nbsp;<span class="ident" id="7867051">_</span><span class="op" id="7867052">,</span>&nbsp;<span class="ident" id="7867054">_</span><span class="op" id="7867055">,</span>&nbsp;<span class="ident" id="7867057">err</span>&nbsp;<span class="op" id="7867061">:=</span>&nbsp;<span class="ident" id="7867064">c</span><span class="op" id="7867065">.</span><span class="ident" id="7867066">ReadFromUDP</span><span class="op" id="7867077">(</span><span class="ident" id="7867078">rb</span><span class="op" id="7867080">)</span><span class="op" id="7867081">;</span>&nbsp;<span class="ident" id="7867083">err</span>&nbsp;<span class="op" id="7867087">!=</span>&nbsp;<span class="ident" id="7867090">nil</span>&nbsp;<span class="op" id="7867094">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867098">t</span><span class="op" id="7867099">.</span><span class="ident" id="7867100">Fatalf</span><span class="op" id="7867106">(</span><span class="string" id="7867107">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867139">,</span>&nbsp;<span class="ident" id="7867141">err</span><span class="op" id="7867144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867150">if</span>&nbsp;<span class="ident" id="7867153">_</span><span class="op" id="7867154">,</span>&nbsp;<span class="ident" id="7867156">_</span><span class="op" id="7867157">,</span>&nbsp;<span class="ident" id="7867159">err</span>&nbsp;<span class="op" id="7867163">:=</span>&nbsp;<span class="ident" id="7867166">c</span><span class="op" id="7867167">.</span><span class="ident" id="7867168">WriteMsgUDP</span><span class="op" id="7867179">(</span><span class="ident" id="7867180">wb</span><span class="op" id="7867182">,</span>&nbsp;<span class="ident" id="7867184">nil</span><span class="op" id="7867187">,</span>&nbsp;<span class="ident" id="7867189">c</span><span class="op" id="7867190">.</span><span class="ident" id="7867191">LocalAddr</span><span class="op" id="7867200">(</span><span class="op" id="7867201">)</span><span class="op" id="7867202">.</span><span class="op" id="7867203">(</span><span class="op" id="7867204">*</span><span class="ident" id="7867205">UDPAddr</span><span class="op" id="7867212">)</span><span class="op" id="7867213">)</span><span class="op" id="7867214">;</span>&nbsp;<span class="ident" id="7867216">err</span>&nbsp;<span class="op" id="7867220">!=</span>&nbsp;<span class="ident" id="7867223">nil</span>&nbsp;<span class="op" id="7867227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867231">condFatalf</span><span class="op" id="7867241">(</span><span class="ident" id="7867242">t</span><span class="op" id="7867243">,</span>&nbsp;<span class="string" id="7867245">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867277">,</span>&nbsp;<span class="ident" id="7867279">err</span><span class="op" id="7867282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867285">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867288">if</span>&nbsp;<span class="ident" id="7867291">_</span><span class="op" id="7867292">,</span>&nbsp;<span class="ident" id="7867294">_</span><span class="op" id="7867295">,</span>&nbsp;<span class="ident" id="7867297">_</span><span class="op" id="7867298">,</span>&nbsp;<span class="ident" id="7867300">_</span><span class="op" id="7867301">,</span>&nbsp;<span class="ident" id="7867303">err</span>&nbsp;<span class="op" id="7867307">:=</span>&nbsp;<span class="ident" id="7867310">c</span><span class="op" id="7867311">.</span><span class="ident" id="7867312">ReadMsgUDP</span><span class="op" id="7867322">(</span><span class="ident" id="7867323">rb</span><span class="op" id="7867325">,</span>&nbsp;<span class="ident" id="7867327">nil</span><span class="op" id="7867330">)</span><span class="op" id="7867331">;</span>&nbsp;<span class="ident" id="7867333">err</span>&nbsp;<span class="op" id="7867337">!=</span>&nbsp;<span class="ident" id="7867340">nil</span>&nbsp;<span class="op" id="7867344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867348">condFatalf</span><span class="op" id="7867358">(</span><span class="ident" id="7867359">t</span><span class="op" id="7867360">,</span>&nbsp;<span class="string" id="7867362">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867393">,</span>&nbsp;<span class="ident" id="7867395">err</span><span class="op" id="7867398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867405">if</span>&nbsp;<span class="ident" id="7867408">f</span><span class="op" id="7867409">,</span>&nbsp;<span class="ident" id="7867411">err</span>&nbsp;<span class="op" id="7867415">:=</span>&nbsp;<span class="ident" id="7867418">c</span><span class="op" id="7867419">.</span><span class="ident" id="7867420">File</span><span class="op" id="7867424">(</span><span class="op" id="7867425">)</span><span class="op" id="7867426">;</span>&nbsp;<span class="ident" id="7867428">err</span>&nbsp;<span class="op" id="7867432">!=</span>&nbsp;<span class="ident" id="7867435">nil</span>&nbsp;<span class="op" id="7867439">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867443">condFatalf</span><span class="op" id="7867453">(</span><span class="ident" id="7867454">t</span><span class="op" id="7867455">,</span>&nbsp;<span class="string" id="7867457">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867482">,</span>&nbsp;<span class="ident" id="7867484">err</span><span class="op" id="7867487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867490">}</span>&nbsp;<span class="keyword" id="7867492">else</span>&nbsp;<span class="op" id="7867497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867501">f</span><span class="op" id="7867502">.</span><span class="ident" id="7867503">Close</span><span class="op" id="7867508">(</span><span class="op" id="7867509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867516">defer</span>&nbsp;<span class="keyword" id="7867522">func</span><span class="op" id="7867526">(</span><span class="op" id="7867527">)</span>&nbsp;<span class="op" id="7867529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867533">if</span>&nbsp;<span class="ident" id="7867536">p</span>&nbsp;<span class="op" id="7867538">:=</span>&nbsp;<span class="builtinfunc" id="7867541">recover</span><span class="op" id="7867548">(</span><span class="op" id="7867549">)</span><span class="op" id="7867550">;</span>&nbsp;<span class="ident" id="7867552">p</span>&nbsp;<span class="op" id="7867554">!=</span>&nbsp;<span class="ident" id="7867557">nil</span>&nbsp;<span class="op" id="7867561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867566">t</span><span class="op" id="7867567">.</span><span class="ident" id="7867568">Fatalf</span><span class="op" id="7867574">(</span><span class="string" id="7867575">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7867623">,</span>&nbsp;<span class="ident" id="7867625">p</span><span class="op" id="7867626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867633">}</span><span class="op" id="7867634">(</span><span class="op" id="7867635">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867639">c</span><span class="op" id="7867640">.</span><span class="ident" id="7867641">WriteToUDP</span><span class="op" id="7867651">(</span><span class="ident" id="7867652">wb</span><span class="op" id="7867654">,</span>&nbsp;<span class="ident" id="7867656">nil</span><span class="op" id="7867659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867662">c</span><span class="op" id="7867663">.</span><span class="ident" id="7867664">WriteMsgUDP</span><span class="op" id="7867675">(</span><span class="ident" id="7867676">wb</span><span class="op" id="7867678">,</span>&nbsp;<span class="ident" id="7867680">nil</span><span class="op" id="7867683">,</span>&nbsp;<span class="ident" id="7867685">nil</span><span class="op" id="7867688">)</span><br>
<span class="lineno"></span><span class="op" id="7867690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7867693">func</span>&nbsp;<span class="ident" id="7867698">TestIPConnSpecificMethods</span><span class="op" id="7867723">(</span><span class="ident" id="7867724">t</span>&nbsp;<span class="op" id="7867726">*</span><span class="ident" id="7867727">testing</span><span class="op" id="7867734">.</span><span class="ident" id="7867735">T</span><span class="op" id="7867736">)</span>&nbsp;<span class="op" id="7867738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867741">if</span>&nbsp;<span class="ident" id="7867744">skip</span><span class="op" id="7867748">,</span>&nbsp;<span class="ident" id="7867750">skipmsg</span>&nbsp;<span class="op" id="7867758">:=</span>&nbsp;<span class="ident" id="7867761">skipRawSocketTest</span><span class="op" id="7867778">(</span><span class="ident" id="7867779">t</span><span class="op" id="7867780">)</span><span class="op" id="7867781">;</span>&nbsp;<span class="ident" id="7867783">skip</span>&nbsp;<span class="op" id="7867788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867792">t</span><span class="op" id="7867793">.</span><span class="ident" id="7867794">Skip</span><span class="op" id="7867798">(</span><span class="ident" id="7867799">skipmsg</span><span class="op" id="7867806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867813">la</span><span class="op" id="7867815">,</span>&nbsp;<span class="ident" id="7867817">err</span>&nbsp;<span class="op" id="7867821">:=</span>&nbsp;<span class="ident" id="7867824">ResolveIPAddr</span><span class="op" id="7867837">(</span><span class="string" id="7867838">&#34;ip4&#34;</span><span class="op" id="7867843">,</span>&nbsp;<span class="string" id="7867845">&#34;127.0.0.1&#34;</span><span class="op" id="7867856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867859">if</span>&nbsp;<span class="ident" id="7867862">err</span>&nbsp;<span class="op" id="7867866">!=</span>&nbsp;<span class="ident" id="7867869">nil</span>&nbsp;<span class="op" id="7867873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867877">t</span><span class="op" id="7867878">.</span><span class="ident" id="7867879">Fatalf</span><span class="op" id="7867885">(</span><span class="string" id="7867886">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867912">,</span>&nbsp;<span class="ident" id="7867914">err</span><span class="op" id="7867917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867923">c</span><span class="op" id="7867924">,</span>&nbsp;<span class="ident" id="7867926">err</span>&nbsp;<span class="op" id="7867930">:=</span>&nbsp;<span class="ident" id="7867933">ListenIP</span><span class="op" id="7867941">(</span><span class="string" id="7867942">&#34;ip4:icmp&#34;</span><span class="op" id="7867952">,</span>&nbsp;<span class="ident" id="7867954">la</span><span class="op" id="7867956">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867959">if</span>&nbsp;<span class="ident" id="7867962">err</span>&nbsp;<span class="op" id="7867966">!=</span>&nbsp;<span class="ident" id="7867969">nil</span>&nbsp;<span class="op" id="7867973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867977">t</span><span class="op" id="7867978">.</span><span class="ident" id="7867979">Fatalf</span><span class="op" id="7867985">(</span><span class="string" id="7867986">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7868007">,</span>&nbsp;<span class="ident" id="7868009">err</span><span class="op" id="7868012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868018">defer</span>&nbsp;<span class="ident" id="7868024">c</span><span class="op" id="7868025">.</span><span class="ident" id="7868026">Close</span><span class="op" id="7868031">(</span><span class="op" id="7868032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868035">c</span><span class="op" id="7868036">.</span><span class="ident" id="7868037">LocalAddr</span><span class="op" id="7868046">(</span><span class="op" id="7868047">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868050">c</span><span class="op" id="7868051">.</span><span class="ident" id="7868052">RemoteAddr</span><span class="op" id="7868062">(</span><span class="op" id="7868063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868066">c</span><span class="op" id="7868067">.</span><span class="ident" id="7868068">SetDeadline</span><span class="op" id="7868079">(</span><span class="ident" id="7868080">time</span><span class="op" id="7868084">.</span><span class="ident" id="7868085">Now</span><span class="op" id="7868088">(</span><span class="op" id="7868089">)</span><span class="op" id="7868090">.</span><span class="ident" id="7868091">Add</span><span class="op" id="7868094">(</span><span class="ident" id="7868095">someTimeout</span><span class="op" id="7868106">)</span><span class="op" id="7868107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868110">c</span><span class="op" id="7868111">.</span><span class="ident" id="7868112">SetReadDeadline</span><span class="op" id="7868127">(</span><span class="ident" id="7868128">time</span><span class="op" id="7868132">.</span><span class="ident" id="7868133">Now</span><span class="op" id="7868136">(</span><span class="op" id="7868137">)</span><span class="op" id="7868138">.</span><span class="ident" id="7868139">Add</span><span class="op" id="7868142">(</span><span class="ident" id="7868143">someTimeout</span><span class="op" id="7868154">)</span><span class="op" id="7868155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868158">c</span><span class="op" id="7868159">.</span><span class="ident" id="7868160">SetWriteDeadline</span><span class="op" id="7868176">(</span><span class="ident" id="7868177">time</span><span class="op" id="7868181">.</span><span class="ident" id="7868182">Now</span><span class="op" id="7868185">(</span><span class="op" id="7868186">)</span><span class="op" id="7868187">.</span><span class="ident" id="7868188">Add</span><span class="op" id="7868191">(</span><span class="ident" id="7868192">someTimeout</span><span class="op" id="7868203">)</span><span class="op" id="7868204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868207">c</span><span class="op" id="7868208">.</span><span class="ident" id="7868209">SetReadBuffer</span><span class="op" id="7868222">(</span><span class="num" id="7868223">2048</span><span class="op" id="7868227">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868230">c</span><span class="op" id="7868231">.</span><span class="ident" id="7868232">SetWriteBuffer</span><span class="op" id="7868246">(</span><span class="num" id="7868247">2048</span><span class="op" id="7868251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868255">wb</span><span class="op" id="7868257">,</span>&nbsp;<span class="ident" id="7868259">err</span>&nbsp;<span class="op" id="7868263">:=</span>&nbsp;<span class="op" id="7868266">(</span><span class="op" id="7868267">&amp;</span><span class="ident" id="7868268">icmpMessage</span><span class="op" id="7868279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868283">Type</span><span class="op" id="7868287">:</span>&nbsp;<span class="ident" id="7868289">icmpv4EchoRequest</span><span class="op" id="7868306">,</span>&nbsp;<span class="ident" id="7868308">Code</span><span class="op" id="7868312">:</span>&nbsp;<span class="num" id="7868314">0</span><span class="op" id="7868315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868319">Body</span><span class="op" id="7868323">:</span>&nbsp;<span class="op" id="7868325">&amp;</span><span class="ident" id="7868326">icmpEcho</span><span class="op" id="7868334">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868339">ID</span><span class="op" id="7868341">:</span>&nbsp;<span class="ident" id="7868343">os</span><span class="op" id="7868345">.</span><span class="ident" id="7868346">Getpid</span><span class="op" id="7868352">(</span><span class="op" id="7868353">)</span>&nbsp;<span class="op" id="7868355">&amp;</span>&nbsp;<span class="num" id="7868357">0xffff</span><span class="op" id="7868363">,</span>&nbsp;<span class="ident" id="7868365">Seq</span><span class="op" id="7868368">:</span>&nbsp;<span class="num" id="7868370">1</span><span class="op" id="7868371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868376">Data</span><span class="op" id="7868380">:</span>&nbsp;<span class="op" id="7868382">[</span><span class="op" id="7868383">]</span><span class="builtintype" id="7868384">byte</span><span class="op" id="7868388">(</span><span class="string" id="7868389">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="7868403">)</span><span class="op" id="7868404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868408">}</span><span class="op" id="7868409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868412">}</span><span class="op" id="7868413">)</span><span class="op" id="7868414">.</span><span class="ident" id="7868415">Marshal</span><span class="op" id="7868422">(</span><span class="op" id="7868423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868426">if</span>&nbsp;<span class="ident" id="7868429">err</span>&nbsp;<span class="op" id="7868433">!=</span>&nbsp;<span class="ident" id="7868436">nil</span>&nbsp;<span class="op" id="7868440">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868444">t</span><span class="op" id="7868445">.</span><span class="ident" id="7868446">Fatalf</span><span class="op" id="7868452">(</span><span class="string" id="7868453">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7868485">,</span>&nbsp;<span class="ident" id="7868487">err</span><span class="op" id="7868490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868496">rb</span>&nbsp;<span class="op" id="7868499">:=</span>&nbsp;<span class="builtinfunc" id="7868502">make</span><span class="op" id="7868506">(</span><span class="op" id="7868507">[</span><span class="op" id="7868508">]</span><span class="builtintype" id="7868509">byte</span><span class="op" id="7868513">,</span>&nbsp;<span class="num" id="7868515">20</span><span class="op" id="7868517">+</span><span class="builtinfunc" id="7868518">len</span><span class="op" id="7868521">(</span><span class="ident" id="7868522">wb</span><span class="op" id="7868524">)</span><span class="op" id="7868525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868528">if</span>&nbsp;<span class="ident" id="7868531">_</span><span class="op" id="7868532">,</span>&nbsp;<span class="ident" id="7868534">err</span>&nbsp;<span class="op" id="7868538">:=</span>&nbsp;<span class="ident" id="7868541">c</span><span class="op" id="7868542">.</span><span class="ident" id="7868543">WriteToIP</span><span class="op" id="7868552">(</span><span class="ident" id="7868553">wb</span><span class="op" id="7868555">,</span>&nbsp;<span class="ident" id="7868557">c</span><span class="op" id="7868558">.</span><span class="ident" id="7868559">LocalAddr</span><span class="op" id="7868568">(</span><span class="op" id="7868569">)</span><span class="op" id="7868570">.</span><span class="op" id="7868571">(</span><span class="op" id="7868572">*</span><span class="ident" id="7868573">IPAddr</span><span class="op" id="7868579">)</span><span class="op" id="7868580">)</span><span class="op" id="7868581">;</span>&nbsp;<span class="ident" id="7868583">err</span>&nbsp;<span class="op" id="7868587">!=</span>&nbsp;<span class="ident" id="7868590">nil</span>&nbsp;<span class="op" id="7868594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868598">t</span><span class="op" id="7868599">.</span><span class="ident" id="7868600">Fatalf</span><span class="op" id="7868606">(</span><span class="string" id="7868607">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7868636">,</span>&nbsp;<span class="ident" id="7868638">err</span><span class="op" id="7868641">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868647">if</span>&nbsp;<span class="ident" id="7868650">_</span><span class="op" id="7868651">,</span>&nbsp;<span class="ident" id="7868653">_</span><span class="op" id="7868654">,</span>&nbsp;<span class="ident" id="7868656">err</span>&nbsp;<span class="op" id="7868660">:=</span>&nbsp;<span class="ident" id="7868663">c</span><span class="op" id="7868664">.</span><span class="ident" id="7868665">ReadFromIP</span><span class="op" id="7868675">(</span><span class="ident" id="7868676">rb</span><span class="op" id="7868678">)</span><span class="op" id="7868679">;</span>&nbsp;<span class="ident" id="7868681">err</span>&nbsp;<span class="op" id="7868685">!=</span>&nbsp;<span class="ident" id="7868688">nil</span>&nbsp;<span class="op" id="7868692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868696">t</span><span class="op" id="7868697">.</span><span class="ident" id="7868698">Fatalf</span><span class="op" id="7868704">(</span><span class="string" id="7868705">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7868735">,</span>&nbsp;<span class="ident" id="7868737">err</span><span class="op" id="7868740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868746">if</span>&nbsp;<span class="ident" id="7868749">_</span><span class="op" id="7868750">,</span>&nbsp;<span class="ident" id="7868752">_</span><span class="op" id="7868753">,</span>&nbsp;<span class="ident" id="7868755">err</span>&nbsp;<span class="op" id="7868759">:=</span>&nbsp;<span class="ident" id="7868762">c</span><span class="op" id="7868763">.</span><span class="ident" id="7868764">WriteMsgIP</span><span class="op" id="7868774">(</span><span class="ident" id="7868775">wb</span><span class="op" id="7868777">,</span>&nbsp;<span class="ident" id="7868779">nil</span><span class="op" id="7868782">,</span>&nbsp;<span class="ident" id="7868784">c</span><span class="op" id="7868785">.</span><span class="ident" id="7868786">LocalAddr</span><span class="op" id="7868795">(</span><span class="op" id="7868796">)</span><span class="op" id="7868797">.</span><span class="op" id="7868798">(</span><span class="op" id="7868799">*</span><span class="ident" id="7868800">IPAddr</span><span class="op" id="7868806">)</span><span class="op" id="7868807">)</span><span class="op" id="7868808">;</span>&nbsp;<span class="ident" id="7868810">err</span>&nbsp;<span class="op" id="7868814">!=</span>&nbsp;<span class="ident" id="7868817">nil</span>&nbsp;<span class="op" id="7868821">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868825">condFatalf</span><span class="op" id="7868835">(</span><span class="ident" id="7868836">t</span><span class="op" id="7868837">,</span>&nbsp;<span class="string" id="7868839">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7868869">,</span>&nbsp;<span class="ident" id="7868871">err</span><span class="op" id="7868874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868880">if</span>&nbsp;<span class="ident" id="7868883">_</span><span class="op" id="7868884">,</span>&nbsp;<span class="ident" id="7868886">_</span><span class="op" id="7868887">,</span>&nbsp;<span class="ident" id="7868889">_</span><span class="op" id="7868890">,</span>&nbsp;<span class="ident" id="7868892">_</span><span class="op" id="7868893">,</span>&nbsp;<span class="ident" id="7868895">err</span>&nbsp;<span class="op" id="7868899">:=</span>&nbsp;<span class="ident" id="7868902">c</span><span class="op" id="7868903">.</span><span class="ident" id="7868904">ReadMsgIP</span><span class="op" id="7868913">(</span><span class="ident" id="7868914">rb</span><span class="op" id="7868916">,</span>&nbsp;<span class="ident" id="7868918">nil</span><span class="op" id="7868921">)</span><span class="op" id="7868922">;</span>&nbsp;<span class="ident" id="7868924">err</span>&nbsp;<span class="op" id="7868928">!=</span>&nbsp;<span class="ident" id="7868931">nil</span>&nbsp;<span class="op" id="7868935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868939">condFatalf</span><span class="op" id="7868949">(</span><span class="ident" id="7868950">t</span><span class="op" id="7868951">,</span>&nbsp;<span class="string" id="7868953">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7868982">,</span>&nbsp;<span class="ident" id="7868984">err</span><span class="op" id="7868987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868990">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868994">if</span>&nbsp;<span class="ident" id="7868997">f</span><span class="op" id="7868998">,</span>&nbsp;<span class="ident" id="7869000">err</span>&nbsp;<span class="op" id="7869004">:=</span>&nbsp;<span class="ident" id="7869007">c</span><span class="op" id="7869008">.</span><span class="ident" id="7869009">File</span><span class="op" id="7869013">(</span><span class="op" id="7869014">)</span><span class="op" id="7869015">;</span>&nbsp;<span class="ident" id="7869017">err</span>&nbsp;<span class="op" id="7869021">!=</span>&nbsp;<span class="ident" id="7869024">nil</span>&nbsp;<span class="op" id="7869028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869032">condFatalf</span><span class="op" id="7869042">(</span><span class="ident" id="7869043">t</span><span class="op" id="7869044">,</span>&nbsp;<span class="string" id="7869046">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7869070">,</span>&nbsp;<span class="ident" id="7869072">err</span><span class="op" id="7869075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869078">}</span>&nbsp;<span class="keyword" id="7869080">else</span>&nbsp;<span class="op" id="7869085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869089">f</span><span class="op" id="7869090">.</span><span class="ident" id="7869091">Close</span><span class="op" id="7869096">(</span><span class="op" id="7869097">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869104">defer</span>&nbsp;<span class="keyword" id="7869110">func</span><span class="op" id="7869114">(</span><span class="op" id="7869115">)</span>&nbsp;<span class="op" id="7869117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869121">if</span>&nbsp;<span class="ident" id="7869124">p</span>&nbsp;<span class="op" id="7869126">:=</span>&nbsp;<span class="builtinfunc" id="7869129">recover</span><span class="op" id="7869136">(</span><span class="op" id="7869137">)</span><span class="op" id="7869138">;</span>&nbsp;<span class="ident" id="7869140">p</span>&nbsp;<span class="op" id="7869142">!=</span>&nbsp;<span class="ident" id="7869145">nil</span>&nbsp;<span class="op" id="7869149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869154">t</span><span class="op" id="7869155">.</span><span class="ident" id="7869156">Fatalf</span><span class="op" id="7869162">(</span><span class="string" id="7869163">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7869208">,</span>&nbsp;<span class="ident" id="7869210">p</span><span class="op" id="7869211">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869218">}</span><span class="op" id="7869219">(</span><span class="op" id="7869220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869224">c</span><span class="op" id="7869225">.</span><span class="ident" id="7869226">WriteToIP</span><span class="op" id="7869235">(</span><span class="ident" id="7869236">wb</span><span class="op" id="7869238">,</span>&nbsp;<span class="ident" id="7869240">nil</span><span class="op" id="7869243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869246">c</span><span class="op" id="7869247">.</span><span class="ident" id="7869248">WriteMsgIP</span><span class="op" id="7869258">(</span><span class="ident" id="7869259">wb</span><span class="op" id="7869261">,</span>&nbsp;<span class="ident" id="7869263">nil</span><span class="op" id="7869266">,</span>&nbsp;<span class="ident" id="7869268">nil</span><span class="op" id="7869271">)</span><br>
<span class="lineno">235</span><span class="op" id="7869273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7869276">func</span>&nbsp;<span class="ident" id="7869281">TestUnixListenerSpecificMethods</span><span class="op" id="7869312">(</span><span class="ident" id="7869313">t</span>&nbsp;<span class="op" id="7869315">*</span><span class="ident" id="7869316">testing</span><span class="op" id="7869323">.</span><span class="ident" id="7869324">T</span><span class="op" id="7869325">)</span>&nbsp;<span class="op" id="7869327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869330">switch</span>&nbsp;<span class="ident" id="7869337">runtime</span><span class="op" id="7869344">.</span><span class="ident" id="7869345">GOOS</span>&nbsp;<span class="op" id="7869350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869353">case</span>&nbsp;<span class="string" id="7869358">&#34;nacl&#34;</span><span class="op" id="7869364">,</span>&nbsp;<span class="string" id="7869366">&#34;plan9&#34;</span><span class="op" id="7869373">,</span>&nbsp;<span class="string" id="7869375">&#34;windows&#34;</span><span class="op" id="7869384">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869388">t</span><span class="op" id="7869389">.</span><span class="ident" id="7869390">Skipf</span><span class="op" id="7869395">(</span><span class="string" id="7869396">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7869417">,</span>&nbsp;<span class="ident" id="7869419">runtime</span><span class="op" id="7869426">.</span><span class="ident" id="7869427">GOOS</span><span class="op" id="7869431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869438">addr</span>&nbsp;<span class="op" id="7869443">:=</span>&nbsp;<span class="ident" id="7869446">testUnixAddr</span><span class="op" id="7869458">(</span><span class="op" id="7869459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869462">la</span><span class="op" id="7869464">,</span>&nbsp;<span class="ident" id="7869466">err</span>&nbsp;<span class="op" id="7869470">:=</span>&nbsp;<span class="ident" id="7869473">ResolveUnixAddr</span><span class="op" id="7869488">(</span><span class="string" id="7869489">&#34;unix&#34;</span><span class="op" id="7869495">,</span>&nbsp;<span class="ident" id="7869497">addr</span><span class="op" id="7869501">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869504">if</span>&nbsp;<span class="ident" id="7869507">err</span>&nbsp;<span class="op" id="7869511">!=</span>&nbsp;<span class="ident" id="7869514">nil</span>&nbsp;<span class="op" id="7869518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869522">t</span><span class="op" id="7869523">.</span><span class="ident" id="7869524">Fatalf</span><span class="op" id="7869530">(</span><span class="string" id="7869531">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7869559">,</span>&nbsp;<span class="ident" id="7869561">err</span><span class="op" id="7869564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869570">ln</span><span class="op" id="7869572">,</span>&nbsp;<span class="ident" id="7869574">err</span>&nbsp;<span class="op" id="7869578">:=</span>&nbsp;<span class="ident" id="7869581">ListenUnix</span><span class="op" id="7869591">(</span><span class="string" id="7869592">&#34;unix&#34;</span><span class="op" id="7869598">,</span>&nbsp;<span class="ident" id="7869600">la</span><span class="op" id="7869602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869605">if</span>&nbsp;<span class="ident" id="7869608">err</span>&nbsp;<span class="op" id="7869612">!=</span>&nbsp;<span class="ident" id="7869615">nil</span>&nbsp;<span class="op" id="7869619">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869623">t</span><span class="op" id="7869624">.</span><span class="ident" id="7869625">Fatalf</span><span class="op" id="7869631">(</span><span class="string" id="7869632">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7869655">,</span>&nbsp;<span class="ident" id="7869657">err</span><span class="op" id="7869660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869666">defer</span>&nbsp;<span class="ident" id="7869672">ln</span><span class="op" id="7869674">.</span><span class="ident" id="7869675">Close</span><span class="op" id="7869680">(</span><span class="op" id="7869681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869684">defer</span>&nbsp;<span class="ident" id="7869690">os</span><span class="op" id="7869692">.</span><span class="ident" id="7869693">Remove</span><span class="op" id="7869699">(</span><span class="ident" id="7869700">addr</span><span class="op" id="7869704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869707">ln</span><span class="op" id="7869709">.</span><span class="ident" id="7869710">Addr</span><span class="op" id="7869714">(</span><span class="op" id="7869715">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869718">ln</span><span class="op" id="7869720">.</span><span class="ident" id="7869721">SetDeadline</span><span class="op" id="7869732">(</span><span class="ident" id="7869733">time</span><span class="op" id="7869737">.</span><span class="ident" id="7869738">Now</span><span class="op" id="7869741">(</span><span class="op" id="7869742">)</span><span class="op" id="7869743">.</span><span class="ident" id="7869744">Add</span><span class="op" id="7869747">(</span><span class="num" id="7869748">30</span>&nbsp;<span class="op" id="7869751">*</span>&nbsp;<span class="ident" id="7869753">time</span><span class="op" id="7869757">.</span><span class="ident" id="7869758">Nanosecond</span><span class="op" id="7869768">)</span><span class="op" id="7869769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869773">if</span>&nbsp;<span class="ident" id="7869776">c</span><span class="op" id="7869777">,</span>&nbsp;<span class="ident" id="7869779">err</span>&nbsp;<span class="op" id="7869783">:=</span>&nbsp;<span class="ident" id="7869786">ln</span><span class="op" id="7869788">.</span><span class="ident" id="7869789">Accept</span><span class="op" id="7869795">(</span><span class="op" id="7869796">)</span><span class="op" id="7869797">;</span>&nbsp;<span class="ident" id="7869799">err</span>&nbsp;<span class="op" id="7869803">!=</span>&nbsp;<span class="ident" id="7869806">nil</span>&nbsp;<span class="op" id="7869810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869814">if</span>&nbsp;<span class="op" id="7869817">!</span><span class="ident" id="7869818">err</span><span class="op" id="7869821">.</span><span class="op" id="7869822">(</span><span class="ident" id="7869823">Error</span><span class="op" id="7869828">)</span><span class="op" id="7869829">.</span><span class="ident" id="7869830">Timeout</span><span class="op" id="7869837">(</span><span class="op" id="7869838">)</span>&nbsp;<span class="op" id="7869840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869845">t</span><span class="op" id="7869846">.</span><span class="ident" id="7869847">Fatalf</span><span class="op" id="7869853">(</span><span class="string" id="7869854">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7869886">,</span>&nbsp;<span class="ident" id="7869888">err</span><span class="op" id="7869891">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869898">}</span>&nbsp;<span class="keyword" id="7869900">else</span>&nbsp;<span class="op" id="7869905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869909">c</span><span class="op" id="7869910">.</span><span class="ident" id="7869911">Close</span><span class="op" id="7869916">(</span><span class="op" id="7869917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869923">if</span>&nbsp;<span class="ident" id="7869926">c</span><span class="op" id="7869927">,</span>&nbsp;<span class="ident" id="7869929">err</span>&nbsp;<span class="op" id="7869933">:=</span>&nbsp;<span class="ident" id="7869936">ln</span><span class="op" id="7869938">.</span><span class="ident" id="7869939">AcceptUnix</span><span class="op" id="7869949">(</span><span class="op" id="7869950">)</span><span class="op" id="7869951">;</span>&nbsp;<span class="ident" id="7869953">err</span>&nbsp;<span class="op" id="7869957">!=</span>&nbsp;<span class="ident" id="7869960">nil</span>&nbsp;<span class="op" id="7869964">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869968">if</span>&nbsp;<span class="op" id="7869971">!</span><span class="ident" id="7869972">err</span><span class="op" id="7869975">.</span><span class="op" id="7869976">(</span><span class="ident" id="7869977">Error</span><span class="op" id="7869982">)</span><span class="op" id="7869983">.</span><span class="ident" id="7869984">Timeout</span><span class="op" id="7869991">(</span><span class="op" id="7869992">)</span>&nbsp;<span class="op" id="7869994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869999">t</span><span class="op" id="7870000">.</span><span class="ident" id="7870001">Fatalf</span><span class="op" id="7870007">(</span><span class="string" id="7870008">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7870044">,</span>&nbsp;<span class="ident" id="7870046">err</span><span class="op" id="7870049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870056">}</span>&nbsp;<span class="keyword" id="7870058">else</span>&nbsp;<span class="op" id="7870063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870067">c</span><span class="op" id="7870068">.</span><span class="ident" id="7870069">Close</span><span class="op" id="7870074">(</span><span class="op" id="7870075">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870082">if</span>&nbsp;<span class="ident" id="7870085">f</span><span class="op" id="7870086">,</span>&nbsp;<span class="ident" id="7870088">err</span>&nbsp;<span class="op" id="7870092">:=</span>&nbsp;<span class="ident" id="7870095">ln</span><span class="op" id="7870097">.</span><span class="ident" id="7870098">File</span><span class="op" id="7870102">(</span><span class="op" id="7870103">)</span><span class="op" id="7870104">;</span>&nbsp;<span class="ident" id="7870106">err</span>&nbsp;<span class="op" id="7870110">!=</span>&nbsp;<span class="ident" id="7870113">nil</span>&nbsp;<span class="op" id="7870117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870121">t</span><span class="op" id="7870122">.</span><span class="ident" id="7870123">Fatalf</span><span class="op" id="7870129">(</span><span class="string" id="7870130">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7870160">,</span>&nbsp;<span class="ident" id="7870162">err</span><span class="op" id="7870165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870168">}</span>&nbsp;<span class="keyword" id="7870170">else</span>&nbsp;<span class="op" id="7870175">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870179">f</span><span class="op" id="7870180">.</span><span class="ident" id="7870181">Close</span><span class="op" id="7870186">(</span><span class="op" id="7870187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870190">}</span><br>
<span class="lineno"></span><span class="op" id="7870192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7870195">func</span>&nbsp;<span class="ident" id="7870200">TestUnixConnSpecificMethods</span><span class="op" id="7870227">(</span><span class="ident" id="7870228">t</span>&nbsp;<span class="op" id="7870230">*</span><span class="ident" id="7870231">testing</span><span class="op" id="7870238">.</span><span class="ident" id="7870239">T</span><span class="op" id="7870240">)</span>&nbsp;<span class="op" id="7870242">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870245">switch</span>&nbsp;<span class="ident" id="7870252">runtime</span><span class="op" id="7870259">.</span><span class="ident" id="7870260">GOOS</span>&nbsp;<span class="op" id="7870265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870268">case</span>&nbsp;<span class="string" id="7870273">&#34;nacl&#34;</span><span class="op" id="7870279">,</span>&nbsp;<span class="string" id="7870281">&#34;plan9&#34;</span><span class="op" id="7870288">,</span>&nbsp;<span class="string" id="7870290">&#34;windows&#34;</span><span class="op" id="7870299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870303">t</span><span class="op" id="7870304">.</span><span class="ident" id="7870305">Skipf</span><span class="op" id="7870310">(</span><span class="string" id="7870311">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7870332">,</span>&nbsp;<span class="ident" id="7870334">runtime</span><span class="op" id="7870341">.</span><span class="ident" id="7870342">GOOS</span><span class="op" id="7870346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870353">addr1</span><span class="op" id="7870358">,</span>&nbsp;<span class="ident" id="7870360">addr2</span><span class="op" id="7870365">,</span>&nbsp;<span class="ident" id="7870367">addr3</span>&nbsp;<span class="op" id="7870373">:=</span>&nbsp;<span class="ident" id="7870376">testUnixAddr</span><span class="op" id="7870388">(</span><span class="op" id="7870389">)</span><span class="op" id="7870390">,</span>&nbsp;<span class="ident" id="7870392">testUnixAddr</span><span class="op" id="7870404">(</span><span class="op" id="7870405">)</span><span class="op" id="7870406">,</span>&nbsp;<span class="ident" id="7870408">testUnixAddr</span><span class="op" id="7870420">(</span><span class="op" id="7870421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870425">a1</span><span class="op" id="7870427">,</span>&nbsp;<span class="ident" id="7870429">err</span>&nbsp;<span class="op" id="7870433">:=</span>&nbsp;<span class="ident" id="7870436">ResolveUnixAddr</span><span class="op" id="7870451">(</span><span class="string" id="7870452">&#34;unixgram&#34;</span><span class="op" id="7870462">,</span>&nbsp;<span class="ident" id="7870464">addr1</span><span class="op" id="7870469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870472">if</span>&nbsp;<span class="ident" id="7870475">err</span>&nbsp;<span class="op" id="7870479">!=</span>&nbsp;<span class="ident" id="7870482">nil</span>&nbsp;<span class="op" id="7870486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870490">t</span><span class="op" id="7870491">.</span><span class="ident" id="7870492">Fatalf</span><span class="op" id="7870498">(</span><span class="string" id="7870499">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7870527">,</span>&nbsp;<span class="ident" id="7870529">err</span><span class="op" id="7870532">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870538">c1</span><span class="op" id="7870540">,</span>&nbsp;<span class="ident" id="7870542">err</span>&nbsp;<span class="op" id="7870546">:=</span>&nbsp;<span class="ident" id="7870549">DialUnix</span><span class="op" id="7870557">(</span><span class="string" id="7870558">&#34;unixgram&#34;</span><span class="op" id="7870568">,</span>&nbsp;<span class="ident" id="7870570">a1</span><span class="op" id="7870572">,</span>&nbsp;<span class="ident" id="7870574">nil</span><span class="op" id="7870577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870580">if</span>&nbsp;<span class="ident" id="7870583">err</span>&nbsp;<span class="op" id="7870587">!=</span>&nbsp;<span class="ident" id="7870590">nil</span>&nbsp;<span class="op" id="7870594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870598">t</span><span class="op" id="7870599">.</span><span class="ident" id="7870600">Fatalf</span><span class="op" id="7870606">(</span><span class="string" id="7870607">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7870628">,</span>&nbsp;<span class="ident" id="7870630">err</span><span class="op" id="7870633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870636">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870639">defer</span>&nbsp;<span class="ident" id="7870645">c1</span><span class="op" id="7870647">.</span><span class="ident" id="7870648">Close</span><span class="op" id="7870653">(</span><span class="op" id="7870654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870657">defer</span>&nbsp;<span class="ident" id="7870663">os</span><span class="op" id="7870665">.</span><span class="ident" id="7870666">Remove</span><span class="op" id="7870672">(</span><span class="ident" id="7870673">addr1</span><span class="op" id="7870678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870681">c1</span><span class="op" id="7870683">.</span><span class="ident" id="7870684">LocalAddr</span><span class="op" id="7870693">(</span><span class="op" id="7870694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870697">c1</span><span class="op" id="7870699">.</span><span class="ident" id="7870700">RemoteAddr</span><span class="op" id="7870710">(</span><span class="op" id="7870711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870714">c1</span><span class="op" id="7870716">.</span><span class="ident" id="7870717">SetDeadline</span><span class="op" id="7870728">(</span><span class="ident" id="7870729">time</span><span class="op" id="7870733">.</span><span class="ident" id="7870734">Now</span><span class="op" id="7870737">(</span><span class="op" id="7870738">)</span><span class="op" id="7870739">.</span><span class="ident" id="7870740">Add</span><span class="op" id="7870743">(</span><span class="ident" id="7870744">someTimeout</span><span class="op" id="7870755">)</span><span class="op" id="7870756">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870759">c1</span><span class="op" id="7870761">.</span><span class="ident" id="7870762">SetReadDeadline</span><span class="op" id="7870777">(</span><span class="ident" id="7870778">time</span><span class="op" id="7870782">.</span><span class="ident" id="7870783">Now</span><span class="op" id="7870786">(</span><span class="op" id="7870787">)</span><span class="op" id="7870788">.</span><span class="ident" id="7870789">Add</span><span class="op" id="7870792">(</span><span class="ident" id="7870793">someTimeout</span><span class="op" id="7870804">)</span><span class="op" id="7870805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870808">c1</span><span class="op" id="7870810">.</span><span class="ident" id="7870811">SetWriteDeadline</span><span class="op" id="7870827">(</span><span class="ident" id="7870828">time</span><span class="op" id="7870832">.</span><span class="ident" id="7870833">Now</span><span class="op" id="7870836">(</span><span class="op" id="7870837">)</span><span class="op" id="7870838">.</span><span class="ident" id="7870839">Add</span><span class="op" id="7870842">(</span><span class="ident" id="7870843">someTimeout</span><span class="op" id="7870854">)</span><span class="op" id="7870855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870858">c1</span><span class="op" id="7870860">.</span><span class="ident" id="7870861">SetReadBuffer</span><span class="op" id="7870874">(</span><span class="num" id="7870875">2048</span><span class="op" id="7870879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870882">c1</span><span class="op" id="7870884">.</span><span class="ident" id="7870885">SetWriteBuffer</span><span class="op" id="7870899">(</span><span class="num" id="7870900">2048</span><span class="op" id="7870904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870908">a2</span><span class="op" id="7870910">,</span>&nbsp;<span class="ident" id="7870912">err</span>&nbsp;<span class="op" id="7870916">:=</span>&nbsp;<span class="ident" id="7870919">ResolveUnixAddr</span><span class="op" id="7870934">(</span><span class="string" id="7870935">&#34;unixgram&#34;</span><span class="op" id="7870945">,</span>&nbsp;<span class="ident" id="7870947">addr2</span><span class="op" id="7870952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870955">if</span>&nbsp;<span class="ident" id="7870958">err</span>&nbsp;<span class="op" id="7870962">!=</span>&nbsp;<span class="ident" id="7870965">nil</span>&nbsp;<span class="op" id="7870969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870973">t</span><span class="op" id="7870974">.</span><span class="ident" id="7870975">Fatalf</span><span class="op" id="7870981">(</span><span class="string" id="7870982">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7871010">,</span>&nbsp;<span class="ident" id="7871012">err</span><span class="op" id="7871015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871021">c2</span><span class="op" id="7871023">,</span>&nbsp;<span class="ident" id="7871025">err</span>&nbsp;<span class="op" id="7871029">:=</span>&nbsp;<span class="ident" id="7871032">DialUnix</span><span class="op" id="7871040">(</span><span class="string" id="7871041">&#34;unixgram&#34;</span><span class="op" id="7871051">,</span>&nbsp;<span class="ident" id="7871053">a2</span><span class="op" id="7871055">,</span>&nbsp;<span class="ident" id="7871057">nil</span><span class="op" id="7871060">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871063">if</span>&nbsp;<span class="ident" id="7871066">err</span>&nbsp;<span class="op" id="7871070">!=</span>&nbsp;<span class="ident" id="7871073">nil</span>&nbsp;<span class="op" id="7871077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871081">t</span><span class="op" id="7871082">.</span><span class="ident" id="7871083">Fatalf</span><span class="op" id="7871089">(</span><span class="string" id="7871090">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7871111">,</span>&nbsp;<span class="ident" id="7871113">err</span><span class="op" id="7871116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871122">defer</span>&nbsp;<span class="ident" id="7871128">c2</span><span class="op" id="7871130">.</span><span class="ident" id="7871131">Close</span><span class="op" id="7871136">(</span><span class="op" id="7871137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871140">defer</span>&nbsp;<span class="ident" id="7871146">os</span><span class="op" id="7871148">.</span><span class="ident" id="7871149">Remove</span><span class="op" id="7871155">(</span><span class="ident" id="7871156">addr2</span><span class="op" id="7871161">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871164">c2</span><span class="op" id="7871166">.</span><span class="ident" id="7871167">LocalAddr</span><span class="op" id="7871176">(</span><span class="op" id="7871177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871180">c2</span><span class="op" id="7871182">.</span><span class="ident" id="7871183">RemoteAddr</span><span class="op" id="7871193">(</span><span class="op" id="7871194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871197">c2</span><span class="op" id="7871199">.</span><span class="ident" id="7871200">SetDeadline</span><span class="op" id="7871211">(</span><span class="ident" id="7871212">time</span><span class="op" id="7871216">.</span><span class="ident" id="7871217">Now</span><span class="op" id="7871220">(</span><span class="op" id="7871221">)</span><span class="op" id="7871222">.</span><span class="ident" id="7871223">Add</span><span class="op" id="7871226">(</span><span class="ident" id="7871227">someTimeout</span><span class="op" id="7871238">)</span><span class="op" id="7871239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871242">c2</span><span class="op" id="7871244">.</span><span class="ident" id="7871245">SetReadDeadline</span><span class="op" id="7871260">(</span><span class="ident" id="7871261">time</span><span class="op" id="7871265">.</span><span class="ident" id="7871266">Now</span><span class="op" id="7871269">(</span><span class="op" id="7871270">)</span><span class="op" id="7871271">.</span><span class="ident" id="7871272">Add</span><span class="op" id="7871275">(</span><span class="ident" id="7871276">someTimeout</span><span class="op" id="7871287">)</span><span class="op" id="7871288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871291">c2</span><span class="op" id="7871293">.</span><span class="ident" id="7871294">SetWriteDeadline</span><span class="op" id="7871310">(</span><span class="ident" id="7871311">time</span><span class="op" id="7871315">.</span><span class="ident" id="7871316">Now</span><span class="op" id="7871319">(</span><span class="op" id="7871320">)</span><span class="op" id="7871321">.</span><span class="ident" id="7871322">Add</span><span class="op" id="7871325">(</span><span class="ident" id="7871326">someTimeout</span><span class="op" id="7871337">)</span><span class="op" id="7871338">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871341">c2</span><span class="op" id="7871343">.</span><span class="ident" id="7871344">SetReadBuffer</span><span class="op" id="7871357">(</span><span class="num" id="7871358">2048</span><span class="op" id="7871362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871365">c2</span><span class="op" id="7871367">.</span><span class="ident" id="7871368">SetWriteBuffer</span><span class="op" id="7871382">(</span><span class="num" id="7871383">2048</span><span class="op" id="7871387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871391">a3</span><span class="op" id="7871393">,</span>&nbsp;<span class="ident" id="7871395">err</span>&nbsp;<span class="op" id="7871399">:=</span>&nbsp;<span class="ident" id="7871402">ResolveUnixAddr</span><span class="op" id="7871417">(</span><span class="string" id="7871418">&#34;unixgram&#34;</span><span class="op" id="7871428">,</span>&nbsp;<span class="ident" id="7871430">addr3</span><span class="op" id="7871435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871438">if</span>&nbsp;<span class="ident" id="7871441">err</span>&nbsp;<span class="op" id="7871445">!=</span>&nbsp;<span class="ident" id="7871448">nil</span>&nbsp;<span class="op" id="7871452">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871456">t</span><span class="op" id="7871457">.</span><span class="ident" id="7871458">Fatalf</span><span class="op" id="7871464">(</span><span class="string" id="7871465">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7871493">,</span>&nbsp;<span class="ident" id="7871495">err</span><span class="op" id="7871498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871504">c3</span><span class="op" id="7871506">,</span>&nbsp;<span class="ident" id="7871508">err</span>&nbsp;<span class="op" id="7871512">:=</span>&nbsp;<span class="ident" id="7871515">ListenUnixgram</span><span class="op" id="7871529">(</span><span class="string" id="7871530">&#34;unixgram&#34;</span><span class="op" id="7871540">,</span>&nbsp;<span class="ident" id="7871542">a3</span><span class="op" id="7871544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871547">if</span>&nbsp;<span class="ident" id="7871550">err</span>&nbsp;<span class="op" id="7871554">!=</span>&nbsp;<span class="ident" id="7871557">nil</span>&nbsp;<span class="op" id="7871561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871565">t</span><span class="op" id="7871566">.</span><span class="ident" id="7871567">Fatalf</span><span class="op" id="7871573">(</span><span class="string" id="7871574">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7871601">,</span>&nbsp;<span class="ident" id="7871603">err</span><span class="op" id="7871606">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871612">defer</span>&nbsp;<span class="ident" id="7871618">c3</span><span class="op" id="7871620">.</span><span class="ident" id="7871621">Close</span><span class="op" id="7871626">(</span><span class="op" id="7871627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871630">defer</span>&nbsp;<span class="ident" id="7871636">os</span><span class="op" id="7871638">.</span><span class="ident" id="7871639">Remove</span><span class="op" id="7871645">(</span><span class="ident" id="7871646">addr3</span><span class="op" id="7871651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871654">c3</span><span class="op" id="7871656">.</span><span class="ident" id="7871657">LocalAddr</span><span class="op" id="7871666">(</span><span class="op" id="7871667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871670">c3</span><span class="op" id="7871672">.</span><span class="ident" id="7871673">RemoteAddr</span><span class="op" id="7871683">(</span><span class="op" id="7871684">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871687">c3</span><span class="op" id="7871689">.</span><span class="ident" id="7871690">SetDeadline</span><span class="op" id="7871701">(</span><span class="ident" id="7871702">time</span><span class="op" id="7871706">.</span><span class="ident" id="7871707">Now</span><span class="op" id="7871710">(</span><span class="op" id="7871711">)</span><span class="op" id="7871712">.</span><span class="ident" id="7871713">Add</span><span class="op" id="7871716">(</span><span class="ident" id="7871717">someTimeout</span><span class="op" id="7871728">)</span><span class="op" id="7871729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871732">c3</span><span class="op" id="7871734">.</span><span class="ident" id="7871735">SetReadDeadline</span><span class="op" id="7871750">(</span><span class="ident" id="7871751">time</span><span class="op" id="7871755">.</span><span class="ident" id="7871756">Now</span><span class="op" id="7871759">(</span><span class="op" id="7871760">)</span><span class="op" id="7871761">.</span><span class="ident" id="7871762">Add</span><span class="op" id="7871765">(</span><span class="ident" id="7871766">someTimeout</span><span class="op" id="7871777">)</span><span class="op" id="7871778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871781">c3</span><span class="op" id="7871783">.</span><span class="ident" id="7871784">SetWriteDeadline</span><span class="op" id="7871800">(</span><span class="ident" id="7871801">time</span><span class="op" id="7871805">.</span><span class="ident" id="7871806">Now</span><span class="op" id="7871809">(</span><span class="op" id="7871810">)</span><span class="op" id="7871811">.</span><span class="ident" id="7871812">Add</span><span class="op" id="7871815">(</span><span class="ident" id="7871816">someTimeout</span><span class="op" id="7871827">)</span><span class="op" id="7871828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871831">c3</span><span class="op" id="7871833">.</span><span class="ident" id="7871834">SetReadBuffer</span><span class="op" id="7871847">(</span><span class="num" id="7871848">2048</span><span class="op" id="7871852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871855">c3</span><span class="op" id="7871857">.</span><span class="ident" id="7871858">SetWriteBuffer</span><span class="op" id="7871872">(</span><span class="num" id="7871873">2048</span><span class="op" id="7871877">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871881">wb</span>&nbsp;<span class="op" id="7871884">:=</span>&nbsp;<span class="op" id="7871887">[</span><span class="op" id="7871888">]</span><span class="builtintype" id="7871889">byte</span><span class="op" id="7871893">(</span><span class="string" id="7871894">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="7871909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871912">rb1</span>&nbsp;<span class="op" id="7871916">:=</span>&nbsp;<span class="builtinfunc" id="7871919">make</span><span class="op" id="7871923">(</span><span class="op" id="7871924">[</span><span class="op" id="7871925">]</span><span class="builtintype" id="7871926">byte</span><span class="op" id="7871930">,</span>&nbsp;<span class="num" id="7871932">128</span><span class="op" id="7871935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871938">rb2</span>&nbsp;<span class="op" id="7871942">:=</span>&nbsp;<span class="builtinfunc" id="7871945">make</span><span class="op" id="7871949">(</span><span class="op" id="7871950">[</span><span class="op" id="7871951">]</span><span class="builtintype" id="7871952">byte</span><span class="op" id="7871956">,</span>&nbsp;<span class="num" id="7871958">128</span><span class="op" id="7871961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871964">rb3</span>&nbsp;<span class="op" id="7871968">:=</span>&nbsp;<span class="builtinfunc" id="7871971">make</span><span class="op" id="7871975">(</span><span class="op" id="7871976">[</span><span class="op" id="7871977">]</span><span class="builtintype" id="7871978">byte</span><span class="op" id="7871982">,</span>&nbsp;<span class="num" id="7871984">128</span><span class="op" id="7871987">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871990">if</span>&nbsp;<span class="ident" id="7871993">_</span><span class="op" id="7871994">,</span>&nbsp;<span class="ident" id="7871996">_</span><span class="op" id="7871997">,</span>&nbsp;<span class="ident" id="7871999">err</span>&nbsp;<span class="op" id="7872003">:=</span>&nbsp;<span class="ident" id="7872006">c1</span><span class="op" id="7872008">.</span><span class="ident" id="7872009">WriteMsgUnix</span><span class="op" id="7872021">(</span><span class="ident" id="7872022">wb</span><span class="op" id="7872024">,</span>&nbsp;<span class="ident" id="7872026">nil</span><span class="op" id="7872029">,</span>&nbsp;<span class="ident" id="7872031">a2</span><span class="op" id="7872033">)</span><span class="op" id="7872034">;</span>&nbsp;<span class="ident" id="7872036">err</span>&nbsp;<span class="op" id="7872040">!=</span>&nbsp;<span class="ident" id="7872043">nil</span>&nbsp;<span class="op" id="7872047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872051">t</span><span class="op" id="7872052">.</span><span class="ident" id="7872053">Fatalf</span><span class="op" id="7872059">(</span><span class="string" id="7872060">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872094">,</span>&nbsp;<span class="ident" id="7872096">err</span><span class="op" id="7872099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872105">if</span>&nbsp;<span class="ident" id="7872108">_</span><span class="op" id="7872109">,</span>&nbsp;<span class="ident" id="7872111">_</span><span class="op" id="7872112">,</span>&nbsp;<span class="ident" id="7872114">_</span><span class="op" id="7872115">,</span>&nbsp;<span class="ident" id="7872117">_</span><span class="op" id="7872118">,</span>&nbsp;<span class="ident" id="7872120">err</span>&nbsp;<span class="op" id="7872124">:=</span>&nbsp;<span class="ident" id="7872127">c2</span><span class="op" id="7872129">.</span><span class="ident" id="7872130">ReadMsgUnix</span><span class="op" id="7872141">(</span><span class="ident" id="7872142">rb2</span><span class="op" id="7872145">,</span>&nbsp;<span class="ident" id="7872147">nil</span><span class="op" id="7872150">)</span><span class="op" id="7872151">;</span>&nbsp;<span class="ident" id="7872153">err</span>&nbsp;<span class="op" id="7872157">!=</span>&nbsp;<span class="ident" id="7872160">nil</span>&nbsp;<span class="op" id="7872164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872168">t</span><span class="op" id="7872169">.</span><span class="ident" id="7872170">Fatalf</span><span class="op" id="7872176">(</span><span class="string" id="7872177">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872210">,</span>&nbsp;<span class="ident" id="7872212">err</span><span class="op" id="7872215">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872221">if</span>&nbsp;<span class="ident" id="7872224">_</span><span class="op" id="7872225">,</span>&nbsp;<span class="ident" id="7872227">err</span>&nbsp;<span class="op" id="7872231">:=</span>&nbsp;<span class="ident" id="7872234">c2</span><span class="op" id="7872236">.</span><span class="ident" id="7872237">WriteToUnix</span><span class="op" id="7872248">(</span><span class="ident" id="7872249">wb</span><span class="op" id="7872251">,</span>&nbsp;<span class="ident" id="7872253">a1</span><span class="op" id="7872255">)</span><span class="op" id="7872256">;</span>&nbsp;<span class="ident" id="7872258">err</span>&nbsp;<span class="op" id="7872262">!=</span>&nbsp;<span class="ident" id="7872265">nil</span>&nbsp;<span class="op" id="7872269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872273">t</span><span class="op" id="7872274">.</span><span class="ident" id="7872275">Fatalf</span><span class="op" id="7872281">(</span><span class="string" id="7872282">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872315">,</span>&nbsp;<span class="ident" id="7872317">err</span><span class="op" id="7872320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872326">if</span>&nbsp;<span class="ident" id="7872329">_</span><span class="op" id="7872330">,</span>&nbsp;<span class="ident" id="7872332">_</span><span class="op" id="7872333">,</span>&nbsp;<span class="ident" id="7872335">err</span>&nbsp;<span class="op" id="7872339">:=</span>&nbsp;<span class="ident" id="7872342">c1</span><span class="op" id="7872344">.</span><span class="ident" id="7872345">ReadFromUnix</span><span class="op" id="7872357">(</span><span class="ident" id="7872358">rb1</span><span class="op" id="7872361">)</span><span class="op" id="7872362">;</span>&nbsp;<span class="ident" id="7872364">err</span>&nbsp;<span class="op" id="7872368">!=</span>&nbsp;<span class="ident" id="7872371">nil</span>&nbsp;<span class="op" id="7872375">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872379">t</span><span class="op" id="7872380">.</span><span class="ident" id="7872381">Fatalf</span><span class="op" id="7872387">(</span><span class="string" id="7872388">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872422">,</span>&nbsp;<span class="ident" id="7872424">err</span><span class="op" id="7872427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872433">if</span>&nbsp;<span class="ident" id="7872436">_</span><span class="op" id="7872437">,</span>&nbsp;<span class="ident" id="7872439">err</span>&nbsp;<span class="op" id="7872443">:=</span>&nbsp;<span class="ident" id="7872446">c3</span><span class="op" id="7872448">.</span><span class="ident" id="7872449">WriteToUnix</span><span class="op" id="7872460">(</span><span class="ident" id="7872461">wb</span><span class="op" id="7872463">,</span>&nbsp;<span class="ident" id="7872465">a1</span><span class="op" id="7872467">)</span><span class="op" id="7872468">;</span>&nbsp;<span class="ident" id="7872470">err</span>&nbsp;<span class="op" id="7872474">!=</span>&nbsp;<span class="ident" id="7872477">nil</span>&nbsp;<span class="op" id="7872481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872485">t</span><span class="op" id="7872486">.</span><span class="ident" id="7872487">Fatalf</span><span class="op" id="7872493">(</span><span class="string" id="7872494">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872527">,</span>&nbsp;<span class="ident" id="7872529">err</span><span class="op" id="7872532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872535">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872538">if</span>&nbsp;<span class="ident" id="7872541">_</span><span class="op" id="7872542">,</span>&nbsp;<span class="ident" id="7872544">_</span><span class="op" id="7872545">,</span>&nbsp;<span class="ident" id="7872547">err</span>&nbsp;<span class="op" id="7872551">:=</span>&nbsp;<span class="ident" id="7872554">c1</span><span class="op" id="7872556">.</span><span class="ident" id="7872557">ReadFromUnix</span><span class="op" id="7872569">(</span><span class="ident" id="7872570">rb1</span><span class="op" id="7872573">)</span><span class="op" id="7872574">;</span>&nbsp;<span class="ident" id="7872576">err</span>&nbsp;<span class="op" id="7872580">!=</span>&nbsp;<span class="ident" id="7872583">nil</span>&nbsp;<span class="op" id="7872587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872591">t</span><span class="op" id="7872592">.</span><span class="ident" id="7872593">Fatalf</span><span class="op" id="7872599">(</span><span class="string" id="7872600">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872634">,</span>&nbsp;<span class="ident" id="7872636">err</span><span class="op" id="7872639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872645">if</span>&nbsp;<span class="ident" id="7872648">_</span><span class="op" id="7872649">,</span>&nbsp;<span class="ident" id="7872651">err</span>&nbsp;<span class="op" id="7872655">:=</span>&nbsp;<span class="ident" id="7872658">c2</span><span class="op" id="7872660">.</span><span class="ident" id="7872661">WriteToUnix</span><span class="op" id="7872672">(</span><span class="ident" id="7872673">wb</span><span class="op" id="7872675">,</span>&nbsp;<span class="ident" id="7872677">a3</span><span class="op" id="7872679">)</span><span class="op" id="7872680">;</span>&nbsp;<span class="ident" id="7872682">err</span>&nbsp;<span class="op" id="7872686">!=</span>&nbsp;<span class="ident" id="7872689">nil</span>&nbsp;<span class="op" id="7872693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872697">t</span><span class="op" id="7872698">.</span><span class="ident" id="7872699">Fatalf</span><span class="op" id="7872705">(</span><span class="string" id="7872706">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872739">,</span>&nbsp;<span class="ident" id="7872741">err</span><span class="op" id="7872744">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872750">if</span>&nbsp;<span class="ident" id="7872753">_</span><span class="op" id="7872754">,</span>&nbsp;<span class="ident" id="7872756">_</span><span class="op" id="7872757">,</span>&nbsp;<span class="ident" id="7872759">err</span>&nbsp;<span class="op" id="7872763">:=</span>&nbsp;<span class="ident" id="7872766">c3</span><span class="op" id="7872768">.</span><span class="ident" id="7872769">ReadFromUnix</span><span class="op" id="7872781">(</span><span class="ident" id="7872782">rb3</span><span class="op" id="7872785">)</span><span class="op" id="7872786">;</span>&nbsp;<span class="ident" id="7872788">err</span>&nbsp;<span class="op" id="7872792">!=</span>&nbsp;<span class="ident" id="7872795">nil</span>&nbsp;<span class="op" id="7872799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872803">t</span><span class="op" id="7872804">.</span><span class="ident" id="7872805">Fatalf</span><span class="op" id="7872811">(</span><span class="string" id="7872812">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872846">,</span>&nbsp;<span class="ident" id="7872848">err</span><span class="op" id="7872851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872858">if</span>&nbsp;<span class="ident" id="7872861">f</span><span class="op" id="7872862">,</span>&nbsp;<span class="ident" id="7872864">err</span>&nbsp;<span class="op" id="7872868">:=</span>&nbsp;<span class="ident" id="7872871">c1</span><span class="op" id="7872873">.</span><span class="ident" id="7872874">File</span><span class="op" id="7872878">(</span><span class="op" id="7872879">)</span><span class="op" id="7872880">;</span>&nbsp;<span class="ident" id="7872882">err</span>&nbsp;<span class="op" id="7872886">!=</span>&nbsp;<span class="ident" id="7872889">nil</span>&nbsp;<span class="op" id="7872893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872897">t</span><span class="op" id="7872898">.</span><span class="ident" id="7872899">Fatalf</span><span class="op" id="7872905">(</span><span class="string" id="7872906">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7872932">,</span>&nbsp;<span class="ident" id="7872934">err</span><span class="op" id="7872937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872940">}</span>&nbsp;<span class="keyword" id="7872942">else</span>&nbsp;<span class="op" id="7872947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872951">f</span><span class="op" id="7872952">.</span><span class="ident" id="7872953">Close</span><span class="op" id="7872958">(</span><span class="op" id="7872959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872962">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872966">defer</span>&nbsp;<span class="keyword" id="7872972">func</span><span class="op" id="7872976">(</span><span class="op" id="7872977">)</span>&nbsp;<span class="op" id="7872979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872983">if</span>&nbsp;<span class="ident" id="7872986">p</span>&nbsp;<span class="op" id="7872988">:=</span>&nbsp;<span class="builtinfunc" id="7872991">recover</span><span class="op" id="7872998">(</span><span class="op" id="7872999">)</span><span class="op" id="7873000">;</span>&nbsp;<span class="ident" id="7873002">p</span>&nbsp;<span class="op" id="7873004">!=</span>&nbsp;<span class="ident" id="7873007">nil</span>&nbsp;<span class="op" id="7873011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873016">t</span><span class="op" id="7873017">.</span><span class="ident" id="7873018">Fatalf</span><span class="op" id="7873024">(</span><span class="string" id="7873025">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7873076">,</span>&nbsp;<span class="ident" id="7873078">p</span><span class="op" id="7873079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873083">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873086">}</span><span class="op" id="7873087">(</span><span class="op" id="7873088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873092">c1</span><span class="op" id="7873094">.</span><span class="ident" id="7873095">WriteToUnix</span><span class="op" id="7873106">(</span><span class="ident" id="7873107">wb</span><span class="op" id="7873109">,</span>&nbsp;<span class="ident" id="7873111">nil</span><span class="op" id="7873114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873117">c1</span><span class="op" id="7873119">.</span><span class="ident" id="7873120">WriteMsgUnix</span><span class="op" id="7873132">(</span><span class="ident" id="7873133">wb</span><span class="op" id="7873135">,</span>&nbsp;<span class="ident" id="7873137">nil</span><span class="op" id="7873140">,</span>&nbsp;<span class="ident" id="7873142">nil</span><span class="op" id="7873145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873148">c3</span><span class="op" id="7873150">.</span><span class="ident" id="7873151">WriteToUnix</span><span class="op" id="7873162">(</span><span class="ident" id="7873163">wb</span><span class="op" id="7873165">,</span>&nbsp;<span class="ident" id="7873167">nil</span><span class="op" id="7873170">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873173">c3</span><span class="op" id="7873175">.</span><span class="ident" id="7873176">WriteMsgUnix</span><span class="op" id="7873188">(</span><span class="ident" id="7873189">wb</span><span class="op" id="7873191">,</span>&nbsp;<span class="ident" id="7873193">nil</span><span class="op" id="7873196">,</span>&nbsp;<span class="ident" id="7873198">nil</span><span class="op" id="7873201">)</span><br>
<span class="lineno"></span><span class="op" id="7873203">}</span>
</div>
</body>
</html>
