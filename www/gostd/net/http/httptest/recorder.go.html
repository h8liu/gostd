<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5945726">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5945781">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5945835">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5945886">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5945943">package</span>&nbsp;<span class="ident" id="5945951">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945961">import</span>&nbsp;<span class="op" id="5945968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5945971">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5945980">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="5945991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5945994">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5946063">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="5946119">type</span>&nbsp;<span class="ident" id="5946124">ResponseRecorder</span>&nbsp;<span class="keyword" id="5946141">struct</span>&nbsp;<span class="op" id="5946148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946151">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5946161">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946175">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946219">HeaderMap</span>&nbsp;<span class="ident" id="5946229">http</span><span class="op" id="5946233">.</span><span class="ident" id="5946234">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5946243">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946273">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946283">*</span><span class="ident" id="5946284">bytes</span><span class="op" id="5946289">.</span><span class="ident" id="5946290">Buffer</span>&nbsp;<span class="comment" id="5946297">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946356">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5946366">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946373">wroteHeader</span>&nbsp;<span class="builtintype" id="5946385">bool</span><br>
<span class="lineno"></span><span class="op" id="5946390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946393">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="5946449">func</span>&nbsp;<span class="ident" id="5946454">NewRecorder</span><span class="op" id="5946465">(</span><span class="op" id="5946466">)</span>&nbsp;<span class="op" id="5946468">*</span><span class="ident" id="5946469">ResponseRecorder</span>&nbsp;<span class="op" id="5946486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946489">return</span>&nbsp;<span class="op" id="5946496">&amp;</span><span class="ident" id="5946497">ResponseRecorder</span><span class="op" id="5946513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946517">HeaderMap</span><span class="op" id="5946526">:</span>&nbsp;<span class="builtinfunc" id="5946528">make</span><span class="op" id="5946532">(</span><span class="ident" id="5946533">http</span><span class="op" id="5946537">.</span><span class="ident" id="5946538">Header</span><span class="op" id="5946544">)</span><span class="op" id="5946545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946549">Body</span><span class="op" id="5946553">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5946560">new</span><span class="op" id="5946563">(</span><span class="ident" id="5946564">bytes</span><span class="op" id="5946569">.</span><span class="ident" id="5946570">Buffer</span><span class="op" id="5946576">)</span><span class="op" id="5946577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946581">Code</span><span class="op" id="5946585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5946592">200</span><span class="op" id="5946595">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946598">}</span><br>
<span class="lineno"></span><span class="op" id="5946600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946603">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5946681">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="5946745">const</span>&nbsp;<span class="ident" id="5946751">DefaultRemoteAddr</span>&nbsp;<span class="op" id="5946769">=</span>&nbsp;<span class="string" id="5946771">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946782">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5946822">func</span>&nbsp;<span class="op" id="5946827">(</span><span class="ident" id="5946828">rw</span>&nbsp;<span class="op" id="5946831">*</span><span class="ident" id="5946832">ResponseRecorder</span><span class="op" id="5946848">)</span>&nbsp;<span class="ident" id="5946850">Header</span><span class="op" id="5946856">(</span><span class="op" id="5946857">)</span>&nbsp;<span class="ident" id="5946859">http</span><span class="op" id="5946863">.</span><span class="ident" id="5946864">Header</span>&nbsp;<span class="op" id="5946871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946874">m</span>&nbsp;<span class="op" id="5946876">:=</span>&nbsp;<span class="ident" id="5946879">rw</span><span class="op" id="5946881">.</span><span class="ident" id="5946882">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946893">if</span>&nbsp;<span class="ident" id="5946896">m</span>&nbsp;<span class="op" id="5946898">==</span>&nbsp;<span class="ident" id="5946901">nil</span>&nbsp;<span class="op" id="5946905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946909">m</span>&nbsp;<span class="op" id="5946911">=</span>&nbsp;<span class="builtinfunc" id="5946913">make</span><span class="op" id="5946917">(</span><span class="ident" id="5946918">http</span><span class="op" id="5946922">.</span><span class="ident" id="5946923">Header</span><span class="op" id="5946929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946933">rw</span><span class="op" id="5946935">.</span><span class="ident" id="5946936">HeaderMap</span>&nbsp;<span class="op" id="5946946">=</span>&nbsp;<span class="ident" id="5946948">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946954">return</span>&nbsp;<span class="ident" id="5946961">m</span><br>
<span class="lineno">45</span><span class="op" id="5946963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946966">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5947026">func</span>&nbsp;<span class="op" id="5947031">(</span><span class="ident" id="5947032">rw</span>&nbsp;<span class="op" id="5947035">*</span><span class="ident" id="5947036">ResponseRecorder</span><span class="op" id="5947052">)</span>&nbsp;<span class="ident" id="5947054">Write</span><span class="op" id="5947059">(</span><span class="ident" id="5947060">buf</span>&nbsp;<span class="op" id="5947064">[</span><span class="op" id="5947065">]</span><span class="builtintype" id="5947066">byte</span><span class="op" id="5947070">)</span>&nbsp;<span class="op" id="5947072">(</span><span class="builtintype" id="5947073">int</span><span class="op" id="5947076">,</span>&nbsp;<span class="builtintype" id="5947078">error</span><span class="op" id="5947083">)</span>&nbsp;<span class="op" id="5947085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947088">if</span>&nbsp;<span class="op" id="5947091">!</span><span class="ident" id="5947092">rw</span><span class="op" id="5947094">.</span><span class="ident" id="5947095">wroteHeader</span>&nbsp;<span class="op" id="5947107">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947111">rw</span><span class="op" id="5947113">.</span><span class="ident" id="5947114">WriteHeader</span><span class="op" id="5947125">(</span><span class="num" id="5947126">200</span><span class="op" id="5947129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947135">if</span>&nbsp;<span class="ident" id="5947138">rw</span><span class="op" id="5947140">.</span><span class="ident" id="5947141">Body</span>&nbsp;<span class="op" id="5947146">!=</span>&nbsp;<span class="ident" id="5947149">nil</span>&nbsp;<span class="op" id="5947153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947157">rw</span><span class="op" id="5947159">.</span><span class="ident" id="5947160">Body</span><span class="op" id="5947164">.</span><span class="ident" id="5947165">Write</span><span class="op" id="5947170">(</span><span class="ident" id="5947171">buf</span><span class="op" id="5947174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947177">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947180">return</span>&nbsp;<span class="builtinfunc" id="5947187">len</span><span class="op" id="5947190">(</span><span class="ident" id="5947191">buf</span><span class="op" id="5947194">)</span><span class="op" id="5947195">,</span>&nbsp;<span class="ident" id="5947197">nil</span><br>
<span class="lineno"></span><span class="op" id="5947201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5947204">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="5947233">func</span>&nbsp;<span class="op" id="5947238">(</span><span class="ident" id="5947239">rw</span>&nbsp;<span class="op" id="5947242">*</span><span class="ident" id="5947243">ResponseRecorder</span><span class="op" id="5947259">)</span>&nbsp;<span class="ident" id="5947261">WriteHeader</span><span class="op" id="5947272">(</span><span class="ident" id="5947273">code</span>&nbsp;<span class="builtintype" id="5947278">int</span><span class="op" id="5947281">)</span>&nbsp;<span class="op" id="5947283">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947286">if</span>&nbsp;<span class="op" id="5947289">!</span><span class="ident" id="5947290">rw</span><span class="op" id="5947292">.</span><span class="ident" id="5947293">wroteHeader</span>&nbsp;<span class="op" id="5947305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947309">rw</span><span class="op" id="5947311">.</span><span class="ident" id="5947312">Code</span>&nbsp;<span class="op" id="5947317">=</span>&nbsp;<span class="ident" id="5947319">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947328">rw</span><span class="op" id="5947330">.</span><span class="ident" id="5947331">wroteHeader</span>&nbsp;<span class="op" id="5947343">=</span>&nbsp;<span class="builtintype" id="5947345">true</span><br>
<span class="lineno"></span><span class="op" id="5947350">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5947353">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5947387">func</span>&nbsp;<span class="op" id="5947392">(</span><span class="ident" id="5947393">rw</span>&nbsp;<span class="op" id="5947396">*</span><span class="ident" id="5947397">ResponseRecorder</span><span class="op" id="5947413">)</span>&nbsp;<span class="ident" id="5947415">Flush</span><span class="op" id="5947420">(</span><span class="op" id="5947421">)</span>&nbsp;<span class="op" id="5947423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947426">if</span>&nbsp;<span class="op" id="5947429">!</span><span class="ident" id="5947430">rw</span><span class="op" id="5947432">.</span><span class="ident" id="5947433">wroteHeader</span>&nbsp;<span class="op" id="5947445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947449">rw</span><span class="op" id="5947451">.</span><span class="ident" id="5947452">WriteHeader</span><span class="op" id="5947463">(</span><span class="num" id="5947464">200</span><span class="op" id="5947467">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947473">rw</span><span class="op" id="5947475">.</span><span class="ident" id="5947476">Flushed</span>&nbsp;<span class="op" id="5947484">=</span>&nbsp;<span class="builtintype" id="5947486">true</span><br>
<span class="lineno"></span><span class="op" id="5947491">}</span>
</div>
</body>
</html>
