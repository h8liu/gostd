<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8580977">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8581032">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8581086">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8581137">package</span>&nbsp;<span class="ident" id="8581145">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8581158">import</span>&nbsp;<span class="op" id="8581165">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581168">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581177">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581190">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581200">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581208">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581219">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8581229">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8581232">type</span>&nbsp;<span class="ident" id="8581237">testCase</span>&nbsp;<span class="keyword" id="8581246">struct</span>&nbsp;<span class="op" id="8581253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581256">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8581265">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8581274">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581296">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8581305">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8581314">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581334">patterns</span>&nbsp;<span class="op" id="8581343">[</span><span class="op" id="8581344">]</span><span class="builtintype" id="8581345">string</span>&nbsp;<span class="comment" id="8581352">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="8581374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8581377">var</span>&nbsp;<span class="ident" id="8581381">testCases</span>&nbsp;<span class="op" id="8581391">=</span>&nbsp;<span class="op" id="8581393">[</span><span class="op" id="8581394">]</span><span class="ident" id="8581395">testCase</span><span class="op" id="8581403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581410">&#34;empty&nbsp;string&#34;</span><span class="op" id="8581424">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581428">&#34;&#34;</span><span class="op" id="8581430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581434">[</span><span class="op" id="8581435">]</span><span class="builtintype" id="8581436">string</span><span class="op" id="8581442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581447">&#34;&#34;</span><span class="op" id="8581449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581454">&#34;foo&#34;</span><span class="op" id="8581459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581464">&#34;(foo)&#34;</span><span class="op" id="8581471">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581476">&#34;.*&#34;</span><span class="op" id="8581480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581485">&#34;a*&#34;</span><span class="op" id="8581489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581493">}</span><span class="op" id="8581494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581497">}</span><span class="op" id="8581498">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581506">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="8581515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581519">&#34;aaaaaaaaaa&#34;</span><span class="op" id="8581531">,</span>&nbsp;<span class="comment" id="8581533">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581545">[</span><span class="op" id="8581546">]</span><span class="builtintype" id="8581547">string</span><span class="op" id="8581553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581558">&#34;&#34;</span><span class="op" id="8581560">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581565">&#34;a&#34;</span><span class="op" id="8581568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581573">&#34;aa&#34;</span><span class="op" id="8581577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581582">&#34;aaa&#34;</span><span class="op" id="8581587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581592">&#34;aaaa&#34;</span><span class="op" id="8581598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581603">&#34;aaaaa&#34;</span><span class="op" id="8581610">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581615">&#34;aaaaaa&#34;</span><span class="op" id="8581623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581628">&#34;aaaaaaa&#34;</span><span class="op" id="8581637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581642">&#34;aaaaaaaa&#34;</span><span class="op" id="8581652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581657">&#34;aaaaaaaaa&#34;</span><span class="op" id="8581668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581673">&#34;aaaaaaaaaa&#34;</span><span class="op" id="8581685">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581690">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="8581703">,</span>&nbsp;<span class="comment" id="8581705">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581718">&#34;.&#34;</span><span class="op" id="8581721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581726">&#34;.*&#34;</span><span class="op" id="8581730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581735">&#34;a+&#34;</span><span class="op" id="8581739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581744">&#34;aa+&#34;</span><span class="op" id="8581749">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581754">&#34;aaaa[b]?&#34;</span><span class="op" id="8581764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581769">&#34;aaa*&#34;</span><span class="op" id="8581775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581779">}</span><span class="op" id="8581780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581783">}</span><span class="op" id="8581784">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581792">&#34;abc&#34;</span><span class="op" id="8581797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581801">&#34;abc&#34;</span><span class="op" id="8581806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581810">[</span><span class="op" id="8581811">]</span><span class="builtintype" id="8581812">string</span><span class="op" id="8581818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581823">&#34;a&#34;</span><span class="op" id="8581826">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581831">&#34;b&#34;</span><span class="op" id="8581834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581839">&#34;c&#34;</span><span class="op" id="8581842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581847">&#34;ab&#34;</span><span class="op" id="8581851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581856">&#34;bc&#34;</span><span class="op" id="8581860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581865">&#34;abc&#34;</span><span class="op" id="8581870">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581875">&#34;a.c&#34;</span><span class="op" id="8581880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581885">&#34;a(b|c)&#34;</span><span class="op" id="8581893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581898">&#34;abc?&#34;</span><span class="op" id="8581904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581908">}</span><span class="op" id="8581909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581912">}</span><span class="op" id="8581913">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581921">&#34;barbara*3&#34;</span><span class="op" id="8581932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581936">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="8581959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581963">[</span><span class="op" id="8581964">]</span><span class="builtintype" id="8581965">string</span><span class="op" id="8581971">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581976">&#34;a&#34;</span><span class="op" id="8581979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581984">&#34;bar&#34;</span><span class="op" id="8581989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581994">&#34;rab&#34;</span><span class="op" id="8581999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582004">&#34;arab&#34;</span><span class="op" id="8582010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582015">&#34;barbar&#34;</span><span class="op" id="8582023">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582028">&#34;bara?bar&#34;</span><span class="op" id="8582038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582042">}</span><span class="op" id="8582043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582046">}</span><span class="op" id="8582047">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582051">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582055">&#34;typing&nbsp;drill&#34;</span><span class="op" id="8582069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582073">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="8582144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582148">[</span><span class="op" id="8582149">]</span><span class="builtintype" id="8582150">string</span><span class="op" id="8582156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582161">&#34;Now&#34;</span><span class="op" id="8582166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582171">&#34;the&nbsp;time&#34;</span><span class="op" id="8582181">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582186">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="8582203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582208">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="8582266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582271">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="8582287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582291">}</span><span class="op" id="8582292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582295">}</span><span class="op" id="8582296">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582304">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="8582322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8582326">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="8582371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582375">[</span><span class="op" id="8582376">]</span><span class="builtintype" id="8582377">string</span><span class="op" id="8582383">{</span><span class="op" id="8582384">}</span><span class="op" id="8582385">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582388">}</span><span class="op" id="8582389">,</span><br>
<span class="lineno"></span><span class="op" id="8582391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8582394">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="8582463">func</span>&nbsp;<span class="ident" id="8582468">find</span><span class="op" id="8582472">(</span><span class="ident" id="8582473">src</span><span class="op" id="8582476">,</span>&nbsp;<span class="ident" id="8582478">s</span>&nbsp;<span class="builtintype" id="8582480">string</span><span class="op" id="8582486">,</span>&nbsp;<span class="ident" id="8582488">n</span>&nbsp;<span class="builtintype" id="8582490">int</span><span class="op" id="8582493">)</span>&nbsp;<span class="op" id="8582495">[</span><span class="op" id="8582496">]</span><span class="builtintype" id="8582497">int</span>&nbsp;<span class="op" id="8582501">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582504">var</span>&nbsp;<span class="ident" id="8582508">res</span>&nbsp;<span class="op" id="8582512">[</span><span class="op" id="8582513">]</span><span class="builtintype" id="8582514">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582519">if</span>&nbsp;<span class="ident" id="8582522">s</span>&nbsp;<span class="op" id="8582524">!=</span>&nbsp;<span class="string" id="8582527">&#34;&#34;</span>&nbsp;<span class="op" id="8582530">&amp;&amp;</span>&nbsp;<span class="ident" id="8582533">n</span>&nbsp;<span class="op" id="8582535">!=</span>&nbsp;<span class="num" id="8582538">0</span>&nbsp;<span class="op" id="8582540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8582544">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582588">for</span>&nbsp;<span class="ident" id="8582592">i</span>&nbsp;<span class="op" id="8582594">:=</span>&nbsp;<span class="op" id="8582597">-</span><span class="num" id="8582598">1</span><span class="op" id="8582599">;</span>&nbsp;<span class="ident" id="8582601">n</span>&nbsp;<span class="op" id="8582603">&lt;</span>&nbsp;<span class="num" id="8582605">0</span>&nbsp;<span class="op" id="8582607">||</span>&nbsp;<span class="builtinfunc" id="8582610">len</span><span class="op" id="8582613">(</span><span class="ident" id="8582614">res</span><span class="op" id="8582617">)</span>&nbsp;<span class="op" id="8582619">&lt;</span>&nbsp;<span class="ident" id="8582621">n</span><span class="op" id="8582622">;</span>&nbsp;<span class="op" id="8582624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582629">j</span>&nbsp;<span class="op" id="8582631">:=</span>&nbsp;<span class="ident" id="8582634">strings</span><span class="op" id="8582641">.</span><span class="ident" id="8582642">Index</span><span class="op" id="8582647">(</span><span class="ident" id="8582648">src</span><span class="op" id="8582651">[</span><span class="ident" id="8582652">i</span><span class="op" id="8582653">+</span><span class="num" id="8582654">1</span><span class="op" id="8582655">:</span><span class="op" id="8582656">]</span><span class="op" id="8582657">,</span>&nbsp;<span class="ident" id="8582659">s</span><span class="op" id="8582660">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582665">if</span>&nbsp;<span class="ident" id="8582668">j</span>&nbsp;<span class="op" id="8582670">&lt;</span>&nbsp;<span class="num" id="8582672">0</span>&nbsp;<span class="op" id="8582674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582680">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582694">i</span>&nbsp;<span class="op" id="8582696">+=</span>&nbsp;<span class="ident" id="8582699">j</span>&nbsp;<span class="op" id="8582701">+</span>&nbsp;<span class="num" id="8582703">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582708">res</span>&nbsp;<span class="op" id="8582712">=</span>&nbsp;<span class="builtinfunc" id="8582714">append</span><span class="op" id="8582720">(</span><span class="ident" id="8582721">res</span><span class="op" id="8582724">,</span>&nbsp;<span class="ident" id="8582726">i</span><span class="op" id="8582727">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8582734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582737">return</span>&nbsp;<span class="ident" id="8582744">res</span><br>
<span class="lineno"></span><span class="op" id="8582748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8582751">func</span>&nbsp;<span class="ident" id="8582756">testLookup</span><span class="op" id="8582766">(</span><span class="ident" id="8582767">t</span>&nbsp;<span class="op" id="8582769">*</span><span class="ident" id="8582770">testing</span><span class="op" id="8582777">.</span><span class="ident" id="8582778">T</span><span class="op" id="8582779">,</span>&nbsp;<span class="ident" id="8582781">tc</span>&nbsp;<span class="op" id="8582784">*</span><span class="ident" id="8582785">testCase</span><span class="op" id="8582793">,</span>&nbsp;<span class="ident" id="8582795">x</span>&nbsp;<span class="op" id="8582797">*</span><span class="ident" id="8582798">Index</span><span class="op" id="8582803">,</span>&nbsp;<span class="ident" id="8582805">s</span>&nbsp;<span class="builtintype" id="8582807">string</span><span class="op" id="8582813">,</span>&nbsp;<span class="ident" id="8582815">n</span>&nbsp;<span class="builtintype" id="8582817">int</span><span class="op" id="8582820">)</span>&nbsp;<span class="op" id="8582822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582825">res</span>&nbsp;<span class="op" id="8582829">:=</span>&nbsp;<span class="ident" id="8582832">x</span><span class="op" id="8582833">.</span><span class="ident" id="8582834">Lookup</span><span class="op" id="8582840">(</span><span class="op" id="8582841">[</span><span class="op" id="8582842">]</span><span class="builtintype" id="8582843">byte</span><span class="op" id="8582847">(</span><span class="ident" id="8582848">s</span><span class="op" id="8582849">)</span><span class="op" id="8582850">,</span>&nbsp;<span class="ident" id="8582852">n</span><span class="op" id="8582853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582856">exp</span>&nbsp;<span class="op" id="8582860">:=</span>&nbsp;<span class="ident" id="8582863">find</span><span class="op" id="8582867">(</span><span class="ident" id="8582868">tc</span><span class="op" id="8582870">.</span><span class="ident" id="8582871">source</span><span class="op" id="8582877">,</span>&nbsp;<span class="ident" id="8582879">s</span><span class="op" id="8582880">,</span>&nbsp;<span class="ident" id="8582882">n</span><span class="op" id="8582883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8582887">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8582920">if</span>&nbsp;<span class="builtinfunc" id="8582923">len</span><span class="op" id="8582926">(</span><span class="ident" id="8582927">res</span><span class="op" id="8582930">)</span>&nbsp;<span class="op" id="8582932">!=</span>&nbsp;<span class="builtinfunc" id="8582935">len</span><span class="op" id="8582938">(</span><span class="ident" id="8582939">exp</span><span class="op" id="8582942">)</span>&nbsp;<span class="op" id="8582944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582948">t</span><span class="op" id="8582949">.</span><span class="ident" id="8582950">Errorf</span><span class="op" id="8582956">(</span><span class="string" id="8582957">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8583015">,</span>&nbsp;<span class="ident" id="8583017">tc</span><span class="op" id="8583019">.</span><span class="ident" id="8583020">name</span><span class="op" id="8583024">,</span>&nbsp;<span class="ident" id="8583026">s</span><span class="op" id="8583027">,</span>&nbsp;<span class="ident" id="8583029">n</span><span class="op" id="8583030">,</span>&nbsp;<span class="builtinfunc" id="8583032">len</span><span class="op" id="8583035">(</span><span class="ident" id="8583036">exp</span><span class="op" id="8583039">)</span><span class="op" id="8583040">,</span>&nbsp;<span class="builtinfunc" id="8583042">len</span><span class="op" id="8583045">(</span><span class="ident" id="8583046">res</span><span class="op" id="8583049">)</span><span class="op" id="8583050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8583053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8583057">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8583133">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8583209">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8583285">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8583350">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8583432">sort</span><span class="op" id="8583436">.</span><span class="ident" id="8583437">Ints</span><span class="op" id="8583441">(</span><span class="ident" id="8583442">res</span><span class="op" id="8583445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8583448">for</span>&nbsp;<span class="ident" id="8583452">i</span><span class="op" id="8583453">,</span>&nbsp;<span class="ident" id="8583455">r</span>&nbsp;<span class="op" id="8583457">:=</span>&nbsp;<span class="keyword" id="8583460">range</span>&nbsp;<span class="ident" id="8583466">res</span>&nbsp;<span class="op" id="8583470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8583474">if</span>&nbsp;<span class="ident" id="8583477">r</span>&nbsp;<span class="op" id="8583479">&lt;</span>&nbsp;<span class="num" id="8583481">0</span>&nbsp;<span class="op" id="8583483">||</span>&nbsp;<span class="builtinfunc" id="8583486">len</span><span class="op" id="8583489">(</span><span class="ident" id="8583490">tc</span><span class="op" id="8583492">.</span><span class="ident" id="8583493">source</span><span class="op" id="8583499">)</span>&nbsp;<span class="op" id="8583501">&lt;=</span>&nbsp;<span class="ident" id="8583504">r</span>&nbsp;<span class="op" id="8583506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8583511">t</span><span class="op" id="8583512">.</span><span class="ident" id="8583513">Errorf</span><span class="op" id="8583519">(</span><span class="string" id="8583520">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="8583591">,</span>&nbsp;<span class="ident" id="8583593">tc</span><span class="op" id="8583595">.</span><span class="ident" id="8583596">name</span><span class="op" id="8583600">,</span>&nbsp;<span class="ident" id="8583602">s</span><span class="op" id="8583603">,</span>&nbsp;<span class="ident" id="8583605">i</span><span class="op" id="8583606">,</span>&nbsp;<span class="ident" id="8583608">n</span><span class="op" id="8583609">,</span>&nbsp;<span class="ident" id="8583611">r</span><span class="op" id="8583612">,</span>&nbsp;<span class="builtinfunc" id="8583614">len</span><span class="op" id="8583617">(</span><span class="ident" id="8583618">tc</span><span class="op" id="8583620">.</span><span class="ident" id="8583621">source</span><span class="op" id="8583627">)</span><span class="op" id="8583628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8583632">}</span>&nbsp;<span class="keyword" id="8583634">else</span>&nbsp;<span class="keyword" id="8583639">if</span>&nbsp;<span class="op" id="8583642">!</span><span class="ident" id="8583643">strings</span><span class="op" id="8583650">.</span><span class="ident" id="8583651">HasPrefix</span><span class="op" id="8583660">(</span><span class="ident" id="8583661">tc</span><span class="op" id="8583663">.</span><span class="ident" id="8583664">source</span><span class="op" id="8583670">[</span><span class="ident" id="8583671">r</span><span class="op" id="8583672">:</span><span class="op" id="8583673">]</span><span class="op" id="8583674">,</span>&nbsp;<span class="ident" id="8583676">s</span><span class="op" id="8583677">)</span>&nbsp;<span class="op" id="8583679">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8583684">t</span><span class="op" id="8583685">.</span><span class="ident" id="8583686">Errorf</span><span class="op" id="8583692">(</span><span class="string" id="8583693">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="8583755">,</span>&nbsp;<span class="ident" id="8583757">tc</span><span class="op" id="8583759">.</span><span class="ident" id="8583760">name</span><span class="op" id="8583764">,</span>&nbsp;<span class="ident" id="8583766">s</span><span class="op" id="8583767">,</span>&nbsp;<span class="ident" id="8583769">i</span><span class="op" id="8583770">,</span>&nbsp;<span class="ident" id="8583772">n</span><span class="op" id="8583773">,</span>&nbsp;<span class="ident" id="8583775">r</span><span class="op" id="8583776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8583780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8583784">if</span>&nbsp;<span class="ident" id="8583787">i</span>&nbsp;<span class="op" id="8583789">&gt;</span>&nbsp;<span class="num" id="8583791">0</span>&nbsp;<span class="op" id="8583793">&amp;&amp;</span>&nbsp;<span class="ident" id="8583796">res</span><span class="op" id="8583799">[</span><span class="ident" id="8583800">i</span><span class="op" id="8583801">-</span><span class="num" id="8583802">1</span><span class="op" id="8583803">]</span>&nbsp;<span class="op" id="8583805">==</span>&nbsp;<span class="ident" id="8583808">r</span>&nbsp;<span class="op" id="8583810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8583815">t</span><span class="op" id="8583816">.</span><span class="ident" id="8583817">Errorf</span><span class="op" id="8583823">(</span><span class="string" id="8583824">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="8583890">,</span>&nbsp;<span class="ident" id="8583892">tc</span><span class="op" id="8583894">.</span><span class="ident" id="8583895">name</span><span class="op" id="8583899">,</span>&nbsp;<span class="ident" id="8583901">s</span><span class="op" id="8583902">,</span>&nbsp;<span class="ident" id="8583904">i</span><span class="op" id="8583905">,</span>&nbsp;<span class="ident" id="8583907">n</span><span class="op" id="8583908">,</span>&nbsp;<span class="ident" id="8583910">r</span><span class="op" id="8583911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8583915">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8583918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8583922">if</span>&nbsp;<span class="ident" id="8583925">n</span>&nbsp;<span class="op" id="8583927">&lt;</span>&nbsp;<span class="num" id="8583929">0</span>&nbsp;<span class="op" id="8583931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8583935">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8583996">for</span>&nbsp;<span class="ident" id="8584000">i</span><span class="op" id="8584001">,</span>&nbsp;<span class="ident" id="8584003">r</span>&nbsp;<span class="op" id="8584005">:=</span>&nbsp;<span class="keyword" id="8584008">range</span>&nbsp;<span class="ident" id="8584014">res</span>&nbsp;<span class="op" id="8584018">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8584023">e</span>&nbsp;<span class="op" id="8584025">:=</span>&nbsp;<span class="ident" id="8584028">exp</span><span class="op" id="8584031">[</span><span class="ident" id="8584032">i</span><span class="op" id="8584033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8584038">if</span>&nbsp;<span class="ident" id="8584041">r</span>&nbsp;<span class="op" id="8584043">!=</span>&nbsp;<span class="ident" id="8584046">e</span>&nbsp;<span class="op" id="8584048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8584054">t</span><span class="op" id="8584055">.</span><span class="ident" id="8584056">Errorf</span><span class="op" id="8584062">(</span><span class="string" id="8584063">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8584121">,</span>&nbsp;<span class="ident" id="8584123">tc</span><span class="op" id="8584125">.</span><span class="ident" id="8584126">name</span><span class="op" id="8584130">,</span>&nbsp;<span class="ident" id="8584132">s</span><span class="op" id="8584133">,</span>&nbsp;<span class="ident" id="8584135">i</span><span class="op" id="8584136">,</span>&nbsp;<span class="ident" id="8584138">e</span><span class="op" id="8584139">,</span>&nbsp;<span class="ident" id="8584141">r</span><span class="op" id="8584142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8584147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8584151">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8584154">}</span><br>
<span class="lineno"></span><span class="op" id="8584156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8584159">func</span>&nbsp;<span class="ident" id="8584164">testFindAllIndex</span><span class="op" id="8584180">(</span><span class="ident" id="8584181">t</span>&nbsp;<span class="op" id="8584183">*</span><span class="ident" id="8584184">testing</span><span class="op" id="8584191">.</span><span class="ident" id="8584192">T</span><span class="op" id="8584193">,</span>&nbsp;<span class="ident" id="8584195">tc</span>&nbsp;<span class="op" id="8584198">*</span><span class="ident" id="8584199">testCase</span><span class="op" id="8584207">,</span>&nbsp;<span class="ident" id="8584209">x</span>&nbsp;<span class="op" id="8584211">*</span><span class="ident" id="8584212">Index</span><span class="op" id="8584217">,</span>&nbsp;<span class="ident" id="8584219">rx</span>&nbsp;<span class="op" id="8584222">*</span><span class="ident" id="8584223">regexp</span><span class="op" id="8584229">.</span><span class="ident" id="8584230">Regexp</span><span class="op" id="8584236">,</span>&nbsp;<span class="ident" id="8584238">n</span>&nbsp;<span class="builtintype" id="8584240">int</span><span class="op" id="8584243">)</span>&nbsp;<span class="op" id="8584245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8584248">res</span>&nbsp;<span class="op" id="8584252">:=</span>&nbsp;<span class="ident" id="8584255">x</span><span class="op" id="8584256">.</span><span class="ident" id="8584257">FindAllIndex</span><span class="op" id="8584269">(</span><span class="ident" id="8584270">rx</span><span class="op" id="8584272">,</span>&nbsp;<span class="ident" id="8584274">n</span><span class="op" id="8584275">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8584278">exp</span>&nbsp;<span class="op" id="8584282">:=</span>&nbsp;<span class="ident" id="8584285">rx</span><span class="op" id="8584287">.</span><span class="ident" id="8584288">FindAllStringIndex</span><span class="op" id="8584306">(</span><span class="ident" id="8584307">tc</span><span class="op" id="8584309">.</span><span class="ident" id="8584310">source</span><span class="op" id="8584316">,</span>&nbsp;<span class="ident" id="8584318">n</span><span class="op" id="8584319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8584323">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8584356">if</span>&nbsp;<span class="builtinfunc" id="8584359">len</span><span class="op" id="8584362">(</span><span class="ident" id="8584363">res</span><span class="op" id="8584366">)</span>&nbsp;<span class="op" id="8584368">!=</span>&nbsp;<span class="builtinfunc" id="8584371">len</span><span class="op" id="8584374">(</span><span class="ident" id="8584375">exp</span><span class="op" id="8584378">)</span>&nbsp;<span class="op" id="8584380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8584384">t</span><span class="op" id="8584385">.</span><span class="ident" id="8584386">Errorf</span><span class="op" id="8584392">(</span><span class="string" id="8584393">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8584457">,</span>&nbsp;<span class="ident" id="8584459">tc</span><span class="op" id="8584461">.</span><span class="ident" id="8584462">name</span><span class="op" id="8584466">,</span>&nbsp;<span class="ident" id="8584468">rx</span><span class="op" id="8584470">,</span>&nbsp;<span class="ident" id="8584472">n</span><span class="op" id="8584473">,</span>&nbsp;<span class="builtinfunc" id="8584475">len</span><span class="op" id="8584478">(</span><span class="ident" id="8584479">exp</span><span class="op" id="8584482">)</span><span class="op" id="8584483">,</span>&nbsp;<span class="builtinfunc" id="8584485">len</span><span class="op" id="8584488">(</span><span class="ident" id="8584489">res</span><span class="op" id="8584492">)</span><span class="op" id="8584493">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8584496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8584500">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8584576">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8584654">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8584732">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8584797">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8584876">for</span>&nbsp;<span class="ident" id="8584880">i</span><span class="op" id="8584881">,</span>&nbsp;<span class="ident" id="8584883">r</span>&nbsp;<span class="op" id="8584885">:=</span>&nbsp;<span class="keyword" id="8584888">range</span>&nbsp;<span class="ident" id="8584894">res</span>&nbsp;<span class="op" id="8584898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8584902">if</span>&nbsp;<span class="ident" id="8584905">r</span><span class="op" id="8584906">[</span><span class="num" id="8584907">0</span><span class="op" id="8584908">]</span>&nbsp;<span class="op" id="8584910">&lt;</span>&nbsp;<span class="num" id="8584912">0</span>&nbsp;<span class="op" id="8584914">||</span>&nbsp;<span class="ident" id="8584917">r</span><span class="op" id="8584918">[</span><span class="num" id="8584919">0</span><span class="op" id="8584920">]</span>&nbsp;<span class="op" id="8584922">&gt;</span>&nbsp;<span class="ident" id="8584924">r</span><span class="op" id="8584925">[</span><span class="num" id="8584926">1</span><span class="op" id="8584927">]</span>&nbsp;<span class="op" id="8584929">||</span>&nbsp;<span class="builtinfunc" id="8584932">len</span><span class="op" id="8584935">(</span><span class="ident" id="8584936">tc</span><span class="op" id="8584938">.</span><span class="ident" id="8584939">source</span><span class="op" id="8584945">)</span>&nbsp;<span class="op" id="8584947">&lt;</span>&nbsp;<span class="ident" id="8584949">r</span><span class="op" id="8584950">[</span><span class="num" id="8584951">1</span><span class="op" id="8584952">]</span>&nbsp;<span class="op" id="8584954">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8584959">t</span><span class="op" id="8584960">.</span><span class="ident" id="8584961">Errorf</span><span class="op" id="8584967">(</span><span class="string" id="8584968">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="8585039">,</span>&nbsp;<span class="ident" id="8585041">tc</span><span class="op" id="8585043">.</span><span class="ident" id="8585044">name</span><span class="op" id="8585048">,</span>&nbsp;<span class="ident" id="8585050">rx</span><span class="op" id="8585052">,</span>&nbsp;<span class="ident" id="8585054">i</span><span class="op" id="8585055">,</span>&nbsp;<span class="ident" id="8585057">n</span><span class="op" id="8585058">,</span>&nbsp;<span class="ident" id="8585060">r</span><span class="op" id="8585061">[</span><span class="num" id="8585062">0</span><span class="op" id="8585063">]</span><span class="op" id="8585064">,</span>&nbsp;<span class="ident" id="8585066">r</span><span class="op" id="8585067">[</span><span class="num" id="8585068">1</span><span class="op" id="8585069">]</span><span class="op" id="8585070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585074">}</span>&nbsp;<span class="keyword" id="8585076">else</span>&nbsp;<span class="keyword" id="8585081">if</span>&nbsp;<span class="op" id="8585084">!</span><span class="ident" id="8585085">rx</span><span class="op" id="8585087">.</span><span class="ident" id="8585088">MatchString</span><span class="op" id="8585099">(</span><span class="ident" id="8585100">tc</span><span class="op" id="8585102">.</span><span class="ident" id="8585103">source</span><span class="op" id="8585109">[</span><span class="ident" id="8585110">r</span><span class="op" id="8585111">[</span><span class="num" id="8585112">0</span><span class="op" id="8585113">]</span><span class="op" id="8585114">:</span><span class="ident" id="8585115">r</span><span class="op" id="8585116">[</span><span class="num" id="8585117">1</span><span class="op" id="8585118">]</span><span class="op" id="8585119">]</span><span class="op" id="8585120">)</span>&nbsp;<span class="op" id="8585122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8585127">t</span><span class="op" id="8585128">.</span><span class="ident" id="8585129">Errorf</span><span class="op" id="8585135">(</span><span class="string" id="8585136">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="8585204">,</span>&nbsp;<span class="ident" id="8585206">tc</span><span class="op" id="8585208">.</span><span class="ident" id="8585209">name</span><span class="op" id="8585213">,</span>&nbsp;<span class="ident" id="8585215">rx</span><span class="op" id="8585217">,</span>&nbsp;<span class="ident" id="8585219">i</span><span class="op" id="8585220">,</span>&nbsp;<span class="ident" id="8585222">n</span><span class="op" id="8585223">,</span>&nbsp;<span class="ident" id="8585225">r</span><span class="op" id="8585226">[</span><span class="num" id="8585227">0</span><span class="op" id="8585228">]</span><span class="op" id="8585229">,</span>&nbsp;<span class="ident" id="8585231">r</span><span class="op" id="8585232">[</span><span class="num" id="8585233">1</span><span class="op" id="8585234">]</span><span class="op" id="8585235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585242">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8585246">if</span>&nbsp;<span class="ident" id="8585249">n</span>&nbsp;<span class="op" id="8585251">&lt;</span>&nbsp;<span class="num" id="8585253">0</span>&nbsp;<span class="op" id="8585255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8585259">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8585320">for</span>&nbsp;<span class="ident" id="8585324">i</span><span class="op" id="8585325">,</span>&nbsp;<span class="ident" id="8585327">r</span>&nbsp;<span class="op" id="8585329">:=</span>&nbsp;<span class="keyword" id="8585332">range</span>&nbsp;<span class="ident" id="8585338">res</span>&nbsp;<span class="op" id="8585342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8585347">e</span>&nbsp;<span class="op" id="8585349">:=</span>&nbsp;<span class="ident" id="8585352">exp</span><span class="op" id="8585355">[</span><span class="ident" id="8585356">i</span><span class="op" id="8585357">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8585362">if</span>&nbsp;<span class="ident" id="8585365">r</span><span class="op" id="8585366">[</span><span class="num" id="8585367">0</span><span class="op" id="8585368">]</span>&nbsp;<span class="op" id="8585370">!=</span>&nbsp;<span class="ident" id="8585373">e</span><span class="op" id="8585374">[</span><span class="num" id="8585375">0</span><span class="op" id="8585376">]</span>&nbsp;<span class="op" id="8585378">||</span>&nbsp;<span class="ident" id="8585381">r</span><span class="op" id="8585382">[</span><span class="num" id="8585383">1</span><span class="op" id="8585384">]</span>&nbsp;<span class="op" id="8585386">!=</span>&nbsp;<span class="ident" id="8585389">e</span><span class="op" id="8585390">[</span><span class="num" id="8585391">1</span><span class="op" id="8585392">]</span>&nbsp;<span class="op" id="8585394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8585400">t</span><span class="op" id="8585401">.</span><span class="ident" id="8585402">Errorf</span><span class="op" id="8585408">(</span><span class="string" id="8585409">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="8585485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8585492">tc</span><span class="op" id="8585494">.</span><span class="ident" id="8585495">name</span><span class="op" id="8585499">,</span>&nbsp;<span class="ident" id="8585501">rx</span><span class="op" id="8585503">,</span>&nbsp;<span class="ident" id="8585505">i</span><span class="op" id="8585506">,</span>&nbsp;<span class="ident" id="8585508">e</span><span class="op" id="8585509">[</span><span class="num" id="8585510">0</span><span class="op" id="8585511">]</span><span class="op" id="8585512">,</span>&nbsp;<span class="ident" id="8585514">e</span><span class="op" id="8585515">[</span><span class="num" id="8585516">1</span><span class="op" id="8585517">]</span><span class="op" id="8585518">,</span>&nbsp;<span class="ident" id="8585520">r</span><span class="op" id="8585521">[</span><span class="num" id="8585522">0</span><span class="op" id="8585523">]</span><span class="op" id="8585524">,</span>&nbsp;<span class="ident" id="8585526">r</span><span class="op" id="8585527">[</span><span class="num" id="8585528">1</span><span class="op" id="8585529">]</span><span class="op" id="8585530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585539">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585542">}</span><br>
<span class="lineno"></span><span class="op" id="8585544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8585547">func</span>&nbsp;<span class="ident" id="8585552">testLookups</span><span class="op" id="8585563">(</span><span class="ident" id="8585564">t</span>&nbsp;<span class="op" id="8585566">*</span><span class="ident" id="8585567">testing</span><span class="op" id="8585574">.</span><span class="ident" id="8585575">T</span><span class="op" id="8585576">,</span>&nbsp;<span class="ident" id="8585578">tc</span>&nbsp;<span class="op" id="8585581">*</span><span class="ident" id="8585582">testCase</span><span class="op" id="8585590">,</span>&nbsp;<span class="ident" id="8585592">x</span>&nbsp;<span class="op" id="8585594">*</span><span class="ident" id="8585595">Index</span><span class="op" id="8585600">,</span>&nbsp;<span class="ident" id="8585602">n</span>&nbsp;<span class="builtintype" id="8585604">int</span><span class="op" id="8585607">)</span>&nbsp;<span class="op" id="8585609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8585612">for</span>&nbsp;<span class="ident" id="8585616">_</span><span class="op" id="8585617">,</span>&nbsp;<span class="ident" id="8585619">pat</span>&nbsp;<span class="op" id="8585623">:=</span>&nbsp;<span class="keyword" id="8585626">range</span>&nbsp;<span class="ident" id="8585632">tc</span><span class="op" id="8585634">.</span><span class="ident" id="8585635">patterns</span>&nbsp;<span class="op" id="8585644">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8585648">testLookup</span><span class="op" id="8585658">(</span><span class="ident" id="8585659">t</span><span class="op" id="8585660">,</span>&nbsp;<span class="ident" id="8585662">tc</span><span class="op" id="8585664">,</span>&nbsp;<span class="ident" id="8585666">x</span><span class="op" id="8585667">,</span>&nbsp;<span class="ident" id="8585669">pat</span><span class="op" id="8585672">,</span>&nbsp;<span class="ident" id="8585674">n</span><span class="op" id="8585675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8585679">if</span>&nbsp;<span class="ident" id="8585682">rx</span><span class="op" id="8585684">,</span>&nbsp;<span class="ident" id="8585686">err</span>&nbsp;<span class="op" id="8585690">:=</span>&nbsp;<span class="ident" id="8585693">regexp</span><span class="op" id="8585699">.</span><span class="ident" id="8585700">Compile</span><span class="op" id="8585707">(</span><span class="ident" id="8585708">pat</span><span class="op" id="8585711">)</span><span class="op" id="8585712">;</span>&nbsp;<span class="ident" id="8585714">err</span>&nbsp;<span class="op" id="8585718">==</span>&nbsp;<span class="ident" id="8585721">nil</span>&nbsp;<span class="op" id="8585725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8585730">testFindAllIndex</span><span class="op" id="8585746">(</span><span class="ident" id="8585747">t</span><span class="op" id="8585748">,</span>&nbsp;<span class="ident" id="8585750">tc</span><span class="op" id="8585752">,</span>&nbsp;<span class="ident" id="8585754">x</span><span class="op" id="8585755">,</span>&nbsp;<span class="ident" id="8585757">rx</span><span class="op" id="8585759">,</span>&nbsp;<span class="ident" id="8585761">n</span><span class="op" id="8585762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8585769">}</span><br>
<span class="lineno">205</span><span class="op" id="8585771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8585774">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="8585818">type</span>&nbsp;<span class="ident" id="8585823">index</span>&nbsp;<span class="ident" id="8585829">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="8585836">func</span>&nbsp;<span class="op" id="8585841">(</span><span class="ident" id="8585842">x</span>&nbsp;<span class="op" id="8585844">*</span><span class="ident" id="8585845">index</span><span class="op" id="8585850">)</span>&nbsp;<span class="ident" id="8585852">Len</span><span class="op" id="8585855">(</span><span class="op" id="8585856">)</span>&nbsp;<span class="builtintype" id="8585858">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8585872">{</span>&nbsp;<span class="keyword" id="8585874">return</span>&nbsp;<span class="builtinfunc" id="8585881">len</span><span class="op" id="8585884">(</span><span class="ident" id="8585885">x</span><span class="op" id="8585886">.</span><span class="ident" id="8585887">sa</span><span class="op" id="8585889">)</span>&nbsp;<span class="op" id="8585891">}</span><br>
<span class="lineno"></span><span class="keyword" id="8585893">func</span>&nbsp;<span class="op" id="8585898">(</span><span class="ident" id="8585899">x</span>&nbsp;<span class="op" id="8585901">*</span><span class="ident" id="8585902">index</span><span class="op" id="8585907">)</span>&nbsp;<span class="ident" id="8585909">Less</span><span class="op" id="8585913">(</span><span class="ident" id="8585914">i</span><span class="op" id="8585915">,</span>&nbsp;<span class="ident" id="8585917">j</span>&nbsp;<span class="builtintype" id="8585919">int</span><span class="op" id="8585922">)</span>&nbsp;<span class="builtintype" id="8585924">bool</span>&nbsp;<span class="op" id="8585929">{</span>&nbsp;<span class="keyword" id="8585931">return</span>&nbsp;<span class="ident" id="8585938">bytes</span><span class="op" id="8585943">.</span><span class="ident" id="8585944">Compare</span><span class="op" id="8585951">(</span><span class="ident" id="8585952">x</span><span class="op" id="8585953">.</span><span class="ident" id="8585954">at</span><span class="op" id="8585956">(</span><span class="ident" id="8585957">i</span><span class="op" id="8585958">)</span><span class="op" id="8585959">,</span>&nbsp;<span class="ident" id="8585961">x</span><span class="op" id="8585962">.</span><span class="ident" id="8585963">at</span><span class="op" id="8585965">(</span><span class="ident" id="8585966">j</span><span class="op" id="8585967">)</span><span class="op" id="8585968">)</span>&nbsp;<span class="op" id="8585970">&lt;</span>&nbsp;<span class="num" id="8585972">0</span>&nbsp;<span class="op" id="8585974">}</span><br>
<span class="lineno"></span><span class="keyword" id="8585976">func</span>&nbsp;<span class="op" id="8585981">(</span><span class="ident" id="8585982">x</span>&nbsp;<span class="op" id="8585984">*</span><span class="ident" id="8585985">index</span><span class="op" id="8585990">)</span>&nbsp;<span class="ident" id="8585992">Swap</span><span class="op" id="8585996">(</span><span class="ident" id="8585997">i</span><span class="op" id="8585998">,</span>&nbsp;<span class="ident" id="8586000">j</span>&nbsp;<span class="builtintype" id="8586002">int</span><span class="op" id="8586005">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8586012">{</span>&nbsp;<span class="ident" id="8586014">x</span><span class="op" id="8586015">.</span><span class="ident" id="8586016">sa</span><span class="op" id="8586018">[</span><span class="ident" id="8586019">i</span><span class="op" id="8586020">]</span><span class="op" id="8586021">,</span>&nbsp;<span class="ident" id="8586023">x</span><span class="op" id="8586024">.</span><span class="ident" id="8586025">sa</span><span class="op" id="8586027">[</span><span class="ident" id="8586028">j</span><span class="op" id="8586029">]</span>&nbsp;<span class="op" id="8586031">=</span>&nbsp;<span class="ident" id="8586033">x</span><span class="op" id="8586034">.</span><span class="ident" id="8586035">sa</span><span class="op" id="8586037">[</span><span class="ident" id="8586038">j</span><span class="op" id="8586039">]</span><span class="op" id="8586040">,</span>&nbsp;<span class="ident" id="8586042">x</span><span class="op" id="8586043">.</span><span class="ident" id="8586044">sa</span><span class="op" id="8586046">[</span><span class="ident" id="8586047">i</span><span class="op" id="8586048">]</span>&nbsp;<span class="op" id="8586050">}</span><br>
<span class="lineno"></span><span class="keyword" id="8586052">func</span>&nbsp;<span class="op" id="8586057">(</span><span class="ident" id="8586058">a</span>&nbsp;<span class="op" id="8586060">*</span><span class="ident" id="8586061">index</span><span class="op" id="8586066">)</span>&nbsp;<span class="ident" id="8586068">at</span><span class="op" id="8586070">(</span><span class="ident" id="8586071">i</span>&nbsp;<span class="builtintype" id="8586073">int</span><span class="op" id="8586076">)</span>&nbsp;<span class="op" id="8586078">[</span><span class="op" id="8586079">]</span><span class="builtintype" id="8586080">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8586088">{</span>&nbsp;<span class="keyword" id="8586090">return</span>&nbsp;<span class="ident" id="8586097">a</span><span class="op" id="8586098">.</span><span class="ident" id="8586099">data</span><span class="op" id="8586103">[</span><span class="ident" id="8586104">a</span><span class="op" id="8586105">.</span><span class="ident" id="8586106">sa</span><span class="op" id="8586108">[</span><span class="ident" id="8586109">i</span><span class="op" id="8586110">]</span><span class="op" id="8586111">:</span><span class="op" id="8586112">]</span>&nbsp;<span class="op" id="8586114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8586117">func</span>&nbsp;<span class="ident" id="8586122">testConstruction</span><span class="op" id="8586138">(</span><span class="ident" id="8586139">t</span>&nbsp;<span class="op" id="8586141">*</span><span class="ident" id="8586142">testing</span><span class="op" id="8586149">.</span><span class="ident" id="8586150">T</span><span class="op" id="8586151">,</span>&nbsp;<span class="ident" id="8586153">tc</span>&nbsp;<span class="op" id="8586156">*</span><span class="ident" id="8586157">testCase</span><span class="op" id="8586165">,</span>&nbsp;<span class="ident" id="8586167">x</span>&nbsp;<span class="op" id="8586169">*</span><span class="ident" id="8586170">Index</span><span class="op" id="8586175">)</span>&nbsp;<span class="op" id="8586177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586180">if</span>&nbsp;<span class="op" id="8586183">!</span><span class="ident" id="8586184">sort</span><span class="op" id="8586188">.</span><span class="ident" id="8586189">IsSorted</span><span class="op" id="8586197">(</span><span class="op" id="8586198">(</span><span class="op" id="8586199">*</span><span class="ident" id="8586200">index</span><span class="op" id="8586205">)</span><span class="op" id="8586206">(</span><span class="ident" id="8586207">x</span><span class="op" id="8586208">)</span><span class="op" id="8586209">)</span>&nbsp;<span class="op" id="8586211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586215">t</span><span class="op" id="8586216">.</span><span class="ident" id="8586217">Errorf</span><span class="op" id="8586223">(</span><span class="string" id="8586224">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="8586252">,</span>&nbsp;<span class="ident" id="8586254">tc</span><span class="op" id="8586256">.</span><span class="ident" id="8586257">name</span><span class="op" id="8586261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586264">}</span><br>
<span class="lineno"></span><span class="op" id="8586266">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8586269">func</span>&nbsp;<span class="ident" id="8586274">equal</span><span class="op" id="8586279">(</span><span class="ident" id="8586280">x</span><span class="op" id="8586281">,</span>&nbsp;<span class="ident" id="8586283">y</span>&nbsp;<span class="op" id="8586285">*</span><span class="ident" id="8586286">Index</span><span class="op" id="8586291">)</span>&nbsp;<span class="builtintype" id="8586293">bool</span>&nbsp;<span class="op" id="8586298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586301">if</span>&nbsp;<span class="op" id="8586304">!</span><span class="ident" id="8586305">bytes</span><span class="op" id="8586310">.</span><span class="ident" id="8586311">Equal</span><span class="op" id="8586316">(</span><span class="ident" id="8586317">x</span><span class="op" id="8586318">.</span><span class="ident" id="8586319">data</span><span class="op" id="8586323">,</span>&nbsp;<span class="ident" id="8586325">y</span><span class="op" id="8586326">.</span><span class="ident" id="8586327">data</span><span class="op" id="8586331">)</span>&nbsp;<span class="op" id="8586333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586337">return</span>&nbsp;<span class="builtintype" id="8586344">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586351">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586354">for</span>&nbsp;<span class="ident" id="8586358">i</span><span class="op" id="8586359">,</span>&nbsp;<span class="ident" id="8586361">j</span>&nbsp;<span class="op" id="8586363">:=</span>&nbsp;<span class="keyword" id="8586366">range</span>&nbsp;<span class="ident" id="8586372">x</span><span class="op" id="8586373">.</span><span class="ident" id="8586374">sa</span>&nbsp;<span class="op" id="8586377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586381">if</span>&nbsp;<span class="ident" id="8586384">j</span>&nbsp;<span class="op" id="8586386">!=</span>&nbsp;<span class="ident" id="8586389">y</span><span class="op" id="8586390">.</span><span class="ident" id="8586391">sa</span><span class="op" id="8586393">[</span><span class="ident" id="8586394">i</span><span class="op" id="8586395">]</span>&nbsp;<span class="op" id="8586397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586402">return</span>&nbsp;<span class="builtintype" id="8586409">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586420">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586423">return</span>&nbsp;<span class="builtintype" id="8586430">true</span><br>
<span class="lineno"></span><span class="op" id="8586435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8586438">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="8586475">func</span>&nbsp;<span class="ident" id="8586480">testSaveRestore</span><span class="op" id="8586495">(</span><span class="ident" id="8586496">t</span>&nbsp;<span class="op" id="8586498">*</span><span class="ident" id="8586499">testing</span><span class="op" id="8586506">.</span><span class="ident" id="8586507">T</span><span class="op" id="8586508">,</span>&nbsp;<span class="ident" id="8586510">tc</span>&nbsp;<span class="op" id="8586513">*</span><span class="ident" id="8586514">testCase</span><span class="op" id="8586522">,</span>&nbsp;<span class="ident" id="8586524">x</span>&nbsp;<span class="op" id="8586526">*</span><span class="ident" id="8586527">Index</span><span class="op" id="8586532">)</span>&nbsp;<span class="builtintype" id="8586534">int</span>&nbsp;<span class="op" id="8586538">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586541">var</span>&nbsp;<span class="ident" id="8586545">buf</span>&nbsp;<span class="ident" id="8586549">bytes</span><span class="op" id="8586554">.</span><span class="ident" id="8586555">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586563">if</span>&nbsp;<span class="ident" id="8586566">err</span>&nbsp;<span class="op" id="8586570">:=</span>&nbsp;<span class="ident" id="8586573">x</span><span class="op" id="8586574">.</span><span class="ident" id="8586575">Write</span><span class="op" id="8586580">(</span><span class="op" id="8586581">&amp;</span><span class="ident" id="8586582">buf</span><span class="op" id="8586585">)</span><span class="op" id="8586586">;</span>&nbsp;<span class="ident" id="8586588">err</span>&nbsp;<span class="op" id="8586592">!=</span>&nbsp;<span class="ident" id="8586595">nil</span>&nbsp;<span class="op" id="8586599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586603">t</span><span class="op" id="8586604">.</span><span class="ident" id="8586605">Errorf</span><span class="op" id="8586611">(</span><span class="string" id="8586612">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="8586642">,</span>&nbsp;<span class="ident" id="8586644">tc</span><span class="op" id="8586646">.</span><span class="ident" id="8586647">name</span><span class="op" id="8586651">,</span>&nbsp;<span class="ident" id="8586653">err</span><span class="op" id="8586656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586662">size</span>&nbsp;<span class="op" id="8586667">:=</span>&nbsp;<span class="ident" id="8586670">buf</span><span class="op" id="8586673">.</span><span class="ident" id="8586674">Len</span><span class="op" id="8586677">(</span><span class="op" id="8586678">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586681">var</span>&nbsp;<span class="ident" id="8586685">y</span>&nbsp;<span class="ident" id="8586687">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586694">if</span>&nbsp;<span class="ident" id="8586697">err</span>&nbsp;<span class="op" id="8586701">:=</span>&nbsp;<span class="ident" id="8586704">y</span><span class="op" id="8586705">.</span><span class="ident" id="8586706">Read</span><span class="op" id="8586710">(</span><span class="op" id="8586711">&amp;</span><span class="ident" id="8586712">buf</span><span class="op" id="8586715">)</span><span class="op" id="8586716">;</span>&nbsp;<span class="ident" id="8586718">err</span>&nbsp;<span class="op" id="8586722">!=</span>&nbsp;<span class="ident" id="8586725">nil</span>&nbsp;<span class="op" id="8586729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586733">t</span><span class="op" id="8586734">.</span><span class="ident" id="8586735">Errorf</span><span class="op" id="8586741">(</span><span class="string" id="8586742">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="8586772">,</span>&nbsp;<span class="ident" id="8586774">tc</span><span class="op" id="8586776">.</span><span class="ident" id="8586777">name</span><span class="op" id="8586781">,</span>&nbsp;<span class="ident" id="8586783">err</span><span class="op" id="8586786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586792">if</span>&nbsp;<span class="op" id="8586795">!</span><span class="ident" id="8586796">equal</span><span class="op" id="8586801">(</span><span class="ident" id="8586802">x</span><span class="op" id="8586803">,</span>&nbsp;<span class="op" id="8586805">&amp;</span><span class="ident" id="8586806">y</span><span class="op" id="8586807">)</span>&nbsp;<span class="op" id="8586809">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586813">t</span><span class="op" id="8586814">.</span><span class="ident" id="8586815">Errorf</span><span class="op" id="8586821">(</span><span class="string" id="8586822">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="8586867">,</span>&nbsp;<span class="ident" id="8586869">tc</span><span class="op" id="8586871">.</span><span class="ident" id="8586872">name</span><span class="op" id="8586876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8586879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586882">return</span>&nbsp;<span class="ident" id="8586889">size</span><br>
<span class="lineno"></span><span class="op" id="8586894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="8586897">func</span>&nbsp;<span class="ident" id="8586902">TestIndex</span><span class="op" id="8586911">(</span><span class="ident" id="8586912">t</span>&nbsp;<span class="op" id="8586914">*</span><span class="ident" id="8586915">testing</span><span class="op" id="8586922">.</span><span class="ident" id="8586923">T</span><span class="op" id="8586924">)</span>&nbsp;<span class="op" id="8586926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8586929">for</span>&nbsp;<span class="ident" id="8586933">_</span><span class="op" id="8586934">,</span>&nbsp;<span class="ident" id="8586936">tc</span>&nbsp;<span class="op" id="8586939">:=</span>&nbsp;<span class="keyword" id="8586942">range</span>&nbsp;<span class="ident" id="8586948">testCases</span>&nbsp;<span class="op" id="8586958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586962">x</span>&nbsp;<span class="op" id="8586964">:=</span>&nbsp;<span class="ident" id="8586967">New</span><span class="op" id="8586970">(</span><span class="op" id="8586971">[</span><span class="op" id="8586972">]</span><span class="builtintype" id="8586973">byte</span><span class="op" id="8586977">(</span><span class="ident" id="8586978">tc</span><span class="op" id="8586980">.</span><span class="ident" id="8586981">source</span><span class="op" id="8586987">)</span><span class="op" id="8586988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8586992">testConstruction</span><span class="op" id="8587008">(</span><span class="ident" id="8587009">t</span><span class="op" id="8587010">,</span>&nbsp;<span class="op" id="8587012">&amp;</span><span class="ident" id="8587013">tc</span><span class="op" id="8587015">,</span>&nbsp;<span class="ident" id="8587017">x</span><span class="op" id="8587018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587022">testSaveRestore</span><span class="op" id="8587037">(</span><span class="ident" id="8587038">t</span><span class="op" id="8587039">,</span>&nbsp;<span class="op" id="8587041">&amp;</span><span class="ident" id="8587042">tc</span><span class="op" id="8587044">,</span>&nbsp;<span class="ident" id="8587046">x</span><span class="op" id="8587047">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587051">testLookups</span><span class="op" id="8587062">(</span><span class="ident" id="8587063">t</span><span class="op" id="8587064">,</span>&nbsp;<span class="op" id="8587066">&amp;</span><span class="ident" id="8587067">tc</span><span class="op" id="8587069">,</span>&nbsp;<span class="ident" id="8587071">x</span><span class="op" id="8587072">,</span>&nbsp;<span class="num" id="8587074">0</span><span class="op" id="8587075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587079">testLookups</span><span class="op" id="8587090">(</span><span class="ident" id="8587091">t</span><span class="op" id="8587092">,</span>&nbsp;<span class="op" id="8587094">&amp;</span><span class="ident" id="8587095">tc</span><span class="op" id="8587097">,</span>&nbsp;<span class="ident" id="8587099">x</span><span class="op" id="8587100">,</span>&nbsp;<span class="num" id="8587102">1</span><span class="op" id="8587103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587107">testLookups</span><span class="op" id="8587118">(</span><span class="ident" id="8587119">t</span><span class="op" id="8587120">,</span>&nbsp;<span class="op" id="8587122">&amp;</span><span class="ident" id="8587123">tc</span><span class="op" id="8587125">,</span>&nbsp;<span class="ident" id="8587127">x</span><span class="op" id="8587128">,</span>&nbsp;<span class="num" id="8587130">10</span><span class="op" id="8587132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587136">testLookups</span><span class="op" id="8587147">(</span><span class="ident" id="8587148">t</span><span class="op" id="8587149">,</span>&nbsp;<span class="op" id="8587151">&amp;</span><span class="ident" id="8587152">tc</span><span class="op" id="8587154">,</span>&nbsp;<span class="ident" id="8587156">x</span><span class="op" id="8587157">,</span>&nbsp;<span class="num" id="8587159">2e9</span><span class="op" id="8587162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587166">testLookups</span><span class="op" id="8587177">(</span><span class="ident" id="8587178">t</span><span class="op" id="8587179">,</span>&nbsp;<span class="op" id="8587181">&amp;</span><span class="ident" id="8587182">tc</span><span class="op" id="8587184">,</span>&nbsp;<span class="ident" id="8587186">x</span><span class="op" id="8587187">,</span>&nbsp;<span class="op" id="8587189">-</span><span class="num" id="8587190">1</span><span class="op" id="8587191">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8587194">}</span><br>
<span class="lineno"></span><span class="op" id="8587196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8587199">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="8587278">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="8587352">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="8587414">func</span>&nbsp;<span class="ident" id="8587419">benchmarkNew</span><span class="op" id="8587431">(</span><span class="ident" id="8587432">b</span>&nbsp;<span class="op" id="8587434">*</span><span class="ident" id="8587435">testing</span><span class="op" id="8587442">.</span><span class="ident" id="8587443">B</span><span class="op" id="8587444">,</span>&nbsp;<span class="ident" id="8587446">random</span>&nbsp;<span class="builtintype" id="8587453">bool</span><span class="op" id="8587457">)</span>&nbsp;<span class="op" id="8587459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587462">b</span><span class="op" id="8587463">.</span><span class="ident" id="8587464">StopTimer</span><span class="op" id="8587473">(</span><span class="op" id="8587474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587477">data</span>&nbsp;<span class="op" id="8587482">:=</span>&nbsp;<span class="builtinfunc" id="8587485">make</span><span class="op" id="8587489">(</span><span class="op" id="8587490">[</span><span class="op" id="8587491">]</span><span class="builtintype" id="8587492">byte</span><span class="op" id="8587496">,</span>&nbsp;<span class="num" id="8587498">1e6</span><span class="op" id="8587501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8587504">if</span>&nbsp;<span class="ident" id="8587507">random</span>&nbsp;<span class="op" id="8587514">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8587518">for</span>&nbsp;<span class="ident" id="8587522">i</span>&nbsp;<span class="op" id="8587524">:=</span>&nbsp;<span class="keyword" id="8587527">range</span>&nbsp;<span class="ident" id="8587533">data</span>&nbsp;<span class="op" id="8587538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587543">data</span><span class="op" id="8587547">[</span><span class="ident" id="8587548">i</span><span class="op" id="8587549">]</span>&nbsp;<span class="op" id="8587551">=</span>&nbsp;<span class="builtintype" id="8587553">byte</span><span class="op" id="8587557">(</span><span class="ident" id="8587558">rand</span><span class="op" id="8587562">.</span><span class="ident" id="8587563">Intn</span><span class="op" id="8587567">(</span><span class="num" id="8587568">256</span><span class="op" id="8587571">)</span><span class="op" id="8587572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8587576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8587579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587582">b</span><span class="op" id="8587583">.</span><span class="ident" id="8587584">StartTimer</span><span class="op" id="8587594">(</span><span class="op" id="8587595">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8587598">for</span>&nbsp;<span class="ident" id="8587602">i</span>&nbsp;<span class="op" id="8587604">:=</span>&nbsp;<span class="num" id="8587607">0</span><span class="op" id="8587608">;</span>&nbsp;<span class="ident" id="8587610">i</span>&nbsp;<span class="op" id="8587612">&lt;</span>&nbsp;<span class="ident" id="8587614">b</span><span class="op" id="8587615">.</span><span class="ident" id="8587616">N</span><span class="op" id="8587617">;</span>&nbsp;<span class="ident" id="8587619">i</span><span class="op" id="8587620">++</span>&nbsp;<span class="op" id="8587623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587627">New</span><span class="op" id="8587630">(</span><span class="ident" id="8587631">data</span><span class="op" id="8587635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8587638">}</span><br>
<span class="lineno"></span><span class="op" id="8587640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8587643">func</span>&nbsp;<span class="ident" id="8587648">BenchmarkNewIndexRandom</span><span class="op" id="8587671">(</span><span class="ident" id="8587672">b</span>&nbsp;<span class="op" id="8587674">*</span><span class="ident" id="8587675">testing</span><span class="op" id="8587682">.</span><span class="ident" id="8587683">B</span><span class="op" id="8587684">)</span>&nbsp;<span class="op" id="8587686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587689">benchmarkNew</span><span class="op" id="8587701">(</span><span class="ident" id="8587702">b</span><span class="op" id="8587703">,</span>&nbsp;<span class="builtintype" id="8587705">true</span><span class="op" id="8587709">)</span><br>
<span class="lineno"></span><span class="op" id="8587711">}</span><br>
<span class="lineno"></span><span class="keyword" id="8587713">func</span>&nbsp;<span class="ident" id="8587718">BenchmarkNewIndexRepeat</span><span class="op" id="8587741">(</span><span class="ident" id="8587742">b</span>&nbsp;<span class="op" id="8587744">*</span><span class="ident" id="8587745">testing</span><span class="op" id="8587752">.</span><span class="ident" id="8587753">B</span><span class="op" id="8587754">)</span>&nbsp;<span class="op" id="8587756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587759">benchmarkNew</span><span class="op" id="8587771">(</span><span class="ident" id="8587772">b</span><span class="op" id="8587773">,</span>&nbsp;<span class="builtintype" id="8587775">false</span><span class="op" id="8587780">)</span><br>
<span class="lineno">285</span><span class="op" id="8587782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8587785">func</span>&nbsp;<span class="ident" id="8587790">BenchmarkSaveRestore</span><span class="op" id="8587810">(</span><span class="ident" id="8587811">b</span>&nbsp;<span class="op" id="8587813">*</span><span class="ident" id="8587814">testing</span><span class="op" id="8587821">.</span><span class="ident" id="8587822">B</span><span class="op" id="8587823">)</span>&nbsp;<span class="op" id="8587825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587828">b</span><span class="op" id="8587829">.</span><span class="ident" id="8587830">StopTimer</span><span class="op" id="8587839">(</span><span class="op" id="8587840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587843">r</span>&nbsp;<span class="op" id="8587845">:=</span>&nbsp;<span class="ident" id="8587848">rand</span><span class="op" id="8587852">.</span><span class="ident" id="8587853">New</span><span class="op" id="8587856">(</span><span class="ident" id="8587857">rand</span><span class="op" id="8587861">.</span><span class="ident" id="8587862">NewSource</span><span class="op" id="8587871">(</span><span class="num" id="8587872">0x5a77a1</span><span class="op" id="8587880">)</span><span class="op" id="8587881">)</span>&nbsp;<span class="comment" id="8587883">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8587918">data</span>&nbsp;<span class="op" id="8587923">:=</span>&nbsp;<span class="builtinfunc" id="8587926">make</span><span class="op" id="8587930">(</span><span class="op" id="8587931">[</span><span class="op" id="8587932">]</span><span class="builtintype" id="8587933">byte</span><span class="op" id="8587937">,</span>&nbsp;<span class="num" id="8587939">1</span><span class="op" id="8587940">&lt;&lt;</span><span class="num" id="8587942">20</span><span class="op" id="8587944">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8587958">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8587983">for</span>&nbsp;<span class="ident" id="8587987">i</span>&nbsp;<span class="op" id="8587989">:=</span>&nbsp;<span class="keyword" id="8587992">range</span>&nbsp;<span class="ident" id="8587998">data</span>&nbsp;<span class="op" id="8588003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588007">data</span><span class="op" id="8588011">[</span><span class="ident" id="8588012">i</span><span class="op" id="8588013">]</span>&nbsp;<span class="op" id="8588015">=</span>&nbsp;<span class="builtintype" id="8588017">byte</span><span class="op" id="8588021">(</span><span class="ident" id="8588022">r</span><span class="op" id="8588023">.</span><span class="ident" id="8588024">Intn</span><span class="op" id="8588028">(</span><span class="num" id="8588029">256</span><span class="op" id="8588032">)</span><span class="op" id="8588033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8588036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588039">x</span>&nbsp;<span class="op" id="8588041">:=</span>&nbsp;<span class="ident" id="8588044">New</span><span class="op" id="8588047">(</span><span class="ident" id="8588048">data</span><span class="op" id="8588052">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588055">size</span>&nbsp;<span class="op" id="8588060">:=</span>&nbsp;<span class="ident" id="8588063">testSaveRestore</span><span class="op" id="8588078">(</span><span class="ident" id="8588079">nil</span><span class="op" id="8588082">,</span>&nbsp;<span class="ident" id="8588084">nil</span><span class="op" id="8588087">,</span>&nbsp;<span class="ident" id="8588089">x</span><span class="op" id="8588090">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8588098">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588121">buf</span>&nbsp;<span class="op" id="8588125">:=</span>&nbsp;<span class="ident" id="8588128">bytes</span><span class="op" id="8588133">.</span><span class="ident" id="8588134">NewBuffer</span><span class="op" id="8588143">(</span><span class="builtinfunc" id="8588144">make</span><span class="op" id="8588148">(</span><span class="op" id="8588149">[</span><span class="op" id="8588150">]</span><span class="builtintype" id="8588151">byte</span><span class="op" id="8588155">,</span>&nbsp;<span class="ident" id="8588157">size</span><span class="op" id="8588161">)</span><span class="op" id="8588162">)</span>&nbsp;<span class="comment" id="8588164">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588182">b</span><span class="op" id="8588183">.</span><span class="ident" id="8588184">SetBytes</span><span class="op" id="8588192">(</span><span class="ident" id="8588193">int64</span><span class="op" id="8588198">(</span><span class="ident" id="8588199">size</span><span class="op" id="8588203">)</span><span class="op" id="8588204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588207">b</span><span class="op" id="8588208">.</span><span class="ident" id="8588209">StartTimer</span><span class="op" id="8588219">(</span><span class="op" id="8588220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8588223">for</span>&nbsp;<span class="ident" id="8588227">i</span>&nbsp;<span class="op" id="8588229">:=</span>&nbsp;<span class="num" id="8588232">0</span><span class="op" id="8588233">;</span>&nbsp;<span class="ident" id="8588235">i</span>&nbsp;<span class="op" id="8588237">&lt;</span>&nbsp;<span class="ident" id="8588239">b</span><span class="op" id="8588240">.</span><span class="ident" id="8588241">N</span><span class="op" id="8588242">;</span>&nbsp;<span class="ident" id="8588244">i</span><span class="op" id="8588245">++</span>&nbsp;<span class="op" id="8588248">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588252">x</span><span class="op" id="8588253">.</span><span class="ident" id="8588254">Write</span><span class="op" id="8588259">(</span><span class="ident" id="8588260">buf</span><span class="op" id="8588263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8588267">var</span>&nbsp;<span class="ident" id="8588271">y</span>&nbsp;<span class="ident" id="8588273">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8588281">y</span><span class="op" id="8588282">.</span><span class="ident" id="8588283">Read</span><span class="op" id="8588287">(</span><span class="ident" id="8588288">buf</span><span class="op" id="8588291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8588294">}</span><br>
<span class="lineno"></span><span class="op" id="8588296">}</span>
</div>
</body>
</html>
