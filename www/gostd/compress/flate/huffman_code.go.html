<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html" class="current">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5024026">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5024081">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5024135">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5024186">package</span>&nbsp;<span class="ident" id="5024194">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024201">import</span>&nbsp;<span class="op" id="5024208">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5024211">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5024219">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5024226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024229">type</span>&nbsp;<span class="ident" id="5024234">huffmanEncoder</span>&nbsp;<span class="keyword" id="5024249">struct</span>&nbsp;<span class="op" id="5024256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024259">codeBits</span>&nbsp;<span class="op" id="5024268">[</span><span class="op" id="5024269">]</span><span class="builtintype" id="5024270">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024277">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5024286">[</span><span class="op" id="5024287">]</span><span class="builtintype" id="5024288">uint16</span><br>
<span class="lineno">15</span><span class="op" id="5024295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024298">type</span>&nbsp;<span class="ident" id="5024303">literalNode</span>&nbsp;<span class="keyword" id="5024315">struct</span>&nbsp;<span class="op" id="5024322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024325">literal</span>&nbsp;<span class="builtintype" id="5024333">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024341">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5024349">int32</span><br>
<span class="lineno">20</span><span class="op" id="5024355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5024358">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5024436">type</span>&nbsp;<span class="ident" id="5024441">levelInfo</span>&nbsp;<span class="keyword" id="5024451">struct</span>&nbsp;<span class="op" id="5024458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024461">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024497">level</span>&nbsp;<span class="builtintype" id="5024503">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024511">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024560">lastFreq</span>&nbsp;<span class="builtintype" id="5024569">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024577">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024638">nextCharFreq</span>&nbsp;<span class="builtintype" id="5024651">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024659">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024735">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024802">nextPairFreq</span>&nbsp;<span class="builtintype" id="5024815">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024823">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024899">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024924">needed</span>&nbsp;<span class="builtintype" id="5024931">int32</span><br>
<span class="lineno">40</span><span class="op" id="5024937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024940">func</span>&nbsp;<span class="ident" id="5024945">maxNode</span><span class="op" id="5024952">(</span><span class="op" id="5024953">)</span>&nbsp;<span class="ident" id="5024955">literalNode</span>&nbsp;<span class="op" id="5024967">{</span>&nbsp;<span class="keyword" id="5024969">return</span>&nbsp;<span class="ident" id="5024976">literalNode</span><span class="op" id="5024987">{</span><span class="ident" id="5024988">math</span><span class="op" id="5024992">.</span><span class="ident" id="5024993">MaxUint16</span><span class="op" id="5025002">,</span>&nbsp;<span class="ident" id="5025004">math</span><span class="op" id="5025008">.</span><span class="ident" id="5025009">MaxInt32</span><span class="op" id="5025017">}</span>&nbsp;<span class="op" id="5025019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5025022">func</span>&nbsp;<span class="ident" id="5025027">newHuffmanEncoder</span><span class="op" id="5025044">(</span><span class="ident" id="5025045">size</span>&nbsp;<span class="builtintype" id="5025050">int</span><span class="op" id="5025053">)</span>&nbsp;<span class="op" id="5025055">*</span><span class="ident" id="5025056">huffmanEncoder</span>&nbsp;<span class="op" id="5025071">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025074">return</span>&nbsp;<span class="op" id="5025081">&amp;</span><span class="ident" id="5025082">huffmanEncoder</span><span class="op" id="5025096">{</span><span class="builtinfunc" id="5025097">make</span><span class="op" id="5025101">(</span><span class="op" id="5025102">[</span><span class="op" id="5025103">]</span><span class="builtintype" id="5025104">uint8</span><span class="op" id="5025109">,</span>&nbsp;<span class="ident" id="5025111">size</span><span class="op" id="5025115">)</span><span class="op" id="5025116">,</span>&nbsp;<span class="builtinfunc" id="5025118">make</span><span class="op" id="5025122">(</span><span class="op" id="5025123">[</span><span class="op" id="5025124">]</span><span class="builtintype" id="5025125">uint16</span><span class="op" id="5025131">,</span>&nbsp;<span class="ident" id="5025133">size</span><span class="op" id="5025137">)</span><span class="op" id="5025138">}</span><br>
<span class="lineno"></span><span class="op" id="5025140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5025143">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="5025211">func</span>&nbsp;<span class="ident" id="5025216">generateFixedLiteralEncoding</span><span class="op" id="5025244">(</span><span class="op" id="5025245">)</span>&nbsp;<span class="op" id="5025247">*</span><span class="ident" id="5025248">huffmanEncoder</span>&nbsp;<span class="op" id="5025263">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025266">h</span>&nbsp;<span class="op" id="5025268">:=</span>&nbsp;<span class="ident" id="5025271">newHuffmanEncoder</span><span class="op" id="5025288">(</span><span class="ident" id="5025289">maxLit</span><span class="op" id="5025295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025298">codeBits</span>&nbsp;<span class="op" id="5025307">:=</span>&nbsp;<span class="ident" id="5025310">h</span><span class="op" id="5025311">.</span><span class="ident" id="5025312">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025322">code</span>&nbsp;<span class="op" id="5025327">:=</span>&nbsp;<span class="ident" id="5025330">h</span><span class="op" id="5025331">.</span><span class="ident" id="5025332">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025338">var</span>&nbsp;<span class="ident" id="5025342">ch</span>&nbsp;<span class="builtintype" id="5025345">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025353">for</span>&nbsp;<span class="ident" id="5025357">ch</span>&nbsp;<span class="op" id="5025360">=</span>&nbsp;<span class="num" id="5025362">0</span><span class="op" id="5025363">;</span>&nbsp;<span class="ident" id="5025365">ch</span>&nbsp;<span class="op" id="5025368">&lt;</span>&nbsp;<span class="ident" id="5025370">maxLit</span><span class="op" id="5025376">;</span>&nbsp;<span class="ident" id="5025378">ch</span><span class="op" id="5025380">++</span>&nbsp;<span class="op" id="5025383">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025387">var</span>&nbsp;<span class="ident" id="5025391">bits</span>&nbsp;<span class="builtintype" id="5025396">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025405">var</span>&nbsp;<span class="ident" id="5025409">size</span>&nbsp;<span class="builtintype" id="5025414">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025422">switch</span>&nbsp;<span class="op" id="5025429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025433">case</span>&nbsp;<span class="ident" id="5025438">ch</span>&nbsp;<span class="op" id="5025441">&lt;</span>&nbsp;<span class="num" id="5025443">144</span><span class="op" id="5025446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025451">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025488">bits</span>&nbsp;<span class="op" id="5025493">=</span>&nbsp;<span class="ident" id="5025495">ch</span>&nbsp;<span class="op" id="5025498">+</span>&nbsp;<span class="num" id="5025500">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025506">size</span>&nbsp;<span class="op" id="5025511">=</span>&nbsp;<span class="num" id="5025513">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025518">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025526">case</span>&nbsp;<span class="ident" id="5025531">ch</span>&nbsp;<span class="op" id="5025534">&lt;</span>&nbsp;<span class="num" id="5025536">256</span><span class="op" id="5025539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025544">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025581">bits</span>&nbsp;<span class="op" id="5025586">=</span>&nbsp;<span class="ident" id="5025588">ch</span>&nbsp;<span class="op" id="5025591">+</span>&nbsp;<span class="num" id="5025593">400</span>&nbsp;<span class="op" id="5025597">-</span>&nbsp;<span class="num" id="5025599">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025606">size</span>&nbsp;<span class="op" id="5025611">=</span>&nbsp;<span class="num" id="5025613">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025618">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025626">case</span>&nbsp;<span class="ident" id="5025631">ch</span>&nbsp;<span class="op" id="5025634">&lt;</span>&nbsp;<span class="num" id="5025636">280</span><span class="op" id="5025639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025644">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025677">bits</span>&nbsp;<span class="op" id="5025682">=</span>&nbsp;<span class="ident" id="5025684">ch</span>&nbsp;<span class="op" id="5025687">-</span>&nbsp;<span class="num" id="5025689">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025696">size</span>&nbsp;<span class="op" id="5025701">=</span>&nbsp;<span class="num" id="5025703">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025708">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025716">default</span><span class="op" id="5025723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025728">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025763">bits</span>&nbsp;<span class="op" id="5025768">=</span>&nbsp;<span class="ident" id="5025770">ch</span>&nbsp;<span class="op" id="5025773">+</span>&nbsp;<span class="num" id="5025775">192</span>&nbsp;<span class="op" id="5025779">-</span>&nbsp;<span class="num" id="5025781">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025788">size</span>&nbsp;<span class="op" id="5025793">=</span>&nbsp;<span class="num" id="5025795">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025803">codeBits</span><span class="op" id="5025811">[</span><span class="ident" id="5025812">ch</span><span class="op" id="5025814">]</span>&nbsp;<span class="op" id="5025816">=</span>&nbsp;<span class="ident" id="5025818">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025825">code</span><span class="op" id="5025829">[</span><span class="ident" id="5025830">ch</span><span class="op" id="5025832">]</span>&nbsp;<span class="op" id="5025834">=</span>&nbsp;<span class="ident" id="5025836">reverseBits</span><span class="op" id="5025847">(</span><span class="ident" id="5025848">bits</span><span class="op" id="5025852">,</span>&nbsp;<span class="ident" id="5025854">size</span><span class="op" id="5025858">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025864">return</span>&nbsp;<span class="ident" id="5025871">h</span><br>
<span class="lineno"></span><span class="op" id="5025873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5025876">func</span>&nbsp;<span class="ident" id="5025881">generateFixedOffsetEncoding</span><span class="op" id="5025908">(</span><span class="op" id="5025909">)</span>&nbsp;<span class="op" id="5025911">*</span><span class="ident" id="5025912">huffmanEncoder</span>&nbsp;<span class="op" id="5025927">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025930">h</span>&nbsp;<span class="op" id="5025932">:=</span>&nbsp;<span class="ident" id="5025935">newHuffmanEncoder</span><span class="op" id="5025952">(</span><span class="num" id="5025953">30</span><span class="op" id="5025955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025958">codeBits</span>&nbsp;<span class="op" id="5025967">:=</span>&nbsp;<span class="ident" id="5025970">h</span><span class="op" id="5025971">.</span><span class="ident" id="5025972">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025982">code</span>&nbsp;<span class="op" id="5025987">:=</span>&nbsp;<span class="ident" id="5025990">h</span><span class="op" id="5025991">.</span><span class="ident" id="5025992">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025998">for</span>&nbsp;<span class="ident" id="5026002">ch</span>&nbsp;<span class="op" id="5026005">:=</span>&nbsp;<span class="builtintype" id="5026008">uint16</span><span class="op" id="5026014">(</span><span class="num" id="5026015">0</span><span class="op" id="5026016">)</span><span class="op" id="5026017">;</span>&nbsp;<span class="ident" id="5026019">ch</span>&nbsp;<span class="op" id="5026022">&lt;</span>&nbsp;<span class="num" id="5026024">30</span><span class="op" id="5026026">;</span>&nbsp;<span class="ident" id="5026028">ch</span><span class="op" id="5026030">++</span>&nbsp;<span class="op" id="5026033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026037">codeBits</span><span class="op" id="5026045">[</span><span class="ident" id="5026046">ch</span><span class="op" id="5026048">]</span>&nbsp;<span class="op" id="5026050">=</span>&nbsp;<span class="num" id="5026052">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026056">code</span><span class="op" id="5026060">[</span><span class="ident" id="5026061">ch</span><span class="op" id="5026063">]</span>&nbsp;<span class="op" id="5026065">=</span>&nbsp;<span class="ident" id="5026067">reverseBits</span><span class="op" id="5026078">(</span><span class="ident" id="5026079">ch</span><span class="op" id="5026081">,</span>&nbsp;<span class="num" id="5026083">5</span><span class="op" id="5026084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026090">return</span>&nbsp;<span class="ident" id="5026097">h</span><br>
<span class="lineno"></span><span class="op" id="5026099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5026102">var</span>&nbsp;<span class="ident" id="5026106">fixedLiteralEncoding</span>&nbsp;<span class="op" id="5026127">*</span><span class="ident" id="5026128">huffmanEncoder</span>&nbsp;<span class="op" id="5026143">=</span>&nbsp;<span class="ident" id="5026145">generateFixedLiteralEncoding</span><span class="op" id="5026173">(</span><span class="op" id="5026174">)</span><br>
<span class="lineno"></span><span class="keyword" id="5026176">var</span>&nbsp;<span class="ident" id="5026180">fixedOffsetEncoding</span>&nbsp;<span class="op" id="5026200">*</span><span class="ident" id="5026201">huffmanEncoder</span>&nbsp;<span class="op" id="5026216">=</span>&nbsp;<span class="ident" id="5026218">generateFixedOffsetEncoding</span><span class="op" id="5026245">(</span><span class="op" id="5026246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5026249">func</span>&nbsp;<span class="op" id="5026254">(</span><span class="ident" id="5026255">h</span>&nbsp;<span class="op" id="5026257">*</span><span class="ident" id="5026258">huffmanEncoder</span><span class="op" id="5026272">)</span>&nbsp;<span class="ident" id="5026274">bitLength</span><span class="op" id="5026283">(</span><span class="ident" id="5026284">freq</span>&nbsp;<span class="op" id="5026289">[</span><span class="op" id="5026290">]</span><span class="builtintype" id="5026291">int32</span><span class="op" id="5026296">)</span>&nbsp;<span class="ident" id="5026298">int64</span>&nbsp;<span class="op" id="5026304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026307">var</span>&nbsp;<span class="ident" id="5026311">total</span>&nbsp;<span class="ident" id="5026317">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026324">for</span>&nbsp;<span class="ident" id="5026328">i</span><span class="op" id="5026329">,</span>&nbsp;<span class="ident" id="5026331">f</span>&nbsp;<span class="op" id="5026333">:=</span>&nbsp;<span class="keyword" id="5026336">range</span>&nbsp;<span class="ident" id="5026342">freq</span>&nbsp;<span class="op" id="5026347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026351">if</span>&nbsp;<span class="ident" id="5026354">f</span>&nbsp;<span class="op" id="5026356">!=</span>&nbsp;<span class="num" id="5026359">0</span>&nbsp;<span class="op" id="5026361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026366">total</span>&nbsp;<span class="op" id="5026372">+=</span>&nbsp;<span class="ident" id="5026375">int64</span><span class="op" id="5026380">(</span><span class="ident" id="5026381">f</span><span class="op" id="5026382">)</span>&nbsp;<span class="op" id="5026384">*</span>&nbsp;<span class="ident" id="5026386">int64</span><span class="op" id="5026391">(</span><span class="ident" id="5026392">h</span><span class="op" id="5026393">.</span><span class="ident" id="5026394">codeBits</span><span class="op" id="5026402">[</span><span class="ident" id="5026403">i</span><span class="op" id="5026404">]</span><span class="op" id="5026405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026412">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026415">return</span>&nbsp;<span class="ident" id="5026422">total</span><br>
<span class="lineno"></span><span class="op" id="5026428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5026431">const</span>&nbsp;<span class="ident" id="5026437">maxBitsLimit</span>&nbsp;<span class="op" id="5026450">=</span>&nbsp;<span class="num" id="5026452">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5026456">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5026539">//</span><br>
<span class="lineno"></span><span class="comment" id="5026542">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="5026594">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5026665">//</span><br>
<span class="lineno">115</span><span class="comment" id="5026668">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="5026728">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="5026814">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="5026901">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="5026925">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="5027010">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="5027047">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="5027130">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5027179">func</span>&nbsp;<span class="op" id="5027184">(</span><span class="ident" id="5027185">h</span>&nbsp;<span class="op" id="5027187">*</span><span class="ident" id="5027188">huffmanEncoder</span><span class="op" id="5027202">)</span>&nbsp;<span class="ident" id="5027204">bitCounts</span><span class="op" id="5027213">(</span><span class="ident" id="5027214">list</span>&nbsp;<span class="op" id="5027219">[</span><span class="op" id="5027220">]</span><span class="ident" id="5027221">literalNode</span><span class="op" id="5027232">,</span>&nbsp;<span class="ident" id="5027234">maxBits</span>&nbsp;<span class="builtintype" id="5027242">int32</span><span class="op" id="5027247">)</span>&nbsp;<span class="op" id="5027249">[</span><span class="op" id="5027250">]</span><span class="builtintype" id="5027251">int32</span>&nbsp;<span class="op" id="5027257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027260">if</span>&nbsp;<span class="ident" id="5027263">maxBits</span>&nbsp;<span class="op" id="5027271">&gt;=</span>&nbsp;<span class="ident" id="5027274">maxBitsLimit</span>&nbsp;<span class="op" id="5027287">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5027291">panic</span><span class="op" id="5027296">(</span><span class="string" id="5027297">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="5027323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027329">n</span>&nbsp;<span class="op" id="5027331">:=</span>&nbsp;<span class="builtintype" id="5027334">int32</span><span class="op" id="5027339">(</span><span class="builtinfunc" id="5027340">len</span><span class="op" id="5027343">(</span><span class="ident" id="5027344">list</span><span class="op" id="5027348">)</span><span class="op" id="5027349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027352">list</span>&nbsp;<span class="op" id="5027357">=</span>&nbsp;<span class="ident" id="5027359">list</span><span class="op" id="5027363">[</span><span class="num" id="5027364">0</span>&nbsp;<span class="op" id="5027366">:</span>&nbsp;<span class="ident" id="5027368">n</span><span class="op" id="5027369">+</span><span class="num" id="5027370">1</span><span class="op" id="5027371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027374">list</span><span class="op" id="5027378">[</span><span class="ident" id="5027379">n</span><span class="op" id="5027380">]</span>&nbsp;<span class="op" id="5027382">=</span>&nbsp;<span class="ident" id="5027384">maxNode</span><span class="op" id="5027391">(</span><span class="op" id="5027392">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027396">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027468">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027519">if</span>&nbsp;<span class="ident" id="5027522">maxBits</span>&nbsp;<span class="op" id="5027530">&gt;</span>&nbsp;<span class="ident" id="5027532">n</span><span class="op" id="5027533">-</span><span class="num" id="5027534">1</span>&nbsp;<span class="op" id="5027536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027540">maxBits</span>&nbsp;<span class="op" id="5027548">=</span>&nbsp;<span class="ident" id="5027550">n</span>&nbsp;<span class="op" id="5027552">-</span>&nbsp;<span class="num" id="5027554">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027561">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027610">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027662">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027721">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027771">var</span>&nbsp;<span class="ident" id="5027775">levels</span>&nbsp;<span class="op" id="5027782">[</span><span class="ident" id="5027783">maxBitsLimit</span><span class="op" id="5027795">]</span><span class="ident" id="5027796">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027807">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027867">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027918">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027977">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028006">var</span>&nbsp;<span class="ident" id="5028010">leafCounts</span>&nbsp;<span class="op" id="5028021">[</span><span class="ident" id="5028022">maxBitsLimit</span><span class="op" id="5028034">]</span><span class="op" id="5028035">[</span><span class="ident" id="5028036">maxBitsLimit</span><span class="op" id="5028048">]</span><span class="builtintype" id="5028049">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028057">for</span>&nbsp;<span class="ident" id="5028061">level</span>&nbsp;<span class="op" id="5028067">:=</span>&nbsp;<span class="builtintype" id="5028070">int32</span><span class="op" id="5028075">(</span><span class="num" id="5028076">1</span><span class="op" id="5028077">)</span><span class="op" id="5028078">;</span>&nbsp;<span class="ident" id="5028080">level</span>&nbsp;<span class="op" id="5028086">&lt;=</span>&nbsp;<span class="ident" id="5028089">maxBits</span><span class="op" id="5028096">;</span>&nbsp;<span class="ident" id="5028098">level</span><span class="op" id="5028103">++</span>&nbsp;<span class="op" id="5028106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028110">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028182">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028251">levels</span><span class="op" id="5028257">[</span><span class="ident" id="5028258">level</span><span class="op" id="5028263">]</span>&nbsp;<span class="op" id="5028265">=</span>&nbsp;<span class="ident" id="5028267">levelInfo</span><span class="op" id="5028276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028281">level</span><span class="op" id="5028286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5028295">level</span><span class="op" id="5028300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028305">lastFreq</span><span class="op" id="5028313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5028319">list</span><span class="op" id="5028323">[</span><span class="num" id="5028324">1</span><span class="op" id="5028325">]</span><span class="op" id="5028326">.</span><span class="ident" id="5028327">freq</span><span class="op" id="5028331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028336">nextCharFreq</span><span class="op" id="5028348">:</span>&nbsp;<span class="ident" id="5028350">list</span><span class="op" id="5028354">[</span><span class="num" id="5028355">2</span><span class="op" id="5028356">]</span><span class="op" id="5028357">.</span><span class="ident" id="5028358">freq</span><span class="op" id="5028362">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028367">nextPairFreq</span><span class="op" id="5028379">:</span>&nbsp;<span class="ident" id="5028381">list</span><span class="op" id="5028385">[</span><span class="num" id="5028386">0</span><span class="op" id="5028387">]</span><span class="op" id="5028388">.</span><span class="ident" id="5028389">freq</span>&nbsp;<span class="op" id="5028394">+</span>&nbsp;<span class="ident" id="5028396">list</span><span class="op" id="5028400">[</span><span class="num" id="5028401">1</span><span class="op" id="5028402">]</span><span class="op" id="5028403">.</span><span class="ident" id="5028404">freq</span><span class="op" id="5028408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028416">leafCounts</span><span class="op" id="5028426">[</span><span class="ident" id="5028427">level</span><span class="op" id="5028432">]</span><span class="op" id="5028433">[</span><span class="ident" id="5028434">level</span><span class="op" id="5028439">]</span>&nbsp;<span class="op" id="5028441">=</span>&nbsp;<span class="num" id="5028443">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028447">if</span>&nbsp;<span class="ident" id="5028450">level</span>&nbsp;<span class="op" id="5028456">==</span>&nbsp;<span class="num" id="5028459">1</span>&nbsp;<span class="op" id="5028461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028466">levels</span><span class="op" id="5028472">[</span><span class="ident" id="5028473">level</span><span class="op" id="5028478">]</span><span class="op" id="5028479">.</span><span class="ident" id="5028480">nextPairFreq</span>&nbsp;<span class="op" id="5028493">=</span>&nbsp;<span class="ident" id="5028495">math</span><span class="op" id="5028499">.</span><span class="ident" id="5028500">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028518">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028598">levels</span><span class="op" id="5028604">[</span><span class="ident" id="5028605">maxBits</span><span class="op" id="5028612">]</span><span class="op" id="5028613">.</span><span class="ident" id="5028614">needed</span>&nbsp;<span class="op" id="5028621">=</span>&nbsp;<span class="num" id="5028623">2</span><span class="op" id="5028624">*</span><span class="ident" id="5028625">n</span>&nbsp;<span class="op" id="5028627">-</span>&nbsp;<span class="num" id="5028629">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028633">level</span>&nbsp;<span class="op" id="5028639">:=</span>&nbsp;<span class="ident" id="5028642">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028651">for</span>&nbsp;<span class="op" id="5028655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028659">l</span>&nbsp;<span class="op" id="5028661">:=</span>&nbsp;<span class="op" id="5028664">&amp;</span><span class="ident" id="5028665">levels</span><span class="op" id="5028671">[</span><span class="ident" id="5028672">level</span><span class="op" id="5028677">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028681">if</span>&nbsp;<span class="ident" id="5028684">l</span><span class="op" id="5028685">.</span><span class="ident" id="5028686">nextPairFreq</span>&nbsp;<span class="op" id="5028699">==</span>&nbsp;<span class="ident" id="5028702">math</span><span class="op" id="5028706">.</span><span class="ident" id="5028707">MaxInt32</span>&nbsp;<span class="op" id="5028716">&amp;&amp;</span>&nbsp;<span class="ident" id="5028719">l</span><span class="op" id="5028720">.</span><span class="ident" id="5028721">nextCharFreq</span>&nbsp;<span class="op" id="5028734">==</span>&nbsp;<span class="ident" id="5028737">math</span><span class="op" id="5028741">.</span><span class="ident" id="5028742">MaxInt32</span>&nbsp;<span class="op" id="5028751">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028756">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028801">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028844">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028916">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028957">l</span><span class="op" id="5028958">.</span><span class="ident" id="5028959">needed</span>&nbsp;<span class="op" id="5028966">=</span>&nbsp;<span class="num" id="5028968">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028973">levels</span><span class="op" id="5028979">[</span><span class="ident" id="5028980">level</span><span class="op" id="5028985">+</span><span class="num" id="5028986">1</span><span class="op" id="5028987">]</span><span class="op" id="5028988">.</span><span class="ident" id="5028989">nextPairFreq</span>&nbsp;<span class="op" id="5029002">=</span>&nbsp;<span class="ident" id="5029004">math</span><span class="op" id="5029008">.</span><span class="ident" id="5029009">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029021">level</span><span class="op" id="5029026">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029032">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5029043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029048">prevFreq</span>&nbsp;<span class="op" id="5029057">:=</span>&nbsp;<span class="ident" id="5029060">l</span><span class="op" id="5029061">.</span><span class="ident" id="5029062">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029073">if</span>&nbsp;<span class="ident" id="5029076">l</span><span class="op" id="5029077">.</span><span class="ident" id="5029078">nextCharFreq</span>&nbsp;<span class="op" id="5029091">&lt;</span>&nbsp;<span class="ident" id="5029093">l</span><span class="op" id="5029094">.</span><span class="ident" id="5029095">nextPairFreq</span>&nbsp;<span class="op" id="5029108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029113">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029161">n</span>&nbsp;<span class="op" id="5029163">:=</span>&nbsp;<span class="ident" id="5029166">leafCounts</span><span class="op" id="5029176">[</span><span class="ident" id="5029177">level</span><span class="op" id="5029182">]</span><span class="op" id="5029183">[</span><span class="ident" id="5029184">level</span><span class="op" id="5029189">]</span>&nbsp;<span class="op" id="5029191">+</span>&nbsp;<span class="num" id="5029193">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029198">l</span><span class="op" id="5029199">.</span><span class="ident" id="5029200">lastFreq</span>&nbsp;<span class="op" id="5029209">=</span>&nbsp;<span class="ident" id="5029211">l</span><span class="op" id="5029212">.</span><span class="ident" id="5029213">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029229">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029287">leafCounts</span><span class="op" id="5029297">[</span><span class="ident" id="5029298">level</span><span class="op" id="5029303">]</span><span class="op" id="5029304">[</span><span class="ident" id="5029305">level</span><span class="op" id="5029310">]</span>&nbsp;<span class="op" id="5029312">=</span>&nbsp;<span class="ident" id="5029314">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029319">l</span><span class="op" id="5029320">.</span><span class="ident" id="5029321">nextCharFreq</span>&nbsp;<span class="op" id="5029334">=</span>&nbsp;<span class="ident" id="5029336">list</span><span class="op" id="5029340">[</span><span class="ident" id="5029341">n</span><span class="op" id="5029342">]</span><span class="op" id="5029343">.</span><span class="ident" id="5029344">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5029351">}</span>&nbsp;<span class="keyword" id="5029353">else</span>&nbsp;<span class="op" id="5029358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029363">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029428">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029481">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029518">l</span><span class="op" id="5029519">.</span><span class="ident" id="5029520">lastFreq</span>&nbsp;<span class="op" id="5029529">=</span>&nbsp;<span class="ident" id="5029531">l</span><span class="op" id="5029532">.</span><span class="ident" id="5029533">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029549">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5029633">copy</span><span class="op" id="5029637">(</span><span class="ident" id="5029638">leafCounts</span><span class="op" id="5029648">[</span><span class="ident" id="5029649">level</span><span class="op" id="5029654">]</span><span class="op" id="5029655">[</span><span class="op" id="5029656">:</span><span class="ident" id="5029657">level</span><span class="op" id="5029662">]</span><span class="op" id="5029663">,</span>&nbsp;<span class="ident" id="5029665">leafCounts</span><span class="op" id="5029675">[</span><span class="ident" id="5029676">level</span><span class="op" id="5029681">-</span><span class="num" id="5029682">1</span><span class="op" id="5029683">]</span><span class="op" id="5029684">[</span><span class="op" id="5029685">:</span><span class="ident" id="5029686">level</span><span class="op" id="5029691">]</span><span class="op" id="5029692">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029697">levels</span><span class="op" id="5029703">[</span><span class="ident" id="5029704">l</span><span class="op" id="5029705">.</span><span class="ident" id="5029706">level</span><span class="op" id="5029711">-</span><span class="num" id="5029712">1</span><span class="op" id="5029713">]</span><span class="op" id="5029714">.</span><span class="ident" id="5029715">needed</span>&nbsp;<span class="op" id="5029722">=</span>&nbsp;<span class="num" id="5029724">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5029728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029733">if</span>&nbsp;<span class="ident" id="5029736">l</span><span class="op" id="5029737">.</span><span class="ident" id="5029738">needed</span><span class="op" id="5029744">--</span><span class="op" id="5029746">;</span>&nbsp;<span class="ident" id="5029748">l</span><span class="op" id="5029749">.</span><span class="ident" id="5029750">needed</span>&nbsp;<span class="op" id="5029757">==</span>&nbsp;<span class="num" id="5029760">0</span>&nbsp;<span class="op" id="5029762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029767">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029825">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029888">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029963">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029981">if</span>&nbsp;<span class="ident" id="5029984">l</span><span class="op" id="5029985">.</span><span class="ident" id="5029986">level</span>&nbsp;<span class="op" id="5029992">==</span>&nbsp;<span class="ident" id="5029995">maxBits</span>&nbsp;<span class="op" id="5030003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030009">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030026">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030040">levels</span><span class="op" id="5030046">[</span><span class="ident" id="5030047">l</span><span class="op" id="5030048">.</span><span class="ident" id="5030049">level</span><span class="op" id="5030054">+</span><span class="num" id="5030055">1</span><span class="op" id="5030056">]</span><span class="op" id="5030057">.</span><span class="ident" id="5030058">nextPairFreq</span>&nbsp;<span class="op" id="5030071">=</span>&nbsp;<span class="ident" id="5030073">prevFreq</span>&nbsp;<span class="op" id="5030082">+</span>&nbsp;<span class="ident" id="5030084">l</span><span class="op" id="5030085">.</span><span class="ident" id="5030086">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030098">level</span><span class="op" id="5030103">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030108">}</span>&nbsp;<span class="keyword" id="5030110">else</span>&nbsp;<span class="op" id="5030115">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030120">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030189">for</span>&nbsp;<span class="ident" id="5030193">levels</span><span class="op" id="5030199">[</span><span class="ident" id="5030200">level</span><span class="op" id="5030205">-</span><span class="num" id="5030206">1</span><span class="op" id="5030207">]</span><span class="op" id="5030208">.</span><span class="ident" id="5030209">needed</span>&nbsp;<span class="op" id="5030216">&gt;</span>&nbsp;<span class="num" id="5030218">0</span>&nbsp;<span class="op" id="5030220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030226">level</span><span class="op" id="5030231">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030241">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030248">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030324">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030347">if</span>&nbsp;<span class="ident" id="5030350">leafCounts</span><span class="op" id="5030360">[</span><span class="ident" id="5030361">maxBits</span><span class="op" id="5030368">]</span><span class="op" id="5030369">[</span><span class="ident" id="5030370">maxBits</span><span class="op" id="5030377">]</span>&nbsp;<span class="op" id="5030379">!=</span>&nbsp;<span class="ident" id="5030382">n</span>&nbsp;<span class="op" id="5030384">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5030388">panic</span><span class="op" id="5030393">(</span><span class="string" id="5030394">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="5030429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030436">bitCount</span>&nbsp;<span class="op" id="5030445">:=</span>&nbsp;<span class="builtinfunc" id="5030448">make</span><span class="op" id="5030452">(</span><span class="op" id="5030453">[</span><span class="op" id="5030454">]</span><span class="builtintype" id="5030455">int32</span><span class="op" id="5030460">,</span>&nbsp;<span class="ident" id="5030462">maxBits</span><span class="op" id="5030469">+</span><span class="num" id="5030470">1</span><span class="op" id="5030471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030474">bits</span>&nbsp;<span class="op" id="5030479">:=</span>&nbsp;<span class="num" id="5030482">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030485">counts</span>&nbsp;<span class="op" id="5030492">:=</span>&nbsp;<span class="op" id="5030495">&amp;</span><span class="ident" id="5030496">leafCounts</span><span class="op" id="5030506">[</span><span class="ident" id="5030507">maxBits</span><span class="op" id="5030514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030517">for</span>&nbsp;<span class="ident" id="5030521">level</span>&nbsp;<span class="op" id="5030527">:=</span>&nbsp;<span class="ident" id="5030530">maxBits</span><span class="op" id="5030537">;</span>&nbsp;<span class="ident" id="5030539">level</span>&nbsp;<span class="op" id="5030545">&gt;</span>&nbsp;<span class="num" id="5030547">0</span><span class="op" id="5030548">;</span>&nbsp;<span class="ident" id="5030550">level</span><span class="op" id="5030555">--</span>&nbsp;<span class="op" id="5030558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030562">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030638">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030659">bitCount</span><span class="op" id="5030667">[</span><span class="ident" id="5030668">bits</span><span class="op" id="5030672">]</span>&nbsp;<span class="op" id="5030674">=</span>&nbsp;<span class="ident" id="5030676">counts</span><span class="op" id="5030682">[</span><span class="ident" id="5030683">level</span><span class="op" id="5030688">]</span>&nbsp;<span class="op" id="5030690">-</span>&nbsp;<span class="ident" id="5030692">counts</span><span class="op" id="5030698">[</span><span class="ident" id="5030699">level</span><span class="op" id="5030704">-</span><span class="num" id="5030705">1</span><span class="op" id="5030706">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030710">bits</span><span class="op" id="5030714">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030721">return</span>&nbsp;<span class="ident" id="5030728">bitCount</span><br>
<span class="lineno"></span><span class="op" id="5030737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="5030740">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5030819">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="5030840">func</span>&nbsp;<span class="op" id="5030845">(</span><span class="ident" id="5030846">h</span>&nbsp;<span class="op" id="5030848">*</span><span class="ident" id="5030849">huffmanEncoder</span><span class="op" id="5030863">)</span>&nbsp;<span class="ident" id="5030865">assignEncodingAndSize</span><span class="op" id="5030886">(</span><span class="ident" id="5030887">bitCount</span>&nbsp;<span class="op" id="5030896">[</span><span class="op" id="5030897">]</span><span class="builtintype" id="5030898">int32</span><span class="op" id="5030903">,</span>&nbsp;<span class="ident" id="5030905">list</span>&nbsp;<span class="op" id="5030910">[</span><span class="op" id="5030911">]</span><span class="ident" id="5030912">literalNode</span><span class="op" id="5030923">)</span>&nbsp;<span class="op" id="5030925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030928">code</span>&nbsp;<span class="op" id="5030933">:=</span>&nbsp;<span class="builtintype" id="5030936">uint16</span><span class="op" id="5030942">(</span><span class="num" id="5030943">0</span><span class="op" id="5030944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030947">for</span>&nbsp;<span class="ident" id="5030951">n</span><span class="op" id="5030952">,</span>&nbsp;<span class="ident" id="5030954">bits</span>&nbsp;<span class="op" id="5030959">:=</span>&nbsp;<span class="keyword" id="5030962">range</span>&nbsp;<span class="ident" id="5030968">bitCount</span>&nbsp;<span class="op" id="5030977">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030981">code</span>&nbsp;<span class="op" id="5030986">&lt;&lt;=</span>&nbsp;<span class="num" id="5030990">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030994">if</span>&nbsp;<span class="ident" id="5030997">n</span>&nbsp;<span class="op" id="5030999">==</span>&nbsp;<span class="num" id="5031002">0</span>&nbsp;<span class="op" id="5031004">||</span>&nbsp;<span class="ident" id="5031007">bits</span>&nbsp;<span class="op" id="5031012">==</span>&nbsp;<span class="num" id="5031015">0</span>&nbsp;<span class="op" id="5031017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031037">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031100">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031155">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031202">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031256">chunk</span>&nbsp;<span class="op" id="5031262">:=</span>&nbsp;<span class="ident" id="5031265">list</span><span class="op" id="5031269">[</span><span class="builtinfunc" id="5031270">len</span><span class="op" id="5031273">(</span><span class="ident" id="5031274">list</span><span class="op" id="5031278">)</span><span class="op" id="5031279">-</span><span class="builtintype" id="5031280">int</span><span class="op" id="5031283">(</span><span class="ident" id="5031284">bits</span><span class="op" id="5031288">)</span><span class="op" id="5031289">:</span><span class="op" id="5031290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031294">sortByLiteral</span><span class="op" id="5031307">(</span><span class="ident" id="5031308">chunk</span><span class="op" id="5031313">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031317">for</span>&nbsp;<span class="ident" id="5031321">_</span><span class="op" id="5031322">,</span>&nbsp;<span class="ident" id="5031324">node</span>&nbsp;<span class="op" id="5031329">:=</span>&nbsp;<span class="keyword" id="5031332">range</span>&nbsp;<span class="ident" id="5031338">chunk</span>&nbsp;<span class="op" id="5031344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031349">h</span><span class="op" id="5031350">.</span><span class="ident" id="5031351">codeBits</span><span class="op" id="5031359">[</span><span class="ident" id="5031360">node</span><span class="op" id="5031364">.</span><span class="ident" id="5031365">literal</span><span class="op" id="5031372">]</span>&nbsp;<span class="op" id="5031374">=</span>&nbsp;<span class="builtintype" id="5031376">uint8</span><span class="op" id="5031381">(</span><span class="ident" id="5031382">n</span><span class="op" id="5031383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031388">h</span><span class="op" id="5031389">.</span><span class="ident" id="5031390">code</span><span class="op" id="5031394">[</span><span class="ident" id="5031395">node</span><span class="op" id="5031399">.</span><span class="ident" id="5031400">literal</span><span class="op" id="5031407">]</span>&nbsp;<span class="op" id="5031409">=</span>&nbsp;<span class="ident" id="5031411">reverseBits</span><span class="op" id="5031422">(</span><span class="ident" id="5031423">code</span><span class="op" id="5031427">,</span>&nbsp;<span class="builtintype" id="5031429">uint8</span><span class="op" id="5031434">(</span><span class="ident" id="5031435">n</span><span class="op" id="5031436">)</span><span class="op" id="5031437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031442">code</span><span class="op" id="5031446">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031451">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031455">list</span>&nbsp;<span class="op" id="5031460">=</span>&nbsp;<span class="ident" id="5031462">list</span><span class="op" id="5031466">[</span><span class="num" id="5031467">0</span>&nbsp;<span class="op" id="5031469">:</span>&nbsp;<span class="builtinfunc" id="5031471">len</span><span class="op" id="5031474">(</span><span class="ident" id="5031475">list</span><span class="op" id="5031479">)</span><span class="op" id="5031480">-</span><span class="builtintype" id="5031481">int</span><span class="op" id="5031484">(</span><span class="ident" id="5031485">bits</span><span class="op" id="5031489">)</span><span class="op" id="5031490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031493">}</span><br>
<span class="lineno"></span><span class="op" id="5031495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5031498">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="5031591">//</span><br>
<span class="lineno"></span><span class="comment" id="5031594">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="5031684">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="5031747">func</span>&nbsp;<span class="op" id="5031752">(</span><span class="ident" id="5031753">h</span>&nbsp;<span class="op" id="5031755">*</span><span class="ident" id="5031756">huffmanEncoder</span><span class="op" id="5031770">)</span>&nbsp;<span class="ident" id="5031772">generate</span><span class="op" id="5031780">(</span><span class="ident" id="5031781">freq</span>&nbsp;<span class="op" id="5031786">[</span><span class="op" id="5031787">]</span><span class="builtintype" id="5031788">int32</span><span class="op" id="5031793">,</span>&nbsp;<span class="ident" id="5031795">maxBits</span>&nbsp;<span class="builtintype" id="5031803">int32</span><span class="op" id="5031808">)</span>&nbsp;<span class="op" id="5031810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031813">list</span>&nbsp;<span class="op" id="5031818">:=</span>&nbsp;<span class="builtinfunc" id="5031821">make</span><span class="op" id="5031825">(</span><span class="op" id="5031826">[</span><span class="op" id="5031827">]</span><span class="ident" id="5031828">literalNode</span><span class="op" id="5031839">,</span>&nbsp;<span class="builtinfunc" id="5031841">len</span><span class="op" id="5031844">(</span><span class="ident" id="5031845">freq</span><span class="op" id="5031849">)</span><span class="op" id="5031850">+</span><span class="num" id="5031851">1</span><span class="op" id="5031852">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031855">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031887">count</span>&nbsp;<span class="op" id="5031893">:=</span>&nbsp;<span class="num" id="5031896">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031899">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031973">for</span>&nbsp;<span class="ident" id="5031977">i</span><span class="op" id="5031978">,</span>&nbsp;<span class="ident" id="5031980">f</span>&nbsp;<span class="op" id="5031982">:=</span>&nbsp;<span class="keyword" id="5031985">range</span>&nbsp;<span class="ident" id="5031991">freq</span>&nbsp;<span class="op" id="5031996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032000">if</span>&nbsp;<span class="ident" id="5032003">f</span>&nbsp;<span class="op" id="5032005">!=</span>&nbsp;<span class="num" id="5032008">0</span>&nbsp;<span class="op" id="5032010">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032015">list</span><span class="op" id="5032019">[</span><span class="ident" id="5032020">count</span><span class="op" id="5032025">]</span>&nbsp;<span class="op" id="5032027">=</span>&nbsp;<span class="ident" id="5032029">literalNode</span><span class="op" id="5032040">{</span><span class="builtintype" id="5032041">uint16</span><span class="op" id="5032047">(</span><span class="ident" id="5032048">i</span><span class="op" id="5032049">)</span><span class="op" id="5032050">,</span>&nbsp;<span class="ident" id="5032052">f</span><span class="op" id="5032053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032058">count</span><span class="op" id="5032063">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032068">}</span>&nbsp;<span class="keyword" id="5032070">else</span>&nbsp;<span class="op" id="5032075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032080">h</span><span class="op" id="5032081">.</span><span class="ident" id="5032082">codeBits</span><span class="op" id="5032090">[</span><span class="ident" id="5032091">i</span><span class="op" id="5032092">]</span>&nbsp;<span class="op" id="5032094">=</span>&nbsp;<span class="num" id="5032096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032100">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032106">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032183">h</span><span class="op" id="5032184">.</span><span class="ident" id="5032185">codeBits</span>&nbsp;<span class="op" id="5032194">=</span>&nbsp;<span class="ident" id="5032196">h</span><span class="op" id="5032197">.</span><span class="ident" id="5032198">codeBits</span><span class="op" id="5032206">[</span><span class="num" id="5032207">0</span><span class="op" id="5032208">:</span><span class="builtinfunc" id="5032209">len</span><span class="op" id="5032212">(</span><span class="ident" id="5032213">freq</span><span class="op" id="5032217">)</span><span class="op" id="5032218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032221">list</span>&nbsp;<span class="op" id="5032226">=</span>&nbsp;<span class="ident" id="5032228">list</span><span class="op" id="5032232">[</span><span class="num" id="5032233">0</span><span class="op" id="5032234">:</span><span class="ident" id="5032235">count</span><span class="op" id="5032240">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032243">if</span>&nbsp;<span class="ident" id="5032246">count</span>&nbsp;<span class="op" id="5032252">&lt;=</span>&nbsp;<span class="num" id="5032255">2</span>&nbsp;<span class="op" id="5032257">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032261">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032353">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032410">for</span>&nbsp;<span class="ident" id="5032414">i</span><span class="op" id="5032415">,</span>&nbsp;<span class="ident" id="5032417">node</span>&nbsp;<span class="op" id="5032422">:=</span>&nbsp;<span class="keyword" id="5032425">range</span>&nbsp;<span class="ident" id="5032431">list</span>&nbsp;<span class="op" id="5032436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032441">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032495">h</span><span class="op" id="5032496">.</span><span class="ident" id="5032497">codeBits</span><span class="op" id="5032505">[</span><span class="ident" id="5032506">node</span><span class="op" id="5032510">.</span><span class="ident" id="5032511">literal</span><span class="op" id="5032518">]</span>&nbsp;<span class="op" id="5032520">=</span>&nbsp;<span class="num" id="5032522">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032527">h</span><span class="op" id="5032528">.</span><span class="ident" id="5032529">code</span><span class="op" id="5032533">[</span><span class="ident" id="5032534">node</span><span class="op" id="5032538">.</span><span class="ident" id="5032539">literal</span><span class="op" id="5032546">]</span>&nbsp;<span class="op" id="5032548">=</span>&nbsp;<span class="builtintype" id="5032550">uint16</span><span class="op" id="5032556">(</span><span class="ident" id="5032557">i</span><span class="op" id="5032558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032566">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032577">sortByFreq</span><span class="op" id="5032587">(</span><span class="ident" id="5032588">list</span><span class="op" id="5032592">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032596">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032646">bitCount</span>&nbsp;<span class="op" id="5032655">:=</span>&nbsp;<span class="ident" id="5032658">h</span><span class="op" id="5032659">.</span><span class="ident" id="5032660">bitCounts</span><span class="op" id="5032669">(</span><span class="ident" id="5032670">list</span><span class="op" id="5032674">,</span>&nbsp;<span class="ident" id="5032676">maxBits</span><span class="op" id="5032683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032686">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032712">h</span><span class="op" id="5032713">.</span><span class="ident" id="5032714">assignEncodingAndSize</span><span class="op" id="5032735">(</span><span class="ident" id="5032736">bitCount</span><span class="op" id="5032744">,</span>&nbsp;<span class="ident" id="5032746">list</span><span class="op" id="5032750">)</span><br>
<span class="lineno">295</span><span class="op" id="5032752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5032755">type</span>&nbsp;<span class="ident" id="5032760">literalNodeSorter</span>&nbsp;<span class="keyword" id="5032778">struct</span>&nbsp;<span class="op" id="5032785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032788">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5032793">[</span><span class="op" id="5032794">]</span><span class="ident" id="5032795">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032808">less</span>&nbsp;<span class="keyword" id="5032813">func</span><span class="op" id="5032817">(</span><span class="ident" id="5032818">i</span><span class="op" id="5032819">,</span>&nbsp;<span class="ident" id="5032821">j</span>&nbsp;<span class="builtintype" id="5032823">int</span><span class="op" id="5032826">)</span>&nbsp;<span class="builtintype" id="5032828">bool</span><br>
<span class="lineno">300</span><span class="op" id="5032833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5032836">func</span>&nbsp;<span class="op" id="5032841">(</span><span class="ident" id="5032842">s</span>&nbsp;<span class="ident" id="5032844">literalNodeSorter</span><span class="op" id="5032861">)</span>&nbsp;<span class="ident" id="5032863">Len</span><span class="op" id="5032866">(</span><span class="op" id="5032867">)</span>&nbsp;<span class="builtintype" id="5032869">int</span>&nbsp;<span class="op" id="5032873">{</span>&nbsp;<span class="keyword" id="5032875">return</span>&nbsp;<span class="builtinfunc" id="5032882">len</span><span class="op" id="5032885">(</span><span class="ident" id="5032886">s</span><span class="op" id="5032887">.</span><span class="ident" id="5032888">a</span><span class="op" id="5032889">)</span>&nbsp;<span class="op" id="5032891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5032894">func</span>&nbsp;<span class="op" id="5032899">(</span><span class="ident" id="5032900">s</span>&nbsp;<span class="ident" id="5032902">literalNodeSorter</span><span class="op" id="5032919">)</span>&nbsp;<span class="ident" id="5032921">Less</span><span class="op" id="5032925">(</span><span class="ident" id="5032926">i</span><span class="op" id="5032927">,</span>&nbsp;<span class="ident" id="5032929">j</span>&nbsp;<span class="builtintype" id="5032931">int</span><span class="op" id="5032934">)</span>&nbsp;<span class="builtintype" id="5032936">bool</span>&nbsp;<span class="op" id="5032941">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032944">return</span>&nbsp;<span class="ident" id="5032951">s</span><span class="op" id="5032952">.</span><span class="ident" id="5032953">less</span><span class="op" id="5032957">(</span><span class="ident" id="5032958">i</span><span class="op" id="5032959">,</span>&nbsp;<span class="ident" id="5032961">j</span><span class="op" id="5032962">)</span><br>
<span class="lineno"></span><span class="op" id="5032964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5032967">func</span>&nbsp;<span class="op" id="5032972">(</span><span class="ident" id="5032973">s</span>&nbsp;<span class="ident" id="5032975">literalNodeSorter</span><span class="op" id="5032992">)</span>&nbsp;<span class="ident" id="5032994">Swap</span><span class="op" id="5032998">(</span><span class="ident" id="5032999">i</span><span class="op" id="5033000">,</span>&nbsp;<span class="ident" id="5033002">j</span>&nbsp;<span class="builtintype" id="5033004">int</span><span class="op" id="5033007">)</span>&nbsp;<span class="op" id="5033009">{</span>&nbsp;<span class="ident" id="5033011">s</span><span class="op" id="5033012">.</span><span class="ident" id="5033013">a</span><span class="op" id="5033014">[</span><span class="ident" id="5033015">i</span><span class="op" id="5033016">]</span><span class="op" id="5033017">,</span>&nbsp;<span class="ident" id="5033019">s</span><span class="op" id="5033020">.</span><span class="ident" id="5033021">a</span><span class="op" id="5033022">[</span><span class="ident" id="5033023">j</span><span class="op" id="5033024">]</span>&nbsp;<span class="op" id="5033026">=</span>&nbsp;<span class="ident" id="5033028">s</span><span class="op" id="5033029">.</span><span class="ident" id="5033030">a</span><span class="op" id="5033031">[</span><span class="ident" id="5033032">j</span><span class="op" id="5033033">]</span><span class="op" id="5033034">,</span>&nbsp;<span class="ident" id="5033036">s</span><span class="op" id="5033037">.</span><span class="ident" id="5033038">a</span><span class="op" id="5033039">[</span><span class="ident" id="5033040">i</span><span class="op" id="5033041">]</span>&nbsp;<span class="op" id="5033043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="5033046">func</span>&nbsp;<span class="ident" id="5033051">sortByFreq</span><span class="op" id="5033061">(</span><span class="ident" id="5033062">a</span>&nbsp;<span class="op" id="5033064">[</span><span class="op" id="5033065">]</span><span class="ident" id="5033066">literalNode</span><span class="op" id="5033077">)</span>&nbsp;<span class="op" id="5033079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033082">s</span>&nbsp;<span class="op" id="5033084">:=</span>&nbsp;<span class="op" id="5033087">&amp;</span><span class="ident" id="5033088">literalNodeSorter</span><span class="op" id="5033105">{</span><span class="ident" id="5033106">a</span><span class="op" id="5033107">,</span>&nbsp;<span class="keyword" id="5033109">func</span><span class="op" id="5033113">(</span><span class="ident" id="5033114">i</span><span class="op" id="5033115">,</span>&nbsp;<span class="ident" id="5033117">j</span>&nbsp;<span class="builtintype" id="5033119">int</span><span class="op" id="5033122">)</span>&nbsp;<span class="builtintype" id="5033124">bool</span>&nbsp;<span class="op" id="5033129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033133">if</span>&nbsp;<span class="ident" id="5033136">a</span><span class="op" id="5033137">[</span><span class="ident" id="5033138">i</span><span class="op" id="5033139">]</span><span class="op" id="5033140">.</span><span class="ident" id="5033141">freq</span>&nbsp;<span class="op" id="5033146">==</span>&nbsp;<span class="ident" id="5033149">a</span><span class="op" id="5033150">[</span><span class="ident" id="5033151">j</span><span class="op" id="5033152">]</span><span class="op" id="5033153">.</span><span class="ident" id="5033154">freq</span>&nbsp;<span class="op" id="5033159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033164">return</span>&nbsp;<span class="ident" id="5033171">a</span><span class="op" id="5033172">[</span><span class="ident" id="5033173">i</span><span class="op" id="5033174">]</span><span class="op" id="5033175">.</span><span class="ident" id="5033176">literal</span>&nbsp;<span class="op" id="5033184">&lt;</span>&nbsp;<span class="ident" id="5033186">a</span><span class="op" id="5033187">[</span><span class="ident" id="5033188">j</span><span class="op" id="5033189">]</span><span class="op" id="5033190">.</span><span class="ident" id="5033191">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033201">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033205">return</span>&nbsp;<span class="ident" id="5033212">a</span><span class="op" id="5033213">[</span><span class="ident" id="5033214">i</span><span class="op" id="5033215">]</span><span class="op" id="5033216">.</span><span class="ident" id="5033217">freq</span>&nbsp;<span class="op" id="5033222">&lt;</span>&nbsp;<span class="ident" id="5033224">a</span><span class="op" id="5033225">[</span><span class="ident" id="5033226">j</span><span class="op" id="5033227">]</span><span class="op" id="5033228">.</span><span class="ident" id="5033229">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033235">}</span><span class="op" id="5033236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033239">sort</span><span class="op" id="5033243">.</span><span class="ident" id="5033244">Sort</span><span class="op" id="5033248">(</span><span class="ident" id="5033249">s</span><span class="op" id="5033250">)</span><br>
<span class="lineno"></span><span class="op" id="5033252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="5033255">func</span>&nbsp;<span class="ident" id="5033260">sortByLiteral</span><span class="op" id="5033273">(</span><span class="ident" id="5033274">a</span>&nbsp;<span class="op" id="5033276">[</span><span class="op" id="5033277">]</span><span class="ident" id="5033278">literalNode</span><span class="op" id="5033289">)</span>&nbsp;<span class="op" id="5033291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033294">s</span>&nbsp;<span class="op" id="5033296">:=</span>&nbsp;<span class="op" id="5033299">&amp;</span><span class="ident" id="5033300">literalNodeSorter</span><span class="op" id="5033317">{</span><span class="ident" id="5033318">a</span><span class="op" id="5033319">,</span>&nbsp;<span class="keyword" id="5033321">func</span><span class="op" id="5033325">(</span><span class="ident" id="5033326">i</span><span class="op" id="5033327">,</span>&nbsp;<span class="ident" id="5033329">j</span>&nbsp;<span class="builtintype" id="5033331">int</span><span class="op" id="5033334">)</span>&nbsp;<span class="builtintype" id="5033336">bool</span>&nbsp;<span class="op" id="5033341">{</span>&nbsp;<span class="keyword" id="5033343">return</span>&nbsp;<span class="ident" id="5033350">a</span><span class="op" id="5033351">[</span><span class="ident" id="5033352">i</span><span class="op" id="5033353">]</span><span class="op" id="5033354">.</span><span class="ident" id="5033355">literal</span>&nbsp;<span class="op" id="5033363">&lt;</span>&nbsp;<span class="ident" id="5033365">a</span><span class="op" id="5033366">[</span><span class="ident" id="5033367">j</span><span class="op" id="5033368">]</span><span class="op" id="5033369">.</span><span class="ident" id="5033370">literal</span>&nbsp;<span class="op" id="5033378">}</span><span class="op" id="5033379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033382">sort</span><span class="op" id="5033386">.</span><span class="ident" id="5033387">Sort</span><span class="op" id="5033391">(</span><span class="ident" id="5033392">s</span><span class="op" id="5033393">)</span><br>
<span class="lineno"></span><span class="op" id="5033395">}</span>
</div>
</body>
</html>
