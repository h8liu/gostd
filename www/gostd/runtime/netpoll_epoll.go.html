<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html" class="current">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1595246">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1595301">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1595355">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1595406">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1595423">package</span>&nbsp;<span class="ident" id="1595431">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1595440">import</span>&nbsp;<span class="string" id="1595447">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1595457">func</span>&nbsp;<span class="ident" id="1595462">epollcreate</span><span class="op" id="1595473">(</span><span class="ident" id="1595474">size</span>&nbsp;<span class="builtintype" id="1595479">int32</span><span class="op" id="1595484">)</span>&nbsp;<span class="builtintype" id="1595486">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1595492">func</span>&nbsp;<span class="ident" id="1595497">epollcreate1</span><span class="op" id="1595509">(</span><span class="ident" id="1595510">flags</span>&nbsp;<span class="builtintype" id="1595516">int32</span><span class="op" id="1595521">)</span>&nbsp;<span class="builtintype" id="1595523">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1595530">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1595544">func</span>&nbsp;<span class="ident" id="1595549">epollctl</span><span class="op" id="1595557">(</span><span class="ident" id="1595558">epfd</span><span class="op" id="1595562">,</span>&nbsp;<span class="ident" id="1595564">op</span><span class="op" id="1595566">,</span>&nbsp;<span class="ident" id="1595568">fd</span>&nbsp;<span class="builtintype" id="1595571">int32</span><span class="op" id="1595576">,</span>&nbsp;<span class="ident" id="1595578">ev</span>&nbsp;<span class="op" id="1595581">*</span><span class="ident" id="1595582">epollevent</span><span class="op" id="1595592">)</span>&nbsp;<span class="builtintype" id="1595594">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1595601">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1595615">func</span>&nbsp;<span class="ident" id="1595620">epollwait</span><span class="op" id="1595629">(</span><span class="ident" id="1595630">epfd</span>&nbsp;<span class="builtintype" id="1595635">int32</span><span class="op" id="1595640">,</span>&nbsp;<span class="ident" id="1595642">ev</span>&nbsp;<span class="op" id="1595645">*</span><span class="ident" id="1595646">epollevent</span><span class="op" id="1595656">,</span>&nbsp;<span class="ident" id="1595658">nev</span><span class="op" id="1595661">,</span>&nbsp;<span class="ident" id="1595663">timeout</span>&nbsp;<span class="builtintype" id="1595671">int32</span><span class="op" id="1595676">)</span>&nbsp;<span class="builtintype" id="1595678">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1595684">func</span>&nbsp;<span class="ident" id="1595689">closeonexec</span><span class="op" id="1595700">(</span><span class="ident" id="1595701">fd</span>&nbsp;<span class="builtintype" id="1595704">int32</span><span class="op" id="1595709">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1595712">var</span>&nbsp;<span class="op" id="1595716">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595719">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1595734">int32</span>&nbsp;<span class="op" id="1595740">=</span>&nbsp;<span class="op" id="1595742">-</span><span class="num" id="1595743">1</span>&nbsp;<span class="comment" id="1595745">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595766">netpolllasterr</span>&nbsp;<span class="builtintype" id="1595781">int32</span><br>
<span class="lineno"></span><span class="op" id="1595787">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1595790">func</span>&nbsp;<span class="ident" id="1595795">netpollinit</span><span class="op" id="1595806">(</span><span class="op" id="1595807">)</span>&nbsp;<span class="op" id="1595809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595812">epfd</span>&nbsp;<span class="op" id="1595817">=</span>&nbsp;<span class="ident" id="1595819">epollcreate1</span><span class="op" id="1595831">(</span><span class="ident" id="1595832">_EPOLL_CLOEXEC</span><span class="op" id="1595846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595849">if</span>&nbsp;<span class="ident" id="1595852">epfd</span>&nbsp;<span class="op" id="1595857">&gt;=</span>&nbsp;<span class="num" id="1595860">0</span>&nbsp;<span class="op" id="1595862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595866">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595877">epfd</span>&nbsp;<span class="op" id="1595882">=</span>&nbsp;<span class="ident" id="1595884">epollcreate</span><span class="op" id="1595895">(</span><span class="num" id="1595896">1024</span><span class="op" id="1595900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595903">if</span>&nbsp;<span class="ident" id="1595906">epfd</span>&nbsp;<span class="op" id="1595911">&gt;=</span>&nbsp;<span class="num" id="1595914">0</span>&nbsp;<span class="op" id="1595916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595920">closeonexec</span><span class="op" id="1595931">(</span><span class="ident" id="1595932">epfd</span><span class="op" id="1595936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595940">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1595951">println</span><span class="op" id="1595958">(</span><span class="string" id="1595959">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1596007">,</span>&nbsp;<span class="op" id="1596009">-</span><span class="ident" id="1596010">epfd</span><span class="op" id="1596014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596017">gothrow</span><span class="op" id="1596024">(</span><span class="string" id="1596025">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1596067">)</span><br>
<span class="lineno"></span><span class="op" id="1596069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1596072">func</span>&nbsp;<span class="ident" id="1596077">netpollopen</span><span class="op" id="1596088">(</span><span class="ident" id="1596089">fd</span>&nbsp;<span class="builtintype" id="1596092">uintptr</span><span class="op" id="1596099">,</span>&nbsp;<span class="ident" id="1596101">pd</span>&nbsp;<span class="op" id="1596104">*</span><span class="ident" id="1596105">pollDesc</span><span class="op" id="1596113">)</span>&nbsp;<span class="builtintype" id="1596115">int32</span>&nbsp;<span class="op" id="1596121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596124">var</span>&nbsp;<span class="ident" id="1596128">ev</span>&nbsp;<span class="ident" id="1596131">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596143">ev</span><span class="op" id="1596145">.</span><span class="ident" id="1596146">events</span>&nbsp;<span class="op" id="1596153">=</span>&nbsp;<span class="ident" id="1596155">_EPOLLIN</span>&nbsp;<span class="op" id="1596164">|</span>&nbsp;<span class="ident" id="1596166">_EPOLLOUT</span>&nbsp;<span class="op" id="1596176">|</span>&nbsp;<span class="ident" id="1596178">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1596190">|</span>&nbsp;<span class="ident" id="1596192">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596202">*</span><span class="op" id="1596203">(</span><span class="op" id="1596204">*</span><span class="op" id="1596205">*</span><span class="ident" id="1596206">pollDesc</span><span class="op" id="1596214">)</span><span class="op" id="1596215">(</span><span class="ident" id="1596216">unsafe</span><span class="op" id="1596222">.</span><span class="ident" id="1596223">Pointer</span><span class="op" id="1596230">(</span><span class="op" id="1596231">&amp;</span><span class="ident" id="1596232">ev</span><span class="op" id="1596234">.</span><span class="ident" id="1596235">data</span><span class="op" id="1596239">)</span><span class="op" id="1596240">)</span>&nbsp;<span class="op" id="1596242">=</span>&nbsp;<span class="ident" id="1596244">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596248">return</span>&nbsp;<span class="op" id="1596255">-</span><span class="ident" id="1596256">epollctl</span><span class="op" id="1596264">(</span><span class="ident" id="1596265">epfd</span><span class="op" id="1596269">,</span>&nbsp;<span class="ident" id="1596271">_EPOLL_CTL_ADD</span><span class="op" id="1596285">,</span>&nbsp;<span class="builtintype" id="1596287">int32</span><span class="op" id="1596292">(</span><span class="ident" id="1596293">fd</span><span class="op" id="1596295">)</span><span class="op" id="1596296">,</span>&nbsp;<span class="op" id="1596298">&amp;</span><span class="ident" id="1596299">ev</span><span class="op" id="1596301">)</span><br>
<span class="lineno">45</span><span class="op" id="1596303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1596306">func</span>&nbsp;<span class="ident" id="1596311">netpollclose</span><span class="op" id="1596323">(</span><span class="ident" id="1596324">fd</span>&nbsp;<span class="builtintype" id="1596327">uintptr</span><span class="op" id="1596334">)</span>&nbsp;<span class="builtintype" id="1596336">int32</span>&nbsp;<span class="op" id="1596342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596345">var</span>&nbsp;<span class="ident" id="1596349">ev</span>&nbsp;<span class="ident" id="1596352">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596364">return</span>&nbsp;<span class="op" id="1596371">-</span><span class="ident" id="1596372">epollctl</span><span class="op" id="1596380">(</span><span class="ident" id="1596381">epfd</span><span class="op" id="1596385">,</span>&nbsp;<span class="ident" id="1596387">_EPOLL_CTL_DEL</span><span class="op" id="1596401">,</span>&nbsp;<span class="builtintype" id="1596403">int32</span><span class="op" id="1596408">(</span><span class="ident" id="1596409">fd</span><span class="op" id="1596411">)</span><span class="op" id="1596412">,</span>&nbsp;<span class="op" id="1596414">&amp;</span><span class="ident" id="1596415">ev</span><span class="op" id="1596417">)</span><br>
<span class="lineno">50</span><span class="op" id="1596419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1596422">func</span>&nbsp;<span class="ident" id="1596427">netpollarm</span><span class="op" id="1596437">(</span><span class="ident" id="1596438">pd</span>&nbsp;<span class="op" id="1596441">*</span><span class="ident" id="1596442">pollDesc</span><span class="op" id="1596450">,</span>&nbsp;<span class="ident" id="1596452">mode</span>&nbsp;<span class="builtintype" id="1596457">int</span><span class="op" id="1596460">)</span>&nbsp;<span class="op" id="1596462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596465">gothrow</span><span class="op" id="1596472">(</span><span class="string" id="1596473">&#34;unused&#34;</span><span class="op" id="1596481">)</span><br>
<span class="lineno"></span><span class="op" id="1596483">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1596486">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1596525">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1596576">func</span>&nbsp;<span class="ident" id="1596581">netpoll</span><span class="op" id="1596588">(</span><span class="ident" id="1596589">block</span>&nbsp;<span class="builtintype" id="1596595">bool</span><span class="op" id="1596599">)</span>&nbsp;<span class="op" id="1596601">(</span><span class="ident" id="1596602">gp</span>&nbsp;<span class="op" id="1596605">*</span><span class="ident" id="1596606">g</span><span class="op" id="1596607">)</span>&nbsp;<span class="op" id="1596609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596612">if</span>&nbsp;<span class="ident" id="1596615">epfd</span>&nbsp;<span class="op" id="1596620">==</span>&nbsp;<span class="op" id="1596623">-</span><span class="num" id="1596624">1</span>&nbsp;<span class="op" id="1596626">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596630">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596641">waitms</span>&nbsp;<span class="op" id="1596648">:=</span>&nbsp;<span class="builtintype" id="1596651">int32</span><span class="op" id="1596656">(</span><span class="op" id="1596657">-</span><span class="num" id="1596658">1</span><span class="op" id="1596659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596662">if</span>&nbsp;<span class="op" id="1596665">!</span><span class="ident" id="1596666">block</span>&nbsp;<span class="op" id="1596672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596676">waitms</span>&nbsp;<span class="op" id="1596683">=</span>&nbsp;<span class="num" id="1596685">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596691">var</span>&nbsp;<span class="ident" id="1596695">events</span>&nbsp;<span class="op" id="1596702">[</span><span class="num" id="1596703">128</span><span class="op" id="1596706">]</span><span class="ident" id="1596707">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1596718">retry</span><span class="op" id="1596723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596726">n</span>&nbsp;<span class="op" id="1596728">:=</span>&nbsp;<span class="ident" id="1596731">epollwait</span><span class="op" id="1596740">(</span><span class="ident" id="1596741">epfd</span><span class="op" id="1596745">,</span>&nbsp;<span class="op" id="1596747">&amp;</span><span class="ident" id="1596748">events</span><span class="op" id="1596754">[</span><span class="num" id="1596755">0</span><span class="op" id="1596756">]</span><span class="op" id="1596757">,</span>&nbsp;<span class="builtintype" id="1596759">int32</span><span class="op" id="1596764">(</span><span class="builtinfunc" id="1596765">len</span><span class="op" id="1596768">(</span><span class="ident" id="1596769">events</span><span class="op" id="1596775">)</span><span class="op" id="1596776">)</span><span class="op" id="1596777">,</span>&nbsp;<span class="ident" id="1596779">waitms</span><span class="op" id="1596785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596788">if</span>&nbsp;<span class="ident" id="1596791">n</span>&nbsp;<span class="op" id="1596793">&lt;</span>&nbsp;<span class="num" id="1596795">0</span>&nbsp;<span class="op" id="1596797">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596801">if</span>&nbsp;<span class="ident" id="1596804">n</span>&nbsp;<span class="op" id="1596806">!=</span>&nbsp;<span class="op" id="1596809">-</span><span class="ident" id="1596810">_EINTR</span>&nbsp;<span class="op" id="1596817">&amp;&amp;</span>&nbsp;<span class="ident" id="1596820">n</span>&nbsp;<span class="op" id="1596822">!=</span>&nbsp;<span class="ident" id="1596825">netpolllasterr</span>&nbsp;<span class="op" id="1596840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596845">netpolllasterr</span>&nbsp;<span class="op" id="1596860">=</span>&nbsp;<span class="ident" id="1596862">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1596867">println</span><span class="op" id="1596874">(</span><span class="string" id="1596875">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1596901">,</span>&nbsp;<span class="ident" id="1596903">epfd</span><span class="op" id="1596907">,</span>&nbsp;<span class="string" id="1596909">&#34;failed&nbsp;with&#34;</span><span class="op" id="1596922">,</span>&nbsp;<span class="op" id="1596924">-</span><span class="ident" id="1596925">n</span><span class="op" id="1596926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596934">goto</span>&nbsp;<span class="ident" id="1596939">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596949">for</span>&nbsp;<span class="ident" id="1596953">i</span>&nbsp;<span class="op" id="1596955">:=</span>&nbsp;<span class="builtintype" id="1596958">int32</span><span class="op" id="1596963">(</span><span class="num" id="1596964">0</span><span class="op" id="1596965">)</span><span class="op" id="1596966">;</span>&nbsp;<span class="ident" id="1596968">i</span>&nbsp;<span class="op" id="1596970">&lt;</span>&nbsp;<span class="ident" id="1596972">n</span><span class="op" id="1596973">;</span>&nbsp;<span class="ident" id="1596975">i</span><span class="op" id="1596976">++</span>&nbsp;<span class="op" id="1596979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596983">ev</span>&nbsp;<span class="op" id="1596986">:=</span>&nbsp;<span class="op" id="1596989">&amp;</span><span class="ident" id="1596990">events</span><span class="op" id="1596996">[</span><span class="ident" id="1596997">i</span><span class="op" id="1596998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597002">if</span>&nbsp;<span class="ident" id="1597005">ev</span><span class="op" id="1597007">.</span><span class="ident" id="1597008">events</span>&nbsp;<span class="op" id="1597015">==</span>&nbsp;<span class="num" id="1597018">0</span>&nbsp;<span class="op" id="1597020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597025">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597040">var</span>&nbsp;<span class="ident" id="1597044">mode</span>&nbsp;<span class="builtintype" id="1597049">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597057">if</span>&nbsp;<span class="ident" id="1597060">ev</span><span class="op" id="1597062">.</span><span class="ident" id="1597063">events</span><span class="op" id="1597069">&amp;</span><span class="op" id="1597070">(</span><span class="ident" id="1597071">_EPOLLIN</span><span class="op" id="1597079">|</span><span class="ident" id="1597080">_EPOLLRDHUP</span><span class="op" id="1597091">|</span><span class="ident" id="1597092">_EPOLLHUP</span><span class="op" id="1597101">|</span><span class="ident" id="1597102">_EPOLLERR</span><span class="op" id="1597111">)</span>&nbsp;<span class="op" id="1597113">!=</span>&nbsp;<span class="num" id="1597116">0</span>&nbsp;<span class="op" id="1597118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597123">mode</span>&nbsp;<span class="op" id="1597128">+=</span>&nbsp;<span class="string" id="1597131">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597137">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597141">if</span>&nbsp;<span class="ident" id="1597144">ev</span><span class="op" id="1597146">.</span><span class="ident" id="1597147">events</span><span class="op" id="1597153">&amp;</span><span class="op" id="1597154">(</span><span class="ident" id="1597155">_EPOLLOUT</span><span class="op" id="1597164">|</span><span class="ident" id="1597165">_EPOLLHUP</span><span class="op" id="1597174">|</span><span class="ident" id="1597175">_EPOLLERR</span><span class="op" id="1597184">)</span>&nbsp;<span class="op" id="1597186">!=</span>&nbsp;<span class="num" id="1597189">0</span>&nbsp;<span class="op" id="1597191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597196">mode</span>&nbsp;<span class="op" id="1597201">+=</span>&nbsp;<span class="string" id="1597204">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597214">if</span>&nbsp;<span class="ident" id="1597217">mode</span>&nbsp;<span class="op" id="1597222">!=</span>&nbsp;<span class="num" id="1597225">0</span>&nbsp;<span class="op" id="1597227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597232">pd</span>&nbsp;<span class="op" id="1597235">:=</span>&nbsp;<span class="op" id="1597238">*</span><span class="op" id="1597239">(</span><span class="op" id="1597240">*</span><span class="op" id="1597241">*</span><span class="ident" id="1597242">pollDesc</span><span class="op" id="1597250">)</span><span class="op" id="1597251">(</span><span class="ident" id="1597252">unsafe</span><span class="op" id="1597258">.</span><span class="ident" id="1597259">Pointer</span><span class="op" id="1597266">(</span><span class="op" id="1597267">&amp;</span><span class="ident" id="1597268">ev</span><span class="op" id="1597270">.</span><span class="ident" id="1597271">data</span><span class="op" id="1597275">)</span><span class="op" id="1597276">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597281">netpollready</span><span class="op" id="1597293">(</span><span class="op" id="1597294">(</span><span class="op" id="1597295">*</span><span class="op" id="1597296">*</span><span class="ident" id="1597297">g</span><span class="op" id="1597298">)</span><span class="op" id="1597299">(</span><span class="ident" id="1597300">noescape</span><span class="op" id="1597308">(</span><span class="ident" id="1597309">unsafe</span><span class="op" id="1597315">.</span><span class="ident" id="1597316">Pointer</span><span class="op" id="1597323">(</span><span class="op" id="1597324">&amp;</span><span class="ident" id="1597325">gp</span><span class="op" id="1597327">)</span><span class="op" id="1597328">)</span><span class="op" id="1597329">)</span><span class="op" id="1597330">,</span>&nbsp;<span class="ident" id="1597332">pd</span><span class="op" id="1597334">,</span>&nbsp;<span class="ident" id="1597336">mode</span><span class="op" id="1597340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597350">if</span>&nbsp;<span class="ident" id="1597353">block</span>&nbsp;<span class="op" id="1597359">&amp;&amp;</span>&nbsp;<span class="ident" id="1597362">gp</span>&nbsp;<span class="op" id="1597365">==</span>&nbsp;<span class="ident" id="1597368">nil</span>&nbsp;<span class="op" id="1597372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597376">goto</span>&nbsp;<span class="ident" id="1597381">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597391">return</span>&nbsp;<span class="ident" id="1597398">gp</span><br>
<span class="lineno"></span><span class="op" id="1597401">}</span>
</div>
</body>
</html>
