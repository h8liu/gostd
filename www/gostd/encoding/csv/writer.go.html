<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6069592">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6069647">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6069701">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6069752">package</span>&nbsp;<span class="ident" id="6069760">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6069765">import</span>&nbsp;<span class="op" id="6069772">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069775">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069784">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069790">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069801">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069812">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6069827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6069830">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6069880">//</span><br>
<span class="lineno"></span><span class="comment" id="6069883">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6069952">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6070028">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6070108">//</span><br>
<span class="lineno"></span><span class="comment" id="6070111">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6070144">//</span><br>
<span class="lineno"></span><span class="comment" id="6070147">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6070223">type</span>&nbsp;<span class="ident" id="6070228">Writer</span>&nbsp;<span class="keyword" id="6070235">struct</span>&nbsp;<span class="op" id="6070242">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070245">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6070253">rune</span>&nbsp;<span class="comment" id="6070258">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070304">UseCRLF</span>&nbsp;<span class="builtintype" id="6070312">bool</span>&nbsp;<span class="comment" id="6070317">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070361">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070369">*</span><span class="ident" id="6070370">bufio</span><span class="op" id="6070375">.</span><span class="ident" id="6070376">Writer</span><br>
<span class="lineno"></span><span class="op" id="6070383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6070386">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6070438">func</span>&nbsp;<span class="ident" id="6070443">NewWriter</span><span class="op" id="6070452">(</span><span class="ident" id="6070453">w</span>&nbsp;<span class="ident" id="6070455">io</span><span class="op" id="6070457">.</span><span class="ident" id="6070458">Writer</span><span class="op" id="6070464">)</span>&nbsp;<span class="op" id="6070466">*</span><span class="ident" id="6070467">Writer</span>&nbsp;<span class="op" id="6070474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070477">return</span>&nbsp;<span class="op" id="6070484">&amp;</span><span class="ident" id="6070485">Writer</span><span class="op" id="6070491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070495">Comma</span><span class="op" id="6070500">:</span>&nbsp;<span class="string" id="6070502">&#39;,&#39;</span><span class="op" id="6070505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070509">w</span><span class="op" id="6070510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070516">bufio</span><span class="op" id="6070521">.</span><span class="ident" id="6070522">NewWriter</span><span class="op" id="6070531">(</span><span class="ident" id="6070532">w</span><span class="op" id="6070533">)</span><span class="op" id="6070534">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070537">}</span><br>
<span class="lineno"></span><span class="op" id="6070539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070542">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6070618">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6070686">func</span>&nbsp;<span class="op" id="6070691">(</span><span class="ident" id="6070692">w</span>&nbsp;<span class="op" id="6070694">*</span><span class="ident" id="6070695">Writer</span><span class="op" id="6070701">)</span>&nbsp;<span class="ident" id="6070703">Write</span><span class="op" id="6070708">(</span><span class="ident" id="6070709">record</span>&nbsp;<span class="op" id="6070716">[</span><span class="op" id="6070717">]</span><span class="builtintype" id="6070718">string</span><span class="op" id="6070724">)</span>&nbsp;<span class="op" id="6070726">(</span><span class="ident" id="6070727">err</span>&nbsp;<span class="builtintype" id="6070731">error</span><span class="op" id="6070736">)</span>&nbsp;<span class="op" id="6070738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070741">for</span>&nbsp;<span class="ident" id="6070745">n</span><span class="op" id="6070746">,</span>&nbsp;<span class="ident" id="6070748">field</span>&nbsp;<span class="op" id="6070754">:=</span>&nbsp;<span class="keyword" id="6070757">range</span>&nbsp;<span class="ident" id="6070763">record</span>&nbsp;<span class="op" id="6070770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070774">if</span>&nbsp;<span class="ident" id="6070777">n</span>&nbsp;<span class="op" id="6070779">&gt;</span>&nbsp;<span class="num" id="6070781">0</span>&nbsp;<span class="op" id="6070783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070788">if</span>&nbsp;<span class="ident" id="6070791">_</span><span class="op" id="6070792">,</span>&nbsp;<span class="ident" id="6070794">err</span>&nbsp;<span class="op" id="6070798">=</span>&nbsp;<span class="ident" id="6070800">w</span><span class="op" id="6070801">.</span><span class="ident" id="6070802">w</span><span class="op" id="6070803">.</span><span class="ident" id="6070804">WriteRune</span><span class="op" id="6070813">(</span><span class="ident" id="6070814">w</span><span class="op" id="6070815">.</span><span class="ident" id="6070816">Comma</span><span class="op" id="6070821">)</span><span class="op" id="6070822">;</span>&nbsp;<span class="ident" id="6070824">err</span>&nbsp;<span class="op" id="6070828">!=</span>&nbsp;<span class="ident" id="6070831">nil</span>&nbsp;<span class="op" id="6070835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070841">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070860">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070915">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070972">if</span>&nbsp;<span class="op" id="6070975">!</span><span class="ident" id="6070976">w</span><span class="op" id="6070977">.</span><span class="ident" id="6070978">fieldNeedsQuotes</span><span class="op" id="6070994">(</span><span class="ident" id="6070995">field</span><span class="op" id="6071000">)</span>&nbsp;<span class="op" id="6071002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071007">if</span>&nbsp;<span class="ident" id="6071010">_</span><span class="op" id="6071011">,</span>&nbsp;<span class="ident" id="6071013">err</span>&nbsp;<span class="op" id="6071017">=</span>&nbsp;<span class="ident" id="6071019">w</span><span class="op" id="6071020">.</span><span class="ident" id="6071021">w</span><span class="op" id="6071022">.</span><span class="ident" id="6071023">WriteString</span><span class="op" id="6071034">(</span><span class="ident" id="6071035">field</span><span class="op" id="6071040">)</span><span class="op" id="6071041">;</span>&nbsp;<span class="ident" id="6071043">err</span>&nbsp;<span class="op" id="6071047">!=</span>&nbsp;<span class="ident" id="6071050">nil</span>&nbsp;<span class="op" id="6071054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071060">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071075">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071090">if</span>&nbsp;<span class="ident" id="6071093">err</span>&nbsp;<span class="op" id="6071097">=</span>&nbsp;<span class="ident" id="6071099">w</span><span class="op" id="6071100">.</span><span class="ident" id="6071101">w</span><span class="op" id="6071102">.</span><span class="ident" id="6071103">WriteByte</span><span class="op" id="6071112">(</span><span class="string" id="6071113">&#39;&#34;&#39;</span><span class="op" id="6071116">)</span><span class="op" id="6071117">;</span>&nbsp;<span class="ident" id="6071119">err</span>&nbsp;<span class="op" id="6071123">!=</span>&nbsp;<span class="ident" id="6071126">nil</span>&nbsp;<span class="op" id="6071130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071135">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071149">for</span>&nbsp;<span class="ident" id="6071153">_</span><span class="op" id="6071154">,</span>&nbsp;<span class="ident" id="6071156">r1</span>&nbsp;<span class="op" id="6071159">:=</span>&nbsp;<span class="keyword" id="6071162">range</span>&nbsp;<span class="ident" id="6071168">field</span>&nbsp;<span class="op" id="6071174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071179">switch</span>&nbsp;<span class="ident" id="6071186">r1</span>&nbsp;<span class="op" id="6071189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071194">case</span>&nbsp;<span class="string" id="6071199">&#39;&#34;&#39;</span><span class="op" id="6071202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071208">_</span><span class="op" id="6071209">,</span>&nbsp;<span class="ident" id="6071211">err</span>&nbsp;<span class="op" id="6071215">=</span>&nbsp;<span class="ident" id="6071217">w</span><span class="op" id="6071218">.</span><span class="ident" id="6071219">w</span><span class="op" id="6071220">.</span><span class="ident" id="6071221">WriteString</span><span class="op" id="6071232">(</span><span class="string" id="6071233">`&#34;&#34;`</span><span class="op" id="6071237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071242">case</span>&nbsp;<span class="string" id="6071247">&#39;\r&#39;</span><span class="op" id="6071251">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071257">if</span>&nbsp;<span class="op" id="6071260">!</span><span class="ident" id="6071261">w</span><span class="op" id="6071262">.</span><span class="ident" id="6071263">UseCRLF</span>&nbsp;<span class="op" id="6071271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071278">err</span>&nbsp;<span class="op" id="6071282">=</span>&nbsp;<span class="ident" id="6071284">w</span><span class="op" id="6071285">.</span><span class="ident" id="6071286">w</span><span class="op" id="6071287">.</span><span class="ident" id="6071288">WriteByte</span><span class="op" id="6071297">(</span><span class="string" id="6071298">&#39;\r&#39;</span><span class="op" id="6071302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071313">case</span>&nbsp;<span class="string" id="6071318">&#39;\n&#39;</span><span class="op" id="6071322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071328">if</span>&nbsp;<span class="ident" id="6071331">w</span><span class="op" id="6071332">.</span><span class="ident" id="6071333">UseCRLF</span>&nbsp;<span class="op" id="6071341">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071348">_</span><span class="op" id="6071349">,</span>&nbsp;<span class="ident" id="6071351">err</span>&nbsp;<span class="op" id="6071355">=</span>&nbsp;<span class="ident" id="6071357">w</span><span class="op" id="6071358">.</span><span class="ident" id="6071359">w</span><span class="op" id="6071360">.</span><span class="ident" id="6071361">WriteString</span><span class="op" id="6071372">(</span><span class="string" id="6071373">&#34;\r\n&#34;</span><span class="op" id="6071379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071385">}</span>&nbsp;<span class="keyword" id="6071387">else</span>&nbsp;<span class="op" id="6071392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071399">err</span>&nbsp;<span class="op" id="6071403">=</span>&nbsp;<span class="ident" id="6071405">w</span><span class="op" id="6071406">.</span><span class="ident" id="6071407">w</span><span class="op" id="6071408">.</span><span class="ident" id="6071409">WriteByte</span><span class="op" id="6071418">(</span><span class="string" id="6071419">&#39;\n&#39;</span><span class="op" id="6071423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071434">default</span><span class="op" id="6071441">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071447">_</span><span class="op" id="6071448">,</span>&nbsp;<span class="ident" id="6071450">err</span>&nbsp;<span class="op" id="6071454">=</span>&nbsp;<span class="ident" id="6071456">w</span><span class="op" id="6071457">.</span><span class="ident" id="6071458">w</span><span class="op" id="6071459">.</span><span class="ident" id="6071460">WriteRune</span><span class="op" id="6071469">(</span><span class="ident" id="6071470">r1</span><span class="op" id="6071472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071482">if</span>&nbsp;<span class="ident" id="6071485">err</span>&nbsp;<span class="op" id="6071489">!=</span>&nbsp;<span class="ident" id="6071492">nil</span>&nbsp;<span class="op" id="6071496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071502">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071512">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071521">if</span>&nbsp;<span class="ident" id="6071524">err</span>&nbsp;<span class="op" id="6071528">=</span>&nbsp;<span class="ident" id="6071530">w</span><span class="op" id="6071531">.</span><span class="ident" id="6071532">w</span><span class="op" id="6071533">.</span><span class="ident" id="6071534">WriteByte</span><span class="op" id="6071543">(</span><span class="string" id="6071544">&#39;&#34;&#39;</span><span class="op" id="6071547">)</span><span class="op" id="6071548">;</span>&nbsp;<span class="ident" id="6071550">err</span>&nbsp;<span class="op" id="6071554">!=</span>&nbsp;<span class="ident" id="6071557">nil</span>&nbsp;<span class="op" id="6071561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071566">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071575">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071581">if</span>&nbsp;<span class="ident" id="6071584">w</span><span class="op" id="6071585">.</span><span class="ident" id="6071586">UseCRLF</span>&nbsp;<span class="op" id="6071594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071598">_</span><span class="op" id="6071599">,</span>&nbsp;<span class="ident" id="6071601">err</span>&nbsp;<span class="op" id="6071605">=</span>&nbsp;<span class="ident" id="6071607">w</span><span class="op" id="6071608">.</span><span class="ident" id="6071609">w</span><span class="op" id="6071610">.</span><span class="ident" id="6071611">WriteString</span><span class="op" id="6071622">(</span><span class="string" id="6071623">&#34;\r\n&#34;</span><span class="op" id="6071629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071632">}</span>&nbsp;<span class="keyword" id="6071634">else</span>&nbsp;<span class="op" id="6071639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071643">err</span>&nbsp;<span class="op" id="6071647">=</span>&nbsp;<span class="ident" id="6071649">w</span><span class="op" id="6071650">.</span><span class="ident" id="6071651">w</span><span class="op" id="6071652">.</span><span class="ident" id="6071653">WriteByte</span><span class="op" id="6071662">(</span><span class="string" id="6071663">&#39;\n&#39;</span><span class="op" id="6071667">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071673">return</span><br>
<span class="lineno"></span><span class="op" id="6071680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071683">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6071746">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6071809">func</span>&nbsp;<span class="op" id="6071814">(</span><span class="ident" id="6071815">w</span>&nbsp;<span class="op" id="6071817">*</span><span class="ident" id="6071818">Writer</span><span class="op" id="6071824">)</span>&nbsp;<span class="ident" id="6071826">Flush</span><span class="op" id="6071831">(</span><span class="op" id="6071832">)</span>&nbsp;<span class="op" id="6071834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071837">w</span><span class="op" id="6071838">.</span><span class="ident" id="6071839">w</span><span class="op" id="6071840">.</span><span class="ident" id="6071841">Flush</span><span class="op" id="6071846">(</span><span class="op" id="6071847">)</span><br>
<span class="lineno"></span><span class="op" id="6071849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6071852">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6071931">func</span>&nbsp;<span class="op" id="6071936">(</span><span class="ident" id="6071937">w</span>&nbsp;<span class="op" id="6071939">*</span><span class="ident" id="6071940">Writer</span><span class="op" id="6071946">)</span>&nbsp;<span class="ident" id="6071948">Error</span><span class="op" id="6071953">(</span><span class="op" id="6071954">)</span>&nbsp;<span class="builtintype" id="6071956">error</span>&nbsp;<span class="op" id="6071962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071965">_</span><span class="op" id="6071966">,</span>&nbsp;<span class="ident" id="6071968">err</span>&nbsp;<span class="op" id="6071972">:=</span>&nbsp;<span class="ident" id="6071975">w</span><span class="op" id="6071976">.</span><span class="ident" id="6071977">w</span><span class="op" id="6071978">.</span><span class="ident" id="6071979">Write</span><span class="op" id="6071984">(</span><span class="ident" id="6071985">nil</span><span class="op" id="6071988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071991">return</span>&nbsp;<span class="ident" id="6071998">err</span><br>
<span class="lineno"></span><span class="op" id="6072002">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6072005">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6072084">func</span>&nbsp;<span class="op" id="6072089">(</span><span class="ident" id="6072090">w</span>&nbsp;<span class="op" id="6072092">*</span><span class="ident" id="6072093">Writer</span><span class="op" id="6072099">)</span>&nbsp;<span class="ident" id="6072101">WriteAll</span><span class="op" id="6072109">(</span><span class="ident" id="6072110">records</span>&nbsp;<span class="op" id="6072118">[</span><span class="op" id="6072119">]</span><span class="op" id="6072120">[</span><span class="op" id="6072121">]</span><span class="builtintype" id="6072122">string</span><span class="op" id="6072128">)</span>&nbsp;<span class="op" id="6072130">(</span><span class="ident" id="6072131">err</span>&nbsp;<span class="builtintype" id="6072135">error</span><span class="op" id="6072140">)</span>&nbsp;<span class="op" id="6072142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072145">for</span>&nbsp;<span class="ident" id="6072149">_</span><span class="op" id="6072150">,</span>&nbsp;<span class="ident" id="6072152">record</span>&nbsp;<span class="op" id="6072159">:=</span>&nbsp;<span class="keyword" id="6072162">range</span>&nbsp;<span class="ident" id="6072168">records</span>&nbsp;<span class="op" id="6072176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072180">err</span>&nbsp;<span class="op" id="6072184">=</span>&nbsp;<span class="ident" id="6072186">w</span><span class="op" id="6072187">.</span><span class="ident" id="6072188">Write</span><span class="op" id="6072193">(</span><span class="ident" id="6072194">record</span><span class="op" id="6072200">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072204">if</span>&nbsp;<span class="ident" id="6072207">err</span>&nbsp;<span class="op" id="6072211">!=</span>&nbsp;<span class="ident" id="6072214">nil</span>&nbsp;<span class="op" id="6072218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072223">return</span>&nbsp;<span class="ident" id="6072230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072242">return</span>&nbsp;<span class="ident" id="6072249">w</span><span class="op" id="6072250">.</span><span class="ident" id="6072251">w</span><span class="op" id="6072252">.</span><span class="ident" id="6072253">Flush</span><span class="op" id="6072258">(</span><span class="op" id="6072259">)</span><br>
<span class="lineno">115</span><span class="op" id="6072261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072264">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6072338">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6072398">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6072461">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6072534">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6072610">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6072683">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6072755">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6072824">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6072879">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6072954">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6072994">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6073049">func</span>&nbsp;<span class="op" id="6073054">(</span><span class="ident" id="6073055">w</span>&nbsp;<span class="op" id="6073057">*</span><span class="ident" id="6073058">Writer</span><span class="op" id="6073064">)</span>&nbsp;<span class="ident" id="6073066">fieldNeedsQuotes</span><span class="op" id="6073082">(</span><span class="ident" id="6073083">field</span>&nbsp;<span class="builtintype" id="6073089">string</span><span class="op" id="6073095">)</span>&nbsp;<span class="builtintype" id="6073097">bool</span>&nbsp;<span class="op" id="6073102">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073105">if</span>&nbsp;<span class="ident" id="6073108">field</span>&nbsp;<span class="op" id="6073114">==</span>&nbsp;<span class="string" id="6073117">&#34;&#34;</span>&nbsp;<span class="op" id="6073120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073124">return</span>&nbsp;<span class="builtintype" id="6073131">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073141">if</span>&nbsp;<span class="ident" id="6073144">field</span>&nbsp;<span class="op" id="6073150">==</span>&nbsp;<span class="string" id="6073153">`\.`</span>&nbsp;<span class="op" id="6073158">||</span>&nbsp;<span class="ident" id="6073161">strings</span><span class="op" id="6073168">.</span><span class="ident" id="6073169">IndexRune</span><span class="op" id="6073178">(</span><span class="ident" id="6073179">field</span><span class="op" id="6073184">,</span>&nbsp;<span class="ident" id="6073186">w</span><span class="op" id="6073187">.</span><span class="ident" id="6073188">Comma</span><span class="op" id="6073193">)</span>&nbsp;<span class="op" id="6073195">&gt;=</span>&nbsp;<span class="num" id="6073198">0</span>&nbsp;<span class="op" id="6073200">||</span>&nbsp;<span class="ident" id="6073203">strings</span><span class="op" id="6073210">.</span><span class="ident" id="6073211">IndexAny</span><span class="op" id="6073219">(</span><span class="ident" id="6073220">field</span><span class="op" id="6073225">,</span>&nbsp;<span class="string" id="6073227">&#34;\&#34;\r\n&#34;</span><span class="op" id="6073235">)</span>&nbsp;<span class="op" id="6073237">&gt;=</span>&nbsp;<span class="num" id="6073240">0</span>&nbsp;<span class="op" id="6073242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073246">return</span>&nbsp;<span class="builtintype" id="6073253">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073263">r1</span><span class="op" id="6073265">,</span>&nbsp;<span class="ident" id="6073267">_</span>&nbsp;<span class="op" id="6073269">:=</span>&nbsp;<span class="ident" id="6073272">utf8</span><span class="op" id="6073276">.</span><span class="ident" id="6073277">DecodeRuneInString</span><span class="op" id="6073295">(</span><span class="ident" id="6073296">field</span><span class="op" id="6073301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073304">return</span>&nbsp;<span class="ident" id="6073311">unicode</span><span class="op" id="6073318">.</span><span class="ident" id="6073319">IsSpace</span><span class="op" id="6073326">(</span><span class="ident" id="6073327">r1</span><span class="op" id="6073329">)</span><br>
<span class="lineno"></span><span class="op" id="6073331">}</span>
</div>
</body>
</html>
