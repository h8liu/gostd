<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4798148">package</span>&nbsp;<span class="ident" id="4798156">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4798163">//&nbsp;PageTable&nbsp;describes&nbsp;a&nbsp;page&nbsp;table&nbsp;in&nbsp;a&nbsp;physical&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="4798221">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;translate&nbsp;a&nbsp;virtual&nbsp;memory&nbsp;address&nbsp;into&nbsp;a&nbsp;physical</span><br>
<span class="lineno">5</span><span class="comment" id="4798293">//&nbsp;memory&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4798312">type</span>&nbsp;<span class="ident" id="4798317">pageTable</span>&nbsp;<span class="keyword" id="4798327">struct</span>&nbsp;<span class="op" id="4798334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798337">mem</span>&nbsp;&nbsp;<span class="op" id="4798342">*</span><span class="ident" id="4798343">phyMemory</span>&nbsp;<span class="comment" id="4798353">//&nbsp;the&nbsp;physical&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798377">root</span>&nbsp;<span class="builtintype" id="4798382">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798393">//&nbsp;root&nbsp;address</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798411">//&nbsp;last&nbsp;translation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798432">pte1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798441">ptEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798450">pte2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798459">ptEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798468">pte1Addr</span>&nbsp;<span class="builtintype" id="4798477">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798485">pte2Addr</span>&nbsp;<span class="builtintype" id="4798494">uint32</span><br>
<span class="lineno">15</span><span class="op" id="4798501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4798504">//&nbsp;NewPageTable&nbsp;creates&nbsp;a&nbsp;new&nbsp;page&nbsp;table&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="4798554">//&nbsp;The&nbsp;page&nbsp;table&nbsp;is&nbsp;saved&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="4798590">//&nbsp;If&nbsp;addr&nbsp;is&nbsp;not&nbsp;page&nbsp;size&nbsp;aligned,&nbsp;it&nbsp;is&nbsp;aligned&nbsp;down.</span><br>
<span class="lineno">20</span><span class="keyword" id="4798647">func</span>&nbsp;<span class="ident" id="4798652">newPageTable</span><span class="op" id="4798664">(</span><span class="ident" id="4798665">m</span>&nbsp;<span class="op" id="4798667">*</span><span class="ident" id="4798668">phyMemory</span><span class="op" id="4798677">,</span>&nbsp;<span class="ident" id="4798679">addr</span>&nbsp;<span class="builtintype" id="4798684">uint32</span><span class="op" id="4798690">)</span>&nbsp;<span class="op" id="4798692">*</span><span class="ident" id="4798693">pageTable</span>&nbsp;<span class="op" id="4798703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798706">addr</span>&nbsp;<span class="op" id="4798711">-=</span>&nbsp;<span class="ident" id="4798714">addr</span>&nbsp;<span class="op" id="4798719">%</span>&nbsp;<span class="ident" id="4798721">PageSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798731">ret</span>&nbsp;<span class="op" id="4798735">:=</span>&nbsp;<span class="builtinfunc" id="4798738">new</span><span class="op" id="4798741">(</span><span class="ident" id="4798742">pageTable</span><span class="op" id="4798751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798754">ret</span><span class="op" id="4798757">.</span><span class="ident" id="4798758">mem</span>&nbsp;<span class="op" id="4798762">=</span>&nbsp;<span class="ident" id="4798764">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798767">ret</span><span class="op" id="4798770">.</span><span class="ident" id="4798771">root</span>&nbsp;<span class="op" id="4798776">=</span>&nbsp;<span class="ident" id="4798778">addr</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798785">return</span>&nbsp;<span class="ident" id="4798792">ret</span><br>
<span class="lineno"></span><span class="op" id="4798796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4798799">//&nbsp;bit&nbsp;[31:12]&nbsp;-&gt;&nbsp;a&nbsp;page&nbsp;pointer</span><br>
<span class="lineno">30</span><span class="comment" id="4798832">//</span><br>
<span class="lineno"></span><span class="comment" id="4798835">//&nbsp;bit&nbsp;3:&nbsp;dirty&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4798855">//&nbsp;bit&nbsp;2:&nbsp;use&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4798873">//&nbsp;bit&nbsp;1:&nbsp;readonly&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4798896">//&nbsp;bit&nbsp;0:&nbsp;valid&nbsp;bit</span><br>
<span class="lineno">35</span><span class="keyword" id="4798916">type</span>&nbsp;<span class="ident" id="4798921">ptEntry</span>&nbsp;<span class="builtintype" id="4798929">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4798937">const</span>&nbsp;<span class="op" id="4798943">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798946">pteValid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798958">=</span>&nbsp;<span class="num" id="4798960">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798963">pteReadonly</span>&nbsp;<span class="op" id="4798975">=</span>&nbsp;<span class="num" id="4798977">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798980">pteUse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798992">=</span>&nbsp;<span class="num" id="4798994">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798997">pteDirty</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799009">=</span>&nbsp;<span class="num" id="4799011">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799014">pteUser</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799026">=</span>&nbsp;<span class="num" id="4799028">4</span><br>
<span class="lineno"></span><span class="op" id="4799030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4799033">const</span>&nbsp;<span class="ident" id="4799039">u32one</span>&nbsp;<span class="builtintype" id="4799046">uint32</span>&nbsp;<span class="op" id="4799053">=</span>&nbsp;<span class="num" id="4799055">0x1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4799060">func</span>&nbsp;<span class="op" id="4799065">(</span><span class="ident" id="4799066">pte</span>&nbsp;<span class="ident" id="4799070">ptEntry</span><span class="op" id="4799077">)</span>&nbsp;<span class="ident" id="4799079">testBit</span><span class="op" id="4799086">(</span><span class="ident" id="4799087">n</span>&nbsp;<span class="builtintype" id="4799089">uint</span><span class="op" id="4799093">)</span>&nbsp;<span class="builtintype" id="4799095">bool</span>&nbsp;<span class="op" id="4799100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799103">return</span>&nbsp;<span class="op" id="4799110">(</span><span class="builtintype" id="4799111">uint32</span><span class="op" id="4799117">(</span><span class="ident" id="4799118">pte</span><span class="op" id="4799121">)</span>&nbsp;<span class="op" id="4799123">&amp;</span>&nbsp;<span class="op" id="4799125">(</span><span class="ident" id="4799126">u32one</span>&nbsp;<span class="op" id="4799133">&lt;&lt;</span>&nbsp;<span class="ident" id="4799136">n</span><span class="op" id="4799137">)</span><span class="op" id="4799138">)</span>&nbsp;<span class="op" id="4799140">!=</span>&nbsp;<span class="num" id="4799143">0</span><br>
<span class="lineno"></span><span class="op" id="4799145">}</span><br>
<span class="lineno">50</span><span class="keyword" id="4799147">func</span>&nbsp;<span class="op" id="4799152">(</span><span class="ident" id="4799153">pte</span>&nbsp;<span class="op" id="4799157">*</span><span class="ident" id="4799158">ptEntry</span><span class="op" id="4799165">)</span>&nbsp;<span class="ident" id="4799167">setBit</span><span class="op" id="4799173">(</span><span class="ident" id="4799174">n</span>&nbsp;<span class="builtintype" id="4799176">uint</span><span class="op" id="4799180">)</span>&nbsp;<span class="op" id="4799182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799185">*</span><span class="ident" id="4799186">pte</span>&nbsp;<span class="op" id="4799190">=</span>&nbsp;<span class="ident" id="4799192">ptEntry</span><span class="op" id="4799199">(</span><span class="builtintype" id="4799200">uint32</span><span class="op" id="4799206">(</span><span class="op" id="4799207">*</span><span class="ident" id="4799208">pte</span><span class="op" id="4799211">)</span>&nbsp;<span class="op" id="4799213">|</span>&nbsp;<span class="op" id="4799215">(</span><span class="ident" id="4799216">u32one</span>&nbsp;<span class="op" id="4799223">&lt;&lt;</span>&nbsp;<span class="ident" id="4799226">n</span><span class="op" id="4799227">)</span><span class="op" id="4799228">)</span><br>
<span class="lineno"></span><span class="op" id="4799230">}</span><br>
<span class="lineno"></span><span class="keyword" id="4799232">func</span>&nbsp;<span class="op" id="4799237">(</span><span class="ident" id="4799238">pte</span>&nbsp;<span class="ident" id="4799242">ptEntry</span><span class="op" id="4799249">)</span>&nbsp;<span class="ident" id="4799251">pn</span><span class="op" id="4799253">(</span><span class="op" id="4799254">)</span>&nbsp;<span class="builtintype" id="4799256">uint32</span>&nbsp;<span class="op" id="4799263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799266">return</span>&nbsp;<span class="builtintype" id="4799273">uint32</span><span class="op" id="4799279">(</span><span class="ident" id="4799280">pte</span>&nbsp;<span class="op" id="4799284">/</span>&nbsp;<span class="ident" id="4799286">PageSize</span><span class="op" id="4799294">)</span><br>
<span class="lineno">55</span><span class="op" id="4799296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4799299">func</span>&nbsp;<span class="op" id="4799304">(</span><span class="ident" id="4799305">pte</span>&nbsp;<span class="ident" id="4799309">ptEntry</span><span class="op" id="4799316">)</span>&nbsp;<span class="ident" id="4799318">test</span><span class="op" id="4799322">(</span><span class="ident" id="4799323">addr</span>&nbsp;<span class="builtintype" id="4799328">uint32</span><span class="op" id="4799334">,</span>&nbsp;<span class="ident" id="4799336">ring</span>&nbsp;<span class="builtintype" id="4799341">byte</span><span class="op" id="4799345">)</span>&nbsp;<span class="op" id="4799347">*</span><span class="ident" id="4799348">Excep</span>&nbsp;<span class="op" id="4799354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799357">if</span>&nbsp;<span class="op" id="4799360">!</span><span class="ident" id="4799361">pte</span><span class="op" id="4799364">.</span><span class="ident" id="4799365">testBit</span><span class="op" id="4799372">(</span><span class="ident" id="4799373">pteValid</span><span class="op" id="4799381">)</span>&nbsp;<span class="op" id="4799383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799387">return</span>&nbsp;<span class="ident" id="4799394">newPageFault</span><span class="op" id="4799406">(</span><span class="ident" id="4799407">addr</span><span class="op" id="4799411">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799417">if</span>&nbsp;<span class="ident" id="4799420">ring</span>&nbsp;<span class="op" id="4799425">&gt;</span>&nbsp;<span class="num" id="4799427">0</span>&nbsp;<span class="op" id="4799429">&amp;&amp;</span>&nbsp;<span class="op" id="4799432">!</span><span class="ident" id="4799433">pte</span><span class="op" id="4799436">.</span><span class="ident" id="4799437">testBit</span><span class="op" id="4799444">(</span><span class="ident" id="4799445">pteUser</span><span class="op" id="4799452">)</span>&nbsp;<span class="op" id="4799454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799458">return</span>&nbsp;<span class="ident" id="4799465">newPageFault</span><span class="op" id="4799477">(</span><span class="ident" id="4799478">addr</span><span class="op" id="4799482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799488">return</span>&nbsp;<span class="ident" id="4799495">nil</span><br>
<span class="lineno">65</span><span class="op" id="4799499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4799502">//&nbsp;Translate&nbsp;transalate&nbsp;a&nbsp;virutal&nbsp;address&nbsp;into&nbsp;physical&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4799567">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;translation&nbsp;fails</span><br>
<span class="lineno"></span><span class="keyword" id="4799615">func</span>&nbsp;<span class="op" id="4799620">(</span><span class="ident" id="4799621">pt</span>&nbsp;<span class="op" id="4799624">*</span><span class="ident" id="4799625">pageTable</span><span class="op" id="4799634">)</span>&nbsp;<span class="ident" id="4799636">Translate</span><span class="op" id="4799645">(</span><span class="ident" id="4799646">addr</span>&nbsp;<span class="builtintype" id="4799651">uint32</span><span class="op" id="4799657">,</span>&nbsp;<span class="ident" id="4799659">ring</span>&nbsp;<span class="builtintype" id="4799664">byte</span><span class="op" id="4799668">)</span>&nbsp;<span class="op" id="4799670">(</span><span class="builtintype" id="4799671">uint32</span><span class="op" id="4799677">,</span>&nbsp;<span class="op" id="4799679">*</span><span class="ident" id="4799680">Excep</span><span class="op" id="4799685">)</span>&nbsp;<span class="op" id="4799687">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799690">vpn</span>&nbsp;<span class="op" id="4799694">:=</span>&nbsp;<span class="ident" id="4799697">addr</span>&nbsp;<span class="op" id="4799702">/</span>&nbsp;<span class="ident" id="4799704">PageSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799714">off</span>&nbsp;<span class="op" id="4799718">:=</span>&nbsp;<span class="ident" id="4799721">addr</span>&nbsp;<span class="op" id="4799726">%</span>&nbsp;<span class="ident" id="4799728">PageSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799739">index1</span>&nbsp;<span class="op" id="4799746">:=</span>&nbsp;<span class="ident" id="4799749">vpn</span>&nbsp;<span class="op" id="4799753">/</span>&nbsp;<span class="num" id="4799755">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799761">index2</span>&nbsp;<span class="op" id="4799768">:=</span>&nbsp;<span class="ident" id="4799771">vpn</span>&nbsp;<span class="op" id="4799775">%</span>&nbsp;<span class="num" id="4799777">1024</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799784">//&nbsp;first&nbsp;level&nbsp;page&nbsp;table&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799817">pt</span><span class="op" id="4799819">.</span><span class="ident" id="4799820">pte1Addr</span>&nbsp;<span class="op" id="4799829">=</span>&nbsp;<span class="ident" id="4799831">pt</span><span class="op" id="4799833">.</span><span class="ident" id="4799834">root</span>&nbsp;<span class="op" id="4799839">+</span>&nbsp;<span class="ident" id="4799841">index1</span><span class="op" id="4799847">*</span><span class="num" id="4799848">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799851">w</span><span class="op" id="4799852">,</span>&nbsp;<span class="ident" id="4799854">e</span>&nbsp;<span class="op" id="4799856">:=</span>&nbsp;<span class="ident" id="4799859">pt</span><span class="op" id="4799861">.</span><span class="ident" id="4799862">mem</span><span class="op" id="4799865">.</span><span class="ident" id="4799866">ReadWord</span><span class="op" id="4799874">(</span><span class="ident" id="4799875">pt</span><span class="op" id="4799877">.</span><span class="ident" id="4799878">pte1Addr</span><span class="op" id="4799886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799889">if</span>&nbsp;<span class="ident" id="4799892">e</span>&nbsp;<span class="op" id="4799894">!=</span>&nbsp;<span class="ident" id="4799897">nil</span>&nbsp;<span class="op" id="4799901">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799905">return</span>&nbsp;<span class="num" id="4799912">0</span><span class="op" id="4799913">,</span>&nbsp;<span class="ident" id="4799915">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799921">pt</span><span class="op" id="4799923">.</span><span class="ident" id="4799924">pte1</span>&nbsp;<span class="op" id="4799929">=</span>&nbsp;<span class="ident" id="4799931">ptEntry</span><span class="op" id="4799938">(</span><span class="ident" id="4799939">w</span><span class="op" id="4799940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799943">e</span>&nbsp;<span class="op" id="4799945">=</span>&nbsp;<span class="ident" id="4799947">pt</span><span class="op" id="4799949">.</span><span class="ident" id="4799950">pte1</span><span class="op" id="4799954">.</span><span class="ident" id="4799955">test</span><span class="op" id="4799959">(</span><span class="ident" id="4799960">addr</span><span class="op" id="4799964">,</span>&nbsp;<span class="ident" id="4799966">ring</span><span class="op" id="4799970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799973">if</span>&nbsp;<span class="ident" id="4799976">e</span>&nbsp;<span class="op" id="4799978">!=</span>&nbsp;<span class="ident" id="4799981">nil</span>&nbsp;<span class="op" id="4799985">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799989">return</span>&nbsp;<span class="num" id="4799996">0</span><span class="op" id="4799997">,</span>&nbsp;<span class="ident" id="4799999">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800006">pn1</span>&nbsp;<span class="op" id="4800010">:=</span>&nbsp;<span class="ident" id="4800013">pt</span><span class="op" id="4800015">.</span><span class="ident" id="4800016">pte1</span><span class="op" id="4800020">.</span><span class="ident" id="4800021">pn</span><span class="op" id="4800023">(</span><span class="op" id="4800024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800028">pt</span><span class="op" id="4800030">.</span><span class="ident" id="4800031">pte2Addr</span>&nbsp;<span class="op" id="4800040">=</span>&nbsp;<span class="ident" id="4800042">pn1</span><span class="op" id="4800045">*</span><span class="ident" id="4800046">PageSize</span>&nbsp;<span class="op" id="4800055">+</span>&nbsp;<span class="ident" id="4800057">index2</span><span class="op" id="4800063">*</span><span class="num" id="4800064">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800067">w</span><span class="op" id="4800068">,</span>&nbsp;<span class="ident" id="4800070">e</span>&nbsp;<span class="op" id="4800072">=</span>&nbsp;<span class="ident" id="4800074">pt</span><span class="op" id="4800076">.</span><span class="ident" id="4800077">mem</span><span class="op" id="4800080">.</span><span class="ident" id="4800081">ReadWord</span><span class="op" id="4800089">(</span><span class="ident" id="4800090">pt</span><span class="op" id="4800092">.</span><span class="ident" id="4800093">pte2Addr</span><span class="op" id="4800101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800104">if</span>&nbsp;<span class="ident" id="4800107">e</span>&nbsp;<span class="op" id="4800109">!=</span>&nbsp;<span class="ident" id="4800112">nil</span>&nbsp;<span class="op" id="4800116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800120">return</span>&nbsp;<span class="num" id="4800127">0</span><span class="op" id="4800128">,</span>&nbsp;<span class="ident" id="4800130">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800133">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800136">pt</span><span class="op" id="4800138">.</span><span class="ident" id="4800139">pte2</span>&nbsp;<span class="op" id="4800144">=</span>&nbsp;<span class="ident" id="4800146">ptEntry</span><span class="op" id="4800153">(</span><span class="ident" id="4800154">w</span><span class="op" id="4800155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800158">e</span>&nbsp;<span class="op" id="4800160">=</span>&nbsp;<span class="ident" id="4800162">pt</span><span class="op" id="4800164">.</span><span class="ident" id="4800165">pte2</span><span class="op" id="4800169">.</span><span class="ident" id="4800170">test</span><span class="op" id="4800174">(</span><span class="ident" id="4800175">addr</span><span class="op" id="4800179">,</span>&nbsp;<span class="ident" id="4800181">ring</span><span class="op" id="4800185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800188">if</span>&nbsp;<span class="ident" id="4800191">e</span>&nbsp;<span class="op" id="4800193">!=</span>&nbsp;<span class="ident" id="4800196">nil</span>&nbsp;<span class="op" id="4800200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800204">return</span>&nbsp;<span class="num" id="4800211">0</span><span class="op" id="4800212">,</span>&nbsp;<span class="ident" id="4800214">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800217">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800221">ppn</span>&nbsp;<span class="op" id="4800225">:=</span>&nbsp;<span class="ident" id="4800228">pt</span><span class="op" id="4800230">.</span><span class="ident" id="4800231">pte2</span><span class="op" id="4800235">.</span><span class="ident" id="4800236">pn</span><span class="op" id="4800238">(</span><span class="op" id="4800239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800243">return</span>&nbsp;<span class="ident" id="4800250">ppn</span><span class="op" id="4800253">*</span><span class="ident" id="4800254">PageSize</span>&nbsp;<span class="op" id="4800263">+</span>&nbsp;<span class="ident" id="4800265">off</span><span class="op" id="4800268">,</span>&nbsp;<span class="ident" id="4800270">nil</span><br>
<span class="lineno"></span><span class="op" id="4800274">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="4800277">func</span>&nbsp;<span class="op" id="4800282">(</span><span class="ident" id="4800283">pt</span>&nbsp;<span class="op" id="4800286">*</span><span class="ident" id="4800287">pageTable</span><span class="op" id="4800296">)</span>&nbsp;<span class="ident" id="4800298">updatePte</span><span class="op" id="4800307">(</span><span class="op" id="4800308">)</span>&nbsp;<span class="op" id="4800310">*</span><span class="ident" id="4800311">Excep</span>&nbsp;<span class="op" id="4800317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800320">e</span>&nbsp;<span class="op" id="4800322">:=</span>&nbsp;<span class="ident" id="4800325">pt</span><span class="op" id="4800327">.</span><span class="ident" id="4800328">mem</span><span class="op" id="4800331">.</span><span class="ident" id="4800332">WriteWord</span><span class="op" id="4800341">(</span><span class="ident" id="4800342">pt</span><span class="op" id="4800344">.</span><span class="ident" id="4800345">pte1Addr</span><span class="op" id="4800353">,</span>&nbsp;<span class="builtintype" id="4800355">uint32</span><span class="op" id="4800361">(</span><span class="ident" id="4800362">pt</span><span class="op" id="4800364">.</span><span class="ident" id="4800365">pte1</span><span class="op" id="4800369">)</span><span class="op" id="4800370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800373">if</span>&nbsp;<span class="ident" id="4800376">e</span>&nbsp;<span class="op" id="4800378">!=</span>&nbsp;<span class="ident" id="4800381">nil</span>&nbsp;<span class="op" id="4800385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800389">return</span>&nbsp;<span class="ident" id="4800396">e</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800403">e</span>&nbsp;<span class="op" id="4800405">=</span>&nbsp;<span class="ident" id="4800407">pt</span><span class="op" id="4800409">.</span><span class="ident" id="4800410">mem</span><span class="op" id="4800413">.</span><span class="ident" id="4800414">WriteWord</span><span class="op" id="4800423">(</span><span class="ident" id="4800424">pt</span><span class="op" id="4800426">.</span><span class="ident" id="4800427">pte2Addr</span><span class="op" id="4800435">,</span>&nbsp;<span class="builtintype" id="4800437">uint32</span><span class="op" id="4800443">(</span><span class="ident" id="4800444">pt</span><span class="op" id="4800446">.</span><span class="ident" id="4800447">pte2</span><span class="op" id="4800451">)</span><span class="op" id="4800452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800455">if</span>&nbsp;<span class="ident" id="4800458">e</span>&nbsp;<span class="op" id="4800460">!=</span>&nbsp;<span class="ident" id="4800463">nil</span>&nbsp;<span class="op" id="4800467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800471">return</span>&nbsp;<span class="ident" id="4800478">e</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800485">return</span>&nbsp;<span class="ident" id="4800492">nil</span><br>
<span class="lineno"></span><span class="op" id="4800496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="4800499">//&nbsp;TranslateRead&nbsp;translates&nbsp;the&nbsp;address&nbsp;and&nbsp;sets&nbsp;the&nbsp;use&nbsp;bit.</span><br>
<span class="lineno"></span><span class="keyword" id="4800561">func</span>&nbsp;<span class="op" id="4800566">(</span><span class="ident" id="4800567">pt</span>&nbsp;<span class="op" id="4800570">*</span><span class="ident" id="4800571">pageTable</span><span class="op" id="4800580">)</span>&nbsp;<span class="ident" id="4800582">TranslateRead</span><span class="op" id="4800595">(</span><span class="ident" id="4800596">addr</span>&nbsp;<span class="builtintype" id="4800601">uint32</span><span class="op" id="4800607">,</span>&nbsp;<span class="ident" id="4800609">ring</span>&nbsp;<span class="builtintype" id="4800614">byte</span><span class="op" id="4800618">)</span>&nbsp;<span class="op" id="4800620">(</span><span class="builtintype" id="4800621">uint32</span><span class="op" id="4800627">,</span>&nbsp;<span class="op" id="4800629">*</span><span class="ident" id="4800630">Excep</span><span class="op" id="4800635">)</span>&nbsp;<span class="op" id="4800637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800640">ret</span><span class="op" id="4800643">,</span>&nbsp;<span class="ident" id="4800645">e</span>&nbsp;<span class="op" id="4800647">:=</span>&nbsp;<span class="ident" id="4800650">pt</span><span class="op" id="4800652">.</span><span class="ident" id="4800653">Translate</span><span class="op" id="4800662">(</span><span class="ident" id="4800663">addr</span><span class="op" id="4800667">,</span>&nbsp;<span class="ident" id="4800669">ring</span><span class="op" id="4800673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800676">if</span>&nbsp;<span class="ident" id="4800679">e</span>&nbsp;<span class="op" id="4800681">!=</span>&nbsp;<span class="ident" id="4800684">nil</span>&nbsp;<span class="op" id="4800688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800692">return</span>&nbsp;<span class="num" id="4800699">0</span><span class="op" id="4800700">,</span>&nbsp;<span class="ident" id="4800702">e</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800709">pt</span><span class="op" id="4800711">.</span><span class="ident" id="4800712">pte1</span><span class="op" id="4800716">.</span><span class="ident" id="4800717">setBit</span><span class="op" id="4800723">(</span><span class="ident" id="4800724">pteUse</span><span class="op" id="4800730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800733">pt</span><span class="op" id="4800735">.</span><span class="ident" id="4800736">pte2</span><span class="op" id="4800740">.</span><span class="ident" id="4800741">setBit</span><span class="op" id="4800747">(</span><span class="ident" id="4800748">pteUse</span><span class="op" id="4800754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800758">e</span>&nbsp;<span class="op" id="4800760">=</span>&nbsp;<span class="ident" id="4800762">pt</span><span class="op" id="4800764">.</span><span class="ident" id="4800765">updatePte</span><span class="op" id="4800774">(</span><span class="op" id="4800775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800778">if</span>&nbsp;<span class="ident" id="4800781">e</span>&nbsp;<span class="op" id="4800783">!=</span>&nbsp;<span class="ident" id="4800786">nil</span>&nbsp;<span class="op" id="4800790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800794">return</span>&nbsp;<span class="num" id="4800801">0</span><span class="op" id="4800802">,</span>&nbsp;<span class="ident" id="4800804">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800811">return</span>&nbsp;<span class="ident" id="4800818">ret</span><span class="op" id="4800821">,</span>&nbsp;<span class="ident" id="4800823">nil</span><br>
<span class="lineno"></span><span class="op" id="4800827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4800830">//&nbsp;TranslateWrite&nbsp;translates&nbsp;the&nbsp;address&nbsp;and&nbsp;sets&nbsp;the&nbsp;use&nbsp;and&nbsp;dirty&nbsp;bit</span><br>
<span class="lineno"></span><span class="keyword" id="4800902">func</span>&nbsp;<span class="op" id="4800907">(</span><span class="ident" id="4800908">pt</span>&nbsp;<span class="op" id="4800911">*</span><span class="ident" id="4800912">pageTable</span><span class="op" id="4800921">)</span>&nbsp;<span class="ident" id="4800923">TranslateWrite</span><span class="op" id="4800937">(</span><span class="ident" id="4800938">addr</span>&nbsp;<span class="builtintype" id="4800943">uint32</span><span class="op" id="4800949">,</span>&nbsp;<span class="ident" id="4800951">ring</span>&nbsp;<span class="builtintype" id="4800956">byte</span><span class="op" id="4800960">)</span>&nbsp;<span class="op" id="4800962">(</span><span class="builtintype" id="4800963">uint32</span><span class="op" id="4800969">,</span>&nbsp;<span class="op" id="4800971">*</span><span class="ident" id="4800972">Excep</span><span class="op" id="4800977">)</span>&nbsp;<span class="op" id="4800979">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800982">ret</span><span class="op" id="4800985">,</span>&nbsp;<span class="ident" id="4800987">e</span>&nbsp;<span class="op" id="4800989">:=</span>&nbsp;<span class="ident" id="4800992">pt</span><span class="op" id="4800994">.</span><span class="ident" id="4800995">Translate</span><span class="op" id="4801004">(</span><span class="ident" id="4801005">addr</span><span class="op" id="4801009">,</span>&nbsp;<span class="ident" id="4801011">ring</span><span class="op" id="4801015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801018">if</span>&nbsp;<span class="ident" id="4801021">e</span>&nbsp;<span class="op" id="4801023">!=</span>&nbsp;<span class="ident" id="4801026">nil</span>&nbsp;<span class="op" id="4801030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801034">return</span>&nbsp;<span class="num" id="4801041">0</span><span class="op" id="4801042">,</span>&nbsp;<span class="ident" id="4801044">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801051">if</span>&nbsp;<span class="ident" id="4801054">pt</span><span class="op" id="4801056">.</span><span class="ident" id="4801057">pte1</span><span class="op" id="4801061">.</span><span class="ident" id="4801062">testBit</span><span class="op" id="4801069">(</span><span class="ident" id="4801070">pteReadonly</span><span class="op" id="4801081">)</span>&nbsp;<span class="op" id="4801083">||</span>&nbsp;<span class="ident" id="4801086">pt</span><span class="op" id="4801088">.</span><span class="ident" id="4801089">pte2</span><span class="op" id="4801093">.</span><span class="ident" id="4801094">testBit</span><span class="op" id="4801101">(</span><span class="ident" id="4801102">pteReadonly</span><span class="op" id="4801113">)</span>&nbsp;<span class="op" id="4801115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801119">return</span>&nbsp;<span class="num" id="4801126">0</span><span class="op" id="4801127">,</span>&nbsp;<span class="ident" id="4801129">newPageReadonly</span><span class="op" id="4801144">(</span><span class="ident" id="4801145">addr</span><span class="op" id="4801149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801156">pt</span><span class="op" id="4801158">.</span><span class="ident" id="4801159">pte1</span><span class="op" id="4801163">.</span><span class="ident" id="4801164">setBit</span><span class="op" id="4801170">(</span><span class="ident" id="4801171">pteUse</span><span class="op" id="4801177">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801180">pt</span><span class="op" id="4801182">.</span><span class="ident" id="4801183">pte1</span><span class="op" id="4801187">.</span><span class="ident" id="4801188">setBit</span><span class="op" id="4801194">(</span><span class="ident" id="4801195">pteDirty</span><span class="op" id="4801203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801206">pt</span><span class="op" id="4801208">.</span><span class="ident" id="4801209">pte2</span><span class="op" id="4801213">.</span><span class="ident" id="4801214">setBit</span><span class="op" id="4801220">(</span><span class="ident" id="4801221">pteUse</span><span class="op" id="4801227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801230">pt</span><span class="op" id="4801232">.</span><span class="ident" id="4801233">pte2</span><span class="op" id="4801237">.</span><span class="ident" id="4801238">setBit</span><span class="op" id="4801244">(</span><span class="ident" id="4801245">pteDirty</span><span class="op" id="4801253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801257">e</span>&nbsp;<span class="op" id="4801259">=</span>&nbsp;<span class="ident" id="4801261">pt</span><span class="op" id="4801263">.</span><span class="ident" id="4801264">updatePte</span><span class="op" id="4801273">(</span><span class="op" id="4801274">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801277">if</span>&nbsp;<span class="ident" id="4801280">e</span>&nbsp;<span class="op" id="4801282">!=</span>&nbsp;<span class="ident" id="4801285">nil</span>&nbsp;<span class="op" id="4801289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801293">return</span>&nbsp;<span class="num" id="4801300">0</span><span class="op" id="4801301">,</span>&nbsp;<span class="ident" id="4801303">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801310">return</span>&nbsp;<span class="ident" id="4801317">ret</span><span class="op" id="4801320">,</span>&nbsp;<span class="ident" id="4801322">nil</span><br>
<span class="lineno">160</span><span class="op" id="4801326">}</span>
</div>
</body>
</html>
