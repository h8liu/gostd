<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html" class="current">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4886335">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4886390">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4886444">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4886495">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4886550">package</span>&nbsp;<span class="ident" id="4886558">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4886563">import</span>&nbsp;<span class="op" id="4886570">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4886573">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4886585">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4886595">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4886601">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4886609">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4886619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4886622">var</span>&nbsp;<span class="op" id="4886626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886629">errBadUint</span>&nbsp;<span class="op" id="4886640">=</span>&nbsp;<span class="ident" id="4886642">errors</span><span class="op" id="4886648">.</span><span class="ident" id="4886649">New</span><span class="op" id="4886652">(</span><span class="string" id="4886653">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="4886697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886700">errBadType</span>&nbsp;<span class="op" id="4886711">=</span>&nbsp;<span class="ident" id="4886713">errors</span><span class="op" id="4886719">.</span><span class="ident" id="4886720">New</span><span class="op" id="4886723">(</span><span class="string" id="4886724">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="4886764">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886767">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4886778">=</span>&nbsp;<span class="ident" id="4886780">errors</span><span class="op" id="4886786">.</span><span class="ident" id="4886787">New</span><span class="op" id="4886790">(</span><span class="string" id="4886791">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="4886835">)</span><br>
<span class="lineno"></span><span class="op" id="4886837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4886840">type</span>&nbsp;<span class="ident" id="4886845">decHelper</span>&nbsp;<span class="keyword" id="4886855">func</span><span class="op" id="4886859">(</span><span class="ident" id="4886860">state</span>&nbsp;<span class="op" id="4886866">*</span><span class="ident" id="4886867">decoderState</span><span class="op" id="4886879">,</span>&nbsp;<span class="ident" id="4886881">v</span>&nbsp;<span class="ident" id="4886883">reflect</span><span class="op" id="4886890">.</span><span class="ident" id="4886891">Value</span><span class="op" id="4886896">,</span>&nbsp;<span class="ident" id="4886898">length</span>&nbsp;<span class="builtintype" id="4886905">int</span><span class="op" id="4886908">,</span>&nbsp;<span class="ident" id="4886910">ovfl</span>&nbsp;<span class="builtintype" id="4886915">error</span><span class="op" id="4886920">)</span>&nbsp;<span class="builtintype" id="4886922">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4886928">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4887010">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="4887044">type</span>&nbsp;<span class="ident" id="4887049">decoderState</span>&nbsp;<span class="keyword" id="4887062">struct</span>&nbsp;<span class="op" id="4887069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887072">dec</span>&nbsp;<span class="op" id="4887076">*</span><span class="ident" id="4887077">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4887086">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4887164">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887235">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887244">*</span><span class="ident" id="4887245">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887256">fieldnum</span>&nbsp;<span class="builtintype" id="4887265">int</span>&nbsp;<span class="comment" id="4887269">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887301">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887310">[</span><span class="op" id="4887311">]</span><span class="builtintype" id="4887312">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887318">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887327">*</span><span class="ident" id="4887328">decoderState</span>&nbsp;<span class="comment" id="4887341">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="4887358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887361">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4887446">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="4887545">type</span>&nbsp;<span class="ident" id="4887550">decBuffer</span>&nbsp;<span class="keyword" id="4887560">struct</span>&nbsp;<span class="op" id="4887567">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887570">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4887577">[</span><span class="op" id="4887578">]</span><span class="builtintype" id="4887579">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887585">offset</span>&nbsp;<span class="builtintype" id="4887592">int</span>&nbsp;<span class="comment" id="4887596">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="4887612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4887615">func</span>&nbsp;<span class="op" id="4887620">(</span><span class="ident" id="4887621">d</span>&nbsp;<span class="op" id="4887623">*</span><span class="ident" id="4887624">decBuffer</span><span class="op" id="4887633">)</span>&nbsp;<span class="ident" id="4887635">Read</span><span class="op" id="4887639">(</span><span class="ident" id="4887640">p</span>&nbsp;<span class="op" id="4887642">[</span><span class="op" id="4887643">]</span><span class="builtintype" id="4887644">byte</span><span class="op" id="4887648">)</span>&nbsp;<span class="op" id="4887650">(</span><span class="builtintype" id="4887651">int</span><span class="op" id="4887654">,</span>&nbsp;<span class="builtintype" id="4887656">error</span><span class="op" id="4887661">)</span>&nbsp;<span class="op" id="4887663">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887666">n</span>&nbsp;<span class="op" id="4887668">:=</span>&nbsp;<span class="builtinfunc" id="4887671">copy</span><span class="op" id="4887675">(</span><span class="ident" id="4887676">p</span><span class="op" id="4887677">,</span>&nbsp;<span class="ident" id="4887679">d</span><span class="op" id="4887680">.</span><span class="ident" id="4887681">data</span><span class="op" id="4887685">[</span><span class="ident" id="4887686">d</span><span class="op" id="4887687">.</span><span class="ident" id="4887688">offset</span><span class="op" id="4887694">:</span><span class="op" id="4887695">]</span><span class="op" id="4887696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887699">if</span>&nbsp;<span class="ident" id="4887702">n</span>&nbsp;<span class="op" id="4887704">==</span>&nbsp;<span class="num" id="4887707">0</span>&nbsp;<span class="op" id="4887709">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4887712">len</span><span class="op" id="4887715">(</span><span class="ident" id="4887716">p</span><span class="op" id="4887717">)</span>&nbsp;<span class="op" id="4887719">!=</span>&nbsp;<span class="num" id="4887722">0</span>&nbsp;<span class="op" id="4887724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887728">return</span>&nbsp;<span class="num" id="4887735">0</span><span class="op" id="4887736">,</span>&nbsp;<span class="ident" id="4887738">io</span><span class="op" id="4887740">.</span><span class="ident" id="4887741">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887749">d</span><span class="op" id="4887750">.</span><span class="ident" id="4887751">offset</span>&nbsp;<span class="op" id="4887758">+=</span>&nbsp;<span class="ident" id="4887761">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887764">return</span>&nbsp;<span class="ident" id="4887771">n</span><span class="op" id="4887772">,</span>&nbsp;<span class="ident" id="4887774">nil</span><br>
<span class="lineno"></span><span class="op" id="4887778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4887781">func</span>&nbsp;<span class="op" id="4887786">(</span><span class="ident" id="4887787">d</span>&nbsp;<span class="op" id="4887789">*</span><span class="ident" id="4887790">decBuffer</span><span class="op" id="4887799">)</span>&nbsp;<span class="ident" id="4887801">Drop</span><span class="op" id="4887805">(</span><span class="ident" id="4887806">n</span>&nbsp;<span class="builtintype" id="4887808">int</span><span class="op" id="4887811">)</span>&nbsp;<span class="op" id="4887813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887816">if</span>&nbsp;<span class="ident" id="4887819">n</span>&nbsp;<span class="op" id="4887821">&gt;</span>&nbsp;<span class="ident" id="4887823">d</span><span class="op" id="4887824">.</span><span class="ident" id="4887825">Len</span><span class="op" id="4887828">(</span><span class="op" id="4887829">)</span>&nbsp;<span class="op" id="4887831">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4887835">panic</span><span class="op" id="4887840">(</span><span class="string" id="4887841">&#34;drop&#34;</span><span class="op" id="4887847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887853">d</span><span class="op" id="4887854">.</span><span class="ident" id="4887855">offset</span>&nbsp;<span class="op" id="4887862">+=</span>&nbsp;<span class="ident" id="4887865">n</span><br>
<span class="lineno"></span><span class="op" id="4887867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4887870">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4887933">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4887998">func</span>&nbsp;<span class="op" id="4888003">(</span><span class="ident" id="4888004">d</span>&nbsp;<span class="op" id="4888006">*</span><span class="ident" id="4888007">decBuffer</span><span class="op" id="4888016">)</span>&nbsp;<span class="ident" id="4888018">Size</span><span class="op" id="4888022">(</span><span class="ident" id="4888023">n</span>&nbsp;<span class="builtintype" id="4888025">int</span><span class="op" id="4888028">)</span>&nbsp;<span class="op" id="4888030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888033">d</span><span class="op" id="4888034">.</span><span class="ident" id="4888035">Reset</span><span class="op" id="4888040">(</span><span class="op" id="4888041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888044">if</span>&nbsp;<span class="builtinfunc" id="4888047">cap</span><span class="op" id="4888050">(</span><span class="ident" id="4888051">d</span><span class="op" id="4888052">.</span><span class="ident" id="4888053">data</span><span class="op" id="4888057">)</span>&nbsp;<span class="op" id="4888059">&lt;</span>&nbsp;<span class="ident" id="4888061">n</span>&nbsp;<span class="op" id="4888063">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888067">d</span><span class="op" id="4888068">.</span><span class="ident" id="4888069">data</span>&nbsp;<span class="op" id="4888074">=</span>&nbsp;<span class="builtinfunc" id="4888076">make</span><span class="op" id="4888080">(</span><span class="op" id="4888081">[</span><span class="op" id="4888082">]</span><span class="builtintype" id="4888083">byte</span><span class="op" id="4888087">,</span>&nbsp;<span class="ident" id="4888089">n</span><span class="op" id="4888090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888093">}</span>&nbsp;<span class="keyword" id="4888095">else</span>&nbsp;<span class="op" id="4888100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888104">d</span><span class="op" id="4888105">.</span><span class="ident" id="4888106">data</span>&nbsp;<span class="op" id="4888111">=</span>&nbsp;<span class="ident" id="4888113">d</span><span class="op" id="4888114">.</span><span class="ident" id="4888115">data</span><span class="op" id="4888119">[</span><span class="num" id="4888120">0</span><span class="op" id="4888121">:</span><span class="ident" id="4888122">n</span><span class="op" id="4888123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888126">}</span><br>
<span class="lineno"></span><span class="op" id="4888128">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4888131">func</span>&nbsp;<span class="op" id="4888136">(</span><span class="ident" id="4888137">d</span>&nbsp;<span class="op" id="4888139">*</span><span class="ident" id="4888140">decBuffer</span><span class="op" id="4888149">)</span>&nbsp;<span class="ident" id="4888151">ReadByte</span><span class="op" id="4888159">(</span><span class="op" id="4888160">)</span>&nbsp;<span class="op" id="4888162">(</span><span class="builtintype" id="4888163">byte</span><span class="op" id="4888167">,</span>&nbsp;<span class="builtintype" id="4888169">error</span><span class="op" id="4888174">)</span>&nbsp;<span class="op" id="4888176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888179">if</span>&nbsp;<span class="ident" id="4888182">d</span><span class="op" id="4888183">.</span><span class="ident" id="4888184">offset</span>&nbsp;<span class="op" id="4888191">&gt;=</span>&nbsp;<span class="builtinfunc" id="4888194">len</span><span class="op" id="4888197">(</span><span class="ident" id="4888198">d</span><span class="op" id="4888199">.</span><span class="ident" id="4888200">data</span><span class="op" id="4888204">)</span>&nbsp;<span class="op" id="4888206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888210">return</span>&nbsp;<span class="num" id="4888217">0</span><span class="op" id="4888218">,</span>&nbsp;<span class="ident" id="4888220">io</span><span class="op" id="4888222">.</span><span class="ident" id="4888223">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888228">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888231">c</span>&nbsp;<span class="op" id="4888233">:=</span>&nbsp;<span class="ident" id="4888236">d</span><span class="op" id="4888237">.</span><span class="ident" id="4888238">data</span><span class="op" id="4888242">[</span><span class="ident" id="4888243">d</span><span class="op" id="4888244">.</span><span class="ident" id="4888245">offset</span><span class="op" id="4888251">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888254">d</span><span class="op" id="4888255">.</span><span class="ident" id="4888256">offset</span><span class="op" id="4888262">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888266">return</span>&nbsp;<span class="ident" id="4888273">c</span><span class="op" id="4888274">,</span>&nbsp;<span class="ident" id="4888276">nil</span><br>
<span class="lineno"></span><span class="op" id="4888280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4888283">func</span>&nbsp;<span class="op" id="4888288">(</span><span class="ident" id="4888289">d</span>&nbsp;<span class="op" id="4888291">*</span><span class="ident" id="4888292">decBuffer</span><span class="op" id="4888301">)</span>&nbsp;<span class="ident" id="4888303">Len</span><span class="op" id="4888306">(</span><span class="op" id="4888307">)</span>&nbsp;<span class="builtintype" id="4888309">int</span>&nbsp;<span class="op" id="4888313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888316">return</span>&nbsp;<span class="builtinfunc" id="4888323">len</span><span class="op" id="4888326">(</span><span class="ident" id="4888327">d</span><span class="op" id="4888328">.</span><span class="ident" id="4888329">data</span><span class="op" id="4888333">)</span>&nbsp;<span class="op" id="4888335">-</span>&nbsp;<span class="ident" id="4888337">d</span><span class="op" id="4888338">.</span><span class="ident" id="4888339">offset</span><br>
<span class="lineno"></span><span class="op" id="4888346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4888349">func</span>&nbsp;<span class="op" id="4888354">(</span><span class="ident" id="4888355">d</span>&nbsp;<span class="op" id="4888357">*</span><span class="ident" id="4888358">decBuffer</span><span class="op" id="4888367">)</span>&nbsp;<span class="ident" id="4888369">Bytes</span><span class="op" id="4888374">(</span><span class="op" id="4888375">)</span>&nbsp;<span class="op" id="4888377">[</span><span class="op" id="4888378">]</span><span class="builtintype" id="4888379">byte</span>&nbsp;<span class="op" id="4888384">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888387">return</span>&nbsp;<span class="ident" id="4888394">d</span><span class="op" id="4888395">.</span><span class="ident" id="4888396">data</span><span class="op" id="4888400">[</span><span class="ident" id="4888401">d</span><span class="op" id="4888402">.</span><span class="ident" id="4888403">offset</span><span class="op" id="4888409">:</span><span class="op" id="4888410">]</span><br>
<span class="lineno"></span><span class="op" id="4888412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4888415">func</span>&nbsp;<span class="op" id="4888420">(</span><span class="ident" id="4888421">d</span>&nbsp;<span class="op" id="4888423">*</span><span class="ident" id="4888424">decBuffer</span><span class="op" id="4888433">)</span>&nbsp;<span class="ident" id="4888435">Reset</span><span class="op" id="4888440">(</span><span class="op" id="4888441">)</span>&nbsp;<span class="op" id="4888443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888446">d</span><span class="op" id="4888447">.</span><span class="ident" id="4888448">data</span>&nbsp;<span class="op" id="4888453">=</span>&nbsp;<span class="ident" id="4888455">d</span><span class="op" id="4888456">.</span><span class="ident" id="4888457">data</span><span class="op" id="4888461">[</span><span class="num" id="4888462">0</span><span class="op" id="4888463">:</span><span class="num" id="4888464">0</span><span class="op" id="4888465">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888468">d</span><span class="op" id="4888469">.</span><span class="ident" id="4888470">offset</span>&nbsp;<span class="op" id="4888477">=</span>&nbsp;<span class="num" id="4888479">0</span><br>
<span class="lineno"></span><span class="op" id="4888481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4888484">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="4888564">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="4888601">func</span>&nbsp;<span class="op" id="4888606">(</span><span class="ident" id="4888607">dec</span>&nbsp;<span class="op" id="4888611">*</span><span class="ident" id="4888612">Decoder</span><span class="op" id="4888619">)</span>&nbsp;<span class="ident" id="4888621">newDecoderState</span><span class="op" id="4888636">(</span><span class="ident" id="4888637">buf</span>&nbsp;<span class="op" id="4888641">*</span><span class="ident" id="4888642">decBuffer</span><span class="op" id="4888651">)</span>&nbsp;<span class="op" id="4888653">*</span><span class="ident" id="4888654">decoderState</span>&nbsp;<span class="op" id="4888667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888670">d</span>&nbsp;<span class="op" id="4888672">:=</span>&nbsp;<span class="ident" id="4888675">dec</span><span class="op" id="4888678">.</span><span class="ident" id="4888679">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888689">if</span>&nbsp;<span class="ident" id="4888692">d</span>&nbsp;<span class="op" id="4888694">==</span>&nbsp;<span class="ident" id="4888697">nil</span>&nbsp;<span class="op" id="4888701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888705">d</span>&nbsp;<span class="op" id="4888707">=</span>&nbsp;<span class="builtinfunc" id="4888709">new</span><span class="op" id="4888712">(</span><span class="ident" id="4888713">decoderState</span><span class="op" id="4888725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888729">d</span><span class="op" id="4888730">.</span><span class="ident" id="4888731">dec</span>&nbsp;<span class="op" id="4888735">=</span>&nbsp;<span class="ident" id="4888737">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888743">d</span><span class="op" id="4888744">.</span><span class="ident" id="4888745">buf</span>&nbsp;<span class="op" id="4888749">=</span>&nbsp;<span class="builtinfunc" id="4888751">make</span><span class="op" id="4888755">(</span><span class="op" id="4888756">[</span><span class="op" id="4888757">]</span><span class="builtintype" id="4888758">byte</span><span class="op" id="4888762">,</span>&nbsp;<span class="ident" id="4888764">uint64Size</span><span class="op" id="4888774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888777">}</span>&nbsp;<span class="keyword" id="4888779">else</span>&nbsp;<span class="op" id="4888784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888788">dec</span><span class="op" id="4888791">.</span><span class="ident" id="4888792">freeList</span>&nbsp;<span class="op" id="4888801">=</span>&nbsp;<span class="ident" id="4888803">d</span><span class="op" id="4888804">.</span><span class="ident" id="4888805">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888814">d</span><span class="op" id="4888815">.</span><span class="ident" id="4888816">b</span>&nbsp;<span class="op" id="4888818">=</span>&nbsp;<span class="ident" id="4888820">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888825">return</span>&nbsp;<span class="ident" id="4888832">d</span><br>
<span class="lineno"></span><span class="op" id="4888834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4888837">func</span>&nbsp;<span class="op" id="4888842">(</span><span class="ident" id="4888843">dec</span>&nbsp;<span class="op" id="4888847">*</span><span class="ident" id="4888848">Decoder</span><span class="op" id="4888855">)</span>&nbsp;<span class="ident" id="4888857">freeDecoderState</span><span class="op" id="4888873">(</span><span class="ident" id="4888874">d</span>&nbsp;<span class="op" id="4888876">*</span><span class="ident" id="4888877">decoderState</span><span class="op" id="4888889">)</span>&nbsp;<span class="op" id="4888891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888894">d</span><span class="op" id="4888895">.</span><span class="ident" id="4888896">next</span>&nbsp;<span class="op" id="4888901">=</span>&nbsp;<span class="ident" id="4888903">dec</span><span class="op" id="4888906">.</span><span class="ident" id="4888907">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888917">dec</span><span class="op" id="4888920">.</span><span class="ident" id="4888921">freeList</span>&nbsp;<span class="op" id="4888930">=</span>&nbsp;<span class="ident" id="4888932">d</span><br>
<span class="lineno"></span><span class="op" id="4888934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4888937">func</span>&nbsp;<span class="ident" id="4888942">overflow</span><span class="op" id="4888950">(</span><span class="ident" id="4888951">name</span>&nbsp;<span class="builtintype" id="4888956">string</span><span class="op" id="4888962">)</span>&nbsp;<span class="builtintype" id="4888964">error</span>&nbsp;<span class="op" id="4888970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888973">return</span>&nbsp;<span class="ident" id="4888980">errors</span><span class="op" id="4888986">.</span><span class="ident" id="4888987">New</span><span class="op" id="4888990">(</span><span class="string" id="4888991">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4889005">+</span>&nbsp;<span class="ident" id="4889007">name</span>&nbsp;<span class="op" id="4889012">+</span>&nbsp;<span class="string" id="4889014">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4889030">)</span><br>
<span class="lineno">115</span><span class="op" id="4889032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4889035">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4889108">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4889164">func</span>&nbsp;<span class="ident" id="4889169">decodeUintReader</span><span class="op" id="4889185">(</span><span class="ident" id="4889186">r</span>&nbsp;<span class="ident" id="4889188">io</span><span class="op" id="4889190">.</span><span class="ident" id="4889191">Reader</span><span class="op" id="4889197">,</span>&nbsp;<span class="ident" id="4889199">buf</span>&nbsp;<span class="op" id="4889203">[</span><span class="op" id="4889204">]</span><span class="builtintype" id="4889205">byte</span><span class="op" id="4889209">)</span>&nbsp;<span class="op" id="4889211">(</span><span class="ident" id="4889212">x</span>&nbsp;<span class="ident" id="4889214">uint64</span><span class="op" id="4889220">,</span>&nbsp;<span class="ident" id="4889222">width</span>&nbsp;<span class="builtintype" id="4889228">int</span><span class="op" id="4889231">,</span>&nbsp;<span class="ident" id="4889233">err</span>&nbsp;<span class="builtintype" id="4889237">error</span><span class="op" id="4889242">)</span>&nbsp;<span class="op" id="4889244">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889247">width</span>&nbsp;<span class="op" id="4889253">=</span>&nbsp;<span class="num" id="4889255">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889258">n</span><span class="op" id="4889259">,</span>&nbsp;<span class="ident" id="4889261">err</span>&nbsp;<span class="op" id="4889265">:=</span>&nbsp;<span class="ident" id="4889268">io</span><span class="op" id="4889270">.</span><span class="ident" id="4889271">ReadFull</span><span class="op" id="4889279">(</span><span class="ident" id="4889280">r</span><span class="op" id="4889281">,</span>&nbsp;<span class="ident" id="4889283">buf</span><span class="op" id="4889286">[</span><span class="num" id="4889287">0</span><span class="op" id="4889288">:</span><span class="ident" id="4889289">width</span><span class="op" id="4889294">]</span><span class="op" id="4889295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889298">if</span>&nbsp;<span class="ident" id="4889301">n</span>&nbsp;<span class="op" id="4889303">==</span>&nbsp;<span class="num" id="4889306">0</span>&nbsp;<span class="op" id="4889308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889320">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889323">b</span>&nbsp;<span class="op" id="4889325">:=</span>&nbsp;<span class="ident" id="4889328">buf</span><span class="op" id="4889331">[</span><span class="num" id="4889332">0</span><span class="op" id="4889333">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889336">if</span>&nbsp;<span class="ident" id="4889339">b</span>&nbsp;<span class="op" id="4889341">&lt;=</span>&nbsp;<span class="num" id="4889344">0x7f</span>&nbsp;<span class="op" id="4889349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889353">return</span>&nbsp;<span class="ident" id="4889360">uint64</span><span class="op" id="4889366">(</span><span class="ident" id="4889367">b</span><span class="op" id="4889368">)</span><span class="op" id="4889369">,</span>&nbsp;<span class="ident" id="4889371">width</span><span class="op" id="4889376">,</span>&nbsp;<span class="ident" id="4889378">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889386">n</span>&nbsp;<span class="op" id="4889388">=</span>&nbsp;<span class="op" id="4889390">-</span><span class="builtintype" id="4889391">int</span><span class="op" id="4889394">(</span><span class="builtintype" id="4889395">int8</span><span class="op" id="4889399">(</span><span class="ident" id="4889400">b</span><span class="op" id="4889401">)</span><span class="op" id="4889402">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889405">if</span>&nbsp;<span class="ident" id="4889408">n</span>&nbsp;<span class="op" id="4889410">&gt;</span>&nbsp;<span class="ident" id="4889412">uint64Size</span>&nbsp;<span class="op" id="4889423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889427">err</span>&nbsp;<span class="op" id="4889431">=</span>&nbsp;<span class="ident" id="4889433">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889457">width</span><span class="op" id="4889462">,</span>&nbsp;<span class="ident" id="4889464">err</span>&nbsp;<span class="op" id="4889468">=</span>&nbsp;<span class="ident" id="4889470">io</span><span class="op" id="4889472">.</span><span class="ident" id="4889473">ReadFull</span><span class="op" id="4889481">(</span><span class="ident" id="4889482">r</span><span class="op" id="4889483">,</span>&nbsp;<span class="ident" id="4889485">buf</span><span class="op" id="4889488">[</span><span class="num" id="4889489">0</span><span class="op" id="4889490">:</span><span class="ident" id="4889491">n</span><span class="op" id="4889492">]</span><span class="op" id="4889493">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889496">if</span>&nbsp;<span class="ident" id="4889499">err</span>&nbsp;<span class="op" id="4889503">!=</span>&nbsp;<span class="ident" id="4889506">nil</span>&nbsp;<span class="op" id="4889510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889514">if</span>&nbsp;<span class="ident" id="4889517">err</span>&nbsp;<span class="op" id="4889521">==</span>&nbsp;<span class="ident" id="4889524">io</span><span class="op" id="4889526">.</span><span class="ident" id="4889527">EOF</span>&nbsp;<span class="op" id="4889531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889536">err</span>&nbsp;<span class="op" id="4889540">=</span>&nbsp;<span class="ident" id="4889542">io</span><span class="op" id="4889544">.</span><span class="ident" id="4889545">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889568">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4889579">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889645">for</span>&nbsp;<span class="ident" id="4889649">_</span><span class="op" id="4889650">,</span>&nbsp;<span class="ident" id="4889652">b</span>&nbsp;<span class="op" id="4889654">:=</span>&nbsp;<span class="keyword" id="4889657">range</span>&nbsp;<span class="ident" id="4889663">buf</span><span class="op" id="4889666">[</span><span class="num" id="4889667">0</span><span class="op" id="4889668">:</span><span class="ident" id="4889669">width</span><span class="op" id="4889674">]</span>&nbsp;<span class="op" id="4889676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889680">x</span>&nbsp;<span class="op" id="4889682">=</span>&nbsp;<span class="ident" id="4889684">x</span><span class="op" id="4889685">&lt;&lt;</span><span class="num" id="4889687">8</span>&nbsp;<span class="op" id="4889689">|</span>&nbsp;<span class="ident" id="4889691">uint64</span><span class="op" id="4889697">(</span><span class="ident" id="4889698">b</span><span class="op" id="4889699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889702">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889705">width</span><span class="op" id="4889710">++</span>&nbsp;<span class="comment" id="4889713">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889736">return</span><br>
<span class="lineno"></span><span class="op" id="4889743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4889746">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="4889808">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4889840">func</span>&nbsp;<span class="op" id="4889845">(</span><span class="ident" id="4889846">state</span>&nbsp;<span class="op" id="4889852">*</span><span class="ident" id="4889853">decoderState</span><span class="op" id="4889865">)</span>&nbsp;<span class="ident" id="4889867">decodeUint</span><span class="op" id="4889877">(</span><span class="op" id="4889878">)</span>&nbsp;<span class="op" id="4889880">(</span><span class="ident" id="4889881">x</span>&nbsp;<span class="ident" id="4889883">uint64</span><span class="op" id="4889889">)</span>&nbsp;<span class="op" id="4889891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889894">b</span><span class="op" id="4889895">,</span>&nbsp;<span class="ident" id="4889897">err</span>&nbsp;<span class="op" id="4889901">:=</span>&nbsp;<span class="ident" id="4889904">state</span><span class="op" id="4889909">.</span><span class="ident" id="4889910">b</span><span class="op" id="4889911">.</span><span class="ident" id="4889912">ReadByte</span><span class="op" id="4889920">(</span><span class="op" id="4889921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889924">if</span>&nbsp;<span class="ident" id="4889927">err</span>&nbsp;<span class="op" id="4889931">!=</span>&nbsp;<span class="ident" id="4889934">nil</span>&nbsp;<span class="op" id="4889938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889942">error_</span><span class="op" id="4889948">(</span><span class="ident" id="4889949">err</span><span class="op" id="4889952">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889958">if</span>&nbsp;<span class="ident" id="4889961">b</span>&nbsp;<span class="op" id="4889963">&lt;=</span>&nbsp;<span class="num" id="4889966">0x7f</span>&nbsp;<span class="op" id="4889971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889975">return</span>&nbsp;<span class="ident" id="4889982">uint64</span><span class="op" id="4889988">(</span><span class="ident" id="4889989">b</span><span class="op" id="4889990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889996">n</span>&nbsp;<span class="op" id="4889998">:=</span>&nbsp;<span class="op" id="4890001">-</span><span class="builtintype" id="4890002">int</span><span class="op" id="4890005">(</span><span class="builtintype" id="4890006">int8</span><span class="op" id="4890010">(</span><span class="ident" id="4890011">b</span><span class="op" id="4890012">)</span><span class="op" id="4890013">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890016">if</span>&nbsp;<span class="ident" id="4890019">n</span>&nbsp;<span class="op" id="4890021">&gt;</span>&nbsp;<span class="ident" id="4890023">uint64Size</span>&nbsp;<span class="op" id="4890034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890038">error_</span><span class="op" id="4890044">(</span><span class="ident" id="4890045">errBadUint</span><span class="op" id="4890055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890061">width</span><span class="op" id="4890066">,</span>&nbsp;<span class="ident" id="4890068">err</span>&nbsp;<span class="op" id="4890072">:=</span>&nbsp;<span class="ident" id="4890075">state</span><span class="op" id="4890080">.</span><span class="ident" id="4890081">b</span><span class="op" id="4890082">.</span><span class="ident" id="4890083">Read</span><span class="op" id="4890087">(</span><span class="ident" id="4890088">state</span><span class="op" id="4890093">.</span><span class="ident" id="4890094">buf</span><span class="op" id="4890097">[</span><span class="num" id="4890098">0</span><span class="op" id="4890099">:</span><span class="ident" id="4890100">n</span><span class="op" id="4890101">]</span><span class="op" id="4890102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890105">if</span>&nbsp;<span class="ident" id="4890108">err</span>&nbsp;<span class="op" id="4890112">!=</span>&nbsp;<span class="ident" id="4890115">nil</span>&nbsp;<span class="op" id="4890119">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890123">error_</span><span class="op" id="4890129">(</span><span class="ident" id="4890130">err</span><span class="op" id="4890133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4890139">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4890200">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890266">for</span>&nbsp;<span class="ident" id="4890270">_</span><span class="op" id="4890271">,</span>&nbsp;<span class="ident" id="4890273">b</span>&nbsp;<span class="op" id="4890275">:=</span>&nbsp;<span class="keyword" id="4890278">range</span>&nbsp;<span class="ident" id="4890284">state</span><span class="op" id="4890289">.</span><span class="ident" id="4890290">buf</span><span class="op" id="4890293">[</span><span class="num" id="4890294">0</span><span class="op" id="4890295">:</span><span class="ident" id="4890296">width</span><span class="op" id="4890301">]</span>&nbsp;<span class="op" id="4890303">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890307">x</span>&nbsp;<span class="op" id="4890309">=</span>&nbsp;<span class="ident" id="4890311">x</span><span class="op" id="4890312">&lt;&lt;</span><span class="num" id="4890314">8</span>&nbsp;<span class="op" id="4890316">|</span>&nbsp;<span class="ident" id="4890318">uint64</span><span class="op" id="4890324">(</span><span class="ident" id="4890325">b</span><span class="op" id="4890326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890332">return</span>&nbsp;<span class="ident" id="4890339">x</span><br>
<span class="lineno"></span><span class="op" id="4890341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4890344">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="4890403">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4890435">func</span>&nbsp;<span class="op" id="4890440">(</span><span class="ident" id="4890441">state</span>&nbsp;<span class="op" id="4890447">*</span><span class="ident" id="4890448">decoderState</span><span class="op" id="4890460">)</span>&nbsp;<span class="ident" id="4890462">decodeInt</span><span class="op" id="4890471">(</span><span class="op" id="4890472">)</span>&nbsp;<span class="ident" id="4890474">int64</span>&nbsp;<span class="op" id="4890480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890483">x</span>&nbsp;<span class="op" id="4890485">:=</span>&nbsp;<span class="ident" id="4890488">state</span><span class="op" id="4890493">.</span><span class="ident" id="4890494">decodeUint</span><span class="op" id="4890504">(</span><span class="op" id="4890505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890508">if</span>&nbsp;<span class="ident" id="4890511">x</span><span class="op" id="4890512">&amp;</span><span class="num" id="4890513">1</span>&nbsp;<span class="op" id="4890515">!=</span>&nbsp;<span class="num" id="4890518">0</span>&nbsp;<span class="op" id="4890520">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890524">return</span>&nbsp;<span class="op" id="4890531">^</span><span class="ident" id="4890532">int64</span><span class="op" id="4890537">(</span><span class="ident" id="4890538">x</span>&nbsp;<span class="op" id="4890540">&gt;&gt;</span>&nbsp;<span class="num" id="4890543">1</span><span class="op" id="4890544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890550">return</span>&nbsp;<span class="ident" id="4890557">int64</span><span class="op" id="4890562">(</span><span class="ident" id="4890563">x</span>&nbsp;<span class="op" id="4890565">&gt;&gt;</span>&nbsp;<span class="num" id="4890568">1</span><span class="op" id="4890569">)</span><br>
<span class="lineno"></span><span class="op" id="4890571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4890574">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4890641">type</span>&nbsp;<span class="ident" id="4890646">decOp</span>&nbsp;<span class="keyword" id="4890652">func</span><span class="op" id="4890656">(</span><span class="ident" id="4890657">i</span>&nbsp;<span class="op" id="4890659">*</span><span class="ident" id="4890660">decInstr</span><span class="op" id="4890668">,</span>&nbsp;<span class="ident" id="4890670">state</span>&nbsp;<span class="op" id="4890676">*</span><span class="ident" id="4890677">decoderState</span><span class="op" id="4890689">,</span>&nbsp;<span class="ident" id="4890691">v</span>&nbsp;<span class="ident" id="4890693">reflect</span><span class="op" id="4890700">.</span><span class="ident" id="4890701">Value</span><span class="op" id="4890706">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4890709">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="4890755">type</span>&nbsp;<span class="ident" id="4890760">decInstr</span>&nbsp;<span class="keyword" id="4890769">struct</span>&nbsp;<span class="op" id="4890776">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890779">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890785">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890792">field</span>&nbsp;<span class="builtintype" id="4890798">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4890804">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890838">index</span>&nbsp;<span class="op" id="4890844">[</span><span class="op" id="4890845">]</span><span class="builtintype" id="4890846">int</span>&nbsp;<span class="comment" id="4890850">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890896">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="4890902">error</span>&nbsp;<span class="comment" id="4890908">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="4890978">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4890981">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4891038">func</span>&nbsp;<span class="ident" id="4891043">ignoreUint</span><span class="op" id="4891053">(</span><span class="ident" id="4891054">i</span>&nbsp;<span class="op" id="4891056">*</span><span class="ident" id="4891057">decInstr</span><span class="op" id="4891065">,</span>&nbsp;<span class="ident" id="4891067">state</span>&nbsp;<span class="op" id="4891073">*</span><span class="ident" id="4891074">decoderState</span><span class="op" id="4891086">,</span>&nbsp;<span class="ident" id="4891088">v</span>&nbsp;<span class="ident" id="4891090">reflect</span><span class="op" id="4891097">.</span><span class="ident" id="4891098">Value</span><span class="op" id="4891103">)</span>&nbsp;<span class="op" id="4891105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891108">state</span><span class="op" id="4891113">.</span><span class="ident" id="4891114">decodeUint</span><span class="op" id="4891124">(</span><span class="op" id="4891125">)</span><br>
<span class="lineno"></span><span class="op" id="4891127">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4891130">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4891209">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4891228">func</span>&nbsp;<span class="ident" id="4891233">ignoreTwoUints</span><span class="op" id="4891247">(</span><span class="ident" id="4891248">i</span>&nbsp;<span class="op" id="4891250">*</span><span class="ident" id="4891251">decInstr</span><span class="op" id="4891259">,</span>&nbsp;<span class="ident" id="4891261">state</span>&nbsp;<span class="op" id="4891267">*</span><span class="ident" id="4891268">decoderState</span><span class="op" id="4891280">,</span>&nbsp;<span class="ident" id="4891282">v</span>&nbsp;<span class="ident" id="4891284">reflect</span><span class="op" id="4891291">.</span><span class="ident" id="4891292">Value</span><span class="op" id="4891297">)</span>&nbsp;<span class="op" id="4891299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891302">state</span><span class="op" id="4891307">.</span><span class="ident" id="4891308">decodeUint</span><span class="op" id="4891318">(</span><span class="op" id="4891319">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891322">state</span><span class="op" id="4891327">.</span><span class="ident" id="4891328">decodeUint</span><span class="op" id="4891338">(</span><span class="op" id="4891339">)</span><br>
<span class="lineno"></span><span class="op" id="4891341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4891344">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4891416">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="4891489">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="4891533">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4891605">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4891684">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4891697">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4891761">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="4891849">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="4891927">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4891972">func</span>&nbsp;<span class="ident" id="4891977">decAlloc</span><span class="op" id="4891985">(</span><span class="ident" id="4891986">v</span>&nbsp;<span class="ident" id="4891988">reflect</span><span class="op" id="4891995">.</span><span class="ident" id="4891996">Value</span><span class="op" id="4892001">)</span>&nbsp;<span class="ident" id="4892003">reflect</span><span class="op" id="4892010">.</span><span class="ident" id="4892011">Value</span>&nbsp;<span class="op" id="4892017">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4892020">for</span>&nbsp;<span class="ident" id="4892024">v</span><span class="op" id="4892025">.</span><span class="ident" id="4892026">Kind</span><span class="op" id="4892030">(</span><span class="op" id="4892031">)</span>&nbsp;<span class="op" id="4892033">==</span>&nbsp;<span class="ident" id="4892036">reflect</span><span class="op" id="4892043">.</span><span class="ident" id="4892044">Ptr</span>&nbsp;<span class="op" id="4892048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4892052">if</span>&nbsp;<span class="ident" id="4892055">v</span><span class="op" id="4892056">.</span><span class="ident" id="4892057">IsNil</span><span class="op" id="4892062">(</span><span class="op" id="4892063">)</span>&nbsp;<span class="op" id="4892065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892070">v</span><span class="op" id="4892071">.</span><span class="ident" id="4892072">Set</span><span class="op" id="4892075">(</span><span class="ident" id="4892076">reflect</span><span class="op" id="4892083">.</span><span class="ident" id="4892084">New</span><span class="op" id="4892087">(</span><span class="ident" id="4892088">v</span><span class="op" id="4892089">.</span><span class="ident" id="4892090">Type</span><span class="op" id="4892094">(</span><span class="op" id="4892095">)</span><span class="op" id="4892096">.</span><span class="ident" id="4892097">Elem</span><span class="op" id="4892101">(</span><span class="op" id="4892102">)</span><span class="op" id="4892103">)</span><span class="op" id="4892104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4892108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892112">v</span>&nbsp;<span class="op" id="4892114">=</span>&nbsp;<span class="ident" id="4892116">v</span><span class="op" id="4892117">.</span><span class="ident" id="4892118">Elem</span><span class="op" id="4892122">(</span><span class="op" id="4892123">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4892126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4892129">return</span>&nbsp;<span class="ident" id="4892136">v</span><br>
<span class="lineno"></span><span class="op" id="4892138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4892141">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="4892204">func</span>&nbsp;<span class="ident" id="4892209">decBool</span><span class="op" id="4892216">(</span><span class="ident" id="4892217">i</span>&nbsp;<span class="op" id="4892219">*</span><span class="ident" id="4892220">decInstr</span><span class="op" id="4892228">,</span>&nbsp;<span class="ident" id="4892230">state</span>&nbsp;<span class="op" id="4892236">*</span><span class="ident" id="4892237">decoderState</span><span class="op" id="4892249">,</span>&nbsp;<span class="ident" id="4892251">value</span>&nbsp;<span class="ident" id="4892257">reflect</span><span class="op" id="4892264">.</span><span class="ident" id="4892265">Value</span><span class="op" id="4892270">)</span>&nbsp;<span class="op" id="4892272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892275">value</span><span class="op" id="4892280">.</span><span class="ident" id="4892281">SetBool</span><span class="op" id="4892288">(</span><span class="ident" id="4892289">state</span><span class="op" id="4892294">.</span><span class="ident" id="4892295">decodeUint</span><span class="op" id="4892305">(</span><span class="op" id="4892306">)</span>&nbsp;<span class="op" id="4892308">!=</span>&nbsp;<span class="num" id="4892311">0</span><span class="op" id="4892312">)</span><br>
<span class="lineno"></span><span class="op" id="4892314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4892317">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="4892382">func</span>&nbsp;<span class="ident" id="4892387">decInt8</span><span class="op" id="4892394">(</span><span class="ident" id="4892395">i</span>&nbsp;<span class="op" id="4892397">*</span><span class="ident" id="4892398">decInstr</span><span class="op" id="4892406">,</span>&nbsp;<span class="ident" id="4892408">state</span>&nbsp;<span class="op" id="4892414">*</span><span class="ident" id="4892415">decoderState</span><span class="op" id="4892427">,</span>&nbsp;<span class="ident" id="4892429">value</span>&nbsp;<span class="ident" id="4892435">reflect</span><span class="op" id="4892442">.</span><span class="ident" id="4892443">Value</span><span class="op" id="4892448">)</span>&nbsp;<span class="op" id="4892450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892453">v</span>&nbsp;<span class="op" id="4892455">:=</span>&nbsp;<span class="ident" id="4892458">state</span><span class="op" id="4892463">.</span><span class="ident" id="4892464">decodeInt</span><span class="op" id="4892473">(</span><span class="op" id="4892474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4892477">if</span>&nbsp;<span class="ident" id="4892480">v</span>&nbsp;<span class="op" id="4892482">&lt;</span>&nbsp;<span class="ident" id="4892484">math</span><span class="op" id="4892488">.</span><span class="ident" id="4892489">MinInt8</span>&nbsp;<span class="op" id="4892497">||</span>&nbsp;<span class="ident" id="4892500">math</span><span class="op" id="4892504">.</span><span class="ident" id="4892505">MaxInt8</span>&nbsp;<span class="op" id="4892513">&lt;</span>&nbsp;<span class="ident" id="4892515">v</span>&nbsp;<span class="op" id="4892517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892521">error_</span><span class="op" id="4892527">(</span><span class="ident" id="4892528">i</span><span class="op" id="4892529">.</span><span class="ident" id="4892530">ovfl</span><span class="op" id="4892534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4892537">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892540">value</span><span class="op" id="4892545">.</span><span class="ident" id="4892546">SetInt</span><span class="op" id="4892552">(</span><span class="ident" id="4892553">v</span><span class="op" id="4892554">)</span><br>
<span class="lineno"></span><span class="op" id="4892556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4892559">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4892634">func</span>&nbsp;<span class="ident" id="4892639">decUint8</span><span class="op" id="4892647">(</span><span class="ident" id="4892648">i</span>&nbsp;<span class="op" id="4892650">*</span><span class="ident" id="4892651">decInstr</span><span class="op" id="4892659">,</span>&nbsp;<span class="ident" id="4892661">state</span>&nbsp;<span class="op" id="4892667">*</span><span class="ident" id="4892668">decoderState</span><span class="op" id="4892680">,</span>&nbsp;<span class="ident" id="4892682">value</span>&nbsp;<span class="ident" id="4892688">reflect</span><span class="op" id="4892695">.</span><span class="ident" id="4892696">Value</span><span class="op" id="4892701">)</span>&nbsp;<span class="op" id="4892703">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892706">v</span>&nbsp;<span class="op" id="4892708">:=</span>&nbsp;<span class="ident" id="4892711">state</span><span class="op" id="4892716">.</span><span class="ident" id="4892717">decodeUint</span><span class="op" id="4892727">(</span><span class="op" id="4892728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4892731">if</span>&nbsp;<span class="ident" id="4892734">math</span><span class="op" id="4892738">.</span><span class="ident" id="4892739">MaxUint8</span>&nbsp;<span class="op" id="4892748">&lt;</span>&nbsp;<span class="ident" id="4892750">v</span>&nbsp;<span class="op" id="4892752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892756">error_</span><span class="op" id="4892762">(</span><span class="ident" id="4892763">i</span><span class="op" id="4892764">.</span><span class="ident" id="4892765">ovfl</span><span class="op" id="4892769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4892772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892775">value</span><span class="op" id="4892780">.</span><span class="ident" id="4892781">SetUint</span><span class="op" id="4892788">(</span><span class="ident" id="4892789">v</span><span class="op" id="4892790">)</span><br>
<span class="lineno">250</span><span class="op" id="4892792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4892795">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4892862">func</span>&nbsp;<span class="ident" id="4892867">decInt16</span><span class="op" id="4892875">(</span><span class="ident" id="4892876">i</span>&nbsp;<span class="op" id="4892878">*</span><span class="ident" id="4892879">decInstr</span><span class="op" id="4892887">,</span>&nbsp;<span class="ident" id="4892889">state</span>&nbsp;<span class="op" id="4892895">*</span><span class="ident" id="4892896">decoderState</span><span class="op" id="4892908">,</span>&nbsp;<span class="ident" id="4892910">value</span>&nbsp;<span class="ident" id="4892916">reflect</span><span class="op" id="4892923">.</span><span class="ident" id="4892924">Value</span><span class="op" id="4892929">)</span>&nbsp;<span class="op" id="4892931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4892934">v</span>&nbsp;<span class="op" id="4892936">:=</span>&nbsp;<span class="ident" id="4892939">state</span><span class="op" id="4892944">.</span><span class="ident" id="4892945">decodeInt</span><span class="op" id="4892954">(</span><span class="op" id="4892955">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4892958">if</span>&nbsp;<span class="ident" id="4892961">v</span>&nbsp;<span class="op" id="4892963">&lt;</span>&nbsp;<span class="ident" id="4892965">math</span><span class="op" id="4892969">.</span><span class="ident" id="4892970">MinInt16</span>&nbsp;<span class="op" id="4892979">||</span>&nbsp;<span class="ident" id="4892982">math</span><span class="op" id="4892986">.</span><span class="ident" id="4892987">MaxInt16</span>&nbsp;<span class="op" id="4892996">&lt;</span>&nbsp;<span class="ident" id="4892998">v</span>&nbsp;<span class="op" id="4893000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893004">error_</span><span class="op" id="4893010">(</span><span class="ident" id="4893011">i</span><span class="op" id="4893012">.</span><span class="ident" id="4893013">ovfl</span><span class="op" id="4893017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4893020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893023">value</span><span class="op" id="4893028">.</span><span class="ident" id="4893029">SetInt</span><span class="op" id="4893035">(</span><span class="ident" id="4893036">v</span><span class="op" id="4893037">)</span><br>
<span class="lineno"></span><span class="op" id="4893039">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4893042">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4893119">func</span>&nbsp;<span class="ident" id="4893124">decUint16</span><span class="op" id="4893133">(</span><span class="ident" id="4893134">i</span>&nbsp;<span class="op" id="4893136">*</span><span class="ident" id="4893137">decInstr</span><span class="op" id="4893145">,</span>&nbsp;<span class="ident" id="4893147">state</span>&nbsp;<span class="op" id="4893153">*</span><span class="ident" id="4893154">decoderState</span><span class="op" id="4893166">,</span>&nbsp;<span class="ident" id="4893168">value</span>&nbsp;<span class="ident" id="4893174">reflect</span><span class="op" id="4893181">.</span><span class="ident" id="4893182">Value</span><span class="op" id="4893187">)</span>&nbsp;<span class="op" id="4893189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893192">v</span>&nbsp;<span class="op" id="4893194">:=</span>&nbsp;<span class="ident" id="4893197">state</span><span class="op" id="4893202">.</span><span class="ident" id="4893203">decodeUint</span><span class="op" id="4893213">(</span><span class="op" id="4893214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4893217">if</span>&nbsp;<span class="ident" id="4893220">math</span><span class="op" id="4893224">.</span><span class="ident" id="4893225">MaxUint16</span>&nbsp;<span class="op" id="4893235">&lt;</span>&nbsp;<span class="ident" id="4893237">v</span>&nbsp;<span class="op" id="4893239">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893243">error_</span><span class="op" id="4893249">(</span><span class="ident" id="4893250">i</span><span class="op" id="4893251">.</span><span class="ident" id="4893252">ovfl</span><span class="op" id="4893256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4893259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893262">value</span><span class="op" id="4893267">.</span><span class="ident" id="4893268">SetUint</span><span class="op" id="4893275">(</span><span class="ident" id="4893276">v</span><span class="op" id="4893277">)</span><br>
<span class="lineno"></span><span class="op" id="4893279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4893282">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4893349">func</span>&nbsp;<span class="ident" id="4893354">decInt32</span><span class="op" id="4893362">(</span><span class="ident" id="4893363">i</span>&nbsp;<span class="op" id="4893365">*</span><span class="ident" id="4893366">decInstr</span><span class="op" id="4893374">,</span>&nbsp;<span class="ident" id="4893376">state</span>&nbsp;<span class="op" id="4893382">*</span><span class="ident" id="4893383">decoderState</span><span class="op" id="4893395">,</span>&nbsp;<span class="ident" id="4893397">value</span>&nbsp;<span class="ident" id="4893403">reflect</span><span class="op" id="4893410">.</span><span class="ident" id="4893411">Value</span><span class="op" id="4893416">)</span>&nbsp;<span class="op" id="4893418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893421">v</span>&nbsp;<span class="op" id="4893423">:=</span>&nbsp;<span class="ident" id="4893426">state</span><span class="op" id="4893431">.</span><span class="ident" id="4893432">decodeInt</span><span class="op" id="4893441">(</span><span class="op" id="4893442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4893445">if</span>&nbsp;<span class="ident" id="4893448">v</span>&nbsp;<span class="op" id="4893450">&lt;</span>&nbsp;<span class="ident" id="4893452">math</span><span class="op" id="4893456">.</span><span class="ident" id="4893457">MinInt32</span>&nbsp;<span class="op" id="4893466">||</span>&nbsp;<span class="ident" id="4893469">math</span><span class="op" id="4893473">.</span><span class="ident" id="4893474">MaxInt32</span>&nbsp;<span class="op" id="4893483">&lt;</span>&nbsp;<span class="ident" id="4893485">v</span>&nbsp;<span class="op" id="4893487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893491">error_</span><span class="op" id="4893497">(</span><span class="ident" id="4893498">i</span><span class="op" id="4893499">.</span><span class="ident" id="4893500">ovfl</span><span class="op" id="4893504">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4893507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893510">value</span><span class="op" id="4893515">.</span><span class="ident" id="4893516">SetInt</span><span class="op" id="4893522">(</span><span class="ident" id="4893523">v</span><span class="op" id="4893524">)</span><br>
<span class="lineno"></span><span class="op" id="4893526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4893529">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="4893606">func</span>&nbsp;<span class="ident" id="4893611">decUint32</span><span class="op" id="4893620">(</span><span class="ident" id="4893621">i</span>&nbsp;<span class="op" id="4893623">*</span><span class="ident" id="4893624">decInstr</span><span class="op" id="4893632">,</span>&nbsp;<span class="ident" id="4893634">state</span>&nbsp;<span class="op" id="4893640">*</span><span class="ident" id="4893641">decoderState</span><span class="op" id="4893653">,</span>&nbsp;<span class="ident" id="4893655">value</span>&nbsp;<span class="ident" id="4893661">reflect</span><span class="op" id="4893668">.</span><span class="ident" id="4893669">Value</span><span class="op" id="4893674">)</span>&nbsp;<span class="op" id="4893676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893679">v</span>&nbsp;<span class="op" id="4893681">:=</span>&nbsp;<span class="ident" id="4893684">state</span><span class="op" id="4893689">.</span><span class="ident" id="4893690">decodeUint</span><span class="op" id="4893700">(</span><span class="op" id="4893701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4893704">if</span>&nbsp;<span class="ident" id="4893707">math</span><span class="op" id="4893711">.</span><span class="ident" id="4893712">MaxUint32</span>&nbsp;<span class="op" id="4893722">&lt;</span>&nbsp;<span class="ident" id="4893724">v</span>&nbsp;<span class="op" id="4893726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893730">error_</span><span class="op" id="4893736">(</span><span class="ident" id="4893737">i</span><span class="op" id="4893738">.</span><span class="ident" id="4893739">ovfl</span><span class="op" id="4893743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4893746">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893749">value</span><span class="op" id="4893754">.</span><span class="ident" id="4893755">SetUint</span><span class="op" id="4893762">(</span><span class="ident" id="4893763">v</span><span class="op" id="4893764">)</span><br>
<span class="lineno"></span><span class="op" id="4893766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4893769">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4893836">func</span>&nbsp;<span class="ident" id="4893841">decInt64</span><span class="op" id="4893849">(</span><span class="ident" id="4893850">i</span>&nbsp;<span class="op" id="4893852">*</span><span class="ident" id="4893853">decInstr</span><span class="op" id="4893861">,</span>&nbsp;<span class="ident" id="4893863">state</span>&nbsp;<span class="op" id="4893869">*</span><span class="ident" id="4893870">decoderState</span><span class="op" id="4893882">,</span>&nbsp;<span class="ident" id="4893884">value</span>&nbsp;<span class="ident" id="4893890">reflect</span><span class="op" id="4893897">.</span><span class="ident" id="4893898">Value</span><span class="op" id="4893903">)</span>&nbsp;<span class="op" id="4893905">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893908">v</span>&nbsp;<span class="op" id="4893910">:=</span>&nbsp;<span class="ident" id="4893913">state</span><span class="op" id="4893918">.</span><span class="ident" id="4893919">decodeInt</span><span class="op" id="4893928">(</span><span class="op" id="4893929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893932">value</span><span class="op" id="4893937">.</span><span class="ident" id="4893938">SetInt</span><span class="op" id="4893944">(</span><span class="ident" id="4893945">v</span><span class="op" id="4893946">)</span><br>
<span class="lineno"></span><span class="op" id="4893948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4893951">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="4894028">func</span>&nbsp;<span class="ident" id="4894033">decUint64</span><span class="op" id="4894042">(</span><span class="ident" id="4894043">i</span>&nbsp;<span class="op" id="4894045">*</span><span class="ident" id="4894046">decInstr</span><span class="op" id="4894054">,</span>&nbsp;<span class="ident" id="4894056">state</span>&nbsp;<span class="op" id="4894062">*</span><span class="ident" id="4894063">decoderState</span><span class="op" id="4894075">,</span>&nbsp;<span class="ident" id="4894077">value</span>&nbsp;<span class="ident" id="4894083">reflect</span><span class="op" id="4894090">.</span><span class="ident" id="4894091">Value</span><span class="op" id="4894096">)</span>&nbsp;<span class="op" id="4894098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894101">v</span>&nbsp;<span class="op" id="4894103">:=</span>&nbsp;<span class="ident" id="4894106">state</span><span class="op" id="4894111">.</span><span class="ident" id="4894112">decodeUint</span><span class="op" id="4894122">(</span><span class="op" id="4894123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894126">value</span><span class="op" id="4894131">.</span><span class="ident" id="4894132">SetUint</span><span class="op" id="4894139">(</span><span class="ident" id="4894140">v</span><span class="op" id="4894141">)</span><br>
<span class="lineno"></span><span class="op" id="4894143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4894146">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4894216">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4894288">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="4894360">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4894425">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="4894441">func</span>&nbsp;<span class="ident" id="4894446">float64FromBits</span><span class="op" id="4894461">(</span><span class="ident" id="4894462">u</span>&nbsp;<span class="ident" id="4894464">uint64</span><span class="op" id="4894470">)</span>&nbsp;<span class="builtintype" id="4894472">float64</span>&nbsp;<span class="op" id="4894480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4894483">var</span>&nbsp;<span class="ident" id="4894487">v</span>&nbsp;<span class="ident" id="4894489">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4894497">for</span>&nbsp;<span class="ident" id="4894501">i</span>&nbsp;<span class="op" id="4894503">:=</span>&nbsp;<span class="num" id="4894506">0</span><span class="op" id="4894507">;</span>&nbsp;<span class="ident" id="4894509">i</span>&nbsp;<span class="op" id="4894511">&lt;</span>&nbsp;<span class="num" id="4894513">8</span><span class="op" id="4894514">;</span>&nbsp;<span class="ident" id="4894516">i</span><span class="op" id="4894517">++</span>&nbsp;<span class="op" id="4894520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894524">v</span>&nbsp;<span class="op" id="4894526">&lt;&lt;=</span>&nbsp;<span class="num" id="4894530">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894534">v</span>&nbsp;<span class="op" id="4894536">|=</span>&nbsp;<span class="ident" id="4894539">u</span>&nbsp;<span class="op" id="4894541">&amp;</span>&nbsp;<span class="num" id="4894543">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894550">u</span>&nbsp;<span class="op" id="4894552">&gt;&gt;=</span>&nbsp;<span class="num" id="4894556">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4894559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4894562">return</span>&nbsp;<span class="ident" id="4894569">math</span><span class="op" id="4894573">.</span><span class="ident" id="4894574">Float64frombits</span><span class="op" id="4894589">(</span><span class="ident" id="4894590">v</span><span class="op" id="4894591">)</span><br>
<span class="lineno"></span><span class="op" id="4894593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4894596">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4894681">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="4894758">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4894835">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="4894898">func</span>&nbsp;<span class="ident" id="4894903">float32FromBits</span><span class="op" id="4894918">(</span><span class="ident" id="4894919">u</span>&nbsp;<span class="ident" id="4894921">uint64</span><span class="op" id="4894927">,</span>&nbsp;<span class="ident" id="4894929">ovfl</span>&nbsp;<span class="builtintype" id="4894934">error</span><span class="op" id="4894939">)</span>&nbsp;<span class="builtintype" id="4894941">float64</span>&nbsp;<span class="op" id="4894949">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894952">v</span>&nbsp;<span class="op" id="4894954">:=</span>&nbsp;<span class="ident" id="4894957">float64FromBits</span><span class="op" id="4894972">(</span><span class="ident" id="4894973">u</span><span class="op" id="4894974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4894977">av</span>&nbsp;<span class="op" id="4894980">:=</span>&nbsp;<span class="ident" id="4894983">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4894986">if</span>&nbsp;<span class="ident" id="4894989">av</span>&nbsp;<span class="op" id="4894992">&lt;</span>&nbsp;<span class="num" id="4894994">0</span>&nbsp;<span class="op" id="4894996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4895000">av</span>&nbsp;<span class="op" id="4895003">=</span>&nbsp;<span class="op" id="4895005">-</span><span class="ident" id="4895006">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4895010">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4895013">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4895084">if</span>&nbsp;<span class="ident" id="4895087">math</span><span class="op" id="4895091">.</span><span class="ident" id="4895092">MaxFloat32</span>&nbsp;<span class="op" id="4895103">&lt;</span>&nbsp;<span class="ident" id="4895105">av</span>&nbsp;<span class="op" id="4895108">&amp;&amp;</span>&nbsp;<span class="ident" id="4895111">av</span>&nbsp;<span class="op" id="4895114">&lt;=</span>&nbsp;<span class="ident" id="4895117">math</span><span class="op" id="4895121">.</span><span class="ident" id="4895122">MaxFloat64</span>&nbsp;<span class="op" id="4895133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4895137">error_</span><span class="op" id="4895143">(</span><span class="ident" id="4895144">ovfl</span><span class="op" id="4895148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4895151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4895154">return</span>&nbsp;<span class="ident" id="4895161">v</span><br>
<span class="lineno">330</span><span class="op" id="4895163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4895166">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4895246">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4895281">func</span>&nbsp;<span class="ident" id="4895286">decFloat32</span><span class="op" id="4895296">(</span><span class="ident" id="4895297">i</span>&nbsp;<span class="op" id="4895299">*</span><span class="ident" id="4895300">decInstr</span><span class="op" id="4895308">,</span>&nbsp;<span class="ident" id="4895310">state</span>&nbsp;<span class="op" id="4895316">*</span><span class="ident" id="4895317">decoderState</span><span class="op" id="4895329">,</span>&nbsp;<span class="ident" id="4895331">value</span>&nbsp;<span class="ident" id="4895337">reflect</span><span class="op" id="4895344">.</span><span class="ident" id="4895345">Value</span><span class="op" id="4895350">)</span>&nbsp;<span class="op" id="4895352">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4895355">value</span><span class="op" id="4895360">.</span><span class="ident" id="4895361">SetFloat</span><span class="op" id="4895369">(</span><span class="ident" id="4895370">float32FromBits</span><span class="op" id="4895385">(</span><span class="ident" id="4895386">state</span><span class="op" id="4895391">.</span><span class="ident" id="4895392">decodeUint</span><span class="op" id="4895402">(</span><span class="op" id="4895403">)</span><span class="op" id="4895404">,</span>&nbsp;<span class="ident" id="4895406">i</span><span class="op" id="4895407">.</span><span class="ident" id="4895408">ovfl</span><span class="op" id="4895412">)</span><span class="op" id="4895413">)</span><br>
<span class="lineno"></span><span class="op" id="4895415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4895418">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4895498">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="4895533">func</span>&nbsp;<span class="ident" id="4895538">decFloat64</span><span class="op" id="4895548">(</span><span class="ident" id="4895549">i</span>&nbsp;<span class="op" id="4895551">*</span><span class="ident" id="4895552">decInstr</span><span class="op" id="4895560">,</span>&nbsp;<span class="ident" id="4895562">state</span>&nbsp;<span class="op" id="4895568">*</span><span class="ident" id="4895569">decoderState</span><span class="op" id="4895581">,</span>&nbsp;<span class="ident" id="4895583">value</span>&nbsp;<span class="ident" id="4895589">reflect</span><span class="op" id="4895596">.</span><span class="ident" id="4895597">Value</span><span class="op" id="4895602">)</span>&nbsp;<span class="op" id="4895604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4895607">value</span><span class="op" id="4895612">.</span><span class="ident" id="4895613">SetFloat</span><span class="op" id="4895621">(</span><span class="ident" id="4895622">float64FromBits</span><span class="op" id="4895637">(</span><span class="ident" id="4895638">state</span><span class="op" id="4895643">.</span><span class="ident" id="4895644">decodeUint</span><span class="op" id="4895654">(</span><span class="op" id="4895655">)</span><span class="op" id="4895656">)</span><span class="op" id="4895657">)</span><br>
<span class="lineno"></span><span class="op" id="4895659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4895662">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="4895732">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4895808">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4895838">func</span>&nbsp;<span class="ident" id="4895843">decComplex64</span><span class="op" id="4895855">(</span><span class="ident" id="4895856">i</span>&nbsp;<span class="op" id="4895858">*</span><span class="ident" id="4895859">decInstr</span><span class="op" id="4895867">,</span>&nbsp;<span class="ident" id="4895869">state</span>&nbsp;<span class="op" id="4895875">*</span><span class="ident" id="4895876">decoderState</span><span class="op" id="4895888">,</span>&nbsp;<span class="ident" id="4895890">value</span>&nbsp;<span class="ident" id="4895896">reflect</span><span class="op" id="4895903">.</span><span class="ident" id="4895904">Value</span><span class="op" id="4895909">)</span>&nbsp;<span class="op" id="4895911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4895914">real</span>&nbsp;<span class="op" id="4895919">:=</span>&nbsp;<span class="ident" id="4895922">float32FromBits</span><span class="op" id="4895937">(</span><span class="ident" id="4895938">state</span><span class="op" id="4895943">.</span><span class="ident" id="4895944">decodeUint</span><span class="op" id="4895954">(</span><span class="op" id="4895955">)</span><span class="op" id="4895956">,</span>&nbsp;<span class="ident" id="4895958">i</span><span class="op" id="4895959">.</span><span class="ident" id="4895960">ovfl</span><span class="op" id="4895964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4895967">imag</span>&nbsp;<span class="op" id="4895972">:=</span>&nbsp;<span class="ident" id="4895975">float32FromBits</span><span class="op" id="4895990">(</span><span class="ident" id="4895991">state</span><span class="op" id="4895996">.</span><span class="ident" id="4895997">decodeUint</span><span class="op" id="4896007">(</span><span class="op" id="4896008">)</span><span class="op" id="4896009">,</span>&nbsp;<span class="ident" id="4896011">i</span><span class="op" id="4896012">.</span><span class="ident" id="4896013">ovfl</span><span class="op" id="4896017">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896020">value</span><span class="op" id="4896025">.</span><span class="ident" id="4896026">SetComplex</span><span class="op" id="4896036">(</span><span class="builtinfunc" id="4896037">complex</span><span class="op" id="4896044">(</span><span class="builtinfunc" id="4896045">real</span><span class="op" id="4896049">,</span>&nbsp;<span class="builtinfunc" id="4896051">imag</span><span class="op" id="4896055">)</span><span class="op" id="4896056">)</span><br>
<span class="lineno"></span><span class="op" id="4896058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4896061">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4896132">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="4896209">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4896239">func</span>&nbsp;<span class="ident" id="4896244">decComplex128</span><span class="op" id="4896257">(</span><span class="ident" id="4896258">i</span>&nbsp;<span class="op" id="4896260">*</span><span class="ident" id="4896261">decInstr</span><span class="op" id="4896269">,</span>&nbsp;<span class="ident" id="4896271">state</span>&nbsp;<span class="op" id="4896277">*</span><span class="ident" id="4896278">decoderState</span><span class="op" id="4896290">,</span>&nbsp;<span class="ident" id="4896292">value</span>&nbsp;<span class="ident" id="4896298">reflect</span><span class="op" id="4896305">.</span><span class="ident" id="4896306">Value</span><span class="op" id="4896311">)</span>&nbsp;<span class="op" id="4896313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4896316">real</span>&nbsp;<span class="op" id="4896321">:=</span>&nbsp;<span class="ident" id="4896324">float64FromBits</span><span class="op" id="4896339">(</span><span class="ident" id="4896340">state</span><span class="op" id="4896345">.</span><span class="ident" id="4896346">decodeUint</span><span class="op" id="4896356">(</span><span class="op" id="4896357">)</span><span class="op" id="4896358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4896361">imag</span>&nbsp;<span class="op" id="4896366">:=</span>&nbsp;<span class="ident" id="4896369">float64FromBits</span><span class="op" id="4896384">(</span><span class="ident" id="4896385">state</span><span class="op" id="4896390">.</span><span class="ident" id="4896391">decodeUint</span><span class="op" id="4896401">(</span><span class="op" id="4896402">)</span><span class="op" id="4896403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896406">value</span><span class="op" id="4896411">.</span><span class="ident" id="4896412">SetComplex</span><span class="op" id="4896422">(</span><span class="builtinfunc" id="4896423">complex</span><span class="op" id="4896430">(</span><span class="builtinfunc" id="4896431">real</span><span class="op" id="4896435">,</span>&nbsp;<span class="builtinfunc" id="4896437">imag</span><span class="op" id="4896441">)</span><span class="op" id="4896442">)</span><br>
<span class="lineno">360</span><span class="op" id="4896444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4896447">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4896520">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4896544">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="4896620">func</span>&nbsp;<span class="ident" id="4896625">decUint8Slice</span><span class="op" id="4896638">(</span><span class="ident" id="4896639">i</span>&nbsp;<span class="op" id="4896641">*</span><span class="ident" id="4896642">decInstr</span><span class="op" id="4896650">,</span>&nbsp;<span class="ident" id="4896652">state</span>&nbsp;<span class="op" id="4896658">*</span><span class="ident" id="4896659">decoderState</span><span class="op" id="4896671">,</span>&nbsp;<span class="ident" id="4896673">value</span>&nbsp;<span class="ident" id="4896679">reflect</span><span class="op" id="4896686">.</span><span class="ident" id="4896687">Value</span><span class="op" id="4896692">)</span>&nbsp;<span class="op" id="4896694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896697">u</span>&nbsp;<span class="op" id="4896699">:=</span>&nbsp;<span class="ident" id="4896702">state</span><span class="op" id="4896707">.</span><span class="ident" id="4896708">decodeUint</span><span class="op" id="4896718">(</span><span class="op" id="4896719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896722">n</span>&nbsp;<span class="op" id="4896724">:=</span>&nbsp;<span class="builtintype" id="4896727">int</span><span class="op" id="4896730">(</span><span class="ident" id="4896731">u</span><span class="op" id="4896732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4896735">if</span>&nbsp;<span class="ident" id="4896738">n</span>&nbsp;<span class="op" id="4896740">&lt;</span>&nbsp;<span class="num" id="4896742">0</span>&nbsp;<span class="op" id="4896744">||</span>&nbsp;<span class="ident" id="4896747">uint64</span><span class="op" id="4896753">(</span><span class="ident" id="4896754">n</span><span class="op" id="4896755">)</span>&nbsp;<span class="op" id="4896757">!=</span>&nbsp;<span class="ident" id="4896760">u</span>&nbsp;<span class="op" id="4896762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896766">errorf</span><span class="op" id="4896772">(</span><span class="string" id="4896773">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4896817">,</span>&nbsp;<span class="ident" id="4896819">value</span><span class="op" id="4896824">.</span><span class="ident" id="4896825">Type</span><span class="op" id="4896829">(</span><span class="op" id="4896830">)</span><span class="op" id="4896831">,</span>&nbsp;<span class="ident" id="4896833">u</span><span class="op" id="4896834">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4896837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4896840">if</span>&nbsp;<span class="ident" id="4896843">n</span>&nbsp;<span class="op" id="4896845">&gt;</span>&nbsp;<span class="ident" id="4896847">state</span><span class="op" id="4896852">.</span><span class="ident" id="4896853">b</span><span class="op" id="4896854">.</span><span class="ident" id="4896855">Len</span><span class="op" id="4896858">(</span><span class="op" id="4896859">)</span>&nbsp;<span class="op" id="4896861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896865">errorf</span><span class="op" id="4896871">(</span><span class="string" id="4896872">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4896905">,</span>&nbsp;<span class="ident" id="4896907">value</span><span class="op" id="4896912">.</span><span class="ident" id="4896913">Type</span><span class="op" id="4896917">(</span><span class="op" id="4896918">)</span><span class="op" id="4896919">,</span>&nbsp;<span class="ident" id="4896921">n</span><span class="op" id="4896922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4896925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4896928">if</span>&nbsp;<span class="ident" id="4896931">n</span>&nbsp;<span class="op" id="4896933">&gt;</span>&nbsp;<span class="ident" id="4896935">tooBig</span>&nbsp;<span class="op" id="4896942">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4896946">errorf</span><span class="op" id="4896952">(</span><span class="string" id="4896953">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="4896977">,</span>&nbsp;<span class="ident" id="4896979">n</span><span class="op" id="4896980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4896983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4896986">if</span>&nbsp;<span class="ident" id="4896989">value</span><span class="op" id="4896994">.</span><span class="ident" id="4896995">Cap</span><span class="op" id="4896998">(</span><span class="op" id="4896999">)</span>&nbsp;<span class="op" id="4897001">&lt;</span>&nbsp;<span class="ident" id="4897003">n</span>&nbsp;<span class="op" id="4897005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897009">value</span><span class="op" id="4897014">.</span><span class="ident" id="4897015">Set</span><span class="op" id="4897018">(</span><span class="ident" id="4897019">reflect</span><span class="op" id="4897026">.</span><span class="ident" id="4897027">MakeSlice</span><span class="op" id="4897036">(</span><span class="ident" id="4897037">value</span><span class="op" id="4897042">.</span><span class="ident" id="4897043">Type</span><span class="op" id="4897047">(</span><span class="op" id="4897048">)</span><span class="op" id="4897049">,</span>&nbsp;<span class="ident" id="4897051">n</span><span class="op" id="4897052">,</span>&nbsp;<span class="ident" id="4897054">n</span><span class="op" id="4897055">)</span><span class="op" id="4897056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4897059">}</span>&nbsp;<span class="keyword" id="4897061">else</span>&nbsp;<span class="op" id="4897066">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897070">value</span><span class="op" id="4897075">.</span><span class="ident" id="4897076">Set</span><span class="op" id="4897079">(</span><span class="ident" id="4897080">value</span><span class="op" id="4897085">.</span><span class="ident" id="4897086">Slice</span><span class="op" id="4897091">(</span><span class="num" id="4897092">0</span><span class="op" id="4897093">,</span>&nbsp;<span class="ident" id="4897095">n</span><span class="op" id="4897096">)</span><span class="op" id="4897097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4897100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4897103">if</span>&nbsp;<span class="ident" id="4897106">_</span><span class="op" id="4897107">,</span>&nbsp;<span class="ident" id="4897109">err</span>&nbsp;<span class="op" id="4897113">:=</span>&nbsp;<span class="ident" id="4897116">state</span><span class="op" id="4897121">.</span><span class="ident" id="4897122">b</span><span class="op" id="4897123">.</span><span class="ident" id="4897124">Read</span><span class="op" id="4897128">(</span><span class="ident" id="4897129">value</span><span class="op" id="4897134">.</span><span class="ident" id="4897135">Bytes</span><span class="op" id="4897140">(</span><span class="op" id="4897141">)</span><span class="op" id="4897142">)</span><span class="op" id="4897143">;</span>&nbsp;<span class="ident" id="4897145">err</span>&nbsp;<span class="op" id="4897149">!=</span>&nbsp;<span class="ident" id="4897152">nil</span>&nbsp;<span class="op" id="4897156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897160">errorf</span><span class="op" id="4897166">(</span><span class="string" id="4897167">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="4897194">,</span>&nbsp;<span class="ident" id="4897196">err</span><span class="op" id="4897199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4897202">}</span><br>
<span class="lineno">385</span><span class="op" id="4897204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897207">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4897275">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4897299">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="4897370">func</span>&nbsp;<span class="ident" id="4897375">decString</span><span class="op" id="4897384">(</span><span class="ident" id="4897385">i</span>&nbsp;<span class="op" id="4897387">*</span><span class="ident" id="4897388">decInstr</span><span class="op" id="4897396">,</span>&nbsp;<span class="ident" id="4897398">state</span>&nbsp;<span class="op" id="4897404">*</span><span class="ident" id="4897405">decoderState</span><span class="op" id="4897417">,</span>&nbsp;<span class="ident" id="4897419">value</span>&nbsp;<span class="ident" id="4897425">reflect</span><span class="op" id="4897432">.</span><span class="ident" id="4897433">Value</span><span class="op" id="4897438">)</span>&nbsp;<span class="op" id="4897440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897443">u</span>&nbsp;<span class="op" id="4897445">:=</span>&nbsp;<span class="ident" id="4897448">state</span><span class="op" id="4897453">.</span><span class="ident" id="4897454">decodeUint</span><span class="op" id="4897464">(</span><span class="op" id="4897465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897468">n</span>&nbsp;<span class="op" id="4897470">:=</span>&nbsp;<span class="builtintype" id="4897473">int</span><span class="op" id="4897476">(</span><span class="ident" id="4897477">u</span><span class="op" id="4897478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4897481">if</span>&nbsp;<span class="ident" id="4897484">n</span>&nbsp;<span class="op" id="4897486">&lt;</span>&nbsp;<span class="num" id="4897488">0</span>&nbsp;<span class="op" id="4897490">||</span>&nbsp;<span class="ident" id="4897493">uint64</span><span class="op" id="4897499">(</span><span class="ident" id="4897500">n</span><span class="op" id="4897501">)</span>&nbsp;<span class="op" id="4897503">!=</span>&nbsp;<span class="ident" id="4897506">u</span>&nbsp;<span class="op" id="4897508">||</span>&nbsp;<span class="ident" id="4897511">n</span>&nbsp;<span class="op" id="4897513">&gt;</span>&nbsp;<span class="ident" id="4897515">state</span><span class="op" id="4897520">.</span><span class="ident" id="4897521">b</span><span class="op" id="4897522">.</span><span class="ident" id="4897523">Len</span><span class="op" id="4897526">(</span><span class="op" id="4897527">)</span>&nbsp;<span class="op" id="4897529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897533">errorf</span><span class="op" id="4897539">(</span><span class="string" id="4897540">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4897584">,</span>&nbsp;<span class="ident" id="4897586">value</span><span class="op" id="4897591">.</span><span class="ident" id="4897592">Type</span><span class="op" id="4897596">(</span><span class="op" id="4897597">)</span><span class="op" id="4897598">,</span>&nbsp;<span class="ident" id="4897600">u</span><span class="op" id="4897601">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4897604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4897607">if</span>&nbsp;<span class="ident" id="4897610">n</span>&nbsp;<span class="op" id="4897612">&gt;</span>&nbsp;<span class="ident" id="4897614">state</span><span class="op" id="4897619">.</span><span class="ident" id="4897620">b</span><span class="op" id="4897621">.</span><span class="ident" id="4897622">Len</span><span class="op" id="4897625">(</span><span class="op" id="4897626">)</span>&nbsp;<span class="op" id="4897628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897632">errorf</span><span class="op" id="4897638">(</span><span class="string" id="4897639">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4897672">,</span>&nbsp;<span class="ident" id="4897674">value</span><span class="op" id="4897679">.</span><span class="ident" id="4897680">Type</span><span class="op" id="4897684">(</span><span class="op" id="4897685">)</span><span class="op" id="4897686">,</span>&nbsp;<span class="ident" id="4897688">n</span><span class="op" id="4897689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4897692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4897695">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897714">data</span>&nbsp;<span class="op" id="4897719">:=</span>&nbsp;<span class="builtinfunc" id="4897722">make</span><span class="op" id="4897726">(</span><span class="op" id="4897727">[</span><span class="op" id="4897728">]</span><span class="builtintype" id="4897729">byte</span><span class="op" id="4897733">,</span>&nbsp;<span class="ident" id="4897735">n</span><span class="op" id="4897736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4897739">if</span>&nbsp;<span class="ident" id="4897742">_</span><span class="op" id="4897743">,</span>&nbsp;<span class="ident" id="4897745">err</span>&nbsp;<span class="op" id="4897749">:=</span>&nbsp;<span class="ident" id="4897752">state</span><span class="op" id="4897757">.</span><span class="ident" id="4897758">b</span><span class="op" id="4897759">.</span><span class="ident" id="4897760">Read</span><span class="op" id="4897764">(</span><span class="ident" id="4897765">data</span><span class="op" id="4897769">)</span><span class="op" id="4897770">;</span>&nbsp;<span class="ident" id="4897772">err</span>&nbsp;<span class="op" id="4897776">!=</span>&nbsp;<span class="ident" id="4897779">nil</span>&nbsp;<span class="op" id="4897783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897787">errorf</span><span class="op" id="4897793">(</span><span class="string" id="4897794">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="4897821">,</span>&nbsp;<span class="ident" id="4897823">err</span><span class="op" id="4897826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4897829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4897832">value</span><span class="op" id="4897837">.</span><span class="ident" id="4897838">SetString</span><span class="op" id="4897847">(</span><span class="builtintype" id="4897848">string</span><span class="op" id="4897854">(</span><span class="ident" id="4897855">data</span><span class="op" id="4897859">)</span><span class="op" id="4897860">)</span><br>
<span class="lineno">405</span><span class="op" id="4897862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897865">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4897949">func</span>&nbsp;<span class="ident" id="4897954">ignoreUint8Array</span><span class="op" id="4897970">(</span><span class="ident" id="4897971">i</span>&nbsp;<span class="op" id="4897973">*</span><span class="ident" id="4897974">decInstr</span><span class="op" id="4897982">,</span>&nbsp;<span class="ident" id="4897984">state</span>&nbsp;<span class="op" id="4897990">*</span><span class="ident" id="4897991">decoderState</span><span class="op" id="4898003">,</span>&nbsp;<span class="ident" id="4898005">value</span>&nbsp;<span class="ident" id="4898011">reflect</span><span class="op" id="4898018">.</span><span class="ident" id="4898019">Value</span><span class="op" id="4898024">)</span>&nbsp;<span class="op" id="4898026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898029">b</span>&nbsp;<span class="op" id="4898031">:=</span>&nbsp;<span class="builtinfunc" id="4898034">make</span><span class="op" id="4898038">(</span><span class="op" id="4898039">[</span><span class="op" id="4898040">]</span><span class="builtintype" id="4898041">byte</span><span class="op" id="4898045">,</span>&nbsp;<span class="ident" id="4898047">state</span><span class="op" id="4898052">.</span><span class="ident" id="4898053">decodeUint</span><span class="op" id="4898063">(</span><span class="op" id="4898064">)</span><span class="op" id="4898065">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898068">state</span><span class="op" id="4898073">.</span><span class="ident" id="4898074">b</span><span class="op" id="4898075">.</span><span class="ident" id="4898076">Read</span><span class="op" id="4898080">(</span><span class="ident" id="4898081">b</span><span class="op" id="4898082">)</span><br>
<span class="lineno"></span><span class="op" id="4898084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4898087">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4898108">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4898198">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="4898272">type</span>&nbsp;<span class="ident" id="4898277">decEngine</span>&nbsp;<span class="keyword" id="4898287">struct</span>&nbsp;<span class="op" id="4898294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898297">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4898306">[</span><span class="op" id="4898307">]</span><span class="ident" id="4898308">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898318">numInstr</span>&nbsp;<span class="builtintype" id="4898327">int</span>&nbsp;<span class="comment" id="4898331">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="4898368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4898371">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4898458">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4898537">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="4898594">func</span>&nbsp;<span class="op" id="4898599">(</span><span class="ident" id="4898600">dec</span>&nbsp;<span class="op" id="4898604">*</span><span class="ident" id="4898605">Decoder</span><span class="op" id="4898612">)</span>&nbsp;<span class="ident" id="4898614">decodeSingle</span><span class="op" id="4898626">(</span><span class="ident" id="4898627">engine</span>&nbsp;<span class="op" id="4898634">*</span><span class="ident" id="4898635">decEngine</span><span class="op" id="4898644">,</span>&nbsp;<span class="ident" id="4898646">ut</span>&nbsp;<span class="op" id="4898649">*</span><span class="ident" id="4898650">userTypeInfo</span><span class="op" id="4898662">,</span>&nbsp;<span class="ident" id="4898664">value</span>&nbsp;<span class="ident" id="4898670">reflect</span><span class="op" id="4898677">.</span><span class="ident" id="4898678">Value</span><span class="op" id="4898683">)</span>&nbsp;<span class="op" id="4898685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898688">state</span>&nbsp;<span class="op" id="4898694">:=</span>&nbsp;<span class="ident" id="4898697">dec</span><span class="op" id="4898700">.</span><span class="ident" id="4898701">newDecoderState</span><span class="op" id="4898716">(</span><span class="op" id="4898717">&amp;</span><span class="ident" id="4898718">dec</span><span class="op" id="4898721">.</span><span class="ident" id="4898722">buf</span><span class="op" id="4898725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4898728">defer</span>&nbsp;<span class="ident" id="4898734">dec</span><span class="op" id="4898737">.</span><span class="ident" id="4898738">freeDecoderState</span><span class="op" id="4898754">(</span><span class="ident" id="4898755">state</span><span class="op" id="4898760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898763">state</span><span class="op" id="4898768">.</span><span class="ident" id="4898769">fieldnum</span>&nbsp;<span class="op" id="4898778">=</span>&nbsp;<span class="ident" id="4898780">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4898796">if</span>&nbsp;<span class="ident" id="4898799">state</span><span class="op" id="4898804">.</span><span class="ident" id="4898805">decodeUint</span><span class="op" id="4898815">(</span><span class="op" id="4898816">)</span>&nbsp;<span class="op" id="4898818">!=</span>&nbsp;<span class="num" id="4898821">0</span>&nbsp;<span class="op" id="4898823">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898827">errorf</span><span class="op" id="4898833">(</span><span class="string" id="4898834">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4898888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4898891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898894">instr</span>&nbsp;<span class="op" id="4898900">:=</span>&nbsp;<span class="op" id="4898903">&amp;</span><span class="ident" id="4898904">engine</span><span class="op" id="4898910">.</span><span class="ident" id="4898911">instr</span><span class="op" id="4898916">[</span><span class="ident" id="4898917">singletonField</span><span class="op" id="4898931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898934">instr</span><span class="op" id="4898939">.</span><span class="ident" id="4898940">op</span><span class="op" id="4898942">(</span><span class="ident" id="4898943">instr</span><span class="op" id="4898948">,</span>&nbsp;<span class="ident" id="4898950">state</span><span class="op" id="4898955">,</span>&nbsp;<span class="ident" id="4898957">value</span><span class="op" id="4898962">)</span><br>
<span class="lineno"></span><span class="op" id="4898964">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="4898967">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4899034">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4899107">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="4899178">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="4899248">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4899309">func</span>&nbsp;<span class="op" id="4899314">(</span><span class="ident" id="4899315">dec</span>&nbsp;<span class="op" id="4899319">*</span><span class="ident" id="4899320">Decoder</span><span class="op" id="4899327">)</span>&nbsp;<span class="ident" id="4899329">decodeStruct</span><span class="op" id="4899341">(</span><span class="ident" id="4899342">engine</span>&nbsp;<span class="op" id="4899349">*</span><span class="ident" id="4899350">decEngine</span><span class="op" id="4899359">,</span>&nbsp;<span class="ident" id="4899361">ut</span>&nbsp;<span class="op" id="4899364">*</span><span class="ident" id="4899365">userTypeInfo</span><span class="op" id="4899377">,</span>&nbsp;<span class="ident" id="4899379">value</span>&nbsp;<span class="ident" id="4899385">reflect</span><span class="op" id="4899392">.</span><span class="ident" id="4899393">Value</span><span class="op" id="4899398">)</span>&nbsp;<span class="op" id="4899400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899403">state</span>&nbsp;<span class="op" id="4899409">:=</span>&nbsp;<span class="ident" id="4899412">dec</span><span class="op" id="4899415">.</span><span class="ident" id="4899416">newDecoderState</span><span class="op" id="4899431">(</span><span class="op" id="4899432">&amp;</span><span class="ident" id="4899433">dec</span><span class="op" id="4899436">.</span><span class="ident" id="4899437">buf</span><span class="op" id="4899440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899443">defer</span>&nbsp;<span class="ident" id="4899449">dec</span><span class="op" id="4899452">.</span><span class="ident" id="4899453">freeDecoderState</span><span class="op" id="4899469">(</span><span class="ident" id="4899470">state</span><span class="op" id="4899475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899478">state</span><span class="op" id="4899483">.</span><span class="ident" id="4899484">fieldnum</span>&nbsp;<span class="op" id="4899493">=</span>&nbsp;<span class="op" id="4899495">-</span><span class="num" id="4899496">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899499">for</span>&nbsp;<span class="ident" id="4899503">state</span><span class="op" id="4899508">.</span><span class="ident" id="4899509">b</span><span class="op" id="4899510">.</span><span class="ident" id="4899511">Len</span><span class="op" id="4899514">(</span><span class="op" id="4899515">)</span>&nbsp;<span class="op" id="4899517">&gt;</span>&nbsp;<span class="num" id="4899519">0</span>&nbsp;<span class="op" id="4899521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899525">delta</span>&nbsp;<span class="op" id="4899531">:=</span>&nbsp;<span class="builtintype" id="4899534">int</span><span class="op" id="4899537">(</span><span class="ident" id="4899538">state</span><span class="op" id="4899543">.</span><span class="ident" id="4899544">decodeUint</span><span class="op" id="4899554">(</span><span class="op" id="4899555">)</span><span class="op" id="4899556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899560">if</span>&nbsp;<span class="ident" id="4899563">delta</span>&nbsp;<span class="op" id="4899569">&lt;</span>&nbsp;<span class="num" id="4899571">0</span>&nbsp;<span class="op" id="4899573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899578">errorf</span><span class="op" id="4899584">(</span><span class="string" id="4899585">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4899625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4899629">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899633">if</span>&nbsp;<span class="ident" id="4899636">delta</span>&nbsp;<span class="op" id="4899642">==</span>&nbsp;<span class="num" id="4899645">0</span>&nbsp;<span class="op" id="4899647">{</span>&nbsp;<span class="comment" id="4899649">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899696">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4899704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899708">fieldnum</span>&nbsp;<span class="op" id="4899717">:=</span>&nbsp;<span class="ident" id="4899720">state</span><span class="op" id="4899725">.</span><span class="ident" id="4899726">fieldnum</span>&nbsp;<span class="op" id="4899735">+</span>&nbsp;<span class="ident" id="4899737">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899745">if</span>&nbsp;<span class="ident" id="4899748">fieldnum</span>&nbsp;<span class="op" id="4899757">&gt;=</span>&nbsp;<span class="builtinfunc" id="4899760">len</span><span class="op" id="4899763">(</span><span class="ident" id="4899764">engine</span><span class="op" id="4899770">.</span><span class="ident" id="4899771">instr</span><span class="op" id="4899776">)</span>&nbsp;<span class="op" id="4899778">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899783">error_</span><span class="op" id="4899789">(</span><span class="ident" id="4899790">errRange</span><span class="op" id="4899798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899803">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4899811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899815">instr</span>&nbsp;<span class="op" id="4899821">:=</span>&nbsp;<span class="op" id="4899824">&amp;</span><span class="ident" id="4899825">engine</span><span class="op" id="4899831">.</span><span class="ident" id="4899832">instr</span><span class="op" id="4899837">[</span><span class="ident" id="4899838">fieldnum</span><span class="op" id="4899846">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899850">var</span>&nbsp;<span class="ident" id="4899854">field</span>&nbsp;<span class="ident" id="4899860">reflect</span><span class="op" id="4899867">.</span><span class="ident" id="4899868">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4899876">if</span>&nbsp;<span class="ident" id="4899879">instr</span><span class="op" id="4899884">.</span><span class="ident" id="4899885">index</span>&nbsp;<span class="op" id="4899891">!=</span>&nbsp;<span class="ident" id="4899894">nil</span>&nbsp;<span class="op" id="4899898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4899903">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4899976">field</span>&nbsp;<span class="op" id="4899982">=</span>&nbsp;<span class="ident" id="4899984">value</span><span class="op" id="4899989">.</span><span class="ident" id="4899990">FieldByIndex</span><span class="op" id="4900002">(</span><span class="ident" id="4900003">instr</span><span class="op" id="4900008">.</span><span class="ident" id="4900009">index</span><span class="op" id="4900014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900019">if</span>&nbsp;<span class="ident" id="4900022">field</span><span class="op" id="4900027">.</span><span class="ident" id="4900028">Kind</span><span class="op" id="4900032">(</span><span class="op" id="4900033">)</span>&nbsp;<span class="op" id="4900035">==</span>&nbsp;<span class="ident" id="4900038">reflect</span><span class="op" id="4900045">.</span><span class="ident" id="4900046">Ptr</span>&nbsp;<span class="op" id="4900050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900056">field</span>&nbsp;<span class="op" id="4900062">=</span>&nbsp;<span class="ident" id="4900064">decAlloc</span><span class="op" id="4900072">(</span><span class="ident" id="4900073">field</span><span class="op" id="4900078">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900091">instr</span><span class="op" id="4900096">.</span><span class="ident" id="4900097">op</span><span class="op" id="4900099">(</span><span class="ident" id="4900100">instr</span><span class="op" id="4900105">,</span>&nbsp;<span class="ident" id="4900107">state</span><span class="op" id="4900112">,</span>&nbsp;<span class="ident" id="4900114">field</span><span class="op" id="4900119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900123">state</span><span class="op" id="4900128">.</span><span class="ident" id="4900129">fieldnum</span>&nbsp;<span class="op" id="4900138">=</span>&nbsp;<span class="ident" id="4900140">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900150">}</span><br>
<span class="lineno">470</span><span class="op" id="4900152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4900155">var</span>&nbsp;<span class="ident" id="4900159">noValue</span>&nbsp;<span class="ident" id="4900167">reflect</span><span class="op" id="4900174">.</span><span class="ident" id="4900175">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4900182">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="4900250">func</span>&nbsp;<span class="op" id="4900255">(</span><span class="ident" id="4900256">dec</span>&nbsp;<span class="op" id="4900260">*</span><span class="ident" id="4900261">Decoder</span><span class="op" id="4900268">)</span>&nbsp;<span class="ident" id="4900270">ignoreStruct</span><span class="op" id="4900282">(</span><span class="ident" id="4900283">engine</span>&nbsp;<span class="op" id="4900290">*</span><span class="ident" id="4900291">decEngine</span><span class="op" id="4900300">)</span>&nbsp;<span class="op" id="4900302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900305">state</span>&nbsp;<span class="op" id="4900311">:=</span>&nbsp;<span class="ident" id="4900314">dec</span><span class="op" id="4900317">.</span><span class="ident" id="4900318">newDecoderState</span><span class="op" id="4900333">(</span><span class="op" id="4900334">&amp;</span><span class="ident" id="4900335">dec</span><span class="op" id="4900338">.</span><span class="ident" id="4900339">buf</span><span class="op" id="4900342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900345">defer</span>&nbsp;<span class="ident" id="4900351">dec</span><span class="op" id="4900354">.</span><span class="ident" id="4900355">freeDecoderState</span><span class="op" id="4900371">(</span><span class="ident" id="4900372">state</span><span class="op" id="4900377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900380">state</span><span class="op" id="4900385">.</span><span class="ident" id="4900386">fieldnum</span>&nbsp;<span class="op" id="4900395">=</span>&nbsp;<span class="op" id="4900397">-</span><span class="num" id="4900398">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900401">for</span>&nbsp;<span class="ident" id="4900405">state</span><span class="op" id="4900410">.</span><span class="ident" id="4900411">b</span><span class="op" id="4900412">.</span><span class="ident" id="4900413">Len</span><span class="op" id="4900416">(</span><span class="op" id="4900417">)</span>&nbsp;<span class="op" id="4900419">&gt;</span>&nbsp;<span class="num" id="4900421">0</span>&nbsp;<span class="op" id="4900423">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900427">delta</span>&nbsp;<span class="op" id="4900433">:=</span>&nbsp;<span class="builtintype" id="4900436">int</span><span class="op" id="4900439">(</span><span class="ident" id="4900440">state</span><span class="op" id="4900445">.</span><span class="ident" id="4900446">decodeUint</span><span class="op" id="4900456">(</span><span class="op" id="4900457">)</span><span class="op" id="4900458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900462">if</span>&nbsp;<span class="ident" id="4900465">delta</span>&nbsp;<span class="op" id="4900471">&lt;</span>&nbsp;<span class="num" id="4900473">0</span>&nbsp;<span class="op" id="4900475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900480">errorf</span><span class="op" id="4900486">(</span><span class="string" id="4900487">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4900534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900542">if</span>&nbsp;<span class="ident" id="4900545">delta</span>&nbsp;<span class="op" id="4900551">==</span>&nbsp;<span class="num" id="4900554">0</span>&nbsp;<span class="op" id="4900556">{</span>&nbsp;<span class="comment" id="4900558">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900617">fieldnum</span>&nbsp;<span class="op" id="4900626">:=</span>&nbsp;<span class="ident" id="4900629">state</span><span class="op" id="4900634">.</span><span class="ident" id="4900635">fieldnum</span>&nbsp;<span class="op" id="4900644">+</span>&nbsp;<span class="ident" id="4900646">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4900654">if</span>&nbsp;<span class="ident" id="4900657">fieldnum</span>&nbsp;<span class="op" id="4900666">&gt;=</span>&nbsp;<span class="builtinfunc" id="4900669">len</span><span class="op" id="4900672">(</span><span class="ident" id="4900673">engine</span><span class="op" id="4900679">.</span><span class="ident" id="4900680">instr</span><span class="op" id="4900685">)</span>&nbsp;<span class="op" id="4900687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900692">error_</span><span class="op" id="4900698">(</span><span class="ident" id="4900699">errRange</span><span class="op" id="4900707">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900715">instr</span>&nbsp;<span class="op" id="4900721">:=</span>&nbsp;<span class="op" id="4900724">&amp;</span><span class="ident" id="4900725">engine</span><span class="op" id="4900731">.</span><span class="ident" id="4900732">instr</span><span class="op" id="4900737">[</span><span class="ident" id="4900738">fieldnum</span><span class="op" id="4900746">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900750">instr</span><span class="op" id="4900755">.</span><span class="ident" id="4900756">op</span><span class="op" id="4900758">(</span><span class="ident" id="4900759">instr</span><span class="op" id="4900764">,</span>&nbsp;<span class="ident" id="4900766">state</span><span class="op" id="4900771">,</span>&nbsp;<span class="ident" id="4900773">noValue</span><span class="op" id="4900780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4900784">state</span><span class="op" id="4900789">.</span><span class="ident" id="4900790">fieldnum</span>&nbsp;<span class="op" id="4900799">=</span>&nbsp;<span class="ident" id="4900801">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4900811">}</span><br>
<span class="lineno">495</span><span class="op" id="4900813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4900816">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4900891">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4900955">func</span>&nbsp;<span class="op" id="4900960">(</span><span class="ident" id="4900961">dec</span>&nbsp;<span class="op" id="4900965">*</span><span class="ident" id="4900966">Decoder</span><span class="op" id="4900973">)</span>&nbsp;<span class="ident" id="4900975">ignoreSingle</span><span class="op" id="4900987">(</span><span class="ident" id="4900988">engine</span>&nbsp;<span class="op" id="4900995">*</span><span class="ident" id="4900996">decEngine</span><span class="op" id="4901005">)</span>&nbsp;<span class="op" id="4901007">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901010">state</span>&nbsp;<span class="op" id="4901016">:=</span>&nbsp;<span class="ident" id="4901019">dec</span><span class="op" id="4901022">.</span><span class="ident" id="4901023">newDecoderState</span><span class="op" id="4901038">(</span><span class="op" id="4901039">&amp;</span><span class="ident" id="4901040">dec</span><span class="op" id="4901043">.</span><span class="ident" id="4901044">buf</span><span class="op" id="4901047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901050">defer</span>&nbsp;<span class="ident" id="4901056">dec</span><span class="op" id="4901059">.</span><span class="ident" id="4901060">freeDecoderState</span><span class="op" id="4901076">(</span><span class="ident" id="4901077">state</span><span class="op" id="4901082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901085">state</span><span class="op" id="4901090">.</span><span class="ident" id="4901091">fieldnum</span>&nbsp;<span class="op" id="4901100">=</span>&nbsp;<span class="ident" id="4901102">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901118">delta</span>&nbsp;<span class="op" id="4901124">:=</span>&nbsp;<span class="builtintype" id="4901127">int</span><span class="op" id="4901130">(</span><span class="ident" id="4901131">state</span><span class="op" id="4901136">.</span><span class="ident" id="4901137">decodeUint</span><span class="op" id="4901147">(</span><span class="op" id="4901148">)</span><span class="op" id="4901149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901152">if</span>&nbsp;<span class="ident" id="4901155">delta</span>&nbsp;<span class="op" id="4901161">!=</span>&nbsp;<span class="num" id="4901164">0</span>&nbsp;<span class="op" id="4901166">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901170">errorf</span><span class="op" id="4901176">(</span><span class="string" id="4901177">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4901231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901237">instr</span>&nbsp;<span class="op" id="4901243">:=</span>&nbsp;<span class="op" id="4901246">&amp;</span><span class="ident" id="4901247">engine</span><span class="op" id="4901253">.</span><span class="ident" id="4901254">instr</span><span class="op" id="4901259">[</span><span class="ident" id="4901260">singletonField</span><span class="op" id="4901274">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901277">instr</span><span class="op" id="4901282">.</span><span class="ident" id="4901283">op</span><span class="op" id="4901285">(</span><span class="ident" id="4901286">instr</span><span class="op" id="4901291">,</span>&nbsp;<span class="ident" id="4901293">state</span><span class="op" id="4901298">,</span>&nbsp;<span class="ident" id="4901300">noValue</span><span class="op" id="4901307">)</span><br>
<span class="lineno"></span><span class="op" id="4901309">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="4901312">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4901379">func</span>&nbsp;<span class="op" id="4901384">(</span><span class="ident" id="4901385">dec</span>&nbsp;<span class="op" id="4901389">*</span><span class="ident" id="4901390">Decoder</span><span class="op" id="4901397">)</span>&nbsp;<span class="ident" id="4901399">decodeArrayHelper</span><span class="op" id="4901416">(</span><span class="ident" id="4901417">state</span>&nbsp;<span class="op" id="4901423">*</span><span class="ident" id="4901424">decoderState</span><span class="op" id="4901436">,</span>&nbsp;<span class="ident" id="4901438">value</span>&nbsp;<span class="ident" id="4901444">reflect</span><span class="op" id="4901451">.</span><span class="ident" id="4901452">Value</span><span class="op" id="4901457">,</span>&nbsp;<span class="ident" id="4901459">elemOp</span>&nbsp;<span class="ident" id="4901466">decOp</span><span class="op" id="4901471">,</span>&nbsp;<span class="ident" id="4901473">length</span>&nbsp;<span class="builtintype" id="4901480">int</span><span class="op" id="4901483">,</span>&nbsp;<span class="ident" id="4901485">ovfl</span>&nbsp;<span class="builtintype" id="4901490">error</span><span class="op" id="4901495">,</span>&nbsp;<span class="ident" id="4901497">helper</span>&nbsp;<span class="ident" id="4901504">decHelper</span><span class="op" id="4901513">)</span>&nbsp;<span class="op" id="4901515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901518">if</span>&nbsp;<span class="ident" id="4901521">helper</span>&nbsp;<span class="op" id="4901528">!=</span>&nbsp;<span class="ident" id="4901531">nil</span>&nbsp;<span class="op" id="4901535">&amp;&amp;</span>&nbsp;<span class="ident" id="4901538">helper</span><span class="op" id="4901544">(</span><span class="ident" id="4901545">state</span><span class="op" id="4901550">,</span>&nbsp;<span class="ident" id="4901552">value</span><span class="op" id="4901557">,</span>&nbsp;<span class="ident" id="4901559">length</span><span class="op" id="4901565">,</span>&nbsp;<span class="ident" id="4901567">ovfl</span><span class="op" id="4901571">)</span>&nbsp;<span class="op" id="4901573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901577">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901588">instr</span>&nbsp;<span class="op" id="4901594">:=</span>&nbsp;<span class="op" id="4901597">&amp;</span><span class="ident" id="4901598">decInstr</span><span class="op" id="4901606">{</span><span class="ident" id="4901607">elemOp</span><span class="op" id="4901613">,</span>&nbsp;<span class="num" id="4901615">0</span><span class="op" id="4901616">,</span>&nbsp;<span class="ident" id="4901618">nil</span><span class="op" id="4901621">,</span>&nbsp;<span class="ident" id="4901623">ovfl</span><span class="op" id="4901627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901630">isPtr</span>&nbsp;<span class="op" id="4901636">:=</span>&nbsp;<span class="ident" id="4901639">value</span><span class="op" id="4901644">.</span><span class="ident" id="4901645">Type</span><span class="op" id="4901649">(</span><span class="op" id="4901650">)</span><span class="op" id="4901651">.</span><span class="ident" id="4901652">Elem</span><span class="op" id="4901656">(</span><span class="op" id="4901657">)</span><span class="op" id="4901658">.</span><span class="ident" id="4901659">Kind</span><span class="op" id="4901663">(</span><span class="op" id="4901664">)</span>&nbsp;<span class="op" id="4901666">==</span>&nbsp;<span class="ident" id="4901669">reflect</span><span class="op" id="4901676">.</span><span class="ident" id="4901677">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901682">for</span>&nbsp;<span class="ident" id="4901686">i</span>&nbsp;<span class="op" id="4901688">:=</span>&nbsp;<span class="num" id="4901691">0</span><span class="op" id="4901692">;</span>&nbsp;<span class="ident" id="4901694">i</span>&nbsp;<span class="op" id="4901696">&lt;</span>&nbsp;<span class="ident" id="4901698">length</span><span class="op" id="4901704">;</span>&nbsp;<span class="ident" id="4901706">i</span><span class="op" id="4901707">++</span>&nbsp;<span class="op" id="4901710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901714">if</span>&nbsp;<span class="ident" id="4901717">state</span><span class="op" id="4901722">.</span><span class="ident" id="4901723">b</span><span class="op" id="4901724">.</span><span class="ident" id="4901725">Len</span><span class="op" id="4901728">(</span><span class="op" id="4901729">)</span>&nbsp;<span class="op" id="4901731">==</span>&nbsp;<span class="num" id="4901734">0</span>&nbsp;<span class="op" id="4901736">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901741">errorf</span><span class="op" id="4901747">(</span><span class="string" id="4901748">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="4901814">,</span>&nbsp;<span class="ident" id="4901816">length</span><span class="op" id="4901822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901830">v</span>&nbsp;<span class="op" id="4901832">:=</span>&nbsp;<span class="ident" id="4901835">value</span><span class="op" id="4901840">.</span><span class="ident" id="4901841">Index</span><span class="op" id="4901846">(</span><span class="ident" id="4901847">i</span><span class="op" id="4901848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4901852">if</span>&nbsp;<span class="ident" id="4901855">isPtr</span>&nbsp;<span class="op" id="4901861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901866">v</span>&nbsp;<span class="op" id="4901868">=</span>&nbsp;<span class="ident" id="4901870">decAlloc</span><span class="op" id="4901878">(</span><span class="ident" id="4901879">v</span><span class="op" id="4901880">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901888">elemOp</span><span class="op" id="4901894">(</span><span class="ident" id="4901895">instr</span><span class="op" id="4901900">,</span>&nbsp;<span class="ident" id="4901902">state</span><span class="op" id="4901907">,</span>&nbsp;<span class="ident" id="4901909">v</span><span class="op" id="4901910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4901913">}</span><br>
<span class="lineno"></span><span class="op" id="4901915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4901918">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4901974">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="4902072">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4902153">func</span>&nbsp;<span class="op" id="4902158">(</span><span class="ident" id="4902159">dec</span>&nbsp;<span class="op" id="4902163">*</span><span class="ident" id="4902164">Decoder</span><span class="op" id="4902171">)</span>&nbsp;<span class="ident" id="4902173">decodeArray</span><span class="op" id="4902184">(</span><span class="ident" id="4902185">atyp</span>&nbsp;<span class="ident" id="4902190">reflect</span><span class="op" id="4902197">.</span><span class="ident" id="4902198">Type</span><span class="op" id="4902202">,</span>&nbsp;<span class="ident" id="4902204">state</span>&nbsp;<span class="op" id="4902210">*</span><span class="ident" id="4902211">decoderState</span><span class="op" id="4902223">,</span>&nbsp;<span class="ident" id="4902225">value</span>&nbsp;<span class="ident" id="4902231">reflect</span><span class="op" id="4902238">.</span><span class="ident" id="4902239">Value</span><span class="op" id="4902244">,</span>&nbsp;<span class="ident" id="4902246">elemOp</span>&nbsp;<span class="ident" id="4902253">decOp</span><span class="op" id="4902258">,</span>&nbsp;<span class="ident" id="4902260">length</span>&nbsp;<span class="builtintype" id="4902267">int</span><span class="op" id="4902270">,</span>&nbsp;<span class="ident" id="4902272">ovfl</span>&nbsp;<span class="builtintype" id="4902277">error</span><span class="op" id="4902282">,</span>&nbsp;<span class="ident" id="4902284">helper</span>&nbsp;<span class="ident" id="4902291">decHelper</span><span class="op" id="4902300">)</span>&nbsp;<span class="op" id="4902302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902305">if</span>&nbsp;<span class="ident" id="4902308">n</span>&nbsp;<span class="op" id="4902310">:=</span>&nbsp;<span class="ident" id="4902313">state</span><span class="op" id="4902318">.</span><span class="ident" id="4902319">decodeUint</span><span class="op" id="4902329">(</span><span class="op" id="4902330">)</span><span class="op" id="4902331">;</span>&nbsp;<span class="ident" id="4902333">n</span>&nbsp;<span class="op" id="4902335">!=</span>&nbsp;<span class="ident" id="4902338">uint64</span><span class="op" id="4902344">(</span><span class="ident" id="4902345">length</span><span class="op" id="4902351">)</span>&nbsp;<span class="op" id="4902353">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902357">errorf</span><span class="op" id="4902363">(</span><span class="string" id="4902364">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="4902396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902402">dec</span><span class="op" id="4902405">.</span><span class="ident" id="4902406">decodeArrayHelper</span><span class="op" id="4902423">(</span><span class="ident" id="4902424">state</span><span class="op" id="4902429">,</span>&nbsp;<span class="ident" id="4902431">value</span><span class="op" id="4902436">,</span>&nbsp;<span class="ident" id="4902438">elemOp</span><span class="op" id="4902444">,</span>&nbsp;<span class="ident" id="4902446">length</span><span class="op" id="4902452">,</span>&nbsp;<span class="ident" id="4902454">ovfl</span><span class="op" id="4902458">,</span>&nbsp;<span class="ident" id="4902460">helper</span><span class="op" id="4902466">)</span><br>
<span class="lineno"></span><span class="op" id="4902468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="4902471">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4902520">func</span>&nbsp;<span class="ident" id="4902525">decodeIntoValue</span><span class="op" id="4902540">(</span><span class="ident" id="4902541">state</span>&nbsp;<span class="op" id="4902547">*</span><span class="ident" id="4902548">decoderState</span><span class="op" id="4902560">,</span>&nbsp;<span class="ident" id="4902562">op</span>&nbsp;<span class="ident" id="4902565">decOp</span><span class="op" id="4902570">,</span>&nbsp;<span class="ident" id="4902572">isPtr</span>&nbsp;<span class="builtintype" id="4902578">bool</span><span class="op" id="4902582">,</span>&nbsp;<span class="ident" id="4902584">value</span>&nbsp;<span class="ident" id="4902590">reflect</span><span class="op" id="4902597">.</span><span class="ident" id="4902598">Value</span><span class="op" id="4902603">,</span>&nbsp;<span class="ident" id="4902605">ovfl</span>&nbsp;<span class="builtintype" id="4902610">error</span><span class="op" id="4902615">)</span>&nbsp;<span class="ident" id="4902617">reflect</span><span class="op" id="4902624">.</span><span class="ident" id="4902625">Value</span>&nbsp;<span class="op" id="4902631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902634">instr</span>&nbsp;<span class="op" id="4902640">:=</span>&nbsp;<span class="op" id="4902643">&amp;</span><span class="ident" id="4902644">decInstr</span><span class="op" id="4902652">{</span><span class="ident" id="4902653">op</span><span class="op" id="4902655">,</span>&nbsp;<span class="num" id="4902657">0</span><span class="op" id="4902658">,</span>&nbsp;<span class="ident" id="4902660">nil</span><span class="op" id="4902663">,</span>&nbsp;<span class="ident" id="4902665">ovfl</span><span class="op" id="4902669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902672">v</span>&nbsp;<span class="op" id="4902674">:=</span>&nbsp;<span class="ident" id="4902677">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902684">if</span>&nbsp;<span class="ident" id="4902687">isPtr</span>&nbsp;<span class="op" id="4902693">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902697">v</span>&nbsp;<span class="op" id="4902699">=</span>&nbsp;<span class="ident" id="4902701">decAlloc</span><span class="op" id="4902709">(</span><span class="ident" id="4902710">value</span><span class="op" id="4902715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4902718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4902721">op</span><span class="op" id="4902723">(</span><span class="ident" id="4902724">instr</span><span class="op" id="4902729">,</span>&nbsp;<span class="ident" id="4902731">state</span><span class="op" id="4902736">,</span>&nbsp;<span class="ident" id="4902738">v</span><span class="op" id="4902739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4902742">return</span>&nbsp;<span class="ident" id="4902749">value</span><br>
<span class="lineno"></span><span class="op" id="4902755">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4902758">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4902809">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="4902870">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4902934">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="4902979">func</span>&nbsp;<span class="op" id="4902984">(</span><span class="ident" id="4902985">dec</span>&nbsp;<span class="op" id="4902989">*</span><span class="ident" id="4902990">Decoder</span><span class="op" id="4902997">)</span>&nbsp;<span class="ident" id="4902999">decodeMap</span><span class="op" id="4903008">(</span><span class="ident" id="4903009">mtyp</span>&nbsp;<span class="ident" id="4903014">reflect</span><span class="op" id="4903021">.</span><span class="ident" id="4903022">Type</span><span class="op" id="4903026">,</span>&nbsp;<span class="ident" id="4903028">state</span>&nbsp;<span class="op" id="4903034">*</span><span class="ident" id="4903035">decoderState</span><span class="op" id="4903047">,</span>&nbsp;<span class="ident" id="4903049">value</span>&nbsp;<span class="ident" id="4903055">reflect</span><span class="op" id="4903062">.</span><span class="ident" id="4903063">Value</span><span class="op" id="4903068">,</span>&nbsp;<span class="ident" id="4903070">keyOp</span><span class="op" id="4903075">,</span>&nbsp;<span class="ident" id="4903077">elemOp</span>&nbsp;<span class="ident" id="4903084">decOp</span><span class="op" id="4903089">,</span>&nbsp;<span class="ident" id="4903091">ovfl</span>&nbsp;<span class="builtintype" id="4903096">error</span><span class="op" id="4903101">)</span>&nbsp;<span class="op" id="4903103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903106">if</span>&nbsp;<span class="ident" id="4903109">value</span><span class="op" id="4903114">.</span><span class="ident" id="4903115">IsNil</span><span class="op" id="4903120">(</span><span class="op" id="4903121">)</span>&nbsp;<span class="op" id="4903123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4903127">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903146">value</span><span class="op" id="4903151">.</span><span class="ident" id="4903152">Set</span><span class="op" id="4903155">(</span><span class="ident" id="4903156">reflect</span><span class="op" id="4903163">.</span><span class="ident" id="4903164">MakeMap</span><span class="op" id="4903171">(</span><span class="ident" id="4903172">mtyp</span><span class="op" id="4903176">)</span><span class="op" id="4903177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903180">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903183">n</span>&nbsp;<span class="op" id="4903185">:=</span>&nbsp;<span class="builtintype" id="4903188">int</span><span class="op" id="4903191">(</span><span class="ident" id="4903192">state</span><span class="op" id="4903197">.</span><span class="ident" id="4903198">decodeUint</span><span class="op" id="4903208">(</span><span class="op" id="4903209">)</span><span class="op" id="4903210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903213">keyIsPtr</span>&nbsp;<span class="op" id="4903222">:=</span>&nbsp;<span class="ident" id="4903225">mtyp</span><span class="op" id="4903229">.</span><span class="ident" id="4903230">Key</span><span class="op" id="4903233">(</span><span class="op" id="4903234">)</span><span class="op" id="4903235">.</span><span class="ident" id="4903236">Kind</span><span class="op" id="4903240">(</span><span class="op" id="4903241">)</span>&nbsp;<span class="op" id="4903243">==</span>&nbsp;<span class="ident" id="4903246">reflect</span><span class="op" id="4903253">.</span><span class="ident" id="4903254">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903259">elemIsPtr</span>&nbsp;<span class="op" id="4903269">:=</span>&nbsp;<span class="ident" id="4903272">mtyp</span><span class="op" id="4903276">.</span><span class="ident" id="4903277">Elem</span><span class="op" id="4903281">(</span><span class="op" id="4903282">)</span><span class="op" id="4903283">.</span><span class="ident" id="4903284">Kind</span><span class="op" id="4903288">(</span><span class="op" id="4903289">)</span>&nbsp;<span class="op" id="4903291">==</span>&nbsp;<span class="ident" id="4903294">reflect</span><span class="op" id="4903301">.</span><span class="ident" id="4903302">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903307">for</span>&nbsp;<span class="ident" id="4903311">i</span>&nbsp;<span class="op" id="4903313">:=</span>&nbsp;<span class="num" id="4903316">0</span><span class="op" id="4903317">;</span>&nbsp;<span class="ident" id="4903319">i</span>&nbsp;<span class="op" id="4903321">&lt;</span>&nbsp;<span class="ident" id="4903323">n</span><span class="op" id="4903324">;</span>&nbsp;<span class="ident" id="4903326">i</span><span class="op" id="4903327">++</span>&nbsp;<span class="op" id="4903330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903334">key</span>&nbsp;<span class="op" id="4903338">:=</span>&nbsp;<span class="ident" id="4903341">decodeIntoValue</span><span class="op" id="4903356">(</span><span class="ident" id="4903357">state</span><span class="op" id="4903362">,</span>&nbsp;<span class="ident" id="4903364">keyOp</span><span class="op" id="4903369">,</span>&nbsp;<span class="ident" id="4903371">keyIsPtr</span><span class="op" id="4903379">,</span>&nbsp;<span class="ident" id="4903381">allocValue</span><span class="op" id="4903391">(</span><span class="ident" id="4903392">mtyp</span><span class="op" id="4903396">.</span><span class="ident" id="4903397">Key</span><span class="op" id="4903400">(</span><span class="op" id="4903401">)</span><span class="op" id="4903402">)</span><span class="op" id="4903403">,</span>&nbsp;<span class="ident" id="4903405">ovfl</span><span class="op" id="4903409">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903413">elem</span>&nbsp;<span class="op" id="4903418">:=</span>&nbsp;<span class="ident" id="4903421">decodeIntoValue</span><span class="op" id="4903436">(</span><span class="ident" id="4903437">state</span><span class="op" id="4903442">,</span>&nbsp;<span class="ident" id="4903444">elemOp</span><span class="op" id="4903450">,</span>&nbsp;<span class="ident" id="4903452">elemIsPtr</span><span class="op" id="4903461">,</span>&nbsp;<span class="ident" id="4903463">allocValue</span><span class="op" id="4903473">(</span><span class="ident" id="4903474">mtyp</span><span class="op" id="4903478">.</span><span class="ident" id="4903479">Elem</span><span class="op" id="4903483">(</span><span class="op" id="4903484">)</span><span class="op" id="4903485">)</span><span class="op" id="4903486">,</span>&nbsp;<span class="ident" id="4903488">ovfl</span><span class="op" id="4903492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903496">value</span><span class="op" id="4903501">.</span><span class="ident" id="4903502">SetMapIndex</span><span class="op" id="4903513">(</span><span class="ident" id="4903514">key</span><span class="op" id="4903517">,</span>&nbsp;<span class="ident" id="4903519">elem</span><span class="op" id="4903523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903526">}</span><br>
<span class="lineno"></span><span class="op" id="4903528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="4903531">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4903600">func</span>&nbsp;<span class="op" id="4903605">(</span><span class="ident" id="4903606">dec</span>&nbsp;<span class="op" id="4903610">*</span><span class="ident" id="4903611">Decoder</span><span class="op" id="4903618">)</span>&nbsp;<span class="ident" id="4903620">ignoreArrayHelper</span><span class="op" id="4903637">(</span><span class="ident" id="4903638">state</span>&nbsp;<span class="op" id="4903644">*</span><span class="ident" id="4903645">decoderState</span><span class="op" id="4903657">,</span>&nbsp;<span class="ident" id="4903659">elemOp</span>&nbsp;<span class="ident" id="4903666">decOp</span><span class="op" id="4903671">,</span>&nbsp;<span class="ident" id="4903673">length</span>&nbsp;<span class="builtintype" id="4903680">int</span><span class="op" id="4903683">)</span>&nbsp;<span class="op" id="4903685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903688">instr</span>&nbsp;<span class="op" id="4903694">:=</span>&nbsp;<span class="op" id="4903697">&amp;</span><span class="ident" id="4903698">decInstr</span><span class="op" id="4903706">{</span><span class="ident" id="4903707">elemOp</span><span class="op" id="4903713">,</span>&nbsp;<span class="num" id="4903715">0</span><span class="op" id="4903716">,</span>&nbsp;<span class="ident" id="4903718">nil</span><span class="op" id="4903721">,</span>&nbsp;<span class="ident" id="4903723">errors</span><span class="op" id="4903729">.</span><span class="ident" id="4903730">New</span><span class="op" id="4903733">(</span><span class="string" id="4903734">&#34;no&nbsp;error&#34;</span><span class="op" id="4903744">)</span><span class="op" id="4903745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903748">for</span>&nbsp;<span class="ident" id="4903752">i</span>&nbsp;<span class="op" id="4903754">:=</span>&nbsp;<span class="num" id="4903757">0</span><span class="op" id="4903758">;</span>&nbsp;<span class="ident" id="4903760">i</span>&nbsp;<span class="op" id="4903762">&lt;</span>&nbsp;<span class="ident" id="4903764">length</span><span class="op" id="4903770">;</span>&nbsp;<span class="ident" id="4903772">i</span><span class="op" id="4903773">++</span>&nbsp;<span class="op" id="4903776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4903780">elemOp</span><span class="op" id="4903786">(</span><span class="ident" id="4903787">instr</span><span class="op" id="4903792">,</span>&nbsp;<span class="ident" id="4903794">state</span><span class="op" id="4903799">,</span>&nbsp;<span class="ident" id="4903801">noValue</span><span class="op" id="4903808">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4903811">}</span><br>
<span class="lineno"></span><span class="op" id="4903813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4903816">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4903889">func</span>&nbsp;<span class="op" id="4903894">(</span><span class="ident" id="4903895">dec</span>&nbsp;<span class="op" id="4903899">*</span><span class="ident" id="4903900">Decoder</span><span class="op" id="4903907">)</span>&nbsp;<span class="ident" id="4903909">ignoreArray</span><span class="op" id="4903920">(</span><span class="ident" id="4903921">state</span>&nbsp;<span class="op" id="4903927">*</span><span class="ident" id="4903928">decoderState</span><span class="op" id="4903940">,</span>&nbsp;<span class="ident" id="4903942">elemOp</span>&nbsp;<span class="ident" id="4903949">decOp</span><span class="op" id="4903954">,</span>&nbsp;<span class="ident" id="4903956">length</span>&nbsp;<span class="builtintype" id="4903963">int</span><span class="op" id="4903966">)</span>&nbsp;<span class="op" id="4903968">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4903971">if</span>&nbsp;<span class="ident" id="4903974">n</span>&nbsp;<span class="op" id="4903976">:=</span>&nbsp;<span class="ident" id="4903979">state</span><span class="op" id="4903984">.</span><span class="ident" id="4903985">decodeUint</span><span class="op" id="4903995">(</span><span class="op" id="4903996">)</span><span class="op" id="4903997">;</span>&nbsp;<span class="ident" id="4903999">n</span>&nbsp;<span class="op" id="4904001">!=</span>&nbsp;<span class="ident" id="4904004">uint64</span><span class="op" id="4904010">(</span><span class="ident" id="4904011">length</span><span class="op" id="4904017">)</span>&nbsp;<span class="op" id="4904019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904023">errorf</span><span class="op" id="4904029">(</span><span class="string" id="4904030">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="4904062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904068">dec</span><span class="op" id="4904071">.</span><span class="ident" id="4904072">ignoreArrayHelper</span><span class="op" id="4904089">(</span><span class="ident" id="4904090">state</span><span class="op" id="4904095">,</span>&nbsp;<span class="ident" id="4904097">elemOp</span><span class="op" id="4904103">,</span>&nbsp;<span class="ident" id="4904105">length</span><span class="op" id="4904111">)</span><br>
<span class="lineno"></span><span class="op" id="4904113">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="4904116">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4904184">func</span>&nbsp;<span class="op" id="4904189">(</span><span class="ident" id="4904190">dec</span>&nbsp;<span class="op" id="4904194">*</span><span class="ident" id="4904195">Decoder</span><span class="op" id="4904202">)</span>&nbsp;<span class="ident" id="4904204">ignoreMap</span><span class="op" id="4904213">(</span><span class="ident" id="4904214">state</span>&nbsp;<span class="op" id="4904220">*</span><span class="ident" id="4904221">decoderState</span><span class="op" id="4904233">,</span>&nbsp;<span class="ident" id="4904235">keyOp</span><span class="op" id="4904240">,</span>&nbsp;<span class="ident" id="4904242">elemOp</span>&nbsp;<span class="ident" id="4904249">decOp</span><span class="op" id="4904254">)</span>&nbsp;<span class="op" id="4904256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904259">n</span>&nbsp;<span class="op" id="4904261">:=</span>&nbsp;<span class="builtintype" id="4904264">int</span><span class="op" id="4904267">(</span><span class="ident" id="4904268">state</span><span class="op" id="4904273">.</span><span class="ident" id="4904274">decodeUint</span><span class="op" id="4904284">(</span><span class="op" id="4904285">)</span><span class="op" id="4904286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904289">keyInstr</span>&nbsp;<span class="op" id="4904298">:=</span>&nbsp;<span class="op" id="4904301">&amp;</span><span class="ident" id="4904302">decInstr</span><span class="op" id="4904310">{</span><span class="ident" id="4904311">keyOp</span><span class="op" id="4904316">,</span>&nbsp;<span class="num" id="4904318">0</span><span class="op" id="4904319">,</span>&nbsp;<span class="ident" id="4904321">nil</span><span class="op" id="4904324">,</span>&nbsp;<span class="ident" id="4904326">errors</span><span class="op" id="4904332">.</span><span class="ident" id="4904333">New</span><span class="op" id="4904336">(</span><span class="string" id="4904337">&#34;no&nbsp;error&#34;</span><span class="op" id="4904347">)</span><span class="op" id="4904348">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904351">elemInstr</span>&nbsp;<span class="op" id="4904361">:=</span>&nbsp;<span class="op" id="4904364">&amp;</span><span class="ident" id="4904365">decInstr</span><span class="op" id="4904373">{</span><span class="ident" id="4904374">elemOp</span><span class="op" id="4904380">,</span>&nbsp;<span class="num" id="4904382">0</span><span class="op" id="4904383">,</span>&nbsp;<span class="ident" id="4904385">nil</span><span class="op" id="4904388">,</span>&nbsp;<span class="ident" id="4904390">errors</span><span class="op" id="4904396">.</span><span class="ident" id="4904397">New</span><span class="op" id="4904400">(</span><span class="string" id="4904401">&#34;no&nbsp;error&#34;</span><span class="op" id="4904411">)</span><span class="op" id="4904412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904415">for</span>&nbsp;<span class="ident" id="4904419">i</span>&nbsp;<span class="op" id="4904421">:=</span>&nbsp;<span class="num" id="4904424">0</span><span class="op" id="4904425">;</span>&nbsp;<span class="ident" id="4904427">i</span>&nbsp;<span class="op" id="4904429">&lt;</span>&nbsp;<span class="ident" id="4904431">n</span><span class="op" id="4904432">;</span>&nbsp;<span class="ident" id="4904434">i</span><span class="op" id="4904435">++</span>&nbsp;<span class="op" id="4904438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904442">keyOp</span><span class="op" id="4904447">(</span><span class="ident" id="4904448">keyInstr</span><span class="op" id="4904456">,</span>&nbsp;<span class="ident" id="4904458">state</span><span class="op" id="4904463">,</span>&nbsp;<span class="ident" id="4904465">noValue</span><span class="op" id="4904472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904476">elemOp</span><span class="op" id="4904482">(</span><span class="ident" id="4904483">elemInstr</span><span class="op" id="4904492">,</span>&nbsp;<span class="ident" id="4904494">state</span><span class="op" id="4904499">,</span>&nbsp;<span class="ident" id="4904501">noValue</span><span class="op" id="4904508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904511">}</span><br>
<span class="lineno">595</span><span class="op" id="4904513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4904516">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4904571">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="4904641">func</span>&nbsp;<span class="op" id="4904646">(</span><span class="ident" id="4904647">dec</span>&nbsp;<span class="op" id="4904651">*</span><span class="ident" id="4904652">Decoder</span><span class="op" id="4904659">)</span>&nbsp;<span class="ident" id="4904661">decodeSlice</span><span class="op" id="4904672">(</span><span class="ident" id="4904673">state</span>&nbsp;<span class="op" id="4904679">*</span><span class="ident" id="4904680">decoderState</span><span class="op" id="4904692">,</span>&nbsp;<span class="ident" id="4904694">value</span>&nbsp;<span class="ident" id="4904700">reflect</span><span class="op" id="4904707">.</span><span class="ident" id="4904708">Value</span><span class="op" id="4904713">,</span>&nbsp;<span class="ident" id="4904715">elemOp</span>&nbsp;<span class="ident" id="4904722">decOp</span><span class="op" id="4904727">,</span>&nbsp;<span class="ident" id="4904729">ovfl</span>&nbsp;<span class="builtintype" id="4904734">error</span><span class="op" id="4904739">,</span>&nbsp;<span class="ident" id="4904741">helper</span>&nbsp;<span class="ident" id="4904748">decHelper</span><span class="op" id="4904757">)</span>&nbsp;<span class="op" id="4904759">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904762">u</span>&nbsp;<span class="op" id="4904764">:=</span>&nbsp;<span class="ident" id="4904767">state</span><span class="op" id="4904772">.</span><span class="ident" id="4904773">decodeUint</span><span class="op" id="4904783">(</span><span class="op" id="4904784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904787">typ</span>&nbsp;<span class="op" id="4904791">:=</span>&nbsp;<span class="ident" id="4904794">value</span><span class="op" id="4904799">.</span><span class="ident" id="4904800">Type</span><span class="op" id="4904804">(</span><span class="op" id="4904805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904808">size</span>&nbsp;<span class="op" id="4904813">:=</span>&nbsp;<span class="ident" id="4904816">uint64</span><span class="op" id="4904822">(</span><span class="ident" id="4904823">typ</span><span class="op" id="4904826">.</span><span class="ident" id="4904827">Elem</span><span class="op" id="4904831">(</span><span class="op" id="4904832">)</span><span class="op" id="4904833">.</span><span class="ident" id="4904834">Size</span><span class="op" id="4904838">(</span><span class="op" id="4904839">)</span><span class="op" id="4904840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904843">nBytes</span>&nbsp;<span class="op" id="4904850">:=</span>&nbsp;<span class="ident" id="4904853">u</span>&nbsp;<span class="op" id="4904855">*</span>&nbsp;<span class="ident" id="4904857">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904863">n</span>&nbsp;<span class="op" id="4904865">:=</span>&nbsp;<span class="builtintype" id="4904868">int</span><span class="op" id="4904871">(</span><span class="ident" id="4904872">u</span><span class="op" id="4904873">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4904876">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904925">if</span>&nbsp;<span class="ident" id="4904928">n</span>&nbsp;<span class="op" id="4904930">&lt;</span>&nbsp;<span class="num" id="4904932">0</span>&nbsp;<span class="op" id="4904934">||</span>&nbsp;<span class="ident" id="4904937">uint64</span><span class="op" id="4904943">(</span><span class="ident" id="4904944">n</span><span class="op" id="4904945">)</span>&nbsp;<span class="op" id="4904947">!=</span>&nbsp;<span class="ident" id="4904950">u</span>&nbsp;<span class="op" id="4904952">||</span>&nbsp;<span class="ident" id="4904955">nBytes</span>&nbsp;<span class="op" id="4904962">&gt;</span>&nbsp;<span class="ident" id="4904964">tooBig</span>&nbsp;<span class="op" id="4904971">||</span>&nbsp;<span class="op" id="4904974">(</span><span class="ident" id="4904975">size</span>&nbsp;<span class="op" id="4904980">&gt;</span>&nbsp;<span class="num" id="4904982">0</span>&nbsp;<span class="op" id="4904984">&amp;&amp;</span>&nbsp;<span class="ident" id="4904987">nBytes</span><span class="op" id="4904993">/</span><span class="ident" id="4904994">size</span>&nbsp;<span class="op" id="4904999">!=</span>&nbsp;<span class="ident" id="4905002">u</span><span class="op" id="4905003">)</span>&nbsp;<span class="op" id="4905005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905009">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905082">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905132">errorf</span><span class="op" id="4905138">(</span><span class="string" id="4905139">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="4905182">,</span>&nbsp;<span class="ident" id="4905184">typ</span><span class="op" id="4905187">.</span><span class="ident" id="4905188">Elem</span><span class="op" id="4905192">(</span><span class="op" id="4905193">)</span><span class="op" id="4905194">,</span>&nbsp;<span class="ident" id="4905196">u</span><span class="op" id="4905197">,</span>&nbsp;<span class="ident" id="4905199">size</span><span class="op" id="4905203">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4905206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4905209">if</span>&nbsp;<span class="ident" id="4905212">value</span><span class="op" id="4905217">.</span><span class="ident" id="4905218">Cap</span><span class="op" id="4905221">(</span><span class="op" id="4905222">)</span>&nbsp;<span class="op" id="4905224">&lt;</span>&nbsp;<span class="ident" id="4905226">n</span>&nbsp;<span class="op" id="4905228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905232">value</span><span class="op" id="4905237">.</span><span class="ident" id="4905238">Set</span><span class="op" id="4905241">(</span><span class="ident" id="4905242">reflect</span><span class="op" id="4905249">.</span><span class="ident" id="4905250">MakeSlice</span><span class="op" id="4905259">(</span><span class="ident" id="4905260">typ</span><span class="op" id="4905263">,</span>&nbsp;<span class="ident" id="4905265">n</span><span class="op" id="4905266">,</span>&nbsp;<span class="ident" id="4905268">n</span><span class="op" id="4905269">)</span><span class="op" id="4905270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4905273">}</span>&nbsp;<span class="keyword" id="4905275">else</span>&nbsp;<span class="op" id="4905280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905284">value</span><span class="op" id="4905289">.</span><span class="ident" id="4905290">Set</span><span class="op" id="4905293">(</span><span class="ident" id="4905294">value</span><span class="op" id="4905299">.</span><span class="ident" id="4905300">Slice</span><span class="op" id="4905305">(</span><span class="num" id="4905306">0</span><span class="op" id="4905307">,</span>&nbsp;<span class="ident" id="4905309">n</span><span class="op" id="4905310">)</span><span class="op" id="4905311">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4905314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905317">dec</span><span class="op" id="4905320">.</span><span class="ident" id="4905321">decodeArrayHelper</span><span class="op" id="4905338">(</span><span class="ident" id="4905339">state</span><span class="op" id="4905344">,</span>&nbsp;<span class="ident" id="4905346">value</span><span class="op" id="4905351">,</span>&nbsp;<span class="ident" id="4905353">elemOp</span><span class="op" id="4905359">,</span>&nbsp;<span class="ident" id="4905361">n</span><span class="op" id="4905362">,</span>&nbsp;<span class="ident" id="4905364">ovfl</span><span class="op" id="4905368">,</span>&nbsp;<span class="ident" id="4905370">helper</span><span class="op" id="4905376">)</span><br>
<span class="lineno"></span><span class="op" id="4905378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4905381">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="4905455">func</span>&nbsp;<span class="op" id="4905460">(</span><span class="ident" id="4905461">dec</span>&nbsp;<span class="op" id="4905465">*</span><span class="ident" id="4905466">Decoder</span><span class="op" id="4905473">)</span>&nbsp;<span class="ident" id="4905475">ignoreSlice</span><span class="op" id="4905486">(</span><span class="ident" id="4905487">state</span>&nbsp;<span class="op" id="4905493">*</span><span class="ident" id="4905494">decoderState</span><span class="op" id="4905506">,</span>&nbsp;<span class="ident" id="4905508">elemOp</span>&nbsp;<span class="ident" id="4905515">decOp</span><span class="op" id="4905520">)</span>&nbsp;<span class="op" id="4905522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905525">dec</span><span class="op" id="4905528">.</span><span class="ident" id="4905529">ignoreArrayHelper</span><span class="op" id="4905546">(</span><span class="ident" id="4905547">state</span><span class="op" id="4905552">,</span>&nbsp;<span class="ident" id="4905554">elemOp</span><span class="op" id="4905560">,</span>&nbsp;<span class="builtintype" id="4905562">int</span><span class="op" id="4905565">(</span><span class="ident" id="4905566">state</span><span class="op" id="4905571">.</span><span class="ident" id="4905572">decodeUint</span><span class="op" id="4905582">(</span><span class="op" id="4905583">)</span><span class="op" id="4905584">)</span><span class="op" id="4905585">)</span><br>
<span class="lineno"></span><span class="op" id="4905587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4905590">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="4905660">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4905738">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4905802">func</span>&nbsp;<span class="op" id="4905807">(</span><span class="ident" id="4905808">dec</span>&nbsp;<span class="op" id="4905812">*</span><span class="ident" id="4905813">Decoder</span><span class="op" id="4905820">)</span>&nbsp;<span class="ident" id="4905822">decodeInterface</span><span class="op" id="4905837">(</span><span class="ident" id="4905838">ityp</span>&nbsp;<span class="ident" id="4905843">reflect</span><span class="op" id="4905850">.</span><span class="ident" id="4905851">Type</span><span class="op" id="4905855">,</span>&nbsp;<span class="ident" id="4905857">state</span>&nbsp;<span class="op" id="4905863">*</span><span class="ident" id="4905864">decoderState</span><span class="op" id="4905876">,</span>&nbsp;<span class="ident" id="4905878">value</span>&nbsp;<span class="ident" id="4905884">reflect</span><span class="op" id="4905891">.</span><span class="ident" id="4905892">Value</span><span class="op" id="4905897">)</span>&nbsp;<span class="op" id="4905899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4905902">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905942">nr</span>&nbsp;<span class="op" id="4905945">:=</span>&nbsp;<span class="ident" id="4905948">state</span><span class="op" id="4905953">.</span><span class="ident" id="4905954">decodeUint</span><span class="op" id="4905964">(</span><span class="op" id="4905965">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4905968">if</span>&nbsp;<span class="ident" id="4905971">nr</span>&nbsp;<span class="op" id="4905974">&lt;</span>&nbsp;<span class="num" id="4905976">0</span>&nbsp;<span class="op" id="4905978">||</span>&nbsp;<span class="ident" id="4905981">nr</span>&nbsp;<span class="op" id="4905984">&gt;</span>&nbsp;<span class="num" id="4905986">1</span><span class="op" id="4905987">&lt;&lt;</span><span class="num" id="4905989">31</span>&nbsp;<span class="op" id="4905992">{</span>&nbsp;<span class="comment" id="4905994">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906039">errorf</span><span class="op" id="4906045">(</span><span class="string" id="4906046">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="4906075">,</span>&nbsp;<span class="ident" id="4906077">nr</span><span class="op" id="4906079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906085">if</span>&nbsp;<span class="ident" id="4906088">nr</span>&nbsp;<span class="op" id="4906091">&gt;</span>&nbsp;<span class="ident" id="4906093">uint64</span><span class="op" id="4906099">(</span><span class="ident" id="4906100">state</span><span class="op" id="4906105">.</span><span class="ident" id="4906106">b</span><span class="op" id="4906107">.</span><span class="ident" id="4906108">Len</span><span class="op" id="4906111">(</span><span class="op" id="4906112">)</span><span class="op" id="4906113">)</span>&nbsp;<span class="op" id="4906115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906119">errorf</span><span class="op" id="4906125">(</span><span class="string" id="4906126">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="4906175">,</span>&nbsp;<span class="ident" id="4906177">nr</span><span class="op" id="4906179">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906185">b</span>&nbsp;<span class="op" id="4906187">:=</span>&nbsp;<span class="builtinfunc" id="4906190">make</span><span class="op" id="4906194">(</span><span class="op" id="4906195">[</span><span class="op" id="4906196">]</span><span class="builtintype" id="4906197">byte</span><span class="op" id="4906201">,</span>&nbsp;<span class="ident" id="4906203">nr</span><span class="op" id="4906205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906208">state</span><span class="op" id="4906213">.</span><span class="ident" id="4906214">b</span><span class="op" id="4906215">.</span><span class="ident" id="4906216">Read</span><span class="op" id="4906220">(</span><span class="ident" id="4906221">b</span><span class="op" id="4906222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906225">name</span>&nbsp;<span class="op" id="4906230">:=</span>&nbsp;<span class="builtintype" id="4906233">string</span><span class="op" id="4906239">(</span><span class="ident" id="4906240">b</span><span class="op" id="4906241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906244">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906290">if</span>&nbsp;<span class="ident" id="4906293">name</span>&nbsp;<span class="op" id="4906298">==</span>&nbsp;<span class="string" id="4906301">&#34;&#34;</span>&nbsp;<span class="op" id="4906304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906308">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906357">value</span><span class="op" id="4906362">.</span><span class="ident" id="4906363">Set</span><span class="op" id="4906366">(</span><span class="ident" id="4906367">reflect</span><span class="op" id="4906374">.</span><span class="ident" id="4906375">Zero</span><span class="op" id="4906379">(</span><span class="ident" id="4906380">value</span><span class="op" id="4906385">.</span><span class="ident" id="4906386">Type</span><span class="op" id="4906390">(</span><span class="op" id="4906391">)</span><span class="op" id="4906392">)</span><span class="op" id="4906393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906397">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906405">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906408">if</span>&nbsp;<span class="builtinfunc" id="4906411">len</span><span class="op" id="4906414">(</span><span class="ident" id="4906415">name</span><span class="op" id="4906419">)</span>&nbsp;<span class="op" id="4906421">&gt;</span>&nbsp;<span class="num" id="4906423">1024</span>&nbsp;<span class="op" id="4906428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906432">errorf</span><span class="op" id="4906438">(</span><span class="string" id="4906439">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="4906475">,</span>&nbsp;<span class="builtinfunc" id="4906477">len</span><span class="op" id="4906480">(</span><span class="ident" id="4906481">name</span><span class="op" id="4906485">)</span><span class="op" id="4906486">,</span>&nbsp;<span class="ident" id="4906488">name</span><span class="op" id="4906492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906498">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906540">registerLock</span><span class="op" id="4906552">.</span><span class="ident" id="4906553">RLock</span><span class="op" id="4906558">(</span><span class="op" id="4906559">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906562">typ</span><span class="op" id="4906565">,</span>&nbsp;<span class="ident" id="4906567">ok</span>&nbsp;<span class="op" id="4906570">:=</span>&nbsp;<span class="ident" id="4906573">nameToConcreteType</span><span class="op" id="4906591">[</span><span class="ident" id="4906592">name</span><span class="op" id="4906596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906599">registerLock</span><span class="op" id="4906611">.</span><span class="ident" id="4906612">RUnlock</span><span class="op" id="4906619">(</span><span class="op" id="4906620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906623">if</span>&nbsp;<span class="op" id="4906626">!</span><span class="ident" id="4906627">ok</span>&nbsp;<span class="op" id="4906630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906634">errorf</span><span class="op" id="4906640">(</span><span class="string" id="4906641">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="4906680">,</span>&nbsp;<span class="ident" id="4906682">name</span><span class="op" id="4906686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906689">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906692">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906736">concreteId</span>&nbsp;<span class="op" id="4906747">:=</span>&nbsp;<span class="ident" id="4906750">dec</span><span class="op" id="4906753">.</span><span class="ident" id="4906754">decodeTypeSequence</span><span class="op" id="4906772">(</span><span class="builtintype" id="4906773">true</span><span class="op" id="4906777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906780">if</span>&nbsp;<span class="ident" id="4906783">concreteId</span>&nbsp;<span class="op" id="4906794">&lt;</span>&nbsp;<span class="num" id="4906796">0</span>&nbsp;<span class="op" id="4906798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906802">error_</span><span class="op" id="4906808">(</span><span class="ident" id="4906809">dec</span><span class="op" id="4906812">.</span><span class="ident" id="4906813">err</span><span class="op" id="4906816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4906819">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906822">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906892">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906960">state</span><span class="op" id="4906965">.</span><span class="ident" id="4906966">decodeUint</span><span class="op" id="4906976">(</span><span class="op" id="4906977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906980">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907009">v</span>&nbsp;<span class="op" id="4907011">:=</span>&nbsp;<span class="ident" id="4907014">allocValue</span><span class="op" id="4907024">(</span><span class="ident" id="4907025">typ</span><span class="op" id="4907028">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907031">dec</span><span class="op" id="4907034">.</span><span class="ident" id="4907035">decodeValue</span><span class="op" id="4907046">(</span><span class="ident" id="4907047">concreteId</span><span class="op" id="4907057">,</span>&nbsp;<span class="ident" id="4907059">v</span><span class="op" id="4907060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907063">if</span>&nbsp;<span class="ident" id="4907066">dec</span><span class="op" id="4907069">.</span><span class="ident" id="4907070">err</span>&nbsp;<span class="op" id="4907074">!=</span>&nbsp;<span class="ident" id="4907077">nil</span>&nbsp;<span class="op" id="4907081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907085">error_</span><span class="op" id="4907091">(</span><span class="ident" id="4907092">dec</span><span class="op" id="4907095">.</span><span class="ident" id="4907096">err</span><span class="op" id="4907099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907105">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907153">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907210">if</span>&nbsp;<span class="op" id="4907213">!</span><span class="ident" id="4907214">typ</span><span class="op" id="4907217">.</span><span class="ident" id="4907218">AssignableTo</span><span class="op" id="4907230">(</span><span class="ident" id="4907231">ityp</span><span class="op" id="4907235">)</span>&nbsp;<span class="op" id="4907237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907241">errorf</span><span class="op" id="4907247">(</span><span class="string" id="4907248">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4907281">,</span>&nbsp;<span class="ident" id="4907283">typ</span><span class="op" id="4907286">,</span>&nbsp;<span class="ident" id="4907288">ityp</span><span class="op" id="4907292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907298">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907342">value</span><span class="op" id="4907347">.</span><span class="ident" id="4907348">Set</span><span class="op" id="4907351">(</span><span class="ident" id="4907352">v</span><span class="op" id="4907353">)</span><br>
<span class="lineno"></span><span class="op" id="4907355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4907358">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4907439">func</span>&nbsp;<span class="op" id="4907444">(</span><span class="ident" id="4907445">dec</span>&nbsp;<span class="op" id="4907449">*</span><span class="ident" id="4907450">Decoder</span><span class="op" id="4907457">)</span>&nbsp;<span class="ident" id="4907459">ignoreInterface</span><span class="op" id="4907474">(</span><span class="ident" id="4907475">state</span>&nbsp;<span class="op" id="4907481">*</span><span class="ident" id="4907482">decoderState</span><span class="op" id="4907494">)</span>&nbsp;<span class="op" id="4907496">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907499">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907539">b</span>&nbsp;<span class="op" id="4907541">:=</span>&nbsp;<span class="builtinfunc" id="4907544">make</span><span class="op" id="4907548">(</span><span class="op" id="4907549">[</span><span class="op" id="4907550">]</span><span class="builtintype" id="4907551">byte</span><span class="op" id="4907555">,</span>&nbsp;<span class="ident" id="4907557">state</span><span class="op" id="4907562">.</span><span class="ident" id="4907563">decodeUint</span><span class="op" id="4907573">(</span><span class="op" id="4907574">)</span><span class="op" id="4907575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907578">_</span><span class="op" id="4907579">,</span>&nbsp;<span class="ident" id="4907581">err</span>&nbsp;<span class="op" id="4907585">:=</span>&nbsp;<span class="ident" id="4907588">state</span><span class="op" id="4907593">.</span><span class="ident" id="4907594">b</span><span class="op" id="4907595">.</span><span class="ident" id="4907596">Read</span><span class="op" id="4907600">(</span><span class="ident" id="4907601">b</span><span class="op" id="4907602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907605">if</span>&nbsp;<span class="ident" id="4907608">err</span>&nbsp;<span class="op" id="4907612">!=</span>&nbsp;<span class="ident" id="4907615">nil</span>&nbsp;<span class="op" id="4907619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907623">error_</span><span class="op" id="4907629">(</span><span class="ident" id="4907630">err</span><span class="op" id="4907633">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907639">id</span>&nbsp;<span class="op" id="4907642">:=</span>&nbsp;<span class="ident" id="4907645">dec</span><span class="op" id="4907648">.</span><span class="ident" id="4907649">decodeTypeSequence</span><span class="op" id="4907667">(</span><span class="builtintype" id="4907668">true</span><span class="op" id="4907672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907675">if</span>&nbsp;<span class="ident" id="4907678">id</span>&nbsp;<span class="op" id="4907681">&lt;</span>&nbsp;<span class="num" id="4907683">0</span>&nbsp;<span class="op" id="4907685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907689">error_</span><span class="op" id="4907695">(</span><span class="ident" id="4907696">dec</span><span class="op" id="4907699">.</span><span class="ident" id="4907700">err</span><span class="op" id="4907703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907706">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4907709">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907789">state</span><span class="op" id="4907794">.</span><span class="ident" id="4907795">b</span><span class="op" id="4907796">.</span><span class="ident" id="4907797">Drop</span><span class="op" id="4907801">(</span><span class="builtintype" id="4907802">int</span><span class="op" id="4907805">(</span><span class="ident" id="4907806">state</span><span class="op" id="4907811">.</span><span class="ident" id="4907812">decodeUint</span><span class="op" id="4907822">(</span><span class="op" id="4907823">)</span><span class="op" id="4907824">)</span><span class="op" id="4907825">)</span><br>
<span class="lineno"></span><span class="op" id="4907827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4907830">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="4907907">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4907947">func</span>&nbsp;<span class="op" id="4907952">(</span><span class="ident" id="4907953">dec</span>&nbsp;<span class="op" id="4907957">*</span><span class="ident" id="4907958">Decoder</span><span class="op" id="4907965">)</span>&nbsp;<span class="ident" id="4907967">decodeGobDecoder</span><span class="op" id="4907983">(</span><span class="ident" id="4907984">ut</span>&nbsp;<span class="op" id="4907987">*</span><span class="ident" id="4907988">userTypeInfo</span><span class="op" id="4908000">,</span>&nbsp;<span class="ident" id="4908002">state</span>&nbsp;<span class="op" id="4908008">*</span><span class="ident" id="4908009">decoderState</span><span class="op" id="4908021">,</span>&nbsp;<span class="ident" id="4908023">value</span>&nbsp;<span class="ident" id="4908029">reflect</span><span class="op" id="4908036">.</span><span class="ident" id="4908037">Value</span><span class="op" id="4908042">)</span>&nbsp;<span class="op" id="4908044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908047">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908081">b</span>&nbsp;<span class="op" id="4908083">:=</span>&nbsp;<span class="builtinfunc" id="4908086">make</span><span class="op" id="4908090">(</span><span class="op" id="4908091">[</span><span class="op" id="4908092">]</span><span class="builtintype" id="4908093">byte</span><span class="op" id="4908097">,</span>&nbsp;<span class="ident" id="4908099">state</span><span class="op" id="4908104">.</span><span class="ident" id="4908105">decodeUint</span><span class="op" id="4908115">(</span><span class="op" id="4908116">)</span><span class="op" id="4908117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908120">_</span><span class="op" id="4908121">,</span>&nbsp;<span class="ident" id="4908123">err</span>&nbsp;<span class="op" id="4908127">:=</span>&nbsp;<span class="ident" id="4908130">state</span><span class="op" id="4908135">.</span><span class="ident" id="4908136">b</span><span class="op" id="4908137">.</span><span class="ident" id="4908138">Read</span><span class="op" id="4908142">(</span><span class="ident" id="4908143">b</span><span class="op" id="4908144">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908147">if</span>&nbsp;<span class="ident" id="4908150">err</span>&nbsp;<span class="op" id="4908154">!=</span>&nbsp;<span class="ident" id="4908157">nil</span>&nbsp;<span class="op" id="4908161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908165">error_</span><span class="op" id="4908171">(</span><span class="ident" id="4908172">err</span><span class="op" id="4908175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908181">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908212">switch</span>&nbsp;<span class="ident" id="4908219">ut</span><span class="op" id="4908221">.</span><span class="ident" id="4908222">externalDec</span>&nbsp;<span class="op" id="4908234">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908237">case</span>&nbsp;<span class="ident" id="4908242">xGob</span><span class="op" id="4908246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908250">err</span>&nbsp;<span class="op" id="4908254">=</span>&nbsp;<span class="ident" id="4908256">value</span><span class="op" id="4908261">.</span><span class="ident" id="4908262">Interface</span><span class="op" id="4908271">(</span><span class="op" id="4908272">)</span><span class="op" id="4908273">.</span><span class="op" id="4908274">(</span><span class="ident" id="4908275">GobDecoder</span><span class="op" id="4908285">)</span><span class="op" id="4908286">.</span><span class="ident" id="4908287">GobDecode</span><span class="op" id="4908296">(</span><span class="ident" id="4908297">b</span><span class="op" id="4908298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908301">case</span>&nbsp;<span class="ident" id="4908306">xBinary</span><span class="op" id="4908313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908317">err</span>&nbsp;<span class="op" id="4908321">=</span>&nbsp;<span class="ident" id="4908323">value</span><span class="op" id="4908328">.</span><span class="ident" id="4908329">Interface</span><span class="op" id="4908338">(</span><span class="op" id="4908339">)</span><span class="op" id="4908340">.</span><span class="op" id="4908341">(</span><span class="ident" id="4908342">encoding</span><span class="op" id="4908350">.</span><span class="ident" id="4908351">BinaryUnmarshaler</span><span class="op" id="4908368">)</span><span class="op" id="4908369">.</span><span class="ident" id="4908370">UnmarshalBinary</span><span class="op" id="4908385">(</span><span class="ident" id="4908386">b</span><span class="op" id="4908387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908390">case</span>&nbsp;<span class="ident" id="4908395">xText</span><span class="op" id="4908400">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908404">err</span>&nbsp;<span class="op" id="4908408">=</span>&nbsp;<span class="ident" id="4908410">value</span><span class="op" id="4908415">.</span><span class="ident" id="4908416">Interface</span><span class="op" id="4908425">(</span><span class="op" id="4908426">)</span><span class="op" id="4908427">.</span><span class="op" id="4908428">(</span><span class="ident" id="4908429">encoding</span><span class="op" id="4908437">.</span><span class="ident" id="4908438">TextUnmarshaler</span><span class="op" id="4908453">)</span><span class="op" id="4908454">.</span><span class="ident" id="4908455">UnmarshalText</span><span class="op" id="4908468">(</span><span class="ident" id="4908469">b</span><span class="op" id="4908470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908476">if</span>&nbsp;<span class="ident" id="4908479">err</span>&nbsp;<span class="op" id="4908483">!=</span>&nbsp;<span class="ident" id="4908486">nil</span>&nbsp;<span class="op" id="4908490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908494">error_</span><span class="op" id="4908500">(</span><span class="ident" id="4908501">err</span><span class="op" id="4908504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908507">}</span><br>
<span class="lineno">715</span><span class="op" id="4908509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4908512">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4908594">func</span>&nbsp;<span class="op" id="4908599">(</span><span class="ident" id="4908600">dec</span>&nbsp;<span class="op" id="4908604">*</span><span class="ident" id="4908605">Decoder</span><span class="op" id="4908612">)</span>&nbsp;<span class="ident" id="4908614">ignoreGobDecoder</span><span class="op" id="4908630">(</span><span class="ident" id="4908631">state</span>&nbsp;<span class="op" id="4908637">*</span><span class="ident" id="4908638">decoderState</span><span class="op" id="4908650">)</span>&nbsp;<span class="op" id="4908652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908655">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908689">b</span>&nbsp;<span class="op" id="4908691">:=</span>&nbsp;<span class="builtinfunc" id="4908694">make</span><span class="op" id="4908698">(</span><span class="op" id="4908699">[</span><span class="op" id="4908700">]</span><span class="builtintype" id="4908701">byte</span><span class="op" id="4908705">,</span>&nbsp;<span class="ident" id="4908707">state</span><span class="op" id="4908712">.</span><span class="ident" id="4908713">decodeUint</span><span class="op" id="4908723">(</span><span class="op" id="4908724">)</span><span class="op" id="4908725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908728">_</span><span class="op" id="4908729">,</span>&nbsp;<span class="ident" id="4908731">err</span>&nbsp;<span class="op" id="4908735">:=</span>&nbsp;<span class="ident" id="4908738">state</span><span class="op" id="4908743">.</span><span class="ident" id="4908744">b</span><span class="op" id="4908745">.</span><span class="ident" id="4908746">Read</span><span class="op" id="4908750">(</span><span class="ident" id="4908751">b</span><span class="op" id="4908752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908755">if</span>&nbsp;<span class="ident" id="4908758">err</span>&nbsp;<span class="op" id="4908762">!=</span>&nbsp;<span class="ident" id="4908765">nil</span>&nbsp;<span class="op" id="4908769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908773">error_</span><span class="op" id="4908779">(</span><span class="ident" id="4908780">err</span><span class="op" id="4908783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908786">}</span><br>
<span class="lineno">725</span><span class="op" id="4908788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4908791">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4908813">var</span>&nbsp;<span class="ident" id="4908817">decOpTable</span>&nbsp;<span class="op" id="4908828">=</span>&nbsp;<span class="op" id="4908830">[</span><span class="op" id="4908831">...</span><span class="op" id="4908834">]</span><span class="ident" id="4908835">decOp</span><span class="op" id="4908840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908843">reflect</span><span class="op" id="4908850">.</span><span class="ident" id="4908851">Bool</span><span class="op" id="4908855">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908863">decBool</span><span class="op" id="4908870">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908873">reflect</span><span class="op" id="4908880">.</span><span class="ident" id="4908881">Int8</span><span class="op" id="4908885">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908893">decInt8</span><span class="op" id="4908900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908903">reflect</span><span class="op" id="4908910">.</span><span class="ident" id="4908911">Int16</span><span class="op" id="4908916">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908923">decInt16</span><span class="op" id="4908931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908934">reflect</span><span class="op" id="4908941">.</span><span class="ident" id="4908942">Int32</span><span class="op" id="4908947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908954">decInt32</span><span class="op" id="4908962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908965">reflect</span><span class="op" id="4908972">.</span><span class="ident" id="4908973">Int64</span><span class="op" id="4908978">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908985">decInt64</span><span class="op" id="4908993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908996">reflect</span><span class="op" id="4909003">.</span><span class="ident" id="4909004">Uint8</span><span class="op" id="4909009">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909016">decUint8</span><span class="op" id="4909024">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909027">reflect</span><span class="op" id="4909034">.</span><span class="ident" id="4909035">Uint16</span><span class="op" id="4909041">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909047">decUint16</span><span class="op" id="4909056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909059">reflect</span><span class="op" id="4909066">.</span><span class="ident" id="4909067">Uint32</span><span class="op" id="4909073">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909079">decUint32</span><span class="op" id="4909088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909091">reflect</span><span class="op" id="4909098">.</span><span class="ident" id="4909099">Uint64</span><span class="op" id="4909105">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909111">decUint64</span><span class="op" id="4909120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909123">reflect</span><span class="op" id="4909130">.</span><span class="ident" id="4909131">Float32</span><span class="op" id="4909138">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909143">decFloat32</span><span class="op" id="4909153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909156">reflect</span><span class="op" id="4909163">.</span><span class="ident" id="4909164">Float64</span><span class="op" id="4909171">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909176">decFloat64</span><span class="op" id="4909186">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909189">reflect</span><span class="op" id="4909196">.</span><span class="ident" id="4909197">Complex64</span><span class="op" id="4909206">:</span>&nbsp;&nbsp;<span class="ident" id="4909209">decComplex64</span><span class="op" id="4909221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909224">reflect</span><span class="op" id="4909231">.</span><span class="ident" id="4909232">Complex128</span><span class="op" id="4909242">:</span>&nbsp;<span class="ident" id="4909244">decComplex128</span><span class="op" id="4909257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909260">reflect</span><span class="op" id="4909267">.</span><span class="ident" id="4909268">String</span><span class="op" id="4909274">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909280">decString</span><span class="op" id="4909289">,</span><br>
<span class="lineno"></span><span class="op" id="4909291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="4909294">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="4909363">var</span>&nbsp;<span class="ident" id="4909367">decIgnoreOpMap</span>&nbsp;<span class="op" id="4909382">=</span>&nbsp;<span class="keyword" id="4909384">map</span><span class="op" id="4909387">[</span><span class="ident" id="4909388">typeId</span><span class="op" id="4909394">]</span><span class="ident" id="4909395">decOp</span><span class="op" id="4909400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909403">tBool</span><span class="op" id="4909408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909413">ignoreUint</span><span class="op" id="4909423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909426">tInt</span><span class="op" id="4909430">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909436">ignoreUint</span><span class="op" id="4909446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909449">tUint</span><span class="op" id="4909454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909459">ignoreUint</span><span class="op" id="4909469">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909472">tFloat</span><span class="op" id="4909478">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4909482">ignoreUint</span><span class="op" id="4909492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909495">tBytes</span><span class="op" id="4909501">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4909505">ignoreUint8Array</span><span class="op" id="4909521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909524">tString</span><span class="op" id="4909531">:</span>&nbsp;&nbsp;<span class="ident" id="4909534">ignoreUint8Array</span><span class="op" id="4909550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909553">tComplex</span><span class="op" id="4909561">:</span>&nbsp;<span class="ident" id="4909563">ignoreTwoUints</span><span class="op" id="4909577">,</span><br>
<span class="lineno"></span><span class="op" id="4909579">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="4909582">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4909649">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4909687">func</span>&nbsp;<span class="op" id="4909692">(</span><span class="ident" id="4909693">dec</span>&nbsp;<span class="op" id="4909697">*</span><span class="ident" id="4909698">Decoder</span><span class="op" id="4909705">)</span>&nbsp;<span class="ident" id="4909707">decOpFor</span><span class="op" id="4909715">(</span><span class="ident" id="4909716">wireId</span>&nbsp;<span class="ident" id="4909723">typeId</span><span class="op" id="4909729">,</span>&nbsp;<span class="ident" id="4909731">rt</span>&nbsp;<span class="ident" id="4909734">reflect</span><span class="op" id="4909741">.</span><span class="ident" id="4909742">Type</span><span class="op" id="4909746">,</span>&nbsp;<span class="ident" id="4909748">name</span>&nbsp;<span class="builtintype" id="4909753">string</span><span class="op" id="4909759">,</span>&nbsp;<span class="ident" id="4909761">inProgress</span>&nbsp;<span class="keyword" id="4909772">map</span><span class="op" id="4909775">[</span><span class="ident" id="4909776">reflect</span><span class="op" id="4909783">.</span><span class="ident" id="4909784">Type</span><span class="op" id="4909788">]</span><span class="op" id="4909789">*</span><span class="ident" id="4909790">decOp</span><span class="op" id="4909795">)</span>&nbsp;<span class="op" id="4909797">*</span><span class="ident" id="4909798">decOp</span>&nbsp;<span class="op" id="4909804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909807">ut</span>&nbsp;<span class="op" id="4909810">:=</span>&nbsp;<span class="ident" id="4909813">userType</span><span class="op" id="4909821">(</span><span class="ident" id="4909822">rt</span><span class="op" id="4909824">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909827">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909907">if</span>&nbsp;<span class="ident" id="4909910">ut</span><span class="op" id="4909912">.</span><span class="ident" id="4909913">externalDec</span>&nbsp;<span class="op" id="4909925">!=</span>&nbsp;<span class="num" id="4909928">0</span>&nbsp;<span class="op" id="4909930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909934">return</span>&nbsp;<span class="ident" id="4909941">dec</span><span class="op" id="4909944">.</span><span class="ident" id="4909945">gobDecodeOpFor</span><span class="op" id="4909959">(</span><span class="ident" id="4909960">ut</span><span class="op" id="4909962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909969">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4910054">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910111">if</span>&nbsp;<span class="ident" id="4910114">opPtr</span>&nbsp;<span class="op" id="4910120">:=</span>&nbsp;<span class="ident" id="4910123">inProgress</span><span class="op" id="4910133">[</span><span class="ident" id="4910134">rt</span><span class="op" id="4910136">]</span><span class="op" id="4910137">;</span>&nbsp;<span class="ident" id="4910139">opPtr</span>&nbsp;<span class="op" id="4910145">!=</span>&nbsp;<span class="ident" id="4910148">nil</span>&nbsp;<span class="op" id="4910152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910156">return</span>&nbsp;<span class="ident" id="4910163">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910170">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910173">typ</span>&nbsp;<span class="op" id="4910177">:=</span>&nbsp;<span class="ident" id="4910180">ut</span><span class="op" id="4910182">.</span><span class="ident" id="4910183">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910189">var</span>&nbsp;<span class="ident" id="4910193">op</span>&nbsp;<span class="ident" id="4910196">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910203">k</span>&nbsp;<span class="op" id="4910205">:=</span>&nbsp;<span class="ident" id="4910208">typ</span><span class="op" id="4910211">.</span><span class="ident" id="4910212">Kind</span><span class="op" id="4910216">(</span><span class="op" id="4910217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910220">if</span>&nbsp;<span class="builtintype" id="4910223">int</span><span class="op" id="4910226">(</span><span class="ident" id="4910227">k</span><span class="op" id="4910228">)</span>&nbsp;<span class="op" id="4910230">&lt;</span>&nbsp;<span class="builtinfunc" id="4910232">len</span><span class="op" id="4910235">(</span><span class="ident" id="4910236">decOpTable</span><span class="op" id="4910246">)</span>&nbsp;<span class="op" id="4910248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910252">op</span>&nbsp;<span class="op" id="4910255">=</span>&nbsp;<span class="ident" id="4910257">decOpTable</span><span class="op" id="4910267">[</span><span class="ident" id="4910268">k</span><span class="op" id="4910269">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910275">if</span>&nbsp;<span class="ident" id="4910278">op</span>&nbsp;<span class="op" id="4910281">==</span>&nbsp;<span class="ident" id="4910284">nil</span>&nbsp;<span class="op" id="4910288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910292">inProgress</span><span class="op" id="4910302">[</span><span class="ident" id="4910303">rt</span><span class="op" id="4910305">]</span>&nbsp;<span class="op" id="4910307">=</span>&nbsp;<span class="op" id="4910309">&amp;</span><span class="ident" id="4910310">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4910315">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910334">switch</span>&nbsp;<span class="ident" id="4910341">t</span>&nbsp;<span class="op" id="4910343">:=</span>&nbsp;<span class="ident" id="4910346">typ</span><span class="op" id="4910349">;</span>&nbsp;<span class="ident" id="4910351">t</span><span class="op" id="4910352">.</span><span class="ident" id="4910353">Kind</span><span class="op" id="4910357">(</span><span class="op" id="4910358">)</span>&nbsp;<span class="op" id="4910360">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910364">case</span>&nbsp;<span class="ident" id="4910369">reflect</span><span class="op" id="4910376">.</span><span class="ident" id="4910377">Array</span><span class="op" id="4910382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910387">name</span>&nbsp;<span class="op" id="4910392">=</span>&nbsp;<span class="string" id="4910394">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4910408">+</span>&nbsp;<span class="ident" id="4910410">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910418">elemId</span>&nbsp;<span class="op" id="4910425">:=</span>&nbsp;<span class="ident" id="4910428">dec</span><span class="op" id="4910431">.</span><span class="ident" id="4910432">wireType</span><span class="op" id="4910440">[</span><span class="ident" id="4910441">wireId</span><span class="op" id="4910447">]</span><span class="op" id="4910448">.</span><span class="ident" id="4910449">ArrayT</span><span class="op" id="4910455">.</span><span class="ident" id="4910456">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910464">elemOp</span>&nbsp;<span class="op" id="4910471">:=</span>&nbsp;<span class="ident" id="4910474">dec</span><span class="op" id="4910477">.</span><span class="ident" id="4910478">decOpFor</span><span class="op" id="4910486">(</span><span class="ident" id="4910487">elemId</span><span class="op" id="4910493">,</span>&nbsp;<span class="ident" id="4910495">t</span><span class="op" id="4910496">.</span><span class="ident" id="4910497">Elem</span><span class="op" id="4910501">(</span><span class="op" id="4910502">)</span><span class="op" id="4910503">,</span>&nbsp;<span class="ident" id="4910505">name</span><span class="op" id="4910509">,</span>&nbsp;<span class="ident" id="4910511">inProgress</span><span class="op" id="4910521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910526">ovfl</span>&nbsp;<span class="op" id="4910531">:=</span>&nbsp;<span class="ident" id="4910534">overflow</span><span class="op" id="4910542">(</span><span class="ident" id="4910543">name</span><span class="op" id="4910547">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910552">helper</span>&nbsp;<span class="op" id="4910559">:=</span>&nbsp;<span class="ident" id="4910562">decArrayHelper</span><span class="op" id="4910576">[</span><span class="ident" id="4910577">t</span><span class="op" id="4910578">.</span><span class="ident" id="4910579">Elem</span><span class="op" id="4910583">(</span><span class="op" id="4910584">)</span><span class="op" id="4910585">.</span><span class="ident" id="4910586">Kind</span><span class="op" id="4910590">(</span><span class="op" id="4910591">)</span><span class="op" id="4910592">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910597">op</span>&nbsp;<span class="op" id="4910600">=</span>&nbsp;<span class="keyword" id="4910602">func</span><span class="op" id="4910606">(</span><span class="ident" id="4910607">i</span>&nbsp;<span class="op" id="4910609">*</span><span class="ident" id="4910610">decInstr</span><span class="op" id="4910618">,</span>&nbsp;<span class="ident" id="4910620">state</span>&nbsp;<span class="op" id="4910626">*</span><span class="ident" id="4910627">decoderState</span><span class="op" id="4910639">,</span>&nbsp;<span class="ident" id="4910641">value</span>&nbsp;<span class="ident" id="4910647">reflect</span><span class="op" id="4910654">.</span><span class="ident" id="4910655">Value</span><span class="op" id="4910660">)</span>&nbsp;<span class="op" id="4910662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910668">state</span><span class="op" id="4910673">.</span><span class="ident" id="4910674">dec</span><span class="op" id="4910677">.</span><span class="ident" id="4910678">decodeArray</span><span class="op" id="4910689">(</span><span class="ident" id="4910690">t</span><span class="op" id="4910691">,</span>&nbsp;<span class="ident" id="4910693">state</span><span class="op" id="4910698">,</span>&nbsp;<span class="ident" id="4910700">value</span><span class="op" id="4910705">,</span>&nbsp;<span class="op" id="4910707">*</span><span class="ident" id="4910708">elemOp</span><span class="op" id="4910714">,</span>&nbsp;<span class="ident" id="4910716">t</span><span class="op" id="4910717">.</span><span class="ident" id="4910718">Len</span><span class="op" id="4910721">(</span><span class="op" id="4910722">)</span><span class="op" id="4910723">,</span>&nbsp;<span class="ident" id="4910725">ovfl</span><span class="op" id="4910729">,</span>&nbsp;<span class="ident" id="4910731">helper</span><span class="op" id="4910737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910747">case</span>&nbsp;<span class="ident" id="4910752">reflect</span><span class="op" id="4910759">.</span><span class="ident" id="4910760">Map</span><span class="op" id="4910763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910768">keyId</span>&nbsp;<span class="op" id="4910774">:=</span>&nbsp;<span class="ident" id="4910777">dec</span><span class="op" id="4910780">.</span><span class="ident" id="4910781">wireType</span><span class="op" id="4910789">[</span><span class="ident" id="4910790">wireId</span><span class="op" id="4910796">]</span><span class="op" id="4910797">.</span><span class="ident" id="4910798">MapT</span><span class="op" id="4910802">.</span><span class="ident" id="4910803">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910810">elemId</span>&nbsp;<span class="op" id="4910817">:=</span>&nbsp;<span class="ident" id="4910820">dec</span><span class="op" id="4910823">.</span><span class="ident" id="4910824">wireType</span><span class="op" id="4910832">[</span><span class="ident" id="4910833">wireId</span><span class="op" id="4910839">]</span><span class="op" id="4910840">.</span><span class="ident" id="4910841">MapT</span><span class="op" id="4910845">.</span><span class="ident" id="4910846">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910854">keyOp</span>&nbsp;<span class="op" id="4910860">:=</span>&nbsp;<span class="ident" id="4910863">dec</span><span class="op" id="4910866">.</span><span class="ident" id="4910867">decOpFor</span><span class="op" id="4910875">(</span><span class="ident" id="4910876">keyId</span><span class="op" id="4910881">,</span>&nbsp;<span class="ident" id="4910883">t</span><span class="op" id="4910884">.</span><span class="ident" id="4910885">Key</span><span class="op" id="4910888">(</span><span class="op" id="4910889">)</span><span class="op" id="4910890">,</span>&nbsp;<span class="string" id="4910892">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="4910901">+</span><span class="ident" id="4910902">name</span><span class="op" id="4910906">,</span>&nbsp;<span class="ident" id="4910908">inProgress</span><span class="op" id="4910918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910923">elemOp</span>&nbsp;<span class="op" id="4910930">:=</span>&nbsp;<span class="ident" id="4910933">dec</span><span class="op" id="4910936">.</span><span class="ident" id="4910937">decOpFor</span><span class="op" id="4910945">(</span><span class="ident" id="4910946">elemId</span><span class="op" id="4910952">,</span>&nbsp;<span class="ident" id="4910954">t</span><span class="op" id="4910955">.</span><span class="ident" id="4910956">Elem</span><span class="op" id="4910960">(</span><span class="op" id="4910961">)</span><span class="op" id="4910962">,</span>&nbsp;<span class="string" id="4910964">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="4910977">+</span><span class="ident" id="4910978">name</span><span class="op" id="4910982">,</span>&nbsp;<span class="ident" id="4910984">inProgress</span><span class="op" id="4910994">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910999">ovfl</span>&nbsp;<span class="op" id="4911004">:=</span>&nbsp;<span class="ident" id="4911007">overflow</span><span class="op" id="4911015">(</span><span class="ident" id="4911016">name</span><span class="op" id="4911020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911025">op</span>&nbsp;<span class="op" id="4911028">=</span>&nbsp;<span class="keyword" id="4911030">func</span><span class="op" id="4911034">(</span><span class="ident" id="4911035">i</span>&nbsp;<span class="op" id="4911037">*</span><span class="ident" id="4911038">decInstr</span><span class="op" id="4911046">,</span>&nbsp;<span class="ident" id="4911048">state</span>&nbsp;<span class="op" id="4911054">*</span><span class="ident" id="4911055">decoderState</span><span class="op" id="4911067">,</span>&nbsp;<span class="ident" id="4911069">value</span>&nbsp;<span class="ident" id="4911075">reflect</span><span class="op" id="4911082">.</span><span class="ident" id="4911083">Value</span><span class="op" id="4911088">)</span>&nbsp;<span class="op" id="4911090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911096">state</span><span class="op" id="4911101">.</span><span class="ident" id="4911102">dec</span><span class="op" id="4911105">.</span><span class="ident" id="4911106">decodeMap</span><span class="op" id="4911115">(</span><span class="ident" id="4911116">t</span><span class="op" id="4911117">,</span>&nbsp;<span class="ident" id="4911119">state</span><span class="op" id="4911124">,</span>&nbsp;<span class="ident" id="4911126">value</span><span class="op" id="4911131">,</span>&nbsp;<span class="op" id="4911133">*</span><span class="ident" id="4911134">keyOp</span><span class="op" id="4911139">,</span>&nbsp;<span class="op" id="4911141">*</span><span class="ident" id="4911142">elemOp</span><span class="op" id="4911148">,</span>&nbsp;<span class="ident" id="4911150">ovfl</span><span class="op" id="4911154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911164">case</span>&nbsp;<span class="ident" id="4911169">reflect</span><span class="op" id="4911176">.</span><span class="ident" id="4911177">Slice</span><span class="op" id="4911182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911187">name</span>&nbsp;<span class="op" id="4911192">=</span>&nbsp;<span class="string" id="4911194">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4911208">+</span>&nbsp;<span class="ident" id="4911210">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911218">if</span>&nbsp;<span class="ident" id="4911221">t</span><span class="op" id="4911222">.</span><span class="ident" id="4911223">Elem</span><span class="op" id="4911227">(</span><span class="op" id="4911228">)</span><span class="op" id="4911229">.</span><span class="ident" id="4911230">Kind</span><span class="op" id="4911234">(</span><span class="op" id="4911235">)</span>&nbsp;<span class="op" id="4911237">==</span>&nbsp;<span class="ident" id="4911240">reflect</span><span class="op" id="4911247">.</span><span class="ident" id="4911248">Uint8</span>&nbsp;<span class="op" id="4911254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911260">op</span>&nbsp;<span class="op" id="4911263">=</span>&nbsp;<span class="ident" id="4911265">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911283">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911297">var</span>&nbsp;<span class="ident" id="4911301">elemId</span>&nbsp;<span class="ident" id="4911308">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911318">if</span>&nbsp;<span class="ident" id="4911321">tt</span><span class="op" id="4911323">,</span>&nbsp;<span class="ident" id="4911325">ok</span>&nbsp;<span class="op" id="4911328">:=</span>&nbsp;<span class="ident" id="4911331">builtinIdToType</span><span class="op" id="4911346">[</span><span class="ident" id="4911347">wireId</span><span class="op" id="4911353">]</span><span class="op" id="4911354">;</span>&nbsp;<span class="ident" id="4911356">ok</span>&nbsp;<span class="op" id="4911359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911365">elemId</span>&nbsp;<span class="op" id="4911372">=</span>&nbsp;<span class="ident" id="4911374">tt</span><span class="op" id="4911376">.</span><span class="op" id="4911377">(</span><span class="op" id="4911378">*</span><span class="ident" id="4911379">sliceType</span><span class="op" id="4911388">)</span><span class="op" id="4911389">.</span><span class="ident" id="4911390">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911398">}</span>&nbsp;<span class="keyword" id="4911400">else</span>&nbsp;<span class="op" id="4911405">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911411">elemId</span>&nbsp;<span class="op" id="4911418">=</span>&nbsp;<span class="ident" id="4911420">dec</span><span class="op" id="4911423">.</span><span class="ident" id="4911424">wireType</span><span class="op" id="4911432">[</span><span class="ident" id="4911433">wireId</span><span class="op" id="4911439">]</span><span class="op" id="4911440">.</span><span class="ident" id="4911441">SliceT</span><span class="op" id="4911447">.</span><span class="ident" id="4911448">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911461">elemOp</span>&nbsp;<span class="op" id="4911468">:=</span>&nbsp;<span class="ident" id="4911471">dec</span><span class="op" id="4911474">.</span><span class="ident" id="4911475">decOpFor</span><span class="op" id="4911483">(</span><span class="ident" id="4911484">elemId</span><span class="op" id="4911490">,</span>&nbsp;<span class="ident" id="4911492">t</span><span class="op" id="4911493">.</span><span class="ident" id="4911494">Elem</span><span class="op" id="4911498">(</span><span class="op" id="4911499">)</span><span class="op" id="4911500">,</span>&nbsp;<span class="ident" id="4911502">name</span><span class="op" id="4911506">,</span>&nbsp;<span class="ident" id="4911508">inProgress</span><span class="op" id="4911518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911523">ovfl</span>&nbsp;<span class="op" id="4911528">:=</span>&nbsp;<span class="ident" id="4911531">overflow</span><span class="op" id="4911539">(</span><span class="ident" id="4911540">name</span><span class="op" id="4911544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911549">helper</span>&nbsp;<span class="op" id="4911556">:=</span>&nbsp;<span class="ident" id="4911559">decSliceHelper</span><span class="op" id="4911573">[</span><span class="ident" id="4911574">t</span><span class="op" id="4911575">.</span><span class="ident" id="4911576">Elem</span><span class="op" id="4911580">(</span><span class="op" id="4911581">)</span><span class="op" id="4911582">.</span><span class="ident" id="4911583">Kind</span><span class="op" id="4911587">(</span><span class="op" id="4911588">)</span><span class="op" id="4911589">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911594">op</span>&nbsp;<span class="op" id="4911597">=</span>&nbsp;<span class="keyword" id="4911599">func</span><span class="op" id="4911603">(</span><span class="ident" id="4911604">i</span>&nbsp;<span class="op" id="4911606">*</span><span class="ident" id="4911607">decInstr</span><span class="op" id="4911615">,</span>&nbsp;<span class="ident" id="4911617">state</span>&nbsp;<span class="op" id="4911623">*</span><span class="ident" id="4911624">decoderState</span><span class="op" id="4911636">,</span>&nbsp;<span class="ident" id="4911638">value</span>&nbsp;<span class="ident" id="4911644">reflect</span><span class="op" id="4911651">.</span><span class="ident" id="4911652">Value</span><span class="op" id="4911657">)</span>&nbsp;<span class="op" id="4911659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911665">state</span><span class="op" id="4911670">.</span><span class="ident" id="4911671">dec</span><span class="op" id="4911674">.</span><span class="ident" id="4911675">decodeSlice</span><span class="op" id="4911686">(</span><span class="ident" id="4911687">state</span><span class="op" id="4911692">,</span>&nbsp;<span class="ident" id="4911694">value</span><span class="op" id="4911699">,</span>&nbsp;<span class="op" id="4911701">*</span><span class="ident" id="4911702">elemOp</span><span class="op" id="4911708">,</span>&nbsp;<span class="ident" id="4911710">ovfl</span><span class="op" id="4911714">,</span>&nbsp;<span class="ident" id="4911716">helper</span><span class="op" id="4911722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911732">case</span>&nbsp;<span class="ident" id="4911737">reflect</span><span class="op" id="4911744">.</span><span class="ident" id="4911745">Struct</span><span class="op" id="4911751">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4911756">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911831">ut</span>&nbsp;<span class="op" id="4911834">:=</span>&nbsp;<span class="ident" id="4911837">userType</span><span class="op" id="4911845">(</span><span class="ident" id="4911846">typ</span><span class="op" id="4911849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911854">enginePtr</span><span class="op" id="4911863">,</span>&nbsp;<span class="ident" id="4911865">err</span>&nbsp;<span class="op" id="4911869">:=</span>&nbsp;<span class="ident" id="4911872">dec</span><span class="op" id="4911875">.</span><span class="ident" id="4911876">getDecEnginePtr</span><span class="op" id="4911891">(</span><span class="ident" id="4911892">wireId</span><span class="op" id="4911898">,</span>&nbsp;<span class="ident" id="4911900">ut</span><span class="op" id="4911902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911907">if</span>&nbsp;<span class="ident" id="4911910">err</span>&nbsp;<span class="op" id="4911914">!=</span>&nbsp;<span class="ident" id="4911917">nil</span>&nbsp;<span class="op" id="4911921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911927">error_</span><span class="op" id="4911933">(</span><span class="ident" id="4911934">err</span><span class="op" id="4911937">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911947">op</span>&nbsp;<span class="op" id="4911950">=</span>&nbsp;<span class="keyword" id="4911952">func</span><span class="op" id="4911956">(</span><span class="ident" id="4911957">i</span>&nbsp;<span class="op" id="4911959">*</span><span class="ident" id="4911960">decInstr</span><span class="op" id="4911968">,</span>&nbsp;<span class="ident" id="4911970">state</span>&nbsp;<span class="op" id="4911976">*</span><span class="ident" id="4911977">decoderState</span><span class="op" id="4911989">,</span>&nbsp;<span class="ident" id="4911991">value</span>&nbsp;<span class="ident" id="4911997">reflect</span><span class="op" id="4912004">.</span><span class="ident" id="4912005">Value</span><span class="op" id="4912010">)</span>&nbsp;<span class="op" id="4912012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4912018">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912095">dec</span><span class="op" id="4912098">.</span><span class="ident" id="4912099">decodeStruct</span><span class="op" id="4912111">(</span><span class="op" id="4912112">*</span><span class="ident" id="4912113">enginePtr</span><span class="op" id="4912122">,</span>&nbsp;<span class="ident" id="4912124">ut</span><span class="op" id="4912126">,</span>&nbsp;<span class="ident" id="4912128">value</span><span class="op" id="4912133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912138">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912142">case</span>&nbsp;<span class="ident" id="4912147">reflect</span><span class="op" id="4912154">.</span><span class="ident" id="4912155">Interface</span><span class="op" id="4912164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912169">op</span>&nbsp;<span class="op" id="4912172">=</span>&nbsp;<span class="keyword" id="4912174">func</span><span class="op" id="4912178">(</span><span class="ident" id="4912179">i</span>&nbsp;<span class="op" id="4912181">*</span><span class="ident" id="4912182">decInstr</span><span class="op" id="4912190">,</span>&nbsp;<span class="ident" id="4912192">state</span>&nbsp;<span class="op" id="4912198">*</span><span class="ident" id="4912199">decoderState</span><span class="op" id="4912211">,</span>&nbsp;<span class="ident" id="4912213">value</span>&nbsp;<span class="ident" id="4912219">reflect</span><span class="op" id="4912226">.</span><span class="ident" id="4912227">Value</span><span class="op" id="4912232">)</span>&nbsp;<span class="op" id="4912234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912240">state</span><span class="op" id="4912245">.</span><span class="ident" id="4912246">dec</span><span class="op" id="4912249">.</span><span class="ident" id="4912250">decodeInterface</span><span class="op" id="4912265">(</span><span class="ident" id="4912266">t</span><span class="op" id="4912267">,</span>&nbsp;<span class="ident" id="4912269">state</span><span class="op" id="4912274">,</span>&nbsp;<span class="ident" id="4912276">value</span><span class="op" id="4912281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912290">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912296">if</span>&nbsp;<span class="ident" id="4912299">op</span>&nbsp;<span class="op" id="4912302">==</span>&nbsp;<span class="ident" id="4912305">nil</span>&nbsp;<span class="op" id="4912309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912313">errorf</span><span class="op" id="4912319">(</span><span class="string" id="4912320">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4912349">,</span>&nbsp;<span class="ident" id="4912351">rt</span><span class="op" id="4912353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912359">return</span>&nbsp;<span class="op" id="4912366">&amp;</span><span class="ident" id="4912367">op</span><br>
<span class="lineno">840</span><span class="op" id="4912370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4912373">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4912452">func</span>&nbsp;<span class="op" id="4912457">(</span><span class="ident" id="4912458">dec</span>&nbsp;<span class="op" id="4912462">*</span><span class="ident" id="4912463">Decoder</span><span class="op" id="4912470">)</span>&nbsp;<span class="ident" id="4912472">decIgnoreOpFor</span><span class="op" id="4912486">(</span><span class="ident" id="4912487">wireId</span>&nbsp;<span class="ident" id="4912494">typeId</span><span class="op" id="4912500">)</span>&nbsp;<span class="ident" id="4912502">decOp</span>&nbsp;<span class="op" id="4912508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912511">op</span><span class="op" id="4912513">,</span>&nbsp;<span class="ident" id="4912515">ok</span>&nbsp;<span class="op" id="4912518">:=</span>&nbsp;<span class="ident" id="4912521">decIgnoreOpMap</span><span class="op" id="4912535">[</span><span class="ident" id="4912536">wireId</span><span class="op" id="4912542">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912545">if</span>&nbsp;<span class="op" id="4912548">!</span><span class="ident" id="4912549">ok</span>&nbsp;<span class="op" id="4912552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912556">if</span>&nbsp;<span class="ident" id="4912559">wireId</span>&nbsp;<span class="op" id="4912566">==</span>&nbsp;<span class="ident" id="4912569">tInterface</span>&nbsp;<span class="op" id="4912580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4912585">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4912650">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912719">op</span>&nbsp;<span class="op" id="4912722">=</span>&nbsp;<span class="keyword" id="4912724">func</span><span class="op" id="4912728">(</span><span class="ident" id="4912729">i</span>&nbsp;<span class="op" id="4912731">*</span><span class="ident" id="4912732">decInstr</span><span class="op" id="4912740">,</span>&nbsp;<span class="ident" id="4912742">state</span>&nbsp;<span class="op" id="4912748">*</span><span class="ident" id="4912749">decoderState</span><span class="op" id="4912761">,</span>&nbsp;<span class="ident" id="4912763">value</span>&nbsp;<span class="ident" id="4912769">reflect</span><span class="op" id="4912776">.</span><span class="ident" id="4912777">Value</span><span class="op" id="4912782">)</span>&nbsp;<span class="op" id="4912784">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912790">state</span><span class="op" id="4912795">.</span><span class="ident" id="4912796">dec</span><span class="op" id="4912799">.</span><span class="ident" id="4912800">ignoreInterface</span><span class="op" id="4912815">(</span><span class="ident" id="4912816">state</span><span class="op" id="4912821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912831">return</span>&nbsp;<span class="ident" id="4912838">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4912847">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912866">wire</span>&nbsp;<span class="op" id="4912871">:=</span>&nbsp;<span class="ident" id="4912874">dec</span><span class="op" id="4912877">.</span><span class="ident" id="4912878">wireType</span><span class="op" id="4912886">[</span><span class="ident" id="4912887">wireId</span><span class="op" id="4912893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912897">switch</span>&nbsp;<span class="op" id="4912904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912908">case</span>&nbsp;<span class="ident" id="4912913">wire</span>&nbsp;<span class="op" id="4912918">==</span>&nbsp;<span class="ident" id="4912921">nil</span><span class="op" id="4912924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912929">errorf</span><span class="op" id="4912935">(</span><span class="string" id="4912936">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4912965">,</span>&nbsp;<span class="ident" id="4912967">wireId</span><span class="op" id="4912973">.</span><span class="builtintype" id="4912974">string</span><span class="op" id="4912980">(</span><span class="op" id="4912981">)</span><span class="op" id="4912982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912986">case</span>&nbsp;<span class="ident" id="4912991">wire</span><span class="op" id="4912995">.</span><span class="ident" id="4912996">ArrayT</span>&nbsp;<span class="op" id="4913003">!=</span>&nbsp;<span class="ident" id="4913006">nil</span><span class="op" id="4913009">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913014">elemId</span>&nbsp;<span class="op" id="4913021">:=</span>&nbsp;<span class="ident" id="4913024">wire</span><span class="op" id="4913028">.</span><span class="ident" id="4913029">ArrayT</span><span class="op" id="4913035">.</span><span class="ident" id="4913036">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913044">elemOp</span>&nbsp;<span class="op" id="4913051">:=</span>&nbsp;<span class="ident" id="4913054">dec</span><span class="op" id="4913057">.</span><span class="ident" id="4913058">decIgnoreOpFor</span><span class="op" id="4913072">(</span><span class="ident" id="4913073">elemId</span><span class="op" id="4913079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913084">op</span>&nbsp;<span class="op" id="4913087">=</span>&nbsp;<span class="keyword" id="4913089">func</span><span class="op" id="4913093">(</span><span class="ident" id="4913094">i</span>&nbsp;<span class="op" id="4913096">*</span><span class="ident" id="4913097">decInstr</span><span class="op" id="4913105">,</span>&nbsp;<span class="ident" id="4913107">state</span>&nbsp;<span class="op" id="4913113">*</span><span class="ident" id="4913114">decoderState</span><span class="op" id="4913126">,</span>&nbsp;<span class="ident" id="4913128">value</span>&nbsp;<span class="ident" id="4913134">reflect</span><span class="op" id="4913141">.</span><span class="ident" id="4913142">Value</span><span class="op" id="4913147">)</span>&nbsp;<span class="op" id="4913149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913155">state</span><span class="op" id="4913160">.</span><span class="ident" id="4913161">dec</span><span class="op" id="4913164">.</span><span class="ident" id="4913165">ignoreArray</span><span class="op" id="4913176">(</span><span class="ident" id="4913177">state</span><span class="op" id="4913182">,</span>&nbsp;<span class="ident" id="4913184">elemOp</span><span class="op" id="4913190">,</span>&nbsp;<span class="ident" id="4913192">wire</span><span class="op" id="4913196">.</span><span class="ident" id="4913197">ArrayT</span><span class="op" id="4913203">.</span><span class="ident" id="4913204">Len</span><span class="op" id="4913207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913212">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913217">case</span>&nbsp;<span class="ident" id="4913222">wire</span><span class="op" id="4913226">.</span><span class="ident" id="4913227">MapT</span>&nbsp;<span class="op" id="4913232">!=</span>&nbsp;<span class="ident" id="4913235">nil</span><span class="op" id="4913238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913243">keyId</span>&nbsp;<span class="op" id="4913249">:=</span>&nbsp;<span class="ident" id="4913252">dec</span><span class="op" id="4913255">.</span><span class="ident" id="4913256">wireType</span><span class="op" id="4913264">[</span><span class="ident" id="4913265">wireId</span><span class="op" id="4913271">]</span><span class="op" id="4913272">.</span><span class="ident" id="4913273">MapT</span><span class="op" id="4913277">.</span><span class="ident" id="4913278">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913285">elemId</span>&nbsp;<span class="op" id="4913292">:=</span>&nbsp;<span class="ident" id="4913295">dec</span><span class="op" id="4913298">.</span><span class="ident" id="4913299">wireType</span><span class="op" id="4913307">[</span><span class="ident" id="4913308">wireId</span><span class="op" id="4913314">]</span><span class="op" id="4913315">.</span><span class="ident" id="4913316">MapT</span><span class="op" id="4913320">.</span><span class="ident" id="4913321">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913329">keyOp</span>&nbsp;<span class="op" id="4913335">:=</span>&nbsp;<span class="ident" id="4913338">dec</span><span class="op" id="4913341">.</span><span class="ident" id="4913342">decIgnoreOpFor</span><span class="op" id="4913356">(</span><span class="ident" id="4913357">keyId</span><span class="op" id="4913362">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913367">elemOp</span>&nbsp;<span class="op" id="4913374">:=</span>&nbsp;<span class="ident" id="4913377">dec</span><span class="op" id="4913380">.</span><span class="ident" id="4913381">decIgnoreOpFor</span><span class="op" id="4913395">(</span><span class="ident" id="4913396">elemId</span><span class="op" id="4913402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913407">op</span>&nbsp;<span class="op" id="4913410">=</span>&nbsp;<span class="keyword" id="4913412">func</span><span class="op" id="4913416">(</span><span class="ident" id="4913417">i</span>&nbsp;<span class="op" id="4913419">*</span><span class="ident" id="4913420">decInstr</span><span class="op" id="4913428">,</span>&nbsp;<span class="ident" id="4913430">state</span>&nbsp;<span class="op" id="4913436">*</span><span class="ident" id="4913437">decoderState</span><span class="op" id="4913449">,</span>&nbsp;<span class="ident" id="4913451">value</span>&nbsp;<span class="ident" id="4913457">reflect</span><span class="op" id="4913464">.</span><span class="ident" id="4913465">Value</span><span class="op" id="4913470">)</span>&nbsp;<span class="op" id="4913472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913478">state</span><span class="op" id="4913483">.</span><span class="ident" id="4913484">dec</span><span class="op" id="4913487">.</span><span class="ident" id="4913488">ignoreMap</span><span class="op" id="4913497">(</span><span class="ident" id="4913498">state</span><span class="op" id="4913503">,</span>&nbsp;<span class="ident" id="4913505">keyOp</span><span class="op" id="4913510">,</span>&nbsp;<span class="ident" id="4913512">elemOp</span><span class="op" id="4913518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913528">case</span>&nbsp;<span class="ident" id="4913533">wire</span><span class="op" id="4913537">.</span><span class="ident" id="4913538">SliceT</span>&nbsp;<span class="op" id="4913545">!=</span>&nbsp;<span class="ident" id="4913548">nil</span><span class="op" id="4913551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913556">elemId</span>&nbsp;<span class="op" id="4913563">:=</span>&nbsp;<span class="ident" id="4913566">wire</span><span class="op" id="4913570">.</span><span class="ident" id="4913571">SliceT</span><span class="op" id="4913577">.</span><span class="ident" id="4913578">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913586">elemOp</span>&nbsp;<span class="op" id="4913593">:=</span>&nbsp;<span class="ident" id="4913596">dec</span><span class="op" id="4913599">.</span><span class="ident" id="4913600">decIgnoreOpFor</span><span class="op" id="4913614">(</span><span class="ident" id="4913615">elemId</span><span class="op" id="4913621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913626">op</span>&nbsp;<span class="op" id="4913629">=</span>&nbsp;<span class="keyword" id="4913631">func</span><span class="op" id="4913635">(</span><span class="ident" id="4913636">i</span>&nbsp;<span class="op" id="4913638">*</span><span class="ident" id="4913639">decInstr</span><span class="op" id="4913647">,</span>&nbsp;<span class="ident" id="4913649">state</span>&nbsp;<span class="op" id="4913655">*</span><span class="ident" id="4913656">decoderState</span><span class="op" id="4913668">,</span>&nbsp;<span class="ident" id="4913670">value</span>&nbsp;<span class="ident" id="4913676">reflect</span><span class="op" id="4913683">.</span><span class="ident" id="4913684">Value</span><span class="op" id="4913689">)</span>&nbsp;<span class="op" id="4913691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913697">state</span><span class="op" id="4913702">.</span><span class="ident" id="4913703">dec</span><span class="op" id="4913706">.</span><span class="ident" id="4913707">ignoreSlice</span><span class="op" id="4913718">(</span><span class="ident" id="4913719">state</span><span class="op" id="4913724">,</span>&nbsp;<span class="ident" id="4913726">elemOp</span><span class="op" id="4913732">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913742">case</span>&nbsp;<span class="ident" id="4913747">wire</span><span class="op" id="4913751">.</span><span class="ident" id="4913752">StructT</span>&nbsp;<span class="op" id="4913760">!=</span>&nbsp;<span class="ident" id="4913763">nil</span><span class="op" id="4913766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4913771">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913846">enginePtr</span><span class="op" id="4913855">,</span>&nbsp;<span class="ident" id="4913857">err</span>&nbsp;<span class="op" id="4913861">:=</span>&nbsp;<span class="ident" id="4913864">dec</span><span class="op" id="4913867">.</span><span class="ident" id="4913868">getIgnoreEnginePtr</span><span class="op" id="4913886">(</span><span class="ident" id="4913887">wireId</span><span class="op" id="4913893">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913898">if</span>&nbsp;<span class="ident" id="4913901">err</span>&nbsp;<span class="op" id="4913905">!=</span>&nbsp;<span class="ident" id="4913908">nil</span>&nbsp;<span class="op" id="4913912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913918">error_</span><span class="op" id="4913924">(</span><span class="ident" id="4913925">err</span><span class="op" id="4913928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913938">op</span>&nbsp;<span class="op" id="4913941">=</span>&nbsp;<span class="keyword" id="4913943">func</span><span class="op" id="4913947">(</span><span class="ident" id="4913948">i</span>&nbsp;<span class="op" id="4913950">*</span><span class="ident" id="4913951">decInstr</span><span class="op" id="4913959">,</span>&nbsp;<span class="ident" id="4913961">state</span>&nbsp;<span class="op" id="4913967">*</span><span class="ident" id="4913968">decoderState</span><span class="op" id="4913980">,</span>&nbsp;<span class="ident" id="4913982">value</span>&nbsp;<span class="ident" id="4913988">reflect</span><span class="op" id="4913995">.</span><span class="ident" id="4913996">Value</span><span class="op" id="4914001">)</span>&nbsp;<span class="op" id="4914003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914009">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914085">state</span><span class="op" id="4914090">.</span><span class="ident" id="4914091">dec</span><span class="op" id="4914094">.</span><span class="ident" id="4914095">ignoreStruct</span><span class="op" id="4914107">(</span><span class="op" id="4914108">*</span><span class="ident" id="4914109">enginePtr</span><span class="op" id="4914118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914128">case</span>&nbsp;<span class="ident" id="4914133">wire</span><span class="op" id="4914137">.</span><span class="ident" id="4914138">GobEncoderT</span>&nbsp;<span class="op" id="4914150">!=</span>&nbsp;<span class="ident" id="4914153">nil</span><span class="op" id="4914156">,</span>&nbsp;<span class="ident" id="4914158">wire</span><span class="op" id="4914162">.</span><span class="ident" id="4914163">BinaryMarshalerT</span>&nbsp;<span class="op" id="4914180">!=</span>&nbsp;<span class="ident" id="4914183">nil</span><span class="op" id="4914186">,</span>&nbsp;<span class="ident" id="4914188">wire</span><span class="op" id="4914192">.</span><span class="ident" id="4914193">TextMarshalerT</span>&nbsp;<span class="op" id="4914208">!=</span>&nbsp;<span class="ident" id="4914211">nil</span><span class="op" id="4914214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914219">op</span>&nbsp;<span class="op" id="4914222">=</span>&nbsp;<span class="keyword" id="4914224">func</span><span class="op" id="4914228">(</span><span class="ident" id="4914229">i</span>&nbsp;<span class="op" id="4914231">*</span><span class="ident" id="4914232">decInstr</span><span class="op" id="4914240">,</span>&nbsp;<span class="ident" id="4914242">state</span>&nbsp;<span class="op" id="4914248">*</span><span class="ident" id="4914249">decoderState</span><span class="op" id="4914261">,</span>&nbsp;<span class="ident" id="4914263">value</span>&nbsp;<span class="ident" id="4914269">reflect</span><span class="op" id="4914276">.</span><span class="ident" id="4914277">Value</span><span class="op" id="4914282">)</span>&nbsp;<span class="op" id="4914284">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914290">state</span><span class="op" id="4914295">.</span><span class="ident" id="4914296">dec</span><span class="op" id="4914299">.</span><span class="ident" id="4914300">ignoreGobDecoder</span><span class="op" id="4914316">(</span><span class="ident" id="4914317">state</span><span class="op" id="4914322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914337">if</span>&nbsp;<span class="ident" id="4914340">op</span>&nbsp;<span class="op" id="4914343">==</span>&nbsp;<span class="ident" id="4914346">nil</span>&nbsp;<span class="op" id="4914350">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914354">errorf</span><span class="op" id="4914360">(</span><span class="string" id="4914361">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4914400">,</span>&nbsp;<span class="ident" id="4914402">wireId</span><span class="op" id="4914408">.</span><span class="builtintype" id="4914409">string</span><span class="op" id="4914415">(</span><span class="op" id="4914416">)</span><span class="op" id="4914417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914423">return</span>&nbsp;<span class="ident" id="4914430">op</span><br>
<span class="lineno"></span><span class="op" id="4914433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="4914436">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="4914507">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4914522">func</span>&nbsp;<span class="op" id="4914527">(</span><span class="ident" id="4914528">dec</span>&nbsp;<span class="op" id="4914532">*</span><span class="ident" id="4914533">Decoder</span><span class="op" id="4914540">)</span>&nbsp;<span class="ident" id="4914542">gobDecodeOpFor</span><span class="op" id="4914556">(</span><span class="ident" id="4914557">ut</span>&nbsp;<span class="op" id="4914560">*</span><span class="ident" id="4914561">userTypeInfo</span><span class="op" id="4914573">)</span>&nbsp;<span class="op" id="4914575">*</span><span class="ident" id="4914576">decOp</span>&nbsp;<span class="op" id="4914582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914585">rcvrType</span>&nbsp;<span class="op" id="4914594">:=</span>&nbsp;<span class="ident" id="4914597">ut</span><span class="op" id="4914599">.</span><span class="ident" id="4914600">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914606">if</span>&nbsp;<span class="ident" id="4914609">ut</span><span class="op" id="4914611">.</span><span class="ident" id="4914612">decIndir</span>&nbsp;<span class="op" id="4914621">==</span>&nbsp;<span class="op" id="4914624">-</span><span class="num" id="4914625">1</span>&nbsp;<span class="op" id="4914627">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914631">rcvrType</span>&nbsp;<span class="op" id="4914640">=</span>&nbsp;<span class="ident" id="4914642">reflect</span><span class="op" id="4914649">.</span><span class="ident" id="4914650">PtrTo</span><span class="op" id="4914655">(</span><span class="ident" id="4914656">rcvrType</span><span class="op" id="4914664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914667">}</span>&nbsp;<span class="keyword" id="4914669">else</span>&nbsp;<span class="keyword" id="4914674">if</span>&nbsp;<span class="ident" id="4914677">ut</span><span class="op" id="4914679">.</span><span class="ident" id="4914680">decIndir</span>&nbsp;<span class="op" id="4914689">&gt;</span>&nbsp;<span class="num" id="4914691">0</span>&nbsp;<span class="op" id="4914693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914697">for</span>&nbsp;<span class="ident" id="4914701">i</span>&nbsp;<span class="op" id="4914703">:=</span>&nbsp;<span class="builtintype" id="4914706">int8</span><span class="op" id="4914710">(</span><span class="num" id="4914711">0</span><span class="op" id="4914712">)</span><span class="op" id="4914713">;</span>&nbsp;<span class="ident" id="4914715">i</span>&nbsp;<span class="op" id="4914717">&lt;</span>&nbsp;<span class="ident" id="4914719">ut</span><span class="op" id="4914721">.</span><span class="ident" id="4914722">decIndir</span><span class="op" id="4914730">;</span>&nbsp;<span class="ident" id="4914732">i</span><span class="op" id="4914733">++</span>&nbsp;<span class="op" id="4914736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914741">rcvrType</span>&nbsp;<span class="op" id="4914750">=</span>&nbsp;<span class="ident" id="4914752">rcvrType</span><span class="op" id="4914760">.</span><span class="ident" id="4914761">Elem</span><span class="op" id="4914765">(</span><span class="op" id="4914766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914770">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914776">var</span>&nbsp;<span class="ident" id="4914780">op</span>&nbsp;<span class="ident" id="4914783">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914790">op</span>&nbsp;<span class="op" id="4914793">=</span>&nbsp;<span class="keyword" id="4914795">func</span><span class="op" id="4914799">(</span><span class="ident" id="4914800">i</span>&nbsp;<span class="op" id="4914802">*</span><span class="ident" id="4914803">decInstr</span><span class="op" id="4914811">,</span>&nbsp;<span class="ident" id="4914813">state</span>&nbsp;<span class="op" id="4914819">*</span><span class="ident" id="4914820">decoderState</span><span class="op" id="4914832">,</span>&nbsp;<span class="ident" id="4914834">value</span>&nbsp;<span class="ident" id="4914840">reflect</span><span class="op" id="4914847">.</span><span class="ident" id="4914848">Value</span><span class="op" id="4914853">)</span>&nbsp;<span class="op" id="4914855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914859">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914941">if</span>&nbsp;<span class="ident" id="4914944">value</span><span class="op" id="4914949">.</span><span class="ident" id="4914950">Kind</span><span class="op" id="4914954">(</span><span class="op" id="4914955">)</span>&nbsp;<span class="op" id="4914957">!=</span>&nbsp;<span class="ident" id="4914960">reflect</span><span class="op" id="4914967">.</span><span class="ident" id="4914968">Ptr</span>&nbsp;<span class="op" id="4914972">&amp;&amp;</span>&nbsp;<span class="ident" id="4914975">rcvrType</span><span class="op" id="4914983">.</span><span class="ident" id="4914984">Kind</span><span class="op" id="4914988">(</span><span class="op" id="4914989">)</span>&nbsp;<span class="op" id="4914991">==</span>&nbsp;<span class="ident" id="4914994">reflect</span><span class="op" id="4915001">.</span><span class="ident" id="4915002">Ptr</span>&nbsp;<span class="op" id="4915006">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915011">value</span>&nbsp;<span class="op" id="4915017">=</span>&nbsp;<span class="ident" id="4915019">value</span><span class="op" id="4915024">.</span><span class="ident" id="4915025">Addr</span><span class="op" id="4915029">(</span><span class="op" id="4915030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915038">state</span><span class="op" id="4915043">.</span><span class="ident" id="4915044">dec</span><span class="op" id="4915047">.</span><span class="ident" id="4915048">decodeGobDecoder</span><span class="op" id="4915064">(</span><span class="ident" id="4915065">ut</span><span class="op" id="4915067">,</span>&nbsp;<span class="ident" id="4915069">state</span><span class="op" id="4915074">,</span>&nbsp;<span class="ident" id="4915076">value</span><span class="op" id="4915081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915087">return</span>&nbsp;<span class="op" id="4915094">&amp;</span><span class="ident" id="4915095">op</span><br>
<span class="lineno">925</span><span class="op" id="4915098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4915101">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="4915161">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="4915232">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="4915261">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="4915321">func</span>&nbsp;<span class="op" id="4915326">(</span><span class="ident" id="4915327">dec</span>&nbsp;<span class="op" id="4915331">*</span><span class="ident" id="4915332">Decoder</span><span class="op" id="4915339">)</span>&nbsp;<span class="ident" id="4915341">compatibleType</span><span class="op" id="4915355">(</span><span class="ident" id="4915356">fr</span>&nbsp;<span class="ident" id="4915359">reflect</span><span class="op" id="4915366">.</span><span class="ident" id="4915367">Type</span><span class="op" id="4915371">,</span>&nbsp;<span class="ident" id="4915373">fw</span>&nbsp;<span class="ident" id="4915376">typeId</span><span class="op" id="4915382">,</span>&nbsp;<span class="ident" id="4915384">inProgress</span>&nbsp;<span class="keyword" id="4915395">map</span><span class="op" id="4915398">[</span><span class="ident" id="4915399">reflect</span><span class="op" id="4915406">.</span><span class="ident" id="4915407">Type</span><span class="op" id="4915411">]</span><span class="ident" id="4915412">typeId</span><span class="op" id="4915418">)</span>&nbsp;<span class="builtintype" id="4915420">bool</span>&nbsp;<span class="op" id="4915425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915428">if</span>&nbsp;<span class="ident" id="4915431">rhs</span><span class="op" id="4915434">,</span>&nbsp;<span class="ident" id="4915436">ok</span>&nbsp;<span class="op" id="4915439">:=</span>&nbsp;<span class="ident" id="4915442">inProgress</span><span class="op" id="4915452">[</span><span class="ident" id="4915453">fr</span><span class="op" id="4915455">]</span><span class="op" id="4915456">;</span>&nbsp;<span class="ident" id="4915458">ok</span>&nbsp;<span class="op" id="4915461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915465">return</span>&nbsp;<span class="ident" id="4915472">rhs</span>&nbsp;<span class="op" id="4915476">==</span>&nbsp;<span class="ident" id="4915479">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915483">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915486">inProgress</span><span class="op" id="4915496">[</span><span class="ident" id="4915497">fr</span><span class="op" id="4915499">]</span>&nbsp;<span class="op" id="4915501">=</span>&nbsp;<span class="ident" id="4915503">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915507">ut</span>&nbsp;<span class="op" id="4915510">:=</span>&nbsp;<span class="ident" id="4915513">userType</span><span class="op" id="4915521">(</span><span class="ident" id="4915522">fr</span><span class="op" id="4915524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915527">wire</span><span class="op" id="4915531">,</span>&nbsp;<span class="ident" id="4915533">ok</span>&nbsp;<span class="op" id="4915536">:=</span>&nbsp;<span class="ident" id="4915539">dec</span><span class="op" id="4915542">.</span><span class="ident" id="4915543">wireType</span><span class="op" id="4915551">[</span><span class="ident" id="4915552">fw</span><span class="op" id="4915554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915557">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915632">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915661">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915707">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915777">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915840">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915886">if</span>&nbsp;<span class="op" id="4915889">(</span><span class="ident" id="4915890">ut</span><span class="op" id="4915892">.</span><span class="ident" id="4915893">externalDec</span>&nbsp;<span class="op" id="4915905">==</span>&nbsp;<span class="ident" id="4915908">xGob</span><span class="op" id="4915912">)</span>&nbsp;<span class="op" id="4915914">!=</span>&nbsp;<span class="op" id="4915917">(</span><span class="ident" id="4915918">ok</span>&nbsp;<span class="op" id="4915921">&amp;&amp;</span>&nbsp;<span class="ident" id="4915924">wire</span><span class="op" id="4915928">.</span><span class="ident" id="4915929">GobEncoderT</span>&nbsp;<span class="op" id="4915941">!=</span>&nbsp;<span class="ident" id="4915944">nil</span><span class="op" id="4915947">)</span>&nbsp;<span class="op" id="4915949">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915954">(</span><span class="ident" id="4915955">ut</span><span class="op" id="4915957">.</span><span class="ident" id="4915958">externalDec</span>&nbsp;<span class="op" id="4915970">==</span>&nbsp;<span class="ident" id="4915973">xBinary</span><span class="op" id="4915980">)</span>&nbsp;<span class="op" id="4915982">!=</span>&nbsp;<span class="op" id="4915985">(</span><span class="ident" id="4915986">ok</span>&nbsp;<span class="op" id="4915989">&amp;&amp;</span>&nbsp;<span class="ident" id="4915992">wire</span><span class="op" id="4915996">.</span><span class="ident" id="4915997">BinaryMarshalerT</span>&nbsp;<span class="op" id="4916014">!=</span>&nbsp;<span class="ident" id="4916017">nil</span><span class="op" id="4916020">)</span>&nbsp;<span class="op" id="4916022">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916027">(</span><span class="ident" id="4916028">ut</span><span class="op" id="4916030">.</span><span class="ident" id="4916031">externalDec</span>&nbsp;<span class="op" id="4916043">==</span>&nbsp;<span class="ident" id="4916046">xText</span><span class="op" id="4916051">)</span>&nbsp;<span class="op" id="4916053">!=</span>&nbsp;<span class="op" id="4916056">(</span><span class="ident" id="4916057">ok</span>&nbsp;<span class="op" id="4916060">&amp;&amp;</span>&nbsp;<span class="ident" id="4916063">wire</span><span class="op" id="4916067">.</span><span class="ident" id="4916068">TextMarshalerT</span>&nbsp;<span class="op" id="4916083">!=</span>&nbsp;<span class="ident" id="4916086">nil</span><span class="op" id="4916089">)</span>&nbsp;<span class="op" id="4916091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916095">return</span>&nbsp;<span class="builtintype" id="4916102">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916112">if</span>&nbsp;<span class="ident" id="4916115">ut</span><span class="op" id="4916117">.</span><span class="ident" id="4916118">externalDec</span>&nbsp;<span class="op" id="4916130">!=</span>&nbsp;<span class="num" id="4916133">0</span>&nbsp;<span class="op" id="4916135">{</span>&nbsp;<span class="comment" id="4916137">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916171">return</span>&nbsp;<span class="builtintype" id="4916178">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916187">switch</span>&nbsp;<span class="ident" id="4916194">t</span>&nbsp;<span class="op" id="4916196">:=</span>&nbsp;<span class="ident" id="4916199">ut</span><span class="op" id="4916201">.</span><span class="ident" id="4916202">base</span><span class="op" id="4916206">;</span>&nbsp;<span class="ident" id="4916208">t</span><span class="op" id="4916209">.</span><span class="ident" id="4916210">Kind</span><span class="op" id="4916214">(</span><span class="op" id="4916215">)</span>&nbsp;<span class="op" id="4916217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916220">default</span><span class="op" id="4916227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916231">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916262">return</span>&nbsp;<span class="builtintype" id="4916269">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916276">case</span>&nbsp;<span class="ident" id="4916281">reflect</span><span class="op" id="4916288">.</span><span class="ident" id="4916289">Bool</span><span class="op" id="4916293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916297">return</span>&nbsp;<span class="ident" id="4916304">fw</span>&nbsp;<span class="op" id="4916307">==</span>&nbsp;<span class="ident" id="4916310">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916317">case</span>&nbsp;<span class="ident" id="4916322">reflect</span><span class="op" id="4916329">.</span><span class="ident" id="4916330">Int</span><span class="op" id="4916333">,</span>&nbsp;<span class="ident" id="4916335">reflect</span><span class="op" id="4916342">.</span><span class="ident" id="4916343">Int8</span><span class="op" id="4916347">,</span>&nbsp;<span class="ident" id="4916349">reflect</span><span class="op" id="4916356">.</span><span class="ident" id="4916357">Int16</span><span class="op" id="4916362">,</span>&nbsp;<span class="ident" id="4916364">reflect</span><span class="op" id="4916371">.</span><span class="ident" id="4916372">Int32</span><span class="op" id="4916377">,</span>&nbsp;<span class="ident" id="4916379">reflect</span><span class="op" id="4916386">.</span><span class="ident" id="4916387">Int64</span><span class="op" id="4916392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916396">return</span>&nbsp;<span class="ident" id="4916403">fw</span>&nbsp;<span class="op" id="4916406">==</span>&nbsp;<span class="ident" id="4916409">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916415">case</span>&nbsp;<span class="ident" id="4916420">reflect</span><span class="op" id="4916427">.</span><span class="ident" id="4916428">Uint</span><span class="op" id="4916432">,</span>&nbsp;<span class="ident" id="4916434">reflect</span><span class="op" id="4916441">.</span><span class="ident" id="4916442">Uint8</span><span class="op" id="4916447">,</span>&nbsp;<span class="ident" id="4916449">reflect</span><span class="op" id="4916456">.</span><span class="ident" id="4916457">Uint16</span><span class="op" id="4916463">,</span>&nbsp;<span class="ident" id="4916465">reflect</span><span class="op" id="4916472">.</span><span class="ident" id="4916473">Uint32</span><span class="op" id="4916479">,</span>&nbsp;<span class="ident" id="4916481">reflect</span><span class="op" id="4916488">.</span><span class="ident" id="4916489">Uint64</span><span class="op" id="4916495">,</span>&nbsp;<span class="ident" id="4916497">reflect</span><span class="op" id="4916504">.</span><span class="ident" id="4916505">Uintptr</span><span class="op" id="4916512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916516">return</span>&nbsp;<span class="ident" id="4916523">fw</span>&nbsp;<span class="op" id="4916526">==</span>&nbsp;<span class="ident" id="4916529">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916536">case</span>&nbsp;<span class="ident" id="4916541">reflect</span><span class="op" id="4916548">.</span><span class="ident" id="4916549">Float32</span><span class="op" id="4916556">,</span>&nbsp;<span class="ident" id="4916558">reflect</span><span class="op" id="4916565">.</span><span class="ident" id="4916566">Float64</span><span class="op" id="4916573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916577">return</span>&nbsp;<span class="ident" id="4916584">fw</span>&nbsp;<span class="op" id="4916587">==</span>&nbsp;<span class="ident" id="4916590">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916598">case</span>&nbsp;<span class="ident" id="4916603">reflect</span><span class="op" id="4916610">.</span><span class="ident" id="4916611">Complex64</span><span class="op" id="4916620">,</span>&nbsp;<span class="ident" id="4916622">reflect</span><span class="op" id="4916629">.</span><span class="ident" id="4916630">Complex128</span><span class="op" id="4916640">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916644">return</span>&nbsp;<span class="ident" id="4916651">fw</span>&nbsp;<span class="op" id="4916654">==</span>&nbsp;<span class="ident" id="4916657">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916667">case</span>&nbsp;<span class="ident" id="4916672">reflect</span><span class="op" id="4916679">.</span><span class="ident" id="4916680">String</span><span class="op" id="4916686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916690">return</span>&nbsp;<span class="ident" id="4916697">fw</span>&nbsp;<span class="op" id="4916700">==</span>&nbsp;<span class="ident" id="4916703">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916712">case</span>&nbsp;<span class="ident" id="4916717">reflect</span><span class="op" id="4916724">.</span><span class="ident" id="4916725">Interface</span><span class="op" id="4916734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916738">return</span>&nbsp;<span class="ident" id="4916745">fw</span>&nbsp;<span class="op" id="4916748">==</span>&nbsp;<span class="ident" id="4916751">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916763">case</span>&nbsp;<span class="ident" id="4916768">reflect</span><span class="op" id="4916775">.</span><span class="ident" id="4916776">Array</span><span class="op" id="4916781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916785">if</span>&nbsp;<span class="op" id="4916788">!</span><span class="ident" id="4916789">ok</span>&nbsp;<span class="op" id="4916792">||</span>&nbsp;<span class="ident" id="4916795">wire</span><span class="op" id="4916799">.</span><span class="ident" id="4916800">ArrayT</span>&nbsp;<span class="op" id="4916807">==</span>&nbsp;<span class="ident" id="4916810">nil</span>&nbsp;<span class="op" id="4916814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916819">return</span>&nbsp;<span class="builtintype" id="4916826">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916838">array</span>&nbsp;<span class="op" id="4916844">:=</span>&nbsp;<span class="ident" id="4916847">wire</span><span class="op" id="4916851">.</span><span class="ident" id="4916852">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916861">return</span>&nbsp;<span class="ident" id="4916868">t</span><span class="op" id="4916869">.</span><span class="ident" id="4916870">Len</span><span class="op" id="4916873">(</span><span class="op" id="4916874">)</span>&nbsp;<span class="op" id="4916876">==</span>&nbsp;<span class="ident" id="4916879">array</span><span class="op" id="4916884">.</span><span class="ident" id="4916885">Len</span>&nbsp;<span class="op" id="4916889">&amp;&amp;</span>&nbsp;<span class="ident" id="4916892">dec</span><span class="op" id="4916895">.</span><span class="ident" id="4916896">compatibleType</span><span class="op" id="4916910">(</span><span class="ident" id="4916911">t</span><span class="op" id="4916912">.</span><span class="ident" id="4916913">Elem</span><span class="op" id="4916917">(</span><span class="op" id="4916918">)</span><span class="op" id="4916919">,</span>&nbsp;<span class="ident" id="4916921">array</span><span class="op" id="4916926">.</span><span class="ident" id="4916927">Elem</span><span class="op" id="4916931">,</span>&nbsp;<span class="ident" id="4916933">inProgress</span><span class="op" id="4916943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916946">case</span>&nbsp;<span class="ident" id="4916951">reflect</span><span class="op" id="4916958">.</span><span class="ident" id="4916959">Map</span><span class="op" id="4916962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916966">if</span>&nbsp;<span class="op" id="4916969">!</span><span class="ident" id="4916970">ok</span>&nbsp;<span class="op" id="4916973">||</span>&nbsp;<span class="ident" id="4916976">wire</span><span class="op" id="4916980">.</span><span class="ident" id="4916981">MapT</span>&nbsp;<span class="op" id="4916986">==</span>&nbsp;<span class="ident" id="4916989">nil</span>&nbsp;<span class="op" id="4916993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916998">return</span>&nbsp;<span class="builtintype" id="4917005">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917013">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917017">MapType</span>&nbsp;<span class="op" id="4917025">:=</span>&nbsp;<span class="ident" id="4917028">wire</span><span class="op" id="4917032">.</span><span class="ident" id="4917033">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917040">return</span>&nbsp;<span class="ident" id="4917047">dec</span><span class="op" id="4917050">.</span><span class="ident" id="4917051">compatibleType</span><span class="op" id="4917065">(</span><span class="ident" id="4917066">t</span><span class="op" id="4917067">.</span><span class="ident" id="4917068">Key</span><span class="op" id="4917071">(</span><span class="op" id="4917072">)</span><span class="op" id="4917073">,</span>&nbsp;<span class="ident" id="4917075">MapType</span><span class="op" id="4917082">.</span><span class="ident" id="4917083">Key</span><span class="op" id="4917086">,</span>&nbsp;<span class="ident" id="4917088">inProgress</span><span class="op" id="4917098">)</span>&nbsp;<span class="op" id="4917100">&amp;&amp;</span>&nbsp;<span class="ident" id="4917103">dec</span><span class="op" id="4917106">.</span><span class="ident" id="4917107">compatibleType</span><span class="op" id="4917121">(</span><span class="ident" id="4917122">t</span><span class="op" id="4917123">.</span><span class="ident" id="4917124">Elem</span><span class="op" id="4917128">(</span><span class="op" id="4917129">)</span><span class="op" id="4917130">,</span>&nbsp;<span class="ident" id="4917132">MapType</span><span class="op" id="4917139">.</span><span class="ident" id="4917140">Elem</span><span class="op" id="4917144">,</span>&nbsp;<span class="ident" id="4917146">inProgress</span><span class="op" id="4917156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917159">case</span>&nbsp;<span class="ident" id="4917164">reflect</span><span class="op" id="4917171">.</span><span class="ident" id="4917172">Slice</span><span class="op" id="4917177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917181">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917211">if</span>&nbsp;<span class="ident" id="4917214">t</span><span class="op" id="4917215">.</span><span class="ident" id="4917216">Elem</span><span class="op" id="4917220">(</span><span class="op" id="4917221">)</span><span class="op" id="4917222">.</span><span class="ident" id="4917223">Kind</span><span class="op" id="4917227">(</span><span class="op" id="4917228">)</span>&nbsp;<span class="op" id="4917230">==</span>&nbsp;<span class="ident" id="4917233">reflect</span><span class="op" id="4917240">.</span><span class="ident" id="4917241">Uint8</span>&nbsp;<span class="op" id="4917247">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917252">return</span>&nbsp;<span class="ident" id="4917259">fw</span>&nbsp;<span class="op" id="4917262">==</span>&nbsp;<span class="ident" id="4917265">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917278">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917318">var</span>&nbsp;<span class="ident" id="4917322">sw</span>&nbsp;<span class="op" id="4917325">*</span><span class="ident" id="4917326">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917338">if</span>&nbsp;<span class="ident" id="4917341">tt</span><span class="op" id="4917343">,</span>&nbsp;<span class="ident" id="4917345">ok</span>&nbsp;<span class="op" id="4917348">:=</span>&nbsp;<span class="ident" id="4917351">builtinIdToType</span><span class="op" id="4917366">[</span><span class="ident" id="4917367">fw</span><span class="op" id="4917369">]</span><span class="op" id="4917370">;</span>&nbsp;<span class="ident" id="4917372">ok</span>&nbsp;<span class="op" id="4917375">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917380">sw</span><span class="op" id="4917382">,</span>&nbsp;<span class="ident" id="4917384">_</span>&nbsp;<span class="op" id="4917386">=</span>&nbsp;<span class="ident" id="4917388">tt</span><span class="op" id="4917390">.</span><span class="op" id="4917391">(</span><span class="op" id="4917392">*</span><span class="ident" id="4917393">sliceType</span><span class="op" id="4917402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917406">}</span>&nbsp;<span class="keyword" id="4917408">else</span>&nbsp;<span class="keyword" id="4917413">if</span>&nbsp;<span class="ident" id="4917416">wire</span>&nbsp;<span class="op" id="4917421">!=</span>&nbsp;<span class="ident" id="4917424">nil</span>&nbsp;<span class="op" id="4917428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917433">sw</span>&nbsp;<span class="op" id="4917436">=</span>&nbsp;<span class="ident" id="4917438">wire</span><span class="op" id="4917442">.</span><span class="ident" id="4917443">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917456">elem</span>&nbsp;<span class="op" id="4917461">:=</span>&nbsp;<span class="ident" id="4917464">userType</span><span class="op" id="4917472">(</span><span class="ident" id="4917473">t</span><span class="op" id="4917474">.</span><span class="ident" id="4917475">Elem</span><span class="op" id="4917479">(</span><span class="op" id="4917480">)</span><span class="op" id="4917481">)</span><span class="op" id="4917482">.</span><span class="ident" id="4917483">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917490">return</span>&nbsp;<span class="ident" id="4917497">sw</span>&nbsp;<span class="op" id="4917500">!=</span>&nbsp;<span class="ident" id="4917503">nil</span>&nbsp;<span class="op" id="4917507">&amp;&amp;</span>&nbsp;<span class="ident" id="4917510">dec</span><span class="op" id="4917513">.</span><span class="ident" id="4917514">compatibleType</span><span class="op" id="4917528">(</span><span class="ident" id="4917529">elem</span><span class="op" id="4917533">,</span>&nbsp;<span class="ident" id="4917535">sw</span><span class="op" id="4917537">.</span><span class="ident" id="4917538">Elem</span><span class="op" id="4917542">,</span>&nbsp;<span class="ident" id="4917544">inProgress</span><span class="op" id="4917554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917557">case</span>&nbsp;<span class="ident" id="4917562">reflect</span><span class="op" id="4917569">.</span><span class="ident" id="4917570">Struct</span><span class="op" id="4917576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917580">return</span>&nbsp;<span class="builtintype" id="4917587">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917593">}</span><br>
<span class="lineno"></span><span class="op" id="4917595">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="4917598">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="4917685">func</span>&nbsp;<span class="op" id="4917690">(</span><span class="ident" id="4917691">dec</span>&nbsp;<span class="op" id="4917695">*</span><span class="ident" id="4917696">Decoder</span><span class="op" id="4917703">)</span>&nbsp;<span class="ident" id="4917705">typeString</span><span class="op" id="4917715">(</span><span class="ident" id="4917716">remoteId</span>&nbsp;<span class="ident" id="4917725">typeId</span><span class="op" id="4917731">)</span>&nbsp;<span class="builtintype" id="4917733">string</span>&nbsp;<span class="op" id="4917740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917743">if</span>&nbsp;<span class="ident" id="4917746">t</span>&nbsp;<span class="op" id="4917748">:=</span>&nbsp;<span class="ident" id="4917751">idToType</span><span class="op" id="4917759">[</span><span class="ident" id="4917760">remoteId</span><span class="op" id="4917768">]</span><span class="op" id="4917769">;</span>&nbsp;<span class="ident" id="4917771">t</span>&nbsp;<span class="op" id="4917773">!=</span>&nbsp;<span class="ident" id="4917776">nil</span>&nbsp;<span class="op" id="4917780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917784">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917810">return</span>&nbsp;<span class="ident" id="4917817">t</span><span class="op" id="4917818">.</span><span class="builtintype" id="4917819">string</span><span class="op" id="4917825">(</span><span class="op" id="4917826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917832">return</span>&nbsp;<span class="ident" id="4917839">dec</span><span class="op" id="4917842">.</span><span class="ident" id="4917843">wireType</span><span class="op" id="4917851">[</span><span class="ident" id="4917852">remoteId</span><span class="op" id="4917860">]</span><span class="op" id="4917861">.</span><span class="builtintype" id="4917862">string</span><span class="op" id="4917868">(</span><span class="op" id="4917869">)</span><br>
<span class="lineno"></span><span class="op" id="4917871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="4917874">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="4917963">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="4917979">func</span>&nbsp;<span class="op" id="4917984">(</span><span class="ident" id="4917985">dec</span>&nbsp;<span class="op" id="4917989">*</span><span class="ident" id="4917990">Decoder</span><span class="op" id="4917997">)</span>&nbsp;<span class="ident" id="4917999">compileSingle</span><span class="op" id="4918012">(</span><span class="ident" id="4918013">remoteId</span>&nbsp;<span class="ident" id="4918022">typeId</span><span class="op" id="4918028">,</span>&nbsp;<span class="ident" id="4918030">ut</span>&nbsp;<span class="op" id="4918033">*</span><span class="ident" id="4918034">userTypeInfo</span><span class="op" id="4918046">)</span>&nbsp;<span class="op" id="4918048">(</span><span class="ident" id="4918049">engine</span>&nbsp;<span class="op" id="4918056">*</span><span class="ident" id="4918057">decEngine</span><span class="op" id="4918066">,</span>&nbsp;<span class="ident" id="4918068">err</span>&nbsp;<span class="builtintype" id="4918072">error</span><span class="op" id="4918077">)</span>&nbsp;<span class="op" id="4918079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918082">rt</span>&nbsp;<span class="op" id="4918085">:=</span>&nbsp;<span class="ident" id="4918088">ut</span><span class="op" id="4918090">.</span><span class="ident" id="4918091">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918097">engine</span>&nbsp;<span class="op" id="4918104">=</span>&nbsp;<span class="builtinfunc" id="4918106">new</span><span class="op" id="4918109">(</span><span class="ident" id="4918110">decEngine</span><span class="op" id="4918119">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918122">engine</span><span class="op" id="4918128">.</span><span class="ident" id="4918129">instr</span>&nbsp;<span class="op" id="4918135">=</span>&nbsp;<span class="builtinfunc" id="4918137">make</span><span class="op" id="4918141">(</span><span class="op" id="4918142">[</span><span class="op" id="4918143">]</span><span class="ident" id="4918144">decInstr</span><span class="op" id="4918152">,</span>&nbsp;<span class="num" id="4918154">1</span><span class="op" id="4918155">)</span>&nbsp;<span class="comment" id="4918157">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918170">name</span>&nbsp;<span class="op" id="4918175">:=</span>&nbsp;<span class="ident" id="4918178">rt</span><span class="op" id="4918180">.</span><span class="ident" id="4918181">String</span><span class="op" id="4918187">(</span><span class="op" id="4918188">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918205">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918224">if</span>&nbsp;<span class="op" id="4918227">!</span><span class="ident" id="4918228">dec</span><span class="op" id="4918231">.</span><span class="ident" id="4918232">compatibleType</span><span class="op" id="4918246">(</span><span class="ident" id="4918247">rt</span><span class="op" id="4918249">,</span>&nbsp;<span class="ident" id="4918251">remoteId</span><span class="op" id="4918259">,</span>&nbsp;<span class="builtinfunc" id="4918261">make</span><span class="op" id="4918265">(</span><span class="keyword" id="4918266">map</span><span class="op" id="4918269">[</span><span class="ident" id="4918270">reflect</span><span class="op" id="4918277">.</span><span class="ident" id="4918278">Type</span><span class="op" id="4918282">]</span><span class="ident" id="4918283">typeId</span><span class="op" id="4918289">)</span><span class="op" id="4918290">)</span>&nbsp;<span class="op" id="4918292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918296">remoteType</span>&nbsp;<span class="op" id="4918307">:=</span>&nbsp;<span class="ident" id="4918310">dec</span><span class="op" id="4918313">.</span><span class="ident" id="4918314">typeString</span><span class="op" id="4918324">(</span><span class="ident" id="4918325">remoteId</span><span class="op" id="4918333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918337">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918409">if</span>&nbsp;<span class="ident" id="4918412">ut</span><span class="op" id="4918414">.</span><span class="ident" id="4918415">base</span><span class="op" id="4918419">.</span><span class="ident" id="4918420">Kind</span><span class="op" id="4918424">(</span><span class="op" id="4918425">)</span>&nbsp;<span class="op" id="4918427">==</span>&nbsp;<span class="ident" id="4918430">reflect</span><span class="op" id="4918437">.</span><span class="ident" id="4918438">Interface</span>&nbsp;<span class="op" id="4918448">&amp;&amp;</span>&nbsp;<span class="ident" id="4918451">remoteId</span>&nbsp;<span class="op" id="4918460">!=</span>&nbsp;<span class="ident" id="4918463">tInterface</span>&nbsp;<span class="op" id="4918474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918479">return</span>&nbsp;<span class="ident" id="4918486">nil</span><span class="op" id="4918489">,</span>&nbsp;<span class="ident" id="4918491">errors</span><span class="op" id="4918497">.</span><span class="ident" id="4918498">New</span><span class="op" id="4918501">(</span><span class="string" id="4918502">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4918531">+</span>&nbsp;<span class="ident" id="4918533">name</span>&nbsp;<span class="op" id="4918538">+</span>&nbsp;<span class="string" id="4918540">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4918615">+</span>&nbsp;<span class="ident" id="4918617">remoteType</span><span class="op" id="4918627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918635">return</span>&nbsp;<span class="ident" id="4918642">nil</span><span class="op" id="4918645">,</span>&nbsp;<span class="ident" id="4918647">errors</span><span class="op" id="4918653">.</span><span class="ident" id="4918654">New</span><span class="op" id="4918657">(</span><span class="string" id="4918658">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4918691">+</span>&nbsp;<span class="ident" id="4918693">name</span>&nbsp;<span class="op" id="4918698">+</span>&nbsp;<span class="string" id="4918700">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4918726">+</span>&nbsp;<span class="ident" id="4918728">remoteType</span><span class="op" id="4918738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918741">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918744">op</span>&nbsp;<span class="op" id="4918747">:=</span>&nbsp;<span class="ident" id="4918750">dec</span><span class="op" id="4918753">.</span><span class="ident" id="4918754">decOpFor</span><span class="op" id="4918762">(</span><span class="ident" id="4918763">remoteId</span><span class="op" id="4918771">,</span>&nbsp;<span class="ident" id="4918773">rt</span><span class="op" id="4918775">,</span>&nbsp;<span class="ident" id="4918777">name</span><span class="op" id="4918781">,</span>&nbsp;<span class="builtinfunc" id="4918783">make</span><span class="op" id="4918787">(</span><span class="keyword" id="4918788">map</span><span class="op" id="4918791">[</span><span class="ident" id="4918792">reflect</span><span class="op" id="4918799">.</span><span class="ident" id="4918800">Type</span><span class="op" id="4918804">]</span><span class="op" id="4918805">*</span><span class="ident" id="4918806">decOp</span><span class="op" id="4918811">)</span><span class="op" id="4918812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918815">ovfl</span>&nbsp;<span class="op" id="4918820">:=</span>&nbsp;<span class="ident" id="4918823">errors</span><span class="op" id="4918829">.</span><span class="ident" id="4918830">New</span><span class="op" id="4918833">(</span><span class="string" id="4918834">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4918848">+</span>&nbsp;<span class="ident" id="4918850">name</span>&nbsp;<span class="op" id="4918855">+</span>&nbsp;<span class="string" id="4918857">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4918873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918876">engine</span><span class="op" id="4918882">.</span><span class="ident" id="4918883">instr</span><span class="op" id="4918888">[</span><span class="ident" id="4918889">singletonField</span><span class="op" id="4918903">]</span>&nbsp;<span class="op" id="4918905">=</span>&nbsp;<span class="ident" id="4918907">decInstr</span><span class="op" id="4918915">{</span><span class="op" id="4918916">*</span><span class="ident" id="4918917">op</span><span class="op" id="4918919">,</span>&nbsp;<span class="ident" id="4918921">singletonField</span><span class="op" id="4918935">,</span>&nbsp;<span class="ident" id="4918937">nil</span><span class="op" id="4918940">,</span>&nbsp;<span class="ident" id="4918942">ovfl</span><span class="op" id="4918946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918949">engine</span><span class="op" id="4918955">.</span><span class="ident" id="4918956">numInstr</span>&nbsp;<span class="op" id="4918965">=</span>&nbsp;<span class="num" id="4918967">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918970">return</span><br>
<span class="lineno">1030</span><span class="op" id="4918977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4918980">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4919088">func</span>&nbsp;<span class="op" id="4919093">(</span><span class="ident" id="4919094">dec</span>&nbsp;<span class="op" id="4919098">*</span><span class="ident" id="4919099">Decoder</span><span class="op" id="4919106">)</span>&nbsp;<span class="ident" id="4919108">compileIgnoreSingle</span><span class="op" id="4919127">(</span><span class="ident" id="4919128">remoteId</span>&nbsp;<span class="ident" id="4919137">typeId</span><span class="op" id="4919143">)</span>&nbsp;<span class="op" id="4919145">(</span><span class="ident" id="4919146">engine</span>&nbsp;<span class="op" id="4919153">*</span><span class="ident" id="4919154">decEngine</span><span class="op" id="4919163">,</span>&nbsp;<span class="ident" id="4919165">err</span>&nbsp;<span class="builtintype" id="4919169">error</span><span class="op" id="4919174">)</span>&nbsp;<span class="op" id="4919176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919179">engine</span>&nbsp;<span class="op" id="4919186">=</span>&nbsp;<span class="builtinfunc" id="4919188">new</span><span class="op" id="4919191">(</span><span class="ident" id="4919192">decEngine</span><span class="op" id="4919201">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919204">engine</span><span class="op" id="4919210">.</span><span class="ident" id="4919211">instr</span>&nbsp;<span class="op" id="4919217">=</span>&nbsp;<span class="builtinfunc" id="4919219">make</span><span class="op" id="4919223">(</span><span class="op" id="4919224">[</span><span class="op" id="4919225">]</span><span class="ident" id="4919226">decInstr</span><span class="op" id="4919234">,</span>&nbsp;<span class="num" id="4919236">1</span><span class="op" id="4919237">)</span>&nbsp;<span class="comment" id="4919239">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919252">op</span>&nbsp;<span class="op" id="4919255">:=</span>&nbsp;<span class="ident" id="4919258">dec</span><span class="op" id="4919261">.</span><span class="ident" id="4919262">decIgnoreOpFor</span><span class="op" id="4919276">(</span><span class="ident" id="4919277">remoteId</span><span class="op" id="4919285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919288">ovfl</span>&nbsp;<span class="op" id="4919293">:=</span>&nbsp;<span class="ident" id="4919296">overflow</span><span class="op" id="4919304">(</span><span class="ident" id="4919305">dec</span><span class="op" id="4919308">.</span><span class="ident" id="4919309">typeString</span><span class="op" id="4919319">(</span><span class="ident" id="4919320">remoteId</span><span class="op" id="4919328">)</span><span class="op" id="4919329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919332">engine</span><span class="op" id="4919338">.</span><span class="ident" id="4919339">instr</span><span class="op" id="4919344">[</span><span class="num" id="4919345">0</span><span class="op" id="4919346">]</span>&nbsp;<span class="op" id="4919348">=</span>&nbsp;<span class="ident" id="4919350">decInstr</span><span class="op" id="4919358">{</span><span class="ident" id="4919359">op</span><span class="op" id="4919361">,</span>&nbsp;<span class="num" id="4919363">0</span><span class="op" id="4919364">,</span>&nbsp;<span class="ident" id="4919366">nil</span><span class="op" id="4919369">,</span>&nbsp;<span class="ident" id="4919371">ovfl</span><span class="op" id="4919375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919378">engine</span><span class="op" id="4919384">.</span><span class="ident" id="4919385">numInstr</span>&nbsp;<span class="op" id="4919394">=</span>&nbsp;<span class="num" id="4919396">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919399">return</span><br>
<span class="lineno"></span><span class="op" id="4919406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4919409">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="4919495">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="4919529">func</span>&nbsp;<span class="op" id="4919534">(</span><span class="ident" id="4919535">dec</span>&nbsp;<span class="op" id="4919539">*</span><span class="ident" id="4919540">Decoder</span><span class="op" id="4919547">)</span>&nbsp;<span class="ident" id="4919549">compileDec</span><span class="op" id="4919559">(</span><span class="ident" id="4919560">remoteId</span>&nbsp;<span class="ident" id="4919569">typeId</span><span class="op" id="4919575">,</span>&nbsp;<span class="ident" id="4919577">ut</span>&nbsp;<span class="op" id="4919580">*</span><span class="ident" id="4919581">userTypeInfo</span><span class="op" id="4919593">)</span>&nbsp;<span class="op" id="4919595">(</span><span class="ident" id="4919596">engine</span>&nbsp;<span class="op" id="4919603">*</span><span class="ident" id="4919604">decEngine</span><span class="op" id="4919613">,</span>&nbsp;<span class="ident" id="4919615">err</span>&nbsp;<span class="builtintype" id="4919619">error</span><span class="op" id="4919624">)</span>&nbsp;<span class="op" id="4919626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919629">rt</span>&nbsp;<span class="op" id="4919632">:=</span>&nbsp;<span class="ident" id="4919635">ut</span><span class="op" id="4919637">.</span><span class="ident" id="4919638">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919644">srt</span>&nbsp;<span class="op" id="4919648">:=</span>&nbsp;<span class="ident" id="4919651">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919655">if</span>&nbsp;<span class="ident" id="4919658">srt</span><span class="op" id="4919661">.</span><span class="ident" id="4919662">Kind</span><span class="op" id="4919666">(</span><span class="op" id="4919667">)</span>&nbsp;<span class="op" id="4919669">!=</span>&nbsp;<span class="ident" id="4919672">reflect</span><span class="op" id="4919679">.</span><span class="ident" id="4919680">Struct</span>&nbsp;<span class="op" id="4919687">||</span>&nbsp;<span class="ident" id="4919690">ut</span><span class="op" id="4919692">.</span><span class="ident" id="4919693">externalDec</span>&nbsp;<span class="op" id="4919705">!=</span>&nbsp;<span class="num" id="4919708">0</span>&nbsp;<span class="op" id="4919710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919714">return</span>&nbsp;<span class="ident" id="4919721">dec</span><span class="op" id="4919724">.</span><span class="ident" id="4919725">compileSingle</span><span class="op" id="4919738">(</span><span class="ident" id="4919739">remoteId</span><span class="op" id="4919747">,</span>&nbsp;<span class="ident" id="4919749">ut</span><span class="op" id="4919751">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919757">var</span>&nbsp;<span class="ident" id="4919761">wireStruct</span>&nbsp;<span class="op" id="4919772">*</span><span class="ident" id="4919773">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919785">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919871">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919951">if</span>&nbsp;<span class="ident" id="4919954">t</span><span class="op" id="4919955">,</span>&nbsp;<span class="ident" id="4919957">ok</span>&nbsp;<span class="op" id="4919960">:=</span>&nbsp;<span class="ident" id="4919963">builtinIdToType</span><span class="op" id="4919978">[</span><span class="ident" id="4919979">remoteId</span><span class="op" id="4919987">]</span><span class="op" id="4919988">;</span>&nbsp;<span class="ident" id="4919990">ok</span>&nbsp;<span class="op" id="4919993">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919997">wireStruct</span><span class="op" id="4920007">,</span>&nbsp;<span class="ident" id="4920009">_</span>&nbsp;<span class="op" id="4920011">=</span>&nbsp;<span class="ident" id="4920013">t</span><span class="op" id="4920014">.</span><span class="op" id="4920015">(</span><span class="op" id="4920016">*</span><span class="ident" id="4920017">structType</span><span class="op" id="4920027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920030">}</span>&nbsp;<span class="keyword" id="4920032">else</span>&nbsp;<span class="op" id="4920037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920041">wire</span>&nbsp;<span class="op" id="4920046">:=</span>&nbsp;<span class="ident" id="4920049">dec</span><span class="op" id="4920052">.</span><span class="ident" id="4920053">wireType</span><span class="op" id="4920061">[</span><span class="ident" id="4920062">remoteId</span><span class="op" id="4920070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920074">if</span>&nbsp;<span class="ident" id="4920077">wire</span>&nbsp;<span class="op" id="4920082">==</span>&nbsp;<span class="ident" id="4920085">nil</span>&nbsp;<span class="op" id="4920089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920094">error_</span><span class="op" id="4920100">(</span><span class="ident" id="4920101">errBadType</span><span class="op" id="4920111">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920119">wireStruct</span>&nbsp;<span class="op" id="4920130">=</span>&nbsp;<span class="ident" id="4920132">wire</span><span class="op" id="4920136">.</span><span class="ident" id="4920137">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920149">if</span>&nbsp;<span class="ident" id="4920152">wireStruct</span>&nbsp;<span class="op" id="4920163">==</span>&nbsp;<span class="ident" id="4920166">nil</span>&nbsp;<span class="op" id="4920170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920174">errorf</span><span class="op" id="4920180">(</span><span class="string" id="4920181">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="4920244">,</span>&nbsp;<span class="ident" id="4920246">rt</span><span class="op" id="4920248">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920254">engine</span>&nbsp;<span class="op" id="4920261">=</span>&nbsp;<span class="builtinfunc" id="4920263">new</span><span class="op" id="4920266">(</span><span class="ident" id="4920267">decEngine</span><span class="op" id="4920276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920279">engine</span><span class="op" id="4920285">.</span><span class="ident" id="4920286">instr</span>&nbsp;<span class="op" id="4920292">=</span>&nbsp;<span class="builtinfunc" id="4920294">make</span><span class="op" id="4920298">(</span><span class="op" id="4920299">[</span><span class="op" id="4920300">]</span><span class="ident" id="4920301">decInstr</span><span class="op" id="4920309">,</span>&nbsp;<span class="builtinfunc" id="4920311">len</span><span class="op" id="4920314">(</span><span class="ident" id="4920315">wireStruct</span><span class="op" id="4920325">.</span><span class="ident" id="4920326">Field</span><span class="op" id="4920331">)</span><span class="op" id="4920332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920335">seen</span>&nbsp;<span class="op" id="4920340">:=</span>&nbsp;<span class="builtinfunc" id="4920343">make</span><span class="op" id="4920347">(</span><span class="keyword" id="4920348">map</span><span class="op" id="4920351">[</span><span class="ident" id="4920352">reflect</span><span class="op" id="4920359">.</span><span class="ident" id="4920360">Type</span><span class="op" id="4920364">]</span><span class="op" id="4920365">*</span><span class="ident" id="4920366">decOp</span><span class="op" id="4920371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920374">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920417">for</span>&nbsp;<span class="ident" id="4920421">fieldnum</span>&nbsp;<span class="op" id="4920430">:=</span>&nbsp;<span class="num" id="4920433">0</span><span class="op" id="4920434">;</span>&nbsp;<span class="ident" id="4920436">fieldnum</span>&nbsp;<span class="op" id="4920445">&lt;</span>&nbsp;<span class="builtinfunc" id="4920447">len</span><span class="op" id="4920450">(</span><span class="ident" id="4920451">wireStruct</span><span class="op" id="4920461">.</span><span class="ident" id="4920462">Field</span><span class="op" id="4920467">)</span><span class="op" id="4920468">;</span>&nbsp;<span class="ident" id="4920470">fieldnum</span><span class="op" id="4920478">++</span>&nbsp;<span class="op" id="4920481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920485">wireField</span>&nbsp;<span class="op" id="4920495">:=</span>&nbsp;<span class="ident" id="4920498">wireStruct</span><span class="op" id="4920508">.</span><span class="ident" id="4920509">Field</span><span class="op" id="4920514">[</span><span class="ident" id="4920515">fieldnum</span><span class="op" id="4920523">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920527">if</span>&nbsp;<span class="ident" id="4920530">wireField</span><span class="op" id="4920539">.</span><span class="ident" id="4920540">Name</span>&nbsp;<span class="op" id="4920545">==</span>&nbsp;<span class="string" id="4920548">&#34;&#34;</span>&nbsp;<span class="op" id="4920551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920556">errorf</span><span class="op" id="4920562">(</span><span class="string" id="4920563">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4920603">,</span>&nbsp;<span class="ident" id="4920605">wireStruct</span><span class="op" id="4920615">.</span><span class="ident" id="4920616">Name</span><span class="op" id="4920620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920624">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920628">ovfl</span>&nbsp;<span class="op" id="4920633">:=</span>&nbsp;<span class="ident" id="4920636">overflow</span><span class="op" id="4920644">(</span><span class="ident" id="4920645">wireField</span><span class="op" id="4920654">.</span><span class="ident" id="4920655">Name</span><span class="op" id="4920659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920663">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920721">localField</span><span class="op" id="4920731">,</span>&nbsp;<span class="ident" id="4920733">present</span>&nbsp;<span class="op" id="4920741">:=</span>&nbsp;<span class="ident" id="4920744">srt</span><span class="op" id="4920747">.</span><span class="ident" id="4920748">FieldByName</span><span class="op" id="4920759">(</span><span class="ident" id="4920760">wireField</span><span class="op" id="4920769">.</span><span class="ident" id="4920770">Name</span><span class="op" id="4920774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920778">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920808">if</span>&nbsp;<span class="op" id="4920811">!</span><span class="ident" id="4920812">present</span>&nbsp;<span class="op" id="4920820">||</span>&nbsp;<span class="op" id="4920823">!</span><span class="ident" id="4920824">isExported</span><span class="op" id="4920834">(</span><span class="ident" id="4920835">wireField</span><span class="op" id="4920844">.</span><span class="ident" id="4920845">Name</span><span class="op" id="4920849">)</span>&nbsp;<span class="op" id="4920851">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920856">op</span>&nbsp;<span class="op" id="4920859">:=</span>&nbsp;<span class="ident" id="4920862">dec</span><span class="op" id="4920865">.</span><span class="ident" id="4920866">decIgnoreOpFor</span><span class="op" id="4920880">(</span><span class="ident" id="4920881">wireField</span><span class="op" id="4920890">.</span><span class="ident" id="4920891">Id</span><span class="op" id="4920893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920898">engine</span><span class="op" id="4920904">.</span><span class="ident" id="4920905">instr</span><span class="op" id="4920910">[</span><span class="ident" id="4920911">fieldnum</span><span class="op" id="4920919">]</span>&nbsp;<span class="op" id="4920921">=</span>&nbsp;<span class="ident" id="4920923">decInstr</span><span class="op" id="4920931">{</span><span class="ident" id="4920932">op</span><span class="op" id="4920934">,</span>&nbsp;<span class="ident" id="4920936">fieldnum</span><span class="op" id="4920944">,</span>&nbsp;<span class="ident" id="4920946">nil</span><span class="op" id="4920949">,</span>&nbsp;<span class="ident" id="4920951">ovfl</span><span class="op" id="4920955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920960">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920975">if</span>&nbsp;<span class="op" id="4920978">!</span><span class="ident" id="4920979">dec</span><span class="op" id="4920982">.</span><span class="ident" id="4920983">compatibleType</span><span class="op" id="4920997">(</span><span class="ident" id="4920998">localField</span><span class="op" id="4921008">.</span><span class="ident" id="4921009">Type</span><span class="op" id="4921013">,</span>&nbsp;<span class="ident" id="4921015">wireField</span><span class="op" id="4921024">.</span><span class="ident" id="4921025">Id</span><span class="op" id="4921027">,</span>&nbsp;<span class="builtinfunc" id="4921029">make</span><span class="op" id="4921033">(</span><span class="keyword" id="4921034">map</span><span class="op" id="4921037">[</span><span class="ident" id="4921038">reflect</span><span class="op" id="4921045">.</span><span class="ident" id="4921046">Type</span><span class="op" id="4921050">]</span><span class="ident" id="4921051">typeId</span><span class="op" id="4921057">)</span><span class="op" id="4921058">)</span>&nbsp;<span class="op" id="4921060">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921065">errorf</span><span class="op" id="4921071">(</span><span class="string" id="4921072">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="4921114">,</span>&nbsp;<span class="ident" id="4921116">localField</span><span class="op" id="4921126">.</span><span class="ident" id="4921127">Type</span><span class="op" id="4921131">,</span>&nbsp;<span class="ident" id="4921133">wireStruct</span><span class="op" id="4921143">.</span><span class="ident" id="4921144">Name</span><span class="op" id="4921148">,</span>&nbsp;<span class="ident" id="4921150">wireField</span><span class="op" id="4921159">.</span><span class="ident" id="4921160">Name</span><span class="op" id="4921164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921172">op</span>&nbsp;<span class="op" id="4921175">:=</span>&nbsp;<span class="ident" id="4921178">dec</span><span class="op" id="4921181">.</span><span class="ident" id="4921182">decOpFor</span><span class="op" id="4921190">(</span><span class="ident" id="4921191">wireField</span><span class="op" id="4921200">.</span><span class="ident" id="4921201">Id</span><span class="op" id="4921203">,</span>&nbsp;<span class="ident" id="4921205">localField</span><span class="op" id="4921215">.</span><span class="ident" id="4921216">Type</span><span class="op" id="4921220">,</span>&nbsp;<span class="ident" id="4921222">localField</span><span class="op" id="4921232">.</span><span class="ident" id="4921233">Name</span><span class="op" id="4921237">,</span>&nbsp;<span class="ident" id="4921239">seen</span><span class="op" id="4921243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921247">engine</span><span class="op" id="4921253">.</span><span class="ident" id="4921254">instr</span><span class="op" id="4921259">[</span><span class="ident" id="4921260">fieldnum</span><span class="op" id="4921268">]</span>&nbsp;<span class="op" id="4921270">=</span>&nbsp;<span class="ident" id="4921272">decInstr</span><span class="op" id="4921280">{</span><span class="op" id="4921281">*</span><span class="ident" id="4921282">op</span><span class="op" id="4921284">,</span>&nbsp;<span class="ident" id="4921286">fieldnum</span><span class="op" id="4921294">,</span>&nbsp;<span class="ident" id="4921296">localField</span><span class="op" id="4921306">.</span><span class="ident" id="4921307">Index</span><span class="op" id="4921312">,</span>&nbsp;<span class="ident" id="4921314">ovfl</span><span class="op" id="4921318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921322">engine</span><span class="op" id="4921328">.</span><span class="ident" id="4921329">numInstr</span><span class="op" id="4921337">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921344">return</span><br>
<span class="lineno"></span><span class="op" id="4921351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4921354">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="4921416">func</span>&nbsp;<span class="op" id="4921421">(</span><span class="ident" id="4921422">dec</span>&nbsp;<span class="op" id="4921426">*</span><span class="ident" id="4921427">Decoder</span><span class="op" id="4921434">)</span>&nbsp;<span class="ident" id="4921436">getDecEnginePtr</span><span class="op" id="4921451">(</span><span class="ident" id="4921452">remoteId</span>&nbsp;<span class="ident" id="4921461">typeId</span><span class="op" id="4921467">,</span>&nbsp;<span class="ident" id="4921469">ut</span>&nbsp;<span class="op" id="4921472">*</span><span class="ident" id="4921473">userTypeInfo</span><span class="op" id="4921485">)</span>&nbsp;<span class="op" id="4921487">(</span><span class="ident" id="4921488">enginePtr</span>&nbsp;<span class="op" id="4921498">*</span><span class="op" id="4921499">*</span><span class="ident" id="4921500">decEngine</span><span class="op" id="4921509">,</span>&nbsp;<span class="ident" id="4921511">err</span>&nbsp;<span class="builtintype" id="4921515">error</span><span class="op" id="4921520">)</span>&nbsp;<span class="op" id="4921522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921525">rt</span>&nbsp;<span class="op" id="4921528">:=</span>&nbsp;<span class="ident" id="4921531">ut</span><span class="op" id="4921533">.</span><span class="ident" id="4921534">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921540">decoderMap</span><span class="op" id="4921550">,</span>&nbsp;<span class="ident" id="4921552">ok</span>&nbsp;<span class="op" id="4921555">:=</span>&nbsp;<span class="ident" id="4921558">dec</span><span class="op" id="4921561">.</span><span class="ident" id="4921562">decoderCache</span><span class="op" id="4921574">[</span><span class="ident" id="4921575">rt</span><span class="op" id="4921577">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921580">if</span>&nbsp;<span class="op" id="4921583">!</span><span class="ident" id="4921584">ok</span>&nbsp;<span class="op" id="4921587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921591">decoderMap</span>&nbsp;<span class="op" id="4921602">=</span>&nbsp;<span class="builtinfunc" id="4921604">make</span><span class="op" id="4921608">(</span><span class="keyword" id="4921609">map</span><span class="op" id="4921612">[</span><span class="ident" id="4921613">typeId</span><span class="op" id="4921619">]</span><span class="op" id="4921620">*</span><span class="op" id="4921621">*</span><span class="ident" id="4921622">decEngine</span><span class="op" id="4921631">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921635">dec</span><span class="op" id="4921638">.</span><span class="ident" id="4921639">decoderCache</span><span class="op" id="4921651">[</span><span class="ident" id="4921652">rt</span><span class="op" id="4921654">]</span>&nbsp;<span class="op" id="4921656">=</span>&nbsp;<span class="ident" id="4921658">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921673">if</span>&nbsp;<span class="ident" id="4921676">enginePtr</span><span class="op" id="4921685">,</span>&nbsp;<span class="ident" id="4921687">ok</span>&nbsp;<span class="op" id="4921690">=</span>&nbsp;<span class="ident" id="4921692">decoderMap</span><span class="op" id="4921702">[</span><span class="ident" id="4921703">remoteId</span><span class="op" id="4921711">]</span><span class="op" id="4921712">;</span>&nbsp;<span class="op" id="4921714">!</span><span class="ident" id="4921715">ok</span>&nbsp;<span class="op" id="4921718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921722">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921801">enginePtr</span>&nbsp;<span class="op" id="4921811">=</span>&nbsp;<span class="builtinfunc" id="4921813">new</span><span class="op" id="4921816">(</span><span class="op" id="4921817">*</span><span class="ident" id="4921818">decEngine</span><span class="op" id="4921827">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921831">decoderMap</span><span class="op" id="4921841">[</span><span class="ident" id="4921842">remoteId</span><span class="op" id="4921850">]</span>&nbsp;<span class="op" id="4921852">=</span>&nbsp;<span class="ident" id="4921854">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921866">*</span><span class="ident" id="4921867">enginePtr</span><span class="op" id="4921876">,</span>&nbsp;<span class="ident" id="4921878">err</span>&nbsp;<span class="op" id="4921882">=</span>&nbsp;<span class="ident" id="4921884">dec</span><span class="op" id="4921887">.</span><span class="ident" id="4921888">compileDec</span><span class="op" id="4921898">(</span><span class="ident" id="4921899">remoteId</span><span class="op" id="4921907">,</span>&nbsp;<span class="ident" id="4921909">ut</span><span class="op" id="4921911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921915">if</span>&nbsp;<span class="ident" id="4921918">err</span>&nbsp;<span class="op" id="4921922">!=</span>&nbsp;<span class="ident" id="4921925">nil</span>&nbsp;<span class="op" id="4921929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4921934">delete</span><span class="op" id="4921940">(</span><span class="ident" id="4921941">decoderMap</span><span class="op" id="4921951">,</span>&nbsp;<span class="ident" id="4921953">remoteId</span><span class="op" id="4921961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921965">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921971">return</span><br>
<span class="lineno"></span><span class="op" id="4921978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4921981">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="4922054">type</span>&nbsp;<span class="ident" id="4922059">emptyStruct</span>&nbsp;<span class="keyword" id="4922071">struct</span><span class="op" id="4922077">{</span><span class="op" id="4922078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4922081">var</span>&nbsp;<span class="ident" id="4922085">emptyStructType</span>&nbsp;<span class="op" id="4922101">=</span>&nbsp;<span class="ident" id="4922103">reflect</span><span class="op" id="4922110">.</span><span class="ident" id="4922111">TypeOf</span><span class="op" id="4922117">(</span><span class="ident" id="4922118">emptyStruct</span><span class="op" id="4922129">{</span><span class="op" id="4922130">}</span><span class="op" id="4922131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4922134">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="4922230">func</span>&nbsp;<span class="op" id="4922235">(</span><span class="ident" id="4922236">dec</span>&nbsp;<span class="op" id="4922240">*</span><span class="ident" id="4922241">Decoder</span><span class="op" id="4922248">)</span>&nbsp;<span class="ident" id="4922250">getIgnoreEnginePtr</span><span class="op" id="4922268">(</span><span class="ident" id="4922269">wireId</span>&nbsp;<span class="ident" id="4922276">typeId</span><span class="op" id="4922282">)</span>&nbsp;<span class="op" id="4922284">(</span><span class="ident" id="4922285">enginePtr</span>&nbsp;<span class="op" id="4922295">*</span><span class="op" id="4922296">*</span><span class="ident" id="4922297">decEngine</span><span class="op" id="4922306">,</span>&nbsp;<span class="ident" id="4922308">err</span>&nbsp;<span class="builtintype" id="4922312">error</span><span class="op" id="4922317">)</span>&nbsp;<span class="op" id="4922319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922322">var</span>&nbsp;<span class="ident" id="4922326">ok</span>&nbsp;<span class="builtintype" id="4922329">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922335">if</span>&nbsp;<span class="ident" id="4922338">enginePtr</span><span class="op" id="4922347">,</span>&nbsp;<span class="ident" id="4922349">ok</span>&nbsp;<span class="op" id="4922352">=</span>&nbsp;<span class="ident" id="4922354">dec</span><span class="op" id="4922357">.</span><span class="ident" id="4922358">ignorerCache</span><span class="op" id="4922370">[</span><span class="ident" id="4922371">wireId</span><span class="op" id="4922377">]</span><span class="op" id="4922378">;</span>&nbsp;<span class="op" id="4922380">!</span><span class="ident" id="4922381">ok</span>&nbsp;<span class="op" id="4922384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922388">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922467">enginePtr</span>&nbsp;<span class="op" id="4922477">=</span>&nbsp;<span class="builtinfunc" id="4922479">new</span><span class="op" id="4922482">(</span><span class="op" id="4922483">*</span><span class="ident" id="4922484">decEngine</span><span class="op" id="4922493">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922497">dec</span><span class="op" id="4922500">.</span><span class="ident" id="4922501">ignorerCache</span><span class="op" id="4922513">[</span><span class="ident" id="4922514">wireId</span><span class="op" id="4922520">]</span>&nbsp;<span class="op" id="4922522">=</span>&nbsp;<span class="ident" id="4922524">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922536">wire</span>&nbsp;<span class="op" id="4922541">:=</span>&nbsp;<span class="ident" id="4922544">dec</span><span class="op" id="4922547">.</span><span class="ident" id="4922548">wireType</span><span class="op" id="4922556">[</span><span class="ident" id="4922557">wireId</span><span class="op" id="4922563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922567">if</span>&nbsp;<span class="ident" id="4922570">wire</span>&nbsp;<span class="op" id="4922575">!=</span>&nbsp;<span class="ident" id="4922578">nil</span>&nbsp;<span class="op" id="4922582">&amp;&amp;</span>&nbsp;<span class="ident" id="4922585">wire</span><span class="op" id="4922589">.</span><span class="ident" id="4922590">StructT</span>&nbsp;<span class="op" id="4922598">!=</span>&nbsp;<span class="ident" id="4922601">nil</span>&nbsp;<span class="op" id="4922605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922610">*</span><span class="ident" id="4922611">enginePtr</span><span class="op" id="4922620">,</span>&nbsp;<span class="ident" id="4922622">err</span>&nbsp;<span class="op" id="4922626">=</span>&nbsp;<span class="ident" id="4922628">dec</span><span class="op" id="4922631">.</span><span class="ident" id="4922632">compileDec</span><span class="op" id="4922642">(</span><span class="ident" id="4922643">wireId</span><span class="op" id="4922649">,</span>&nbsp;<span class="ident" id="4922651">userType</span><span class="op" id="4922659">(</span><span class="ident" id="4922660">emptyStructType</span><span class="op" id="4922675">)</span><span class="op" id="4922676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922680">}</span>&nbsp;<span class="keyword" id="4922682">else</span>&nbsp;<span class="op" id="4922687">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922692">*</span><span class="ident" id="4922693">enginePtr</span><span class="op" id="4922702">,</span>&nbsp;<span class="ident" id="4922704">err</span>&nbsp;<span class="op" id="4922708">=</span>&nbsp;<span class="ident" id="4922710">dec</span><span class="op" id="4922713">.</span><span class="ident" id="4922714">compileIgnoreSingle</span><span class="op" id="4922733">(</span><span class="ident" id="4922734">wireId</span><span class="op" id="4922740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922748">if</span>&nbsp;<span class="ident" id="4922751">err</span>&nbsp;<span class="op" id="4922755">!=</span>&nbsp;<span class="ident" id="4922758">nil</span>&nbsp;<span class="op" id="4922762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4922767">delete</span><span class="op" id="4922773">(</span><span class="ident" id="4922774">dec</span><span class="op" id="4922777">.</span><span class="ident" id="4922778">ignorerCache</span><span class="op" id="4922790">,</span>&nbsp;<span class="ident" id="4922792">wireId</span><span class="op" id="4922798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922802">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922808">return</span><br>
<span class="lineno"></span><span class="op" id="4922815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4922818">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="4922902">func</span>&nbsp;<span class="op" id="4922907">(</span><span class="ident" id="4922908">dec</span>&nbsp;<span class="op" id="4922912">*</span><span class="ident" id="4922913">Decoder</span><span class="op" id="4922920">)</span>&nbsp;<span class="ident" id="4922922">decodeValue</span><span class="op" id="4922933">(</span><span class="ident" id="4922934">wireId</span>&nbsp;<span class="ident" id="4922941">typeId</span><span class="op" id="4922947">,</span>&nbsp;<span class="ident" id="4922949">value</span>&nbsp;<span class="ident" id="4922955">reflect</span><span class="op" id="4922962">.</span><span class="ident" id="4922963">Value</span><span class="op" id="4922968">)</span>&nbsp;<span class="op" id="4922970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922973">defer</span>&nbsp;<span class="ident" id="4922979">catchError</span><span class="op" id="4922989">(</span><span class="op" id="4922990">&amp;</span><span class="ident" id="4922991">dec</span><span class="op" id="4922994">.</span><span class="ident" id="4922995">err</span><span class="op" id="4922998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923001">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923068">if</span>&nbsp;<span class="op" id="4923071">!</span><span class="ident" id="4923072">value</span><span class="op" id="4923077">.</span><span class="ident" id="4923078">IsValid</span><span class="op" id="4923085">(</span><span class="op" id="4923086">)</span>&nbsp;<span class="op" id="4923088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923092">dec</span><span class="op" id="4923095">.</span><span class="ident" id="4923096">decodeIgnoredValue</span><span class="op" id="4923114">(</span><span class="ident" id="4923115">wireId</span><span class="op" id="4923121">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923125">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923136">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923181">ut</span>&nbsp;<span class="op" id="4923184">:=</span>&nbsp;<span class="ident" id="4923187">userType</span><span class="op" id="4923195">(</span><span class="ident" id="4923196">value</span><span class="op" id="4923201">.</span><span class="ident" id="4923202">Type</span><span class="op" id="4923206">(</span><span class="op" id="4923207">)</span><span class="op" id="4923208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923211">base</span>&nbsp;<span class="op" id="4923216">:=</span>&nbsp;<span class="ident" id="4923219">ut</span><span class="op" id="4923221">.</span><span class="ident" id="4923222">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923228">var</span>&nbsp;<span class="ident" id="4923232">enginePtr</span>&nbsp;<span class="op" id="4923242">*</span><span class="op" id="4923243">*</span><span class="ident" id="4923244">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923255">enginePtr</span><span class="op" id="4923264">,</span>&nbsp;<span class="ident" id="4923266">dec</span><span class="op" id="4923269">.</span><span class="ident" id="4923270">err</span>&nbsp;<span class="op" id="4923274">=</span>&nbsp;<span class="ident" id="4923276">dec</span><span class="op" id="4923279">.</span><span class="ident" id="4923280">getDecEnginePtr</span><span class="op" id="4923295">(</span><span class="ident" id="4923296">wireId</span><span class="op" id="4923302">,</span>&nbsp;<span class="ident" id="4923304">ut</span><span class="op" id="4923306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923309">if</span>&nbsp;<span class="ident" id="4923312">dec</span><span class="op" id="4923315">.</span><span class="ident" id="4923316">err</span>&nbsp;<span class="op" id="4923320">!=</span>&nbsp;<span class="ident" id="4923323">nil</span>&nbsp;<span class="op" id="4923327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923339">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923342">value</span>&nbsp;<span class="op" id="4923348">=</span>&nbsp;<span class="ident" id="4923350">decAlloc</span><span class="op" id="4923358">(</span><span class="ident" id="4923359">value</span><span class="op" id="4923364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923367">engine</span>&nbsp;<span class="op" id="4923374">:=</span>&nbsp;<span class="op" id="4923377">*</span><span class="ident" id="4923378">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923389">if</span>&nbsp;<span class="ident" id="4923392">st</span>&nbsp;<span class="op" id="4923395">:=</span>&nbsp;<span class="ident" id="4923398">base</span><span class="op" id="4923402">;</span>&nbsp;<span class="ident" id="4923404">st</span><span class="op" id="4923406">.</span><span class="ident" id="4923407">Kind</span><span class="op" id="4923411">(</span><span class="op" id="4923412">)</span>&nbsp;<span class="op" id="4923414">==</span>&nbsp;<span class="ident" id="4923417">reflect</span><span class="op" id="4923424">.</span><span class="ident" id="4923425">Struct</span>&nbsp;<span class="op" id="4923432">&amp;&amp;</span>&nbsp;<span class="ident" id="4923435">ut</span><span class="op" id="4923437">.</span><span class="ident" id="4923438">externalDec</span>&nbsp;<span class="op" id="4923450">==</span>&nbsp;<span class="num" id="4923453">0</span>&nbsp;<span class="op" id="4923455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923459">if</span>&nbsp;<span class="ident" id="4923462">engine</span><span class="op" id="4923468">.</span><span class="ident" id="4923469">numInstr</span>&nbsp;<span class="op" id="4923478">==</span>&nbsp;<span class="num" id="4923481">0</span>&nbsp;<span class="op" id="4923483">&amp;&amp;</span>&nbsp;<span class="ident" id="4923486">st</span><span class="op" id="4923488">.</span><span class="ident" id="4923489">NumField</span><span class="op" id="4923497">(</span><span class="op" id="4923498">)</span>&nbsp;<span class="op" id="4923500">&gt;</span>&nbsp;<span class="num" id="4923502">0</span>&nbsp;<span class="op" id="4923504">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923510">dec</span><span class="op" id="4923513">.</span><span class="ident" id="4923514">wireType</span><span class="op" id="4923522">[</span><span class="ident" id="4923523">wireId</span><span class="op" id="4923529">]</span>&nbsp;<span class="op" id="4923531">!=</span>&nbsp;<span class="ident" id="4923534">nil</span>&nbsp;<span class="op" id="4923538">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4923541">len</span><span class="op" id="4923544">(</span><span class="ident" id="4923545">dec</span><span class="op" id="4923548">.</span><span class="ident" id="4923549">wireType</span><span class="op" id="4923557">[</span><span class="ident" id="4923558">wireId</span><span class="op" id="4923564">]</span><span class="op" id="4923565">.</span><span class="ident" id="4923566">StructT</span><span class="op" id="4923573">.</span><span class="ident" id="4923574">Field</span><span class="op" id="4923579">)</span>&nbsp;<span class="op" id="4923581">&gt;</span>&nbsp;<span class="num" id="4923583">0</span>&nbsp;<span class="op" id="4923585">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923590">name</span>&nbsp;<span class="op" id="4923595">:=</span>&nbsp;<span class="ident" id="4923598">base</span><span class="op" id="4923602">.</span><span class="ident" id="4923603">Name</span><span class="op" id="4923607">(</span><span class="op" id="4923608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923613">errorf</span><span class="op" id="4923619">(</span><span class="string" id="4923620">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="4923679">,</span>&nbsp;<span class="ident" id="4923681">name</span><span class="op" id="4923685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923693">dec</span><span class="op" id="4923696">.</span><span class="ident" id="4923697">decodeStruct</span><span class="op" id="4923709">(</span><span class="ident" id="4923710">engine</span><span class="op" id="4923716">,</span>&nbsp;<span class="ident" id="4923718">ut</span><span class="op" id="4923720">,</span>&nbsp;<span class="ident" id="4923722">value</span><span class="op" id="4923727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923730">}</span>&nbsp;<span class="keyword" id="4923732">else</span>&nbsp;<span class="op" id="4923737">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923741">dec</span><span class="op" id="4923744">.</span><span class="ident" id="4923745">decodeSingle</span><span class="op" id="4923757">(</span><span class="ident" id="4923758">engine</span><span class="op" id="4923764">,</span>&nbsp;<span class="ident" id="4923766">ut</span><span class="op" id="4923768">,</span>&nbsp;<span class="ident" id="4923770">value</span><span class="op" id="4923775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923778">}</span><br>
<span class="lineno"></span><span class="op" id="4923780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4923783">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="4923889">func</span>&nbsp;<span class="op" id="4923894">(</span><span class="ident" id="4923895">dec</span>&nbsp;<span class="op" id="4923899">*</span><span class="ident" id="4923900">Decoder</span><span class="op" id="4923907">)</span>&nbsp;<span class="ident" id="4923909">decodeIgnoredValue</span><span class="op" id="4923927">(</span><span class="ident" id="4923928">wireId</span>&nbsp;<span class="ident" id="4923935">typeId</span><span class="op" id="4923941">)</span>&nbsp;<span class="op" id="4923943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923946">var</span>&nbsp;<span class="ident" id="4923950">enginePtr</span>&nbsp;<span class="op" id="4923960">*</span><span class="op" id="4923961">*</span><span class="ident" id="4923962">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923973">enginePtr</span><span class="op" id="4923982">,</span>&nbsp;<span class="ident" id="4923984">dec</span><span class="op" id="4923987">.</span><span class="ident" id="4923988">err</span>&nbsp;<span class="op" id="4923992">=</span>&nbsp;<span class="ident" id="4923994">dec</span><span class="op" id="4923997">.</span><span class="ident" id="4923998">getIgnoreEnginePtr</span><span class="op" id="4924016">(</span><span class="ident" id="4924017">wireId</span><span class="op" id="4924023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924026">if</span>&nbsp;<span class="ident" id="4924029">dec</span><span class="op" id="4924032">.</span><span class="ident" id="4924033">err</span>&nbsp;<span class="op" id="4924037">!=</span>&nbsp;<span class="ident" id="4924040">nil</span>&nbsp;<span class="op" id="4924044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924048">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924059">wire</span>&nbsp;<span class="op" id="4924064">:=</span>&nbsp;<span class="ident" id="4924067">dec</span><span class="op" id="4924070">.</span><span class="ident" id="4924071">wireType</span><span class="op" id="4924079">[</span><span class="ident" id="4924080">wireId</span><span class="op" id="4924086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924089">if</span>&nbsp;<span class="ident" id="4924092">wire</span>&nbsp;<span class="op" id="4924097">!=</span>&nbsp;<span class="ident" id="4924100">nil</span>&nbsp;<span class="op" id="4924104">&amp;&amp;</span>&nbsp;<span class="ident" id="4924107">wire</span><span class="op" id="4924111">.</span><span class="ident" id="4924112">StructT</span>&nbsp;<span class="op" id="4924120">!=</span>&nbsp;<span class="ident" id="4924123">nil</span>&nbsp;<span class="op" id="4924127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924131">dec</span><span class="op" id="4924134">.</span><span class="ident" id="4924135">ignoreStruct</span><span class="op" id="4924147">(</span><span class="op" id="4924148">*</span><span class="ident" id="4924149">enginePtr</span><span class="op" id="4924158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924161">}</span>&nbsp;<span class="keyword" id="4924163">else</span>&nbsp;<span class="op" id="4924168">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924172">dec</span><span class="op" id="4924175">.</span><span class="ident" id="4924176">ignoreSingle</span><span class="op" id="4924188">(</span><span class="op" id="4924189">*</span><span class="ident" id="4924190">enginePtr</span><span class="op" id="4924199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924202">}</span><br>
<span class="lineno"></span><span class="op" id="4924204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4924207">func</span>&nbsp;<span class="ident" id="4924212">init</span><span class="op" id="4924216">(</span><span class="op" id="4924217">)</span>&nbsp;<span class="op" id="4924219">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924222">var</span>&nbsp;<span class="ident" id="4924226">iop</span><span class="op" id="4924229">,</span>&nbsp;<span class="ident" id="4924231">uop</span>&nbsp;<span class="ident" id="4924235">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924242">switch</span>&nbsp;<span class="ident" id="4924249">reflect</span><span class="op" id="4924256">.</span><span class="ident" id="4924257">TypeOf</span><span class="op" id="4924263">(</span><span class="builtintype" id="4924264">int</span><span class="op" id="4924267">(</span><span class="num" id="4924268">0</span><span class="op" id="4924269">)</span><span class="op" id="4924270">)</span><span class="op" id="4924271">.</span><span class="ident" id="4924272">Bits</span><span class="op" id="4924276">(</span><span class="op" id="4924277">)</span>&nbsp;<span class="op" id="4924279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924282">case</span>&nbsp;<span class="num" id="4924287">32</span><span class="op" id="4924289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924293">iop</span>&nbsp;<span class="op" id="4924297">=</span>&nbsp;<span class="ident" id="4924299">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924310">uop</span>&nbsp;<span class="op" id="4924314">=</span>&nbsp;<span class="ident" id="4924316">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924327">case</span>&nbsp;<span class="num" id="4924332">64</span><span class="op" id="4924334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924338">iop</span>&nbsp;<span class="op" id="4924342">=</span>&nbsp;<span class="ident" id="4924344">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924355">uop</span>&nbsp;<span class="op" id="4924359">=</span>&nbsp;<span class="ident" id="4924361">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924372">default</span><span class="op" id="4924379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4924383">panic</span><span class="op" id="4924388">(</span><span class="string" id="4924389">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="4924420">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924426">decOpTable</span><span class="op" id="4924436">[</span><span class="ident" id="4924437">reflect</span><span class="op" id="4924444">.</span><span class="ident" id="4924445">Int</span><span class="op" id="4924448">]</span>&nbsp;<span class="op" id="4924450">=</span>&nbsp;<span class="ident" id="4924452">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924457">decOpTable</span><span class="op" id="4924467">[</span><span class="ident" id="4924468">reflect</span><span class="op" id="4924475">.</span><span class="ident" id="4924476">Uint</span><span class="op" id="4924480">]</span>&nbsp;<span class="op" id="4924482">=</span>&nbsp;<span class="ident" id="4924484">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924490">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924510">switch</span>&nbsp;<span class="ident" id="4924517">reflect</span><span class="op" id="4924524">.</span><span class="ident" id="4924525">TypeOf</span><span class="op" id="4924531">(</span><span class="builtintype" id="4924532">uintptr</span><span class="op" id="4924539">(</span><span class="num" id="4924540">0</span><span class="op" id="4924541">)</span><span class="op" id="4924542">)</span><span class="op" id="4924543">.</span><span class="ident" id="4924544">Bits</span><span class="op" id="4924548">(</span><span class="op" id="4924549">)</span>&nbsp;<span class="op" id="4924551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924554">case</span>&nbsp;<span class="num" id="4924559">32</span><span class="op" id="4924561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924565">uop</span>&nbsp;<span class="op" id="4924569">=</span>&nbsp;<span class="ident" id="4924571">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924582">case</span>&nbsp;<span class="num" id="4924587">64</span><span class="op" id="4924589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924593">uop</span>&nbsp;<span class="op" id="4924597">=</span>&nbsp;<span class="ident" id="4924599">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924610">default</span><span class="op" id="4924617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4924621">panic</span><span class="op" id="4924626">(</span><span class="string" id="4924627">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="4924657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924663">decOpTable</span><span class="op" id="4924673">[</span><span class="ident" id="4924674">reflect</span><span class="op" id="4924681">.</span><span class="ident" id="4924682">Uintptr</span><span class="op" id="4924689">]</span>&nbsp;<span class="op" id="4924691">=</span>&nbsp;<span class="ident" id="4924693">uop</span><br>
<span class="lineno"></span><span class="op" id="4924697">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="4924700">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4924749">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4924809">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="4924842">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4924871">func</span>&nbsp;<span class="ident" id="4924876">allocValue</span><span class="op" id="4924886">(</span><span class="ident" id="4924887">t</span>&nbsp;<span class="ident" id="4924889">reflect</span><span class="op" id="4924896">.</span><span class="ident" id="4924897">Type</span><span class="op" id="4924901">)</span>&nbsp;<span class="ident" id="4924903">reflect</span><span class="op" id="4924910">.</span><span class="ident" id="4924911">Value</span>&nbsp;<span class="op" id="4924917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924920">return</span>&nbsp;<span class="ident" id="4924927">reflect</span><span class="op" id="4924934">.</span><span class="ident" id="4924935">New</span><span class="op" id="4924938">(</span><span class="ident" id="4924939">t</span><span class="op" id="4924940">)</span><span class="op" id="4924941">.</span><span class="ident" id="4924942">Elem</span><span class="op" id="4924946">(</span><span class="op" id="4924947">)</span><br>
<span class="lineno"></span><span class="op" id="4924949">}</span>
</div>
</body>
</html>
