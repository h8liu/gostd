<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1740737">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1740792">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1740846">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1740897">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1740975">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1741060">package</span>&nbsp;<span class="ident" id="1741068">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1741074">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1741131">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1741186">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1741262">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1741302">const</span>&nbsp;<span class="op" id="1741308">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741311">RuneError</span>&nbsp;<span class="op" id="1741321">=</span>&nbsp;<span class="string" id="1741323">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741336">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741392">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1741402">=</span>&nbsp;<span class="num" id="1741404">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741417">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741495">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1741505">=</span>&nbsp;<span class="string" id="1741507">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1741520">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741558">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741568">=</span>&nbsp;<span class="num" id="1741570">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741583">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1741648">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1741651">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1741714">const</span>&nbsp;<span class="op" id="1741720">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741723">surrogateMin</span>&nbsp;<span class="op" id="1741736">=</span>&nbsp;<span class="num" id="1741738">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741746">surrogateMax</span>&nbsp;<span class="op" id="1741759">=</span>&nbsp;<span class="num" id="1741761">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1741768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1741771">const</span>&nbsp;<span class="op" id="1741777">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741780">t1</span>&nbsp;<span class="op" id="1741783">=</span>&nbsp;<span class="num" id="1741785">0x00</span>&nbsp;<span class="comment" id="1741790">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741804">tx</span>&nbsp;<span class="op" id="1741807">=</span>&nbsp;<span class="num" id="1741809">0x80</span>&nbsp;<span class="comment" id="1741814">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741828">t2</span>&nbsp;<span class="op" id="1741831">=</span>&nbsp;<span class="num" id="1741833">0xC0</span>&nbsp;<span class="comment" id="1741838">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741852">t3</span>&nbsp;<span class="op" id="1741855">=</span>&nbsp;<span class="num" id="1741857">0xE0</span>&nbsp;<span class="comment" id="1741862">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741876">t4</span>&nbsp;<span class="op" id="1741879">=</span>&nbsp;<span class="num" id="1741881">0xF0</span>&nbsp;<span class="comment" id="1741886">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741900">t5</span>&nbsp;<span class="op" id="1741903">=</span>&nbsp;<span class="num" id="1741905">0xF8</span>&nbsp;<span class="comment" id="1741910">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741925">maskx</span>&nbsp;<span class="op" id="1741931">=</span>&nbsp;<span class="num" id="1741933">0x3F</span>&nbsp;<span class="comment" id="1741938">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741952">mask2</span>&nbsp;<span class="op" id="1741958">=</span>&nbsp;<span class="num" id="1741960">0x1F</span>&nbsp;<span class="comment" id="1741965">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1741979">mask3</span>&nbsp;<span class="op" id="1741985">=</span>&nbsp;<span class="num" id="1741987">0x0F</span>&nbsp;<span class="comment" id="1741992">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742006">mask4</span>&nbsp;<span class="op" id="1742012">=</span>&nbsp;<span class="num" id="1742014">0x07</span>&nbsp;<span class="comment" id="1742019">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742034">rune1Max</span>&nbsp;<span class="op" id="1742043">=</span>&nbsp;<span class="num" id="1742045">1</span><span class="op" id="1742046">&lt;&lt;</span><span class="num" id="1742048">7</span>&nbsp;<span class="op" id="1742050">-</span>&nbsp;<span class="num" id="1742052">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742055">rune2Max</span>&nbsp;<span class="op" id="1742064">=</span>&nbsp;<span class="num" id="1742066">1</span><span class="op" id="1742067">&lt;&lt;</span><span class="num" id="1742069">11</span>&nbsp;<span class="op" id="1742072">-</span>&nbsp;<span class="num" id="1742074">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742077">rune3Max</span>&nbsp;<span class="op" id="1742086">=</span>&nbsp;<span class="num" id="1742088">1</span><span class="op" id="1742089">&lt;&lt;</span><span class="num" id="1742091">16</span>&nbsp;<span class="op" id="1742094">-</span>&nbsp;<span class="num" id="1742096">1</span><br>
<span class="lineno"></span><span class="op" id="1742098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1742101">func</span>&nbsp;<span class="ident" id="1742106">decodeRuneInternal</span><span class="op" id="1742124">(</span><span class="ident" id="1742125">p</span>&nbsp;<span class="op" id="1742127">[</span><span class="op" id="1742128">]</span><span class="builtintype" id="1742129">byte</span><span class="op" id="1742133">)</span>&nbsp;<span class="op" id="1742135">(</span><span class="ident" id="1742136">r</span>&nbsp;<span class="builtintype" id="1742138">rune</span><span class="op" id="1742142">,</span>&nbsp;<span class="ident" id="1742144">size</span>&nbsp;<span class="builtintype" id="1742149">int</span><span class="op" id="1742152">,</span>&nbsp;<span class="ident" id="1742154">short</span>&nbsp;<span class="builtintype" id="1742160">bool</span><span class="op" id="1742164">)</span>&nbsp;<span class="op" id="1742166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742169">n</span>&nbsp;<span class="op" id="1742171">:=</span>&nbsp;<span class="builtinfunc" id="1742174">len</span><span class="op" id="1742177">(</span><span class="ident" id="1742178">p</span><span class="op" id="1742179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742182">if</span>&nbsp;<span class="ident" id="1742185">n</span>&nbsp;<span class="op" id="1742187">&lt;</span>&nbsp;<span class="num" id="1742189">1</span>&nbsp;<span class="op" id="1742191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742195">return</span>&nbsp;<span class="ident" id="1742202">RuneError</span><span class="op" id="1742211">,</span>&nbsp;<span class="num" id="1742213">0</span><span class="op" id="1742214">,</span>&nbsp;<span class="builtintype" id="1742216">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742222">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742225">c0</span>&nbsp;<span class="op" id="1742228">:=</span>&nbsp;<span class="ident" id="1742231">p</span><span class="op" id="1742232">[</span><span class="num" id="1742233">0</span><span class="op" id="1742234">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742238">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742266">if</span>&nbsp;<span class="ident" id="1742269">c0</span>&nbsp;<span class="op" id="1742272">&lt;</span>&nbsp;<span class="ident" id="1742274">tx</span>&nbsp;<span class="op" id="1742277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742281">return</span>&nbsp;<span class="builtintype" id="1742288">rune</span><span class="op" id="1742292">(</span><span class="ident" id="1742293">c0</span><span class="op" id="1742295">)</span><span class="op" id="1742296">,</span>&nbsp;<span class="num" id="1742298">1</span><span class="op" id="1742299">,</span>&nbsp;<span class="builtintype" id="1742301">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742312">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742346">if</span>&nbsp;<span class="ident" id="1742349">c0</span>&nbsp;<span class="op" id="1742352">&lt;</span>&nbsp;<span class="ident" id="1742354">t2</span>&nbsp;<span class="op" id="1742357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742361">return</span>&nbsp;<span class="ident" id="1742368">RuneError</span><span class="op" id="1742377">,</span>&nbsp;<span class="num" id="1742379">1</span><span class="op" id="1742380">,</span>&nbsp;<span class="builtintype" id="1742382">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742393">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742426">if</span>&nbsp;<span class="ident" id="1742429">n</span>&nbsp;<span class="op" id="1742431">&lt;</span>&nbsp;<span class="num" id="1742433">2</span>&nbsp;<span class="op" id="1742435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742439">return</span>&nbsp;<span class="ident" id="1742446">RuneError</span><span class="op" id="1742455">,</span>&nbsp;<span class="num" id="1742457">1</span><span class="op" id="1742458">,</span>&nbsp;<span class="builtintype" id="1742460">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742469">c1</span>&nbsp;<span class="op" id="1742472">:=</span>&nbsp;<span class="ident" id="1742475">p</span><span class="op" id="1742476">[</span><span class="num" id="1742477">1</span><span class="op" id="1742478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742481">if</span>&nbsp;<span class="ident" id="1742484">c1</span>&nbsp;<span class="op" id="1742487">&lt;</span>&nbsp;<span class="ident" id="1742489">tx</span>&nbsp;<span class="op" id="1742492">||</span>&nbsp;<span class="ident" id="1742495">t2</span>&nbsp;<span class="op" id="1742498">&lt;=</span>&nbsp;<span class="ident" id="1742501">c1</span>&nbsp;<span class="op" id="1742504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742508">return</span>&nbsp;<span class="ident" id="1742515">RuneError</span><span class="op" id="1742524">,</span>&nbsp;<span class="num" id="1742526">1</span><span class="op" id="1742527">,</span>&nbsp;<span class="builtintype" id="1742529">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742536">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742540">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742569">if</span>&nbsp;<span class="ident" id="1742572">c0</span>&nbsp;<span class="op" id="1742575">&lt;</span>&nbsp;<span class="ident" id="1742577">t3</span>&nbsp;<span class="op" id="1742580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742584">r</span>&nbsp;<span class="op" id="1742586">=</span>&nbsp;<span class="builtintype" id="1742588">rune</span><span class="op" id="1742592">(</span><span class="ident" id="1742593">c0</span><span class="op" id="1742595">&amp;</span><span class="ident" id="1742596">mask2</span><span class="op" id="1742601">)</span><span class="op" id="1742602">&lt;&lt;</span><span class="num" id="1742604">6</span>&nbsp;<span class="op" id="1742606">|</span>&nbsp;<span class="builtintype" id="1742608">rune</span><span class="op" id="1742612">(</span><span class="ident" id="1742613">c1</span><span class="op" id="1742615">&amp;</span><span class="ident" id="1742616">maskx</span><span class="op" id="1742621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742625">if</span>&nbsp;<span class="ident" id="1742628">r</span>&nbsp;<span class="op" id="1742630">&lt;=</span>&nbsp;<span class="ident" id="1742633">rune1Max</span>&nbsp;<span class="op" id="1742642">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742647">return</span>&nbsp;<span class="ident" id="1742654">RuneError</span><span class="op" id="1742663">,</span>&nbsp;<span class="num" id="1742665">1</span><span class="op" id="1742666">,</span>&nbsp;<span class="builtintype" id="1742668">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742680">return</span>&nbsp;<span class="ident" id="1742687">r</span><span class="op" id="1742688">,</span>&nbsp;<span class="num" id="1742690">2</span><span class="op" id="1742691">,</span>&nbsp;<span class="builtintype" id="1742693">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742704">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742738">if</span>&nbsp;<span class="ident" id="1742741">n</span>&nbsp;<span class="op" id="1742743">&lt;</span>&nbsp;<span class="num" id="1742745">3</span>&nbsp;<span class="op" id="1742747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742751">return</span>&nbsp;<span class="ident" id="1742758">RuneError</span><span class="op" id="1742767">,</span>&nbsp;<span class="num" id="1742769">1</span><span class="op" id="1742770">,</span>&nbsp;<span class="builtintype" id="1742772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742781">c2</span>&nbsp;<span class="op" id="1742784">:=</span>&nbsp;<span class="ident" id="1742787">p</span><span class="op" id="1742788">[</span><span class="num" id="1742789">2</span><span class="op" id="1742790">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742793">if</span>&nbsp;<span class="ident" id="1742796">c2</span>&nbsp;<span class="op" id="1742799">&lt;</span>&nbsp;<span class="ident" id="1742801">tx</span>&nbsp;<span class="op" id="1742804">||</span>&nbsp;<span class="ident" id="1742807">t2</span>&nbsp;<span class="op" id="1742810">&lt;=</span>&nbsp;<span class="ident" id="1742813">c2</span>&nbsp;<span class="op" id="1742816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742820">return</span>&nbsp;<span class="ident" id="1742827">RuneError</span><span class="op" id="1742836">,</span>&nbsp;<span class="num" id="1742838">1</span><span class="op" id="1742839">,</span>&nbsp;<span class="builtintype" id="1742841">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1742848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1742852">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742881">if</span>&nbsp;<span class="ident" id="1742884">c0</span>&nbsp;<span class="op" id="1742887">&lt;</span>&nbsp;<span class="ident" id="1742889">t4</span>&nbsp;<span class="op" id="1742892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1742896">r</span>&nbsp;<span class="op" id="1742898">=</span>&nbsp;<span class="builtintype" id="1742900">rune</span><span class="op" id="1742904">(</span><span class="ident" id="1742905">c0</span><span class="op" id="1742907">&amp;</span><span class="ident" id="1742908">mask3</span><span class="op" id="1742913">)</span><span class="op" id="1742914">&lt;&lt;</span><span class="num" id="1742916">12</span>&nbsp;<span class="op" id="1742919">|</span>&nbsp;<span class="builtintype" id="1742921">rune</span><span class="op" id="1742925">(</span><span class="ident" id="1742926">c1</span><span class="op" id="1742928">&amp;</span><span class="ident" id="1742929">maskx</span><span class="op" id="1742934">)</span><span class="op" id="1742935">&lt;&lt;</span><span class="num" id="1742937">6</span>&nbsp;<span class="op" id="1742939">|</span>&nbsp;<span class="builtintype" id="1742941">rune</span><span class="op" id="1742945">(</span><span class="ident" id="1742946">c2</span><span class="op" id="1742948">&amp;</span><span class="ident" id="1742949">maskx</span><span class="op" id="1742954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742958">if</span>&nbsp;<span class="ident" id="1742961">r</span>&nbsp;<span class="op" id="1742963">&lt;=</span>&nbsp;<span class="ident" id="1742966">rune2Max</span>&nbsp;<span class="op" id="1742975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1742980">return</span>&nbsp;<span class="ident" id="1742987">RuneError</span><span class="op" id="1742996">,</span>&nbsp;<span class="num" id="1742998">1</span><span class="op" id="1742999">,</span>&nbsp;<span class="builtintype" id="1743001">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743009">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743013">if</span>&nbsp;<span class="ident" id="1743016">surrogateMin</span>&nbsp;<span class="op" id="1743029">&lt;=</span>&nbsp;<span class="ident" id="1743032">r</span>&nbsp;<span class="op" id="1743034">&amp;&amp;</span>&nbsp;<span class="ident" id="1743037">r</span>&nbsp;<span class="op" id="1743039">&lt;=</span>&nbsp;<span class="ident" id="1743042">surrogateMax</span>&nbsp;<span class="op" id="1743055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743060">return</span>&nbsp;<span class="ident" id="1743067">RuneError</span><span class="op" id="1743076">,</span>&nbsp;<span class="num" id="1743078">1</span><span class="op" id="1743079">,</span>&nbsp;<span class="builtintype" id="1743081">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743093">return</span>&nbsp;<span class="ident" id="1743100">r</span><span class="op" id="1743101">,</span>&nbsp;<span class="num" id="1743103">3</span><span class="op" id="1743104">,</span>&nbsp;<span class="builtintype" id="1743106">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743113">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743117">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743150">if</span>&nbsp;<span class="ident" id="1743153">n</span>&nbsp;<span class="op" id="1743155">&lt;</span>&nbsp;<span class="num" id="1743157">4</span>&nbsp;<span class="op" id="1743159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743163">return</span>&nbsp;<span class="ident" id="1743170">RuneError</span><span class="op" id="1743179">,</span>&nbsp;<span class="num" id="1743181">1</span><span class="op" id="1743182">,</span>&nbsp;<span class="builtintype" id="1743184">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743190">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743193">c3</span>&nbsp;<span class="op" id="1743196">:=</span>&nbsp;<span class="ident" id="1743199">p</span><span class="op" id="1743200">[</span><span class="num" id="1743201">3</span><span class="op" id="1743202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743205">if</span>&nbsp;<span class="ident" id="1743208">c3</span>&nbsp;<span class="op" id="1743211">&lt;</span>&nbsp;<span class="ident" id="1743213">tx</span>&nbsp;<span class="op" id="1743216">||</span>&nbsp;<span class="ident" id="1743219">t2</span>&nbsp;<span class="op" id="1743222">&lt;=</span>&nbsp;<span class="ident" id="1743225">c3</span>&nbsp;<span class="op" id="1743228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743232">return</span>&nbsp;<span class="ident" id="1743239">RuneError</span><span class="op" id="1743248">,</span>&nbsp;<span class="num" id="1743250">1</span><span class="op" id="1743251">,</span>&nbsp;<span class="builtintype" id="1743253">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743264">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743293">if</span>&nbsp;<span class="ident" id="1743296">c0</span>&nbsp;<span class="op" id="1743299">&lt;</span>&nbsp;<span class="ident" id="1743301">t5</span>&nbsp;<span class="op" id="1743304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743308">r</span>&nbsp;<span class="op" id="1743310">=</span>&nbsp;<span class="builtintype" id="1743312">rune</span><span class="op" id="1743316">(</span><span class="ident" id="1743317">c0</span><span class="op" id="1743319">&amp;</span><span class="ident" id="1743320">mask4</span><span class="op" id="1743325">)</span><span class="op" id="1743326">&lt;&lt;</span><span class="num" id="1743328">18</span>&nbsp;<span class="op" id="1743331">|</span>&nbsp;<span class="builtintype" id="1743333">rune</span><span class="op" id="1743337">(</span><span class="ident" id="1743338">c1</span><span class="op" id="1743340">&amp;</span><span class="ident" id="1743341">maskx</span><span class="op" id="1743346">)</span><span class="op" id="1743347">&lt;&lt;</span><span class="num" id="1743349">12</span>&nbsp;<span class="op" id="1743352">|</span>&nbsp;<span class="builtintype" id="1743354">rune</span><span class="op" id="1743358">(</span><span class="ident" id="1743359">c2</span><span class="op" id="1743361">&amp;</span><span class="ident" id="1743362">maskx</span><span class="op" id="1743367">)</span><span class="op" id="1743368">&lt;&lt;</span><span class="num" id="1743370">6</span>&nbsp;<span class="op" id="1743372">|</span>&nbsp;<span class="builtintype" id="1743374">rune</span><span class="op" id="1743378">(</span><span class="ident" id="1743379">c3</span><span class="op" id="1743381">&amp;</span><span class="ident" id="1743382">maskx</span><span class="op" id="1743387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743391">if</span>&nbsp;<span class="ident" id="1743394">r</span>&nbsp;<span class="op" id="1743396">&lt;=</span>&nbsp;<span class="ident" id="1743399">rune3Max</span>&nbsp;<span class="op" id="1743408">||</span>&nbsp;<span class="ident" id="1743411">MaxRune</span>&nbsp;<span class="op" id="1743419">&lt;</span>&nbsp;<span class="ident" id="1743421">r</span>&nbsp;<span class="op" id="1743423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743428">return</span>&nbsp;<span class="ident" id="1743435">RuneError</span><span class="op" id="1743444">,</span>&nbsp;<span class="num" id="1743446">1</span><span class="op" id="1743447">,</span>&nbsp;<span class="builtintype" id="1743449">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743461">return</span>&nbsp;<span class="ident" id="1743468">r</span><span class="op" id="1743469">,</span>&nbsp;<span class="num" id="1743471">4</span><span class="op" id="1743472">,</span>&nbsp;<span class="builtintype" id="1743474">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743485">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743495">return</span>&nbsp;<span class="ident" id="1743502">RuneError</span><span class="op" id="1743511">,</span>&nbsp;<span class="num" id="1743513">1</span><span class="op" id="1743514">,</span>&nbsp;<span class="builtintype" id="1743516">false</span><br>
<span class="lineno"></span><span class="op" id="1743522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1743525">func</span>&nbsp;<span class="ident" id="1743530">decodeRuneInStringInternal</span><span class="op" id="1743556">(</span><span class="ident" id="1743557">s</span>&nbsp;<span class="builtintype" id="1743559">string</span><span class="op" id="1743565">)</span>&nbsp;<span class="op" id="1743567">(</span><span class="ident" id="1743568">r</span>&nbsp;<span class="builtintype" id="1743570">rune</span><span class="op" id="1743574">,</span>&nbsp;<span class="ident" id="1743576">size</span>&nbsp;<span class="builtintype" id="1743581">int</span><span class="op" id="1743584">,</span>&nbsp;<span class="ident" id="1743586">short</span>&nbsp;<span class="builtintype" id="1743592">bool</span><span class="op" id="1743596">)</span>&nbsp;<span class="op" id="1743598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743601">n</span>&nbsp;<span class="op" id="1743603">:=</span>&nbsp;<span class="builtinfunc" id="1743606">len</span><span class="op" id="1743609">(</span><span class="ident" id="1743610">s</span><span class="op" id="1743611">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743614">if</span>&nbsp;<span class="ident" id="1743617">n</span>&nbsp;<span class="op" id="1743619">&lt;</span>&nbsp;<span class="num" id="1743621">1</span>&nbsp;<span class="op" id="1743623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743627">return</span>&nbsp;<span class="ident" id="1743634">RuneError</span><span class="op" id="1743643">,</span>&nbsp;<span class="num" id="1743645">0</span><span class="op" id="1743646">,</span>&nbsp;<span class="builtintype" id="1743648">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743657">c0</span>&nbsp;<span class="op" id="1743660">:=</span>&nbsp;<span class="ident" id="1743663">s</span><span class="op" id="1743664">[</span><span class="num" id="1743665">0</span><span class="op" id="1743666">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743670">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743698">if</span>&nbsp;<span class="ident" id="1743701">c0</span>&nbsp;<span class="op" id="1743704">&lt;</span>&nbsp;<span class="ident" id="1743706">tx</span>&nbsp;<span class="op" id="1743709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743713">return</span>&nbsp;<span class="builtintype" id="1743720">rune</span><span class="op" id="1743724">(</span><span class="ident" id="1743725">c0</span><span class="op" id="1743727">)</span><span class="op" id="1743728">,</span>&nbsp;<span class="num" id="1743730">1</span><span class="op" id="1743731">,</span>&nbsp;<span class="builtintype" id="1743733">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743744">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743778">if</span>&nbsp;<span class="ident" id="1743781">c0</span>&nbsp;<span class="op" id="1743784">&lt;</span>&nbsp;<span class="ident" id="1743786">t2</span>&nbsp;<span class="op" id="1743789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743793">return</span>&nbsp;<span class="ident" id="1743800">RuneError</span><span class="op" id="1743809">,</span>&nbsp;<span class="num" id="1743811">1</span><span class="op" id="1743812">,</span>&nbsp;<span class="builtintype" id="1743814">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743825">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743858">if</span>&nbsp;<span class="ident" id="1743861">n</span>&nbsp;<span class="op" id="1743863">&lt;</span>&nbsp;<span class="num" id="1743865">2</span>&nbsp;<span class="op" id="1743867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743871">return</span>&nbsp;<span class="ident" id="1743878">RuneError</span><span class="op" id="1743887">,</span>&nbsp;<span class="num" id="1743889">1</span><span class="op" id="1743890">,</span>&nbsp;<span class="builtintype" id="1743892">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1743901">c1</span>&nbsp;<span class="op" id="1743904">:=</span>&nbsp;<span class="ident" id="1743907">s</span><span class="op" id="1743908">[</span><span class="num" id="1743909">1</span><span class="op" id="1743910">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743913">if</span>&nbsp;<span class="ident" id="1743916">c1</span>&nbsp;<span class="op" id="1743919">&lt;</span>&nbsp;<span class="ident" id="1743921">tx</span>&nbsp;<span class="op" id="1743924">||</span>&nbsp;<span class="ident" id="1743927">t2</span>&nbsp;<span class="op" id="1743930">&lt;=</span>&nbsp;<span class="ident" id="1743933">c1</span>&nbsp;<span class="op" id="1743936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1743940">return</span>&nbsp;<span class="ident" id="1743947">RuneError</span><span class="op" id="1743956">,</span>&nbsp;<span class="num" id="1743958">1</span><span class="op" id="1743959">,</span>&nbsp;<span class="builtintype" id="1743961">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1743968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1743972">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744001">if</span>&nbsp;<span class="ident" id="1744004">c0</span>&nbsp;<span class="op" id="1744007">&lt;</span>&nbsp;<span class="ident" id="1744009">t3</span>&nbsp;<span class="op" id="1744012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1744016">r</span>&nbsp;<span class="op" id="1744018">=</span>&nbsp;<span class="builtintype" id="1744020">rune</span><span class="op" id="1744024">(</span><span class="ident" id="1744025">c0</span><span class="op" id="1744027">&amp;</span><span class="ident" id="1744028">mask2</span><span class="op" id="1744033">)</span><span class="op" id="1744034">&lt;&lt;</span><span class="num" id="1744036">6</span>&nbsp;<span class="op" id="1744038">|</span>&nbsp;<span class="builtintype" id="1744040">rune</span><span class="op" id="1744044">(</span><span class="ident" id="1744045">c1</span><span class="op" id="1744047">&amp;</span><span class="ident" id="1744048">maskx</span><span class="op" id="1744053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744057">if</span>&nbsp;<span class="ident" id="1744060">r</span>&nbsp;<span class="op" id="1744062">&lt;=</span>&nbsp;<span class="ident" id="1744065">rune1Max</span>&nbsp;<span class="op" id="1744074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744079">return</span>&nbsp;<span class="ident" id="1744086">RuneError</span><span class="op" id="1744095">,</span>&nbsp;<span class="num" id="1744097">1</span><span class="op" id="1744098">,</span>&nbsp;<span class="builtintype" id="1744100">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744108">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744112">return</span>&nbsp;<span class="ident" id="1744119">r</span><span class="op" id="1744120">,</span>&nbsp;<span class="num" id="1744122">2</span><span class="op" id="1744123">,</span>&nbsp;<span class="builtintype" id="1744125">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1744136">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744170">if</span>&nbsp;<span class="ident" id="1744173">n</span>&nbsp;<span class="op" id="1744175">&lt;</span>&nbsp;<span class="num" id="1744177">3</span>&nbsp;<span class="op" id="1744179">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744183">return</span>&nbsp;<span class="ident" id="1744190">RuneError</span><span class="op" id="1744199">,</span>&nbsp;<span class="num" id="1744201">1</span><span class="op" id="1744202">,</span>&nbsp;<span class="builtintype" id="1744204">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1744213">c2</span>&nbsp;<span class="op" id="1744216">:=</span>&nbsp;<span class="ident" id="1744219">s</span><span class="op" id="1744220">[</span><span class="num" id="1744221">2</span><span class="op" id="1744222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744225">if</span>&nbsp;<span class="ident" id="1744228">c2</span>&nbsp;<span class="op" id="1744231">&lt;</span>&nbsp;<span class="ident" id="1744233">tx</span>&nbsp;<span class="op" id="1744236">||</span>&nbsp;<span class="ident" id="1744239">t2</span>&nbsp;<span class="op" id="1744242">&lt;=</span>&nbsp;<span class="ident" id="1744245">c2</span>&nbsp;<span class="op" id="1744248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744252">return</span>&nbsp;<span class="ident" id="1744259">RuneError</span><span class="op" id="1744268">,</span>&nbsp;<span class="num" id="1744270">1</span><span class="op" id="1744271">,</span>&nbsp;<span class="builtintype" id="1744273">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1744284">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744313">if</span>&nbsp;<span class="ident" id="1744316">c0</span>&nbsp;<span class="op" id="1744319">&lt;</span>&nbsp;<span class="ident" id="1744321">t4</span>&nbsp;<span class="op" id="1744324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1744328">r</span>&nbsp;<span class="op" id="1744330">=</span>&nbsp;<span class="builtintype" id="1744332">rune</span><span class="op" id="1744336">(</span><span class="ident" id="1744337">c0</span><span class="op" id="1744339">&amp;</span><span class="ident" id="1744340">mask3</span><span class="op" id="1744345">)</span><span class="op" id="1744346">&lt;&lt;</span><span class="num" id="1744348">12</span>&nbsp;<span class="op" id="1744351">|</span>&nbsp;<span class="builtintype" id="1744353">rune</span><span class="op" id="1744357">(</span><span class="ident" id="1744358">c1</span><span class="op" id="1744360">&amp;</span><span class="ident" id="1744361">maskx</span><span class="op" id="1744366">)</span><span class="op" id="1744367">&lt;&lt;</span><span class="num" id="1744369">6</span>&nbsp;<span class="op" id="1744371">|</span>&nbsp;<span class="builtintype" id="1744373">rune</span><span class="op" id="1744377">(</span><span class="ident" id="1744378">c2</span><span class="op" id="1744380">&amp;</span><span class="ident" id="1744381">maskx</span><span class="op" id="1744386">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744390">if</span>&nbsp;<span class="ident" id="1744393">r</span>&nbsp;<span class="op" id="1744395">&lt;=</span>&nbsp;<span class="ident" id="1744398">rune2Max</span>&nbsp;<span class="op" id="1744407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744412">return</span>&nbsp;<span class="ident" id="1744419">RuneError</span><span class="op" id="1744428">,</span>&nbsp;<span class="num" id="1744430">1</span><span class="op" id="1744431">,</span>&nbsp;<span class="builtintype" id="1744433">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744445">if</span>&nbsp;<span class="ident" id="1744448">surrogateMin</span>&nbsp;<span class="op" id="1744461">&lt;=</span>&nbsp;<span class="ident" id="1744464">r</span>&nbsp;<span class="op" id="1744466">&amp;&amp;</span>&nbsp;<span class="ident" id="1744469">r</span>&nbsp;<span class="op" id="1744471">&lt;=</span>&nbsp;<span class="ident" id="1744474">surrogateMax</span>&nbsp;<span class="op" id="1744487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744492">return</span>&nbsp;<span class="ident" id="1744499">RuneError</span><span class="op" id="1744508">,</span>&nbsp;<span class="num" id="1744510">1</span><span class="op" id="1744511">,</span>&nbsp;<span class="builtintype" id="1744513">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744525">return</span>&nbsp;<span class="ident" id="1744532">r</span><span class="op" id="1744533">,</span>&nbsp;<span class="num" id="1744535">3</span><span class="op" id="1744536">,</span>&nbsp;<span class="builtintype" id="1744538">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1744549">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744582">if</span>&nbsp;<span class="ident" id="1744585">n</span>&nbsp;<span class="op" id="1744587">&lt;</span>&nbsp;<span class="num" id="1744589">4</span>&nbsp;<span class="op" id="1744591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744595">return</span>&nbsp;<span class="ident" id="1744602">RuneError</span><span class="op" id="1744611">,</span>&nbsp;<span class="num" id="1744613">1</span><span class="op" id="1744614">,</span>&nbsp;<span class="builtintype" id="1744616">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1744625">c3</span>&nbsp;<span class="op" id="1744628">:=</span>&nbsp;<span class="ident" id="1744631">s</span><span class="op" id="1744632">[</span><span class="num" id="1744633">3</span><span class="op" id="1744634">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744637">if</span>&nbsp;<span class="ident" id="1744640">c3</span>&nbsp;<span class="op" id="1744643">&lt;</span>&nbsp;<span class="ident" id="1744645">tx</span>&nbsp;<span class="op" id="1744648">||</span>&nbsp;<span class="ident" id="1744651">t2</span>&nbsp;<span class="op" id="1744654">&lt;=</span>&nbsp;<span class="ident" id="1744657">c3</span>&nbsp;<span class="op" id="1744660">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744664">return</span>&nbsp;<span class="ident" id="1744671">RuneError</span><span class="op" id="1744680">,</span>&nbsp;<span class="num" id="1744682">1</span><span class="op" id="1744683">,</span>&nbsp;<span class="builtintype" id="1744685">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1744696">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744725">if</span>&nbsp;<span class="ident" id="1744728">c0</span>&nbsp;<span class="op" id="1744731">&lt;</span>&nbsp;<span class="ident" id="1744733">t5</span>&nbsp;<span class="op" id="1744736">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1744740">r</span>&nbsp;<span class="op" id="1744742">=</span>&nbsp;<span class="builtintype" id="1744744">rune</span><span class="op" id="1744748">(</span><span class="ident" id="1744749">c0</span><span class="op" id="1744751">&amp;</span><span class="ident" id="1744752">mask4</span><span class="op" id="1744757">)</span><span class="op" id="1744758">&lt;&lt;</span><span class="num" id="1744760">18</span>&nbsp;<span class="op" id="1744763">|</span>&nbsp;<span class="builtintype" id="1744765">rune</span><span class="op" id="1744769">(</span><span class="ident" id="1744770">c1</span><span class="op" id="1744772">&amp;</span><span class="ident" id="1744773">maskx</span><span class="op" id="1744778">)</span><span class="op" id="1744779">&lt;&lt;</span><span class="num" id="1744781">12</span>&nbsp;<span class="op" id="1744784">|</span>&nbsp;<span class="builtintype" id="1744786">rune</span><span class="op" id="1744790">(</span><span class="ident" id="1744791">c2</span><span class="op" id="1744793">&amp;</span><span class="ident" id="1744794">maskx</span><span class="op" id="1744799">)</span><span class="op" id="1744800">&lt;&lt;</span><span class="num" id="1744802">6</span>&nbsp;<span class="op" id="1744804">|</span>&nbsp;<span class="builtintype" id="1744806">rune</span><span class="op" id="1744810">(</span><span class="ident" id="1744811">c3</span><span class="op" id="1744813">&amp;</span><span class="ident" id="1744814">maskx</span><span class="op" id="1744819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744823">if</span>&nbsp;<span class="ident" id="1744826">r</span>&nbsp;<span class="op" id="1744828">&lt;=</span>&nbsp;<span class="ident" id="1744831">rune3Max</span>&nbsp;<span class="op" id="1744840">||</span>&nbsp;<span class="ident" id="1744843">MaxRune</span>&nbsp;<span class="op" id="1744851">&lt;</span>&nbsp;<span class="ident" id="1744853">r</span>&nbsp;<span class="op" id="1744855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744860">return</span>&nbsp;<span class="ident" id="1744867">RuneError</span><span class="op" id="1744876">,</span>&nbsp;<span class="num" id="1744878">1</span><span class="op" id="1744879">,</span>&nbsp;<span class="builtintype" id="1744881">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744893">return</span>&nbsp;<span class="ident" id="1744900">r</span><span class="op" id="1744901">,</span>&nbsp;<span class="num" id="1744903">4</span><span class="op" id="1744904">,</span>&nbsp;<span class="builtintype" id="1744906">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1744913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1744917">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1744927">return</span>&nbsp;<span class="ident" id="1744934">RuneError</span><span class="op" id="1744943">,</span>&nbsp;<span class="num" id="1744945">1</span><span class="op" id="1744946">,</span>&nbsp;<span class="builtintype" id="1744948">false</span><br>
<span class="lineno"></span><span class="op" id="1744954">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1744957">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1745044">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1745140">func</span>&nbsp;<span class="ident" id="1745145">FullRune</span><span class="op" id="1745153">(</span><span class="ident" id="1745154">p</span>&nbsp;<span class="op" id="1745156">[</span><span class="op" id="1745157">]</span><span class="builtintype" id="1745158">byte</span><span class="op" id="1745162">)</span>&nbsp;<span class="builtintype" id="1745164">bool</span>&nbsp;<span class="op" id="1745169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1745172">_</span><span class="op" id="1745173">,</span>&nbsp;<span class="ident" id="1745175">_</span><span class="op" id="1745176">,</span>&nbsp;<span class="ident" id="1745178">short</span>&nbsp;<span class="op" id="1745184">:=</span>&nbsp;<span class="ident" id="1745187">decodeRuneInternal</span><span class="op" id="1745205">(</span><span class="ident" id="1745206">p</span><span class="op" id="1745207">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1745210">return</span>&nbsp;<span class="op" id="1745217">!</span><span class="ident" id="1745218">short</span><br>
<span class="lineno"></span><span class="op" id="1745224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1745227">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1745291">func</span>&nbsp;<span class="ident" id="1745296">FullRuneInString</span><span class="op" id="1745312">(</span><span class="ident" id="1745313">s</span>&nbsp;<span class="builtintype" id="1745315">string</span><span class="op" id="1745321">)</span>&nbsp;<span class="builtintype" id="1745323">bool</span>&nbsp;<span class="op" id="1745328">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1745331">_</span><span class="op" id="1745332">,</span>&nbsp;<span class="ident" id="1745334">_</span><span class="op" id="1745335">,</span>&nbsp;<span class="ident" id="1745337">short</span>&nbsp;<span class="op" id="1745343">:=</span>&nbsp;<span class="ident" id="1745346">decodeRuneInStringInternal</span><span class="op" id="1745372">(</span><span class="ident" id="1745373">s</span><span class="op" id="1745374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1745377">return</span>&nbsp;<span class="op" id="1745384">!</span><span class="ident" id="1745385">short</span><br>
<span class="lineno"></span><span class="op" id="1745391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1745394">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1745471">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1745549">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1745624">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1745654">//</span><br>
<span class="lineno"></span><span class="comment" id="1745657">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1745732">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1745804">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1745848">func</span>&nbsp;<span class="ident" id="1745853">DecodeRune</span><span class="op" id="1745863">(</span><span class="ident" id="1745864">p</span>&nbsp;<span class="op" id="1745866">[</span><span class="op" id="1745867">]</span><span class="builtintype" id="1745868">byte</span><span class="op" id="1745872">)</span>&nbsp;<span class="op" id="1745874">(</span><span class="ident" id="1745875">r</span>&nbsp;<span class="builtintype" id="1745877">rune</span><span class="op" id="1745881">,</span>&nbsp;<span class="ident" id="1745883">size</span>&nbsp;<span class="builtintype" id="1745888">int</span><span class="op" id="1745891">)</span>&nbsp;<span class="op" id="1745893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1745896">r</span><span class="op" id="1745897">,</span>&nbsp;<span class="ident" id="1745899">size</span><span class="op" id="1745903">,</span>&nbsp;<span class="ident" id="1745905">_</span>&nbsp;<span class="op" id="1745907">=</span>&nbsp;<span class="ident" id="1745909">decodeRuneInternal</span><span class="op" id="1745927">(</span><span class="ident" id="1745928">p</span><span class="op" id="1745929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1745932">return</span><br>
<span class="lineno">225</span><span class="op" id="1745939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1745942">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1746018">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1746096">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1746170">//</span><br>
<span class="lineno"></span><span class="comment" id="1746173">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1746248">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1746320">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1746364">func</span>&nbsp;<span class="ident" id="1746369">DecodeRuneInString</span><span class="op" id="1746387">(</span><span class="ident" id="1746388">s</span>&nbsp;<span class="builtintype" id="1746390">string</span><span class="op" id="1746396">)</span>&nbsp;<span class="op" id="1746398">(</span><span class="ident" id="1746399">r</span>&nbsp;<span class="builtintype" id="1746401">rune</span><span class="op" id="1746405">,</span>&nbsp;<span class="ident" id="1746407">size</span>&nbsp;<span class="builtintype" id="1746412">int</span><span class="op" id="1746415">)</span>&nbsp;<span class="op" id="1746417">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1746420">r</span><span class="op" id="1746421">,</span>&nbsp;<span class="ident" id="1746423">size</span><span class="op" id="1746427">,</span>&nbsp;<span class="ident" id="1746429">_</span>&nbsp;<span class="op" id="1746431">=</span>&nbsp;<span class="ident" id="1746433">decodeRuneInStringInternal</span><span class="op" id="1746459">(</span><span class="ident" id="1746460">s</span><span class="op" id="1746461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1746464">return</span><br>
<span class="lineno"></span><span class="op" id="1746471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1746474">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1746554">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1746632">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1746707">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1746737">//</span><br>
<span class="lineno"></span><span class="comment" id="1746740">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1746815">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1746887">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1746931">func</span>&nbsp;<span class="ident" id="1746936">DecodeLastRune</span><span class="op" id="1746950">(</span><span class="ident" id="1746951">p</span>&nbsp;<span class="op" id="1746953">[</span><span class="op" id="1746954">]</span><span class="builtintype" id="1746955">byte</span><span class="op" id="1746959">)</span>&nbsp;<span class="op" id="1746961">(</span><span class="ident" id="1746962">r</span>&nbsp;<span class="builtintype" id="1746964">rune</span><span class="op" id="1746968">,</span>&nbsp;<span class="ident" id="1746970">size</span>&nbsp;<span class="builtintype" id="1746975">int</span><span class="op" id="1746978">)</span>&nbsp;<span class="op" id="1746980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1746983">end</span>&nbsp;<span class="op" id="1746987">:=</span>&nbsp;<span class="builtinfunc" id="1746990">len</span><span class="op" id="1746993">(</span><span class="ident" id="1746994">p</span><span class="op" id="1746995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1746998">if</span>&nbsp;<span class="ident" id="1747001">end</span>&nbsp;<span class="op" id="1747005">==</span>&nbsp;<span class="num" id="1747008">0</span>&nbsp;<span class="op" id="1747010">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747014">return</span>&nbsp;<span class="ident" id="1747021">RuneError</span><span class="op" id="1747030">,</span>&nbsp;<span class="num" id="1747032">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747038">start</span>&nbsp;<span class="op" id="1747044">:=</span>&nbsp;<span class="ident" id="1747047">end</span>&nbsp;<span class="op" id="1747051">-</span>&nbsp;<span class="num" id="1747053">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747056">r</span>&nbsp;<span class="op" id="1747058">=</span>&nbsp;<span class="builtintype" id="1747060">rune</span><span class="op" id="1747064">(</span><span class="ident" id="1747065">p</span><span class="op" id="1747066">[</span><span class="ident" id="1747067">start</span><span class="op" id="1747072">]</span><span class="op" id="1747073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747076">if</span>&nbsp;<span class="ident" id="1747079">r</span>&nbsp;<span class="op" id="1747081">&lt;</span>&nbsp;<span class="ident" id="1747083">RuneSelf</span>&nbsp;<span class="op" id="1747092">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747096">return</span>&nbsp;<span class="ident" id="1747103">r</span><span class="op" id="1747104">,</span>&nbsp;<span class="num" id="1747106">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1747112">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1747162">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1747215">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747234">lim</span>&nbsp;<span class="op" id="1747238">:=</span>&nbsp;<span class="ident" id="1747241">end</span>&nbsp;<span class="op" id="1747245">-</span>&nbsp;<span class="ident" id="1747247">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747255">if</span>&nbsp;<span class="ident" id="1747258">lim</span>&nbsp;<span class="op" id="1747262">&lt;</span>&nbsp;<span class="num" id="1747264">0</span>&nbsp;<span class="op" id="1747266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747270">lim</span>&nbsp;<span class="op" id="1747274">=</span>&nbsp;<span class="num" id="1747276">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747282">for</span>&nbsp;<span class="ident" id="1747286">start</span><span class="op" id="1747291">--</span><span class="op" id="1747293">;</span>&nbsp;<span class="ident" id="1747295">start</span>&nbsp;<span class="op" id="1747301">&gt;=</span>&nbsp;<span class="ident" id="1747304">lim</span><span class="op" id="1747307">;</span>&nbsp;<span class="ident" id="1747309">start</span><span class="op" id="1747314">--</span>&nbsp;<span class="op" id="1747317">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747321">if</span>&nbsp;<span class="ident" id="1747324">RuneStart</span><span class="op" id="1747333">(</span><span class="ident" id="1747334">p</span><span class="op" id="1747335">[</span><span class="ident" id="1747336">start</span><span class="op" id="1747341">]</span><span class="op" id="1747342">)</span>&nbsp;<span class="op" id="1747344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747349">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747363">if</span>&nbsp;<span class="ident" id="1747366">start</span>&nbsp;<span class="op" id="1747372">&lt;</span>&nbsp;<span class="num" id="1747374">0</span>&nbsp;<span class="op" id="1747376">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747380">start</span>&nbsp;<span class="op" id="1747386">=</span>&nbsp;<span class="num" id="1747388">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747394">r</span><span class="op" id="1747395">,</span>&nbsp;<span class="ident" id="1747397">size</span>&nbsp;<span class="op" id="1747402">=</span>&nbsp;<span class="ident" id="1747404">DecodeRune</span><span class="op" id="1747414">(</span><span class="ident" id="1747415">p</span><span class="op" id="1747416">[</span><span class="ident" id="1747417">start</span><span class="op" id="1747422">:</span><span class="ident" id="1747423">end</span><span class="op" id="1747426">]</span><span class="op" id="1747427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747430">if</span>&nbsp;<span class="ident" id="1747433">start</span><span class="op" id="1747438">+</span><span class="ident" id="1747439">size</span>&nbsp;<span class="op" id="1747444">!=</span>&nbsp;<span class="ident" id="1747447">end</span>&nbsp;<span class="op" id="1747451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747455">return</span>&nbsp;<span class="ident" id="1747462">RuneError</span><span class="op" id="1747471">,</span>&nbsp;<span class="num" id="1747473">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1747476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1747479">return</span>&nbsp;<span class="ident" id="1747486">r</span><span class="op" id="1747487">,</span>&nbsp;<span class="ident" id="1747489">size</span><br>
<span class="lineno"></span><span class="op" id="1747494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1747497">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1747576">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1747656">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1747733">//</span><br>
<span class="lineno"></span><span class="comment" id="1747736">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1747811">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1747883">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1747927">func</span>&nbsp;<span class="ident" id="1747932">DecodeLastRuneInString</span><span class="op" id="1747954">(</span><span class="ident" id="1747955">s</span>&nbsp;<span class="builtintype" id="1747957">string</span><span class="op" id="1747963">)</span>&nbsp;<span class="op" id="1747965">(</span><span class="ident" id="1747966">r</span>&nbsp;<span class="builtintype" id="1747968">rune</span><span class="op" id="1747972">,</span>&nbsp;<span class="ident" id="1747974">size</span>&nbsp;<span class="builtintype" id="1747979">int</span><span class="op" id="1747982">)</span>&nbsp;<span class="op" id="1747984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1747987">end</span>&nbsp;<span class="op" id="1747991">:=</span>&nbsp;<span class="builtinfunc" id="1747994">len</span><span class="op" id="1747997">(</span><span class="ident" id="1747998">s</span><span class="op" id="1747999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748002">if</span>&nbsp;<span class="ident" id="1748005">end</span>&nbsp;<span class="op" id="1748009">==</span>&nbsp;<span class="num" id="1748012">0</span>&nbsp;<span class="op" id="1748014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748018">return</span>&nbsp;<span class="ident" id="1748025">RuneError</span><span class="op" id="1748034">,</span>&nbsp;<span class="num" id="1748036">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1748042">start</span>&nbsp;<span class="op" id="1748048">:=</span>&nbsp;<span class="ident" id="1748051">end</span>&nbsp;<span class="op" id="1748055">-</span>&nbsp;<span class="num" id="1748057">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1748060">r</span>&nbsp;<span class="op" id="1748062">=</span>&nbsp;<span class="builtintype" id="1748064">rune</span><span class="op" id="1748068">(</span><span class="ident" id="1748069">s</span><span class="op" id="1748070">[</span><span class="ident" id="1748071">start</span><span class="op" id="1748076">]</span><span class="op" id="1748077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748080">if</span>&nbsp;<span class="ident" id="1748083">r</span>&nbsp;<span class="op" id="1748085">&lt;</span>&nbsp;<span class="ident" id="1748087">RuneSelf</span>&nbsp;<span class="op" id="1748096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748100">return</span>&nbsp;<span class="ident" id="1748107">r</span><span class="op" id="1748108">,</span>&nbsp;<span class="num" id="1748110">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1748116">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1748166">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1748219">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1748238">lim</span>&nbsp;<span class="op" id="1748242">:=</span>&nbsp;<span class="ident" id="1748245">end</span>&nbsp;<span class="op" id="1748249">-</span>&nbsp;<span class="ident" id="1748251">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748259">if</span>&nbsp;<span class="ident" id="1748262">lim</span>&nbsp;<span class="op" id="1748266">&lt;</span>&nbsp;<span class="num" id="1748268">0</span>&nbsp;<span class="op" id="1748270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1748274">lim</span>&nbsp;<span class="op" id="1748278">=</span>&nbsp;<span class="num" id="1748280">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748286">for</span>&nbsp;<span class="ident" id="1748290">start</span><span class="op" id="1748295">--</span><span class="op" id="1748297">;</span>&nbsp;<span class="ident" id="1748299">start</span>&nbsp;<span class="op" id="1748305">&gt;=</span>&nbsp;<span class="ident" id="1748308">lim</span><span class="op" id="1748311">;</span>&nbsp;<span class="ident" id="1748313">start</span><span class="op" id="1748318">--</span>&nbsp;<span class="op" id="1748321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748325">if</span>&nbsp;<span class="ident" id="1748328">RuneStart</span><span class="op" id="1748337">(</span><span class="ident" id="1748338">s</span><span class="op" id="1748339">[</span><span class="ident" id="1748340">start</span><span class="op" id="1748345">]</span><span class="op" id="1748346">)</span>&nbsp;<span class="op" id="1748348">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748353">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748367">if</span>&nbsp;<span class="ident" id="1748370">start</span>&nbsp;<span class="op" id="1748376">&lt;</span>&nbsp;<span class="num" id="1748378">0</span>&nbsp;<span class="op" id="1748380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1748384">start</span>&nbsp;<span class="op" id="1748390">=</span>&nbsp;<span class="num" id="1748392">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1748398">r</span><span class="op" id="1748399">,</span>&nbsp;<span class="ident" id="1748401">size</span>&nbsp;<span class="op" id="1748406">=</span>&nbsp;<span class="ident" id="1748408">DecodeRuneInString</span><span class="op" id="1748426">(</span><span class="ident" id="1748427">s</span><span class="op" id="1748428">[</span><span class="ident" id="1748429">start</span><span class="op" id="1748434">:</span><span class="ident" id="1748435">end</span><span class="op" id="1748438">]</span><span class="op" id="1748439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748442">if</span>&nbsp;<span class="ident" id="1748445">start</span><span class="op" id="1748450">+</span><span class="ident" id="1748451">size</span>&nbsp;<span class="op" id="1748456">!=</span>&nbsp;<span class="ident" id="1748459">end</span>&nbsp;<span class="op" id="1748463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748467">return</span>&nbsp;<span class="ident" id="1748474">RuneError</span><span class="op" id="1748483">,</span>&nbsp;<span class="num" id="1748485">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748488">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748491">return</span>&nbsp;<span class="ident" id="1748498">r</span><span class="op" id="1748499">,</span>&nbsp;<span class="ident" id="1748501">size</span><br>
<span class="lineno"></span><span class="op" id="1748506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1748509">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1748577">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1748647">func</span>&nbsp;<span class="ident" id="1748652">RuneLen</span><span class="op" id="1748659">(</span><span class="ident" id="1748660">r</span>&nbsp;<span class="builtintype" id="1748662">rune</span><span class="op" id="1748666">)</span>&nbsp;<span class="builtintype" id="1748668">int</span>&nbsp;<span class="op" id="1748672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748675">switch</span>&nbsp;<span class="op" id="1748682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748685">case</span>&nbsp;<span class="ident" id="1748690">r</span>&nbsp;<span class="op" id="1748692">&lt;</span>&nbsp;<span class="num" id="1748694">0</span><span class="op" id="1748695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748699">return</span>&nbsp;<span class="op" id="1748706">-</span><span class="num" id="1748707">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748710">case</span>&nbsp;<span class="ident" id="1748715">r</span>&nbsp;<span class="op" id="1748717">&lt;=</span>&nbsp;<span class="ident" id="1748720">rune1Max</span><span class="op" id="1748728">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748732">return</span>&nbsp;<span class="num" id="1748739">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748742">case</span>&nbsp;<span class="ident" id="1748747">r</span>&nbsp;<span class="op" id="1748749">&lt;=</span>&nbsp;<span class="ident" id="1748752">rune2Max</span><span class="op" id="1748760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748764">return</span>&nbsp;<span class="num" id="1748771">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748774">case</span>&nbsp;<span class="ident" id="1748779">surrogateMin</span>&nbsp;<span class="op" id="1748792">&lt;=</span>&nbsp;<span class="ident" id="1748795">r</span>&nbsp;<span class="op" id="1748797">&amp;&amp;</span>&nbsp;<span class="ident" id="1748800">r</span>&nbsp;<span class="op" id="1748802">&lt;=</span>&nbsp;<span class="ident" id="1748805">surrogateMax</span><span class="op" id="1748817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748821">return</span>&nbsp;<span class="op" id="1748828">-</span><span class="num" id="1748829">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748832">case</span>&nbsp;<span class="ident" id="1748837">r</span>&nbsp;<span class="op" id="1748839">&lt;=</span>&nbsp;<span class="ident" id="1748842">rune3Max</span><span class="op" id="1748850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748854">return</span>&nbsp;<span class="num" id="1748861">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748864">case</span>&nbsp;<span class="ident" id="1748869">r</span>&nbsp;<span class="op" id="1748871">&lt;=</span>&nbsp;<span class="ident" id="1748874">MaxRune</span><span class="op" id="1748881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748885">return</span>&nbsp;<span class="num" id="1748892">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1748895">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1748898">return</span>&nbsp;<span class="op" id="1748905">-</span><span class="num" id="1748906">1</span><br>
<span class="lineno"></span><span class="op" id="1748908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1748911">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1749000">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1749043">func</span>&nbsp;<span class="ident" id="1749048">EncodeRune</span><span class="op" id="1749058">(</span><span class="ident" id="1749059">p</span>&nbsp;<span class="op" id="1749061">[</span><span class="op" id="1749062">]</span><span class="builtintype" id="1749063">byte</span><span class="op" id="1749067">,</span>&nbsp;<span class="ident" id="1749069">r</span>&nbsp;<span class="builtintype" id="1749071">rune</span><span class="op" id="1749075">)</span>&nbsp;<span class="builtintype" id="1749077">int</span>&nbsp;<span class="op" id="1749081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1749084">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749162">switch</span>&nbsp;<span class="ident" id="1749169">i</span>&nbsp;<span class="op" id="1749171">:=</span>&nbsp;<span class="builtintype" id="1749174">uint32</span><span class="op" id="1749180">(</span><span class="ident" id="1749181">r</span><span class="op" id="1749182">)</span><span class="op" id="1749183">;</span>&nbsp;<span class="op" id="1749185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749188">case</span>&nbsp;<span class="ident" id="1749193">i</span>&nbsp;<span class="op" id="1749195">&lt;=</span>&nbsp;<span class="ident" id="1749198">rune1Max</span><span class="op" id="1749206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749210">p</span><span class="op" id="1749211">[</span><span class="num" id="1749212">0</span><span class="op" id="1749213">]</span>&nbsp;<span class="op" id="1749215">=</span>&nbsp;<span class="builtintype" id="1749217">byte</span><span class="op" id="1749221">(</span><span class="ident" id="1749222">r</span><span class="op" id="1749223">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749227">return</span>&nbsp;<span class="num" id="1749234">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749237">case</span>&nbsp;<span class="ident" id="1749242">i</span>&nbsp;<span class="op" id="1749244">&lt;=</span>&nbsp;<span class="ident" id="1749247">rune2Max</span><span class="op" id="1749255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749259">p</span><span class="op" id="1749260">[</span><span class="num" id="1749261">0</span><span class="op" id="1749262">]</span>&nbsp;<span class="op" id="1749264">=</span>&nbsp;<span class="ident" id="1749266">t2</span>&nbsp;<span class="op" id="1749269">|</span>&nbsp;<span class="builtintype" id="1749271">byte</span><span class="op" id="1749275">(</span><span class="ident" id="1749276">r</span><span class="op" id="1749277">&gt;&gt;</span><span class="num" id="1749279">6</span><span class="op" id="1749280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749284">p</span><span class="op" id="1749285">[</span><span class="num" id="1749286">1</span><span class="op" id="1749287">]</span>&nbsp;<span class="op" id="1749289">=</span>&nbsp;<span class="ident" id="1749291">tx</span>&nbsp;<span class="op" id="1749294">|</span>&nbsp;<span class="builtintype" id="1749296">byte</span><span class="op" id="1749300">(</span><span class="ident" id="1749301">r</span><span class="op" id="1749302">)</span><span class="op" id="1749303">&amp;</span><span class="ident" id="1749304">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749312">return</span>&nbsp;<span class="num" id="1749319">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749322">case</span>&nbsp;<span class="ident" id="1749327">i</span>&nbsp;<span class="op" id="1749329">&gt;</span>&nbsp;<span class="ident" id="1749331">MaxRune</span><span class="op" id="1749338">,</span>&nbsp;<span class="ident" id="1749340">surrogateMin</span>&nbsp;<span class="op" id="1749353">&lt;=</span>&nbsp;<span class="ident" id="1749356">i</span>&nbsp;<span class="op" id="1749358">&amp;&amp;</span>&nbsp;<span class="ident" id="1749361">i</span>&nbsp;<span class="op" id="1749363">&lt;=</span>&nbsp;<span class="ident" id="1749366">surrogateMax</span><span class="op" id="1749378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749382">r</span>&nbsp;<span class="op" id="1749384">=</span>&nbsp;<span class="ident" id="1749386">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749398">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749411">case</span>&nbsp;<span class="ident" id="1749416">i</span>&nbsp;<span class="op" id="1749418">&lt;=</span>&nbsp;<span class="ident" id="1749421">rune3Max</span><span class="op" id="1749429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749433">p</span><span class="op" id="1749434">[</span><span class="num" id="1749435">0</span><span class="op" id="1749436">]</span>&nbsp;<span class="op" id="1749438">=</span>&nbsp;<span class="ident" id="1749440">t3</span>&nbsp;<span class="op" id="1749443">|</span>&nbsp;<span class="builtintype" id="1749445">byte</span><span class="op" id="1749449">(</span><span class="ident" id="1749450">r</span><span class="op" id="1749451">&gt;&gt;</span><span class="num" id="1749453">12</span><span class="op" id="1749455">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749459">p</span><span class="op" id="1749460">[</span><span class="num" id="1749461">1</span><span class="op" id="1749462">]</span>&nbsp;<span class="op" id="1749464">=</span>&nbsp;<span class="ident" id="1749466">tx</span>&nbsp;<span class="op" id="1749469">|</span>&nbsp;<span class="builtintype" id="1749471">byte</span><span class="op" id="1749475">(</span><span class="ident" id="1749476">r</span><span class="op" id="1749477">&gt;&gt;</span><span class="num" id="1749479">6</span><span class="op" id="1749480">)</span><span class="op" id="1749481">&amp;</span><span class="ident" id="1749482">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749490">p</span><span class="op" id="1749491">[</span><span class="num" id="1749492">2</span><span class="op" id="1749493">]</span>&nbsp;<span class="op" id="1749495">=</span>&nbsp;<span class="ident" id="1749497">tx</span>&nbsp;<span class="op" id="1749500">|</span>&nbsp;<span class="builtintype" id="1749502">byte</span><span class="op" id="1749506">(</span><span class="ident" id="1749507">r</span><span class="op" id="1749508">)</span><span class="op" id="1749509">&amp;</span><span class="ident" id="1749510">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749518">return</span>&nbsp;<span class="num" id="1749525">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749528">default</span><span class="op" id="1749535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749539">p</span><span class="op" id="1749540">[</span><span class="num" id="1749541">0</span><span class="op" id="1749542">]</span>&nbsp;<span class="op" id="1749544">=</span>&nbsp;<span class="ident" id="1749546">t4</span>&nbsp;<span class="op" id="1749549">|</span>&nbsp;<span class="builtintype" id="1749551">byte</span><span class="op" id="1749555">(</span><span class="ident" id="1749556">r</span><span class="op" id="1749557">&gt;&gt;</span><span class="num" id="1749559">18</span><span class="op" id="1749561">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749565">p</span><span class="op" id="1749566">[</span><span class="num" id="1749567">1</span><span class="op" id="1749568">]</span>&nbsp;<span class="op" id="1749570">=</span>&nbsp;<span class="ident" id="1749572">tx</span>&nbsp;<span class="op" id="1749575">|</span>&nbsp;<span class="builtintype" id="1749577">byte</span><span class="op" id="1749581">(</span><span class="ident" id="1749582">r</span><span class="op" id="1749583">&gt;&gt;</span><span class="num" id="1749585">12</span><span class="op" id="1749587">)</span><span class="op" id="1749588">&amp;</span><span class="ident" id="1749589">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749597">p</span><span class="op" id="1749598">[</span><span class="num" id="1749599">2</span><span class="op" id="1749600">]</span>&nbsp;<span class="op" id="1749602">=</span>&nbsp;<span class="ident" id="1749604">tx</span>&nbsp;<span class="op" id="1749607">|</span>&nbsp;<span class="builtintype" id="1749609">byte</span><span class="op" id="1749613">(</span><span class="ident" id="1749614">r</span><span class="op" id="1749615">&gt;&gt;</span><span class="num" id="1749617">6</span><span class="op" id="1749618">)</span><span class="op" id="1749619">&amp;</span><span class="ident" id="1749620">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749628">p</span><span class="op" id="1749629">[</span><span class="num" id="1749630">3</span><span class="op" id="1749631">]</span>&nbsp;<span class="op" id="1749633">=</span>&nbsp;<span class="ident" id="1749635">tx</span>&nbsp;<span class="op" id="1749638">|</span>&nbsp;<span class="builtintype" id="1749640">byte</span><span class="op" id="1749644">(</span><span class="ident" id="1749645">r</span><span class="op" id="1749646">)</span><span class="op" id="1749647">&amp;</span><span class="ident" id="1749648">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749656">return</span>&nbsp;<span class="num" id="1749663">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1749666">}</span><br>
<span class="lineno">365</span><span class="op" id="1749668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1749671">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1749739">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1749797">func</span>&nbsp;<span class="ident" id="1749802">RuneCount</span><span class="op" id="1749811">(</span><span class="ident" id="1749812">p</span>&nbsp;<span class="op" id="1749814">[</span><span class="op" id="1749815">]</span><span class="builtintype" id="1749816">byte</span><span class="op" id="1749820">)</span>&nbsp;<span class="builtintype" id="1749822">int</span>&nbsp;<span class="op" id="1749826">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749829">i</span>&nbsp;<span class="op" id="1749831">:=</span>&nbsp;<span class="num" id="1749834">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749837">var</span>&nbsp;<span class="ident" id="1749841">n</span>&nbsp;<span class="builtintype" id="1749843">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749848">for</span>&nbsp;<span class="ident" id="1749852">n</span>&nbsp;<span class="op" id="1749854">=</span>&nbsp;<span class="num" id="1749856">0</span><span class="op" id="1749857">;</span>&nbsp;<span class="ident" id="1749859">i</span>&nbsp;<span class="op" id="1749861">&lt;</span>&nbsp;<span class="builtinfunc" id="1749863">len</span><span class="op" id="1749866">(</span><span class="ident" id="1749867">p</span><span class="op" id="1749868">)</span><span class="op" id="1749869">;</span>&nbsp;<span class="ident" id="1749871">n</span><span class="op" id="1749872">++</span>&nbsp;<span class="op" id="1749875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749879">if</span>&nbsp;<span class="ident" id="1749882">p</span><span class="op" id="1749883">[</span><span class="ident" id="1749884">i</span><span class="op" id="1749885">]</span>&nbsp;<span class="op" id="1749887">&lt;</span>&nbsp;<span class="ident" id="1749889">RuneSelf</span>&nbsp;<span class="op" id="1749898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749903">i</span><span class="op" id="1749904">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1749909">}</span>&nbsp;<span class="keyword" id="1749911">else</span>&nbsp;<span class="op" id="1749916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749921">_</span><span class="op" id="1749922">,</span>&nbsp;<span class="ident" id="1749924">size</span>&nbsp;<span class="op" id="1749929">:=</span>&nbsp;<span class="ident" id="1749932">DecodeRune</span><span class="op" id="1749942">(</span><span class="ident" id="1749943">p</span><span class="op" id="1749944">[</span><span class="ident" id="1749945">i</span><span class="op" id="1749946">:</span><span class="op" id="1749947">]</span><span class="op" id="1749948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1749953">i</span>&nbsp;<span class="op" id="1749955">+=</span>&nbsp;<span class="ident" id="1749958">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1749965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1749968">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1749971">return</span>&nbsp;<span class="ident" id="1749978">n</span><br>
<span class="lineno"></span><span class="op" id="1749980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1749983">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1750049">func</span>&nbsp;<span class="ident" id="1750054">RuneCountInString</span><span class="op" id="1750071">(</span><span class="ident" id="1750072">s</span>&nbsp;<span class="builtintype" id="1750074">string</span><span class="op" id="1750080">)</span>&nbsp;<span class="op" id="1750082">(</span><span class="ident" id="1750083">n</span>&nbsp;<span class="builtintype" id="1750085">int</span><span class="op" id="1750088">)</span>&nbsp;<span class="op" id="1750090">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750093">for</span>&nbsp;<span class="keyword" id="1750097">range</span>&nbsp;<span class="ident" id="1750103">s</span>&nbsp;<span class="op" id="1750105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1750109">n</span><span class="op" id="1750110">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1750114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750117">return</span><br>
<span class="lineno"></span><span class="op" id="1750124">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1750127">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1750192">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1750261">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1750284">func</span>&nbsp;<span class="ident" id="1750289">RuneStart</span><span class="op" id="1750298">(</span><span class="ident" id="1750299">b</span>&nbsp;<span class="builtintype" id="1750301">byte</span><span class="op" id="1750305">)</span>&nbsp;<span class="builtintype" id="1750307">bool</span>&nbsp;<span class="op" id="1750312">{</span>&nbsp;<span class="keyword" id="1750314">return</span>&nbsp;<span class="ident" id="1750321">b</span><span class="op" id="1750322">&amp;</span><span class="num" id="1750323">0xC0</span>&nbsp;<span class="op" id="1750328">!=</span>&nbsp;<span class="num" id="1750331">0x80</span>&nbsp;<span class="op" id="1750336">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1750339">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1750414">func</span>&nbsp;<span class="ident" id="1750419">Valid</span><span class="op" id="1750424">(</span><span class="ident" id="1750425">p</span>&nbsp;<span class="op" id="1750427">[</span><span class="op" id="1750428">]</span><span class="builtintype" id="1750429">byte</span><span class="op" id="1750433">)</span>&nbsp;<span class="builtintype" id="1750435">bool</span>&nbsp;<span class="op" id="1750440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1750443">i</span>&nbsp;<span class="op" id="1750445">:=</span>&nbsp;<span class="num" id="1750448">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750451">for</span>&nbsp;<span class="ident" id="1750455">i</span>&nbsp;<span class="op" id="1750457">&lt;</span>&nbsp;<span class="builtinfunc" id="1750459">len</span><span class="op" id="1750462">(</span><span class="ident" id="1750463">p</span><span class="op" id="1750464">)</span>&nbsp;<span class="op" id="1750466">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750470">if</span>&nbsp;<span class="ident" id="1750473">p</span><span class="op" id="1750474">[</span><span class="ident" id="1750475">i</span><span class="op" id="1750476">]</span>&nbsp;<span class="op" id="1750478">&lt;</span>&nbsp;<span class="ident" id="1750480">RuneSelf</span>&nbsp;<span class="op" id="1750489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1750494">i</span><span class="op" id="1750495">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1750500">}</span>&nbsp;<span class="keyword" id="1750502">else</span>&nbsp;<span class="op" id="1750507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1750512">_</span><span class="op" id="1750513">,</span>&nbsp;<span class="ident" id="1750515">size</span>&nbsp;<span class="op" id="1750520">:=</span>&nbsp;<span class="ident" id="1750523">DecodeRune</span><span class="op" id="1750533">(</span><span class="ident" id="1750534">p</span><span class="op" id="1750535">[</span><span class="ident" id="1750536">i</span><span class="op" id="1750537">:</span><span class="op" id="1750538">]</span><span class="op" id="1750539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750544">if</span>&nbsp;<span class="ident" id="1750547">size</span>&nbsp;<span class="op" id="1750552">==</span>&nbsp;<span class="num" id="1750555">1</span>&nbsp;<span class="op" id="1750557">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1750563">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1750603">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1750646">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750679">return</span>&nbsp;<span class="builtintype" id="1750686">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1750695">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1750700">i</span>&nbsp;<span class="op" id="1750702">+=</span>&nbsp;<span class="ident" id="1750705">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1750712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1750715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750718">return</span>&nbsp;<span class="builtintype" id="1750725">true</span><br>
<span class="lineno"></span><span class="op" id="1750730">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1750733">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1750814">func</span>&nbsp;<span class="ident" id="1750819">ValidString</span><span class="op" id="1750830">(</span><span class="ident" id="1750831">s</span>&nbsp;<span class="builtintype" id="1750833">string</span><span class="op" id="1750839">)</span>&nbsp;<span class="builtintype" id="1750841">bool</span>&nbsp;<span class="op" id="1750846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750849">for</span>&nbsp;<span class="ident" id="1750853">i</span><span class="op" id="1750854">,</span>&nbsp;<span class="ident" id="1750856">r</span>&nbsp;<span class="op" id="1750858">:=</span>&nbsp;<span class="keyword" id="1750861">range</span>&nbsp;<span class="ident" id="1750867">s</span>&nbsp;<span class="op" id="1750869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1750873">if</span>&nbsp;<span class="ident" id="1750876">r</span>&nbsp;<span class="op" id="1750878">==</span>&nbsp;<span class="ident" id="1750881">RuneError</span>&nbsp;<span class="op" id="1750891">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1750896">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1750938">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1750988">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1751038">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751076">_</span><span class="op" id="1751077">,</span>&nbsp;<span class="ident" id="1751079">size</span>&nbsp;<span class="op" id="1751084">:=</span>&nbsp;<span class="ident" id="1751087">DecodeRuneInString</span><span class="op" id="1751105">(</span><span class="ident" id="1751106">s</span><span class="op" id="1751107">[</span><span class="ident" id="1751108">i</span><span class="op" id="1751109">:</span><span class="op" id="1751110">]</span><span class="op" id="1751111">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751116">if</span>&nbsp;<span class="ident" id="1751119">size</span>&nbsp;<span class="op" id="1751124">==</span>&nbsp;<span class="num" id="1751127">1</span>&nbsp;<span class="op" id="1751129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751135">return</span>&nbsp;<span class="builtintype" id="1751142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1751151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1751155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1751158">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751161">return</span>&nbsp;<span class="builtintype" id="1751168">true</span><br>
<span class="lineno"></span><span class="op" id="1751173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1751176">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1751240">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1751310">func</span>&nbsp;<span class="ident" id="1751315">ValidRune</span><span class="op" id="1751324">(</span><span class="ident" id="1751325">r</span>&nbsp;<span class="builtintype" id="1751327">rune</span><span class="op" id="1751331">)</span>&nbsp;<span class="builtintype" id="1751333">bool</span>&nbsp;<span class="op" id="1751338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751341">switch</span>&nbsp;<span class="op" id="1751348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751351">case</span>&nbsp;<span class="ident" id="1751356">r</span>&nbsp;<span class="op" id="1751358">&lt;</span>&nbsp;<span class="num" id="1751360">0</span><span class="op" id="1751361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751365">return</span>&nbsp;<span class="builtintype" id="1751372">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751379">case</span>&nbsp;<span class="ident" id="1751384">surrogateMin</span>&nbsp;<span class="op" id="1751397">&lt;=</span>&nbsp;<span class="ident" id="1751400">r</span>&nbsp;<span class="op" id="1751402">&amp;&amp;</span>&nbsp;<span class="ident" id="1751405">r</span>&nbsp;<span class="op" id="1751407">&lt;=</span>&nbsp;<span class="ident" id="1751410">surrogateMax</span><span class="op" id="1751422">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751426">return</span>&nbsp;<span class="builtintype" id="1751433">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751440">case</span>&nbsp;<span class="ident" id="1751445">r</span>&nbsp;<span class="op" id="1751447">&gt;</span>&nbsp;<span class="ident" id="1751449">MaxRune</span><span class="op" id="1751456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751460">return</span>&nbsp;<span class="builtintype" id="1751467">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1751474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1751477">return</span>&nbsp;<span class="builtintype" id="1751484">true</span><br>
<span class="lineno">445</span><span class="op" id="1751489">}</span>
</div>
</body>
</html>
