<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7810644">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7810700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7810754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7810805">package</span>&nbsp;<span class="ident" id="7810813">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7810824">import</span>&nbsp;<span class="op" id="7810831">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7810834">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7810843">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7810852">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7810858">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7810869">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7810880">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7810890">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7810893">type</span>&nbsp;<span class="ident" id="7810898">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="7810921">struct</span>&nbsp;<span class="op" id="7810928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7810931">in</span><span class="op" id="7810933">,</span>&nbsp;<span class="ident" id="7810935">out</span>&nbsp;<span class="builtintype" id="7810939">string</span><br>
<span class="lineno"></span><span class="op" id="7810946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7810949">var</span>&nbsp;<span class="ident" id="7810953">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7810977">=</span>&nbsp;<span class="op" id="7810979">[</span><span class="op" id="7810980">]</span><span class="ident" id="7810981">canonicalHeaderKeyTest</span><span class="op" id="7811003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811006">{</span><span class="string" id="7811007">&#34;a-b-c&#34;</span><span class="op" id="7811014">,</span>&nbsp;<span class="string" id="7811016">&#34;A-B-C&#34;</span><span class="op" id="7811023">}</span><span class="op" id="7811024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811027">{</span><span class="string" id="7811028">&#34;a-1-c&#34;</span><span class="op" id="7811035">,</span>&nbsp;<span class="string" id="7811037">&#34;A-1-C&#34;</span><span class="op" id="7811044">}</span><span class="op" id="7811045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811048">{</span><span class="string" id="7811049">&#34;User-Agent&#34;</span><span class="op" id="7811061">,</span>&nbsp;<span class="string" id="7811063">&#34;User-Agent&#34;</span><span class="op" id="7811075">}</span><span class="op" id="7811076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811079">{</span><span class="string" id="7811080">&#34;uSER-aGENT&#34;</span><span class="op" id="7811092">,</span>&nbsp;<span class="string" id="7811094">&#34;User-Agent&#34;</span><span class="op" id="7811106">}</span><span class="op" id="7811107">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811110">{</span><span class="string" id="7811111">&#34;user-agent&#34;</span><span class="op" id="7811123">,</span>&nbsp;<span class="string" id="7811125">&#34;User-Agent&#34;</span><span class="op" id="7811137">}</span><span class="op" id="7811138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811141">{</span><span class="string" id="7811142">&#34;USER-AGENT&#34;</span><span class="op" id="7811154">,</span>&nbsp;<span class="string" id="7811156">&#34;User-Agent&#34;</span><span class="op" id="7811168">}</span><span class="op" id="7811169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811172">{</span><span class="string" id="7811173">&#34;üser-agenT&#34;</span><span class="op" id="7811186">,</span>&nbsp;<span class="string" id="7811188">&#34;üser-Agent&#34;</span><span class="op" id="7811201">}</span><span class="op" id="7811202">,</span>&nbsp;<span class="comment" id="7811204">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7811229">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811284">{</span><span class="string" id="7811285">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="7811313">,</span>&nbsp;<span class="string" id="7811315">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="7811343">}</span><span class="op" id="7811344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811347">{</span><span class="string" id="7811348">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7811357">,</span>&nbsp;<span class="string" id="7811359">&#34;Foo-Bar&#34;</span><span class="op" id="7811368">}</span><span class="op" id="7811369">,</span><br>
<span class="lineno"></span><span class="op" id="7811371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7811374">func</span>&nbsp;<span class="ident" id="7811379">TestCanonicalMIMEHeaderKey</span><span class="op" id="7811405">(</span><span class="ident" id="7811406">t</span>&nbsp;<span class="op" id="7811408">*</span><span class="ident" id="7811409">testing</span><span class="op" id="7811416">.</span><span class="ident" id="7811417">T</span><span class="op" id="7811418">)</span>&nbsp;<span class="op" id="7811420">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7811423">for</span>&nbsp;<span class="ident" id="7811427">_</span><span class="op" id="7811428">,</span>&nbsp;<span class="ident" id="7811430">tt</span>&nbsp;<span class="op" id="7811433">:=</span>&nbsp;<span class="keyword" id="7811436">range</span>&nbsp;<span class="ident" id="7811442">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7811466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7811470">if</span>&nbsp;<span class="ident" id="7811473">s</span>&nbsp;<span class="op" id="7811475">:=</span>&nbsp;<span class="ident" id="7811478">CanonicalMIMEHeaderKey</span><span class="op" id="7811500">(</span><span class="ident" id="7811501">tt</span><span class="op" id="7811503">.</span><span class="ident" id="7811504">in</span><span class="op" id="7811506">)</span><span class="op" id="7811507">;</span>&nbsp;<span class="ident" id="7811509">s</span>&nbsp;<span class="op" id="7811511">!=</span>&nbsp;<span class="ident" id="7811514">tt</span><span class="op" id="7811516">.</span><span class="ident" id="7811517">out</span>&nbsp;<span class="op" id="7811521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811526">t</span><span class="op" id="7811527">.</span><span class="ident" id="7811528">Errorf</span><span class="op" id="7811534">(</span><span class="string" id="7811535">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7811577">,</span>&nbsp;<span class="ident" id="7811579">tt</span><span class="op" id="7811581">.</span><span class="ident" id="7811582">in</span><span class="op" id="7811584">,</span>&nbsp;<span class="ident" id="7811586">s</span><span class="op" id="7811587">,</span>&nbsp;<span class="ident" id="7811589">tt</span><span class="op" id="7811591">.</span><span class="ident" id="7811592">out</span><span class="op" id="7811595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811602">}</span><br>
<span class="lineno">40</span><span class="op" id="7811604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7811607">func</span>&nbsp;<span class="ident" id="7811612">reader</span><span class="op" id="7811618">(</span><span class="ident" id="7811619">s</span>&nbsp;<span class="builtintype" id="7811621">string</span><span class="op" id="7811627">)</span>&nbsp;<span class="op" id="7811629">*</span><span class="ident" id="7811630">Reader</span>&nbsp;<span class="op" id="7811637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7811640">return</span>&nbsp;<span class="ident" id="7811647">NewReader</span><span class="op" id="7811656">(</span><span class="ident" id="7811657">bufio</span><span class="op" id="7811662">.</span><span class="ident" id="7811663">NewReader</span><span class="op" id="7811672">(</span><span class="ident" id="7811673">strings</span><span class="op" id="7811680">.</span><span class="ident" id="7811681">NewReader</span><span class="op" id="7811690">(</span><span class="ident" id="7811691">s</span><span class="op" id="7811692">)</span><span class="op" id="7811693">)</span><span class="op" id="7811694">)</span><br>
<span class="lineno"></span><span class="op" id="7811696">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7811699">func</span>&nbsp;<span class="ident" id="7811704">TestReadLine</span><span class="op" id="7811716">(</span><span class="ident" id="7811717">t</span>&nbsp;<span class="op" id="7811719">*</span><span class="ident" id="7811720">testing</span><span class="op" id="7811727">.</span><span class="ident" id="7811728">T</span><span class="op" id="7811729">)</span>&nbsp;<span class="op" id="7811731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811734">r</span>&nbsp;<span class="op" id="7811736">:=</span>&nbsp;<span class="ident" id="7811739">reader</span><span class="op" id="7811745">(</span><span class="string" id="7811746">&#34;line1\nline2\n&#34;</span><span class="op" id="7811762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811765">s</span><span class="op" id="7811766">,</span>&nbsp;<span class="ident" id="7811768">err</span>&nbsp;<span class="op" id="7811772">:=</span>&nbsp;<span class="ident" id="7811775">r</span><span class="op" id="7811776">.</span><span class="ident" id="7811777">ReadLine</span><span class="op" id="7811785">(</span><span class="op" id="7811786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7811789">if</span>&nbsp;<span class="ident" id="7811792">s</span>&nbsp;<span class="op" id="7811794">!=</span>&nbsp;<span class="string" id="7811797">&#34;line1&#34;</span>&nbsp;<span class="op" id="7811805">||</span>&nbsp;<span class="ident" id="7811808">err</span>&nbsp;<span class="op" id="7811812">!=</span>&nbsp;<span class="ident" id="7811815">nil</span>&nbsp;<span class="op" id="7811819">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811823">t</span><span class="op" id="7811824">.</span><span class="ident" id="7811825">Fatalf</span><span class="op" id="7811831">(</span><span class="string" id="7811832">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7811848">,</span>&nbsp;<span class="ident" id="7811850">s</span><span class="op" id="7811851">,</span>&nbsp;<span class="ident" id="7811853">err</span><span class="op" id="7811856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811862">s</span><span class="op" id="7811863">,</span>&nbsp;<span class="ident" id="7811865">err</span>&nbsp;<span class="op" id="7811869">=</span>&nbsp;<span class="ident" id="7811871">r</span><span class="op" id="7811872">.</span><span class="ident" id="7811873">ReadLine</span><span class="op" id="7811881">(</span><span class="op" id="7811882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7811885">if</span>&nbsp;<span class="ident" id="7811888">s</span>&nbsp;<span class="op" id="7811890">!=</span>&nbsp;<span class="string" id="7811893">&#34;line2&#34;</span>&nbsp;<span class="op" id="7811901">||</span>&nbsp;<span class="ident" id="7811904">err</span>&nbsp;<span class="op" id="7811908">!=</span>&nbsp;<span class="ident" id="7811911">nil</span>&nbsp;<span class="op" id="7811915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811919">t</span><span class="op" id="7811920">.</span><span class="ident" id="7811921">Fatalf</span><span class="op" id="7811927">(</span><span class="string" id="7811928">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7811944">,</span>&nbsp;<span class="ident" id="7811946">s</span><span class="op" id="7811947">,</span>&nbsp;<span class="ident" id="7811949">err</span><span class="op" id="7811952">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7811955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7811958">s</span><span class="op" id="7811959">,</span>&nbsp;<span class="ident" id="7811961">err</span>&nbsp;<span class="op" id="7811965">=</span>&nbsp;<span class="ident" id="7811967">r</span><span class="op" id="7811968">.</span><span class="ident" id="7811969">ReadLine</span><span class="op" id="7811977">(</span><span class="op" id="7811978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7811981">if</span>&nbsp;<span class="ident" id="7811984">s</span>&nbsp;<span class="op" id="7811986">!=</span>&nbsp;<span class="string" id="7811989">&#34;&#34;</span>&nbsp;<span class="op" id="7811992">||</span>&nbsp;<span class="ident" id="7811995">err</span>&nbsp;<span class="op" id="7811999">!=</span>&nbsp;<span class="ident" id="7812002">io</span><span class="op" id="7812004">.</span><span class="ident" id="7812005">EOF</span>&nbsp;<span class="op" id="7812009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812013">t</span><span class="op" id="7812014">.</span><span class="ident" id="7812015">Fatalf</span><span class="op" id="7812021">(</span><span class="string" id="7812022">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812035">,</span>&nbsp;<span class="ident" id="7812037">s</span><span class="op" id="7812038">,</span>&nbsp;<span class="ident" id="7812040">err</span><span class="op" id="7812043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812046">}</span><br>
<span class="lineno">60</span><span class="op" id="7812048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7812051">func</span>&nbsp;<span class="ident" id="7812056">TestReadContinuedLine</span><span class="op" id="7812077">(</span><span class="ident" id="7812078">t</span>&nbsp;<span class="op" id="7812080">*</span><span class="ident" id="7812081">testing</span><span class="op" id="7812088">.</span><span class="ident" id="7812089">T</span><span class="op" id="7812090">)</span>&nbsp;<span class="op" id="7812092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812095">r</span>&nbsp;<span class="op" id="7812097">:=</span>&nbsp;<span class="ident" id="7812100">reader</span><span class="op" id="7812106">(</span><span class="string" id="7812107">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="7812133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812136">s</span><span class="op" id="7812137">,</span>&nbsp;<span class="ident" id="7812139">err</span>&nbsp;<span class="op" id="7812143">:=</span>&nbsp;<span class="ident" id="7812146">r</span><span class="op" id="7812147">.</span><span class="ident" id="7812148">ReadContinuedLine</span><span class="op" id="7812165">(</span><span class="op" id="7812166">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812169">if</span>&nbsp;<span class="ident" id="7812172">s</span>&nbsp;<span class="op" id="7812174">!=</span>&nbsp;<span class="string" id="7812177">&#34;line1&#34;</span>&nbsp;<span class="op" id="7812185">||</span>&nbsp;<span class="ident" id="7812188">err</span>&nbsp;<span class="op" id="7812192">!=</span>&nbsp;<span class="ident" id="7812195">nil</span>&nbsp;<span class="op" id="7812199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812203">t</span><span class="op" id="7812204">.</span><span class="ident" id="7812205">Fatalf</span><span class="op" id="7812211">(</span><span class="string" id="7812212">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812228">,</span>&nbsp;<span class="ident" id="7812230">s</span><span class="op" id="7812231">,</span>&nbsp;<span class="ident" id="7812233">err</span><span class="op" id="7812236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812242">s</span><span class="op" id="7812243">,</span>&nbsp;<span class="ident" id="7812245">err</span>&nbsp;<span class="op" id="7812249">=</span>&nbsp;<span class="ident" id="7812251">r</span><span class="op" id="7812252">.</span><span class="ident" id="7812253">ReadContinuedLine</span><span class="op" id="7812270">(</span><span class="op" id="7812271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812274">if</span>&nbsp;<span class="ident" id="7812277">s</span>&nbsp;<span class="op" id="7812279">!=</span>&nbsp;<span class="string" id="7812282">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="7812291">||</span>&nbsp;<span class="ident" id="7812294">err</span>&nbsp;<span class="op" id="7812298">!=</span>&nbsp;<span class="ident" id="7812301">nil</span>&nbsp;<span class="op" id="7812305">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812309">t</span><span class="op" id="7812310">.</span><span class="ident" id="7812311">Fatalf</span><span class="op" id="7812317">(</span><span class="string" id="7812318">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812334">,</span>&nbsp;<span class="ident" id="7812336">s</span><span class="op" id="7812337">,</span>&nbsp;<span class="ident" id="7812339">err</span><span class="op" id="7812342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812348">s</span><span class="op" id="7812349">,</span>&nbsp;<span class="ident" id="7812351">err</span>&nbsp;<span class="op" id="7812355">=</span>&nbsp;<span class="ident" id="7812357">r</span><span class="op" id="7812358">.</span><span class="ident" id="7812359">ReadContinuedLine</span><span class="op" id="7812376">(</span><span class="op" id="7812377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812380">if</span>&nbsp;<span class="ident" id="7812383">s</span>&nbsp;<span class="op" id="7812385">!=</span>&nbsp;<span class="string" id="7812388">&#34;line3&#34;</span>&nbsp;<span class="op" id="7812396">||</span>&nbsp;<span class="ident" id="7812399">err</span>&nbsp;<span class="op" id="7812403">!=</span>&nbsp;<span class="ident" id="7812406">nil</span>&nbsp;<span class="op" id="7812410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812414">t</span><span class="op" id="7812415">.</span><span class="ident" id="7812416">Fatalf</span><span class="op" id="7812422">(</span><span class="string" id="7812423">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812439">,</span>&nbsp;<span class="ident" id="7812441">s</span><span class="op" id="7812442">,</span>&nbsp;<span class="ident" id="7812444">err</span><span class="op" id="7812447">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812453">s</span><span class="op" id="7812454">,</span>&nbsp;<span class="ident" id="7812456">err</span>&nbsp;<span class="op" id="7812460">=</span>&nbsp;<span class="ident" id="7812462">r</span><span class="op" id="7812463">.</span><span class="ident" id="7812464">ReadContinuedLine</span><span class="op" id="7812481">(</span><span class="op" id="7812482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812485">if</span>&nbsp;<span class="ident" id="7812488">s</span>&nbsp;<span class="op" id="7812490">!=</span>&nbsp;<span class="string" id="7812493">&#34;&#34;</span>&nbsp;<span class="op" id="7812496">||</span>&nbsp;<span class="ident" id="7812499">err</span>&nbsp;<span class="op" id="7812503">!=</span>&nbsp;<span class="ident" id="7812506">io</span><span class="op" id="7812508">.</span><span class="ident" id="7812509">EOF</span>&nbsp;<span class="op" id="7812513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812517">t</span><span class="op" id="7812518">.</span><span class="ident" id="7812519">Fatalf</span><span class="op" id="7812525">(</span><span class="string" id="7812526">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812539">,</span>&nbsp;<span class="ident" id="7812541">s</span><span class="op" id="7812542">,</span>&nbsp;<span class="ident" id="7812544">err</span><span class="op" id="7812547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812550">}</span><br>
<span class="lineno">80</span><span class="op" id="7812552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7812555">func</span>&nbsp;<span class="ident" id="7812560">TestReadCodeLine</span><span class="op" id="7812576">(</span><span class="ident" id="7812577">t</span>&nbsp;<span class="op" id="7812579">*</span><span class="ident" id="7812580">testing</span><span class="op" id="7812587">.</span><span class="ident" id="7812588">T</span><span class="op" id="7812589">)</span>&nbsp;<span class="op" id="7812591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812594">r</span>&nbsp;<span class="op" id="7812596">:=</span>&nbsp;<span class="ident" id="7812599">reader</span><span class="op" id="7812605">(</span><span class="string" id="7812606">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="7812637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812640">code</span><span class="op" id="7812644">,</span>&nbsp;<span class="ident" id="7812646">msg</span><span class="op" id="7812649">,</span>&nbsp;<span class="ident" id="7812651">err</span>&nbsp;<span class="op" id="7812655">:=</span>&nbsp;<span class="ident" id="7812658">r</span><span class="op" id="7812659">.</span><span class="ident" id="7812660">ReadCodeLine</span><span class="op" id="7812672">(</span><span class="num" id="7812673">0</span><span class="op" id="7812674">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812677">if</span>&nbsp;<span class="ident" id="7812680">code</span>&nbsp;<span class="op" id="7812685">!=</span>&nbsp;<span class="num" id="7812688">123</span>&nbsp;<span class="op" id="7812692">||</span>&nbsp;<span class="ident" id="7812695">msg</span>&nbsp;<span class="op" id="7812699">!=</span>&nbsp;<span class="string" id="7812702">&#34;hi&#34;</span>&nbsp;<span class="op" id="7812707">||</span>&nbsp;<span class="ident" id="7812710">err</span>&nbsp;<span class="op" id="7812714">!=</span>&nbsp;<span class="ident" id="7812717">nil</span>&nbsp;<span class="op" id="7812721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812725">t</span><span class="op" id="7812726">.</span><span class="ident" id="7812727">Fatalf</span><span class="op" id="7812733">(</span><span class="string" id="7812734">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812754">,</span>&nbsp;<span class="ident" id="7812756">code</span><span class="op" id="7812760">,</span>&nbsp;<span class="ident" id="7812762">msg</span><span class="op" id="7812765">,</span>&nbsp;<span class="ident" id="7812767">err</span><span class="op" id="7812770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812776">code</span><span class="op" id="7812780">,</span>&nbsp;<span class="ident" id="7812782">msg</span><span class="op" id="7812785">,</span>&nbsp;<span class="ident" id="7812787">err</span>&nbsp;<span class="op" id="7812791">=</span>&nbsp;<span class="ident" id="7812793">r</span><span class="op" id="7812794">.</span><span class="ident" id="7812795">ReadCodeLine</span><span class="op" id="7812807">(</span><span class="num" id="7812808">23</span><span class="op" id="7812810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812813">if</span>&nbsp;<span class="ident" id="7812816">code</span>&nbsp;<span class="op" id="7812821">!=</span>&nbsp;<span class="num" id="7812824">234</span>&nbsp;<span class="op" id="7812828">||</span>&nbsp;<span class="ident" id="7812831">msg</span>&nbsp;<span class="op" id="7812835">!=</span>&nbsp;<span class="string" id="7812838">&#34;bye&#34;</span>&nbsp;<span class="op" id="7812844">||</span>&nbsp;<span class="ident" id="7812847">err</span>&nbsp;<span class="op" id="7812851">!=</span>&nbsp;<span class="ident" id="7812854">nil</span>&nbsp;<span class="op" id="7812858">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812862">t</span><span class="op" id="7812863">.</span><span class="ident" id="7812864">Fatalf</span><span class="op" id="7812870">(</span><span class="string" id="7812871">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7812891">,</span>&nbsp;<span class="ident" id="7812893">code</span><span class="op" id="7812897">,</span>&nbsp;<span class="ident" id="7812899">msg</span><span class="op" id="7812902">,</span>&nbsp;<span class="ident" id="7812904">err</span><span class="op" id="7812907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7812910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7812913">code</span><span class="op" id="7812917">,</span>&nbsp;<span class="ident" id="7812919">msg</span><span class="op" id="7812922">,</span>&nbsp;<span class="ident" id="7812924">err</span>&nbsp;<span class="op" id="7812928">=</span>&nbsp;<span class="ident" id="7812930">r</span><span class="op" id="7812931">.</span><span class="ident" id="7812932">ReadCodeLine</span><span class="op" id="7812944">(</span><span class="num" id="7812945">346</span><span class="op" id="7812948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7812951">if</span>&nbsp;<span class="ident" id="7812954">code</span>&nbsp;<span class="op" id="7812959">!=</span>&nbsp;<span class="num" id="7812962">345</span>&nbsp;<span class="op" id="7812966">||</span>&nbsp;<span class="ident" id="7812969">msg</span>&nbsp;<span class="op" id="7812973">!=</span>&nbsp;<span class="string" id="7812976">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="7812985">||</span>&nbsp;<span class="ident" id="7812988">err</span>&nbsp;<span class="op" id="7812992">==</span>&nbsp;<span class="ident" id="7812995">nil</span>&nbsp;<span class="op" id="7812999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813003">t</span><span class="op" id="7813004">.</span><span class="ident" id="7813005">Fatalf</span><span class="op" id="7813011">(</span><span class="string" id="7813012">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7813032">,</span>&nbsp;<span class="ident" id="7813034">code</span><span class="op" id="7813038">,</span>&nbsp;<span class="ident" id="7813040">msg</span><span class="op" id="7813043">,</span>&nbsp;<span class="ident" id="7813045">err</span><span class="op" id="7813048">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7813051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7813054">if</span>&nbsp;<span class="ident" id="7813057">e</span><span class="op" id="7813058">,</span>&nbsp;<span class="ident" id="7813060">ok</span>&nbsp;<span class="op" id="7813063">:=</span>&nbsp;<span class="ident" id="7813066">err</span><span class="op" id="7813069">.</span><span class="op" id="7813070">(</span><span class="op" id="7813071">*</span><span class="ident" id="7813072">Error</span><span class="op" id="7813077">)</span><span class="op" id="7813078">;</span>&nbsp;<span class="op" id="7813080">!</span><span class="ident" id="7813081">ok</span>&nbsp;<span class="op" id="7813084">||</span>&nbsp;<span class="ident" id="7813087">e</span><span class="op" id="7813088">.</span><span class="ident" id="7813089">Code</span>&nbsp;<span class="op" id="7813094">!=</span>&nbsp;<span class="ident" id="7813097">code</span>&nbsp;<span class="op" id="7813102">||</span>&nbsp;<span class="ident" id="7813105">e</span><span class="op" id="7813106">.</span><span class="ident" id="7813107">Msg</span>&nbsp;<span class="op" id="7813111">!=</span>&nbsp;<span class="ident" id="7813114">msg</span>&nbsp;<span class="op" id="7813118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813122">t</span><span class="op" id="7813123">.</span><span class="ident" id="7813124">Fatalf</span><span class="op" id="7813130">(</span><span class="string" id="7813131">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="7813157">,</span>&nbsp;<span class="ident" id="7813159">err</span><span class="op" id="7813162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7813165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813168">code</span><span class="op" id="7813172">,</span>&nbsp;<span class="ident" id="7813174">msg</span><span class="op" id="7813177">,</span>&nbsp;<span class="ident" id="7813179">err</span>&nbsp;<span class="op" id="7813183">=</span>&nbsp;<span class="ident" id="7813185">r</span><span class="op" id="7813186">.</span><span class="ident" id="7813187">ReadCodeLine</span><span class="op" id="7813199">(</span><span class="num" id="7813200">1</span><span class="op" id="7813201">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7813204">if</span>&nbsp;<span class="ident" id="7813207">code</span>&nbsp;<span class="op" id="7813212">!=</span>&nbsp;<span class="num" id="7813215">0</span>&nbsp;<span class="op" id="7813217">||</span>&nbsp;<span class="ident" id="7813220">msg</span>&nbsp;<span class="op" id="7813224">!=</span>&nbsp;<span class="string" id="7813227">&#34;&#34;</span>&nbsp;<span class="op" id="7813230">||</span>&nbsp;<span class="ident" id="7813233">err</span>&nbsp;<span class="op" id="7813237">!=</span>&nbsp;<span class="ident" id="7813240">io</span><span class="op" id="7813242">.</span><span class="ident" id="7813243">EOF</span>&nbsp;<span class="op" id="7813247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813251">t</span><span class="op" id="7813252">.</span><span class="ident" id="7813253">Fatalf</span><span class="op" id="7813259">(</span><span class="string" id="7813260">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7813277">,</span>&nbsp;<span class="ident" id="7813279">code</span><span class="op" id="7813283">,</span>&nbsp;<span class="ident" id="7813285">msg</span><span class="op" id="7813288">,</span>&nbsp;<span class="ident" id="7813290">err</span><span class="op" id="7813293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7813296">}</span><br>
<span class="lineno"></span><span class="op" id="7813298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7813301">func</span>&nbsp;<span class="ident" id="7813306">TestReadDotLines</span><span class="op" id="7813322">(</span><span class="ident" id="7813323">t</span>&nbsp;<span class="op" id="7813325">*</span><span class="ident" id="7813326">testing</span><span class="op" id="7813333">.</span><span class="ident" id="7813334">T</span><span class="op" id="7813335">)</span>&nbsp;<span class="op" id="7813337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813340">r</span>&nbsp;<span class="op" id="7813342">:=</span>&nbsp;<span class="ident" id="7813345">reader</span><span class="op" id="7813351">(</span><span class="string" id="7813352">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="7813415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813418">s</span><span class="op" id="7813419">,</span>&nbsp;<span class="ident" id="7813421">err</span>&nbsp;<span class="op" id="7813425">:=</span>&nbsp;<span class="ident" id="7813428">r</span><span class="op" id="7813429">.</span><span class="ident" id="7813430">ReadDotLines</span><span class="op" id="7813442">(</span><span class="op" id="7813443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813446">want</span>&nbsp;<span class="op" id="7813451">:=</span>&nbsp;<span class="op" id="7813454">[</span><span class="op" id="7813455">]</span><span class="builtintype" id="7813456">string</span><span class="op" id="7813462">{</span><span class="string" id="7813463">&#34;dotlines&#34;</span><span class="op" id="7813473">,</span>&nbsp;<span class="string" id="7813475">&#34;foo&#34;</span><span class="op" id="7813480">,</span>&nbsp;<span class="string" id="7813482">&#34;.bar&#34;</span><span class="op" id="7813488">,</span>&nbsp;<span class="string" id="7813490">&#34;..baz&#34;</span><span class="op" id="7813497">,</span>&nbsp;<span class="string" id="7813499">&#34;quux&#34;</span><span class="op" id="7813505">,</span>&nbsp;<span class="string" id="7813507">&#34;&#34;</span><span class="op" id="7813509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7813512">if</span>&nbsp;<span class="op" id="7813515">!</span><span class="ident" id="7813516">reflect</span><span class="op" id="7813523">.</span><span class="ident" id="7813524">DeepEqual</span><span class="op" id="7813533">(</span><span class="ident" id="7813534">s</span><span class="op" id="7813535">,</span>&nbsp;<span class="ident" id="7813537">want</span><span class="op" id="7813541">)</span>&nbsp;<span class="op" id="7813543">||</span>&nbsp;<span class="ident" id="7813546">err</span>&nbsp;<span class="op" id="7813550">!=</span>&nbsp;<span class="ident" id="7813553">nil</span>&nbsp;<span class="op" id="7813557">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813561">t</span><span class="op" id="7813562">.</span><span class="ident" id="7813563">Fatalf</span><span class="op" id="7813569">(</span><span class="string" id="7813570">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7813592">,</span>&nbsp;<span class="ident" id="7813594">s</span><span class="op" id="7813595">,</span>&nbsp;<span class="ident" id="7813597">err</span><span class="op" id="7813600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7813603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813607">s</span><span class="op" id="7813608">,</span>&nbsp;<span class="ident" id="7813610">err</span>&nbsp;<span class="op" id="7813614">=</span>&nbsp;<span class="ident" id="7813616">r</span><span class="op" id="7813617">.</span><span class="ident" id="7813618">ReadDotLines</span><span class="op" id="7813630">(</span><span class="op" id="7813631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813634">want</span>&nbsp;<span class="op" id="7813639">=</span>&nbsp;<span class="op" id="7813641">[</span><span class="op" id="7813642">]</span><span class="builtintype" id="7813643">string</span><span class="op" id="7813649">{</span><span class="string" id="7813650">&#34;another&#34;</span><span class="op" id="7813659">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7813662">if</span>&nbsp;<span class="op" id="7813665">!</span><span class="ident" id="7813666">reflect</span><span class="op" id="7813673">.</span><span class="ident" id="7813674">DeepEqual</span><span class="op" id="7813683">(</span><span class="ident" id="7813684">s</span><span class="op" id="7813685">,</span>&nbsp;<span class="ident" id="7813687">want</span><span class="op" id="7813691">)</span>&nbsp;<span class="op" id="7813693">||</span>&nbsp;<span class="ident" id="7813696">err</span>&nbsp;<span class="op" id="7813700">!=</span>&nbsp;<span class="ident" id="7813703">io</span><span class="op" id="7813705">.</span><span class="ident" id="7813706">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7813723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813727">t</span><span class="op" id="7813728">.</span><span class="ident" id="7813729">Fatalf</span><span class="op" id="7813735">(</span><span class="string" id="7813736">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7813759">,</span>&nbsp;<span class="ident" id="7813761">s</span><span class="op" id="7813762">,</span>&nbsp;<span class="ident" id="7813764">err</span><span class="op" id="7813767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7813770">}</span><br>
<span class="lineno"></span><span class="op" id="7813772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7813775">func</span>&nbsp;<span class="ident" id="7813780">TestReadDotBytes</span><span class="op" id="7813796">(</span><span class="ident" id="7813797">t</span>&nbsp;<span class="op" id="7813799">*</span><span class="ident" id="7813800">testing</span><span class="op" id="7813807">.</span><span class="ident" id="7813808">T</span><span class="op" id="7813809">)</span>&nbsp;<span class="op" id="7813811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813814">r</span>&nbsp;<span class="op" id="7813816">:=</span>&nbsp;<span class="ident" id="7813819">reader</span><span class="op" id="7813825">(</span><span class="string" id="7813826">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="7813892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813895">b</span><span class="op" id="7813896">,</span>&nbsp;<span class="ident" id="7813898">err</span>&nbsp;<span class="op" id="7813902">:=</span>&nbsp;<span class="ident" id="7813905">r</span><span class="op" id="7813906">.</span><span class="ident" id="7813907">ReadDotBytes</span><span class="op" id="7813919">(</span><span class="op" id="7813920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7813923">want</span>&nbsp;<span class="op" id="7813928">:=</span>&nbsp;<span class="op" id="7813931">[</span><span class="op" id="7813932">]</span><span class="builtintype" id="7813933">byte</span><span class="op" id="7813937">(</span><span class="string" id="7813938">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="7813976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7813979">if</span>&nbsp;<span class="op" id="7813982">!</span><span class="ident" id="7813983">reflect</span><span class="op" id="7813990">.</span><span class="ident" id="7813991">DeepEqual</span><span class="op" id="7814000">(</span><span class="ident" id="7814001">b</span><span class="op" id="7814002">,</span>&nbsp;<span class="ident" id="7814004">want</span><span class="op" id="7814008">)</span>&nbsp;<span class="op" id="7814010">||</span>&nbsp;<span class="ident" id="7814013">err</span>&nbsp;<span class="op" id="7814017">!=</span>&nbsp;<span class="ident" id="7814020">nil</span>&nbsp;<span class="op" id="7814024">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814028">t</span><span class="op" id="7814029">.</span><span class="ident" id="7814030">Fatalf</span><span class="op" id="7814036">(</span><span class="string" id="7814037">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7814059">,</span>&nbsp;<span class="ident" id="7814061">b</span><span class="op" id="7814062">,</span>&nbsp;<span class="ident" id="7814064">err</span><span class="op" id="7814067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7814070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814074">b</span><span class="op" id="7814075">,</span>&nbsp;<span class="ident" id="7814077">err</span>&nbsp;<span class="op" id="7814081">=</span>&nbsp;<span class="ident" id="7814083">r</span><span class="op" id="7814084">.</span><span class="ident" id="7814085">ReadDotBytes</span><span class="op" id="7814097">(</span><span class="op" id="7814098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814101">want</span>&nbsp;<span class="op" id="7814106">=</span>&nbsp;<span class="op" id="7814108">[</span><span class="op" id="7814109">]</span><span class="builtintype" id="7814110">byte</span><span class="op" id="7814114">(</span><span class="string" id="7814115">&#34;anot.her\n&#34;</span><span class="op" id="7814127">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7814130">if</span>&nbsp;<span class="op" id="7814133">!</span><span class="ident" id="7814134">reflect</span><span class="op" id="7814141">.</span><span class="ident" id="7814142">DeepEqual</span><span class="op" id="7814151">(</span><span class="ident" id="7814152">b</span><span class="op" id="7814153">,</span>&nbsp;<span class="ident" id="7814155">want</span><span class="op" id="7814159">)</span>&nbsp;<span class="op" id="7814161">||</span>&nbsp;<span class="ident" id="7814164">err</span>&nbsp;<span class="op" id="7814168">!=</span>&nbsp;<span class="ident" id="7814171">io</span><span class="op" id="7814173">.</span><span class="ident" id="7814174">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7814191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814195">t</span><span class="op" id="7814196">.</span><span class="ident" id="7814197">Fatalf</span><span class="op" id="7814203">(</span><span class="string" id="7814204">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7814227">,</span>&nbsp;<span class="ident" id="7814229">b</span><span class="op" id="7814230">,</span>&nbsp;<span class="ident" id="7814232">err</span><span class="op" id="7814235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7814238">}</span><br>
<span class="lineno"></span><span class="op" id="7814240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="7814243">func</span>&nbsp;<span class="ident" id="7814248">TestReadMIMEHeader</span><span class="op" id="7814266">(</span><span class="ident" id="7814267">t</span>&nbsp;<span class="op" id="7814269">*</span><span class="ident" id="7814270">testing</span><span class="op" id="7814277">.</span><span class="ident" id="7814278">T</span><span class="op" id="7814279">)</span>&nbsp;<span class="op" id="7814281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814284">r</span>&nbsp;<span class="op" id="7814286">:=</span>&nbsp;<span class="ident" id="7814289">reader</span><span class="op" id="7814295">(</span><span class="string" id="7814296">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="7814374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814377">m</span><span class="op" id="7814378">,</span>&nbsp;<span class="ident" id="7814380">err</span>&nbsp;<span class="op" id="7814384">:=</span>&nbsp;<span class="ident" id="7814387">r</span><span class="op" id="7814388">.</span><span class="ident" id="7814389">ReadMIMEHeader</span><span class="op" id="7814403">(</span><span class="op" id="7814404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814407">want</span>&nbsp;<span class="op" id="7814412">:=</span>&nbsp;<span class="ident" id="7814415">MIMEHeader</span><span class="op" id="7814425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7814429">&#34;My-Key&#34;</span><span class="op" id="7814437">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7814441">{</span><span class="string" id="7814442">&#34;Value&nbsp;1&#34;</span><span class="op" id="7814451">,</span>&nbsp;<span class="string" id="7814453">&#34;Value&nbsp;2&#34;</span><span class="op" id="7814462">}</span><span class="op" id="7814463">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7814467">&#34;Long-Key&#34;</span><span class="op" id="7814477">:</span>&nbsp;<span class="op" id="7814479">{</span><span class="string" id="7814480">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="7814499">}</span><span class="op" id="7814500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7814503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7814506">if</span>&nbsp;<span class="op" id="7814509">!</span><span class="ident" id="7814510">reflect</span><span class="op" id="7814517">.</span><span class="ident" id="7814518">DeepEqual</span><span class="op" id="7814527">(</span><span class="ident" id="7814528">m</span><span class="op" id="7814529">,</span>&nbsp;<span class="ident" id="7814531">want</span><span class="op" id="7814535">)</span>&nbsp;<span class="op" id="7814537">||</span>&nbsp;<span class="ident" id="7814540">err</span>&nbsp;<span class="op" id="7814544">!=</span>&nbsp;<span class="ident" id="7814547">nil</span>&nbsp;<span class="op" id="7814551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814555">t</span><span class="op" id="7814556">.</span><span class="ident" id="7814557">Fatalf</span><span class="op" id="7814563">(</span><span class="string" id="7814564">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7814597">,</span>&nbsp;<span class="ident" id="7814599">m</span><span class="op" id="7814600">,</span>&nbsp;<span class="ident" id="7814602">err</span><span class="op" id="7814605">,</span>&nbsp;<span class="ident" id="7814607">want</span><span class="op" id="7814611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7814614">}</span><br>
<span class="lineno">145</span><span class="op" id="7814616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7814619">func</span>&nbsp;<span class="ident" id="7814624">TestReadMIMEHeaderSingle</span><span class="op" id="7814648">(</span><span class="ident" id="7814649">t</span>&nbsp;<span class="op" id="7814651">*</span><span class="ident" id="7814652">testing</span><span class="op" id="7814659">.</span><span class="ident" id="7814660">T</span><span class="op" id="7814661">)</span>&nbsp;<span class="op" id="7814663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814666">r</span>&nbsp;<span class="op" id="7814668">:=</span>&nbsp;<span class="ident" id="7814671">reader</span><span class="op" id="7814677">(</span><span class="string" id="7814678">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="7814692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814695">m</span><span class="op" id="7814696">,</span>&nbsp;<span class="ident" id="7814698">err</span>&nbsp;<span class="op" id="7814702">:=</span>&nbsp;<span class="ident" id="7814705">r</span><span class="op" id="7814706">.</span><span class="ident" id="7814707">ReadMIMEHeader</span><span class="op" id="7814721">(</span><span class="op" id="7814722">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814725">want</span>&nbsp;<span class="op" id="7814730">:=</span>&nbsp;<span class="ident" id="7814733">MIMEHeader</span><span class="op" id="7814743">{</span><span class="string" id="7814744">&#34;Foo&#34;</span><span class="op" id="7814749">:</span>&nbsp;<span class="op" id="7814751">{</span><span class="string" id="7814752">&#34;bar&#34;</span><span class="op" id="7814757">}</span><span class="op" id="7814758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7814761">if</span>&nbsp;<span class="op" id="7814764">!</span><span class="ident" id="7814765">reflect</span><span class="op" id="7814772">.</span><span class="ident" id="7814773">DeepEqual</span><span class="op" id="7814782">(</span><span class="ident" id="7814783">m</span><span class="op" id="7814784">,</span>&nbsp;<span class="ident" id="7814786">want</span><span class="op" id="7814790">)</span>&nbsp;<span class="op" id="7814792">||</span>&nbsp;<span class="ident" id="7814795">err</span>&nbsp;<span class="op" id="7814799">!=</span>&nbsp;<span class="ident" id="7814802">nil</span>&nbsp;<span class="op" id="7814806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814810">t</span><span class="op" id="7814811">.</span><span class="ident" id="7814812">Fatalf</span><span class="op" id="7814818">(</span><span class="string" id="7814819">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7814852">,</span>&nbsp;<span class="ident" id="7814854">m</span><span class="op" id="7814855">,</span>&nbsp;<span class="ident" id="7814857">err</span><span class="op" id="7814860">,</span>&nbsp;<span class="ident" id="7814862">want</span><span class="op" id="7814866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7814869">}</span><br>
<span class="lineno"></span><span class="op" id="7814871">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7814874">func</span>&nbsp;<span class="ident" id="7814879">TestLargeReadMIMEHeader</span><span class="op" id="7814902">(</span><span class="ident" id="7814903">t</span>&nbsp;<span class="op" id="7814905">*</span><span class="ident" id="7814906">testing</span><span class="op" id="7814913">.</span><span class="ident" id="7814914">T</span><span class="op" id="7814915">)</span>&nbsp;<span class="op" id="7814917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814920">data</span>&nbsp;<span class="op" id="7814925">:=</span>&nbsp;<span class="builtinfunc" id="7814928">make</span><span class="op" id="7814932">(</span><span class="op" id="7814933">[</span><span class="op" id="7814934">]</span><span class="builtintype" id="7814935">byte</span><span class="op" id="7814939">,</span>&nbsp;<span class="num" id="7814941">16</span><span class="op" id="7814943">*</span><span class="num" id="7814944">1024</span><span class="op" id="7814948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7814951">for</span>&nbsp;<span class="ident" id="7814955">i</span>&nbsp;<span class="op" id="7814957">:=</span>&nbsp;<span class="num" id="7814960">0</span><span class="op" id="7814961">;</span>&nbsp;<span class="ident" id="7814963">i</span>&nbsp;<span class="op" id="7814965">&lt;</span>&nbsp;<span class="builtinfunc" id="7814967">len</span><span class="op" id="7814970">(</span><span class="ident" id="7814971">data</span><span class="op" id="7814975">)</span><span class="op" id="7814976">;</span>&nbsp;<span class="ident" id="7814978">i</span><span class="op" id="7814979">++</span>&nbsp;<span class="op" id="7814982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7814986">data</span><span class="op" id="7814990">[</span><span class="ident" id="7814991">i</span><span class="op" id="7814992">]</span>&nbsp;<span class="op" id="7814994">=</span>&nbsp;<span class="string" id="7814996">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7815001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815004">sdata</span>&nbsp;<span class="op" id="7815010">:=</span>&nbsp;<span class="builtintype" id="7815013">string</span><span class="op" id="7815019">(</span><span class="ident" id="7815020">data</span><span class="op" id="7815024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815027">r</span>&nbsp;<span class="op" id="7815029">:=</span>&nbsp;<span class="ident" id="7815032">reader</span><span class="op" id="7815038">(</span><span class="string" id="7815039">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="7815050">+</span>&nbsp;<span class="ident" id="7815052">sdata</span>&nbsp;<span class="op" id="7815058">+</span>&nbsp;<span class="string" id="7815060">&#34;\r\n\n&#34;</span><span class="op" id="7815068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815071">m</span><span class="op" id="7815072">,</span>&nbsp;<span class="ident" id="7815074">err</span>&nbsp;<span class="op" id="7815078">:=</span>&nbsp;<span class="ident" id="7815081">r</span><span class="op" id="7815082">.</span><span class="ident" id="7815083">ReadMIMEHeader</span><span class="op" id="7815097">(</span><span class="op" id="7815098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7815101">if</span>&nbsp;<span class="ident" id="7815104">err</span>&nbsp;<span class="op" id="7815108">!=</span>&nbsp;<span class="ident" id="7815111">nil</span>&nbsp;<span class="op" id="7815115">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815119">t</span><span class="op" id="7815120">.</span><span class="ident" id="7815121">Fatalf</span><span class="op" id="7815127">(</span><span class="string" id="7815128">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="7815148">,</span>&nbsp;<span class="ident" id="7815150">err</span><span class="op" id="7815153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7815156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815159">cookie</span>&nbsp;<span class="op" id="7815166">:=</span>&nbsp;<span class="ident" id="7815169">m</span><span class="op" id="7815170">.</span><span class="ident" id="7815171">Get</span><span class="op" id="7815174">(</span><span class="string" id="7815175">&#34;Cookie&#34;</span><span class="op" id="7815183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7815186">if</span>&nbsp;<span class="ident" id="7815189">cookie</span>&nbsp;<span class="op" id="7815196">!=</span>&nbsp;<span class="ident" id="7815199">sdata</span>&nbsp;<span class="op" id="7815205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815209">t</span><span class="op" id="7815210">.</span><span class="ident" id="7815211">Fatalf</span><span class="op" id="7815217">(</span><span class="string" id="7815218">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="7815259">,</span>&nbsp;<span class="builtinfunc" id="7815261">len</span><span class="op" id="7815264">(</span><span class="ident" id="7815265">cookie</span><span class="op" id="7815271">)</span><span class="op" id="7815272">,</span>&nbsp;<span class="builtinfunc" id="7815274">len</span><span class="op" id="7815277">(</span><span class="ident" id="7815278">sdata</span><span class="op" id="7815283">)</span><span class="op" id="7815284">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7815287">}</span><br>
<span class="lineno"></span><span class="op" id="7815289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7815292">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="7815359">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="7815409">func</span>&nbsp;<span class="ident" id="7815414">TestReadMIMEHeaderNonCompliant</span><span class="op" id="7815444">(</span><span class="ident" id="7815445">t</span>&nbsp;<span class="op" id="7815447">*</span><span class="ident" id="7815448">testing</span><span class="op" id="7815455">.</span><span class="ident" id="7815456">T</span><span class="op" id="7815457">)</span>&nbsp;<span class="op" id="7815459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7815462">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7815523">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815588">r</span>&nbsp;<span class="op" id="7815590">:=</span>&nbsp;<span class="ident" id="7815593">reader</span><span class="op" id="7815599">(</span><span class="string" id="7815600">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="7815615">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815619">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="7815646">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815650">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7815664">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815668">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="7815692">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815696">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="7815721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815724">m</span><span class="op" id="7815725">,</span>&nbsp;<span class="ident" id="7815727">err</span>&nbsp;<span class="op" id="7815731">:=</span>&nbsp;<span class="ident" id="7815734">r</span><span class="op" id="7815735">.</span><span class="ident" id="7815736">ReadMIMEHeader</span><span class="op" id="7815750">(</span><span class="op" id="7815751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815754">want</span>&nbsp;<span class="op" id="7815759">:=</span>&nbsp;<span class="ident" id="7815762">MIMEHeader</span><span class="op" id="7815772">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815776">&#34;Foo&#34;</span><span class="op" id="7815781">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815796">{</span><span class="string" id="7815797">&#34;bar&#34;</span><span class="op" id="7815802">}</span><span class="op" id="7815803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815807">&#34;Content-Language&#34;</span><span class="op" id="7815825">:</span>&nbsp;<span class="op" id="7815827">{</span><span class="string" id="7815828">&#34;en&#34;</span><span class="op" id="7815832">}</span><span class="op" id="7815833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815837">&#34;Sid&#34;</span><span class="op" id="7815842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815857">{</span><span class="string" id="7815858">&#34;0&#34;</span><span class="op" id="7815861">}</span><span class="op" id="7815862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815866">&#34;Audio-Mode&#34;</span><span class="op" id="7815878">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815886">{</span><span class="string" id="7815887">&#34;None&#34;</span><span class="op" id="7815893">}</span><span class="op" id="7815894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7815898">&#34;Privilege&#34;</span><span class="op" id="7815909">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815918">{</span><span class="string" id="7815919">&#34;127&#34;</span><span class="op" id="7815924">}</span><span class="op" id="7815925">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7815928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7815931">if</span>&nbsp;<span class="op" id="7815934">!</span><span class="ident" id="7815935">reflect</span><span class="op" id="7815942">.</span><span class="ident" id="7815943">DeepEqual</span><span class="op" id="7815952">(</span><span class="ident" id="7815953">m</span><span class="op" id="7815954">,</span>&nbsp;<span class="ident" id="7815956">want</span><span class="op" id="7815960">)</span>&nbsp;<span class="op" id="7815962">||</span>&nbsp;<span class="ident" id="7815965">err</span>&nbsp;<span class="op" id="7815969">!=</span>&nbsp;<span class="ident" id="7815972">nil</span>&nbsp;<span class="op" id="7815976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7815980">t</span><span class="op" id="7815981">.</span><span class="ident" id="7815982">Fatalf</span><span class="op" id="7815988">(</span><span class="string" id="7815989">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="7816026">,</span>&nbsp;<span class="ident" id="7816028">m</span><span class="op" id="7816029">,</span>&nbsp;<span class="ident" id="7816031">err</span><span class="op" id="7816034">,</span>&nbsp;<span class="ident" id="7816036">want</span><span class="op" id="7816040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816043">}</span><br>
<span class="lineno"></span><span class="op" id="7816045">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7816048">type</span>&nbsp;<span class="ident" id="7816053">readResponseTest</span>&nbsp;<span class="keyword" id="7816070">struct</span>&nbsp;<span class="op" id="7816077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816080">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7816089">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816097">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7816106">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816111">wantCode</span>&nbsp;<span class="builtintype" id="7816120">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816125">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="7816134">string</span><br>
<span class="lineno"></span><span class="op" id="7816141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7816144">var</span>&nbsp;<span class="ident" id="7816148">readResponseTests</span>&nbsp;<span class="op" id="7816166">=</span>&nbsp;<span class="op" id="7816168">[</span><span class="op" id="7816169">]</span><span class="ident" id="7816170">readResponseTest</span><span class="op" id="7816186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816189">{</span><span class="string" id="7816190">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="7816243">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7816247">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="7816277">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7816281">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="7816294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816298">23</span><span class="op" id="7816300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816304">230</span><span class="op" id="7816307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7816311">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="7816393">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816396">}</span><span class="op" id="7816397">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816401">{</span><span class="string" id="7816402">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="7816454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816458">23</span><span class="op" id="7816460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816464">230</span><span class="op" id="7816467">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7816471">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="7816517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816520">}</span><span class="op" id="7816521">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816525">{</span><span class="string" id="7816526">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="7816547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816551">4</span><span class="op" id="7816552">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816556">400</span><span class="op" id="7816559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7816563">&#34;A\nB\nC&#34;</span><span class="op" id="7816572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816575">}</span><span class="op" id="7816576">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816580">{</span><span class="string" id="7816581">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="7816610">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816614">4</span><span class="op" id="7816615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7816619">400</span><span class="op" id="7816622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7816626">&#34;A\nB\nC&#34;</span><span class="op" id="7816635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816638">}</span><span class="op" id="7816639">,</span><br>
<span class="lineno"></span><span class="op" id="7816641">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="7816644">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="7816695">func</span>&nbsp;<span class="ident" id="7816700">TestRFC959Lines</span><span class="op" id="7816715">(</span><span class="ident" id="7816716">t</span>&nbsp;<span class="op" id="7816718">*</span><span class="ident" id="7816719">testing</span><span class="op" id="7816726">.</span><span class="ident" id="7816727">T</span><span class="op" id="7816728">)</span>&nbsp;<span class="op" id="7816730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7816733">for</span>&nbsp;<span class="ident" id="7816737">i</span><span class="op" id="7816738">,</span>&nbsp;<span class="ident" id="7816740">tt</span>&nbsp;<span class="op" id="7816743">:=</span>&nbsp;<span class="keyword" id="7816746">range</span>&nbsp;<span class="ident" id="7816752">readResponseTests</span>&nbsp;<span class="op" id="7816770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816774">r</span>&nbsp;<span class="op" id="7816776">:=</span>&nbsp;<span class="ident" id="7816779">reader</span><span class="op" id="7816785">(</span><span class="ident" id="7816786">tt</span><span class="op" id="7816788">.</span><span class="ident" id="7816789">in</span>&nbsp;<span class="op" id="7816792">+</span>&nbsp;<span class="string" id="7816794">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="7816812">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816816">code</span><span class="op" id="7816820">,</span>&nbsp;<span class="ident" id="7816822">msg</span><span class="op" id="7816825">,</span>&nbsp;<span class="ident" id="7816827">err</span>&nbsp;<span class="op" id="7816831">:=</span>&nbsp;<span class="ident" id="7816834">r</span><span class="op" id="7816835">.</span><span class="ident" id="7816836">ReadResponse</span><span class="op" id="7816848">(</span><span class="ident" id="7816849">tt</span><span class="op" id="7816851">.</span><span class="ident" id="7816852">inCode</span><span class="op" id="7816858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7816862">if</span>&nbsp;<span class="ident" id="7816865">err</span>&nbsp;<span class="op" id="7816869">!=</span>&nbsp;<span class="ident" id="7816872">nil</span>&nbsp;<span class="op" id="7816876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816881">t</span><span class="op" id="7816882">.</span><span class="ident" id="7816883">Errorf</span><span class="op" id="7816889">(</span><span class="string" id="7816890">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7816913">,</span>&nbsp;<span class="ident" id="7816915">i</span><span class="op" id="7816916">,</span>&nbsp;<span class="ident" id="7816918">err</span><span class="op" id="7816921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7816926">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7816937">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7816941">if</span>&nbsp;<span class="ident" id="7816944">code</span>&nbsp;<span class="op" id="7816949">!=</span>&nbsp;<span class="ident" id="7816952">tt</span><span class="op" id="7816954">.</span><span class="ident" id="7816955">wantCode</span>&nbsp;<span class="op" id="7816964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7816969">t</span><span class="op" id="7816970">.</span><span class="ident" id="7816971">Errorf</span><span class="op" id="7816977">(</span><span class="string" id="7816978">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7817001">,</span>&nbsp;<span class="ident" id="7817003">i</span><span class="op" id="7817004">,</span>&nbsp;<span class="ident" id="7817006">code</span><span class="op" id="7817010">,</span>&nbsp;<span class="ident" id="7817012">tt</span><span class="op" id="7817014">.</span><span class="ident" id="7817015">wantCode</span><span class="op" id="7817023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7817031">if</span>&nbsp;<span class="ident" id="7817034">msg</span>&nbsp;<span class="op" id="7817038">!=</span>&nbsp;<span class="ident" id="7817041">tt</span><span class="op" id="7817043">.</span><span class="ident" id="7817044">wantMsg</span>&nbsp;<span class="op" id="7817052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817057">t</span><span class="op" id="7817058">.</span><span class="ident" id="7817059">Errorf</span><span class="op" id="7817065">(</span><span class="string" id="7817066">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7817088">,</span>&nbsp;<span class="ident" id="7817090">i</span><span class="op" id="7817091">,</span>&nbsp;<span class="ident" id="7817093">msg</span><span class="op" id="7817096">,</span>&nbsp;<span class="ident" id="7817098">tt</span><span class="op" id="7817100">.</span><span class="ident" id="7817101">wantMsg</span><span class="op" id="7817108">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817115">}</span><br>
<span class="lineno"></span><span class="op" id="7817117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7817120">func</span>&nbsp;<span class="ident" id="7817125">TestCommonHeaders</span><span class="op" id="7817142">(</span><span class="ident" id="7817143">t</span>&nbsp;<span class="op" id="7817145">*</span><span class="ident" id="7817146">testing</span><span class="op" id="7817153">.</span><span class="ident" id="7817154">T</span><span class="op" id="7817155">)</span>&nbsp;<span class="op" id="7817157">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7817160">for</span>&nbsp;<span class="ident" id="7817164">h</span>&nbsp;<span class="op" id="7817166">:=</span>&nbsp;<span class="keyword" id="7817169">range</span>&nbsp;<span class="ident" id="7817175">commonHeader</span>&nbsp;<span class="op" id="7817188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7817192">if</span>&nbsp;<span class="ident" id="7817195">h</span>&nbsp;<span class="op" id="7817197">!=</span>&nbsp;<span class="ident" id="7817200">CanonicalMIMEHeaderKey</span><span class="op" id="7817222">(</span><span class="ident" id="7817223">h</span><span class="op" id="7817224">)</span>&nbsp;<span class="op" id="7817226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817231">t</span><span class="op" id="7817232">.</span><span class="ident" id="7817233">Errorf</span><span class="op" id="7817239">(</span><span class="string" id="7817240">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="7817281">,</span>&nbsp;<span class="ident" id="7817283">h</span><span class="op" id="7817284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817291">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817294">b</span>&nbsp;<span class="op" id="7817296">:=</span>&nbsp;<span class="op" id="7817299">[</span><span class="op" id="7817300">]</span><span class="builtintype" id="7817301">byte</span><span class="op" id="7817305">(</span><span class="string" id="7817306">&#34;content-Length&#34;</span><span class="op" id="7817322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817325">want</span>&nbsp;<span class="op" id="7817330">:=</span>&nbsp;<span class="string" id="7817333">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817351">n</span>&nbsp;<span class="op" id="7817353">:=</span>&nbsp;<span class="ident" id="7817356">testing</span><span class="op" id="7817363">.</span><span class="ident" id="7817364">AllocsPerRun</span><span class="op" id="7817376">(</span><span class="num" id="7817377">200</span><span class="op" id="7817380">,</span>&nbsp;<span class="keyword" id="7817382">func</span><span class="op" id="7817386">(</span><span class="op" id="7817387">)</span>&nbsp;<span class="op" id="7817389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7817393">if</span>&nbsp;<span class="ident" id="7817396">x</span>&nbsp;<span class="op" id="7817398">:=</span>&nbsp;<span class="ident" id="7817401">canonicalMIMEHeaderKey</span><span class="op" id="7817423">(</span><span class="ident" id="7817424">b</span><span class="op" id="7817425">)</span><span class="op" id="7817426">;</span>&nbsp;<span class="ident" id="7817428">x</span>&nbsp;<span class="op" id="7817430">!=</span>&nbsp;<span class="ident" id="7817433">want</span>&nbsp;<span class="op" id="7817438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817443">t</span><span class="op" id="7817444">.</span><span class="ident" id="7817445">Fatalf</span><span class="op" id="7817451">(</span><span class="string" id="7817452">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7817494">,</span>&nbsp;<span class="ident" id="7817496">b</span><span class="op" id="7817497">,</span>&nbsp;<span class="ident" id="7817499">x</span><span class="op" id="7817500">,</span>&nbsp;<span class="ident" id="7817502">want</span><span class="op" id="7817506">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817513">}</span><span class="op" id="7817514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7817517">if</span>&nbsp;<span class="ident" id="7817520">n</span>&nbsp;<span class="op" id="7817522">&gt;</span>&nbsp;<span class="num" id="7817524">0</span>&nbsp;<span class="op" id="7817526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7817530">t</span><span class="op" id="7817531">.</span><span class="ident" id="7817532">Errorf</span><span class="op" id="7817538">(</span><span class="string" id="7817539">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7817583">,</span>&nbsp;<span class="ident" id="7817585">n</span><span class="op" id="7817586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7817589">}</span><br>
<span class="lineno">265</span><span class="op" id="7817591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7817594">var</span>&nbsp;<span class="ident" id="7817598">clientHeaders</span>&nbsp;<span class="op" id="7817612">=</span>&nbsp;<span class="ident" id="7817614">strings</span><span class="op" id="7817621">.</span><span class="ident" id="7817622">Replace</span><span class="op" id="7817629">(</span><span class="string" id="7817630">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="7818307">,</span>&nbsp;<span class="string" id="7818309">&#34;\n&#34;</span><span class="op" id="7818313">,</span>&nbsp;<span class="string" id="7818315">&#34;\r\n&#34;</span><span class="op" id="7818321">,</span>&nbsp;<span class="op" id="7818323">-</span><span class="num" id="7818324">1</span><span class="op" id="7818325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7818328">var</span>&nbsp;<span class="ident" id="7818332">serverHeaders</span>&nbsp;<span class="op" id="7818346">=</span>&nbsp;<span class="ident" id="7818348">strings</span><span class="op" id="7818355">.</span><span class="ident" id="7818356">Replace</span><span class="op" id="7818363">(</span><span class="string" id="7818364">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="7818616">,</span>&nbsp;<span class="string" id="7818618">&#34;\n&#34;</span><span class="op" id="7818622">,</span>&nbsp;<span class="string" id="7818624">&#34;\r\n&#34;</span><span class="op" id="7818630">,</span>&nbsp;<span class="op" id="7818632">-</span><span class="num" id="7818633">1</span><span class="op" id="7818634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7818637">func</span>&nbsp;<span class="ident" id="7818642">BenchmarkReadMIMEHeader</span><span class="op" id="7818665">(</span><span class="ident" id="7818666">b</span>&nbsp;<span class="op" id="7818668">*</span><span class="ident" id="7818669">testing</span><span class="op" id="7818676">.</span><span class="ident" id="7818677">B</span><span class="op" id="7818678">)</span>&nbsp;<span class="op" id="7818680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818683">b</span><span class="op" id="7818684">.</span><span class="ident" id="7818685">ReportAllocs</span><span class="op" id="7818697">(</span><span class="op" id="7818698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7818701">var</span>&nbsp;<span class="ident" id="7818705">buf</span>&nbsp;<span class="ident" id="7818709">bytes</span><span class="op" id="7818714">.</span><span class="ident" id="7818715">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818723">br</span>&nbsp;<span class="op" id="7818726">:=</span>&nbsp;<span class="ident" id="7818729">bufio</span><span class="op" id="7818734">.</span><span class="ident" id="7818735">NewReader</span><span class="op" id="7818744">(</span><span class="op" id="7818745">&amp;</span><span class="ident" id="7818746">buf</span><span class="op" id="7818749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818752">r</span>&nbsp;<span class="op" id="7818754">:=</span>&nbsp;<span class="ident" id="7818757">NewReader</span><span class="op" id="7818766">(</span><span class="ident" id="7818767">br</span><span class="op" id="7818769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7818772">for</span>&nbsp;<span class="ident" id="7818776">i</span>&nbsp;<span class="op" id="7818778">:=</span>&nbsp;<span class="num" id="7818781">0</span><span class="op" id="7818782">;</span>&nbsp;<span class="ident" id="7818784">i</span>&nbsp;<span class="op" id="7818786">&lt;</span>&nbsp;<span class="ident" id="7818788">b</span><span class="op" id="7818789">.</span><span class="ident" id="7818790">N</span><span class="op" id="7818791">;</span>&nbsp;<span class="ident" id="7818793">i</span><span class="op" id="7818794">++</span>&nbsp;<span class="op" id="7818797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7818801">var</span>&nbsp;<span class="ident" id="7818805">want</span>&nbsp;<span class="builtintype" id="7818810">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7818816">var</span>&nbsp;<span class="ident" id="7818820">find</span>&nbsp;<span class="builtintype" id="7818825">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7818834">if</span>&nbsp;<span class="op" id="7818837">(</span><span class="ident" id="7818838">i</span>&nbsp;<span class="op" id="7818840">&amp;</span>&nbsp;<span class="num" id="7818842">1</span><span class="op" id="7818843">)</span>&nbsp;<span class="op" id="7818845">==</span>&nbsp;<span class="num" id="7818848">1</span>&nbsp;<span class="op" id="7818850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818855">buf</span><span class="op" id="7818858">.</span><span class="ident" id="7818859">WriteString</span><span class="op" id="7818870">(</span><span class="ident" id="7818871">clientHeaders</span><span class="op" id="7818884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818889">want</span>&nbsp;<span class="op" id="7818894">=</span>&nbsp;<span class="num" id="7818896">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818902">find</span>&nbsp;<span class="op" id="7818907">=</span>&nbsp;<span class="string" id="7818909">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7818920">}</span>&nbsp;<span class="keyword" id="7818922">else</span>&nbsp;<span class="op" id="7818927">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818932">buf</span><span class="op" id="7818935">.</span><span class="ident" id="7818936">WriteString</span><span class="op" id="7818947">(</span><span class="ident" id="7818948">serverHeaders</span><span class="op" id="7818961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818966">want</span>&nbsp;<span class="op" id="7818971">=</span>&nbsp;<span class="num" id="7818973">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818978">find</span>&nbsp;<span class="op" id="7818983">=</span>&nbsp;<span class="string" id="7818985">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7818993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7818997">h</span><span class="op" id="7818998">,</span>&nbsp;<span class="ident" id="7819000">err</span>&nbsp;<span class="op" id="7819004">:=</span>&nbsp;<span class="ident" id="7819007">r</span><span class="op" id="7819008">.</span><span class="ident" id="7819009">ReadMIMEHeader</span><span class="op" id="7819023">(</span><span class="op" id="7819024">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819028">if</span>&nbsp;<span class="ident" id="7819031">err</span>&nbsp;<span class="op" id="7819035">!=</span>&nbsp;<span class="ident" id="7819038">nil</span>&nbsp;<span class="op" id="7819042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819047">b</span><span class="op" id="7819048">.</span><span class="ident" id="7819049">Fatal</span><span class="op" id="7819054">(</span><span class="ident" id="7819055">err</span><span class="op" id="7819058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819066">if</span>&nbsp;<span class="builtinfunc" id="7819069">len</span><span class="op" id="7819072">(</span><span class="ident" id="7819073">h</span><span class="op" id="7819074">)</span>&nbsp;<span class="op" id="7819076">!=</span>&nbsp;<span class="ident" id="7819079">want</span>&nbsp;<span class="op" id="7819084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819089">b</span><span class="op" id="7819090">.</span><span class="ident" id="7819091">Fatalf</span><span class="op" id="7819097">(</span><span class="string" id="7819098">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7819140">,</span>&nbsp;<span class="builtinfunc" id="7819142">len</span><span class="op" id="7819145">(</span><span class="ident" id="7819146">h</span><span class="op" id="7819147">)</span><span class="op" id="7819148">,</span>&nbsp;<span class="ident" id="7819150">want</span><span class="op" id="7819154">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819162">if</span>&nbsp;<span class="ident" id="7819165">_</span><span class="op" id="7819166">,</span>&nbsp;<span class="ident" id="7819168">ok</span>&nbsp;<span class="op" id="7819171">:=</span>&nbsp;<span class="ident" id="7819174">h</span><span class="op" id="7819175">[</span><span class="ident" id="7819176">find</span><span class="op" id="7819180">]</span><span class="op" id="7819181">;</span>&nbsp;<span class="op" id="7819183">!</span><span class="ident" id="7819184">ok</span>&nbsp;<span class="op" id="7819187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819192">b</span><span class="op" id="7819193">.</span><span class="ident" id="7819194">Fatalf</span><span class="op" id="7819200">(</span><span class="string" id="7819201">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="7819222">,</span>&nbsp;<span class="ident" id="7819224">find</span><span class="op" id="7819228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819235">}</span><br>
<span class="lineno">320</span><span class="op" id="7819237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7819240">func</span>&nbsp;<span class="ident" id="7819245">BenchmarkUncommon</span><span class="op" id="7819262">(</span><span class="ident" id="7819263">b</span>&nbsp;<span class="op" id="7819265">*</span><span class="ident" id="7819266">testing</span><span class="op" id="7819273">.</span><span class="ident" id="7819274">B</span><span class="op" id="7819275">)</span>&nbsp;<span class="op" id="7819277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819280">b</span><span class="op" id="7819281">.</span><span class="ident" id="7819282">ReportAllocs</span><span class="op" id="7819294">(</span><span class="op" id="7819295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819298">var</span>&nbsp;<span class="ident" id="7819302">buf</span>&nbsp;<span class="ident" id="7819306">bytes</span><span class="op" id="7819311">.</span><span class="ident" id="7819312">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819320">br</span>&nbsp;<span class="op" id="7819323">:=</span>&nbsp;<span class="ident" id="7819326">bufio</span><span class="op" id="7819331">.</span><span class="ident" id="7819332">NewReader</span><span class="op" id="7819341">(</span><span class="op" id="7819342">&amp;</span><span class="ident" id="7819343">buf</span><span class="op" id="7819346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819349">r</span>&nbsp;<span class="op" id="7819351">:=</span>&nbsp;<span class="ident" id="7819354">NewReader</span><span class="op" id="7819363">(</span><span class="ident" id="7819364">br</span><span class="op" id="7819366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819369">for</span>&nbsp;<span class="ident" id="7819373">i</span>&nbsp;<span class="op" id="7819375">:=</span>&nbsp;<span class="num" id="7819378">0</span><span class="op" id="7819379">;</span>&nbsp;<span class="ident" id="7819381">i</span>&nbsp;<span class="op" id="7819383">&lt;</span>&nbsp;<span class="ident" id="7819385">b</span><span class="op" id="7819386">.</span><span class="ident" id="7819387">N</span><span class="op" id="7819388">;</span>&nbsp;<span class="ident" id="7819390">i</span><span class="op" id="7819391">++</span>&nbsp;<span class="op" id="7819394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819398">buf</span><span class="op" id="7819401">.</span><span class="ident" id="7819402">WriteString</span><span class="op" id="7819413">(</span><span class="string" id="7819414">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="7819458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819462">h</span><span class="op" id="7819463">,</span>&nbsp;<span class="ident" id="7819465">err</span>&nbsp;<span class="op" id="7819469">:=</span>&nbsp;<span class="ident" id="7819472">r</span><span class="op" id="7819473">.</span><span class="ident" id="7819474">ReadMIMEHeader</span><span class="op" id="7819488">(</span><span class="op" id="7819489">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819493">if</span>&nbsp;<span class="ident" id="7819496">err</span>&nbsp;<span class="op" id="7819500">!=</span>&nbsp;<span class="ident" id="7819503">nil</span>&nbsp;<span class="op" id="7819507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819512">b</span><span class="op" id="7819513">.</span><span class="ident" id="7819514">Fatal</span><span class="op" id="7819519">(</span><span class="ident" id="7819520">err</span><span class="op" id="7819523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7819531">if</span>&nbsp;<span class="ident" id="7819534">_</span><span class="op" id="7819535">,</span>&nbsp;<span class="ident" id="7819537">ok</span>&nbsp;<span class="op" id="7819540">:=</span>&nbsp;<span class="ident" id="7819543">h</span><span class="op" id="7819544">[</span><span class="string" id="7819545">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="7819576">]</span><span class="op" id="7819577">;</span>&nbsp;<span class="op" id="7819579">!</span><span class="ident" id="7819580">ok</span>&nbsp;<span class="op" id="7819583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7819588">b</span><span class="op" id="7819589">.</span><span class="ident" id="7819590">Fatal</span><span class="op" id="7819595">(</span><span class="string" id="7819596">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="7819620">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7819627">}</span><br>
<span class="lineno"></span><span class="op" id="7819629">}</span>
</div>
</body>
</html>
