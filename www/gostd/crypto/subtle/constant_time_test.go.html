<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html" class="current">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6776440">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6776495">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6776549">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6776600">package</span>&nbsp;<span class="ident" id="6776608">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776616">import</span>&nbsp;<span class="op" id="6776623">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6776626">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6776637">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6776653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776656">type</span>&nbsp;<span class="ident" id="6776661">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="6776691">struct</span>&nbsp;<span class="op" id="6776698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776701">a</span><span class="op" id="6776702">,</span>&nbsp;<span class="ident" id="6776704">b</span>&nbsp;<span class="op" id="6776706">[</span><span class="op" id="6776707">]</span><span class="builtintype" id="6776708">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776714">out</span>&nbsp;&nbsp;<span class="builtintype" id="6776719">int</span><br>
<span class="lineno">15</span><span class="op" id="6776723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6776726">var</span>&nbsp;<span class="ident" id="6776730">testConstantTimeCompareData</span>&nbsp;<span class="op" id="6776758">=</span>&nbsp;<span class="op" id="6776760">[</span><span class="op" id="6776761">]</span><span class="ident" id="6776762">TestConstantTimeCompareStruct</span><span class="op" id="6776791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776794">{</span><span class="op" id="6776795">[</span><span class="op" id="6776796">]</span><span class="builtintype" id="6776797">byte</span><span class="op" id="6776801">{</span><span class="op" id="6776802">}</span><span class="op" id="6776803">,</span>&nbsp;<span class="op" id="6776805">[</span><span class="op" id="6776806">]</span><span class="builtintype" id="6776807">byte</span><span class="op" id="6776811">{</span><span class="op" id="6776812">}</span><span class="op" id="6776813">,</span>&nbsp;<span class="num" id="6776815">1</span><span class="op" id="6776816">}</span><span class="op" id="6776817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776820">{</span><span class="op" id="6776821">[</span><span class="op" id="6776822">]</span><span class="builtintype" id="6776823">byte</span><span class="op" id="6776827">{</span><span class="num" id="6776828">0x11</span><span class="op" id="6776832">}</span><span class="op" id="6776833">,</span>&nbsp;<span class="op" id="6776835">[</span><span class="op" id="6776836">]</span><span class="builtintype" id="6776837">byte</span><span class="op" id="6776841">{</span><span class="num" id="6776842">0x11</span><span class="op" id="6776846">}</span><span class="op" id="6776847">,</span>&nbsp;<span class="num" id="6776849">1</span><span class="op" id="6776850">}</span><span class="op" id="6776851">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776854">{</span><span class="op" id="6776855">[</span><span class="op" id="6776856">]</span><span class="builtintype" id="6776857">byte</span><span class="op" id="6776861">{</span><span class="num" id="6776862">0x12</span><span class="op" id="6776866">}</span><span class="op" id="6776867">,</span>&nbsp;<span class="op" id="6776869">[</span><span class="op" id="6776870">]</span><span class="builtintype" id="6776871">byte</span><span class="op" id="6776875">{</span><span class="num" id="6776876">0x11</span><span class="op" id="6776880">}</span><span class="op" id="6776881">,</span>&nbsp;<span class="num" id="6776883">0</span><span class="op" id="6776884">}</span><span class="op" id="6776885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776888">{</span><span class="op" id="6776889">[</span><span class="op" id="6776890">]</span><span class="builtintype" id="6776891">byte</span><span class="op" id="6776895">{</span><span class="num" id="6776896">0x11</span><span class="op" id="6776900">}</span><span class="op" id="6776901">,</span>&nbsp;<span class="op" id="6776903">[</span><span class="op" id="6776904">]</span><span class="builtintype" id="6776905">byte</span><span class="op" id="6776909">{</span><span class="num" id="6776910">0x11</span><span class="op" id="6776914">,</span>&nbsp;<span class="num" id="6776916">0x12</span><span class="op" id="6776920">}</span><span class="op" id="6776921">,</span>&nbsp;<span class="num" id="6776923">0</span><span class="op" id="6776924">}</span><span class="op" id="6776925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776928">{</span><span class="op" id="6776929">[</span><span class="op" id="6776930">]</span><span class="builtintype" id="6776931">byte</span><span class="op" id="6776935">{</span><span class="num" id="6776936">0x11</span><span class="op" id="6776940">,</span>&nbsp;<span class="num" id="6776942">0x12</span><span class="op" id="6776946">}</span><span class="op" id="6776947">,</span>&nbsp;<span class="op" id="6776949">[</span><span class="op" id="6776950">]</span><span class="builtintype" id="6776951">byte</span><span class="op" id="6776955">{</span><span class="num" id="6776956">0x11</span><span class="op" id="6776960">}</span><span class="op" id="6776961">,</span>&nbsp;<span class="num" id="6776963">0</span><span class="op" id="6776964">}</span><span class="op" id="6776965">,</span><br>
<span class="lineno"></span><span class="op" id="6776967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6776970">func</span>&nbsp;<span class="ident" id="6776975">TestConstantTimeCompare</span><span class="op" id="6776998">(</span><span class="ident" id="6776999">t</span>&nbsp;<span class="op" id="6777001">*</span><span class="ident" id="6777002">testing</span><span class="op" id="6777009">.</span><span class="ident" id="6777010">T</span><span class="op" id="6777011">)</span>&nbsp;<span class="op" id="6777013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777016">for</span>&nbsp;<span class="ident" id="6777020">i</span><span class="op" id="6777021">,</span>&nbsp;<span class="ident" id="6777023">test</span>&nbsp;<span class="op" id="6777028">:=</span>&nbsp;<span class="keyword" id="6777031">range</span>&nbsp;<span class="ident" id="6777037">testConstantTimeCompareData</span>&nbsp;<span class="op" id="6777065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777069">if</span>&nbsp;<span class="ident" id="6777072">r</span>&nbsp;<span class="op" id="6777074">:=</span>&nbsp;<span class="ident" id="6777077">ConstantTimeCompare</span><span class="op" id="6777096">(</span><span class="ident" id="6777097">test</span><span class="op" id="6777101">.</span><span class="ident" id="6777102">a</span><span class="op" id="6777103">,</span>&nbsp;<span class="ident" id="6777105">test</span><span class="op" id="6777109">.</span><span class="ident" id="6777110">b</span><span class="op" id="6777111">)</span><span class="op" id="6777112">;</span>&nbsp;<span class="ident" id="6777114">r</span>&nbsp;<span class="op" id="6777116">!=</span>&nbsp;<span class="ident" id="6777119">test</span><span class="op" id="6777123">.</span><span class="ident" id="6777124">out</span>&nbsp;<span class="op" id="6777128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777133">t</span><span class="op" id="6777134">.</span><span class="ident" id="6777135">Errorf</span><span class="op" id="6777141">(</span><span class="string" id="6777142">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="6777176">,</span>&nbsp;<span class="ident" id="6777178">i</span><span class="op" id="6777179">,</span>&nbsp;<span class="ident" id="6777181">r</span><span class="op" id="6777182">,</span>&nbsp;<span class="ident" id="6777184">test</span><span class="op" id="6777188">.</span><span class="ident" id="6777189">out</span><span class="op" id="6777192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777196">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777199">}</span><br>
<span class="lineno"></span><span class="op" id="6777201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6777204">type</span>&nbsp;<span class="ident" id="6777209">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="6777238">struct</span>&nbsp;<span class="op" id="6777245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777248">a</span><span class="op" id="6777249">,</span>&nbsp;<span class="ident" id="6777251">b</span>&nbsp;<span class="builtintype" id="6777253">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777260">out</span>&nbsp;&nbsp;<span class="builtintype" id="6777265">int</span><br>
<span class="lineno"></span><span class="op" id="6777269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6777272">var</span>&nbsp;<span class="ident" id="6777276">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="6777303">=</span>&nbsp;<span class="op" id="6777305">[</span><span class="op" id="6777306">]</span><span class="ident" id="6777307">TestConstantTimeByteEqStruct</span><span class="op" id="6777335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777338">{</span><span class="num" id="6777339">0</span><span class="op" id="6777340">,</span>&nbsp;<span class="num" id="6777342">0</span><span class="op" id="6777343">,</span>&nbsp;<span class="num" id="6777345">1</span><span class="op" id="6777346">}</span><span class="op" id="6777347">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777350">{</span><span class="num" id="6777351">0</span><span class="op" id="6777352">,</span>&nbsp;<span class="num" id="6777354">1</span><span class="op" id="6777355">,</span>&nbsp;<span class="num" id="6777357">0</span><span class="op" id="6777358">}</span><span class="op" id="6777359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777362">{</span><span class="num" id="6777363">1</span><span class="op" id="6777364">,</span>&nbsp;<span class="num" id="6777366">0</span><span class="op" id="6777367">,</span>&nbsp;<span class="num" id="6777369">0</span><span class="op" id="6777370">}</span><span class="op" id="6777371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777374">{</span><span class="num" id="6777375">0xff</span><span class="op" id="6777379">,</span>&nbsp;<span class="num" id="6777381">0xff</span><span class="op" id="6777385">,</span>&nbsp;<span class="num" id="6777387">1</span><span class="op" id="6777388">}</span><span class="op" id="6777389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777392">{</span><span class="num" id="6777393">0xff</span><span class="op" id="6777397">,</span>&nbsp;<span class="num" id="6777399">0xfe</span><span class="op" id="6777403">,</span>&nbsp;<span class="num" id="6777405">0</span><span class="op" id="6777406">}</span><span class="op" id="6777407">,</span><br>
<span class="lineno"></span><span class="op" id="6777409">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6777412">func</span>&nbsp;<span class="ident" id="6777417">byteEq</span><span class="op" id="6777423">(</span><span class="ident" id="6777424">a</span><span class="op" id="6777425">,</span>&nbsp;<span class="ident" id="6777427">b</span>&nbsp;<span class="builtintype" id="6777429">uint8</span><span class="op" id="6777434">)</span>&nbsp;<span class="builtintype" id="6777436">int</span>&nbsp;<span class="op" id="6777440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777443">if</span>&nbsp;<span class="ident" id="6777446">a</span>&nbsp;<span class="op" id="6777448">==</span>&nbsp;<span class="ident" id="6777451">b</span>&nbsp;<span class="op" id="6777453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777457">return</span>&nbsp;<span class="num" id="6777464">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777467">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777470">return</span>&nbsp;<span class="num" id="6777477">0</span><br>
<span class="lineno"></span><span class="op" id="6777479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6777482">func</span>&nbsp;<span class="ident" id="6777487">TestConstantTimeByteEq</span><span class="op" id="6777509">(</span><span class="ident" id="6777510">t</span>&nbsp;<span class="op" id="6777512">*</span><span class="ident" id="6777513">testing</span><span class="op" id="6777520">.</span><span class="ident" id="6777521">T</span><span class="op" id="6777522">)</span>&nbsp;<span class="op" id="6777524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777527">for</span>&nbsp;<span class="ident" id="6777531">i</span><span class="op" id="6777532">,</span>&nbsp;<span class="ident" id="6777534">test</span>&nbsp;<span class="op" id="6777539">:=</span>&nbsp;<span class="keyword" id="6777542">range</span>&nbsp;<span class="ident" id="6777548">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="6777575">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777579">if</span>&nbsp;<span class="ident" id="6777582">r</span>&nbsp;<span class="op" id="6777584">:=</span>&nbsp;<span class="ident" id="6777587">ConstantTimeByteEq</span><span class="op" id="6777605">(</span><span class="ident" id="6777606">test</span><span class="op" id="6777610">.</span><span class="ident" id="6777611">a</span><span class="op" id="6777612">,</span>&nbsp;<span class="ident" id="6777614">test</span><span class="op" id="6777618">.</span><span class="ident" id="6777619">b</span><span class="op" id="6777620">)</span><span class="op" id="6777621">;</span>&nbsp;<span class="ident" id="6777623">r</span>&nbsp;<span class="op" id="6777625">!=</span>&nbsp;<span class="ident" id="6777628">test</span><span class="op" id="6777632">.</span><span class="ident" id="6777633">out</span>&nbsp;<span class="op" id="6777637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777642">t</span><span class="op" id="6777643">.</span><span class="ident" id="6777644">Errorf</span><span class="op" id="6777650">(</span><span class="string" id="6777651">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="6777685">,</span>&nbsp;<span class="ident" id="6777687">i</span><span class="op" id="6777688">,</span>&nbsp;<span class="ident" id="6777690">r</span><span class="op" id="6777691">,</span>&nbsp;<span class="ident" id="6777693">test</span><span class="op" id="6777697">.</span><span class="ident" id="6777698">out</span><span class="op" id="6777701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777711">err</span>&nbsp;<span class="op" id="6777715">:=</span>&nbsp;<span class="ident" id="6777718">quick</span><span class="op" id="6777723">.</span><span class="ident" id="6777724">CheckEqual</span><span class="op" id="6777734">(</span><span class="ident" id="6777735">ConstantTimeByteEq</span><span class="op" id="6777753">,</span>&nbsp;<span class="ident" id="6777755">byteEq</span><span class="op" id="6777761">,</span>&nbsp;<span class="ident" id="6777763">nil</span><span class="op" id="6777766">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777769">if</span>&nbsp;<span class="ident" id="6777772">err</span>&nbsp;<span class="op" id="6777776">!=</span>&nbsp;<span class="ident" id="6777779">nil</span>&nbsp;<span class="op" id="6777783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777787">t</span><span class="op" id="6777788">.</span><span class="ident" id="6777789">Error</span><span class="op" id="6777794">(</span><span class="ident" id="6777795">err</span><span class="op" id="6777798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777801">}</span><br>
<span class="lineno"></span><span class="op" id="6777803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6777806">func</span>&nbsp;<span class="ident" id="6777811">eq</span><span class="op" id="6777813">(</span><span class="ident" id="6777814">a</span><span class="op" id="6777815">,</span>&nbsp;<span class="ident" id="6777817">b</span>&nbsp;<span class="builtintype" id="6777819">int32</span><span class="op" id="6777824">)</span>&nbsp;<span class="builtintype" id="6777826">int</span>&nbsp;<span class="op" id="6777830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777833">if</span>&nbsp;<span class="ident" id="6777836">a</span>&nbsp;<span class="op" id="6777838">==</span>&nbsp;<span class="ident" id="6777841">b</span>&nbsp;<span class="op" id="6777843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777847">return</span>&nbsp;<span class="num" id="6777854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777860">return</span>&nbsp;<span class="num" id="6777867">0</span><br>
<span class="lineno">70</span><span class="op" id="6777869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6777872">func</span>&nbsp;<span class="ident" id="6777877">TestConstantTimeEq</span><span class="op" id="6777895">(</span><span class="ident" id="6777896">t</span>&nbsp;<span class="op" id="6777898">*</span><span class="ident" id="6777899">testing</span><span class="op" id="6777906">.</span><span class="ident" id="6777907">T</span><span class="op" id="6777908">)</span>&nbsp;<span class="op" id="6777910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777913">err</span>&nbsp;<span class="op" id="6777917">:=</span>&nbsp;<span class="ident" id="6777920">quick</span><span class="op" id="6777925">.</span><span class="ident" id="6777926">CheckEqual</span><span class="op" id="6777936">(</span><span class="ident" id="6777937">ConstantTimeEq</span><span class="op" id="6777951">,</span>&nbsp;<span class="ident" id="6777953">eq</span><span class="op" id="6777955">,</span>&nbsp;<span class="ident" id="6777957">nil</span><span class="op" id="6777960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6777963">if</span>&nbsp;<span class="ident" id="6777966">err</span>&nbsp;<span class="op" id="6777970">!=</span>&nbsp;<span class="ident" id="6777973">nil</span>&nbsp;<span class="op" id="6777977">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6777981">t</span><span class="op" id="6777982">.</span><span class="ident" id="6777983">Error</span><span class="op" id="6777988">(</span><span class="ident" id="6777989">err</span><span class="op" id="6777992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6777995">}</span><br>
<span class="lineno"></span><span class="op" id="6777997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6778000">func</span>&nbsp;<span class="ident" id="6778005">makeCopy</span><span class="op" id="6778013">(</span><span class="ident" id="6778014">v</span>&nbsp;<span class="builtintype" id="6778016">int</span><span class="op" id="6778019">,</span>&nbsp;<span class="ident" id="6778021">x</span><span class="op" id="6778022">,</span>&nbsp;<span class="ident" id="6778024">y</span>&nbsp;<span class="op" id="6778026">[</span><span class="op" id="6778027">]</span><span class="builtintype" id="6778028">byte</span><span class="op" id="6778032">)</span>&nbsp;<span class="op" id="6778034">[</span><span class="op" id="6778035">]</span><span class="builtintype" id="6778036">byte</span>&nbsp;<span class="op" id="6778041">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778044">if</span>&nbsp;<span class="builtinfunc" id="6778047">len</span><span class="op" id="6778050">(</span><span class="ident" id="6778051">x</span><span class="op" id="6778052">)</span>&nbsp;<span class="op" id="6778054">&gt;</span>&nbsp;<span class="builtinfunc" id="6778056">len</span><span class="op" id="6778059">(</span><span class="ident" id="6778060">y</span><span class="op" id="6778061">)</span>&nbsp;<span class="op" id="6778063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778067">x</span>&nbsp;<span class="op" id="6778069">=</span>&nbsp;<span class="ident" id="6778071">x</span><span class="op" id="6778072">[</span><span class="num" id="6778073">0</span><span class="op" id="6778074">:</span><span class="builtinfunc" id="6778075">len</span><span class="op" id="6778078">(</span><span class="ident" id="6778079">y</span><span class="op" id="6778080">)</span><span class="op" id="6778081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778084">}</span>&nbsp;<span class="keyword" id="6778086">else</span>&nbsp;<span class="op" id="6778091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778095">y</span>&nbsp;<span class="op" id="6778097">=</span>&nbsp;<span class="ident" id="6778099">y</span><span class="op" id="6778100">[</span><span class="num" id="6778101">0</span><span class="op" id="6778102">:</span><span class="builtinfunc" id="6778103">len</span><span class="op" id="6778106">(</span><span class="ident" id="6778107">x</span><span class="op" id="6778108">)</span><span class="op" id="6778109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778112">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778115">if</span>&nbsp;<span class="ident" id="6778118">v</span>&nbsp;<span class="op" id="6778120">==</span>&nbsp;<span class="num" id="6778123">1</span>&nbsp;<span class="op" id="6778125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6778129">copy</span><span class="op" id="6778133">(</span><span class="ident" id="6778134">x</span><span class="op" id="6778135">,</span>&nbsp;<span class="ident" id="6778137">y</span><span class="op" id="6778138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778144">return</span>&nbsp;<span class="ident" id="6778151">x</span><br>
<span class="lineno"></span><span class="op" id="6778153">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6778156">func</span>&nbsp;<span class="ident" id="6778161">constantTimeCopyWrapper</span><span class="op" id="6778184">(</span><span class="ident" id="6778185">v</span>&nbsp;<span class="builtintype" id="6778187">int</span><span class="op" id="6778190">,</span>&nbsp;<span class="ident" id="6778192">x</span><span class="op" id="6778193">,</span>&nbsp;<span class="ident" id="6778195">y</span>&nbsp;<span class="op" id="6778197">[</span><span class="op" id="6778198">]</span><span class="builtintype" id="6778199">byte</span><span class="op" id="6778203">)</span>&nbsp;<span class="op" id="6778205">[</span><span class="op" id="6778206">]</span><span class="builtintype" id="6778207">byte</span>&nbsp;<span class="op" id="6778212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778215">if</span>&nbsp;<span class="builtinfunc" id="6778218">len</span><span class="op" id="6778221">(</span><span class="ident" id="6778222">x</span><span class="op" id="6778223">)</span>&nbsp;<span class="op" id="6778225">&gt;</span>&nbsp;<span class="builtinfunc" id="6778227">len</span><span class="op" id="6778230">(</span><span class="ident" id="6778231">y</span><span class="op" id="6778232">)</span>&nbsp;<span class="op" id="6778234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778238">x</span>&nbsp;<span class="op" id="6778240">=</span>&nbsp;<span class="ident" id="6778242">x</span><span class="op" id="6778243">[</span><span class="num" id="6778244">0</span><span class="op" id="6778245">:</span><span class="builtinfunc" id="6778246">len</span><span class="op" id="6778249">(</span><span class="ident" id="6778250">y</span><span class="op" id="6778251">)</span><span class="op" id="6778252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778255">}</span>&nbsp;<span class="keyword" id="6778257">else</span>&nbsp;<span class="op" id="6778262">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778266">y</span>&nbsp;<span class="op" id="6778268">=</span>&nbsp;<span class="ident" id="6778270">y</span><span class="op" id="6778271">[</span><span class="num" id="6778272">0</span><span class="op" id="6778273">:</span><span class="builtinfunc" id="6778274">len</span><span class="op" id="6778277">(</span><span class="ident" id="6778278">x</span><span class="op" id="6778279">)</span><span class="op" id="6778280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778286">v</span>&nbsp;<span class="op" id="6778288">&amp;=</span>&nbsp;<span class="num" id="6778291">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778294">ConstantTimeCopy</span><span class="op" id="6778310">(</span><span class="ident" id="6778311">v</span><span class="op" id="6778312">,</span>&nbsp;<span class="ident" id="6778314">x</span><span class="op" id="6778315">,</span>&nbsp;<span class="ident" id="6778317">y</span><span class="op" id="6778318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778321">return</span>&nbsp;<span class="ident" id="6778328">x</span><br>
<span class="lineno">100</span><span class="op" id="6778330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6778333">func</span>&nbsp;<span class="ident" id="6778338">TestConstantTimeCopy</span><span class="op" id="6778358">(</span><span class="ident" id="6778359">t</span>&nbsp;<span class="op" id="6778361">*</span><span class="ident" id="6778362">testing</span><span class="op" id="6778369">.</span><span class="ident" id="6778370">T</span><span class="op" id="6778371">)</span>&nbsp;<span class="op" id="6778373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778376">err</span>&nbsp;<span class="op" id="6778380">:=</span>&nbsp;<span class="ident" id="6778383">quick</span><span class="op" id="6778388">.</span><span class="ident" id="6778389">CheckEqual</span><span class="op" id="6778399">(</span><span class="ident" id="6778400">constantTimeCopyWrapper</span><span class="op" id="6778423">,</span>&nbsp;<span class="ident" id="6778425">makeCopy</span><span class="op" id="6778433">,</span>&nbsp;<span class="ident" id="6778435">nil</span><span class="op" id="6778438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778441">if</span>&nbsp;<span class="ident" id="6778444">err</span>&nbsp;<span class="op" id="6778448">!=</span>&nbsp;<span class="ident" id="6778451">nil</span>&nbsp;<span class="op" id="6778455">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778459">t</span><span class="op" id="6778460">.</span><span class="ident" id="6778461">Error</span><span class="op" id="6778466">(</span><span class="ident" id="6778467">err</span><span class="op" id="6778470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778473">}</span><br>
<span class="lineno"></span><span class="op" id="6778475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6778478">var</span>&nbsp;<span class="ident" id="6778482">lessOrEqTests</span>&nbsp;<span class="op" id="6778496">=</span>&nbsp;<span class="op" id="6778498">[</span><span class="op" id="6778499">]</span><span class="keyword" id="6778500">struct</span>&nbsp;<span class="op" id="6778507">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778510">x</span><span class="op" id="6778511">,</span>&nbsp;<span class="ident" id="6778513">y</span><span class="op" id="6778514">,</span>&nbsp;<span class="ident" id="6778516">result</span>&nbsp;<span class="builtintype" id="6778523">int</span><br>
<span class="lineno"></span><span class="op" id="6778527">}</span><span class="op" id="6778528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778531">{</span><span class="num" id="6778532">0</span><span class="op" id="6778533">,</span>&nbsp;<span class="num" id="6778535">0</span><span class="op" id="6778536">,</span>&nbsp;<span class="num" id="6778538">1</span><span class="op" id="6778539">}</span><span class="op" id="6778540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778543">{</span><span class="num" id="6778544">1</span><span class="op" id="6778545">,</span>&nbsp;<span class="num" id="6778547">0</span><span class="op" id="6778548">,</span>&nbsp;<span class="num" id="6778550">0</span><span class="op" id="6778551">}</span><span class="op" id="6778552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778555">{</span><span class="num" id="6778556">0</span><span class="op" id="6778557">,</span>&nbsp;<span class="num" id="6778559">1</span><span class="op" id="6778560">,</span>&nbsp;<span class="num" id="6778562">1</span><span class="op" id="6778563">}</span><span class="op" id="6778564">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778567">{</span><span class="num" id="6778568">10</span><span class="op" id="6778570">,</span>&nbsp;<span class="num" id="6778572">20</span><span class="op" id="6778574">,</span>&nbsp;<span class="num" id="6778576">1</span><span class="op" id="6778577">}</span><span class="op" id="6778578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778581">{</span><span class="num" id="6778582">20</span><span class="op" id="6778584">,</span>&nbsp;<span class="num" id="6778586">10</span><span class="op" id="6778588">,</span>&nbsp;<span class="num" id="6778590">0</span><span class="op" id="6778591">}</span><span class="op" id="6778592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778595">{</span><span class="num" id="6778596">10</span><span class="op" id="6778598">,</span>&nbsp;<span class="num" id="6778600">10</span><span class="op" id="6778602">,</span>&nbsp;<span class="num" id="6778604">1</span><span class="op" id="6778605">}</span><span class="op" id="6778606">,</span><br>
<span class="lineno"></span><span class="op" id="6778608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6778611">func</span>&nbsp;<span class="ident" id="6778616">TestConstantTimeLessOrEq</span><span class="op" id="6778640">(</span><span class="ident" id="6778641">t</span>&nbsp;<span class="op" id="6778643">*</span><span class="ident" id="6778644">testing</span><span class="op" id="6778651">.</span><span class="ident" id="6778652">T</span><span class="op" id="6778653">)</span>&nbsp;<span class="op" id="6778655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778658">for</span>&nbsp;<span class="ident" id="6778662">i</span><span class="op" id="6778663">,</span>&nbsp;<span class="ident" id="6778665">test</span>&nbsp;<span class="op" id="6778670">:=</span>&nbsp;<span class="keyword" id="6778673">range</span>&nbsp;<span class="ident" id="6778679">lessOrEqTests</span>&nbsp;<span class="op" id="6778693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778697">result</span>&nbsp;<span class="op" id="6778704">:=</span>&nbsp;<span class="ident" id="6778707">ConstantTimeLessOrEq</span><span class="op" id="6778727">(</span><span class="ident" id="6778728">test</span><span class="op" id="6778732">.</span><span class="ident" id="6778733">x</span><span class="op" id="6778734">,</span>&nbsp;<span class="ident" id="6778736">test</span><span class="op" id="6778740">.</span><span class="ident" id="6778741">y</span><span class="op" id="6778742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6778746">if</span>&nbsp;<span class="ident" id="6778749">result</span>&nbsp;<span class="op" id="6778756">!=</span>&nbsp;<span class="ident" id="6778759">test</span><span class="op" id="6778763">.</span><span class="ident" id="6778764">result</span>&nbsp;<span class="op" id="6778771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778776">t</span><span class="op" id="6778777">.</span><span class="ident" id="6778778">Errorf</span><span class="op" id="6778784">(</span><span class="string" id="6778785">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6778821">,</span>&nbsp;<span class="ident" id="6778823">i</span><span class="op" id="6778824">,</span>&nbsp;<span class="ident" id="6778826">test</span><span class="op" id="6778830">.</span><span class="ident" id="6778831">x</span><span class="op" id="6778832">,</span>&nbsp;<span class="ident" id="6778834">test</span><span class="op" id="6778838">.</span><span class="ident" id="6778839">y</span><span class="op" id="6778840">,</span>&nbsp;<span class="ident" id="6778842">result</span><span class="op" id="6778848">,</span>&nbsp;<span class="ident" id="6778850">test</span><span class="op" id="6778854">.</span><span class="ident" id="6778855">result</span><span class="op" id="6778861">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6778868">}</span><br>
<span class="lineno"></span><span class="op" id="6778870">}</span>
</div>
</body>
</html>
