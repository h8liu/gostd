<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2919097">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2919152">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2919206">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2919257">package</span>&nbsp;<span class="ident" id="2919265">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2919274">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2919351">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2919401">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2919469">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2919546">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2919581">type</span>&nbsp;<span class="ident" id="2919586">stringFinder</span>&nbsp;<span class="keyword" id="2919599">struct</span>&nbsp;<span class="op" id="2919606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919609">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2919674">pattern</span>&nbsp;<span class="builtintype" id="2919682">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919691">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919765">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919839">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919875">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919879">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2919951">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920024">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2920069">badCharSkip</span>&nbsp;<span class="op" id="2920081">[</span><span class="num" id="2920082">256</span><span class="op" id="2920085">]</span><span class="builtintype" id="2920086">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920092">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920168">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920240">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920282">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920286">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920358">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920432">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920502">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920575">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920640">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920675">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920679">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920754">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920822">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920896">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2920962">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921030">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921100">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921171">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921244">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921301">goodSuffixSkip</span>&nbsp;<span class="op" id="2921316">[</span><span class="op" id="2921317">]</span><span class="builtintype" id="2921318">int</span><br>
<span class="lineno"></span><span class="op" id="2921322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2921325">func</span>&nbsp;<span class="ident" id="2921330">makeStringFinder</span><span class="op" id="2921346">(</span><span class="ident" id="2921347">pattern</span>&nbsp;<span class="builtintype" id="2921355">string</span><span class="op" id="2921361">)</span>&nbsp;<span class="op" id="2921363">*</span><span class="ident" id="2921364">stringFinder</span>&nbsp;<span class="op" id="2921377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921380">f</span>&nbsp;<span class="op" id="2921382">:=</span>&nbsp;<span class="op" id="2921385">&amp;</span><span class="ident" id="2921386">stringFinder</span><span class="op" id="2921398">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921402">pattern</span><span class="op" id="2921409">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2921418">pattern</span><span class="op" id="2921425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921429">goodSuffixSkip</span><span class="op" id="2921443">:</span>&nbsp;<span class="builtinfunc" id="2921445">make</span><span class="op" id="2921449">(</span><span class="op" id="2921450">[</span><span class="op" id="2921451">]</span><span class="builtintype" id="2921452">int</span><span class="op" id="2921455">,</span>&nbsp;<span class="builtinfunc" id="2921457">len</span><span class="op" id="2921460">(</span><span class="ident" id="2921461">pattern</span><span class="op" id="2921468">)</span><span class="op" id="2921469">)</span><span class="op" id="2921470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921476">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921536">last</span>&nbsp;<span class="op" id="2921541">:=</span>&nbsp;<span class="builtinfunc" id="2921544">len</span><span class="op" id="2921547">(</span><span class="ident" id="2921548">pattern</span><span class="op" id="2921555">)</span>&nbsp;<span class="op" id="2921557">-</span>&nbsp;<span class="num" id="2921559">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921563">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921594">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921654">for</span>&nbsp;<span class="ident" id="2921658">i</span>&nbsp;<span class="op" id="2921660">:=</span>&nbsp;<span class="keyword" id="2921663">range</span>&nbsp;<span class="ident" id="2921669">f</span><span class="op" id="2921670">.</span><span class="ident" id="2921671">badCharSkip</span>&nbsp;<span class="op" id="2921683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921687">f</span><span class="op" id="2921688">.</span><span class="ident" id="2921689">badCharSkip</span><span class="op" id="2921700">[</span><span class="ident" id="2921701">i</span><span class="op" id="2921702">]</span>&nbsp;<span class="op" id="2921704">=</span>&nbsp;<span class="builtinfunc" id="2921706">len</span><span class="op" id="2921709">(</span><span class="ident" id="2921710">pattern</span><span class="op" id="2921717">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921723">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921796">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921871">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2921912">for</span>&nbsp;<span class="ident" id="2921916">i</span>&nbsp;<span class="op" id="2921918">:=</span>&nbsp;<span class="num" id="2921921">0</span><span class="op" id="2921922">;</span>&nbsp;<span class="ident" id="2921924">i</span>&nbsp;<span class="op" id="2921926">&lt;</span>&nbsp;<span class="ident" id="2921928">last</span><span class="op" id="2921932">;</span>&nbsp;<span class="ident" id="2921934">i</span><span class="op" id="2921935">++</span>&nbsp;<span class="op" id="2921938">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2921942">f</span><span class="op" id="2921943">.</span><span class="ident" id="2921944">badCharSkip</span><span class="op" id="2921955">[</span><span class="ident" id="2921956">pattern</span><span class="op" id="2921963">[</span><span class="ident" id="2921964">i</span><span class="op" id="2921965">]</span><span class="op" id="2921966">]</span>&nbsp;<span class="op" id="2921968">=</span>&nbsp;<span class="ident" id="2921970">last</span>&nbsp;<span class="op" id="2921975">-</span>&nbsp;<span class="ident" id="2921977">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2921980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2921984">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2922013">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2922087">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922100">lastPrefix</span>&nbsp;<span class="op" id="2922111">:=</span>&nbsp;<span class="ident" id="2922114">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922120">for</span>&nbsp;<span class="ident" id="2922124">i</span>&nbsp;<span class="op" id="2922126">:=</span>&nbsp;<span class="ident" id="2922129">last</span><span class="op" id="2922133">;</span>&nbsp;<span class="ident" id="2922135">i</span>&nbsp;<span class="op" id="2922137">&gt;=</span>&nbsp;<span class="num" id="2922140">0</span><span class="op" id="2922141">;</span>&nbsp;<span class="ident" id="2922143">i</span><span class="op" id="2922144">--</span>&nbsp;<span class="op" id="2922147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922151">if</span>&nbsp;<span class="ident" id="2922154">HasPrefix</span><span class="op" id="2922163">(</span><span class="ident" id="2922164">pattern</span><span class="op" id="2922171">,</span>&nbsp;<span class="ident" id="2922173">pattern</span><span class="op" id="2922180">[</span><span class="ident" id="2922181">i</span><span class="op" id="2922182">+</span><span class="num" id="2922183">1</span><span class="op" id="2922184">:</span><span class="op" id="2922185">]</span><span class="op" id="2922186">)</span>&nbsp;<span class="op" id="2922188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922193">lastPrefix</span>&nbsp;<span class="op" id="2922204">=</span>&nbsp;<span class="ident" id="2922206">i</span>&nbsp;<span class="op" id="2922208">+</span>&nbsp;<span class="num" id="2922210">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2922218">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922277">f</span><span class="op" id="2922278">.</span><span class="ident" id="2922279">goodSuffixSkip</span><span class="op" id="2922293">[</span><span class="ident" id="2922294">i</span><span class="op" id="2922295">]</span>&nbsp;<span class="op" id="2922297">=</span>&nbsp;<span class="ident" id="2922299">lastPrefix</span>&nbsp;<span class="op" id="2922310">+</span>&nbsp;<span class="ident" id="2922312">last</span>&nbsp;<span class="op" id="2922317">-</span>&nbsp;<span class="ident" id="2922319">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2922325">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922400">for</span>&nbsp;<span class="ident" id="2922404">i</span>&nbsp;<span class="op" id="2922406">:=</span>&nbsp;<span class="num" id="2922409">0</span><span class="op" id="2922410">;</span>&nbsp;<span class="ident" id="2922412">i</span>&nbsp;<span class="op" id="2922414">&lt;</span>&nbsp;<span class="ident" id="2922416">last</span><span class="op" id="2922420">;</span>&nbsp;<span class="ident" id="2922422">i</span><span class="op" id="2922423">++</span>&nbsp;<span class="op" id="2922426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922430">lenSuffix</span>&nbsp;<span class="op" id="2922440">:=</span>&nbsp;<span class="ident" id="2922443">longestCommonSuffix</span><span class="op" id="2922462">(</span><span class="ident" id="2922463">pattern</span><span class="op" id="2922470">,</span>&nbsp;<span class="ident" id="2922472">pattern</span><span class="op" id="2922479">[</span><span class="num" id="2922480">1</span><span class="op" id="2922481">:</span><span class="ident" id="2922482">i</span><span class="op" id="2922483">+</span><span class="num" id="2922484">1</span><span class="op" id="2922485">]</span><span class="op" id="2922486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922490">if</span>&nbsp;<span class="ident" id="2922493">pattern</span><span class="op" id="2922500">[</span><span class="ident" id="2922501">i</span><span class="op" id="2922502">-</span><span class="ident" id="2922503">lenSuffix</span><span class="op" id="2922512">]</span>&nbsp;<span class="op" id="2922514">!=</span>&nbsp;<span class="ident" id="2922517">pattern</span><span class="op" id="2922524">[</span><span class="ident" id="2922525">last</span><span class="op" id="2922529">-</span><span class="ident" id="2922530">lenSuffix</span><span class="op" id="2922539">]</span>&nbsp;<span class="op" id="2922541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2922546">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2922605">f</span><span class="op" id="2922606">.</span><span class="ident" id="2922607">goodSuffixSkip</span><span class="op" id="2922621">[</span><span class="ident" id="2922622">last</span><span class="op" id="2922626">-</span><span class="ident" id="2922627">lenSuffix</span><span class="op" id="2922636">]</span>&nbsp;<span class="op" id="2922638">=</span>&nbsp;<span class="ident" id="2922640">lenSuffix</span>&nbsp;<span class="op" id="2922650">+</span>&nbsp;<span class="ident" id="2922652">last</span>&nbsp;<span class="op" id="2922657">-</span>&nbsp;<span class="ident" id="2922659">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922670">return</span>&nbsp;<span class="ident" id="2922677">f</span><br>
<span class="lineno"></span><span class="op" id="2922679">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2922682">func</span>&nbsp;<span class="ident" id="2922687">longestCommonSuffix</span><span class="op" id="2922706">(</span><span class="ident" id="2922707">a</span><span class="op" id="2922708">,</span>&nbsp;<span class="ident" id="2922710">b</span>&nbsp;<span class="builtintype" id="2922712">string</span><span class="op" id="2922718">)</span>&nbsp;<span class="op" id="2922720">(</span><span class="ident" id="2922721">i</span>&nbsp;<span class="builtintype" id="2922723">int</span><span class="op" id="2922726">)</span>&nbsp;<span class="op" id="2922728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922731">for</span>&nbsp;<span class="op" id="2922735">;</span>&nbsp;<span class="ident" id="2922737">i</span>&nbsp;<span class="op" id="2922739">&lt;</span>&nbsp;<span class="builtinfunc" id="2922741">len</span><span class="op" id="2922744">(</span><span class="ident" id="2922745">a</span><span class="op" id="2922746">)</span>&nbsp;<span class="op" id="2922748">&amp;&amp;</span>&nbsp;<span class="ident" id="2922751">i</span>&nbsp;<span class="op" id="2922753">&lt;</span>&nbsp;<span class="builtinfunc" id="2922755">len</span><span class="op" id="2922758">(</span><span class="ident" id="2922759">b</span><span class="op" id="2922760">)</span><span class="op" id="2922761">;</span>&nbsp;<span class="ident" id="2922763">i</span><span class="op" id="2922764">++</span>&nbsp;<span class="op" id="2922767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922771">if</span>&nbsp;<span class="ident" id="2922774">a</span><span class="op" id="2922775">[</span><span class="builtinfunc" id="2922776">len</span><span class="op" id="2922779">(</span><span class="ident" id="2922780">a</span><span class="op" id="2922781">)</span><span class="op" id="2922782">-</span><span class="num" id="2922783">1</span><span class="op" id="2922784">-</span><span class="ident" id="2922785">i</span><span class="op" id="2922786">]</span>&nbsp;<span class="op" id="2922788">!=</span>&nbsp;<span class="ident" id="2922791">b</span><span class="op" id="2922792">[</span><span class="builtinfunc" id="2922793">len</span><span class="op" id="2922796">(</span><span class="ident" id="2922797">b</span><span class="op" id="2922798">)</span><span class="op" id="2922799">-</span><span class="num" id="2922800">1</span><span class="op" id="2922801">-</span><span class="ident" id="2922802">i</span><span class="op" id="2922803">]</span>&nbsp;<span class="op" id="2922805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922810">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2922821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2922824">return</span><br>
<span class="lineno"></span><span class="op" id="2922831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2922834">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2922911">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2922955">func</span>&nbsp;<span class="op" id="2922960">(</span><span class="ident" id="2922961">f</span>&nbsp;<span class="op" id="2922963">*</span><span class="ident" id="2922964">stringFinder</span><span class="op" id="2922976">)</span>&nbsp;<span class="ident" id="2922978">next</span><span class="op" id="2922982">(</span><span class="ident" id="2922983">text</span>&nbsp;<span class="builtintype" id="2922988">string</span><span class="op" id="2922994">)</span>&nbsp;<span class="builtintype" id="2922996">int</span>&nbsp;<span class="op" id="2923000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923003">i</span>&nbsp;<span class="op" id="2923005">:=</span>&nbsp;<span class="builtinfunc" id="2923008">len</span><span class="op" id="2923011">(</span><span class="ident" id="2923012">f</span><span class="op" id="2923013">.</span><span class="ident" id="2923014">pattern</span><span class="op" id="2923021">)</span>&nbsp;<span class="op" id="2923023">-</span>&nbsp;<span class="num" id="2923025">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923028">for</span>&nbsp;<span class="ident" id="2923032">i</span>&nbsp;<span class="op" id="2923034">&lt;</span>&nbsp;<span class="builtinfunc" id="2923036">len</span><span class="op" id="2923039">(</span><span class="ident" id="2923040">text</span><span class="op" id="2923044">)</span>&nbsp;<span class="op" id="2923046">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2923050">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923124">j</span>&nbsp;<span class="op" id="2923126">:=</span>&nbsp;<span class="builtinfunc" id="2923129">len</span><span class="op" id="2923132">(</span><span class="ident" id="2923133">f</span><span class="op" id="2923134">.</span><span class="ident" id="2923135">pattern</span><span class="op" id="2923142">)</span>&nbsp;<span class="op" id="2923144">-</span>&nbsp;<span class="num" id="2923146">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923150">for</span>&nbsp;<span class="ident" id="2923154">j</span>&nbsp;<span class="op" id="2923156">&gt;=</span>&nbsp;<span class="num" id="2923159">0</span>&nbsp;<span class="op" id="2923161">&amp;&amp;</span>&nbsp;<span class="ident" id="2923164">text</span><span class="op" id="2923168">[</span><span class="ident" id="2923169">i</span><span class="op" id="2923170">]</span>&nbsp;<span class="op" id="2923172">==</span>&nbsp;<span class="ident" id="2923175">f</span><span class="op" id="2923176">.</span><span class="ident" id="2923177">pattern</span><span class="op" id="2923184">[</span><span class="ident" id="2923185">j</span><span class="op" id="2923186">]</span>&nbsp;<span class="op" id="2923188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923193">i</span><span class="op" id="2923194">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923200">j</span><span class="op" id="2923201">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923210">if</span>&nbsp;<span class="ident" id="2923213">j</span>&nbsp;<span class="op" id="2923215">&lt;</span>&nbsp;<span class="num" id="2923217">0</span>&nbsp;<span class="op" id="2923219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923224">return</span>&nbsp;<span class="ident" id="2923231">i</span>&nbsp;<span class="op" id="2923233">+</span>&nbsp;<span class="num" id="2923235">1</span>&nbsp;<span class="comment" id="2923237">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923252">i</span>&nbsp;<span class="op" id="2923254">+=</span>&nbsp;<span class="ident" id="2923257">max</span><span class="op" id="2923260">(</span><span class="ident" id="2923261">f</span><span class="op" id="2923262">.</span><span class="ident" id="2923263">badCharSkip</span><span class="op" id="2923274">[</span><span class="ident" id="2923275">text</span><span class="op" id="2923279">[</span><span class="ident" id="2923280">i</span><span class="op" id="2923281">]</span><span class="op" id="2923282">]</span><span class="op" id="2923283">,</span>&nbsp;<span class="ident" id="2923285">f</span><span class="op" id="2923286">.</span><span class="ident" id="2923287">goodSuffixSkip</span><span class="op" id="2923301">[</span><span class="ident" id="2923302">j</span><span class="op" id="2923303">]</span><span class="op" id="2923304">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923310">return</span>&nbsp;<span class="op" id="2923317">-</span><span class="num" id="2923318">1</span><br>
<span class="lineno"></span><span class="op" id="2923320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2923323">func</span>&nbsp;<span class="ident" id="2923328">max</span><span class="op" id="2923331">(</span><span class="ident" id="2923332">a</span><span class="op" id="2923333">,</span>&nbsp;<span class="ident" id="2923335">b</span>&nbsp;<span class="builtintype" id="2923337">int</span><span class="op" id="2923340">)</span>&nbsp;<span class="builtintype" id="2923342">int</span>&nbsp;<span class="op" id="2923346">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923349">if</span>&nbsp;<span class="ident" id="2923352">a</span>&nbsp;<span class="op" id="2923354">&gt;</span>&nbsp;<span class="ident" id="2923356">b</span>&nbsp;<span class="op" id="2923358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923362">return</span>&nbsp;<span class="ident" id="2923369">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923375">return</span>&nbsp;<span class="ident" id="2923382">b</span><br>
<span class="lineno"></span><span class="op" id="2923384">}</span>
</div>
</body>
</html>
