<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5804540">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5804595">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5804649">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5804700">package</span>&nbsp;<span class="ident" id="5804708">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5804713">import</span>&nbsp;<span class="op" id="5804720">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5804723">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5804732">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5804738">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5804749">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5804760">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5804775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5804778">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5804828">//</span><br>
<span class="lineno"></span><span class="comment" id="5804831">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5804900">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5804976">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="5805056">//</span><br>
<span class="lineno"></span><span class="comment" id="5805059">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="5805092">//</span><br>
<span class="lineno"></span><span class="comment" id="5805095">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="5805171">type</span>&nbsp;<span class="ident" id="5805176">Writer</span>&nbsp;<span class="keyword" id="5805183">struct</span>&nbsp;<span class="op" id="5805190">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5805193">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5805201">rune</span>&nbsp;<span class="comment" id="5805206">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5805252">UseCRLF</span>&nbsp;<span class="builtintype" id="5805260">bool</span>&nbsp;<span class="comment" id="5805265">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5805309">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5805317">*</span><span class="ident" id="5805318">bufio</span><span class="op" id="5805323">.</span><span class="ident" id="5805324">Writer</span><br>
<span class="lineno"></span><span class="op" id="5805331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5805334">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5805386">func</span>&nbsp;<span class="ident" id="5805391">NewWriter</span><span class="op" id="5805400">(</span><span class="ident" id="5805401">w</span>&nbsp;<span class="ident" id="5805403">io</span><span class="op" id="5805405">.</span><span class="ident" id="5805406">Writer</span><span class="op" id="5805412">)</span>&nbsp;<span class="op" id="5805414">*</span><span class="ident" id="5805415">Writer</span>&nbsp;<span class="op" id="5805422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805425">return</span>&nbsp;<span class="op" id="5805432">&amp;</span><span class="ident" id="5805433">Writer</span><span class="op" id="5805439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5805443">Comma</span><span class="op" id="5805448">:</span>&nbsp;<span class="string" id="5805450">&#39;,&#39;</span><span class="op" id="5805453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5805457">w</span><span class="op" id="5805458">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5805464">bufio</span><span class="op" id="5805469">.</span><span class="ident" id="5805470">NewWriter</span><span class="op" id="5805479">(</span><span class="ident" id="5805480">w</span><span class="op" id="5805481">)</span><span class="op" id="5805482">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5805485">}</span><br>
<span class="lineno"></span><span class="op" id="5805487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5805490">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="5805566">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="5805634">func</span>&nbsp;<span class="op" id="5805639">(</span><span class="ident" id="5805640">w</span>&nbsp;<span class="op" id="5805642">*</span><span class="ident" id="5805643">Writer</span><span class="op" id="5805649">)</span>&nbsp;<span class="ident" id="5805651">Write</span><span class="op" id="5805656">(</span><span class="ident" id="5805657">record</span>&nbsp;<span class="op" id="5805664">[</span><span class="op" id="5805665">]</span><span class="builtintype" id="5805666">string</span><span class="op" id="5805672">)</span>&nbsp;<span class="op" id="5805674">(</span><span class="ident" id="5805675">err</span>&nbsp;<span class="builtintype" id="5805679">error</span><span class="op" id="5805684">)</span>&nbsp;<span class="op" id="5805686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805689">for</span>&nbsp;<span class="ident" id="5805693">n</span><span class="op" id="5805694">,</span>&nbsp;<span class="ident" id="5805696">field</span>&nbsp;<span class="op" id="5805702">:=</span>&nbsp;<span class="keyword" id="5805705">range</span>&nbsp;<span class="ident" id="5805711">record</span>&nbsp;<span class="op" id="5805718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805722">if</span>&nbsp;<span class="ident" id="5805725">n</span>&nbsp;<span class="op" id="5805727">&gt;</span>&nbsp;<span class="num" id="5805729">0</span>&nbsp;<span class="op" id="5805731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805736">if</span>&nbsp;<span class="ident" id="5805739">_</span><span class="op" id="5805740">,</span>&nbsp;<span class="ident" id="5805742">err</span>&nbsp;<span class="op" id="5805746">=</span>&nbsp;<span class="ident" id="5805748">w</span><span class="op" id="5805749">.</span><span class="ident" id="5805750">w</span><span class="op" id="5805751">.</span><span class="ident" id="5805752">WriteRune</span><span class="op" id="5805761">(</span><span class="ident" id="5805762">w</span><span class="op" id="5805763">.</span><span class="ident" id="5805764">Comma</span><span class="op" id="5805769">)</span><span class="op" id="5805770">;</span>&nbsp;<span class="ident" id="5805772">err</span>&nbsp;<span class="op" id="5805776">!=</span>&nbsp;<span class="ident" id="5805779">nil</span>&nbsp;<span class="op" id="5805783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805789">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5805799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5805803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5805808">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5805863">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805920">if</span>&nbsp;<span class="op" id="5805923">!</span><span class="ident" id="5805924">w</span><span class="op" id="5805925">.</span><span class="ident" id="5805926">fieldNeedsQuotes</span><span class="op" id="5805942">(</span><span class="ident" id="5805943">field</span><span class="op" id="5805948">)</span>&nbsp;<span class="op" id="5805950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805955">if</span>&nbsp;<span class="ident" id="5805958">_</span><span class="op" id="5805959">,</span>&nbsp;<span class="ident" id="5805961">err</span>&nbsp;<span class="op" id="5805965">=</span>&nbsp;<span class="ident" id="5805967">w</span><span class="op" id="5805968">.</span><span class="ident" id="5805969">w</span><span class="op" id="5805970">.</span><span class="ident" id="5805971">WriteString</span><span class="op" id="5805982">(</span><span class="ident" id="5805983">field</span><span class="op" id="5805988">)</span><span class="op" id="5805989">;</span>&nbsp;<span class="ident" id="5805991">err</span>&nbsp;<span class="op" id="5805995">!=</span>&nbsp;<span class="ident" id="5805998">nil</span>&nbsp;<span class="op" id="5806002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806008">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806023">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806038">if</span>&nbsp;<span class="ident" id="5806041">err</span>&nbsp;<span class="op" id="5806045">=</span>&nbsp;<span class="ident" id="5806047">w</span><span class="op" id="5806048">.</span><span class="ident" id="5806049">w</span><span class="op" id="5806050">.</span><span class="ident" id="5806051">WriteByte</span><span class="op" id="5806060">(</span><span class="string" id="5806061">&#39;&#34;&#39;</span><span class="op" id="5806064">)</span><span class="op" id="5806065">;</span>&nbsp;<span class="ident" id="5806067">err</span>&nbsp;<span class="op" id="5806071">!=</span>&nbsp;<span class="ident" id="5806074">nil</span>&nbsp;<span class="op" id="5806078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806083">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806097">for</span>&nbsp;<span class="ident" id="5806101">_</span><span class="op" id="5806102">,</span>&nbsp;<span class="ident" id="5806104">r1</span>&nbsp;<span class="op" id="5806107">:=</span>&nbsp;<span class="keyword" id="5806110">range</span>&nbsp;<span class="ident" id="5806116">field</span>&nbsp;<span class="op" id="5806122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806127">switch</span>&nbsp;<span class="ident" id="5806134">r1</span>&nbsp;<span class="op" id="5806137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806142">case</span>&nbsp;<span class="string" id="5806147">&#39;&#34;&#39;</span><span class="op" id="5806150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806156">_</span><span class="op" id="5806157">,</span>&nbsp;<span class="ident" id="5806159">err</span>&nbsp;<span class="op" id="5806163">=</span>&nbsp;<span class="ident" id="5806165">w</span><span class="op" id="5806166">.</span><span class="ident" id="5806167">w</span><span class="op" id="5806168">.</span><span class="ident" id="5806169">WriteString</span><span class="op" id="5806180">(</span><span class="string" id="5806181">`&#34;&#34;`</span><span class="op" id="5806185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806190">case</span>&nbsp;<span class="string" id="5806195">&#39;\r&#39;</span><span class="op" id="5806199">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806205">if</span>&nbsp;<span class="op" id="5806208">!</span><span class="ident" id="5806209">w</span><span class="op" id="5806210">.</span><span class="ident" id="5806211">UseCRLF</span>&nbsp;<span class="op" id="5806219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806226">err</span>&nbsp;<span class="op" id="5806230">=</span>&nbsp;<span class="ident" id="5806232">w</span><span class="op" id="5806233">.</span><span class="ident" id="5806234">w</span><span class="op" id="5806235">.</span><span class="ident" id="5806236">WriteByte</span><span class="op" id="5806245">(</span><span class="string" id="5806246">&#39;\r&#39;</span><span class="op" id="5806250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806261">case</span>&nbsp;<span class="string" id="5806266">&#39;\n&#39;</span><span class="op" id="5806270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806276">if</span>&nbsp;<span class="ident" id="5806279">w</span><span class="op" id="5806280">.</span><span class="ident" id="5806281">UseCRLF</span>&nbsp;<span class="op" id="5806289">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806296">_</span><span class="op" id="5806297">,</span>&nbsp;<span class="ident" id="5806299">err</span>&nbsp;<span class="op" id="5806303">=</span>&nbsp;<span class="ident" id="5806305">w</span><span class="op" id="5806306">.</span><span class="ident" id="5806307">w</span><span class="op" id="5806308">.</span><span class="ident" id="5806309">WriteString</span><span class="op" id="5806320">(</span><span class="string" id="5806321">&#34;\r\n&#34;</span><span class="op" id="5806327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806333">}</span>&nbsp;<span class="keyword" id="5806335">else</span>&nbsp;<span class="op" id="5806340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806347">err</span>&nbsp;<span class="op" id="5806351">=</span>&nbsp;<span class="ident" id="5806353">w</span><span class="op" id="5806354">.</span><span class="ident" id="5806355">w</span><span class="op" id="5806356">.</span><span class="ident" id="5806357">WriteByte</span><span class="op" id="5806366">(</span><span class="string" id="5806367">&#39;\n&#39;</span><span class="op" id="5806371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806382">default</span><span class="op" id="5806389">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806395">_</span><span class="op" id="5806396">,</span>&nbsp;<span class="ident" id="5806398">err</span>&nbsp;<span class="op" id="5806402">=</span>&nbsp;<span class="ident" id="5806404">w</span><span class="op" id="5806405">.</span><span class="ident" id="5806406">w</span><span class="op" id="5806407">.</span><span class="ident" id="5806408">WriteRune</span><span class="op" id="5806417">(</span><span class="ident" id="5806418">r1</span><span class="op" id="5806420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806430">if</span>&nbsp;<span class="ident" id="5806433">err</span>&nbsp;<span class="op" id="5806437">!=</span>&nbsp;<span class="ident" id="5806440">nil</span>&nbsp;<span class="op" id="5806444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806460">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806469">if</span>&nbsp;<span class="ident" id="5806472">err</span>&nbsp;<span class="op" id="5806476">=</span>&nbsp;<span class="ident" id="5806478">w</span><span class="op" id="5806479">.</span><span class="ident" id="5806480">w</span><span class="op" id="5806481">.</span><span class="ident" id="5806482">WriteByte</span><span class="op" id="5806491">(</span><span class="string" id="5806492">&#39;&#34;&#39;</span><span class="op" id="5806495">)</span><span class="op" id="5806496">;</span>&nbsp;<span class="ident" id="5806498">err</span>&nbsp;<span class="op" id="5806502">!=</span>&nbsp;<span class="ident" id="5806505">nil</span>&nbsp;<span class="op" id="5806509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806514">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806523">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806529">if</span>&nbsp;<span class="ident" id="5806532">w</span><span class="op" id="5806533">.</span><span class="ident" id="5806534">UseCRLF</span>&nbsp;<span class="op" id="5806542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806546">_</span><span class="op" id="5806547">,</span>&nbsp;<span class="ident" id="5806549">err</span>&nbsp;<span class="op" id="5806553">=</span>&nbsp;<span class="ident" id="5806555">w</span><span class="op" id="5806556">.</span><span class="ident" id="5806557">w</span><span class="op" id="5806558">.</span><span class="ident" id="5806559">WriteString</span><span class="op" id="5806570">(</span><span class="string" id="5806571">&#34;\r\n&#34;</span><span class="op" id="5806577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806580">}</span>&nbsp;<span class="keyword" id="5806582">else</span>&nbsp;<span class="op" id="5806587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806591">err</span>&nbsp;<span class="op" id="5806595">=</span>&nbsp;<span class="ident" id="5806597">w</span><span class="op" id="5806598">.</span><span class="ident" id="5806599">w</span><span class="op" id="5806600">.</span><span class="ident" id="5806601">WriteByte</span><span class="op" id="5806610">(</span><span class="string" id="5806611">&#39;\n&#39;</span><span class="op" id="5806615">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5806618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806621">return</span><br>
<span class="lineno"></span><span class="op" id="5806628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5806631">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="5806694">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="5806757">func</span>&nbsp;<span class="op" id="5806762">(</span><span class="ident" id="5806763">w</span>&nbsp;<span class="op" id="5806765">*</span><span class="ident" id="5806766">Writer</span><span class="op" id="5806772">)</span>&nbsp;<span class="ident" id="5806774">Flush</span><span class="op" id="5806779">(</span><span class="op" id="5806780">)</span>&nbsp;<span class="op" id="5806782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806785">w</span><span class="op" id="5806786">.</span><span class="ident" id="5806787">w</span><span class="op" id="5806788">.</span><span class="ident" id="5806789">Flush</span><span class="op" id="5806794">(</span><span class="op" id="5806795">)</span><br>
<span class="lineno"></span><span class="op" id="5806797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5806800">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="5806879">func</span>&nbsp;<span class="op" id="5806884">(</span><span class="ident" id="5806885">w</span>&nbsp;<span class="op" id="5806887">*</span><span class="ident" id="5806888">Writer</span><span class="op" id="5806894">)</span>&nbsp;<span class="ident" id="5806896">Error</span><span class="op" id="5806901">(</span><span class="op" id="5806902">)</span>&nbsp;<span class="builtintype" id="5806904">error</span>&nbsp;<span class="op" id="5806910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5806913">_</span><span class="op" id="5806914">,</span>&nbsp;<span class="ident" id="5806916">err</span>&nbsp;<span class="op" id="5806920">:=</span>&nbsp;<span class="ident" id="5806923">w</span><span class="op" id="5806924">.</span><span class="ident" id="5806925">w</span><span class="op" id="5806926">.</span><span class="ident" id="5806927">Write</span><span class="op" id="5806932">(</span><span class="ident" id="5806933">nil</span><span class="op" id="5806936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5806939">return</span>&nbsp;<span class="ident" id="5806946">err</span><br>
<span class="lineno"></span><span class="op" id="5806950">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5806953">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="5807032">func</span>&nbsp;<span class="op" id="5807037">(</span><span class="ident" id="5807038">w</span>&nbsp;<span class="op" id="5807040">*</span><span class="ident" id="5807041">Writer</span><span class="op" id="5807047">)</span>&nbsp;<span class="ident" id="5807049">WriteAll</span><span class="op" id="5807057">(</span><span class="ident" id="5807058">records</span>&nbsp;<span class="op" id="5807066">[</span><span class="op" id="5807067">]</span><span class="op" id="5807068">[</span><span class="op" id="5807069">]</span><span class="builtintype" id="5807070">string</span><span class="op" id="5807076">)</span>&nbsp;<span class="op" id="5807078">(</span><span class="ident" id="5807079">err</span>&nbsp;<span class="builtintype" id="5807083">error</span><span class="op" id="5807088">)</span>&nbsp;<span class="op" id="5807090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5807093">for</span>&nbsp;<span class="ident" id="5807097">_</span><span class="op" id="5807098">,</span>&nbsp;<span class="ident" id="5807100">record</span>&nbsp;<span class="op" id="5807107">:=</span>&nbsp;<span class="keyword" id="5807110">range</span>&nbsp;<span class="ident" id="5807116">records</span>&nbsp;<span class="op" id="5807124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5807128">err</span>&nbsp;<span class="op" id="5807132">=</span>&nbsp;<span class="ident" id="5807134">w</span><span class="op" id="5807135">.</span><span class="ident" id="5807136">Write</span><span class="op" id="5807141">(</span><span class="ident" id="5807142">record</span><span class="op" id="5807148">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5807152">if</span>&nbsp;<span class="ident" id="5807155">err</span>&nbsp;<span class="op" id="5807159">!=</span>&nbsp;<span class="ident" id="5807162">nil</span>&nbsp;<span class="op" id="5807166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5807171">return</span>&nbsp;<span class="ident" id="5807178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5807190">return</span>&nbsp;<span class="ident" id="5807197">w</span><span class="op" id="5807198">.</span><span class="ident" id="5807199">w</span><span class="op" id="5807200">.</span><span class="ident" id="5807201">Flush</span><span class="op" id="5807206">(</span><span class="op" id="5807207">)</span><br>
<span class="lineno">115</span><span class="op" id="5807209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5807212">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="5807286">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5807346">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="5807409">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="5807482">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="5807558">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5807631">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5807703">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="5807772">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="5807827">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="5807902">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="5807942">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="5807997">func</span>&nbsp;<span class="op" id="5808002">(</span><span class="ident" id="5808003">w</span>&nbsp;<span class="op" id="5808005">*</span><span class="ident" id="5808006">Writer</span><span class="op" id="5808012">)</span>&nbsp;<span class="ident" id="5808014">fieldNeedsQuotes</span><span class="op" id="5808030">(</span><span class="ident" id="5808031">field</span>&nbsp;<span class="builtintype" id="5808037">string</span><span class="op" id="5808043">)</span>&nbsp;<span class="builtintype" id="5808045">bool</span>&nbsp;<span class="op" id="5808050">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5808053">if</span>&nbsp;<span class="ident" id="5808056">field</span>&nbsp;<span class="op" id="5808062">==</span>&nbsp;<span class="string" id="5808065">&#34;&#34;</span>&nbsp;<span class="op" id="5808068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5808072">return</span>&nbsp;<span class="builtintype" id="5808079">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5808086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5808089">if</span>&nbsp;<span class="ident" id="5808092">field</span>&nbsp;<span class="op" id="5808098">==</span>&nbsp;<span class="string" id="5808101">`\.`</span>&nbsp;<span class="op" id="5808106">||</span>&nbsp;<span class="ident" id="5808109">strings</span><span class="op" id="5808116">.</span><span class="ident" id="5808117">IndexRune</span><span class="op" id="5808126">(</span><span class="ident" id="5808127">field</span><span class="op" id="5808132">,</span>&nbsp;<span class="ident" id="5808134">w</span><span class="op" id="5808135">.</span><span class="ident" id="5808136">Comma</span><span class="op" id="5808141">)</span>&nbsp;<span class="op" id="5808143">&gt;=</span>&nbsp;<span class="num" id="5808146">0</span>&nbsp;<span class="op" id="5808148">||</span>&nbsp;<span class="ident" id="5808151">strings</span><span class="op" id="5808158">.</span><span class="ident" id="5808159">IndexAny</span><span class="op" id="5808167">(</span><span class="ident" id="5808168">field</span><span class="op" id="5808173">,</span>&nbsp;<span class="string" id="5808175">&#34;\&#34;\r\n&#34;</span><span class="op" id="5808183">)</span>&nbsp;<span class="op" id="5808185">&gt;=</span>&nbsp;<span class="num" id="5808188">0</span>&nbsp;<span class="op" id="5808190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5808194">return</span>&nbsp;<span class="builtintype" id="5808201">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5808207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5808211">r1</span><span class="op" id="5808213">,</span>&nbsp;<span class="ident" id="5808215">_</span>&nbsp;<span class="op" id="5808217">:=</span>&nbsp;<span class="ident" id="5808220">utf8</span><span class="op" id="5808224">.</span><span class="ident" id="5808225">DecodeRuneInString</span><span class="op" id="5808243">(</span><span class="ident" id="5808244">field</span><span class="op" id="5808249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5808252">return</span>&nbsp;<span class="ident" id="5808259">unicode</span><span class="op" id="5808266">.</span><span class="ident" id="5808267">IsSpace</span><span class="op" id="5808274">(</span><span class="ident" id="5808275">r1</span><span class="op" id="5808277">)</span><br>
<span class="lineno"></span><span class="op" id="5808279">}</span>
</div>
</body>
</html>
