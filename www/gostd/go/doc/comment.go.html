<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html" class="current">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2995617">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2995672">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2995726">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2995777">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995838">package</span>&nbsp;<span class="ident" id="2995846">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995851">import</span>&nbsp;<span class="op" id="2995858">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995861">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995867">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995877">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995888">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="2995904">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995923">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2995934">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2995949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995952">var</span>&nbsp;<span class="op" id="2995956">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995959">ldquo</span>&nbsp;<span class="op" id="2995965">=</span>&nbsp;<span class="op" id="2995967">[</span><span class="op" id="2995968">]</span><span class="builtintype" id="2995969">byte</span><span class="op" id="2995973">(</span><span class="string" id="2995974">&#34;&amp;ldquo;&#34;</span><span class="op" id="2995983">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995986">rdquo</span>&nbsp;<span class="op" id="2995992">=</span>&nbsp;<span class="op" id="2995994">[</span><span class="op" id="2995995">]</span><span class="builtintype" id="2995996">byte</span><span class="op" id="2996000">(</span><span class="string" id="2996001">&#34;&amp;rdquo;&#34;</span><span class="op" id="2996010">)</span><br>
<span class="lineno"></span><span class="op" id="2996012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2996015">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="2996064">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="2996114">func</span>&nbsp;<span class="ident" id="2996119">commentEscape</span><span class="op" id="2996132">(</span><span class="ident" id="2996133">w</span>&nbsp;<span class="ident" id="2996135">io</span><span class="op" id="2996137">.</span><span class="ident" id="2996138">Writer</span><span class="op" id="2996144">,</span>&nbsp;<span class="ident" id="2996146">text</span>&nbsp;<span class="builtintype" id="2996151">string</span><span class="op" id="2996157">,</span>&nbsp;<span class="ident" id="2996159">nice</span>&nbsp;<span class="builtintype" id="2996164">bool</span><span class="op" id="2996168">)</span>&nbsp;<span class="op" id="2996170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996173">last</span>&nbsp;<span class="op" id="2996178">:=</span>&nbsp;<span class="num" id="2996181">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996184">if</span>&nbsp;<span class="ident" id="2996187">nice</span>&nbsp;<span class="op" id="2996192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996196">for</span>&nbsp;<span class="ident" id="2996200">i</span>&nbsp;<span class="op" id="2996202">:=</span>&nbsp;<span class="num" id="2996205">0</span><span class="op" id="2996206">;</span>&nbsp;<span class="ident" id="2996208">i</span>&nbsp;<span class="op" id="2996210">&lt;</span>&nbsp;<span class="builtinfunc" id="2996212">len</span><span class="op" id="2996215">(</span><span class="ident" id="2996216">text</span><span class="op" id="2996220">)</span><span class="op" id="2996221">-</span><span class="num" id="2996222">1</span><span class="op" id="2996223">;</span>&nbsp;<span class="ident" id="2996225">i</span><span class="op" id="2996226">++</span>&nbsp;<span class="op" id="2996229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996234">ch</span>&nbsp;<span class="op" id="2996237">:=</span>&nbsp;<span class="ident" id="2996240">text</span><span class="op" id="2996244">[</span><span class="ident" id="2996245">i</span><span class="op" id="2996246">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996251">if</span>&nbsp;<span class="ident" id="2996254">ch</span>&nbsp;<span class="op" id="2996257">==</span>&nbsp;<span class="ident" id="2996260">text</span><span class="op" id="2996264">[</span><span class="ident" id="2996265">i</span><span class="op" id="2996266">+</span><span class="num" id="2996267">1</span><span class="op" id="2996268">]</span>&nbsp;<span class="op" id="2996270">&amp;&amp;</span>&nbsp;<span class="op" id="2996273">(</span><span class="ident" id="2996274">ch</span>&nbsp;<span class="op" id="2996277">==</span>&nbsp;<span class="string" id="2996280">&#39;`&#39;</span>&nbsp;<span class="op" id="2996284">||</span>&nbsp;<span class="ident" id="2996287">ch</span>&nbsp;<span class="op" id="2996290">==</span>&nbsp;<span class="string" id="2996293">&#39;\&#39;&#39;</span><span class="op" id="2996297">)</span>&nbsp;<span class="op" id="2996299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996305">template</span><span class="op" id="2996313">.</span><span class="ident" id="2996314">HTMLEscape</span><span class="op" id="2996324">(</span><span class="ident" id="2996325">w</span><span class="op" id="2996326">,</span>&nbsp;<span class="op" id="2996328">[</span><span class="op" id="2996329">]</span><span class="builtintype" id="2996330">byte</span><span class="op" id="2996334">(</span><span class="ident" id="2996335">text</span><span class="op" id="2996339">[</span><span class="ident" id="2996340">last</span><span class="op" id="2996344">:</span><span class="ident" id="2996345">i</span><span class="op" id="2996346">]</span><span class="op" id="2996347">)</span><span class="op" id="2996348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996354">last</span>&nbsp;<span class="op" id="2996359">=</span>&nbsp;<span class="ident" id="2996361">i</span>&nbsp;<span class="op" id="2996363">+</span>&nbsp;<span class="num" id="2996365">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996371">switch</span>&nbsp;<span class="ident" id="2996378">ch</span>&nbsp;<span class="op" id="2996381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996387">case</span>&nbsp;<span class="string" id="2996392">&#39;`&#39;</span><span class="op" id="2996395">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996402">w</span><span class="op" id="2996403">.</span><span class="ident" id="2996404">Write</span><span class="op" id="2996409">(</span><span class="ident" id="2996410">ldquo</span><span class="op" id="2996415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996421">case</span>&nbsp;<span class="string" id="2996426">&#39;\&#39;&#39;</span><span class="op" id="2996430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996437">w</span><span class="op" id="2996438">.</span><span class="ident" id="2996439">Write</span><span class="op" id="2996444">(</span><span class="ident" id="2996445">rdquo</span><span class="op" id="2996450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996462">i</span><span class="op" id="2996463">++</span>&nbsp;<span class="comment" id="2996466">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996505">template</span><span class="op" id="2996513">.</span><span class="ident" id="2996514">HTMLEscape</span><span class="op" id="2996524">(</span><span class="ident" id="2996525">w</span><span class="op" id="2996526">,</span>&nbsp;<span class="op" id="2996528">[</span><span class="op" id="2996529">]</span><span class="builtintype" id="2996530">byte</span><span class="op" id="2996534">(</span><span class="ident" id="2996535">text</span><span class="op" id="2996539">[</span><span class="ident" id="2996540">last</span><span class="op" id="2996544">:</span><span class="op" id="2996545">]</span><span class="op" id="2996546">)</span><span class="op" id="2996547">)</span><br>
<span class="lineno"></span><span class="op" id="2996549">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="2996552">const</span>&nbsp;<span class="op" id="2996558">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2996561">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996591">identRx</span>&nbsp;<span class="op" id="2996599">=</span>&nbsp;<span class="string" id="2996601">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2996622">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996642">protocol</span>&nbsp;<span class="op" id="2996651">=</span>&nbsp;<span class="string" id="2996653">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996717">hostPart</span>&nbsp;<span class="op" id="2996726">=</span>&nbsp;<span class="string" id="2996728">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996748">filePart</span>&nbsp;<span class="op" id="2996757">=</span>&nbsp;<span class="string" id="2996759">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="2996787">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996850">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996859">=</span>&nbsp;<span class="string" id="2996861">`(`</span>&nbsp;<span class="op" id="2996865">+</span>&nbsp;<span class="ident" id="2996867">protocol</span>&nbsp;<span class="op" id="2996876">+</span>&nbsp;<span class="string" id="2996878">`)://`</span>&nbsp;<span class="op" id="2996885">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2996889">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996902">hostPart</span>&nbsp;<span class="op" id="2996911">+</span>&nbsp;<span class="string" id="2996913">`([.:]`</span>&nbsp;<span class="op" id="2996921">+</span>&nbsp;<span class="ident" id="2996923">hostPart</span>&nbsp;<span class="op" id="2996932">+</span>&nbsp;<span class="string" id="2996934">`)*/?`</span>&nbsp;<span class="op" id="2996941">+</span>&nbsp;<span class="comment" id="2996943">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996971">filePart</span>&nbsp;<span class="op" id="2996980">+</span>&nbsp;<span class="string" id="2996982">`([:.,]`</span>&nbsp;<span class="op" id="2996991">+</span>&nbsp;<span class="ident" id="2996993">filePart</span>&nbsp;<span class="op" id="2997002">+</span>&nbsp;<span class="string" id="2997004">`)*`</span><br>
<span class="lineno"></span><span class="op" id="2997009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2997012">var</span>&nbsp;<span class="ident" id="2997016">matchRx</span>&nbsp;<span class="op" id="2997024">=</span>&nbsp;<span class="ident" id="2997026">regexp</span><span class="op" id="2997032">.</span><span class="ident" id="2997033">MustCompile</span><span class="op" id="2997044">(</span><span class="string" id="2997045">`(`</span>&nbsp;<span class="op" id="2997049">+</span>&nbsp;<span class="ident" id="2997051">urlRx</span>&nbsp;<span class="op" id="2997057">+</span>&nbsp;<span class="string" id="2997059">`)|(`</span>&nbsp;<span class="op" id="2997065">+</span>&nbsp;<span class="ident" id="2997067">identRx</span>&nbsp;<span class="op" id="2997075">+</span>&nbsp;<span class="string" id="2997077">`)`</span><span class="op" id="2997080">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="2997083">var</span>&nbsp;<span class="op" id="2997087">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997090">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997102">=</span>&nbsp;<span class="op" id="2997104">[</span><span class="op" id="2997105">]</span><span class="builtintype" id="2997106">byte</span><span class="op" id="2997110">(</span><span class="string" id="2997111">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="2997122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997125">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997137">=</span>&nbsp;<span class="op" id="2997139">[</span><span class="op" id="2997140">]</span><span class="builtintype" id="2997141">byte</span><span class="op" id="2997145">(</span><span class="string" id="2997146">`&#34;&gt;`</span><span class="op" id="2997150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997153">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2997165">=</span>&nbsp;<span class="op" id="2997167">[</span><span class="op" id="2997168">]</span><span class="builtintype" id="2997169">byte</span><span class="op" id="2997173">(</span><span class="string" id="2997174">&#34;&lt;/a&gt;&#34;</span><span class="op" id="2997180">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997183">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997195">=</span>&nbsp;<span class="op" id="2997197">[</span><span class="op" id="2997198">]</span><span class="builtintype" id="2997199">byte</span><span class="op" id="2997203">(</span><span class="string" id="2997204">&#34;&lt;i&gt;&#34;</span><span class="op" id="2997209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997212">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2997224">=</span>&nbsp;<span class="op" id="2997226">[</span><span class="op" id="2997227">]</span><span class="builtintype" id="2997228">byte</span><span class="op" id="2997232">(</span><span class="string" id="2997233">&#34;&lt;/i&gt;&#34;</span><span class="op" id="2997239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997242">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997254">=</span>&nbsp;<span class="op" id="2997256">[</span><span class="op" id="2997257">]</span><span class="builtintype" id="2997258">byte</span><span class="op" id="2997262">(</span><span class="string" id="2997263">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="2997270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997273">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2997285">=</span>&nbsp;<span class="op" id="2997287">[</span><span class="op" id="2997288">]</span><span class="builtintype" id="2997289">byte</span><span class="op" id="2997293">(</span><span class="string" id="2997294">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="2997302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997305">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997317">=</span>&nbsp;<span class="op" id="2997319">[</span><span class="op" id="2997320">]</span><span class="builtintype" id="2997321">byte</span><span class="op" id="2997325">(</span><span class="string" id="2997326">&#34;&lt;pre&gt;&#34;</span><span class="op" id="2997333">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997336">html_endpre</span>&nbsp;<span class="op" id="2997348">=</span>&nbsp;<span class="op" id="2997350">[</span><span class="op" id="2997351">]</span><span class="builtintype" id="2997352">byte</span><span class="op" id="2997356">(</span><span class="string" id="2997357">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="2997367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997370">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997382">=</span>&nbsp;<span class="op" id="2997384">[</span><span class="op" id="2997385">]</span><span class="builtintype" id="2997386">byte</span><span class="op" id="2997390">(</span><span class="string" id="2997391">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="2997401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997404">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997416">=</span>&nbsp;<span class="op" id="2997418">[</span><span class="op" id="2997419">]</span><span class="builtintype" id="2997420">byte</span><span class="op" id="2997424">(</span><span class="string" id="2997425">`&#34;&gt;`</span><span class="op" id="2997429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997432">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2997444">=</span>&nbsp;<span class="op" id="2997446">[</span><span class="op" id="2997447">]</span><span class="builtintype" id="2997448">byte</span><span class="op" id="2997452">(</span><span class="string" id="2997453">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="2997462">)</span><br>
<span class="lineno"></span><span class="op" id="2997464">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="2997467">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="2997569">func</span>&nbsp;<span class="ident" id="2997574">pairedParensPrefixLen</span><span class="op" id="2997595">(</span><span class="ident" id="2997596">s</span>&nbsp;<span class="builtintype" id="2997598">string</span><span class="op" id="2997604">)</span>&nbsp;<span class="builtintype" id="2997606">int</span>&nbsp;<span class="op" id="2997610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997613">parens</span>&nbsp;<span class="op" id="2997620">:=</span>&nbsp;<span class="num" id="2997623">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997626">l</span>&nbsp;<span class="op" id="2997628">:=</span>&nbsp;<span class="builtinfunc" id="2997631">len</span><span class="op" id="2997634">(</span><span class="ident" id="2997635">s</span><span class="op" id="2997636">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997639">for</span>&nbsp;<span class="ident" id="2997643">i</span><span class="op" id="2997644">,</span>&nbsp;<span class="ident" id="2997646">ch</span>&nbsp;<span class="op" id="2997649">:=</span>&nbsp;<span class="keyword" id="2997652">range</span>&nbsp;<span class="ident" id="2997658">s</span>&nbsp;<span class="op" id="2997660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997664">switch</span>&nbsp;<span class="ident" id="2997671">ch</span>&nbsp;<span class="op" id="2997674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997678">case</span>&nbsp;<span class="string" id="2997683">&#39;(&#39;</span><span class="op" id="2997686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997691">if</span>&nbsp;<span class="ident" id="2997694">parens</span>&nbsp;<span class="op" id="2997701">==</span>&nbsp;<span class="num" id="2997704">0</span>&nbsp;<span class="op" id="2997706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997712">l</span>&nbsp;<span class="op" id="2997714">=</span>&nbsp;<span class="ident" id="2997716">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997726">parens</span><span class="op" id="2997732">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997737">case</span>&nbsp;<span class="string" id="2997742">&#39;)&#39;</span><span class="op" id="2997745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997750">parens</span><span class="op" id="2997756">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997762">if</span>&nbsp;<span class="ident" id="2997765">parens</span>&nbsp;<span class="op" id="2997772">==</span>&nbsp;<span class="num" id="2997775">0</span>&nbsp;<span class="op" id="2997777">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997783">l</span>&nbsp;<span class="op" id="2997785">=</span>&nbsp;<span class="builtinfunc" id="2997787">len</span><span class="op" id="2997790">(</span><span class="ident" id="2997791">s</span><span class="op" id="2997792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997797">}</span>&nbsp;<span class="keyword" id="2997799">else</span>&nbsp;<span class="keyword" id="2997804">if</span>&nbsp;<span class="ident" id="2997807">parens</span>&nbsp;<span class="op" id="2997814">&lt;</span>&nbsp;<span class="num" id="2997816">0</span>&nbsp;<span class="op" id="2997818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997824">return</span>&nbsp;<span class="ident" id="2997831">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997840">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997846">return</span>&nbsp;<span class="ident" id="2997853">l</span><br>
<span class="lineno"></span><span class="op" id="2997855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2997858">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="2997938">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="2998018">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="2998095">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2998175">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="2998254">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="2998333">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="2998413">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="2998438">func</span>&nbsp;<span class="ident" id="2998443">emphasize</span><span class="op" id="2998452">(</span><span class="ident" id="2998453">w</span>&nbsp;<span class="ident" id="2998455">io</span><span class="op" id="2998457">.</span><span class="ident" id="2998458">Writer</span><span class="op" id="2998464">,</span>&nbsp;<span class="ident" id="2998466">line</span>&nbsp;<span class="builtintype" id="2998471">string</span><span class="op" id="2998477">,</span>&nbsp;<span class="ident" id="2998479">words</span>&nbsp;<span class="keyword" id="2998485">map</span><span class="op" id="2998488">[</span><span class="builtintype" id="2998489">string</span><span class="op" id="2998495">]</span><span class="builtintype" id="2998496">string</span><span class="op" id="2998502">,</span>&nbsp;<span class="ident" id="2998504">nice</span>&nbsp;<span class="builtintype" id="2998509">bool</span><span class="op" id="2998513">)</span>&nbsp;<span class="op" id="2998515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998518">for</span>&nbsp;<span class="op" id="2998522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998526">m</span>&nbsp;<span class="op" id="2998528">:=</span>&nbsp;<span class="ident" id="2998531">matchRx</span><span class="op" id="2998538">.</span><span class="ident" id="2998539">FindStringSubmatchIndex</span><span class="op" id="2998562">(</span><span class="ident" id="2998563">line</span><span class="op" id="2998567">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998571">if</span>&nbsp;<span class="ident" id="2998574">m</span>&nbsp;<span class="op" id="2998576">==</span>&nbsp;<span class="ident" id="2998579">nil</span>&nbsp;<span class="op" id="2998583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998588">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998600">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998674">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998703">commentEscape</span><span class="op" id="2998716">(</span><span class="ident" id="2998717">w</span><span class="op" id="2998718">,</span>&nbsp;<span class="ident" id="2998720">line</span><span class="op" id="2998724">[</span><span class="num" id="2998725">0</span><span class="op" id="2998726">:</span><span class="ident" id="2998727">m</span><span class="op" id="2998728">[</span><span class="num" id="2998729">0</span><span class="op" id="2998730">]</span><span class="op" id="2998731">]</span><span class="op" id="2998732">,</span>&nbsp;<span class="ident" id="2998734">nice</span><span class="op" id="2998738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998743">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998774">match</span>&nbsp;<span class="op" id="2998780">:=</span>&nbsp;<span class="ident" id="2998783">line</span><span class="op" id="2998787">[</span><span class="ident" id="2998788">m</span><span class="op" id="2998789">[</span><span class="num" id="2998790">0</span><span class="op" id="2998791">]</span><span class="op" id="2998792">:</span><span class="ident" id="2998793">m</span><span class="op" id="2998794">[</span><span class="num" id="2998795">1</span><span class="op" id="2998796">]</span><span class="op" id="2998797">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998801">if</span>&nbsp;<span class="ident" id="2998804">n</span>&nbsp;<span class="op" id="2998806">:=</span>&nbsp;<span class="ident" id="2998809">pairedParensPrefixLen</span><span class="op" id="2998830">(</span><span class="ident" id="2998831">match</span><span class="op" id="2998836">)</span><span class="op" id="2998837">;</span>&nbsp;<span class="ident" id="2998839">n</span>&nbsp;<span class="op" id="2998841">&lt;</span>&nbsp;<span class="builtinfunc" id="2998843">len</span><span class="op" id="2998846">(</span><span class="ident" id="2998847">match</span><span class="op" id="2998852">)</span>&nbsp;<span class="op" id="2998854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998859">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998909">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998969">m</span>&nbsp;<span class="op" id="2998971">=</span>&nbsp;<span class="ident" id="2998973">matchRx</span><span class="op" id="2998980">.</span><span class="ident" id="2998981">FindStringSubmatchIndex</span><span class="op" id="2999004">(</span><span class="ident" id="2999005">line</span><span class="op" id="2999009">[</span><span class="op" id="2999010">:</span><span class="ident" id="2999011">m</span><span class="op" id="2999012">[</span><span class="num" id="2999013">0</span><span class="op" id="2999014">]</span><span class="op" id="2999015">+</span><span class="ident" id="2999016">n</span><span class="op" id="2999017">]</span><span class="op" id="2999018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999023">match</span>&nbsp;<span class="op" id="2999029">=</span>&nbsp;<span class="ident" id="2999031">match</span><span class="op" id="2999036">[</span><span class="op" id="2999037">:</span><span class="ident" id="2999038">n</span><span class="op" id="2999039">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2999048">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999067">url</span>&nbsp;<span class="op" id="2999071">:=</span>&nbsp;<span class="string" id="2999074">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999079">italics</span>&nbsp;<span class="op" id="2999087">:=</span>&nbsp;<span class="builtintype" id="2999090">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999098">if</span>&nbsp;<span class="ident" id="2999101">words</span>&nbsp;<span class="op" id="2999107">!=</span>&nbsp;<span class="ident" id="2999110">nil</span>&nbsp;<span class="op" id="2999114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999119">url</span><span class="op" id="2999122">,</span>&nbsp;<span class="ident" id="2999124">italics</span>&nbsp;<span class="op" id="2999132">=</span>&nbsp;<span class="ident" id="2999134">words</span><span class="op" id="2999139">[</span><span class="ident" id="2999140">match</span><span class="op" id="2999145">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999153">if</span>&nbsp;<span class="ident" id="2999156">m</span><span class="op" id="2999157">[</span><span class="num" id="2999158">2</span><span class="op" id="2999159">]</span>&nbsp;<span class="op" id="2999161">&gt;=</span>&nbsp;<span class="num" id="2999164">0</span>&nbsp;<span class="op" id="2999166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2999171">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999251">if</span>&nbsp;<span class="op" id="2999254">!</span><span class="ident" id="2999255">italics</span>&nbsp;<span class="op" id="2999263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2999269">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999328">url</span>&nbsp;<span class="op" id="2999332">=</span>&nbsp;<span class="ident" id="2999334">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999348">italics</span>&nbsp;<span class="op" id="2999356">=</span>&nbsp;<span class="builtintype" id="2999358">false</span>&nbsp;<span class="comment" id="2999364">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2999395">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999412">if</span>&nbsp;<span class="builtinfunc" id="2999415">len</span><span class="op" id="2999418">(</span><span class="ident" id="2999419">url</span><span class="op" id="2999422">)</span>&nbsp;<span class="op" id="2999424">&gt;</span>&nbsp;<span class="num" id="2999426">0</span>&nbsp;<span class="op" id="2999428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999433">w</span><span class="op" id="2999434">.</span><span class="ident" id="2999435">Write</span><span class="op" id="2999440">(</span><span class="ident" id="2999441">html_a</span><span class="op" id="2999447">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999452">template</span><span class="op" id="2999460">.</span><span class="ident" id="2999461">HTMLEscape</span><span class="op" id="2999471">(</span><span class="ident" id="2999472">w</span><span class="op" id="2999473">,</span>&nbsp;<span class="op" id="2999475">[</span><span class="op" id="2999476">]</span><span class="builtintype" id="2999477">byte</span><span class="op" id="2999481">(</span><span class="ident" id="2999482">url</span><span class="op" id="2999485">)</span><span class="op" id="2999486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999491">w</span><span class="op" id="2999492">.</span><span class="ident" id="2999493">Write</span><span class="op" id="2999498">(</span><span class="ident" id="2999499">html_aq</span><span class="op" id="2999506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999514">if</span>&nbsp;<span class="ident" id="2999517">italics</span>&nbsp;<span class="op" id="2999525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999530">w</span><span class="op" id="2999531">.</span><span class="ident" id="2999532">Write</span><span class="op" id="2999537">(</span><span class="ident" id="2999538">html_i</span><span class="op" id="2999544">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999552">commentEscape</span><span class="op" id="2999565">(</span><span class="ident" id="2999566">w</span><span class="op" id="2999567">,</span>&nbsp;<span class="ident" id="2999569">match</span><span class="op" id="2999574">,</span>&nbsp;<span class="ident" id="2999576">nice</span><span class="op" id="2999580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999584">if</span>&nbsp;<span class="ident" id="2999587">italics</span>&nbsp;<span class="op" id="2999595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999600">w</span><span class="op" id="2999601">.</span><span class="ident" id="2999602">Write</span><span class="op" id="2999607">(</span><span class="ident" id="2999608">html_endi</span><span class="op" id="2999617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999621">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999625">if</span>&nbsp;<span class="builtinfunc" id="2999628">len</span><span class="op" id="2999631">(</span><span class="ident" id="2999632">url</span><span class="op" id="2999635">)</span>&nbsp;<span class="op" id="2999637">&gt;</span>&nbsp;<span class="num" id="2999639">0</span>&nbsp;<span class="op" id="2999641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999646">w</span><span class="op" id="2999647">.</span><span class="ident" id="2999648">Write</span><span class="op" id="2999653">(</span><span class="ident" id="2999654">html_enda</span><span class="op" id="2999663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2999672">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999685">line</span>&nbsp;<span class="op" id="2999690">=</span>&nbsp;<span class="ident" id="2999692">line</span><span class="op" id="2999696">[</span><span class="ident" id="2999697">m</span><span class="op" id="2999698">[</span><span class="num" id="2999699">1</span><span class="op" id="2999700">]</span><span class="op" id="2999701">:</span><span class="op" id="2999702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999708">commentEscape</span><span class="op" id="2999721">(</span><span class="ident" id="2999722">w</span><span class="op" id="2999723">,</span>&nbsp;<span class="ident" id="2999725">line</span><span class="op" id="2999729">,</span>&nbsp;<span class="ident" id="2999731">nice</span><span class="op" id="2999735">)</span><br>
<span class="lineno"></span><span class="op" id="2999737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="2999740">func</span>&nbsp;<span class="ident" id="2999745">indentLen</span><span class="op" id="2999754">(</span><span class="ident" id="2999755">s</span>&nbsp;<span class="builtintype" id="2999757">string</span><span class="op" id="2999763">)</span>&nbsp;<span class="builtintype" id="2999765">int</span>&nbsp;<span class="op" id="2999769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999772">i</span>&nbsp;<span class="op" id="2999774">:=</span>&nbsp;<span class="num" id="2999777">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999780">for</span>&nbsp;<span class="ident" id="2999784">i</span>&nbsp;<span class="op" id="2999786">&lt;</span>&nbsp;<span class="builtinfunc" id="2999788">len</span><span class="op" id="2999791">(</span><span class="ident" id="2999792">s</span><span class="op" id="2999793">)</span>&nbsp;<span class="op" id="2999795">&amp;&amp;</span>&nbsp;<span class="op" id="2999798">(</span><span class="ident" id="2999799">s</span><span class="op" id="2999800">[</span><span class="ident" id="2999801">i</span><span class="op" id="2999802">]</span>&nbsp;<span class="op" id="2999804">==</span>&nbsp;<span class="string" id="2999807">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2999811">||</span>&nbsp;<span class="ident" id="2999814">s</span><span class="op" id="2999815">[</span><span class="ident" id="2999816">i</span><span class="op" id="2999817">]</span>&nbsp;<span class="op" id="2999819">==</span>&nbsp;<span class="string" id="2999822">&#39;\t&#39;</span><span class="op" id="2999826">)</span>&nbsp;<span class="op" id="2999828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999832">i</span><span class="op" id="2999833">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999837">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999840">return</span>&nbsp;<span class="ident" id="2999847">i</span><br>
<span class="lineno"></span><span class="op" id="2999849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999852">func</span>&nbsp;<span class="ident" id="2999857">isBlank</span><span class="op" id="2999864">(</span><span class="ident" id="2999865">s</span>&nbsp;<span class="builtintype" id="2999867">string</span><span class="op" id="2999873">)</span>&nbsp;<span class="builtintype" id="2999875">bool</span>&nbsp;<span class="op" id="2999880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999883">return</span>&nbsp;<span class="builtinfunc" id="2999890">len</span><span class="op" id="2999893">(</span><span class="ident" id="2999894">s</span><span class="op" id="2999895">)</span>&nbsp;<span class="op" id="2999897">==</span>&nbsp;<span class="num" id="2999900">0</span>&nbsp;<span class="op" id="2999902">||</span>&nbsp;<span class="op" id="2999905">(</span><span class="builtinfunc" id="2999906">len</span><span class="op" id="2999909">(</span><span class="ident" id="2999910">s</span><span class="op" id="2999911">)</span>&nbsp;<span class="op" id="2999913">==</span>&nbsp;<span class="num" id="2999916">1</span>&nbsp;<span class="op" id="2999918">&amp;&amp;</span>&nbsp;<span class="ident" id="2999921">s</span><span class="op" id="2999922">[</span><span class="num" id="2999923">0</span><span class="op" id="2999924">]</span>&nbsp;<span class="op" id="2999926">==</span>&nbsp;<span class="string" id="2999929">&#39;\n&#39;</span><span class="op" id="2999933">)</span><br>
<span class="lineno">175</span><span class="op" id="2999935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999938">func</span>&nbsp;<span class="ident" id="2999943">commonPrefix</span><span class="op" id="2999955">(</span><span class="ident" id="2999956">a</span><span class="op" id="2999957">,</span>&nbsp;<span class="ident" id="2999959">b</span>&nbsp;<span class="builtintype" id="2999961">string</span><span class="op" id="2999967">)</span>&nbsp;<span class="builtintype" id="2999969">string</span>&nbsp;<span class="op" id="2999976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999979">i</span>&nbsp;<span class="op" id="2999981">:=</span>&nbsp;<span class="num" id="2999984">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999987">for</span>&nbsp;<span class="ident" id="2999991">i</span>&nbsp;<span class="op" id="2999993">&lt;</span>&nbsp;<span class="builtinfunc" id="2999995">len</span><span class="op" id="2999998">(</span><span class="ident" id="2999999">a</span><span class="op" id="3000000">)</span>&nbsp;<span class="op" id="3000002">&amp;&amp;</span>&nbsp;<span class="ident" id="3000005">i</span>&nbsp;<span class="op" id="3000007">&lt;</span>&nbsp;<span class="builtinfunc" id="3000009">len</span><span class="op" id="3000012">(</span><span class="ident" id="3000013">b</span><span class="op" id="3000014">)</span>&nbsp;<span class="op" id="3000016">&amp;&amp;</span>&nbsp;<span class="ident" id="3000019">a</span><span class="op" id="3000020">[</span><span class="ident" id="3000021">i</span><span class="op" id="3000022">]</span>&nbsp;<span class="op" id="3000024">==</span>&nbsp;<span class="ident" id="3000027">b</span><span class="op" id="3000028">[</span><span class="ident" id="3000029">i</span><span class="op" id="3000030">]</span>&nbsp;<span class="op" id="3000032">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000036">i</span><span class="op" id="3000037">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000044">return</span>&nbsp;<span class="ident" id="3000051">a</span><span class="op" id="3000052">[</span><span class="num" id="3000053">0</span><span class="op" id="3000054">:</span><span class="ident" id="3000055">i</span><span class="op" id="3000056">]</span><br>
<span class="lineno"></span><span class="op" id="3000058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="3000061">func</span>&nbsp;<span class="ident" id="3000066">unindent</span><span class="op" id="3000074">(</span><span class="ident" id="3000075">block</span>&nbsp;<span class="op" id="3000081">[</span><span class="op" id="3000082">]</span><span class="builtintype" id="3000083">string</span><span class="op" id="3000089">)</span>&nbsp;<span class="op" id="3000091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000094">if</span>&nbsp;<span class="builtinfunc" id="3000097">len</span><span class="op" id="3000100">(</span><span class="ident" id="3000101">block</span><span class="op" id="3000106">)</span>&nbsp;<span class="op" id="3000108">==</span>&nbsp;<span class="num" id="3000111">0</span>&nbsp;<span class="op" id="3000113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000129">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000169">prefix</span>&nbsp;<span class="op" id="3000176">:=</span>&nbsp;<span class="ident" id="3000179">block</span><span class="op" id="3000184">[</span><span class="num" id="3000185">0</span><span class="op" id="3000186">]</span><span class="op" id="3000187">[</span><span class="num" id="3000188">0</span><span class="op" id="3000189">:</span><span class="ident" id="3000190">indentLen</span><span class="op" id="3000199">(</span><span class="ident" id="3000200">block</span><span class="op" id="3000205">[</span><span class="num" id="3000206">0</span><span class="op" id="3000207">]</span><span class="op" id="3000208">)</span><span class="op" id="3000209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000212">for</span>&nbsp;<span class="ident" id="3000216">_</span><span class="op" id="3000217">,</span>&nbsp;<span class="ident" id="3000219">line</span>&nbsp;<span class="op" id="3000224">:=</span>&nbsp;<span class="keyword" id="3000227">range</span>&nbsp;<span class="ident" id="3000233">block</span>&nbsp;<span class="op" id="3000239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000243">if</span>&nbsp;<span class="op" id="3000246">!</span><span class="ident" id="3000247">isBlank</span><span class="op" id="3000254">(</span><span class="ident" id="3000255">line</span><span class="op" id="3000259">)</span>&nbsp;<span class="op" id="3000261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000266">prefix</span>&nbsp;<span class="op" id="3000273">=</span>&nbsp;<span class="ident" id="3000275">commonPrefix</span><span class="op" id="3000287">(</span><span class="ident" id="3000288">prefix</span><span class="op" id="3000294">,</span>&nbsp;<span class="ident" id="3000296">line</span><span class="op" id="3000300">[</span><span class="num" id="3000301">0</span><span class="op" id="3000302">:</span><span class="ident" id="3000303">indentLen</span><span class="op" id="3000312">(</span><span class="ident" id="3000313">line</span><span class="op" id="3000317">)</span><span class="op" id="3000318">]</span><span class="op" id="3000319">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000329">n</span>&nbsp;<span class="op" id="3000331">:=</span>&nbsp;<span class="builtinfunc" id="3000334">len</span><span class="op" id="3000337">(</span><span class="ident" id="3000338">prefix</span><span class="op" id="3000344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000348">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000359">for</span>&nbsp;<span class="ident" id="3000363">i</span><span class="op" id="3000364">,</span>&nbsp;<span class="ident" id="3000366">line</span>&nbsp;<span class="op" id="3000371">:=</span>&nbsp;<span class="keyword" id="3000374">range</span>&nbsp;<span class="ident" id="3000380">block</span>&nbsp;<span class="op" id="3000386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000390">if</span>&nbsp;<span class="op" id="3000393">!</span><span class="ident" id="3000394">isBlank</span><span class="op" id="3000401">(</span><span class="ident" id="3000402">line</span><span class="op" id="3000406">)</span>&nbsp;<span class="op" id="3000408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000413">block</span><span class="op" id="3000418">[</span><span class="ident" id="3000419">i</span><span class="op" id="3000420">]</span>&nbsp;<span class="op" id="3000422">=</span>&nbsp;<span class="ident" id="3000424">line</span><span class="op" id="3000428">[</span><span class="ident" id="3000429">n</span><span class="op" id="3000430">:</span><span class="op" id="3000431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000438">}</span><br>
<span class="lineno">205</span><span class="op" id="3000440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3000443">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="3000514">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3000556">func</span>&nbsp;<span class="ident" id="3000561">heading</span><span class="op" id="3000568">(</span><span class="ident" id="3000569">line</span>&nbsp;<span class="builtintype" id="3000574">string</span><span class="op" id="3000580">)</span>&nbsp;<span class="builtintype" id="3000582">string</span>&nbsp;<span class="op" id="3000589">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000592">line</span>&nbsp;<span class="op" id="3000597">=</span>&nbsp;<span class="ident" id="3000599">strings</span><span class="op" id="3000606">.</span><span class="ident" id="3000607">TrimSpace</span><span class="op" id="3000616">(</span><span class="ident" id="3000617">line</span><span class="op" id="3000621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000624">if</span>&nbsp;<span class="builtinfunc" id="3000627">len</span><span class="op" id="3000630">(</span><span class="ident" id="3000631">line</span><span class="op" id="3000635">)</span>&nbsp;<span class="op" id="3000637">==</span>&nbsp;<span class="num" id="3000640">0</span>&nbsp;<span class="op" id="3000642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000646">return</span>&nbsp;<span class="string" id="3000653">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000661">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000711">r</span><span class="op" id="3000712">,</span>&nbsp;<span class="ident" id="3000714">_</span>&nbsp;<span class="op" id="3000716">:=</span>&nbsp;<span class="ident" id="3000719">utf8</span><span class="op" id="3000723">.</span><span class="ident" id="3000724">DecodeRuneInString</span><span class="op" id="3000742">(</span><span class="ident" id="3000743">line</span><span class="op" id="3000747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000750">if</span>&nbsp;<span class="op" id="3000753">!</span><span class="ident" id="3000754">unicode</span><span class="op" id="3000761">.</span><span class="ident" id="3000762">IsLetter</span><span class="op" id="3000770">(</span><span class="ident" id="3000771">r</span><span class="op" id="3000772">)</span>&nbsp;<span class="op" id="3000774">||</span>&nbsp;<span class="op" id="3000777">!</span><span class="ident" id="3000778">unicode</span><span class="op" id="3000785">.</span><span class="ident" id="3000786">IsUpper</span><span class="op" id="3000793">(</span><span class="ident" id="3000794">r</span><span class="op" id="3000795">)</span>&nbsp;<span class="op" id="3000797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000801">return</span>&nbsp;<span class="string" id="3000808">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000812">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000816">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000854">r</span><span class="op" id="3000855">,</span>&nbsp;<span class="ident" id="3000857">_</span>&nbsp;<span class="op" id="3000859">=</span>&nbsp;<span class="ident" id="3000861">utf8</span><span class="op" id="3000865">.</span><span class="ident" id="3000866">DecodeLastRuneInString</span><span class="op" id="3000888">(</span><span class="ident" id="3000889">line</span><span class="op" id="3000893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000896">if</span>&nbsp;<span class="op" id="3000899">!</span><span class="ident" id="3000900">unicode</span><span class="op" id="3000907">.</span><span class="ident" id="3000908">IsLetter</span><span class="op" id="3000916">(</span><span class="ident" id="3000917">r</span><span class="op" id="3000918">)</span>&nbsp;<span class="op" id="3000920">&amp;&amp;</span>&nbsp;<span class="op" id="3000923">!</span><span class="ident" id="3000924">unicode</span><span class="op" id="3000931">.</span><span class="ident" id="3000932">IsDigit</span><span class="op" id="3000939">(</span><span class="ident" id="3000940">r</span><span class="op" id="3000941">)</span>&nbsp;<span class="op" id="3000943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000947">return</span>&nbsp;<span class="string" id="3000954">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000962">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001004">if</span>&nbsp;<span class="ident" id="3001007">strings</span><span class="op" id="3001014">.</span><span class="ident" id="3001015">IndexAny</span><span class="op" id="3001023">(</span><span class="ident" id="3001024">line</span><span class="op" id="3001028">,</span>&nbsp;<span class="string" id="3001030">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="3001065">)</span>&nbsp;<span class="op" id="3001067">&gt;=</span>&nbsp;<span class="num" id="3001070">0</span>&nbsp;<span class="op" id="3001072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001076">return</span>&nbsp;<span class="string" id="3001083">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001091">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001130">for</span>&nbsp;<span class="ident" id="3001134">b</span>&nbsp;<span class="op" id="3001136">:=</span>&nbsp;<span class="ident" id="3001139">line</span><span class="op" id="3001143">;</span>&nbsp;<span class="op" id="3001145">;</span>&nbsp;<span class="op" id="3001147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001151">i</span>&nbsp;<span class="op" id="3001153">:=</span>&nbsp;<span class="ident" id="3001156">strings</span><span class="op" id="3001163">.</span><span class="ident" id="3001164">IndexRune</span><span class="op" id="3001173">(</span><span class="ident" id="3001174">b</span><span class="op" id="3001175">,</span>&nbsp;<span class="string" id="3001177">&#39;\&#39;&#39;</span><span class="op" id="3001181">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001185">if</span>&nbsp;<span class="ident" id="3001188">i</span>&nbsp;<span class="op" id="3001190">&lt;</span>&nbsp;<span class="num" id="3001192">0</span>&nbsp;<span class="op" id="3001194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001199">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001211">if</span>&nbsp;<span class="ident" id="3001214">i</span><span class="op" id="3001215">+</span><span class="num" id="3001216">1</span>&nbsp;<span class="op" id="3001218">&gt;=</span>&nbsp;<span class="builtinfunc" id="3001221">len</span><span class="op" id="3001224">(</span><span class="ident" id="3001225">b</span><span class="op" id="3001226">)</span>&nbsp;<span class="op" id="3001228">||</span>&nbsp;<span class="ident" id="3001231">b</span><span class="op" id="3001232">[</span><span class="ident" id="3001233">i</span><span class="op" id="3001234">+</span><span class="num" id="3001235">1</span><span class="op" id="3001236">]</span>&nbsp;<span class="op" id="3001238">!=</span>&nbsp;<span class="string" id="3001241">&#39;s&#39;</span>&nbsp;<span class="op" id="3001245">||</span>&nbsp;<span class="op" id="3001248">(</span><span class="ident" id="3001249">i</span><span class="op" id="3001250">+</span><span class="num" id="3001251">2</span>&nbsp;<span class="op" id="3001253">&lt;</span>&nbsp;<span class="builtinfunc" id="3001255">len</span><span class="op" id="3001258">(</span><span class="ident" id="3001259">b</span><span class="op" id="3001260">)</span>&nbsp;<span class="op" id="3001262">&amp;&amp;</span>&nbsp;<span class="ident" id="3001265">b</span><span class="op" id="3001266">[</span><span class="ident" id="3001267">i</span><span class="op" id="3001268">+</span><span class="num" id="3001269">2</span><span class="op" id="3001270">]</span>&nbsp;<span class="op" id="3001272">!=</span>&nbsp;<span class="string" id="3001275">&#39;&nbsp;&#39;</span><span class="op" id="3001278">)</span>&nbsp;<span class="op" id="3001280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001285">return</span>&nbsp;<span class="string" id="3001292">&#34;&#34;</span>&nbsp;<span class="comment" id="3001295">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001325">b</span>&nbsp;<span class="op" id="3001327">=</span>&nbsp;<span class="ident" id="3001329">b</span><span class="op" id="3001330">[</span><span class="ident" id="3001331">i</span><span class="op" id="3001332">+</span><span class="num" id="3001333">2</span><span class="op" id="3001334">:</span><span class="op" id="3001335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001342">return</span>&nbsp;<span class="ident" id="3001349">line</span><br>
<span class="lineno">245</span><span class="op" id="3001354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3001357">type</span>&nbsp;<span class="ident" id="3001362">op</span>&nbsp;<span class="builtintype" id="3001365">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3001370">const</span>&nbsp;<span class="op" id="3001376">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001379">opPara</span>&nbsp;<span class="ident" id="3001386">op</span>&nbsp;<span class="op" id="3001389">=</span>&nbsp;<span class="ident" id="3001391">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001397">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001405">opPre</span><br>
<span class="lineno"></span><span class="op" id="3001411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3001414">type</span>&nbsp;<span class="ident" id="3001419">block</span>&nbsp;<span class="keyword" id="3001425">struct</span>&nbsp;<span class="op" id="3001432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001435">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001441">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001445">lines</span>&nbsp;<span class="op" id="3001451">[</span><span class="op" id="3001452">]</span><span class="builtintype" id="3001453">string</span><br>
<span class="lineno"></span><span class="op" id="3001460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="3001463">var</span>&nbsp;<span class="ident" id="3001467">nonAlphaNumRx</span>&nbsp;<span class="op" id="3001481">=</span>&nbsp;<span class="ident" id="3001483">regexp</span><span class="op" id="3001489">.</span><span class="ident" id="3001490">MustCompile</span><span class="op" id="3001501">(</span><span class="string" id="3001502">`[^a-zA-Z0-9]`</span><span class="op" id="3001516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3001519">func</span>&nbsp;<span class="ident" id="3001524">anchorID</span><span class="op" id="3001532">(</span><span class="ident" id="3001533">line</span>&nbsp;<span class="builtintype" id="3001538">string</span><span class="op" id="3001544">)</span>&nbsp;<span class="builtintype" id="3001546">string</span>&nbsp;<span class="op" id="3001553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001556">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001636">return</span>&nbsp;<span class="string" id="3001643">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="3001650">+</span>&nbsp;<span class="ident" id="3001652">nonAlphaNumRx</span><span class="op" id="3001665">.</span><span class="ident" id="3001666">ReplaceAllString</span><span class="op" id="3001682">(</span><span class="ident" id="3001683">line</span><span class="op" id="3001687">,</span>&nbsp;<span class="string" id="3001689">&#34;_&#34;</span><span class="op" id="3001692">)</span><br>
<span class="lineno">265</span><span class="op" id="3001694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3001697">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="3001748">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="3001790">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="3001850">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="3001902">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3001952">//</span><br>
<span class="lineno"></span><span class="comment" id="3001955">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3002016">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="3002087">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="3002156">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="3002217">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="3002247">//</span><br>
<span class="lineno"></span><span class="comment" id="3002250">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="3002311">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3002353">//</span><br>
<span class="lineno"></span><span class="comment" id="3002356">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="3002434">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3002512">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="3002581">//</span><br>
<span class="lineno"></span><span class="comment" id="3002584">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3002668">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3002755">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="3002771">func</span>&nbsp;<span class="ident" id="3002776">ToHTML</span><span class="op" id="3002782">(</span><span class="ident" id="3002783">w</span>&nbsp;<span class="ident" id="3002785">io</span><span class="op" id="3002787">.</span><span class="ident" id="3002788">Writer</span><span class="op" id="3002794">,</span>&nbsp;<span class="ident" id="3002796">text</span>&nbsp;<span class="builtintype" id="3002801">string</span><span class="op" id="3002807">,</span>&nbsp;<span class="ident" id="3002809">words</span>&nbsp;<span class="keyword" id="3002815">map</span><span class="op" id="3002818">[</span><span class="builtintype" id="3002819">string</span><span class="op" id="3002825">]</span><span class="builtintype" id="3002826">string</span><span class="op" id="3002832">)</span>&nbsp;<span class="op" id="3002834">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002837">for</span>&nbsp;<span class="ident" id="3002841">_</span><span class="op" id="3002842">,</span>&nbsp;<span class="ident" id="3002844">b</span>&nbsp;<span class="op" id="3002846">:=</span>&nbsp;<span class="keyword" id="3002849">range</span>&nbsp;<span class="ident" id="3002855">blocks</span><span class="op" id="3002861">(</span><span class="ident" id="3002862">text</span><span class="op" id="3002866">)</span>&nbsp;<span class="op" id="3002868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002872">switch</span>&nbsp;<span class="ident" id="3002879">b</span><span class="op" id="3002880">.</span><span class="ident" id="3002881">op</span>&nbsp;<span class="op" id="3002884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002888">case</span>&nbsp;<span class="ident" id="3002893">opPara</span><span class="op" id="3002899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002904">w</span><span class="op" id="3002905">.</span><span class="ident" id="3002906">Write</span><span class="op" id="3002911">(</span><span class="ident" id="3002912">html_p</span><span class="op" id="3002918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002923">for</span>&nbsp;<span class="ident" id="3002927">_</span><span class="op" id="3002928">,</span>&nbsp;<span class="ident" id="3002930">line</span>&nbsp;<span class="op" id="3002935">:=</span>&nbsp;<span class="keyword" id="3002938">range</span>&nbsp;<span class="ident" id="3002944">b</span><span class="op" id="3002945">.</span><span class="ident" id="3002946">lines</span>&nbsp;<span class="op" id="3002952">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002958">emphasize</span><span class="op" id="3002967">(</span><span class="ident" id="3002968">w</span><span class="op" id="3002969">,</span>&nbsp;<span class="ident" id="3002971">line</span><span class="op" id="3002975">,</span>&nbsp;<span class="ident" id="3002977">words</span><span class="op" id="3002982">,</span>&nbsp;<span class="builtintype" id="3002984">true</span><span class="op" id="3002988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002998">w</span><span class="op" id="3002999">.</span><span class="ident" id="3003000">Write</span><span class="op" id="3003005">(</span><span class="ident" id="3003006">html_endp</span><span class="op" id="3003015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003019">case</span>&nbsp;<span class="ident" id="3003024">opHead</span><span class="op" id="3003030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003035">w</span><span class="op" id="3003036">.</span><span class="ident" id="3003037">Write</span><span class="op" id="3003042">(</span><span class="ident" id="3003043">html_h</span><span class="op" id="3003049">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003054">id</span>&nbsp;<span class="op" id="3003057">:=</span>&nbsp;<span class="string" id="3003060">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003066">for</span>&nbsp;<span class="ident" id="3003070">_</span><span class="op" id="3003071">,</span>&nbsp;<span class="ident" id="3003073">line</span>&nbsp;<span class="op" id="3003078">:=</span>&nbsp;<span class="keyword" id="3003081">range</span>&nbsp;<span class="ident" id="3003087">b</span><span class="op" id="3003088">.</span><span class="ident" id="3003089">lines</span>&nbsp;<span class="op" id="3003095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003101">if</span>&nbsp;<span class="ident" id="3003104">id</span>&nbsp;<span class="op" id="3003107">==</span>&nbsp;<span class="string" id="3003110">&#34;&#34;</span>&nbsp;<span class="op" id="3003113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003120">id</span>&nbsp;<span class="op" id="3003123">=</span>&nbsp;<span class="ident" id="3003125">anchorID</span><span class="op" id="3003133">(</span><span class="ident" id="3003134">line</span><span class="op" id="3003138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003145">w</span><span class="op" id="3003146">.</span><span class="ident" id="3003147">Write</span><span class="op" id="3003152">(</span><span class="op" id="3003153">[</span><span class="op" id="3003154">]</span><span class="builtintype" id="3003155">byte</span><span class="op" id="3003159">(</span><span class="ident" id="3003160">id</span><span class="op" id="3003162">)</span><span class="op" id="3003163">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003170">w</span><span class="op" id="3003171">.</span><span class="ident" id="3003172">Write</span><span class="op" id="3003177">(</span><span class="ident" id="3003178">html_hq</span><span class="op" id="3003185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003197">commentEscape</span><span class="op" id="3003210">(</span><span class="ident" id="3003211">w</span><span class="op" id="3003212">,</span>&nbsp;<span class="ident" id="3003214">line</span><span class="op" id="3003218">,</span>&nbsp;<span class="builtintype" id="3003220">true</span><span class="op" id="3003224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003234">if</span>&nbsp;<span class="ident" id="3003237">id</span>&nbsp;<span class="op" id="3003240">==</span>&nbsp;<span class="string" id="3003243">&#34;&#34;</span>&nbsp;<span class="op" id="3003246">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003252">w</span><span class="op" id="3003253">.</span><span class="ident" id="3003254">Write</span><span class="op" id="3003259">(</span><span class="ident" id="3003260">html_hq</span><span class="op" id="3003267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003277">w</span><span class="op" id="3003278">.</span><span class="ident" id="3003279">Write</span><span class="op" id="3003284">(</span><span class="ident" id="3003285">html_endh</span><span class="op" id="3003294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003298">case</span>&nbsp;<span class="ident" id="3003303">opPre</span><span class="op" id="3003308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003313">w</span><span class="op" id="3003314">.</span><span class="ident" id="3003315">Write</span><span class="op" id="3003320">(</span><span class="ident" id="3003321">html_pre</span><span class="op" id="3003329">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003334">for</span>&nbsp;<span class="ident" id="3003338">_</span><span class="op" id="3003339">,</span>&nbsp;<span class="ident" id="3003341">line</span>&nbsp;<span class="op" id="3003346">:=</span>&nbsp;<span class="keyword" id="3003349">range</span>&nbsp;<span class="ident" id="3003355">b</span><span class="op" id="3003356">.</span><span class="ident" id="3003357">lines</span>&nbsp;<span class="op" id="3003363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003369">emphasize</span><span class="op" id="3003378">(</span><span class="ident" id="3003379">w</span><span class="op" id="3003380">,</span>&nbsp;<span class="ident" id="3003382">line</span><span class="op" id="3003386">,</span>&nbsp;<span class="ident" id="3003388">nil</span><span class="op" id="3003391">,</span>&nbsp;<span class="builtintype" id="3003393">false</span><span class="op" id="3003398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003408">w</span><span class="op" id="3003409">.</span><span class="ident" id="3003410">Write</span><span class="op" id="3003415">(</span><span class="ident" id="3003416">html_endpre</span><span class="op" id="3003427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003431">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003434">}</span><br>
<span class="lineno"></span><span class="op" id="3003436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3003439">func</span>&nbsp;<span class="ident" id="3003444">blocks</span><span class="op" id="3003450">(</span><span class="ident" id="3003451">text</span>&nbsp;<span class="builtintype" id="3003456">string</span><span class="op" id="3003462">)</span>&nbsp;<span class="op" id="3003464">[</span><span class="op" id="3003465">]</span><span class="ident" id="3003466">block</span>&nbsp;<span class="op" id="3003472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003475">var</span>&nbsp;<span class="op" id="3003479">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003483">out</span>&nbsp;&nbsp;<span class="op" id="3003488">[</span><span class="op" id="3003489">]</span><span class="ident" id="3003490">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003498">para</span>&nbsp;<span class="op" id="3003503">[</span><span class="op" id="3003504">]</span><span class="builtintype" id="3003505">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003515">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3003530">=</span>&nbsp;<span class="builtintype" id="3003532">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003540">lastWasHeading</span>&nbsp;<span class="op" id="3003555">=</span>&nbsp;<span class="builtintype" id="3003557">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3003568">close</span>&nbsp;<span class="op" id="3003574">:=</span>&nbsp;<span class="keyword" id="3003577">func</span><span class="op" id="3003581">(</span><span class="op" id="3003582">)</span>&nbsp;<span class="op" id="3003584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003588">if</span>&nbsp;<span class="ident" id="3003591">para</span>&nbsp;<span class="op" id="3003596">!=</span>&nbsp;<span class="ident" id="3003599">nil</span>&nbsp;<span class="op" id="3003603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003608">out</span>&nbsp;<span class="op" id="3003612">=</span>&nbsp;<span class="builtinfunc" id="3003614">append</span><span class="op" id="3003620">(</span><span class="ident" id="3003621">out</span><span class="op" id="3003624">,</span>&nbsp;<span class="ident" id="3003626">block</span><span class="op" id="3003631">{</span><span class="ident" id="3003632">opPara</span><span class="op" id="3003638">,</span>&nbsp;<span class="ident" id="3003640">para</span><span class="op" id="3003644">}</span><span class="op" id="3003645">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003650">para</span>&nbsp;<span class="op" id="3003655">=</span>&nbsp;<span class="ident" id="3003657">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003670">lines</span>&nbsp;<span class="op" id="3003676">:=</span>&nbsp;<span class="ident" id="3003679">strings</span><span class="op" id="3003686">.</span><span class="ident" id="3003687">SplitAfter</span><span class="op" id="3003697">(</span><span class="ident" id="3003698">text</span><span class="op" id="3003702">,</span>&nbsp;<span class="string" id="3003704">&#34;\n&#34;</span><span class="op" id="3003708">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003711">unindent</span><span class="op" id="3003719">(</span><span class="ident" id="3003720">lines</span><span class="op" id="3003725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003728">for</span>&nbsp;<span class="ident" id="3003732">i</span>&nbsp;<span class="op" id="3003734">:=</span>&nbsp;<span class="num" id="3003737">0</span><span class="op" id="3003738">;</span>&nbsp;<span class="ident" id="3003740">i</span>&nbsp;<span class="op" id="3003742">&lt;</span>&nbsp;<span class="builtinfunc" id="3003744">len</span><span class="op" id="3003747">(</span><span class="ident" id="3003748">lines</span><span class="op" id="3003753">)</span><span class="op" id="3003754">;</span>&nbsp;<span class="op" id="3003756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003760">line</span>&nbsp;<span class="op" id="3003765">:=</span>&nbsp;<span class="ident" id="3003768">lines</span><span class="op" id="3003773">[</span><span class="ident" id="3003774">i</span><span class="op" id="3003775">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003779">if</span>&nbsp;<span class="ident" id="3003782">isBlank</span><span class="op" id="3003789">(</span><span class="ident" id="3003790">line</span><span class="op" id="3003794">)</span>&nbsp;<span class="op" id="3003796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003801">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3003823">close</span><span class="op" id="3003828">(</span><span class="op" id="3003829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003834">i</span><span class="op" id="3003835">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003841">lastWasBlank</span>&nbsp;<span class="op" id="3003854">=</span>&nbsp;<span class="builtintype" id="3003856">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003864">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003875">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003879">if</span>&nbsp;<span class="ident" id="3003882">indentLen</span><span class="op" id="3003891">(</span><span class="ident" id="3003892">line</span><span class="op" id="3003896">)</span>&nbsp;<span class="op" id="3003898">&gt;</span>&nbsp;<span class="num" id="3003900">0</span>&nbsp;<span class="op" id="3003902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003907">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3003929">close</span><span class="op" id="3003934">(</span><span class="op" id="3003935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003941">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003977">j</span>&nbsp;<span class="op" id="3003979">:=</span>&nbsp;<span class="ident" id="3003982">i</span>&nbsp;<span class="op" id="3003984">+</span>&nbsp;<span class="num" id="3003986">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003991">for</span>&nbsp;<span class="ident" id="3003995">j</span>&nbsp;<span class="op" id="3003997">&lt;</span>&nbsp;<span class="builtinfunc" id="3003999">len</span><span class="op" id="3004002">(</span><span class="ident" id="3004003">lines</span><span class="op" id="3004008">)</span>&nbsp;<span class="op" id="3004010">&amp;&amp;</span>&nbsp;<span class="op" id="3004013">(</span><span class="ident" id="3004014">isBlank</span><span class="op" id="3004021">(</span><span class="ident" id="3004022">lines</span><span class="op" id="3004027">[</span><span class="ident" id="3004028">j</span><span class="op" id="3004029">]</span><span class="op" id="3004030">)</span>&nbsp;<span class="op" id="3004032">||</span>&nbsp;<span class="ident" id="3004035">indentLen</span><span class="op" id="3004044">(</span><span class="ident" id="3004045">lines</span><span class="op" id="3004050">[</span><span class="ident" id="3004051">j</span><span class="op" id="3004052">]</span><span class="op" id="3004053">)</span>&nbsp;<span class="op" id="3004055">&gt;</span>&nbsp;<span class="num" id="3004057">0</span><span class="op" id="3004058">)</span>&nbsp;<span class="op" id="3004060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004066">j</span><span class="op" id="3004067">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004078">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004113">for</span>&nbsp;<span class="ident" id="3004117">j</span>&nbsp;<span class="op" id="3004119">&gt;</span>&nbsp;<span class="ident" id="3004121">i</span>&nbsp;<span class="op" id="3004123">&amp;&amp;</span>&nbsp;<span class="ident" id="3004126">isBlank</span><span class="op" id="3004133">(</span><span class="ident" id="3004134">lines</span><span class="op" id="3004139">[</span><span class="ident" id="3004140">j</span><span class="op" id="3004141">-</span><span class="num" id="3004142">1</span><span class="op" id="3004143">]</span><span class="op" id="3004144">)</span>&nbsp;<span class="op" id="3004146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004152">j</span><span class="op" id="3004153">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004164">pre</span>&nbsp;<span class="op" id="3004168">:=</span>&nbsp;<span class="ident" id="3004171">lines</span><span class="op" id="3004176">[</span><span class="ident" id="3004177">i</span><span class="op" id="3004178">:</span><span class="ident" id="3004179">j</span><span class="op" id="3004180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004185">i</span>&nbsp;<span class="op" id="3004187">=</span>&nbsp;<span class="ident" id="3004189">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004195">unindent</span><span class="op" id="3004203">(</span><span class="ident" id="3004204">pre</span><span class="op" id="3004207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004213">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004250">out</span>&nbsp;<span class="op" id="3004254">=</span>&nbsp;<span class="builtinfunc" id="3004256">append</span><span class="op" id="3004262">(</span><span class="ident" id="3004263">out</span><span class="op" id="3004266">,</span>&nbsp;<span class="ident" id="3004268">block</span><span class="op" id="3004273">{</span><span class="ident" id="3004274">opPre</span><span class="op" id="3004279">,</span>&nbsp;<span class="ident" id="3004281">pre</span><span class="op" id="3004284">}</span><span class="op" id="3004285">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004290">lastWasHeading</span>&nbsp;<span class="op" id="3004305">=</span>&nbsp;<span class="builtintype" id="3004307">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004316">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004332">if</span>&nbsp;<span class="ident" id="3004335">lastWasBlank</span>&nbsp;<span class="op" id="3004348">&amp;&amp;</span>&nbsp;<span class="op" id="3004351">!</span><span class="ident" id="3004352">lastWasHeading</span>&nbsp;<span class="op" id="3004367">&amp;&amp;</span>&nbsp;<span class="ident" id="3004370">i</span><span class="op" id="3004371">+</span><span class="num" id="3004372">2</span>&nbsp;<span class="op" id="3004374">&lt;</span>&nbsp;<span class="builtinfunc" id="3004376">len</span><span class="op" id="3004379">(</span><span class="ident" id="3004380">lines</span><span class="op" id="3004385">)</span>&nbsp;<span class="op" id="3004387">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004393">isBlank</span><span class="op" id="3004400">(</span><span class="ident" id="3004401">lines</span><span class="op" id="3004406">[</span><span class="ident" id="3004407">i</span><span class="op" id="3004408">+</span><span class="num" id="3004409">1</span><span class="op" id="3004410">]</span><span class="op" id="3004411">)</span>&nbsp;<span class="op" id="3004413">&amp;&amp;</span>&nbsp;<span class="op" id="3004416">!</span><span class="ident" id="3004417">isBlank</span><span class="op" id="3004424">(</span><span class="ident" id="3004425">lines</span><span class="op" id="3004430">[</span><span class="ident" id="3004431">i</span><span class="op" id="3004432">+</span><span class="num" id="3004433">2</span><span class="op" id="3004434">]</span><span class="op" id="3004435">)</span>&nbsp;<span class="op" id="3004437">&amp;&amp;</span>&nbsp;<span class="ident" id="3004440">indentLen</span><span class="op" id="3004449">(</span><span class="ident" id="3004450">lines</span><span class="op" id="3004455">[</span><span class="ident" id="3004456">i</span><span class="op" id="3004457">+</span><span class="num" id="3004458">2</span><span class="op" id="3004459">]</span><span class="op" id="3004460">)</span>&nbsp;<span class="op" id="3004462">==</span>&nbsp;<span class="num" id="3004465">0</span>&nbsp;<span class="op" id="3004467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004472">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004531">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004587">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004613">if</span>&nbsp;<span class="ident" id="3004616">head</span>&nbsp;<span class="op" id="3004621">:=</span>&nbsp;<span class="ident" id="3004624">heading</span><span class="op" id="3004631">(</span><span class="ident" id="3004632">line</span><span class="op" id="3004636">)</span><span class="op" id="3004637">;</span>&nbsp;<span class="ident" id="3004639">head</span>&nbsp;<span class="op" id="3004644">!=</span>&nbsp;<span class="string" id="3004647">&#34;&#34;</span>&nbsp;<span class="op" id="3004650">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3004656">close</span><span class="op" id="3004661">(</span><span class="op" id="3004662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004668">out</span>&nbsp;<span class="op" id="3004672">=</span>&nbsp;<span class="builtinfunc" id="3004674">append</span><span class="op" id="3004680">(</span><span class="ident" id="3004681">out</span><span class="op" id="3004684">,</span>&nbsp;<span class="ident" id="3004686">block</span><span class="op" id="3004691">{</span><span class="ident" id="3004692">opHead</span><span class="op" id="3004698">,</span>&nbsp;<span class="op" id="3004700">[</span><span class="op" id="3004701">]</span><span class="builtintype" id="3004702">string</span><span class="op" id="3004708">{</span><span class="ident" id="3004709">head</span><span class="op" id="3004713">}</span><span class="op" id="3004714">}</span><span class="op" id="3004715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004721">i</span>&nbsp;<span class="op" id="3004723">+=</span>&nbsp;<span class="num" id="3004726">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004732">lastWasHeading</span>&nbsp;<span class="op" id="3004747">=</span>&nbsp;<span class="builtintype" id="3004749">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004758">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004779">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004799">lastWasBlank</span>&nbsp;<span class="op" id="3004812">=</span>&nbsp;<span class="builtintype" id="3004814">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004822">lastWasHeading</span>&nbsp;<span class="op" id="3004837">=</span>&nbsp;<span class="builtintype" id="3004839">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004847">para</span>&nbsp;<span class="op" id="3004852">=</span>&nbsp;<span class="builtinfunc" id="3004854">append</span><span class="op" id="3004860">(</span><span class="ident" id="3004861">para</span><span class="op" id="3004865">,</span>&nbsp;<span class="ident" id="3004867">lines</span><span class="op" id="3004872">[</span><span class="ident" id="3004873">i</span><span class="op" id="3004874">]</span><span class="op" id="3004875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004879">i</span><span class="op" id="3004880">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3004887">close</span><span class="op" id="3004892">(</span><span class="op" id="3004893">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004897">return</span>&nbsp;<span class="ident" id="3004904">out</span><br>
<span class="lineno"></span><span class="op" id="3004908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3004911">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="3004979">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="3005048">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="3005122">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="3005197">func</span>&nbsp;<span class="ident" id="3005202">ToText</span><span class="op" id="3005208">(</span><span class="ident" id="3005209">w</span>&nbsp;<span class="ident" id="3005211">io</span><span class="op" id="3005213">.</span><span class="ident" id="3005214">Writer</span><span class="op" id="3005220">,</span>&nbsp;<span class="ident" id="3005222">text</span>&nbsp;<span class="builtintype" id="3005227">string</span><span class="op" id="3005233">,</span>&nbsp;<span class="ident" id="3005235">indent</span><span class="op" id="3005241">,</span>&nbsp;<span class="ident" id="3005243">preIndent</span>&nbsp;<span class="builtintype" id="3005253">string</span><span class="op" id="3005259">,</span>&nbsp;<span class="ident" id="3005261">width</span>&nbsp;<span class="builtintype" id="3005267">int</span><span class="op" id="3005270">)</span>&nbsp;<span class="op" id="3005272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005275">l</span>&nbsp;<span class="op" id="3005277">:=</span>&nbsp;<span class="ident" id="3005280">lineWrapper</span><span class="op" id="3005291">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005295">out</span><span class="op" id="3005298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005303">w</span><span class="op" id="3005304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005308">width</span><span class="op" id="3005313">:</span>&nbsp;&nbsp;<span class="ident" id="3005316">width</span><span class="op" id="3005321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005325">indent</span><span class="op" id="3005331">:</span>&nbsp;<span class="ident" id="3005333">indent</span><span class="op" id="3005339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005345">for</span>&nbsp;<span class="ident" id="3005349">_</span><span class="op" id="3005350">,</span>&nbsp;<span class="ident" id="3005352">b</span>&nbsp;<span class="op" id="3005354">:=</span>&nbsp;<span class="keyword" id="3005357">range</span>&nbsp;<span class="ident" id="3005363">blocks</span><span class="op" id="3005369">(</span><span class="ident" id="3005370">text</span><span class="op" id="3005374">)</span>&nbsp;<span class="op" id="3005376">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005380">switch</span>&nbsp;<span class="ident" id="3005387">b</span><span class="op" id="3005388">.</span><span class="ident" id="3005389">op</span>&nbsp;<span class="op" id="3005392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005396">case</span>&nbsp;<span class="ident" id="3005401">opPara</span><span class="op" id="3005407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005412">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005463">for</span>&nbsp;<span class="ident" id="3005467">_</span><span class="op" id="3005468">,</span>&nbsp;<span class="ident" id="3005470">line</span>&nbsp;<span class="op" id="3005475">:=</span>&nbsp;<span class="keyword" id="3005478">range</span>&nbsp;<span class="ident" id="3005484">b</span><span class="op" id="3005485">.</span><span class="ident" id="3005486">lines</span>&nbsp;<span class="op" id="3005492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005498">l</span><span class="op" id="3005499">.</span><span class="ident" id="3005500">write</span><span class="op" id="3005505">(</span><span class="ident" id="3005506">line</span><span class="op" id="3005510">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005520">l</span><span class="op" id="3005521">.</span><span class="ident" id="3005522">flush</span><span class="op" id="3005527">(</span><span class="op" id="3005528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005532">case</span>&nbsp;<span class="ident" id="3005537">opHead</span><span class="op" id="3005543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005548">w</span><span class="op" id="3005549">.</span><span class="ident" id="3005550">Write</span><span class="op" id="3005555">(</span><span class="ident" id="3005556">nl</span><span class="op" id="3005558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005563">for</span>&nbsp;<span class="ident" id="3005567">_</span><span class="op" id="3005568">,</span>&nbsp;<span class="ident" id="3005570">line</span>&nbsp;<span class="op" id="3005575">:=</span>&nbsp;<span class="keyword" id="3005578">range</span>&nbsp;<span class="ident" id="3005584">b</span><span class="op" id="3005585">.</span><span class="ident" id="3005586">lines</span>&nbsp;<span class="op" id="3005592">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005598">l</span><span class="op" id="3005599">.</span><span class="ident" id="3005600">write</span><span class="op" id="3005605">(</span><span class="ident" id="3005606">line</span>&nbsp;<span class="op" id="3005611">+</span>&nbsp;<span class="string" id="3005613">&#34;\n&#34;</span><span class="op" id="3005617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005627">l</span><span class="op" id="3005628">.</span><span class="ident" id="3005629">flush</span><span class="op" id="3005634">(</span><span class="op" id="3005635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005639">case</span>&nbsp;<span class="ident" id="3005644">opPre</span><span class="op" id="3005649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005654">w</span><span class="op" id="3005655">.</span><span class="ident" id="3005656">Write</span><span class="op" id="3005661">(</span><span class="ident" id="3005662">nl</span><span class="op" id="3005664">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005669">for</span>&nbsp;<span class="ident" id="3005673">_</span><span class="op" id="3005674">,</span>&nbsp;<span class="ident" id="3005676">line</span>&nbsp;<span class="op" id="3005681">:=</span>&nbsp;<span class="keyword" id="3005684">range</span>&nbsp;<span class="ident" id="3005690">b</span><span class="op" id="3005691">.</span><span class="ident" id="3005692">lines</span>&nbsp;<span class="op" id="3005698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005704">if</span>&nbsp;<span class="ident" id="3005707">isBlank</span><span class="op" id="3005714">(</span><span class="ident" id="3005715">line</span><span class="op" id="3005719">)</span>&nbsp;<span class="op" id="3005721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005728">w</span><span class="op" id="3005729">.</span><span class="ident" id="3005730">Write</span><span class="op" id="3005735">(</span><span class="op" id="3005736">[</span><span class="op" id="3005737">]</span><span class="builtintype" id="3005738">byte</span><span class="op" id="3005742">(</span><span class="string" id="3005743">&#34;\n&#34;</span><span class="op" id="3005747">)</span><span class="op" id="3005748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005754">}</span>&nbsp;<span class="keyword" id="3005756">else</span>&nbsp;<span class="op" id="3005761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005768">w</span><span class="op" id="3005769">.</span><span class="ident" id="3005770">Write</span><span class="op" id="3005775">(</span><span class="op" id="3005776">[</span><span class="op" id="3005777">]</span><span class="builtintype" id="3005778">byte</span><span class="op" id="3005782">(</span><span class="ident" id="3005783">preIndent</span><span class="op" id="3005792">)</span><span class="op" id="3005793">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005800">w</span><span class="op" id="3005801">.</span><span class="ident" id="3005802">Write</span><span class="op" id="3005807">(</span><span class="op" id="3005808">[</span><span class="op" id="3005809">]</span><span class="builtintype" id="3005810">byte</span><span class="op" id="3005814">(</span><span class="ident" id="3005815">line</span><span class="op" id="3005819">)</span><span class="op" id="3005820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3005838">}</span><br>
<span class="lineno">435</span><span class="op" id="3005840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005843">type</span>&nbsp;<span class="ident" id="3005848">lineWrapper</span>&nbsp;<span class="keyword" id="3005860">struct</span>&nbsp;<span class="op" id="3005867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005870">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005880">io</span><span class="op" id="3005882">.</span><span class="ident" id="3005883">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005891">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005901">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005907">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005917">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005922">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005932">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005940">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005950">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005955">pendSpace</span>&nbsp;<span class="builtintype" id="3005965">int</span><br>
<span class="lineno"></span><span class="op" id="3005969">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="3005972">var</span>&nbsp;<span class="ident" id="3005976">nl</span>&nbsp;<span class="op" id="3005979">=</span>&nbsp;<span class="op" id="3005981">[</span><span class="op" id="3005982">]</span><span class="builtintype" id="3005983">byte</span><span class="op" id="3005987">(</span><span class="string" id="3005988">&#34;\n&#34;</span><span class="op" id="3005992">)</span><br>
<span class="lineno"></span><span class="keyword" id="3005994">var</span>&nbsp;<span class="ident" id="3005998">space</span>&nbsp;<span class="op" id="3006004">=</span>&nbsp;<span class="op" id="3006006">[</span><span class="op" id="3006007">]</span><span class="builtintype" id="3006008">byte</span><span class="op" id="3006012">(</span><span class="string" id="3006013">&#34;&nbsp;&#34;</span><span class="op" id="3006016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3006019">func</span>&nbsp;<span class="op" id="3006024">(</span><span class="ident" id="3006025">l</span>&nbsp;<span class="op" id="3006027">*</span><span class="ident" id="3006028">lineWrapper</span><span class="op" id="3006039">)</span>&nbsp;<span class="ident" id="3006041">write</span><span class="op" id="3006046">(</span><span class="ident" id="3006047">text</span>&nbsp;<span class="builtintype" id="3006052">string</span><span class="op" id="3006058">)</span>&nbsp;<span class="op" id="3006060">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006063">if</span>&nbsp;<span class="ident" id="3006066">l</span><span class="op" id="3006067">.</span><span class="ident" id="3006068">n</span>&nbsp;<span class="op" id="3006070">==</span>&nbsp;<span class="num" id="3006073">0</span>&nbsp;<span class="op" id="3006075">&amp;&amp;</span>&nbsp;<span class="ident" id="3006078">l</span><span class="op" id="3006079">.</span><span class="ident" id="3006080">printed</span>&nbsp;<span class="op" id="3006088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006092">l</span><span class="op" id="3006093">.</span><span class="ident" id="3006094">out</span><span class="op" id="3006097">.</span><span class="ident" id="3006098">Write</span><span class="op" id="3006103">(</span><span class="ident" id="3006104">nl</span><span class="op" id="3006106">)</span>&nbsp;<span class="comment" id="3006108">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006147">l</span><span class="op" id="3006148">.</span><span class="ident" id="3006149">printed</span>&nbsp;<span class="op" id="3006157">=</span>&nbsp;<span class="builtintype" id="3006159">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006166">for</span>&nbsp;<span class="ident" id="3006170">_</span><span class="op" id="3006171">,</span>&nbsp;<span class="ident" id="3006173">f</span>&nbsp;<span class="op" id="3006175">:=</span>&nbsp;<span class="keyword" id="3006178">range</span>&nbsp;<span class="ident" id="3006184">strings</span><span class="op" id="3006191">.</span><span class="ident" id="3006192">Fields</span><span class="op" id="3006198">(</span><span class="ident" id="3006199">text</span><span class="op" id="3006203">)</span>&nbsp;<span class="op" id="3006205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006209">w</span>&nbsp;<span class="op" id="3006211">:=</span>&nbsp;<span class="ident" id="3006214">utf8</span><span class="op" id="3006218">.</span><span class="ident" id="3006219">RuneCountInString</span><span class="op" id="3006236">(</span><span class="ident" id="3006237">f</span><span class="op" id="3006238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006242">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006272">if</span>&nbsp;<span class="ident" id="3006275">l</span><span class="op" id="3006276">.</span><span class="ident" id="3006277">n</span>&nbsp;<span class="op" id="3006279">&gt;</span>&nbsp;<span class="num" id="3006281">0</span>&nbsp;<span class="op" id="3006283">&amp;&amp;</span>&nbsp;<span class="ident" id="3006286">l</span><span class="op" id="3006287">.</span><span class="ident" id="3006288">n</span><span class="op" id="3006289">+</span><span class="ident" id="3006290">l</span><span class="op" id="3006291">.</span><span class="ident" id="3006292">pendSpace</span><span class="op" id="3006301">+</span><span class="ident" id="3006302">w</span>&nbsp;<span class="op" id="3006304">&gt;</span>&nbsp;<span class="ident" id="3006306">l</span><span class="op" id="3006307">.</span><span class="ident" id="3006308">width</span>&nbsp;<span class="op" id="3006314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006319">l</span><span class="op" id="3006320">.</span><span class="ident" id="3006321">out</span><span class="op" id="3006324">.</span><span class="ident" id="3006325">Write</span><span class="op" id="3006330">(</span><span class="ident" id="3006331">nl</span><span class="op" id="3006333">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006338">l</span><span class="op" id="3006339">.</span><span class="ident" id="3006340">n</span>&nbsp;<span class="op" id="3006342">=</span>&nbsp;<span class="num" id="3006344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006349">l</span><span class="op" id="3006350">.</span><span class="ident" id="3006351">pendSpace</span>&nbsp;<span class="op" id="3006361">=</span>&nbsp;<span class="num" id="3006363">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006371">if</span>&nbsp;<span class="ident" id="3006374">l</span><span class="op" id="3006375">.</span><span class="ident" id="3006376">n</span>&nbsp;<span class="op" id="3006378">==</span>&nbsp;<span class="num" id="3006381">0</span>&nbsp;<span class="op" id="3006383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006388">l</span><span class="op" id="3006389">.</span><span class="ident" id="3006390">out</span><span class="op" id="3006393">.</span><span class="ident" id="3006394">Write</span><span class="op" id="3006399">(</span><span class="op" id="3006400">[</span><span class="op" id="3006401">]</span><span class="builtintype" id="3006402">byte</span><span class="op" id="3006406">(</span><span class="ident" id="3006407">l</span><span class="op" id="3006408">.</span><span class="ident" id="3006409">indent</span><span class="op" id="3006415">)</span><span class="op" id="3006416">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006424">l</span><span class="op" id="3006425">.</span><span class="ident" id="3006426">out</span><span class="op" id="3006429">.</span><span class="ident" id="3006430">Write</span><span class="op" id="3006435">(</span><span class="ident" id="3006436">space</span><span class="op" id="3006441">[</span><span class="op" id="3006442">:</span><span class="ident" id="3006443">l</span><span class="op" id="3006444">.</span><span class="ident" id="3006445">pendSpace</span><span class="op" id="3006454">]</span><span class="op" id="3006455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006459">l</span><span class="op" id="3006460">.</span><span class="ident" id="3006461">out</span><span class="op" id="3006464">.</span><span class="ident" id="3006465">Write</span><span class="op" id="3006470">(</span><span class="op" id="3006471">[</span><span class="op" id="3006472">]</span><span class="builtintype" id="3006473">byte</span><span class="op" id="3006477">(</span><span class="ident" id="3006478">f</span><span class="op" id="3006479">)</span><span class="op" id="3006480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006484">l</span><span class="op" id="3006485">.</span><span class="ident" id="3006486">n</span>&nbsp;<span class="op" id="3006488">+=</span>&nbsp;<span class="ident" id="3006491">l</span><span class="op" id="3006492">.</span><span class="ident" id="3006493">pendSpace</span>&nbsp;<span class="op" id="3006503">+</span>&nbsp;<span class="ident" id="3006505">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006509">l</span><span class="op" id="3006510">.</span><span class="ident" id="3006511">pendSpace</span>&nbsp;<span class="op" id="3006521">=</span>&nbsp;<span class="num" id="3006523">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006526">}</span><br>
<span class="lineno"></span><span class="op" id="3006528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3006531">func</span>&nbsp;<span class="op" id="3006536">(</span><span class="ident" id="3006537">l</span>&nbsp;<span class="op" id="3006539">*</span><span class="ident" id="3006540">lineWrapper</span><span class="op" id="3006551">)</span>&nbsp;<span class="ident" id="3006553">flush</span><span class="op" id="3006558">(</span><span class="op" id="3006559">)</span>&nbsp;<span class="op" id="3006561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006564">if</span>&nbsp;<span class="ident" id="3006567">l</span><span class="op" id="3006568">.</span><span class="ident" id="3006569">n</span>&nbsp;<span class="op" id="3006571">==</span>&nbsp;<span class="num" id="3006574">0</span>&nbsp;<span class="op" id="3006576">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006580">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006591">l</span><span class="op" id="3006592">.</span><span class="ident" id="3006593">out</span><span class="op" id="3006596">.</span><span class="ident" id="3006597">Write</span><span class="op" id="3006602">(</span><span class="ident" id="3006603">nl</span><span class="op" id="3006605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006608">l</span><span class="op" id="3006609">.</span><span class="ident" id="3006610">pendSpace</span>&nbsp;<span class="op" id="3006620">=</span>&nbsp;<span class="num" id="3006622">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006625">l</span><span class="op" id="3006626">.</span><span class="ident" id="3006627">n</span>&nbsp;<span class="op" id="3006629">=</span>&nbsp;<span class="num" id="3006631">0</span><br>
<span class="lineno">480</span><span class="op" id="3006633">}</span>
</div>
</body>
</html>
