<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4061948">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4062003">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4062057">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4062108">package</span>&nbsp;<span class="ident" id="4062116">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4062122">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4062196">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4062270">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4062290">import</span>&nbsp;<span class="op" id="4062297">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062300">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062314">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062331">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062345">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062359">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062375">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062391">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062401">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4062407">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4062417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4062420">type</span>&nbsp;<span class="ident" id="4062425">PEMCipher</span>&nbsp;<span class="builtintype" id="4062435">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4062440">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4062505">const</span>&nbsp;<span class="op" id="4062511">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062514">_</span>&nbsp;<span class="ident" id="4062516">PEMCipher</span>&nbsp;<span class="op" id="4062526">=</span>&nbsp;<span class="ident" id="4062528">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062534">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062548">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062563">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062580">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062597">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4062613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4062616">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4062675">type</span>&nbsp;<span class="ident" id="4062680">rfc1423Algo</span>&nbsp;<span class="keyword" id="4062692">struct</span>&nbsp;<span class="op" id="4062699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062702">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4062713">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062724">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4062735">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062743">cipherFunc</span>&nbsp;<span class="keyword" id="4062754">func</span><span class="op" id="4062758">(</span><span class="ident" id="4062759">key</span>&nbsp;<span class="op" id="4062763">[</span><span class="op" id="4062764">]</span><span class="builtintype" id="4062765">byte</span><span class="op" id="4062769">)</span>&nbsp;<span class="op" id="4062771">(</span><span class="ident" id="4062772">cipher</span><span class="op" id="4062778">.</span><span class="ident" id="4062779">Block</span><span class="op" id="4062784">,</span>&nbsp;<span class="builtintype" id="4062786">error</span><span class="op" id="4062791">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062794">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4062805">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062810">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4062821">int</span><br>
<span class="lineno"></span><span class="op" id="4062825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4062828">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4062896">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4062962">var</span>&nbsp;<span class="ident" id="4062966">rfc1423Algos</span>&nbsp;<span class="op" id="4062979">=</span>&nbsp;<span class="op" id="4062981">[</span><span class="op" id="4062982">]</span><span class="ident" id="4062983">rfc1423Algo</span><span class="op" id="4062994">{</span><span class="op" id="4062995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062998">cipher</span><span class="op" id="4063004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063010">PEMCipherDES</span><span class="op" id="4063022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063025">name</span><span class="op" id="4063029">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4063037">&#34;DES-CBC&#34;</span><span class="op" id="4063046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063049">cipherFunc</span><span class="op" id="4063059">:</span>&nbsp;<span class="ident" id="4063061">des</span><span class="op" id="4063064">.</span><span class="ident" id="4063065">NewCipher</span><span class="op" id="4063074">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063077">keySize</span><span class="op" id="4063084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4063089">8</span><span class="op" id="4063090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063093">blockSize</span><span class="op" id="4063102">:</span>&nbsp;&nbsp;<span class="ident" id="4063105">des</span><span class="op" id="4063108">.</span><span class="ident" id="4063109">BlockSize</span><span class="op" id="4063118">,</span><br>
<span class="lineno"></span><span class="op" id="4063120">}</span><span class="op" id="4063121">,</span>&nbsp;<span class="op" id="4063123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063126">cipher</span><span class="op" id="4063132">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063138">PEMCipher3DES</span><span class="op" id="4063151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063154">name</span><span class="op" id="4063158">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4063166">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4063180">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063183">cipherFunc</span><span class="op" id="4063193">:</span>&nbsp;<span class="ident" id="4063195">des</span><span class="op" id="4063198">.</span><span class="ident" id="4063199">NewTripleDESCipher</span><span class="op" id="4063217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063220">keySize</span><span class="op" id="4063227">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4063232">24</span><span class="op" id="4063234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063237">blockSize</span><span class="op" id="4063246">:</span>&nbsp;&nbsp;<span class="ident" id="4063249">des</span><span class="op" id="4063252">.</span><span class="ident" id="4063253">BlockSize</span><span class="op" id="4063262">,</span><br>
<span class="lineno"></span><span class="op" id="4063264">}</span><span class="op" id="4063265">,</span>&nbsp;<span class="op" id="4063267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063270">cipher</span><span class="op" id="4063276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063282">PEMCipherAES128</span><span class="op" id="4063297">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063300">name</span><span class="op" id="4063304">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4063312">&#34;AES-128-CBC&#34;</span><span class="op" id="4063325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063328">cipherFunc</span><span class="op" id="4063338">:</span>&nbsp;<span class="ident" id="4063340">aes</span><span class="op" id="4063343">.</span><span class="ident" id="4063344">NewCipher</span><span class="op" id="4063353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063356">keySize</span><span class="op" id="4063363">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4063368">16</span><span class="op" id="4063370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063373">blockSize</span><span class="op" id="4063382">:</span>&nbsp;&nbsp;<span class="ident" id="4063385">aes</span><span class="op" id="4063388">.</span><span class="ident" id="4063389">BlockSize</span><span class="op" id="4063398">,</span><br>
<span class="lineno"></span><span class="op" id="4063400">}</span><span class="op" id="4063401">,</span>&nbsp;<span class="op" id="4063403">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063406">cipher</span><span class="op" id="4063412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063418">PEMCipherAES192</span><span class="op" id="4063433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063436">name</span><span class="op" id="4063440">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4063448">&#34;AES-192-CBC&#34;</span><span class="op" id="4063461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063464">cipherFunc</span><span class="op" id="4063474">:</span>&nbsp;<span class="ident" id="4063476">aes</span><span class="op" id="4063479">.</span><span class="ident" id="4063480">NewCipher</span><span class="op" id="4063489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063492">keySize</span><span class="op" id="4063499">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4063504">24</span><span class="op" id="4063506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063509">blockSize</span><span class="op" id="4063518">:</span>&nbsp;&nbsp;<span class="ident" id="4063521">aes</span><span class="op" id="4063524">.</span><span class="ident" id="4063525">BlockSize</span><span class="op" id="4063534">,</span><br>
<span class="lineno">70</span><span class="op" id="4063536">}</span><span class="op" id="4063537">,</span>&nbsp;<span class="op" id="4063539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063542">cipher</span><span class="op" id="4063548">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063554">PEMCipherAES256</span><span class="op" id="4063569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063572">name</span><span class="op" id="4063576">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4063584">&#34;AES-256-CBC&#34;</span><span class="op" id="4063597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063600">cipherFunc</span><span class="op" id="4063610">:</span>&nbsp;<span class="ident" id="4063612">aes</span><span class="op" id="4063615">.</span><span class="ident" id="4063616">NewCipher</span><span class="op" id="4063625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063628">keySize</span><span class="op" id="4063635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4063640">32</span><span class="op" id="4063642">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063645">blockSize</span><span class="op" id="4063654">:</span>&nbsp;&nbsp;<span class="ident" id="4063657">aes</span><span class="op" id="4063660">.</span><span class="ident" id="4063661">BlockSize</span><span class="op" id="4063670">,</span><br>
<span class="lineno"></span><span class="op" id="4063672">}</span><span class="op" id="4063673">,</span><br>
<span class="lineno"></span><span class="op" id="4063675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4063678">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4063757">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4063837">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4063860">func</span>&nbsp;<span class="op" id="4063865">(</span><span class="ident" id="4063866">c</span>&nbsp;<span class="ident" id="4063868">rfc1423Algo</span><span class="op" id="4063879">)</span>&nbsp;<span class="ident" id="4063881">deriveKey</span><span class="op" id="4063890">(</span><span class="ident" id="4063891">password</span><span class="op" id="4063899">,</span>&nbsp;<span class="ident" id="4063901">salt</span>&nbsp;<span class="op" id="4063906">[</span><span class="op" id="4063907">]</span><span class="builtintype" id="4063908">byte</span><span class="op" id="4063912">)</span>&nbsp;<span class="op" id="4063914">[</span><span class="op" id="4063915">]</span><span class="builtintype" id="4063916">byte</span>&nbsp;<span class="op" id="4063921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063924">hash</span>&nbsp;<span class="op" id="4063929">:=</span>&nbsp;<span class="ident" id="4063932">md5</span><span class="op" id="4063935">.</span><span class="ident" id="4063936">New</span><span class="op" id="4063939">(</span><span class="op" id="4063940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063943">out</span>&nbsp;<span class="op" id="4063947">:=</span>&nbsp;<span class="builtinfunc" id="4063950">make</span><span class="op" id="4063954">(</span><span class="op" id="4063955">[</span><span class="op" id="4063956">]</span><span class="builtintype" id="4063957">byte</span><span class="op" id="4063961">,</span>&nbsp;<span class="ident" id="4063963">c</span><span class="op" id="4063964">.</span><span class="ident" id="4063965">keySize</span><span class="op" id="4063972">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063975">var</span>&nbsp;<span class="ident" id="4063979">digest</span>&nbsp;<span class="op" id="4063986">[</span><span class="op" id="4063987">]</span><span class="builtintype" id="4063988">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063995">for</span>&nbsp;<span class="ident" id="4063999">i</span>&nbsp;<span class="op" id="4064001">:=</span>&nbsp;<span class="num" id="4064004">0</span><span class="op" id="4064005">;</span>&nbsp;<span class="ident" id="4064007">i</span>&nbsp;<span class="op" id="4064009">&lt;</span>&nbsp;<span class="builtinfunc" id="4064011">len</span><span class="op" id="4064014">(</span><span class="ident" id="4064015">out</span><span class="op" id="4064018">)</span><span class="op" id="4064019">;</span>&nbsp;<span class="ident" id="4064021">i</span>&nbsp;<span class="op" id="4064023">+=</span>&nbsp;<span class="builtinfunc" id="4064026">len</span><span class="op" id="4064029">(</span><span class="ident" id="4064030">digest</span><span class="op" id="4064036">)</span>&nbsp;<span class="op" id="4064038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064042">hash</span><span class="op" id="4064046">.</span><span class="ident" id="4064047">Reset</span><span class="op" id="4064052">(</span><span class="op" id="4064053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064057">hash</span><span class="op" id="4064061">.</span><span class="ident" id="4064062">Write</span><span class="op" id="4064067">(</span><span class="ident" id="4064068">digest</span><span class="op" id="4064074">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064078">hash</span><span class="op" id="4064082">.</span><span class="ident" id="4064083">Write</span><span class="op" id="4064088">(</span><span class="ident" id="4064089">password</span><span class="op" id="4064097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064101">hash</span><span class="op" id="4064105">.</span><span class="ident" id="4064106">Write</span><span class="op" id="4064111">(</span><span class="ident" id="4064112">salt</span><span class="op" id="4064116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064120">digest</span>&nbsp;<span class="op" id="4064127">=</span>&nbsp;<span class="ident" id="4064129">hash</span><span class="op" id="4064133">.</span><span class="ident" id="4064134">Sum</span><span class="op" id="4064137">(</span><span class="ident" id="4064138">digest</span><span class="op" id="4064144">[</span><span class="op" id="4064145">:</span><span class="num" id="4064146">0</span><span class="op" id="4064147">]</span><span class="op" id="4064148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4064152">copy</span><span class="op" id="4064156">(</span><span class="ident" id="4064157">out</span><span class="op" id="4064160">[</span><span class="ident" id="4064161">i</span><span class="op" id="4064162">:</span><span class="op" id="4064163">]</span><span class="op" id="4064164">,</span>&nbsp;<span class="ident" id="4064166">digest</span><span class="op" id="4064172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064175">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064178">return</span>&nbsp;<span class="ident" id="4064185">out</span><br>
<span class="lineno"></span><span class="op" id="4064189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4064192">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4064263">func</span>&nbsp;<span class="ident" id="4064268">IsEncryptedPEMBlock</span><span class="op" id="4064287">(</span><span class="ident" id="4064288">b</span>&nbsp;<span class="op" id="4064290">*</span><span class="ident" id="4064291">pem</span><span class="op" id="4064294">.</span><span class="ident" id="4064295">Block</span><span class="op" id="4064300">)</span>&nbsp;<span class="builtintype" id="4064302">bool</span>&nbsp;<span class="op" id="4064307">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064310">_</span><span class="op" id="4064311">,</span>&nbsp;<span class="ident" id="4064313">ok</span>&nbsp;<span class="op" id="4064316">:=</span>&nbsp;<span class="ident" id="4064319">b</span><span class="op" id="4064320">.</span><span class="ident" id="4064321">Headers</span><span class="op" id="4064328">[</span><span class="string" id="4064329">&#34;DEK-Info&#34;</span><span class="op" id="4064339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064342">return</span>&nbsp;<span class="ident" id="4064349">ok</span><br>
<span class="lineno"></span><span class="op" id="4064352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4064355">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4064433">var</span>&nbsp;<span class="ident" id="4064437">IncorrectPasswordError</span>&nbsp;<span class="op" id="4064460">=</span>&nbsp;<span class="ident" id="4064462">errors</span><span class="op" id="4064468">.</span><span class="ident" id="4064469">New</span><span class="op" id="4064472">(</span><span class="string" id="4064473">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4064510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4064513">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4064594">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4064672">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4064749">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4064827">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4064881">func</span>&nbsp;<span class="ident" id="4064886">DecryptPEMBlock</span><span class="op" id="4064901">(</span><span class="ident" id="4064902">b</span>&nbsp;<span class="op" id="4064904">*</span><span class="ident" id="4064905">pem</span><span class="op" id="4064908">.</span><span class="ident" id="4064909">Block</span><span class="op" id="4064914">,</span>&nbsp;<span class="ident" id="4064916">password</span>&nbsp;<span class="op" id="4064925">[</span><span class="op" id="4064926">]</span><span class="builtintype" id="4064927">byte</span><span class="op" id="4064931">)</span>&nbsp;<span class="op" id="4064933">(</span><span class="op" id="4064934">[</span><span class="op" id="4064935">]</span><span class="builtintype" id="4064936">byte</span><span class="op" id="4064940">,</span>&nbsp;<span class="builtintype" id="4064942">error</span><span class="op" id="4064947">)</span>&nbsp;<span class="op" id="4064949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064952">dek</span><span class="op" id="4064955">,</span>&nbsp;<span class="ident" id="4064957">ok</span>&nbsp;<span class="op" id="4064960">:=</span>&nbsp;<span class="ident" id="4064963">b</span><span class="op" id="4064964">.</span><span class="ident" id="4064965">Headers</span><span class="op" id="4064972">[</span><span class="string" id="4064973">&#34;DEK-Info&#34;</span><span class="op" id="4064983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064986">if</span>&nbsp;<span class="op" id="4064989">!</span><span class="ident" id="4064990">ok</span>&nbsp;<span class="op" id="4064993">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064997">return</span>&nbsp;<span class="ident" id="4065004">nil</span><span class="op" id="4065007">,</span>&nbsp;<span class="ident" id="4065009">errors</span><span class="op" id="4065015">.</span><span class="ident" id="4065016">New</span><span class="op" id="4065019">(</span><span class="string" id="4065020">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4065055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065062">idx</span>&nbsp;<span class="op" id="4065066">:=</span>&nbsp;<span class="ident" id="4065069">strings</span><span class="op" id="4065076">.</span><span class="ident" id="4065077">Index</span><span class="op" id="4065082">(</span><span class="ident" id="4065083">dek</span><span class="op" id="4065086">,</span>&nbsp;<span class="string" id="4065088">&#34;,&#34;</span><span class="op" id="4065091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065094">if</span>&nbsp;<span class="ident" id="4065097">idx</span>&nbsp;<span class="op" id="4065101">==</span>&nbsp;<span class="op" id="4065104">-</span><span class="num" id="4065105">1</span>&nbsp;<span class="op" id="4065107">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065111">return</span>&nbsp;<span class="ident" id="4065118">nil</span><span class="op" id="4065121">,</span>&nbsp;<span class="ident" id="4065123">errors</span><span class="op" id="4065129">.</span><span class="ident" id="4065130">New</span><span class="op" id="4065133">(</span><span class="string" id="4065134">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4065167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065174">mode</span><span class="op" id="4065178">,</span>&nbsp;<span class="ident" id="4065180">hexIV</span>&nbsp;<span class="op" id="4065186">:=</span>&nbsp;<span class="ident" id="4065189">dek</span><span class="op" id="4065192">[</span><span class="op" id="4065193">:</span><span class="ident" id="4065194">idx</span><span class="op" id="4065197">]</span><span class="op" id="4065198">,</span>&nbsp;<span class="ident" id="4065200">dek</span><span class="op" id="4065203">[</span><span class="ident" id="4065204">idx</span><span class="op" id="4065207">+</span><span class="num" id="4065208">1</span><span class="op" id="4065209">:</span><span class="op" id="4065210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065213">ciph</span>&nbsp;<span class="op" id="4065218">:=</span>&nbsp;<span class="ident" id="4065221">cipherByName</span><span class="op" id="4065233">(</span><span class="ident" id="4065234">mode</span><span class="op" id="4065238">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065241">if</span>&nbsp;<span class="ident" id="4065244">ciph</span>&nbsp;<span class="op" id="4065249">==</span>&nbsp;<span class="ident" id="4065252">nil</span>&nbsp;<span class="op" id="4065256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065260">return</span>&nbsp;<span class="ident" id="4065267">nil</span><span class="op" id="4065270">,</span>&nbsp;<span class="ident" id="4065272">errors</span><span class="op" id="4065278">.</span><span class="ident" id="4065279">New</span><span class="op" id="4065282">(</span><span class="string" id="4065283">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4065314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065320">iv</span><span class="op" id="4065322">,</span>&nbsp;<span class="ident" id="4065324">err</span>&nbsp;<span class="op" id="4065328">:=</span>&nbsp;<span class="ident" id="4065331">hex</span><span class="op" id="4065334">.</span><span class="ident" id="4065335">DecodeString</span><span class="op" id="4065347">(</span><span class="ident" id="4065348">hexIV</span><span class="op" id="4065353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065356">if</span>&nbsp;<span class="ident" id="4065359">err</span>&nbsp;<span class="op" id="4065363">!=</span>&nbsp;<span class="ident" id="4065366">nil</span>&nbsp;<span class="op" id="4065370">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065374">return</span>&nbsp;<span class="ident" id="4065381">nil</span><span class="op" id="4065384">,</span>&nbsp;<span class="ident" id="4065386">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065394">if</span>&nbsp;<span class="builtinfunc" id="4065397">len</span><span class="op" id="4065400">(</span><span class="ident" id="4065401">iv</span><span class="op" id="4065403">)</span>&nbsp;<span class="op" id="4065405">!=</span>&nbsp;<span class="ident" id="4065408">ciph</span><span class="op" id="4065412">.</span><span class="ident" id="4065413">blockSize</span>&nbsp;<span class="op" id="4065423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065427">return</span>&nbsp;<span class="ident" id="4065434">nil</span><span class="op" id="4065437">,</span>&nbsp;<span class="ident" id="4065439">errors</span><span class="op" id="4065445">.</span><span class="ident" id="4065446">New</span><span class="op" id="4065449">(</span><span class="string" id="4065450">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4065475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065478">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065482">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065553">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065587">key</span>&nbsp;<span class="op" id="4065591">:=</span>&nbsp;<span class="ident" id="4065594">ciph</span><span class="op" id="4065598">.</span><span class="ident" id="4065599">deriveKey</span><span class="op" id="4065608">(</span><span class="ident" id="4065609">password</span><span class="op" id="4065617">,</span>&nbsp;<span class="ident" id="4065619">iv</span><span class="op" id="4065621">[</span><span class="op" id="4065622">:</span><span class="num" id="4065623">8</span><span class="op" id="4065624">]</span><span class="op" id="4065625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065628">block</span><span class="op" id="4065633">,</span>&nbsp;<span class="ident" id="4065635">err</span>&nbsp;<span class="op" id="4065639">:=</span>&nbsp;<span class="ident" id="4065642">ciph</span><span class="op" id="4065646">.</span><span class="ident" id="4065647">cipherFunc</span><span class="op" id="4065657">(</span><span class="ident" id="4065658">key</span><span class="op" id="4065661">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065664">if</span>&nbsp;<span class="ident" id="4065667">err</span>&nbsp;<span class="op" id="4065671">!=</span>&nbsp;<span class="ident" id="4065674">nil</span>&nbsp;<span class="op" id="4065678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065682">return</span>&nbsp;<span class="ident" id="4065689">nil</span><span class="op" id="4065692">,</span>&nbsp;<span class="ident" id="4065694">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065703">data</span>&nbsp;<span class="op" id="4065708">:=</span>&nbsp;<span class="builtinfunc" id="4065711">make</span><span class="op" id="4065715">(</span><span class="op" id="4065716">[</span><span class="op" id="4065717">]</span><span class="builtintype" id="4065718">byte</span><span class="op" id="4065722">,</span>&nbsp;<span class="builtinfunc" id="4065724">len</span><span class="op" id="4065727">(</span><span class="ident" id="4065728">b</span><span class="op" id="4065729">.</span><span class="ident" id="4065730">Bytes</span><span class="op" id="4065735">)</span><span class="op" id="4065736">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065739">dec</span>&nbsp;<span class="op" id="4065743">:=</span>&nbsp;<span class="ident" id="4065746">cipher</span><span class="op" id="4065752">.</span><span class="ident" id="4065753">NewCBCDecrypter</span><span class="op" id="4065768">(</span><span class="ident" id="4065769">block</span><span class="op" id="4065774">,</span>&nbsp;<span class="ident" id="4065776">iv</span><span class="op" id="4065778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065781">dec</span><span class="op" id="4065784">.</span><span class="ident" id="4065785">CryptBlocks</span><span class="op" id="4065796">(</span><span class="ident" id="4065797">data</span><span class="op" id="4065801">,</span>&nbsp;<span class="ident" id="4065803">b</span><span class="op" id="4065804">.</span><span class="ident" id="4065805">Bytes</span><span class="op" id="4065810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065814">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065893">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065971">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065988">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066004">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066028">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066097">dlen</span>&nbsp;<span class="op" id="4066102">:=</span>&nbsp;<span class="builtinfunc" id="4066105">len</span><span class="op" id="4066108">(</span><span class="ident" id="4066109">data</span><span class="op" id="4066113">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066116">if</span>&nbsp;<span class="ident" id="4066119">dlen</span>&nbsp;<span class="op" id="4066124">==</span>&nbsp;<span class="num" id="4066127">0</span>&nbsp;<span class="op" id="4066129">||</span>&nbsp;<span class="ident" id="4066132">dlen</span><span class="op" id="4066136">%</span><span class="ident" id="4066137">ciph</span><span class="op" id="4066141">.</span><span class="ident" id="4066142">blockSize</span>&nbsp;<span class="op" id="4066152">!=</span>&nbsp;<span class="num" id="4066155">0</span>&nbsp;<span class="op" id="4066157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066161">return</span>&nbsp;<span class="ident" id="4066168">nil</span><span class="op" id="4066171">,</span>&nbsp;<span class="ident" id="4066173">errors</span><span class="op" id="4066179">.</span><span class="ident" id="4066180">New</span><span class="op" id="4066183">(</span><span class="string" id="4066184">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4066207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066213">last</span>&nbsp;<span class="op" id="4066218">:=</span>&nbsp;<span class="builtintype" id="4066221">int</span><span class="op" id="4066224">(</span><span class="ident" id="4066225">data</span><span class="op" id="4066229">[</span><span class="ident" id="4066230">dlen</span><span class="op" id="4066234">-</span><span class="num" id="4066235">1</span><span class="op" id="4066236">]</span><span class="op" id="4066237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066240">if</span>&nbsp;<span class="ident" id="4066243">dlen</span>&nbsp;<span class="op" id="4066248">&lt;</span>&nbsp;<span class="ident" id="4066250">last</span>&nbsp;<span class="op" id="4066255">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066259">return</span>&nbsp;<span class="ident" id="4066266">nil</span><span class="op" id="4066269">,</span>&nbsp;<span class="ident" id="4066271">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066298">if</span>&nbsp;<span class="ident" id="4066301">last</span>&nbsp;<span class="op" id="4066306">==</span>&nbsp;<span class="num" id="4066309">0</span>&nbsp;<span class="op" id="4066311">||</span>&nbsp;<span class="ident" id="4066314">last</span>&nbsp;<span class="op" id="4066319">&gt;</span>&nbsp;<span class="ident" id="4066321">ciph</span><span class="op" id="4066325">.</span><span class="ident" id="4066326">blockSize</span>&nbsp;<span class="op" id="4066336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066340">return</span>&nbsp;<span class="ident" id="4066347">nil</span><span class="op" id="4066350">,</span>&nbsp;<span class="ident" id="4066352">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066376">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066379">for</span>&nbsp;<span class="ident" id="4066383">_</span><span class="op" id="4066384">,</span>&nbsp;<span class="ident" id="4066386">val</span>&nbsp;<span class="op" id="4066390">:=</span>&nbsp;<span class="keyword" id="4066393">range</span>&nbsp;<span class="ident" id="4066399">data</span><span class="op" id="4066403">[</span><span class="ident" id="4066404">dlen</span><span class="op" id="4066408">-</span><span class="ident" id="4066409">last</span><span class="op" id="4066413">:</span><span class="op" id="4066414">]</span>&nbsp;<span class="op" id="4066416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066420">if</span>&nbsp;<span class="builtintype" id="4066423">int</span><span class="op" id="4066426">(</span><span class="ident" id="4066427">val</span><span class="op" id="4066430">)</span>&nbsp;<span class="op" id="4066432">!=</span>&nbsp;<span class="ident" id="4066435">last</span>&nbsp;<span class="op" id="4066440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066445">return</span>&nbsp;<span class="ident" id="4066452">nil</span><span class="op" id="4066455">,</span>&nbsp;<span class="ident" id="4066457">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066485">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066488">return</span>&nbsp;<span class="ident" id="4066495">data</span><span class="op" id="4066499">[</span><span class="op" id="4066500">:</span><span class="ident" id="4066501">dlen</span><span class="op" id="4066505">-</span><span class="ident" id="4066506">last</span><span class="op" id="4066510">]</span><span class="op" id="4066511">,</span>&nbsp;<span class="ident" id="4066513">nil</span><br>
<span class="lineno"></span><span class="op" id="4066517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4066520">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4066593">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4066662">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4066675">func</span>&nbsp;<span class="ident" id="4066680">EncryptPEMBlock</span><span class="op" id="4066695">(</span><span class="ident" id="4066696">rand</span>&nbsp;<span class="ident" id="4066701">io</span><span class="op" id="4066703">.</span><span class="ident" id="4066704">Reader</span><span class="op" id="4066710">,</span>&nbsp;<span class="ident" id="4066712">blockType</span>&nbsp;<span class="builtintype" id="4066722">string</span><span class="op" id="4066728">,</span>&nbsp;<span class="ident" id="4066730">data</span><span class="op" id="4066734">,</span>&nbsp;<span class="ident" id="4066736">password</span>&nbsp;<span class="op" id="4066745">[</span><span class="op" id="4066746">]</span><span class="builtintype" id="4066747">byte</span><span class="op" id="4066751">,</span>&nbsp;<span class="ident" id="4066753">alg</span>&nbsp;<span class="ident" id="4066757">PEMCipher</span><span class="op" id="4066766">)</span>&nbsp;<span class="op" id="4066768">(</span><span class="op" id="4066769">*</span><span class="ident" id="4066770">pem</span><span class="op" id="4066773">.</span><span class="ident" id="4066774">Block</span><span class="op" id="4066779">,</span>&nbsp;<span class="builtintype" id="4066781">error</span><span class="op" id="4066786">)</span>&nbsp;<span class="op" id="4066788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066791">ciph</span>&nbsp;<span class="op" id="4066796">:=</span>&nbsp;<span class="ident" id="4066799">cipherByKey</span><span class="op" id="4066810">(</span><span class="ident" id="4066811">alg</span><span class="op" id="4066814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066817">if</span>&nbsp;<span class="ident" id="4066820">ciph</span>&nbsp;<span class="op" id="4066825">==</span>&nbsp;<span class="ident" id="4066828">nil</span>&nbsp;<span class="op" id="4066832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066836">return</span>&nbsp;<span class="ident" id="4066843">nil</span><span class="op" id="4066846">,</span>&nbsp;<span class="ident" id="4066848">errors</span><span class="op" id="4066854">.</span><span class="ident" id="4066855">New</span><span class="op" id="4066858">(</span><span class="string" id="4066859">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4066890">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066896">iv</span>&nbsp;<span class="op" id="4066899">:=</span>&nbsp;<span class="builtinfunc" id="4066902">make</span><span class="op" id="4066906">(</span><span class="op" id="4066907">[</span><span class="op" id="4066908">]</span><span class="builtintype" id="4066909">byte</span><span class="op" id="4066913">,</span>&nbsp;<span class="ident" id="4066915">ciph</span><span class="op" id="4066919">.</span><span class="ident" id="4066920">blockSize</span><span class="op" id="4066929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066932">if</span>&nbsp;<span class="ident" id="4066935">_</span><span class="op" id="4066936">,</span>&nbsp;<span class="ident" id="4066938">err</span>&nbsp;<span class="op" id="4066942">:=</span>&nbsp;<span class="ident" id="4066945">io</span><span class="op" id="4066947">.</span><span class="ident" id="4066948">ReadFull</span><span class="op" id="4066956">(</span><span class="ident" id="4066957">rand</span><span class="op" id="4066961">,</span>&nbsp;<span class="ident" id="4066963">iv</span><span class="op" id="4066965">)</span><span class="op" id="4066966">;</span>&nbsp;<span class="ident" id="4066968">err</span>&nbsp;<span class="op" id="4066972">!=</span>&nbsp;<span class="ident" id="4066975">nil</span>&nbsp;<span class="op" id="4066979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066983">return</span>&nbsp;<span class="ident" id="4066990">nil</span><span class="op" id="4066993">,</span>&nbsp;<span class="ident" id="4066995">errors</span><span class="op" id="4067001">.</span><span class="ident" id="4067002">New</span><span class="op" id="4067005">(</span><span class="string" id="4067006">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4067035">+</span>&nbsp;<span class="ident" id="4067037">err</span><span class="op" id="4067040">.</span><span class="ident" id="4067041">Error</span><span class="op" id="4067046">(</span><span class="op" id="4067047">)</span><span class="op" id="4067048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067051">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067054">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067118">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067170">key</span>&nbsp;<span class="op" id="4067174">:=</span>&nbsp;<span class="ident" id="4067177">ciph</span><span class="op" id="4067181">.</span><span class="ident" id="4067182">deriveKey</span><span class="op" id="4067191">(</span><span class="ident" id="4067192">password</span><span class="op" id="4067200">,</span>&nbsp;<span class="ident" id="4067202">iv</span><span class="op" id="4067204">[</span><span class="op" id="4067205">:</span><span class="num" id="4067206">8</span><span class="op" id="4067207">]</span><span class="op" id="4067208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067211">block</span><span class="op" id="4067216">,</span>&nbsp;<span class="ident" id="4067218">err</span>&nbsp;<span class="op" id="4067222">:=</span>&nbsp;<span class="ident" id="4067225">ciph</span><span class="op" id="4067229">.</span><span class="ident" id="4067230">cipherFunc</span><span class="op" id="4067240">(</span><span class="ident" id="4067241">key</span><span class="op" id="4067244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067247">if</span>&nbsp;<span class="ident" id="4067250">err</span>&nbsp;<span class="op" id="4067254">!=</span>&nbsp;<span class="ident" id="4067257">nil</span>&nbsp;<span class="op" id="4067261">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067265">return</span>&nbsp;<span class="ident" id="4067272">nil</span><span class="op" id="4067275">,</span>&nbsp;<span class="ident" id="4067277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067285">enc</span>&nbsp;<span class="op" id="4067289">:=</span>&nbsp;<span class="ident" id="4067292">cipher</span><span class="op" id="4067298">.</span><span class="ident" id="4067299">NewCBCEncrypter</span><span class="op" id="4067314">(</span><span class="ident" id="4067315">block</span><span class="op" id="4067320">,</span>&nbsp;<span class="ident" id="4067322">iv</span><span class="op" id="4067324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067327">pad</span>&nbsp;<span class="op" id="4067331">:=</span>&nbsp;<span class="ident" id="4067334">ciph</span><span class="op" id="4067338">.</span><span class="ident" id="4067339">blockSize</span>&nbsp;<span class="op" id="4067349">-</span>&nbsp;<span class="builtinfunc" id="4067351">len</span><span class="op" id="4067354">(</span><span class="ident" id="4067355">data</span><span class="op" id="4067359">)</span><span class="op" id="4067360">%</span><span class="ident" id="4067361">ciph</span><span class="op" id="4067365">.</span><span class="ident" id="4067366">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067377">encrypted</span>&nbsp;<span class="op" id="4067387">:=</span>&nbsp;<span class="builtinfunc" id="4067390">make</span><span class="op" id="4067394">(</span><span class="op" id="4067395">[</span><span class="op" id="4067396">]</span><span class="builtintype" id="4067397">byte</span><span class="op" id="4067401">,</span>&nbsp;<span class="builtinfunc" id="4067403">len</span><span class="op" id="4067406">(</span><span class="ident" id="4067407">data</span><span class="op" id="4067411">)</span><span class="op" id="4067412">,</span>&nbsp;<span class="builtinfunc" id="4067414">len</span><span class="op" id="4067417">(</span><span class="ident" id="4067418">data</span><span class="op" id="4067422">)</span><span class="op" id="4067423">+</span><span class="ident" id="4067424">pad</span><span class="op" id="4067427">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067430">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067496">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067562">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4067572">copy</span><span class="op" id="4067576">(</span><span class="ident" id="4067577">encrypted</span><span class="op" id="4067586">,</span>&nbsp;<span class="ident" id="4067588">data</span><span class="op" id="4067592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067595">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067625">for</span>&nbsp;<span class="ident" id="4067629">i</span>&nbsp;<span class="op" id="4067631">:=</span>&nbsp;<span class="num" id="4067634">0</span><span class="op" id="4067635">;</span>&nbsp;<span class="ident" id="4067637">i</span>&nbsp;<span class="op" id="4067639">&lt;</span>&nbsp;<span class="ident" id="4067641">pad</span><span class="op" id="4067644">;</span>&nbsp;<span class="ident" id="4067646">i</span><span class="op" id="4067647">++</span>&nbsp;<span class="op" id="4067650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067654">encrypted</span>&nbsp;<span class="op" id="4067664">=</span>&nbsp;<span class="builtinfunc" id="4067666">append</span><span class="op" id="4067672">(</span><span class="ident" id="4067673">encrypted</span><span class="op" id="4067682">,</span>&nbsp;<span class="builtintype" id="4067684">byte</span><span class="op" id="4067688">(</span><span class="ident" id="4067689">pad</span><span class="op" id="4067692">)</span><span class="op" id="4067693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067699">enc</span><span class="op" id="4067702">.</span><span class="ident" id="4067703">CryptBlocks</span><span class="op" id="4067714">(</span><span class="ident" id="4067715">encrypted</span><span class="op" id="4067724">,</span>&nbsp;<span class="ident" id="4067726">encrypted</span><span class="op" id="4067735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067739">return</span>&nbsp;<span class="op" id="4067746">&amp;</span><span class="ident" id="4067747">pem</span><span class="op" id="4067750">.</span><span class="ident" id="4067751">Block</span><span class="op" id="4067756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067760">Type</span><span class="op" id="4067764">:</span>&nbsp;<span class="ident" id="4067766">blockType</span><span class="op" id="4067775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067779">Headers</span><span class="op" id="4067786">:</span>&nbsp;<span class="keyword" id="4067788">map</span><span class="op" id="4067791">[</span><span class="builtintype" id="4067792">string</span><span class="op" id="4067798">]</span><span class="builtintype" id="4067799">string</span><span class="op" id="4067805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4067810">&#34;Proc-Type&#34;</span><span class="op" id="4067821">:</span>&nbsp;<span class="string" id="4067823">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4067836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4067841">&#34;DEK-Info&#34;</span><span class="op" id="4067851">:</span>&nbsp;&nbsp;<span class="ident" id="4067854">ciph</span><span class="op" id="4067858">.</span><span class="ident" id="4067859">name</span>&nbsp;<span class="op" id="4067864">+</span>&nbsp;<span class="string" id="4067866">&#34;,&#34;</span>&nbsp;<span class="op" id="4067870">+</span>&nbsp;<span class="ident" id="4067872">hex</span><span class="op" id="4067875">.</span><span class="ident" id="4067876">EncodeToString</span><span class="op" id="4067890">(</span><span class="ident" id="4067891">iv</span><span class="op" id="4067893">)</span><span class="op" id="4067894">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067898">}</span><span class="op" id="4067899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067903">Bytes</span><span class="op" id="4067908">:</span>&nbsp;<span class="ident" id="4067910">encrypted</span><span class="op" id="4067919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067922">}</span><span class="op" id="4067923">,</span>&nbsp;<span class="ident" id="4067925">nil</span><br>
<span class="lineno"></span><span class="op" id="4067929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4067932">func</span>&nbsp;<span class="ident" id="4067937">cipherByName</span><span class="op" id="4067949">(</span><span class="ident" id="4067950">name</span>&nbsp;<span class="builtintype" id="4067955">string</span><span class="op" id="4067961">)</span>&nbsp;<span class="op" id="4067963">*</span><span class="ident" id="4067964">rfc1423Algo</span>&nbsp;<span class="op" id="4067976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067979">for</span>&nbsp;<span class="ident" id="4067983">i</span>&nbsp;<span class="op" id="4067985">:=</span>&nbsp;<span class="keyword" id="4067988">range</span>&nbsp;<span class="ident" id="4067994">rfc1423Algos</span>&nbsp;<span class="op" id="4068007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068011">alg</span>&nbsp;<span class="op" id="4068015">:=</span>&nbsp;<span class="op" id="4068018">&amp;</span><span class="ident" id="4068019">rfc1423Algos</span><span class="op" id="4068031">[</span><span class="ident" id="4068032">i</span><span class="op" id="4068033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068037">if</span>&nbsp;<span class="ident" id="4068040">alg</span><span class="op" id="4068043">.</span><span class="ident" id="4068044">name</span>&nbsp;<span class="op" id="4068049">==</span>&nbsp;<span class="ident" id="4068052">name</span>&nbsp;<span class="op" id="4068057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068062">return</span>&nbsp;<span class="ident" id="4068069">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068081">return</span>&nbsp;<span class="ident" id="4068088">nil</span><br>
<span class="lineno"></span><span class="op" id="4068092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4068095">func</span>&nbsp;<span class="ident" id="4068100">cipherByKey</span><span class="op" id="4068111">(</span><span class="ident" id="4068112">key</span>&nbsp;<span class="ident" id="4068116">PEMCipher</span><span class="op" id="4068125">)</span>&nbsp;<span class="op" id="4068127">*</span><span class="ident" id="4068128">rfc1423Algo</span>&nbsp;<span class="op" id="4068140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068143">for</span>&nbsp;<span class="ident" id="4068147">i</span>&nbsp;<span class="op" id="4068149">:=</span>&nbsp;<span class="keyword" id="4068152">range</span>&nbsp;<span class="ident" id="4068158">rfc1423Algos</span>&nbsp;<span class="op" id="4068171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068175">alg</span>&nbsp;<span class="op" id="4068179">:=</span>&nbsp;<span class="op" id="4068182">&amp;</span><span class="ident" id="4068183">rfc1423Algos</span><span class="op" id="4068195">[</span><span class="ident" id="4068196">i</span><span class="op" id="4068197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068201">if</span>&nbsp;<span class="ident" id="4068204">alg</span><span class="op" id="4068207">.</span><span class="ident" id="4068208">cipher</span>&nbsp;<span class="op" id="4068215">==</span>&nbsp;<span class="ident" id="4068218">key</span>&nbsp;<span class="op" id="4068222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068227">return</span>&nbsp;<span class="ident" id="4068234">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068246">return</span>&nbsp;<span class="ident" id="4068253">nil</span><br>
<span class="lineno"></span><span class="op" id="4068257">}</span>
</div>
</body>
</html>
