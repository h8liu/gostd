<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8602398">package</span>&nbsp;<span class="ident" id="8602406">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8602413">import</span>&nbsp;<span class="op" id="8602420">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8602423">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8602433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8602436">type</span>&nbsp;<span class="ident" id="8602441">ti1</span>&nbsp;<span class="builtintype" id="8602445">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8602450">func</span>&nbsp;<span class="op" id="8602455">(</span><span class="ident" id="8602456">i</span>&nbsp;<span class="ident" id="8602458"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602441">ti1</a></span><span class="op" id="8602461">)</span>&nbsp;<span class="ident" id="8602463">I</span><span class="op" id="8602464">(</span><span class="ident" id="8602465">cpu</span>&nbsp;<span class="op" id="8602469">*</span><span class="ident" id="8602470"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="8602473">,</span>&nbsp;<span class="ident" id="8602475">in</span>&nbsp;<span class="builtintype" id="8602478">uint32</span><span class="op" id="8602484">)</span>&nbsp;<span class="op" id="8602486">*</span><span class="ident" id="8602487"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="8602493">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602496">switch</span>&nbsp;<span class="ident" id="8602503"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602475">in</a></span>&nbsp;<span class="op" id="8602506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602509">case</span>&nbsp;<span class="num" id="8602514">0</span><span class="op" id="8602515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602519">return</span>&nbsp;<span class="ident" id="8602526"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966023">errHalt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602535">case</span>&nbsp;<span class="num" id="8602540">1</span><span class="op" id="8602541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602545">return</span>&nbsp;<span class="ident" id="8602552"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966067">errTimeInt</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602564">case</span>&nbsp;<span class="num" id="8602569">2</span><span class="op" id="8602570">:</span>&nbsp;<span class="comment" id="8602572">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602582">if</span>&nbsp;<span class="ident" id="8602585"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602465">cpu</a></span><span class="op" id="8602588">.</span><span class="ident" id="8602589">UserMode</span><span class="op" id="8602597">(</span><span class="op" id="8602598">)</span>&nbsp;<span class="op" id="8602600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602605">return</span>&nbsp;<span class="ident" id="8602612"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966122">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8602629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602633">return</span>&nbsp;<span class="ident" id="8602640"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602465">cpu</a></span><span class="op" id="8602643">.</span><span class="ident" id="8602644">Iret</span><span class="op" id="8602648">(</span><span class="op" id="8602649">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602652">default</span><span class="op" id="8602659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602663">return</span>&nbsp;<span class="ident" id="8602670"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966122">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8602686">}</span><br>
<span class="lineno"></span><span class="op" id="8602688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8602691">func</span>&nbsp;<span class="ident" id="8602696">TestCPU</span><span class="op" id="8602703">(</span><span class="ident" id="8602704">t</span>&nbsp;<span class="op" id="8602706">*</span><span class="ident" id="8602707"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602423">testing</a></span><span class="op" id="8602714">.</span><span class="ident" id="8602715">T</span><span class="op" id="8602716">)</span>&nbsp;<span class="op" id="8602718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602721">as</span>&nbsp;<span class="op" id="8602724">:=</span>&nbsp;<span class="keyword" id="8602727">func</span><span class="op" id="8602731">(</span><span class="ident" id="8602732">cond</span>&nbsp;<span class="builtintype" id="8602737">bool</span><span class="op" id="8602741">,</span>&nbsp;<span class="ident" id="8602743">s</span>&nbsp;<span class="builtintype" id="8602745">string</span><span class="op" id="8602751">,</span>&nbsp;<span class="ident" id="8602753">args</span>&nbsp;<span class="op" id="8602758">...</span><span class="keyword" id="8602761">interface</span><span class="op" id="8602770">{</span><span class="op" id="8602771">}</span><span class="op" id="8602772">)</span>&nbsp;<span class="op" id="8602774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8602778">if</span>&nbsp;<span class="op" id="8602781">!</span><span class="ident" id="8602782"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602732">cond</a></span>&nbsp;<span class="op" id="8602787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602792"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602704">t</a></span><span class="op" id="8602793">.</span><span class="ident" id="8602794">Fatalf</span><span class="op" id="8602800">(</span><span class="ident" id="8602801"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602743">s</a></span><span class="op" id="8602802">,</span>&nbsp;<span class="ident" id="8602804"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602753">args</a></span><span class="op" id="8602808">...</span><span class="op" id="8602811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8602815">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8602818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602822">m</span>&nbsp;<span class="op" id="8602824">:=</span>&nbsp;<span class="ident" id="8602827"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5984648">newPhyMemory</a></span><span class="op" id="8602839">(</span><span class="ident" id="8602840"><a href="/lonnie.io/e8vm/arch8/page.go.html#5979836">PageSize</a></span>&nbsp;<span class="op" id="8602849">*</span>&nbsp;<span class="num" id="8602851">32</span><span class="op" id="8602853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602856">cpu</span>&nbsp;<span class="op" id="8602860">:=</span>&nbsp;<span class="ident" id="8602863"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961361">newCPU</a></span><span class="op" id="8602869">(</span><span class="ident" id="8602870"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602822">m</a></span><span class="op" id="8602871">,</span>&nbsp;<span class="ident" id="8602873"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602441">ti1</a></span><span class="op" id="8602876">(</span><span class="num" id="8602877">0</span><span class="op" id="8602878">)</span><span class="op" id="8602879">,</span>&nbsp;<span class="num" id="8602881">0</span><span class="op" id="8602882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602885">e</span>&nbsp;<span class="op" id="8602887">:=</span>&nbsp;<span class="ident" id="8602890"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8602893">.</span><span class="ident" id="8602894">Tick</span><span class="op" id="8602898">(</span><span class="op" id="8602899">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602902"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8602904">(</span><span class="ident" id="8602905"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8602907">==</span>&nbsp;<span class="ident" id="8602910"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966023">errHalt</a></span><span class="op" id="8602917">,</span>&nbsp;<span class="string" id="8602919">&#34;not&nbsp;halting&#34;</span><span class="op" id="8602932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602936"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8602939">.</span><span class="ident" id="8602940">Reset</span><span class="op" id="8602945">(</span><span class="op" id="8602946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602949"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602822">m</a></span><span class="op" id="8602950">.</span><span class="ident" id="8602951">WriteWord</span><span class="op" id="8602960">(</span><span class="ident" id="8602961"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961279">InitPC</a></span><span class="op" id="8602967">,</span>&nbsp;<span class="num" id="8602969">1</span><span class="op" id="8602970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602973"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8602975">=</span>&nbsp;<span class="ident" id="8602977"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8602980">.</span><span class="ident" id="8602981">Tick</span><span class="op" id="8602985">(</span><span class="op" id="8602986">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8602989"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8602991">(</span><span class="ident" id="8602992"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8602994">==</span>&nbsp;<span class="ident" id="8602997"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966067">errTimeInt</a></span><span class="op" id="8603007">,</span>&nbsp;<span class="string" id="8603009">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="8603029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603033"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603036">.</span><span class="ident" id="8603037">Reset</span><span class="op" id="8603042">(</span><span class="op" id="8603043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603046"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603049">.</span><span class="ident" id="8603050">interrupt</span><span class="op" id="8603059">.</span><span class="ident" id="8603060">Enable</span><span class="op" id="8603066">(</span><span class="op" id="8603067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603070"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603073">.</span><span class="ident" id="8603074">interrupt</span><span class="op" id="8603083">.</span><span class="ident" id="8603084">EnableInt</span><span class="op" id="8603093">(</span><span class="ident" id="8603094"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966067">errTimeInt</a></span><span class="op" id="8603104">.</span><span class="ident" id="8603105">Code</span><span class="op" id="8603109">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603112"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603115">.</span><span class="ident" id="8603116">interrupt</span><span class="op" id="8603125">.</span><span class="ident" id="8603126">writeWord</span><span class="op" id="8603135">(</span><span class="ident" id="8603136"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5972924">intKernelSP</a></span><span class="op" id="8603147">,</span>&nbsp;<span class="num" id="8603149">0x10000</span><span class="op" id="8603156">)</span>&nbsp;&nbsp;<span class="comment" id="8603159">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603171"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603174">.</span><span class="ident" id="8603175">interrupt</span><span class="op" id="8603184">.</span><span class="ident" id="8603185">writeWord</span><span class="op" id="8603194">(</span><span class="ident" id="8603195"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5972989">intHandlerPC</a></span><span class="op" id="8603207">,</span>&nbsp;<span class="num" id="8603209">0x10000</span><span class="op" id="8603216">)</span>&nbsp;<span class="comment" id="8603218">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603230"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603233">.</span><span class="ident" id="8603234">ring</span>&nbsp;<span class="op" id="8603239">=</span>&nbsp;<span class="num" id="8603241">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603245"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603247">=</span>&nbsp;<span class="ident" id="8603249"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603252">.</span><span class="ident" id="8603253">Tick</span><span class="op" id="8603257">(</span><span class="op" id="8603258">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603261"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603263">(</span><span class="ident" id="8603264"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603266">==</span>&nbsp;<span class="ident" id="8603269">nil</span><span class="op" id="8603272">,</span>&nbsp;<span class="string" id="8603274">&#34;should&nbsp;have&nbsp;no&nbsp;error&#34;</span><span class="op" id="8603296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603299"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603301">(</span><span class="ident" id="8603302"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603305">.</span><span class="ident" id="8603306">regs</span><span class="op" id="8603310">[</span><span class="ident" id="8603311"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="8603313">]</span>&nbsp;<span class="op" id="8603315">==</span>&nbsp;<span class="num" id="8603318">0x10000</span><span class="op" id="8603325">,</span>&nbsp;<span class="string" id="8603327">&#34;pc&nbsp;incorrect&#34;</span><span class="op" id="8603341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603344"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603346">(</span><span class="ident" id="8603347"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603350">.</span><span class="ident" id="8603351">regs</span><span class="op" id="8603355">[</span><span class="ident" id="8603356"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986835">SP</a></span><span class="op" id="8603358">]</span>&nbsp;<span class="op" id="8603360">==</span>&nbsp;<span class="num" id="8603363">0x10000</span><span class="op" id="8603370">,</span>&nbsp;<span class="string" id="8603372">&#34;sp&nbsp;incorrect&#34;</span><span class="op" id="8603386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603389"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603391">(</span><span class="ident" id="8603392"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603395">.</span><span class="ident" id="8603396">regs</span><span class="op" id="8603400">[</span><span class="ident" id="8603401"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986844">RET</a></span><span class="op" id="8603404">]</span>&nbsp;<span class="op" id="8603406">==</span>&nbsp;<span class="num" id="8603409">0x8000</span><span class="op" id="8603415">,</span>&nbsp;<span class="string" id="8603417">&#34;ret&nbsp;incorrect&#34;</span><span class="op" id="8603432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603435"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603437">(</span><span class="op" id="8603438">!</span><span class="ident" id="8603439"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603442">.</span><span class="ident" id="8603443">UserMode</span><span class="op" id="8603451">(</span><span class="op" id="8603452">)</span><span class="op" id="8603453">,</span>&nbsp;<span class="string" id="8603455">&#34;not&nbsp;in&nbsp;kernel&#34;</span><span class="op" id="8603470">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603473">b</span><span class="op" id="8603474">,</span>&nbsp;<span class="ident" id="8603476"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603478">:=</span>&nbsp;<span class="ident" id="8603481"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602822">m</a></span><span class="op" id="8603482">.</span><span class="ident" id="8603483">ReadByte</span><span class="op" id="8603491">(</span><span class="num" id="8603492">0x10000</span>&nbsp;<span class="op" id="8603500">-</span>&nbsp;<span class="ident" id="8603502"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962542">intFrameSize</a></span>&nbsp;<span class="op" id="8603515">+</span>&nbsp;<span class="ident" id="8603517"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962503">intFrameCode</a></span><span class="op" id="8603529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603532"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603534">(</span><span class="ident" id="8603535"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603537">==</span>&nbsp;<span class="ident" id="8603540">nil</span><span class="op" id="8603543">,</span>&nbsp;<span class="string" id="8603545">&#34;read&nbsp;byte&nbsp;error&#34;</span><span class="op" id="8603562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603565"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603567">(</span><span class="ident" id="8603568"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8603473">b</a></span>&nbsp;<span class="op" id="8603570">==</span>&nbsp;<span class="ident" id="8603573"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966067">errTimeInt</a></span><span class="op" id="8603583">.</span><span class="ident" id="8603584">Code</span><span class="op" id="8603588">,</span>&nbsp;<span class="string" id="8603590">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="8603610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603613"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8603473">b</a></span><span class="op" id="8603614">,</span>&nbsp;<span class="ident" id="8603616"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603618">=</span>&nbsp;<span class="ident" id="8603620"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602822">m</a></span><span class="op" id="8603621">.</span><span class="ident" id="8603622">ReadByte</span><span class="op" id="8603630">(</span><span class="num" id="8603631">0x10000</span>&nbsp;<span class="op" id="8603639">-</span>&nbsp;<span class="ident" id="8603641"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962542">intFrameSize</a></span>&nbsp;<span class="op" id="8603654">+</span>&nbsp;<span class="ident" id="8603656"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962522">intFrameRing</a></span><span class="op" id="8603668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603671"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603673">(</span><span class="ident" id="8603674"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8603473">b</a></span>&nbsp;<span class="op" id="8603676">==</span>&nbsp;<span class="num" id="8603679">1</span><span class="op" id="8603680">,</span>&nbsp;<span class="string" id="8603682">&#34;was&nbsp;not&nbsp;in&nbsp;user&#34;</span><span class="op" id="8603699">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603702"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603704">(</span><span class="op" id="8603705">!</span><span class="ident" id="8603706"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603709">.</span><span class="ident" id="8603710">interrupt</span><span class="op" id="8603719">.</span><span class="ident" id="8603720">Enabled</span><span class="op" id="8603727">(</span><span class="op" id="8603728">)</span><span class="op" id="8603729">,</span>&nbsp;<span class="string" id="8603731">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="8603755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603759"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603761">=</span>&nbsp;<span class="ident" id="8603763"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603766">.</span><span class="ident" id="8603767">Tick</span><span class="op" id="8603771">(</span><span class="op" id="8603772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603775"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603777">(</span><span class="ident" id="8603778"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603780">==</span>&nbsp;<span class="ident" id="8603783"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966023">errHalt</a></span><span class="op" id="8603790">,</span>&nbsp;<span class="string" id="8603792">&#34;should&nbsp;halt&nbsp;now&#34;</span><span class="op" id="8603809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603813"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603816">.</span><span class="ident" id="8603817">Reset</span><span class="op" id="8603822">(</span><span class="op" id="8603823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603826"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603829">.</span><span class="ident" id="8603830">interrupt</span><span class="op" id="8603839">.</span><span class="ident" id="8603840">Enable</span><span class="op" id="8603846">(</span><span class="op" id="8603847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603850"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603853">.</span><span class="ident" id="8603854">ring</span>&nbsp;<span class="op" id="8603859">=</span>&nbsp;<span class="num" id="8603861">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603864"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602822">m</a></span><span class="op" id="8603865">.</span><span class="ident" id="8603866">WriteWord</span><span class="op" id="8603875">(</span><span class="num" id="8603876">0x10000</span><span class="op" id="8603883">,</span>&nbsp;<span class="num" id="8603885">2</span><span class="op" id="8603886">)</span>&nbsp;<span class="comment" id="8603888">//&nbsp;write&nbsp;an&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603906"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603908">=</span>&nbsp;<span class="ident" id="8603910"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603913">.</span><span class="ident" id="8603914">Tick</span><span class="op" id="8603918">(</span><span class="op" id="8603919">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603922"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603924">(</span><span class="ident" id="8603925"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8603927">==</span>&nbsp;<span class="ident" id="8603930">nil</span><span class="op" id="8603933">,</span>&nbsp;<span class="string" id="8603935">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8603957">,</span>&nbsp;<span class="ident" id="8603959"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span><span class="op" id="8603960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8603963"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8603965">(</span><span class="op" id="8603966">!</span><span class="ident" id="8603967"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8603970">.</span><span class="ident" id="8603971">interrupt</span><span class="op" id="8603980">.</span><span class="ident" id="8603981">Enabled</span><span class="op" id="8603988">(</span><span class="op" id="8603989">)</span><span class="op" id="8603990">,</span>&nbsp;<span class="string" id="8603992">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="8604016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604019"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8604021">=</span>&nbsp;<span class="ident" id="8604023"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8604026">.</span><span class="ident" id="8604027">Tick</span><span class="op" id="8604031">(</span><span class="op" id="8604032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604035"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8604037">(</span><span class="ident" id="8604038"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span>&nbsp;<span class="op" id="8604040">==</span>&nbsp;<span class="ident" id="8604043">nil</span><span class="op" id="8604046">,</span>&nbsp;<span class="string" id="8604048">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8604070">,</span>&nbsp;<span class="ident" id="8604072"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602885">e</a></span><span class="op" id="8604073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604076"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8604078">(</span><span class="ident" id="8604079"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8604082">.</span><span class="ident" id="8604083">regs</span><span class="op" id="8604087">[</span><span class="ident" id="8604088"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="8604090">]</span>&nbsp;<span class="op" id="8604092">==</span>&nbsp;<span class="num" id="8604095">0x8000</span><span class="op" id="8604101">,</span>&nbsp;<span class="string" id="8604103">&#34;pc&nbsp;not&nbsp;iret&#39;ed&#34;</span><span class="op" id="8604119">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604122"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8604124">(</span><span class="ident" id="8604125"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8604128">.</span><span class="ident" id="8604129">regs</span><span class="op" id="8604133">[</span><span class="ident" id="8604134"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986835">SP</a></span><span class="op" id="8604136">]</span>&nbsp;<span class="op" id="8604138">==</span>&nbsp;<span class="num" id="8604141">0</span><span class="op" id="8604142">,</span>&nbsp;<span class="string" id="8604144">&#34;sp&nbsp;not&nbsp;restored&#34;</span><span class="op" id="8604161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604164"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8604166">(</span><span class="ident" id="8604167"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8604170">.</span><span class="ident" id="8604171">ring</span>&nbsp;<span class="op" id="8604176">==</span>&nbsp;<span class="num" id="8604179">1</span><span class="op" id="8604180">,</span>&nbsp;<span class="string" id="8604182">&#34;ring&nbsp;not&nbsp;restored&#34;</span><span class="op" id="8604201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604204"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8604206">(</span><span class="ident" id="8604207"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8604210">.</span><span class="ident" id="8604211">interrupt</span><span class="op" id="8604220">.</span><span class="ident" id="8604221">Enabled</span><span class="op" id="8604228">(</span><span class="op" id="8604229">)</span><span class="op" id="8604230">,</span>&nbsp;<span class="string" id="8604232">&#34;interrupt&nbsp;not&nbsp;enabled&nbsp;again&#34;</span><span class="op" id="8604261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604264">has</span><span class="op" id="8604267">,</span>&nbsp;<span class="ident" id="8604269">code</span>&nbsp;<span class="op" id="8604274">:=</span>&nbsp;<span class="ident" id="8604277"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602856">cpu</a></span><span class="op" id="8604280">.</span><span class="ident" id="8604281">interrupt</span><span class="op" id="8604290">.</span><span class="ident" id="8604291">Poll</span><span class="op" id="8604295">(</span><span class="op" id="8604296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8604299"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8602721">as</a></span><span class="op" id="8604301">(</span><span class="op" id="8604302">!</span><span class="ident" id="8604303"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8604264">has</a></span>&nbsp;<span class="op" id="8604307">&amp;&amp;</span>&nbsp;<span class="ident" id="8604310"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#8604269">code</a></span>&nbsp;<span class="op" id="8604315">==</span>&nbsp;<span class="num" id="8604318">0</span><span class="op" id="8604319">,</span>&nbsp;<span class="string" id="8604321">&#34;interrupt&nbsp;was&nbsp;not&nbsp;cleared&#34;</span><span class="op" id="8604348">)</span><br>
<span class="lineno">80</span><span class="op" id="8604350">}</span>
</div>
</body>
</html>
