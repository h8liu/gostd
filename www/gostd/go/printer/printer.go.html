<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5991794">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5991849">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5991903">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5991954">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5992007">package</span>&nbsp;<span class="ident" id="5992015">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5992024">import</span>&nbsp;<span class="op" id="5992031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992034">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992041">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992051">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992063">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992069">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992075">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992086">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992097">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992115">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5992125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5992128">const</span>&nbsp;<span class="op" id="5992134">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992137">maxNewlines</span>&nbsp;<span class="op" id="5992149">=</span>&nbsp;<span class="num" id="5992151">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992157">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992205">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992217">=</span>&nbsp;<span class="builtintype" id="5992219">false</span>&nbsp;<span class="comment" id="5992225">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992250">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992262">=</span>&nbsp;<span class="num" id="5992264">1</span>&nbsp;<span class="op" id="5992266">&lt;&lt;</span>&nbsp;<span class="num" id="5992269">30</span><br>
<span class="lineno"></span><span class="op" id="5992272">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5992275">type</span>&nbsp;<span class="ident" id="5992280">whiteSpace</span>&nbsp;<span class="builtintype" id="5992291">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5992297">const</span>&nbsp;<span class="op" id="5992303">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992306">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5992315">=</span>&nbsp;<span class="ident" id="5992317">whiteSpace</span><span class="op" id="5992327">(</span><span class="num" id="5992328">0</span><span class="op" id="5992329">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992332">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992341">=</span>&nbsp;<span class="ident" id="5992343">whiteSpace</span><span class="op" id="5992353">(</span><span class="string" id="5992354">&#39;&nbsp;&#39;</span><span class="op" id="5992357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992360">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992369">=</span>&nbsp;<span class="ident" id="5992371">whiteSpace</span><span class="op" id="5992381">(</span><span class="string" id="5992382">&#39;\v&#39;</span><span class="op" id="5992386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992389">newline</span>&nbsp;&nbsp;<span class="op" id="5992398">=</span>&nbsp;<span class="ident" id="5992400">whiteSpace</span><span class="op" id="5992410">(</span><span class="string" id="5992411">&#39;\n&#39;</span><span class="op" id="5992415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992418">formfeed</span>&nbsp;<span class="op" id="5992427">=</span>&nbsp;<span class="ident" id="5992429">whiteSpace</span><span class="op" id="5992439">(</span><span class="string" id="5992440">&#39;\f&#39;</span><span class="op" id="5992444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992447">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5992456">=</span>&nbsp;<span class="ident" id="5992458">whiteSpace</span><span class="op" id="5992468">(</span><span class="string" id="5992469">&#39;&gt;&#39;</span><span class="op" id="5992472">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992475">unindent</span>&nbsp;<span class="op" id="5992484">=</span>&nbsp;<span class="ident" id="5992486">whiteSpace</span><span class="op" id="5992496">(</span><span class="string" id="5992497">&#39;&lt;&#39;</span><span class="op" id="5992500">)</span><br>
<span class="lineno"></span><span class="op" id="5992502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992505">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5992559">type</span>&nbsp;<span class="ident" id="5992564">pmode</span>&nbsp;<span class="builtintype" id="5992570">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5992575">const</span>&nbsp;<span class="op" id="5992581">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992584">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992601">pmode</span>&nbsp;<span class="op" id="5992607">=</span>&nbsp;<span class="num" id="5992609">1</span>&nbsp;<span class="op" id="5992611">&lt;&lt;</span>&nbsp;<span class="ident" id="5992614">iota</span>&nbsp;<span class="comment" id="5992619">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992667">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992702">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5992754">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5992757">type</span>&nbsp;<span class="ident" id="5992762">commentInfo</span>&nbsp;<span class="keyword" id="5992774">struct</span>&nbsp;<span class="op" id="5992781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992784">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5992799">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992817">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992843">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5992858">*</span><span class="ident" id="5992859">ast</span><span class="op" id="5992862">.</span><span class="ident" id="5992863">CommentGroup</span>&nbsp;<span class="comment" id="5992876">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992915">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5992930">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992948">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993029">commentNewline</span>&nbsp;<span class="builtintype" id="5993044">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993062">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5993109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5993112">type</span>&nbsp;<span class="ident" id="5993117">printer</span>&nbsp;<span class="keyword" id="5993125">struct</span>&nbsp;<span class="op" id="5993132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993135">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993192">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993200">fset</span>&nbsp;<span class="op" id="5993205">*</span><span class="ident" id="5993206">token</span><span class="op" id="5993211">.</span><span class="ident" id="5993212">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993222">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993240">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993252">[</span><span class="op" id="5993253">]</span><span class="builtintype" id="5993254">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993265">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993288">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5993300">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993313">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993337">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993349">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993362">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993387">impliedSemi</span>&nbsp;<span class="builtintype" id="5993399">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993412">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993456">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993468">token</span><span class="op" id="5993473">.</span><span class="ident" id="5993474">Token</span>&nbsp;&nbsp;<span class="comment" id="5993481">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993539">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5993551">token</span><span class="op" id="5993556">.</span><span class="ident" id="5993557">Token</span>&nbsp;&nbsp;<span class="comment" id="5993564">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993623">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993635">[</span><span class="op" id="5993636">]</span><span class="ident" id="5993637">whiteSpace</span>&nbsp;<span class="comment" id="5993648">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993673">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993687">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993754">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993822">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993888">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993954">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993998">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994006">token</span><span class="op" id="5994011">.</span><span class="ident" id="5994012">Position</span>&nbsp;<span class="comment" id="5994021">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994064">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994072">token</span><span class="op" id="5994077">.</span><span class="ident" id="5994078">Position</span>&nbsp;<span class="comment" id="5994087">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994124">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5994132">token</span><span class="op" id="5994137">.</span><span class="ident" id="5994138">Position</span>&nbsp;<span class="comment" id="5994147">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994190">linePtr</span>&nbsp;<span class="op" id="5994198">*</span><span class="builtintype" id="5994199">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5994213">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994273">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994334">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994350">[</span><span class="op" id="5994351">]</span><span class="op" id="5994352">*</span><span class="ident" id="5994353">ast</span><span class="op" id="5994356">.</span><span class="ident" id="5994357">CommentGroup</span>&nbsp;<span class="comment" id="5994370">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994385">useNodeComments</span>&nbsp;<span class="builtintype" id="5994401">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5994421">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994477">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994544">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994558">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994600">nodeSizes</span>&nbsp;<span class="keyword" id="5994610">map</span><span class="op" id="5994613">[</span><span class="ident" id="5994614">ast</span><span class="op" id="5994617">.</span><span class="ident" id="5994618">Node</span><span class="op" id="5994622">]</span><span class="builtintype" id="5994623">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994629">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994680">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5994691">token</span><span class="op" id="5994696">.</span><span class="ident" id="5994697">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994702">cachedLine</span>&nbsp;<span class="builtintype" id="5994713">int</span>&nbsp;<span class="comment" id="5994717">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5994752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5994755">func</span>&nbsp;<span class="op" id="5994760">(</span><span class="ident" id="5994761">p</span>&nbsp;<span class="op" id="5994763">*</span><span class="ident" id="5994764">printer</span><span class="op" id="5994771">)</span>&nbsp;<span class="ident" id="5994773">init</span><span class="op" id="5994777">(</span><span class="ident" id="5994778">cfg</span>&nbsp;<span class="op" id="5994782">*</span><span class="ident" id="5994783">Config</span><span class="op" id="5994789">,</span>&nbsp;<span class="ident" id="5994791">fset</span>&nbsp;<span class="op" id="5994796">*</span><span class="ident" id="5994797">token</span><span class="op" id="5994802">.</span><span class="ident" id="5994803">FileSet</span><span class="op" id="5994810">,</span>&nbsp;<span class="ident" id="5994812">nodeSizes</span>&nbsp;<span class="keyword" id="5994822">map</span><span class="op" id="5994825">[</span><span class="ident" id="5994826">ast</span><span class="op" id="5994829">.</span><span class="ident" id="5994830">Node</span><span class="op" id="5994834">]</span><span class="builtintype" id="5994835">int</span><span class="op" id="5994838">)</span>&nbsp;<span class="op" id="5994840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994843">p</span><span class="op" id="5994844">.</span><span class="ident" id="5994845">Config</span>&nbsp;<span class="op" id="5994852">=</span>&nbsp;<span class="op" id="5994854">*</span><span class="ident" id="5994855">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994860">p</span><span class="op" id="5994861">.</span><span class="ident" id="5994862">fset</span>&nbsp;<span class="op" id="5994867">=</span>&nbsp;<span class="ident" id="5994869">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994875">p</span><span class="op" id="5994876">.</span><span class="ident" id="5994877">pos</span>&nbsp;<span class="op" id="5994881">=</span>&nbsp;<span class="ident" id="5994883">token</span><span class="op" id="5994888">.</span><span class="ident" id="5994889">Position</span><span class="op" id="5994897">{</span><span class="ident" id="5994898">Line</span><span class="op" id="5994902">:</span>&nbsp;<span class="num" id="5994904">1</span><span class="op" id="5994905">,</span>&nbsp;<span class="ident" id="5994907">Column</span><span class="op" id="5994913">:</span>&nbsp;<span class="num" id="5994915">1</span><span class="op" id="5994916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994919">p</span><span class="op" id="5994920">.</span><span class="ident" id="5994921">out</span>&nbsp;<span class="op" id="5994925">=</span>&nbsp;<span class="ident" id="5994927">token</span><span class="op" id="5994932">.</span><span class="ident" id="5994933">Position</span><span class="op" id="5994941">{</span><span class="ident" id="5994942">Line</span><span class="op" id="5994946">:</span>&nbsp;<span class="num" id="5994948">1</span><span class="op" id="5994949">,</span>&nbsp;<span class="ident" id="5994951">Column</span><span class="op" id="5994957">:</span>&nbsp;<span class="num" id="5994959">1</span><span class="op" id="5994960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994963">p</span><span class="op" id="5994964">.</span><span class="ident" id="5994965">wsbuf</span>&nbsp;<span class="op" id="5994971">=</span>&nbsp;<span class="builtinfunc" id="5994973">make</span><span class="op" id="5994977">(</span><span class="op" id="5994978">[</span><span class="op" id="5994979">]</span><span class="ident" id="5994980">whiteSpace</span><span class="op" id="5994990">,</span>&nbsp;<span class="num" id="5994992">0</span><span class="op" id="5994993">,</span>&nbsp;<span class="num" id="5994995">16</span><span class="op" id="5994997">)</span>&nbsp;<span class="comment" id="5994999">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995034">p</span><span class="op" id="5995035">.</span><span class="ident" id="5995036">nodeSizes</span>&nbsp;<span class="op" id="5995046">=</span>&nbsp;<span class="ident" id="5995048">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995059">p</span><span class="op" id="5995060">.</span><span class="ident" id="5995061">cachedPos</span>&nbsp;<span class="op" id="5995071">=</span>&nbsp;<span class="op" id="5995073">-</span><span class="num" id="5995074">1</span><br>
<span class="lineno"></span><span class="op" id="5995076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5995079">func</span>&nbsp;<span class="op" id="5995084">(</span><span class="ident" id="5995085">p</span>&nbsp;<span class="op" id="5995087">*</span><span class="ident" id="5995088">printer</span><span class="op" id="5995095">)</span>&nbsp;<span class="ident" id="5995097">internalError</span><span class="op" id="5995110">(</span><span class="ident" id="5995111">msg</span>&nbsp;<span class="op" id="5995115">...</span><span class="keyword" id="5995118">interface</span><span class="op" id="5995127">{</span><span class="op" id="5995128">}</span><span class="op" id="5995129">)</span>&nbsp;<span class="op" id="5995131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995134">if</span>&nbsp;<span class="ident" id="5995137">debug</span>&nbsp;<span class="op" id="5995143">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995147">fmt</span><span class="op" id="5995150">.</span><span class="ident" id="5995151">Print</span><span class="op" id="5995156">(</span><span class="ident" id="5995157">p</span><span class="op" id="5995158">.</span><span class="ident" id="5995159">pos</span><span class="op" id="5995162">.</span><span class="ident" id="5995163">String</span><span class="op" id="5995169">(</span><span class="op" id="5995170">)</span>&nbsp;<span class="op" id="5995172">+</span>&nbsp;<span class="string" id="5995174">&#34;:&nbsp;&#34;</span><span class="op" id="5995178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995182">fmt</span><span class="op" id="5995185">.</span><span class="ident" id="5995186">Println</span><span class="op" id="5995193">(</span><span class="ident" id="5995194">msg</span><span class="op" id="5995197">...</span><span class="op" id="5995200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5995204">panic</span><span class="op" id="5995209">(</span><span class="string" id="5995210">&#34;go/printer&#34;</span><span class="op" id="5995222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995225">}</span><br>
<span class="lineno"></span><span class="op" id="5995227">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5995230">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5995301">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5995377">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5995450">func</span>&nbsp;<span class="op" id="5995455">(</span><span class="ident" id="5995456">p</span>&nbsp;<span class="op" id="5995458">*</span><span class="ident" id="5995459">printer</span><span class="op" id="5995466">)</span>&nbsp;<span class="ident" id="5995468">commentsHaveNewline</span><span class="op" id="5995487">(</span><span class="ident" id="5995488">list</span>&nbsp;<span class="op" id="5995493">[</span><span class="op" id="5995494">]</span><span class="op" id="5995495">*</span><span class="ident" id="5995496">ast</span><span class="op" id="5995499">.</span><span class="ident" id="5995500">Comment</span><span class="op" id="5995507">)</span>&nbsp;<span class="builtintype" id="5995509">bool</span>&nbsp;<span class="op" id="5995514">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995517">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995535">line</span>&nbsp;<span class="op" id="5995540">:=</span>&nbsp;<span class="ident" id="5995543">p</span><span class="op" id="5995544">.</span><span class="ident" id="5995545">lineFor</span><span class="op" id="5995552">(</span><span class="ident" id="5995553">list</span><span class="op" id="5995557">[</span><span class="num" id="5995558">0</span><span class="op" id="5995559">]</span><span class="op" id="5995560">.</span><span class="ident" id="5995561">Pos</span><span class="op" id="5995564">(</span><span class="op" id="5995565">)</span><span class="op" id="5995566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995569">for</span>&nbsp;<span class="ident" id="5995573">i</span><span class="op" id="5995574">,</span>&nbsp;<span class="ident" id="5995576">c</span>&nbsp;<span class="op" id="5995578">:=</span>&nbsp;<span class="keyword" id="5995581">range</span>&nbsp;<span class="ident" id="5995587">list</span>&nbsp;<span class="op" id="5995592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995596">if</span>&nbsp;<span class="ident" id="5995599">i</span>&nbsp;<span class="op" id="5995601">&gt;</span>&nbsp;<span class="num" id="5995603">0</span>&nbsp;<span class="op" id="5995605">&amp;&amp;</span>&nbsp;<span class="ident" id="5995608">p</span><span class="op" id="5995609">.</span><span class="ident" id="5995610">lineFor</span><span class="op" id="5995617">(</span><span class="ident" id="5995618">list</span><span class="op" id="5995622">[</span><span class="ident" id="5995623">i</span><span class="op" id="5995624">]</span><span class="op" id="5995625">.</span><span class="ident" id="5995626">Pos</span><span class="op" id="5995629">(</span><span class="op" id="5995630">)</span><span class="op" id="5995631">)</span>&nbsp;<span class="op" id="5995633">!=</span>&nbsp;<span class="ident" id="5995636">line</span>&nbsp;<span class="op" id="5995641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995646">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995686">return</span>&nbsp;<span class="builtintype" id="5995693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995704">if</span>&nbsp;<span class="ident" id="5995707">t</span>&nbsp;<span class="op" id="5995709">:=</span>&nbsp;<span class="ident" id="5995712">c</span><span class="op" id="5995713">.</span><span class="ident" id="5995714">Text</span><span class="op" id="5995718">;</span>&nbsp;<span class="builtinfunc" id="5995720">len</span><span class="op" id="5995723">(</span><span class="ident" id="5995724">t</span><span class="op" id="5995725">)</span>&nbsp;<span class="op" id="5995727">&gt;=</span>&nbsp;<span class="num" id="5995730">2</span>&nbsp;<span class="op" id="5995732">&amp;&amp;</span>&nbsp;<span class="op" id="5995735">(</span><span class="ident" id="5995736">t</span><span class="op" id="5995737">[</span><span class="num" id="5995738">1</span><span class="op" id="5995739">]</span>&nbsp;<span class="op" id="5995741">==</span>&nbsp;<span class="string" id="5995744">&#39;/&#39;</span>&nbsp;<span class="op" id="5995748">||</span>&nbsp;<span class="ident" id="5995751">strings</span><span class="op" id="5995758">.</span><span class="ident" id="5995759">Contains</span><span class="op" id="5995767">(</span><span class="ident" id="5995768">t</span><span class="op" id="5995769">,</span>&nbsp;<span class="string" id="5995771">&#34;\n&#34;</span><span class="op" id="5995775">)</span><span class="op" id="5995776">)</span>&nbsp;<span class="op" id="5995778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995783">return</span>&nbsp;<span class="builtintype" id="5995790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995797">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995803">_</span>&nbsp;<span class="op" id="5995805">=</span>&nbsp;<span class="ident" id="5995807">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995813">return</span>&nbsp;<span class="builtintype" id="5995820">false</span><br>
<span class="lineno"></span><span class="op" id="5995826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5995829">func</span>&nbsp;<span class="op" id="5995834">(</span><span class="ident" id="5995835">p</span>&nbsp;<span class="op" id="5995837">*</span><span class="ident" id="5995838">printer</span><span class="op" id="5995845">)</span>&nbsp;<span class="ident" id="5995847">nextComment</span><span class="op" id="5995858">(</span><span class="op" id="5995859">)</span>&nbsp;<span class="op" id="5995861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995864">for</span>&nbsp;<span class="ident" id="5995868">p</span><span class="op" id="5995869">.</span><span class="ident" id="5995870">cindex</span>&nbsp;<span class="op" id="5995877">&lt;</span>&nbsp;<span class="builtinfunc" id="5995879">len</span><span class="op" id="5995882">(</span><span class="ident" id="5995883">p</span><span class="op" id="5995884">.</span><span class="ident" id="5995885">comments</span><span class="op" id="5995893">)</span>&nbsp;<span class="op" id="5995895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995899">c</span>&nbsp;<span class="op" id="5995901">:=</span>&nbsp;<span class="ident" id="5995904">p</span><span class="op" id="5995905">.</span><span class="ident" id="5995906">comments</span><span class="op" id="5995914">[</span><span class="ident" id="5995915">p</span><span class="op" id="5995916">.</span><span class="ident" id="5995917">cindex</span><span class="op" id="5995923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995927">p</span><span class="op" id="5995928">.</span><span class="ident" id="5995929">cindex</span><span class="op" id="5995935">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995940">if</span>&nbsp;<span class="ident" id="5995943">list</span>&nbsp;<span class="op" id="5995948">:=</span>&nbsp;<span class="ident" id="5995951">c</span><span class="op" id="5995952">.</span><span class="ident" id="5995953">List</span><span class="op" id="5995957">;</span>&nbsp;<span class="builtinfunc" id="5995959">len</span><span class="op" id="5995962">(</span><span class="ident" id="5995963">list</span><span class="op" id="5995967">)</span>&nbsp;<span class="op" id="5995969">&gt;</span>&nbsp;<span class="num" id="5995971">0</span>&nbsp;<span class="op" id="5995973">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995978">p</span><span class="op" id="5995979">.</span><span class="ident" id="5995980">comment</span>&nbsp;<span class="op" id="5995988">=</span>&nbsp;<span class="ident" id="5995990">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995995">p</span><span class="op" id="5995996">.</span><span class="ident" id="5995997">commentOffset</span>&nbsp;<span class="op" id="5996011">=</span>&nbsp;<span class="ident" id="5996013">p</span><span class="op" id="5996014">.</span><span class="ident" id="5996015">posFor</span><span class="op" id="5996021">(</span><span class="ident" id="5996022">list</span><span class="op" id="5996026">[</span><span class="num" id="5996027">0</span><span class="op" id="5996028">]</span><span class="op" id="5996029">.</span><span class="ident" id="5996030">Pos</span><span class="op" id="5996033">(</span><span class="op" id="5996034">)</span><span class="op" id="5996035">)</span><span class="op" id="5996036">.</span><span class="ident" id="5996037">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996047">p</span><span class="op" id="5996048">.</span><span class="ident" id="5996049">commentNewline</span>&nbsp;<span class="op" id="5996064">=</span>&nbsp;<span class="ident" id="5996066">p</span><span class="op" id="5996067">.</span><span class="ident" id="5996068">commentsHaveNewline</span><span class="op" id="5996087">(</span><span class="ident" id="5996088">list</span><span class="op" id="5996092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996106">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996110">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996171">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996237">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996258">p</span><span class="op" id="5996259">.</span><span class="ident" id="5996260">commentOffset</span>&nbsp;<span class="op" id="5996274">=</span>&nbsp;<span class="ident" id="5996276">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5996285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5996288">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5996355">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5996423">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5996461">//</span><br>
<span class="lineno"></span><span class="keyword" id="5996464">func</span>&nbsp;<span class="op" id="5996469">(</span><span class="ident" id="5996470">p</span>&nbsp;<span class="op" id="5996472">*</span><span class="ident" id="5996473">printer</span><span class="op" id="5996480">)</span>&nbsp;<span class="ident" id="5996482">commentBefore</span><span class="op" id="5996495">(</span><span class="ident" id="5996496">next</span>&nbsp;<span class="ident" id="5996501">token</span><span class="op" id="5996506">.</span><span class="ident" id="5996507">Position</span><span class="op" id="5996515">)</span>&nbsp;<span class="builtintype" id="5996517">bool</span>&nbsp;<span class="op" id="5996522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996525">return</span>&nbsp;<span class="ident" id="5996532">p</span><span class="op" id="5996533">.</span><span class="ident" id="5996534">commentOffset</span>&nbsp;<span class="op" id="5996548">&lt;</span>&nbsp;<span class="ident" id="5996550">next</span><span class="op" id="5996554">.</span><span class="ident" id="5996555">Offset</span>&nbsp;<span class="op" id="5996562">&amp;&amp;</span>&nbsp;<span class="op" id="5996565">(</span><span class="op" id="5996566">!</span><span class="ident" id="5996567">p</span><span class="op" id="5996568">.</span><span class="ident" id="5996569">impliedSemi</span>&nbsp;<span class="op" id="5996581">||</span>&nbsp;<span class="op" id="5996584">!</span><span class="ident" id="5996585">p</span><span class="op" id="5996586">.</span><span class="ident" id="5996587">commentNewline</span><span class="op" id="5996601">)</span><br>
<span class="lineno"></span><span class="op" id="5996603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5996606">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5996661">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5996716">//</span><br>
<span class="lineno"></span><span class="keyword" id="5996719">func</span>&nbsp;<span class="op" id="5996724">(</span><span class="ident" id="5996725">p</span>&nbsp;<span class="op" id="5996727">*</span><span class="ident" id="5996728">printer</span><span class="op" id="5996735">)</span>&nbsp;<span class="ident" id="5996737">commentSizeBefore</span><span class="op" id="5996754">(</span><span class="ident" id="5996755">next</span>&nbsp;<span class="ident" id="5996760">token</span><span class="op" id="5996765">.</span><span class="ident" id="5996766">Position</span><span class="op" id="5996774">)</span>&nbsp;<span class="builtintype" id="5996776">int</span>&nbsp;<span class="op" id="5996780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996783">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996852">defer</span>&nbsp;<span class="keyword" id="5996858">func</span><span class="op" id="5996862">(</span><span class="ident" id="5996863">info</span>&nbsp;<span class="ident" id="5996868">commentInfo</span><span class="op" id="5996879">)</span>&nbsp;<span class="op" id="5996881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996885">p</span><span class="op" id="5996886">.</span><span class="ident" id="5996887">commentInfo</span>&nbsp;<span class="op" id="5996899">=</span>&nbsp;<span class="ident" id="5996901">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996907">}</span><span class="op" id="5996908">(</span><span class="ident" id="5996909">p</span><span class="op" id="5996910">.</span><span class="ident" id="5996911">commentInfo</span><span class="op" id="5996922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996926">size</span>&nbsp;<span class="op" id="5996931">:=</span>&nbsp;<span class="num" id="5996934">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996937">for</span>&nbsp;<span class="ident" id="5996941">p</span><span class="op" id="5996942">.</span><span class="ident" id="5996943">commentBefore</span><span class="op" id="5996956">(</span><span class="ident" id="5996957">next</span><span class="op" id="5996961">)</span>&nbsp;<span class="op" id="5996963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996967">for</span>&nbsp;<span class="ident" id="5996971">_</span><span class="op" id="5996972">,</span>&nbsp;<span class="ident" id="5996974">c</span>&nbsp;<span class="op" id="5996976">:=</span>&nbsp;<span class="keyword" id="5996979">range</span>&nbsp;<span class="ident" id="5996985">p</span><span class="op" id="5996986">.</span><span class="ident" id="5996987">comment</span><span class="op" id="5996994">.</span><span class="ident" id="5996995">List</span>&nbsp;<span class="op" id="5997000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997005">size</span>&nbsp;<span class="op" id="5997010">+=</span>&nbsp;<span class="builtinfunc" id="5997013">len</span><span class="op" id="5997016">(</span><span class="ident" id="5997017">c</span><span class="op" id="5997018">.</span><span class="ident" id="5997019">Text</span><span class="op" id="5997023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997031">p</span><span class="op" id="5997032">.</span><span class="ident" id="5997033">nextComment</span><span class="op" id="5997044">(</span><span class="op" id="5997045">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997051">return</span>&nbsp;<span class="ident" id="5997058">size</span><br>
<span class="lineno"></span><span class="op" id="5997063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5997066">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5997139">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5997213">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5997289">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5997305">//</span><br>
<span class="lineno"></span><span class="keyword" id="5997308">func</span>&nbsp;<span class="op" id="5997313">(</span><span class="ident" id="5997314">p</span>&nbsp;<span class="op" id="5997316">*</span><span class="ident" id="5997317">printer</span><span class="op" id="5997324">)</span>&nbsp;<span class="ident" id="5997326">recordLine</span><span class="op" id="5997336">(</span><span class="ident" id="5997337">linePtr</span>&nbsp;<span class="op" id="5997345">*</span><span class="builtintype" id="5997346">int</span><span class="op" id="5997349">)</span>&nbsp;<span class="op" id="5997351">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997354">p</span><span class="op" id="5997355">.</span><span class="ident" id="5997356">linePtr</span>&nbsp;<span class="op" id="5997364">=</span>&nbsp;<span class="ident" id="5997366">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5997374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5997377">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5997445">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5997513">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5997583">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5997639">//</span><br>
<span class="lineno"></span><span class="keyword" id="5997642">func</span>&nbsp;<span class="op" id="5997647">(</span><span class="ident" id="5997648">p</span>&nbsp;<span class="op" id="5997650">*</span><span class="ident" id="5997651">printer</span><span class="op" id="5997658">)</span>&nbsp;<span class="ident" id="5997660">linesFrom</span><span class="op" id="5997669">(</span><span class="ident" id="5997670">line</span>&nbsp;<span class="builtintype" id="5997675">int</span><span class="op" id="5997678">)</span>&nbsp;<span class="builtintype" id="5997680">int</span>&nbsp;<span class="op" id="5997684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997687">return</span>&nbsp;<span class="ident" id="5997694">p</span><span class="op" id="5997695">.</span><span class="ident" id="5997696">out</span><span class="op" id="5997699">.</span><span class="ident" id="5997700">Line</span>&nbsp;<span class="op" id="5997705">-</span>&nbsp;<span class="ident" id="5997707">line</span><br>
<span class="lineno">190</span><span class="op" id="5997712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5997715">func</span>&nbsp;<span class="op" id="5997720">(</span><span class="ident" id="5997721">p</span>&nbsp;<span class="op" id="5997723">*</span><span class="ident" id="5997724">printer</span><span class="op" id="5997731">)</span>&nbsp;<span class="ident" id="5997733">posFor</span><span class="op" id="5997739">(</span><span class="ident" id="5997740">pos</span>&nbsp;<span class="ident" id="5997744">token</span><span class="op" id="5997749">.</span><span class="ident" id="5997750">Pos</span><span class="op" id="5997753">)</span>&nbsp;<span class="ident" id="5997755">token</span><span class="op" id="5997760">.</span><span class="ident" id="5997761">Position</span>&nbsp;<span class="op" id="5997770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997773">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997835">return</span>&nbsp;<span class="ident" id="5997842">p</span><span class="op" id="5997843">.</span><span class="ident" id="5997844">fset</span><span class="op" id="5997848">.</span><span class="ident" id="5997849">Position</span><span class="op" id="5997857">(</span><span class="ident" id="5997858">pos</span><span class="op" id="5997861">)</span><br>
<span class="lineno">195</span><span class="op" id="5997863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5997866">func</span>&nbsp;<span class="op" id="5997871">(</span><span class="ident" id="5997872">p</span>&nbsp;<span class="op" id="5997874">*</span><span class="ident" id="5997875">printer</span><span class="op" id="5997882">)</span>&nbsp;<span class="ident" id="5997884">lineFor</span><span class="op" id="5997891">(</span><span class="ident" id="5997892">pos</span>&nbsp;<span class="ident" id="5997896">token</span><span class="op" id="5997901">.</span><span class="ident" id="5997902">Pos</span><span class="op" id="5997905">)</span>&nbsp;<span class="builtintype" id="5997907">int</span>&nbsp;<span class="op" id="5997911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997914">if</span>&nbsp;<span class="ident" id="5997917">pos</span>&nbsp;<span class="op" id="5997921">!=</span>&nbsp;<span class="ident" id="5997924">p</span><span class="op" id="5997925">.</span><span class="ident" id="5997926">cachedPos</span>&nbsp;<span class="op" id="5997936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997940">p</span><span class="op" id="5997941">.</span><span class="ident" id="5997942">cachedPos</span>&nbsp;<span class="op" id="5997952">=</span>&nbsp;<span class="ident" id="5997954">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997960">p</span><span class="op" id="5997961">.</span><span class="ident" id="5997962">cachedLine</span>&nbsp;<span class="op" id="5997973">=</span>&nbsp;<span class="ident" id="5997975">p</span><span class="op" id="5997976">.</span><span class="ident" id="5997977">fset</span><span class="op" id="5997981">.</span><span class="ident" id="5997982">Position</span><span class="op" id="5997990">(</span><span class="ident" id="5997991">pos</span><span class="op" id="5997994">)</span><span class="op" id="5997995">.</span><span class="ident" id="5997996">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998005">return</span>&nbsp;<span class="ident" id="5998012">p</span><span class="op" id="5998013">.</span><span class="ident" id="5998014">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5998025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5998028">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5998103">func</span>&nbsp;<span class="op" id="5998108">(</span><span class="ident" id="5998109">p</span>&nbsp;<span class="op" id="5998111">*</span><span class="ident" id="5998112">printer</span><span class="op" id="5998119">)</span>&nbsp;<span class="ident" id="5998121">atLineBegin</span><span class="op" id="5998132">(</span><span class="ident" id="5998133">pos</span>&nbsp;<span class="ident" id="5998137">token</span><span class="op" id="5998142">.</span><span class="ident" id="5998143">Position</span><span class="op" id="5998151">)</span>&nbsp;<span class="op" id="5998153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998156">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998196">if</span>&nbsp;<span class="ident" id="5998199">p</span><span class="op" id="5998200">.</span><span class="ident" id="5998201">Config</span><span class="op" id="5998207">.</span><span class="ident" id="5998208">Mode</span><span class="op" id="5998212">&amp;</span><span class="ident" id="5998213">SourcePos</span>&nbsp;<span class="op" id="5998223">!=</span>&nbsp;<span class="num" id="5998226">0</span>&nbsp;<span class="op" id="5998228">&amp;&amp;</span>&nbsp;<span class="ident" id="5998231">pos</span><span class="op" id="5998234">.</span><span class="ident" id="5998235">IsValid</span><span class="op" id="5998242">(</span><span class="op" id="5998243">)</span>&nbsp;<span class="op" id="5998245">&amp;&amp;</span>&nbsp;<span class="op" id="5998248">(</span><span class="ident" id="5998249">p</span><span class="op" id="5998250">.</span><span class="ident" id="5998251">out</span><span class="op" id="5998254">.</span><span class="ident" id="5998255">Line</span>&nbsp;<span class="op" id="5998260">!=</span>&nbsp;<span class="ident" id="5998263">pos</span><span class="op" id="5998266">.</span><span class="ident" id="5998267">Line</span>&nbsp;<span class="op" id="5998272">||</span>&nbsp;<span class="ident" id="5998275">p</span><span class="op" id="5998276">.</span><span class="ident" id="5998277">out</span><span class="op" id="5998280">.</span><span class="ident" id="5998281">Filename</span>&nbsp;<span class="op" id="5998290">!=</span>&nbsp;<span class="ident" id="5998293">pos</span><span class="op" id="5998296">.</span><span class="ident" id="5998297">Filename</span><span class="op" id="5998305">)</span>&nbsp;<span class="op" id="5998307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998311">p</span><span class="op" id="5998312">.</span><span class="ident" id="5998313">output</span>&nbsp;<span class="op" id="5998320">=</span>&nbsp;<span class="builtinfunc" id="5998322">append</span><span class="op" id="5998328">(</span><span class="ident" id="5998329">p</span><span class="op" id="5998330">.</span><span class="ident" id="5998331">output</span><span class="op" id="5998337">,</span>&nbsp;<span class="ident" id="5998339">tabwriter</span><span class="op" id="5998348">.</span><span class="ident" id="5998349">Escape</span><span class="op" id="5998355">)</span>&nbsp;<span class="comment" id="5998357">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998415">p</span><span class="op" id="5998416">.</span><span class="ident" id="5998417">output</span>&nbsp;<span class="op" id="5998424">=</span>&nbsp;<span class="builtinfunc" id="5998426">append</span><span class="op" id="5998432">(</span><span class="ident" id="5998433">p</span><span class="op" id="5998434">.</span><span class="ident" id="5998435">output</span><span class="op" id="5998441">,</span>&nbsp;<span class="ident" id="5998443">fmt</span><span class="op" id="5998446">.</span><span class="ident" id="5998447">Sprintf</span><span class="op" id="5998454">(</span><span class="string" id="5998455">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5998471">,</span>&nbsp;<span class="ident" id="5998473">pos</span><span class="op" id="5998476">.</span><span class="ident" id="5998477">Filename</span><span class="op" id="5998485">,</span>&nbsp;<span class="ident" id="5998487">pos</span><span class="op" id="5998490">.</span><span class="ident" id="5998491">Line</span><span class="op" id="5998495">)</span><span class="op" id="5998496">...</span><span class="op" id="5998499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998503">p</span><span class="op" id="5998504">.</span><span class="ident" id="5998505">output</span>&nbsp;<span class="op" id="5998512">=</span>&nbsp;<span class="builtinfunc" id="5998514">append</span><span class="op" id="5998520">(</span><span class="ident" id="5998521">p</span><span class="op" id="5998522">.</span><span class="ident" id="5998523">output</span><span class="op" id="5998529">,</span>&nbsp;<span class="ident" id="5998531">tabwriter</span><span class="op" id="5998540">.</span><span class="ident" id="5998541">Escape</span><span class="op" id="5998547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998551">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998592">p</span><span class="op" id="5998593">.</span><span class="ident" id="5998594">out</span><span class="op" id="5998597">.</span><span class="ident" id="5998598">Filename</span>&nbsp;<span class="op" id="5998607">=</span>&nbsp;<span class="ident" id="5998609">pos</span><span class="op" id="5998612">.</span><span class="ident" id="5998613">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998624">p</span><span class="op" id="5998625">.</span><span class="ident" id="5998626">out</span><span class="op" id="5998629">.</span><span class="ident" id="5998630">Line</span>&nbsp;<span class="op" id="5998635">=</span>&nbsp;<span class="ident" id="5998637">pos</span><span class="op" id="5998640">.</span><span class="ident" id="5998641">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998651">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998673">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998716">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998759">n</span>&nbsp;<span class="op" id="5998761">:=</span>&nbsp;<span class="ident" id="5998764">p</span><span class="op" id="5998765">.</span><span class="ident" id="5998766">Config</span><span class="op" id="5998772">.</span><span class="ident" id="5998773">Indent</span>&nbsp;<span class="op" id="5998780">+</span>&nbsp;<span class="ident" id="5998782">p</span><span class="op" id="5998783">.</span><span class="ident" id="5998784">indent</span>&nbsp;<span class="comment" id="5998791">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998820">for</span>&nbsp;<span class="ident" id="5998824">i</span>&nbsp;<span class="op" id="5998826">:=</span>&nbsp;<span class="num" id="5998829">0</span><span class="op" id="5998830">;</span>&nbsp;<span class="ident" id="5998832">i</span>&nbsp;<span class="op" id="5998834">&lt;</span>&nbsp;<span class="ident" id="5998836">n</span><span class="op" id="5998837">;</span>&nbsp;<span class="ident" id="5998839">i</span><span class="op" id="5998840">++</span>&nbsp;<span class="op" id="5998843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998847">p</span><span class="op" id="5998848">.</span><span class="ident" id="5998849">output</span>&nbsp;<span class="op" id="5998856">=</span>&nbsp;<span class="builtinfunc" id="5998858">append</span><span class="op" id="5998864">(</span><span class="ident" id="5998865">p</span><span class="op" id="5998866">.</span><span class="ident" id="5998867">output</span><span class="op" id="5998873">,</span>&nbsp;<span class="string" id="5998875">&#39;\t&#39;</span><span class="op" id="5998879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998886">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998907">p</span><span class="op" id="5998908">.</span><span class="ident" id="5998909">pos</span><span class="op" id="5998912">.</span><span class="ident" id="5998913">Offset</span>&nbsp;<span class="op" id="5998920">+=</span>&nbsp;<span class="ident" id="5998923">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998926">p</span><span class="op" id="5998927">.</span><span class="ident" id="5998928">pos</span><span class="op" id="5998931">.</span><span class="ident" id="5998932">Column</span>&nbsp;<span class="op" id="5998939">+=</span>&nbsp;<span class="ident" id="5998942">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998945">p</span><span class="op" id="5998946">.</span><span class="ident" id="5998947">out</span><span class="op" id="5998950">.</span><span class="ident" id="5998951">Column</span>&nbsp;<span class="op" id="5998958">+=</span>&nbsp;<span class="ident" id="5998961">n</span><br>
<span class="lineno"></span><span class="op" id="5998963">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5998966">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5999028">func</span>&nbsp;<span class="op" id="5999033">(</span><span class="ident" id="5999034">p</span>&nbsp;<span class="op" id="5999036">*</span><span class="ident" id="5999037">printer</span><span class="op" id="5999044">)</span>&nbsp;<span class="ident" id="5999046">writeByte</span><span class="op" id="5999055">(</span><span class="ident" id="5999056">ch</span>&nbsp;<span class="builtintype" id="5999059">byte</span><span class="op" id="5999063">,</span>&nbsp;<span class="ident" id="5999065">n</span>&nbsp;<span class="builtintype" id="5999067">int</span><span class="op" id="5999070">)</span>&nbsp;<span class="op" id="5999072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999075">if</span>&nbsp;<span class="ident" id="5999078">p</span><span class="op" id="5999079">.</span><span class="ident" id="5999080">out</span><span class="op" id="5999083">.</span><span class="ident" id="5999084">Column</span>&nbsp;<span class="op" id="5999091">==</span>&nbsp;<span class="num" id="5999094">1</span>&nbsp;<span class="op" id="5999096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999100">p</span><span class="op" id="5999101">.</span><span class="ident" id="5999102">atLineBegin</span><span class="op" id="5999113">(</span><span class="ident" id="5999114">p</span><span class="op" id="5999115">.</span><span class="ident" id="5999116">pos</span><span class="op" id="5999119">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999126">for</span>&nbsp;<span class="ident" id="5999130">i</span>&nbsp;<span class="op" id="5999132">:=</span>&nbsp;<span class="num" id="5999135">0</span><span class="op" id="5999136">;</span>&nbsp;<span class="ident" id="5999138">i</span>&nbsp;<span class="op" id="5999140">&lt;</span>&nbsp;<span class="ident" id="5999142">n</span><span class="op" id="5999143">;</span>&nbsp;<span class="ident" id="5999145">i</span><span class="op" id="5999146">++</span>&nbsp;<span class="op" id="5999149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999153">p</span><span class="op" id="5999154">.</span><span class="ident" id="5999155">output</span>&nbsp;<span class="op" id="5999162">=</span>&nbsp;<span class="builtinfunc" id="5999164">append</span><span class="op" id="5999170">(</span><span class="ident" id="5999171">p</span><span class="op" id="5999172">.</span><span class="ident" id="5999173">output</span><span class="op" id="5999179">,</span>&nbsp;<span class="ident" id="5999181">ch</span><span class="op" id="5999183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999186">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999190">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999211">p</span><span class="op" id="5999212">.</span><span class="ident" id="5999213">pos</span><span class="op" id="5999216">.</span><span class="ident" id="5999217">Offset</span>&nbsp;<span class="op" id="5999224">+=</span>&nbsp;<span class="ident" id="5999227">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999230">if</span>&nbsp;<span class="ident" id="5999233">ch</span>&nbsp;<span class="op" id="5999236">==</span>&nbsp;<span class="string" id="5999239">&#39;\n&#39;</span>&nbsp;<span class="op" id="5999244">||</span>&nbsp;<span class="ident" id="5999247">ch</span>&nbsp;<span class="op" id="5999250">==</span>&nbsp;<span class="string" id="5999253">&#39;\f&#39;</span>&nbsp;<span class="op" id="5999258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999262">p</span><span class="op" id="5999263">.</span><span class="ident" id="5999264">pos</span><span class="op" id="5999267">.</span><span class="ident" id="5999268">Line</span>&nbsp;<span class="op" id="5999273">+=</span>&nbsp;<span class="ident" id="5999276">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999280">p</span><span class="op" id="5999281">.</span><span class="ident" id="5999282">out</span><span class="op" id="5999285">.</span><span class="ident" id="5999286">Line</span>&nbsp;<span class="op" id="5999291">+=</span>&nbsp;<span class="ident" id="5999294">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999298">p</span><span class="op" id="5999299">.</span><span class="ident" id="5999300">pos</span><span class="op" id="5999303">.</span><span class="ident" id="5999304">Column</span>&nbsp;<span class="op" id="5999311">=</span>&nbsp;<span class="num" id="5999313">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999317">p</span><span class="op" id="5999318">.</span><span class="ident" id="5999319">out</span><span class="op" id="5999322">.</span><span class="ident" id="5999323">Column</span>&nbsp;<span class="op" id="5999330">=</span>&nbsp;<span class="num" id="5999332">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999336">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999344">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999347">p</span><span class="op" id="5999348">.</span><span class="ident" id="5999349">pos</span><span class="op" id="5999352">.</span><span class="ident" id="5999353">Column</span>&nbsp;<span class="op" id="5999360">+=</span>&nbsp;<span class="ident" id="5999363">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999366">p</span><span class="op" id="5999367">.</span><span class="ident" id="5999368">out</span><span class="op" id="5999371">.</span><span class="ident" id="5999372">Column</span>&nbsp;<span class="op" id="5999379">+=</span>&nbsp;<span class="ident" id="5999382">n</span><br>
<span class="lineno"></span><span class="op" id="5999384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5999387">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5999460">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5999536">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5999593">//</span><br>
<span class="lineno"></span><span class="comment" id="5999596">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5999664">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5999737">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5999809">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5999885">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5999958">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5999993">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5999996">func</span>&nbsp;<span class="op" id="6000001">(</span><span class="ident" id="6000002">p</span>&nbsp;<span class="op" id="6000004">*</span><span class="ident" id="6000005">printer</span><span class="op" id="6000012">)</span>&nbsp;<span class="ident" id="6000014">writeString</span><span class="op" id="6000025">(</span><span class="ident" id="6000026">pos</span>&nbsp;<span class="ident" id="6000030">token</span><span class="op" id="6000035">.</span><span class="ident" id="6000036">Position</span><span class="op" id="6000044">,</span>&nbsp;<span class="ident" id="6000046">s</span>&nbsp;<span class="builtintype" id="6000048">string</span><span class="op" id="6000054">,</span>&nbsp;<span class="ident" id="6000056">isLit</span>&nbsp;<span class="builtintype" id="6000062">bool</span><span class="op" id="6000066">)</span>&nbsp;<span class="op" id="6000068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000071">if</span>&nbsp;<span class="ident" id="6000074">p</span><span class="op" id="6000075">.</span><span class="ident" id="6000076">out</span><span class="op" id="6000079">.</span><span class="ident" id="6000080">Column</span>&nbsp;<span class="op" id="6000087">==</span>&nbsp;<span class="num" id="6000090">1</span>&nbsp;<span class="op" id="6000092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000096">p</span><span class="op" id="6000097">.</span><span class="ident" id="6000098">atLineBegin</span><span class="op" id="6000109">(</span><span class="ident" id="6000110">pos</span><span class="op" id="6000113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000120">if</span>&nbsp;<span class="ident" id="6000123">pos</span><span class="op" id="6000126">.</span><span class="ident" id="6000127">IsValid</span><span class="op" id="6000134">(</span><span class="op" id="6000135">)</span>&nbsp;<span class="op" id="6000137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000141">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000209">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000272">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000337">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000364">p</span><span class="op" id="6000365">.</span><span class="ident" id="6000366">pos</span>&nbsp;<span class="op" id="6000370">=</span>&nbsp;<span class="ident" id="6000372">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000381">if</span>&nbsp;<span class="ident" id="6000384">isLit</span>&nbsp;<span class="op" id="6000390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000394">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000451">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000510">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000572">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000594">p</span><span class="op" id="6000595">.</span><span class="ident" id="6000596">output</span>&nbsp;<span class="op" id="6000603">=</span>&nbsp;<span class="builtinfunc" id="6000605">append</span><span class="op" id="6000611">(</span><span class="ident" id="6000612">p</span><span class="op" id="6000613">.</span><span class="ident" id="6000614">output</span><span class="op" id="6000620">,</span>&nbsp;<span class="ident" id="6000622">tabwriter</span><span class="op" id="6000631">.</span><span class="ident" id="6000632">Escape</span><span class="op" id="6000638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000641">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000645">if</span>&nbsp;<span class="ident" id="6000648">debug</span>&nbsp;<span class="op" id="6000654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000658">p</span><span class="op" id="6000659">.</span><span class="ident" id="6000660">output</span>&nbsp;<span class="op" id="6000667">=</span>&nbsp;<span class="builtinfunc" id="6000669">append</span><span class="op" id="6000675">(</span><span class="ident" id="6000676">p</span><span class="op" id="6000677">.</span><span class="ident" id="6000678">output</span><span class="op" id="6000684">,</span>&nbsp;<span class="ident" id="6000686">fmt</span><span class="op" id="6000689">.</span><span class="ident" id="6000690">Sprintf</span><span class="op" id="6000697">(</span><span class="string" id="6000698">&#34;/*%s*/&#34;</span><span class="op" id="6000706">,</span>&nbsp;<span class="ident" id="6000708">pos</span><span class="op" id="6000711">)</span><span class="op" id="6000712">...</span><span class="op" id="6000715">)</span>&nbsp;<span class="comment" id="6000717">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000745">p</span><span class="op" id="6000746">.</span><span class="ident" id="6000747">output</span>&nbsp;<span class="op" id="6000754">=</span>&nbsp;<span class="builtinfunc" id="6000756">append</span><span class="op" id="6000762">(</span><span class="ident" id="6000763">p</span><span class="op" id="6000764">.</span><span class="ident" id="6000765">output</span><span class="op" id="6000771">,</span>&nbsp;<span class="ident" id="6000773">s</span><span class="op" id="6000774">...</span><span class="op" id="6000777">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000781">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000802">nlines</span>&nbsp;<span class="op" id="6000809">:=</span>&nbsp;<span class="num" id="6000812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000815">var</span>&nbsp;<span class="ident" id="6000819">li</span>&nbsp;<span class="builtintype" id="6000822">int</span>&nbsp;<span class="comment" id="6000826">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000873">for</span>&nbsp;<span class="ident" id="6000877">i</span>&nbsp;<span class="op" id="6000879">:=</span>&nbsp;<span class="num" id="6000882">0</span><span class="op" id="6000883">;</span>&nbsp;<span class="ident" id="6000885">i</span>&nbsp;<span class="op" id="6000887">&lt;</span>&nbsp;<span class="builtinfunc" id="6000889">len</span><span class="op" id="6000892">(</span><span class="ident" id="6000893">s</span><span class="op" id="6000894">)</span><span class="op" id="6000895">;</span>&nbsp;<span class="ident" id="6000897">i</span><span class="op" id="6000898">++</span>&nbsp;<span class="op" id="6000901">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000905">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000965">if</span>&nbsp;<span class="ident" id="6000968">s</span><span class="op" id="6000969">[</span><span class="ident" id="6000970">i</span><span class="op" id="6000971">]</span>&nbsp;<span class="op" id="6000973">==</span>&nbsp;<span class="string" id="6000976">&#39;\n&#39;</span>&nbsp;<span class="op" id="6000981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000986">nlines</span><span class="op" id="6000992">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000998">li</span>&nbsp;<span class="op" id="6001001">=</span>&nbsp;<span class="ident" id="6001003">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001007">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001013">p</span><span class="op" id="6001014">.</span><span class="ident" id="6001015">pos</span><span class="op" id="6001018">.</span><span class="ident" id="6001019">Offset</span>&nbsp;<span class="op" id="6001026">+=</span>&nbsp;<span class="builtinfunc" id="6001029">len</span><span class="op" id="6001032">(</span><span class="ident" id="6001033">s</span><span class="op" id="6001034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001037">if</span>&nbsp;<span class="ident" id="6001040">nlines</span>&nbsp;<span class="op" id="6001047">&gt;</span>&nbsp;<span class="num" id="6001049">0</span>&nbsp;<span class="op" id="6001051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001055">p</span><span class="op" id="6001056">.</span><span class="ident" id="6001057">pos</span><span class="op" id="6001060">.</span><span class="ident" id="6001061">Line</span>&nbsp;<span class="op" id="6001066">+=</span>&nbsp;<span class="ident" id="6001069">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001078">p</span><span class="op" id="6001079">.</span><span class="ident" id="6001080">out</span><span class="op" id="6001083">.</span><span class="ident" id="6001084">Line</span>&nbsp;<span class="op" id="6001089">+=</span>&nbsp;<span class="ident" id="6001092">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001101">c</span>&nbsp;<span class="op" id="6001103">:=</span>&nbsp;<span class="builtinfunc" id="6001106">len</span><span class="op" id="6001109">(</span><span class="ident" id="6001110">s</span><span class="op" id="6001111">)</span>&nbsp;<span class="op" id="6001113">-</span>&nbsp;<span class="ident" id="6001115">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001120">p</span><span class="op" id="6001121">.</span><span class="ident" id="6001122">pos</span><span class="op" id="6001125">.</span><span class="ident" id="6001126">Column</span>&nbsp;<span class="op" id="6001133">=</span>&nbsp;<span class="ident" id="6001135">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001139">p</span><span class="op" id="6001140">.</span><span class="ident" id="6001141">out</span><span class="op" id="6001144">.</span><span class="ident" id="6001145">Column</span>&nbsp;<span class="op" id="6001152">=</span>&nbsp;<span class="ident" id="6001154">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001157">}</span>&nbsp;<span class="keyword" id="6001159">else</span>&nbsp;<span class="op" id="6001164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001168">p</span><span class="op" id="6001169">.</span><span class="ident" id="6001170">pos</span><span class="op" id="6001173">.</span><span class="ident" id="6001174">Column</span>&nbsp;<span class="op" id="6001181">+=</span>&nbsp;<span class="builtinfunc" id="6001184">len</span><span class="op" id="6001187">(</span><span class="ident" id="6001188">s</span><span class="op" id="6001189">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001193">p</span><span class="op" id="6001194">.</span><span class="ident" id="6001195">out</span><span class="op" id="6001198">.</span><span class="ident" id="6001199">Column</span>&nbsp;<span class="op" id="6001206">+=</span>&nbsp;<span class="builtinfunc" id="6001209">len</span><span class="op" id="6001212">(</span><span class="ident" id="6001213">s</span><span class="op" id="6001214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001221">if</span>&nbsp;<span class="ident" id="6001224">isLit</span>&nbsp;<span class="op" id="6001230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001234">p</span><span class="op" id="6001235">.</span><span class="ident" id="6001236">output</span>&nbsp;<span class="op" id="6001243">=</span>&nbsp;<span class="builtinfunc" id="6001245">append</span><span class="op" id="6001251">(</span><span class="ident" id="6001252">p</span><span class="op" id="6001253">.</span><span class="ident" id="6001254">output</span><span class="op" id="6001260">,</span>&nbsp;<span class="ident" id="6001262">tabwriter</span><span class="op" id="6001271">.</span><span class="ident" id="6001272">Escape</span><span class="op" id="6001278">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001285">p</span><span class="op" id="6001286">.</span><span class="ident" id="6001287">last</span>&nbsp;<span class="op" id="6001292">=</span>&nbsp;<span class="ident" id="6001294">p</span><span class="op" id="6001295">.</span><span class="ident" id="6001296">pos</span><br>
<span class="lineno"></span><span class="op" id="6001300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="6001303">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="6001365">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6001427">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="6001483">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="6001545">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="6001608">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6001668">//</span><br>
<span class="lineno"></span><span class="keyword" id="6001671">func</span>&nbsp;<span class="op" id="6001676">(</span><span class="ident" id="6001677">p</span>&nbsp;<span class="op" id="6001679">*</span><span class="ident" id="6001680">printer</span><span class="op" id="6001687">)</span>&nbsp;<span class="ident" id="6001689">writeCommentPrefix</span><span class="op" id="6001707">(</span><span class="ident" id="6001708">pos</span><span class="op" id="6001711">,</span>&nbsp;<span class="ident" id="6001713">next</span>&nbsp;<span class="ident" id="6001718">token</span><span class="op" id="6001723">.</span><span class="ident" id="6001724">Position</span><span class="op" id="6001732">,</span>&nbsp;<span class="ident" id="6001734">prev</span><span class="op" id="6001738">,</span>&nbsp;<span class="ident" id="6001740">comment</span>&nbsp;<span class="op" id="6001748">*</span><span class="ident" id="6001749">ast</span><span class="op" id="6001752">.</span><span class="ident" id="6001753">Comment</span><span class="op" id="6001760">,</span>&nbsp;<span class="ident" id="6001762">tok</span>&nbsp;<span class="ident" id="6001766">token</span><span class="op" id="6001771">.</span><span class="ident" id="6001772">Token</span><span class="op" id="6001777">)</span>&nbsp;<span class="op" id="6001779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001782">if</span>&nbsp;<span class="builtinfunc" id="6001785">len</span><span class="op" id="6001788">(</span><span class="ident" id="6001789">p</span><span class="op" id="6001790">.</span><span class="ident" id="6001791">output</span><span class="op" id="6001797">)</span>&nbsp;<span class="op" id="6001799">==</span>&nbsp;<span class="num" id="6001802">0</span>&nbsp;<span class="op" id="6001804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001808">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001886">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001898">if</span>&nbsp;<span class="ident" id="6001901">pos</span><span class="op" id="6001904">.</span><span class="ident" id="6001905">IsValid</span><span class="op" id="6001912">(</span><span class="op" id="6001913">)</span>&nbsp;<span class="op" id="6001915">&amp;&amp;</span>&nbsp;<span class="ident" id="6001918">pos</span><span class="op" id="6001921">.</span><span class="ident" id="6001922">Filename</span>&nbsp;<span class="op" id="6001931">!=</span>&nbsp;<span class="ident" id="6001934">p</span><span class="op" id="6001935">.</span><span class="ident" id="6001936">last</span><span class="op" id="6001940">.</span><span class="ident" id="6001941">Filename</span>&nbsp;<span class="op" id="6001950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001954">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002012">p</span><span class="op" id="6002013">.</span><span class="ident" id="6002014">writeByte</span><span class="op" id="6002023">(</span><span class="string" id="6002024">&#39;\f&#39;</span><span class="op" id="6002028">,</span>&nbsp;<span class="ident" id="6002030">maxNewlines</span><span class="op" id="6002041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002045">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002057">if</span>&nbsp;<span class="ident" id="6002060">pos</span><span class="op" id="6002063">.</span><span class="ident" id="6002064">Line</span>&nbsp;<span class="op" id="6002069">==</span>&nbsp;<span class="ident" id="6002072">p</span><span class="op" id="6002073">.</span><span class="ident" id="6002074">last</span><span class="op" id="6002078">.</span><span class="ident" id="6002079">Line</span>&nbsp;<span class="op" id="6002084">&amp;&amp;</span>&nbsp;<span class="op" id="6002087">(</span><span class="ident" id="6002088">prev</span>&nbsp;<span class="op" id="6002093">==</span>&nbsp;<span class="ident" id="6002096">nil</span>&nbsp;<span class="op" id="6002100">||</span>&nbsp;<span class="ident" id="6002103">prev</span><span class="op" id="6002107">.</span><span class="ident" id="6002108">Text</span><span class="op" id="6002112">[</span><span class="num" id="6002113">1</span><span class="op" id="6002114">]</span>&nbsp;<span class="op" id="6002116">!=</span>&nbsp;<span class="string" id="6002119">&#39;/&#39;</span><span class="op" id="6002122">)</span>&nbsp;<span class="op" id="6002124">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002128">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002172">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002214">hasSep</span>&nbsp;<span class="op" id="6002221">:=</span>&nbsp;<span class="builtintype" id="6002224">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002232">if</span>&nbsp;<span class="ident" id="6002235">prev</span>&nbsp;<span class="op" id="6002240">==</span>&nbsp;<span class="ident" id="6002243">nil</span>&nbsp;<span class="op" id="6002247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002252">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002291">j</span>&nbsp;<span class="op" id="6002293">:=</span>&nbsp;<span class="num" id="6002296">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002301">for</span>&nbsp;<span class="ident" id="6002305">i</span><span class="op" id="6002306">,</span>&nbsp;<span class="ident" id="6002308">ch</span>&nbsp;<span class="op" id="6002311">:=</span>&nbsp;<span class="keyword" id="6002314">range</span>&nbsp;<span class="ident" id="6002320">p</span><span class="op" id="6002321">.</span><span class="ident" id="6002322">wsbuf</span>&nbsp;<span class="op" id="6002328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002334">switch</span>&nbsp;<span class="ident" id="6002341">ch</span>&nbsp;<span class="op" id="6002344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002350">case</span>&nbsp;<span class="ident" id="6002355">blank</span><span class="op" id="6002360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002367">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002410">p</span><span class="op" id="6002411">.</span><span class="ident" id="6002412">wsbuf</span><span class="op" id="6002417">[</span><span class="ident" id="6002418">i</span><span class="op" id="6002419">]</span>&nbsp;<span class="op" id="6002421">=</span>&nbsp;<span class="ident" id="6002423">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002435">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002448">case</span>&nbsp;<span class="ident" id="6002453">vtab</span><span class="op" id="6002457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002464">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002506">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002557">hasSep</span>&nbsp;<span class="op" id="6002564">=</span>&nbsp;<span class="builtintype" id="6002566">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002576">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002589">case</span>&nbsp;<span class="ident" id="6002594">indent</span><span class="op" id="6002600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002607">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002641">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002660">j</span>&nbsp;<span class="op" id="6002662">=</span>&nbsp;<span class="ident" id="6002664">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002670">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002684">p</span><span class="op" id="6002685">.</span><span class="ident" id="6002686">writeWhitespace</span><span class="op" id="6002701">(</span><span class="ident" id="6002702">j</span><span class="op" id="6002703">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002711">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002758">if</span>&nbsp;<span class="op" id="6002761">!</span><span class="ident" id="6002762">hasSep</span>&nbsp;<span class="op" id="6002769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002774">sep</span>&nbsp;<span class="op" id="6002778">:=</span>&nbsp;<span class="builtintype" id="6002781">byte</span><span class="op" id="6002785">(</span><span class="string" id="6002786">&#39;\t&#39;</span><span class="op" id="6002790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002795">if</span>&nbsp;<span class="ident" id="6002798">pos</span><span class="op" id="6002801">.</span><span class="ident" id="6002802">Line</span>&nbsp;<span class="op" id="6002807">==</span>&nbsp;<span class="ident" id="6002810">next</span><span class="op" id="6002814">.</span><span class="ident" id="6002815">Line</span>&nbsp;<span class="op" id="6002820">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002826">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002878">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002930">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002967">sep</span>&nbsp;<span class="op" id="6002971">=</span>&nbsp;<span class="string" id="6002973">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002980">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002985">p</span><span class="op" id="6002986">.</span><span class="ident" id="6002987">writeByte</span><span class="op" id="6002996">(</span><span class="ident" id="6002997">sep</span><span class="op" id="6003000">,</span>&nbsp;<span class="num" id="6003002">1</span><span class="op" id="6003003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003011">}</span>&nbsp;<span class="keyword" id="6003013">else</span>&nbsp;<span class="op" id="6003018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003022">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003056">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003099">droppedLinebreak</span>&nbsp;<span class="op" id="6003116">:=</span>&nbsp;<span class="builtintype" id="6003119">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003127">j</span>&nbsp;<span class="op" id="6003129">:=</span>&nbsp;<span class="num" id="6003132">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003136">for</span>&nbsp;<span class="ident" id="6003140">i</span><span class="op" id="6003141">,</span>&nbsp;<span class="ident" id="6003143">ch</span>&nbsp;<span class="op" id="6003146">:=</span>&nbsp;<span class="keyword" id="6003149">range</span>&nbsp;<span class="ident" id="6003155">p</span><span class="op" id="6003156">.</span><span class="ident" id="6003157">wsbuf</span>&nbsp;<span class="op" id="6003163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003168">switch</span>&nbsp;<span class="ident" id="6003175">ch</span>&nbsp;<span class="op" id="6003178">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003183">case</span>&nbsp;<span class="ident" id="6003188">blank</span><span class="op" id="6003193">,</span>&nbsp;<span class="ident" id="6003195">vtab</span><span class="op" id="6003199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003205">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003264">p</span><span class="op" id="6003265">.</span><span class="ident" id="6003266">wsbuf</span><span class="op" id="6003271">[</span><span class="ident" id="6003272">i</span><span class="op" id="6003273">]</span>&nbsp;<span class="op" id="6003275">=</span>&nbsp;<span class="ident" id="6003277">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003288">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003300">case</span>&nbsp;<span class="ident" id="6003305">indent</span><span class="op" id="6003311">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003317">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003350">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003362">case</span>&nbsp;<span class="ident" id="6003367">unindent</span><span class="op" id="6003375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003381">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003431">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003478">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003532">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003574">if</span>&nbsp;<span class="ident" id="6003577">i</span><span class="op" id="6003578">+</span><span class="num" id="6003579">1</span>&nbsp;<span class="op" id="6003581">&lt;</span>&nbsp;<span class="builtinfunc" id="6003583">len</span><span class="op" id="6003586">(</span><span class="ident" id="6003587">p</span><span class="op" id="6003588">.</span><span class="ident" id="6003589">wsbuf</span><span class="op" id="6003594">)</span>&nbsp;<span class="op" id="6003596">&amp;&amp;</span>&nbsp;<span class="ident" id="6003599">p</span><span class="op" id="6003600">.</span><span class="ident" id="6003601">wsbuf</span><span class="op" id="6003606">[</span><span class="ident" id="6003607">i</span><span class="op" id="6003608">+</span><span class="num" id="6003609">1</span><span class="op" id="6003610">]</span>&nbsp;<span class="op" id="6003612">==</span>&nbsp;<span class="ident" id="6003615">unindent</span>&nbsp;<span class="op" id="6003624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003631">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003644">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003650">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003714">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003772">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003829">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003887">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003942">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004000">if</span>&nbsp;<span class="ident" id="6004003">tok</span>&nbsp;<span class="op" id="6004007">!=</span>&nbsp;<span class="ident" id="6004010">token</span><span class="op" id="6004015">.</span><span class="ident" id="6004016">RBRACE</span>&nbsp;<span class="op" id="6004023">&amp;&amp;</span>&nbsp;<span class="ident" id="6004026">pos</span><span class="op" id="6004029">.</span><span class="ident" id="6004030">Column</span>&nbsp;<span class="op" id="6004037">==</span>&nbsp;<span class="ident" id="6004040">next</span><span class="op" id="6004044">.</span><span class="ident" id="6004045">Column</span>&nbsp;<span class="op" id="6004052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004059">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004077">case</span>&nbsp;<span class="ident" id="6004082">newline</span><span class="op" id="6004089">,</span>&nbsp;<span class="ident" id="6004091">formfeed</span><span class="op" id="6004099">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004105">p</span><span class="op" id="6004106">.</span><span class="ident" id="6004107">wsbuf</span><span class="op" id="6004112">[</span><span class="ident" id="6004113">i</span><span class="op" id="6004114">]</span>&nbsp;<span class="op" id="6004116">=</span>&nbsp;<span class="ident" id="6004118">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004129">droppedLinebreak</span>&nbsp;<span class="op" id="6004146">=</span>&nbsp;<span class="ident" id="6004148">prev</span>&nbsp;<span class="op" id="6004153">==</span>&nbsp;<span class="ident" id="6004156">nil</span>&nbsp;<span class="comment" id="6004160">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004211">j</span>&nbsp;<span class="op" id="6004213">=</span>&nbsp;<span class="ident" id="6004215">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004220">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004232">p</span><span class="op" id="6004233">.</span><span class="ident" id="6004234">writeWhitespace</span><span class="op" id="6004249">(</span><span class="ident" id="6004250">j</span><span class="op" id="6004251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004256">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004311">n</span>&nbsp;<span class="op" id="6004313">:=</span>&nbsp;<span class="num" id="6004316">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004320">if</span>&nbsp;<span class="ident" id="6004323">pos</span><span class="op" id="6004326">.</span><span class="ident" id="6004327">IsValid</span><span class="op" id="6004334">(</span><span class="op" id="6004335">)</span>&nbsp;<span class="op" id="6004337">&amp;&amp;</span>&nbsp;<span class="ident" id="6004340">p</span><span class="op" id="6004341">.</span><span class="ident" id="6004342">last</span><span class="op" id="6004346">.</span><span class="ident" id="6004347">IsValid</span><span class="op" id="6004354">(</span><span class="op" id="6004355">)</span>&nbsp;<span class="op" id="6004357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004362">n</span>&nbsp;<span class="op" id="6004364">=</span>&nbsp;<span class="ident" id="6004366">pos</span><span class="op" id="6004369">.</span><span class="ident" id="6004370">Line</span>&nbsp;<span class="op" id="6004375">-</span>&nbsp;<span class="ident" id="6004377">p</span><span class="op" id="6004378">.</span><span class="ident" id="6004379">last</span><span class="op" id="6004383">.</span><span class="ident" id="6004384">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004392">if</span>&nbsp;<span class="ident" id="6004395">n</span>&nbsp;<span class="op" id="6004397">&lt;</span>&nbsp;<span class="num" id="6004399">0</span>&nbsp;<span class="op" id="6004401">{</span>&nbsp;<span class="comment" id="6004403">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004430">n</span>&nbsp;<span class="op" id="6004432">=</span>&nbsp;<span class="num" id="6004434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004439">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004448">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004502">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004554">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004608">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004662">if</span>&nbsp;<span class="ident" id="6004665">p</span><span class="op" id="6004666">.</span><span class="ident" id="6004667">indent</span>&nbsp;<span class="op" id="6004674">==</span>&nbsp;<span class="num" id="6004677">0</span>&nbsp;<span class="op" id="6004679">&amp;&amp;</span>&nbsp;<span class="ident" id="6004682">droppedLinebreak</span>&nbsp;<span class="op" id="6004699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004704">n</span><span class="op" id="6004705">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004715">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004763">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004811">if</span>&nbsp;<span class="ident" id="6004814">n</span>&nbsp;<span class="op" id="6004816">==</span>&nbsp;<span class="num" id="6004819">0</span>&nbsp;<span class="op" id="6004821">&amp;&amp;</span>&nbsp;<span class="ident" id="6004824">prev</span>&nbsp;<span class="op" id="6004829">!=</span>&nbsp;<span class="ident" id="6004832">nil</span>&nbsp;<span class="op" id="6004836">&amp;&amp;</span>&nbsp;<span class="ident" id="6004839">prev</span><span class="op" id="6004843">.</span><span class="ident" id="6004844">Text</span><span class="op" id="6004848">[</span><span class="num" id="6004849">1</span><span class="op" id="6004850">]</span>&nbsp;<span class="op" id="6004852">==</span>&nbsp;<span class="string" id="6004855">&#39;/&#39;</span>&nbsp;<span class="op" id="6004859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004864">n</span>&nbsp;<span class="op" id="6004866">=</span>&nbsp;<span class="num" id="6004868">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004872">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004877">if</span>&nbsp;<span class="ident" id="6004880">n</span>&nbsp;<span class="op" id="6004882">&gt;</span>&nbsp;<span class="num" id="6004884">0</span>&nbsp;<span class="op" id="6004886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004891">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004946">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005001">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005045">p</span><span class="op" id="6005046">.</span><span class="ident" id="6005047">writeByte</span><span class="op" id="6005056">(</span><span class="string" id="6005057">&#39;\f&#39;</span><span class="op" id="6005061">,</span>&nbsp;<span class="ident" id="6005063">nlimit</span><span class="op" id="6005069">(</span><span class="ident" id="6005070">n</span><span class="op" id="6005071">)</span><span class="op" id="6005072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005079">}</span><br>
<span class="lineno"></span><span class="op" id="6005081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="6005084">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="6005131">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="6005194">//</span><br>
<span class="lineno"></span><span class="keyword" id="6005197">func</span>&nbsp;<span class="ident" id="6005202">isBlank</span><span class="op" id="6005209">(</span><span class="ident" id="6005210">s</span>&nbsp;<span class="builtintype" id="6005212">string</span><span class="op" id="6005218">)</span>&nbsp;<span class="builtintype" id="6005220">bool</span>&nbsp;<span class="op" id="6005225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005228">for</span>&nbsp;<span class="ident" id="6005232">i</span>&nbsp;<span class="op" id="6005234">:=</span>&nbsp;<span class="num" id="6005237">0</span><span class="op" id="6005238">;</span>&nbsp;<span class="ident" id="6005240">i</span>&nbsp;<span class="op" id="6005242">&lt;</span>&nbsp;<span class="builtinfunc" id="6005244">len</span><span class="op" id="6005247">(</span><span class="ident" id="6005248">s</span><span class="op" id="6005249">)</span><span class="op" id="6005250">;</span>&nbsp;<span class="ident" id="6005252">i</span><span class="op" id="6005253">++</span>&nbsp;<span class="op" id="6005256">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005260">if</span>&nbsp;<span class="ident" id="6005263">s</span><span class="op" id="6005264">[</span><span class="ident" id="6005265">i</span><span class="op" id="6005266">]</span>&nbsp;<span class="op" id="6005268">&gt;</span>&nbsp;<span class="string" id="6005270">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6005274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005279">return</span>&nbsp;<span class="builtintype" id="6005286">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005300">return</span>&nbsp;<span class="builtintype" id="6005307">true</span><br>
<span class="lineno">460</span><span class="op" id="6005312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6005315">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="6005369">func</span>&nbsp;<span class="ident" id="6005374">commonPrefix</span><span class="op" id="6005386">(</span><span class="ident" id="6005387">a</span><span class="op" id="6005388">,</span>&nbsp;<span class="ident" id="6005390">b</span>&nbsp;<span class="builtintype" id="6005392">string</span><span class="op" id="6005398">)</span>&nbsp;<span class="builtintype" id="6005400">string</span>&nbsp;<span class="op" id="6005407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005410">i</span>&nbsp;<span class="op" id="6005412">:=</span>&nbsp;<span class="num" id="6005415">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005418">for</span>&nbsp;<span class="ident" id="6005422">i</span>&nbsp;<span class="op" id="6005424">&lt;</span>&nbsp;<span class="builtinfunc" id="6005426">len</span><span class="op" id="6005429">(</span><span class="ident" id="6005430">a</span><span class="op" id="6005431">)</span>&nbsp;<span class="op" id="6005433">&amp;&amp;</span>&nbsp;<span class="ident" id="6005436">i</span>&nbsp;<span class="op" id="6005438">&lt;</span>&nbsp;<span class="builtinfunc" id="6005440">len</span><span class="op" id="6005443">(</span><span class="ident" id="6005444">b</span><span class="op" id="6005445">)</span>&nbsp;<span class="op" id="6005447">&amp;&amp;</span>&nbsp;<span class="ident" id="6005450">a</span><span class="op" id="6005451">[</span><span class="ident" id="6005452">i</span><span class="op" id="6005453">]</span>&nbsp;<span class="op" id="6005455">==</span>&nbsp;<span class="ident" id="6005458">b</span><span class="op" id="6005459">[</span><span class="ident" id="6005460">i</span><span class="op" id="6005461">]</span>&nbsp;<span class="op" id="6005463">&amp;&amp;</span>&nbsp;<span class="op" id="6005466">(</span><span class="ident" id="6005467">a</span><span class="op" id="6005468">[</span><span class="ident" id="6005469">i</span><span class="op" id="6005470">]</span>&nbsp;<span class="op" id="6005472">&lt;=</span>&nbsp;<span class="string" id="6005475">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6005479">||</span>&nbsp;<span class="ident" id="6005482">a</span><span class="op" id="6005483">[</span><span class="ident" id="6005484">i</span><span class="op" id="6005485">]</span>&nbsp;<span class="op" id="6005487">==</span>&nbsp;<span class="string" id="6005490">&#39;*&#39;</span><span class="op" id="6005493">)</span>&nbsp;<span class="op" id="6005495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005499">i</span><span class="op" id="6005500">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005507">return</span>&nbsp;<span class="ident" id="6005514">a</span><span class="op" id="6005515">[</span><span class="num" id="6005516">0</span><span class="op" id="6005517">:</span><span class="ident" id="6005518">i</span><span class="op" id="6005519">]</span><br>
<span class="lineno"></span><span class="op" id="6005521">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="6005524">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="6005581">func</span>&nbsp;<span class="ident" id="6005586">trimRight</span><span class="op" id="6005595">(</span><span class="ident" id="6005596">s</span>&nbsp;<span class="builtintype" id="6005598">string</span><span class="op" id="6005604">)</span>&nbsp;<span class="builtintype" id="6005606">string</span>&nbsp;<span class="op" id="6005613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005616">return</span>&nbsp;<span class="ident" id="6005623">strings</span><span class="op" id="6005630">.</span><span class="ident" id="6005631">TrimRightFunc</span><span class="op" id="6005644">(</span><span class="ident" id="6005645">s</span><span class="op" id="6005646">,</span>&nbsp;<span class="ident" id="6005648">unicode</span><span class="op" id="6005655">.</span><span class="ident" id="6005656">IsSpace</span><span class="op" id="6005663">)</span><br>
<span class="lineno"></span><span class="op" id="6005665">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="6005668">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6005752">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="6005837">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="6005917">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="6005997">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="6006021">//</span><br>
<span class="lineno"></span><span class="keyword" id="6006024">func</span>&nbsp;<span class="ident" id="6006029">stripCommonPrefix</span><span class="op" id="6006046">(</span><span class="ident" id="6006047">lines</span>&nbsp;<span class="op" id="6006053">[</span><span class="op" id="6006054">]</span><span class="builtintype" id="6006055">string</span><span class="op" id="6006061">)</span>&nbsp;<span class="op" id="6006063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006066">if</span>&nbsp;<span class="builtinfunc" id="6006069">len</span><span class="op" id="6006072">(</span><span class="ident" id="6006073">lines</span><span class="op" id="6006078">)</span>&nbsp;<span class="op" id="6006080">&lt;=</span>&nbsp;<span class="num" id="6006083">1</span>&nbsp;<span class="op" id="6006085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006089">return</span>&nbsp;<span class="comment" id="6006096">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006136">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006156">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006213">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006270">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006324">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006382">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006440">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006498">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006539">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006601">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006663">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006724">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006785">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006845">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006859">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006863">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006923">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006983">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007037">var</span>&nbsp;<span class="ident" id="6007041">prefix</span>&nbsp;<span class="builtintype" id="6007048">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007056">if</span>&nbsp;<span class="builtinfunc" id="6007059">len</span><span class="op" id="6007062">(</span><span class="ident" id="6007063">lines</span><span class="op" id="6007068">)</span>&nbsp;<span class="op" id="6007070">&gt;</span>&nbsp;<span class="num" id="6007072">2</span>&nbsp;<span class="op" id="6007074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007078">first</span>&nbsp;<span class="op" id="6007084">:=</span>&nbsp;<span class="builtintype" id="6007087">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007094">for</span>&nbsp;<span class="ident" id="6007098">i</span><span class="op" id="6007099">,</span>&nbsp;<span class="ident" id="6007101">line</span>&nbsp;<span class="op" id="6007106">:=</span>&nbsp;<span class="keyword" id="6007109">range</span>&nbsp;<span class="ident" id="6007115">lines</span><span class="op" id="6007120">[</span><span class="num" id="6007121">1</span>&nbsp;<span class="op" id="6007123">:</span>&nbsp;<span class="builtinfunc" id="6007125">len</span><span class="op" id="6007128">(</span><span class="ident" id="6007129">lines</span><span class="op" id="6007134">)</span><span class="op" id="6007135">-</span><span class="num" id="6007136">1</span><span class="op" id="6007137">]</span>&nbsp;<span class="op" id="6007139">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007144">switch</span>&nbsp;<span class="op" id="6007151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007156">case</span>&nbsp;<span class="ident" id="6007161">isBlank</span><span class="op" id="6007168">(</span><span class="ident" id="6007169">line</span><span class="op" id="6007173">)</span><span class="op" id="6007174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007180">lines</span><span class="op" id="6007185">[</span><span class="num" id="6007186">1</span><span class="op" id="6007187">+</span><span class="ident" id="6007188">i</span><span class="op" id="6007189">]</span>&nbsp;<span class="op" id="6007191">=</span>&nbsp;<span class="string" id="6007193">&#34;&#34;</span>&nbsp;<span class="comment" id="6007196">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007229">case</span>&nbsp;<span class="ident" id="6007234">first</span><span class="op" id="6007239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007245">prefix</span>&nbsp;<span class="op" id="6007252">=</span>&nbsp;<span class="ident" id="6007254">commonPrefix</span><span class="op" id="6007266">(</span><span class="ident" id="6007267">line</span><span class="op" id="6007271">,</span>&nbsp;<span class="ident" id="6007273">line</span><span class="op" id="6007277">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007283">first</span>&nbsp;<span class="op" id="6007289">=</span>&nbsp;<span class="builtintype" id="6007291">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007300">default</span><span class="op" id="6007307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007313">prefix</span>&nbsp;<span class="op" id="6007320">=</span>&nbsp;<span class="ident" id="6007322">commonPrefix</span><span class="op" id="6007334">(</span><span class="ident" id="6007335">prefix</span><span class="op" id="6007341">,</span>&nbsp;<span class="ident" id="6007343">line</span><span class="op" id="6007347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007356">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007359">}</span>&nbsp;<span class="keyword" id="6007361">else</span>&nbsp;<span class="op" id="6007366">{</span>&nbsp;<span class="comment" id="6007368">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007432">line</span>&nbsp;<span class="op" id="6007437">:=</span>&nbsp;<span class="ident" id="6007440">lines</span><span class="op" id="6007445">[</span><span class="num" id="6007446">1</span><span class="op" id="6007447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007451">prefix</span>&nbsp;<span class="op" id="6007458">=</span>&nbsp;<span class="ident" id="6007460">commonPrefix</span><span class="op" id="6007472">(</span><span class="ident" id="6007473">line</span><span class="op" id="6007477">,</span>&nbsp;<span class="ident" id="6007479">line</span><span class="op" id="6007483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007490">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007570">lineOfStars</span>&nbsp;<span class="op" id="6007582">:=</span>&nbsp;<span class="builtintype" id="6007585">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007592">if</span>&nbsp;<span class="ident" id="6007595">i</span>&nbsp;<span class="op" id="6007597">:=</span>&nbsp;<span class="ident" id="6007600">strings</span><span class="op" id="6007607">.</span><span class="ident" id="6007608">Index</span><span class="op" id="6007613">(</span><span class="ident" id="6007614">prefix</span><span class="op" id="6007620">,</span>&nbsp;<span class="string" id="6007622">&#34;*&#34;</span><span class="op" id="6007625">)</span><span class="op" id="6007626">;</span>&nbsp;<span class="ident" id="6007628">i</span>&nbsp;<span class="op" id="6007630">&gt;=</span>&nbsp;<span class="num" id="6007633">0</span>&nbsp;<span class="op" id="6007635">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007639">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007667">if</span>&nbsp;<span class="ident" id="6007670">i</span>&nbsp;<span class="op" id="6007672">&gt;</span>&nbsp;<span class="num" id="6007674">0</span>&nbsp;<span class="op" id="6007676">&amp;&amp;</span>&nbsp;<span class="ident" id="6007679">prefix</span><span class="op" id="6007685">[</span><span class="ident" id="6007686">i</span><span class="op" id="6007687">-</span><span class="num" id="6007688">1</span><span class="op" id="6007689">]</span>&nbsp;<span class="op" id="6007691">==</span>&nbsp;<span class="string" id="6007694">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6007698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007703">i</span><span class="op" id="6007704">--</span>&nbsp;<span class="comment" id="6007707">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007774">prefix</span>&nbsp;<span class="op" id="6007781">=</span>&nbsp;<span class="ident" id="6007783">prefix</span><span class="op" id="6007789">[</span><span class="num" id="6007790">0</span><span class="op" id="6007791">:</span><span class="ident" id="6007792">i</span><span class="op" id="6007793">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007797">lineOfStars</span>&nbsp;<span class="op" id="6007809">=</span>&nbsp;<span class="builtintype" id="6007811">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007817">}</span>&nbsp;<span class="keyword" id="6007819">else</span>&nbsp;<span class="op" id="6007824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007828">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007859">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007921">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007983">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008046">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008107">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008169">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008230">first</span>&nbsp;<span class="op" id="6008236">:=</span>&nbsp;<span class="ident" id="6008239">lines</span><span class="op" id="6008244">[</span><span class="num" id="6008245">0</span><span class="op" id="6008246">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008250">if</span>&nbsp;<span class="ident" id="6008253">isBlank</span><span class="op" id="6008260">(</span><span class="ident" id="6008261">first</span><span class="op" id="6008266">[</span><span class="num" id="6008267">2</span><span class="op" id="6008268">:</span><span class="op" id="6008269">]</span><span class="op" id="6008270">)</span>&nbsp;<span class="op" id="6008272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008277">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008318">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008365">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008417">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008470">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008495">i</span>&nbsp;<span class="op" id="6008497">:=</span>&nbsp;<span class="builtinfunc" id="6008500">len</span><span class="op" id="6008503">(</span><span class="ident" id="6008504">prefix</span><span class="op" id="6008510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008515">for</span>&nbsp;<span class="ident" id="6008519">n</span>&nbsp;<span class="op" id="6008521">:=</span>&nbsp;<span class="num" id="6008524">0</span><span class="op" id="6008525">;</span>&nbsp;<span class="ident" id="6008527">n</span>&nbsp;<span class="op" id="6008529">&lt;</span>&nbsp;<span class="num" id="6008531">3</span>&nbsp;<span class="op" id="6008533">&amp;&amp;</span>&nbsp;<span class="ident" id="6008536">i</span>&nbsp;<span class="op" id="6008538">&gt;</span>&nbsp;<span class="num" id="6008540">0</span>&nbsp;<span class="op" id="6008542">&amp;&amp;</span>&nbsp;<span class="ident" id="6008545">prefix</span><span class="op" id="6008551">[</span><span class="ident" id="6008552">i</span><span class="op" id="6008553">-</span><span class="num" id="6008554">1</span><span class="op" id="6008555">]</span>&nbsp;<span class="op" id="6008557">==</span>&nbsp;<span class="string" id="6008560">&#39;&nbsp;&#39;</span><span class="op" id="6008563">;</span>&nbsp;<span class="ident" id="6008565">n</span><span class="op" id="6008566">++</span>&nbsp;<span class="op" id="6008569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008575">i</span><span class="op" id="6008576">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008582">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008587">if</span>&nbsp;<span class="ident" id="6008590">i</span>&nbsp;<span class="op" id="6008592">==</span>&nbsp;<span class="builtinfunc" id="6008595">len</span><span class="op" id="6008598">(</span><span class="ident" id="6008599">prefix</span><span class="op" id="6008605">)</span>&nbsp;<span class="op" id="6008607">&amp;&amp;</span>&nbsp;<span class="ident" id="6008610">i</span>&nbsp;<span class="op" id="6008612">&gt;</span>&nbsp;<span class="num" id="6008614">0</span>&nbsp;<span class="op" id="6008616">&amp;&amp;</span>&nbsp;<span class="ident" id="6008619">prefix</span><span class="op" id="6008625">[</span><span class="ident" id="6008626">i</span><span class="op" id="6008627">-</span><span class="num" id="6008628">1</span><span class="op" id="6008629">]</span>&nbsp;<span class="op" id="6008631">==</span>&nbsp;<span class="string" id="6008634">&#39;\t&#39;</span>&nbsp;<span class="op" id="6008639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008645">i</span><span class="op" id="6008646">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008657">prefix</span>&nbsp;<span class="op" id="6008664">=</span>&nbsp;<span class="ident" id="6008666">prefix</span><span class="op" id="6008672">[</span><span class="num" id="6008673">0</span><span class="op" id="6008674">:</span><span class="ident" id="6008675">i</span><span class="op" id="6008676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008680">}</span>&nbsp;<span class="keyword" id="6008682">else</span>&nbsp;<span class="op" id="6008687">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008692">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008729">suffix</span>&nbsp;<span class="op" id="6008736">:=</span>&nbsp;<span class="builtinfunc" id="6008739">make</span><span class="op" id="6008743">(</span><span class="op" id="6008744">[</span><span class="op" id="6008745">]</span><span class="builtintype" id="6008746">byte</span><span class="op" id="6008750">,</span>&nbsp;<span class="builtinfunc" id="6008752">len</span><span class="op" id="6008755">(</span><span class="ident" id="6008756">first</span><span class="op" id="6008761">)</span><span class="op" id="6008762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008767">n</span>&nbsp;<span class="op" id="6008769">:=</span>&nbsp;<span class="num" id="6008772">2</span>&nbsp;<span class="comment" id="6008774">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008803">for</span>&nbsp;<span class="ident" id="6008807">n</span>&nbsp;<span class="op" id="6008809">&lt;</span>&nbsp;<span class="builtinfunc" id="6008811">len</span><span class="op" id="6008814">(</span><span class="ident" id="6008815">first</span><span class="op" id="6008820">)</span>&nbsp;<span class="op" id="6008822">&amp;&amp;</span>&nbsp;<span class="ident" id="6008825">first</span><span class="op" id="6008830">[</span><span class="ident" id="6008831">n</span><span class="op" id="6008832">]</span>&nbsp;<span class="op" id="6008834">&lt;=</span>&nbsp;<span class="string" id="6008837">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6008841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008847">suffix</span><span class="op" id="6008853">[</span><span class="ident" id="6008854">n</span><span class="op" id="6008855">]</span>&nbsp;<span class="op" id="6008857">=</span>&nbsp;<span class="ident" id="6008859">first</span><span class="op" id="6008864">[</span><span class="ident" id="6008865">n</span><span class="op" id="6008866">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008872">n</span><span class="op" id="6008873">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008884">if</span>&nbsp;<span class="ident" id="6008887">n</span>&nbsp;<span class="op" id="6008889">&gt;</span>&nbsp;<span class="num" id="6008891">2</span>&nbsp;<span class="op" id="6008893">&amp;&amp;</span>&nbsp;<span class="ident" id="6008896">suffix</span><span class="op" id="6008902">[</span><span class="num" id="6008903">2</span><span class="op" id="6008904">]</span>&nbsp;<span class="op" id="6008906">==</span>&nbsp;<span class="string" id="6008909">&#39;\t&#39;</span>&nbsp;<span class="op" id="6008914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008920">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008966">suffix</span>&nbsp;<span class="op" id="6008973">=</span>&nbsp;<span class="ident" id="6008975">suffix</span><span class="op" id="6008981">[</span><span class="num" id="6008982">2</span><span class="op" id="6008983">:</span><span class="ident" id="6008984">n</span><span class="op" id="6008985">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008990">}</span>&nbsp;<span class="keyword" id="6008992">else</span>&nbsp;<span class="op" id="6008997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009003">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009038">suffix</span><span class="op" id="6009044">[</span><span class="num" id="6009045">0</span><span class="op" id="6009046">]</span><span class="op" id="6009047">,</span>&nbsp;<span class="ident" id="6009049">suffix</span><span class="op" id="6009055">[</span><span class="num" id="6009056">1</span><span class="op" id="6009057">]</span>&nbsp;<span class="op" id="6009059">=</span>&nbsp;<span class="string" id="6009061">&#39;&nbsp;&#39;</span><span class="op" id="6009064">,</span>&nbsp;<span class="string" id="6009066">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009074">suffix</span>&nbsp;<span class="op" id="6009081">=</span>&nbsp;<span class="ident" id="6009083">suffix</span><span class="op" id="6009089">[</span><span class="num" id="6009090">0</span><span class="op" id="6009091">:</span><span class="ident" id="6009092">n</span><span class="op" id="6009093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009098">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009103">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009161">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009215">prefix</span>&nbsp;<span class="op" id="6009222">=</span>&nbsp;<span class="ident" id="6009224">strings</span><span class="op" id="6009231">.</span><span class="ident" id="6009232">TrimSuffix</span><span class="op" id="6009242">(</span><span class="ident" id="6009243">prefix</span><span class="op" id="6009249">,</span>&nbsp;<span class="builtintype" id="6009251">string</span><span class="op" id="6009257">(</span><span class="ident" id="6009258">suffix</span><span class="op" id="6009264">)</span><span class="op" id="6009265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009272">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009276">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009341">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009406">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009417">last</span>&nbsp;<span class="op" id="6009422">:=</span>&nbsp;<span class="ident" id="6009425">lines</span><span class="op" id="6009430">[</span><span class="builtinfunc" id="6009431">len</span><span class="op" id="6009434">(</span><span class="ident" id="6009435">lines</span><span class="op" id="6009440">)</span><span class="op" id="6009441">-</span><span class="num" id="6009442">1</span><span class="op" id="6009443">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009446">closing</span>&nbsp;<span class="op" id="6009454">:=</span>&nbsp;<span class="string" id="6009457">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009463">i</span>&nbsp;<span class="op" id="6009465">:=</span>&nbsp;<span class="ident" id="6009468">strings</span><span class="op" id="6009475">.</span><span class="ident" id="6009476">Index</span><span class="op" id="6009481">(</span><span class="ident" id="6009482">last</span><span class="op" id="6009486">,</span>&nbsp;<span class="ident" id="6009488">closing</span><span class="op" id="6009495">)</span>&nbsp;<span class="comment" id="6009497">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009536">if</span>&nbsp;<span class="ident" id="6009539">isBlank</span><span class="op" id="6009546">(</span><span class="ident" id="6009547">last</span><span class="op" id="6009551">[</span><span class="num" id="6009552">0</span><span class="op" id="6009553">:</span><span class="ident" id="6009554">i</span><span class="op" id="6009555">]</span><span class="op" id="6009556">)</span>&nbsp;<span class="op" id="6009558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009562">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009602">if</span>&nbsp;<span class="ident" id="6009605">lineOfStars</span>&nbsp;<span class="op" id="6009617">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009622">closing</span>&nbsp;<span class="op" id="6009630">=</span>&nbsp;<span class="string" id="6009632">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="6009638">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009677">lines</span><span class="op" id="6009682">[</span><span class="builtinfunc" id="6009683">len</span><span class="op" id="6009686">(</span><span class="ident" id="6009687">lines</span><span class="op" id="6009692">)</span><span class="op" id="6009693">-</span><span class="num" id="6009694">1</span><span class="op" id="6009695">]</span>&nbsp;<span class="op" id="6009697">=</span>&nbsp;<span class="ident" id="6009699">prefix</span>&nbsp;<span class="op" id="6009706">+</span>&nbsp;<span class="ident" id="6009708">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009717">}</span>&nbsp;<span class="keyword" id="6009719">else</span>&nbsp;<span class="op" id="6009724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009728">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009779">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009831">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009858">prefix</span>&nbsp;<span class="op" id="6009865">=</span>&nbsp;<span class="ident" id="6009867">commonPrefix</span><span class="op" id="6009879">(</span><span class="ident" id="6009880">prefix</span><span class="op" id="6009886">,</span>&nbsp;<span class="ident" id="6009888">last</span><span class="op" id="6009892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009899">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009968">for</span>&nbsp;<span class="ident" id="6009972">i</span><span class="op" id="6009973">,</span>&nbsp;<span class="ident" id="6009975">line</span>&nbsp;<span class="op" id="6009980">:=</span>&nbsp;<span class="keyword" id="6009983">range</span>&nbsp;<span class="ident" id="6009989">lines</span>&nbsp;<span class="op" id="6009995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009999">if</span>&nbsp;<span class="ident" id="6010002">i</span>&nbsp;<span class="op" id="6010004">&gt;</span>&nbsp;<span class="num" id="6010006">0</span>&nbsp;<span class="op" id="6010008">&amp;&amp;</span>&nbsp;<span class="ident" id="6010011">line</span>&nbsp;<span class="op" id="6010016">!=</span>&nbsp;<span class="string" id="6010019">&#34;&#34;</span>&nbsp;<span class="op" id="6010022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010027">lines</span><span class="op" id="6010032">[</span><span class="ident" id="6010033">i</span><span class="op" id="6010034">]</span>&nbsp;<span class="op" id="6010036">=</span>&nbsp;<span class="ident" id="6010038">line</span><span class="op" id="6010042">[</span><span class="builtinfunc" id="6010043">len</span><span class="op" id="6010046">(</span><span class="ident" id="6010047">prefix</span><span class="op" id="6010053">)</span><span class="op" id="6010054">:</span><span class="op" id="6010055">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010059">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010062">}</span><br>
<span class="lineno"></span><span class="op" id="6010064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6010067">func</span>&nbsp;<span class="op" id="6010072">(</span><span class="ident" id="6010073">p</span>&nbsp;<span class="op" id="6010075">*</span><span class="ident" id="6010076">printer</span><span class="op" id="6010083">)</span>&nbsp;<span class="ident" id="6010085">writeComment</span><span class="op" id="6010097">(</span><span class="ident" id="6010098">comment</span>&nbsp;<span class="op" id="6010106">*</span><span class="ident" id="6010107">ast</span><span class="op" id="6010110">.</span><span class="ident" id="6010111">Comment</span><span class="op" id="6010118">)</span>&nbsp;<span class="op" id="6010120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010123">text</span>&nbsp;<span class="op" id="6010128">:=</span>&nbsp;<span class="ident" id="6010131">comment</span><span class="op" id="6010138">.</span><span class="ident" id="6010139">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010145">pos</span>&nbsp;<span class="op" id="6010149">:=</span>&nbsp;<span class="ident" id="6010152">p</span><span class="op" id="6010153">.</span><span class="ident" id="6010154">posFor</span><span class="op" id="6010160">(</span><span class="ident" id="6010161">comment</span><span class="op" id="6010168">.</span><span class="ident" id="6010169">Pos</span><span class="op" id="6010172">(</span><span class="op" id="6010173">)</span><span class="op" id="6010174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010178">const</span>&nbsp;<span class="ident" id="6010184">linePrefix</span>&nbsp;<span class="op" id="6010195">=</span>&nbsp;<span class="string" id="6010197">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010208">if</span>&nbsp;<span class="ident" id="6010211">strings</span><span class="op" id="6010218">.</span><span class="ident" id="6010219">HasPrefix</span><span class="op" id="6010228">(</span><span class="ident" id="6010229">text</span><span class="op" id="6010233">,</span>&nbsp;<span class="ident" id="6010235">linePrefix</span><span class="op" id="6010245">)</span>&nbsp;<span class="op" id="6010247">&amp;&amp;</span>&nbsp;<span class="op" id="6010250">(</span><span class="op" id="6010251">!</span><span class="ident" id="6010252">pos</span><span class="op" id="6010255">.</span><span class="ident" id="6010256">IsValid</span><span class="op" id="6010263">(</span><span class="op" id="6010264">)</span>&nbsp;<span class="op" id="6010266">||</span>&nbsp;<span class="ident" id="6010269">pos</span><span class="op" id="6010272">.</span><span class="ident" id="6010273">Column</span>&nbsp;<span class="op" id="6010280">==</span>&nbsp;<span class="num" id="6010283">1</span><span class="op" id="6010284">)</span>&nbsp;<span class="op" id="6010286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010290">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010321">ldir</span>&nbsp;<span class="op" id="6010326">:=</span>&nbsp;<span class="ident" id="6010329">strings</span><span class="op" id="6010336">.</span><span class="ident" id="6010337">TrimSpace</span><span class="op" id="6010346">(</span><span class="ident" id="6010347">text</span><span class="op" id="6010351">[</span><span class="builtinfunc" id="6010352">len</span><span class="op" id="6010355">(</span><span class="ident" id="6010356">linePrefix</span><span class="op" id="6010366">)</span><span class="op" id="6010367">:</span><span class="op" id="6010368">]</span><span class="op" id="6010369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010373">if</span>&nbsp;<span class="ident" id="6010376">i</span>&nbsp;<span class="op" id="6010378">:=</span>&nbsp;<span class="ident" id="6010381">strings</span><span class="op" id="6010388">.</span><span class="ident" id="6010389">LastIndex</span><span class="op" id="6010398">(</span><span class="ident" id="6010399">ldir</span><span class="op" id="6010403">,</span>&nbsp;<span class="string" id="6010405">&#34;:&#34;</span><span class="op" id="6010408">)</span><span class="op" id="6010409">;</span>&nbsp;<span class="ident" id="6010411">i</span>&nbsp;<span class="op" id="6010413">&gt;=</span>&nbsp;<span class="num" id="6010416">0</span>&nbsp;<span class="op" id="6010418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010423">if</span>&nbsp;<span class="ident" id="6010426">line</span><span class="op" id="6010430">,</span>&nbsp;<span class="ident" id="6010432">err</span>&nbsp;<span class="op" id="6010436">:=</span>&nbsp;<span class="ident" id="6010439">strconv</span><span class="op" id="6010446">.</span><span class="ident" id="6010447">Atoi</span><span class="op" id="6010451">(</span><span class="ident" id="6010452">ldir</span><span class="op" id="6010456">[</span><span class="ident" id="6010457">i</span><span class="op" id="6010458">+</span><span class="num" id="6010459">1</span><span class="op" id="6010460">:</span><span class="op" id="6010461">]</span><span class="op" id="6010462">)</span><span class="op" id="6010463">;</span>&nbsp;<span class="ident" id="6010465">err</span>&nbsp;<span class="op" id="6010469">==</span>&nbsp;<span class="ident" id="6010472">nil</span>&nbsp;<span class="op" id="6010476">&amp;&amp;</span>&nbsp;<span class="ident" id="6010479">line</span>&nbsp;<span class="op" id="6010484">&gt;</span>&nbsp;<span class="num" id="6010486">0</span>&nbsp;<span class="op" id="6010488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010494">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010550">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010606">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010662">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010718">indent</span>&nbsp;<span class="op" id="6010725">:=</span>&nbsp;<span class="ident" id="6010728">p</span><span class="op" id="6010729">.</span><span class="ident" id="6010730">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010741">p</span><span class="op" id="6010742">.</span><span class="ident" id="6010743">indent</span>&nbsp;<span class="op" id="6010750">=</span>&nbsp;<span class="num" id="6010752">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010758">defer</span>&nbsp;<span class="keyword" id="6010764">func</span><span class="op" id="6010768">(</span><span class="op" id="6010769">)</span>&nbsp;<span class="op" id="6010771">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010778">p</span><span class="op" id="6010779">.</span><span class="ident" id="6010780">pos</span><span class="op" id="6010783">.</span><span class="ident" id="6010784">Filename</span>&nbsp;<span class="op" id="6010793">=</span>&nbsp;<span class="ident" id="6010795">ldir</span><span class="op" id="6010799">[</span><span class="op" id="6010800">:</span><span class="ident" id="6010801">i</span><span class="op" id="6010802">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010809">p</span><span class="op" id="6010810">.</span><span class="ident" id="6010811">pos</span><span class="op" id="6010814">.</span><span class="ident" id="6010815">Line</span>&nbsp;<span class="op" id="6010820">=</span>&nbsp;<span class="ident" id="6010822">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010832">p</span><span class="op" id="6010833">.</span><span class="ident" id="6010834">pos</span><span class="op" id="6010837">.</span><span class="ident" id="6010838">Column</span>&nbsp;<span class="op" id="6010845">=</span>&nbsp;<span class="num" id="6010847">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010854">p</span><span class="op" id="6010855">.</span><span class="ident" id="6010856">indent</span>&nbsp;<span class="op" id="6010863">=</span>&nbsp;<span class="ident" id="6010865">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010876">}</span><span class="op" id="6010877">(</span><span class="op" id="6010878">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010894">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010940">if</span>&nbsp;<span class="ident" id="6010943">text</span><span class="op" id="6010947">[</span><span class="num" id="6010948">1</span><span class="op" id="6010949">]</span>&nbsp;<span class="op" id="6010951">==</span>&nbsp;<span class="string" id="6010954">&#39;/&#39;</span>&nbsp;<span class="op" id="6010958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010962">p</span><span class="op" id="6010963">.</span><span class="ident" id="6010964">writeString</span><span class="op" id="6010975">(</span><span class="ident" id="6010976">pos</span><span class="op" id="6010979">,</span>&nbsp;<span class="ident" id="6010981">trimRight</span><span class="op" id="6010990">(</span><span class="ident" id="6010991">text</span><span class="op" id="6010995">)</span><span class="op" id="6010996">,</span>&nbsp;<span class="builtintype" id="6010998">true</span><span class="op" id="6011002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011006">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011018">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011076">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011131">lines</span>&nbsp;<span class="op" id="6011137">:=</span>&nbsp;<span class="ident" id="6011140">strings</span><span class="op" id="6011147">.</span><span class="ident" id="6011148">Split</span><span class="op" id="6011153">(</span><span class="ident" id="6011154">text</span><span class="op" id="6011158">,</span>&nbsp;<span class="string" id="6011160">&#34;\n&#34;</span><span class="op" id="6011164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011168">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011225">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011287">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011348">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011411">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011471">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011501">if</span>&nbsp;<span class="ident" id="6011504">pos</span><span class="op" id="6011507">.</span><span class="ident" id="6011508">IsValid</span><span class="op" id="6011515">(</span><span class="op" id="6011516">)</span>&nbsp;<span class="op" id="6011518">&amp;&amp;</span>&nbsp;<span class="ident" id="6011521">pos</span><span class="op" id="6011524">.</span><span class="ident" id="6011525">Column</span>&nbsp;<span class="op" id="6011532">==</span>&nbsp;<span class="num" id="6011535">1</span>&nbsp;<span class="op" id="6011537">&amp;&amp;</span>&nbsp;<span class="ident" id="6011540">p</span><span class="op" id="6011541">.</span><span class="ident" id="6011542">indent</span>&nbsp;<span class="op" id="6011549">&gt;</span>&nbsp;<span class="num" id="6011551">0</span>&nbsp;<span class="op" id="6011553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011557">for</span>&nbsp;<span class="ident" id="6011561">i</span><span class="op" id="6011562">,</span>&nbsp;<span class="ident" id="6011564">line</span>&nbsp;<span class="op" id="6011569">:=</span>&nbsp;<span class="keyword" id="6011572">range</span>&nbsp;<span class="ident" id="6011578">lines</span><span class="op" id="6011583">[</span><span class="num" id="6011584">1</span><span class="op" id="6011585">:</span><span class="op" id="6011586">]</span>&nbsp;<span class="op" id="6011588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011593">lines</span><span class="op" id="6011598">[</span><span class="num" id="6011599">1</span><span class="op" id="6011600">+</span><span class="ident" id="6011601">i</span><span class="op" id="6011602">]</span>&nbsp;<span class="op" id="6011604">=</span>&nbsp;<span class="string" id="6011606">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="6011612">+</span>&nbsp;<span class="ident" id="6011614">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011624">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011628">stripCommonPrefix</span><span class="op" id="6011645">(</span><span class="ident" id="6011646">lines</span><span class="op" id="6011651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011655">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011703">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011748">for</span>&nbsp;<span class="ident" id="6011752">i</span><span class="op" id="6011753">,</span>&nbsp;<span class="ident" id="6011755">line</span>&nbsp;<span class="op" id="6011760">:=</span>&nbsp;<span class="keyword" id="6011763">range</span>&nbsp;<span class="ident" id="6011769">lines</span>&nbsp;<span class="op" id="6011775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011779">if</span>&nbsp;<span class="ident" id="6011782">i</span>&nbsp;<span class="op" id="6011784">&gt;</span>&nbsp;<span class="num" id="6011786">0</span>&nbsp;<span class="op" id="6011788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011793">p</span><span class="op" id="6011794">.</span><span class="ident" id="6011795">writeByte</span><span class="op" id="6011804">(</span><span class="string" id="6011805">&#39;\f&#39;</span><span class="op" id="6011809">,</span>&nbsp;<span class="num" id="6011811">1</span><span class="op" id="6011812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011817">pos</span>&nbsp;<span class="op" id="6011821">=</span>&nbsp;<span class="ident" id="6011823">p</span><span class="op" id="6011824">.</span><span class="ident" id="6011825">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011831">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011835">if</span>&nbsp;<span class="builtinfunc" id="6011838">len</span><span class="op" id="6011841">(</span><span class="ident" id="6011842">line</span><span class="op" id="6011846">)</span>&nbsp;<span class="op" id="6011848">&gt;</span>&nbsp;<span class="num" id="6011850">0</span>&nbsp;<span class="op" id="6011852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011857">p</span><span class="op" id="6011858">.</span><span class="ident" id="6011859">writeString</span><span class="op" id="6011870">(</span><span class="ident" id="6011871">pos</span><span class="op" id="6011874">,</span>&nbsp;<span class="ident" id="6011876">trimRight</span><span class="op" id="6011885">(</span><span class="ident" id="6011886">line</span><span class="op" id="6011890">)</span><span class="op" id="6011891">,</span>&nbsp;<span class="builtintype" id="6011893">true</span><span class="op" id="6011897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011904">}</span><br>
<span class="lineno"></span><span class="op" id="6011906">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="6011909">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="6011980">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="6012051">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6012120">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="6012188">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6012260">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6012271">//</span><br>
<span class="lineno"></span><span class="keyword" id="6012274">func</span>&nbsp;<span class="op" id="6012279">(</span><span class="ident" id="6012280">p</span>&nbsp;<span class="op" id="6012282">*</span><span class="ident" id="6012283">printer</span><span class="op" id="6012290">)</span>&nbsp;<span class="ident" id="6012292">writeCommentSuffix</span><span class="op" id="6012310">(</span><span class="ident" id="6012311">needsLinebreak</span>&nbsp;<span class="builtintype" id="6012326">bool</span><span class="op" id="6012330">)</span>&nbsp;<span class="op" id="6012332">(</span><span class="ident" id="6012333">wroteNewline</span><span class="op" id="6012345">,</span>&nbsp;<span class="ident" id="6012347">droppedFF</span>&nbsp;<span class="builtintype" id="6012357">bool</span><span class="op" id="6012361">)</span>&nbsp;<span class="op" id="6012363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012366">for</span>&nbsp;<span class="ident" id="6012370">i</span><span class="op" id="6012371">,</span>&nbsp;<span class="ident" id="6012373">ch</span>&nbsp;<span class="op" id="6012376">:=</span>&nbsp;<span class="keyword" id="6012379">range</span>&nbsp;<span class="ident" id="6012385">p</span><span class="op" id="6012386">.</span><span class="ident" id="6012387">wsbuf</span>&nbsp;<span class="op" id="6012393">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012397">switch</span>&nbsp;<span class="ident" id="6012404">ch</span>&nbsp;<span class="op" id="6012407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012411">case</span>&nbsp;<span class="ident" id="6012416">blank</span><span class="op" id="6012421">,</span>&nbsp;<span class="ident" id="6012423">vtab</span><span class="op" id="6012427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012432">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012465">p</span><span class="op" id="6012466">.</span><span class="ident" id="6012467">wsbuf</span><span class="op" id="6012472">[</span><span class="ident" id="6012473">i</span><span class="op" id="6012474">]</span>&nbsp;<span class="op" id="6012476">=</span>&nbsp;<span class="ident" id="6012478">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012487">case</span>&nbsp;<span class="ident" id="6012492">indent</span><span class="op" id="6012498">,</span>&nbsp;<span class="ident" id="6012500">unindent</span><span class="op" id="6012508">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012513">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012553">case</span>&nbsp;<span class="ident" id="6012558">newline</span><span class="op" id="6012565">,</span>&nbsp;<span class="ident" id="6012567">formfeed</span><span class="op" id="6012575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012580">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012628">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012675">if</span>&nbsp;<span class="ident" id="6012678">needsLinebreak</span>&nbsp;<span class="op" id="6012693">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012699">needsLinebreak</span>&nbsp;<span class="op" id="6012714">=</span>&nbsp;<span class="builtintype" id="6012716">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012726">wroteNewline</span>&nbsp;<span class="op" id="6012739">=</span>&nbsp;<span class="builtintype" id="6012741">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012749">}</span>&nbsp;<span class="keyword" id="6012751">else</span>&nbsp;<span class="op" id="6012756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012762">if</span>&nbsp;<span class="ident" id="6012765">ch</span>&nbsp;<span class="op" id="6012768">==</span>&nbsp;<span class="ident" id="6012771">formfeed</span>&nbsp;<span class="op" id="6012780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012787">droppedFF</span>&nbsp;<span class="op" id="6012797">=</span>&nbsp;<span class="builtintype" id="6012799">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012814">p</span><span class="op" id="6012815">.</span><span class="ident" id="6012816">wsbuf</span><span class="op" id="6012821">[</span><span class="ident" id="6012822">i</span><span class="op" id="6012823">]</span>&nbsp;<span class="op" id="6012825">=</span>&nbsp;<span class="ident" id="6012827">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012844">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012847">p</span><span class="op" id="6012848">.</span><span class="ident" id="6012849">writeWhitespace</span><span class="op" id="6012864">(</span><span class="builtinfunc" id="6012865">len</span><span class="op" id="6012868">(</span><span class="ident" id="6012869">p</span><span class="op" id="6012870">.</span><span class="ident" id="6012871">wsbuf</span><span class="op" id="6012876">)</span><span class="op" id="6012877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012881">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012916">if</span>&nbsp;<span class="ident" id="6012919">needsLinebreak</span>&nbsp;<span class="op" id="6012934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012938">p</span><span class="op" id="6012939">.</span><span class="ident" id="6012940">writeByte</span><span class="op" id="6012949">(</span><span class="string" id="6012950">&#39;\n&#39;</span><span class="op" id="6012954">,</span>&nbsp;<span class="num" id="6012956">1</span><span class="op" id="6012957">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012961">wroteNewline</span>&nbsp;<span class="op" id="6012974">=</span>&nbsp;<span class="builtintype" id="6012976">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012986">return</span><br>
<span class="lineno"></span><span class="op" id="6012993">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="6012996">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="6013075">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6013156">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="6013235">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="6013313">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6013393">//</span><br>
<span class="lineno"></span><span class="keyword" id="6013396">func</span>&nbsp;<span class="op" id="6013401">(</span><span class="ident" id="6013402">p</span>&nbsp;<span class="op" id="6013404">*</span><span class="ident" id="6013405">printer</span><span class="op" id="6013412">)</span>&nbsp;<span class="ident" id="6013414">intersperseComments</span><span class="op" id="6013433">(</span><span class="ident" id="6013434">next</span>&nbsp;<span class="ident" id="6013439">token</span><span class="op" id="6013444">.</span><span class="ident" id="6013445">Position</span><span class="op" id="6013453">,</span>&nbsp;<span class="ident" id="6013455">tok</span>&nbsp;<span class="ident" id="6013459">token</span><span class="op" id="6013464">.</span><span class="ident" id="6013465">Token</span><span class="op" id="6013470">)</span>&nbsp;<span class="op" id="6013472">(</span><span class="ident" id="6013473">wroteNewline</span><span class="op" id="6013485">,</span>&nbsp;<span class="ident" id="6013487">droppedFF</span>&nbsp;<span class="builtintype" id="6013497">bool</span><span class="op" id="6013501">)</span>&nbsp;<span class="op" id="6013503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013506">var</span>&nbsp;<span class="ident" id="6013510">last</span>&nbsp;<span class="op" id="6013515">*</span><span class="ident" id="6013516">ast</span><span class="op" id="6013519">.</span><span class="ident" id="6013520">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013529">for</span>&nbsp;<span class="ident" id="6013533">p</span><span class="op" id="6013534">.</span><span class="ident" id="6013535">commentBefore</span><span class="op" id="6013548">(</span><span class="ident" id="6013549">next</span><span class="op" id="6013553">)</span>&nbsp;<span class="op" id="6013555">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013559">for</span>&nbsp;<span class="ident" id="6013563">_</span><span class="op" id="6013564">,</span>&nbsp;<span class="ident" id="6013566">c</span>&nbsp;<span class="op" id="6013568">:=</span>&nbsp;<span class="keyword" id="6013571">range</span>&nbsp;<span class="ident" id="6013577">p</span><span class="op" id="6013578">.</span><span class="ident" id="6013579">comment</span><span class="op" id="6013586">.</span><span class="ident" id="6013587">List</span>&nbsp;<span class="op" id="6013592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013597">p</span><span class="op" id="6013598">.</span><span class="ident" id="6013599">writeCommentPrefix</span><span class="op" id="6013617">(</span><span class="ident" id="6013618">p</span><span class="op" id="6013619">.</span><span class="ident" id="6013620">posFor</span><span class="op" id="6013626">(</span><span class="ident" id="6013627">c</span><span class="op" id="6013628">.</span><span class="ident" id="6013629">Pos</span><span class="op" id="6013632">(</span><span class="op" id="6013633">)</span><span class="op" id="6013634">)</span><span class="op" id="6013635">,</span>&nbsp;<span class="ident" id="6013637">next</span><span class="op" id="6013641">,</span>&nbsp;<span class="ident" id="6013643">last</span><span class="op" id="6013647">,</span>&nbsp;<span class="ident" id="6013649">c</span><span class="op" id="6013650">,</span>&nbsp;<span class="ident" id="6013652">tok</span><span class="op" id="6013655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013660">p</span><span class="op" id="6013661">.</span><span class="ident" id="6013662">writeComment</span><span class="op" id="6013674">(</span><span class="ident" id="6013675">c</span><span class="op" id="6013676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013681">last</span>&nbsp;<span class="op" id="6013686">=</span>&nbsp;<span class="ident" id="6013688">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013692">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013696">p</span><span class="op" id="6013697">.</span><span class="ident" id="6013698">nextComment</span><span class="op" id="6013709">(</span><span class="op" id="6013710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013717">if</span>&nbsp;<span class="ident" id="6013720">last</span>&nbsp;<span class="op" id="6013725">!=</span>&nbsp;<span class="ident" id="6013728">nil</span>&nbsp;<span class="op" id="6013732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013736">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013801">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013871">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013939">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014005">if</span>&nbsp;<span class="ident" id="6014008">p</span><span class="op" id="6014009">.</span><span class="ident" id="6014010">mode</span><span class="op" id="6014014">&amp;</span><span class="ident" id="6014015">noExtraBlank</span>&nbsp;<span class="op" id="6014028">==</span>&nbsp;<span class="num" id="6014031">0</span>&nbsp;<span class="op" id="6014033">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014039">last</span><span class="op" id="6014043">.</span><span class="ident" id="6014044">Text</span><span class="op" id="6014048">[</span><span class="num" id="6014049">1</span><span class="op" id="6014050">]</span>&nbsp;<span class="op" id="6014052">==</span>&nbsp;<span class="string" id="6014055">&#39;*&#39;</span>&nbsp;<span class="op" id="6014059">&amp;&amp;</span>&nbsp;<span class="ident" id="6014062">p</span><span class="op" id="6014063">.</span><span class="ident" id="6014064">lineFor</span><span class="op" id="6014071">(</span><span class="ident" id="6014072">last</span><span class="op" id="6014076">.</span><span class="ident" id="6014077">Pos</span><span class="op" id="6014080">(</span><span class="op" id="6014081">)</span><span class="op" id="6014082">)</span>&nbsp;<span class="op" id="6014084">==</span>&nbsp;<span class="ident" id="6014087">next</span><span class="op" id="6014091">.</span><span class="ident" id="6014092">Line</span>&nbsp;<span class="op" id="6014097">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014103">tok</span>&nbsp;<span class="op" id="6014107">!=</span>&nbsp;<span class="ident" id="6014110">token</span><span class="op" id="6014115">.</span><span class="ident" id="6014116">COMMA</span>&nbsp;<span class="op" id="6014122">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014128">(</span><span class="ident" id="6014129">tok</span>&nbsp;<span class="op" id="6014133">!=</span>&nbsp;<span class="ident" id="6014136">token</span><span class="op" id="6014141">.</span><span class="ident" id="6014142">RPAREN</span>&nbsp;<span class="op" id="6014149">||</span>&nbsp;<span class="ident" id="6014152">p</span><span class="op" id="6014153">.</span><span class="ident" id="6014154">prevOpen</span>&nbsp;<span class="op" id="6014163">==</span>&nbsp;<span class="ident" id="6014166">token</span><span class="op" id="6014171">.</span><span class="ident" id="6014172">LPAREN</span><span class="op" id="6014178">)</span>&nbsp;<span class="op" id="6014180">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014186">(</span><span class="ident" id="6014187">tok</span>&nbsp;<span class="op" id="6014191">!=</span>&nbsp;<span class="ident" id="6014194">token</span><span class="op" id="6014199">.</span><span class="ident" id="6014200">RBRACK</span>&nbsp;<span class="op" id="6014207">||</span>&nbsp;<span class="ident" id="6014210">p</span><span class="op" id="6014211">.</span><span class="ident" id="6014212">prevOpen</span>&nbsp;<span class="op" id="6014221">==</span>&nbsp;<span class="ident" id="6014224">token</span><span class="op" id="6014229">.</span><span class="ident" id="6014230">LBRACK</span><span class="op" id="6014236">)</span>&nbsp;<span class="op" id="6014238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014243">p</span><span class="op" id="6014244">.</span><span class="ident" id="6014245">writeByte</span><span class="op" id="6014254">(</span><span class="string" id="6014255">&#39;&nbsp;&#39;</span><span class="op" id="6014258">,</span>&nbsp;<span class="num" id="6014260">1</span><span class="op" id="6014261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014265">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014269">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014334">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014398">needsLinebreak</span>&nbsp;<span class="op" id="6014413">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014419">last</span><span class="op" id="6014423">.</span><span class="ident" id="6014424">Text</span><span class="op" id="6014428">[</span><span class="num" id="6014429">1</span><span class="op" id="6014430">]</span>&nbsp;<span class="op" id="6014432">==</span>&nbsp;<span class="string" id="6014435">&#39;/&#39;</span>&nbsp;<span class="op" id="6014439">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014446">tok</span>&nbsp;<span class="op" id="6014450">==</span>&nbsp;<span class="ident" id="6014453">token</span><span class="op" id="6014458">.</span><span class="ident" id="6014459">RBRACE</span>&nbsp;<span class="op" id="6014466">&amp;&amp;</span>&nbsp;<span class="ident" id="6014469">p</span><span class="op" id="6014470">.</span><span class="ident" id="6014471">mode</span><span class="op" id="6014475">&amp;</span><span class="ident" id="6014476">noExtraLinebreak</span>&nbsp;<span class="op" id="6014493">==</span>&nbsp;<span class="num" id="6014496">0</span>&nbsp;<span class="op" id="6014498">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014505">tok</span>&nbsp;<span class="op" id="6014509">==</span>&nbsp;<span class="ident" id="6014512">token</span><span class="op" id="6014517">.</span><span class="ident" id="6014518">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014524">return</span>&nbsp;<span class="ident" id="6014531">p</span><span class="op" id="6014532">.</span><span class="ident" id="6014533">writeCommentSuffix</span><span class="op" id="6014551">(</span><span class="ident" id="6014552">needsLinebreak</span><span class="op" id="6014566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014573">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014635">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014693">p</span><span class="op" id="6014694">.</span><span class="ident" id="6014695">internalError</span><span class="op" id="6014708">(</span><span class="string" id="6014709">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="6014762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014765">return</span><br>
<span class="lineno"></span><span class="op" id="6014772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="6014775">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="6014833">func</span>&nbsp;<span class="op" id="6014838">(</span><span class="ident" id="6014839">p</span>&nbsp;<span class="op" id="6014841">*</span><span class="ident" id="6014842">printer</span><span class="op" id="6014849">)</span>&nbsp;<span class="ident" id="6014851">writeWhitespace</span><span class="op" id="6014866">(</span><span class="ident" id="6014867">n</span>&nbsp;<span class="builtintype" id="6014869">int</span><span class="op" id="6014872">)</span>&nbsp;<span class="op" id="6014874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014877">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014895">for</span>&nbsp;<span class="ident" id="6014899">i</span>&nbsp;<span class="op" id="6014901">:=</span>&nbsp;<span class="num" id="6014904">0</span><span class="op" id="6014905">;</span>&nbsp;<span class="ident" id="6014907">i</span>&nbsp;<span class="op" id="6014909">&lt;</span>&nbsp;<span class="ident" id="6014911">n</span><span class="op" id="6014912">;</span>&nbsp;<span class="ident" id="6014914">i</span><span class="op" id="6014915">++</span>&nbsp;<span class="op" id="6014918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014922">switch</span>&nbsp;<span class="ident" id="6014929">ch</span>&nbsp;<span class="op" id="6014932">:=</span>&nbsp;<span class="ident" id="6014935">p</span><span class="op" id="6014936">.</span><span class="ident" id="6014937">wsbuf</span><span class="op" id="6014942">[</span><span class="ident" id="6014943">i</span><span class="op" id="6014944">]</span><span class="op" id="6014945">;</span>&nbsp;<span class="ident" id="6014947">ch</span>&nbsp;<span class="op" id="6014950">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014954">case</span>&nbsp;<span class="ident" id="6014959">ignore</span><span class="op" id="6014965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014970">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014983">case</span>&nbsp;<span class="ident" id="6014988">indent</span><span class="op" id="6014994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014999">p</span><span class="op" id="6015000">.</span><span class="ident" id="6015001">indent</span><span class="op" id="6015007">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015012">case</span>&nbsp;<span class="ident" id="6015017">unindent</span><span class="op" id="6015025">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015030">p</span><span class="op" id="6015031">.</span><span class="ident" id="6015032">indent</span><span class="op" id="6015038">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015044">if</span>&nbsp;<span class="ident" id="6015047">p</span><span class="op" id="6015048">.</span><span class="ident" id="6015049">indent</span>&nbsp;<span class="op" id="6015056">&lt;</span>&nbsp;<span class="num" id="6015058">0</span>&nbsp;<span class="op" id="6015060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015066">p</span><span class="op" id="6015067">.</span><span class="ident" id="6015068">internalError</span><span class="op" id="6015081">(</span><span class="string" id="6015082">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="6015105">,</span>&nbsp;<span class="ident" id="6015107">p</span><span class="op" id="6015108">.</span><span class="ident" id="6015109">indent</span><span class="op" id="6015115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015121">p</span><span class="op" id="6015122">.</span><span class="ident" id="6015123">indent</span>&nbsp;<span class="op" id="6015130">=</span>&nbsp;<span class="num" id="6015132">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015137">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015141">case</span>&nbsp;<span class="ident" id="6015146">newline</span><span class="op" id="6015153">,</span>&nbsp;<span class="ident" id="6015155">formfeed</span><span class="op" id="6015163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015168">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015226">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015285">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015341">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015397">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015457">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015502">if</span>&nbsp;<span class="ident" id="6015505">i</span><span class="op" id="6015506">+</span><span class="num" id="6015507">1</span>&nbsp;<span class="op" id="6015509">&lt;</span>&nbsp;<span class="ident" id="6015511">n</span>&nbsp;<span class="op" id="6015513">&amp;&amp;</span>&nbsp;<span class="ident" id="6015516">p</span><span class="op" id="6015517">.</span><span class="ident" id="6015518">wsbuf</span><span class="op" id="6015523">[</span><span class="ident" id="6015524">i</span><span class="op" id="6015525">+</span><span class="num" id="6015526">1</span><span class="op" id="6015527">]</span>&nbsp;<span class="op" id="6015529">==</span>&nbsp;<span class="ident" id="6015532">unindent</span>&nbsp;<span class="op" id="6015541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015547">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015603">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015664">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015724">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015787">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015807">p</span><span class="op" id="6015808">.</span><span class="ident" id="6015809">wsbuf</span><span class="op" id="6015814">[</span><span class="ident" id="6015815">i</span><span class="op" id="6015816">]</span><span class="op" id="6015817">,</span>&nbsp;<span class="ident" id="6015819">p</span><span class="op" id="6015820">.</span><span class="ident" id="6015821">wsbuf</span><span class="op" id="6015826">[</span><span class="ident" id="6015827">i</span><span class="op" id="6015828">+</span><span class="num" id="6015829">1</span><span class="op" id="6015830">]</span>&nbsp;<span class="op" id="6015832">=</span>&nbsp;<span class="ident" id="6015834">unindent</span><span class="op" id="6015842">,</span>&nbsp;<span class="ident" id="6015844">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015857">i</span><span class="op" id="6015858">--</span>&nbsp;<span class="comment" id="6015861">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015880">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015897">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015911">default</span><span class="op" id="6015918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015923">p</span><span class="op" id="6015924">.</span><span class="ident" id="6015925">writeByte</span><span class="op" id="6015934">(</span><span class="builtintype" id="6015935">byte</span><span class="op" id="6015939">(</span><span class="ident" id="6015940">ch</span><span class="op" id="6015942">)</span><span class="op" id="6015943">,</span>&nbsp;<span class="num" id="6015945">1</span><span class="op" id="6015946">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015957">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015990">l</span>&nbsp;<span class="op" id="6015992">:=</span>&nbsp;<span class="builtinfunc" id="6015995">copy</span><span class="op" id="6015999">(</span><span class="ident" id="6016000">p</span><span class="op" id="6016001">.</span><span class="ident" id="6016002">wsbuf</span><span class="op" id="6016007">,</span>&nbsp;<span class="ident" id="6016009">p</span><span class="op" id="6016010">.</span><span class="ident" id="6016011">wsbuf</span><span class="op" id="6016016">[</span><span class="ident" id="6016017">n</span><span class="op" id="6016018">:</span><span class="op" id="6016019">]</span><span class="op" id="6016020">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016023">p</span><span class="op" id="6016024">.</span><span class="ident" id="6016025">wsbuf</span>&nbsp;<span class="op" id="6016031">=</span>&nbsp;<span class="ident" id="6016033">p</span><span class="op" id="6016034">.</span><span class="ident" id="6016035">wsbuf</span><span class="op" id="6016040">[</span><span class="op" id="6016041">:</span><span class="ident" id="6016042">l</span><span class="op" id="6016043">]</span><br>
<span class="lineno"></span><span class="op" id="6016045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6016048">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6016128">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="6016151">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="6016186">func</span>&nbsp;<span class="ident" id="6016191">nlimit</span><span class="op" id="6016197">(</span><span class="ident" id="6016198">n</span>&nbsp;<span class="builtintype" id="6016200">int</span><span class="op" id="6016203">)</span>&nbsp;<span class="builtintype" id="6016205">int</span>&nbsp;<span class="op" id="6016209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016212">if</span>&nbsp;<span class="ident" id="6016215">n</span>&nbsp;<span class="op" id="6016217">&gt;</span>&nbsp;<span class="ident" id="6016219">maxNewlines</span>&nbsp;<span class="op" id="6016231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016235">n</span>&nbsp;<span class="op" id="6016237">=</span>&nbsp;<span class="ident" id="6016239">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016255">return</span>&nbsp;<span class="ident" id="6016262">n</span><br>
<span class="lineno"></span><span class="op" id="6016264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6016267">func</span>&nbsp;<span class="ident" id="6016272">mayCombine</span><span class="op" id="6016282">(</span><span class="ident" id="6016283">prev</span>&nbsp;<span class="ident" id="6016288">token</span><span class="op" id="6016293">.</span><span class="ident" id="6016294">Token</span><span class="op" id="6016299">,</span>&nbsp;<span class="ident" id="6016301">next</span>&nbsp;<span class="builtintype" id="6016306">byte</span><span class="op" id="6016310">)</span>&nbsp;<span class="op" id="6016312">(</span><span class="ident" id="6016313">b</span>&nbsp;<span class="builtintype" id="6016315">bool</span><span class="op" id="6016319">)</span>&nbsp;<span class="op" id="6016321">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016324">switch</span>&nbsp;<span class="ident" id="6016331">prev</span>&nbsp;<span class="op" id="6016336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016339">case</span>&nbsp;<span class="ident" id="6016344">token</span><span class="op" id="6016349">.</span><span class="ident" id="6016350">INT</span><span class="op" id="6016353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016357">b</span>&nbsp;<span class="op" id="6016359">=</span>&nbsp;<span class="ident" id="6016361">next</span>&nbsp;<span class="op" id="6016366">==</span>&nbsp;<span class="string" id="6016369">&#39;.&#39;</span>&nbsp;<span class="comment" id="6016373">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016380">case</span>&nbsp;<span class="ident" id="6016385">token</span><span class="op" id="6016390">.</span><span class="ident" id="6016391">ADD</span><span class="op" id="6016394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016398">b</span>&nbsp;<span class="op" id="6016400">=</span>&nbsp;<span class="ident" id="6016402">next</span>&nbsp;<span class="op" id="6016407">==</span>&nbsp;<span class="string" id="6016410">&#39;+&#39;</span>&nbsp;<span class="comment" id="6016414">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016421">case</span>&nbsp;<span class="ident" id="6016426">token</span><span class="op" id="6016431">.</span><span class="ident" id="6016432">SUB</span><span class="op" id="6016435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016439">b</span>&nbsp;<span class="op" id="6016441">=</span>&nbsp;<span class="ident" id="6016443">next</span>&nbsp;<span class="op" id="6016448">==</span>&nbsp;<span class="string" id="6016451">&#39;-&#39;</span>&nbsp;<span class="comment" id="6016455">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016462">case</span>&nbsp;<span class="ident" id="6016467">token</span><span class="op" id="6016472">.</span><span class="ident" id="6016473">QUO</span><span class="op" id="6016476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016480">b</span>&nbsp;<span class="op" id="6016482">=</span>&nbsp;<span class="ident" id="6016484">next</span>&nbsp;<span class="op" id="6016489">==</span>&nbsp;<span class="string" id="6016492">&#39;*&#39;</span>&nbsp;<span class="comment" id="6016496">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016503">case</span>&nbsp;<span class="ident" id="6016508">token</span><span class="op" id="6016513">.</span><span class="ident" id="6016514">LSS</span><span class="op" id="6016517">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016521">b</span>&nbsp;<span class="op" id="6016523">=</span>&nbsp;<span class="ident" id="6016525">next</span>&nbsp;<span class="op" id="6016530">==</span>&nbsp;<span class="string" id="6016533">&#39;-&#39;</span>&nbsp;<span class="op" id="6016537">||</span>&nbsp;<span class="ident" id="6016540">next</span>&nbsp;<span class="op" id="6016545">==</span>&nbsp;<span class="string" id="6016548">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="6016552">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016565">case</span>&nbsp;<span class="ident" id="6016570">token</span><span class="op" id="6016575">.</span><span class="ident" id="6016576">AND</span><span class="op" id="6016579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016583">b</span>&nbsp;<span class="op" id="6016585">=</span>&nbsp;<span class="ident" id="6016587">next</span>&nbsp;<span class="op" id="6016592">==</span>&nbsp;<span class="string" id="6016595">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="6016599">||</span>&nbsp;<span class="ident" id="6016602">next</span>&nbsp;<span class="op" id="6016607">==</span>&nbsp;<span class="string" id="6016610">&#39;^&#39;</span>&nbsp;<span class="comment" id="6016614">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016630">return</span><br>
<span class="lineno">825</span><span class="op" id="6016637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6016640">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="6016710">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="6016780">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="6016849">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="6016899">//</span><br>
<span class="lineno"></span><span class="comment" id="6016902">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="6016973">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="6017042">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="6017112">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6017182">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6017224">//</span><br>
<span class="lineno"></span><span class="keyword" id="6017227">func</span>&nbsp;<span class="op" id="6017232">(</span><span class="ident" id="6017233">p</span>&nbsp;<span class="op" id="6017235">*</span><span class="ident" id="6017236">printer</span><span class="op" id="6017243">)</span>&nbsp;<span class="builtinfunc" id="6017245">print</span><span class="op" id="6017250">(</span><span class="ident" id="6017251">args</span>&nbsp;<span class="op" id="6017256">...</span><span class="keyword" id="6017259">interface</span><span class="op" id="6017268">{</span><span class="op" id="6017269">}</span><span class="op" id="6017270">)</span>&nbsp;<span class="op" id="6017272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017275">for</span>&nbsp;<span class="ident" id="6017279">_</span><span class="op" id="6017280">,</span>&nbsp;<span class="ident" id="6017282">arg</span>&nbsp;<span class="op" id="6017286">:=</span>&nbsp;<span class="keyword" id="6017289">range</span>&nbsp;<span class="ident" id="6017295">args</span>&nbsp;<span class="op" id="6017300">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017304">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017343">var</span>&nbsp;<span class="ident" id="6017347">data</span>&nbsp;<span class="builtintype" id="6017352">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017361">var</span>&nbsp;<span class="ident" id="6017365">isLit</span>&nbsp;<span class="builtintype" id="6017371">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017378">var</span>&nbsp;<span class="ident" id="6017382">impliedSemi</span>&nbsp;<span class="builtintype" id="6017394">bool</span>&nbsp;<span class="comment" id="6017399">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017444">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017487">switch</span>&nbsp;<span class="ident" id="6017494">p</span><span class="op" id="6017495">.</span><span class="ident" id="6017496">lastTok</span>&nbsp;<span class="op" id="6017504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017508">case</span>&nbsp;<span class="ident" id="6017513">token</span><span class="op" id="6017518">.</span><span class="ident" id="6017519">ILLEGAL</span><span class="op" id="6017526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017531">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017557">case</span>&nbsp;<span class="ident" id="6017562">token</span><span class="op" id="6017567">.</span><span class="ident" id="6017568">LPAREN</span><span class="op" id="6017574">,</span>&nbsp;<span class="ident" id="6017576">token</span><span class="op" id="6017581">.</span><span class="ident" id="6017582">LBRACK</span><span class="op" id="6017588">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017593">p</span><span class="op" id="6017594">.</span><span class="ident" id="6017595">prevOpen</span>&nbsp;<span class="op" id="6017604">=</span>&nbsp;<span class="ident" id="6017606">p</span><span class="op" id="6017607">.</span><span class="ident" id="6017608">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017618">default</span><span class="op" id="6017625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017630">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017676">p</span><span class="op" id="6017677">.</span><span class="ident" id="6017678">prevOpen</span>&nbsp;<span class="op" id="6017687">=</span>&nbsp;<span class="ident" id="6017689">token</span><span class="op" id="6017694">.</span><span class="ident" id="6017695">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017705">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017710">switch</span>&nbsp;<span class="ident" id="6017717">x</span>&nbsp;<span class="op" id="6017719">:=</span>&nbsp;<span class="ident" id="6017722">arg</span><span class="op" id="6017725">.</span><span class="op" id="6017726">(</span><span class="keyword" id="6017727">type</span><span class="op" id="6017731">)</span>&nbsp;<span class="op" id="6017733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017737">case</span>&nbsp;<span class="ident" id="6017742">pmode</span><span class="op" id="6017747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017752">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017778">p</span><span class="op" id="6017779">.</span><span class="ident" id="6017780">mode</span>&nbsp;<span class="op" id="6017785">^=</span>&nbsp;<span class="ident" id="6017788">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017793">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017805">case</span>&nbsp;<span class="ident" id="6017810">whiteSpace</span><span class="op" id="6017820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017825">if</span>&nbsp;<span class="ident" id="6017828">x</span>&nbsp;<span class="op" id="6017830">==</span>&nbsp;<span class="ident" id="6017833">ignore</span>&nbsp;<span class="op" id="6017840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017846">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017892">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017940">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017960">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017977">i</span>&nbsp;<span class="op" id="6017979">:=</span>&nbsp;<span class="builtinfunc" id="6017982">len</span><span class="op" id="6017985">(</span><span class="ident" id="6017986">p</span><span class="op" id="6017987">.</span><span class="ident" id="6017988">wsbuf</span><span class="op" id="6017993">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017998">if</span>&nbsp;<span class="ident" id="6018001">i</span>&nbsp;<span class="op" id="6018003">==</span>&nbsp;<span class="builtinfunc" id="6018006">cap</span><span class="op" id="6018009">(</span><span class="ident" id="6018010">p</span><span class="op" id="6018011">.</span><span class="ident" id="6018012">wsbuf</span><span class="op" id="6018017">)</span>&nbsp;<span class="op" id="6018019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018025">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018083">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018141">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018190">p</span><span class="op" id="6018191">.</span><span class="ident" id="6018192">writeWhitespace</span><span class="op" id="6018207">(</span><span class="ident" id="6018208">i</span><span class="op" id="6018209">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018215">i</span>&nbsp;<span class="op" id="6018217">=</span>&nbsp;<span class="num" id="6018219">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018229">p</span><span class="op" id="6018230">.</span><span class="ident" id="6018231">wsbuf</span>&nbsp;<span class="op" id="6018237">=</span>&nbsp;<span class="ident" id="6018239">p</span><span class="op" id="6018240">.</span><span class="ident" id="6018241">wsbuf</span><span class="op" id="6018246">[</span><span class="num" id="6018247">0</span>&nbsp;<span class="op" id="6018249">:</span>&nbsp;<span class="ident" id="6018251">i</span><span class="op" id="6018252">+</span><span class="num" id="6018253">1</span><span class="op" id="6018254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018259">p</span><span class="op" id="6018260">.</span><span class="ident" id="6018261">wsbuf</span><span class="op" id="6018266">[</span><span class="ident" id="6018267">i</span><span class="op" id="6018268">]</span>&nbsp;<span class="op" id="6018270">=</span>&nbsp;<span class="ident" id="6018272">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018277">if</span>&nbsp;<span class="ident" id="6018280">x</span>&nbsp;<span class="op" id="6018282">==</span>&nbsp;<span class="ident" id="6018285">newline</span>&nbsp;<span class="op" id="6018293">||</span>&nbsp;<span class="ident" id="6018296">x</span>&nbsp;<span class="op" id="6018298">==</span>&nbsp;<span class="ident" id="6018301">formfeed</span>&nbsp;<span class="op" id="6018310">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018316">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018373">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018431">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018490">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018510">p</span><span class="op" id="6018511">.</span><span class="ident" id="6018512">impliedSemi</span>&nbsp;<span class="op" id="6018524">=</span>&nbsp;<span class="builtintype" id="6018526">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018540">p</span><span class="op" id="6018541">.</span><span class="ident" id="6018542">lastTok</span>&nbsp;<span class="op" id="6018550">=</span>&nbsp;<span class="ident" id="6018552">token</span><span class="op" id="6018557">.</span><span class="ident" id="6018558">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018569">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018581">case</span>&nbsp;<span class="op" id="6018586">*</span><span class="ident" id="6018587">ast</span><span class="op" id="6018590">.</span><span class="ident" id="6018591">Ident</span><span class="op" id="6018596">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018601">data</span>&nbsp;<span class="op" id="6018606">=</span>&nbsp;<span class="ident" id="6018608">x</span><span class="op" id="6018609">.</span><span class="ident" id="6018610">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018618">impliedSemi</span>&nbsp;<span class="op" id="6018630">=</span>&nbsp;<span class="builtintype" id="6018632">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018640">p</span><span class="op" id="6018641">.</span><span class="ident" id="6018642">lastTok</span>&nbsp;<span class="op" id="6018650">=</span>&nbsp;<span class="ident" id="6018652">token</span><span class="op" id="6018657">.</span><span class="ident" id="6018658">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018667">case</span>&nbsp;<span class="op" id="6018672">*</span><span class="ident" id="6018673">ast</span><span class="op" id="6018676">.</span><span class="ident" id="6018677">BasicLit</span><span class="op" id="6018685">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018690">data</span>&nbsp;<span class="op" id="6018695">=</span>&nbsp;<span class="ident" id="6018697">x</span><span class="op" id="6018698">.</span><span class="ident" id="6018699">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018708">isLit</span>&nbsp;<span class="op" id="6018714">=</span>&nbsp;<span class="builtintype" id="6018716">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018724">impliedSemi</span>&nbsp;<span class="op" id="6018736">=</span>&nbsp;<span class="builtintype" id="6018738">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018746">p</span><span class="op" id="6018747">.</span><span class="ident" id="6018748">lastTok</span>&nbsp;<span class="op" id="6018756">=</span>&nbsp;<span class="ident" id="6018758">x</span><span class="op" id="6018759">.</span><span class="ident" id="6018760">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018768">case</span>&nbsp;<span class="ident" id="6018773">token</span><span class="op" id="6018778">.</span><span class="ident" id="6018779">Token</span><span class="op" id="6018784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018789">s</span>&nbsp;<span class="op" id="6018791">:=</span>&nbsp;<span class="ident" id="6018794">x</span><span class="op" id="6018795">.</span><span class="ident" id="6018796">String</span><span class="op" id="6018802">(</span><span class="op" id="6018803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018808">if</span>&nbsp;<span class="ident" id="6018811">mayCombine</span><span class="op" id="6018821">(</span><span class="ident" id="6018822">p</span><span class="op" id="6018823">.</span><span class="ident" id="6018824">lastTok</span><span class="op" id="6018831">,</span>&nbsp;<span class="ident" id="6018833">s</span><span class="op" id="6018834">[</span><span class="num" id="6018835">0</span><span class="op" id="6018836">]</span><span class="op" id="6018837">)</span>&nbsp;<span class="op" id="6018839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018845">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018895">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018946">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018995">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019047">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019099">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019143">if</span>&nbsp;<span class="builtinfunc" id="6019146">len</span><span class="op" id="6019149">(</span><span class="ident" id="6019150">p</span><span class="op" id="6019151">.</span><span class="ident" id="6019152">wsbuf</span><span class="op" id="6019157">)</span>&nbsp;<span class="op" id="6019159">!=</span>&nbsp;<span class="num" id="6019162">0</span>&nbsp;<span class="op" id="6019164">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019171">p</span><span class="op" id="6019172">.</span><span class="ident" id="6019173">internalError</span><span class="op" id="6019186">(</span><span class="string" id="6019187">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="6019216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019228">p</span><span class="op" id="6019229">.</span><span class="ident" id="6019230">wsbuf</span>&nbsp;<span class="op" id="6019236">=</span>&nbsp;<span class="ident" id="6019238">p</span><span class="op" id="6019239">.</span><span class="ident" id="6019240">wsbuf</span><span class="op" id="6019245">[</span><span class="num" id="6019246">0</span><span class="op" id="6019247">:</span><span class="num" id="6019248">1</span><span class="op" id="6019249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019255">p</span><span class="op" id="6019256">.</span><span class="ident" id="6019257">wsbuf</span><span class="op" id="6019262">[</span><span class="num" id="6019263">0</span><span class="op" id="6019264">]</span>&nbsp;<span class="op" id="6019266">=</span>&nbsp;<span class="string" id="6019268">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019275">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019280">data</span>&nbsp;<span class="op" id="6019285">=</span>&nbsp;<span class="ident" id="6019287">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019292">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019352">switch</span>&nbsp;<span class="ident" id="6019359">x</span>&nbsp;<span class="op" id="6019361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019366">case</span>&nbsp;<span class="ident" id="6019371">token</span><span class="op" id="6019376">.</span><span class="ident" id="6019377">BREAK</span><span class="op" id="6019382">,</span>&nbsp;<span class="ident" id="6019384">token</span><span class="op" id="6019389">.</span><span class="ident" id="6019390">CONTINUE</span><span class="op" id="6019398">,</span>&nbsp;<span class="ident" id="6019400">token</span><span class="op" id="6019405">.</span><span class="ident" id="6019406">FALLTHROUGH</span><span class="op" id="6019417">,</span>&nbsp;<span class="ident" id="6019419">token</span><span class="op" id="6019424">.</span><span class="ident" id="6019425">RETURN</span><span class="op" id="6019431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019437">token</span><span class="op" id="6019442">.</span><span class="ident" id="6019443">INC</span><span class="op" id="6019446">,</span>&nbsp;<span class="ident" id="6019448">token</span><span class="op" id="6019453">.</span><span class="ident" id="6019454">DEC</span><span class="op" id="6019457">,</span>&nbsp;<span class="ident" id="6019459">token</span><span class="op" id="6019464">.</span><span class="ident" id="6019465">RPAREN</span><span class="op" id="6019471">,</span>&nbsp;<span class="ident" id="6019473">token</span><span class="op" id="6019478">.</span><span class="ident" id="6019479">RBRACK</span><span class="op" id="6019485">,</span>&nbsp;<span class="ident" id="6019487">token</span><span class="op" id="6019492">.</span><span class="ident" id="6019493">RBRACE</span><span class="op" id="6019499">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019505">impliedSemi</span>&nbsp;<span class="op" id="6019517">=</span>&nbsp;<span class="builtintype" id="6019519">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019532">p</span><span class="op" id="6019533">.</span><span class="ident" id="6019534">lastTok</span>&nbsp;<span class="op" id="6019542">=</span>&nbsp;<span class="ident" id="6019544">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019549">case</span>&nbsp;<span class="ident" id="6019554">token</span><span class="op" id="6019559">.</span><span class="ident" id="6019560">Pos</span><span class="op" id="6019563">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019568">if</span>&nbsp;<span class="ident" id="6019571">x</span><span class="op" id="6019572">.</span><span class="ident" id="6019573">IsValid</span><span class="op" id="6019580">(</span><span class="op" id="6019581">)</span>&nbsp;<span class="op" id="6019583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019589">p</span><span class="op" id="6019590">.</span><span class="ident" id="6019591">pos</span>&nbsp;<span class="op" id="6019595">=</span>&nbsp;<span class="ident" id="6019597">p</span><span class="op" id="6019598">.</span><span class="ident" id="6019599">posFor</span><span class="op" id="6019605">(</span><span class="ident" id="6019606">x</span><span class="op" id="6019607">)</span>&nbsp;<span class="comment" id="6019609">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019651">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019663">case</span>&nbsp;<span class="builtintype" id="6019668">string</span><span class="op" id="6019674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019679">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019721">data</span>&nbsp;<span class="op" id="6019726">=</span>&nbsp;<span class="ident" id="6019728">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019733">isLit</span>&nbsp;<span class="op" id="6019739">=</span>&nbsp;<span class="builtintype" id="6019741">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019749">impliedSemi</span>&nbsp;<span class="op" id="6019761">=</span>&nbsp;<span class="builtintype" id="6019763">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019771">p</span><span class="op" id="6019772">.</span><span class="ident" id="6019773">lastTok</span>&nbsp;<span class="op" id="6019781">=</span>&nbsp;<span class="ident" id="6019783">token</span><span class="op" id="6019788">.</span><span class="ident" id="6019789">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019799">default</span><span class="op" id="6019806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019811">fmt</span><span class="op" id="6019814">.</span><span class="ident" id="6019815">Fprintf</span><span class="op" id="6019822">(</span><span class="ident" id="6019823">os</span><span class="op" id="6019825">.</span><span class="ident" id="6019826">Stderr</span><span class="op" id="6019832">,</span>&nbsp;<span class="string" id="6019834">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="6019873">,</span>&nbsp;<span class="ident" id="6019875">arg</span><span class="op" id="6019878">,</span>&nbsp;<span class="ident" id="6019880">arg</span><span class="op" id="6019883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6019888">panic</span><span class="op" id="6019893">(</span><span class="string" id="6019894">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="6019911">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019919">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019936">next</span>&nbsp;<span class="op" id="6019941">:=</span>&nbsp;<span class="ident" id="6019944">p</span><span class="op" id="6019945">.</span><span class="ident" id="6019946">pos</span>&nbsp;<span class="comment" id="6019950">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019996">wroteNewline</span><span class="op" id="6020008">,</span>&nbsp;<span class="ident" id="6020010">droppedFF</span>&nbsp;<span class="op" id="6020020">:=</span>&nbsp;<span class="ident" id="6020023">p</span><span class="op" id="6020024">.</span><span class="ident" id="6020025">flush</span><span class="op" id="6020030">(</span><span class="ident" id="6020031">next</span><span class="op" id="6020035">,</span>&nbsp;<span class="ident" id="6020037">p</span><span class="op" id="6020038">.</span><span class="ident" id="6020039">lastTok</span><span class="op" id="6020046">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020051">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020112">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020172">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020237">if</span>&nbsp;<span class="op" id="6020240">!</span><span class="ident" id="6020241">p</span><span class="op" id="6020242">.</span><span class="ident" id="6020243">impliedSemi</span>&nbsp;<span class="op" id="6020255">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020260">n</span>&nbsp;<span class="op" id="6020262">:=</span>&nbsp;<span class="ident" id="6020265">nlimit</span><span class="op" id="6020271">(</span><span class="ident" id="6020272">next</span><span class="op" id="6020276">.</span><span class="ident" id="6020277">Line</span>&nbsp;<span class="op" id="6020282">-</span>&nbsp;<span class="ident" id="6020284">p</span><span class="op" id="6020285">.</span><span class="ident" id="6020286">pos</span><span class="op" id="6020289">.</span><span class="ident" id="6020290">Line</span><span class="op" id="6020294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020299">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020354">if</span>&nbsp;<span class="ident" id="6020357">wroteNewline</span>&nbsp;<span class="op" id="6020370">&amp;&amp;</span>&nbsp;<span class="ident" id="6020373">n</span>&nbsp;<span class="op" id="6020375">==</span>&nbsp;<span class="ident" id="6020378">maxNewlines</span>&nbsp;<span class="op" id="6020390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020396">n</span>&nbsp;<span class="op" id="6020398">=</span>&nbsp;<span class="ident" id="6020400">maxNewlines</span>&nbsp;<span class="op" id="6020412">-</span>&nbsp;<span class="num" id="6020414">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020419">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020424">if</span>&nbsp;<span class="ident" id="6020427">n</span>&nbsp;<span class="op" id="6020429">&gt;</span>&nbsp;<span class="num" id="6020431">0</span>&nbsp;<span class="op" id="6020433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020439">ch</span>&nbsp;<span class="op" id="6020442">:=</span>&nbsp;<span class="builtintype" id="6020445">byte</span><span class="op" id="6020449">(</span><span class="string" id="6020450">&#39;\n&#39;</span><span class="op" id="6020454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020460">if</span>&nbsp;<span class="ident" id="6020463">droppedFF</span>&nbsp;<span class="op" id="6020473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020480">ch</span>&nbsp;<span class="op" id="6020483">=</span>&nbsp;<span class="string" id="6020485">&#39;\f&#39;</span>&nbsp;<span class="comment" id="6020490">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020538">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020544">p</span><span class="op" id="6020545">.</span><span class="ident" id="6020546">writeByte</span><span class="op" id="6020555">(</span><span class="ident" id="6020556">ch</span><span class="op" id="6020558">,</span>&nbsp;<span class="ident" id="6020560">n</span><span class="op" id="6020561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020567">impliedSemi</span>&nbsp;<span class="op" id="6020579">=</span>&nbsp;<span class="builtintype" id="6020581">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020599">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020668">if</span>&nbsp;<span class="ident" id="6020671">p</span><span class="op" id="6020672">.</span><span class="ident" id="6020673">linePtr</span>&nbsp;<span class="op" id="6020681">!=</span>&nbsp;<span class="ident" id="6020684">nil</span>&nbsp;<span class="op" id="6020688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020693">*</span><span class="ident" id="6020694">p</span><span class="op" id="6020695">.</span><span class="ident" id="6020696">linePtr</span>&nbsp;<span class="op" id="6020704">=</span>&nbsp;<span class="ident" id="6020706">p</span><span class="op" id="6020707">.</span><span class="ident" id="6020708">out</span><span class="op" id="6020711">.</span><span class="ident" id="6020712">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020720">p</span><span class="op" id="6020721">.</span><span class="ident" id="6020722">linePtr</span>&nbsp;<span class="op" id="6020730">=</span>&nbsp;<span class="ident" id="6020732">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020738">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020743">p</span><span class="op" id="6020744">.</span><span class="ident" id="6020745">writeString</span><span class="op" id="6020756">(</span><span class="ident" id="6020757">next</span><span class="op" id="6020761">,</span>&nbsp;<span class="ident" id="6020763">data</span><span class="op" id="6020767">,</span>&nbsp;<span class="ident" id="6020769">isLit</span><span class="op" id="6020774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020778">p</span><span class="op" id="6020779">.</span><span class="ident" id="6020780">impliedSemi</span>&nbsp;<span class="op" id="6020792">=</span>&nbsp;<span class="ident" id="6020794">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020807">}</span><br>
<span class="lineno"></span><span class="op" id="6020809">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="6020812">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="6020884">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="6020957">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6021034">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="6021045">//</span><br>
<span class="lineno"></span><span class="keyword" id="6021048">func</span>&nbsp;<span class="op" id="6021053">(</span><span class="ident" id="6021054">p</span>&nbsp;<span class="op" id="6021056">*</span><span class="ident" id="6021057">printer</span><span class="op" id="6021064">)</span>&nbsp;<span class="ident" id="6021066">flush</span><span class="op" id="6021071">(</span><span class="ident" id="6021072">next</span>&nbsp;<span class="ident" id="6021077">token</span><span class="op" id="6021082">.</span><span class="ident" id="6021083">Position</span><span class="op" id="6021091">,</span>&nbsp;<span class="ident" id="6021093">tok</span>&nbsp;<span class="ident" id="6021097">token</span><span class="op" id="6021102">.</span><span class="ident" id="6021103">Token</span><span class="op" id="6021108">)</span>&nbsp;<span class="op" id="6021110">(</span><span class="ident" id="6021111">wroteNewline</span><span class="op" id="6021123">,</span>&nbsp;<span class="ident" id="6021125">droppedFF</span>&nbsp;<span class="builtintype" id="6021135">bool</span><span class="op" id="6021139">)</span>&nbsp;<span class="op" id="6021141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021144">if</span>&nbsp;<span class="ident" id="6021147">p</span><span class="op" id="6021148">.</span><span class="ident" id="6021149">commentBefore</span><span class="op" id="6021162">(</span><span class="ident" id="6021163">next</span><span class="op" id="6021167">)</span>&nbsp;<span class="op" id="6021169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021173">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021239">wroteNewline</span><span class="op" id="6021251">,</span>&nbsp;<span class="ident" id="6021253">droppedFF</span>&nbsp;<span class="op" id="6021263">=</span>&nbsp;<span class="ident" id="6021265">p</span><span class="op" id="6021266">.</span><span class="ident" id="6021267">intersperseComments</span><span class="op" id="6021286">(</span><span class="ident" id="6021287">next</span><span class="op" id="6021291">,</span>&nbsp;<span class="ident" id="6021293">tok</span><span class="op" id="6021296">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021299">}</span>&nbsp;<span class="keyword" id="6021301">else</span>&nbsp;<span class="op" id="6021306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021310">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021356">p</span><span class="op" id="6021357">.</span><span class="ident" id="6021358">writeWhitespace</span><span class="op" id="6021373">(</span><span class="builtinfunc" id="6021374">len</span><span class="op" id="6021377">(</span><span class="ident" id="6021378">p</span><span class="op" id="6021379">.</span><span class="ident" id="6021380">wsbuf</span><span class="op" id="6021385">)</span><span class="op" id="6021386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021392">return</span><br>
<span class="lineno">990</span><span class="op" id="6021399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6021402">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="6021469">func</span>&nbsp;<span class="ident" id="6021474">getDoc</span><span class="op" id="6021480">(</span><span class="ident" id="6021481">n</span>&nbsp;<span class="ident" id="6021483">ast</span><span class="op" id="6021486">.</span><span class="ident" id="6021487">Node</span><span class="op" id="6021491">)</span>&nbsp;<span class="op" id="6021493">*</span><span class="ident" id="6021494">ast</span><span class="op" id="6021497">.</span><span class="ident" id="6021498">CommentGroup</span>&nbsp;<span class="op" id="6021511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021514">switch</span>&nbsp;<span class="ident" id="6021521">n</span>&nbsp;<span class="op" id="6021523">:=</span>&nbsp;<span class="ident" id="6021526">n</span><span class="op" id="6021527">.</span><span class="op" id="6021528">(</span><span class="keyword" id="6021529">type</span><span class="op" id="6021533">)</span>&nbsp;<span class="op" id="6021535">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021538">case</span>&nbsp;<span class="op" id="6021543">*</span><span class="ident" id="6021544">ast</span><span class="op" id="6021547">.</span><span class="ident" id="6021548">Field</span><span class="op" id="6021553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021557">return</span>&nbsp;<span class="ident" id="6021564">n</span><span class="op" id="6021565">.</span><span class="ident" id="6021566">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021571">case</span>&nbsp;<span class="op" id="6021576">*</span><span class="ident" id="6021577">ast</span><span class="op" id="6021580">.</span><span class="ident" id="6021581">ImportSpec</span><span class="op" id="6021591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021595">return</span>&nbsp;<span class="ident" id="6021602">n</span><span class="op" id="6021603">.</span><span class="ident" id="6021604">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021609">case</span>&nbsp;<span class="op" id="6021614">*</span><span class="ident" id="6021615">ast</span><span class="op" id="6021618">.</span><span class="ident" id="6021619">ValueSpec</span><span class="op" id="6021628">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021632">return</span>&nbsp;<span class="ident" id="6021639">n</span><span class="op" id="6021640">.</span><span class="ident" id="6021641">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021646">case</span>&nbsp;<span class="op" id="6021651">*</span><span class="ident" id="6021652">ast</span><span class="op" id="6021655">.</span><span class="ident" id="6021656">TypeSpec</span><span class="op" id="6021664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021668">return</span>&nbsp;<span class="ident" id="6021675">n</span><span class="op" id="6021676">.</span><span class="ident" id="6021677">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021682">case</span>&nbsp;<span class="op" id="6021687">*</span><span class="ident" id="6021688">ast</span><span class="op" id="6021691">.</span><span class="ident" id="6021692">GenDecl</span><span class="op" id="6021699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021703">return</span>&nbsp;<span class="ident" id="6021710">n</span><span class="op" id="6021711">.</span><span class="ident" id="6021712">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021717">case</span>&nbsp;<span class="op" id="6021722">*</span><span class="ident" id="6021723">ast</span><span class="op" id="6021726">.</span><span class="ident" id="6021727">FuncDecl</span><span class="op" id="6021735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021739">return</span>&nbsp;<span class="ident" id="6021746">n</span><span class="op" id="6021747">.</span><span class="ident" id="6021748">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021753">case</span>&nbsp;<span class="op" id="6021758">*</span><span class="ident" id="6021759">ast</span><span class="op" id="6021762">.</span><span class="ident" id="6021763">File</span><span class="op" id="6021767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021771">return</span>&nbsp;<span class="ident" id="6021778">n</span><span class="op" id="6021779">.</span><span class="ident" id="6021780">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021785">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021788">return</span>&nbsp;<span class="ident" id="6021795">nil</span><br>
<span class="lineno"></span><span class="op" id="6021799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6021802">func</span>&nbsp;<span class="op" id="6021807">(</span><span class="ident" id="6021808">p</span>&nbsp;<span class="op" id="6021810">*</span><span class="ident" id="6021811">printer</span><span class="op" id="6021818">)</span>&nbsp;<span class="ident" id="6021820">printNode</span><span class="op" id="6021829">(</span><span class="ident" id="6021830">node</span>&nbsp;<span class="keyword" id="6021835">interface</span><span class="op" id="6021844">{</span><span class="op" id="6021845">}</span><span class="op" id="6021846">)</span>&nbsp;<span class="builtintype" id="6021848">error</span>&nbsp;<span class="op" id="6021854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021857">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021891">var</span>&nbsp;<span class="ident" id="6021895">comments</span>&nbsp;<span class="op" id="6021904">[</span><span class="op" id="6021905">]</span><span class="op" id="6021906">*</span><span class="ident" id="6021907">ast</span><span class="op" id="6021910">.</span><span class="ident" id="6021911">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021925">if</span>&nbsp;<span class="ident" id="6021928">cnode</span><span class="op" id="6021933">,</span>&nbsp;<span class="ident" id="6021935">ok</span>&nbsp;<span class="op" id="6021938">:=</span>&nbsp;<span class="ident" id="6021941">node</span><span class="op" id="6021945">.</span><span class="op" id="6021946">(</span><span class="op" id="6021947">*</span><span class="ident" id="6021948">CommentedNode</span><span class="op" id="6021961">)</span><span class="op" id="6021962">;</span>&nbsp;<span class="ident" id="6021964">ok</span>&nbsp;<span class="op" id="6021967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021971">node</span>&nbsp;<span class="op" id="6021976">=</span>&nbsp;<span class="ident" id="6021978">cnode</span><span class="op" id="6021983">.</span><span class="ident" id="6021984">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021991">comments</span>&nbsp;<span class="op" id="6022000">=</span>&nbsp;<span class="ident" id="6022002">cnode</span><span class="op" id="6022007">.</span><span class="ident" id="6022008">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022018">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022022">if</span>&nbsp;<span class="ident" id="6022025">comments</span>&nbsp;<span class="op" id="6022034">!=</span>&nbsp;<span class="ident" id="6022037">nil</span>&nbsp;<span class="op" id="6022041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022045">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022107">n</span><span class="op" id="6022108">,</span>&nbsp;<span class="ident" id="6022110">ok</span>&nbsp;<span class="op" id="6022113">:=</span>&nbsp;<span class="ident" id="6022116">node</span><span class="op" id="6022120">.</span><span class="op" id="6022121">(</span><span class="ident" id="6022122">ast</span><span class="op" id="6022125">.</span><span class="ident" id="6022126">Node</span><span class="op" id="6022130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022134">if</span>&nbsp;<span class="op" id="6022137">!</span><span class="ident" id="6022138">ok</span>&nbsp;<span class="op" id="6022141">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022146">goto</span>&nbsp;<span class="ident" id="6022151">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022169">beg</span>&nbsp;<span class="op" id="6022173">:=</span>&nbsp;<span class="ident" id="6022176">n</span><span class="op" id="6022177">.</span><span class="ident" id="6022178">Pos</span><span class="op" id="6022181">(</span><span class="op" id="6022182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022186">end</span>&nbsp;<span class="op" id="6022190">:=</span>&nbsp;<span class="ident" id="6022193">n</span><span class="op" id="6022194">.</span><span class="ident" id="6022195">End</span><span class="op" id="6022198">(</span><span class="op" id="6022199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022203">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022250">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022294">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022340">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022391">if</span>&nbsp;<span class="ident" id="6022394">doc</span>&nbsp;<span class="op" id="6022398">:=</span>&nbsp;<span class="ident" id="6022401">getDoc</span><span class="op" id="6022407">(</span><span class="ident" id="6022408">n</span><span class="op" id="6022409">)</span><span class="op" id="6022410">;</span>&nbsp;<span class="ident" id="6022412">doc</span>&nbsp;<span class="op" id="6022416">!=</span>&nbsp;<span class="ident" id="6022419">nil</span>&nbsp;<span class="op" id="6022423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022428">beg</span>&nbsp;<span class="op" id="6022432">=</span>&nbsp;<span class="ident" id="6022434">doc</span><span class="op" id="6022437">.</span><span class="ident" id="6022438">Pos</span><span class="op" id="6022441">(</span><span class="op" id="6022442">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022450">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022499">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022526">i</span>&nbsp;<span class="op" id="6022528">:=</span>&nbsp;<span class="num" id="6022531">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022535">for</span>&nbsp;<span class="ident" id="6022539">i</span>&nbsp;<span class="op" id="6022541">&lt;</span>&nbsp;<span class="builtinfunc" id="6022543">len</span><span class="op" id="6022546">(</span><span class="ident" id="6022547">comments</span><span class="op" id="6022555">)</span>&nbsp;<span class="op" id="6022557">&amp;&amp;</span>&nbsp;<span class="ident" id="6022560">comments</span><span class="op" id="6022568">[</span><span class="ident" id="6022569">i</span><span class="op" id="6022570">]</span><span class="op" id="6022571">.</span><span class="ident" id="6022572">End</span><span class="op" id="6022575">(</span><span class="op" id="6022576">)</span>&nbsp;<span class="op" id="6022578">&lt;</span>&nbsp;<span class="ident" id="6022580">beg</span>&nbsp;<span class="op" id="6022584">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022589">i</span><span class="op" id="6022590">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022599">j</span>&nbsp;<span class="op" id="6022601">:=</span>&nbsp;<span class="ident" id="6022604">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022608">for</span>&nbsp;<span class="ident" id="6022612">j</span>&nbsp;<span class="op" id="6022614">&lt;</span>&nbsp;<span class="builtinfunc" id="6022616">len</span><span class="op" id="6022619">(</span><span class="ident" id="6022620">comments</span><span class="op" id="6022628">)</span>&nbsp;<span class="op" id="6022630">&amp;&amp;</span>&nbsp;<span class="ident" id="6022633">comments</span><span class="op" id="6022641">[</span><span class="ident" id="6022642">j</span><span class="op" id="6022643">]</span><span class="op" id="6022644">.</span><span class="ident" id="6022645">Pos</span><span class="op" id="6022648">(</span><span class="op" id="6022649">)</span>&nbsp;<span class="op" id="6022651">&lt;</span>&nbsp;<span class="ident" id="6022653">end</span>&nbsp;<span class="op" id="6022657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022662">j</span><span class="op" id="6022663">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022672">if</span>&nbsp;<span class="ident" id="6022675">i</span>&nbsp;<span class="op" id="6022677">&lt;</span>&nbsp;<span class="ident" id="6022679">j</span>&nbsp;<span class="op" id="6022681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022686">p</span><span class="op" id="6022687">.</span><span class="ident" id="6022688">comments</span>&nbsp;<span class="op" id="6022697">=</span>&nbsp;<span class="ident" id="6022699">comments</span><span class="op" id="6022707">[</span><span class="ident" id="6022708">i</span><span class="op" id="6022709">:</span><span class="ident" id="6022710">j</span><span class="op" id="6022711">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022718">}</span>&nbsp;<span class="keyword" id="6022720">else</span>&nbsp;<span class="keyword" id="6022725">if</span>&nbsp;<span class="ident" id="6022728">n</span><span class="op" id="6022729">,</span>&nbsp;<span class="ident" id="6022731">ok</span>&nbsp;<span class="op" id="6022734">:=</span>&nbsp;<span class="ident" id="6022737">node</span><span class="op" id="6022741">.</span><span class="op" id="6022742">(</span><span class="op" id="6022743">*</span><span class="ident" id="6022744">ast</span><span class="op" id="6022747">.</span><span class="ident" id="6022748">File</span><span class="op" id="6022752">)</span><span class="op" id="6022753">;</span>&nbsp;<span class="ident" id="6022755">ok</span>&nbsp;<span class="op" id="6022758">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022762">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022797">p</span><span class="op" id="6022798">.</span><span class="ident" id="6022799">comments</span>&nbsp;<span class="op" id="6022808">=</span>&nbsp;<span class="ident" id="6022810">n</span><span class="op" id="6022811">.</span><span class="ident" id="6022812">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022826">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022874">p</span><span class="op" id="6022875">.</span><span class="ident" id="6022876">useNodeComments</span>&nbsp;<span class="op" id="6022892">=</span>&nbsp;<span class="ident" id="6022894">p</span><span class="op" id="6022895">.</span><span class="ident" id="6022896">comments</span>&nbsp;<span class="op" id="6022905">==</span>&nbsp;<span class="ident" id="6022908">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022914">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022945">p</span><span class="op" id="6022946">.</span><span class="ident" id="6022947">nextComment</span><span class="op" id="6022958">(</span><span class="op" id="6022959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022963">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022979">switch</span>&nbsp;<span class="ident" id="6022986">n</span>&nbsp;<span class="op" id="6022988">:=</span>&nbsp;<span class="ident" id="6022991">node</span><span class="op" id="6022995">.</span><span class="op" id="6022996">(</span><span class="keyword" id="6022997">type</span><span class="op" id="6023001">)</span>&nbsp;<span class="op" id="6023003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023006">case</span>&nbsp;<span class="ident" id="6023011">ast</span><span class="op" id="6023014">.</span><span class="ident" id="6023015">Expr</span><span class="op" id="6023019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023023">p</span><span class="op" id="6023024">.</span><span class="ident" id="6023025">expr</span><span class="op" id="6023029">(</span><span class="ident" id="6023030">n</span><span class="op" id="6023031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023034">case</span>&nbsp;<span class="ident" id="6023039">ast</span><span class="op" id="6023042">.</span><span class="ident" id="6023043">Stmt</span><span class="op" id="6023047">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023051">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023114">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023173">if</span>&nbsp;<span class="ident" id="6023176">_</span><span class="op" id="6023177">,</span>&nbsp;<span class="ident" id="6023179">ok</span>&nbsp;<span class="op" id="6023182">:=</span>&nbsp;<span class="ident" id="6023185">n</span><span class="op" id="6023186">.</span><span class="op" id="6023187">(</span><span class="op" id="6023188">*</span><span class="ident" id="6023189">ast</span><span class="op" id="6023192">.</span><span class="ident" id="6023193">LabeledStmt</span><span class="op" id="6023204">)</span><span class="op" id="6023205">;</span>&nbsp;<span class="ident" id="6023207">ok</span>&nbsp;<span class="op" id="6023210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023215">p</span><span class="op" id="6023216">.</span><span class="ident" id="6023217">indent</span>&nbsp;<span class="op" id="6023224">=</span>&nbsp;<span class="num" id="6023226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023230">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023234">p</span><span class="op" id="6023235">.</span><span class="ident" id="6023236">stmt</span><span class="op" id="6023240">(</span><span class="ident" id="6023241">n</span><span class="op" id="6023242">,</span>&nbsp;<span class="builtintype" id="6023244">false</span><span class="op" id="6023249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023252">case</span>&nbsp;<span class="ident" id="6023257">ast</span><span class="op" id="6023260">.</span><span class="ident" id="6023261">Decl</span><span class="op" id="6023265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023269">p</span><span class="op" id="6023270">.</span><span class="ident" id="6023271">decl</span><span class="op" id="6023275">(</span><span class="ident" id="6023276">n</span><span class="op" id="6023277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023280">case</span>&nbsp;<span class="ident" id="6023285">ast</span><span class="op" id="6023288">.</span><span class="ident" id="6023289">Spec</span><span class="op" id="6023293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023297">p</span><span class="op" id="6023298">.</span><span class="ident" id="6023299">spec</span><span class="op" id="6023303">(</span><span class="ident" id="6023304">n</span><span class="op" id="6023305">,</span>&nbsp;<span class="num" id="6023307">1</span><span class="op" id="6023308">,</span>&nbsp;<span class="builtintype" id="6023310">false</span><span class="op" id="6023315">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023318">case</span>&nbsp;<span class="op" id="6023323">[</span><span class="op" id="6023324">]</span><span class="ident" id="6023325">ast</span><span class="op" id="6023328">.</span><span class="ident" id="6023329">Stmt</span><span class="op" id="6023333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023337">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023400">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023459">for</span>&nbsp;<span class="ident" id="6023463">_</span><span class="op" id="6023464">,</span>&nbsp;<span class="ident" id="6023466">s</span>&nbsp;<span class="op" id="6023468">:=</span>&nbsp;<span class="keyword" id="6023471">range</span>&nbsp;<span class="ident" id="6023477">n</span>&nbsp;<span class="op" id="6023479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023484">if</span>&nbsp;<span class="ident" id="6023487">_</span><span class="op" id="6023488">,</span>&nbsp;<span class="ident" id="6023490">ok</span>&nbsp;<span class="op" id="6023493">:=</span>&nbsp;<span class="ident" id="6023496">s</span><span class="op" id="6023497">.</span><span class="op" id="6023498">(</span><span class="op" id="6023499">*</span><span class="ident" id="6023500">ast</span><span class="op" id="6023503">.</span><span class="ident" id="6023504">LabeledStmt</span><span class="op" id="6023515">)</span><span class="op" id="6023516">;</span>&nbsp;<span class="ident" id="6023518">ok</span>&nbsp;<span class="op" id="6023521">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023527">p</span><span class="op" id="6023528">.</span><span class="ident" id="6023529">indent</span>&nbsp;<span class="op" id="6023536">=</span>&nbsp;<span class="num" id="6023538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023551">p</span><span class="op" id="6023552">.</span><span class="ident" id="6023553">stmtList</span><span class="op" id="6023561">(</span><span class="ident" id="6023562">n</span><span class="op" id="6023563">,</span>&nbsp;<span class="num" id="6023565">0</span><span class="op" id="6023566">,</span>&nbsp;<span class="builtintype" id="6023568">false</span><span class="op" id="6023573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023576">case</span>&nbsp;<span class="op" id="6023581">[</span><span class="op" id="6023582">]</span><span class="ident" id="6023583">ast</span><span class="op" id="6023586">.</span><span class="ident" id="6023587">Decl</span><span class="op" id="6023591">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023595">p</span><span class="op" id="6023596">.</span><span class="ident" id="6023597">declList</span><span class="op" id="6023605">(</span><span class="ident" id="6023606">n</span><span class="op" id="6023607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023610">case</span>&nbsp;<span class="op" id="6023615">*</span><span class="ident" id="6023616">ast</span><span class="op" id="6023619">.</span><span class="ident" id="6023620">File</span><span class="op" id="6023624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023628">p</span><span class="op" id="6023629">.</span><span class="ident" id="6023630">file</span><span class="op" id="6023634">(</span><span class="ident" id="6023635">n</span><span class="op" id="6023636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023639">default</span><span class="op" id="6023646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023650">goto</span>&nbsp;<span class="ident" id="6023655">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023672">return</span>&nbsp;<span class="ident" id="6023679">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="6023684">unsupported</span><span class="op" id="6023695">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023698">return</span>&nbsp;<span class="ident" id="6023705">fmt</span><span class="op" id="6023708">.</span><span class="ident" id="6023709">Errorf</span><span class="op" id="6023715">(</span><span class="string" id="6023716">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="6023754">,</span>&nbsp;<span class="ident" id="6023756">node</span><span class="op" id="6023760">)</span><br>
<span class="lineno"></span><span class="op" id="6023762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6023765">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6023845">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="6023857">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="6023924">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="6023993">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="6024062">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="6024131">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="6024153">//</span><br>
<span class="lineno"></span><span class="keyword" id="6024156">type</span>&nbsp;<span class="ident" id="6024161">trimmer</span>&nbsp;<span class="keyword" id="6024169">struct</span>&nbsp;<span class="op" id="6024176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024179">output</span>&nbsp;<span class="ident" id="6024186">io</span><span class="op" id="6024188">.</span><span class="ident" id="6024189">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024197">state</span>&nbsp;&nbsp;<span class="builtintype" id="6024204">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024209">space</span>&nbsp;&nbsp;<span class="op" id="6024216">[</span><span class="op" id="6024217">]</span><span class="builtintype" id="6024218">byte</span><br>
<span class="lineno"></span><span class="op" id="6024223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6024226">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="6024272">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="6024317">const</span>&nbsp;<span class="op" id="6024323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024326">inSpace</span>&nbsp;&nbsp;<span class="op" id="6024335">=</span>&nbsp;<span class="ident" id="6024337">iota</span>&nbsp;<span class="comment" id="6024342">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024359">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024375">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024422">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024438">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="6024453">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="6024456">func</span>&nbsp;<span class="op" id="6024461">(</span><span class="ident" id="6024462">p</span>&nbsp;<span class="op" id="6024464">*</span><span class="ident" id="6024465">trimmer</span><span class="op" id="6024472">)</span>&nbsp;<span class="ident" id="6024474">resetSpace</span><span class="op" id="6024484">(</span><span class="op" id="6024485">)</span>&nbsp;<span class="op" id="6024487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024490">p</span><span class="op" id="6024491">.</span><span class="ident" id="6024492">state</span>&nbsp;<span class="op" id="6024498">=</span>&nbsp;<span class="ident" id="6024500">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024509">p</span><span class="op" id="6024510">.</span><span class="ident" id="6024511">space</span>&nbsp;<span class="op" id="6024517">=</span>&nbsp;<span class="ident" id="6024519">p</span><span class="op" id="6024520">.</span><span class="ident" id="6024521">space</span><span class="op" id="6024526">[</span><span class="num" id="6024527">0</span><span class="op" id="6024528">:</span><span class="num" id="6024529">0</span><span class="op" id="6024530">]</span><br>
<span class="lineno"></span><span class="op" id="6024532">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="6024535">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6024605">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="6024675">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6024743">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="6024810">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6024842">var</span>&nbsp;<span class="ident" id="6024846">aNewline</span>&nbsp;<span class="op" id="6024855">=</span>&nbsp;<span class="op" id="6024857">[</span><span class="op" id="6024858">]</span><span class="builtintype" id="6024859">byte</span><span class="op" id="6024863">(</span><span class="string" id="6024864">&#34;\n&#34;</span><span class="op" id="6024868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6024871">func</span>&nbsp;<span class="op" id="6024876">(</span><span class="ident" id="6024877">p</span>&nbsp;<span class="op" id="6024879">*</span><span class="ident" id="6024880">trimmer</span><span class="op" id="6024887">)</span>&nbsp;<span class="ident" id="6024889">Write</span><span class="op" id="6024894">(</span><span class="ident" id="6024895">data</span>&nbsp;<span class="op" id="6024900">[</span><span class="op" id="6024901">]</span><span class="builtintype" id="6024902">byte</span><span class="op" id="6024906">)</span>&nbsp;<span class="op" id="6024908">(</span><span class="ident" id="6024909">n</span>&nbsp;<span class="builtintype" id="6024911">int</span><span class="op" id="6024914">,</span>&nbsp;<span class="ident" id="6024916">err</span>&nbsp;<span class="builtintype" id="6024920">error</span><span class="op" id="6024925">)</span>&nbsp;<span class="op" id="6024927">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024930">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024946">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024970">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024995">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025028">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025055">m</span>&nbsp;<span class="op" id="6025057">:=</span>&nbsp;<span class="num" id="6025060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025063">var</span>&nbsp;<span class="ident" id="6025067">b</span>&nbsp;<span class="builtintype" id="6025069">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025075">for</span>&nbsp;<span class="ident" id="6025079">n</span><span class="op" id="6025080">,</span>&nbsp;<span class="ident" id="6025082">b</span>&nbsp;<span class="op" id="6025084">=</span>&nbsp;<span class="keyword" id="6025086">range</span>&nbsp;<span class="ident" id="6025092">data</span>&nbsp;<span class="op" id="6025097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025101">if</span>&nbsp;<span class="ident" id="6025104">b</span>&nbsp;<span class="op" id="6025106">==</span>&nbsp;<span class="string" id="6025109">&#39;\v&#39;</span>&nbsp;<span class="op" id="6025114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025119">b</span>&nbsp;<span class="op" id="6025121">=</span>&nbsp;<span class="string" id="6025123">&#39;\t&#39;</span>&nbsp;<span class="comment" id="6025128">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025153">switch</span>&nbsp;<span class="ident" id="6025160">p</span><span class="op" id="6025161">.</span><span class="ident" id="6025162">state</span>&nbsp;<span class="op" id="6025168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025172">case</span>&nbsp;<span class="ident" id="6025177">inSpace</span><span class="op" id="6025184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025189">switch</span>&nbsp;<span class="ident" id="6025196">b</span>&nbsp;<span class="op" id="6025198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025203">case</span>&nbsp;<span class="string" id="6025208">&#39;\t&#39;</span><span class="op" id="6025212">,</span>&nbsp;<span class="string" id="6025214">&#39;&nbsp;&#39;</span><span class="op" id="6025217">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025223">p</span><span class="op" id="6025224">.</span><span class="ident" id="6025225">space</span>&nbsp;<span class="op" id="6025231">=</span>&nbsp;<span class="builtinfunc" id="6025233">append</span><span class="op" id="6025239">(</span><span class="ident" id="6025240">p</span><span class="op" id="6025241">.</span><span class="ident" id="6025242">space</span><span class="op" id="6025247">,</span>&nbsp;<span class="ident" id="6025249">b</span><span class="op" id="6025250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025255">case</span>&nbsp;<span class="string" id="6025260">&#39;\n&#39;</span><span class="op" id="6025264">,</span>&nbsp;<span class="string" id="6025266">&#39;\f&#39;</span><span class="op" id="6025270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025276">p</span><span class="op" id="6025277">.</span><span class="ident" id="6025278">resetSpace</span><span class="op" id="6025288">(</span><span class="op" id="6025289">)</span>&nbsp;<span class="comment" id="6025291">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025321">_</span><span class="op" id="6025322">,</span>&nbsp;<span class="ident" id="6025324">err</span>&nbsp;<span class="op" id="6025328">=</span>&nbsp;<span class="ident" id="6025330">p</span><span class="op" id="6025331">.</span><span class="ident" id="6025332">output</span><span class="op" id="6025338">.</span><span class="ident" id="6025339">Write</span><span class="op" id="6025344">(</span><span class="ident" id="6025345">aNewline</span><span class="op" id="6025353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025358">case</span>&nbsp;<span class="ident" id="6025363">tabwriter</span><span class="op" id="6025372">.</span><span class="ident" id="6025373">Escape</span><span class="op" id="6025379">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025385">_</span><span class="op" id="6025386">,</span>&nbsp;<span class="ident" id="6025388">err</span>&nbsp;<span class="op" id="6025392">=</span>&nbsp;<span class="ident" id="6025394">p</span><span class="op" id="6025395">.</span><span class="ident" id="6025396">output</span><span class="op" id="6025402">.</span><span class="ident" id="6025403">Write</span><span class="op" id="6025408">(</span><span class="ident" id="6025409">p</span><span class="op" id="6025410">.</span><span class="ident" id="6025411">space</span><span class="op" id="6025416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025422">p</span><span class="op" id="6025423">.</span><span class="ident" id="6025424">state</span>&nbsp;<span class="op" id="6025430">=</span>&nbsp;<span class="ident" id="6025432">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025445">m</span>&nbsp;<span class="op" id="6025447">=</span>&nbsp;<span class="ident" id="6025449">n</span>&nbsp;<span class="op" id="6025451">+</span>&nbsp;<span class="num" id="6025453">1</span>&nbsp;<span class="comment" id="6025455">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025487">default</span><span class="op" id="6025494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025500">_</span><span class="op" id="6025501">,</span>&nbsp;<span class="ident" id="6025503">err</span>&nbsp;<span class="op" id="6025507">=</span>&nbsp;<span class="ident" id="6025509">p</span><span class="op" id="6025510">.</span><span class="ident" id="6025511">output</span><span class="op" id="6025517">.</span><span class="ident" id="6025518">Write</span><span class="op" id="6025523">(</span><span class="ident" id="6025524">p</span><span class="op" id="6025525">.</span><span class="ident" id="6025526">space</span><span class="op" id="6025531">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025537">p</span><span class="op" id="6025538">.</span><span class="ident" id="6025539">state</span>&nbsp;<span class="op" id="6025545">=</span>&nbsp;<span class="ident" id="6025547">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025558">m</span>&nbsp;<span class="op" id="6025560">=</span>&nbsp;<span class="ident" id="6025562">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025571">case</span>&nbsp;<span class="ident" id="6025576">inEscape</span><span class="op" id="6025584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025589">if</span>&nbsp;<span class="ident" id="6025592">b</span>&nbsp;<span class="op" id="6025594">==</span>&nbsp;<span class="ident" id="6025597">tabwriter</span><span class="op" id="6025606">.</span><span class="ident" id="6025607">Escape</span>&nbsp;<span class="op" id="6025614">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025620">_</span><span class="op" id="6025621">,</span>&nbsp;<span class="ident" id="6025623">err</span>&nbsp;<span class="op" id="6025627">=</span>&nbsp;<span class="ident" id="6025629">p</span><span class="op" id="6025630">.</span><span class="ident" id="6025631">output</span><span class="op" id="6025637">.</span><span class="ident" id="6025638">Write</span><span class="op" id="6025643">(</span><span class="ident" id="6025644">data</span><span class="op" id="6025648">[</span><span class="ident" id="6025649">m</span><span class="op" id="6025650">:</span><span class="ident" id="6025651">n</span><span class="op" id="6025652">]</span><span class="op" id="6025653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025659">p</span><span class="op" id="6025660">.</span><span class="ident" id="6025661">resetSpace</span><span class="op" id="6025671">(</span><span class="op" id="6025672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025681">case</span>&nbsp;<span class="ident" id="6025686">inText</span><span class="op" id="6025692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025697">switch</span>&nbsp;<span class="ident" id="6025704">b</span>&nbsp;<span class="op" id="6025706">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025711">case</span>&nbsp;<span class="string" id="6025716">&#39;\t&#39;</span><span class="op" id="6025720">,</span>&nbsp;<span class="string" id="6025722">&#39;&nbsp;&#39;</span><span class="op" id="6025725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025731">_</span><span class="op" id="6025732">,</span>&nbsp;<span class="ident" id="6025734">err</span>&nbsp;<span class="op" id="6025738">=</span>&nbsp;<span class="ident" id="6025740">p</span><span class="op" id="6025741">.</span><span class="ident" id="6025742">output</span><span class="op" id="6025748">.</span><span class="ident" id="6025749">Write</span><span class="op" id="6025754">(</span><span class="ident" id="6025755">data</span><span class="op" id="6025759">[</span><span class="ident" id="6025760">m</span><span class="op" id="6025761">:</span><span class="ident" id="6025762">n</span><span class="op" id="6025763">]</span><span class="op" id="6025764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025770">p</span><span class="op" id="6025771">.</span><span class="ident" id="6025772">resetSpace</span><span class="op" id="6025782">(</span><span class="op" id="6025783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025789">p</span><span class="op" id="6025790">.</span><span class="ident" id="6025791">space</span>&nbsp;<span class="op" id="6025797">=</span>&nbsp;<span class="builtinfunc" id="6025799">append</span><span class="op" id="6025805">(</span><span class="ident" id="6025806">p</span><span class="op" id="6025807">.</span><span class="ident" id="6025808">space</span><span class="op" id="6025813">,</span>&nbsp;<span class="ident" id="6025815">b</span><span class="op" id="6025816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025821">case</span>&nbsp;<span class="string" id="6025826">&#39;\n&#39;</span><span class="op" id="6025830">,</span>&nbsp;<span class="string" id="6025832">&#39;\f&#39;</span><span class="op" id="6025836">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025842">_</span><span class="op" id="6025843">,</span>&nbsp;<span class="ident" id="6025845">err</span>&nbsp;<span class="op" id="6025849">=</span>&nbsp;<span class="ident" id="6025851">p</span><span class="op" id="6025852">.</span><span class="ident" id="6025853">output</span><span class="op" id="6025859">.</span><span class="ident" id="6025860">Write</span><span class="op" id="6025865">(</span><span class="ident" id="6025866">data</span><span class="op" id="6025870">[</span><span class="ident" id="6025871">m</span><span class="op" id="6025872">:</span><span class="ident" id="6025873">n</span><span class="op" id="6025874">]</span><span class="op" id="6025875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025881">p</span><span class="op" id="6025882">.</span><span class="ident" id="6025883">resetSpace</span><span class="op" id="6025893">(</span><span class="op" id="6025894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025900">_</span><span class="op" id="6025901">,</span>&nbsp;<span class="ident" id="6025903">err</span>&nbsp;<span class="op" id="6025907">=</span>&nbsp;<span class="ident" id="6025909">p</span><span class="op" id="6025910">.</span><span class="ident" id="6025911">output</span><span class="op" id="6025917">.</span><span class="ident" id="6025918">Write</span><span class="op" id="6025923">(</span><span class="ident" id="6025924">aNewline</span><span class="op" id="6025932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025937">case</span>&nbsp;<span class="ident" id="6025942">tabwriter</span><span class="op" id="6025951">.</span><span class="ident" id="6025952">Escape</span><span class="op" id="6025958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025964">_</span><span class="op" id="6025965">,</span>&nbsp;<span class="ident" id="6025967">err</span>&nbsp;<span class="op" id="6025971">=</span>&nbsp;<span class="ident" id="6025973">p</span><span class="op" id="6025974">.</span><span class="ident" id="6025975">output</span><span class="op" id="6025981">.</span><span class="ident" id="6025982">Write</span><span class="op" id="6025987">(</span><span class="ident" id="6025988">data</span><span class="op" id="6025992">[</span><span class="ident" id="6025993">m</span><span class="op" id="6025994">:</span><span class="ident" id="6025995">n</span><span class="op" id="6025996">]</span><span class="op" id="6025997">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026003">p</span><span class="op" id="6026004">.</span><span class="ident" id="6026005">state</span>&nbsp;<span class="op" id="6026011">=</span>&nbsp;<span class="ident" id="6026013">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026026">m</span>&nbsp;<span class="op" id="6026028">=</span>&nbsp;<span class="ident" id="6026030">n</span>&nbsp;<span class="op" id="6026032">+</span>&nbsp;<span class="num" id="6026034">1</span>&nbsp;<span class="comment" id="6026036">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026072">default</span><span class="op" id="6026079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6026084">panic</span><span class="op" id="6026089">(</span><span class="string" id="6026090">&#34;unreachable&#34;</span><span class="op" id="6026103">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026111">if</span>&nbsp;<span class="ident" id="6026114">err</span>&nbsp;<span class="op" id="6026118">!=</span>&nbsp;<span class="ident" id="6026121">nil</span>&nbsp;<span class="op" id="6026125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026142">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026145">n</span>&nbsp;<span class="op" id="6026147">=</span>&nbsp;<span class="builtinfunc" id="6026149">len</span><span class="op" id="6026152">(</span><span class="ident" id="6026153">data</span><span class="op" id="6026157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026161">switch</span>&nbsp;<span class="ident" id="6026168">p</span><span class="op" id="6026169">.</span><span class="ident" id="6026170">state</span>&nbsp;<span class="op" id="6026176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026179">case</span>&nbsp;<span class="ident" id="6026184">inEscape</span><span class="op" id="6026192">,</span>&nbsp;<span class="ident" id="6026194">inText</span><span class="op" id="6026200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026204">_</span><span class="op" id="6026205">,</span>&nbsp;<span class="ident" id="6026207">err</span>&nbsp;<span class="op" id="6026211">=</span>&nbsp;<span class="ident" id="6026213">p</span><span class="op" id="6026214">.</span><span class="ident" id="6026215">output</span><span class="op" id="6026221">.</span><span class="ident" id="6026222">Write</span><span class="op" id="6026227">(</span><span class="ident" id="6026228">data</span><span class="op" id="6026232">[</span><span class="ident" id="6026233">m</span><span class="op" id="6026234">:</span><span class="ident" id="6026235">n</span><span class="op" id="6026236">]</span><span class="op" id="6026237">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026241">p</span><span class="op" id="6026242">.</span><span class="ident" id="6026243">resetSpace</span><span class="op" id="6026253">(</span><span class="op" id="6026254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026261">return</span><br>
<span class="lineno"></span><span class="op" id="6026268">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="6026271">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6026351">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026372">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="6026437">type</span>&nbsp;<span class="ident" id="6026442">Mode</span>&nbsp;<span class="builtintype" id="6026447">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6026453">const</span>&nbsp;<span class="op" id="6026459">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026462">RawFormat</span>&nbsp;<span class="ident" id="6026472">Mode</span>&nbsp;<span class="op" id="6026477">=</span>&nbsp;<span class="num" id="6026479">1</span>&nbsp;<span class="op" id="6026481">&lt;&lt;</span>&nbsp;<span class="ident" id="6026484">iota</span>&nbsp;<span class="comment" id="6026489">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026546">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026573">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026627">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026654">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026699">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026726">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="6026788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026791">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="6026839">type</span>&nbsp;<span class="ident" id="6026844">Config</span>&nbsp;<span class="keyword" id="6026851">struct</span>&nbsp;<span class="op" id="6026858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026861">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026870">Mode</span>&nbsp;<span class="comment" id="6026875">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026890">Tabwidth</span>&nbsp;<span class="builtintype" id="6026899">int</span>&nbsp;&nbsp;<span class="comment" id="6026904">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026919">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6026928">int</span>&nbsp;&nbsp;<span class="comment" id="6026933">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="6026992">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="6026995">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="6027084">func</span>&nbsp;<span class="op" id="6027089">(</span><span class="ident" id="6027090">cfg</span>&nbsp;<span class="op" id="6027094">*</span><span class="ident" id="6027095">Config</span><span class="op" id="6027101">)</span>&nbsp;<span class="ident" id="6027103">fprint</span><span class="op" id="6027109">(</span><span class="ident" id="6027110">output</span>&nbsp;<span class="ident" id="6027117">io</span><span class="op" id="6027119">.</span><span class="ident" id="6027120">Writer</span><span class="op" id="6027126">,</span>&nbsp;<span class="ident" id="6027128">fset</span>&nbsp;<span class="op" id="6027133">*</span><span class="ident" id="6027134">token</span><span class="op" id="6027139">.</span><span class="ident" id="6027140">FileSet</span><span class="op" id="6027147">,</span>&nbsp;<span class="ident" id="6027149">node</span>&nbsp;<span class="keyword" id="6027154">interface</span><span class="op" id="6027163">{</span><span class="op" id="6027164">}</span><span class="op" id="6027165">,</span>&nbsp;<span class="ident" id="6027167">nodeSizes</span>&nbsp;<span class="keyword" id="6027177">map</span><span class="op" id="6027180">[</span><span class="ident" id="6027181">ast</span><span class="op" id="6027184">.</span><span class="ident" id="6027185">Node</span><span class="op" id="6027189">]</span><span class="builtintype" id="6027190">int</span><span class="op" id="6027193">)</span>&nbsp;<span class="op" id="6027195">(</span><span class="ident" id="6027196">err</span>&nbsp;<span class="builtintype" id="6027200">error</span><span class="op" id="6027205">)</span>&nbsp;<span class="op" id="6027207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027210">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027225">var</span>&nbsp;<span class="ident" id="6027229">p</span>&nbsp;<span class="ident" id="6027231">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027240">p</span><span class="op" id="6027241">.</span><span class="ident" id="6027242">init</span><span class="op" id="6027246">(</span><span class="ident" id="6027247">cfg</span><span class="op" id="6027250">,</span>&nbsp;<span class="ident" id="6027252">fset</span><span class="op" id="6027256">,</span>&nbsp;<span class="ident" id="6027258">nodeSizes</span><span class="op" id="6027267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027270">if</span>&nbsp;<span class="ident" id="6027273">err</span>&nbsp;<span class="op" id="6027277">=</span>&nbsp;<span class="ident" id="6027279">p</span><span class="op" id="6027280">.</span><span class="ident" id="6027281">printNode</span><span class="op" id="6027290">(</span><span class="ident" id="6027291">node</span><span class="op" id="6027295">)</span><span class="op" id="6027296">;</span>&nbsp;<span class="ident" id="6027298">err</span>&nbsp;<span class="op" id="6027302">!=</span>&nbsp;<span class="ident" id="6027305">nil</span>&nbsp;<span class="op" id="6027309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027324">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027355">p</span><span class="op" id="6027356">.</span><span class="ident" id="6027357">impliedSemi</span>&nbsp;<span class="op" id="6027369">=</span>&nbsp;<span class="builtintype" id="6027371">false</span>&nbsp;<span class="comment" id="6027377">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027405">p</span><span class="op" id="6027406">.</span><span class="ident" id="6027407">flush</span><span class="op" id="6027412">(</span><span class="ident" id="6027413">token</span><span class="op" id="6027418">.</span><span class="ident" id="6027419">Position</span><span class="op" id="6027427">{</span><span class="ident" id="6027428">Offset</span><span class="op" id="6027434">:</span>&nbsp;<span class="ident" id="6027436">infinity</span><span class="op" id="6027444">,</span>&nbsp;<span class="ident" id="6027446">Line</span><span class="op" id="6027450">:</span>&nbsp;<span class="ident" id="6027452">infinity</span><span class="op" id="6027460">}</span><span class="op" id="6027461">,</span>&nbsp;<span class="ident" id="6027463">token</span><span class="op" id="6027468">.</span><span class="ident" id="6027469">EOF</span><span class="op" id="6027472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027476">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027547">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027619">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027684">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027751">output</span>&nbsp;<span class="op" id="6027758">=</span>&nbsp;<span class="op" id="6027760">&amp;</span><span class="ident" id="6027761">trimmer</span><span class="op" id="6027768">{</span><span class="ident" id="6027769">output</span><span class="op" id="6027775">:</span>&nbsp;<span class="ident" id="6027777">output</span><span class="op" id="6027783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027787">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027840">if</span>&nbsp;<span class="ident" id="6027843">cfg</span><span class="op" id="6027846">.</span><span class="ident" id="6027847">Mode</span><span class="op" id="6027851">&amp;</span><span class="ident" id="6027852">RawFormat</span>&nbsp;<span class="op" id="6027862">==</span>&nbsp;<span class="num" id="6027865">0</span>&nbsp;<span class="op" id="6027867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027871">minwidth</span>&nbsp;<span class="op" id="6027880">:=</span>&nbsp;<span class="ident" id="6027883">cfg</span><span class="op" id="6027886">.</span><span class="ident" id="6027887">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027899">padchar</span>&nbsp;<span class="op" id="6027907">:=</span>&nbsp;<span class="builtintype" id="6027910">byte</span><span class="op" id="6027914">(</span><span class="string" id="6027915">&#39;\t&#39;</span><span class="op" id="6027919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027923">if</span>&nbsp;<span class="ident" id="6027926">cfg</span><span class="op" id="6027929">.</span><span class="ident" id="6027930">Mode</span><span class="op" id="6027934">&amp;</span><span class="ident" id="6027935">UseSpaces</span>&nbsp;<span class="op" id="6027945">!=</span>&nbsp;<span class="num" id="6027948">0</span>&nbsp;<span class="op" id="6027950">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027955">padchar</span>&nbsp;<span class="op" id="6027963">=</span>&nbsp;<span class="string" id="6027965">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027976">twmode</span>&nbsp;<span class="op" id="6027983">:=</span>&nbsp;<span class="ident" id="6027986">tabwriter</span><span class="op" id="6027995">.</span><span class="ident" id="6027996">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028018">if</span>&nbsp;<span class="ident" id="6028021">cfg</span><span class="op" id="6028024">.</span><span class="ident" id="6028025">Mode</span><span class="op" id="6028029">&amp;</span><span class="ident" id="6028030">TabIndent</span>&nbsp;<span class="op" id="6028040">!=</span>&nbsp;<span class="num" id="6028043">0</span>&nbsp;<span class="op" id="6028045">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028050">minwidth</span>&nbsp;<span class="op" id="6028059">=</span>&nbsp;<span class="num" id="6028061">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028066">twmode</span>&nbsp;<span class="op" id="6028073">|=</span>&nbsp;<span class="ident" id="6028076">tabwriter</span><span class="op" id="6028085">.</span><span class="ident" id="6028086">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028103">output</span>&nbsp;<span class="op" id="6028110">=</span>&nbsp;<span class="ident" id="6028112">tabwriter</span><span class="op" id="6028121">.</span><span class="ident" id="6028122">NewWriter</span><span class="op" id="6028131">(</span><span class="ident" id="6028132">output</span><span class="op" id="6028138">,</span>&nbsp;<span class="ident" id="6028140">minwidth</span><span class="op" id="6028148">,</span>&nbsp;<span class="ident" id="6028150">cfg</span><span class="op" id="6028153">.</span><span class="ident" id="6028154">Tabwidth</span><span class="op" id="6028162">,</span>&nbsp;<span class="num" id="6028164">1</span><span class="op" id="6028165">,</span>&nbsp;<span class="ident" id="6028167">padchar</span><span class="op" id="6028174">,</span>&nbsp;<span class="ident" id="6028176">twmode</span><span class="op" id="6028182">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028189">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028246">if</span>&nbsp;<span class="ident" id="6028249">_</span><span class="op" id="6028250">,</span>&nbsp;<span class="ident" id="6028252">err</span>&nbsp;<span class="op" id="6028256">=</span>&nbsp;<span class="ident" id="6028258">output</span><span class="op" id="6028264">.</span><span class="ident" id="6028265">Write</span><span class="op" id="6028270">(</span><span class="ident" id="6028271">p</span><span class="op" id="6028272">.</span><span class="ident" id="6028273">output</span><span class="op" id="6028279">)</span><span class="op" id="6028280">;</span>&nbsp;<span class="ident" id="6028282">err</span>&nbsp;<span class="op" id="6028286">!=</span>&nbsp;<span class="ident" id="6028289">nil</span>&nbsp;<span class="op" id="6028293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028297">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028309">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028337">if</span>&nbsp;<span class="ident" id="6028340">tw</span><span class="op" id="6028342">,</span>&nbsp;<span class="ident" id="6028344">_</span>&nbsp;<span class="op" id="6028346">:=</span>&nbsp;<span class="ident" id="6028349">output</span><span class="op" id="6028355">.</span><span class="op" id="6028356">(</span><span class="op" id="6028357">*</span><span class="ident" id="6028358">tabwriter</span><span class="op" id="6028367">.</span><span class="ident" id="6028368">Writer</span><span class="op" id="6028374">)</span><span class="op" id="6028375">;</span>&nbsp;<span class="ident" id="6028377">tw</span>&nbsp;<span class="op" id="6028380">!=</span>&nbsp;<span class="ident" id="6028383">nil</span>&nbsp;<span class="op" id="6028387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028391">err</span>&nbsp;<span class="op" id="6028395">=</span>&nbsp;<span class="ident" id="6028397">tw</span><span class="op" id="6028399">.</span><span class="ident" id="6028400">Flush</span><span class="op" id="6028405">(</span><span class="op" id="6028406">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028413">return</span><br>
<span class="lineno"></span><span class="op" id="6028420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="6028423">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="6028490">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6028556">//</span><br>
<span class="lineno"></span><span class="keyword" id="6028559">type</span>&nbsp;<span class="ident" id="6028564">CommentedNode</span>&nbsp;<span class="keyword" id="6028578">struct</span>&nbsp;<span class="op" id="6028585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028588">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028597">interface</span><span class="op" id="6028606">{</span><span class="op" id="6028607">}</span>&nbsp;<span class="comment" id="6028609">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028669">Comments</span>&nbsp;<span class="op" id="6028678">[</span><span class="op" id="6028679">]</span><span class="op" id="6028680">*</span><span class="ident" id="6028681">ast</span><span class="op" id="6028684">.</span><span class="ident" id="6028685">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="6028698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6028701">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="6028780">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="6028850">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="6028926">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="6029000">//</span><br>
<span class="lineno"></span><span class="keyword" id="6029003">func</span>&nbsp;<span class="op" id="6029008">(</span><span class="ident" id="6029009">cfg</span>&nbsp;<span class="op" id="6029013">*</span><span class="ident" id="6029014">Config</span><span class="op" id="6029020">)</span>&nbsp;<span class="ident" id="6029022">Fprint</span><span class="op" id="6029028">(</span><span class="ident" id="6029029">output</span>&nbsp;<span class="ident" id="6029036">io</span><span class="op" id="6029038">.</span><span class="ident" id="6029039">Writer</span><span class="op" id="6029045">,</span>&nbsp;<span class="ident" id="6029047">fset</span>&nbsp;<span class="op" id="6029052">*</span><span class="ident" id="6029053">token</span><span class="op" id="6029058">.</span><span class="ident" id="6029059">FileSet</span><span class="op" id="6029066">,</span>&nbsp;<span class="ident" id="6029068">node</span>&nbsp;<span class="keyword" id="6029073">interface</span><span class="op" id="6029082">{</span><span class="op" id="6029083">}</span><span class="op" id="6029084">)</span>&nbsp;<span class="builtintype" id="6029086">error</span>&nbsp;<span class="op" id="6029092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029095">return</span>&nbsp;<span class="ident" id="6029102">cfg</span><span class="op" id="6029105">.</span><span class="ident" id="6029106">fprint</span><span class="op" id="6029112">(</span><span class="ident" id="6029113">output</span><span class="op" id="6029119">,</span>&nbsp;<span class="ident" id="6029121">fset</span><span class="op" id="6029125">,</span>&nbsp;<span class="ident" id="6029127">node</span><span class="op" id="6029131">,</span>&nbsp;<span class="builtinfunc" id="6029133">make</span><span class="op" id="6029137">(</span><span class="keyword" id="6029138">map</span><span class="op" id="6029141">[</span><span class="ident" id="6029142">ast</span><span class="op" id="6029145">.</span><span class="ident" id="6029146">Node</span><span class="op" id="6029150">]</span><span class="builtintype" id="6029151">int</span><span class="op" id="6029154">)</span><span class="op" id="6029155">)</span><br>
<span class="lineno">1285</span><span class="op" id="6029157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6029160">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6029209">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="6029258">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="6029261">func</span>&nbsp;<span class="ident" id="6029266">Fprint</span><span class="op" id="6029272">(</span><span class="ident" id="6029273">output</span>&nbsp;<span class="ident" id="6029280">io</span><span class="op" id="6029282">.</span><span class="ident" id="6029283">Writer</span><span class="op" id="6029289">,</span>&nbsp;<span class="ident" id="6029291">fset</span>&nbsp;<span class="op" id="6029296">*</span><span class="ident" id="6029297">token</span><span class="op" id="6029302">.</span><span class="ident" id="6029303">FileSet</span><span class="op" id="6029310">,</span>&nbsp;<span class="ident" id="6029312">node</span>&nbsp;<span class="keyword" id="6029317">interface</span><span class="op" id="6029326">{</span><span class="op" id="6029327">}</span><span class="op" id="6029328">)</span>&nbsp;<span class="builtintype" id="6029330">error</span>&nbsp;<span class="op" id="6029336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029339">return</span>&nbsp;<span class="op" id="6029346">(</span><span class="op" id="6029347">&amp;</span><span class="ident" id="6029348">Config</span><span class="op" id="6029354">{</span><span class="ident" id="6029355">Tabwidth</span><span class="op" id="6029363">:</span>&nbsp;<span class="num" id="6029365">8</span><span class="op" id="6029366">}</span><span class="op" id="6029367">)</span><span class="op" id="6029368">.</span><span class="ident" id="6029369">Fprint</span><span class="op" id="6029375">(</span><span class="ident" id="6029376">output</span><span class="op" id="6029382">,</span>&nbsp;<span class="ident" id="6029384">fset</span><span class="op" id="6029388">,</span>&nbsp;<span class="ident" id="6029390">node</span><span class="op" id="6029394">)</span><br>
<span class="lineno"></span><span class="op" id="6029396">}</span>
</div>
</body>
</html>
