<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3827602">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3827657">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3827711">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3827762">package</span>&nbsp;<span class="ident" id="3827770">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3827778">import</span>&nbsp;<span class="string" id="3827785">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3827791">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3827869">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3827901">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3827973">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3828028">type</span>&nbsp;<span class="ident" id="3828033">StreamReader</span>&nbsp;<span class="keyword" id="3828046">struct</span>&nbsp;<span class="op" id="3828053">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828056">S</span>&nbsp;<span class="ident" id="3828058">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828066">R</span>&nbsp;<span class="ident" id="3828068">io</span><span class="op" id="3828070">.</span><span class="ident" id="3828071">Reader</span><br>
<span class="lineno"></span><span class="op" id="3828078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3828081">func</span>&nbsp;<span class="op" id="3828086">(</span><span class="ident" id="3828087">r</span>&nbsp;<span class="ident" id="3828089">StreamReader</span><span class="op" id="3828101">)</span>&nbsp;<span class="ident" id="3828103">Read</span><span class="op" id="3828107">(</span><span class="ident" id="3828108">dst</span>&nbsp;<span class="op" id="3828112">[</span><span class="op" id="3828113">]</span><span class="builtintype" id="3828114">byte</span><span class="op" id="3828118">)</span>&nbsp;<span class="op" id="3828120">(</span><span class="ident" id="3828121">n</span>&nbsp;<span class="builtintype" id="3828123">int</span><span class="op" id="3828126">,</span>&nbsp;<span class="ident" id="3828128">err</span>&nbsp;<span class="builtintype" id="3828132">error</span><span class="op" id="3828137">)</span>&nbsp;<span class="op" id="3828139">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828142">n</span><span class="op" id="3828143">,</span>&nbsp;<span class="ident" id="3828145">err</span>&nbsp;<span class="op" id="3828149">=</span>&nbsp;<span class="ident" id="3828151">r</span><span class="op" id="3828152">.</span><span class="ident" id="3828153">R</span><span class="op" id="3828154">.</span><span class="ident" id="3828155">Read</span><span class="op" id="3828159">(</span><span class="ident" id="3828160">dst</span><span class="op" id="3828163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828166">r</span><span class="op" id="3828167">.</span><span class="ident" id="3828168">S</span><span class="op" id="3828169">.</span><span class="ident" id="3828170">XORKeyStream</span><span class="op" id="3828182">(</span><span class="ident" id="3828183">dst</span><span class="op" id="3828186">[</span><span class="op" id="3828187">:</span><span class="ident" id="3828188">n</span><span class="op" id="3828189">]</span><span class="op" id="3828190">,</span>&nbsp;<span class="ident" id="3828192">dst</span><span class="op" id="3828195">[</span><span class="op" id="3828196">:</span><span class="ident" id="3828197">n</span><span class="op" id="3828198">]</span><span class="op" id="3828199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828202">return</span><br>
<span class="lineno"></span><span class="op" id="3828209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3828212">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3828284">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3828357">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3828434">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3828499">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3828536">type</span>&nbsp;<span class="ident" id="3828541">StreamWriter</span>&nbsp;<span class="keyword" id="3828554">struct</span>&nbsp;<span class="op" id="3828561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828564">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3828568">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828576">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3828580">io</span><span class="op" id="3828582">.</span><span class="ident" id="3828583">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828591">Err</span>&nbsp;<span class="builtintype" id="3828595">error</span>&nbsp;<span class="comment" id="3828601">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3828611">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3828614">func</span>&nbsp;<span class="op" id="3828619">(</span><span class="ident" id="3828620">w</span>&nbsp;<span class="ident" id="3828622">StreamWriter</span><span class="op" id="3828634">)</span>&nbsp;<span class="ident" id="3828636">Write</span><span class="op" id="3828641">(</span><span class="ident" id="3828642">src</span>&nbsp;<span class="op" id="3828646">[</span><span class="op" id="3828647">]</span><span class="builtintype" id="3828648">byte</span><span class="op" id="3828652">)</span>&nbsp;<span class="op" id="3828654">(</span><span class="ident" id="3828655">n</span>&nbsp;<span class="builtintype" id="3828657">int</span><span class="op" id="3828660">,</span>&nbsp;<span class="ident" id="3828662">err</span>&nbsp;<span class="builtintype" id="3828666">error</span><span class="op" id="3828671">)</span>&nbsp;<span class="op" id="3828673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828676">c</span>&nbsp;<span class="op" id="3828678">:=</span>&nbsp;<span class="builtinfunc" id="3828681">make</span><span class="op" id="3828685">(</span><span class="op" id="3828686">[</span><span class="op" id="3828687">]</span><span class="builtintype" id="3828688">byte</span><span class="op" id="3828692">,</span>&nbsp;<span class="builtinfunc" id="3828694">len</span><span class="op" id="3828697">(</span><span class="ident" id="3828698">src</span><span class="op" id="3828701">)</span><span class="op" id="3828702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828705">w</span><span class="op" id="3828706">.</span><span class="ident" id="3828707">S</span><span class="op" id="3828708">.</span><span class="ident" id="3828709">XORKeyStream</span><span class="op" id="3828721">(</span><span class="ident" id="3828722">c</span><span class="op" id="3828723">,</span>&nbsp;<span class="ident" id="3828725">src</span><span class="op" id="3828728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828731">n</span><span class="op" id="3828732">,</span>&nbsp;<span class="ident" id="3828734">err</span>&nbsp;<span class="op" id="3828738">=</span>&nbsp;<span class="ident" id="3828740">w</span><span class="op" id="3828741">.</span><span class="ident" id="3828742">W</span><span class="op" id="3828743">.</span><span class="ident" id="3828744">Write</span><span class="op" id="3828749">(</span><span class="ident" id="3828750">c</span><span class="op" id="3828751">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828754">if</span>&nbsp;<span class="ident" id="3828757">n</span>&nbsp;<span class="op" id="3828759">!=</span>&nbsp;<span class="builtinfunc" id="3828762">len</span><span class="op" id="3828765">(</span><span class="ident" id="3828766">src</span><span class="op" id="3828769">)</span>&nbsp;<span class="op" id="3828771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828775">if</span>&nbsp;<span class="ident" id="3828778">err</span>&nbsp;<span class="op" id="3828782">==</span>&nbsp;<span class="ident" id="3828785">nil</span>&nbsp;<span class="op" id="3828789">{</span>&nbsp;<span class="comment" id="3828791">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828817">err</span>&nbsp;<span class="op" id="3828821">=</span>&nbsp;<span class="ident" id="3828823">io</span><span class="op" id="3828825">.</span><span class="ident" id="3828826">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828845">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828848">return</span><br>
<span class="lineno"></span><span class="op" id="3828855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3828858">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3828946">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3828997">func</span>&nbsp;<span class="op" id="3829002">(</span><span class="ident" id="3829003">w</span>&nbsp;<span class="ident" id="3829005">StreamWriter</span><span class="op" id="3829017">)</span>&nbsp;<span class="ident" id="3829019">Close</span><span class="op" id="3829024">(</span><span class="op" id="3829025">)</span>&nbsp;<span class="builtintype" id="3829027">error</span>&nbsp;<span class="op" id="3829033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829036">if</span>&nbsp;<span class="ident" id="3829039">c</span><span class="op" id="3829040">,</span>&nbsp;<span class="ident" id="3829042">ok</span>&nbsp;<span class="op" id="3829045">:=</span>&nbsp;<span class="ident" id="3829048">w</span><span class="op" id="3829049">.</span><span class="ident" id="3829050">W</span><span class="op" id="3829051">.</span><span class="op" id="3829052">(</span><span class="ident" id="3829053">io</span><span class="op" id="3829055">.</span><span class="ident" id="3829056">Closer</span><span class="op" id="3829062">)</span><span class="op" id="3829063">;</span>&nbsp;<span class="ident" id="3829065">ok</span>&nbsp;<span class="op" id="3829068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829072">return</span>&nbsp;<span class="ident" id="3829079">c</span><span class="op" id="3829080">.</span><span class="ident" id="3829081">Close</span><span class="op" id="3829086">(</span><span class="op" id="3829087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829093">return</span>&nbsp;<span class="ident" id="3829100">nil</span><br>
<span class="lineno">55</span><span class="op" id="3829104">}</span>
</div>
</body>
</html>
