<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html" class="current">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3694361">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3694416">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3694470">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3694521">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3694593">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3694667">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="3694742">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="3694800">//</span><br>
<span class="lineno">10</span><span class="keyword" id="3694803">package</span>&nbsp;<span class="ident" id="3694811">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3694819">import</span>&nbsp;<span class="op" id="3694826">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694829">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694836">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694846">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694860">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694872">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694883">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3694894">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="3694904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3694907">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3694966">type</span>&nbsp;<span class="ident" id="3694971">parser</span>&nbsp;<span class="keyword" id="3694978">struct</span>&nbsp;<span class="op" id="3694985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694988">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3694996">*</span><span class="ident" id="3694997">token</span><span class="op" id="3695002">.</span><span class="ident" id="3695003">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695009">errors</span>&nbsp;&nbsp;<span class="ident" id="3695017">scanner</span><span class="op" id="3695024">.</span><span class="ident" id="3695025">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695036">scanner</span>&nbsp;<span class="ident" id="3695044">scanner</span><span class="op" id="3695051">.</span><span class="ident" id="3695052">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695062">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695084">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3695091">Mode</span>&nbsp;<span class="comment" id="3695096">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695113">trace</span>&nbsp;&nbsp;<span class="builtintype" id="3695120">bool</span>&nbsp;<span class="comment" id="3695125">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695152">indent</span>&nbsp;<span class="builtintype" id="3695159">int</span>&nbsp;&nbsp;<span class="comment" id="3695164">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695205">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695218">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3695230">[</span><span class="op" id="3695231">]</span><span class="op" id="3695232">*</span><span class="ident" id="3695233">ast</span><span class="op" id="3695236">.</span><span class="ident" id="3695237">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695251">leadComment</span>&nbsp;<span class="op" id="3695263">*</span><span class="ident" id="3695264">ast</span><span class="op" id="3695267">.</span><span class="ident" id="3695268">CommentGroup</span>&nbsp;<span class="comment" id="3695281">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695303">lineComment</span>&nbsp;<span class="op" id="3695315">*</span><span class="ident" id="3695316">ast</span><span class="op" id="3695319">.</span><span class="ident" id="3695320">CommentGroup</span>&nbsp;<span class="comment" id="3695333">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695356">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695371">pos</span>&nbsp;<span class="ident" id="3695375">token</span><span class="op" id="3695380">.</span><span class="ident" id="3695381">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3695387">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695406">tok</span>&nbsp;<span class="ident" id="3695410">token</span><span class="op" id="3695415">.</span><span class="ident" id="3695416">Token</span>&nbsp;<span class="comment" id="3695422">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695447">lit</span>&nbsp;<span class="builtintype" id="3695451">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695463">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695482">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695501">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695561">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695621">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695687">syncPos</span>&nbsp;<span class="ident" id="3695695">token</span><span class="op" id="3695700">.</span><span class="ident" id="3695701">Pos</span>&nbsp;<span class="comment" id="3695705">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695739">syncCnt</span>&nbsp;<span class="builtintype" id="3695747">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695757">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695806">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695839">exprLev</span>&nbsp;<span class="builtintype" id="3695847">int</span>&nbsp;&nbsp;<span class="comment" id="3695852">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695900">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3695908">bool</span>&nbsp;<span class="comment" id="3695913">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695965">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695996">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3696007">*</span><span class="ident" id="3696008">ast</span><span class="op" id="3696011">.</span><span class="ident" id="3696012">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696025">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696051">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3696062">*</span><span class="ident" id="3696063">ast</span><span class="op" id="3696066">.</span><span class="ident" id="3696067">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696080">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696116">unresolved</span>&nbsp;<span class="op" id="3696127">[</span><span class="op" id="3696128">]</span><span class="op" id="3696129">*</span><span class="ident" id="3696130">ast</span><span class="op" id="3696133">.</span><span class="ident" id="3696134">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696145">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696172">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3696183">[</span><span class="op" id="3696184">]</span><span class="op" id="3696185">*</span><span class="ident" id="3696186">ast</span><span class="op" id="3696189">.</span><span class="ident" id="3696190">ImportSpec</span>&nbsp;<span class="comment" id="3696201">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696222">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696239">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696281">labelScope</span>&nbsp;&nbsp;<span class="op" id="3696293">*</span><span class="ident" id="3696294">ast</span><span class="op" id="3696297">.</span><span class="ident" id="3696298">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696308">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696345">targetStack</span>&nbsp;<span class="op" id="3696357">[</span><span class="op" id="3696358">]</span><span class="op" id="3696359">[</span><span class="op" id="3696360">]</span><span class="op" id="3696361">*</span><span class="ident" id="3696362">ast</span><span class="op" id="3696365">.</span><span class="ident" id="3696366">Ident</span>&nbsp;<span class="comment" id="3696372">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="3696402">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3696405">func</span>&nbsp;<span class="op" id="3696410">(</span><span class="ident" id="3696411">p</span>&nbsp;<span class="op" id="3696413">*</span><span class="ident" id="3696414">parser</span><span class="op" id="3696420">)</span>&nbsp;<span class="ident" id="3696422">init</span><span class="op" id="3696426">(</span><span class="ident" id="3696427">fset</span>&nbsp;<span class="op" id="3696432">*</span><span class="ident" id="3696433">token</span><span class="op" id="3696438">.</span><span class="ident" id="3696439">FileSet</span><span class="op" id="3696446">,</span>&nbsp;<span class="ident" id="3696448">filename</span>&nbsp;<span class="builtintype" id="3696457">string</span><span class="op" id="3696463">,</span>&nbsp;<span class="ident" id="3696465">src</span>&nbsp;<span class="op" id="3696469">[</span><span class="op" id="3696470">]</span><span class="builtintype" id="3696471">byte</span><span class="op" id="3696475">,</span>&nbsp;<span class="ident" id="3696477">mode</span>&nbsp;<span class="ident" id="3696482">Mode</span><span class="op" id="3696486">)</span>&nbsp;<span class="op" id="3696488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696491">p</span><span class="op" id="3696492">.</span><span class="ident" id="3696493">file</span>&nbsp;<span class="op" id="3696498">=</span>&nbsp;<span class="ident" id="3696500">fset</span><span class="op" id="3696504">.</span><span class="ident" id="3696505">AddFile</span><span class="op" id="3696512">(</span><span class="ident" id="3696513">filename</span><span class="op" id="3696521">,</span>&nbsp;<span class="op" id="3696523">-</span><span class="num" id="3696524">1</span><span class="op" id="3696525">,</span>&nbsp;<span class="builtinfunc" id="3696527">len</span><span class="op" id="3696530">(</span><span class="ident" id="3696531">src</span><span class="op" id="3696534">)</span><span class="op" id="3696535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3696538">var</span>&nbsp;<span class="ident" id="3696542">m</span>&nbsp;<span class="ident" id="3696544">scanner</span><span class="op" id="3696551">.</span><span class="ident" id="3696552">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3696558">if</span>&nbsp;<span class="ident" id="3696561">mode</span><span class="op" id="3696565">&amp;</span><span class="ident" id="3696566">ParseComments</span>&nbsp;<span class="op" id="3696580">!=</span>&nbsp;<span class="num" id="3696583">0</span>&nbsp;<span class="op" id="3696585">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696589">m</span>&nbsp;<span class="op" id="3696591">=</span>&nbsp;<span class="ident" id="3696593">scanner</span><span class="op" id="3696600">.</span><span class="ident" id="3696601">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3696615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696618">eh</span>&nbsp;<span class="op" id="3696621">:=</span>&nbsp;<span class="keyword" id="3696624">func</span><span class="op" id="3696628">(</span><span class="ident" id="3696629">pos</span>&nbsp;<span class="ident" id="3696633">token</span><span class="op" id="3696638">.</span><span class="ident" id="3696639">Position</span><span class="op" id="3696647">,</span>&nbsp;<span class="ident" id="3696649">msg</span>&nbsp;<span class="builtintype" id="3696653">string</span><span class="op" id="3696659">)</span>&nbsp;<span class="op" id="3696661">{</span>&nbsp;<span class="ident" id="3696663">p</span><span class="op" id="3696664">.</span><span class="ident" id="3696665">errors</span><span class="op" id="3696671">.</span><span class="ident" id="3696672">Add</span><span class="op" id="3696675">(</span><span class="ident" id="3696676">pos</span><span class="op" id="3696679">,</span>&nbsp;<span class="ident" id="3696681">msg</span><span class="op" id="3696684">)</span>&nbsp;<span class="op" id="3696686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696689">p</span><span class="op" id="3696690">.</span><span class="ident" id="3696691">scanner</span><span class="op" id="3696698">.</span><span class="ident" id="3696699">Init</span><span class="op" id="3696703">(</span><span class="ident" id="3696704">p</span><span class="op" id="3696705">.</span><span class="ident" id="3696706">file</span><span class="op" id="3696710">,</span>&nbsp;<span class="ident" id="3696712">src</span><span class="op" id="3696715">,</span>&nbsp;<span class="ident" id="3696717">eh</span><span class="op" id="3696719">,</span>&nbsp;<span class="ident" id="3696721">m</span><span class="op" id="3696722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696726">p</span><span class="op" id="3696727">.</span><span class="ident" id="3696728">mode</span>&nbsp;<span class="op" id="3696733">=</span>&nbsp;<span class="ident" id="3696735">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696741">p</span><span class="op" id="3696742">.</span><span class="ident" id="3696743">trace</span>&nbsp;<span class="op" id="3696749">=</span>&nbsp;<span class="ident" id="3696751">mode</span><span class="op" id="3696755">&amp;</span><span class="ident" id="3696756">Trace</span>&nbsp;<span class="op" id="3696762">!=</span>&nbsp;<span class="num" id="3696765">0</span>&nbsp;<span class="comment" id="3696767">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696817">p</span><span class="op" id="3696818">.</span><span class="ident" id="3696819">next</span><span class="op" id="3696823">(</span><span class="op" id="3696824">)</span><br>
<span class="lineno"></span><span class="op" id="3696826">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3696829">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3696909">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3696929">func</span>&nbsp;<span class="op" id="3696934">(</span><span class="ident" id="3696935">p</span>&nbsp;<span class="op" id="3696937">*</span><span class="ident" id="3696938">parser</span><span class="op" id="3696944">)</span>&nbsp;<span class="ident" id="3696946">openScope</span><span class="op" id="3696955">(</span><span class="op" id="3696956">)</span>&nbsp;<span class="op" id="3696958">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696961">p</span><span class="op" id="3696962">.</span><span class="ident" id="3696963">topScope</span>&nbsp;<span class="op" id="3696972">=</span>&nbsp;<span class="ident" id="3696974">ast</span><span class="op" id="3696977">.</span><span class="ident" id="3696978">NewScope</span><span class="op" id="3696986">(</span><span class="ident" id="3696987">p</span><span class="op" id="3696988">.</span><span class="ident" id="3696989">topScope</span><span class="op" id="3696997">)</span><br>
<span class="lineno"></span><span class="op" id="3696999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3697002">func</span>&nbsp;<span class="op" id="3697007">(</span><span class="ident" id="3697008">p</span>&nbsp;<span class="op" id="3697010">*</span><span class="ident" id="3697011">parser</span><span class="op" id="3697017">)</span>&nbsp;<span class="ident" id="3697019">closeScope</span><span class="op" id="3697029">(</span><span class="op" id="3697030">)</span>&nbsp;<span class="op" id="3697032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697035">p</span><span class="op" id="3697036">.</span><span class="ident" id="3697037">topScope</span>&nbsp;<span class="op" id="3697046">=</span>&nbsp;<span class="ident" id="3697048">p</span><span class="op" id="3697049">.</span><span class="ident" id="3697050">topScope</span><span class="op" id="3697058">.</span><span class="ident" id="3697059">Outer</span><br>
<span class="lineno">90</span><span class="op" id="3697065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3697068">func</span>&nbsp;<span class="op" id="3697073">(</span><span class="ident" id="3697074">p</span>&nbsp;<span class="op" id="3697076">*</span><span class="ident" id="3697077">parser</span><span class="op" id="3697083">)</span>&nbsp;<span class="ident" id="3697085">openLabelScope</span><span class="op" id="3697099">(</span><span class="op" id="3697100">)</span>&nbsp;<span class="op" id="3697102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697105">p</span><span class="op" id="3697106">.</span><span class="ident" id="3697107">labelScope</span>&nbsp;<span class="op" id="3697118">=</span>&nbsp;<span class="ident" id="3697120">ast</span><span class="op" id="3697123">.</span><span class="ident" id="3697124">NewScope</span><span class="op" id="3697132">(</span><span class="ident" id="3697133">p</span><span class="op" id="3697134">.</span><span class="ident" id="3697135">labelScope</span><span class="op" id="3697145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697148">p</span><span class="op" id="3697149">.</span><span class="ident" id="3697150">targetStack</span>&nbsp;<span class="op" id="3697162">=</span>&nbsp;<span class="builtinfunc" id="3697164">append</span><span class="op" id="3697170">(</span><span class="ident" id="3697171">p</span><span class="op" id="3697172">.</span><span class="ident" id="3697173">targetStack</span><span class="op" id="3697184">,</span>&nbsp;<span class="builtintype" id="3697186">nil</span><span class="op" id="3697189">)</span><br>
<span class="lineno">95</span><span class="op" id="3697191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3697194">func</span>&nbsp;<span class="op" id="3697199">(</span><span class="ident" id="3697200">p</span>&nbsp;<span class="op" id="3697202">*</span><span class="ident" id="3697203">parser</span><span class="op" id="3697209">)</span>&nbsp;<span class="ident" id="3697211">closeLabelScope</span><span class="op" id="3697226">(</span><span class="op" id="3697227">)</span>&nbsp;<span class="op" id="3697229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3697232">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697251">n</span>&nbsp;<span class="op" id="3697253">:=</span>&nbsp;<span class="builtinfunc" id="3697256">len</span><span class="op" id="3697259">(</span><span class="ident" id="3697260">p</span><span class="op" id="3697261">.</span><span class="ident" id="3697262">targetStack</span><span class="op" id="3697273">)</span>&nbsp;<span class="op" id="3697275">-</span>&nbsp;<span class="num" id="3697277">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697280">scope</span>&nbsp;<span class="op" id="3697286">:=</span>&nbsp;<span class="ident" id="3697289">p</span><span class="op" id="3697290">.</span><span class="ident" id="3697291">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3697303">for</span>&nbsp;<span class="ident" id="3697307">_</span><span class="op" id="3697308">,</span>&nbsp;<span class="ident" id="3697310">ident</span>&nbsp;<span class="op" id="3697316">:=</span>&nbsp;<span class="keyword" id="3697319">range</span>&nbsp;<span class="ident" id="3697325">p</span><span class="op" id="3697326">.</span><span class="ident" id="3697327">targetStack</span><span class="op" id="3697338">[</span><span class="ident" id="3697339">n</span><span class="op" id="3697340">]</span>&nbsp;<span class="op" id="3697342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697346">ident</span><span class="op" id="3697351">.</span><span class="ident" id="3697352">Obj</span>&nbsp;<span class="op" id="3697356">=</span>&nbsp;<span class="ident" id="3697358">scope</span><span class="op" id="3697363">.</span><span class="ident" id="3697364">Lookup</span><span class="op" id="3697370">(</span><span class="ident" id="3697371">ident</span><span class="op" id="3697376">.</span><span class="ident" id="3697377">Name</span><span class="op" id="3697381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3697385">if</span>&nbsp;<span class="ident" id="3697388">ident</span><span class="op" id="3697393">.</span><span class="ident" id="3697394">Obj</span>&nbsp;<span class="op" id="3697398">==</span>&nbsp;<span class="builtintype" id="3697401">nil</span>&nbsp;<span class="op" id="3697405">&amp;&amp;</span>&nbsp;<span class="ident" id="3697408">p</span><span class="op" id="3697409">.</span><span class="ident" id="3697410">mode</span><span class="op" id="3697414">&amp;</span><span class="ident" id="3697415">DeclarationErrors</span>&nbsp;<span class="op" id="3697433">!=</span>&nbsp;<span class="num" id="3697436">0</span>&nbsp;<span class="op" id="3697438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697443">p</span><span class="op" id="3697444">.</span><span class="builtintype" id="3697445">error</span><span class="op" id="3697450">(</span><span class="ident" id="3697451">ident</span><span class="op" id="3697456">.</span><span class="ident" id="3697457">Pos</span><span class="op" id="3697460">(</span><span class="op" id="3697461">)</span><span class="op" id="3697462">,</span>&nbsp;<span class="ident" id="3697464">fmt</span><span class="op" id="3697467">.</span><span class="ident" id="3697468">Sprintf</span><span class="op" id="3697475">(</span><span class="string" id="3697476">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="3697496">,</span>&nbsp;<span class="ident" id="3697498">ident</span><span class="op" id="3697503">.</span><span class="ident" id="3697504">Name</span><span class="op" id="3697508">)</span><span class="op" id="3697509">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3697513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3697516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3697519">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697539">p</span><span class="op" id="3697540">.</span><span class="ident" id="3697541">targetStack</span>&nbsp;<span class="op" id="3697553">=</span>&nbsp;<span class="ident" id="3697555">p</span><span class="op" id="3697556">.</span><span class="ident" id="3697557">targetStack</span><span class="op" id="3697568">[</span><span class="num" id="3697569">0</span><span class="op" id="3697570">:</span><span class="ident" id="3697571">n</span><span class="op" id="3697572">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697575">p</span><span class="op" id="3697576">.</span><span class="ident" id="3697577">labelScope</span>&nbsp;<span class="op" id="3697588">=</span>&nbsp;<span class="ident" id="3697590">p</span><span class="op" id="3697591">.</span><span class="ident" id="3697592">labelScope</span><span class="op" id="3697602">.</span><span class="ident" id="3697603">Outer</span><br>
<span class="lineno">110</span><span class="op" id="3697609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3697612">func</span>&nbsp;<span class="op" id="3697617">(</span><span class="ident" id="3697618">p</span>&nbsp;<span class="op" id="3697620">*</span><span class="ident" id="3697621">parser</span><span class="op" id="3697627">)</span>&nbsp;<span class="ident" id="3697629">declare</span><span class="op" id="3697636">(</span><span class="ident" id="3697637">decl</span><span class="op" id="3697641">,</span>&nbsp;<span class="ident" id="3697643">data</span>&nbsp;<span class="keyword" id="3697648">interface</span><span class="op" id="3697657">{</span><span class="op" id="3697658">}</span><span class="op" id="3697659">,</span>&nbsp;<span class="ident" id="3697661">scope</span>&nbsp;<span class="op" id="3697667">*</span><span class="ident" id="3697668">ast</span><span class="op" id="3697671">.</span><span class="ident" id="3697672">Scope</span><span class="op" id="3697677">,</span>&nbsp;<span class="ident" id="3697679">kind</span>&nbsp;<span class="ident" id="3697684">ast</span><span class="op" id="3697687">.</span><span class="ident" id="3697688">ObjKind</span><span class="op" id="3697695">,</span>&nbsp;<span class="ident" id="3697697">idents</span>&nbsp;<span class="op" id="3697704">...</span><span class="op" id="3697707">*</span><span class="ident" id="3697708">ast</span><span class="op" id="3697711">.</span><span class="ident" id="3697712">Ident</span><span class="op" id="3697717">)</span>&nbsp;<span class="op" id="3697719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3697722">for</span>&nbsp;<span class="ident" id="3697726">_</span><span class="op" id="3697727">,</span>&nbsp;<span class="ident" id="3697729">ident</span>&nbsp;<span class="op" id="3697735">:=</span>&nbsp;<span class="keyword" id="3697738">range</span>&nbsp;<span class="ident" id="3697744">idents</span>&nbsp;<span class="op" id="3697751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697755">assert</span><span class="op" id="3697761">(</span><span class="ident" id="3697762">ident</span><span class="op" id="3697767">.</span><span class="ident" id="3697768">Obj</span>&nbsp;<span class="op" id="3697772">==</span>&nbsp;<span class="builtintype" id="3697775">nil</span><span class="op" id="3697778">,</span>&nbsp;<span class="string" id="3697780">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="3697821">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697825">obj</span>&nbsp;<span class="op" id="3697829">:=</span>&nbsp;<span class="ident" id="3697832">ast</span><span class="op" id="3697835">.</span><span class="ident" id="3697836">NewObj</span><span class="op" id="3697842">(</span><span class="ident" id="3697843">kind</span><span class="op" id="3697847">,</span>&nbsp;<span class="ident" id="3697849">ident</span><span class="op" id="3697854">.</span><span class="ident" id="3697855">Name</span><span class="op" id="3697859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3697863">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3697925">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697987">obj</span><span class="op" id="3697990">.</span><span class="ident" id="3697991">Decl</span>&nbsp;<span class="op" id="3697996">=</span>&nbsp;<span class="ident" id="3697998">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698005">obj</span><span class="op" id="3698008">.</span><span class="ident" id="3698009">Data</span>&nbsp;<span class="op" id="3698014">=</span>&nbsp;<span class="ident" id="3698016">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698023">ident</span><span class="op" id="3698028">.</span><span class="ident" id="3698029">Obj</span>&nbsp;<span class="op" id="3698033">=</span>&nbsp;<span class="ident" id="3698035">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698041">if</span>&nbsp;<span class="ident" id="3698044">ident</span><span class="op" id="3698049">.</span><span class="ident" id="3698050">Name</span>&nbsp;<span class="op" id="3698055">!=</span>&nbsp;<span class="string" id="3698058">&#34;_&#34;</span>&nbsp;<span class="op" id="3698062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698067">if</span>&nbsp;<span class="ident" id="3698070">alt</span>&nbsp;<span class="op" id="3698074">:=</span>&nbsp;<span class="ident" id="3698077">scope</span><span class="op" id="3698082">.</span><span class="ident" id="3698083">Insert</span><span class="op" id="3698089">(</span><span class="ident" id="3698090">obj</span><span class="op" id="3698093">)</span><span class="op" id="3698094">;</span>&nbsp;<span class="ident" id="3698096">alt</span>&nbsp;<span class="op" id="3698100">!=</span>&nbsp;<span class="builtintype" id="3698103">nil</span>&nbsp;<span class="op" id="3698107">&amp;&amp;</span>&nbsp;<span class="ident" id="3698110">p</span><span class="op" id="3698111">.</span><span class="ident" id="3698112">mode</span><span class="op" id="3698116">&amp;</span><span class="ident" id="3698117">DeclarationErrors</span>&nbsp;<span class="op" id="3698135">!=</span>&nbsp;<span class="num" id="3698138">0</span>&nbsp;<span class="op" id="3698140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698146">prevDecl</span>&nbsp;<span class="op" id="3698155">:=</span>&nbsp;<span class="string" id="3698158">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698165">if</span>&nbsp;<span class="ident" id="3698168">pos</span>&nbsp;<span class="op" id="3698172">:=</span>&nbsp;<span class="ident" id="3698175">alt</span><span class="op" id="3698178">.</span><span class="ident" id="3698179">Pos</span><span class="op" id="3698182">(</span><span class="op" id="3698183">)</span><span class="op" id="3698184">;</span>&nbsp;<span class="ident" id="3698186">pos</span><span class="op" id="3698189">.</span><span class="ident" id="3698190">IsValid</span><span class="op" id="3698197">(</span><span class="op" id="3698198">)</span>&nbsp;<span class="op" id="3698200">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698207">prevDecl</span>&nbsp;<span class="op" id="3698216">=</span>&nbsp;<span class="ident" id="3698218">fmt</span><span class="op" id="3698221">.</span><span class="ident" id="3698222">Sprintf</span><span class="op" id="3698229">(</span><span class="string" id="3698230">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="3698262">,</span>&nbsp;<span class="ident" id="3698264">p</span><span class="op" id="3698265">.</span><span class="ident" id="3698266">file</span><span class="op" id="3698270">.</span><span class="ident" id="3698271">Position</span><span class="op" id="3698279">(</span><span class="ident" id="3698280">pos</span><span class="op" id="3698283">)</span><span class="op" id="3698284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3698290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698296">p</span><span class="op" id="3698297">.</span><span class="builtintype" id="3698298">error</span><span class="op" id="3698303">(</span><span class="ident" id="3698304">ident</span><span class="op" id="3698309">.</span><span class="ident" id="3698310">Pos</span><span class="op" id="3698313">(</span><span class="op" id="3698314">)</span><span class="op" id="3698315">,</span>&nbsp;<span class="ident" id="3698317">fmt</span><span class="op" id="3698320">.</span><span class="ident" id="3698321">Sprintf</span><span class="op" id="3698328">(</span><span class="string" id="3698329">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="3698360">,</span>&nbsp;<span class="ident" id="3698362">ident</span><span class="op" id="3698367">.</span><span class="ident" id="3698368">Name</span><span class="op" id="3698372">,</span>&nbsp;<span class="ident" id="3698374">prevDecl</span><span class="op" id="3698382">)</span><span class="op" id="3698383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3698388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3698392">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3698395">}</span><br>
<span class="lineno"></span><span class="op" id="3698397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3698400">func</span>&nbsp;<span class="op" id="3698405">(</span><span class="ident" id="3698406">p</span>&nbsp;<span class="op" id="3698408">*</span><span class="ident" id="3698409">parser</span><span class="op" id="3698415">)</span>&nbsp;<span class="ident" id="3698417">shortVarDecl</span><span class="op" id="3698429">(</span><span class="ident" id="3698430">decl</span>&nbsp;<span class="op" id="3698435">*</span><span class="ident" id="3698436">ast</span><span class="op" id="3698439">.</span><span class="ident" id="3698440">AssignStmt</span><span class="op" id="3698450">,</span>&nbsp;<span class="ident" id="3698452">list</span>&nbsp;<span class="op" id="3698457">[</span><span class="op" id="3698458">]</span><span class="ident" id="3698459">ast</span><span class="op" id="3698462">.</span><span class="ident" id="3698463">Expr</span><span class="op" id="3698467">)</span>&nbsp;<span class="op" id="3698469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3698472">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3698538">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3698604">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698675">n</span>&nbsp;<span class="op" id="3698677">:=</span>&nbsp;<span class="num" id="3698680">0</span>&nbsp;<span class="comment" id="3698682">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698710">for</span>&nbsp;<span class="ident" id="3698714">_</span><span class="op" id="3698715">,</span>&nbsp;<span class="ident" id="3698717">x</span>&nbsp;<span class="op" id="3698719">:=</span>&nbsp;<span class="keyword" id="3698722">range</span>&nbsp;<span class="ident" id="3698728">list</span>&nbsp;<span class="op" id="3698733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698737">if</span>&nbsp;<span class="ident" id="3698740">ident</span><span class="op" id="3698745">,</span>&nbsp;<span class="ident" id="3698747">isIdent</span>&nbsp;<span class="op" id="3698755">:=</span>&nbsp;<span class="ident" id="3698758">x</span><span class="op" id="3698759">.</span><span class="op" id="3698760">(</span><span class="op" id="3698761">*</span><span class="ident" id="3698762">ast</span><span class="op" id="3698765">.</span><span class="ident" id="3698766">Ident</span><span class="op" id="3698771">)</span><span class="op" id="3698772">;</span>&nbsp;<span class="ident" id="3698774">isIdent</span>&nbsp;<span class="op" id="3698782">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698787">assert</span><span class="op" id="3698793">(</span><span class="ident" id="3698794">ident</span><span class="op" id="3698799">.</span><span class="ident" id="3698800">Obj</span>&nbsp;<span class="op" id="3698804">==</span>&nbsp;<span class="builtintype" id="3698807">nil</span><span class="op" id="3698810">,</span>&nbsp;<span class="string" id="3698812">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="3698853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698858">obj</span>&nbsp;<span class="op" id="3698862">:=</span>&nbsp;<span class="ident" id="3698865">ast</span><span class="op" id="3698868">.</span><span class="ident" id="3698869">NewObj</span><span class="op" id="3698875">(</span><span class="ident" id="3698876">ast</span><span class="op" id="3698879">.</span><span class="ident" id="3698880">Var</span><span class="op" id="3698883">,</span>&nbsp;<span class="ident" id="3698885">ident</span><span class="op" id="3698890">.</span><span class="ident" id="3698891">Name</span><span class="op" id="3698895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3698900">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698956">obj</span><span class="op" id="3698959">.</span><span class="ident" id="3698960">Decl</span>&nbsp;<span class="op" id="3698965">=</span>&nbsp;<span class="ident" id="3698967">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698975">ident</span><span class="op" id="3698980">.</span><span class="ident" id="3698981">Obj</span>&nbsp;<span class="op" id="3698985">=</span>&nbsp;<span class="ident" id="3698987">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698994">if</span>&nbsp;<span class="ident" id="3698997">ident</span><span class="op" id="3699002">.</span><span class="ident" id="3699003">Name</span>&nbsp;<span class="op" id="3699008">!=</span>&nbsp;<span class="string" id="3699011">&#34;_&#34;</span>&nbsp;<span class="op" id="3699015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699021">if</span>&nbsp;<span class="ident" id="3699024">alt</span>&nbsp;<span class="op" id="3699028">:=</span>&nbsp;<span class="ident" id="3699031">p</span><span class="op" id="3699032">.</span><span class="ident" id="3699033">topScope</span><span class="op" id="3699041">.</span><span class="ident" id="3699042">Insert</span><span class="op" id="3699048">(</span><span class="ident" id="3699049">obj</span><span class="op" id="3699052">)</span><span class="op" id="3699053">;</span>&nbsp;<span class="ident" id="3699055">alt</span>&nbsp;<span class="op" id="3699059">!=</span>&nbsp;<span class="builtintype" id="3699062">nil</span>&nbsp;<span class="op" id="3699066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699073">ident</span><span class="op" id="3699078">.</span><span class="ident" id="3699079">Obj</span>&nbsp;<span class="op" id="3699083">=</span>&nbsp;<span class="ident" id="3699085">alt</span>&nbsp;<span class="comment" id="3699089">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699110">}</span>&nbsp;<span class="keyword" id="3699112">else</span>&nbsp;<span class="op" id="3699117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699124">n</span><span class="op" id="3699125">++</span>&nbsp;<span class="comment" id="3699128">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699160">}</span>&nbsp;<span class="keyword" id="3699162">else</span>&nbsp;<span class="op" id="3699167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699172">p</span><span class="op" id="3699173">.</span><span class="ident" id="3699174">errorExpected</span><span class="op" id="3699187">(</span><span class="ident" id="3699188">x</span><span class="op" id="3699189">.</span><span class="ident" id="3699190">Pos</span><span class="op" id="3699193">(</span><span class="op" id="3699194">)</span><span class="op" id="3699195">,</span>&nbsp;<span class="string" id="3699197">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="3699228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699232">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699238">if</span>&nbsp;<span class="ident" id="3699241">n</span>&nbsp;<span class="op" id="3699243">==</span>&nbsp;<span class="num" id="3699246">0</span>&nbsp;<span class="op" id="3699248">&amp;&amp;</span>&nbsp;<span class="ident" id="3699251">p</span><span class="op" id="3699252">.</span><span class="ident" id="3699253">mode</span><span class="op" id="3699257">&amp;</span><span class="ident" id="3699258">DeclarationErrors</span>&nbsp;<span class="op" id="3699276">!=</span>&nbsp;<span class="num" id="3699279">0</span>&nbsp;<span class="op" id="3699281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699285">p</span><span class="op" id="3699286">.</span><span class="builtintype" id="3699287">error</span><span class="op" id="3699292">(</span><span class="ident" id="3699293">list</span><span class="op" id="3699297">[</span><span class="num" id="3699298">0</span><span class="op" id="3699299">]</span><span class="op" id="3699300">.</span><span class="ident" id="3699301">Pos</span><span class="op" id="3699304">(</span><span class="op" id="3699305">)</span><span class="op" id="3699306">,</span>&nbsp;<span class="string" id="3699308">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="3699345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699348">}</span><br>
<span class="lineno"></span><span class="op" id="3699350">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3699353">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3699433">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="3699515">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="3699540">var</span>&nbsp;<span class="ident" id="3699544">unresolved</span>&nbsp;<span class="op" id="3699555">=</span>&nbsp;<span class="builtinfunc" id="3699557">new</span><span class="op" id="3699560">(</span><span class="ident" id="3699561">ast</span><span class="op" id="3699564">.</span><span class="ident" id="3699565">Object</span><span class="op" id="3699571">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="3699574">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3699647">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3699720">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="3699794">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="3699810">//</span><br>
<span class="lineno"></span><span class="keyword" id="3699813">func</span>&nbsp;<span class="op" id="3699818">(</span><span class="ident" id="3699819">p</span>&nbsp;<span class="op" id="3699821">*</span><span class="ident" id="3699822">parser</span><span class="op" id="3699828">)</span>&nbsp;<span class="ident" id="3699830">tryResolve</span><span class="op" id="3699840">(</span><span class="ident" id="3699841">x</span>&nbsp;<span class="ident" id="3699843">ast</span><span class="op" id="3699846">.</span><span class="ident" id="3699847">Expr</span><span class="op" id="3699851">,</span>&nbsp;<span class="ident" id="3699853">collectUnresolved</span>&nbsp;<span class="builtintype" id="3699871">bool</span><span class="op" id="3699875">)</span>&nbsp;<span class="op" id="3699877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3699880">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699948">ident</span><span class="op" id="3699953">,</span>&nbsp;<span class="ident" id="3699955">_</span>&nbsp;<span class="op" id="3699957">:=</span>&nbsp;<span class="ident" id="3699960">x</span><span class="op" id="3699961">.</span><span class="op" id="3699962">(</span><span class="op" id="3699963">*</span><span class="ident" id="3699964">ast</span><span class="op" id="3699967">.</span><span class="ident" id="3699968">Ident</span><span class="op" id="3699973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699976">if</span>&nbsp;<span class="ident" id="3699979">ident</span>&nbsp;<span class="op" id="3699985">==</span>&nbsp;<span class="builtintype" id="3699988">nil</span>&nbsp;<span class="op" id="3699992">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699996">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700007">assert</span><span class="op" id="3700013">(</span><span class="ident" id="3700014">ident</span><span class="op" id="3700019">.</span><span class="ident" id="3700020">Obj</span>&nbsp;<span class="op" id="3700024">==</span>&nbsp;<span class="builtintype" id="3700027">nil</span><span class="op" id="3700030">,</span>&nbsp;<span class="string" id="3700032">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="3700073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700076">if</span>&nbsp;<span class="ident" id="3700079">ident</span><span class="op" id="3700084">.</span><span class="ident" id="3700085">Name</span>&nbsp;<span class="op" id="3700090">==</span>&nbsp;<span class="string" id="3700093">&#34;_&#34;</span>&nbsp;<span class="op" id="3700097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700101">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3700112">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700146">for</span>&nbsp;<span class="ident" id="3700150">s</span>&nbsp;<span class="op" id="3700152">:=</span>&nbsp;<span class="ident" id="3700155">p</span><span class="op" id="3700156">.</span><span class="ident" id="3700157">topScope</span><span class="op" id="3700165">;</span>&nbsp;<span class="ident" id="3700167">s</span>&nbsp;<span class="op" id="3700169">!=</span>&nbsp;<span class="builtintype" id="3700172">nil</span><span class="op" id="3700175">;</span>&nbsp;<span class="ident" id="3700177">s</span>&nbsp;<span class="op" id="3700179">=</span>&nbsp;<span class="ident" id="3700181">s</span><span class="op" id="3700182">.</span><span class="ident" id="3700183">Outer</span>&nbsp;<span class="op" id="3700189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700193">if</span>&nbsp;<span class="ident" id="3700196">obj</span>&nbsp;<span class="op" id="3700200">:=</span>&nbsp;<span class="ident" id="3700203">s</span><span class="op" id="3700204">.</span><span class="ident" id="3700205">Lookup</span><span class="op" id="3700211">(</span><span class="ident" id="3700212">ident</span><span class="op" id="3700217">.</span><span class="ident" id="3700218">Name</span><span class="op" id="3700222">)</span><span class="op" id="3700223">;</span>&nbsp;<span class="ident" id="3700225">obj</span>&nbsp;<span class="op" id="3700229">!=</span>&nbsp;<span class="builtintype" id="3700232">nil</span>&nbsp;<span class="op" id="3700236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700241">ident</span><span class="op" id="3700246">.</span><span class="ident" id="3700247">Obj</span>&nbsp;<span class="op" id="3700251">=</span>&nbsp;<span class="ident" id="3700253">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700260">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3700275">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3700336">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3700394">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3700455">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700499">if</span>&nbsp;<span class="ident" id="3700502">collectUnresolved</span>&nbsp;<span class="op" id="3700520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700524">ident</span><span class="op" id="3700529">.</span><span class="ident" id="3700530">Obj</span>&nbsp;<span class="op" id="3700534">=</span>&nbsp;<span class="ident" id="3700536">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700549">p</span><span class="op" id="3700550">.</span><span class="ident" id="3700551">unresolved</span>&nbsp;<span class="op" id="3700562">=</span>&nbsp;<span class="builtinfunc" id="3700564">append</span><span class="op" id="3700570">(</span><span class="ident" id="3700571">p</span><span class="op" id="3700572">.</span><span class="ident" id="3700573">unresolved</span><span class="op" id="3700583">,</span>&nbsp;<span class="ident" id="3700585">ident</span><span class="op" id="3700590">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700593">}</span><br>
<span class="lineno"></span><span class="op" id="3700595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3700598">func</span>&nbsp;<span class="op" id="3700603">(</span><span class="ident" id="3700604">p</span>&nbsp;<span class="op" id="3700606">*</span><span class="ident" id="3700607">parser</span><span class="op" id="3700613">)</span>&nbsp;<span class="ident" id="3700615">resolve</span><span class="op" id="3700622">(</span><span class="ident" id="3700623">x</span>&nbsp;<span class="ident" id="3700625">ast</span><span class="op" id="3700628">.</span><span class="ident" id="3700629">Expr</span><span class="op" id="3700633">)</span>&nbsp;<span class="op" id="3700635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700638">p</span><span class="op" id="3700639">.</span><span class="ident" id="3700640">tryResolve</span><span class="op" id="3700650">(</span><span class="ident" id="3700651">x</span><span class="op" id="3700652">,</span>&nbsp;<span class="builtintype" id="3700654">true</span><span class="op" id="3700658">)</span><br>
<span class="lineno">200</span><span class="op" id="3700660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3700663">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3700743">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="3700763">func</span>&nbsp;<span class="op" id="3700768">(</span><span class="ident" id="3700769">p</span>&nbsp;<span class="op" id="3700771">*</span><span class="ident" id="3700772">parser</span><span class="op" id="3700778">)</span>&nbsp;<span class="ident" id="3700780">printTrace</span><span class="op" id="3700790">(</span><span class="ident" id="3700791">a</span>&nbsp;<span class="op" id="3700793">...</span><span class="keyword" id="3700796">interface</span><span class="op" id="3700805">{</span><span class="op" id="3700806">}</span><span class="op" id="3700807">)</span>&nbsp;<span class="op" id="3700809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700812">const</span>&nbsp;<span class="ident" id="3700818">dots</span>&nbsp;<span class="op" id="3700823">=</span>&nbsp;<span class="string" id="3700825">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700893">const</span>&nbsp;<span class="ident" id="3700899">n</span>&nbsp;<span class="op" id="3700901">=</span>&nbsp;<span class="builtinfunc" id="3700903">len</span><span class="op" id="3700906">(</span><span class="ident" id="3700907">dots</span><span class="op" id="3700911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700914">pos</span>&nbsp;<span class="op" id="3700918">:=</span>&nbsp;<span class="ident" id="3700921">p</span><span class="op" id="3700922">.</span><span class="ident" id="3700923">file</span><span class="op" id="3700927">.</span><span class="ident" id="3700928">Position</span><span class="op" id="3700936">(</span><span class="ident" id="3700937">p</span><span class="op" id="3700938">.</span><span class="ident" id="3700939">pos</span><span class="op" id="3700942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700945">fmt</span><span class="op" id="3700948">.</span><span class="ident" id="3700949">Printf</span><span class="op" id="3700955">(</span><span class="string" id="3700956">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="3700967">,</span>&nbsp;<span class="ident" id="3700969">pos</span><span class="op" id="3700972">.</span><span class="ident" id="3700973">Line</span><span class="op" id="3700977">,</span>&nbsp;<span class="ident" id="3700979">pos</span><span class="op" id="3700982">.</span><span class="ident" id="3700983">Column</span><span class="op" id="3700989">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700992">i</span>&nbsp;<span class="op" id="3700994">:=</span>&nbsp;<span class="num" id="3700997">2</span>&nbsp;<span class="op" id="3700999">*</span>&nbsp;<span class="ident" id="3701001">p</span><span class="op" id="3701002">.</span><span class="ident" id="3701003">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701011">for</span>&nbsp;<span class="ident" id="3701015">i</span>&nbsp;<span class="op" id="3701017">&gt;</span>&nbsp;<span class="ident" id="3701019">n</span>&nbsp;<span class="op" id="3701021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701025">fmt</span><span class="op" id="3701028">.</span><span class="ident" id="3701029">Print</span><span class="op" id="3701034">(</span><span class="ident" id="3701035">dots</span><span class="op" id="3701039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701043">i</span>&nbsp;<span class="op" id="3701045">-=</span>&nbsp;<span class="ident" id="3701048">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701051">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3701054">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701065">fmt</span><span class="op" id="3701068">.</span><span class="ident" id="3701069">Print</span><span class="op" id="3701074">(</span><span class="ident" id="3701075">dots</span><span class="op" id="3701079">[</span><span class="num" id="3701080">0</span><span class="op" id="3701081">:</span><span class="ident" id="3701082">i</span><span class="op" id="3701083">]</span><span class="op" id="3701084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701087">fmt</span><span class="op" id="3701090">.</span><span class="ident" id="3701091">Println</span><span class="op" id="3701098">(</span><span class="ident" id="3701099">a</span><span class="op" id="3701100">...</span><span class="op" id="3701103">)</span><br>
<span class="lineno"></span><span class="op" id="3701105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="3701108">func</span>&nbsp;<span class="ident" id="3701113">trace</span><span class="op" id="3701118">(</span><span class="ident" id="3701119">p</span>&nbsp;<span class="op" id="3701121">*</span><span class="ident" id="3701122">parser</span><span class="op" id="3701128">,</span>&nbsp;<span class="ident" id="3701130">msg</span>&nbsp;<span class="builtintype" id="3701134">string</span><span class="op" id="3701140">)</span>&nbsp;<span class="op" id="3701142">*</span><span class="ident" id="3701143">parser</span>&nbsp;<span class="op" id="3701150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701153">p</span><span class="op" id="3701154">.</span><span class="ident" id="3701155">printTrace</span><span class="op" id="3701165">(</span><span class="ident" id="3701166">msg</span><span class="op" id="3701169">,</span>&nbsp;<span class="string" id="3701171">&#34;(&#34;</span><span class="op" id="3701174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701177">p</span><span class="op" id="3701178">.</span><span class="ident" id="3701179">indent</span><span class="op" id="3701185">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701189">return</span>&nbsp;<span class="ident" id="3701196">p</span><br>
<span class="lineno"></span><span class="op" id="3701198">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3701201">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="3701245">func</span>&nbsp;<span class="ident" id="3701250">un</span><span class="op" id="3701252">(</span><span class="ident" id="3701253">p</span>&nbsp;<span class="op" id="3701255">*</span><span class="ident" id="3701256">parser</span><span class="op" id="3701262">)</span>&nbsp;<span class="op" id="3701264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701267">p</span><span class="op" id="3701268">.</span><span class="ident" id="3701269">indent</span><span class="op" id="3701275">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701279">p</span><span class="op" id="3701280">.</span><span class="ident" id="3701281">printTrace</span><span class="op" id="3701291">(</span><span class="string" id="3701292">&#34;)&#34;</span><span class="op" id="3701295">)</span><br>
<span class="lineno">230</span><span class="op" id="3701297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701300">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3701330">func</span>&nbsp;<span class="op" id="3701335">(</span><span class="ident" id="3701336">p</span>&nbsp;<span class="op" id="3701338">*</span><span class="ident" id="3701339">parser</span><span class="op" id="3701345">)</span>&nbsp;<span class="ident" id="3701347">next0</span><span class="op" id="3701352">(</span><span class="op" id="3701353">)</span>&nbsp;<span class="op" id="3701355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3701358">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3701420">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3701480">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3701539">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701586">if</span>&nbsp;<span class="ident" id="3701589">p</span><span class="op" id="3701590">.</span><span class="ident" id="3701591">trace</span>&nbsp;<span class="op" id="3701597">&amp;&amp;</span>&nbsp;<span class="ident" id="3701600">p</span><span class="op" id="3701601">.</span><span class="ident" id="3701602">pos</span><span class="op" id="3701605">.</span><span class="ident" id="3701606">IsValid</span><span class="op" id="3701613">(</span><span class="op" id="3701614">)</span>&nbsp;<span class="op" id="3701616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701620">s</span>&nbsp;<span class="op" id="3701622">:=</span>&nbsp;<span class="ident" id="3701625">p</span><span class="op" id="3701626">.</span><span class="ident" id="3701627">tok</span><span class="op" id="3701630">.</span><span class="ident" id="3701631">String</span><span class="op" id="3701637">(</span><span class="op" id="3701638">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701642">switch</span>&nbsp;<span class="op" id="3701649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701653">case</span>&nbsp;<span class="ident" id="3701658">p</span><span class="op" id="3701659">.</span><span class="ident" id="3701660">tok</span><span class="op" id="3701663">.</span><span class="ident" id="3701664">IsLiteral</span><span class="op" id="3701673">(</span><span class="op" id="3701674">)</span><span class="op" id="3701675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701680">p</span><span class="op" id="3701681">.</span><span class="ident" id="3701682">printTrace</span><span class="op" id="3701692">(</span><span class="ident" id="3701693">s</span><span class="op" id="3701694">,</span>&nbsp;<span class="ident" id="3701696">p</span><span class="op" id="3701697">.</span><span class="ident" id="3701698">lit</span><span class="op" id="3701701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701705">case</span>&nbsp;<span class="ident" id="3701710">p</span><span class="op" id="3701711">.</span><span class="ident" id="3701712">tok</span><span class="op" id="3701715">.</span><span class="ident" id="3701716">IsOperator</span><span class="op" id="3701726">(</span><span class="op" id="3701727">)</span><span class="op" id="3701728">,</span>&nbsp;<span class="ident" id="3701730">p</span><span class="op" id="3701731">.</span><span class="ident" id="3701732">tok</span><span class="op" id="3701735">.</span><span class="ident" id="3701736">IsKeyword</span><span class="op" id="3701745">(</span><span class="op" id="3701746">)</span><span class="op" id="3701747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701752">p</span><span class="op" id="3701753">.</span><span class="ident" id="3701754">printTrace</span><span class="op" id="3701764">(</span><span class="string" id="3701765">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="3701770">+</span>&nbsp;<span class="ident" id="3701772">s</span>&nbsp;<span class="op" id="3701774">+</span>&nbsp;<span class="string" id="3701776">&#34;\&#34;&#34;</span><span class="op" id="3701780">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701784">default</span><span class="op" id="3701791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701796">p</span><span class="op" id="3701797">.</span><span class="ident" id="3701798">printTrace</span><span class="op" id="3701808">(</span><span class="ident" id="3701809">s</span><span class="op" id="3701810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701821">p</span><span class="op" id="3701822">.</span><span class="ident" id="3701823">pos</span><span class="op" id="3701826">,</span>&nbsp;<span class="ident" id="3701828">p</span><span class="op" id="3701829">.</span><span class="ident" id="3701830">tok</span><span class="op" id="3701833">,</span>&nbsp;<span class="ident" id="3701835">p</span><span class="op" id="3701836">.</span><span class="ident" id="3701837">lit</span>&nbsp;<span class="op" id="3701841">=</span>&nbsp;<span class="ident" id="3701843">p</span><span class="op" id="3701844">.</span><span class="ident" id="3701845">scanner</span><span class="op" id="3701852">.</span><span class="ident" id="3701853">Scan</span><span class="op" id="3701857">(</span><span class="op" id="3701858">)</span><br>
<span class="lineno"></span><span class="op" id="3701860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701863">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="3701929">func</span>&nbsp;<span class="op" id="3701934">(</span><span class="ident" id="3701935">p</span>&nbsp;<span class="op" id="3701937">*</span><span class="ident" id="3701938">parser</span><span class="op" id="3701944">)</span>&nbsp;<span class="ident" id="3701946">consumeComment</span><span class="op" id="3701960">(</span><span class="op" id="3701961">)</span>&nbsp;<span class="op" id="3701963">(</span><span class="ident" id="3701964">comment</span>&nbsp;<span class="op" id="3701972">*</span><span class="ident" id="3701973">ast</span><span class="op" id="3701976">.</span><span class="ident" id="3701977">Comment</span><span class="op" id="3701984">,</span>&nbsp;<span class="ident" id="3701986">endline</span>&nbsp;<span class="builtintype" id="3701994">int</span><span class="op" id="3701997">)</span>&nbsp;<span class="op" id="3701999">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3702002">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3702075">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702143">endline</span>&nbsp;<span class="op" id="3702151">=</span>&nbsp;<span class="ident" id="3702153">p</span><span class="op" id="3702154">.</span><span class="ident" id="3702155">file</span><span class="op" id="3702159">.</span><span class="ident" id="3702160">Line</span><span class="op" id="3702164">(</span><span class="ident" id="3702165">p</span><span class="op" id="3702166">.</span><span class="ident" id="3702167">pos</span><span class="op" id="3702170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702173">if</span>&nbsp;<span class="ident" id="3702176">p</span><span class="op" id="3702177">.</span><span class="ident" id="3702178">lit</span><span class="op" id="3702181">[</span><span class="num" id="3702182">1</span><span class="op" id="3702183">]</span>&nbsp;<span class="op" id="3702185">==</span>&nbsp;<span class="string" id="3702188">&#39;*&#39;</span>&nbsp;<span class="op" id="3702192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3702196">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702262">for</span>&nbsp;<span class="ident" id="3702266">i</span>&nbsp;<span class="op" id="3702268">:=</span>&nbsp;<span class="num" id="3702271">0</span><span class="op" id="3702272">;</span>&nbsp;<span class="ident" id="3702274">i</span>&nbsp;<span class="op" id="3702276">&lt;</span>&nbsp;<span class="builtinfunc" id="3702278">len</span><span class="op" id="3702281">(</span><span class="ident" id="3702282">p</span><span class="op" id="3702283">.</span><span class="ident" id="3702284">lit</span><span class="op" id="3702287">)</span><span class="op" id="3702288">;</span>&nbsp;<span class="ident" id="3702290">i</span><span class="op" id="3702291">++</span>&nbsp;<span class="op" id="3702294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702299">if</span>&nbsp;<span class="ident" id="3702302">p</span><span class="op" id="3702303">.</span><span class="ident" id="3702304">lit</span><span class="op" id="3702307">[</span><span class="ident" id="3702308">i</span><span class="op" id="3702309">]</span>&nbsp;<span class="op" id="3702311">==</span>&nbsp;<span class="string" id="3702314">&#39;\n&#39;</span>&nbsp;<span class="op" id="3702319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702325">endline</span><span class="op" id="3702332">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702342">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702349">comment</span>&nbsp;<span class="op" id="3702357">=</span>&nbsp;<span class="op" id="3702359">&amp;</span><span class="ident" id="3702360">ast</span><span class="op" id="3702363">.</span><span class="ident" id="3702364">Comment</span><span class="op" id="3702371">{</span><span class="ident" id="3702372">Slash</span><span class="op" id="3702377">:</span>&nbsp;<span class="ident" id="3702379">p</span><span class="op" id="3702380">.</span><span class="ident" id="3702381">pos</span><span class="op" id="3702384">,</span>&nbsp;<span class="ident" id="3702386">Text</span><span class="op" id="3702390">:</span>&nbsp;<span class="ident" id="3702392">p</span><span class="op" id="3702393">.</span><span class="ident" id="3702394">lit</span><span class="op" id="3702397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702400">p</span><span class="op" id="3702401">.</span><span class="ident" id="3702402">next0</span><span class="op" id="3702407">(</span><span class="op" id="3702408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702412">return</span><br>
<span class="lineno"></span><span class="op" id="3702419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3702422">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3702486">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="3702550">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3702614">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="3702656">//</span><br>
<span class="lineno"></span><span class="keyword" id="3702659">func</span>&nbsp;<span class="op" id="3702664">(</span><span class="ident" id="3702665">p</span>&nbsp;<span class="op" id="3702667">*</span><span class="ident" id="3702668">parser</span><span class="op" id="3702674">)</span>&nbsp;<span class="ident" id="3702676">consumeCommentGroup</span><span class="op" id="3702695">(</span><span class="ident" id="3702696">n</span>&nbsp;<span class="builtintype" id="3702698">int</span><span class="op" id="3702701">)</span>&nbsp;<span class="op" id="3702703">(</span><span class="ident" id="3702704">comments</span>&nbsp;<span class="op" id="3702713">*</span><span class="ident" id="3702714">ast</span><span class="op" id="3702717">.</span><span class="ident" id="3702718">CommentGroup</span><span class="op" id="3702730">,</span>&nbsp;<span class="ident" id="3702732">endline</span>&nbsp;<span class="builtintype" id="3702740">int</span><span class="op" id="3702743">)</span>&nbsp;<span class="op" id="3702745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702748">var</span>&nbsp;<span class="ident" id="3702752">list</span>&nbsp;<span class="op" id="3702757">[</span><span class="op" id="3702758">]</span><span class="op" id="3702759">*</span><span class="ident" id="3702760">ast</span><span class="op" id="3702763">.</span><span class="ident" id="3702764">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702773">endline</span>&nbsp;<span class="op" id="3702781">=</span>&nbsp;<span class="ident" id="3702783">p</span><span class="op" id="3702784">.</span><span class="ident" id="3702785">file</span><span class="op" id="3702789">.</span><span class="ident" id="3702790">Line</span><span class="op" id="3702794">(</span><span class="ident" id="3702795">p</span><span class="op" id="3702796">.</span><span class="ident" id="3702797">pos</span><span class="op" id="3702800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702803">for</span>&nbsp;<span class="ident" id="3702807">p</span><span class="op" id="3702808">.</span><span class="ident" id="3702809">tok</span>&nbsp;<span class="op" id="3702813">==</span>&nbsp;<span class="ident" id="3702816">token</span><span class="op" id="3702821">.</span><span class="ident" id="3702822">COMMENT</span>&nbsp;<span class="op" id="3702830">&amp;&amp;</span>&nbsp;<span class="ident" id="3702833">p</span><span class="op" id="3702834">.</span><span class="ident" id="3702835">file</span><span class="op" id="3702839">.</span><span class="ident" id="3702840">Line</span><span class="op" id="3702844">(</span><span class="ident" id="3702845">p</span><span class="op" id="3702846">.</span><span class="ident" id="3702847">pos</span><span class="op" id="3702850">)</span>&nbsp;<span class="op" id="3702852">&lt;=</span>&nbsp;<span class="ident" id="3702855">endline</span><span class="op" id="3702862">+</span><span class="ident" id="3702863">n</span>&nbsp;<span class="op" id="3702865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702869">var</span>&nbsp;<span class="ident" id="3702873">comment</span>&nbsp;<span class="op" id="3702881">*</span><span class="ident" id="3702882">ast</span><span class="op" id="3702885">.</span><span class="ident" id="3702886">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702896">comment</span><span class="op" id="3702903">,</span>&nbsp;<span class="ident" id="3702905">endline</span>&nbsp;<span class="op" id="3702913">=</span>&nbsp;<span class="ident" id="3702915">p</span><span class="op" id="3702916">.</span><span class="ident" id="3702917">consumeComment</span><span class="op" id="3702931">(</span><span class="op" id="3702932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702936">list</span>&nbsp;<span class="op" id="3702941">=</span>&nbsp;<span class="builtinfunc" id="3702943">append</span><span class="op" id="3702949">(</span><span class="ident" id="3702950">list</span><span class="op" id="3702954">,</span>&nbsp;<span class="ident" id="3702956">comment</span><span class="op" id="3702963">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3702970">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703013">comments</span>&nbsp;<span class="op" id="3703022">=</span>&nbsp;<span class="op" id="3703024">&amp;</span><span class="ident" id="3703025">ast</span><span class="op" id="3703028">.</span><span class="ident" id="3703029">CommentGroup</span><span class="op" id="3703041">{</span><span class="ident" id="3703042">List</span><span class="op" id="3703046">:</span>&nbsp;<span class="ident" id="3703048">list</span><span class="op" id="3703052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703055">p</span><span class="op" id="3703056">.</span><span class="ident" id="3703057">comments</span>&nbsp;<span class="op" id="3703066">=</span>&nbsp;<span class="builtinfunc" id="3703068">append</span><span class="op" id="3703074">(</span><span class="ident" id="3703075">p</span><span class="op" id="3703076">.</span><span class="ident" id="3703077">comments</span><span class="op" id="3703085">,</span>&nbsp;<span class="ident" id="3703087">comments</span><span class="op" id="3703095">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703099">return</span><br>
<span class="lineno"></span><span class="op" id="3703106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3703109">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="3703175">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3703241">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="3703263">//</span><br>
<span class="lineno"></span><span class="comment" id="3703266">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3703329">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="3703400">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="3703458">//</span><br>
<span class="lineno"></span><span class="comment" id="3703461">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="3703525">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3703596">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="3703614">//</span><br>
<span class="lineno"></span><span class="comment" id="3703617">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3703683">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="3703705">//</span><br>
<span class="lineno"></span><span class="keyword" id="3703708">func</span>&nbsp;<span class="op" id="3703713">(</span><span class="ident" id="3703714">p</span>&nbsp;<span class="op" id="3703716">*</span><span class="ident" id="3703717">parser</span><span class="op" id="3703723">)</span>&nbsp;<span class="ident" id="3703725">next</span><span class="op" id="3703729">(</span><span class="op" id="3703730">)</span>&nbsp;<span class="op" id="3703732">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703735">p</span><span class="op" id="3703736">.</span><span class="ident" id="3703737">leadComment</span>&nbsp;<span class="op" id="3703749">=</span>&nbsp;<span class="builtintype" id="3703751">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703756">p</span><span class="op" id="3703757">.</span><span class="ident" id="3703758">lineComment</span>&nbsp;<span class="op" id="3703770">=</span>&nbsp;<span class="builtintype" id="3703772">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703777">prev</span>&nbsp;<span class="op" id="3703782">:=</span>&nbsp;<span class="ident" id="3703785">p</span><span class="op" id="3703786">.</span><span class="ident" id="3703787">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703792">p</span><span class="op" id="3703793">.</span><span class="ident" id="3703794">next0</span><span class="op" id="3703799">(</span><span class="op" id="3703800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703804">if</span>&nbsp;<span class="ident" id="3703807">p</span><span class="op" id="3703808">.</span><span class="ident" id="3703809">tok</span>&nbsp;<span class="op" id="3703813">==</span>&nbsp;<span class="ident" id="3703816">token</span><span class="op" id="3703821">.</span><span class="ident" id="3703822">COMMENT</span>&nbsp;<span class="op" id="3703830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703834">var</span>&nbsp;<span class="ident" id="3703838">comment</span>&nbsp;<span class="op" id="3703846">*</span><span class="ident" id="3703847">ast</span><span class="op" id="3703850">.</span><span class="ident" id="3703851">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703866">var</span>&nbsp;<span class="ident" id="3703870">endline</span>&nbsp;<span class="builtintype" id="3703878">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703885">if</span>&nbsp;<span class="ident" id="3703888">p</span><span class="op" id="3703889">.</span><span class="ident" id="3703890">file</span><span class="op" id="3703894">.</span><span class="ident" id="3703895">Line</span><span class="op" id="3703899">(</span><span class="ident" id="3703900">p</span><span class="op" id="3703901">.</span><span class="ident" id="3703902">pos</span><span class="op" id="3703905">)</span>&nbsp;<span class="op" id="3703907">==</span>&nbsp;<span class="ident" id="3703910">p</span><span class="op" id="3703911">.</span><span class="ident" id="3703912">file</span><span class="op" id="3703916">.</span><span class="ident" id="3703917">Line</span><span class="op" id="3703921">(</span><span class="ident" id="3703922">prev</span><span class="op" id="3703926">)</span>&nbsp;<span class="op" id="3703928">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3703933">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3703993">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704051">comment</span><span class="op" id="3704058">,</span>&nbsp;<span class="ident" id="3704060">endline</span>&nbsp;<span class="op" id="3704068">=</span>&nbsp;<span class="ident" id="3704070">p</span><span class="op" id="3704071">.</span><span class="ident" id="3704072">consumeCommentGroup</span><span class="op" id="3704091">(</span><span class="num" id="3704092">0</span><span class="op" id="3704093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3704098">if</span>&nbsp;<span class="ident" id="3704101">p</span><span class="op" id="3704102">.</span><span class="ident" id="3704103">file</span><span class="op" id="3704107">.</span><span class="ident" id="3704108">Line</span><span class="op" id="3704112">(</span><span class="ident" id="3704113">p</span><span class="op" id="3704114">.</span><span class="ident" id="3704115">pos</span><span class="op" id="3704118">)</span>&nbsp;<span class="op" id="3704120">!=</span>&nbsp;<span class="ident" id="3704123">endline</span>&nbsp;<span class="op" id="3704131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704137">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704188">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704237">p</span><span class="op" id="3704238">.</span><span class="ident" id="3704239">lineComment</span>&nbsp;<span class="op" id="3704251">=</span>&nbsp;<span class="ident" id="3704253">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704273">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704313">endline</span>&nbsp;<span class="op" id="3704321">=</span>&nbsp;<span class="op" id="3704323">-</span><span class="num" id="3704324">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3704328">for</span>&nbsp;<span class="ident" id="3704332">p</span><span class="op" id="3704333">.</span><span class="ident" id="3704334">tok</span>&nbsp;<span class="op" id="3704338">==</span>&nbsp;<span class="ident" id="3704341">token</span><span class="op" id="3704346">.</span><span class="ident" id="3704347">COMMENT</span>&nbsp;<span class="op" id="3704355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704360">comment</span><span class="op" id="3704367">,</span>&nbsp;<span class="ident" id="3704369">endline</span>&nbsp;<span class="op" id="3704377">=</span>&nbsp;<span class="ident" id="3704379">p</span><span class="op" id="3704380">.</span><span class="ident" id="3704381">consumeCommentGroup</span><span class="op" id="3704400">(</span><span class="num" id="3704401">1</span><span class="op" id="3704402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704406">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3704411">if</span>&nbsp;<span class="ident" id="3704414">endline</span><span class="op" id="3704421">+</span><span class="num" id="3704422">1</span>&nbsp;<span class="op" id="3704424">==</span>&nbsp;<span class="ident" id="3704427">p</span><span class="op" id="3704428">.</span><span class="ident" id="3704429">file</span><span class="op" id="3704433">.</span><span class="ident" id="3704434">Line</span><span class="op" id="3704438">(</span><span class="ident" id="3704439">p</span><span class="op" id="3704440">.</span><span class="ident" id="3704441">pos</span><span class="op" id="3704444">)</span>&nbsp;<span class="op" id="3704446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704451">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704519">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704587">p</span><span class="op" id="3704588">.</span><span class="ident" id="3704589">leadComment</span>&nbsp;<span class="op" id="3704601">=</span>&nbsp;<span class="ident" id="3704603">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704616">}</span><br>
<span class="lineno"></span><span class="op" id="3704618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3704621">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="3704681">type</span>&nbsp;<span class="ident" id="3704686">bailout</span>&nbsp;<span class="keyword" id="3704694">struct</span><span class="op" id="3704700">{</span><span class="op" id="3704701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3704704">func</span>&nbsp;<span class="op" id="3704709">(</span><span class="ident" id="3704710">p</span>&nbsp;<span class="op" id="3704712">*</span><span class="ident" id="3704713">parser</span><span class="op" id="3704719">)</span>&nbsp;<span class="builtintype" id="3704721">error</span><span class="op" id="3704726">(</span><span class="ident" id="3704727">pos</span>&nbsp;<span class="ident" id="3704731">token</span><span class="op" id="3704736">.</span><span class="ident" id="3704737">Pos</span><span class="op" id="3704740">,</span>&nbsp;<span class="ident" id="3704742">msg</span>&nbsp;<span class="builtintype" id="3704746">string</span><span class="op" id="3704752">)</span>&nbsp;<span class="op" id="3704754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704757">epos</span>&nbsp;<span class="op" id="3704762">:=</span>&nbsp;<span class="ident" id="3704765">p</span><span class="op" id="3704766">.</span><span class="ident" id="3704767">file</span><span class="op" id="3704771">.</span><span class="ident" id="3704772">Position</span><span class="op" id="3704780">(</span><span class="ident" id="3704781">pos</span><span class="op" id="3704784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704788">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704858">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704929">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3704944">if</span>&nbsp;<span class="ident" id="3704947">p</span><span class="op" id="3704948">.</span><span class="ident" id="3704949">mode</span><span class="op" id="3704953">&amp;</span><span class="ident" id="3704954">AllErrors</span>&nbsp;<span class="op" id="3704964">==</span>&nbsp;<span class="num" id="3704967">0</span>&nbsp;<span class="op" id="3704969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704973">n</span>&nbsp;<span class="op" id="3704975">:=</span>&nbsp;<span class="builtinfunc" id="3704978">len</span><span class="op" id="3704981">(</span><span class="ident" id="3704982">p</span><span class="op" id="3704983">.</span><span class="ident" id="3704984">errors</span><span class="op" id="3704990">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3704994">if</span>&nbsp;<span class="ident" id="3704997">n</span>&nbsp;<span class="op" id="3704999">&gt;</span>&nbsp;<span class="num" id="3705001">0</span>&nbsp;<span class="op" id="3705003">&amp;&amp;</span>&nbsp;<span class="ident" id="3705006">p</span><span class="op" id="3705007">.</span><span class="ident" id="3705008">errors</span><span class="op" id="3705014">[</span><span class="ident" id="3705015">n</span><span class="op" id="3705016">-</span><span class="num" id="3705017">1</span><span class="op" id="3705018">]</span><span class="op" id="3705019">.</span><span class="ident" id="3705020">Pos</span><span class="op" id="3705023">.</span><span class="ident" id="3705024">Line</span>&nbsp;<span class="op" id="3705029">==</span>&nbsp;<span class="ident" id="3705032">epos</span><span class="op" id="3705036">.</span><span class="ident" id="3705037">Line</span>&nbsp;<span class="op" id="3705042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705047">return</span>&nbsp;<span class="comment" id="3705054">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705097">if</span>&nbsp;<span class="ident" id="3705100">n</span>&nbsp;<span class="op" id="3705102">&gt;</span>&nbsp;<span class="num" id="3705104">10</span>&nbsp;<span class="op" id="3705107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3705112">panic</span><span class="op" id="3705117">(</span><span class="ident" id="3705118">bailout</span><span class="op" id="3705125">{</span><span class="op" id="3705126">}</span><span class="op" id="3705127">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705138">p</span><span class="op" id="3705139">.</span><span class="ident" id="3705140">errors</span><span class="op" id="3705146">.</span><span class="ident" id="3705147">Add</span><span class="op" id="3705150">(</span><span class="ident" id="3705151">epos</span><span class="op" id="3705155">,</span>&nbsp;<span class="ident" id="3705157">msg</span><span class="op" id="3705160">)</span><br>
<span class="lineno"></span><span class="op" id="3705162">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3705165">func</span>&nbsp;<span class="op" id="3705170">(</span><span class="ident" id="3705171">p</span>&nbsp;<span class="op" id="3705173">*</span><span class="ident" id="3705174">parser</span><span class="op" id="3705180">)</span>&nbsp;<span class="ident" id="3705182">errorExpected</span><span class="op" id="3705195">(</span><span class="ident" id="3705196">pos</span>&nbsp;<span class="ident" id="3705200">token</span><span class="op" id="3705205">.</span><span class="ident" id="3705206">Pos</span><span class="op" id="3705209">,</span>&nbsp;<span class="ident" id="3705211">msg</span>&nbsp;<span class="builtintype" id="3705215">string</span><span class="op" id="3705221">)</span>&nbsp;<span class="op" id="3705223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705226">msg</span>&nbsp;<span class="op" id="3705230">=</span>&nbsp;<span class="string" id="3705232">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="3705244">+</span>&nbsp;<span class="ident" id="3705246">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705251">if</span>&nbsp;<span class="ident" id="3705254">pos</span>&nbsp;<span class="op" id="3705258">==</span>&nbsp;<span class="ident" id="3705261">p</span><span class="op" id="3705262">.</span><span class="ident" id="3705263">pos</span>&nbsp;<span class="op" id="3705267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3705271">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3705320">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705362">if</span>&nbsp;<span class="ident" id="3705365">p</span><span class="op" id="3705366">.</span><span class="ident" id="3705367">tok</span>&nbsp;<span class="op" id="3705371">==</span>&nbsp;<span class="ident" id="3705374">token</span><span class="op" id="3705379">.</span><span class="ident" id="3705380">SEMICOLON</span>&nbsp;<span class="op" id="3705390">&amp;&amp;</span>&nbsp;<span class="ident" id="3705393">p</span><span class="op" id="3705394">.</span><span class="ident" id="3705395">lit</span>&nbsp;<span class="op" id="3705399">==</span>&nbsp;<span class="string" id="3705402">&#34;\n&#34;</span>&nbsp;<span class="op" id="3705407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705412">msg</span>&nbsp;<span class="op" id="3705416">+=</span>&nbsp;<span class="string" id="3705419">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705439">}</span>&nbsp;<span class="keyword" id="3705441">else</span>&nbsp;<span class="op" id="3705446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705451">msg</span>&nbsp;<span class="op" id="3705455">+=</span>&nbsp;<span class="string" id="3705458">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="3705470">+</span>&nbsp;<span class="ident" id="3705472">p</span><span class="op" id="3705473">.</span><span class="ident" id="3705474">tok</span><span class="op" id="3705477">.</span><span class="ident" id="3705478">String</span><span class="op" id="3705484">(</span><span class="op" id="3705485">)</span>&nbsp;<span class="op" id="3705487">+</span>&nbsp;<span class="string" id="3705489">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705496">if</span>&nbsp;<span class="ident" id="3705499">p</span><span class="op" id="3705500">.</span><span class="ident" id="3705501">tok</span><span class="op" id="3705504">.</span><span class="ident" id="3705505">IsLiteral</span><span class="op" id="3705514">(</span><span class="op" id="3705515">)</span>&nbsp;<span class="op" id="3705517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705523">msg</span>&nbsp;<span class="op" id="3705527">+=</span>&nbsp;<span class="string" id="3705530">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3705534">+</span>&nbsp;<span class="ident" id="3705536">p</span><span class="op" id="3705537">.</span><span class="ident" id="3705538">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705552">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705555">p</span><span class="op" id="3705556">.</span><span class="builtintype" id="3705557">error</span><span class="op" id="3705562">(</span><span class="ident" id="3705563">pos</span><span class="op" id="3705566">,</span>&nbsp;<span class="ident" id="3705568">msg</span><span class="op" id="3705571">)</span><br>
<span class="lineno"></span><span class="op" id="3705573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3705576">func</span>&nbsp;<span class="op" id="3705581">(</span><span class="ident" id="3705582">p</span>&nbsp;<span class="op" id="3705584">*</span><span class="ident" id="3705585">parser</span><span class="op" id="3705591">)</span>&nbsp;<span class="ident" id="3705593">expect</span><span class="op" id="3705599">(</span><span class="ident" id="3705600">tok</span>&nbsp;<span class="ident" id="3705604">token</span><span class="op" id="3705609">.</span><span class="ident" id="3705610">Token</span><span class="op" id="3705615">)</span>&nbsp;<span class="ident" id="3705617">token</span><span class="op" id="3705622">.</span><span class="ident" id="3705623">Pos</span>&nbsp;<span class="op" id="3705627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705630">pos</span>&nbsp;<span class="op" id="3705634">:=</span>&nbsp;<span class="ident" id="3705637">p</span><span class="op" id="3705638">.</span><span class="ident" id="3705639">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705644">if</span>&nbsp;<span class="ident" id="3705647">p</span><span class="op" id="3705648">.</span><span class="ident" id="3705649">tok</span>&nbsp;<span class="op" id="3705653">!=</span>&nbsp;<span class="ident" id="3705656">tok</span>&nbsp;<span class="op" id="3705660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705664">p</span><span class="op" id="3705665">.</span><span class="ident" id="3705666">errorExpected</span><span class="op" id="3705679">(</span><span class="ident" id="3705680">pos</span><span class="op" id="3705683">,</span>&nbsp;<span class="string" id="3705685">&#34;&#39;&#34;</span><span class="op" id="3705688">+</span><span class="ident" id="3705689">tok</span><span class="op" id="3705692">.</span><span class="ident" id="3705693">String</span><span class="op" id="3705699">(</span><span class="op" id="3705700">)</span><span class="op" id="3705701">+</span><span class="string" id="3705702">&#34;&#39;&#34;</span><span class="op" id="3705705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3705708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3705711">p</span><span class="op" id="3705712">.</span><span class="ident" id="3705713">next</span><span class="op" id="3705717">(</span><span class="op" id="3705718">)</span>&nbsp;<span class="comment" id="3705720">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705738">return</span>&nbsp;<span class="ident" id="3705745">pos</span><br>
<span class="lineno">390</span><span class="op" id="3705749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3705752">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3705820">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="3705880">//</span><br>
<span class="lineno">395</span><span class="keyword" id="3705883">func</span>&nbsp;<span class="op" id="3705888">(</span><span class="ident" id="3705889">p</span>&nbsp;<span class="op" id="3705891">*</span><span class="ident" id="3705892">parser</span><span class="op" id="3705898">)</span>&nbsp;<span class="ident" id="3705900">expectClosing</span><span class="op" id="3705913">(</span><span class="ident" id="3705914">tok</span>&nbsp;<span class="ident" id="3705918">token</span><span class="op" id="3705923">.</span><span class="ident" id="3705924">Token</span><span class="op" id="3705929">,</span>&nbsp;<span class="ident" id="3705931">context</span>&nbsp;<span class="builtintype" id="3705939">string</span><span class="op" id="3705945">)</span>&nbsp;<span class="ident" id="3705947">token</span><span class="op" id="3705952">.</span><span class="ident" id="3705953">Pos</span>&nbsp;<span class="op" id="3705957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3705960">if</span>&nbsp;<span class="ident" id="3705963">p</span><span class="op" id="3705964">.</span><span class="ident" id="3705965">tok</span>&nbsp;<span class="op" id="3705969">!=</span>&nbsp;<span class="ident" id="3705972">tok</span>&nbsp;<span class="op" id="3705976">&amp;&amp;</span>&nbsp;<span class="ident" id="3705979">p</span><span class="op" id="3705980">.</span><span class="ident" id="3705981">tok</span>&nbsp;<span class="op" id="3705985">==</span>&nbsp;<span class="ident" id="3705988">token</span><span class="op" id="3705993">.</span><span class="ident" id="3705994">SEMICOLON</span>&nbsp;<span class="op" id="3706004">&amp;&amp;</span>&nbsp;<span class="ident" id="3706007">p</span><span class="op" id="3706008">.</span><span class="ident" id="3706009">lit</span>&nbsp;<span class="op" id="3706013">==</span>&nbsp;<span class="string" id="3706016">&#34;\n&#34;</span>&nbsp;<span class="op" id="3706021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706025">p</span><span class="op" id="3706026">.</span><span class="builtintype" id="3706027">error</span><span class="op" id="3706032">(</span><span class="ident" id="3706033">p</span><span class="op" id="3706034">.</span><span class="ident" id="3706035">pos</span><span class="op" id="3706038">,</span>&nbsp;<span class="string" id="3706040">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="3706072">+</span><span class="ident" id="3706073">context</span><span class="op" id="3706080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706084">p</span><span class="op" id="3706085">.</span><span class="ident" id="3706086">next</span><span class="op" id="3706090">(</span><span class="op" id="3706091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706094">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706097">return</span>&nbsp;<span class="ident" id="3706104">p</span><span class="op" id="3706105">.</span><span class="ident" id="3706106">expect</span><span class="op" id="3706112">(</span><span class="ident" id="3706113">tok</span><span class="op" id="3706116">)</span><br>
<span class="lineno"></span><span class="op" id="3706118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706121">func</span>&nbsp;<span class="op" id="3706126">(</span><span class="ident" id="3706127">p</span>&nbsp;<span class="op" id="3706129">*</span><span class="ident" id="3706130">parser</span><span class="op" id="3706136">)</span>&nbsp;<span class="ident" id="3706138">expectSemi</span><span class="op" id="3706148">(</span><span class="op" id="3706149">)</span>&nbsp;<span class="op" id="3706151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3706154">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706208">if</span>&nbsp;<span class="ident" id="3706211">p</span><span class="op" id="3706212">.</span><span class="ident" id="3706213">tok</span>&nbsp;<span class="op" id="3706217">!=</span>&nbsp;<span class="ident" id="3706220">token</span><span class="op" id="3706225">.</span><span class="ident" id="3706226">RPAREN</span>&nbsp;<span class="op" id="3706233">&amp;&amp;</span>&nbsp;<span class="ident" id="3706236">p</span><span class="op" id="3706237">.</span><span class="ident" id="3706238">tok</span>&nbsp;<span class="op" id="3706242">!=</span>&nbsp;<span class="ident" id="3706245">token</span><span class="op" id="3706250">.</span><span class="ident" id="3706251">RBRACE</span>&nbsp;<span class="op" id="3706258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706262">if</span>&nbsp;<span class="ident" id="3706265">p</span><span class="op" id="3706266">.</span><span class="ident" id="3706267">tok</span>&nbsp;<span class="op" id="3706271">==</span>&nbsp;<span class="ident" id="3706274">token</span><span class="op" id="3706279">.</span><span class="ident" id="3706280">SEMICOLON</span>&nbsp;<span class="op" id="3706290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706295">p</span><span class="op" id="3706296">.</span><span class="ident" id="3706297">next</span><span class="op" id="3706301">(</span><span class="op" id="3706302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706306">}</span>&nbsp;<span class="keyword" id="3706308">else</span>&nbsp;<span class="op" id="3706313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706318">p</span><span class="op" id="3706319">.</span><span class="ident" id="3706320">errorExpected</span><span class="op" id="3706333">(</span><span class="ident" id="3706334">p</span><span class="op" id="3706335">.</span><span class="ident" id="3706336">pos</span><span class="op" id="3706339">,</span>&nbsp;<span class="string" id="3706341">&#34;&#39;;&#39;&#34;</span><span class="op" id="3706346">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706351">syncStmt</span><span class="op" id="3706359">(</span><span class="ident" id="3706360">p</span><span class="op" id="3706361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706368">}</span><br>
<span class="lineno"></span><span class="op" id="3706370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="3706373">func</span>&nbsp;<span class="op" id="3706378">(</span><span class="ident" id="3706379">p</span>&nbsp;<span class="op" id="3706381">*</span><span class="ident" id="3706382">parser</span><span class="op" id="3706388">)</span>&nbsp;<span class="ident" id="3706390">atComma</span><span class="op" id="3706397">(</span><span class="ident" id="3706398">context</span>&nbsp;<span class="builtintype" id="3706406">string</span><span class="op" id="3706412">)</span>&nbsp;<span class="builtintype" id="3706414">bool</span>&nbsp;<span class="op" id="3706419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706422">if</span>&nbsp;<span class="ident" id="3706425">p</span><span class="op" id="3706426">.</span><span class="ident" id="3706427">tok</span>&nbsp;<span class="op" id="3706431">==</span>&nbsp;<span class="ident" id="3706434">token</span><span class="op" id="3706439">.</span><span class="ident" id="3706440">COMMA</span>&nbsp;<span class="op" id="3706446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706450">return</span>&nbsp;<span class="builtintype" id="3706457">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706466">if</span>&nbsp;<span class="ident" id="3706469">p</span><span class="op" id="3706470">.</span><span class="ident" id="3706471">tok</span>&nbsp;<span class="op" id="3706475">==</span>&nbsp;<span class="ident" id="3706478">token</span><span class="op" id="3706483">.</span><span class="ident" id="3706484">SEMICOLON</span>&nbsp;<span class="op" id="3706494">&amp;&amp;</span>&nbsp;<span class="ident" id="3706497">p</span><span class="op" id="3706498">.</span><span class="ident" id="3706499">lit</span>&nbsp;<span class="op" id="3706503">==</span>&nbsp;<span class="string" id="3706506">&#34;\n&#34;</span>&nbsp;<span class="op" id="3706511">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706515">p</span><span class="op" id="3706516">.</span><span class="builtintype" id="3706517">error</span><span class="op" id="3706522">(</span><span class="ident" id="3706523">p</span><span class="op" id="3706524">.</span><span class="ident" id="3706525">pos</span><span class="op" id="3706528">,</span>&nbsp;<span class="string" id="3706530">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="3706562">+</span><span class="ident" id="3706563">context</span><span class="op" id="3706570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706574">return</span>&nbsp;<span class="builtintype" id="3706581">true</span>&nbsp;<span class="comment" id="3706586">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706626">return</span>&nbsp;<span class="builtintype" id="3706633">false</span><br>
<span class="lineno">425</span><span class="op" id="3706639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706642">func</span>&nbsp;<span class="ident" id="3706647">assert</span><span class="op" id="3706653">(</span><span class="ident" id="3706654">cond</span>&nbsp;<span class="builtintype" id="3706659">bool</span><span class="op" id="3706663">,</span>&nbsp;<span class="ident" id="3706665">msg</span>&nbsp;<span class="builtintype" id="3706669">string</span><span class="op" id="3706675">)</span>&nbsp;<span class="op" id="3706677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706680">if</span>&nbsp;<span class="op" id="3706683">!</span><span class="ident" id="3706684">cond</span>&nbsp;<span class="op" id="3706689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3706693">panic</span><span class="op" id="3706698">(</span><span class="string" id="3706699">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="3706728">+</span>&nbsp;<span class="ident" id="3706730">msg</span><span class="op" id="3706733">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3706736">}</span><br>
<span class="lineno"></span><span class="op" id="3706738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3706741">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="3706785">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="3706829">//</span><br>
<span class="lineno"></span><span class="keyword" id="3706832">func</span>&nbsp;<span class="ident" id="3706837">syncStmt</span><span class="op" id="3706845">(</span><span class="ident" id="3706846">p</span>&nbsp;<span class="op" id="3706848">*</span><span class="ident" id="3706849">parser</span><span class="op" id="3706855">)</span>&nbsp;<span class="op" id="3706857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706860">for</span>&nbsp;<span class="op" id="3706864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706868">switch</span>&nbsp;<span class="ident" id="3706875">p</span><span class="op" id="3706876">.</span><span class="ident" id="3706877">tok</span>&nbsp;<span class="op" id="3706881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3706885">case</span>&nbsp;<span class="ident" id="3706890">token</span><span class="op" id="3706895">.</span><span class="ident" id="3706896">BREAK</span><span class="op" id="3706901">,</span>&nbsp;<span class="ident" id="3706903">token</span><span class="op" id="3706908">.</span><span class="ident" id="3706909">CONST</span><span class="op" id="3706914">,</span>&nbsp;<span class="ident" id="3706916">token</span><span class="op" id="3706921">.</span><span class="ident" id="3706922">CONTINUE</span><span class="op" id="3706930">,</span>&nbsp;<span class="ident" id="3706932">token</span><span class="op" id="3706937">.</span><span class="ident" id="3706938">DEFER</span><span class="op" id="3706943">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3706948">token</span><span class="op" id="3706953">.</span><span class="ident" id="3706954">FALLTHROUGH</span><span class="op" id="3706965">,</span>&nbsp;<span class="ident" id="3706967">token</span><span class="op" id="3706972">.</span><span class="ident" id="3706973">FOR</span><span class="op" id="3706976">,</span>&nbsp;<span class="ident" id="3706978">token</span><span class="op" id="3706983">.</span><span class="ident" id="3706984">GO</span><span class="op" id="3706986">,</span>&nbsp;<span class="ident" id="3706988">token</span><span class="op" id="3706993">.</span><span class="ident" id="3706994">GOTO</span><span class="op" id="3706998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707003">token</span><span class="op" id="3707008">.</span><span class="ident" id="3707009">IF</span><span class="op" id="3707011">,</span>&nbsp;<span class="ident" id="3707013">token</span><span class="op" id="3707018">.</span><span class="ident" id="3707019">RETURN</span><span class="op" id="3707025">,</span>&nbsp;<span class="ident" id="3707027">token</span><span class="op" id="3707032">.</span><span class="ident" id="3707033">SELECT</span><span class="op" id="3707039">,</span>&nbsp;<span class="ident" id="3707041">token</span><span class="op" id="3707046">.</span><span class="ident" id="3707047">SWITCH</span><span class="op" id="3707053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707058">token</span><span class="op" id="3707063">.</span><span class="ident" id="3707064">TYPE</span><span class="op" id="3707068">,</span>&nbsp;<span class="ident" id="3707070">token</span><span class="op" id="3707075">.</span><span class="ident" id="3707076">VAR</span><span class="op" id="3707079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707084">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707142">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707200">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707256">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707312">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707368">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707422">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3707457">if</span>&nbsp;<span class="ident" id="3707460">p</span><span class="op" id="3707461">.</span><span class="ident" id="3707462">pos</span>&nbsp;<span class="op" id="3707466">==</span>&nbsp;<span class="ident" id="3707469">p</span><span class="op" id="3707470">.</span><span class="ident" id="3707471">syncPos</span>&nbsp;<span class="op" id="3707479">&amp;&amp;</span>&nbsp;<span class="ident" id="3707482">p</span><span class="op" id="3707483">.</span><span class="ident" id="3707484">syncCnt</span>&nbsp;<span class="op" id="3707492">&lt;</span>&nbsp;<span class="num" id="3707494">10</span>&nbsp;<span class="op" id="3707497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707503">p</span><span class="op" id="3707504">.</span><span class="ident" id="3707505">syncCnt</span><span class="op" id="3707512">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3707519">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3707529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3707534">if</span>&nbsp;<span class="ident" id="3707537">p</span><span class="op" id="3707538">.</span><span class="ident" id="3707539">pos</span>&nbsp;<span class="op" id="3707543">&gt;</span>&nbsp;<span class="ident" id="3707545">p</span><span class="op" id="3707546">.</span><span class="ident" id="3707547">syncPos</span>&nbsp;<span class="op" id="3707555">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707561">p</span><span class="op" id="3707562">.</span><span class="ident" id="3707563">syncPos</span>&nbsp;<span class="op" id="3707571">=</span>&nbsp;<span class="ident" id="3707573">p</span><span class="op" id="3707574">.</span><span class="ident" id="3707575">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707583">p</span><span class="op" id="3707584">.</span><span class="ident" id="3707585">syncCnt</span>&nbsp;<span class="op" id="3707593">=</span>&nbsp;<span class="num" id="3707595">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3707601">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3707611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707616">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707670">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707727">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707781">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707836">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3707871">case</span>&nbsp;<span class="ident" id="3707876">token</span><span class="op" id="3707881">.</span><span class="ident" id="3707882">EOF</span><span class="op" id="3707885">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3707890">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3707899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707903">p</span><span class="op" id="3707904">.</span><span class="ident" id="3707905">next</span><span class="op" id="3707909">(</span><span class="op" id="3707910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3707913">}</span><br>
<span class="lineno"></span><span class="op" id="3707915">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3707918">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="3707964">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3708008">//</span><br>
<span class="lineno"></span><span class="keyword" id="3708011">func</span>&nbsp;<span class="ident" id="3708016">syncDecl</span><span class="op" id="3708024">(</span><span class="ident" id="3708025">p</span>&nbsp;<span class="op" id="3708027">*</span><span class="ident" id="3708028">parser</span><span class="op" id="3708034">)</span>&nbsp;<span class="op" id="3708036">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708039">for</span>&nbsp;<span class="op" id="3708043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708047">switch</span>&nbsp;<span class="ident" id="3708054">p</span><span class="op" id="3708055">.</span><span class="ident" id="3708056">tok</span>&nbsp;<span class="op" id="3708060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708064">case</span>&nbsp;<span class="ident" id="3708069">token</span><span class="op" id="3708074">.</span><span class="ident" id="3708075">CONST</span><span class="op" id="3708080">,</span>&nbsp;<span class="ident" id="3708082">token</span><span class="op" id="3708087">.</span><span class="ident" id="3708088">TYPE</span><span class="op" id="3708092">,</span>&nbsp;<span class="ident" id="3708094">token</span><span class="op" id="3708099">.</span><span class="ident" id="3708100">VAR</span><span class="op" id="3708103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3708108">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708139">if</span>&nbsp;<span class="ident" id="3708142">p</span><span class="op" id="3708143">.</span><span class="ident" id="3708144">pos</span>&nbsp;<span class="op" id="3708148">==</span>&nbsp;<span class="ident" id="3708151">p</span><span class="op" id="3708152">.</span><span class="ident" id="3708153">syncPos</span>&nbsp;<span class="op" id="3708161">&amp;&amp;</span>&nbsp;<span class="ident" id="3708164">p</span><span class="op" id="3708165">.</span><span class="ident" id="3708166">syncCnt</span>&nbsp;<span class="op" id="3708174">&lt;</span>&nbsp;<span class="num" id="3708176">10</span>&nbsp;<span class="op" id="3708179">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3708185">p</span><span class="op" id="3708186">.</span><span class="ident" id="3708187">syncCnt</span><span class="op" id="3708194">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708201">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3708211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708216">if</span>&nbsp;<span class="ident" id="3708219">p</span><span class="op" id="3708220">.</span><span class="ident" id="3708221">pos</span>&nbsp;<span class="op" id="3708225">&gt;</span>&nbsp;<span class="ident" id="3708227">p</span><span class="op" id="3708228">.</span><span class="ident" id="3708229">syncPos</span>&nbsp;<span class="op" id="3708237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3708243">p</span><span class="op" id="3708244">.</span><span class="ident" id="3708245">syncPos</span>&nbsp;<span class="op" id="3708253">=</span>&nbsp;<span class="ident" id="3708255">p</span><span class="op" id="3708256">.</span><span class="ident" id="3708257">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3708265">p</span><span class="op" id="3708266">.</span><span class="ident" id="3708267">syncCnt</span>&nbsp;<span class="op" id="3708275">=</span>&nbsp;<span class="num" id="3708277">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708283">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3708293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708297">case</span>&nbsp;<span class="ident" id="3708302">token</span><span class="op" id="3708307">.</span><span class="ident" id="3708308">EOF</span><span class="op" id="3708311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708316">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3708325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3708329">p</span><span class="op" id="3708330">.</span><span class="ident" id="3708331">next</span><span class="op" id="3708335">(</span><span class="op" id="3708336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3708339">}</span><br>
<span class="lineno"></span><span class="op" id="3708341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="3708344">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="3708414">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="3708486">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="3708523">//</span><br>
<span class="lineno"></span><span class="comment" id="3708526">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="3708601">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3708675">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3708754">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3708829">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="3708842">//</span><br>
<span class="lineno">505</span><span class="keyword" id="3708845">func</span>&nbsp;<span class="op" id="3708850">(</span><span class="ident" id="3708851">p</span>&nbsp;<span class="op" id="3708853">*</span><span class="ident" id="3708854">parser</span><span class="op" id="3708860">)</span>&nbsp;<span class="ident" id="3708862">safePos</span><span class="op" id="3708869">(</span><span class="ident" id="3708870">pos</span>&nbsp;<span class="ident" id="3708874">token</span><span class="op" id="3708879">.</span><span class="ident" id="3708880">Pos</span><span class="op" id="3708883">)</span>&nbsp;<span class="op" id="3708885">(</span><span class="ident" id="3708886">res</span>&nbsp;<span class="ident" id="3708890">token</span><span class="op" id="3708895">.</span><span class="ident" id="3708896">Pos</span><span class="op" id="3708899">)</span>&nbsp;<span class="op" id="3708901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708904">defer</span>&nbsp;<span class="keyword" id="3708910">func</span><span class="op" id="3708914">(</span><span class="op" id="3708915">)</span>&nbsp;<span class="op" id="3708917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3708921">if</span>&nbsp;<span class="builtinfunc" id="3708924">recover</span><span class="op" id="3708931">(</span><span class="op" id="3708932">)</span>&nbsp;<span class="op" id="3708934">!=</span>&nbsp;<span class="builtintype" id="3708937">nil</span>&nbsp;<span class="op" id="3708941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3708946">res</span>&nbsp;<span class="op" id="3708950">=</span>&nbsp;<span class="ident" id="3708952">token</span><span class="op" id="3708957">.</span><span class="ident" id="3708958">Pos</span><span class="op" id="3708961">(</span><span class="ident" id="3708962">p</span><span class="op" id="3708963">.</span><span class="ident" id="3708964">file</span><span class="op" id="3708968">.</span><span class="ident" id="3708969">Base</span><span class="op" id="3708973">(</span><span class="op" id="3708974">)</span>&nbsp;<span class="op" id="3708976">+</span>&nbsp;<span class="ident" id="3708978">p</span><span class="op" id="3708979">.</span><span class="ident" id="3708980">file</span><span class="op" id="3708984">.</span><span class="ident" id="3708985">Size</span><span class="op" id="3708989">(</span><span class="op" id="3708990">)</span><span class="op" id="3708991">)</span>&nbsp;<span class="comment" id="3708993">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709011">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709014">}</span><span class="op" id="3709015">(</span><span class="op" id="3709016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709019">_</span>&nbsp;<span class="op" id="3709021">=</span>&nbsp;<span class="ident" id="3709023">p</span><span class="op" id="3709024">.</span><span class="ident" id="3709025">file</span><span class="op" id="3709029">.</span><span class="ident" id="3709030">Offset</span><span class="op" id="3709036">(</span><span class="ident" id="3709037">pos</span><span class="op" id="3709040">)</span>&nbsp;<span class="comment" id="3709042">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709090">return</span>&nbsp;<span class="ident" id="3709097">pos</span><br>
<span class="lineno"></span><span class="op" id="3709101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="3709104">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3709184">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3709200">func</span>&nbsp;<span class="op" id="3709205">(</span><span class="ident" id="3709206">p</span>&nbsp;<span class="op" id="3709208">*</span><span class="ident" id="3709209">parser</span><span class="op" id="3709215">)</span>&nbsp;<span class="ident" id="3709217">parseIdent</span><span class="op" id="3709227">(</span><span class="op" id="3709228">)</span>&nbsp;<span class="op" id="3709230">*</span><span class="ident" id="3709231">ast</span><span class="op" id="3709234">.</span><span class="ident" id="3709235">Ident</span>&nbsp;<span class="op" id="3709241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709244">pos</span>&nbsp;<span class="op" id="3709248">:=</span>&nbsp;<span class="ident" id="3709251">p</span><span class="op" id="3709252">.</span><span class="ident" id="3709253">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709258">name</span>&nbsp;<span class="op" id="3709263">:=</span>&nbsp;<span class="string" id="3709266">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709271">if</span>&nbsp;<span class="ident" id="3709274">p</span><span class="op" id="3709275">.</span><span class="ident" id="3709276">tok</span>&nbsp;<span class="op" id="3709280">==</span>&nbsp;<span class="ident" id="3709283">token</span><span class="op" id="3709288">.</span><span class="ident" id="3709289">IDENT</span>&nbsp;<span class="op" id="3709295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709299">name</span>&nbsp;<span class="op" id="3709304">=</span>&nbsp;<span class="ident" id="3709306">p</span><span class="op" id="3709307">.</span><span class="ident" id="3709308">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709314">p</span><span class="op" id="3709315">.</span><span class="ident" id="3709316">next</span><span class="op" id="3709320">(</span><span class="op" id="3709321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709324">}</span>&nbsp;<span class="keyword" id="3709326">else</span>&nbsp;<span class="op" id="3709331">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709335">p</span><span class="op" id="3709336">.</span><span class="ident" id="3709337">expect</span><span class="op" id="3709343">(</span><span class="ident" id="3709344">token</span><span class="op" id="3709349">.</span><span class="ident" id="3709350">IDENT</span><span class="op" id="3709355">)</span>&nbsp;<span class="comment" id="3709357">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709392">return</span>&nbsp;<span class="op" id="3709399">&amp;</span><span class="ident" id="3709400">ast</span><span class="op" id="3709403">.</span><span class="ident" id="3709404">Ident</span><span class="op" id="3709409">{</span><span class="ident" id="3709410">NamePos</span><span class="op" id="3709417">:</span>&nbsp;<span class="ident" id="3709419">pos</span><span class="op" id="3709422">,</span>&nbsp;<span class="ident" id="3709424">Name</span><span class="op" id="3709428">:</span>&nbsp;<span class="ident" id="3709430">name</span><span class="op" id="3709434">}</span><br>
<span class="lineno"></span><span class="op" id="3709436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="3709439">func</span>&nbsp;<span class="op" id="3709444">(</span><span class="ident" id="3709445">p</span>&nbsp;<span class="op" id="3709447">*</span><span class="ident" id="3709448">parser</span><span class="op" id="3709454">)</span>&nbsp;<span class="ident" id="3709456">parseIdentList</span><span class="op" id="3709470">(</span><span class="op" id="3709471">)</span>&nbsp;<span class="op" id="3709473">(</span><span class="ident" id="3709474">list</span>&nbsp;<span class="op" id="3709479">[</span><span class="op" id="3709480">]</span><span class="op" id="3709481">*</span><span class="ident" id="3709482">ast</span><span class="op" id="3709485">.</span><span class="ident" id="3709486">Ident</span><span class="op" id="3709491">)</span>&nbsp;<span class="op" id="3709493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709496">if</span>&nbsp;<span class="ident" id="3709499">p</span><span class="op" id="3709500">.</span><span class="ident" id="3709501">trace</span>&nbsp;<span class="op" id="3709507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709511">defer</span>&nbsp;<span class="ident" id="3709517">un</span><span class="op" id="3709519">(</span><span class="ident" id="3709520">trace</span><span class="op" id="3709525">(</span><span class="ident" id="3709526">p</span><span class="op" id="3709527">,</span>&nbsp;<span class="string" id="3709529">&#34;IdentList&#34;</span><span class="op" id="3709540">)</span><span class="op" id="3709541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709548">list</span>&nbsp;<span class="op" id="3709553">=</span>&nbsp;<span class="builtinfunc" id="3709555">append</span><span class="op" id="3709561">(</span><span class="ident" id="3709562">list</span><span class="op" id="3709566">,</span>&nbsp;<span class="ident" id="3709568">p</span><span class="op" id="3709569">.</span><span class="ident" id="3709570">parseIdent</span><span class="op" id="3709580">(</span><span class="op" id="3709581">)</span><span class="op" id="3709582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709585">for</span>&nbsp;<span class="ident" id="3709589">p</span><span class="op" id="3709590">.</span><span class="ident" id="3709591">tok</span>&nbsp;<span class="op" id="3709595">==</span>&nbsp;<span class="ident" id="3709598">token</span><span class="op" id="3709603">.</span><span class="ident" id="3709604">COMMA</span>&nbsp;<span class="op" id="3709610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709614">p</span><span class="op" id="3709615">.</span><span class="ident" id="3709616">next</span><span class="op" id="3709620">(</span><span class="op" id="3709621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709625">list</span>&nbsp;<span class="op" id="3709630">=</span>&nbsp;<span class="builtinfunc" id="3709632">append</span><span class="op" id="3709638">(</span><span class="ident" id="3709639">list</span><span class="op" id="3709643">,</span>&nbsp;<span class="ident" id="3709645">p</span><span class="op" id="3709646">.</span><span class="ident" id="3709647">parseIdent</span><span class="op" id="3709657">(</span><span class="op" id="3709658">)</span><span class="op" id="3709659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709662">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709666">return</span><br>
<span class="lineno"></span><span class="op" id="3709673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709676">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="3709756">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709779">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3709858">func</span>&nbsp;<span class="op" id="3709863">(</span><span class="ident" id="3709864">p</span>&nbsp;<span class="op" id="3709866">*</span><span class="ident" id="3709867">parser</span><span class="op" id="3709873">)</span>&nbsp;<span class="ident" id="3709875">parseExprList</span><span class="op" id="3709888">(</span><span class="ident" id="3709889">lhs</span>&nbsp;<span class="builtintype" id="3709893">bool</span><span class="op" id="3709897">)</span>&nbsp;<span class="op" id="3709899">(</span><span class="ident" id="3709900">list</span>&nbsp;<span class="op" id="3709905">[</span><span class="op" id="3709906">]</span><span class="ident" id="3709907">ast</span><span class="op" id="3709910">.</span><span class="ident" id="3709911">Expr</span><span class="op" id="3709915">)</span>&nbsp;<span class="op" id="3709917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709920">if</span>&nbsp;<span class="ident" id="3709923">p</span><span class="op" id="3709924">.</span><span class="ident" id="3709925">trace</span>&nbsp;<span class="op" id="3709931">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3709935">defer</span>&nbsp;<span class="ident" id="3709941">un</span><span class="op" id="3709943">(</span><span class="ident" id="3709944">trace</span><span class="op" id="3709949">(</span><span class="ident" id="3709950">p</span><span class="op" id="3709951">,</span>&nbsp;<span class="string" id="3709953">&#34;ExpressionList&#34;</span><span class="op" id="3709969">)</span><span class="op" id="3709970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3709973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3709977">list</span>&nbsp;<span class="op" id="3709982">=</span>&nbsp;<span class="builtinfunc" id="3709984">append</span><span class="op" id="3709990">(</span><span class="ident" id="3709991">list</span><span class="op" id="3709995">,</span>&nbsp;<span class="ident" id="3709997">p</span><span class="op" id="3709998">.</span><span class="ident" id="3709999">checkExpr</span><span class="op" id="3710008">(</span><span class="ident" id="3710009">p</span><span class="op" id="3710010">.</span><span class="ident" id="3710011">parseExpr</span><span class="op" id="3710020">(</span><span class="ident" id="3710021">lhs</span><span class="op" id="3710024">)</span><span class="op" id="3710025">)</span><span class="op" id="3710026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710029">for</span>&nbsp;<span class="ident" id="3710033">p</span><span class="op" id="3710034">.</span><span class="ident" id="3710035">tok</span>&nbsp;<span class="op" id="3710039">==</span>&nbsp;<span class="ident" id="3710042">token</span><span class="op" id="3710047">.</span><span class="ident" id="3710048">COMMA</span>&nbsp;<span class="op" id="3710054">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710058">p</span><span class="op" id="3710059">.</span><span class="ident" id="3710060">next</span><span class="op" id="3710064">(</span><span class="op" id="3710065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710069">list</span>&nbsp;<span class="op" id="3710074">=</span>&nbsp;<span class="builtinfunc" id="3710076">append</span><span class="op" id="3710082">(</span><span class="ident" id="3710083">list</span><span class="op" id="3710087">,</span>&nbsp;<span class="ident" id="3710089">p</span><span class="op" id="3710090">.</span><span class="ident" id="3710091">checkExpr</span><span class="op" id="3710100">(</span><span class="ident" id="3710101">p</span><span class="op" id="3710102">.</span><span class="ident" id="3710103">parseExpr</span><span class="op" id="3710112">(</span><span class="ident" id="3710113">lhs</span><span class="op" id="3710116">)</span><span class="op" id="3710117">)</span><span class="op" id="3710118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3710121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710125">return</span><br>
<span class="lineno">560</span><span class="op" id="3710132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3710135">func</span>&nbsp;<span class="op" id="3710140">(</span><span class="ident" id="3710141">p</span>&nbsp;<span class="op" id="3710143">*</span><span class="ident" id="3710144">parser</span><span class="op" id="3710150">)</span>&nbsp;<span class="ident" id="3710152">parseLhsList</span><span class="op" id="3710164">(</span><span class="op" id="3710165">)</span>&nbsp;<span class="op" id="3710167">[</span><span class="op" id="3710168">]</span><span class="ident" id="3710169">ast</span><span class="op" id="3710172">.</span><span class="ident" id="3710173">Expr</span>&nbsp;<span class="op" id="3710178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710181">old</span>&nbsp;<span class="op" id="3710185">:=</span>&nbsp;<span class="ident" id="3710188">p</span><span class="op" id="3710189">.</span><span class="ident" id="3710190">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710197">p</span><span class="op" id="3710198">.</span><span class="ident" id="3710199">inRhs</span>&nbsp;<span class="op" id="3710205">=</span>&nbsp;<span class="builtintype" id="3710207">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710214">list</span>&nbsp;<span class="op" id="3710219">:=</span>&nbsp;<span class="ident" id="3710222">p</span><span class="op" id="3710223">.</span><span class="ident" id="3710224">parseExprList</span><span class="op" id="3710237">(</span><span class="builtintype" id="3710238">true</span><span class="op" id="3710242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710245">switch</span>&nbsp;<span class="ident" id="3710252">p</span><span class="op" id="3710253">.</span><span class="ident" id="3710254">tok</span>&nbsp;<span class="op" id="3710258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710261">case</span>&nbsp;<span class="ident" id="3710266">token</span><span class="op" id="3710271">.</span><span class="ident" id="3710272">DEFINE</span><span class="op" id="3710278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710282">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710323">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710365">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710425">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710450">case</span>&nbsp;<span class="ident" id="3710455">token</span><span class="op" id="3710460">.</span><span class="ident" id="3710461">COLON</span><span class="op" id="3710466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710470">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710540">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710612">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710641">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710698">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710769">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710838">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710883">default</span><span class="op" id="3710890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3710894">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3710938">for</span>&nbsp;<span class="ident" id="3710942">_</span><span class="op" id="3710943">,</span>&nbsp;<span class="ident" id="3710945">x</span>&nbsp;<span class="op" id="3710947">:=</span>&nbsp;<span class="keyword" id="3710950">range</span>&nbsp;<span class="ident" id="3710956">list</span>&nbsp;<span class="op" id="3710961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710966">p</span><span class="op" id="3710967">.</span><span class="ident" id="3710968">resolve</span><span class="op" id="3710975">(</span><span class="ident" id="3710976">x</span><span class="op" id="3710977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3710981">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3710984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3710987">p</span><span class="op" id="3710988">.</span><span class="ident" id="3710989">inRhs</span>&nbsp;<span class="op" id="3710995">=</span>&nbsp;<span class="ident" id="3710997">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711002">return</span>&nbsp;<span class="ident" id="3711009">list</span><br>
<span class="lineno"></span><span class="op" id="3711014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="3711017">func</span>&nbsp;<span class="op" id="3711022">(</span><span class="ident" id="3711023">p</span>&nbsp;<span class="op" id="3711025">*</span><span class="ident" id="3711026">parser</span><span class="op" id="3711032">)</span>&nbsp;<span class="ident" id="3711034">parseRhsList</span><span class="op" id="3711046">(</span><span class="op" id="3711047">)</span>&nbsp;<span class="op" id="3711049">[</span><span class="op" id="3711050">]</span><span class="ident" id="3711051">ast</span><span class="op" id="3711054">.</span><span class="ident" id="3711055">Expr</span>&nbsp;<span class="op" id="3711060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711063">old</span>&nbsp;<span class="op" id="3711067">:=</span>&nbsp;<span class="ident" id="3711070">p</span><span class="op" id="3711071">.</span><span class="ident" id="3711072">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711079">p</span><span class="op" id="3711080">.</span><span class="ident" id="3711081">inRhs</span>&nbsp;<span class="op" id="3711087">=</span>&nbsp;<span class="builtintype" id="3711089">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711095">list</span>&nbsp;<span class="op" id="3711100">:=</span>&nbsp;<span class="ident" id="3711103">p</span><span class="op" id="3711104">.</span><span class="ident" id="3711105">parseExprList</span><span class="op" id="3711118">(</span><span class="builtintype" id="3711119">false</span><span class="op" id="3711124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711127">p</span><span class="op" id="3711128">.</span><span class="ident" id="3711129">inRhs</span>&nbsp;<span class="op" id="3711135">=</span>&nbsp;<span class="ident" id="3711137">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711142">return</span>&nbsp;<span class="ident" id="3711149">list</span><br>
<span class="lineno"></span><span class="op" id="3711154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711157">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3711237">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="3711247">func</span>&nbsp;<span class="op" id="3711252">(</span><span class="ident" id="3711253">p</span>&nbsp;<span class="op" id="3711255">*</span><span class="ident" id="3711256">parser</span><span class="op" id="3711262">)</span>&nbsp;<span class="ident" id="3711264">parseType</span><span class="op" id="3711273">(</span><span class="op" id="3711274">)</span>&nbsp;<span class="ident" id="3711276">ast</span><span class="op" id="3711279">.</span><span class="ident" id="3711280">Expr</span>&nbsp;<span class="op" id="3711285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711288">if</span>&nbsp;<span class="ident" id="3711291">p</span><span class="op" id="3711292">.</span><span class="ident" id="3711293">trace</span>&nbsp;<span class="op" id="3711299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711303">defer</span>&nbsp;<span class="ident" id="3711309">un</span><span class="op" id="3711311">(</span><span class="ident" id="3711312">trace</span><span class="op" id="3711317">(</span><span class="ident" id="3711318">p</span><span class="op" id="3711319">,</span>&nbsp;<span class="string" id="3711321">&#34;Type&#34;</span><span class="op" id="3711327">)</span><span class="op" id="3711328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711331">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711335">typ</span>&nbsp;<span class="op" id="3711339">:=</span>&nbsp;<span class="ident" id="3711342">p</span><span class="op" id="3711343">.</span><span class="ident" id="3711344">tryType</span><span class="op" id="3711351">(</span><span class="op" id="3711352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711356">if</span>&nbsp;<span class="ident" id="3711359">typ</span>&nbsp;<span class="op" id="3711363">==</span>&nbsp;<span class="builtintype" id="3711366">nil</span>&nbsp;<span class="op" id="3711370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711374">pos</span>&nbsp;<span class="op" id="3711378">:=</span>&nbsp;<span class="ident" id="3711381">p</span><span class="op" id="3711382">.</span><span class="ident" id="3711383">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711389">p</span><span class="op" id="3711390">.</span><span class="ident" id="3711391">errorExpected</span><span class="op" id="3711404">(</span><span class="ident" id="3711405">pos</span><span class="op" id="3711408">,</span>&nbsp;<span class="string" id="3711410">&#34;type&#34;</span><span class="op" id="3711416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711420">p</span><span class="op" id="3711421">.</span><span class="ident" id="3711422">next</span><span class="op" id="3711426">(</span><span class="op" id="3711427">)</span>&nbsp;<span class="comment" id="3711429">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711448">return</span>&nbsp;<span class="op" id="3711455">&amp;</span><span class="ident" id="3711456">ast</span><span class="op" id="3711459">.</span><span class="ident" id="3711460">BadExpr</span><span class="op" id="3711467">{</span><span class="ident" id="3711468">From</span><span class="op" id="3711472">:</span>&nbsp;<span class="ident" id="3711474">pos</span><span class="op" id="3711477">,</span>&nbsp;<span class="ident" id="3711479">To</span><span class="op" id="3711481">:</span>&nbsp;<span class="ident" id="3711483">p</span><span class="op" id="3711484">.</span><span class="ident" id="3711485">pos</span><span class="op" id="3711488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711495">return</span>&nbsp;<span class="ident" id="3711502">typ</span><br>
<span class="lineno"></span><span class="op" id="3711506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711509">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3711564">func</span>&nbsp;<span class="op" id="3711569">(</span><span class="ident" id="3711570">p</span>&nbsp;<span class="op" id="3711572">*</span><span class="ident" id="3711573">parser</span><span class="op" id="3711579">)</span>&nbsp;<span class="ident" id="3711581">parseTypeName</span><span class="op" id="3711594">(</span><span class="op" id="3711595">)</span>&nbsp;<span class="ident" id="3711597">ast</span><span class="op" id="3711600">.</span><span class="ident" id="3711601">Expr</span>&nbsp;<span class="op" id="3711606">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711609">if</span>&nbsp;<span class="ident" id="3711612">p</span><span class="op" id="3711613">.</span><span class="ident" id="3711614">trace</span>&nbsp;<span class="op" id="3711620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711624">defer</span>&nbsp;<span class="ident" id="3711630">un</span><span class="op" id="3711632">(</span><span class="ident" id="3711633">trace</span><span class="op" id="3711638">(</span><span class="ident" id="3711639">p</span><span class="op" id="3711640">,</span>&nbsp;<span class="string" id="3711642">&#34;TypeName&#34;</span><span class="op" id="3711652">)</span><span class="op" id="3711653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711660">ident</span>&nbsp;<span class="op" id="3711666">:=</span>&nbsp;<span class="ident" id="3711669">p</span><span class="op" id="3711670">.</span><span class="ident" id="3711671">parseIdent</span><span class="op" id="3711681">(</span><span class="op" id="3711682">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3711685">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711752">if</span>&nbsp;<span class="ident" id="3711755">p</span><span class="op" id="3711756">.</span><span class="ident" id="3711757">tok</span>&nbsp;<span class="op" id="3711761">==</span>&nbsp;<span class="ident" id="3711764">token</span><span class="op" id="3711769">.</span><span class="ident" id="3711770">PERIOD</span>&nbsp;<span class="op" id="3711777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3711781">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711810">p</span><span class="op" id="3711811">.</span><span class="ident" id="3711812">next</span><span class="op" id="3711816">(</span><span class="op" id="3711817">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711821">p</span><span class="op" id="3711822">.</span><span class="ident" id="3711823">resolve</span><span class="op" id="3711830">(</span><span class="ident" id="3711831">ident</span><span class="op" id="3711836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3711840">sel</span>&nbsp;<span class="op" id="3711844">:=</span>&nbsp;<span class="ident" id="3711847">p</span><span class="op" id="3711848">.</span><span class="ident" id="3711849">parseIdent</span><span class="op" id="3711859">(</span><span class="op" id="3711860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711864">return</span>&nbsp;<span class="op" id="3711871">&amp;</span><span class="ident" id="3711872">ast</span><span class="op" id="3711875">.</span><span class="ident" id="3711876">SelectorExpr</span><span class="op" id="3711888">{</span><span class="ident" id="3711889">X</span><span class="op" id="3711890">:</span>&nbsp;<span class="ident" id="3711892">ident</span><span class="op" id="3711897">,</span>&nbsp;<span class="ident" id="3711899">Sel</span><span class="op" id="3711902">:</span>&nbsp;<span class="ident" id="3711904">sel</span><span class="op" id="3711907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711914">return</span>&nbsp;<span class="ident" id="3711921">ident</span><br>
<span class="lineno"></span><span class="op" id="3711927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3711930">func</span>&nbsp;<span class="op" id="3711935">(</span><span class="ident" id="3711936">p</span>&nbsp;<span class="op" id="3711938">*</span><span class="ident" id="3711939">parser</span><span class="op" id="3711945">)</span>&nbsp;<span class="ident" id="3711947">parseArrayType</span><span class="op" id="3711961">(</span><span class="op" id="3711962">)</span>&nbsp;<span class="ident" id="3711964">ast</span><span class="op" id="3711967">.</span><span class="ident" id="3711968">Expr</span>&nbsp;<span class="op" id="3711973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711976">if</span>&nbsp;<span class="ident" id="3711979">p</span><span class="op" id="3711980">.</span><span class="ident" id="3711981">trace</span>&nbsp;<span class="op" id="3711987">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3711991">defer</span>&nbsp;<span class="ident" id="3711997">un</span><span class="op" id="3711999">(</span><span class="ident" id="3712000">trace</span><span class="op" id="3712005">(</span><span class="ident" id="3712006">p</span><span class="op" id="3712007">,</span>&nbsp;<span class="string" id="3712009">&#34;ArrayType&#34;</span><span class="op" id="3712020">)</span><span class="op" id="3712021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712028">lbrack</span>&nbsp;<span class="op" id="3712035">:=</span>&nbsp;<span class="ident" id="3712038">p</span><span class="op" id="3712039">.</span><span class="ident" id="3712040">expect</span><span class="op" id="3712046">(</span><span class="ident" id="3712047">token</span><span class="op" id="3712052">.</span><span class="ident" id="3712053">LBRACK</span><span class="op" id="3712059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712062">p</span><span class="op" id="3712063">.</span><span class="ident" id="3712064">exprLev</span><span class="op" id="3712071">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712075">var</span>&nbsp;<span class="builtinfunc" id="3712079">len</span>&nbsp;<span class="ident" id="3712083">ast</span><span class="op" id="3712086">.</span><span class="ident" id="3712087">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3712093">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712152">if</span>&nbsp;<span class="ident" id="3712155">p</span><span class="op" id="3712156">.</span><span class="ident" id="3712157">tok</span>&nbsp;<span class="op" id="3712161">==</span>&nbsp;<span class="ident" id="3712164">token</span><span class="op" id="3712169">.</span><span class="ident" id="3712170">ELLIPSIS</span>&nbsp;<span class="op" id="3712179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3712183">len</span>&nbsp;<span class="op" id="3712187">=</span>&nbsp;<span class="op" id="3712189">&amp;</span><span class="ident" id="3712190">ast</span><span class="op" id="3712193">.</span><span class="ident" id="3712194">Ellipsis</span><span class="op" id="3712202">{</span><span class="ident" id="3712203">Ellipsis</span><span class="op" id="3712211">:</span>&nbsp;<span class="ident" id="3712213">p</span><span class="op" id="3712214">.</span><span class="ident" id="3712215">pos</span><span class="op" id="3712218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712222">p</span><span class="op" id="3712223">.</span><span class="ident" id="3712224">next</span><span class="op" id="3712228">(</span><span class="op" id="3712229">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712232">}</span>&nbsp;<span class="keyword" id="3712234">else</span>&nbsp;<span class="keyword" id="3712239">if</span>&nbsp;<span class="ident" id="3712242">p</span><span class="op" id="3712243">.</span><span class="ident" id="3712244">tok</span>&nbsp;<span class="op" id="3712248">!=</span>&nbsp;<span class="ident" id="3712251">token</span><span class="op" id="3712256">.</span><span class="ident" id="3712257">RBRACK</span>&nbsp;<span class="op" id="3712264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3712268">len</span>&nbsp;<span class="op" id="3712272">=</span>&nbsp;<span class="ident" id="3712274">p</span><span class="op" id="3712275">.</span><span class="ident" id="3712276">parseRhs</span><span class="op" id="3712284">(</span><span class="op" id="3712285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712291">p</span><span class="op" id="3712292">.</span><span class="ident" id="3712293">exprLev</span><span class="op" id="3712300">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712304">p</span><span class="op" id="3712305">.</span><span class="ident" id="3712306">expect</span><span class="op" id="3712312">(</span><span class="ident" id="3712313">token</span><span class="op" id="3712318">.</span><span class="ident" id="3712319">RBRACK</span><span class="op" id="3712325">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712328">elt</span>&nbsp;<span class="op" id="3712332">:=</span>&nbsp;<span class="ident" id="3712335">p</span><span class="op" id="3712336">.</span><span class="ident" id="3712337">parseType</span><span class="op" id="3712346">(</span><span class="op" id="3712347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712351">return</span>&nbsp;<span class="op" id="3712358">&amp;</span><span class="ident" id="3712359">ast</span><span class="op" id="3712362">.</span><span class="ident" id="3712363">ArrayType</span><span class="op" id="3712372">{</span><span class="ident" id="3712373">Lbrack</span><span class="op" id="3712379">:</span>&nbsp;<span class="ident" id="3712381">lbrack</span><span class="op" id="3712387">,</span>&nbsp;<span class="ident" id="3712389">Len</span><span class="op" id="3712392">:</span>&nbsp;<span class="builtinfunc" id="3712394">len</span><span class="op" id="3712397">,</span>&nbsp;<span class="ident" id="3712399">Elt</span><span class="op" id="3712402">:</span>&nbsp;<span class="ident" id="3712404">elt</span><span class="op" id="3712407">}</span><br>
<span class="lineno"></span><span class="op" id="3712409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="3712412">func</span>&nbsp;<span class="op" id="3712417">(</span><span class="ident" id="3712418">p</span>&nbsp;<span class="op" id="3712420">*</span><span class="ident" id="3712421">parser</span><span class="op" id="3712427">)</span>&nbsp;<span class="ident" id="3712429">makeIdentList</span><span class="op" id="3712442">(</span><span class="ident" id="3712443">list</span>&nbsp;<span class="op" id="3712448">[</span><span class="op" id="3712449">]</span><span class="ident" id="3712450">ast</span><span class="op" id="3712453">.</span><span class="ident" id="3712454">Expr</span><span class="op" id="3712458">)</span>&nbsp;<span class="op" id="3712460">[</span><span class="op" id="3712461">]</span><span class="op" id="3712462">*</span><span class="ident" id="3712463">ast</span><span class="op" id="3712466">.</span><span class="ident" id="3712467">Ident</span>&nbsp;<span class="op" id="3712473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712476">idents</span>&nbsp;<span class="op" id="3712483">:=</span>&nbsp;<span class="builtinfunc" id="3712486">make</span><span class="op" id="3712490">(</span><span class="op" id="3712491">[</span><span class="op" id="3712492">]</span><span class="op" id="3712493">*</span><span class="ident" id="3712494">ast</span><span class="op" id="3712497">.</span><span class="ident" id="3712498">Ident</span><span class="op" id="3712503">,</span>&nbsp;<span class="builtinfunc" id="3712505">len</span><span class="op" id="3712508">(</span><span class="ident" id="3712509">list</span><span class="op" id="3712513">)</span><span class="op" id="3712514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712517">for</span>&nbsp;<span class="ident" id="3712521">i</span><span class="op" id="3712522">,</span>&nbsp;<span class="ident" id="3712524">x</span>&nbsp;<span class="op" id="3712526">:=</span>&nbsp;<span class="keyword" id="3712529">range</span>&nbsp;<span class="ident" id="3712535">list</span>&nbsp;<span class="op" id="3712540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712544">ident</span><span class="op" id="3712549">,</span>&nbsp;<span class="ident" id="3712551">isIdent</span>&nbsp;<span class="op" id="3712559">:=</span>&nbsp;<span class="ident" id="3712562">x</span><span class="op" id="3712563">.</span><span class="op" id="3712564">(</span><span class="op" id="3712565">*</span><span class="ident" id="3712566">ast</span><span class="op" id="3712569">.</span><span class="ident" id="3712570">Ident</span><span class="op" id="3712575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712579">if</span>&nbsp;<span class="op" id="3712582">!</span><span class="ident" id="3712583">isIdent</span>&nbsp;<span class="op" id="3712591">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712596">if</span>&nbsp;<span class="ident" id="3712599">_</span><span class="op" id="3712600">,</span>&nbsp;<span class="ident" id="3712602">isBad</span>&nbsp;<span class="op" id="3712608">:=</span>&nbsp;<span class="ident" id="3712611">x</span><span class="op" id="3712612">.</span><span class="op" id="3712613">(</span><span class="op" id="3712614">*</span><span class="ident" id="3712615">ast</span><span class="op" id="3712618">.</span><span class="ident" id="3712619">BadExpr</span><span class="op" id="3712626">)</span><span class="op" id="3712627">;</span>&nbsp;<span class="op" id="3712629">!</span><span class="ident" id="3712630">isBad</span>&nbsp;<span class="op" id="3712636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3712642">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712685">p</span><span class="op" id="3712686">.</span><span class="ident" id="3712687">errorExpected</span><span class="op" id="3712700">(</span><span class="ident" id="3712701">x</span><span class="op" id="3712702">.</span><span class="ident" id="3712703">Pos</span><span class="op" id="3712706">(</span><span class="op" id="3712707">)</span><span class="op" id="3712708">,</span>&nbsp;<span class="string" id="3712710">&#34;identifier&#34;</span><span class="op" id="3712722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712732">ident</span>&nbsp;<span class="op" id="3712738">=</span>&nbsp;<span class="op" id="3712740">&amp;</span><span class="ident" id="3712741">ast</span><span class="op" id="3712744">.</span><span class="ident" id="3712745">Ident</span><span class="op" id="3712750">{</span><span class="ident" id="3712751">NamePos</span><span class="op" id="3712758">:</span>&nbsp;<span class="ident" id="3712760">x</span><span class="op" id="3712761">.</span><span class="ident" id="3712762">Pos</span><span class="op" id="3712765">(</span><span class="op" id="3712766">)</span><span class="op" id="3712767">,</span>&nbsp;<span class="ident" id="3712769">Name</span><span class="op" id="3712773">:</span>&nbsp;<span class="string" id="3712775">&#34;_&#34;</span><span class="op" id="3712778">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712786">idents</span><span class="op" id="3712792">[</span><span class="ident" id="3712793">i</span><span class="op" id="3712794">]</span>&nbsp;<span class="op" id="3712796">=</span>&nbsp;<span class="ident" id="3712798">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712808">return</span>&nbsp;<span class="ident" id="3712815">idents</span><br>
<span class="lineno"></span><span class="op" id="3712822">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="3712825">func</span>&nbsp;<span class="op" id="3712830">(</span><span class="ident" id="3712831">p</span>&nbsp;<span class="op" id="3712833">*</span><span class="ident" id="3712834">parser</span><span class="op" id="3712840">)</span>&nbsp;<span class="ident" id="3712842">parseFieldDecl</span><span class="op" id="3712856">(</span><span class="ident" id="3712857">scope</span>&nbsp;<span class="op" id="3712863">*</span><span class="ident" id="3712864">ast</span><span class="op" id="3712867">.</span><span class="ident" id="3712868">Scope</span><span class="op" id="3712873">)</span>&nbsp;<span class="op" id="3712875">*</span><span class="ident" id="3712876">ast</span><span class="op" id="3712879">.</span><span class="ident" id="3712880">Field</span>&nbsp;<span class="op" id="3712886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712889">if</span>&nbsp;<span class="ident" id="3712892">p</span><span class="op" id="3712893">.</span><span class="ident" id="3712894">trace</span>&nbsp;<span class="op" id="3712900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3712904">defer</span>&nbsp;<span class="ident" id="3712910">un</span><span class="op" id="3712912">(</span><span class="ident" id="3712913">trace</span><span class="op" id="3712918">(</span><span class="ident" id="3712919">p</span><span class="op" id="3712920">,</span>&nbsp;<span class="string" id="3712922">&#34;FieldDecl&#34;</span><span class="op" id="3712933">)</span><span class="op" id="3712934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712937">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712941">doc</span>&nbsp;<span class="op" id="3712945">:=</span>&nbsp;<span class="ident" id="3712948">p</span><span class="op" id="3712949">.</span><span class="ident" id="3712950">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3712964">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712978">list</span><span class="op" id="3712982">,</span>&nbsp;<span class="ident" id="3712984">typ</span>&nbsp;<span class="op" id="3712988">:=</span>&nbsp;<span class="ident" id="3712991">p</span><span class="op" id="3712992">.</span><span class="ident" id="3712993">parseVarList</span><span class="op" id="3713005">(</span><span class="builtintype" id="3713006">false</span><span class="op" id="3713011">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3713015">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713023">var</span>&nbsp;<span class="ident" id="3713027">tag</span>&nbsp;<span class="op" id="3713031">*</span><span class="ident" id="3713032">ast</span><span class="op" id="3713035">.</span><span class="ident" id="3713036">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713046">if</span>&nbsp;<span class="ident" id="3713049">p</span><span class="op" id="3713050">.</span><span class="ident" id="3713051">tok</span>&nbsp;<span class="op" id="3713055">==</span>&nbsp;<span class="ident" id="3713058">token</span><span class="op" id="3713063">.</span><span class="ident" id="3713064">STRING</span>&nbsp;<span class="op" id="3713071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713075">tag</span>&nbsp;<span class="op" id="3713079">=</span>&nbsp;<span class="op" id="3713081">&amp;</span><span class="ident" id="3713082">ast</span><span class="op" id="3713085">.</span><span class="ident" id="3713086">BasicLit</span><span class="op" id="3713094">{</span><span class="ident" id="3713095">ValuePos</span><span class="op" id="3713103">:</span>&nbsp;<span class="ident" id="3713105">p</span><span class="op" id="3713106">.</span><span class="ident" id="3713107">pos</span><span class="op" id="3713110">,</span>&nbsp;<span class="ident" id="3713112">Kind</span><span class="op" id="3713116">:</span>&nbsp;<span class="ident" id="3713118">p</span><span class="op" id="3713119">.</span><span class="ident" id="3713120">tok</span><span class="op" id="3713123">,</span>&nbsp;<span class="ident" id="3713125">Value</span><span class="op" id="3713130">:</span>&nbsp;<span class="ident" id="3713132">p</span><span class="op" id="3713133">.</span><span class="ident" id="3713134">lit</span><span class="op" id="3713137">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713141">p</span><span class="op" id="3713142">.</span><span class="ident" id="3713143">next</span><span class="op" id="3713147">(</span><span class="op" id="3713148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3713155">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713172">var</span>&nbsp;<span class="ident" id="3713176">idents</span>&nbsp;<span class="op" id="3713183">[</span><span class="op" id="3713184">]</span><span class="op" id="3713185">*</span><span class="ident" id="3713186">ast</span><span class="op" id="3713189">.</span><span class="ident" id="3713190">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713197">if</span>&nbsp;<span class="ident" id="3713200">typ</span>&nbsp;<span class="op" id="3713204">!=</span>&nbsp;<span class="builtintype" id="3713207">nil</span>&nbsp;<span class="op" id="3713211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3713215">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713240">idents</span>&nbsp;<span class="op" id="3713247">=</span>&nbsp;<span class="ident" id="3713249">p</span><span class="op" id="3713250">.</span><span class="ident" id="3713251">makeIdentList</span><span class="op" id="3713264">(</span><span class="ident" id="3713265">list</span><span class="op" id="3713269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713272">}</span>&nbsp;<span class="keyword" id="3713274">else</span>&nbsp;<span class="op" id="3713279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3713283">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713320">typ</span>&nbsp;<span class="op" id="3713324">=</span>&nbsp;<span class="ident" id="3713326">list</span><span class="op" id="3713330">[</span><span class="num" id="3713331">0</span><span class="op" id="3713332">]</span>&nbsp;<span class="comment" id="3713334">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713375">if</span>&nbsp;<span class="ident" id="3713378">n</span>&nbsp;<span class="op" id="3713380">:=</span>&nbsp;<span class="builtinfunc" id="3713383">len</span><span class="op" id="3713386">(</span><span class="ident" id="3713387">list</span><span class="op" id="3713391">)</span><span class="op" id="3713392">;</span>&nbsp;<span class="ident" id="3713394">n</span>&nbsp;<span class="op" id="3713396">&gt;</span>&nbsp;<span class="num" id="3713398">1</span>&nbsp;<span class="op" id="3713400">||</span>&nbsp;<span class="op" id="3713403">!</span><span class="ident" id="3713404">isTypeName</span><span class="op" id="3713414">(</span><span class="ident" id="3713415">deref</span><span class="op" id="3713420">(</span><span class="ident" id="3713421">typ</span><span class="op" id="3713424">)</span><span class="op" id="3713425">)</span>&nbsp;<span class="op" id="3713427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713432">pos</span>&nbsp;<span class="op" id="3713436">:=</span>&nbsp;<span class="ident" id="3713439">typ</span><span class="op" id="3713442">.</span><span class="ident" id="3713443">Pos</span><span class="op" id="3713446">(</span><span class="op" id="3713447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713452">p</span><span class="op" id="3713453">.</span><span class="ident" id="3713454">errorExpected</span><span class="op" id="3713467">(</span><span class="ident" id="3713468">pos</span><span class="op" id="3713471">,</span>&nbsp;<span class="string" id="3713473">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="3713490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713495">typ</span>&nbsp;<span class="op" id="3713499">=</span>&nbsp;<span class="op" id="3713501">&amp;</span><span class="ident" id="3713502">ast</span><span class="op" id="3713505">.</span><span class="ident" id="3713506">BadExpr</span><span class="op" id="3713513">{</span><span class="ident" id="3713514">From</span><span class="op" id="3713518">:</span>&nbsp;<span class="ident" id="3713520">pos</span><span class="op" id="3713523">,</span>&nbsp;<span class="ident" id="3713525">To</span><span class="op" id="3713527">:</span>&nbsp;<span class="ident" id="3713529">p</span><span class="op" id="3713530">.</span><span class="ident" id="3713531">safePos</span><span class="op" id="3713538">(</span><span class="ident" id="3713539">list</span><span class="op" id="3713543">[</span><span class="ident" id="3713544">n</span><span class="op" id="3713545">-</span><span class="num" id="3713546">1</span><span class="op" id="3713547">]</span><span class="op" id="3713548">.</span><span class="ident" id="3713549">End</span><span class="op" id="3713552">(</span><span class="op" id="3713553">)</span><span class="op" id="3713554">)</span><span class="op" id="3713555">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713566">p</span><span class="op" id="3713567">.</span><span class="ident" id="3713568">expectSemi</span><span class="op" id="3713578">(</span><span class="op" id="3713579">)</span>&nbsp;<span class="comment" id="3713581">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713622">field</span>&nbsp;<span class="op" id="3713628">:=</span>&nbsp;<span class="op" id="3713631">&amp;</span><span class="ident" id="3713632">ast</span><span class="op" id="3713635">.</span><span class="ident" id="3713636">Field</span><span class="op" id="3713641">{</span><span class="ident" id="3713642">Doc</span><span class="op" id="3713645">:</span>&nbsp;<span class="ident" id="3713647">doc</span><span class="op" id="3713650">,</span>&nbsp;<span class="ident" id="3713652">Names</span><span class="op" id="3713657">:</span>&nbsp;<span class="ident" id="3713659">idents</span><span class="op" id="3713665">,</span>&nbsp;<span class="ident" id="3713667">Type</span><span class="op" id="3713671">:</span>&nbsp;<span class="ident" id="3713673">typ</span><span class="op" id="3713676">,</span>&nbsp;<span class="ident" id="3713678">Tag</span><span class="op" id="3713681">:</span>&nbsp;<span class="ident" id="3713683">tag</span><span class="op" id="3713686">,</span>&nbsp;<span class="ident" id="3713688">Comment</span><span class="op" id="3713695">:</span>&nbsp;<span class="ident" id="3713697">p</span><span class="op" id="3713698">.</span><span class="ident" id="3713699">lineComment</span><span class="op" id="3713710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713713">p</span><span class="op" id="3713714">.</span><span class="ident" id="3713715">declare</span><span class="op" id="3713722">(</span><span class="ident" id="3713723">field</span><span class="op" id="3713728">,</span>&nbsp;<span class="builtintype" id="3713730">nil</span><span class="op" id="3713733">,</span>&nbsp;<span class="ident" id="3713735">scope</span><span class="op" id="3713740">,</span>&nbsp;<span class="ident" id="3713742">ast</span><span class="op" id="3713745">.</span><span class="ident" id="3713746">Var</span><span class="op" id="3713749">,</span>&nbsp;<span class="ident" id="3713751">idents</span><span class="op" id="3713757">...</span><span class="op" id="3713760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713763">p</span><span class="op" id="3713764">.</span><span class="ident" id="3713765">resolve</span><span class="op" id="3713772">(</span><span class="ident" id="3713773">typ</span><span class="op" id="3713776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713780">return</span>&nbsp;<span class="ident" id="3713787">field</span><br>
<span class="lineno">715</span><span class="op" id="3713793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3713796">func</span>&nbsp;<span class="op" id="3713801">(</span><span class="ident" id="3713802">p</span>&nbsp;<span class="op" id="3713804">*</span><span class="ident" id="3713805">parser</span><span class="op" id="3713811">)</span>&nbsp;<span class="ident" id="3713813">parseStructType</span><span class="op" id="3713828">(</span><span class="op" id="3713829">)</span>&nbsp;<span class="op" id="3713831">*</span><span class="ident" id="3713832">ast</span><span class="op" id="3713835">.</span><span class="ident" id="3713836">StructType</span>&nbsp;<span class="op" id="3713847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713850">if</span>&nbsp;<span class="ident" id="3713853">p</span><span class="op" id="3713854">.</span><span class="ident" id="3713855">trace</span>&nbsp;<span class="op" id="3713861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3713865">defer</span>&nbsp;<span class="ident" id="3713871">un</span><span class="op" id="3713873">(</span><span class="ident" id="3713874">trace</span><span class="op" id="3713879">(</span><span class="ident" id="3713880">p</span><span class="op" id="3713881">,</span>&nbsp;<span class="string" id="3713883">&#34;StructType&#34;</span><span class="op" id="3713895">)</span><span class="op" id="3713896">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713903">pos</span>&nbsp;<span class="op" id="3713907">:=</span>&nbsp;<span class="ident" id="3713910">p</span><span class="op" id="3713911">.</span><span class="ident" id="3713912">expect</span><span class="op" id="3713918">(</span><span class="ident" id="3713919">token</span><span class="op" id="3713924">.</span><span class="ident" id="3713925">STRUCT</span><span class="op" id="3713931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713934">lbrace</span>&nbsp;<span class="op" id="3713941">:=</span>&nbsp;<span class="ident" id="3713944">p</span><span class="op" id="3713945">.</span><span class="ident" id="3713946">expect</span><span class="op" id="3713952">(</span><span class="ident" id="3713953">token</span><span class="op" id="3713958">.</span><span class="ident" id="3713959">LBRACE</span><span class="op" id="3713965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3713968">scope</span>&nbsp;<span class="op" id="3713974">:=</span>&nbsp;<span class="ident" id="3713977">ast</span><span class="op" id="3713980">.</span><span class="ident" id="3713981">NewScope</span><span class="op" id="3713989">(</span><span class="builtintype" id="3713990">nil</span><span class="op" id="3713993">)</span>&nbsp;<span class="comment" id="3713995">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714012">var</span>&nbsp;<span class="ident" id="3714016">list</span>&nbsp;<span class="op" id="3714021">[</span><span class="op" id="3714022">]</span><span class="op" id="3714023">*</span><span class="ident" id="3714024">ast</span><span class="op" id="3714027">.</span><span class="ident" id="3714028">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714035">for</span>&nbsp;<span class="ident" id="3714039">p</span><span class="op" id="3714040">.</span><span class="ident" id="3714041">tok</span>&nbsp;<span class="op" id="3714045">==</span>&nbsp;<span class="ident" id="3714048">token</span><span class="op" id="3714053">.</span><span class="ident" id="3714054">IDENT</span>&nbsp;<span class="op" id="3714060">||</span>&nbsp;<span class="ident" id="3714063">p</span><span class="op" id="3714064">.</span><span class="ident" id="3714065">tok</span>&nbsp;<span class="op" id="3714069">==</span>&nbsp;<span class="ident" id="3714072">token</span><span class="op" id="3714077">.</span><span class="ident" id="3714078">MUL</span>&nbsp;<span class="op" id="3714082">||</span>&nbsp;<span class="ident" id="3714085">p</span><span class="op" id="3714086">.</span><span class="ident" id="3714087">tok</span>&nbsp;<span class="op" id="3714091">==</span>&nbsp;<span class="ident" id="3714094">token</span><span class="op" id="3714099">.</span><span class="ident" id="3714100">LPAREN</span>&nbsp;<span class="op" id="3714107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3714111">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3714174">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3714237">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714296">list</span>&nbsp;<span class="op" id="3714301">=</span>&nbsp;<span class="builtinfunc" id="3714303">append</span><span class="op" id="3714309">(</span><span class="ident" id="3714310">list</span><span class="op" id="3714314">,</span>&nbsp;<span class="ident" id="3714316">p</span><span class="op" id="3714317">.</span><span class="ident" id="3714318">parseFieldDecl</span><span class="op" id="3714332">(</span><span class="ident" id="3714333">scope</span><span class="op" id="3714338">)</span><span class="op" id="3714339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3714342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714345">rbrace</span>&nbsp;<span class="op" id="3714352">:=</span>&nbsp;<span class="ident" id="3714355">p</span><span class="op" id="3714356">.</span><span class="ident" id="3714357">expect</span><span class="op" id="3714363">(</span><span class="ident" id="3714364">token</span><span class="op" id="3714369">.</span><span class="ident" id="3714370">RBRACE</span><span class="op" id="3714376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714380">return</span>&nbsp;<span class="op" id="3714387">&amp;</span><span class="ident" id="3714388">ast</span><span class="op" id="3714391">.</span><span class="ident" id="3714392">StructType</span><span class="op" id="3714402">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714406">Struct</span><span class="op" id="3714412">:</span>&nbsp;<span class="ident" id="3714414">pos</span><span class="op" id="3714417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714421">Fields</span><span class="op" id="3714427">:</span>&nbsp;<span class="op" id="3714429">&amp;</span><span class="ident" id="3714430">ast</span><span class="op" id="3714433">.</span><span class="ident" id="3714434">FieldList</span><span class="op" id="3714443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714448">Opening</span><span class="op" id="3714455">:</span>&nbsp;<span class="ident" id="3714457">lbrace</span><span class="op" id="3714463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714468">List</span><span class="op" id="3714472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714477">list</span><span class="op" id="3714481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714486">Closing</span><span class="op" id="3714493">:</span>&nbsp;<span class="ident" id="3714495">rbrace</span><span class="op" id="3714501">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3714505">}</span><span class="op" id="3714506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3714509">}</span><br>
<span class="lineno"></span><span class="op" id="3714511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3714514">func</span>&nbsp;<span class="op" id="3714519">(</span><span class="ident" id="3714520">p</span>&nbsp;<span class="op" id="3714522">*</span><span class="ident" id="3714523">parser</span><span class="op" id="3714529">)</span>&nbsp;<span class="ident" id="3714531">parsePointerType</span><span class="op" id="3714547">(</span><span class="op" id="3714548">)</span>&nbsp;<span class="op" id="3714550">*</span><span class="ident" id="3714551">ast</span><span class="op" id="3714554">.</span><span class="ident" id="3714555">StarExpr</span>&nbsp;<span class="op" id="3714564">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714567">if</span>&nbsp;<span class="ident" id="3714570">p</span><span class="op" id="3714571">.</span><span class="ident" id="3714572">trace</span>&nbsp;<span class="op" id="3714578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714582">defer</span>&nbsp;<span class="ident" id="3714588">un</span><span class="op" id="3714590">(</span><span class="ident" id="3714591">trace</span><span class="op" id="3714596">(</span><span class="ident" id="3714597">p</span><span class="op" id="3714598">,</span>&nbsp;<span class="string" id="3714600">&#34;PointerType&#34;</span><span class="op" id="3714613">)</span><span class="op" id="3714614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3714617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714621">star</span>&nbsp;<span class="op" id="3714626">:=</span>&nbsp;<span class="ident" id="3714629">p</span><span class="op" id="3714630">.</span><span class="ident" id="3714631">expect</span><span class="op" id="3714637">(</span><span class="ident" id="3714638">token</span><span class="op" id="3714643">.</span><span class="ident" id="3714644">MUL</span><span class="op" id="3714647">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714650">base</span>&nbsp;<span class="op" id="3714655">:=</span>&nbsp;<span class="ident" id="3714658">p</span><span class="op" id="3714659">.</span><span class="ident" id="3714660">parseType</span><span class="op" id="3714669">(</span><span class="op" id="3714670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714674">return</span>&nbsp;<span class="op" id="3714681">&amp;</span><span class="ident" id="3714682">ast</span><span class="op" id="3714685">.</span><span class="ident" id="3714686">StarExpr</span><span class="op" id="3714694">{</span><span class="ident" id="3714695">Star</span><span class="op" id="3714699">:</span>&nbsp;<span class="ident" id="3714701">star</span><span class="op" id="3714705">,</span>&nbsp;<span class="ident" id="3714707">X</span><span class="op" id="3714708">:</span>&nbsp;<span class="ident" id="3714710">base</span><span class="op" id="3714714">}</span><br>
<span class="lineno"></span><span class="op" id="3714716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="3714719">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3714774">func</span>&nbsp;<span class="op" id="3714779">(</span><span class="ident" id="3714780">p</span>&nbsp;<span class="op" id="3714782">*</span><span class="ident" id="3714783">parser</span><span class="op" id="3714789">)</span>&nbsp;<span class="ident" id="3714791">tryVarType</span><span class="op" id="3714801">(</span><span class="ident" id="3714802">isParam</span>&nbsp;<span class="builtintype" id="3714810">bool</span><span class="op" id="3714814">)</span>&nbsp;<span class="ident" id="3714816">ast</span><span class="op" id="3714819">.</span><span class="ident" id="3714820">Expr</span>&nbsp;<span class="op" id="3714825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714828">if</span>&nbsp;<span class="ident" id="3714831">isParam</span>&nbsp;<span class="op" id="3714839">&amp;&amp;</span>&nbsp;<span class="ident" id="3714842">p</span><span class="op" id="3714843">.</span><span class="ident" id="3714844">tok</span>&nbsp;<span class="op" id="3714848">==</span>&nbsp;<span class="ident" id="3714851">token</span><span class="op" id="3714856">.</span><span class="ident" id="3714857">ELLIPSIS</span>&nbsp;<span class="op" id="3714866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714870">pos</span>&nbsp;<span class="op" id="3714874">:=</span>&nbsp;<span class="ident" id="3714877">p</span><span class="op" id="3714878">.</span><span class="ident" id="3714879">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714885">p</span><span class="op" id="3714886">.</span><span class="ident" id="3714887">next</span><span class="op" id="3714891">(</span><span class="op" id="3714892">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3714896">typ</span>&nbsp;<span class="op" id="3714900">:=</span>&nbsp;<span class="ident" id="3714903">p</span><span class="op" id="3714904">.</span><span class="ident" id="3714905">tryIdentOrType</span><span class="op" id="3714919">(</span><span class="op" id="3714920">)</span>&nbsp;<span class="comment" id="3714922">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3714986">if</span>&nbsp;<span class="ident" id="3714989">typ</span>&nbsp;<span class="op" id="3714993">!=</span>&nbsp;<span class="builtintype" id="3714996">nil</span>&nbsp;<span class="op" id="3715000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715005">p</span><span class="op" id="3715006">.</span><span class="ident" id="3715007">resolve</span><span class="op" id="3715014">(</span><span class="ident" id="3715015">typ</span><span class="op" id="3715018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3715022">}</span>&nbsp;<span class="keyword" id="3715024">else</span>&nbsp;<span class="op" id="3715029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715034">p</span><span class="op" id="3715035">.</span><span class="builtintype" id="3715036">error</span><span class="op" id="3715041">(</span><span class="ident" id="3715042">pos</span><span class="op" id="3715045">,</span>&nbsp;<span class="string" id="3715047">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="3715080">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715085">typ</span>&nbsp;<span class="op" id="3715089">=</span>&nbsp;<span class="op" id="3715091">&amp;</span><span class="ident" id="3715092">ast</span><span class="op" id="3715095">.</span><span class="ident" id="3715096">BadExpr</span><span class="op" id="3715103">{</span><span class="ident" id="3715104">From</span><span class="op" id="3715108">:</span>&nbsp;<span class="ident" id="3715110">pos</span><span class="op" id="3715113">,</span>&nbsp;<span class="ident" id="3715115">To</span><span class="op" id="3715117">:</span>&nbsp;<span class="ident" id="3715119">p</span><span class="op" id="3715120">.</span><span class="ident" id="3715121">pos</span><span class="op" id="3715124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3715128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715132">return</span>&nbsp;<span class="op" id="3715139">&amp;</span><span class="ident" id="3715140">ast</span><span class="op" id="3715143">.</span><span class="ident" id="3715144">Ellipsis</span><span class="op" id="3715152">{</span><span class="ident" id="3715153">Ellipsis</span><span class="op" id="3715161">:</span>&nbsp;<span class="ident" id="3715163">pos</span><span class="op" id="3715166">,</span>&nbsp;<span class="ident" id="3715168">Elt</span><span class="op" id="3715171">:</span>&nbsp;<span class="ident" id="3715173">typ</span><span class="op" id="3715176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3715179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715182">return</span>&nbsp;<span class="ident" id="3715189">p</span><span class="op" id="3715190">.</span><span class="ident" id="3715191">tryIdentOrType</span><span class="op" id="3715205">(</span><span class="op" id="3715206">)</span><br>
<span class="lineno">770</span><span class="op" id="3715208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3715211">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3715266">func</span>&nbsp;<span class="op" id="3715271">(</span><span class="ident" id="3715272">p</span>&nbsp;<span class="op" id="3715274">*</span><span class="ident" id="3715275">parser</span><span class="op" id="3715281">)</span>&nbsp;<span class="ident" id="3715283">parseVarType</span><span class="op" id="3715295">(</span><span class="ident" id="3715296">isParam</span>&nbsp;<span class="builtintype" id="3715304">bool</span><span class="op" id="3715308">)</span>&nbsp;<span class="ident" id="3715310">ast</span><span class="op" id="3715313">.</span><span class="ident" id="3715314">Expr</span>&nbsp;<span class="op" id="3715319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715322">typ</span>&nbsp;<span class="op" id="3715326">:=</span>&nbsp;<span class="ident" id="3715329">p</span><span class="op" id="3715330">.</span><span class="ident" id="3715331">tryVarType</span><span class="op" id="3715341">(</span><span class="ident" id="3715342">isParam</span><span class="op" id="3715349">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715352">if</span>&nbsp;<span class="ident" id="3715355">typ</span>&nbsp;<span class="op" id="3715359">==</span>&nbsp;<span class="builtintype" id="3715362">nil</span>&nbsp;<span class="op" id="3715366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715370">pos</span>&nbsp;<span class="op" id="3715374">:=</span>&nbsp;<span class="ident" id="3715377">p</span><span class="op" id="3715378">.</span><span class="ident" id="3715379">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715385">p</span><span class="op" id="3715386">.</span><span class="ident" id="3715387">errorExpected</span><span class="op" id="3715400">(</span><span class="ident" id="3715401">pos</span><span class="op" id="3715404">,</span>&nbsp;<span class="string" id="3715406">&#34;type&#34;</span><span class="op" id="3715412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715416">p</span><span class="op" id="3715417">.</span><span class="ident" id="3715418">next</span><span class="op" id="3715422">(</span><span class="op" id="3715423">)</span>&nbsp;<span class="comment" id="3715425">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3715444">typ</span>&nbsp;<span class="op" id="3715448">=</span>&nbsp;<span class="op" id="3715450">&amp;</span><span class="ident" id="3715451">ast</span><span class="op" id="3715454">.</span><span class="ident" id="3715455">BadExpr</span><span class="op" id="3715462">{</span><span class="ident" id="3715463">From</span><span class="op" id="3715467">:</span>&nbsp;<span class="ident" id="3715469">pos</span><span class="op" id="3715472">,</span>&nbsp;<span class="ident" id="3715474">To</span><span class="op" id="3715476">:</span>&nbsp;<span class="ident" id="3715478">p</span><span class="op" id="3715479">.</span><span class="ident" id="3715480">pos</span><span class="op" id="3715483">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3715486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715489">return</span>&nbsp;<span class="ident" id="3715496">typ</span><br>
<span class="lineno"></span><span class="op" id="3715500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3715503">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="3715568">func</span>&nbsp;<span class="op" id="3715573">(</span><span class="ident" id="3715574">p</span>&nbsp;<span class="op" id="3715576">*</span><span class="ident" id="3715577">parser</span><span class="op" id="3715583">)</span>&nbsp;<span class="ident" id="3715585">parseVarList</span><span class="op" id="3715597">(</span><span class="ident" id="3715598">isParam</span>&nbsp;<span class="builtintype" id="3715606">bool</span><span class="op" id="3715610">)</span>&nbsp;<span class="op" id="3715612">(</span><span class="ident" id="3715613">list</span>&nbsp;<span class="op" id="3715618">[</span><span class="op" id="3715619">]</span><span class="ident" id="3715620">ast</span><span class="op" id="3715623">.</span><span class="ident" id="3715624">Expr</span><span class="op" id="3715628">,</span>&nbsp;<span class="ident" id="3715630">typ</span>&nbsp;<span class="ident" id="3715634">ast</span><span class="op" id="3715637">.</span><span class="ident" id="3715638">Expr</span><span class="op" id="3715642">)</span>&nbsp;<span class="op" id="3715644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715647">if</span>&nbsp;<span class="ident" id="3715650">p</span><span class="op" id="3715651">.</span><span class="ident" id="3715652">trace</span>&nbsp;<span class="op" id="3715658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715662">defer</span>&nbsp;<span class="ident" id="3715668">un</span><span class="op" id="3715670">(</span><span class="ident" id="3715671">trace</span><span class="op" id="3715676">(</span><span class="ident" id="3715677">p</span><span class="op" id="3715678">,</span>&nbsp;<span class="string" id="3715680">&#34;VarList&#34;</span><span class="op" id="3715689">)</span><span class="op" id="3715690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3715693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3715697">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3715755">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3715759">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3715822">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3715885">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3715948">for</span>&nbsp;<span class="ident" id="3715952">typ</span>&nbsp;<span class="op" id="3715956">:=</span>&nbsp;<span class="ident" id="3715959">p</span><span class="op" id="3715960">.</span><span class="ident" id="3715961">parseVarType</span><span class="op" id="3715973">(</span><span class="ident" id="3715974">isParam</span><span class="op" id="3715981">)</span><span class="op" id="3715982">;</span>&nbsp;<span class="ident" id="3715984">typ</span>&nbsp;<span class="op" id="3715988">!=</span>&nbsp;<span class="builtintype" id="3715991">nil</span><span class="op" id="3715994">;</span>&nbsp;<span class="op" id="3715996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716000">list</span>&nbsp;<span class="op" id="3716005">=</span>&nbsp;<span class="builtinfunc" id="3716007">append</span><span class="op" id="3716013">(</span><span class="ident" id="3716014">list</span><span class="op" id="3716018">,</span>&nbsp;<span class="ident" id="3716020">typ</span><span class="op" id="3716023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716027">if</span>&nbsp;<span class="ident" id="3716030">p</span><span class="op" id="3716031">.</span><span class="ident" id="3716032">tok</span>&nbsp;<span class="op" id="3716036">!=</span>&nbsp;<span class="ident" id="3716039">token</span><span class="op" id="3716044">.</span><span class="ident" id="3716045">COMMA</span>&nbsp;<span class="op" id="3716051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716056">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3716064">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716068">p</span><span class="op" id="3716069">.</span><span class="ident" id="3716070">next</span><span class="op" id="3716074">(</span><span class="op" id="3716075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716079">typ</span>&nbsp;<span class="op" id="3716083">=</span>&nbsp;<span class="ident" id="3716085">p</span><span class="op" id="3716086">.</span><span class="ident" id="3716087">tryVarType</span><span class="op" id="3716097">(</span><span class="ident" id="3716098">isParam</span><span class="op" id="3716105">)</span>&nbsp;<span class="comment" id="3716107">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3716144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3716148">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716215">typ</span>&nbsp;<span class="op" id="3716219">=</span>&nbsp;<span class="ident" id="3716221">p</span><span class="op" id="3716222">.</span><span class="ident" id="3716223">tryVarType</span><span class="op" id="3716233">(</span><span class="ident" id="3716234">isParam</span><span class="op" id="3716241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716245">return</span><br>
<span class="lineno"></span><span class="op" id="3716252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="3716255">func</span>&nbsp;<span class="op" id="3716260">(</span><span class="ident" id="3716261">p</span>&nbsp;<span class="op" id="3716263">*</span><span class="ident" id="3716264">parser</span><span class="op" id="3716270">)</span>&nbsp;<span class="ident" id="3716272">parseParameterList</span><span class="op" id="3716290">(</span><span class="ident" id="3716291">scope</span>&nbsp;<span class="op" id="3716297">*</span><span class="ident" id="3716298">ast</span><span class="op" id="3716301">.</span><span class="ident" id="3716302">Scope</span><span class="op" id="3716307">,</span>&nbsp;<span class="ident" id="3716309">ellipsisOk</span>&nbsp;<span class="builtintype" id="3716320">bool</span><span class="op" id="3716324">)</span>&nbsp;<span class="op" id="3716326">(</span><span class="ident" id="3716327">params</span>&nbsp;<span class="op" id="3716334">[</span><span class="op" id="3716335">]</span><span class="op" id="3716336">*</span><span class="ident" id="3716337">ast</span><span class="op" id="3716340">.</span><span class="ident" id="3716341">Field</span><span class="op" id="3716346">)</span>&nbsp;<span class="op" id="3716348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716351">if</span>&nbsp;<span class="ident" id="3716354">p</span><span class="op" id="3716355">.</span><span class="ident" id="3716356">trace</span>&nbsp;<span class="op" id="3716362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716366">defer</span>&nbsp;<span class="ident" id="3716372">un</span><span class="op" id="3716374">(</span><span class="ident" id="3716375">trace</span><span class="op" id="3716380">(</span><span class="ident" id="3716381">p</span><span class="op" id="3716382">,</span>&nbsp;<span class="string" id="3716384">&#34;ParameterList&#34;</span><span class="op" id="3716399">)</span><span class="op" id="3716400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3716403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3716407">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716425">list</span><span class="op" id="3716429">,</span>&nbsp;<span class="ident" id="3716431">typ</span>&nbsp;<span class="op" id="3716435">:=</span>&nbsp;<span class="ident" id="3716438">p</span><span class="op" id="3716439">.</span><span class="ident" id="3716440">parseVarList</span><span class="op" id="3716452">(</span><span class="ident" id="3716453">ellipsisOk</span><span class="op" id="3716463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3716467">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716484">if</span>&nbsp;<span class="ident" id="3716487">typ</span>&nbsp;<span class="op" id="3716491">!=</span>&nbsp;<span class="builtintype" id="3716494">nil</span>&nbsp;<span class="op" id="3716498">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3716502">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716527">idents</span>&nbsp;<span class="op" id="3716534">:=</span>&nbsp;<span class="ident" id="3716537">p</span><span class="op" id="3716538">.</span><span class="ident" id="3716539">makeIdentList</span><span class="op" id="3716552">(</span><span class="ident" id="3716553">list</span><span class="op" id="3716557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716561">field</span>&nbsp;<span class="op" id="3716567">:=</span>&nbsp;<span class="op" id="3716570">&amp;</span><span class="ident" id="3716571">ast</span><span class="op" id="3716574">.</span><span class="ident" id="3716575">Field</span><span class="op" id="3716580">{</span><span class="ident" id="3716581">Names</span><span class="op" id="3716586">:</span>&nbsp;<span class="ident" id="3716588">idents</span><span class="op" id="3716594">,</span>&nbsp;<span class="ident" id="3716596">Type</span><span class="op" id="3716600">:</span>&nbsp;<span class="ident" id="3716602">typ</span><span class="op" id="3716605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716609">params</span>&nbsp;<span class="op" id="3716616">=</span>&nbsp;<span class="builtinfunc" id="3716618">append</span><span class="op" id="3716624">(</span><span class="ident" id="3716625">params</span><span class="op" id="3716631">,</span>&nbsp;<span class="ident" id="3716633">field</span><span class="op" id="3716638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3716642">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3716703">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716759">p</span><span class="op" id="3716760">.</span><span class="ident" id="3716761">declare</span><span class="op" id="3716768">(</span><span class="ident" id="3716769">field</span><span class="op" id="3716774">,</span>&nbsp;<span class="builtintype" id="3716776">nil</span><span class="op" id="3716779">,</span>&nbsp;<span class="ident" id="3716781">scope</span><span class="op" id="3716786">,</span>&nbsp;<span class="ident" id="3716788">ast</span><span class="op" id="3716791">.</span><span class="ident" id="3716792">Var</span><span class="op" id="3716795">,</span>&nbsp;<span class="ident" id="3716797">idents</span><span class="op" id="3716803">...</span><span class="op" id="3716806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716810">p</span><span class="op" id="3716811">.</span><span class="ident" id="3716812">resolve</span><span class="op" id="3716819">(</span><span class="ident" id="3716820">typ</span><span class="op" id="3716823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716827">if</span>&nbsp;<span class="op" id="3716830">!</span><span class="ident" id="3716831">p</span><span class="op" id="3716832">.</span><span class="ident" id="3716833">atComma</span><span class="op" id="3716840">(</span><span class="string" id="3716841">&#34;parameter&nbsp;list&#34;</span><span class="op" id="3716857">)</span>&nbsp;<span class="op" id="3716859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716864">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3716873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716877">p</span><span class="op" id="3716878">.</span><span class="ident" id="3716879">next</span><span class="op" id="3716883">(</span><span class="op" id="3716884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3716888">for</span>&nbsp;<span class="ident" id="3716892">p</span><span class="op" id="3716893">.</span><span class="ident" id="3716894">tok</span>&nbsp;<span class="op" id="3716898">!=</span>&nbsp;<span class="ident" id="3716901">token</span><span class="op" id="3716906">.</span><span class="ident" id="3716907">RPAREN</span>&nbsp;<span class="op" id="3716914">&amp;&amp;</span>&nbsp;<span class="ident" id="3716917">p</span><span class="op" id="3716918">.</span><span class="ident" id="3716919">tok</span>&nbsp;<span class="op" id="3716923">!=</span>&nbsp;<span class="ident" id="3716926">token</span><span class="op" id="3716931">.</span><span class="ident" id="3716932">EOF</span>&nbsp;<span class="op" id="3716936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716941">idents</span>&nbsp;<span class="op" id="3716948">:=</span>&nbsp;<span class="ident" id="3716951">p</span><span class="op" id="3716952">.</span><span class="ident" id="3716953">parseIdentList</span><span class="op" id="3716967">(</span><span class="op" id="3716968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3716973">typ</span>&nbsp;<span class="op" id="3716977">:=</span>&nbsp;<span class="ident" id="3716980">p</span><span class="op" id="3716981">.</span><span class="ident" id="3716982">parseVarType</span><span class="op" id="3716994">(</span><span class="ident" id="3716995">ellipsisOk</span><span class="op" id="3717005">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717010">field</span>&nbsp;<span class="op" id="3717016">:=</span>&nbsp;<span class="op" id="3717019">&amp;</span><span class="ident" id="3717020">ast</span><span class="op" id="3717023">.</span><span class="ident" id="3717024">Field</span><span class="op" id="3717029">{</span><span class="ident" id="3717030">Names</span><span class="op" id="3717035">:</span>&nbsp;<span class="ident" id="3717037">idents</span><span class="op" id="3717043">,</span>&nbsp;<span class="ident" id="3717045">Type</span><span class="op" id="3717049">:</span>&nbsp;<span class="ident" id="3717051">typ</span><span class="op" id="3717054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717059">params</span>&nbsp;<span class="op" id="3717066">=</span>&nbsp;<span class="builtinfunc" id="3717068">append</span><span class="op" id="3717074">(</span><span class="ident" id="3717075">params</span><span class="op" id="3717081">,</span>&nbsp;<span class="ident" id="3717083">field</span><span class="op" id="3717088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3717093">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3717155">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717212">p</span><span class="op" id="3717213">.</span><span class="ident" id="3717214">declare</span><span class="op" id="3717221">(</span><span class="ident" id="3717222">field</span><span class="op" id="3717227">,</span>&nbsp;<span class="builtintype" id="3717229">nil</span><span class="op" id="3717232">,</span>&nbsp;<span class="ident" id="3717234">scope</span><span class="op" id="3717239">,</span>&nbsp;<span class="ident" id="3717241">ast</span><span class="op" id="3717244">.</span><span class="ident" id="3717245">Var</span><span class="op" id="3717248">,</span>&nbsp;<span class="ident" id="3717250">idents</span><span class="op" id="3717256">...</span><span class="op" id="3717259">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717264">p</span><span class="op" id="3717265">.</span><span class="ident" id="3717266">resolve</span><span class="op" id="3717273">(</span><span class="ident" id="3717274">typ</span><span class="op" id="3717277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717282">if</span>&nbsp;<span class="op" id="3717285">!</span><span class="ident" id="3717286">p</span><span class="op" id="3717287">.</span><span class="ident" id="3717288">atComma</span><span class="op" id="3717295">(</span><span class="string" id="3717296">&#34;parameter&nbsp;list&#34;</span><span class="op" id="3717312">)</span>&nbsp;<span class="op" id="3717314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717320">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3717329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717334">p</span><span class="op" id="3717335">.</span><span class="ident" id="3717336">next</span><span class="op" id="3717340">(</span><span class="op" id="3717341">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3717345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717349">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3717357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3717361">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717406">params</span>&nbsp;<span class="op" id="3717413">=</span>&nbsp;<span class="builtinfunc" id="3717415">make</span><span class="op" id="3717419">(</span><span class="op" id="3717420">[</span><span class="op" id="3717421">]</span><span class="op" id="3717422">*</span><span class="ident" id="3717423">ast</span><span class="op" id="3717426">.</span><span class="ident" id="3717427">Field</span><span class="op" id="3717432">,</span>&nbsp;<span class="builtinfunc" id="3717434">len</span><span class="op" id="3717437">(</span><span class="ident" id="3717438">list</span><span class="op" id="3717442">)</span><span class="op" id="3717443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717446">for</span>&nbsp;<span class="ident" id="3717450">i</span><span class="op" id="3717451">,</span>&nbsp;<span class="ident" id="3717453">typ</span>&nbsp;<span class="op" id="3717457">:=</span>&nbsp;<span class="keyword" id="3717460">range</span>&nbsp;<span class="ident" id="3717466">list</span>&nbsp;<span class="op" id="3717471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717475">p</span><span class="op" id="3717476">.</span><span class="ident" id="3717477">resolve</span><span class="op" id="3717484">(</span><span class="ident" id="3717485">typ</span><span class="op" id="3717488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717492">params</span><span class="op" id="3717498">[</span><span class="ident" id="3717499">i</span><span class="op" id="3717500">]</span>&nbsp;<span class="op" id="3717502">=</span>&nbsp;<span class="op" id="3717504">&amp;</span><span class="ident" id="3717505">ast</span><span class="op" id="3717508">.</span><span class="ident" id="3717509">Field</span><span class="op" id="3717514">{</span><span class="ident" id="3717515">Type</span><span class="op" id="3717519">:</span>&nbsp;<span class="ident" id="3717521">typ</span><span class="op" id="3717524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3717527">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717530">return</span><br>
<span class="lineno"></span><span class="op" id="3717537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3717540">func</span>&nbsp;<span class="op" id="3717545">(</span><span class="ident" id="3717546">p</span>&nbsp;<span class="op" id="3717548">*</span><span class="ident" id="3717549">parser</span><span class="op" id="3717555">)</span>&nbsp;<span class="ident" id="3717557">parseParameters</span><span class="op" id="3717572">(</span><span class="ident" id="3717573">scope</span>&nbsp;<span class="op" id="3717579">*</span><span class="ident" id="3717580">ast</span><span class="op" id="3717583">.</span><span class="ident" id="3717584">Scope</span><span class="op" id="3717589">,</span>&nbsp;<span class="ident" id="3717591">ellipsisOk</span>&nbsp;<span class="builtintype" id="3717602">bool</span><span class="op" id="3717606">)</span>&nbsp;<span class="op" id="3717608">*</span><span class="ident" id="3717609">ast</span><span class="op" id="3717612">.</span><span class="ident" id="3717613">FieldList</span>&nbsp;<span class="op" id="3717623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717626">if</span>&nbsp;<span class="ident" id="3717629">p</span><span class="op" id="3717630">.</span><span class="ident" id="3717631">trace</span>&nbsp;<span class="op" id="3717637">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717641">defer</span>&nbsp;<span class="ident" id="3717647">un</span><span class="op" id="3717649">(</span><span class="ident" id="3717650">trace</span><span class="op" id="3717655">(</span><span class="ident" id="3717656">p</span><span class="op" id="3717657">,</span>&nbsp;<span class="string" id="3717659">&#34;Parameters&#34;</span><span class="op" id="3717671">)</span><span class="op" id="3717672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3717675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717679">var</span>&nbsp;<span class="ident" id="3717683">params</span>&nbsp;<span class="op" id="3717690">[</span><span class="op" id="3717691">]</span><span class="op" id="3717692">*</span><span class="ident" id="3717693">ast</span><span class="op" id="3717696">.</span><span class="ident" id="3717697">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717704">lparen</span>&nbsp;<span class="op" id="3717711">:=</span>&nbsp;<span class="ident" id="3717714">p</span><span class="op" id="3717715">.</span><span class="ident" id="3717716">expect</span><span class="op" id="3717722">(</span><span class="ident" id="3717723">token</span><span class="op" id="3717728">.</span><span class="ident" id="3717729">LPAREN</span><span class="op" id="3717735">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717738">if</span>&nbsp;<span class="ident" id="3717741">p</span><span class="op" id="3717742">.</span><span class="ident" id="3717743">tok</span>&nbsp;<span class="op" id="3717747">!=</span>&nbsp;<span class="ident" id="3717750">token</span><span class="op" id="3717755">.</span><span class="ident" id="3717756">RPAREN</span>&nbsp;<span class="op" id="3717763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717767">params</span>&nbsp;<span class="op" id="3717774">=</span>&nbsp;<span class="ident" id="3717776">p</span><span class="op" id="3717777">.</span><span class="ident" id="3717778">parseParameterList</span><span class="op" id="3717796">(</span><span class="ident" id="3717797">scope</span><span class="op" id="3717802">,</span>&nbsp;<span class="ident" id="3717804">ellipsisOk</span><span class="op" id="3717814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3717817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3717820">rparen</span>&nbsp;<span class="op" id="3717827">:=</span>&nbsp;<span class="ident" id="3717830">p</span><span class="op" id="3717831">.</span><span class="ident" id="3717832">expect</span><span class="op" id="3717838">(</span><span class="ident" id="3717839">token</span><span class="op" id="3717844">.</span><span class="ident" id="3717845">RPAREN</span><span class="op" id="3717851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717855">return</span>&nbsp;<span class="op" id="3717862">&amp;</span><span class="ident" id="3717863">ast</span><span class="op" id="3717866">.</span><span class="ident" id="3717867">FieldList</span><span class="op" id="3717876">{</span><span class="ident" id="3717877">Opening</span><span class="op" id="3717884">:</span>&nbsp;<span class="ident" id="3717886">lparen</span><span class="op" id="3717892">,</span>&nbsp;<span class="ident" id="3717894">List</span><span class="op" id="3717898">:</span>&nbsp;<span class="ident" id="3717900">params</span><span class="op" id="3717906">,</span>&nbsp;<span class="ident" id="3717908">Closing</span><span class="op" id="3717915">:</span>&nbsp;<span class="ident" id="3717917">rparen</span><span class="op" id="3717923">}</span><br>
<span class="lineno"></span><span class="op" id="3717925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3717928">func</span>&nbsp;<span class="op" id="3717933">(</span><span class="ident" id="3717934">p</span>&nbsp;<span class="op" id="3717936">*</span><span class="ident" id="3717937">parser</span><span class="op" id="3717943">)</span>&nbsp;<span class="ident" id="3717945">parseResult</span><span class="op" id="3717956">(</span><span class="ident" id="3717957">scope</span>&nbsp;<span class="op" id="3717963">*</span><span class="ident" id="3717964">ast</span><span class="op" id="3717967">.</span><span class="ident" id="3717968">Scope</span><span class="op" id="3717973">)</span>&nbsp;<span class="op" id="3717975">*</span><span class="ident" id="3717976">ast</span><span class="op" id="3717979">.</span><span class="ident" id="3717980">FieldList</span>&nbsp;<span class="op" id="3717990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3717993">if</span>&nbsp;<span class="ident" id="3717996">p</span><span class="op" id="3717997">.</span><span class="ident" id="3717998">trace</span>&nbsp;<span class="op" id="3718004">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718008">defer</span>&nbsp;<span class="ident" id="3718014">un</span><span class="op" id="3718016">(</span><span class="ident" id="3718017">trace</span><span class="op" id="3718022">(</span><span class="ident" id="3718023">p</span><span class="op" id="3718024">,</span>&nbsp;<span class="string" id="3718026">&#34;Result&#34;</span><span class="op" id="3718034">)</span><span class="op" id="3718035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3718038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718042">if</span>&nbsp;<span class="ident" id="3718045">p</span><span class="op" id="3718046">.</span><span class="ident" id="3718047">tok</span>&nbsp;<span class="op" id="3718051">==</span>&nbsp;<span class="ident" id="3718054">token</span><span class="op" id="3718059">.</span><span class="ident" id="3718060">LPAREN</span>&nbsp;<span class="op" id="3718067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718071">return</span>&nbsp;<span class="ident" id="3718078">p</span><span class="op" id="3718079">.</span><span class="ident" id="3718080">parseParameters</span><span class="op" id="3718095">(</span><span class="ident" id="3718096">scope</span><span class="op" id="3718101">,</span>&nbsp;<span class="builtintype" id="3718103">false</span><span class="op" id="3718108">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3718111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718115">typ</span>&nbsp;<span class="op" id="3718119">:=</span>&nbsp;<span class="ident" id="3718122">p</span><span class="op" id="3718123">.</span><span class="ident" id="3718124">tryType</span><span class="op" id="3718131">(</span><span class="op" id="3718132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718135">if</span>&nbsp;<span class="ident" id="3718138">typ</span>&nbsp;<span class="op" id="3718142">!=</span>&nbsp;<span class="builtintype" id="3718145">nil</span>&nbsp;<span class="op" id="3718149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718153">list</span>&nbsp;<span class="op" id="3718158">:=</span>&nbsp;<span class="builtinfunc" id="3718161">make</span><span class="op" id="3718165">(</span><span class="op" id="3718166">[</span><span class="op" id="3718167">]</span><span class="op" id="3718168">*</span><span class="ident" id="3718169">ast</span><span class="op" id="3718172">.</span><span class="ident" id="3718173">Field</span><span class="op" id="3718178">,</span>&nbsp;<span class="num" id="3718180">1</span><span class="op" id="3718181">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718185">list</span><span class="op" id="3718189">[</span><span class="num" id="3718190">0</span><span class="op" id="3718191">]</span>&nbsp;<span class="op" id="3718193">=</span>&nbsp;<span class="op" id="3718195">&amp;</span><span class="ident" id="3718196">ast</span><span class="op" id="3718199">.</span><span class="ident" id="3718200">Field</span><span class="op" id="3718205">{</span><span class="ident" id="3718206">Type</span><span class="op" id="3718210">:</span>&nbsp;<span class="ident" id="3718212">typ</span><span class="op" id="3718215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718219">return</span>&nbsp;<span class="op" id="3718226">&amp;</span><span class="ident" id="3718227">ast</span><span class="op" id="3718230">.</span><span class="ident" id="3718231">FieldList</span><span class="op" id="3718240">{</span><span class="ident" id="3718241">List</span><span class="op" id="3718245">:</span>&nbsp;<span class="ident" id="3718247">list</span><span class="op" id="3718251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3718254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718258">return</span>&nbsp;<span class="builtintype" id="3718265">nil</span><br>
<span class="lineno">890</span><span class="op" id="3718269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3718272">func</span>&nbsp;<span class="op" id="3718277">(</span><span class="ident" id="3718278">p</span>&nbsp;<span class="op" id="3718280">*</span><span class="ident" id="3718281">parser</span><span class="op" id="3718287">)</span>&nbsp;<span class="ident" id="3718289">parseSignature</span><span class="op" id="3718303">(</span><span class="ident" id="3718304">scope</span>&nbsp;<span class="op" id="3718310">*</span><span class="ident" id="3718311">ast</span><span class="op" id="3718314">.</span><span class="ident" id="3718315">Scope</span><span class="op" id="3718320">)</span>&nbsp;<span class="op" id="3718322">(</span><span class="ident" id="3718323">params</span><span class="op" id="3718329">,</span>&nbsp;<span class="ident" id="3718331">results</span>&nbsp;<span class="op" id="3718339">*</span><span class="ident" id="3718340">ast</span><span class="op" id="3718343">.</span><span class="ident" id="3718344">FieldList</span><span class="op" id="3718353">)</span>&nbsp;<span class="op" id="3718355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718358">if</span>&nbsp;<span class="ident" id="3718361">p</span><span class="op" id="3718362">.</span><span class="ident" id="3718363">trace</span>&nbsp;<span class="op" id="3718369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718373">defer</span>&nbsp;<span class="ident" id="3718379">un</span><span class="op" id="3718381">(</span><span class="ident" id="3718382">trace</span><span class="op" id="3718387">(</span><span class="ident" id="3718388">p</span><span class="op" id="3718389">,</span>&nbsp;<span class="string" id="3718391">&#34;Signature&#34;</span><span class="op" id="3718402">)</span><span class="op" id="3718403">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3718406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718410">params</span>&nbsp;<span class="op" id="3718417">=</span>&nbsp;<span class="ident" id="3718419">p</span><span class="op" id="3718420">.</span><span class="ident" id="3718421">parseParameters</span><span class="op" id="3718436">(</span><span class="ident" id="3718437">scope</span><span class="op" id="3718442">,</span>&nbsp;<span class="builtintype" id="3718444">true</span><span class="op" id="3718448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718451">results</span>&nbsp;<span class="op" id="3718459">=</span>&nbsp;<span class="ident" id="3718461">p</span><span class="op" id="3718462">.</span><span class="ident" id="3718463">parseResult</span><span class="op" id="3718474">(</span><span class="ident" id="3718475">scope</span><span class="op" id="3718480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718484">return</span><br>
<span class="lineno"></span><span class="op" id="3718491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3718494">func</span>&nbsp;<span class="op" id="3718499">(</span><span class="ident" id="3718500">p</span>&nbsp;<span class="op" id="3718502">*</span><span class="ident" id="3718503">parser</span><span class="op" id="3718509">)</span>&nbsp;<span class="ident" id="3718511">parseFuncType</span><span class="op" id="3718524">(</span><span class="op" id="3718525">)</span>&nbsp;<span class="op" id="3718527">(</span><span class="op" id="3718528">*</span><span class="ident" id="3718529">ast</span><span class="op" id="3718532">.</span><span class="ident" id="3718533">FuncType</span><span class="op" id="3718541">,</span>&nbsp;<span class="op" id="3718543">*</span><span class="ident" id="3718544">ast</span><span class="op" id="3718547">.</span><span class="ident" id="3718548">Scope</span><span class="op" id="3718553">)</span>&nbsp;<span class="op" id="3718555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718558">if</span>&nbsp;<span class="ident" id="3718561">p</span><span class="op" id="3718562">.</span><span class="ident" id="3718563">trace</span>&nbsp;<span class="op" id="3718569">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718573">defer</span>&nbsp;<span class="ident" id="3718579">un</span><span class="op" id="3718581">(</span><span class="ident" id="3718582">trace</span><span class="op" id="3718587">(</span><span class="ident" id="3718588">p</span><span class="op" id="3718589">,</span>&nbsp;<span class="string" id="3718591">&#34;FuncType&#34;</span><span class="op" id="3718601">)</span><span class="op" id="3718602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3718605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718609">pos</span>&nbsp;<span class="op" id="3718613">:=</span>&nbsp;<span class="ident" id="3718616">p</span><span class="op" id="3718617">.</span><span class="ident" id="3718618">expect</span><span class="op" id="3718624">(</span><span class="ident" id="3718625">token</span><span class="op" id="3718630">.</span><span class="ident" id="3718631">FUNC</span><span class="op" id="3718635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718638">scope</span>&nbsp;<span class="op" id="3718644">:=</span>&nbsp;<span class="ident" id="3718647">ast</span><span class="op" id="3718650">.</span><span class="ident" id="3718651">NewScope</span><span class="op" id="3718659">(</span><span class="ident" id="3718660">p</span><span class="op" id="3718661">.</span><span class="ident" id="3718662">topScope</span><span class="op" id="3718670">)</span>&nbsp;<span class="comment" id="3718672">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718691">params</span><span class="op" id="3718697">,</span>&nbsp;<span class="ident" id="3718699">results</span>&nbsp;<span class="op" id="3718707">:=</span>&nbsp;<span class="ident" id="3718710">p</span><span class="op" id="3718711">.</span><span class="ident" id="3718712">parseSignature</span><span class="op" id="3718726">(</span><span class="ident" id="3718727">scope</span><span class="op" id="3718732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718736">return</span>&nbsp;<span class="op" id="3718743">&amp;</span><span class="ident" id="3718744">ast</span><span class="op" id="3718747">.</span><span class="ident" id="3718748">FuncType</span><span class="op" id="3718756">{</span><span class="ident" id="3718757">Func</span><span class="op" id="3718761">:</span>&nbsp;<span class="ident" id="3718763">pos</span><span class="op" id="3718766">,</span>&nbsp;<span class="ident" id="3718768">Params</span><span class="op" id="3718774">:</span>&nbsp;<span class="ident" id="3718776">params</span><span class="op" id="3718782">,</span>&nbsp;<span class="ident" id="3718784">Results</span><span class="op" id="3718791">:</span>&nbsp;<span class="ident" id="3718793">results</span><span class="op" id="3718800">}</span><span class="op" id="3718801">,</span>&nbsp;<span class="ident" id="3718803">scope</span><br>
<span class="lineno"></span><span class="op" id="3718809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="3718812">func</span>&nbsp;<span class="op" id="3718817">(</span><span class="ident" id="3718818">p</span>&nbsp;<span class="op" id="3718820">*</span><span class="ident" id="3718821">parser</span><span class="op" id="3718827">)</span>&nbsp;<span class="ident" id="3718829">parseMethodSpec</span><span class="op" id="3718844">(</span><span class="ident" id="3718845">scope</span>&nbsp;<span class="op" id="3718851">*</span><span class="ident" id="3718852">ast</span><span class="op" id="3718855">.</span><span class="ident" id="3718856">Scope</span><span class="op" id="3718861">)</span>&nbsp;<span class="op" id="3718863">*</span><span class="ident" id="3718864">ast</span><span class="op" id="3718867">.</span><span class="ident" id="3718868">Field</span>&nbsp;<span class="op" id="3718874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718877">if</span>&nbsp;<span class="ident" id="3718880">p</span><span class="op" id="3718881">.</span><span class="ident" id="3718882">trace</span>&nbsp;<span class="op" id="3718888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718892">defer</span>&nbsp;<span class="ident" id="3718898">un</span><span class="op" id="3718900">(</span><span class="ident" id="3718901">trace</span><span class="op" id="3718906">(</span><span class="ident" id="3718907">p</span><span class="op" id="3718908">,</span>&nbsp;<span class="string" id="3718910">&#34;MethodSpec&#34;</span><span class="op" id="3718922">)</span><span class="op" id="3718923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3718926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718930">doc</span>&nbsp;<span class="op" id="3718934">:=</span>&nbsp;<span class="ident" id="3718937">p</span><span class="op" id="3718938">.</span><span class="ident" id="3718939">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718952">var</span>&nbsp;<span class="ident" id="3718956">idents</span>&nbsp;<span class="op" id="3718963">[</span><span class="op" id="3718964">]</span><span class="op" id="3718965">*</span><span class="ident" id="3718966">ast</span><span class="op" id="3718969">.</span><span class="ident" id="3718970">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3718977">var</span>&nbsp;<span class="ident" id="3718981">typ</span>&nbsp;<span class="ident" id="3718985">ast</span><span class="op" id="3718988">.</span><span class="ident" id="3718989">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3718995">x</span>&nbsp;<span class="op" id="3718997">:=</span>&nbsp;<span class="ident" id="3719000">p</span><span class="op" id="3719001">.</span><span class="ident" id="3719002">parseTypeName</span><span class="op" id="3719015">(</span><span class="op" id="3719016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719019">if</span>&nbsp;<span class="ident" id="3719022">ident</span><span class="op" id="3719027">,</span>&nbsp;<span class="ident" id="3719029">isIdent</span>&nbsp;<span class="op" id="3719037">:=</span>&nbsp;<span class="ident" id="3719040">x</span><span class="op" id="3719041">.</span><span class="op" id="3719042">(</span><span class="op" id="3719043">*</span><span class="ident" id="3719044">ast</span><span class="op" id="3719047">.</span><span class="ident" id="3719048">Ident</span><span class="op" id="3719053">)</span><span class="op" id="3719054">;</span>&nbsp;<span class="ident" id="3719056">isIdent</span>&nbsp;<span class="op" id="3719064">&amp;&amp;</span>&nbsp;<span class="ident" id="3719067">p</span><span class="op" id="3719068">.</span><span class="ident" id="3719069">tok</span>&nbsp;<span class="op" id="3719073">==</span>&nbsp;<span class="ident" id="3719076">token</span><span class="op" id="3719081">.</span><span class="ident" id="3719082">LPAREN</span>&nbsp;<span class="op" id="3719089">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3719093">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719105">idents</span>&nbsp;<span class="op" id="3719112">=</span>&nbsp;<span class="op" id="3719114">[</span><span class="op" id="3719115">]</span><span class="op" id="3719116">*</span><span class="ident" id="3719117">ast</span><span class="op" id="3719120">.</span><span class="ident" id="3719121">Ident</span><span class="op" id="3719126">{</span><span class="ident" id="3719127">ident</span><span class="op" id="3719132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719136">scope</span>&nbsp;<span class="op" id="3719142">:=</span>&nbsp;<span class="ident" id="3719145">ast</span><span class="op" id="3719148">.</span><span class="ident" id="3719149">NewScope</span><span class="op" id="3719157">(</span><span class="builtintype" id="3719158">nil</span><span class="op" id="3719161">)</span>&nbsp;<span class="comment" id="3719163">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719181">params</span><span class="op" id="3719187">,</span>&nbsp;<span class="ident" id="3719189">results</span>&nbsp;<span class="op" id="3719197">:=</span>&nbsp;<span class="ident" id="3719200">p</span><span class="op" id="3719201">.</span><span class="ident" id="3719202">parseSignature</span><span class="op" id="3719216">(</span><span class="ident" id="3719217">scope</span><span class="op" id="3719222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719226">typ</span>&nbsp;<span class="op" id="3719230">=</span>&nbsp;<span class="op" id="3719232">&amp;</span><span class="ident" id="3719233">ast</span><span class="op" id="3719236">.</span><span class="ident" id="3719237">FuncType</span><span class="op" id="3719245">{</span><span class="ident" id="3719246">Func</span><span class="op" id="3719250">:</span>&nbsp;<span class="ident" id="3719252">token</span><span class="op" id="3719257">.</span><span class="ident" id="3719258">NoPos</span><span class="op" id="3719263">,</span>&nbsp;<span class="ident" id="3719265">Params</span><span class="op" id="3719271">:</span>&nbsp;<span class="ident" id="3719273">params</span><span class="op" id="3719279">,</span>&nbsp;<span class="ident" id="3719281">Results</span><span class="op" id="3719288">:</span>&nbsp;<span class="ident" id="3719290">results</span><span class="op" id="3719297">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3719300">}</span>&nbsp;<span class="keyword" id="3719302">else</span>&nbsp;<span class="op" id="3719307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3719311">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719335">typ</span>&nbsp;<span class="op" id="3719339">=</span>&nbsp;<span class="ident" id="3719341">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719345">p</span><span class="op" id="3719346">.</span><span class="ident" id="3719347">resolve</span><span class="op" id="3719354">(</span><span class="ident" id="3719355">typ</span><span class="op" id="3719358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3719361">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719364">p</span><span class="op" id="3719365">.</span><span class="ident" id="3719366">expectSemi</span><span class="op" id="3719376">(</span><span class="op" id="3719377">)</span>&nbsp;<span class="comment" id="3719379">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719420">spec</span>&nbsp;<span class="op" id="3719425">:=</span>&nbsp;<span class="op" id="3719428">&amp;</span><span class="ident" id="3719429">ast</span><span class="op" id="3719432">.</span><span class="ident" id="3719433">Field</span><span class="op" id="3719438">{</span><span class="ident" id="3719439">Doc</span><span class="op" id="3719442">:</span>&nbsp;<span class="ident" id="3719444">doc</span><span class="op" id="3719447">,</span>&nbsp;<span class="ident" id="3719449">Names</span><span class="op" id="3719454">:</span>&nbsp;<span class="ident" id="3719456">idents</span><span class="op" id="3719462">,</span>&nbsp;<span class="ident" id="3719464">Type</span><span class="op" id="3719468">:</span>&nbsp;<span class="ident" id="3719470">typ</span><span class="op" id="3719473">,</span>&nbsp;<span class="ident" id="3719475">Comment</span><span class="op" id="3719482">:</span>&nbsp;<span class="ident" id="3719484">p</span><span class="op" id="3719485">.</span><span class="ident" id="3719486">lineComment</span><span class="op" id="3719497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719500">p</span><span class="op" id="3719501">.</span><span class="ident" id="3719502">declare</span><span class="op" id="3719509">(</span><span class="ident" id="3719510">spec</span><span class="op" id="3719514">,</span>&nbsp;<span class="builtintype" id="3719516">nil</span><span class="op" id="3719519">,</span>&nbsp;<span class="ident" id="3719521">scope</span><span class="op" id="3719526">,</span>&nbsp;<span class="ident" id="3719528">ast</span><span class="op" id="3719531">.</span><span class="ident" id="3719532">Fun</span><span class="op" id="3719535">,</span>&nbsp;<span class="ident" id="3719537">idents</span><span class="op" id="3719543">...</span><span class="op" id="3719546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719550">return</span>&nbsp;<span class="ident" id="3719557">spec</span><br>
<span class="lineno"></span><span class="op" id="3719562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3719565">func</span>&nbsp;<span class="op" id="3719570">(</span><span class="ident" id="3719571">p</span>&nbsp;<span class="op" id="3719573">*</span><span class="ident" id="3719574">parser</span><span class="op" id="3719580">)</span>&nbsp;<span class="ident" id="3719582">parseInterfaceType</span><span class="op" id="3719600">(</span><span class="op" id="3719601">)</span>&nbsp;<span class="op" id="3719603">*</span><span class="ident" id="3719604">ast</span><span class="op" id="3719607">.</span><span class="ident" id="3719608">InterfaceType</span>&nbsp;<span class="op" id="3719622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719625">if</span>&nbsp;<span class="ident" id="3719628">p</span><span class="op" id="3719629">.</span><span class="ident" id="3719630">trace</span>&nbsp;<span class="op" id="3719636">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719640">defer</span>&nbsp;<span class="ident" id="3719646">un</span><span class="op" id="3719648">(</span><span class="ident" id="3719649">trace</span><span class="op" id="3719654">(</span><span class="ident" id="3719655">p</span><span class="op" id="3719656">,</span>&nbsp;<span class="string" id="3719658">&#34;InterfaceType&#34;</span><span class="op" id="3719673">)</span><span class="op" id="3719674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3719677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719681">pos</span>&nbsp;<span class="op" id="3719685">:=</span>&nbsp;<span class="ident" id="3719688">p</span><span class="op" id="3719689">.</span><span class="ident" id="3719690">expect</span><span class="op" id="3719696">(</span><span class="ident" id="3719697">token</span><span class="op" id="3719702">.</span><span class="ident" id="3719703">INTERFACE</span><span class="op" id="3719712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719715">lbrace</span>&nbsp;<span class="op" id="3719722">:=</span>&nbsp;<span class="ident" id="3719725">p</span><span class="op" id="3719726">.</span><span class="ident" id="3719727">expect</span><span class="op" id="3719733">(</span><span class="ident" id="3719734">token</span><span class="op" id="3719739">.</span><span class="ident" id="3719740">LBRACE</span><span class="op" id="3719746">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719749">scope</span>&nbsp;<span class="op" id="3719755">:=</span>&nbsp;<span class="ident" id="3719758">ast</span><span class="op" id="3719761">.</span><span class="ident" id="3719762">NewScope</span><span class="op" id="3719770">(</span><span class="builtintype" id="3719771">nil</span><span class="op" id="3719774">)</span>&nbsp;<span class="comment" id="3719776">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719796">var</span>&nbsp;<span class="ident" id="3719800">list</span>&nbsp;<span class="op" id="3719805">[</span><span class="op" id="3719806">]</span><span class="op" id="3719807">*</span><span class="ident" id="3719808">ast</span><span class="op" id="3719811">.</span><span class="ident" id="3719812">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719819">for</span>&nbsp;<span class="ident" id="3719823">p</span><span class="op" id="3719824">.</span><span class="ident" id="3719825">tok</span>&nbsp;<span class="op" id="3719829">==</span>&nbsp;<span class="ident" id="3719832">token</span><span class="op" id="3719837">.</span><span class="ident" id="3719838">IDENT</span>&nbsp;<span class="op" id="3719844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719848">list</span>&nbsp;<span class="op" id="3719853">=</span>&nbsp;<span class="builtinfunc" id="3719855">append</span><span class="op" id="3719861">(</span><span class="ident" id="3719862">list</span><span class="op" id="3719866">,</span>&nbsp;<span class="ident" id="3719868">p</span><span class="op" id="3719869">.</span><span class="ident" id="3719870">parseMethodSpec</span><span class="op" id="3719885">(</span><span class="ident" id="3719886">scope</span><span class="op" id="3719891">)</span><span class="op" id="3719892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3719895">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719898">rbrace</span>&nbsp;<span class="op" id="3719905">:=</span>&nbsp;<span class="ident" id="3719908">p</span><span class="op" id="3719909">.</span><span class="ident" id="3719910">expect</span><span class="op" id="3719916">(</span><span class="ident" id="3719917">token</span><span class="op" id="3719922">.</span><span class="ident" id="3719923">RBRACE</span><span class="op" id="3719929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3719933">return</span>&nbsp;<span class="op" id="3719940">&amp;</span><span class="ident" id="3719941">ast</span><span class="op" id="3719944">.</span><span class="ident" id="3719945">InterfaceType</span><span class="op" id="3719958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719962">Interface</span><span class="op" id="3719971">:</span>&nbsp;<span class="ident" id="3719973">pos</span><span class="op" id="3719976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3719980">Methods</span><span class="op" id="3719987">:</span>&nbsp;<span class="op" id="3719989">&amp;</span><span class="ident" id="3719990">ast</span><span class="op" id="3719993">.</span><span class="ident" id="3719994">FieldList</span><span class="op" id="3720003">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720008">Opening</span><span class="op" id="3720015">:</span>&nbsp;<span class="ident" id="3720017">lbrace</span><span class="op" id="3720023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720028">List</span><span class="op" id="3720032">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720037">list</span><span class="op" id="3720041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720046">Closing</span><span class="op" id="3720053">:</span>&nbsp;<span class="ident" id="3720055">rbrace</span><span class="op" id="3720061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720065">}</span><span class="op" id="3720066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720069">}</span><br>
<span class="lineno">965</span><span class="op" id="3720071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3720074">func</span>&nbsp;<span class="op" id="3720079">(</span><span class="ident" id="3720080">p</span>&nbsp;<span class="op" id="3720082">*</span><span class="ident" id="3720083">parser</span><span class="op" id="3720089">)</span>&nbsp;<span class="ident" id="3720091">parseMapType</span><span class="op" id="3720103">(</span><span class="op" id="3720104">)</span>&nbsp;<span class="op" id="3720106">*</span><span class="ident" id="3720107">ast</span><span class="op" id="3720110">.</span><span class="ident" id="3720111">MapType</span>&nbsp;<span class="op" id="3720119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720122">if</span>&nbsp;<span class="ident" id="3720125">p</span><span class="op" id="3720126">.</span><span class="ident" id="3720127">trace</span>&nbsp;<span class="op" id="3720133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720137">defer</span>&nbsp;<span class="ident" id="3720143">un</span><span class="op" id="3720145">(</span><span class="ident" id="3720146">trace</span><span class="op" id="3720151">(</span><span class="ident" id="3720152">p</span><span class="op" id="3720153">,</span>&nbsp;<span class="string" id="3720155">&#34;MapType&#34;</span><span class="op" id="3720164">)</span><span class="op" id="3720165">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720172">pos</span>&nbsp;<span class="op" id="3720176">:=</span>&nbsp;<span class="ident" id="3720179">p</span><span class="op" id="3720180">.</span><span class="ident" id="3720181">expect</span><span class="op" id="3720187">(</span><span class="ident" id="3720188">token</span><span class="op" id="3720193">.</span><span class="ident" id="3720194">MAP</span><span class="op" id="3720197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720200">p</span><span class="op" id="3720201">.</span><span class="ident" id="3720202">expect</span><span class="op" id="3720208">(</span><span class="ident" id="3720209">token</span><span class="op" id="3720214">.</span><span class="ident" id="3720215">LBRACK</span><span class="op" id="3720221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720224">key</span>&nbsp;<span class="op" id="3720228">:=</span>&nbsp;<span class="ident" id="3720231">p</span><span class="op" id="3720232">.</span><span class="ident" id="3720233">parseType</span><span class="op" id="3720242">(</span><span class="op" id="3720243">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720246">p</span><span class="op" id="3720247">.</span><span class="ident" id="3720248">expect</span><span class="op" id="3720254">(</span><span class="ident" id="3720255">token</span><span class="op" id="3720260">.</span><span class="ident" id="3720261">RBRACK</span><span class="op" id="3720267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720270">value</span>&nbsp;<span class="op" id="3720276">:=</span>&nbsp;<span class="ident" id="3720279">p</span><span class="op" id="3720280">.</span><span class="ident" id="3720281">parseType</span><span class="op" id="3720290">(</span><span class="op" id="3720291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720295">return</span>&nbsp;<span class="op" id="3720302">&amp;</span><span class="ident" id="3720303">ast</span><span class="op" id="3720306">.</span><span class="ident" id="3720307">MapType</span><span class="op" id="3720314">{</span><span class="ident" id="3720315">Map</span><span class="op" id="3720318">:</span>&nbsp;<span class="ident" id="3720320">pos</span><span class="op" id="3720323">,</span>&nbsp;<span class="ident" id="3720325">Key</span><span class="op" id="3720328">:</span>&nbsp;<span class="ident" id="3720330">key</span><span class="op" id="3720333">,</span>&nbsp;<span class="ident" id="3720335">Value</span><span class="op" id="3720340">:</span>&nbsp;<span class="ident" id="3720342">value</span><span class="op" id="3720347">}</span><br>
<span class="lineno"></span><span class="op" id="3720349">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="3720352">func</span>&nbsp;<span class="op" id="3720357">(</span><span class="ident" id="3720358">p</span>&nbsp;<span class="op" id="3720360">*</span><span class="ident" id="3720361">parser</span><span class="op" id="3720367">)</span>&nbsp;<span class="ident" id="3720369">parseChanType</span><span class="op" id="3720382">(</span><span class="op" id="3720383">)</span>&nbsp;<span class="op" id="3720385">*</span><span class="ident" id="3720386">ast</span><span class="op" id="3720389">.</span><span class="ident" id="3720390">ChanType</span>&nbsp;<span class="op" id="3720399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720402">if</span>&nbsp;<span class="ident" id="3720405">p</span><span class="op" id="3720406">.</span><span class="ident" id="3720407">trace</span>&nbsp;<span class="op" id="3720413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720417">defer</span>&nbsp;<span class="ident" id="3720423">un</span><span class="op" id="3720425">(</span><span class="ident" id="3720426">trace</span><span class="op" id="3720431">(</span><span class="ident" id="3720432">p</span><span class="op" id="3720433">,</span>&nbsp;<span class="string" id="3720435">&#34;ChanType&#34;</span><span class="op" id="3720445">)</span><span class="op" id="3720446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720449">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720453">pos</span>&nbsp;<span class="op" id="3720457">:=</span>&nbsp;<span class="ident" id="3720460">p</span><span class="op" id="3720461">.</span><span class="ident" id="3720462">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720467">dir</span>&nbsp;<span class="op" id="3720471">:=</span>&nbsp;<span class="ident" id="3720474">ast</span><span class="op" id="3720477">.</span><span class="ident" id="3720478">SEND</span>&nbsp;<span class="op" id="3720483">|</span>&nbsp;<span class="ident" id="3720485">ast</span><span class="op" id="3720488">.</span><span class="ident" id="3720489">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720495">var</span>&nbsp;<span class="ident" id="3720499">arrow</span>&nbsp;<span class="ident" id="3720505">token</span><span class="op" id="3720510">.</span><span class="ident" id="3720511">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720516">if</span>&nbsp;<span class="ident" id="3720519">p</span><span class="op" id="3720520">.</span><span class="ident" id="3720521">tok</span>&nbsp;<span class="op" id="3720525">==</span>&nbsp;<span class="ident" id="3720528">token</span><span class="op" id="3720533">.</span><span class="ident" id="3720534">CHAN</span>&nbsp;<span class="op" id="3720539">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720543">p</span><span class="op" id="3720544">.</span><span class="ident" id="3720545">next</span><span class="op" id="3720549">(</span><span class="op" id="3720550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720554">if</span>&nbsp;<span class="ident" id="3720557">p</span><span class="op" id="3720558">.</span><span class="ident" id="3720559">tok</span>&nbsp;<span class="op" id="3720563">==</span>&nbsp;<span class="ident" id="3720566">token</span><span class="op" id="3720571">.</span><span class="ident" id="3720572">ARROW</span>&nbsp;<span class="op" id="3720578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720583">arrow</span>&nbsp;<span class="op" id="3720589">=</span>&nbsp;<span class="ident" id="3720591">p</span><span class="op" id="3720592">.</span><span class="ident" id="3720593">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720600">p</span><span class="op" id="3720601">.</span><span class="ident" id="3720602">next</span><span class="op" id="3720606">(</span><span class="op" id="3720607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720612">dir</span>&nbsp;<span class="op" id="3720616">=</span>&nbsp;<span class="ident" id="3720618">ast</span><span class="op" id="3720621">.</span><span class="ident" id="3720622">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720632">}</span>&nbsp;<span class="keyword" id="3720634">else</span>&nbsp;<span class="op" id="3720639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720643">arrow</span>&nbsp;<span class="op" id="3720649">=</span>&nbsp;<span class="ident" id="3720651">p</span><span class="op" id="3720652">.</span><span class="ident" id="3720653">expect</span><span class="op" id="3720659">(</span><span class="ident" id="3720660">token</span><span class="op" id="3720665">.</span><span class="ident" id="3720666">ARROW</span><span class="op" id="3720671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720675">p</span><span class="op" id="3720676">.</span><span class="ident" id="3720677">expect</span><span class="op" id="3720683">(</span><span class="ident" id="3720684">token</span><span class="op" id="3720689">.</span><span class="ident" id="3720690">CHAN</span><span class="op" id="3720694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720698">dir</span>&nbsp;<span class="op" id="3720702">=</span>&nbsp;<span class="ident" id="3720704">ast</span><span class="op" id="3720707">.</span><span class="ident" id="3720708">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3720714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3720717">value</span>&nbsp;<span class="op" id="3720723">:=</span>&nbsp;<span class="ident" id="3720726">p</span><span class="op" id="3720727">.</span><span class="ident" id="3720728">parseType</span><span class="op" id="3720737">(</span><span class="op" id="3720738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720742">return</span>&nbsp;<span class="op" id="3720749">&amp;</span><span class="ident" id="3720750">ast</span><span class="op" id="3720753">.</span><span class="ident" id="3720754">ChanType</span><span class="op" id="3720762">{</span><span class="ident" id="3720763">Begin</span><span class="op" id="3720768">:</span>&nbsp;<span class="ident" id="3720770">pos</span><span class="op" id="3720773">,</span>&nbsp;<span class="ident" id="3720775">Arrow</span><span class="op" id="3720780">:</span>&nbsp;<span class="ident" id="3720782">arrow</span><span class="op" id="3720787">,</span>&nbsp;<span class="ident" id="3720789">Dir</span><span class="op" id="3720792">:</span>&nbsp;<span class="ident" id="3720794">dir</span><span class="op" id="3720797">,</span>&nbsp;<span class="ident" id="3720799">Value</span><span class="op" id="3720804">:</span>&nbsp;<span class="ident" id="3720806">value</span><span class="op" id="3720811">}</span><br>
<span class="lineno"></span><span class="op" id="3720813">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="3720816">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3720871">func</span>&nbsp;<span class="op" id="3720876">(</span><span class="ident" id="3720877">p</span>&nbsp;<span class="op" id="3720879">*</span><span class="ident" id="3720880">parser</span><span class="op" id="3720886">)</span>&nbsp;<span class="ident" id="3720888">tryIdentOrType</span><span class="op" id="3720902">(</span><span class="op" id="3720903">)</span>&nbsp;<span class="ident" id="3720905">ast</span><span class="op" id="3720908">.</span><span class="ident" id="3720909">Expr</span>&nbsp;<span class="op" id="3720914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720917">switch</span>&nbsp;<span class="ident" id="3720924">p</span><span class="op" id="3720925">.</span><span class="ident" id="3720926">tok</span>&nbsp;<span class="op" id="3720930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720933">case</span>&nbsp;<span class="ident" id="3720938">token</span><span class="op" id="3720943">.</span><span class="ident" id="3720944">IDENT</span><span class="op" id="3720949">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720953">return</span>&nbsp;<span class="ident" id="3720960">p</span><span class="op" id="3720961">.</span><span class="ident" id="3720962">parseTypeName</span><span class="op" id="3720975">(</span><span class="op" id="3720976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3720979">case</span>&nbsp;<span class="ident" id="3720984">token</span><span class="op" id="3720989">.</span><span class="ident" id="3720990">LBRACK</span><span class="op" id="3720996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721000">return</span>&nbsp;<span class="ident" id="3721007">p</span><span class="op" id="3721008">.</span><span class="ident" id="3721009">parseArrayType</span><span class="op" id="3721023">(</span><span class="op" id="3721024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721027">case</span>&nbsp;<span class="ident" id="3721032">token</span><span class="op" id="3721037">.</span><span class="ident" id="3721038">STRUCT</span><span class="op" id="3721044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721048">return</span>&nbsp;<span class="ident" id="3721055">p</span><span class="op" id="3721056">.</span><span class="ident" id="3721057">parseStructType</span><span class="op" id="3721072">(</span><span class="op" id="3721073">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721076">case</span>&nbsp;<span class="ident" id="3721081">token</span><span class="op" id="3721086">.</span><span class="ident" id="3721087">MUL</span><span class="op" id="3721090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721094">return</span>&nbsp;<span class="ident" id="3721101">p</span><span class="op" id="3721102">.</span><span class="ident" id="3721103">parsePointerType</span><span class="op" id="3721119">(</span><span class="op" id="3721120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721123">case</span>&nbsp;<span class="ident" id="3721128">token</span><span class="op" id="3721133">.</span><span class="ident" id="3721134">FUNC</span><span class="op" id="3721138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721142">typ</span><span class="op" id="3721145">,</span>&nbsp;<span class="ident" id="3721147">_</span>&nbsp;<span class="op" id="3721149">:=</span>&nbsp;<span class="ident" id="3721152">p</span><span class="op" id="3721153">.</span><span class="ident" id="3721154">parseFuncType</span><span class="op" id="3721167">(</span><span class="op" id="3721168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721172">return</span>&nbsp;<span class="ident" id="3721179">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721184">case</span>&nbsp;<span class="ident" id="3721189">token</span><span class="op" id="3721194">.</span><span class="ident" id="3721195">INTERFACE</span><span class="op" id="3721204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721208">return</span>&nbsp;<span class="ident" id="3721215">p</span><span class="op" id="3721216">.</span><span class="ident" id="3721217">parseInterfaceType</span><span class="op" id="3721235">(</span><span class="op" id="3721236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721239">case</span>&nbsp;<span class="ident" id="3721244">token</span><span class="op" id="3721249">.</span><span class="ident" id="3721250">MAP</span><span class="op" id="3721253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721257">return</span>&nbsp;<span class="ident" id="3721264">p</span><span class="op" id="3721265">.</span><span class="ident" id="3721266">parseMapType</span><span class="op" id="3721278">(</span><span class="op" id="3721279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721282">case</span>&nbsp;<span class="ident" id="3721287">token</span><span class="op" id="3721292">.</span><span class="ident" id="3721293">CHAN</span><span class="op" id="3721297">,</span>&nbsp;<span class="ident" id="3721299">token</span><span class="op" id="3721304">.</span><span class="ident" id="3721305">ARROW</span><span class="op" id="3721310">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721314">return</span>&nbsp;<span class="ident" id="3721321">p</span><span class="op" id="3721322">.</span><span class="ident" id="3721323">parseChanType</span><span class="op" id="3721336">(</span><span class="op" id="3721337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721340">case</span>&nbsp;<span class="ident" id="3721345">token</span><span class="op" id="3721350">.</span><span class="ident" id="3721351">LPAREN</span><span class="op" id="3721357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721361">lparen</span>&nbsp;<span class="op" id="3721368">:=</span>&nbsp;<span class="ident" id="3721371">p</span><span class="op" id="3721372">.</span><span class="ident" id="3721373">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721379">p</span><span class="op" id="3721380">.</span><span class="ident" id="3721381">next</span><span class="op" id="3721385">(</span><span class="op" id="3721386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721390">typ</span>&nbsp;<span class="op" id="3721394">:=</span>&nbsp;<span class="ident" id="3721397">p</span><span class="op" id="3721398">.</span><span class="ident" id="3721399">parseType</span><span class="op" id="3721408">(</span><span class="op" id="3721409">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721413">rparen</span>&nbsp;<span class="op" id="3721420">:=</span>&nbsp;<span class="ident" id="3721423">p</span><span class="op" id="3721424">.</span><span class="ident" id="3721425">expect</span><span class="op" id="3721431">(</span><span class="ident" id="3721432">token</span><span class="op" id="3721437">.</span><span class="ident" id="3721438">RPAREN</span><span class="op" id="3721444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721448">return</span>&nbsp;<span class="op" id="3721455">&amp;</span><span class="ident" id="3721456">ast</span><span class="op" id="3721459">.</span><span class="ident" id="3721460">ParenExpr</span><span class="op" id="3721469">{</span><span class="ident" id="3721470">Lparen</span><span class="op" id="3721476">:</span>&nbsp;<span class="ident" id="3721478">lparen</span><span class="op" id="3721484">,</span>&nbsp;<span class="ident" id="3721486">X</span><span class="op" id="3721487">:</span>&nbsp;<span class="ident" id="3721489">typ</span><span class="op" id="3721492">,</span>&nbsp;<span class="ident" id="3721494">Rparen</span><span class="op" id="3721500">:</span>&nbsp;<span class="ident" id="3721502">rparen</span><span class="op" id="3721508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3721511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3721515">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721533">return</span>&nbsp;<span class="builtintype" id="3721540">nil</span><br>
<span class="lineno"></span><span class="op" id="3721544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3721547">func</span>&nbsp;<span class="op" id="3721552">(</span><span class="ident" id="3721553">p</span>&nbsp;<span class="op" id="3721555">*</span><span class="ident" id="3721556">parser</span><span class="op" id="3721562">)</span>&nbsp;<span class="ident" id="3721564">tryType</span><span class="op" id="3721571">(</span><span class="op" id="3721572">)</span>&nbsp;<span class="ident" id="3721574">ast</span><span class="op" id="3721577">.</span><span class="ident" id="3721578">Expr</span>&nbsp;<span class="op" id="3721583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721586">typ</span>&nbsp;<span class="op" id="3721590">:=</span>&nbsp;<span class="ident" id="3721593">p</span><span class="op" id="3721594">.</span><span class="ident" id="3721595">tryIdentOrType</span><span class="op" id="3721609">(</span><span class="op" id="3721610">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721613">if</span>&nbsp;<span class="ident" id="3721616">typ</span>&nbsp;<span class="op" id="3721620">!=</span>&nbsp;<span class="builtintype" id="3721623">nil</span>&nbsp;<span class="op" id="3721627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721631">p</span><span class="op" id="3721632">.</span><span class="ident" id="3721633">resolve</span><span class="op" id="3721640">(</span><span class="ident" id="3721641">typ</span><span class="op" id="3721644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3721647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721650">return</span>&nbsp;<span class="ident" id="3721657">typ</span><br>
<span class="lineno"></span><span class="op" id="3721661">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="3721664">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3721744">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3721755">func</span>&nbsp;<span class="op" id="3721760">(</span><span class="ident" id="3721761">p</span>&nbsp;<span class="op" id="3721763">*</span><span class="ident" id="3721764">parser</span><span class="op" id="3721770">)</span>&nbsp;<span class="ident" id="3721772">parseStmtList</span><span class="op" id="3721785">(</span><span class="op" id="3721786">)</span>&nbsp;<span class="op" id="3721788">(</span><span class="ident" id="3721789">list</span>&nbsp;<span class="op" id="3721794">[</span><span class="op" id="3721795">]</span><span class="ident" id="3721796">ast</span><span class="op" id="3721799">.</span><span class="ident" id="3721800">Stmt</span><span class="op" id="3721804">)</span>&nbsp;<span class="op" id="3721806">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721809">if</span>&nbsp;<span class="ident" id="3721812">p</span><span class="op" id="3721813">.</span><span class="ident" id="3721814">trace</span>&nbsp;<span class="op" id="3721820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721824">defer</span>&nbsp;<span class="ident" id="3721830">un</span><span class="op" id="3721832">(</span><span class="ident" id="3721833">trace</span><span class="op" id="3721838">(</span><span class="ident" id="3721839">p</span><span class="op" id="3721840">,</span>&nbsp;<span class="string" id="3721842">&#34;StatementList&#34;</span><span class="op" id="3721857">)</span><span class="op" id="3721858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3721861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3721865">for</span>&nbsp;<span class="ident" id="3721869">p</span><span class="op" id="3721870">.</span><span class="ident" id="3721871">tok</span>&nbsp;<span class="op" id="3721875">!=</span>&nbsp;<span class="ident" id="3721878">token</span><span class="op" id="3721883">.</span><span class="ident" id="3721884">CASE</span>&nbsp;<span class="op" id="3721889">&amp;&amp;</span>&nbsp;<span class="ident" id="3721892">p</span><span class="op" id="3721893">.</span><span class="ident" id="3721894">tok</span>&nbsp;<span class="op" id="3721898">!=</span>&nbsp;<span class="ident" id="3721901">token</span><span class="op" id="3721906">.</span><span class="ident" id="3721907">DEFAULT</span>&nbsp;<span class="op" id="3721915">&amp;&amp;</span>&nbsp;<span class="ident" id="3721918">p</span><span class="op" id="3721919">.</span><span class="ident" id="3721920">tok</span>&nbsp;<span class="op" id="3721924">!=</span>&nbsp;<span class="ident" id="3721927">token</span><span class="op" id="3721932">.</span><span class="ident" id="3721933">RBRACE</span>&nbsp;<span class="op" id="3721940">&amp;&amp;</span>&nbsp;<span class="ident" id="3721943">p</span><span class="op" id="3721944">.</span><span class="ident" id="3721945">tok</span>&nbsp;<span class="op" id="3721949">!=</span>&nbsp;<span class="ident" id="3721952">token</span><span class="op" id="3721957">.</span><span class="ident" id="3721958">EOF</span>&nbsp;<span class="op" id="3721962">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3721966">list</span>&nbsp;<span class="op" id="3721971">=</span>&nbsp;<span class="builtinfunc" id="3721973">append</span><span class="op" id="3721979">(</span><span class="ident" id="3721980">list</span><span class="op" id="3721984">,</span>&nbsp;<span class="ident" id="3721986">p</span><span class="op" id="3721987">.</span><span class="ident" id="3721988">parseStmt</span><span class="op" id="3721997">(</span><span class="op" id="3721998">)</span><span class="op" id="3721999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3722002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722006">return</span><br>
<span class="lineno"></span><span class="op" id="3722013">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="3722016">func</span>&nbsp;<span class="op" id="3722021">(</span><span class="ident" id="3722022">p</span>&nbsp;<span class="op" id="3722024">*</span><span class="ident" id="3722025">parser</span><span class="op" id="3722031">)</span>&nbsp;<span class="ident" id="3722033">parseBody</span><span class="op" id="3722042">(</span><span class="ident" id="3722043">scope</span>&nbsp;<span class="op" id="3722049">*</span><span class="ident" id="3722050">ast</span><span class="op" id="3722053">.</span><span class="ident" id="3722054">Scope</span><span class="op" id="3722059">)</span>&nbsp;<span class="op" id="3722061">*</span><span class="ident" id="3722062">ast</span><span class="op" id="3722065">.</span><span class="ident" id="3722066">BlockStmt</span>&nbsp;<span class="op" id="3722076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722079">if</span>&nbsp;<span class="ident" id="3722082">p</span><span class="op" id="3722083">.</span><span class="ident" id="3722084">trace</span>&nbsp;<span class="op" id="3722090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722094">defer</span>&nbsp;<span class="ident" id="3722100">un</span><span class="op" id="3722102">(</span><span class="ident" id="3722103">trace</span><span class="op" id="3722108">(</span><span class="ident" id="3722109">p</span><span class="op" id="3722110">,</span>&nbsp;<span class="string" id="3722112">&#34;Body&#34;</span><span class="op" id="3722118">)</span><span class="op" id="3722119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3722122">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722126">lbrace</span>&nbsp;<span class="op" id="3722133">:=</span>&nbsp;<span class="ident" id="3722136">p</span><span class="op" id="3722137">.</span><span class="ident" id="3722138">expect</span><span class="op" id="3722144">(</span><span class="ident" id="3722145">token</span><span class="op" id="3722150">.</span><span class="ident" id="3722151">LBRACE</span><span class="op" id="3722157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722160">p</span><span class="op" id="3722161">.</span><span class="ident" id="3722162">topScope</span>&nbsp;<span class="op" id="3722171">=</span>&nbsp;<span class="ident" id="3722173">scope</span>&nbsp;<span class="comment" id="3722179">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722203">p</span><span class="op" id="3722204">.</span><span class="ident" id="3722205">openLabelScope</span><span class="op" id="3722219">(</span><span class="op" id="3722220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722223">list</span>&nbsp;<span class="op" id="3722228">:=</span>&nbsp;<span class="ident" id="3722231">p</span><span class="op" id="3722232">.</span><span class="ident" id="3722233">parseStmtList</span><span class="op" id="3722246">(</span><span class="op" id="3722247">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722250">p</span><span class="op" id="3722251">.</span><span class="ident" id="3722252">closeLabelScope</span><span class="op" id="3722267">(</span><span class="op" id="3722268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722271">p</span><span class="op" id="3722272">.</span><span class="ident" id="3722273">closeScope</span><span class="op" id="3722283">(</span><span class="op" id="3722284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722287">rbrace</span>&nbsp;<span class="op" id="3722294">:=</span>&nbsp;<span class="ident" id="3722297">p</span><span class="op" id="3722298">.</span><span class="ident" id="3722299">expect</span><span class="op" id="3722305">(</span><span class="ident" id="3722306">token</span><span class="op" id="3722311">.</span><span class="ident" id="3722312">RBRACE</span><span class="op" id="3722318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722322">return</span>&nbsp;<span class="op" id="3722329">&amp;</span><span class="ident" id="3722330">ast</span><span class="op" id="3722333">.</span><span class="ident" id="3722334">BlockStmt</span><span class="op" id="3722343">{</span><span class="ident" id="3722344">Lbrace</span><span class="op" id="3722350">:</span>&nbsp;<span class="ident" id="3722352">lbrace</span><span class="op" id="3722358">,</span>&nbsp;<span class="ident" id="3722360">List</span><span class="op" id="3722364">:</span>&nbsp;<span class="ident" id="3722366">list</span><span class="op" id="3722370">,</span>&nbsp;<span class="ident" id="3722372">Rbrace</span><span class="op" id="3722378">:</span>&nbsp;<span class="ident" id="3722380">rbrace</span><span class="op" id="3722386">}</span><br>
<span class="lineno">1075</span><span class="op" id="3722388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3722391">func</span>&nbsp;<span class="op" id="3722396">(</span><span class="ident" id="3722397">p</span>&nbsp;<span class="op" id="3722399">*</span><span class="ident" id="3722400">parser</span><span class="op" id="3722406">)</span>&nbsp;<span class="ident" id="3722408">parseBlockStmt</span><span class="op" id="3722422">(</span><span class="op" id="3722423">)</span>&nbsp;<span class="op" id="3722425">*</span><span class="ident" id="3722426">ast</span><span class="op" id="3722429">.</span><span class="ident" id="3722430">BlockStmt</span>&nbsp;<span class="op" id="3722440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722443">if</span>&nbsp;<span class="ident" id="3722446">p</span><span class="op" id="3722447">.</span><span class="ident" id="3722448">trace</span>&nbsp;<span class="op" id="3722454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722458">defer</span>&nbsp;<span class="ident" id="3722464">un</span><span class="op" id="3722466">(</span><span class="ident" id="3722467">trace</span><span class="op" id="3722472">(</span><span class="ident" id="3722473">p</span><span class="op" id="3722474">,</span>&nbsp;<span class="string" id="3722476">&#34;BlockStmt&#34;</span><span class="op" id="3722487">)</span><span class="op" id="3722488">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3722491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722495">lbrace</span>&nbsp;<span class="op" id="3722502">:=</span>&nbsp;<span class="ident" id="3722505">p</span><span class="op" id="3722506">.</span><span class="ident" id="3722507">expect</span><span class="op" id="3722513">(</span><span class="ident" id="3722514">token</span><span class="op" id="3722519">.</span><span class="ident" id="3722520">LBRACE</span><span class="op" id="3722526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722529">p</span><span class="op" id="3722530">.</span><span class="ident" id="3722531">openScope</span><span class="op" id="3722540">(</span><span class="op" id="3722541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722544">list</span>&nbsp;<span class="op" id="3722549">:=</span>&nbsp;<span class="ident" id="3722552">p</span><span class="op" id="3722553">.</span><span class="ident" id="3722554">parseStmtList</span><span class="op" id="3722567">(</span><span class="op" id="3722568">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722571">p</span><span class="op" id="3722572">.</span><span class="ident" id="3722573">closeScope</span><span class="op" id="3722583">(</span><span class="op" id="3722584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722587">rbrace</span>&nbsp;<span class="op" id="3722594">:=</span>&nbsp;<span class="ident" id="3722597">p</span><span class="op" id="3722598">.</span><span class="ident" id="3722599">expect</span><span class="op" id="3722605">(</span><span class="ident" id="3722606">token</span><span class="op" id="3722611">.</span><span class="ident" id="3722612">RBRACE</span><span class="op" id="3722618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722622">return</span>&nbsp;<span class="op" id="3722629">&amp;</span><span class="ident" id="3722630">ast</span><span class="op" id="3722633">.</span><span class="ident" id="3722634">BlockStmt</span><span class="op" id="3722643">{</span><span class="ident" id="3722644">Lbrace</span><span class="op" id="3722650">:</span>&nbsp;<span class="ident" id="3722652">lbrace</span><span class="op" id="3722658">,</span>&nbsp;<span class="ident" id="3722660">List</span><span class="op" id="3722664">:</span>&nbsp;<span class="ident" id="3722666">list</span><span class="op" id="3722670">,</span>&nbsp;<span class="ident" id="3722672">Rbrace</span><span class="op" id="3722678">:</span>&nbsp;<span class="ident" id="3722680">rbrace</span><span class="op" id="3722686">}</span><br>
<span class="lineno"></span><span class="op" id="3722688">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="3722691">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3722771">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3722787">func</span>&nbsp;<span class="op" id="3722792">(</span><span class="ident" id="3722793">p</span>&nbsp;<span class="op" id="3722795">*</span><span class="ident" id="3722796">parser</span><span class="op" id="3722802">)</span>&nbsp;<span class="ident" id="3722804">parseFuncTypeOrLit</span><span class="op" id="3722822">(</span><span class="op" id="3722823">)</span>&nbsp;<span class="ident" id="3722825">ast</span><span class="op" id="3722828">.</span><span class="ident" id="3722829">Expr</span>&nbsp;<span class="op" id="3722834">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722837">if</span>&nbsp;<span class="ident" id="3722840">p</span><span class="op" id="3722841">.</span><span class="ident" id="3722842">trace</span>&nbsp;<span class="op" id="3722848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722852">defer</span>&nbsp;<span class="ident" id="3722858">un</span><span class="op" id="3722860">(</span><span class="ident" id="3722861">trace</span><span class="op" id="3722866">(</span><span class="ident" id="3722867">p</span><span class="op" id="3722868">,</span>&nbsp;<span class="string" id="3722870">&#34;FuncTypeOrLit&#34;</span><span class="op" id="3722885">)</span><span class="op" id="3722886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3722889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722893">typ</span><span class="op" id="3722896">,</span>&nbsp;<span class="ident" id="3722898">scope</span>&nbsp;<span class="op" id="3722904">:=</span>&nbsp;<span class="ident" id="3722907">p</span><span class="op" id="3722908">.</span><span class="ident" id="3722909">parseFuncType</span><span class="op" id="3722922">(</span><span class="op" id="3722923">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722926">if</span>&nbsp;<span class="ident" id="3722929">p</span><span class="op" id="3722930">.</span><span class="ident" id="3722931">tok</span>&nbsp;<span class="op" id="3722935">!=</span>&nbsp;<span class="ident" id="3722938">token</span><span class="op" id="3722943">.</span><span class="ident" id="3722944">LBRACE</span>&nbsp;<span class="op" id="3722951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3722955">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3722979">return</span>&nbsp;<span class="ident" id="3722986">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3722991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3722995">p</span><span class="op" id="3722996">.</span><span class="ident" id="3722997">exprLev</span><span class="op" id="3723004">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723008">body</span>&nbsp;<span class="op" id="3723013">:=</span>&nbsp;<span class="ident" id="3723016">p</span><span class="op" id="3723017">.</span><span class="ident" id="3723018">parseBody</span><span class="op" id="3723027">(</span><span class="ident" id="3723028">scope</span><span class="op" id="3723033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723036">p</span><span class="op" id="3723037">.</span><span class="ident" id="3723038">exprLev</span><span class="op" id="3723045">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723050">return</span>&nbsp;<span class="op" id="3723057">&amp;</span><span class="ident" id="3723058">ast</span><span class="op" id="3723061">.</span><span class="ident" id="3723062">FuncLit</span><span class="op" id="3723069">{</span><span class="ident" id="3723070">Type</span><span class="op" id="3723074">:</span>&nbsp;<span class="ident" id="3723076">typ</span><span class="op" id="3723079">,</span>&nbsp;<span class="ident" id="3723081">Body</span><span class="op" id="3723085">:</span>&nbsp;<span class="ident" id="3723087">body</span><span class="op" id="3723091">}</span><br>
<span class="lineno">1110</span><span class="op" id="3723093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3723096">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="3723164">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="3723225">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="3723295">//</span><br>
<span class="lineno"></span><span class="keyword" id="3723298">func</span>&nbsp;<span class="op" id="3723303">(</span><span class="ident" id="3723304">p</span>&nbsp;<span class="op" id="3723306">*</span><span class="ident" id="3723307">parser</span><span class="op" id="3723313">)</span>&nbsp;<span class="ident" id="3723315">parseOperand</span><span class="op" id="3723327">(</span><span class="ident" id="3723328">lhs</span>&nbsp;<span class="builtintype" id="3723332">bool</span><span class="op" id="3723336">)</span>&nbsp;<span class="ident" id="3723338">ast</span><span class="op" id="3723341">.</span><span class="ident" id="3723342">Expr</span>&nbsp;<span class="op" id="3723347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723350">if</span>&nbsp;<span class="ident" id="3723353">p</span><span class="op" id="3723354">.</span><span class="ident" id="3723355">trace</span>&nbsp;<span class="op" id="3723361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723365">defer</span>&nbsp;<span class="ident" id="3723371">un</span><span class="op" id="3723373">(</span><span class="ident" id="3723374">trace</span><span class="op" id="3723379">(</span><span class="ident" id="3723380">p</span><span class="op" id="3723381">,</span>&nbsp;<span class="string" id="3723383">&#34;Operand&#34;</span><span class="op" id="3723392">)</span><span class="op" id="3723393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3723396">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723400">switch</span>&nbsp;<span class="ident" id="3723407">p</span><span class="op" id="3723408">.</span><span class="ident" id="3723409">tok</span>&nbsp;<span class="op" id="3723413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723416">case</span>&nbsp;<span class="ident" id="3723421">token</span><span class="op" id="3723426">.</span><span class="ident" id="3723427">IDENT</span><span class="op" id="3723432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723436">x</span>&nbsp;<span class="op" id="3723438">:=</span>&nbsp;<span class="ident" id="3723441">p</span><span class="op" id="3723442">.</span><span class="ident" id="3723443">parseIdent</span><span class="op" id="3723453">(</span><span class="op" id="3723454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723458">if</span>&nbsp;<span class="op" id="3723461">!</span><span class="ident" id="3723462">lhs</span>&nbsp;<span class="op" id="3723466">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723471">p</span><span class="op" id="3723472">.</span><span class="ident" id="3723473">resolve</span><span class="op" id="3723480">(</span><span class="ident" id="3723481">x</span><span class="op" id="3723482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3723486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723490">return</span>&nbsp;<span class="ident" id="3723497">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723501">case</span>&nbsp;<span class="ident" id="3723506">token</span><span class="op" id="3723511">.</span><span class="ident" id="3723512">INT</span><span class="op" id="3723515">,</span>&nbsp;<span class="ident" id="3723517">token</span><span class="op" id="3723522">.</span><span class="ident" id="3723523">FLOAT</span><span class="op" id="3723528">,</span>&nbsp;<span class="ident" id="3723530">token</span><span class="op" id="3723535">.</span><span class="ident" id="3723536">IMAG</span><span class="op" id="3723540">,</span>&nbsp;<span class="ident" id="3723542">token</span><span class="op" id="3723547">.</span><span class="ident" id="3723548">CHAR</span><span class="op" id="3723552">,</span>&nbsp;<span class="ident" id="3723554">token</span><span class="op" id="3723559">.</span><span class="ident" id="3723560">STRING</span><span class="op" id="3723566">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723570">x</span>&nbsp;<span class="op" id="3723572">:=</span>&nbsp;<span class="op" id="3723575">&amp;</span><span class="ident" id="3723576">ast</span><span class="op" id="3723579">.</span><span class="ident" id="3723580">BasicLit</span><span class="op" id="3723588">{</span><span class="ident" id="3723589">ValuePos</span><span class="op" id="3723597">:</span>&nbsp;<span class="ident" id="3723599">p</span><span class="op" id="3723600">.</span><span class="ident" id="3723601">pos</span><span class="op" id="3723604">,</span>&nbsp;<span class="ident" id="3723606">Kind</span><span class="op" id="3723610">:</span>&nbsp;<span class="ident" id="3723612">p</span><span class="op" id="3723613">.</span><span class="ident" id="3723614">tok</span><span class="op" id="3723617">,</span>&nbsp;<span class="ident" id="3723619">Value</span><span class="op" id="3723624">:</span>&nbsp;<span class="ident" id="3723626">p</span><span class="op" id="3723627">.</span><span class="ident" id="3723628">lit</span><span class="op" id="3723631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723635">p</span><span class="op" id="3723636">.</span><span class="ident" id="3723637">next</span><span class="op" id="3723641">(</span><span class="op" id="3723642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723646">return</span>&nbsp;<span class="ident" id="3723653">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723657">case</span>&nbsp;<span class="ident" id="3723662">token</span><span class="op" id="3723667">.</span><span class="ident" id="3723668">LPAREN</span><span class="op" id="3723674">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723678">lparen</span>&nbsp;<span class="op" id="3723685">:=</span>&nbsp;<span class="ident" id="3723688">p</span><span class="op" id="3723689">.</span><span class="ident" id="3723690">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723696">p</span><span class="op" id="3723697">.</span><span class="ident" id="3723698">next</span><span class="op" id="3723702">(</span><span class="op" id="3723703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723707">p</span><span class="op" id="3723708">.</span><span class="ident" id="3723709">exprLev</span><span class="op" id="3723716">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723721">x</span>&nbsp;<span class="op" id="3723723">:=</span>&nbsp;<span class="ident" id="3723726">p</span><span class="op" id="3723727">.</span><span class="ident" id="3723728">parseRhsOrType</span><span class="op" id="3723742">(</span><span class="op" id="3723743">)</span>&nbsp;<span class="comment" id="3723745">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723790">p</span><span class="op" id="3723791">.</span><span class="ident" id="3723792">exprLev</span><span class="op" id="3723799">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723804">rparen</span>&nbsp;<span class="op" id="3723811">:=</span>&nbsp;<span class="ident" id="3723814">p</span><span class="op" id="3723815">.</span><span class="ident" id="3723816">expect</span><span class="op" id="3723822">(</span><span class="ident" id="3723823">token</span><span class="op" id="3723828">.</span><span class="ident" id="3723829">RPAREN</span><span class="op" id="3723835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723839">return</span>&nbsp;<span class="op" id="3723846">&amp;</span><span class="ident" id="3723847">ast</span><span class="op" id="3723850">.</span><span class="ident" id="3723851">ParenExpr</span><span class="op" id="3723860">{</span><span class="ident" id="3723861">Lparen</span><span class="op" id="3723867">:</span>&nbsp;<span class="ident" id="3723869">lparen</span><span class="op" id="3723875">,</span>&nbsp;<span class="ident" id="3723877">X</span><span class="op" id="3723878">:</span>&nbsp;<span class="ident" id="3723880">x</span><span class="op" id="3723881">,</span>&nbsp;<span class="ident" id="3723883">Rparen</span><span class="op" id="3723889">:</span>&nbsp;<span class="ident" id="3723891">rparen</span><span class="op" id="3723897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723901">case</span>&nbsp;<span class="ident" id="3723906">token</span><span class="op" id="3723911">.</span><span class="ident" id="3723912">FUNC</span><span class="op" id="3723916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723920">return</span>&nbsp;<span class="ident" id="3723927">p</span><span class="op" id="3723928">.</span><span class="ident" id="3723929">parseFuncTypeOrLit</span><span class="op" id="3723947">(</span><span class="op" id="3723948">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3723951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3723955">if</span>&nbsp;<span class="ident" id="3723958">typ</span>&nbsp;<span class="op" id="3723962">:=</span>&nbsp;<span class="ident" id="3723965">p</span><span class="op" id="3723966">.</span><span class="ident" id="3723967">tryIdentOrType</span><span class="op" id="3723981">(</span><span class="op" id="3723982">)</span><span class="op" id="3723983">;</span>&nbsp;<span class="ident" id="3723985">typ</span>&nbsp;<span class="op" id="3723989">!=</span>&nbsp;<span class="builtintype" id="3723992">nil</span>&nbsp;<span class="op" id="3723996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3724000">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724055">_</span><span class="op" id="3724056">,</span>&nbsp;<span class="ident" id="3724058">isIdent</span>&nbsp;<span class="op" id="3724066">:=</span>&nbsp;<span class="ident" id="3724069">typ</span><span class="op" id="3724072">.</span><span class="op" id="3724073">(</span><span class="op" id="3724074">*</span><span class="ident" id="3724075">ast</span><span class="op" id="3724078">.</span><span class="ident" id="3724079">Ident</span><span class="op" id="3724084">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724088">assert</span><span class="op" id="3724094">(</span><span class="op" id="3724095">!</span><span class="ident" id="3724096">isIdent</span><span class="op" id="3724103">,</span>&nbsp;<span class="string" id="3724105">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="3724132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724136">return</span>&nbsp;<span class="ident" id="3724143">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3724148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3724152">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724173">pos</span>&nbsp;<span class="op" id="3724177">:=</span>&nbsp;<span class="ident" id="3724180">p</span><span class="op" id="3724181">.</span><span class="ident" id="3724182">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724187">p</span><span class="op" id="3724188">.</span><span class="ident" id="3724189">errorExpected</span><span class="op" id="3724202">(</span><span class="ident" id="3724203">pos</span><span class="op" id="3724206">,</span>&nbsp;<span class="string" id="3724208">&#34;operand&#34;</span><span class="op" id="3724217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724220">syncStmt</span><span class="op" id="3724228">(</span><span class="ident" id="3724229">p</span><span class="op" id="3724230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724233">return</span>&nbsp;<span class="op" id="3724240">&amp;</span><span class="ident" id="3724241">ast</span><span class="op" id="3724244">.</span><span class="ident" id="3724245">BadExpr</span><span class="op" id="3724252">{</span><span class="ident" id="3724253">From</span><span class="op" id="3724257">:</span>&nbsp;<span class="ident" id="3724259">pos</span><span class="op" id="3724262">,</span>&nbsp;<span class="ident" id="3724264">To</span><span class="op" id="3724266">:</span>&nbsp;<span class="ident" id="3724268">p</span><span class="op" id="3724269">.</span><span class="ident" id="3724270">pos</span><span class="op" id="3724273">}</span><br>
<span class="lineno"></span><span class="op" id="3724275">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="3724278">func</span>&nbsp;<span class="op" id="3724283">(</span><span class="ident" id="3724284">p</span>&nbsp;<span class="op" id="3724286">*</span><span class="ident" id="3724287">parser</span><span class="op" id="3724293">)</span>&nbsp;<span class="ident" id="3724295">parseSelector</span><span class="op" id="3724308">(</span><span class="ident" id="3724309">x</span>&nbsp;<span class="ident" id="3724311">ast</span><span class="op" id="3724314">.</span><span class="ident" id="3724315">Expr</span><span class="op" id="3724319">)</span>&nbsp;<span class="ident" id="3724321">ast</span><span class="op" id="3724324">.</span><span class="ident" id="3724325">Expr</span>&nbsp;<span class="op" id="3724330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724333">if</span>&nbsp;<span class="ident" id="3724336">p</span><span class="op" id="3724337">.</span><span class="ident" id="3724338">trace</span>&nbsp;<span class="op" id="3724344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724348">defer</span>&nbsp;<span class="ident" id="3724354">un</span><span class="op" id="3724356">(</span><span class="ident" id="3724357">trace</span><span class="op" id="3724362">(</span><span class="ident" id="3724363">p</span><span class="op" id="3724364">,</span>&nbsp;<span class="string" id="3724366">&#34;Selector&#34;</span><span class="op" id="3724376">)</span><span class="op" id="3724377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3724380">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724384">sel</span>&nbsp;<span class="op" id="3724388">:=</span>&nbsp;<span class="ident" id="3724391">p</span><span class="op" id="3724392">.</span><span class="ident" id="3724393">parseIdent</span><span class="op" id="3724403">(</span><span class="op" id="3724404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724408">return</span>&nbsp;<span class="op" id="3724415">&amp;</span><span class="ident" id="3724416">ast</span><span class="op" id="3724419">.</span><span class="ident" id="3724420">SelectorExpr</span><span class="op" id="3724432">{</span><span class="ident" id="3724433">X</span><span class="op" id="3724434">:</span>&nbsp;<span class="ident" id="3724436">x</span><span class="op" id="3724437">,</span>&nbsp;<span class="ident" id="3724439">Sel</span><span class="op" id="3724442">:</span>&nbsp;<span class="ident" id="3724444">sel</span><span class="op" id="3724447">}</span><br>
<span class="lineno"></span><span class="op" id="3724449">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="3724452">func</span>&nbsp;<span class="op" id="3724457">(</span><span class="ident" id="3724458">p</span>&nbsp;<span class="op" id="3724460">*</span><span class="ident" id="3724461">parser</span><span class="op" id="3724467">)</span>&nbsp;<span class="ident" id="3724469">parseTypeAssertion</span><span class="op" id="3724487">(</span><span class="ident" id="3724488">x</span>&nbsp;<span class="ident" id="3724490">ast</span><span class="op" id="3724493">.</span><span class="ident" id="3724494">Expr</span><span class="op" id="3724498">)</span>&nbsp;<span class="ident" id="3724500">ast</span><span class="op" id="3724503">.</span><span class="ident" id="3724504">Expr</span>&nbsp;<span class="op" id="3724509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724512">if</span>&nbsp;<span class="ident" id="3724515">p</span><span class="op" id="3724516">.</span><span class="ident" id="3724517">trace</span>&nbsp;<span class="op" id="3724523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724527">defer</span>&nbsp;<span class="ident" id="3724533">un</span><span class="op" id="3724535">(</span><span class="ident" id="3724536">trace</span><span class="op" id="3724541">(</span><span class="ident" id="3724542">p</span><span class="op" id="3724543">,</span>&nbsp;<span class="string" id="3724545">&#34;TypeAssertion&#34;</span><span class="op" id="3724560">)</span><span class="op" id="3724561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3724564">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724568">lparen</span>&nbsp;<span class="op" id="3724575">:=</span>&nbsp;<span class="ident" id="3724578">p</span><span class="op" id="3724579">.</span><span class="ident" id="3724580">expect</span><span class="op" id="3724586">(</span><span class="ident" id="3724587">token</span><span class="op" id="3724592">.</span><span class="ident" id="3724593">LPAREN</span><span class="op" id="3724599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724602">var</span>&nbsp;<span class="ident" id="3724606">typ</span>&nbsp;<span class="ident" id="3724610">ast</span><span class="op" id="3724613">.</span><span class="ident" id="3724614">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724620">if</span>&nbsp;<span class="ident" id="3724623">p</span><span class="op" id="3724624">.</span><span class="ident" id="3724625">tok</span>&nbsp;<span class="op" id="3724629">==</span>&nbsp;<span class="ident" id="3724632">token</span><span class="op" id="3724637">.</span><span class="ident" id="3724638">TYPE</span>&nbsp;<span class="op" id="3724643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3724647">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724676">p</span><span class="op" id="3724677">.</span><span class="ident" id="3724678">next</span><span class="op" id="3724682">(</span><span class="op" id="3724683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3724686">}</span>&nbsp;<span class="keyword" id="3724688">else</span>&nbsp;<span class="op" id="3724693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724697">typ</span>&nbsp;<span class="op" id="3724701">=</span>&nbsp;<span class="ident" id="3724703">p</span><span class="op" id="3724704">.</span><span class="ident" id="3724705">parseType</span><span class="op" id="3724714">(</span><span class="op" id="3724715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3724718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3724721">rparen</span>&nbsp;<span class="op" id="3724728">:=</span>&nbsp;<span class="ident" id="3724731">p</span><span class="op" id="3724732">.</span><span class="ident" id="3724733">expect</span><span class="op" id="3724739">(</span><span class="ident" id="3724740">token</span><span class="op" id="3724745">.</span><span class="ident" id="3724746">RPAREN</span><span class="op" id="3724752">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724756">return</span>&nbsp;<span class="op" id="3724763">&amp;</span><span class="ident" id="3724764">ast</span><span class="op" id="3724767">.</span><span class="ident" id="3724768">TypeAssertExpr</span><span class="op" id="3724782">{</span><span class="ident" id="3724783">X</span><span class="op" id="3724784">:</span>&nbsp;<span class="ident" id="3724786">x</span><span class="op" id="3724787">,</span>&nbsp;<span class="ident" id="3724789">Type</span><span class="op" id="3724793">:</span>&nbsp;<span class="ident" id="3724795">typ</span><span class="op" id="3724798">,</span>&nbsp;<span class="ident" id="3724800">Lparen</span><span class="op" id="3724806">:</span>&nbsp;<span class="ident" id="3724808">lparen</span><span class="op" id="3724814">,</span>&nbsp;<span class="ident" id="3724816">Rparen</span><span class="op" id="3724822">:</span>&nbsp;<span class="ident" id="3724824">rparen</span><span class="op" id="3724830">}</span><br>
<span class="lineno"></span><span class="op" id="3724832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3724835">func</span>&nbsp;<span class="op" id="3724840">(</span><span class="ident" id="3724841">p</span>&nbsp;<span class="op" id="3724843">*</span><span class="ident" id="3724844">parser</span><span class="op" id="3724850">)</span>&nbsp;<span class="ident" id="3724852">parseIndexOrSlice</span><span class="op" id="3724869">(</span><span class="ident" id="3724870">x</span>&nbsp;<span class="ident" id="3724872">ast</span><span class="op" id="3724875">.</span><span class="ident" id="3724876">Expr</span><span class="op" id="3724880">)</span>&nbsp;<span class="ident" id="3724882">ast</span><span class="op" id="3724885">.</span><span class="ident" id="3724886">Expr</span>&nbsp;<span class="op" id="3724891">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724894">if</span>&nbsp;<span class="ident" id="3724897">p</span><span class="op" id="3724898">.</span><span class="ident" id="3724899">trace</span>&nbsp;<span class="op" id="3724905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724909">defer</span>&nbsp;<span class="ident" id="3724915">un</span><span class="op" id="3724917">(</span><span class="ident" id="3724918">trace</span><span class="op" id="3724923">(</span><span class="ident" id="3724924">p</span><span class="op" id="3724925">,</span>&nbsp;<span class="string" id="3724927">&#34;IndexOrSlice&#34;</span><span class="op" id="3724941">)</span><span class="op" id="3724942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3724945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3724949">const</span>&nbsp;<span class="ident" id="3724955">N</span>&nbsp;<span class="op" id="3724957">=</span>&nbsp;<span class="num" id="3724959">3</span>&nbsp;<span class="comment" id="3724961">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725009">lbrack</span>&nbsp;<span class="op" id="3725016">:=</span>&nbsp;<span class="ident" id="3725019">p</span><span class="op" id="3725020">.</span><span class="ident" id="3725021">expect</span><span class="op" id="3725027">(</span><span class="ident" id="3725028">token</span><span class="op" id="3725033">.</span><span class="ident" id="3725034">LBRACK</span><span class="op" id="3725040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725043">p</span><span class="op" id="3725044">.</span><span class="ident" id="3725045">exprLev</span><span class="op" id="3725052">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725056">var</span>&nbsp;<span class="ident" id="3725060">index</span>&nbsp;<span class="op" id="3725066">[</span><span class="ident" id="3725067">N</span><span class="op" id="3725068">]</span><span class="ident" id="3725069">ast</span><span class="op" id="3725072">.</span><span class="ident" id="3725073">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725079">var</span>&nbsp;<span class="ident" id="3725083">colons</span>&nbsp;<span class="op" id="3725090">[</span><span class="ident" id="3725091">N</span>&nbsp;<span class="op" id="3725093">-</span>&nbsp;<span class="num" id="3725095">1</span><span class="op" id="3725096">]</span><span class="ident" id="3725097">token</span><span class="op" id="3725102">.</span><span class="ident" id="3725103">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725108">if</span>&nbsp;<span class="ident" id="3725111">p</span><span class="op" id="3725112">.</span><span class="ident" id="3725113">tok</span>&nbsp;<span class="op" id="3725117">!=</span>&nbsp;<span class="ident" id="3725120">token</span><span class="op" id="3725125">.</span><span class="ident" id="3725126">COLON</span>&nbsp;<span class="op" id="3725132">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725136">index</span><span class="op" id="3725141">[</span><span class="num" id="3725142">0</span><span class="op" id="3725143">]</span>&nbsp;<span class="op" id="3725145">=</span>&nbsp;<span class="ident" id="3725147">p</span><span class="op" id="3725148">.</span><span class="ident" id="3725149">parseRhs</span><span class="op" id="3725157">(</span><span class="op" id="3725158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3725161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725164">ncolons</span>&nbsp;<span class="op" id="3725172">:=</span>&nbsp;<span class="num" id="3725175">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725178">for</span>&nbsp;<span class="ident" id="3725182">p</span><span class="op" id="3725183">.</span><span class="ident" id="3725184">tok</span>&nbsp;<span class="op" id="3725188">==</span>&nbsp;<span class="ident" id="3725191">token</span><span class="op" id="3725196">.</span><span class="ident" id="3725197">COLON</span>&nbsp;<span class="op" id="3725203">&amp;&amp;</span>&nbsp;<span class="ident" id="3725206">ncolons</span>&nbsp;<span class="op" id="3725214">&lt;</span>&nbsp;<span class="builtinfunc" id="3725216">len</span><span class="op" id="3725219">(</span><span class="ident" id="3725220">colons</span><span class="op" id="3725226">)</span>&nbsp;<span class="op" id="3725228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725232">colons</span><span class="op" id="3725238">[</span><span class="ident" id="3725239">ncolons</span><span class="op" id="3725246">]</span>&nbsp;<span class="op" id="3725248">=</span>&nbsp;<span class="ident" id="3725250">p</span><span class="op" id="3725251">.</span><span class="ident" id="3725252">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725258">ncolons</span><span class="op" id="3725265">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725270">p</span><span class="op" id="3725271">.</span><span class="ident" id="3725272">next</span><span class="op" id="3725276">(</span><span class="op" id="3725277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725281">if</span>&nbsp;<span class="ident" id="3725284">p</span><span class="op" id="3725285">.</span><span class="ident" id="3725286">tok</span>&nbsp;<span class="op" id="3725290">!=</span>&nbsp;<span class="ident" id="3725293">token</span><span class="op" id="3725298">.</span><span class="ident" id="3725299">COLON</span>&nbsp;<span class="op" id="3725305">&amp;&amp;</span>&nbsp;<span class="ident" id="3725308">p</span><span class="op" id="3725309">.</span><span class="ident" id="3725310">tok</span>&nbsp;<span class="op" id="3725314">!=</span>&nbsp;<span class="ident" id="3725317">token</span><span class="op" id="3725322">.</span><span class="ident" id="3725323">RBRACK</span>&nbsp;<span class="op" id="3725330">&amp;&amp;</span>&nbsp;<span class="ident" id="3725333">p</span><span class="op" id="3725334">.</span><span class="ident" id="3725335">tok</span>&nbsp;<span class="op" id="3725339">!=</span>&nbsp;<span class="ident" id="3725342">token</span><span class="op" id="3725347">.</span><span class="ident" id="3725348">EOF</span>&nbsp;<span class="op" id="3725352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725357">index</span><span class="op" id="3725362">[</span><span class="ident" id="3725363">ncolons</span><span class="op" id="3725370">]</span>&nbsp;<span class="op" id="3725372">=</span>&nbsp;<span class="ident" id="3725374">p</span><span class="op" id="3725375">.</span><span class="ident" id="3725376">parseRhs</span><span class="op" id="3725384">(</span><span class="op" id="3725385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3725389">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3725392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725395">p</span><span class="op" id="3725396">.</span><span class="ident" id="3725397">exprLev</span><span class="op" id="3725404">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725408">rbrack</span>&nbsp;<span class="op" id="3725415">:=</span>&nbsp;<span class="ident" id="3725418">p</span><span class="op" id="3725419">.</span><span class="ident" id="3725420">expect</span><span class="op" id="3725426">(</span><span class="ident" id="3725427">token</span><span class="op" id="3725432">.</span><span class="ident" id="3725433">RBRACK</span><span class="op" id="3725439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725443">if</span>&nbsp;<span class="ident" id="3725446">ncolons</span>&nbsp;<span class="op" id="3725454">&gt;</span>&nbsp;<span class="num" id="3725456">0</span>&nbsp;<span class="op" id="3725458">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3725462">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725484">slice3</span>&nbsp;<span class="op" id="3725491">:=</span>&nbsp;<span class="builtintype" id="3725494">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725502">if</span>&nbsp;<span class="ident" id="3725505">ncolons</span>&nbsp;<span class="op" id="3725513">==</span>&nbsp;<span class="num" id="3725516">2</span>&nbsp;<span class="op" id="3725518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725523">slice3</span>&nbsp;<span class="op" id="3725530">=</span>&nbsp;<span class="builtintype" id="3725532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3725540">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3725620">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725701">if</span>&nbsp;<span class="ident" id="3725704">index</span><span class="op" id="3725709">[</span><span class="num" id="3725710">1</span><span class="op" id="3725711">]</span>&nbsp;<span class="op" id="3725713">==</span>&nbsp;<span class="builtintype" id="3725716">nil</span>&nbsp;<span class="op" id="3725720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725726">p</span><span class="op" id="3725727">.</span><span class="builtintype" id="3725728">error</span><span class="op" id="3725733">(</span><span class="ident" id="3725734">colons</span><span class="op" id="3725740">[</span><span class="num" id="3725741">0</span><span class="op" id="3725742">]</span><span class="op" id="3725743">,</span>&nbsp;<span class="string" id="3725745">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="3725782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725788">index</span><span class="op" id="3725793">[</span><span class="num" id="3725794">1</span><span class="op" id="3725795">]</span>&nbsp;<span class="op" id="3725797">=</span>&nbsp;<span class="op" id="3725799">&amp;</span><span class="ident" id="3725800">ast</span><span class="op" id="3725803">.</span><span class="ident" id="3725804">BadExpr</span><span class="op" id="3725811">{</span><span class="ident" id="3725812">From</span><span class="op" id="3725816">:</span>&nbsp;<span class="ident" id="3725818">colons</span><span class="op" id="3725824">[</span><span class="num" id="3725825">0</span><span class="op" id="3725826">]</span>&nbsp;<span class="op" id="3725828">+</span>&nbsp;<span class="num" id="3725830">1</span><span class="op" id="3725831">,</span>&nbsp;<span class="ident" id="3725833">To</span><span class="op" id="3725835">:</span>&nbsp;<span class="ident" id="3725837">colons</span><span class="op" id="3725843">[</span><span class="num" id="3725844">1</span><span class="op" id="3725845">]</span><span class="op" id="3725846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3725851">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3725856">if</span>&nbsp;<span class="ident" id="3725859">index</span><span class="op" id="3725864">[</span><span class="num" id="3725865">2</span><span class="op" id="3725866">]</span>&nbsp;<span class="op" id="3725868">==</span>&nbsp;<span class="builtintype" id="3725871">nil</span>&nbsp;<span class="op" id="3725875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725881">p</span><span class="op" id="3725882">.</span><span class="builtintype" id="3725883">error</span><span class="op" id="3725888">(</span><span class="ident" id="3725889">colons</span><span class="op" id="3725895">[</span><span class="num" id="3725896">1</span><span class="op" id="3725897">]</span><span class="op" id="3725898">,</span>&nbsp;<span class="string" id="3725900">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="3725937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725943">index</span><span class="op" id="3725948">[</span><span class="num" id="3725949">2</span><span class="op" id="3725950">]</span>&nbsp;<span class="op" id="3725952">=</span>&nbsp;<span class="op" id="3725954">&amp;</span><span class="ident" id="3725955">ast</span><span class="op" id="3725958">.</span><span class="ident" id="3725959">BadExpr</span><span class="op" id="3725966">{</span><span class="ident" id="3725967">From</span><span class="op" id="3725971">:</span>&nbsp;<span class="ident" id="3725973">colons</span><span class="op" id="3725979">[</span><span class="num" id="3725980">1</span><span class="op" id="3725981">]</span>&nbsp;<span class="op" id="3725983">+</span>&nbsp;<span class="num" id="3725985">1</span><span class="op" id="3725986">,</span>&nbsp;<span class="ident" id="3725988">To</span><span class="op" id="3725990">:</span>&nbsp;<span class="ident" id="3725992">rbrack</span><span class="op" id="3725998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726007">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726011">return</span>&nbsp;<span class="op" id="3726018">&amp;</span><span class="ident" id="3726019">ast</span><span class="op" id="3726022">.</span><span class="ident" id="3726023">SliceExpr</span><span class="op" id="3726032">{</span><span class="ident" id="3726033">X</span><span class="op" id="3726034">:</span>&nbsp;<span class="ident" id="3726036">x</span><span class="op" id="3726037">,</span>&nbsp;<span class="ident" id="3726039">Lbrack</span><span class="op" id="3726045">:</span>&nbsp;<span class="ident" id="3726047">lbrack</span><span class="op" id="3726053">,</span>&nbsp;<span class="ident" id="3726055">Low</span><span class="op" id="3726058">:</span>&nbsp;<span class="ident" id="3726060">index</span><span class="op" id="3726065">[</span><span class="num" id="3726066">0</span><span class="op" id="3726067">]</span><span class="op" id="3726068">,</span>&nbsp;<span class="ident" id="3726070">High</span><span class="op" id="3726074">:</span>&nbsp;<span class="ident" id="3726076">index</span><span class="op" id="3726081">[</span><span class="num" id="3726082">1</span><span class="op" id="3726083">]</span><span class="op" id="3726084">,</span>&nbsp;<span class="ident" id="3726086">Max</span><span class="op" id="3726089">:</span>&nbsp;<span class="ident" id="3726091">index</span><span class="op" id="3726096">[</span><span class="num" id="3726097">2</span><span class="op" id="3726098">]</span><span class="op" id="3726099">,</span>&nbsp;<span class="ident" id="3726101">Slice3</span><span class="op" id="3726107">:</span>&nbsp;<span class="ident" id="3726109">slice3</span><span class="op" id="3726115">,</span>&nbsp;<span class="ident" id="3726117">Rbrack</span><span class="op" id="3726123">:</span>&nbsp;<span class="ident" id="3726125">rbrack</span><span class="op" id="3726131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726138">return</span>&nbsp;<span class="op" id="3726145">&amp;</span><span class="ident" id="3726146">ast</span><span class="op" id="3726149">.</span><span class="ident" id="3726150">IndexExpr</span><span class="op" id="3726159">{</span><span class="ident" id="3726160">X</span><span class="op" id="3726161">:</span>&nbsp;<span class="ident" id="3726163">x</span><span class="op" id="3726164">,</span>&nbsp;<span class="ident" id="3726166">Lbrack</span><span class="op" id="3726172">:</span>&nbsp;<span class="ident" id="3726174">lbrack</span><span class="op" id="3726180">,</span>&nbsp;<span class="ident" id="3726182">Index</span><span class="op" id="3726187">:</span>&nbsp;<span class="ident" id="3726189">index</span><span class="op" id="3726194">[</span><span class="num" id="3726195">0</span><span class="op" id="3726196">]</span><span class="op" id="3726197">,</span>&nbsp;<span class="ident" id="3726199">Rbrack</span><span class="op" id="3726205">:</span>&nbsp;<span class="ident" id="3726207">rbrack</span><span class="op" id="3726213">}</span><br>
<span class="lineno"></span><span class="op" id="3726215">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="3726218">func</span>&nbsp;<span class="op" id="3726223">(</span><span class="ident" id="3726224">p</span>&nbsp;<span class="op" id="3726226">*</span><span class="ident" id="3726227">parser</span><span class="op" id="3726233">)</span>&nbsp;<span class="ident" id="3726235">parseCallOrConversion</span><span class="op" id="3726256">(</span><span class="ident" id="3726257">fun</span>&nbsp;<span class="ident" id="3726261">ast</span><span class="op" id="3726264">.</span><span class="ident" id="3726265">Expr</span><span class="op" id="3726269">)</span>&nbsp;<span class="op" id="3726271">*</span><span class="ident" id="3726272">ast</span><span class="op" id="3726275">.</span><span class="ident" id="3726276">CallExpr</span>&nbsp;<span class="op" id="3726285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726288">if</span>&nbsp;<span class="ident" id="3726291">p</span><span class="op" id="3726292">.</span><span class="ident" id="3726293">trace</span>&nbsp;<span class="op" id="3726299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726303">defer</span>&nbsp;<span class="ident" id="3726309">un</span><span class="op" id="3726311">(</span><span class="ident" id="3726312">trace</span><span class="op" id="3726317">(</span><span class="ident" id="3726318">p</span><span class="op" id="3726319">,</span>&nbsp;<span class="string" id="3726321">&#34;CallOrConversion&#34;</span><span class="op" id="3726339">)</span><span class="op" id="3726340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726343">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726347">lparen</span>&nbsp;<span class="op" id="3726354">:=</span>&nbsp;<span class="ident" id="3726357">p</span><span class="op" id="3726358">.</span><span class="ident" id="3726359">expect</span><span class="op" id="3726365">(</span><span class="ident" id="3726366">token</span><span class="op" id="3726371">.</span><span class="ident" id="3726372">LPAREN</span><span class="op" id="3726378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726381">p</span><span class="op" id="3726382">.</span><span class="ident" id="3726383">exprLev</span><span class="op" id="3726390">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726394">var</span>&nbsp;<span class="ident" id="3726398">list</span>&nbsp;<span class="op" id="3726403">[</span><span class="op" id="3726404">]</span><span class="ident" id="3726405">ast</span><span class="op" id="3726408">.</span><span class="ident" id="3726409">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726415">var</span>&nbsp;<span class="ident" id="3726419">ellipsis</span>&nbsp;<span class="ident" id="3726428">token</span><span class="op" id="3726433">.</span><span class="ident" id="3726434">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726439">for</span>&nbsp;<span class="ident" id="3726443">p</span><span class="op" id="3726444">.</span><span class="ident" id="3726445">tok</span>&nbsp;<span class="op" id="3726449">!=</span>&nbsp;<span class="ident" id="3726452">token</span><span class="op" id="3726457">.</span><span class="ident" id="3726458">RPAREN</span>&nbsp;<span class="op" id="3726465">&amp;&amp;</span>&nbsp;<span class="ident" id="3726468">p</span><span class="op" id="3726469">.</span><span class="ident" id="3726470">tok</span>&nbsp;<span class="op" id="3726474">!=</span>&nbsp;<span class="ident" id="3726477">token</span><span class="op" id="3726482">.</span><span class="ident" id="3726483">EOF</span>&nbsp;<span class="op" id="3726487">&amp;&amp;</span>&nbsp;<span class="op" id="3726490">!</span><span class="ident" id="3726491">ellipsis</span><span class="op" id="3726499">.</span><span class="ident" id="3726500">IsValid</span><span class="op" id="3726507">(</span><span class="op" id="3726508">)</span>&nbsp;<span class="op" id="3726510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726514">list</span>&nbsp;<span class="op" id="3726519">=</span>&nbsp;<span class="builtinfunc" id="3726521">append</span><span class="op" id="3726527">(</span><span class="ident" id="3726528">list</span><span class="op" id="3726532">,</span>&nbsp;<span class="ident" id="3726534">p</span><span class="op" id="3726535">.</span><span class="ident" id="3726536">parseRhsOrType</span><span class="op" id="3726550">(</span><span class="op" id="3726551">)</span><span class="op" id="3726552">)</span>&nbsp;<span class="comment" id="3726554">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726608">if</span>&nbsp;<span class="ident" id="3726611">p</span><span class="op" id="3726612">.</span><span class="ident" id="3726613">tok</span>&nbsp;<span class="op" id="3726617">==</span>&nbsp;<span class="ident" id="3726620">token</span><span class="op" id="3726625">.</span><span class="ident" id="3726626">ELLIPSIS</span>&nbsp;<span class="op" id="3726635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726640">ellipsis</span>&nbsp;<span class="op" id="3726649">=</span>&nbsp;<span class="ident" id="3726651">p</span><span class="op" id="3726652">.</span><span class="ident" id="3726653">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726660">p</span><span class="op" id="3726661">.</span><span class="ident" id="3726662">next</span><span class="op" id="3726666">(</span><span class="op" id="3726667">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726675">if</span>&nbsp;<span class="op" id="3726678">!</span><span class="ident" id="3726679">p</span><span class="op" id="3726680">.</span><span class="ident" id="3726681">atComma</span><span class="op" id="3726688">(</span><span class="string" id="3726689">&#34;argument&nbsp;list&#34;</span><span class="op" id="3726704">)</span>&nbsp;<span class="op" id="3726706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726711">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726723">p</span><span class="op" id="3726724">.</span><span class="ident" id="3726725">next</span><span class="op" id="3726729">(</span><span class="op" id="3726730">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726736">p</span><span class="op" id="3726737">.</span><span class="ident" id="3726738">exprLev</span><span class="op" id="3726745">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726749">rparen</span>&nbsp;<span class="op" id="3726756">:=</span>&nbsp;<span class="ident" id="3726759">p</span><span class="op" id="3726760">.</span><span class="ident" id="3726761">expectClosing</span><span class="op" id="3726774">(</span><span class="ident" id="3726775">token</span><span class="op" id="3726780">.</span><span class="ident" id="3726781">RPAREN</span><span class="op" id="3726787">,</span>&nbsp;<span class="string" id="3726789">&#34;argument&nbsp;list&#34;</span><span class="op" id="3726804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726808">return</span>&nbsp;<span class="op" id="3726815">&amp;</span><span class="ident" id="3726816">ast</span><span class="op" id="3726819">.</span><span class="ident" id="3726820">CallExpr</span><span class="op" id="3726828">{</span><span class="ident" id="3726829">Fun</span><span class="op" id="3726832">:</span>&nbsp;<span class="ident" id="3726834">fun</span><span class="op" id="3726837">,</span>&nbsp;<span class="ident" id="3726839">Lparen</span><span class="op" id="3726845">:</span>&nbsp;<span class="ident" id="3726847">lparen</span><span class="op" id="3726853">,</span>&nbsp;<span class="ident" id="3726855">Args</span><span class="op" id="3726859">:</span>&nbsp;<span class="ident" id="3726861">list</span><span class="op" id="3726865">,</span>&nbsp;<span class="ident" id="3726867">Ellipsis</span><span class="op" id="3726875">:</span>&nbsp;<span class="ident" id="3726877">ellipsis</span><span class="op" id="3726885">,</span>&nbsp;<span class="ident" id="3726887">Rparen</span><span class="op" id="3726893">:</span>&nbsp;<span class="ident" id="3726895">rparen</span><span class="op" id="3726901">}</span><br>
<span class="lineno">1260</span><span class="op" id="3726903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3726906">func</span>&nbsp;<span class="op" id="3726911">(</span><span class="ident" id="3726912">p</span>&nbsp;<span class="op" id="3726914">*</span><span class="ident" id="3726915">parser</span><span class="op" id="3726921">)</span>&nbsp;<span class="ident" id="3726923">parseElement</span><span class="op" id="3726935">(</span><span class="ident" id="3726936">keyOk</span>&nbsp;<span class="builtintype" id="3726942">bool</span><span class="op" id="3726946">)</span>&nbsp;<span class="ident" id="3726948">ast</span><span class="op" id="3726951">.</span><span class="ident" id="3726952">Expr</span>&nbsp;<span class="op" id="3726957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726960">if</span>&nbsp;<span class="ident" id="3726963">p</span><span class="op" id="3726964">.</span><span class="ident" id="3726965">trace</span>&nbsp;<span class="op" id="3726971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3726975">defer</span>&nbsp;<span class="ident" id="3726981">un</span><span class="op" id="3726983">(</span><span class="ident" id="3726984">trace</span><span class="op" id="3726989">(</span><span class="ident" id="3726990">p</span><span class="op" id="3726991">,</span>&nbsp;<span class="string" id="3726993">&#34;Element&#34;</span><span class="op" id="3727002">)</span><span class="op" id="3727003">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3727006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3727010">if</span>&nbsp;<span class="ident" id="3727013">p</span><span class="op" id="3727014">.</span><span class="ident" id="3727015">tok</span>&nbsp;<span class="op" id="3727019">==</span>&nbsp;<span class="ident" id="3727022">token</span><span class="op" id="3727027">.</span><span class="ident" id="3727028">LBRACE</span>&nbsp;<span class="op" id="3727035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3727039">return</span>&nbsp;<span class="ident" id="3727046">p</span><span class="op" id="3727047">.</span><span class="ident" id="3727048">parseLiteralValue</span><span class="op" id="3727065">(</span><span class="builtintype" id="3727066">nil</span><span class="op" id="3727069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3727072">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727076">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727150">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727222">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727292">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727306">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727310">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727380">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727449">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727520">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727588">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727655">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727659">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727725">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727798">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727871">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3727944">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727973">x</span>&nbsp;<span class="op" id="3727975">:=</span>&nbsp;<span class="ident" id="3727978">p</span><span class="op" id="3727979">.</span><span class="ident" id="3727980">checkExpr</span><span class="op" id="3727989">(</span><span class="ident" id="3727990">p</span><span class="op" id="3727991">.</span><span class="ident" id="3727992">parseExpr</span><span class="op" id="3728001">(</span><span class="ident" id="3728002">keyOk</span><span class="op" id="3728007">)</span><span class="op" id="3728008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728011">if</span>&nbsp;<span class="ident" id="3728014">keyOk</span>&nbsp;<span class="op" id="3728020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728024">if</span>&nbsp;<span class="ident" id="3728027">p</span><span class="op" id="3728028">.</span><span class="ident" id="3728029">tok</span>&nbsp;<span class="op" id="3728033">==</span>&nbsp;<span class="ident" id="3728036">token</span><span class="op" id="3728041">.</span><span class="ident" id="3728042">COLON</span>&nbsp;<span class="op" id="3728048">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728053">colon</span>&nbsp;<span class="op" id="3728059">:=</span>&nbsp;<span class="ident" id="3728062">p</span><span class="op" id="3728063">.</span><span class="ident" id="3728064">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728071">p</span><span class="op" id="3728072">.</span><span class="ident" id="3728073">next</span><span class="op" id="3728077">(</span><span class="op" id="3728078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3728083">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3728133">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3728184">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3728233">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728257">p</span><span class="op" id="3728258">.</span><span class="ident" id="3728259">tryResolve</span><span class="op" id="3728269">(</span><span class="ident" id="3728270">x</span><span class="op" id="3728271">,</span>&nbsp;<span class="builtintype" id="3728273">false</span><span class="op" id="3728278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728283">return</span>&nbsp;<span class="op" id="3728290">&amp;</span><span class="ident" id="3728291">ast</span><span class="op" id="3728294">.</span><span class="ident" id="3728295">KeyValueExpr</span><span class="op" id="3728307">{</span><span class="ident" id="3728308">Key</span><span class="op" id="3728311">:</span>&nbsp;<span class="ident" id="3728313">x</span><span class="op" id="3728314">,</span>&nbsp;<span class="ident" id="3728316">Colon</span><span class="op" id="3728321">:</span>&nbsp;<span class="ident" id="3728323">colon</span><span class="op" id="3728328">,</span>&nbsp;<span class="ident" id="3728330">Value</span><span class="op" id="3728335">:</span>&nbsp;<span class="ident" id="3728337">p</span><span class="op" id="3728338">.</span><span class="ident" id="3728339">parseElement</span><span class="op" id="3728351">(</span><span class="builtintype" id="3728352">false</span><span class="op" id="3728357">)</span><span class="op" id="3728358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728366">p</span><span class="op" id="3728367">.</span><span class="ident" id="3728368">resolve</span><span class="op" id="3728375">(</span><span class="ident" id="3728376">x</span><span class="op" id="3728377">)</span>&nbsp;<span class="comment" id="3728379">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728397">return</span>&nbsp;<span class="ident" id="3728404">x</span><br>
<span class="lineno"></span><span class="op" id="3728406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="3728409">func</span>&nbsp;<span class="op" id="3728414">(</span><span class="ident" id="3728415">p</span>&nbsp;<span class="op" id="3728417">*</span><span class="ident" id="3728418">parser</span><span class="op" id="3728424">)</span>&nbsp;<span class="ident" id="3728426">parseElementList</span><span class="op" id="3728442">(</span><span class="op" id="3728443">)</span>&nbsp;<span class="op" id="3728445">(</span><span class="ident" id="3728446">list</span>&nbsp;<span class="op" id="3728451">[</span><span class="op" id="3728452">]</span><span class="ident" id="3728453">ast</span><span class="op" id="3728456">.</span><span class="ident" id="3728457">Expr</span><span class="op" id="3728461">)</span>&nbsp;<span class="op" id="3728463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728466">if</span>&nbsp;<span class="ident" id="3728469">p</span><span class="op" id="3728470">.</span><span class="ident" id="3728471">trace</span>&nbsp;<span class="op" id="3728477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728481">defer</span>&nbsp;<span class="ident" id="3728487">un</span><span class="op" id="3728489">(</span><span class="ident" id="3728490">trace</span><span class="op" id="3728495">(</span><span class="ident" id="3728496">p</span><span class="op" id="3728497">,</span>&nbsp;<span class="string" id="3728499">&#34;ElementList&#34;</span><span class="op" id="3728512">)</span><span class="op" id="3728513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728520">for</span>&nbsp;<span class="ident" id="3728524">p</span><span class="op" id="3728525">.</span><span class="ident" id="3728526">tok</span>&nbsp;<span class="op" id="3728530">!=</span>&nbsp;<span class="ident" id="3728533">token</span><span class="op" id="3728538">.</span><span class="ident" id="3728539">RBRACE</span>&nbsp;<span class="op" id="3728546">&amp;&amp;</span>&nbsp;<span class="ident" id="3728549">p</span><span class="op" id="3728550">.</span><span class="ident" id="3728551">tok</span>&nbsp;<span class="op" id="3728555">!=</span>&nbsp;<span class="ident" id="3728558">token</span><span class="op" id="3728563">.</span><span class="ident" id="3728564">EOF</span>&nbsp;<span class="op" id="3728568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728572">list</span>&nbsp;<span class="op" id="3728577">=</span>&nbsp;<span class="builtinfunc" id="3728579">append</span><span class="op" id="3728585">(</span><span class="ident" id="3728586">list</span><span class="op" id="3728590">,</span>&nbsp;<span class="ident" id="3728592">p</span><span class="op" id="3728593">.</span><span class="ident" id="3728594">parseElement</span><span class="op" id="3728606">(</span><span class="builtintype" id="3728607">true</span><span class="op" id="3728611">)</span><span class="op" id="3728612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728616">if</span>&nbsp;<span class="op" id="3728619">!</span><span class="ident" id="3728620">p</span><span class="op" id="3728621">.</span><span class="ident" id="3728622">atComma</span><span class="op" id="3728629">(</span><span class="string" id="3728630">&#34;composite&nbsp;literal&#34;</span><span class="op" id="3728649">)</span>&nbsp;<span class="op" id="3728651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728656">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728664">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728668">p</span><span class="op" id="3728669">.</span><span class="ident" id="3728670">next</span><span class="op" id="3728674">(</span><span class="op" id="3728675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728682">return</span><br>
<span class="lineno"></span><span class="op" id="3728689">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="3728692">func</span>&nbsp;<span class="op" id="3728697">(</span><span class="ident" id="3728698">p</span>&nbsp;<span class="op" id="3728700">*</span><span class="ident" id="3728701">parser</span><span class="op" id="3728707">)</span>&nbsp;<span class="ident" id="3728709">parseLiteralValue</span><span class="op" id="3728726">(</span><span class="ident" id="3728727">typ</span>&nbsp;<span class="ident" id="3728731">ast</span><span class="op" id="3728734">.</span><span class="ident" id="3728735">Expr</span><span class="op" id="3728739">)</span>&nbsp;<span class="ident" id="3728741">ast</span><span class="op" id="3728744">.</span><span class="ident" id="3728745">Expr</span>&nbsp;<span class="op" id="3728750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728753">if</span>&nbsp;<span class="ident" id="3728756">p</span><span class="op" id="3728757">.</span><span class="ident" id="3728758">trace</span>&nbsp;<span class="op" id="3728764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728768">defer</span>&nbsp;<span class="ident" id="3728774">un</span><span class="op" id="3728776">(</span><span class="ident" id="3728777">trace</span><span class="op" id="3728782">(</span><span class="ident" id="3728783">p</span><span class="op" id="3728784">,</span>&nbsp;<span class="string" id="3728786">&#34;LiteralValue&#34;</span><span class="op" id="3728800">)</span><span class="op" id="3728801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728804">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728808">lbrace</span>&nbsp;<span class="op" id="3728815">:=</span>&nbsp;<span class="ident" id="3728818">p</span><span class="op" id="3728819">.</span><span class="ident" id="3728820">expect</span><span class="op" id="3728826">(</span><span class="ident" id="3728827">token</span><span class="op" id="3728832">.</span><span class="ident" id="3728833">LBRACE</span><span class="op" id="3728839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728842">var</span>&nbsp;<span class="ident" id="3728846">elts</span>&nbsp;<span class="op" id="3728851">[</span><span class="op" id="3728852">]</span><span class="ident" id="3728853">ast</span><span class="op" id="3728856">.</span><span class="ident" id="3728857">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728863">p</span><span class="op" id="3728864">.</span><span class="ident" id="3728865">exprLev</span><span class="op" id="3728872">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3728876">if</span>&nbsp;<span class="ident" id="3728879">p</span><span class="op" id="3728880">.</span><span class="ident" id="3728881">tok</span>&nbsp;<span class="op" id="3728885">!=</span>&nbsp;<span class="ident" id="3728888">token</span><span class="op" id="3728893">.</span><span class="ident" id="3728894">RBRACE</span>&nbsp;<span class="op" id="3728901">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728905">elts</span>&nbsp;<span class="op" id="3728910">=</span>&nbsp;<span class="ident" id="3728912">p</span><span class="op" id="3728913">.</span><span class="ident" id="3728914">parseElementList</span><span class="op" id="3728930">(</span><span class="op" id="3728931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728937">p</span><span class="op" id="3728938">.</span><span class="ident" id="3728939">exprLev</span><span class="op" id="3728946">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728950">rbrace</span>&nbsp;<span class="op" id="3728957">:=</span>&nbsp;<span class="ident" id="3728960">p</span><span class="op" id="3728961">.</span><span class="ident" id="3728962">expectClosing</span><span class="op" id="3728975">(</span><span class="ident" id="3728976">token</span><span class="op" id="3728981">.</span><span class="ident" id="3728982">RBRACE</span><span class="op" id="3728988">,</span>&nbsp;<span class="string" id="3728990">&#34;composite&nbsp;literal&#34;</span><span class="op" id="3729009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729012">return</span>&nbsp;<span class="op" id="3729019">&amp;</span><span class="ident" id="3729020">ast</span><span class="op" id="3729023">.</span><span class="ident" id="3729024">CompositeLit</span><span class="op" id="3729036">{</span><span class="ident" id="3729037">Type</span><span class="op" id="3729041">:</span>&nbsp;<span class="ident" id="3729043">typ</span><span class="op" id="3729046">,</span>&nbsp;<span class="ident" id="3729048">Lbrace</span><span class="op" id="3729054">:</span>&nbsp;<span class="ident" id="3729056">lbrace</span><span class="op" id="3729062">,</span>&nbsp;<span class="ident" id="3729064">Elts</span><span class="op" id="3729068">:</span>&nbsp;<span class="ident" id="3729070">elts</span><span class="op" id="3729074">,</span>&nbsp;<span class="ident" id="3729076">Rbrace</span><span class="op" id="3729082">:</span>&nbsp;<span class="ident" id="3729084">rbrace</span><span class="op" id="3729090">}</span><br>
<span class="lineno">1335</span><span class="op" id="3729092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3729095">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="3729157">func</span>&nbsp;<span class="op" id="3729162">(</span><span class="ident" id="3729163">p</span>&nbsp;<span class="op" id="3729165">*</span><span class="ident" id="3729166">parser</span><span class="op" id="3729172">)</span>&nbsp;<span class="ident" id="3729174">checkExpr</span><span class="op" id="3729183">(</span><span class="ident" id="3729184">x</span>&nbsp;<span class="ident" id="3729186">ast</span><span class="op" id="3729189">.</span><span class="ident" id="3729190">Expr</span><span class="op" id="3729194">)</span>&nbsp;<span class="ident" id="3729196">ast</span><span class="op" id="3729199">.</span><span class="ident" id="3729200">Expr</span>&nbsp;<span class="op" id="3729205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729208">switch</span>&nbsp;<span class="ident" id="3729215">unparen</span><span class="op" id="3729222">(</span><span class="ident" id="3729223">x</span><span class="op" id="3729224">)</span><span class="op" id="3729225">.</span><span class="op" id="3729226">(</span><span class="keyword" id="3729227">type</span><span class="op" id="3729231">)</span>&nbsp;<span class="op" id="3729233">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729236">case</span>&nbsp;<span class="op" id="3729241">*</span><span class="ident" id="3729242">ast</span><span class="op" id="3729245">.</span><span class="ident" id="3729246">BadExpr</span><span class="op" id="3729253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729256">case</span>&nbsp;<span class="op" id="3729261">*</span><span class="ident" id="3729262">ast</span><span class="op" id="3729265">.</span><span class="ident" id="3729266">Ident</span><span class="op" id="3729271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729274">case</span>&nbsp;<span class="op" id="3729279">*</span><span class="ident" id="3729280">ast</span><span class="op" id="3729283">.</span><span class="ident" id="3729284">BasicLit</span><span class="op" id="3729292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729295">case</span>&nbsp;<span class="op" id="3729300">*</span><span class="ident" id="3729301">ast</span><span class="op" id="3729304">.</span><span class="ident" id="3729305">FuncLit</span><span class="op" id="3729312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729315">case</span>&nbsp;<span class="op" id="3729320">*</span><span class="ident" id="3729321">ast</span><span class="op" id="3729324">.</span><span class="ident" id="3729325">CompositeLit</span><span class="op" id="3729337">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729340">case</span>&nbsp;<span class="op" id="3729345">*</span><span class="ident" id="3729346">ast</span><span class="op" id="3729349">.</span><span class="ident" id="3729350">ParenExpr</span><span class="op" id="3729359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3729363">panic</span><span class="op" id="3729368">(</span><span class="string" id="3729369">&#34;unreachable&#34;</span><span class="op" id="3729382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729385">case</span>&nbsp;<span class="op" id="3729390">*</span><span class="ident" id="3729391">ast</span><span class="op" id="3729394">.</span><span class="ident" id="3729395">SelectorExpr</span><span class="op" id="3729407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729410">case</span>&nbsp;<span class="op" id="3729415">*</span><span class="ident" id="3729416">ast</span><span class="op" id="3729419">.</span><span class="ident" id="3729420">IndexExpr</span><span class="op" id="3729429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729432">case</span>&nbsp;<span class="op" id="3729437">*</span><span class="ident" id="3729438">ast</span><span class="op" id="3729441">.</span><span class="ident" id="3729442">SliceExpr</span><span class="op" id="3729451">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729454">case</span>&nbsp;<span class="op" id="3729459">*</span><span class="ident" id="3729460">ast</span><span class="op" id="3729463">.</span><span class="ident" id="3729464">TypeAssertExpr</span><span class="op" id="3729478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729482">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729541">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729606">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729671">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729736">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729749">case</span>&nbsp;<span class="op" id="3729754">*</span><span class="ident" id="3729755">ast</span><span class="op" id="3729758">.</span><span class="ident" id="3729759">CallExpr</span><span class="op" id="3729767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729770">case</span>&nbsp;<span class="op" id="3729775">*</span><span class="ident" id="3729776">ast</span><span class="op" id="3729779">.</span><span class="ident" id="3729780">StarExpr</span><span class="op" id="3729788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729791">case</span>&nbsp;<span class="op" id="3729796">*</span><span class="ident" id="3729797">ast</span><span class="op" id="3729800">.</span><span class="ident" id="3729801">UnaryExpr</span><span class="op" id="3729810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729813">case</span>&nbsp;<span class="op" id="3729818">*</span><span class="ident" id="3729819">ast</span><span class="op" id="3729822">.</span><span class="ident" id="3729823">BinaryExpr</span><span class="op" id="3729833">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729836">default</span><span class="op" id="3729843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729847">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3729895">p</span><span class="op" id="3729896">.</span><span class="ident" id="3729897">errorExpected</span><span class="op" id="3729910">(</span><span class="ident" id="3729911">x</span><span class="op" id="3729912">.</span><span class="ident" id="3729913">Pos</span><span class="op" id="3729916">(</span><span class="op" id="3729917">)</span><span class="op" id="3729918">,</span>&nbsp;<span class="string" id="3729920">&#34;expression&#34;</span><span class="op" id="3729932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3729936">x</span>&nbsp;<span class="op" id="3729938">=</span>&nbsp;<span class="op" id="3729940">&amp;</span><span class="ident" id="3729941">ast</span><span class="op" id="3729944">.</span><span class="ident" id="3729945">BadExpr</span><span class="op" id="3729952">{</span><span class="ident" id="3729953">From</span><span class="op" id="3729957">:</span>&nbsp;<span class="ident" id="3729959">x</span><span class="op" id="3729960">.</span><span class="ident" id="3729961">Pos</span><span class="op" id="3729964">(</span><span class="op" id="3729965">)</span><span class="op" id="3729966">,</span>&nbsp;<span class="ident" id="3729968">To</span><span class="op" id="3729970">:</span>&nbsp;<span class="ident" id="3729972">p</span><span class="op" id="3729973">.</span><span class="ident" id="3729974">safePos</span><span class="op" id="3729981">(</span><span class="ident" id="3729982">x</span><span class="op" id="3729983">.</span><span class="ident" id="3729984">End</span><span class="op" id="3729987">(</span><span class="op" id="3729988">)</span><span class="op" id="3729989">)</span><span class="op" id="3729990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729993">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3729996">return</span>&nbsp;<span class="ident" id="3730003">x</span><br>
<span class="lineno"></span><span class="op" id="3730005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3730008">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="3730068">func</span>&nbsp;<span class="ident" id="3730073">isTypeName</span><span class="op" id="3730083">(</span><span class="ident" id="3730084">x</span>&nbsp;<span class="ident" id="3730086">ast</span><span class="op" id="3730089">.</span><span class="ident" id="3730090">Expr</span><span class="op" id="3730094">)</span>&nbsp;<span class="builtintype" id="3730096">bool</span>&nbsp;<span class="op" id="3730101">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730104">switch</span>&nbsp;<span class="ident" id="3730111">t</span>&nbsp;<span class="op" id="3730113">:=</span>&nbsp;<span class="ident" id="3730116">x</span><span class="op" id="3730117">.</span><span class="op" id="3730118">(</span><span class="keyword" id="3730119">type</span><span class="op" id="3730123">)</span>&nbsp;<span class="op" id="3730125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730128">case</span>&nbsp;<span class="op" id="3730133">*</span><span class="ident" id="3730134">ast</span><span class="op" id="3730137">.</span><span class="ident" id="3730138">BadExpr</span><span class="op" id="3730145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730148">case</span>&nbsp;<span class="op" id="3730153">*</span><span class="ident" id="3730154">ast</span><span class="op" id="3730157">.</span><span class="ident" id="3730158">Ident</span><span class="op" id="3730163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730166">case</span>&nbsp;<span class="op" id="3730171">*</span><span class="ident" id="3730172">ast</span><span class="op" id="3730175">.</span><span class="ident" id="3730176">SelectorExpr</span><span class="op" id="3730188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730192">_</span><span class="op" id="3730193">,</span>&nbsp;<span class="ident" id="3730195">isIdent</span>&nbsp;<span class="op" id="3730203">:=</span>&nbsp;<span class="ident" id="3730206">t</span><span class="op" id="3730207">.</span><span class="ident" id="3730208">X</span><span class="op" id="3730209">.</span><span class="op" id="3730210">(</span><span class="op" id="3730211">*</span><span class="ident" id="3730212">ast</span><span class="op" id="3730215">.</span><span class="ident" id="3730216">Ident</span><span class="op" id="3730221">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730225">return</span>&nbsp;<span class="ident" id="3730232">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730241">default</span><span class="op" id="3730248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730252">return</span>&nbsp;<span class="builtintype" id="3730259">false</span>&nbsp;<span class="comment" id="3730265">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3730304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730307">return</span>&nbsp;<span class="builtintype" id="3730314">true</span><br>
<span class="lineno">1380</span><span class="op" id="3730319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3730322">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3730393">func</span>&nbsp;<span class="ident" id="3730398">isLiteralType</span><span class="op" id="3730411">(</span><span class="ident" id="3730412">x</span>&nbsp;<span class="ident" id="3730414">ast</span><span class="op" id="3730417">.</span><span class="ident" id="3730418">Expr</span><span class="op" id="3730422">)</span>&nbsp;<span class="builtintype" id="3730424">bool</span>&nbsp;<span class="op" id="3730429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730432">switch</span>&nbsp;<span class="ident" id="3730439">t</span>&nbsp;<span class="op" id="3730441">:=</span>&nbsp;<span class="ident" id="3730444">x</span><span class="op" id="3730445">.</span><span class="op" id="3730446">(</span><span class="keyword" id="3730447">type</span><span class="op" id="3730451">)</span>&nbsp;<span class="op" id="3730453">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730456">case</span>&nbsp;<span class="op" id="3730461">*</span><span class="ident" id="3730462">ast</span><span class="op" id="3730465">.</span><span class="ident" id="3730466">BadExpr</span><span class="op" id="3730473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730476">case</span>&nbsp;<span class="op" id="3730481">*</span><span class="ident" id="3730482">ast</span><span class="op" id="3730485">.</span><span class="ident" id="3730486">Ident</span><span class="op" id="3730491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730494">case</span>&nbsp;<span class="op" id="3730499">*</span><span class="ident" id="3730500">ast</span><span class="op" id="3730503">.</span><span class="ident" id="3730504">SelectorExpr</span><span class="op" id="3730516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730520">_</span><span class="op" id="3730521">,</span>&nbsp;<span class="ident" id="3730523">isIdent</span>&nbsp;<span class="op" id="3730531">:=</span>&nbsp;<span class="ident" id="3730534">t</span><span class="op" id="3730535">.</span><span class="ident" id="3730536">X</span><span class="op" id="3730537">.</span><span class="op" id="3730538">(</span><span class="op" id="3730539">*</span><span class="ident" id="3730540">ast</span><span class="op" id="3730543">.</span><span class="ident" id="3730544">Ident</span><span class="op" id="3730549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730553">return</span>&nbsp;<span class="ident" id="3730560">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730569">case</span>&nbsp;<span class="op" id="3730574">*</span><span class="ident" id="3730575">ast</span><span class="op" id="3730578">.</span><span class="ident" id="3730579">ArrayType</span><span class="op" id="3730588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730591">case</span>&nbsp;<span class="op" id="3730596">*</span><span class="ident" id="3730597">ast</span><span class="op" id="3730600">.</span><span class="ident" id="3730601">StructType</span><span class="op" id="3730611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730614">case</span>&nbsp;<span class="op" id="3730619">*</span><span class="ident" id="3730620">ast</span><span class="op" id="3730623">.</span><span class="ident" id="3730624">MapType</span><span class="op" id="3730631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730634">default</span><span class="op" id="3730641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730645">return</span>&nbsp;<span class="builtintype" id="3730652">false</span>&nbsp;<span class="comment" id="3730658">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3730716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730719">return</span>&nbsp;<span class="builtintype" id="3730726">true</span><br>
<span class="lineno"></span><span class="op" id="3730731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3730734">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="3730802">func</span>&nbsp;<span class="ident" id="3730807">deref</span><span class="op" id="3730812">(</span><span class="ident" id="3730813">x</span>&nbsp;<span class="ident" id="3730815">ast</span><span class="op" id="3730818">.</span><span class="ident" id="3730819">Expr</span><span class="op" id="3730823">)</span>&nbsp;<span class="ident" id="3730825">ast</span><span class="op" id="3730828">.</span><span class="ident" id="3730829">Expr</span>&nbsp;<span class="op" id="3730834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730837">if</span>&nbsp;<span class="ident" id="3730840">p</span><span class="op" id="3730841">,</span>&nbsp;<span class="ident" id="3730843">isPtr</span>&nbsp;<span class="op" id="3730849">:=</span>&nbsp;<span class="ident" id="3730852">x</span><span class="op" id="3730853">.</span><span class="op" id="3730854">(</span><span class="op" id="3730855">*</span><span class="ident" id="3730856">ast</span><span class="op" id="3730859">.</span><span class="ident" id="3730860">StarExpr</span><span class="op" id="3730868">)</span><span class="op" id="3730869">;</span>&nbsp;<span class="ident" id="3730871">isPtr</span>&nbsp;<span class="op" id="3730877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730881">x</span>&nbsp;<span class="op" id="3730883">=</span>&nbsp;<span class="ident" id="3730885">p</span><span class="op" id="3730886">.</span><span class="ident" id="3730887">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3730890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3730893">return</span>&nbsp;<span class="ident" id="3730900">x</span><br>
<span class="lineno">1405</span><span class="op" id="3730902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3730905">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3730985">func</span>&nbsp;<span class="ident" id="3730990">unparen</span><span class="op" id="3730997">(</span><span class="ident" id="3730998">x</span>&nbsp;<span class="ident" id="3731000">ast</span><span class="op" id="3731003">.</span><span class="ident" id="3731004">Expr</span><span class="op" id="3731008">)</span>&nbsp;<span class="ident" id="3731010">ast</span><span class="op" id="3731013">.</span><span class="ident" id="3731014">Expr</span>&nbsp;<span class="op" id="3731019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731022">if</span>&nbsp;<span class="ident" id="3731025">p</span><span class="op" id="3731026">,</span>&nbsp;<span class="ident" id="3731028">isParen</span>&nbsp;<span class="op" id="3731036">:=</span>&nbsp;<span class="ident" id="3731039">x</span><span class="op" id="3731040">.</span><span class="op" id="3731041">(</span><span class="op" id="3731042">*</span><span class="ident" id="3731043">ast</span><span class="op" id="3731046">.</span><span class="ident" id="3731047">ParenExpr</span><span class="op" id="3731056">)</span><span class="op" id="3731057">;</span>&nbsp;<span class="ident" id="3731059">isParen</span>&nbsp;<span class="op" id="3731067">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731071">x</span>&nbsp;<span class="op" id="3731073">=</span>&nbsp;<span class="ident" id="3731075">unparen</span><span class="op" id="3731082">(</span><span class="ident" id="3731083">p</span><span class="op" id="3731084">.</span><span class="ident" id="3731085">X</span><span class="op" id="3731086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731092">return</span>&nbsp;<span class="ident" id="3731099">x</span><br>
<span class="lineno"></span><span class="op" id="3731101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="3731104">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="3731164">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="3731204">//</span><br>
<span class="lineno"></span><span class="keyword" id="3731207">func</span>&nbsp;<span class="op" id="3731212">(</span><span class="ident" id="3731213">p</span>&nbsp;<span class="op" id="3731215">*</span><span class="ident" id="3731216">parser</span><span class="op" id="3731222">)</span>&nbsp;<span class="ident" id="3731224">checkExprOrType</span><span class="op" id="3731239">(</span><span class="ident" id="3731240">x</span>&nbsp;<span class="ident" id="3731242">ast</span><span class="op" id="3731245">.</span><span class="ident" id="3731246">Expr</span><span class="op" id="3731250">)</span>&nbsp;<span class="ident" id="3731252">ast</span><span class="op" id="3731255">.</span><span class="ident" id="3731256">Expr</span>&nbsp;<span class="op" id="3731261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731264">switch</span>&nbsp;<span class="ident" id="3731271">t</span>&nbsp;<span class="op" id="3731273">:=</span>&nbsp;<span class="ident" id="3731276">unparen</span><span class="op" id="3731283">(</span><span class="ident" id="3731284">x</span><span class="op" id="3731285">)</span><span class="op" id="3731286">.</span><span class="op" id="3731287">(</span><span class="keyword" id="3731288">type</span><span class="op" id="3731292">)</span>&nbsp;<span class="op" id="3731294">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731297">case</span>&nbsp;<span class="op" id="3731302">*</span><span class="ident" id="3731303">ast</span><span class="op" id="3731306">.</span><span class="ident" id="3731307">ParenExpr</span><span class="op" id="3731316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3731320">panic</span><span class="op" id="3731325">(</span><span class="string" id="3731326">&#34;unreachable&#34;</span><span class="op" id="3731339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731342">case</span>&nbsp;<span class="op" id="3731347">*</span><span class="ident" id="3731348">ast</span><span class="op" id="3731351">.</span><span class="ident" id="3731352">UnaryExpr</span><span class="op" id="3731361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731364">case</span>&nbsp;<span class="op" id="3731369">*</span><span class="ident" id="3731370">ast</span><span class="op" id="3731373">.</span><span class="ident" id="3731374">ArrayType</span><span class="op" id="3731383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731387">if</span>&nbsp;<span class="builtinfunc" id="3731390">len</span><span class="op" id="3731393">,</span>&nbsp;<span class="ident" id="3731395">isEllipsis</span>&nbsp;<span class="op" id="3731406">:=</span>&nbsp;<span class="ident" id="3731409">t</span><span class="op" id="3731410">.</span><span class="ident" id="3731411">Len</span><span class="op" id="3731414">.</span><span class="op" id="3731415">(</span><span class="op" id="3731416">*</span><span class="ident" id="3731417">ast</span><span class="op" id="3731420">.</span><span class="ident" id="3731421">Ellipsis</span><span class="op" id="3731429">)</span><span class="op" id="3731430">;</span>&nbsp;<span class="ident" id="3731432">isEllipsis</span>&nbsp;<span class="op" id="3731443">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731448">p</span><span class="op" id="3731449">.</span><span class="builtintype" id="3731450">error</span><span class="op" id="3731455">(</span><span class="builtinfunc" id="3731456">len</span><span class="op" id="3731459">.</span><span class="ident" id="3731460">Pos</span><span class="op" id="3731463">(</span><span class="op" id="3731464">)</span><span class="op" id="3731465">,</span>&nbsp;<span class="string" id="3731467">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="3731503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731508">x</span>&nbsp;<span class="op" id="3731510">=</span>&nbsp;<span class="op" id="3731512">&amp;</span><span class="ident" id="3731513">ast</span><span class="op" id="3731516">.</span><span class="ident" id="3731517">BadExpr</span><span class="op" id="3731524">{</span><span class="ident" id="3731525">From</span><span class="op" id="3731529">:</span>&nbsp;<span class="ident" id="3731531">x</span><span class="op" id="3731532">.</span><span class="ident" id="3731533">Pos</span><span class="op" id="3731536">(</span><span class="op" id="3731537">)</span><span class="op" id="3731538">,</span>&nbsp;<span class="ident" id="3731540">To</span><span class="op" id="3731542">:</span>&nbsp;<span class="ident" id="3731544">p</span><span class="op" id="3731545">.</span><span class="ident" id="3731546">safePos</span><span class="op" id="3731553">(</span><span class="ident" id="3731554">x</span><span class="op" id="3731555">.</span><span class="ident" id="3731556">End</span><span class="op" id="3731559">(</span><span class="op" id="3731560">)</span><span class="op" id="3731561">)</span><span class="op" id="3731562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731573">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731618">return</span>&nbsp;<span class="ident" id="3731625">x</span><br>
<span class="lineno"></span><span class="op" id="3731627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3731630">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="3731700">func</span>&nbsp;<span class="op" id="3731705">(</span><span class="ident" id="3731706">p</span>&nbsp;<span class="op" id="3731708">*</span><span class="ident" id="3731709">parser</span><span class="op" id="3731715">)</span>&nbsp;<span class="ident" id="3731717">parsePrimaryExpr</span><span class="op" id="3731733">(</span><span class="ident" id="3731734">lhs</span>&nbsp;<span class="builtintype" id="3731738">bool</span><span class="op" id="3731742">)</span>&nbsp;<span class="ident" id="3731744">ast</span><span class="op" id="3731747">.</span><span class="ident" id="3731748">Expr</span>&nbsp;<span class="op" id="3731753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731756">if</span>&nbsp;<span class="ident" id="3731759">p</span><span class="op" id="3731760">.</span><span class="ident" id="3731761">trace</span>&nbsp;<span class="op" id="3731767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731771">defer</span>&nbsp;<span class="ident" id="3731777">un</span><span class="op" id="3731779">(</span><span class="ident" id="3731780">trace</span><span class="op" id="3731785">(</span><span class="ident" id="3731786">p</span><span class="op" id="3731787">,</span>&nbsp;<span class="string" id="3731789">&#34;PrimaryExpr&#34;</span><span class="op" id="3731802">)</span><span class="op" id="3731803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731810">x</span>&nbsp;<span class="op" id="3731812">:=</span>&nbsp;<span class="ident" id="3731815">p</span><span class="op" id="3731816">.</span><span class="ident" id="3731817">parseOperand</span><span class="op" id="3731829">(</span><span class="ident" id="3731830">lhs</span><span class="op" id="3731833">)</span><br>
<span class="lineno"></span><span class="ident" id="3731835">L</span><span class="op" id="3731836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731839">for</span>&nbsp;<span class="op" id="3731843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731847">switch</span>&nbsp;<span class="ident" id="3731854">p</span><span class="op" id="3731855">.</span><span class="ident" id="3731856">tok</span>&nbsp;<span class="op" id="3731860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731864">case</span>&nbsp;<span class="ident" id="3731869">token</span><span class="op" id="3731874">.</span><span class="ident" id="3731875">PERIOD</span><span class="op" id="3731881">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731886">p</span><span class="op" id="3731887">.</span><span class="ident" id="3731888">next</span><span class="op" id="3731892">(</span><span class="op" id="3731893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731898">if</span>&nbsp;<span class="ident" id="3731901">lhs</span>&nbsp;<span class="op" id="3731905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731911">p</span><span class="op" id="3731912">.</span><span class="ident" id="3731913">resolve</span><span class="op" id="3731920">(</span><span class="ident" id="3731921">x</span><span class="op" id="3731922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731932">switch</span>&nbsp;<span class="ident" id="3731939">p</span><span class="op" id="3731940">.</span><span class="ident" id="3731941">tok</span>&nbsp;<span class="op" id="3731945">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3731950">case</span>&nbsp;<span class="ident" id="3731955">token</span><span class="op" id="3731960">.</span><span class="ident" id="3731961">IDENT</span><span class="op" id="3731966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731972">x</span>&nbsp;<span class="op" id="3731974">=</span>&nbsp;<span class="ident" id="3731976">p</span><span class="op" id="3731977">.</span><span class="ident" id="3731978">parseSelector</span><span class="op" id="3731991">(</span><span class="ident" id="3731992">p</span><span class="op" id="3731993">.</span><span class="ident" id="3731994">checkExprOrType</span><span class="op" id="3732009">(</span><span class="ident" id="3732010">x</span><span class="op" id="3732011">)</span><span class="op" id="3732012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732017">case</span>&nbsp;<span class="ident" id="3732022">token</span><span class="op" id="3732027">.</span><span class="ident" id="3732028">LPAREN</span><span class="op" id="3732034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732040">x</span>&nbsp;<span class="op" id="3732042">=</span>&nbsp;<span class="ident" id="3732044">p</span><span class="op" id="3732045">.</span><span class="ident" id="3732046">parseTypeAssertion</span><span class="op" id="3732064">(</span><span class="ident" id="3732065">p</span><span class="op" id="3732066">.</span><span class="ident" id="3732067">checkExpr</span><span class="op" id="3732076">(</span><span class="ident" id="3732077">x</span><span class="op" id="3732078">)</span><span class="op" id="3732079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732084">default</span><span class="op" id="3732091">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732097">pos</span>&nbsp;<span class="op" id="3732101">:=</span>&nbsp;<span class="ident" id="3732104">p</span><span class="op" id="3732105">.</span><span class="ident" id="3732106">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732114">p</span><span class="op" id="3732115">.</span><span class="ident" id="3732116">errorExpected</span><span class="op" id="3732129">(</span><span class="ident" id="3732130">pos</span><span class="op" id="3732133">,</span>&nbsp;<span class="string" id="3732135">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="3732163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732169">p</span><span class="op" id="3732170">.</span><span class="ident" id="3732171">next</span><span class="op" id="3732175">(</span><span class="op" id="3732176">)</span>&nbsp;<span class="comment" id="3732178">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732199">x</span>&nbsp;<span class="op" id="3732201">=</span>&nbsp;<span class="op" id="3732203">&amp;</span><span class="ident" id="3732204">ast</span><span class="op" id="3732207">.</span><span class="ident" id="3732208">BadExpr</span><span class="op" id="3732215">{</span><span class="ident" id="3732216">From</span><span class="op" id="3732220">:</span>&nbsp;<span class="ident" id="3732222">pos</span><span class="op" id="3732225">,</span>&nbsp;<span class="ident" id="3732227">To</span><span class="op" id="3732229">:</span>&nbsp;<span class="ident" id="3732231">p</span><span class="op" id="3732232">.</span><span class="ident" id="3732233">pos</span><span class="op" id="3732236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732241">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732245">case</span>&nbsp;<span class="ident" id="3732250">token</span><span class="op" id="3732255">.</span><span class="ident" id="3732256">LBRACK</span><span class="op" id="3732262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732267">if</span>&nbsp;<span class="ident" id="3732270">lhs</span>&nbsp;<span class="op" id="3732274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732280">p</span><span class="op" id="3732281">.</span><span class="ident" id="3732282">resolve</span><span class="op" id="3732289">(</span><span class="ident" id="3732290">x</span><span class="op" id="3732291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732301">x</span>&nbsp;<span class="op" id="3732303">=</span>&nbsp;<span class="ident" id="3732305">p</span><span class="op" id="3732306">.</span><span class="ident" id="3732307">parseIndexOrSlice</span><span class="op" id="3732324">(</span><span class="ident" id="3732325">p</span><span class="op" id="3732326">.</span><span class="ident" id="3732327">checkExpr</span><span class="op" id="3732336">(</span><span class="ident" id="3732337">x</span><span class="op" id="3732338">)</span><span class="op" id="3732339">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732343">case</span>&nbsp;<span class="ident" id="3732348">token</span><span class="op" id="3732353">.</span><span class="ident" id="3732354">LPAREN</span><span class="op" id="3732360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732365">if</span>&nbsp;<span class="ident" id="3732368">lhs</span>&nbsp;<span class="op" id="3732372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732378">p</span><span class="op" id="3732379">.</span><span class="ident" id="3732380">resolve</span><span class="op" id="3732387">(</span><span class="ident" id="3732388">x</span><span class="op" id="3732389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732399">x</span>&nbsp;<span class="op" id="3732401">=</span>&nbsp;<span class="ident" id="3732403">p</span><span class="op" id="3732404">.</span><span class="ident" id="3732405">parseCallOrConversion</span><span class="op" id="3732426">(</span><span class="ident" id="3732427">p</span><span class="op" id="3732428">.</span><span class="ident" id="3732429">checkExprOrType</span><span class="op" id="3732444">(</span><span class="ident" id="3732445">x</span><span class="op" id="3732446">)</span><span class="op" id="3732447">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732451">case</span>&nbsp;<span class="ident" id="3732456">token</span><span class="op" id="3732461">.</span><span class="ident" id="3732462">LBRACE</span><span class="op" id="3732468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732473">if</span>&nbsp;<span class="ident" id="3732476">isLiteralType</span><span class="op" id="3732489">(</span><span class="ident" id="3732490">x</span><span class="op" id="3732491">)</span>&nbsp;<span class="op" id="3732493">&amp;&amp;</span>&nbsp;<span class="op" id="3732496">(</span><span class="ident" id="3732497">p</span><span class="op" id="3732498">.</span><span class="ident" id="3732499">exprLev</span>&nbsp;<span class="op" id="3732507">&gt;=</span>&nbsp;<span class="num" id="3732510">0</span>&nbsp;<span class="op" id="3732512">||</span>&nbsp;<span class="op" id="3732515">!</span><span class="ident" id="3732516">isTypeName</span><span class="op" id="3732526">(</span><span class="ident" id="3732527">x</span><span class="op" id="3732528">)</span><span class="op" id="3732529">)</span>&nbsp;<span class="op" id="3732531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732537">if</span>&nbsp;<span class="ident" id="3732540">lhs</span>&nbsp;<span class="op" id="3732544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732551">p</span><span class="op" id="3732552">.</span><span class="ident" id="3732553">resolve</span><span class="op" id="3732560">(</span><span class="ident" id="3732561">x</span><span class="op" id="3732562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732568">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732574">x</span>&nbsp;<span class="op" id="3732576">=</span>&nbsp;<span class="ident" id="3732578">p</span><span class="op" id="3732579">.</span><span class="ident" id="3732580">parseLiteralValue</span><span class="op" id="3732597">(</span><span class="ident" id="3732598">x</span><span class="op" id="3732599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732604">}</span>&nbsp;<span class="keyword" id="3732606">else</span>&nbsp;<span class="op" id="3732611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732617">break</span>&nbsp;<span class="ident" id="3732623">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732632">default</span><span class="op" id="3732639">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732644">break</span>&nbsp;<span class="ident" id="3732650">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732658">lhs</span>&nbsp;<span class="op" id="3732662">=</span>&nbsp;<span class="builtintype" id="3732664">false</span>&nbsp;<span class="comment" id="3732670">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732710">return</span>&nbsp;<span class="ident" id="3732717">x</span><br>
<span class="lineno"></span><span class="op" id="3732719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3732722">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3732792">func</span>&nbsp;<span class="op" id="3732797">(</span><span class="ident" id="3732798">p</span>&nbsp;<span class="op" id="3732800">*</span><span class="ident" id="3732801">parser</span><span class="op" id="3732807">)</span>&nbsp;<span class="ident" id="3732809">parseUnaryExpr</span><span class="op" id="3732823">(</span><span class="ident" id="3732824">lhs</span>&nbsp;<span class="builtintype" id="3732828">bool</span><span class="op" id="3732832">)</span>&nbsp;<span class="ident" id="3732834">ast</span><span class="op" id="3732837">.</span><span class="ident" id="3732838">Expr</span>&nbsp;<span class="op" id="3732843">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732846">if</span>&nbsp;<span class="ident" id="3732849">p</span><span class="op" id="3732850">.</span><span class="ident" id="3732851">trace</span>&nbsp;<span class="op" id="3732857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732861">defer</span>&nbsp;<span class="ident" id="3732867">un</span><span class="op" id="3732869">(</span><span class="ident" id="3732870">trace</span><span class="op" id="3732875">(</span><span class="ident" id="3732876">p</span><span class="op" id="3732877">,</span>&nbsp;<span class="string" id="3732879">&#34;UnaryExpr&#34;</span><span class="op" id="3732890">)</span><span class="op" id="3732891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3732894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732898">switch</span>&nbsp;<span class="ident" id="3732905">p</span><span class="op" id="3732906">.</span><span class="ident" id="3732907">tok</span>&nbsp;<span class="op" id="3732911">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3732914">case</span>&nbsp;<span class="ident" id="3732919">token</span><span class="op" id="3732924">.</span><span class="ident" id="3732925">ADD</span><span class="op" id="3732928">,</span>&nbsp;<span class="ident" id="3732930">token</span><span class="op" id="3732935">.</span><span class="ident" id="3732936">SUB</span><span class="op" id="3732939">,</span>&nbsp;<span class="ident" id="3732941">token</span><span class="op" id="3732946">.</span><span class="ident" id="3732947">NOT</span><span class="op" id="3732950">,</span>&nbsp;<span class="ident" id="3732952">token</span><span class="op" id="3732957">.</span><span class="ident" id="3732958">XOR</span><span class="op" id="3732961">,</span>&nbsp;<span class="ident" id="3732963">token</span><span class="op" id="3732968">.</span><span class="ident" id="3732969">AND</span><span class="op" id="3732972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732976">pos</span><span class="op" id="3732979">,</span>&nbsp;<span class="ident" id="3732981">op</span>&nbsp;<span class="op" id="3732984">:=</span>&nbsp;<span class="ident" id="3732987">p</span><span class="op" id="3732988">.</span><span class="ident" id="3732989">pos</span><span class="op" id="3732992">,</span>&nbsp;<span class="ident" id="3732994">p</span><span class="op" id="3732995">.</span><span class="ident" id="3732996">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733002">p</span><span class="op" id="3733003">.</span><span class="ident" id="3733004">next</span><span class="op" id="3733008">(</span><span class="op" id="3733009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733013">x</span>&nbsp;<span class="op" id="3733015">:=</span>&nbsp;<span class="ident" id="3733018">p</span><span class="op" id="3733019">.</span><span class="ident" id="3733020">parseUnaryExpr</span><span class="op" id="3733034">(</span><span class="builtintype" id="3733035">false</span><span class="op" id="3733040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3733044">return</span>&nbsp;<span class="op" id="3733051">&amp;</span><span class="ident" id="3733052">ast</span><span class="op" id="3733055">.</span><span class="ident" id="3733056">UnaryExpr</span><span class="op" id="3733065">{</span><span class="ident" id="3733066">OpPos</span><span class="op" id="3733071">:</span>&nbsp;<span class="ident" id="3733073">pos</span><span class="op" id="3733076">,</span>&nbsp;<span class="ident" id="3733078">Op</span><span class="op" id="3733080">:</span>&nbsp;<span class="ident" id="3733082">op</span><span class="op" id="3733084">,</span>&nbsp;<span class="ident" id="3733086">X</span><span class="op" id="3733087">:</span>&nbsp;<span class="ident" id="3733089">p</span><span class="op" id="3733090">.</span><span class="ident" id="3733091">checkExpr</span><span class="op" id="3733100">(</span><span class="ident" id="3733101">x</span><span class="op" id="3733102">)</span><span class="op" id="3733103">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3733107">case</span>&nbsp;<span class="ident" id="3733112">token</span><span class="op" id="3733117">.</span><span class="ident" id="3733118">ARROW</span><span class="op" id="3733123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733127">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733167">arrow</span>&nbsp;<span class="op" id="3733173">:=</span>&nbsp;<span class="ident" id="3733176">p</span><span class="op" id="3733177">.</span><span class="ident" id="3733178">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733184">p</span><span class="op" id="3733185">.</span><span class="ident" id="3733186">next</span><span class="op" id="3733190">(</span><span class="op" id="3733191">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733196">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733259">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733320">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733383">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733403">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733408">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733457">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733517">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733522">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733583">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733621">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733626">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733669">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733717">x</span>&nbsp;<span class="op" id="3733719">:=</span>&nbsp;<span class="ident" id="3733722">p</span><span class="op" id="3733723">.</span><span class="ident" id="3733724">parseUnaryExpr</span><span class="op" id="3733738">(</span><span class="builtintype" id="3733739">false</span><span class="op" id="3733744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733749">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3733783">if</span>&nbsp;<span class="ident" id="3733786">typ</span><span class="op" id="3733789">,</span>&nbsp;<span class="ident" id="3733791">ok</span>&nbsp;<span class="op" id="3733794">:=</span>&nbsp;<span class="ident" id="3733797">x</span><span class="op" id="3733798">.</span><span class="op" id="3733799">(</span><span class="op" id="3733800">*</span><span class="ident" id="3733801">ast</span><span class="op" id="3733804">.</span><span class="ident" id="3733805">ChanType</span><span class="op" id="3733813">)</span><span class="op" id="3733814">;</span>&nbsp;<span class="ident" id="3733816">ok</span>&nbsp;<span class="op" id="3733819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733824">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733840">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733880">dir</span>&nbsp;<span class="op" id="3733884">:=</span>&nbsp;<span class="ident" id="3733887">ast</span><span class="op" id="3733890">.</span><span class="ident" id="3733891">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3733899">for</span>&nbsp;<span class="ident" id="3733903">ok</span>&nbsp;<span class="op" id="3733906">&amp;&amp;</span>&nbsp;<span class="ident" id="3733909">dir</span>&nbsp;<span class="op" id="3733913">==</span>&nbsp;<span class="ident" id="3733916">ast</span><span class="op" id="3733919">.</span><span class="ident" id="3733920">SEND</span>&nbsp;<span class="op" id="3733925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3733931">if</span>&nbsp;<span class="ident" id="3733934">typ</span><span class="op" id="3733937">.</span><span class="ident" id="3733938">Dir</span>&nbsp;<span class="op" id="3733942">==</span>&nbsp;<span class="ident" id="3733945">ast</span><span class="op" id="3733948">.</span><span class="ident" id="3733949">RECV</span>&nbsp;<span class="op" id="3733954">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733961">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734003">p</span><span class="op" id="3734004">.</span><span class="ident" id="3734005">errorExpected</span><span class="op" id="3734018">(</span><span class="ident" id="3734019">typ</span><span class="op" id="3734022">.</span><span class="ident" id="3734023">Arrow</span><span class="op" id="3734028">,</span>&nbsp;<span class="string" id="3734030">&#34;&#39;chan&#39;&#34;</span><span class="op" id="3734038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734050">arrow</span><span class="op" id="3734055">,</span>&nbsp;<span class="ident" id="3734057">typ</span><span class="op" id="3734060">.</span><span class="ident" id="3734061">Begin</span><span class="op" id="3734066">,</span>&nbsp;<span class="ident" id="3734068">typ</span><span class="op" id="3734071">.</span><span class="ident" id="3734072">Arrow</span>&nbsp;<span class="op" id="3734078">=</span>&nbsp;<span class="ident" id="3734080">typ</span><span class="op" id="3734083">.</span><span class="ident" id="3734084">Arrow</span><span class="op" id="3734089">,</span>&nbsp;<span class="ident" id="3734091">arrow</span><span class="op" id="3734096">,</span>&nbsp;<span class="ident" id="3734098">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734108">dir</span><span class="op" id="3734111">,</span>&nbsp;<span class="ident" id="3734113">typ</span><span class="op" id="3734116">.</span><span class="ident" id="3734117">Dir</span>&nbsp;<span class="op" id="3734121">=</span>&nbsp;<span class="ident" id="3734123">typ</span><span class="op" id="3734126">.</span><span class="ident" id="3734127">Dir</span><span class="op" id="3734130">,</span>&nbsp;<span class="ident" id="3734132">ast</span><span class="op" id="3734135">.</span><span class="ident" id="3734136">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734145">typ</span><span class="op" id="3734148">,</span>&nbsp;<span class="ident" id="3734150">ok</span>&nbsp;<span class="op" id="3734153">=</span>&nbsp;<span class="ident" id="3734155">typ</span><span class="op" id="3734158">.</span><span class="ident" id="3734159">Value</span><span class="op" id="3734164">.</span><span class="op" id="3734165">(</span><span class="op" id="3734166">*</span><span class="ident" id="3734167">ast</span><span class="op" id="3734170">.</span><span class="ident" id="3734171">ChanType</span><span class="op" id="3734179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734189">if</span>&nbsp;<span class="ident" id="3734192">dir</span>&nbsp;<span class="op" id="3734196">==</span>&nbsp;<span class="ident" id="3734199">ast</span><span class="op" id="3734202">.</span><span class="ident" id="3734203">SEND</span>&nbsp;<span class="op" id="3734208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734214">p</span><span class="op" id="3734215">.</span><span class="ident" id="3734216">errorExpected</span><span class="op" id="3734229">(</span><span class="ident" id="3734230">arrow</span><span class="op" id="3734235">,</span>&nbsp;<span class="string" id="3734237">&#34;channel&nbsp;type&#34;</span><span class="op" id="3734251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734256">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734262">return</span>&nbsp;<span class="ident" id="3734269">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734278">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734292">return</span>&nbsp;<span class="op" id="3734299">&amp;</span><span class="ident" id="3734300">ast</span><span class="op" id="3734303">.</span><span class="ident" id="3734304">UnaryExpr</span><span class="op" id="3734313">{</span><span class="ident" id="3734314">OpPos</span><span class="op" id="3734319">:</span>&nbsp;<span class="ident" id="3734321">arrow</span><span class="op" id="3734326">,</span>&nbsp;<span class="ident" id="3734328">Op</span><span class="op" id="3734330">:</span>&nbsp;<span class="ident" id="3734332">token</span><span class="op" id="3734337">.</span><span class="ident" id="3734338">ARROW</span><span class="op" id="3734343">,</span>&nbsp;<span class="ident" id="3734345">X</span><span class="op" id="3734346">:</span>&nbsp;<span class="ident" id="3734348">p</span><span class="op" id="3734349">.</span><span class="ident" id="3734350">checkExpr</span><span class="op" id="3734359">(</span><span class="ident" id="3734360">x</span><span class="op" id="3734361">)</span><span class="op" id="3734362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734366">case</span>&nbsp;<span class="ident" id="3734371">token</span><span class="op" id="3734376">.</span><span class="ident" id="3734377">MUL</span><span class="op" id="3734380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734384">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734426">pos</span>&nbsp;<span class="op" id="3734430">:=</span>&nbsp;<span class="ident" id="3734433">p</span><span class="op" id="3734434">.</span><span class="ident" id="3734435">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734441">p</span><span class="op" id="3734442">.</span><span class="ident" id="3734443">next</span><span class="op" id="3734447">(</span><span class="op" id="3734448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734452">x</span>&nbsp;<span class="op" id="3734454">:=</span>&nbsp;<span class="ident" id="3734457">p</span><span class="op" id="3734458">.</span><span class="ident" id="3734459">parseUnaryExpr</span><span class="op" id="3734473">(</span><span class="builtintype" id="3734474">false</span><span class="op" id="3734479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734483">return</span>&nbsp;<span class="op" id="3734490">&amp;</span><span class="ident" id="3734491">ast</span><span class="op" id="3734494">.</span><span class="ident" id="3734495">StarExpr</span><span class="op" id="3734503">{</span><span class="ident" id="3734504">Star</span><span class="op" id="3734508">:</span>&nbsp;<span class="ident" id="3734510">pos</span><span class="op" id="3734513">,</span>&nbsp;<span class="ident" id="3734515">X</span><span class="op" id="3734516">:</span>&nbsp;<span class="ident" id="3734518">p</span><span class="op" id="3734519">.</span><span class="ident" id="3734520">checkExprOrType</span><span class="op" id="3734535">(</span><span class="ident" id="3734536">x</span><span class="op" id="3734537">)</span><span class="op" id="3734538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734545">return</span>&nbsp;<span class="ident" id="3734552">p</span><span class="op" id="3734553">.</span><span class="ident" id="3734554">parsePrimaryExpr</span><span class="op" id="3734570">(</span><span class="ident" id="3734571">lhs</span><span class="op" id="3734574">)</span><br>
<span class="lineno"></span><span class="op" id="3734576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3734579">func</span>&nbsp;<span class="op" id="3734584">(</span><span class="ident" id="3734585">p</span>&nbsp;<span class="op" id="3734587">*</span><span class="ident" id="3734588">parser</span><span class="op" id="3734594">)</span>&nbsp;<span class="ident" id="3734596">tokPrec</span><span class="op" id="3734603">(</span><span class="op" id="3734604">)</span>&nbsp;<span class="op" id="3734606">(</span><span class="ident" id="3734607">token</span><span class="op" id="3734612">.</span><span class="ident" id="3734613">Token</span><span class="op" id="3734618">,</span>&nbsp;<span class="builtintype" id="3734620">int</span><span class="op" id="3734623">)</span>&nbsp;<span class="op" id="3734625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734628">tok</span>&nbsp;<span class="op" id="3734632">:=</span>&nbsp;<span class="ident" id="3734635">p</span><span class="op" id="3734636">.</span><span class="ident" id="3734637">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734642">if</span>&nbsp;<span class="ident" id="3734645">p</span><span class="op" id="3734646">.</span><span class="ident" id="3734647">inRhs</span>&nbsp;<span class="op" id="3734653">&amp;&amp;</span>&nbsp;<span class="ident" id="3734656">tok</span>&nbsp;<span class="op" id="3734660">==</span>&nbsp;<span class="ident" id="3734663">token</span><span class="op" id="3734668">.</span><span class="ident" id="3734669">ASSIGN</span>&nbsp;<span class="op" id="3734676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734680">tok</span>&nbsp;<span class="op" id="3734684">=</span>&nbsp;<span class="ident" id="3734686">token</span><span class="op" id="3734691">.</span><span class="ident" id="3734692">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734700">return</span>&nbsp;<span class="ident" id="3734707">tok</span><span class="op" id="3734710">,</span>&nbsp;<span class="ident" id="3734712">tok</span><span class="op" id="3734715">.</span><span class="ident" id="3734716">Precedence</span><span class="op" id="3734726">(</span><span class="op" id="3734727">)</span><br>
<span class="lineno"></span><span class="op" id="3734729">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="3734732">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3734802">func</span>&nbsp;<span class="op" id="3734807">(</span><span class="ident" id="3734808">p</span>&nbsp;<span class="op" id="3734810">*</span><span class="ident" id="3734811">parser</span><span class="op" id="3734817">)</span>&nbsp;<span class="ident" id="3734819">parseBinaryExpr</span><span class="op" id="3734834">(</span><span class="ident" id="3734835">lhs</span>&nbsp;<span class="builtintype" id="3734839">bool</span><span class="op" id="3734843">,</span>&nbsp;<span class="ident" id="3734845">prec1</span>&nbsp;<span class="builtintype" id="3734851">int</span><span class="op" id="3734854">)</span>&nbsp;<span class="ident" id="3734856">ast</span><span class="op" id="3734859">.</span><span class="ident" id="3734860">Expr</span>&nbsp;<span class="op" id="3734865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734868">if</span>&nbsp;<span class="ident" id="3734871">p</span><span class="op" id="3734872">.</span><span class="ident" id="3734873">trace</span>&nbsp;<span class="op" id="3734879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734883">defer</span>&nbsp;<span class="ident" id="3734889">un</span><span class="op" id="3734891">(</span><span class="ident" id="3734892">trace</span><span class="op" id="3734897">(</span><span class="ident" id="3734898">p</span><span class="op" id="3734899">,</span>&nbsp;<span class="string" id="3734901">&#34;BinaryExpr&#34;</span><span class="op" id="3734913">)</span><span class="op" id="3734914">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3734917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734921">x</span>&nbsp;<span class="op" id="3734923">:=</span>&nbsp;<span class="ident" id="3734926">p</span><span class="op" id="3734927">.</span><span class="ident" id="3734928">parseUnaryExpr</span><span class="op" id="3734942">(</span><span class="ident" id="3734943">lhs</span><span class="op" id="3734946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3734949">for</span>&nbsp;<span class="ident" id="3734953">_</span><span class="op" id="3734954">,</span>&nbsp;<span class="ident" id="3734956">prec</span>&nbsp;<span class="op" id="3734961">:=</span>&nbsp;<span class="ident" id="3734964">p</span><span class="op" id="3734965">.</span><span class="ident" id="3734966">tokPrec</span><span class="op" id="3734973">(</span><span class="op" id="3734974">)</span><span class="op" id="3734975">;</span>&nbsp;<span class="ident" id="3734977">prec</span>&nbsp;<span class="op" id="3734982">&gt;=</span>&nbsp;<span class="ident" id="3734985">prec1</span><span class="op" id="3734990">;</span>&nbsp;<span class="ident" id="3734992">prec</span><span class="op" id="3734996">--</span>&nbsp;<span class="op" id="3734999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735003">for</span>&nbsp;<span class="op" id="3735007">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735012">op</span><span class="op" id="3735014">,</span>&nbsp;<span class="ident" id="3735016">oprec</span>&nbsp;<span class="op" id="3735022">:=</span>&nbsp;<span class="ident" id="3735025">p</span><span class="op" id="3735026">.</span><span class="ident" id="3735027">tokPrec</span><span class="op" id="3735034">(</span><span class="op" id="3735035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735040">if</span>&nbsp;<span class="ident" id="3735043">oprec</span>&nbsp;<span class="op" id="3735049">!=</span>&nbsp;<span class="ident" id="3735052">prec</span>&nbsp;<span class="op" id="3735057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735063">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3735072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735077">pos</span>&nbsp;<span class="op" id="3735081">:=</span>&nbsp;<span class="ident" id="3735084">p</span><span class="op" id="3735085">.</span><span class="ident" id="3735086">expect</span><span class="op" id="3735092">(</span><span class="ident" id="3735093">op</span><span class="op" id="3735095">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735100">if</span>&nbsp;<span class="ident" id="3735103">lhs</span>&nbsp;<span class="op" id="3735107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735113">p</span><span class="op" id="3735114">.</span><span class="ident" id="3735115">resolve</span><span class="op" id="3735122">(</span><span class="ident" id="3735123">x</span><span class="op" id="3735124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735130">lhs</span>&nbsp;<span class="op" id="3735134">=</span>&nbsp;<span class="builtintype" id="3735136">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3735145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735150">y</span>&nbsp;<span class="op" id="3735152">:=</span>&nbsp;<span class="ident" id="3735155">p</span><span class="op" id="3735156">.</span><span class="ident" id="3735157">parseBinaryExpr</span><span class="op" id="3735172">(</span><span class="builtintype" id="3735173">false</span><span class="op" id="3735178">,</span>&nbsp;<span class="ident" id="3735180">prec</span><span class="op" id="3735184">+</span><span class="num" id="3735185">1</span><span class="op" id="3735186">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735191">x</span>&nbsp;<span class="op" id="3735193">=</span>&nbsp;<span class="op" id="3735195">&amp;</span><span class="ident" id="3735196">ast</span><span class="op" id="3735199">.</span><span class="ident" id="3735200">BinaryExpr</span><span class="op" id="3735210">{</span><span class="ident" id="3735211">X</span><span class="op" id="3735212">:</span>&nbsp;<span class="ident" id="3735214">p</span><span class="op" id="3735215">.</span><span class="ident" id="3735216">checkExpr</span><span class="op" id="3735225">(</span><span class="ident" id="3735226">x</span><span class="op" id="3735227">)</span><span class="op" id="3735228">,</span>&nbsp;<span class="ident" id="3735230">OpPos</span><span class="op" id="3735235">:</span>&nbsp;<span class="ident" id="3735237">pos</span><span class="op" id="3735240">,</span>&nbsp;<span class="ident" id="3735242">Op</span><span class="op" id="3735244">:</span>&nbsp;<span class="ident" id="3735246">op</span><span class="op" id="3735248">,</span>&nbsp;<span class="ident" id="3735250">Y</span><span class="op" id="3735251">:</span>&nbsp;<span class="ident" id="3735253">p</span><span class="op" id="3735254">.</span><span class="ident" id="3735255">checkExpr</span><span class="op" id="3735264">(</span><span class="ident" id="3735265">y</span><span class="op" id="3735266">)</span><span class="op" id="3735267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3735271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3735274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735278">return</span>&nbsp;<span class="ident" id="3735285">x</span><br>
<span class="lineno">1590</span><span class="op" id="3735287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3735290">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="3735360">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3735432">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="3735503">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="3735515">func</span>&nbsp;<span class="op" id="3735520">(</span><span class="ident" id="3735521">p</span>&nbsp;<span class="op" id="3735523">*</span><span class="ident" id="3735524">parser</span><span class="op" id="3735530">)</span>&nbsp;<span class="ident" id="3735532">parseExpr</span><span class="op" id="3735541">(</span><span class="ident" id="3735542">lhs</span>&nbsp;<span class="builtintype" id="3735546">bool</span><span class="op" id="3735550">)</span>&nbsp;<span class="ident" id="3735552">ast</span><span class="op" id="3735555">.</span><span class="ident" id="3735556">Expr</span>&nbsp;<span class="op" id="3735561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735564">if</span>&nbsp;<span class="ident" id="3735567">p</span><span class="op" id="3735568">.</span><span class="ident" id="3735569">trace</span>&nbsp;<span class="op" id="3735575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735579">defer</span>&nbsp;<span class="ident" id="3735585">un</span><span class="op" id="3735587">(</span><span class="ident" id="3735588">trace</span><span class="op" id="3735593">(</span><span class="ident" id="3735594">p</span><span class="op" id="3735595">,</span>&nbsp;<span class="string" id="3735597">&#34;Expression&#34;</span><span class="op" id="3735609">)</span><span class="op" id="3735610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3735613">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735617">return</span>&nbsp;<span class="ident" id="3735624">p</span><span class="op" id="3735625">.</span><span class="ident" id="3735626">parseBinaryExpr</span><span class="op" id="3735641">(</span><span class="ident" id="3735642">lhs</span><span class="op" id="3735645">,</span>&nbsp;<span class="ident" id="3735647">token</span><span class="op" id="3735652">.</span><span class="ident" id="3735653">LowestPrec</span><span class="op" id="3735663">+</span><span class="num" id="3735664">1</span><span class="op" id="3735665">)</span><br>
<span class="lineno"></span><span class="op" id="3735667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3735670">func</span>&nbsp;<span class="op" id="3735675">(</span><span class="ident" id="3735676">p</span>&nbsp;<span class="op" id="3735678">*</span><span class="ident" id="3735679">parser</span><span class="op" id="3735685">)</span>&nbsp;<span class="ident" id="3735687">parseRhs</span><span class="op" id="3735695">(</span><span class="op" id="3735696">)</span>&nbsp;<span class="ident" id="3735698">ast</span><span class="op" id="3735701">.</span><span class="ident" id="3735702">Expr</span>&nbsp;<span class="op" id="3735707">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735710">old</span>&nbsp;<span class="op" id="3735714">:=</span>&nbsp;<span class="ident" id="3735717">p</span><span class="op" id="3735718">.</span><span class="ident" id="3735719">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735726">p</span><span class="op" id="3735727">.</span><span class="ident" id="3735728">inRhs</span>&nbsp;<span class="op" id="3735734">=</span>&nbsp;<span class="builtintype" id="3735736">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735742">x</span>&nbsp;<span class="op" id="3735744">:=</span>&nbsp;<span class="ident" id="3735747">p</span><span class="op" id="3735748">.</span><span class="ident" id="3735749">checkExpr</span><span class="op" id="3735758">(</span><span class="ident" id="3735759">p</span><span class="op" id="3735760">.</span><span class="ident" id="3735761">parseExpr</span><span class="op" id="3735770">(</span><span class="builtintype" id="3735771">false</span><span class="op" id="3735776">)</span><span class="op" id="3735777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735780">p</span><span class="op" id="3735781">.</span><span class="ident" id="3735782">inRhs</span>&nbsp;<span class="op" id="3735788">=</span>&nbsp;<span class="ident" id="3735790">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735795">return</span>&nbsp;<span class="ident" id="3735802">x</span><br>
<span class="lineno">1610</span><span class="op" id="3735804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3735807">func</span>&nbsp;<span class="op" id="3735812">(</span><span class="ident" id="3735813">p</span>&nbsp;<span class="op" id="3735815">*</span><span class="ident" id="3735816">parser</span><span class="op" id="3735822">)</span>&nbsp;<span class="ident" id="3735824">parseRhsOrType</span><span class="op" id="3735838">(</span><span class="op" id="3735839">)</span>&nbsp;<span class="ident" id="3735841">ast</span><span class="op" id="3735844">.</span><span class="ident" id="3735845">Expr</span>&nbsp;<span class="op" id="3735850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735853">old</span>&nbsp;<span class="op" id="3735857">:=</span>&nbsp;<span class="ident" id="3735860">p</span><span class="op" id="3735861">.</span><span class="ident" id="3735862">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735869">p</span><span class="op" id="3735870">.</span><span class="ident" id="3735871">inRhs</span>&nbsp;<span class="op" id="3735877">=</span>&nbsp;<span class="builtintype" id="3735879">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735885">x</span>&nbsp;<span class="op" id="3735887">:=</span>&nbsp;<span class="ident" id="3735890">p</span><span class="op" id="3735891">.</span><span class="ident" id="3735892">checkExprOrType</span><span class="op" id="3735907">(</span><span class="ident" id="3735908">p</span><span class="op" id="3735909">.</span><span class="ident" id="3735910">parseExpr</span><span class="op" id="3735919">(</span><span class="builtintype" id="3735920">false</span><span class="op" id="3735925">)</span><span class="op" id="3735926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735929">p</span><span class="op" id="3735930">.</span><span class="ident" id="3735931">inRhs</span>&nbsp;<span class="op" id="3735937">=</span>&nbsp;<span class="ident" id="3735939">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3735944">return</span>&nbsp;<span class="ident" id="3735951">x</span><br>
<span class="lineno"></span><span class="op" id="3735953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="3735956">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3736036">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3736051">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="3736089">const</span>&nbsp;<span class="op" id="3736095">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736098">basic</span>&nbsp;<span class="op" id="3736104">=</span>&nbsp;<span class="ident" id="3736106">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736112">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736121">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="3736129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="3736132">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="3736206">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3736280">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3736354">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="3736425">func</span>&nbsp;<span class="op" id="3736430">(</span><span class="ident" id="3736431">p</span>&nbsp;<span class="op" id="3736433">*</span><span class="ident" id="3736434">parser</span><span class="op" id="3736440">)</span>&nbsp;<span class="ident" id="3736442">parseSimpleStmt</span><span class="op" id="3736457">(</span><span class="ident" id="3736458">mode</span>&nbsp;<span class="builtintype" id="3736463">int</span><span class="op" id="3736466">)</span>&nbsp;<span class="op" id="3736468">(</span><span class="ident" id="3736469">ast</span><span class="op" id="3736472">.</span><span class="ident" id="3736473">Stmt</span><span class="op" id="3736477">,</span>&nbsp;<span class="builtintype" id="3736479">bool</span><span class="op" id="3736483">)</span>&nbsp;<span class="op" id="3736485">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3736488">if</span>&nbsp;<span class="ident" id="3736491">p</span><span class="op" id="3736492">.</span><span class="ident" id="3736493">trace</span>&nbsp;<span class="op" id="3736499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3736503">defer</span>&nbsp;<span class="ident" id="3736509">un</span><span class="op" id="3736511">(</span><span class="ident" id="3736512">trace</span><span class="op" id="3736517">(</span><span class="ident" id="3736518">p</span><span class="op" id="3736519">,</span>&nbsp;<span class="string" id="3736521">&#34;SimpleStmt&#34;</span><span class="op" id="3736533">)</span><span class="op" id="3736534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3736537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736541">x</span>&nbsp;<span class="op" id="3736543">:=</span>&nbsp;<span class="ident" id="3736546">p</span><span class="op" id="3736547">.</span><span class="ident" id="3736548">parseLhsList</span><span class="op" id="3736560">(</span><span class="op" id="3736561">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3736565">switch</span>&nbsp;<span class="ident" id="3736572">p</span><span class="op" id="3736573">.</span><span class="ident" id="3736574">tok</span>&nbsp;<span class="op" id="3736578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3736581">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736588">token</span><span class="op" id="3736593">.</span><span class="ident" id="3736594">DEFINE</span><span class="op" id="3736600">,</span>&nbsp;<span class="ident" id="3736602">token</span><span class="op" id="3736607">.</span><span class="ident" id="3736608">ASSIGN</span><span class="op" id="3736614">,</span>&nbsp;<span class="ident" id="3736616">token</span><span class="op" id="3736621">.</span><span class="ident" id="3736622">ADD_ASSIGN</span><span class="op" id="3736632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736636">token</span><span class="op" id="3736641">.</span><span class="ident" id="3736642">SUB_ASSIGN</span><span class="op" id="3736652">,</span>&nbsp;<span class="ident" id="3736654">token</span><span class="op" id="3736659">.</span><span class="ident" id="3736660">MUL_ASSIGN</span><span class="op" id="3736670">,</span>&nbsp;<span class="ident" id="3736672">token</span><span class="op" id="3736677">.</span><span class="ident" id="3736678">QUO_ASSIGN</span><span class="op" id="3736688">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736692">token</span><span class="op" id="3736697">.</span><span class="ident" id="3736698">REM_ASSIGN</span><span class="op" id="3736708">,</span>&nbsp;<span class="ident" id="3736710">token</span><span class="op" id="3736715">.</span><span class="ident" id="3736716">AND_ASSIGN</span><span class="op" id="3736726">,</span>&nbsp;<span class="ident" id="3736728">token</span><span class="op" id="3736733">.</span><span class="ident" id="3736734">OR_ASSIGN</span><span class="op" id="3736743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736747">token</span><span class="op" id="3736752">.</span><span class="ident" id="3736753">XOR_ASSIGN</span><span class="op" id="3736763">,</span>&nbsp;<span class="ident" id="3736765">token</span><span class="op" id="3736770">.</span><span class="ident" id="3736771">SHL_ASSIGN</span><span class="op" id="3736781">,</span>&nbsp;<span class="ident" id="3736783">token</span><span class="op" id="3736788">.</span><span class="ident" id="3736789">SHR_ASSIGN</span><span class="op" id="3736799">,</span>&nbsp;<span class="ident" id="3736801">token</span><span class="op" id="3736806">.</span><span class="ident" id="3736807">AND_NOT_ASSIGN</span><span class="op" id="3736821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736825">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736884">pos</span><span class="op" id="3736887">,</span>&nbsp;<span class="ident" id="3736889">tok</span>&nbsp;<span class="op" id="3736893">:=</span>&nbsp;<span class="ident" id="3736896">p</span><span class="op" id="3736897">.</span><span class="ident" id="3736898">pos</span><span class="op" id="3736901">,</span>&nbsp;<span class="ident" id="3736903">p</span><span class="op" id="3736904">.</span><span class="ident" id="3736905">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736911">p</span><span class="op" id="3736912">.</span><span class="ident" id="3736913">next</span><span class="op" id="3736917">(</span><span class="op" id="3736918">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3736922">var</span>&nbsp;<span class="ident" id="3736926">y</span>&nbsp;<span class="op" id="3736928">[</span><span class="op" id="3736929">]</span><span class="ident" id="3736930">ast</span><span class="op" id="3736933">.</span><span class="ident" id="3736934">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736941">isRange</span>&nbsp;<span class="op" id="3736949">:=</span>&nbsp;<span class="builtintype" id="3736952">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3736960">if</span>&nbsp;<span class="ident" id="3736963">mode</span>&nbsp;<span class="op" id="3736968">==</span>&nbsp;<span class="ident" id="3736971">rangeOk</span>&nbsp;<span class="op" id="3736979">&amp;&amp;</span>&nbsp;<span class="ident" id="3736982">p</span><span class="op" id="3736983">.</span><span class="ident" id="3736984">tok</span>&nbsp;<span class="op" id="3736988">==</span>&nbsp;<span class="ident" id="3736991">token</span><span class="op" id="3736996">.</span><span class="ident" id="3736997">RANGE</span>&nbsp;<span class="op" id="3737003">&amp;&amp;</span>&nbsp;<span class="op" id="3737006">(</span><span class="ident" id="3737007">tok</span>&nbsp;<span class="op" id="3737011">==</span>&nbsp;<span class="ident" id="3737014">token</span><span class="op" id="3737019">.</span><span class="ident" id="3737020">DEFINE</span>&nbsp;<span class="op" id="3737027">||</span>&nbsp;<span class="ident" id="3737030">tok</span>&nbsp;<span class="op" id="3737034">==</span>&nbsp;<span class="ident" id="3737037">token</span><span class="op" id="3737042">.</span><span class="ident" id="3737043">ASSIGN</span><span class="op" id="3737049">)</span>&nbsp;<span class="op" id="3737051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737056">pos</span>&nbsp;<span class="op" id="3737060">:=</span>&nbsp;<span class="ident" id="3737063">p</span><span class="op" id="3737064">.</span><span class="ident" id="3737065">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737072">p</span><span class="op" id="3737073">.</span><span class="ident" id="3737074">next</span><span class="op" id="3737078">(</span><span class="op" id="3737079">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737084">y</span>&nbsp;<span class="op" id="3737086">=</span>&nbsp;<span class="op" id="3737088">[</span><span class="op" id="3737089">]</span><span class="ident" id="3737090">ast</span><span class="op" id="3737093">.</span><span class="ident" id="3737094">Expr</span><span class="op" id="3737098">{</span><span class="op" id="3737099">&amp;</span><span class="ident" id="3737100">ast</span><span class="op" id="3737103">.</span><span class="ident" id="3737104">UnaryExpr</span><span class="op" id="3737113">{</span><span class="ident" id="3737114">OpPos</span><span class="op" id="3737119">:</span>&nbsp;<span class="ident" id="3737121">pos</span><span class="op" id="3737124">,</span>&nbsp;<span class="ident" id="3737126">Op</span><span class="op" id="3737128">:</span>&nbsp;<span class="ident" id="3737130">token</span><span class="op" id="3737135">.</span><span class="ident" id="3737136">RANGE</span><span class="op" id="3737141">,</span>&nbsp;<span class="ident" id="3737143">X</span><span class="op" id="3737144">:</span>&nbsp;<span class="ident" id="3737146">p</span><span class="op" id="3737147">.</span><span class="ident" id="3737148">parseRhs</span><span class="op" id="3737156">(</span><span class="op" id="3737157">)</span><span class="op" id="3737158">}</span><span class="op" id="3737159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737164">isRange</span>&nbsp;<span class="op" id="3737172">=</span>&nbsp;<span class="builtintype" id="3737174">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3737181">}</span>&nbsp;<span class="keyword" id="3737183">else</span>&nbsp;<span class="op" id="3737188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737193">y</span>&nbsp;<span class="op" id="3737195">=</span>&nbsp;<span class="ident" id="3737197">p</span><span class="op" id="3737198">.</span><span class="ident" id="3737199">parseRhsList</span><span class="op" id="3737211">(</span><span class="op" id="3737212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3737216">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737220">as</span>&nbsp;<span class="op" id="3737223">:=</span>&nbsp;<span class="op" id="3737226">&amp;</span><span class="ident" id="3737227">ast</span><span class="op" id="3737230">.</span><span class="ident" id="3737231">AssignStmt</span><span class="op" id="3737241">{</span><span class="ident" id="3737242">Lhs</span><span class="op" id="3737245">:</span>&nbsp;<span class="ident" id="3737247">x</span><span class="op" id="3737248">,</span>&nbsp;<span class="ident" id="3737250">TokPos</span><span class="op" id="3737256">:</span>&nbsp;<span class="ident" id="3737258">pos</span><span class="op" id="3737261">,</span>&nbsp;<span class="ident" id="3737263">Tok</span><span class="op" id="3737266">:</span>&nbsp;<span class="ident" id="3737268">tok</span><span class="op" id="3737271">,</span>&nbsp;<span class="ident" id="3737273">Rhs</span><span class="op" id="3737276">:</span>&nbsp;<span class="ident" id="3737278">y</span><span class="op" id="3737279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737283">if</span>&nbsp;<span class="ident" id="3737286">tok</span>&nbsp;<span class="op" id="3737290">==</span>&nbsp;<span class="ident" id="3737293">token</span><span class="op" id="3737298">.</span><span class="ident" id="3737299">DEFINE</span>&nbsp;<span class="op" id="3737306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737311">p</span><span class="op" id="3737312">.</span><span class="ident" id="3737313">shortVarDecl</span><span class="op" id="3737325">(</span><span class="ident" id="3737326">as</span><span class="op" id="3737328">,</span>&nbsp;<span class="ident" id="3737330">x</span><span class="op" id="3737331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3737335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737339">return</span>&nbsp;<span class="ident" id="3737346">as</span><span class="op" id="3737348">,</span>&nbsp;<span class="ident" id="3737350">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3737359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737363">if</span>&nbsp;<span class="builtinfunc" id="3737366">len</span><span class="op" id="3737369">(</span><span class="ident" id="3737370">x</span><span class="op" id="3737371">)</span>&nbsp;<span class="op" id="3737373">&gt;</span>&nbsp;<span class="num" id="3737375">1</span>&nbsp;<span class="op" id="3737377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737381">p</span><span class="op" id="3737382">.</span><span class="ident" id="3737383">errorExpected</span><span class="op" id="3737396">(</span><span class="ident" id="3737397">x</span><span class="op" id="3737398">[</span><span class="num" id="3737399">0</span><span class="op" id="3737400">]</span><span class="op" id="3737401">.</span><span class="ident" id="3737402">Pos</span><span class="op" id="3737405">(</span><span class="op" id="3737406">)</span><span class="op" id="3737407">,</span>&nbsp;<span class="string" id="3737409">&#34;1&nbsp;expression&#34;</span><span class="op" id="3737423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737427">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3737462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737466">switch</span>&nbsp;<span class="ident" id="3737473">p</span><span class="op" id="3737474">.</span><span class="ident" id="3737475">tok</span>&nbsp;<span class="op" id="3737479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737482">case</span>&nbsp;<span class="ident" id="3737487">token</span><span class="op" id="3737492">.</span><span class="ident" id="3737493">COLON</span><span class="op" id="3737498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737502">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737525">colon</span>&nbsp;<span class="op" id="3737531">:=</span>&nbsp;<span class="ident" id="3737534">p</span><span class="op" id="3737535">.</span><span class="ident" id="3737536">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737542">p</span><span class="op" id="3737543">.</span><span class="ident" id="3737544">next</span><span class="op" id="3737548">(</span><span class="op" id="3737549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737553">if</span>&nbsp;<span class="ident" id="3737556">label</span><span class="op" id="3737561">,</span>&nbsp;<span class="ident" id="3737563">isIdent</span>&nbsp;<span class="op" id="3737571">:=</span>&nbsp;<span class="ident" id="3737574">x</span><span class="op" id="3737575">[</span><span class="num" id="3737576">0</span><span class="op" id="3737577">]</span><span class="op" id="3737578">.</span><span class="op" id="3737579">(</span><span class="op" id="3737580">*</span><span class="ident" id="3737581">ast</span><span class="op" id="3737584">.</span><span class="ident" id="3737585">Ident</span><span class="op" id="3737590">)</span><span class="op" id="3737591">;</span>&nbsp;<span class="ident" id="3737593">mode</span>&nbsp;<span class="op" id="3737598">==</span>&nbsp;<span class="ident" id="3737601">labelOk</span>&nbsp;<span class="op" id="3737609">&amp;&amp;</span>&nbsp;<span class="ident" id="3737612">isIdent</span>&nbsp;<span class="op" id="3737620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737625">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737689">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737755">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737771">stmt</span>&nbsp;<span class="op" id="3737776">:=</span>&nbsp;<span class="op" id="3737779">&amp;</span><span class="ident" id="3737780">ast</span><span class="op" id="3737783">.</span><span class="ident" id="3737784">LabeledStmt</span><span class="op" id="3737795">{</span><span class="ident" id="3737796">Label</span><span class="op" id="3737801">:</span>&nbsp;<span class="ident" id="3737803">label</span><span class="op" id="3737808">,</span>&nbsp;<span class="ident" id="3737810">Colon</span><span class="op" id="3737815">:</span>&nbsp;<span class="ident" id="3737817">colon</span><span class="op" id="3737822">,</span>&nbsp;<span class="ident" id="3737824">Stmt</span><span class="op" id="3737828">:</span>&nbsp;<span class="ident" id="3737830">p</span><span class="op" id="3737831">.</span><span class="ident" id="3737832">parseStmt</span><span class="op" id="3737841">(</span><span class="op" id="3737842">)</span><span class="op" id="3737843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737848">p</span><span class="op" id="3737849">.</span><span class="ident" id="3737850">declare</span><span class="op" id="3737857">(</span><span class="ident" id="3737858">stmt</span><span class="op" id="3737862">,</span>&nbsp;<span class="builtintype" id="3737864">nil</span><span class="op" id="3737867">,</span>&nbsp;<span class="ident" id="3737869">p</span><span class="op" id="3737870">.</span><span class="ident" id="3737871">labelScope</span><span class="op" id="3737881">,</span>&nbsp;<span class="ident" id="3737883">ast</span><span class="op" id="3737886">.</span><span class="ident" id="3737887">Lbl</span><span class="op" id="3737890">,</span>&nbsp;<span class="ident" id="3737892">label</span><span class="op" id="3737897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3737902">return</span>&nbsp;<span class="ident" id="3737909">stmt</span><span class="op" id="3737913">,</span>&nbsp;<span class="builtintype" id="3737915">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3737923">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737927">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738000">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738074">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738147">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738220">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738294">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738329">p</span><span class="op" id="3738330">.</span><span class="builtintype" id="3738331">error</span><span class="op" id="3738336">(</span><span class="ident" id="3738337">colon</span><span class="op" id="3738342">,</span>&nbsp;<span class="string" id="3738344">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="3738371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738375">return</span>&nbsp;<span class="op" id="3738382">&amp;</span><span class="ident" id="3738383">ast</span><span class="op" id="3738386">.</span><span class="ident" id="3738387">BadStmt</span><span class="op" id="3738394">{</span><span class="ident" id="3738395">From</span><span class="op" id="3738399">:</span>&nbsp;<span class="ident" id="3738401">x</span><span class="op" id="3738402">[</span><span class="num" id="3738403">0</span><span class="op" id="3738404">]</span><span class="op" id="3738405">.</span><span class="ident" id="3738406">Pos</span><span class="op" id="3738409">(</span><span class="op" id="3738410">)</span><span class="op" id="3738411">,</span>&nbsp;<span class="ident" id="3738413">To</span><span class="op" id="3738415">:</span>&nbsp;<span class="ident" id="3738417">colon</span>&nbsp;<span class="op" id="3738423">+</span>&nbsp;<span class="num" id="3738425">1</span><span class="op" id="3738426">}</span><span class="op" id="3738427">,</span>&nbsp;<span class="builtintype" id="3738429">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738437">case</span>&nbsp;<span class="ident" id="3738442">token</span><span class="op" id="3738447">.</span><span class="ident" id="3738448">ARROW</span><span class="op" id="3738453">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738457">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738477">arrow</span>&nbsp;<span class="op" id="3738483">:=</span>&nbsp;<span class="ident" id="3738486">p</span><span class="op" id="3738487">.</span><span class="ident" id="3738488">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738494">p</span><span class="op" id="3738495">.</span><span class="ident" id="3738496">next</span><span class="op" id="3738500">(</span><span class="op" id="3738501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738505">y</span>&nbsp;<span class="op" id="3738507">:=</span>&nbsp;<span class="ident" id="3738510">p</span><span class="op" id="3738511">.</span><span class="ident" id="3738512">parseRhs</span><span class="op" id="3738520">(</span><span class="op" id="3738521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738525">return</span>&nbsp;<span class="op" id="3738532">&amp;</span><span class="ident" id="3738533">ast</span><span class="op" id="3738536">.</span><span class="ident" id="3738537">SendStmt</span><span class="op" id="3738545">{</span><span class="ident" id="3738546">Chan</span><span class="op" id="3738550">:</span>&nbsp;<span class="ident" id="3738552">x</span><span class="op" id="3738553">[</span><span class="num" id="3738554">0</span><span class="op" id="3738555">]</span><span class="op" id="3738556">,</span>&nbsp;<span class="ident" id="3738558">Arrow</span><span class="op" id="3738563">:</span>&nbsp;<span class="ident" id="3738565">arrow</span><span class="op" id="3738570">,</span>&nbsp;<span class="ident" id="3738572">Value</span><span class="op" id="3738577">:</span>&nbsp;<span class="ident" id="3738579">y</span><span class="op" id="3738580">}</span><span class="op" id="3738581">,</span>&nbsp;<span class="builtintype" id="3738583">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738591">case</span>&nbsp;<span class="ident" id="3738596">token</span><span class="op" id="3738601">.</span><span class="ident" id="3738602">INC</span><span class="op" id="3738605">,</span>&nbsp;<span class="ident" id="3738607">token</span><span class="op" id="3738612">.</span><span class="ident" id="3738613">DEC</span><span class="op" id="3738616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738620">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738648">s</span>&nbsp;<span class="op" id="3738650">:=</span>&nbsp;<span class="op" id="3738653">&amp;</span><span class="ident" id="3738654">ast</span><span class="op" id="3738657">.</span><span class="ident" id="3738658">IncDecStmt</span><span class="op" id="3738668">{</span><span class="ident" id="3738669">X</span><span class="op" id="3738670">:</span>&nbsp;<span class="ident" id="3738672">x</span><span class="op" id="3738673">[</span><span class="num" id="3738674">0</span><span class="op" id="3738675">]</span><span class="op" id="3738676">,</span>&nbsp;<span class="ident" id="3738678">TokPos</span><span class="op" id="3738684">:</span>&nbsp;<span class="ident" id="3738686">p</span><span class="op" id="3738687">.</span><span class="ident" id="3738688">pos</span><span class="op" id="3738691">,</span>&nbsp;<span class="ident" id="3738693">Tok</span><span class="op" id="3738696">:</span>&nbsp;<span class="ident" id="3738698">p</span><span class="op" id="3738699">.</span><span class="ident" id="3738700">tok</span><span class="op" id="3738703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738707">p</span><span class="op" id="3738708">.</span><span class="ident" id="3738709">next</span><span class="op" id="3738713">(</span><span class="op" id="3738714">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738718">return</span>&nbsp;<span class="ident" id="3738725">s</span><span class="op" id="3738726">,</span>&nbsp;<span class="builtintype" id="3738728">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738739">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738754">return</span>&nbsp;<span class="op" id="3738761">&amp;</span><span class="ident" id="3738762">ast</span><span class="op" id="3738765">.</span><span class="ident" id="3738766">ExprStmt</span><span class="op" id="3738774">{</span><span class="ident" id="3738775">X</span><span class="op" id="3738776">:</span>&nbsp;<span class="ident" id="3738778">x</span><span class="op" id="3738779">[</span><span class="num" id="3738780">0</span><span class="op" id="3738781">]</span><span class="op" id="3738782">}</span><span class="op" id="3738783">,</span>&nbsp;<span class="builtintype" id="3738785">false</span><br>
<span class="lineno">1710</span><span class="op" id="3738791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738794">func</span>&nbsp;<span class="op" id="3738799">(</span><span class="ident" id="3738800">p</span>&nbsp;<span class="op" id="3738802">*</span><span class="ident" id="3738803">parser</span><span class="op" id="3738809">)</span>&nbsp;<span class="ident" id="3738811">parseCallExpr</span><span class="op" id="3738824">(</span><span class="ident" id="3738825">callType</span>&nbsp;<span class="builtintype" id="3738834">string</span><span class="op" id="3738840">)</span>&nbsp;<span class="op" id="3738842">*</span><span class="ident" id="3738843">ast</span><span class="op" id="3738846">.</span><span class="ident" id="3738847">CallExpr</span>&nbsp;<span class="op" id="3738856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738859">x</span>&nbsp;<span class="op" id="3738861">:=</span>&nbsp;<span class="ident" id="3738864">p</span><span class="op" id="3738865">.</span><span class="ident" id="3738866">parseRhsOrType</span><span class="op" id="3738880">(</span><span class="op" id="3738881">)</span>&nbsp;<span class="comment" id="3738883">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738925">if</span>&nbsp;<span class="ident" id="3738928">call</span><span class="op" id="3738932">,</span>&nbsp;<span class="ident" id="3738934">isCall</span>&nbsp;<span class="op" id="3738941">:=</span>&nbsp;<span class="ident" id="3738944">x</span><span class="op" id="3738945">.</span><span class="op" id="3738946">(</span><span class="op" id="3738947">*</span><span class="ident" id="3738948">ast</span><span class="op" id="3738951">.</span><span class="ident" id="3738952">CallExpr</span><span class="op" id="3738960">)</span><span class="op" id="3738961">;</span>&nbsp;<span class="ident" id="3738963">isCall</span>&nbsp;<span class="op" id="3738970">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738974">return</span>&nbsp;<span class="ident" id="3738981">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738990">if</span>&nbsp;<span class="ident" id="3738993">_</span><span class="op" id="3738994">,</span>&nbsp;<span class="ident" id="3738996">isBad</span>&nbsp;<span class="op" id="3739002">:=</span>&nbsp;<span class="ident" id="3739005">x</span><span class="op" id="3739006">.</span><span class="op" id="3739007">(</span><span class="op" id="3739008">*</span><span class="ident" id="3739009">ast</span><span class="op" id="3739012">.</span><span class="ident" id="3739013">BadExpr</span><span class="op" id="3739020">)</span><span class="op" id="3739021">;</span>&nbsp;<span class="op" id="3739023">!</span><span class="ident" id="3739024">isBad</span>&nbsp;<span class="op" id="3739030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3739034">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739075">p</span><span class="op" id="3739076">.</span><span class="builtintype" id="3739077">error</span><span class="op" id="3739082">(</span><span class="ident" id="3739083">p</span><span class="op" id="3739084">.</span><span class="ident" id="3739085">safePos</span><span class="op" id="3739092">(</span><span class="ident" id="3739093">x</span><span class="op" id="3739094">.</span><span class="ident" id="3739095">End</span><span class="op" id="3739098">(</span><span class="op" id="3739099">)</span><span class="op" id="3739100">)</span><span class="op" id="3739101">,</span>&nbsp;<span class="ident" id="3739103">fmt</span><span class="op" id="3739106">.</span><span class="ident" id="3739107">Sprintf</span><span class="op" id="3739114">(</span><span class="string" id="3739115">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="3739157">,</span>&nbsp;<span class="ident" id="3739159">callType</span><span class="op" id="3739167">)</span><span class="op" id="3739168">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739174">return</span>&nbsp;<span class="builtintype" id="3739181">nil</span><br>
<span class="lineno"></span><span class="op" id="3739185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3739188">func</span>&nbsp;<span class="op" id="3739193">(</span><span class="ident" id="3739194">p</span>&nbsp;<span class="op" id="3739196">*</span><span class="ident" id="3739197">parser</span><span class="op" id="3739203">)</span>&nbsp;<span class="ident" id="3739205">parseGoStmt</span><span class="op" id="3739216">(</span><span class="op" id="3739217">)</span>&nbsp;<span class="ident" id="3739219">ast</span><span class="op" id="3739222">.</span><span class="ident" id="3739223">Stmt</span>&nbsp;<span class="op" id="3739228">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739231">if</span>&nbsp;<span class="ident" id="3739234">p</span><span class="op" id="3739235">.</span><span class="ident" id="3739236">trace</span>&nbsp;<span class="op" id="3739242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739246">defer</span>&nbsp;<span class="ident" id="3739252">un</span><span class="op" id="3739254">(</span><span class="ident" id="3739255">trace</span><span class="op" id="3739260">(</span><span class="ident" id="3739261">p</span><span class="op" id="3739262">,</span>&nbsp;<span class="string" id="3739264">&#34;GoStmt&#34;</span><span class="op" id="3739272">)</span><span class="op" id="3739273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739280">pos</span>&nbsp;<span class="op" id="3739284">:=</span>&nbsp;<span class="ident" id="3739287">p</span><span class="op" id="3739288">.</span><span class="ident" id="3739289">expect</span><span class="op" id="3739295">(</span><span class="ident" id="3739296">token</span><span class="op" id="3739301">.</span><span class="ident" id="3739302">GO</span><span class="op" id="3739304">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739307">call</span>&nbsp;<span class="op" id="3739312">:=</span>&nbsp;<span class="ident" id="3739315">p</span><span class="op" id="3739316">.</span><span class="ident" id="3739317">parseCallExpr</span><span class="op" id="3739330">(</span><span class="string" id="3739331">&#34;go&#34;</span><span class="op" id="3739335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739338">p</span><span class="op" id="3739339">.</span><span class="ident" id="3739340">expectSemi</span><span class="op" id="3739350">(</span><span class="op" id="3739351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739354">if</span>&nbsp;<span class="ident" id="3739357">call</span>&nbsp;<span class="op" id="3739362">==</span>&nbsp;<span class="builtintype" id="3739365">nil</span>&nbsp;<span class="op" id="3739369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739373">return</span>&nbsp;<span class="op" id="3739380">&amp;</span><span class="ident" id="3739381">ast</span><span class="op" id="3739384">.</span><span class="ident" id="3739385">BadStmt</span><span class="op" id="3739392">{</span><span class="ident" id="3739393">From</span><span class="op" id="3739397">:</span>&nbsp;<span class="ident" id="3739399">pos</span><span class="op" id="3739402">,</span>&nbsp;<span class="ident" id="3739404">To</span><span class="op" id="3739406">:</span>&nbsp;<span class="ident" id="3739408">pos</span>&nbsp;<span class="op" id="3739412">+</span>&nbsp;<span class="num" id="3739414">2</span><span class="op" id="3739415">}</span>&nbsp;<span class="comment" id="3739417">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739431">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739435">return</span>&nbsp;<span class="op" id="3739442">&amp;</span><span class="ident" id="3739443">ast</span><span class="op" id="3739446">.</span><span class="ident" id="3739447">GoStmt</span><span class="op" id="3739453">{</span><span class="ident" id="3739454">Go</span><span class="op" id="3739456">:</span>&nbsp;<span class="ident" id="3739458">pos</span><span class="op" id="3739461">,</span>&nbsp;<span class="ident" id="3739463">Call</span><span class="op" id="3739467">:</span>&nbsp;<span class="ident" id="3739469">call</span><span class="op" id="3739473">}</span><br>
<span class="lineno"></span><span class="op" id="3739475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3739478">func</span>&nbsp;<span class="op" id="3739483">(</span><span class="ident" id="3739484">p</span>&nbsp;<span class="op" id="3739486">*</span><span class="ident" id="3739487">parser</span><span class="op" id="3739493">)</span>&nbsp;<span class="ident" id="3739495">parseDeferStmt</span><span class="op" id="3739509">(</span><span class="op" id="3739510">)</span>&nbsp;<span class="ident" id="3739512">ast</span><span class="op" id="3739515">.</span><span class="ident" id="3739516">Stmt</span>&nbsp;<span class="op" id="3739521">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739524">if</span>&nbsp;<span class="ident" id="3739527">p</span><span class="op" id="3739528">.</span><span class="ident" id="3739529">trace</span>&nbsp;<span class="op" id="3739535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739539">defer</span>&nbsp;<span class="ident" id="3739545">un</span><span class="op" id="3739547">(</span><span class="ident" id="3739548">trace</span><span class="op" id="3739553">(</span><span class="ident" id="3739554">p</span><span class="op" id="3739555">,</span>&nbsp;<span class="string" id="3739557">&#34;DeferStmt&#34;</span><span class="op" id="3739568">)</span><span class="op" id="3739569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739576">pos</span>&nbsp;<span class="op" id="3739580">:=</span>&nbsp;<span class="ident" id="3739583">p</span><span class="op" id="3739584">.</span><span class="ident" id="3739585">expect</span><span class="op" id="3739591">(</span><span class="ident" id="3739592">token</span><span class="op" id="3739597">.</span><span class="ident" id="3739598">DEFER</span><span class="op" id="3739603">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739606">call</span>&nbsp;<span class="op" id="3739611">:=</span>&nbsp;<span class="ident" id="3739614">p</span><span class="op" id="3739615">.</span><span class="ident" id="3739616">parseCallExpr</span><span class="op" id="3739629">(</span><span class="string" id="3739630">&#34;defer&#34;</span><span class="op" id="3739637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739640">p</span><span class="op" id="3739641">.</span><span class="ident" id="3739642">expectSemi</span><span class="op" id="3739652">(</span><span class="op" id="3739653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739656">if</span>&nbsp;<span class="ident" id="3739659">call</span>&nbsp;<span class="op" id="3739664">==</span>&nbsp;<span class="builtintype" id="3739667">nil</span>&nbsp;<span class="op" id="3739671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739675">return</span>&nbsp;<span class="op" id="3739682">&amp;</span><span class="ident" id="3739683">ast</span><span class="op" id="3739686">.</span><span class="ident" id="3739687">BadStmt</span><span class="op" id="3739694">{</span><span class="ident" id="3739695">From</span><span class="op" id="3739699">:</span>&nbsp;<span class="ident" id="3739701">pos</span><span class="op" id="3739704">,</span>&nbsp;<span class="ident" id="3739706">To</span><span class="op" id="3739708">:</span>&nbsp;<span class="ident" id="3739710">pos</span>&nbsp;<span class="op" id="3739714">+</span>&nbsp;<span class="num" id="3739716">5</span><span class="op" id="3739717">}</span>&nbsp;<span class="comment" id="3739719">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739736">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739740">return</span>&nbsp;<span class="op" id="3739747">&amp;</span><span class="ident" id="3739748">ast</span><span class="op" id="3739751">.</span><span class="ident" id="3739752">DeferStmt</span><span class="op" id="3739761">{</span><span class="ident" id="3739762">Defer</span><span class="op" id="3739767">:</span>&nbsp;<span class="ident" id="3739769">pos</span><span class="op" id="3739772">,</span>&nbsp;<span class="ident" id="3739774">Call</span><span class="op" id="3739778">:</span>&nbsp;<span class="ident" id="3739780">call</span><span class="op" id="3739784">}</span><br>
<span class="lineno"></span><span class="op" id="3739786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3739789">func</span>&nbsp;<span class="op" id="3739794">(</span><span class="ident" id="3739795">p</span>&nbsp;<span class="op" id="3739797">*</span><span class="ident" id="3739798">parser</span><span class="op" id="3739804">)</span>&nbsp;<span class="ident" id="3739806">parseReturnStmt</span><span class="op" id="3739821">(</span><span class="op" id="3739822">)</span>&nbsp;<span class="op" id="3739824">*</span><span class="ident" id="3739825">ast</span><span class="op" id="3739828">.</span><span class="ident" id="3739829">ReturnStmt</span>&nbsp;<span class="op" id="3739840">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739843">if</span>&nbsp;<span class="ident" id="3739846">p</span><span class="op" id="3739847">.</span><span class="ident" id="3739848">trace</span>&nbsp;<span class="op" id="3739854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739858">defer</span>&nbsp;<span class="ident" id="3739864">un</span><span class="op" id="3739866">(</span><span class="ident" id="3739867">trace</span><span class="op" id="3739872">(</span><span class="ident" id="3739873">p</span><span class="op" id="3739874">,</span>&nbsp;<span class="string" id="3739876">&#34;ReturnStmt&#34;</span><span class="op" id="3739888">)</span><span class="op" id="3739889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739896">pos</span>&nbsp;<span class="op" id="3739900">:=</span>&nbsp;<span class="ident" id="3739903">p</span><span class="op" id="3739904">.</span><span class="ident" id="3739905">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739910">p</span><span class="op" id="3739911">.</span><span class="ident" id="3739912">expect</span><span class="op" id="3739918">(</span><span class="ident" id="3739919">token</span><span class="op" id="3739924">.</span><span class="ident" id="3739925">RETURN</span><span class="op" id="3739931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739934">var</span>&nbsp;<span class="ident" id="3739938">x</span>&nbsp;<span class="op" id="3739940">[</span><span class="op" id="3739941">]</span><span class="ident" id="3739942">ast</span><span class="op" id="3739945">.</span><span class="ident" id="3739946">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739952">if</span>&nbsp;<span class="ident" id="3739955">p</span><span class="op" id="3739956">.</span><span class="ident" id="3739957">tok</span>&nbsp;<span class="op" id="3739961">!=</span>&nbsp;<span class="ident" id="3739964">token</span><span class="op" id="3739969">.</span><span class="ident" id="3739970">SEMICOLON</span>&nbsp;<span class="op" id="3739980">&amp;&amp;</span>&nbsp;<span class="ident" id="3739983">p</span><span class="op" id="3739984">.</span><span class="ident" id="3739985">tok</span>&nbsp;<span class="op" id="3739989">!=</span>&nbsp;<span class="ident" id="3739992">token</span><span class="op" id="3739997">.</span><span class="ident" id="3739998">RBRACE</span>&nbsp;<span class="op" id="3740005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740009">x</span>&nbsp;<span class="op" id="3740011">=</span>&nbsp;<span class="ident" id="3740013">p</span><span class="op" id="3740014">.</span><span class="ident" id="3740015">parseRhsList</span><span class="op" id="3740027">(</span><span class="op" id="3740028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740031">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740034">p</span><span class="op" id="3740035">.</span><span class="ident" id="3740036">expectSemi</span><span class="op" id="3740046">(</span><span class="op" id="3740047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740051">return</span>&nbsp;<span class="op" id="3740058">&amp;</span><span class="ident" id="3740059">ast</span><span class="op" id="3740062">.</span><span class="ident" id="3740063">ReturnStmt</span><span class="op" id="3740073">{</span><span class="ident" id="3740074">Return</span><span class="op" id="3740080">:</span>&nbsp;<span class="ident" id="3740082">pos</span><span class="op" id="3740085">,</span>&nbsp;<span class="ident" id="3740087">Results</span><span class="op" id="3740094">:</span>&nbsp;<span class="ident" id="3740096">x</span><span class="op" id="3740097">}</span><br>
<span class="lineno"></span><span class="op" id="3740099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="3740102">func</span>&nbsp;<span class="op" id="3740107">(</span><span class="ident" id="3740108">p</span>&nbsp;<span class="op" id="3740110">*</span><span class="ident" id="3740111">parser</span><span class="op" id="3740117">)</span>&nbsp;<span class="ident" id="3740119">parseBranchStmt</span><span class="op" id="3740134">(</span><span class="ident" id="3740135">tok</span>&nbsp;<span class="ident" id="3740139">token</span><span class="op" id="3740144">.</span><span class="ident" id="3740145">Token</span><span class="op" id="3740150">)</span>&nbsp;<span class="op" id="3740152">*</span><span class="ident" id="3740153">ast</span><span class="op" id="3740156">.</span><span class="ident" id="3740157">BranchStmt</span>&nbsp;<span class="op" id="3740168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740171">if</span>&nbsp;<span class="ident" id="3740174">p</span><span class="op" id="3740175">.</span><span class="ident" id="3740176">trace</span>&nbsp;<span class="op" id="3740182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740186">defer</span>&nbsp;<span class="ident" id="3740192">un</span><span class="op" id="3740194">(</span><span class="ident" id="3740195">trace</span><span class="op" id="3740200">(</span><span class="ident" id="3740201">p</span><span class="op" id="3740202">,</span>&nbsp;<span class="string" id="3740204">&#34;BranchStmt&#34;</span><span class="op" id="3740216">)</span><span class="op" id="3740217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740224">pos</span>&nbsp;<span class="op" id="3740228">:=</span>&nbsp;<span class="ident" id="3740231">p</span><span class="op" id="3740232">.</span><span class="ident" id="3740233">expect</span><span class="op" id="3740239">(</span><span class="ident" id="3740240">tok</span><span class="op" id="3740243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740246">var</span>&nbsp;<span class="ident" id="3740250">label</span>&nbsp;<span class="op" id="3740256">*</span><span class="ident" id="3740257">ast</span><span class="op" id="3740260">.</span><span class="ident" id="3740261">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740268">if</span>&nbsp;<span class="ident" id="3740271">tok</span>&nbsp;<span class="op" id="3740275">!=</span>&nbsp;<span class="ident" id="3740278">token</span><span class="op" id="3740283">.</span><span class="ident" id="3740284">FALLTHROUGH</span>&nbsp;<span class="op" id="3740296">&amp;&amp;</span>&nbsp;<span class="ident" id="3740299">p</span><span class="op" id="3740300">.</span><span class="ident" id="3740301">tok</span>&nbsp;<span class="op" id="3740305">==</span>&nbsp;<span class="ident" id="3740308">token</span><span class="op" id="3740313">.</span><span class="ident" id="3740314">IDENT</span>&nbsp;<span class="op" id="3740320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740324">label</span>&nbsp;<span class="op" id="3740330">=</span>&nbsp;<span class="ident" id="3740332">p</span><span class="op" id="3740333">.</span><span class="ident" id="3740334">parseIdent</span><span class="op" id="3740344">(</span><span class="op" id="3740345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740349">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740388">n</span>&nbsp;<span class="op" id="3740390">:=</span>&nbsp;<span class="builtinfunc" id="3740393">len</span><span class="op" id="3740396">(</span><span class="ident" id="3740397">p</span><span class="op" id="3740398">.</span><span class="ident" id="3740399">targetStack</span><span class="op" id="3740410">)</span>&nbsp;<span class="op" id="3740412">-</span>&nbsp;<span class="num" id="3740414">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740418">p</span><span class="op" id="3740419">.</span><span class="ident" id="3740420">targetStack</span><span class="op" id="3740431">[</span><span class="ident" id="3740432">n</span><span class="op" id="3740433">]</span>&nbsp;<span class="op" id="3740435">=</span>&nbsp;<span class="builtinfunc" id="3740437">append</span><span class="op" id="3740443">(</span><span class="ident" id="3740444">p</span><span class="op" id="3740445">.</span><span class="ident" id="3740446">targetStack</span><span class="op" id="3740457">[</span><span class="ident" id="3740458">n</span><span class="op" id="3740459">]</span><span class="op" id="3740460">,</span>&nbsp;<span class="ident" id="3740462">label</span><span class="op" id="3740467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740473">p</span><span class="op" id="3740474">.</span><span class="ident" id="3740475">expectSemi</span><span class="op" id="3740485">(</span><span class="op" id="3740486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740490">return</span>&nbsp;<span class="op" id="3740497">&amp;</span><span class="ident" id="3740498">ast</span><span class="op" id="3740501">.</span><span class="ident" id="3740502">BranchStmt</span><span class="op" id="3740512">{</span><span class="ident" id="3740513">TokPos</span><span class="op" id="3740519">:</span>&nbsp;<span class="ident" id="3740521">pos</span><span class="op" id="3740524">,</span>&nbsp;<span class="ident" id="3740526">Tok</span><span class="op" id="3740529">:</span>&nbsp;<span class="ident" id="3740531">tok</span><span class="op" id="3740534">,</span>&nbsp;<span class="ident" id="3740536">Label</span><span class="op" id="3740541">:</span>&nbsp;<span class="ident" id="3740543">label</span><span class="op" id="3740548">}</span><br>
<span class="lineno"></span><span class="op" id="3740550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3740553">func</span>&nbsp;<span class="op" id="3740558">(</span><span class="ident" id="3740559">p</span>&nbsp;<span class="op" id="3740561">*</span><span class="ident" id="3740562">parser</span><span class="op" id="3740568">)</span>&nbsp;<span class="ident" id="3740570">makeExpr</span><span class="op" id="3740578">(</span><span class="ident" id="3740579">s</span>&nbsp;<span class="ident" id="3740581">ast</span><span class="op" id="3740584">.</span><span class="ident" id="3740585">Stmt</span><span class="op" id="3740589">,</span>&nbsp;<span class="ident" id="3740591">kind</span>&nbsp;<span class="builtintype" id="3740596">string</span><span class="op" id="3740602">)</span>&nbsp;<span class="ident" id="3740604">ast</span><span class="op" id="3740607">.</span><span class="ident" id="3740608">Expr</span>&nbsp;<span class="op" id="3740613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740616">if</span>&nbsp;<span class="ident" id="3740619">s</span>&nbsp;<span class="op" id="3740621">==</span>&nbsp;<span class="builtintype" id="3740624">nil</span>&nbsp;<span class="op" id="3740628">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740632">return</span>&nbsp;<span class="builtintype" id="3740639">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740647">if</span>&nbsp;<span class="ident" id="3740650">es</span><span class="op" id="3740652">,</span>&nbsp;<span class="ident" id="3740654">isExpr</span>&nbsp;<span class="op" id="3740661">:=</span>&nbsp;<span class="ident" id="3740664">s</span><span class="op" id="3740665">.</span><span class="op" id="3740666">(</span><span class="op" id="3740667">*</span><span class="ident" id="3740668">ast</span><span class="op" id="3740671">.</span><span class="ident" id="3740672">ExprStmt</span><span class="op" id="3740680">)</span><span class="op" id="3740681">;</span>&nbsp;<span class="ident" id="3740683">isExpr</span>&nbsp;<span class="op" id="3740690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740694">return</span>&nbsp;<span class="ident" id="3740701">p</span><span class="op" id="3740702">.</span><span class="ident" id="3740703">checkExpr</span><span class="op" id="3740712">(</span><span class="ident" id="3740713">es</span><span class="op" id="3740715">.</span><span class="ident" id="3740716">X</span><span class="op" id="3740717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740720">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740723">p</span><span class="op" id="3740724">.</span><span class="builtintype" id="3740725">error</span><span class="op" id="3740730">(</span><span class="ident" id="3740731">s</span><span class="op" id="3740732">.</span><span class="ident" id="3740733">Pos</span><span class="op" id="3740736">(</span><span class="op" id="3740737">)</span><span class="op" id="3740738">,</span>&nbsp;<span class="ident" id="3740740">fmt</span><span class="op" id="3740743">.</span><span class="ident" id="3740744">Sprintf</span><span class="op" id="3740751">(</span><span class="string" id="3740752">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="3740837">,</span>&nbsp;<span class="ident" id="3740839">kind</span><span class="op" id="3740843">)</span><span class="op" id="3740844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740847">return</span>&nbsp;<span class="op" id="3740854">&amp;</span><span class="ident" id="3740855">ast</span><span class="op" id="3740858">.</span><span class="ident" id="3740859">BadExpr</span><span class="op" id="3740866">{</span><span class="ident" id="3740867">From</span><span class="op" id="3740871">:</span>&nbsp;<span class="ident" id="3740873">s</span><span class="op" id="3740874">.</span><span class="ident" id="3740875">Pos</span><span class="op" id="3740878">(</span><span class="op" id="3740879">)</span><span class="op" id="3740880">,</span>&nbsp;<span class="ident" id="3740882">To</span><span class="op" id="3740884">:</span>&nbsp;<span class="ident" id="3740886">p</span><span class="op" id="3740887">.</span><span class="ident" id="3740888">safePos</span><span class="op" id="3740895">(</span><span class="ident" id="3740896">s</span><span class="op" id="3740897">.</span><span class="ident" id="3740898">End</span><span class="op" id="3740901">(</span><span class="op" id="3740902">)</span><span class="op" id="3740903">)</span><span class="op" id="3740904">}</span><br>
<span class="lineno"></span><span class="op" id="3740906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3740909">func</span>&nbsp;<span class="op" id="3740914">(</span><span class="ident" id="3740915">p</span>&nbsp;<span class="op" id="3740917">*</span><span class="ident" id="3740918">parser</span><span class="op" id="3740924">)</span>&nbsp;<span class="ident" id="3740926">parseIfStmt</span><span class="op" id="3740937">(</span><span class="op" id="3740938">)</span>&nbsp;<span class="op" id="3740940">*</span><span class="ident" id="3740941">ast</span><span class="op" id="3740944">.</span><span class="ident" id="3740945">IfStmt</span>&nbsp;<span class="op" id="3740952">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740955">if</span>&nbsp;<span class="ident" id="3740958">p</span><span class="op" id="3740959">.</span><span class="ident" id="3740960">trace</span>&nbsp;<span class="op" id="3740966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740970">defer</span>&nbsp;<span class="ident" id="3740976">un</span><span class="op" id="3740978">(</span><span class="ident" id="3740979">trace</span><span class="op" id="3740984">(</span><span class="ident" id="3740985">p</span><span class="op" id="3740986">,</span>&nbsp;<span class="string" id="3740988">&#34;IfStmt&#34;</span><span class="op" id="3740996">)</span><span class="op" id="3740997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741004">pos</span>&nbsp;<span class="op" id="3741008">:=</span>&nbsp;<span class="ident" id="3741011">p</span><span class="op" id="3741012">.</span><span class="ident" id="3741013">expect</span><span class="op" id="3741019">(</span><span class="ident" id="3741020">token</span><span class="op" id="3741025">.</span><span class="ident" id="3741026">IF</span><span class="op" id="3741028">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741031">p</span><span class="op" id="3741032">.</span><span class="ident" id="3741033">openScope</span><span class="op" id="3741042">(</span><span class="op" id="3741043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741046">defer</span>&nbsp;<span class="ident" id="3741052">p</span><span class="op" id="3741053">.</span><span class="ident" id="3741054">closeScope</span><span class="op" id="3741064">(</span><span class="op" id="3741065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741069">var</span>&nbsp;<span class="ident" id="3741073">s</span>&nbsp;<span class="ident" id="3741075">ast</span><span class="op" id="3741078">.</span><span class="ident" id="3741079">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741085">var</span>&nbsp;<span class="ident" id="3741089">x</span>&nbsp;<span class="ident" id="3741091">ast</span><span class="op" id="3741094">.</span><span class="ident" id="3741095">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741105">prevLev</span>&nbsp;<span class="op" id="3741113">:=</span>&nbsp;<span class="ident" id="3741116">p</span><span class="op" id="3741117">.</span><span class="ident" id="3741118">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741128">p</span><span class="op" id="3741129">.</span><span class="ident" id="3741130">exprLev</span>&nbsp;<span class="op" id="3741138">=</span>&nbsp;<span class="op" id="3741140">-</span><span class="num" id="3741141">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741145">if</span>&nbsp;<span class="ident" id="3741148">p</span><span class="op" id="3741149">.</span><span class="ident" id="3741150">tok</span>&nbsp;<span class="op" id="3741154">==</span>&nbsp;<span class="ident" id="3741157">token</span><span class="op" id="3741162">.</span><span class="ident" id="3741163">SEMICOLON</span>&nbsp;<span class="op" id="3741173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741178">p</span><span class="op" id="3741179">.</span><span class="ident" id="3741180">next</span><span class="op" id="3741184">(</span><span class="op" id="3741185">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741190">x</span>&nbsp;<span class="op" id="3741192">=</span>&nbsp;<span class="ident" id="3741194">p</span><span class="op" id="3741195">.</span><span class="ident" id="3741196">parseRhs</span><span class="op" id="3741204">(</span><span class="op" id="3741205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741209">}</span>&nbsp;<span class="keyword" id="3741211">else</span>&nbsp;<span class="op" id="3741216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741221">s</span><span class="op" id="3741222">,</span>&nbsp;<span class="ident" id="3741224">_</span>&nbsp;<span class="op" id="3741226">=</span>&nbsp;<span class="ident" id="3741228">p</span><span class="op" id="3741229">.</span><span class="ident" id="3741230">parseSimpleStmt</span><span class="op" id="3741245">(</span><span class="ident" id="3741246">basic</span><span class="op" id="3741251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741256">if</span>&nbsp;<span class="ident" id="3741259">p</span><span class="op" id="3741260">.</span><span class="ident" id="3741261">tok</span>&nbsp;<span class="op" id="3741265">==</span>&nbsp;<span class="ident" id="3741268">token</span><span class="op" id="3741273">.</span><span class="ident" id="3741274">SEMICOLON</span>&nbsp;<span class="op" id="3741284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741290">p</span><span class="op" id="3741291">.</span><span class="ident" id="3741292">next</span><span class="op" id="3741296">(</span><span class="op" id="3741297">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741303">x</span>&nbsp;<span class="op" id="3741305">=</span>&nbsp;<span class="ident" id="3741307">p</span><span class="op" id="3741308">.</span><span class="ident" id="3741309">parseRhs</span><span class="op" id="3741317">(</span><span class="op" id="3741318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741323">}</span>&nbsp;<span class="keyword" id="3741325">else</span>&nbsp;<span class="op" id="3741330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741336">x</span>&nbsp;<span class="op" id="3741338">=</span>&nbsp;<span class="ident" id="3741340">p</span><span class="op" id="3741341">.</span><span class="ident" id="3741342">makeExpr</span><span class="op" id="3741350">(</span><span class="ident" id="3741351">s</span><span class="op" id="3741352">,</span>&nbsp;<span class="string" id="3741354">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="3741374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741380">s</span>&nbsp;<span class="op" id="3741382">=</span>&nbsp;<span class="builtintype" id="3741384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741391">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741399">p</span><span class="op" id="3741400">.</span><span class="ident" id="3741401">exprLev</span>&nbsp;<span class="op" id="3741409">=</span>&nbsp;<span class="ident" id="3741411">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741424">body</span>&nbsp;<span class="op" id="3741429">:=</span>&nbsp;<span class="ident" id="3741432">p</span><span class="op" id="3741433">.</span><span class="ident" id="3741434">parseBlockStmt</span><span class="op" id="3741448">(</span><span class="op" id="3741449">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741452">var</span>&nbsp;<span class="ident" id="3741456">else_</span>&nbsp;<span class="ident" id="3741462">ast</span><span class="op" id="3741465">.</span><span class="ident" id="3741466">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741472">if</span>&nbsp;<span class="ident" id="3741475">p</span><span class="op" id="3741476">.</span><span class="ident" id="3741477">tok</span>&nbsp;<span class="op" id="3741481">==</span>&nbsp;<span class="ident" id="3741484">token</span><span class="op" id="3741489">.</span><span class="ident" id="3741490">ELSE</span>&nbsp;<span class="op" id="3741495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741499">p</span><span class="op" id="3741500">.</span><span class="ident" id="3741501">next</span><span class="op" id="3741505">(</span><span class="op" id="3741506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741510">else_</span>&nbsp;<span class="op" id="3741516">=</span>&nbsp;<span class="ident" id="3741518">p</span><span class="op" id="3741519">.</span><span class="ident" id="3741520">parseStmt</span><span class="op" id="3741529">(</span><span class="op" id="3741530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741533">}</span>&nbsp;<span class="keyword" id="3741535">else</span>&nbsp;<span class="op" id="3741540">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741544">p</span><span class="op" id="3741545">.</span><span class="ident" id="3741546">expectSemi</span><span class="op" id="3741556">(</span><span class="op" id="3741557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741564">return</span>&nbsp;<span class="op" id="3741571">&amp;</span><span class="ident" id="3741572">ast</span><span class="op" id="3741575">.</span><span class="ident" id="3741576">IfStmt</span><span class="op" id="3741582">{</span><span class="ident" id="3741583">If</span><span class="op" id="3741585">:</span>&nbsp;<span class="ident" id="3741587">pos</span><span class="op" id="3741590">,</span>&nbsp;<span class="ident" id="3741592">Init</span><span class="op" id="3741596">:</span>&nbsp;<span class="ident" id="3741598">s</span><span class="op" id="3741599">,</span>&nbsp;<span class="ident" id="3741601">Cond</span><span class="op" id="3741605">:</span>&nbsp;<span class="ident" id="3741607">x</span><span class="op" id="3741608">,</span>&nbsp;<span class="ident" id="3741610">Body</span><span class="op" id="3741614">:</span>&nbsp;<span class="ident" id="3741616">body</span><span class="op" id="3741620">,</span>&nbsp;<span class="ident" id="3741622">Else</span><span class="op" id="3741626">:</span>&nbsp;<span class="ident" id="3741628">else_</span><span class="op" id="3741633">}</span><br>
<span class="lineno"></span><span class="op" id="3741635">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="3741638">func</span>&nbsp;<span class="op" id="3741643">(</span><span class="ident" id="3741644">p</span>&nbsp;<span class="op" id="3741646">*</span><span class="ident" id="3741647">parser</span><span class="op" id="3741653">)</span>&nbsp;<span class="ident" id="3741655">parseTypeList</span><span class="op" id="3741668">(</span><span class="op" id="3741669">)</span>&nbsp;<span class="op" id="3741671">(</span><span class="ident" id="3741672">list</span>&nbsp;<span class="op" id="3741677">[</span><span class="op" id="3741678">]</span><span class="ident" id="3741679">ast</span><span class="op" id="3741682">.</span><span class="ident" id="3741683">Expr</span><span class="op" id="3741687">)</span>&nbsp;<span class="op" id="3741689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741692">if</span>&nbsp;<span class="ident" id="3741695">p</span><span class="op" id="3741696">.</span><span class="ident" id="3741697">trace</span>&nbsp;<span class="op" id="3741703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741707">defer</span>&nbsp;<span class="ident" id="3741713">un</span><span class="op" id="3741715">(</span><span class="ident" id="3741716">trace</span><span class="op" id="3741721">(</span><span class="ident" id="3741722">p</span><span class="op" id="3741723">,</span>&nbsp;<span class="string" id="3741725">&#34;TypeList&#34;</span><span class="op" id="3741735">)</span><span class="op" id="3741736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741739">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741743">list</span>&nbsp;<span class="op" id="3741748">=</span>&nbsp;<span class="builtinfunc" id="3741750">append</span><span class="op" id="3741756">(</span><span class="ident" id="3741757">list</span><span class="op" id="3741761">,</span>&nbsp;<span class="ident" id="3741763">p</span><span class="op" id="3741764">.</span><span class="ident" id="3741765">parseType</span><span class="op" id="3741774">(</span><span class="op" id="3741775">)</span><span class="op" id="3741776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741779">for</span>&nbsp;<span class="ident" id="3741783">p</span><span class="op" id="3741784">.</span><span class="ident" id="3741785">tok</span>&nbsp;<span class="op" id="3741789">==</span>&nbsp;<span class="ident" id="3741792">token</span><span class="op" id="3741797">.</span><span class="ident" id="3741798">COMMA</span>&nbsp;<span class="op" id="3741804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741808">p</span><span class="op" id="3741809">.</span><span class="ident" id="3741810">next</span><span class="op" id="3741814">(</span><span class="op" id="3741815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741819">list</span>&nbsp;<span class="op" id="3741824">=</span>&nbsp;<span class="builtinfunc" id="3741826">append</span><span class="op" id="3741832">(</span><span class="ident" id="3741833">list</span><span class="op" id="3741837">,</span>&nbsp;<span class="ident" id="3741839">p</span><span class="op" id="3741840">.</span><span class="ident" id="3741841">parseType</span><span class="op" id="3741850">(</span><span class="op" id="3741851">)</span><span class="op" id="3741852">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741859">return</span><br>
<span class="lineno"></span><span class="op" id="3741866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="3741869">func</span>&nbsp;<span class="op" id="3741874">(</span><span class="ident" id="3741875">p</span>&nbsp;<span class="op" id="3741877">*</span><span class="ident" id="3741878">parser</span><span class="op" id="3741884">)</span>&nbsp;<span class="ident" id="3741886">parseCaseClause</span><span class="op" id="3741901">(</span><span class="ident" id="3741902">typeSwitch</span>&nbsp;<span class="builtintype" id="3741913">bool</span><span class="op" id="3741917">)</span>&nbsp;<span class="op" id="3741919">*</span><span class="ident" id="3741920">ast</span><span class="op" id="3741923">.</span><span class="ident" id="3741924">CaseClause</span>&nbsp;<span class="op" id="3741935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741938">if</span>&nbsp;<span class="ident" id="3741941">p</span><span class="op" id="3741942">.</span><span class="ident" id="3741943">trace</span>&nbsp;<span class="op" id="3741949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741953">defer</span>&nbsp;<span class="ident" id="3741959">un</span><span class="op" id="3741961">(</span><span class="ident" id="3741962">trace</span><span class="op" id="3741967">(</span><span class="ident" id="3741968">p</span><span class="op" id="3741969">,</span>&nbsp;<span class="string" id="3741971">&#34;CaseClause&#34;</span><span class="op" id="3741983">)</span><span class="op" id="3741984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741991">pos</span>&nbsp;<span class="op" id="3741995">:=</span>&nbsp;<span class="ident" id="3741998">p</span><span class="op" id="3741999">.</span><span class="ident" id="3742000">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742005">var</span>&nbsp;<span class="ident" id="3742009">list</span>&nbsp;<span class="op" id="3742014">[</span><span class="op" id="3742015">]</span><span class="ident" id="3742016">ast</span><span class="op" id="3742019">.</span><span class="ident" id="3742020">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742026">if</span>&nbsp;<span class="ident" id="3742029">p</span><span class="op" id="3742030">.</span><span class="ident" id="3742031">tok</span>&nbsp;<span class="op" id="3742035">==</span>&nbsp;<span class="ident" id="3742038">token</span><span class="op" id="3742043">.</span><span class="ident" id="3742044">CASE</span>&nbsp;<span class="op" id="3742049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742053">p</span><span class="op" id="3742054">.</span><span class="ident" id="3742055">next</span><span class="op" id="3742059">(</span><span class="op" id="3742060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742064">if</span>&nbsp;<span class="ident" id="3742067">typeSwitch</span>&nbsp;<span class="op" id="3742078">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742083">list</span>&nbsp;<span class="op" id="3742088">=</span>&nbsp;<span class="ident" id="3742090">p</span><span class="op" id="3742091">.</span><span class="ident" id="3742092">parseTypeList</span><span class="op" id="3742105">(</span><span class="op" id="3742106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742110">}</span>&nbsp;<span class="keyword" id="3742112">else</span>&nbsp;<span class="op" id="3742117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742122">list</span>&nbsp;<span class="op" id="3742127">=</span>&nbsp;<span class="ident" id="3742129">p</span><span class="op" id="3742130">.</span><span class="ident" id="3742131">parseRhsList</span><span class="op" id="3742143">(</span><span class="op" id="3742144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742151">}</span>&nbsp;<span class="keyword" id="3742153">else</span>&nbsp;<span class="op" id="3742158">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742162">p</span><span class="op" id="3742163">.</span><span class="ident" id="3742164">expect</span><span class="op" id="3742170">(</span><span class="ident" id="3742171">token</span><span class="op" id="3742176">.</span><span class="ident" id="3742177">DEFAULT</span><span class="op" id="3742184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742191">colon</span>&nbsp;<span class="op" id="3742197">:=</span>&nbsp;<span class="ident" id="3742200">p</span><span class="op" id="3742201">.</span><span class="ident" id="3742202">expect</span><span class="op" id="3742208">(</span><span class="ident" id="3742209">token</span><span class="op" id="3742214">.</span><span class="ident" id="3742215">COLON</span><span class="op" id="3742220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742223">p</span><span class="op" id="3742224">.</span><span class="ident" id="3742225">openScope</span><span class="op" id="3742234">(</span><span class="op" id="3742235">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742238">body</span>&nbsp;<span class="op" id="3742243">:=</span>&nbsp;<span class="ident" id="3742246">p</span><span class="op" id="3742247">.</span><span class="ident" id="3742248">parseStmtList</span><span class="op" id="3742261">(</span><span class="op" id="3742262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742265">p</span><span class="op" id="3742266">.</span><span class="ident" id="3742267">closeScope</span><span class="op" id="3742277">(</span><span class="op" id="3742278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742282">return</span>&nbsp;<span class="op" id="3742289">&amp;</span><span class="ident" id="3742290">ast</span><span class="op" id="3742293">.</span><span class="ident" id="3742294">CaseClause</span><span class="op" id="3742304">{</span><span class="ident" id="3742305">Case</span><span class="op" id="3742309">:</span>&nbsp;<span class="ident" id="3742311">pos</span><span class="op" id="3742314">,</span>&nbsp;<span class="ident" id="3742316">List</span><span class="op" id="3742320">:</span>&nbsp;<span class="ident" id="3742322">list</span><span class="op" id="3742326">,</span>&nbsp;<span class="ident" id="3742328">Colon</span><span class="op" id="3742333">:</span>&nbsp;<span class="ident" id="3742335">colon</span><span class="op" id="3742340">,</span>&nbsp;<span class="ident" id="3742342">Body</span><span class="op" id="3742346">:</span>&nbsp;<span class="ident" id="3742348">body</span><span class="op" id="3742352">}</span><br>
<span class="lineno"></span><span class="op" id="3742354">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="3742357">func</span>&nbsp;<span class="ident" id="3742362">isTypeSwitchAssert</span><span class="op" id="3742380">(</span><span class="ident" id="3742381">x</span>&nbsp;<span class="ident" id="3742383">ast</span><span class="op" id="3742386">.</span><span class="ident" id="3742387">Expr</span><span class="op" id="3742391">)</span>&nbsp;<span class="builtintype" id="3742393">bool</span>&nbsp;<span class="op" id="3742398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742401">a</span><span class="op" id="3742402">,</span>&nbsp;<span class="ident" id="3742404">ok</span>&nbsp;<span class="op" id="3742407">:=</span>&nbsp;<span class="ident" id="3742410">x</span><span class="op" id="3742411">.</span><span class="op" id="3742412">(</span><span class="op" id="3742413">*</span><span class="ident" id="3742414">ast</span><span class="op" id="3742417">.</span><span class="ident" id="3742418">TypeAssertExpr</span><span class="op" id="3742432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742435">return</span>&nbsp;<span class="ident" id="3742442">ok</span>&nbsp;<span class="op" id="3742445">&amp;&amp;</span>&nbsp;<span class="ident" id="3742448">a</span><span class="op" id="3742449">.</span><span class="ident" id="3742450">Type</span>&nbsp;<span class="op" id="3742455">==</span>&nbsp;<span class="builtintype" id="3742458">nil</span><br>
<span class="lineno"></span><span class="op" id="3742462">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="3742465">func</span>&nbsp;<span class="ident" id="3742470">isTypeSwitchGuard</span><span class="op" id="3742487">(</span><span class="ident" id="3742488">s</span>&nbsp;<span class="ident" id="3742490">ast</span><span class="op" id="3742493">.</span><span class="ident" id="3742494">Stmt</span><span class="op" id="3742498">)</span>&nbsp;<span class="builtintype" id="3742500">bool</span>&nbsp;<span class="op" id="3742505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742508">switch</span>&nbsp;<span class="ident" id="3742515">t</span>&nbsp;<span class="op" id="3742517">:=</span>&nbsp;<span class="ident" id="3742520">s</span><span class="op" id="3742521">.</span><span class="op" id="3742522">(</span><span class="keyword" id="3742523">type</span><span class="op" id="3742527">)</span>&nbsp;<span class="op" id="3742529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742532">case</span>&nbsp;<span class="op" id="3742537">*</span><span class="ident" id="3742538">ast</span><span class="op" id="3742541">.</span><span class="ident" id="3742542">ExprStmt</span><span class="op" id="3742550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742554">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742567">return</span>&nbsp;<span class="ident" id="3742574">isTypeSwitchAssert</span><span class="op" id="3742592">(</span><span class="ident" id="3742593">t</span><span class="op" id="3742594">.</span><span class="ident" id="3742595">X</span><span class="op" id="3742596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742599">case</span>&nbsp;<span class="op" id="3742604">*</span><span class="ident" id="3742605">ast</span><span class="op" id="3742608">.</span><span class="ident" id="3742609">AssignStmt</span><span class="op" id="3742619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742623">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742641">return</span>&nbsp;<span class="builtinfunc" id="3742648">len</span><span class="op" id="3742651">(</span><span class="ident" id="3742652">t</span><span class="op" id="3742653">.</span><span class="ident" id="3742654">Lhs</span><span class="op" id="3742657">)</span>&nbsp;<span class="op" id="3742659">==</span>&nbsp;<span class="num" id="3742662">1</span>&nbsp;<span class="op" id="3742664">&amp;&amp;</span>&nbsp;<span class="ident" id="3742667">t</span><span class="op" id="3742668">.</span><span class="ident" id="3742669">Tok</span>&nbsp;<span class="op" id="3742673">==</span>&nbsp;<span class="ident" id="3742676">token</span><span class="op" id="3742681">.</span><span class="ident" id="3742682">DEFINE</span>&nbsp;<span class="op" id="3742689">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3742692">len</span><span class="op" id="3742695">(</span><span class="ident" id="3742696">t</span><span class="op" id="3742697">.</span><span class="ident" id="3742698">Rhs</span><span class="op" id="3742701">)</span>&nbsp;<span class="op" id="3742703">==</span>&nbsp;<span class="num" id="3742706">1</span>&nbsp;<span class="op" id="3742708">&amp;&amp;</span>&nbsp;<span class="ident" id="3742711">isTypeSwitchAssert</span><span class="op" id="3742729">(</span><span class="ident" id="3742730">t</span><span class="op" id="3742731">.</span><span class="ident" id="3742732">Rhs</span><span class="op" id="3742735">[</span><span class="num" id="3742736">0</span><span class="op" id="3742737">]</span><span class="op" id="3742738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742741">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742744">return</span>&nbsp;<span class="builtintype" id="3742751">false</span><br>
<span class="lineno"></span><span class="op" id="3742757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3742760">func</span>&nbsp;<span class="op" id="3742765">(</span><span class="ident" id="3742766">p</span>&nbsp;<span class="op" id="3742768">*</span><span class="ident" id="3742769">parser</span><span class="op" id="3742775">)</span>&nbsp;<span class="ident" id="3742777">parseSwitchStmt</span><span class="op" id="3742792">(</span><span class="op" id="3742793">)</span>&nbsp;<span class="ident" id="3742795">ast</span><span class="op" id="3742798">.</span><span class="ident" id="3742799">Stmt</span>&nbsp;<span class="op" id="3742804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742807">if</span>&nbsp;<span class="ident" id="3742810">p</span><span class="op" id="3742811">.</span><span class="ident" id="3742812">trace</span>&nbsp;<span class="op" id="3742818">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742822">defer</span>&nbsp;<span class="ident" id="3742828">un</span><span class="op" id="3742830">(</span><span class="ident" id="3742831">trace</span><span class="op" id="3742836">(</span><span class="ident" id="3742837">p</span><span class="op" id="3742838">,</span>&nbsp;<span class="string" id="3742840">&#34;SwitchStmt&#34;</span><span class="op" id="3742852">)</span><span class="op" id="3742853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742860">pos</span>&nbsp;<span class="op" id="3742864">:=</span>&nbsp;<span class="ident" id="3742867">p</span><span class="op" id="3742868">.</span><span class="ident" id="3742869">expect</span><span class="op" id="3742875">(</span><span class="ident" id="3742876">token</span><span class="op" id="3742881">.</span><span class="ident" id="3742882">SWITCH</span><span class="op" id="3742888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742891">p</span><span class="op" id="3742892">.</span><span class="ident" id="3742893">openScope</span><span class="op" id="3742902">(</span><span class="op" id="3742903">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742906">defer</span>&nbsp;<span class="ident" id="3742912">p</span><span class="op" id="3742913">.</span><span class="ident" id="3742914">closeScope</span><span class="op" id="3742924">(</span><span class="op" id="3742925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742929">var</span>&nbsp;<span class="ident" id="3742933">s1</span><span class="op" id="3742935">,</span>&nbsp;<span class="ident" id="3742937">s2</span>&nbsp;<span class="ident" id="3742940">ast</span><span class="op" id="3742943">.</span><span class="ident" id="3742944">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742950">if</span>&nbsp;<span class="ident" id="3742953">p</span><span class="op" id="3742954">.</span><span class="ident" id="3742955">tok</span>&nbsp;<span class="op" id="3742959">!=</span>&nbsp;<span class="ident" id="3742962">token</span><span class="op" id="3742967">.</span><span class="ident" id="3742968">LBRACE</span>&nbsp;<span class="op" id="3742975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742979">prevLev</span>&nbsp;<span class="op" id="3742987">:=</span>&nbsp;<span class="ident" id="3742990">p</span><span class="op" id="3742991">.</span><span class="ident" id="3742992">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743002">p</span><span class="op" id="3743003">.</span><span class="ident" id="3743004">exprLev</span>&nbsp;<span class="op" id="3743012">=</span>&nbsp;<span class="op" id="3743014">-</span><span class="num" id="3743015">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743019">if</span>&nbsp;<span class="ident" id="3743022">p</span><span class="op" id="3743023">.</span><span class="ident" id="3743024">tok</span>&nbsp;<span class="op" id="3743028">!=</span>&nbsp;<span class="ident" id="3743031">token</span><span class="op" id="3743036">.</span><span class="ident" id="3743037">SEMICOLON</span>&nbsp;<span class="op" id="3743047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743052">s2</span><span class="op" id="3743054">,</span>&nbsp;<span class="ident" id="3743056">_</span>&nbsp;<span class="op" id="3743058">=</span>&nbsp;<span class="ident" id="3743060">p</span><span class="op" id="3743061">.</span><span class="ident" id="3743062">parseSimpleStmt</span><span class="op" id="3743077">(</span><span class="ident" id="3743078">basic</span><span class="op" id="3743083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743091">if</span>&nbsp;<span class="ident" id="3743094">p</span><span class="op" id="3743095">.</span><span class="ident" id="3743096">tok</span>&nbsp;<span class="op" id="3743100">==</span>&nbsp;<span class="ident" id="3743103">token</span><span class="op" id="3743108">.</span><span class="ident" id="3743109">SEMICOLON</span>&nbsp;<span class="op" id="3743119">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743124">p</span><span class="op" id="3743125">.</span><span class="ident" id="3743126">next</span><span class="op" id="3743130">(</span><span class="op" id="3743131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743136">s1</span>&nbsp;<span class="op" id="3743139">=</span>&nbsp;<span class="ident" id="3743141">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743147">s2</span>&nbsp;<span class="op" id="3743150">=</span>&nbsp;<span class="builtintype" id="3743152">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743159">if</span>&nbsp;<span class="ident" id="3743162">p</span><span class="op" id="3743163">.</span><span class="ident" id="3743164">tok</span>&nbsp;<span class="op" id="3743168">!=</span>&nbsp;<span class="ident" id="3743171">token</span><span class="op" id="3743176">.</span><span class="ident" id="3743177">LBRACE</span>&nbsp;<span class="op" id="3743184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743190">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743250">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743309">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743369">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743376">//&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743417">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743424">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743478">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743538">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743593">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743600">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743665">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743729">p</span><span class="op" id="3743730">.</span><span class="ident" id="3743731">openScope</span><span class="op" id="3743740">(</span><span class="op" id="3743741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743747">defer</span>&nbsp;<span class="ident" id="3743753">p</span><span class="op" id="3743754">.</span><span class="ident" id="3743755">closeScope</span><span class="op" id="3743765">(</span><span class="op" id="3743766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743772">s2</span><span class="op" id="3743774">,</span>&nbsp;<span class="ident" id="3743776">_</span>&nbsp;<span class="op" id="3743778">=</span>&nbsp;<span class="ident" id="3743780">p</span><span class="op" id="3743781">.</span><span class="ident" id="3743782">parseSimpleStmt</span><span class="op" id="3743797">(</span><span class="ident" id="3743798">basic</span><span class="op" id="3743803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743808">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743816">p</span><span class="op" id="3743817">.</span><span class="ident" id="3743818">exprLev</span>&nbsp;<span class="op" id="3743826">=</span>&nbsp;<span class="ident" id="3743828">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743841">typeSwitch</span>&nbsp;<span class="op" id="3743852">:=</span>&nbsp;<span class="ident" id="3743855">isTypeSwitchGuard</span><span class="op" id="3743872">(</span><span class="ident" id="3743873">s2</span><span class="op" id="3743875">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743878">lbrace</span>&nbsp;<span class="op" id="3743885">:=</span>&nbsp;<span class="ident" id="3743888">p</span><span class="op" id="3743889">.</span><span class="ident" id="3743890">expect</span><span class="op" id="3743896">(</span><span class="ident" id="3743897">token</span><span class="op" id="3743902">.</span><span class="ident" id="3743903">LBRACE</span><span class="op" id="3743909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743912">var</span>&nbsp;<span class="ident" id="3743916">list</span>&nbsp;<span class="op" id="3743921">[</span><span class="op" id="3743922">]</span><span class="ident" id="3743923">ast</span><span class="op" id="3743926">.</span><span class="ident" id="3743927">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743933">for</span>&nbsp;<span class="ident" id="3743937">p</span><span class="op" id="3743938">.</span><span class="ident" id="3743939">tok</span>&nbsp;<span class="op" id="3743943">==</span>&nbsp;<span class="ident" id="3743946">token</span><span class="op" id="3743951">.</span><span class="ident" id="3743952">CASE</span>&nbsp;<span class="op" id="3743957">||</span>&nbsp;<span class="ident" id="3743960">p</span><span class="op" id="3743961">.</span><span class="ident" id="3743962">tok</span>&nbsp;<span class="op" id="3743966">==</span>&nbsp;<span class="ident" id="3743969">token</span><span class="op" id="3743974">.</span><span class="ident" id="3743975">DEFAULT</span>&nbsp;<span class="op" id="3743983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743987">list</span>&nbsp;<span class="op" id="3743992">=</span>&nbsp;<span class="builtinfunc" id="3743994">append</span><span class="op" id="3744000">(</span><span class="ident" id="3744001">list</span><span class="op" id="3744005">,</span>&nbsp;<span class="ident" id="3744007">p</span><span class="op" id="3744008">.</span><span class="ident" id="3744009">parseCaseClause</span><span class="op" id="3744024">(</span><span class="ident" id="3744025">typeSwitch</span><span class="op" id="3744035">)</span><span class="op" id="3744036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744039">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744042">rbrace</span>&nbsp;<span class="op" id="3744049">:=</span>&nbsp;<span class="ident" id="3744052">p</span><span class="op" id="3744053">.</span><span class="ident" id="3744054">expect</span><span class="op" id="3744060">(</span><span class="ident" id="3744061">token</span><span class="op" id="3744066">.</span><span class="ident" id="3744067">RBRACE</span><span class="op" id="3744073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744076">p</span><span class="op" id="3744077">.</span><span class="ident" id="3744078">expectSemi</span><span class="op" id="3744088">(</span><span class="op" id="3744089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744092">body</span>&nbsp;<span class="op" id="3744097">:=</span>&nbsp;<span class="op" id="3744100">&amp;</span><span class="ident" id="3744101">ast</span><span class="op" id="3744104">.</span><span class="ident" id="3744105">BlockStmt</span><span class="op" id="3744114">{</span><span class="ident" id="3744115">Lbrace</span><span class="op" id="3744121">:</span>&nbsp;<span class="ident" id="3744123">lbrace</span><span class="op" id="3744129">,</span>&nbsp;<span class="ident" id="3744131">List</span><span class="op" id="3744135">:</span>&nbsp;<span class="ident" id="3744137">list</span><span class="op" id="3744141">,</span>&nbsp;<span class="ident" id="3744143">Rbrace</span><span class="op" id="3744149">:</span>&nbsp;<span class="ident" id="3744151">rbrace</span><span class="op" id="3744157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744161">if</span>&nbsp;<span class="ident" id="3744164">typeSwitch</span>&nbsp;<span class="op" id="3744175">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744179">return</span>&nbsp;<span class="op" id="3744186">&amp;</span><span class="ident" id="3744187">ast</span><span class="op" id="3744190">.</span><span class="ident" id="3744191">TypeSwitchStmt</span><span class="op" id="3744205">{</span><span class="ident" id="3744206">Switch</span><span class="op" id="3744212">:</span>&nbsp;<span class="ident" id="3744214">pos</span><span class="op" id="3744217">,</span>&nbsp;<span class="ident" id="3744219">Init</span><span class="op" id="3744223">:</span>&nbsp;<span class="ident" id="3744225">s1</span><span class="op" id="3744227">,</span>&nbsp;<span class="ident" id="3744229">Assign</span><span class="op" id="3744235">:</span>&nbsp;<span class="ident" id="3744237">s2</span><span class="op" id="3744239">,</span>&nbsp;<span class="ident" id="3744241">Body</span><span class="op" id="3744245">:</span>&nbsp;<span class="ident" id="3744247">body</span><span class="op" id="3744251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744258">return</span>&nbsp;<span class="op" id="3744265">&amp;</span><span class="ident" id="3744266">ast</span><span class="op" id="3744269">.</span><span class="ident" id="3744270">SwitchStmt</span><span class="op" id="3744280">{</span><span class="ident" id="3744281">Switch</span><span class="op" id="3744287">:</span>&nbsp;<span class="ident" id="3744289">pos</span><span class="op" id="3744292">,</span>&nbsp;<span class="ident" id="3744294">Init</span><span class="op" id="3744298">:</span>&nbsp;<span class="ident" id="3744300">s1</span><span class="op" id="3744302">,</span>&nbsp;<span class="ident" id="3744304">Tag</span><span class="op" id="3744307">:</span>&nbsp;<span class="ident" id="3744309">p</span><span class="op" id="3744310">.</span><span class="ident" id="3744311">makeExpr</span><span class="op" id="3744319">(</span><span class="ident" id="3744320">s2</span><span class="op" id="3744322">,</span>&nbsp;<span class="string" id="3744324">&#34;switch&nbsp;expression&#34;</span><span class="op" id="3744343">)</span><span class="op" id="3744344">,</span>&nbsp;<span class="ident" id="3744346">Body</span><span class="op" id="3744350">:</span>&nbsp;<span class="ident" id="3744352">body</span><span class="op" id="3744356">}</span><br>
<span class="lineno"></span><span class="op" id="3744358">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="3744361">func</span>&nbsp;<span class="op" id="3744366">(</span><span class="ident" id="3744367">p</span>&nbsp;<span class="op" id="3744369">*</span><span class="ident" id="3744370">parser</span><span class="op" id="3744376">)</span>&nbsp;<span class="ident" id="3744378">parseCommClause</span><span class="op" id="3744393">(</span><span class="op" id="3744394">)</span>&nbsp;<span class="op" id="3744396">*</span><span class="ident" id="3744397">ast</span><span class="op" id="3744400">.</span><span class="ident" id="3744401">CommClause</span>&nbsp;<span class="op" id="3744412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744415">if</span>&nbsp;<span class="ident" id="3744418">p</span><span class="op" id="3744419">.</span><span class="ident" id="3744420">trace</span>&nbsp;<span class="op" id="3744426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744430">defer</span>&nbsp;<span class="ident" id="3744436">un</span><span class="op" id="3744438">(</span><span class="ident" id="3744439">trace</span><span class="op" id="3744444">(</span><span class="ident" id="3744445">p</span><span class="op" id="3744446">,</span>&nbsp;<span class="string" id="3744448">&#34;CommClause&#34;</span><span class="op" id="3744460">)</span><span class="op" id="3744461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744464">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744468">p</span><span class="op" id="3744469">.</span><span class="ident" id="3744470">openScope</span><span class="op" id="3744479">(</span><span class="op" id="3744480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744483">pos</span>&nbsp;<span class="op" id="3744487">:=</span>&nbsp;<span class="ident" id="3744490">p</span><span class="op" id="3744491">.</span><span class="ident" id="3744492">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744497">var</span>&nbsp;<span class="ident" id="3744501">comm</span>&nbsp;<span class="ident" id="3744506">ast</span><span class="op" id="3744509">.</span><span class="ident" id="3744510">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744516">if</span>&nbsp;<span class="ident" id="3744519">p</span><span class="op" id="3744520">.</span><span class="ident" id="3744521">tok</span>&nbsp;<span class="op" id="3744525">==</span>&nbsp;<span class="ident" id="3744528">token</span><span class="op" id="3744533">.</span><span class="ident" id="3744534">CASE</span>&nbsp;<span class="op" id="3744539">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744543">p</span><span class="op" id="3744544">.</span><span class="ident" id="3744545">next</span><span class="op" id="3744549">(</span><span class="op" id="3744550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744554">lhs</span>&nbsp;<span class="op" id="3744558">:=</span>&nbsp;<span class="ident" id="3744561">p</span><span class="op" id="3744562">.</span><span class="ident" id="3744563">parseLhsList</span><span class="op" id="3744575">(</span><span class="op" id="3744576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744580">if</span>&nbsp;<span class="ident" id="3744583">p</span><span class="op" id="3744584">.</span><span class="ident" id="3744585">tok</span>&nbsp;<span class="op" id="3744589">==</span>&nbsp;<span class="ident" id="3744592">token</span><span class="op" id="3744597">.</span><span class="ident" id="3744598">ARROW</span>&nbsp;<span class="op" id="3744604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3744609">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744624">if</span>&nbsp;<span class="builtinfunc" id="3744627">len</span><span class="op" id="3744630">(</span><span class="ident" id="3744631">lhs</span><span class="op" id="3744634">)</span>&nbsp;<span class="op" id="3744636">&gt;</span>&nbsp;<span class="num" id="3744638">1</span>&nbsp;<span class="op" id="3744640">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744646">p</span><span class="op" id="3744647">.</span><span class="ident" id="3744648">errorExpected</span><span class="op" id="3744661">(</span><span class="ident" id="3744662">lhs</span><span class="op" id="3744665">[</span><span class="num" id="3744666">0</span><span class="op" id="3744667">]</span><span class="op" id="3744668">.</span><span class="ident" id="3744669">Pos</span><span class="op" id="3744672">(</span><span class="op" id="3744673">)</span><span class="op" id="3744674">,</span>&nbsp;<span class="string" id="3744676">&#34;1&nbsp;expression&#34;</span><span class="op" id="3744690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3744696">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744738">arrow</span>&nbsp;<span class="op" id="3744744">:=</span>&nbsp;<span class="ident" id="3744747">p</span><span class="op" id="3744748">.</span><span class="ident" id="3744749">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744756">p</span><span class="op" id="3744757">.</span><span class="ident" id="3744758">next</span><span class="op" id="3744762">(</span><span class="op" id="3744763">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744768">rhs</span>&nbsp;<span class="op" id="3744772">:=</span>&nbsp;<span class="ident" id="3744775">p</span><span class="op" id="3744776">.</span><span class="ident" id="3744777">parseRhs</span><span class="op" id="3744785">(</span><span class="op" id="3744786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744791">comm</span>&nbsp;<span class="op" id="3744796">=</span>&nbsp;<span class="op" id="3744798">&amp;</span><span class="ident" id="3744799">ast</span><span class="op" id="3744802">.</span><span class="ident" id="3744803">SendStmt</span><span class="op" id="3744811">{</span><span class="ident" id="3744812">Chan</span><span class="op" id="3744816">:</span>&nbsp;<span class="ident" id="3744818">lhs</span><span class="op" id="3744821">[</span><span class="num" id="3744822">0</span><span class="op" id="3744823">]</span><span class="op" id="3744824">,</span>&nbsp;<span class="ident" id="3744826">Arrow</span><span class="op" id="3744831">:</span>&nbsp;<span class="ident" id="3744833">arrow</span><span class="op" id="3744838">,</span>&nbsp;<span class="ident" id="3744840">Value</span><span class="op" id="3744845">:</span>&nbsp;<span class="ident" id="3744847">rhs</span><span class="op" id="3744850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744854">}</span>&nbsp;<span class="keyword" id="3744856">else</span>&nbsp;<span class="op" id="3744861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3744866">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744881">if</span>&nbsp;<span class="ident" id="3744884">tok</span>&nbsp;<span class="op" id="3744888">:=</span>&nbsp;<span class="ident" id="3744891">p</span><span class="op" id="3744892">.</span><span class="ident" id="3744893">tok</span><span class="op" id="3744896">;</span>&nbsp;<span class="ident" id="3744898">tok</span>&nbsp;<span class="op" id="3744902">==</span>&nbsp;<span class="ident" id="3744905">token</span><span class="op" id="3744910">.</span><span class="ident" id="3744911">ASSIGN</span>&nbsp;<span class="op" id="3744918">||</span>&nbsp;<span class="ident" id="3744921">tok</span>&nbsp;<span class="op" id="3744925">==</span>&nbsp;<span class="ident" id="3744928">token</span><span class="op" id="3744933">.</span><span class="ident" id="3744934">DEFINE</span>&nbsp;<span class="op" id="3744941">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3744947">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744979">if</span>&nbsp;<span class="builtinfunc" id="3744982">len</span><span class="op" id="3744985">(</span><span class="ident" id="3744986">lhs</span><span class="op" id="3744989">)</span>&nbsp;<span class="op" id="3744991">&gt;</span>&nbsp;<span class="num" id="3744993">2</span>&nbsp;<span class="op" id="3744995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745002">p</span><span class="op" id="3745003">.</span><span class="ident" id="3745004">errorExpected</span><span class="op" id="3745017">(</span><span class="ident" id="3745018">lhs</span><span class="op" id="3745021">[</span><span class="num" id="3745022">0</span><span class="op" id="3745023">]</span><span class="op" id="3745024">.</span><span class="ident" id="3745025">Pos</span><span class="op" id="3745028">(</span><span class="op" id="3745029">)</span><span class="op" id="3745030">,</span>&nbsp;<span class="string" id="3745032">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="3745052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745059">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745103">lhs</span>&nbsp;<span class="op" id="3745107">=</span>&nbsp;<span class="ident" id="3745109">lhs</span><span class="op" id="3745112">[</span><span class="num" id="3745113">0</span><span class="op" id="3745114">:</span><span class="num" id="3745115">2</span><span class="op" id="3745116">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745128">pos</span>&nbsp;<span class="op" id="3745132">:=</span>&nbsp;<span class="ident" id="3745135">p</span><span class="op" id="3745136">.</span><span class="ident" id="3745137">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745145">p</span><span class="op" id="3745146">.</span><span class="ident" id="3745147">next</span><span class="op" id="3745151">(</span><span class="op" id="3745152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745158">rhs</span>&nbsp;<span class="op" id="3745162">:=</span>&nbsp;<span class="ident" id="3745165">p</span><span class="op" id="3745166">.</span><span class="ident" id="3745167">parseRhs</span><span class="op" id="3745175">(</span><span class="op" id="3745176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745182">as</span>&nbsp;<span class="op" id="3745185">:=</span>&nbsp;<span class="op" id="3745188">&amp;</span><span class="ident" id="3745189">ast</span><span class="op" id="3745192">.</span><span class="ident" id="3745193">AssignStmt</span><span class="op" id="3745203">{</span><span class="ident" id="3745204">Lhs</span><span class="op" id="3745207">:</span>&nbsp;<span class="ident" id="3745209">lhs</span><span class="op" id="3745212">,</span>&nbsp;<span class="ident" id="3745214">TokPos</span><span class="op" id="3745220">:</span>&nbsp;<span class="ident" id="3745222">pos</span><span class="op" id="3745225">,</span>&nbsp;<span class="ident" id="3745227">Tok</span><span class="op" id="3745230">:</span>&nbsp;<span class="ident" id="3745232">tok</span><span class="op" id="3745235">,</span>&nbsp;<span class="ident" id="3745237">Rhs</span><span class="op" id="3745240">:</span>&nbsp;<span class="op" id="3745242">[</span><span class="op" id="3745243">]</span><span class="ident" id="3745244">ast</span><span class="op" id="3745247">.</span><span class="ident" id="3745248">Expr</span><span class="op" id="3745252">{</span><span class="ident" id="3745253">rhs</span><span class="op" id="3745256">}</span><span class="op" id="3745257">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745263">if</span>&nbsp;<span class="ident" id="3745266">tok</span>&nbsp;<span class="op" id="3745270">==</span>&nbsp;<span class="ident" id="3745273">token</span><span class="op" id="3745278">.</span><span class="ident" id="3745279">DEFINE</span>&nbsp;<span class="op" id="3745286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745293">p</span><span class="op" id="3745294">.</span><span class="ident" id="3745295">shortVarDecl</span><span class="op" id="3745307">(</span><span class="ident" id="3745308">as</span><span class="op" id="3745310">,</span>&nbsp;<span class="ident" id="3745312">lhs</span><span class="op" id="3745315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745327">comm</span>&nbsp;<span class="op" id="3745332">=</span>&nbsp;<span class="ident" id="3745334">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745340">}</span>&nbsp;<span class="keyword" id="3745342">else</span>&nbsp;<span class="op" id="3745347">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745353">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745397">if</span>&nbsp;<span class="builtinfunc" id="3745400">len</span><span class="op" id="3745403">(</span><span class="ident" id="3745404">lhs</span><span class="op" id="3745407">)</span>&nbsp;<span class="op" id="3745409">&gt;</span>&nbsp;<span class="num" id="3745411">1</span>&nbsp;<span class="op" id="3745413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745420">p</span><span class="op" id="3745421">.</span><span class="ident" id="3745422">errorExpected</span><span class="op" id="3745435">(</span><span class="ident" id="3745436">lhs</span><span class="op" id="3745439">[</span><span class="num" id="3745440">0</span><span class="op" id="3745441">]</span><span class="op" id="3745442">.</span><span class="ident" id="3745443">Pos</span><span class="op" id="3745446">(</span><span class="op" id="3745447">)</span><span class="op" id="3745448">,</span>&nbsp;<span class="string" id="3745450">&#34;1&nbsp;expression&#34;</span><span class="op" id="3745464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745471">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745509">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745515">comm</span>&nbsp;<span class="op" id="3745520">=</span>&nbsp;<span class="op" id="3745522">&amp;</span><span class="ident" id="3745523">ast</span><span class="op" id="3745526">.</span><span class="ident" id="3745527">ExprStmt</span><span class="op" id="3745535">{</span><span class="ident" id="3745536">X</span><span class="op" id="3745537">:</span>&nbsp;<span class="ident" id="3745539">lhs</span><span class="op" id="3745542">[</span><span class="num" id="3745543">0</span><span class="op" id="3745544">]</span><span class="op" id="3745545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745557">}</span>&nbsp;<span class="keyword" id="3745559">else</span>&nbsp;<span class="op" id="3745564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745568">p</span><span class="op" id="3745569">.</span><span class="ident" id="3745570">expect</span><span class="op" id="3745576">(</span><span class="ident" id="3745577">token</span><span class="op" id="3745582">.</span><span class="ident" id="3745583">DEFAULT</span><span class="op" id="3745590">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745597">colon</span>&nbsp;<span class="op" id="3745603">:=</span>&nbsp;<span class="ident" id="3745606">p</span><span class="op" id="3745607">.</span><span class="ident" id="3745608">expect</span><span class="op" id="3745614">(</span><span class="ident" id="3745615">token</span><span class="op" id="3745620">.</span><span class="ident" id="3745621">COLON</span><span class="op" id="3745626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745629">body</span>&nbsp;<span class="op" id="3745634">:=</span>&nbsp;<span class="ident" id="3745637">p</span><span class="op" id="3745638">.</span><span class="ident" id="3745639">parseStmtList</span><span class="op" id="3745652">(</span><span class="op" id="3745653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745656">p</span><span class="op" id="3745657">.</span><span class="ident" id="3745658">closeScope</span><span class="op" id="3745668">(</span><span class="op" id="3745669">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745673">return</span>&nbsp;<span class="op" id="3745680">&amp;</span><span class="ident" id="3745681">ast</span><span class="op" id="3745684">.</span><span class="ident" id="3745685">CommClause</span><span class="op" id="3745695">{</span><span class="ident" id="3745696">Case</span><span class="op" id="3745700">:</span>&nbsp;<span class="ident" id="3745702">pos</span><span class="op" id="3745705">,</span>&nbsp;<span class="ident" id="3745707">Comm</span><span class="op" id="3745711">:</span>&nbsp;<span class="ident" id="3745713">comm</span><span class="op" id="3745717">,</span>&nbsp;<span class="ident" id="3745719">Colon</span><span class="op" id="3745724">:</span>&nbsp;<span class="ident" id="3745726">colon</span><span class="op" id="3745731">,</span>&nbsp;<span class="ident" id="3745733">Body</span><span class="op" id="3745737">:</span>&nbsp;<span class="ident" id="3745739">body</span><span class="op" id="3745743">}</span><br>
<span class="lineno"></span><span class="op" id="3745745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3745748">func</span>&nbsp;<span class="op" id="3745753">(</span><span class="ident" id="3745754">p</span>&nbsp;<span class="op" id="3745756">*</span><span class="ident" id="3745757">parser</span><span class="op" id="3745763">)</span>&nbsp;<span class="ident" id="3745765">parseSelectStmt</span><span class="op" id="3745780">(</span><span class="op" id="3745781">)</span>&nbsp;<span class="op" id="3745783">*</span><span class="ident" id="3745784">ast</span><span class="op" id="3745787">.</span><span class="ident" id="3745788">SelectStmt</span>&nbsp;<span class="op" id="3745799">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745802">if</span>&nbsp;<span class="ident" id="3745805">p</span><span class="op" id="3745806">.</span><span class="ident" id="3745807">trace</span>&nbsp;<span class="op" id="3745813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745817">defer</span>&nbsp;<span class="ident" id="3745823">un</span><span class="op" id="3745825">(</span><span class="ident" id="3745826">trace</span><span class="op" id="3745831">(</span><span class="ident" id="3745832">p</span><span class="op" id="3745833">,</span>&nbsp;<span class="string" id="3745835">&#34;SelectStmt&#34;</span><span class="op" id="3745847">)</span><span class="op" id="3745848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3745851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745855">pos</span>&nbsp;<span class="op" id="3745859">:=</span>&nbsp;<span class="ident" id="3745862">p</span><span class="op" id="3745863">.</span><span class="ident" id="3745864">expect</span><span class="op" id="3745870">(</span><span class="ident" id="3745871">token</span><span class="op" id="3745876">.</span><span class="ident" id="3745877">SELECT</span><span class="op" id="3745883">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745886">lbrace</span>&nbsp;<span class="op" id="3745893">:=</span>&nbsp;<span class="ident" id="3745896">p</span><span class="op" id="3745897">.</span><span class="ident" id="3745898">expect</span><span class="op" id="3745904">(</span><span class="ident" id="3745905">token</span><span class="op" id="3745910">.</span><span class="ident" id="3745911">LBRACE</span><span class="op" id="3745917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745920">var</span>&nbsp;<span class="ident" id="3745924">list</span>&nbsp;<span class="op" id="3745929">[</span><span class="op" id="3745930">]</span><span class="ident" id="3745931">ast</span><span class="op" id="3745934">.</span><span class="ident" id="3745935">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745941">for</span>&nbsp;<span class="ident" id="3745945">p</span><span class="op" id="3745946">.</span><span class="ident" id="3745947">tok</span>&nbsp;<span class="op" id="3745951">==</span>&nbsp;<span class="ident" id="3745954">token</span><span class="op" id="3745959">.</span><span class="ident" id="3745960">CASE</span>&nbsp;<span class="op" id="3745965">||</span>&nbsp;<span class="ident" id="3745968">p</span><span class="op" id="3745969">.</span><span class="ident" id="3745970">tok</span>&nbsp;<span class="op" id="3745974">==</span>&nbsp;<span class="ident" id="3745977">token</span><span class="op" id="3745982">.</span><span class="ident" id="3745983">DEFAULT</span>&nbsp;<span class="op" id="3745991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745995">list</span>&nbsp;<span class="op" id="3746000">=</span>&nbsp;<span class="builtinfunc" id="3746002">append</span><span class="op" id="3746008">(</span><span class="ident" id="3746009">list</span><span class="op" id="3746013">,</span>&nbsp;<span class="ident" id="3746015">p</span><span class="op" id="3746016">.</span><span class="ident" id="3746017">parseCommClause</span><span class="op" id="3746032">(</span><span class="op" id="3746033">)</span><span class="op" id="3746034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746037">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746040">rbrace</span>&nbsp;<span class="op" id="3746047">:=</span>&nbsp;<span class="ident" id="3746050">p</span><span class="op" id="3746051">.</span><span class="ident" id="3746052">expect</span><span class="op" id="3746058">(</span><span class="ident" id="3746059">token</span><span class="op" id="3746064">.</span><span class="ident" id="3746065">RBRACE</span><span class="op" id="3746071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746074">p</span><span class="op" id="3746075">.</span><span class="ident" id="3746076">expectSemi</span><span class="op" id="3746086">(</span><span class="op" id="3746087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746090">body</span>&nbsp;<span class="op" id="3746095">:=</span>&nbsp;<span class="op" id="3746098">&amp;</span><span class="ident" id="3746099">ast</span><span class="op" id="3746102">.</span><span class="ident" id="3746103">BlockStmt</span><span class="op" id="3746112">{</span><span class="ident" id="3746113">Lbrace</span><span class="op" id="3746119">:</span>&nbsp;<span class="ident" id="3746121">lbrace</span><span class="op" id="3746127">,</span>&nbsp;<span class="ident" id="3746129">List</span><span class="op" id="3746133">:</span>&nbsp;<span class="ident" id="3746135">list</span><span class="op" id="3746139">,</span>&nbsp;<span class="ident" id="3746141">Rbrace</span><span class="op" id="3746147">:</span>&nbsp;<span class="ident" id="3746149">rbrace</span><span class="op" id="3746155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746159">return</span>&nbsp;<span class="op" id="3746166">&amp;</span><span class="ident" id="3746167">ast</span><span class="op" id="3746170">.</span><span class="ident" id="3746171">SelectStmt</span><span class="op" id="3746181">{</span><span class="ident" id="3746182">Select</span><span class="op" id="3746188">:</span>&nbsp;<span class="ident" id="3746190">pos</span><span class="op" id="3746193">,</span>&nbsp;<span class="ident" id="3746195">Body</span><span class="op" id="3746199">:</span>&nbsp;<span class="ident" id="3746201">body</span><span class="op" id="3746205">}</span><br>
<span class="lineno">2030</span><span class="op" id="3746207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3746210">func</span>&nbsp;<span class="op" id="3746215">(</span><span class="ident" id="3746216">p</span>&nbsp;<span class="op" id="3746218">*</span><span class="ident" id="3746219">parser</span><span class="op" id="3746225">)</span>&nbsp;<span class="ident" id="3746227">parseForStmt</span><span class="op" id="3746239">(</span><span class="op" id="3746240">)</span>&nbsp;<span class="ident" id="3746242">ast</span><span class="op" id="3746245">.</span><span class="ident" id="3746246">Stmt</span>&nbsp;<span class="op" id="3746251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746254">if</span>&nbsp;<span class="ident" id="3746257">p</span><span class="op" id="3746258">.</span><span class="ident" id="3746259">trace</span>&nbsp;<span class="op" id="3746265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746269">defer</span>&nbsp;<span class="ident" id="3746275">un</span><span class="op" id="3746277">(</span><span class="ident" id="3746278">trace</span><span class="op" id="3746283">(</span><span class="ident" id="3746284">p</span><span class="op" id="3746285">,</span>&nbsp;<span class="string" id="3746287">&#34;ForStmt&#34;</span><span class="op" id="3746296">)</span><span class="op" id="3746297">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746304">pos</span>&nbsp;<span class="op" id="3746308">:=</span>&nbsp;<span class="ident" id="3746311">p</span><span class="op" id="3746312">.</span><span class="ident" id="3746313">expect</span><span class="op" id="3746319">(</span><span class="ident" id="3746320">token</span><span class="op" id="3746325">.</span><span class="ident" id="3746326">FOR</span><span class="op" id="3746329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746332">p</span><span class="op" id="3746333">.</span><span class="ident" id="3746334">openScope</span><span class="op" id="3746343">(</span><span class="op" id="3746344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746347">defer</span>&nbsp;<span class="ident" id="3746353">p</span><span class="op" id="3746354">.</span><span class="ident" id="3746355">closeScope</span><span class="op" id="3746365">(</span><span class="op" id="3746366">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746370">var</span>&nbsp;<span class="ident" id="3746374">s1</span><span class="op" id="3746376">,</span>&nbsp;<span class="ident" id="3746378">s2</span><span class="op" id="3746380">,</span>&nbsp;<span class="ident" id="3746382">s3</span>&nbsp;<span class="ident" id="3746385">ast</span><span class="op" id="3746388">.</span><span class="ident" id="3746389">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746395">var</span>&nbsp;<span class="ident" id="3746399">isRange</span>&nbsp;<span class="builtintype" id="3746407">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746413">if</span>&nbsp;<span class="ident" id="3746416">p</span><span class="op" id="3746417">.</span><span class="ident" id="3746418">tok</span>&nbsp;<span class="op" id="3746422">!=</span>&nbsp;<span class="ident" id="3746425">token</span><span class="op" id="3746430">.</span><span class="ident" id="3746431">LBRACE</span>&nbsp;<span class="op" id="3746438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746442">prevLev</span>&nbsp;<span class="op" id="3746450">:=</span>&nbsp;<span class="ident" id="3746453">p</span><span class="op" id="3746454">.</span><span class="ident" id="3746455">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746465">p</span><span class="op" id="3746466">.</span><span class="ident" id="3746467">exprLev</span>&nbsp;<span class="op" id="3746475">=</span>&nbsp;<span class="op" id="3746477">-</span><span class="num" id="3746478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746482">if</span>&nbsp;<span class="ident" id="3746485">p</span><span class="op" id="3746486">.</span><span class="ident" id="3746487">tok</span>&nbsp;<span class="op" id="3746491">!=</span>&nbsp;<span class="ident" id="3746494">token</span><span class="op" id="3746499">.</span><span class="ident" id="3746500">SEMICOLON</span>&nbsp;<span class="op" id="3746510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746515">if</span>&nbsp;<span class="ident" id="3746518">p</span><span class="op" id="3746519">.</span><span class="ident" id="3746520">tok</span>&nbsp;<span class="op" id="3746524">==</span>&nbsp;<span class="ident" id="3746527">token</span><span class="op" id="3746532">.</span><span class="ident" id="3746533">RANGE</span>&nbsp;<span class="op" id="3746539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746545">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746590">pos</span>&nbsp;<span class="op" id="3746594">:=</span>&nbsp;<span class="ident" id="3746597">p</span><span class="op" id="3746598">.</span><span class="ident" id="3746599">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746607">p</span><span class="op" id="3746608">.</span><span class="ident" id="3746609">next</span><span class="op" id="3746613">(</span><span class="op" id="3746614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746620">y</span>&nbsp;<span class="op" id="3746622">:=</span>&nbsp;<span class="op" id="3746625">[</span><span class="op" id="3746626">]</span><span class="ident" id="3746627">ast</span><span class="op" id="3746630">.</span><span class="ident" id="3746631">Expr</span><span class="op" id="3746635">{</span><span class="op" id="3746636">&amp;</span><span class="ident" id="3746637">ast</span><span class="op" id="3746640">.</span><span class="ident" id="3746641">UnaryExpr</span><span class="op" id="3746650">{</span><span class="ident" id="3746651">OpPos</span><span class="op" id="3746656">:</span>&nbsp;<span class="ident" id="3746658">pos</span><span class="op" id="3746661">,</span>&nbsp;<span class="ident" id="3746663">Op</span><span class="op" id="3746665">:</span>&nbsp;<span class="ident" id="3746667">token</span><span class="op" id="3746672">.</span><span class="ident" id="3746673">RANGE</span><span class="op" id="3746678">,</span>&nbsp;<span class="ident" id="3746680">X</span><span class="op" id="3746681">:</span>&nbsp;<span class="ident" id="3746683">p</span><span class="op" id="3746684">.</span><span class="ident" id="3746685">parseRhs</span><span class="op" id="3746693">(</span><span class="op" id="3746694">)</span><span class="op" id="3746695">}</span><span class="op" id="3746696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746702">s2</span>&nbsp;<span class="op" id="3746705">=</span>&nbsp;<span class="op" id="3746707">&amp;</span><span class="ident" id="3746708">ast</span><span class="op" id="3746711">.</span><span class="ident" id="3746712">AssignStmt</span><span class="op" id="3746722">{</span><span class="ident" id="3746723">Rhs</span><span class="op" id="3746726">:</span>&nbsp;<span class="ident" id="3746728">y</span><span class="op" id="3746729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746735">isRange</span>&nbsp;<span class="op" id="3746743">=</span>&nbsp;<span class="builtintype" id="3746745">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746753">}</span>&nbsp;<span class="keyword" id="3746755">else</span>&nbsp;<span class="op" id="3746760">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746766">s2</span><span class="op" id="3746768">,</span>&nbsp;<span class="ident" id="3746770">isRange</span>&nbsp;<span class="op" id="3746778">=</span>&nbsp;<span class="ident" id="3746780">p</span><span class="op" id="3746781">.</span><span class="ident" id="3746782">parseSimpleStmt</span><span class="op" id="3746797">(</span><span class="ident" id="3746798">rangeOk</span><span class="op" id="3746805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746818">if</span>&nbsp;<span class="op" id="3746821">!</span><span class="ident" id="3746822">isRange</span>&nbsp;<span class="op" id="3746830">&amp;&amp;</span>&nbsp;<span class="ident" id="3746833">p</span><span class="op" id="3746834">.</span><span class="ident" id="3746835">tok</span>&nbsp;<span class="op" id="3746839">==</span>&nbsp;<span class="ident" id="3746842">token</span><span class="op" id="3746847">.</span><span class="ident" id="3746848">SEMICOLON</span>&nbsp;<span class="op" id="3746858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746863">p</span><span class="op" id="3746864">.</span><span class="ident" id="3746865">next</span><span class="op" id="3746869">(</span><span class="op" id="3746870">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746875">s1</span>&nbsp;<span class="op" id="3746878">=</span>&nbsp;<span class="ident" id="3746880">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746886">s2</span>&nbsp;<span class="op" id="3746889">=</span>&nbsp;<span class="builtintype" id="3746891">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746898">if</span>&nbsp;<span class="ident" id="3746901">p</span><span class="op" id="3746902">.</span><span class="ident" id="3746903">tok</span>&nbsp;<span class="op" id="3746907">!=</span>&nbsp;<span class="ident" id="3746910">token</span><span class="op" id="3746915">.</span><span class="ident" id="3746916">SEMICOLON</span>&nbsp;<span class="op" id="3746926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746932">s2</span><span class="op" id="3746934">,</span>&nbsp;<span class="ident" id="3746936">_</span>&nbsp;<span class="op" id="3746938">=</span>&nbsp;<span class="ident" id="3746940">p</span><span class="op" id="3746941">.</span><span class="ident" id="3746942">parseSimpleStmt</span><span class="op" id="3746957">(</span><span class="ident" id="3746958">basic</span><span class="op" id="3746963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746968">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746973">p</span><span class="op" id="3746974">.</span><span class="ident" id="3746975">expectSemi</span><span class="op" id="3746985">(</span><span class="op" id="3746986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746991">if</span>&nbsp;<span class="ident" id="3746994">p</span><span class="op" id="3746995">.</span><span class="ident" id="3746996">tok</span>&nbsp;<span class="op" id="3747000">!=</span>&nbsp;<span class="ident" id="3747003">token</span><span class="op" id="3747008">.</span><span class="ident" id="3747009">LBRACE</span>&nbsp;<span class="op" id="3747016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747022">s3</span><span class="op" id="3747024">,</span>&nbsp;<span class="ident" id="3747026">_</span>&nbsp;<span class="op" id="3747028">=</span>&nbsp;<span class="ident" id="3747030">p</span><span class="op" id="3747031">.</span><span class="ident" id="3747032">parseSimpleStmt</span><span class="op" id="3747047">(</span><span class="ident" id="3747048">basic</span><span class="op" id="3747053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747062">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747066">p</span><span class="op" id="3747067">.</span><span class="ident" id="3747068">exprLev</span>&nbsp;<span class="op" id="3747076">=</span>&nbsp;<span class="ident" id="3747078">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747091">body</span>&nbsp;<span class="op" id="3747096">:=</span>&nbsp;<span class="ident" id="3747099">p</span><span class="op" id="3747100">.</span><span class="ident" id="3747101">parseBlockStmt</span><span class="op" id="3747115">(</span><span class="op" id="3747116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747119">p</span><span class="op" id="3747120">.</span><span class="ident" id="3747121">expectSemi</span><span class="op" id="3747131">(</span><span class="op" id="3747132">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747136">if</span>&nbsp;<span class="ident" id="3747139">isRange</span>&nbsp;<span class="op" id="3747147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747151">as</span>&nbsp;<span class="op" id="3747154">:=</span>&nbsp;<span class="ident" id="3747157">s2</span><span class="op" id="3747159">.</span><span class="op" id="3747160">(</span><span class="op" id="3747161">*</span><span class="ident" id="3747162">ast</span><span class="op" id="3747165">.</span><span class="ident" id="3747166">AssignStmt</span><span class="op" id="3747176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3747180">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747195">var</span>&nbsp;<span class="ident" id="3747199">key</span><span class="op" id="3747202">,</span>&nbsp;<span class="ident" id="3747204">value</span>&nbsp;<span class="ident" id="3747210">ast</span><span class="op" id="3747213">.</span><span class="ident" id="3747214">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747221">switch</span>&nbsp;<span class="builtinfunc" id="3747228">len</span><span class="op" id="3747231">(</span><span class="ident" id="3747232">as</span><span class="op" id="3747234">.</span><span class="ident" id="3747235">Lhs</span><span class="op" id="3747238">)</span>&nbsp;<span class="op" id="3747240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747244">case</span>&nbsp;<span class="num" id="3747249">0</span><span class="op" id="3747250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3747255">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747274">case</span>&nbsp;<span class="num" id="3747279">1</span><span class="op" id="3747280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747285">key</span>&nbsp;<span class="op" id="3747289">=</span>&nbsp;<span class="ident" id="3747291">as</span><span class="op" id="3747293">.</span><span class="ident" id="3747294">Lhs</span><span class="op" id="3747297">[</span><span class="num" id="3747298">0</span><span class="op" id="3747299">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747303">case</span>&nbsp;<span class="num" id="3747308">2</span><span class="op" id="3747309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747314">key</span><span class="op" id="3747317">,</span>&nbsp;<span class="ident" id="3747319">value</span>&nbsp;<span class="op" id="3747325">=</span>&nbsp;<span class="ident" id="3747327">as</span><span class="op" id="3747329">.</span><span class="ident" id="3747330">Lhs</span><span class="op" id="3747333">[</span><span class="num" id="3747334">0</span><span class="op" id="3747335">]</span><span class="op" id="3747336">,</span>&nbsp;<span class="ident" id="3747338">as</span><span class="op" id="3747340">.</span><span class="ident" id="3747341">Lhs</span><span class="op" id="3747344">[</span><span class="num" id="3747345">1</span><span class="op" id="3747346">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747350">default</span><span class="op" id="3747357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747362">p</span><span class="op" id="3747363">.</span><span class="ident" id="3747364">errorExpected</span><span class="op" id="3747377">(</span><span class="ident" id="3747378">as</span><span class="op" id="3747380">.</span><span class="ident" id="3747381">Lhs</span><span class="op" id="3747384">[</span><span class="builtinfunc" id="3747385">len</span><span class="op" id="3747388">(</span><span class="ident" id="3747389">as</span><span class="op" id="3747391">.</span><span class="ident" id="3747392">Lhs</span><span class="op" id="3747395">)</span><span class="op" id="3747396">-</span><span class="num" id="3747397">1</span><span class="op" id="3747398">]</span><span class="op" id="3747399">.</span><span class="ident" id="3747400">Pos</span><span class="op" id="3747403">(</span><span class="op" id="3747404">)</span><span class="op" id="3747405">,</span>&nbsp;<span class="string" id="3747407">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="3747430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747435">return</span>&nbsp;<span class="op" id="3747442">&amp;</span><span class="ident" id="3747443">ast</span><span class="op" id="3747446">.</span><span class="ident" id="3747447">BadStmt</span><span class="op" id="3747454">{</span><span class="ident" id="3747455">From</span><span class="op" id="3747459">:</span>&nbsp;<span class="ident" id="3747461">pos</span><span class="op" id="3747464">,</span>&nbsp;<span class="ident" id="3747466">To</span><span class="op" id="3747468">:</span>&nbsp;<span class="ident" id="3747470">p</span><span class="op" id="3747471">.</span><span class="ident" id="3747472">safePos</span><span class="op" id="3747479">(</span><span class="ident" id="3747480">body</span><span class="op" id="3747484">.</span><span class="ident" id="3747485">End</span><span class="op" id="3747488">(</span><span class="op" id="3747489">)</span><span class="op" id="3747490">)</span><span class="op" id="3747491">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3747499">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3747552">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747608">x</span>&nbsp;<span class="op" id="3747610">:=</span>&nbsp;<span class="ident" id="3747613">as</span><span class="op" id="3747615">.</span><span class="ident" id="3747616">Rhs</span><span class="op" id="3747619">[</span><span class="num" id="3747620">0</span><span class="op" id="3747621">]</span><span class="op" id="3747622">.</span><span class="op" id="3747623">(</span><span class="op" id="3747624">*</span><span class="ident" id="3747625">ast</span><span class="op" id="3747628">.</span><span class="ident" id="3747629">UnaryExpr</span><span class="op" id="3747638">)</span><span class="op" id="3747639">.</span><span class="ident" id="3747640">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747644">return</span>&nbsp;<span class="op" id="3747651">&amp;</span><span class="ident" id="3747652">ast</span><span class="op" id="3747655">.</span><span class="ident" id="3747656">RangeStmt</span><span class="op" id="3747665">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747670">For</span><span class="op" id="3747673">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747678">pos</span><span class="op" id="3747681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747686">Key</span><span class="op" id="3747689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747694">key</span><span class="op" id="3747697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747702">Value</span><span class="op" id="3747707">:</span>&nbsp;&nbsp;<span class="ident" id="3747710">value</span><span class="op" id="3747715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747720">TokPos</span><span class="op" id="3747726">:</span>&nbsp;<span class="ident" id="3747728">as</span><span class="op" id="3747730">.</span><span class="ident" id="3747731">TokPos</span><span class="op" id="3747737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747742">Tok</span><span class="op" id="3747745">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747750">as</span><span class="op" id="3747752">.</span><span class="ident" id="3747753">Tok</span><span class="op" id="3747756">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747761">X</span><span class="op" id="3747762">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747769">x</span><span class="op" id="3747770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747775">Body</span><span class="op" id="3747779">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3747783">body</span><span class="op" id="3747787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3747798">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747824">return</span>&nbsp;<span class="op" id="3747831">&amp;</span><span class="ident" id="3747832">ast</span><span class="op" id="3747835">.</span><span class="ident" id="3747836">ForStmt</span><span class="op" id="3747843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747847">For</span><span class="op" id="3747850">:</span>&nbsp;&nbsp;<span class="ident" id="3747853">pos</span><span class="op" id="3747856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747860">Init</span><span class="op" id="3747864">:</span>&nbsp;<span class="ident" id="3747866">s1</span><span class="op" id="3747868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747872">Cond</span><span class="op" id="3747876">:</span>&nbsp;<span class="ident" id="3747878">p</span><span class="op" id="3747879">.</span><span class="ident" id="3747880">makeExpr</span><span class="op" id="3747888">(</span><span class="ident" id="3747889">s2</span><span class="op" id="3747891">,</span>&nbsp;<span class="string" id="3747893">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="3747922">)</span><span class="op" id="3747923">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747927">Post</span><span class="op" id="3747931">:</span>&nbsp;<span class="ident" id="3747933">s3</span><span class="op" id="3747935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747939">Body</span><span class="op" id="3747943">:</span>&nbsp;<span class="ident" id="3747945">body</span><span class="op" id="3747949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747952">}</span><br>
<span class="lineno"></span><span class="op" id="3747954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="3747957">func</span>&nbsp;<span class="op" id="3747962">(</span><span class="ident" id="3747963">p</span>&nbsp;<span class="op" id="3747965">*</span><span class="ident" id="3747966">parser</span><span class="op" id="3747972">)</span>&nbsp;<span class="ident" id="3747974">parseStmt</span><span class="op" id="3747983">(</span><span class="op" id="3747984">)</span>&nbsp;<span class="op" id="3747986">(</span><span class="ident" id="3747987">s</span>&nbsp;<span class="ident" id="3747989">ast</span><span class="op" id="3747992">.</span><span class="ident" id="3747993">Stmt</span><span class="op" id="3747997">)</span>&nbsp;<span class="op" id="3747999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748002">if</span>&nbsp;<span class="ident" id="3748005">p</span><span class="op" id="3748006">.</span><span class="ident" id="3748007">trace</span>&nbsp;<span class="op" id="3748013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748017">defer</span>&nbsp;<span class="ident" id="3748023">un</span><span class="op" id="3748025">(</span><span class="ident" id="3748026">trace</span><span class="op" id="3748031">(</span><span class="ident" id="3748032">p</span><span class="op" id="3748033">,</span>&nbsp;<span class="string" id="3748035">&#34;Statement&#34;</span><span class="op" id="3748046">)</span><span class="op" id="3748047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3748050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748054">switch</span>&nbsp;<span class="ident" id="3748061">p</span><span class="op" id="3748062">.</span><span class="ident" id="3748063">tok</span>&nbsp;<span class="op" id="3748067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748070">case</span>&nbsp;<span class="ident" id="3748075">token</span><span class="op" id="3748080">.</span><span class="ident" id="3748081">CONST</span><span class="op" id="3748086">,</span>&nbsp;<span class="ident" id="3748088">token</span><span class="op" id="3748093">.</span><span class="ident" id="3748094">TYPE</span><span class="op" id="3748098">,</span>&nbsp;<span class="ident" id="3748100">token</span><span class="op" id="3748105">.</span><span class="ident" id="3748106">VAR</span><span class="op" id="3748109">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748113">s</span>&nbsp;<span class="op" id="3748115">=</span>&nbsp;<span class="op" id="3748117">&amp;</span><span class="ident" id="3748118">ast</span><span class="op" id="3748121">.</span><span class="ident" id="3748122">DeclStmt</span><span class="op" id="3748130">{</span><span class="ident" id="3748131">Decl</span><span class="op" id="3748135">:</span>&nbsp;<span class="ident" id="3748137">p</span><span class="op" id="3748138">.</span><span class="ident" id="3748139">parseDecl</span><span class="op" id="3748148">(</span><span class="ident" id="3748149">syncStmt</span><span class="op" id="3748157">)</span><span class="op" id="3748158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748161">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3748168">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748209">token</span><span class="op" id="3748214">.</span><span class="ident" id="3748215">IDENT</span><span class="op" id="3748220">,</span>&nbsp;<span class="ident" id="3748222">token</span><span class="op" id="3748227">.</span><span class="ident" id="3748228">INT</span><span class="op" id="3748231">,</span>&nbsp;<span class="ident" id="3748233">token</span><span class="op" id="3748238">.</span><span class="ident" id="3748239">FLOAT</span><span class="op" id="3748244">,</span>&nbsp;<span class="ident" id="3748246">token</span><span class="op" id="3748251">.</span><span class="ident" id="3748252">IMAG</span><span class="op" id="3748256">,</span>&nbsp;<span class="ident" id="3748258">token</span><span class="op" id="3748263">.</span><span class="ident" id="3748264">CHAR</span><span class="op" id="3748268">,</span>&nbsp;<span class="ident" id="3748270">token</span><span class="op" id="3748275">.</span><span class="ident" id="3748276">STRING</span><span class="op" id="3748282">,</span>&nbsp;<span class="ident" id="3748284">token</span><span class="op" id="3748289">.</span><span class="ident" id="3748290">FUNC</span><span class="op" id="3748294">,</span>&nbsp;<span class="ident" id="3748296">token</span><span class="op" id="3748301">.</span><span class="ident" id="3748302">LPAREN</span><span class="op" id="3748308">,</span>&nbsp;<span class="comment" id="3748310">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748324">token</span><span class="op" id="3748329">.</span><span class="ident" id="3748330">LBRACK</span><span class="op" id="3748336">,</span>&nbsp;<span class="ident" id="3748338">token</span><span class="op" id="3748343">.</span><span class="ident" id="3748344">STRUCT</span><span class="op" id="3748350">,</span>&nbsp;<span class="comment" id="3748352">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748373">token</span><span class="op" id="3748378">.</span><span class="ident" id="3748379">ADD</span><span class="op" id="3748382">,</span>&nbsp;<span class="ident" id="3748384">token</span><span class="op" id="3748389">.</span><span class="ident" id="3748390">SUB</span><span class="op" id="3748393">,</span>&nbsp;<span class="ident" id="3748395">token</span><span class="op" id="3748400">.</span><span class="ident" id="3748401">MUL</span><span class="op" id="3748404">,</span>&nbsp;<span class="ident" id="3748406">token</span><span class="op" id="3748411">.</span><span class="ident" id="3748412">AND</span><span class="op" id="3748415">,</span>&nbsp;<span class="ident" id="3748417">token</span><span class="op" id="3748422">.</span><span class="ident" id="3748423">XOR</span><span class="op" id="3748426">,</span>&nbsp;<span class="ident" id="3748428">token</span><span class="op" id="3748433">.</span><span class="ident" id="3748434">ARROW</span><span class="op" id="3748439">,</span>&nbsp;<span class="ident" id="3748441">token</span><span class="op" id="3748446">.</span><span class="ident" id="3748447">NOT</span><span class="op" id="3748450">:</span>&nbsp;<span class="comment" id="3748452">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748473">s</span><span class="op" id="3748474">,</span>&nbsp;<span class="ident" id="3748476">_</span>&nbsp;<span class="op" id="3748478">=</span>&nbsp;<span class="ident" id="3748480">p</span><span class="op" id="3748481">.</span><span class="ident" id="3748482">parseSimpleStmt</span><span class="op" id="3748497">(</span><span class="ident" id="3748498">labelOk</span><span class="op" id="3748505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3748509">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3748573">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3748637">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748647">if</span>&nbsp;<span class="ident" id="3748650">_</span><span class="op" id="3748651">,</span>&nbsp;<span class="ident" id="3748653">isLabeledStmt</span>&nbsp;<span class="op" id="3748667">:=</span>&nbsp;<span class="ident" id="3748670">s</span><span class="op" id="3748671">.</span><span class="op" id="3748672">(</span><span class="op" id="3748673">*</span><span class="ident" id="3748674">ast</span><span class="op" id="3748677">.</span><span class="ident" id="3748678">LabeledStmt</span><span class="op" id="3748689">)</span><span class="op" id="3748690">;</span>&nbsp;<span class="op" id="3748692">!</span><span class="ident" id="3748693">isLabeledStmt</span>&nbsp;<span class="op" id="3748707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748712">p</span><span class="op" id="3748713">.</span><span class="ident" id="3748714">expectSemi</span><span class="op" id="3748724">(</span><span class="op" id="3748725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3748729">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748732">case</span>&nbsp;<span class="ident" id="3748737">token</span><span class="op" id="3748742">.</span><span class="ident" id="3748743">GO</span><span class="op" id="3748745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748749">s</span>&nbsp;<span class="op" id="3748751">=</span>&nbsp;<span class="ident" id="3748753">p</span><span class="op" id="3748754">.</span><span class="ident" id="3748755">parseGoStmt</span><span class="op" id="3748766">(</span><span class="op" id="3748767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748770">case</span>&nbsp;<span class="ident" id="3748775">token</span><span class="op" id="3748780">.</span><span class="ident" id="3748781">DEFER</span><span class="op" id="3748786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748790">s</span>&nbsp;<span class="op" id="3748792">=</span>&nbsp;<span class="ident" id="3748794">p</span><span class="op" id="3748795">.</span><span class="ident" id="3748796">parseDeferStmt</span><span class="op" id="3748810">(</span><span class="op" id="3748811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748814">case</span>&nbsp;<span class="ident" id="3748819">token</span><span class="op" id="3748824">.</span><span class="ident" id="3748825">RETURN</span><span class="op" id="3748831">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748835">s</span>&nbsp;<span class="op" id="3748837">=</span>&nbsp;<span class="ident" id="3748839">p</span><span class="op" id="3748840">.</span><span class="ident" id="3748841">parseReturnStmt</span><span class="op" id="3748856">(</span><span class="op" id="3748857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748860">case</span>&nbsp;<span class="ident" id="3748865">token</span><span class="op" id="3748870">.</span><span class="ident" id="3748871">BREAK</span><span class="op" id="3748876">,</span>&nbsp;<span class="ident" id="3748878">token</span><span class="op" id="3748883">.</span><span class="ident" id="3748884">CONTINUE</span><span class="op" id="3748892">,</span>&nbsp;<span class="ident" id="3748894">token</span><span class="op" id="3748899">.</span><span class="ident" id="3748900">GOTO</span><span class="op" id="3748904">,</span>&nbsp;<span class="ident" id="3748906">token</span><span class="op" id="3748911">.</span><span class="ident" id="3748912">FALLTHROUGH</span><span class="op" id="3748923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748927">s</span>&nbsp;<span class="op" id="3748929">=</span>&nbsp;<span class="ident" id="3748931">p</span><span class="op" id="3748932">.</span><span class="ident" id="3748933">parseBranchStmt</span><span class="op" id="3748948">(</span><span class="ident" id="3748949">p</span><span class="op" id="3748950">.</span><span class="ident" id="3748951">tok</span><span class="op" id="3748954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748957">case</span>&nbsp;<span class="ident" id="3748962">token</span><span class="op" id="3748967">.</span><span class="ident" id="3748968">LBRACE</span><span class="op" id="3748974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748978">s</span>&nbsp;<span class="op" id="3748980">=</span>&nbsp;<span class="ident" id="3748982">p</span><span class="op" id="3748983">.</span><span class="ident" id="3748984">parseBlockStmt</span><span class="op" id="3748998">(</span><span class="op" id="3748999">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749003">p</span><span class="op" id="3749004">.</span><span class="ident" id="3749005">expectSemi</span><span class="op" id="3749015">(</span><span class="op" id="3749016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749019">case</span>&nbsp;<span class="ident" id="3749024">token</span><span class="op" id="3749029">.</span><span class="ident" id="3749030">IF</span><span class="op" id="3749032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749036">s</span>&nbsp;<span class="op" id="3749038">=</span>&nbsp;<span class="ident" id="3749040">p</span><span class="op" id="3749041">.</span><span class="ident" id="3749042">parseIfStmt</span><span class="op" id="3749053">(</span><span class="op" id="3749054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749057">case</span>&nbsp;<span class="ident" id="3749062">token</span><span class="op" id="3749067">.</span><span class="ident" id="3749068">SWITCH</span><span class="op" id="3749074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749078">s</span>&nbsp;<span class="op" id="3749080">=</span>&nbsp;<span class="ident" id="3749082">p</span><span class="op" id="3749083">.</span><span class="ident" id="3749084">parseSwitchStmt</span><span class="op" id="3749099">(</span><span class="op" id="3749100">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749103">case</span>&nbsp;<span class="ident" id="3749108">token</span><span class="op" id="3749113">.</span><span class="ident" id="3749114">SELECT</span><span class="op" id="3749120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749124">s</span>&nbsp;<span class="op" id="3749126">=</span>&nbsp;<span class="ident" id="3749128">p</span><span class="op" id="3749129">.</span><span class="ident" id="3749130">parseSelectStmt</span><span class="op" id="3749145">(</span><span class="op" id="3749146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749149">case</span>&nbsp;<span class="ident" id="3749154">token</span><span class="op" id="3749159">.</span><span class="ident" id="3749160">FOR</span><span class="op" id="3749163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749167">s</span>&nbsp;<span class="op" id="3749169">=</span>&nbsp;<span class="ident" id="3749171">p</span><span class="op" id="3749172">.</span><span class="ident" id="3749173">parseForStmt</span><span class="op" id="3749185">(</span><span class="op" id="3749186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749189">case</span>&nbsp;<span class="ident" id="3749194">token</span><span class="op" id="3749199">.</span><span class="ident" id="3749200">SEMICOLON</span><span class="op" id="3749209">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749213">s</span>&nbsp;<span class="op" id="3749215">=</span>&nbsp;<span class="op" id="3749217">&amp;</span><span class="ident" id="3749218">ast</span><span class="op" id="3749221">.</span><span class="ident" id="3749222">EmptyStmt</span><span class="op" id="3749231">{</span><span class="ident" id="3749232">Semicolon</span><span class="op" id="3749241">:</span>&nbsp;<span class="ident" id="3749243">p</span><span class="op" id="3749244">.</span><span class="ident" id="3749245">pos</span><span class="op" id="3749248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749252">p</span><span class="op" id="3749253">.</span><span class="ident" id="3749254">next</span><span class="op" id="3749258">(</span><span class="op" id="3749259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749262">case</span>&nbsp;<span class="ident" id="3749267">token</span><span class="op" id="3749272">.</span><span class="ident" id="3749273">RBRACE</span><span class="op" id="3749279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3749283">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749336">s</span>&nbsp;<span class="op" id="3749338">=</span>&nbsp;<span class="op" id="3749340">&amp;</span><span class="ident" id="3749341">ast</span><span class="op" id="3749344">.</span><span class="ident" id="3749345">EmptyStmt</span><span class="op" id="3749354">{</span><span class="ident" id="3749355">Semicolon</span><span class="op" id="3749364">:</span>&nbsp;<span class="ident" id="3749366">p</span><span class="op" id="3749367">.</span><span class="ident" id="3749368">pos</span><span class="op" id="3749371">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749374">default</span><span class="op" id="3749381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3749385">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749409">pos</span>&nbsp;<span class="op" id="3749413">:=</span>&nbsp;<span class="ident" id="3749416">p</span><span class="op" id="3749417">.</span><span class="ident" id="3749418">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749424">p</span><span class="op" id="3749425">.</span><span class="ident" id="3749426">errorExpected</span><span class="op" id="3749439">(</span><span class="ident" id="3749440">pos</span><span class="op" id="3749443">,</span>&nbsp;<span class="string" id="3749445">&#34;statement&#34;</span><span class="op" id="3749456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749460">syncStmt</span><span class="op" id="3749468">(</span><span class="ident" id="3749469">p</span><span class="op" id="3749470">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749474">s</span>&nbsp;<span class="op" id="3749476">=</span>&nbsp;<span class="op" id="3749478">&amp;</span><span class="ident" id="3749479">ast</span><span class="op" id="3749482">.</span><span class="ident" id="3749483">BadStmt</span><span class="op" id="3749490">{</span><span class="ident" id="3749491">From</span><span class="op" id="3749495">:</span>&nbsp;<span class="ident" id="3749497">pos</span><span class="op" id="3749500">,</span>&nbsp;<span class="ident" id="3749502">To</span><span class="op" id="3749504">:</span>&nbsp;<span class="ident" id="3749506">p</span><span class="op" id="3749507">.</span><span class="ident" id="3749508">pos</span><span class="op" id="3749511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3749514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749518">return</span><br>
<span class="lineno"></span><span class="op" id="3749525">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="3749528">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3749608">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749625">type</span>&nbsp;<span class="ident" id="3749630">parseSpecFunction</span>&nbsp;<span class="keyword" id="3749648">func</span><span class="op" id="3749652">(</span><span class="ident" id="3749653">doc</span>&nbsp;<span class="op" id="3749657">*</span><span class="ident" id="3749658">ast</span><span class="op" id="3749661">.</span><span class="ident" id="3749662">CommentGroup</span><span class="op" id="3749674">,</span>&nbsp;<span class="ident" id="3749676">keyword</span>&nbsp;<span class="ident" id="3749684">token</span><span class="op" id="3749689">.</span><span class="ident" id="3749690">Token</span><span class="op" id="3749695">,</span>&nbsp;<span class="ident" id="3749697">iota</span>&nbsp;<span class="builtintype" id="3749702">int</span><span class="op" id="3749705">)</span>&nbsp;<span class="ident" id="3749707">ast</span><span class="op" id="3749710">.</span><span class="ident" id="3749711">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="3749717">func</span>&nbsp;<span class="ident" id="3749722">isValidImport</span><span class="op" id="3749735">(</span><span class="ident" id="3749736">lit</span>&nbsp;<span class="builtintype" id="3749740">string</span><span class="op" id="3749746">)</span>&nbsp;<span class="builtintype" id="3749748">bool</span>&nbsp;<span class="op" id="3749753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749756">const</span>&nbsp;<span class="ident" id="3749762">illegalChars</span>&nbsp;<span class="op" id="3749775">=</span>&nbsp;<span class="string" id="3749777">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="3749804">+</span>&nbsp;<span class="string" id="3749806">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749817">s</span><span class="op" id="3749818">,</span>&nbsp;<span class="ident" id="3749820">_</span>&nbsp;<span class="op" id="3749822">:=</span>&nbsp;<span class="ident" id="3749825">strconv</span><span class="op" id="3749832">.</span><span class="ident" id="3749833">Unquote</span><span class="op" id="3749840">(</span><span class="ident" id="3749841">lit</span><span class="op" id="3749844">)</span>&nbsp;<span class="comment" id="3749846">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749892">for</span>&nbsp;<span class="ident" id="3749896">_</span><span class="op" id="3749897">,</span>&nbsp;<span class="ident" id="3749899">r</span>&nbsp;<span class="op" id="3749901">:=</span>&nbsp;<span class="keyword" id="3749904">range</span>&nbsp;<span class="ident" id="3749910">s</span>&nbsp;<span class="op" id="3749912">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749916">if</span>&nbsp;<span class="op" id="3749919">!</span><span class="ident" id="3749920">unicode</span><span class="op" id="3749927">.</span><span class="ident" id="3749928">IsGraphic</span><span class="op" id="3749937">(</span><span class="ident" id="3749938">r</span><span class="op" id="3749939">)</span>&nbsp;<span class="op" id="3749941">||</span>&nbsp;<span class="ident" id="3749944">unicode</span><span class="op" id="3749951">.</span><span class="ident" id="3749952">IsSpace</span><span class="op" id="3749959">(</span><span class="ident" id="3749960">r</span><span class="op" id="3749961">)</span>&nbsp;<span class="op" id="3749963">||</span>&nbsp;<span class="ident" id="3749966">strings</span><span class="op" id="3749973">.</span><span class="ident" id="3749974">ContainsRune</span><span class="op" id="3749986">(</span><span class="ident" id="3749987">illegalChars</span><span class="op" id="3749999">,</span>&nbsp;<span class="ident" id="3750001">r</span><span class="op" id="3750002">)</span>&nbsp;<span class="op" id="3750004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750009">return</span>&nbsp;<span class="builtintype" id="3750016">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750030">return</span>&nbsp;<span class="ident" id="3750037">s</span>&nbsp;<span class="op" id="3750039">!=</span>&nbsp;<span class="string" id="3750042">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="3750045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750048">func</span>&nbsp;<span class="op" id="3750053">(</span><span class="ident" id="3750054">p</span>&nbsp;<span class="op" id="3750056">*</span><span class="ident" id="3750057">parser</span><span class="op" id="3750063">)</span>&nbsp;<span class="ident" id="3750065">parseImportSpec</span><span class="op" id="3750080">(</span><span class="ident" id="3750081">doc</span>&nbsp;<span class="op" id="3750085">*</span><span class="ident" id="3750086">ast</span><span class="op" id="3750089">.</span><span class="ident" id="3750090">CommentGroup</span><span class="op" id="3750102">,</span>&nbsp;<span class="ident" id="3750104">_</span>&nbsp;<span class="ident" id="3750106">token</span><span class="op" id="3750111">.</span><span class="ident" id="3750112">Token</span><span class="op" id="3750117">,</span>&nbsp;<span class="ident" id="3750119">_</span>&nbsp;<span class="builtintype" id="3750121">int</span><span class="op" id="3750124">)</span>&nbsp;<span class="ident" id="3750126">ast</span><span class="op" id="3750129">.</span><span class="ident" id="3750130">Spec</span>&nbsp;<span class="op" id="3750135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750138">if</span>&nbsp;<span class="ident" id="3750141">p</span><span class="op" id="3750142">.</span><span class="ident" id="3750143">trace</span>&nbsp;<span class="op" id="3750149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750153">defer</span>&nbsp;<span class="ident" id="3750159">un</span><span class="op" id="3750161">(</span><span class="ident" id="3750162">trace</span><span class="op" id="3750167">(</span><span class="ident" id="3750168">p</span><span class="op" id="3750169">,</span>&nbsp;<span class="string" id="3750171">&#34;ImportSpec&#34;</span><span class="op" id="3750183">)</span><span class="op" id="3750184">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750191">var</span>&nbsp;<span class="ident" id="3750195">ident</span>&nbsp;<span class="op" id="3750201">*</span><span class="ident" id="3750202">ast</span><span class="op" id="3750205">.</span><span class="ident" id="3750206">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750213">switch</span>&nbsp;<span class="ident" id="3750220">p</span><span class="op" id="3750221">.</span><span class="ident" id="3750222">tok</span>&nbsp;<span class="op" id="3750226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750229">case</span>&nbsp;<span class="ident" id="3750234">token</span><span class="op" id="3750239">.</span><span class="ident" id="3750240">PERIOD</span><span class="op" id="3750246">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750250">ident</span>&nbsp;<span class="op" id="3750256">=</span>&nbsp;<span class="op" id="3750258">&amp;</span><span class="ident" id="3750259">ast</span><span class="op" id="3750262">.</span><span class="ident" id="3750263">Ident</span><span class="op" id="3750268">{</span><span class="ident" id="3750269">NamePos</span><span class="op" id="3750276">:</span>&nbsp;<span class="ident" id="3750278">p</span><span class="op" id="3750279">.</span><span class="ident" id="3750280">pos</span><span class="op" id="3750283">,</span>&nbsp;<span class="ident" id="3750285">Name</span><span class="op" id="3750289">:</span>&nbsp;<span class="string" id="3750291">&#34;.&#34;</span><span class="op" id="3750294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750298">p</span><span class="op" id="3750299">.</span><span class="ident" id="3750300">next</span><span class="op" id="3750304">(</span><span class="op" id="3750305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750308">case</span>&nbsp;<span class="ident" id="3750313">token</span><span class="op" id="3750318">.</span><span class="ident" id="3750319">IDENT</span><span class="op" id="3750324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750328">ident</span>&nbsp;<span class="op" id="3750334">=</span>&nbsp;<span class="ident" id="3750336">p</span><span class="op" id="3750337">.</span><span class="ident" id="3750338">parseIdent</span><span class="op" id="3750348">(</span><span class="op" id="3750349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750352">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750356">pos</span>&nbsp;<span class="op" id="3750360">:=</span>&nbsp;<span class="ident" id="3750363">p</span><span class="op" id="3750364">.</span><span class="ident" id="3750365">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750370">var</span>&nbsp;<span class="ident" id="3750374">path</span>&nbsp;<span class="builtintype" id="3750379">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750387">if</span>&nbsp;<span class="ident" id="3750390">p</span><span class="op" id="3750391">.</span><span class="ident" id="3750392">tok</span>&nbsp;<span class="op" id="3750396">==</span>&nbsp;<span class="ident" id="3750399">token</span><span class="op" id="3750404">.</span><span class="ident" id="3750405">STRING</span>&nbsp;<span class="op" id="3750412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750416">path</span>&nbsp;<span class="op" id="3750421">=</span>&nbsp;<span class="ident" id="3750423">p</span><span class="op" id="3750424">.</span><span class="ident" id="3750425">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750431">if</span>&nbsp;<span class="op" id="3750434">!</span><span class="ident" id="3750435">isValidImport</span><span class="op" id="3750448">(</span><span class="ident" id="3750449">path</span><span class="op" id="3750453">)</span>&nbsp;<span class="op" id="3750455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750460">p</span><span class="op" id="3750461">.</span><span class="builtintype" id="3750462">error</span><span class="op" id="3750467">(</span><span class="ident" id="3750468">pos</span><span class="op" id="3750471">,</span>&nbsp;<span class="string" id="3750473">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="3750496">+</span><span class="ident" id="3750497">path</span><span class="op" id="3750501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750509">p</span><span class="op" id="3750510">.</span><span class="ident" id="3750511">next</span><span class="op" id="3750515">(</span><span class="op" id="3750516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750519">}</span>&nbsp;<span class="keyword" id="3750521">else</span>&nbsp;<span class="op" id="3750526">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750530">p</span><span class="op" id="3750531">.</span><span class="ident" id="3750532">expect</span><span class="op" id="3750538">(</span><span class="ident" id="3750539">token</span><span class="op" id="3750544">.</span><span class="ident" id="3750545">STRING</span><span class="op" id="3750551">)</span>&nbsp;<span class="comment" id="3750553">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750588">p</span><span class="op" id="3750589">.</span><span class="ident" id="3750590">expectSemi</span><span class="op" id="3750600">(</span><span class="op" id="3750601">)</span>&nbsp;<span class="comment" id="3750603">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3750644">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750664">spec</span>&nbsp;<span class="op" id="3750669">:=</span>&nbsp;<span class="op" id="3750672">&amp;</span><span class="ident" id="3750673">ast</span><span class="op" id="3750676">.</span><span class="ident" id="3750677">ImportSpec</span><span class="op" id="3750687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750691">Doc</span><span class="op" id="3750694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750700">doc</span><span class="op" id="3750703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750707">Name</span><span class="op" id="3750711">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750716">ident</span><span class="op" id="3750721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750725">Path</span><span class="op" id="3750729">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750734">&amp;</span><span class="ident" id="3750735">ast</span><span class="op" id="3750738">.</span><span class="ident" id="3750739">BasicLit</span><span class="op" id="3750747">{</span><span class="ident" id="3750748">ValuePos</span><span class="op" id="3750756">:</span>&nbsp;<span class="ident" id="3750758">pos</span><span class="op" id="3750761">,</span>&nbsp;<span class="ident" id="3750763">Kind</span><span class="op" id="3750767">:</span>&nbsp;<span class="ident" id="3750769">token</span><span class="op" id="3750774">.</span><span class="ident" id="3750775">STRING</span><span class="op" id="3750781">,</span>&nbsp;<span class="ident" id="3750783">Value</span><span class="op" id="3750788">:</span>&nbsp;<span class="ident" id="3750790">path</span><span class="op" id="3750794">}</span><span class="op" id="3750795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750799">Comment</span><span class="op" id="3750806">:</span>&nbsp;<span class="ident" id="3750808">p</span><span class="op" id="3750809">.</span><span class="ident" id="3750810">lineComment</span><span class="op" id="3750821">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750827">p</span><span class="op" id="3750828">.</span><span class="ident" id="3750829">imports</span>&nbsp;<span class="op" id="3750837">=</span>&nbsp;<span class="builtinfunc" id="3750839">append</span><span class="op" id="3750845">(</span><span class="ident" id="3750846">p</span><span class="op" id="3750847">.</span><span class="ident" id="3750848">imports</span><span class="op" id="3750855">,</span>&nbsp;<span class="ident" id="3750857">spec</span><span class="op" id="3750861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750865">return</span>&nbsp;<span class="ident" id="3750872">spec</span><br>
<span class="lineno"></span><span class="op" id="3750877">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="3750880">func</span>&nbsp;<span class="op" id="3750885">(</span><span class="ident" id="3750886">p</span>&nbsp;<span class="op" id="3750888">*</span><span class="ident" id="3750889">parser</span><span class="op" id="3750895">)</span>&nbsp;<span class="ident" id="3750897">parseValueSpec</span><span class="op" id="3750911">(</span><span class="ident" id="3750912">doc</span>&nbsp;<span class="op" id="3750916">*</span><span class="ident" id="3750917">ast</span><span class="op" id="3750920">.</span><span class="ident" id="3750921">CommentGroup</span><span class="op" id="3750933">,</span>&nbsp;<span class="ident" id="3750935">keyword</span>&nbsp;<span class="ident" id="3750943">token</span><span class="op" id="3750948">.</span><span class="ident" id="3750949">Token</span><span class="op" id="3750954">,</span>&nbsp;<span class="ident" id="3750956">iota</span>&nbsp;<span class="builtintype" id="3750961">int</span><span class="op" id="3750964">)</span>&nbsp;<span class="ident" id="3750966">ast</span><span class="op" id="3750969">.</span><span class="ident" id="3750970">Spec</span>&nbsp;<span class="op" id="3750975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750978">if</span>&nbsp;<span class="ident" id="3750981">p</span><span class="op" id="3750982">.</span><span class="ident" id="3750983">trace</span>&nbsp;<span class="op" id="3750989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750993">defer</span>&nbsp;<span class="ident" id="3750999">un</span><span class="op" id="3751001">(</span><span class="ident" id="3751002">trace</span><span class="op" id="3751007">(</span><span class="ident" id="3751008">p</span><span class="op" id="3751009">,</span>&nbsp;<span class="ident" id="3751011">keyword</span><span class="op" id="3751018">.</span><span class="ident" id="3751019">String</span><span class="op" id="3751025">(</span><span class="op" id="3751026">)</span><span class="op" id="3751027">+</span><span class="string" id="3751028">&#34;Spec&#34;</span><span class="op" id="3751034">)</span><span class="op" id="3751035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751038">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751042">idents</span>&nbsp;<span class="op" id="3751049">:=</span>&nbsp;<span class="ident" id="3751052">p</span><span class="op" id="3751053">.</span><span class="ident" id="3751054">parseIdentList</span><span class="op" id="3751068">(</span><span class="op" id="3751069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751072">typ</span>&nbsp;<span class="op" id="3751076">:=</span>&nbsp;<span class="ident" id="3751079">p</span><span class="op" id="3751080">.</span><span class="ident" id="3751081">tryType</span><span class="op" id="3751088">(</span><span class="op" id="3751089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751092">var</span>&nbsp;<span class="ident" id="3751096">values</span>&nbsp;<span class="op" id="3751103">[</span><span class="op" id="3751104">]</span><span class="ident" id="3751105">ast</span><span class="op" id="3751108">.</span><span class="ident" id="3751109">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3751115">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751183">if</span>&nbsp;<span class="ident" id="3751186">p</span><span class="op" id="3751187">.</span><span class="ident" id="3751188">tok</span>&nbsp;<span class="op" id="3751192">==</span>&nbsp;<span class="ident" id="3751195">token</span><span class="op" id="3751200">.</span><span class="ident" id="3751201">ASSIGN</span>&nbsp;<span class="op" id="3751208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751212">p</span><span class="op" id="3751213">.</span><span class="ident" id="3751214">next</span><span class="op" id="3751218">(</span><span class="op" id="3751219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751223">values</span>&nbsp;<span class="op" id="3751230">=</span>&nbsp;<span class="ident" id="3751232">p</span><span class="op" id="3751233">.</span><span class="ident" id="3751234">parseRhsList</span><span class="op" id="3751246">(</span><span class="op" id="3751247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751253">p</span><span class="op" id="3751254">.</span><span class="ident" id="3751255">expectSemi</span><span class="op" id="3751265">(</span><span class="op" id="3751266">)</span>&nbsp;<span class="comment" id="3751268">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3751309">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3751385">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3751458">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3751505">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751578">spec</span>&nbsp;<span class="op" id="3751583">:=</span>&nbsp;<span class="op" id="3751586">&amp;</span><span class="ident" id="3751587">ast</span><span class="op" id="3751590">.</span><span class="ident" id="3751591">ValueSpec</span><span class="op" id="3751600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751604">Doc</span><span class="op" id="3751607">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751613">doc</span><span class="op" id="3751616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751620">Names</span><span class="op" id="3751625">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3751629">idents</span><span class="op" id="3751635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751639">Type</span><span class="op" id="3751643">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751648">typ</span><span class="op" id="3751651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751655">Values</span><span class="op" id="3751661">:</span>&nbsp;&nbsp;<span class="ident" id="3751664">values</span><span class="op" id="3751670">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751674">Comment</span><span class="op" id="3751681">:</span>&nbsp;<span class="ident" id="3751683">p</span><span class="op" id="3751684">.</span><span class="ident" id="3751685">lineComment</span><span class="op" id="3751696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751702">kind</span>&nbsp;<span class="op" id="3751707">:=</span>&nbsp;<span class="ident" id="3751710">ast</span><span class="op" id="3751713">.</span><span class="ident" id="3751714">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751719">if</span>&nbsp;<span class="ident" id="3751722">keyword</span>&nbsp;<span class="op" id="3751730">==</span>&nbsp;<span class="ident" id="3751733">token</span><span class="op" id="3751738">.</span><span class="ident" id="3751739">VAR</span>&nbsp;<span class="op" id="3751743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751747">kind</span>&nbsp;<span class="op" id="3751752">=</span>&nbsp;<span class="ident" id="3751754">ast</span><span class="op" id="3751757">.</span><span class="ident" id="3751758">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751766">p</span><span class="op" id="3751767">.</span><span class="ident" id="3751768">declare</span><span class="op" id="3751775">(</span><span class="ident" id="3751776">spec</span><span class="op" id="3751780">,</span>&nbsp;<span class="ident" id="3751782">iota</span><span class="op" id="3751786">,</span>&nbsp;<span class="ident" id="3751788">p</span><span class="op" id="3751789">.</span><span class="ident" id="3751790">topScope</span><span class="op" id="3751798">,</span>&nbsp;<span class="ident" id="3751800">kind</span><span class="op" id="3751804">,</span>&nbsp;<span class="ident" id="3751806">idents</span><span class="op" id="3751812">...</span><span class="op" id="3751815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751819">return</span>&nbsp;<span class="ident" id="3751826">spec</span><br>
<span class="lineno"></span><span class="op" id="3751831">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="3751834">func</span>&nbsp;<span class="op" id="3751839">(</span><span class="ident" id="3751840">p</span>&nbsp;<span class="op" id="3751842">*</span><span class="ident" id="3751843">parser</span><span class="op" id="3751849">)</span>&nbsp;<span class="ident" id="3751851">parseTypeSpec</span><span class="op" id="3751864">(</span><span class="ident" id="3751865">doc</span>&nbsp;<span class="op" id="3751869">*</span><span class="ident" id="3751870">ast</span><span class="op" id="3751873">.</span><span class="ident" id="3751874">CommentGroup</span><span class="op" id="3751886">,</span>&nbsp;<span class="ident" id="3751888">_</span>&nbsp;<span class="ident" id="3751890">token</span><span class="op" id="3751895">.</span><span class="ident" id="3751896">Token</span><span class="op" id="3751901">,</span>&nbsp;<span class="ident" id="3751903">_</span>&nbsp;<span class="builtintype" id="3751905">int</span><span class="op" id="3751908">)</span>&nbsp;<span class="ident" id="3751910">ast</span><span class="op" id="3751913">.</span><span class="ident" id="3751914">Spec</span>&nbsp;<span class="op" id="3751919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751922">if</span>&nbsp;<span class="ident" id="3751925">p</span><span class="op" id="3751926">.</span><span class="ident" id="3751927">trace</span>&nbsp;<span class="op" id="3751933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751937">defer</span>&nbsp;<span class="ident" id="3751943">un</span><span class="op" id="3751945">(</span><span class="ident" id="3751946">trace</span><span class="op" id="3751951">(</span><span class="ident" id="3751952">p</span><span class="op" id="3751953">,</span>&nbsp;<span class="string" id="3751955">&#34;TypeSpec&#34;</span><span class="op" id="3751965">)</span><span class="op" id="3751966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751969">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3751973">ident</span>&nbsp;<span class="op" id="3751979">:=</span>&nbsp;<span class="ident" id="3751982">p</span><span class="op" id="3751983">.</span><span class="ident" id="3751984">parseIdent</span><span class="op" id="3751994">(</span><span class="op" id="3751995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3751999">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3752077">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3752152">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3752174">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752247">spec</span>&nbsp;<span class="op" id="3752252">:=</span>&nbsp;<span class="op" id="3752255">&amp;</span><span class="ident" id="3752256">ast</span><span class="op" id="3752259">.</span><span class="ident" id="3752260">TypeSpec</span><span class="op" id="3752268">{</span><span class="ident" id="3752269">Doc</span><span class="op" id="3752272">:</span>&nbsp;<span class="ident" id="3752274">doc</span><span class="op" id="3752277">,</span>&nbsp;<span class="ident" id="3752279">Name</span><span class="op" id="3752283">:</span>&nbsp;<span class="ident" id="3752285">ident</span><span class="op" id="3752290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752293">p</span><span class="op" id="3752294">.</span><span class="ident" id="3752295">declare</span><span class="op" id="3752302">(</span><span class="ident" id="3752303">spec</span><span class="op" id="3752307">,</span>&nbsp;<span class="builtintype" id="3752309">nil</span><span class="op" id="3752312">,</span>&nbsp;<span class="ident" id="3752314">p</span><span class="op" id="3752315">.</span><span class="ident" id="3752316">topScope</span><span class="op" id="3752324">,</span>&nbsp;<span class="ident" id="3752326">ast</span><span class="op" id="3752329">.</span><span class="ident" id="3752330">Typ</span><span class="op" id="3752333">,</span>&nbsp;<span class="ident" id="3752335">ident</span><span class="op" id="3752340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752344">spec</span><span class="op" id="3752348">.</span><span class="ident" id="3752349">Type</span>&nbsp;<span class="op" id="3752354">=</span>&nbsp;<span class="ident" id="3752356">p</span><span class="op" id="3752357">.</span><span class="ident" id="3752358">parseType</span><span class="op" id="3752367">(</span><span class="op" id="3752368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752371">p</span><span class="op" id="3752372">.</span><span class="ident" id="3752373">expectSemi</span><span class="op" id="3752383">(</span><span class="op" id="3752384">)</span>&nbsp;<span class="comment" id="3752386">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752426">spec</span><span class="op" id="3752430">.</span><span class="ident" id="3752431">Comment</span>&nbsp;<span class="op" id="3752439">=</span>&nbsp;<span class="ident" id="3752441">p</span><span class="op" id="3752442">.</span><span class="ident" id="3752443">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752457">return</span>&nbsp;<span class="ident" id="3752464">spec</span><br>
<span class="lineno">2280</span><span class="op" id="3752469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3752472">func</span>&nbsp;<span class="op" id="3752477">(</span><span class="ident" id="3752478">p</span>&nbsp;<span class="op" id="3752480">*</span><span class="ident" id="3752481">parser</span><span class="op" id="3752487">)</span>&nbsp;<span class="ident" id="3752489">parseGenDecl</span><span class="op" id="3752501">(</span><span class="ident" id="3752502">keyword</span>&nbsp;<span class="ident" id="3752510">token</span><span class="op" id="3752515">.</span><span class="ident" id="3752516">Token</span><span class="op" id="3752521">,</span>&nbsp;<span class="ident" id="3752523">f</span>&nbsp;<span class="ident" id="3752525">parseSpecFunction</span><span class="op" id="3752542">)</span>&nbsp;<span class="op" id="3752544">*</span><span class="ident" id="3752545">ast</span><span class="op" id="3752548">.</span><span class="ident" id="3752549">GenDecl</span>&nbsp;<span class="op" id="3752557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752560">if</span>&nbsp;<span class="ident" id="3752563">p</span><span class="op" id="3752564">.</span><span class="ident" id="3752565">trace</span>&nbsp;<span class="op" id="3752571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752575">defer</span>&nbsp;<span class="ident" id="3752581">un</span><span class="op" id="3752583">(</span><span class="ident" id="3752584">trace</span><span class="op" id="3752589">(</span><span class="ident" id="3752590">p</span><span class="op" id="3752591">,</span>&nbsp;<span class="string" id="3752593">&#34;GenDecl(&#34;</span><span class="op" id="3752603">+</span><span class="ident" id="3752604">keyword</span><span class="op" id="3752611">.</span><span class="ident" id="3752612">String</span><span class="op" id="3752618">(</span><span class="op" id="3752619">)</span><span class="op" id="3752620">+</span><span class="string" id="3752621">&#34;)&#34;</span><span class="op" id="3752624">)</span><span class="op" id="3752625">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3752628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752632">doc</span>&nbsp;<span class="op" id="3752636">:=</span>&nbsp;<span class="ident" id="3752639">p</span><span class="op" id="3752640">.</span><span class="ident" id="3752641">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752654">pos</span>&nbsp;<span class="op" id="3752658">:=</span>&nbsp;<span class="ident" id="3752661">p</span><span class="op" id="3752662">.</span><span class="ident" id="3752663">expect</span><span class="op" id="3752669">(</span><span class="ident" id="3752670">keyword</span><span class="op" id="3752677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752680">var</span>&nbsp;<span class="ident" id="3752684">lparen</span><span class="op" id="3752690">,</span>&nbsp;<span class="ident" id="3752692">rparen</span>&nbsp;<span class="ident" id="3752699">token</span><span class="op" id="3752704">.</span><span class="ident" id="3752705">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752710">var</span>&nbsp;<span class="ident" id="3752714">list</span>&nbsp;<span class="op" id="3752719">[</span><span class="op" id="3752720">]</span><span class="ident" id="3752721">ast</span><span class="op" id="3752724">.</span><span class="ident" id="3752725">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752731">if</span>&nbsp;<span class="ident" id="3752734">p</span><span class="op" id="3752735">.</span><span class="ident" id="3752736">tok</span>&nbsp;<span class="op" id="3752740">==</span>&nbsp;<span class="ident" id="3752743">token</span><span class="op" id="3752748">.</span><span class="ident" id="3752749">LPAREN</span>&nbsp;<span class="op" id="3752756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752760">lparen</span>&nbsp;<span class="op" id="3752767">=</span>&nbsp;<span class="ident" id="3752769">p</span><span class="op" id="3752770">.</span><span class="ident" id="3752771">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752777">p</span><span class="op" id="3752778">.</span><span class="ident" id="3752779">next</span><span class="op" id="3752783">(</span><span class="op" id="3752784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3752788">for</span>&nbsp;<span class="ident" id="3752792">iota</span>&nbsp;<span class="op" id="3752797">:=</span>&nbsp;<span class="num" id="3752800">0</span><span class="op" id="3752801">;</span>&nbsp;<span class="ident" id="3752803">p</span><span class="op" id="3752804">.</span><span class="ident" id="3752805">tok</span>&nbsp;<span class="op" id="3752809">!=</span>&nbsp;<span class="ident" id="3752812">token</span><span class="op" id="3752817">.</span><span class="ident" id="3752818">RPAREN</span>&nbsp;<span class="op" id="3752825">&amp;&amp;</span>&nbsp;<span class="ident" id="3752828">p</span><span class="op" id="3752829">.</span><span class="ident" id="3752830">tok</span>&nbsp;<span class="op" id="3752834">!=</span>&nbsp;<span class="ident" id="3752837">token</span><span class="op" id="3752842">.</span><span class="ident" id="3752843">EOF</span><span class="op" id="3752846">;</span>&nbsp;<span class="ident" id="3752848">iota</span><span class="op" id="3752852">++</span>&nbsp;<span class="op" id="3752855">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752860">list</span>&nbsp;<span class="op" id="3752865">=</span>&nbsp;<span class="builtinfunc" id="3752867">append</span><span class="op" id="3752873">(</span><span class="ident" id="3752874">list</span><span class="op" id="3752878">,</span>&nbsp;<span class="ident" id="3752880">f</span><span class="op" id="3752881">(</span><span class="ident" id="3752882">p</span><span class="op" id="3752883">.</span><span class="ident" id="3752884">leadComment</span><span class="op" id="3752895">,</span>&nbsp;<span class="ident" id="3752897">keyword</span><span class="op" id="3752904">,</span>&nbsp;<span class="ident" id="3752906">iota</span><span class="op" id="3752910">)</span><span class="op" id="3752911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3752915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752919">rparen</span>&nbsp;<span class="op" id="3752926">=</span>&nbsp;<span class="ident" id="3752928">p</span><span class="op" id="3752929">.</span><span class="ident" id="3752930">expect</span><span class="op" id="3752936">(</span><span class="ident" id="3752937">token</span><span class="op" id="3752942">.</span><span class="ident" id="3752943">RPAREN</span><span class="op" id="3752949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752953">p</span><span class="op" id="3752954">.</span><span class="ident" id="3752955">expectSemi</span><span class="op" id="3752965">(</span><span class="op" id="3752966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3752969">}</span>&nbsp;<span class="keyword" id="3752971">else</span>&nbsp;<span class="op" id="3752976">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752980">list</span>&nbsp;<span class="op" id="3752985">=</span>&nbsp;<span class="builtinfunc" id="3752987">append</span><span class="op" id="3752993">(</span><span class="ident" id="3752994">list</span><span class="op" id="3752998">,</span>&nbsp;<span class="ident" id="3753000">f</span><span class="op" id="3753001">(</span><span class="builtintype" id="3753002">nil</span><span class="op" id="3753005">,</span>&nbsp;<span class="ident" id="3753007">keyword</span><span class="op" id="3753014">,</span>&nbsp;<span class="num" id="3753016">0</span><span class="op" id="3753017">)</span><span class="op" id="3753018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753025">return</span>&nbsp;<span class="op" id="3753032">&amp;</span><span class="ident" id="3753033">ast</span><span class="op" id="3753036">.</span><span class="ident" id="3753037">GenDecl</span><span class="op" id="3753044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753048">Doc</span><span class="op" id="3753051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753056">doc</span><span class="op" id="3753059">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753063">TokPos</span><span class="op" id="3753069">:</span>&nbsp;<span class="ident" id="3753071">pos</span><span class="op" id="3753074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753078">Tok</span><span class="op" id="3753081">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753086">keyword</span><span class="op" id="3753093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753097">Lparen</span><span class="op" id="3753103">:</span>&nbsp;<span class="ident" id="3753105">lparen</span><span class="op" id="3753111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753115">Specs</span><span class="op" id="3753120">:</span>&nbsp;&nbsp;<span class="ident" id="3753123">list</span><span class="op" id="3753127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753131">Rparen</span><span class="op" id="3753137">:</span>&nbsp;<span class="ident" id="3753139">rparen</span><span class="op" id="3753145">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753148">}</span><br>
<span class="lineno"></span><span class="op" id="3753150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3753153">func</span>&nbsp;<span class="op" id="3753158">(</span><span class="ident" id="3753159">p</span>&nbsp;<span class="op" id="3753161">*</span><span class="ident" id="3753162">parser</span><span class="op" id="3753168">)</span>&nbsp;<span class="ident" id="3753170">parseFuncDecl</span><span class="op" id="3753183">(</span><span class="op" id="3753184">)</span>&nbsp;<span class="op" id="3753186">*</span><span class="ident" id="3753187">ast</span><span class="op" id="3753190">.</span><span class="ident" id="3753191">FuncDecl</span>&nbsp;<span class="op" id="3753200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753203">if</span>&nbsp;<span class="ident" id="3753206">p</span><span class="op" id="3753207">.</span><span class="ident" id="3753208">trace</span>&nbsp;<span class="op" id="3753214">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753218">defer</span>&nbsp;<span class="ident" id="3753224">un</span><span class="op" id="3753226">(</span><span class="ident" id="3753227">trace</span><span class="op" id="3753232">(</span><span class="ident" id="3753233">p</span><span class="op" id="3753234">,</span>&nbsp;<span class="string" id="3753236">&#34;FunctionDecl&#34;</span><span class="op" id="3753250">)</span><span class="op" id="3753251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753258">doc</span>&nbsp;<span class="op" id="3753262">:=</span>&nbsp;<span class="ident" id="3753265">p</span><span class="op" id="3753266">.</span><span class="ident" id="3753267">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753280">pos</span>&nbsp;<span class="op" id="3753284">:=</span>&nbsp;<span class="ident" id="3753287">p</span><span class="op" id="3753288">.</span><span class="ident" id="3753289">expect</span><span class="op" id="3753295">(</span><span class="ident" id="3753296">token</span><span class="op" id="3753301">.</span><span class="ident" id="3753302">FUNC</span><span class="op" id="3753306">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753309">scope</span>&nbsp;<span class="op" id="3753315">:=</span>&nbsp;<span class="ident" id="3753318">ast</span><span class="op" id="3753321">.</span><span class="ident" id="3753322">NewScope</span><span class="op" id="3753330">(</span><span class="ident" id="3753331">p</span><span class="op" id="3753332">.</span><span class="ident" id="3753333">topScope</span><span class="op" id="3753341">)</span>&nbsp;<span class="comment" id="3753343">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753363">var</span>&nbsp;<span class="ident" id="3753367">recv</span>&nbsp;<span class="op" id="3753372">*</span><span class="ident" id="3753373">ast</span><span class="op" id="3753376">.</span><span class="ident" id="3753377">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753388">if</span>&nbsp;<span class="ident" id="3753391">p</span><span class="op" id="3753392">.</span><span class="ident" id="3753393">tok</span>&nbsp;<span class="op" id="3753397">==</span>&nbsp;<span class="ident" id="3753400">token</span><span class="op" id="3753405">.</span><span class="ident" id="3753406">LPAREN</span>&nbsp;<span class="op" id="3753413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753417">recv</span>&nbsp;<span class="op" id="3753422">=</span>&nbsp;<span class="ident" id="3753424">p</span><span class="op" id="3753425">.</span><span class="ident" id="3753426">parseParameters</span><span class="op" id="3753441">(</span><span class="ident" id="3753442">scope</span><span class="op" id="3753447">,</span>&nbsp;<span class="builtintype" id="3753449">false</span><span class="op" id="3753454">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753461">ident</span>&nbsp;<span class="op" id="3753467">:=</span>&nbsp;<span class="ident" id="3753470">p</span><span class="op" id="3753471">.</span><span class="ident" id="3753472">parseIdent</span><span class="op" id="3753482">(</span><span class="op" id="3753483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753487">params</span><span class="op" id="3753493">,</span>&nbsp;<span class="ident" id="3753495">results</span>&nbsp;<span class="op" id="3753503">:=</span>&nbsp;<span class="ident" id="3753506">p</span><span class="op" id="3753507">.</span><span class="ident" id="3753508">parseSignature</span><span class="op" id="3753522">(</span><span class="ident" id="3753523">scope</span><span class="op" id="3753528">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753532">var</span>&nbsp;<span class="ident" id="3753536">body</span>&nbsp;<span class="op" id="3753541">*</span><span class="ident" id="3753542">ast</span><span class="op" id="3753545">.</span><span class="ident" id="3753546">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753557">if</span>&nbsp;<span class="ident" id="3753560">p</span><span class="op" id="3753561">.</span><span class="ident" id="3753562">tok</span>&nbsp;<span class="op" id="3753566">==</span>&nbsp;<span class="ident" id="3753569">token</span><span class="op" id="3753574">.</span><span class="ident" id="3753575">LBRACE</span>&nbsp;<span class="op" id="3753582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753586">body</span>&nbsp;<span class="op" id="3753591">=</span>&nbsp;<span class="ident" id="3753593">p</span><span class="op" id="3753594">.</span><span class="ident" id="3753595">parseBody</span><span class="op" id="3753604">(</span><span class="ident" id="3753605">scope</span><span class="op" id="3753610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753613">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753616">p</span><span class="op" id="3753617">.</span><span class="ident" id="3753618">expectSemi</span><span class="op" id="3753628">(</span><span class="op" id="3753629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753633">decl</span>&nbsp;<span class="op" id="3753638">:=</span>&nbsp;<span class="op" id="3753641">&amp;</span><span class="ident" id="3753642">ast</span><span class="op" id="3753645">.</span><span class="ident" id="3753646">FuncDecl</span><span class="op" id="3753654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753658">Doc</span><span class="op" id="3753661">:</span>&nbsp;&nbsp;<span class="ident" id="3753664">doc</span><span class="op" id="3753667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753671">Recv</span><span class="op" id="3753675">:</span>&nbsp;<span class="ident" id="3753677">recv</span><span class="op" id="3753681">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753685">Name</span><span class="op" id="3753689">:</span>&nbsp;<span class="ident" id="3753691">ident</span><span class="op" id="3753696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753700">Type</span><span class="op" id="3753704">:</span>&nbsp;<span class="op" id="3753706">&amp;</span><span class="ident" id="3753707">ast</span><span class="op" id="3753710">.</span><span class="ident" id="3753711">FuncType</span><span class="op" id="3753719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753724">Func</span><span class="op" id="3753728">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753733">pos</span><span class="op" id="3753736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753741">Params</span><span class="op" id="3753747">:</span>&nbsp;&nbsp;<span class="ident" id="3753750">params</span><span class="op" id="3753756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753761">Results</span><span class="op" id="3753768">:</span>&nbsp;<span class="ident" id="3753770">results</span><span class="op" id="3753777">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753781">}</span><span class="op" id="3753782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753786">Body</span><span class="op" id="3753790">:</span>&nbsp;<span class="ident" id="3753792">body</span><span class="op" id="3753796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3753799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3753802">if</span>&nbsp;<span class="ident" id="3753805">recv</span>&nbsp;<span class="op" id="3753810">==</span>&nbsp;<span class="builtintype" id="3753813">nil</span>&nbsp;<span class="op" id="3753817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3753821">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3753889">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3753955">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3754005">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3754010">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3754068">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754123">if</span>&nbsp;<span class="ident" id="3754126">ident</span><span class="op" id="3754131">.</span><span class="ident" id="3754132">Name</span>&nbsp;<span class="op" id="3754137">!=</span>&nbsp;<span class="string" id="3754140">&#34;init&#34;</span>&nbsp;<span class="op" id="3754147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3754152">p</span><span class="op" id="3754153">.</span><span class="ident" id="3754154">declare</span><span class="op" id="3754161">(</span><span class="ident" id="3754162">decl</span><span class="op" id="3754166">,</span>&nbsp;<span class="builtintype" id="3754168">nil</span><span class="op" id="3754171">,</span>&nbsp;<span class="ident" id="3754173">p</span><span class="op" id="3754174">.</span><span class="ident" id="3754175">pkgScope</span><span class="op" id="3754183">,</span>&nbsp;<span class="ident" id="3754185">ast</span><span class="op" id="3754188">.</span><span class="ident" id="3754189">Fun</span><span class="op" id="3754192">,</span>&nbsp;<span class="ident" id="3754194">ident</span><span class="op" id="3754199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3754203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3754206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754210">return</span>&nbsp;<span class="ident" id="3754217">decl</span><br>
<span class="lineno"></span><span class="op" id="3754222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3754225">func</span>&nbsp;<span class="op" id="3754230">(</span><span class="ident" id="3754231">p</span>&nbsp;<span class="op" id="3754233">*</span><span class="ident" id="3754234">parser</span><span class="op" id="3754240">)</span>&nbsp;<span class="ident" id="3754242">parseDecl</span><span class="op" id="3754251">(</span><span class="ident" id="3754252">sync</span>&nbsp;<span class="keyword" id="3754257">func</span><span class="op" id="3754261">(</span><span class="op" id="3754262">*</span><span class="ident" id="3754263">parser</span><span class="op" id="3754269">)</span><span class="op" id="3754270">)</span>&nbsp;<span class="ident" id="3754272">ast</span><span class="op" id="3754275">.</span><span class="ident" id="3754276">Decl</span>&nbsp;<span class="op" id="3754281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754284">if</span>&nbsp;<span class="ident" id="3754287">p</span><span class="op" id="3754288">.</span><span class="ident" id="3754289">trace</span>&nbsp;<span class="op" id="3754295">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754299">defer</span>&nbsp;<span class="ident" id="3754305">un</span><span class="op" id="3754307">(</span><span class="ident" id="3754308">trace</span><span class="op" id="3754313">(</span><span class="ident" id="3754314">p</span><span class="op" id="3754315">,</span>&nbsp;<span class="string" id="3754317">&#34;Declaration&#34;</span><span class="op" id="3754330">)</span><span class="op" id="3754331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3754334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754338">var</span>&nbsp;<span class="ident" id="3754342">f</span>&nbsp;<span class="ident" id="3754344">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754363">switch</span>&nbsp;<span class="ident" id="3754370">p</span><span class="op" id="3754371">.</span><span class="ident" id="3754372">tok</span>&nbsp;<span class="op" id="3754376">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754379">case</span>&nbsp;<span class="ident" id="3754384">token</span><span class="op" id="3754389">.</span><span class="ident" id="3754390">CONST</span><span class="op" id="3754395">,</span>&nbsp;<span class="ident" id="3754397">token</span><span class="op" id="3754402">.</span><span class="ident" id="3754403">VAR</span><span class="op" id="3754406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3754410">f</span>&nbsp;<span class="op" id="3754412">=</span>&nbsp;<span class="ident" id="3754414">p</span><span class="op" id="3754415">.</span><span class="ident" id="3754416">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754433">case</span>&nbsp;<span class="ident" id="3754438">token</span><span class="op" id="3754443">.</span><span class="ident" id="3754444">TYPE</span><span class="op" id="3754448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3754452">f</span>&nbsp;<span class="op" id="3754454">=</span>&nbsp;<span class="ident" id="3754456">p</span><span class="op" id="3754457">.</span><span class="ident" id="3754458">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754474">case</span>&nbsp;<span class="ident" id="3754479">token</span><span class="op" id="3754484">.</span><span class="ident" id="3754485">FUNC</span><span class="op" id="3754489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754493">return</span>&nbsp;<span class="ident" id="3754500">p</span><span class="op" id="3754501">.</span><span class="ident" id="3754502">parseFuncDecl</span><span class="op" id="3754515">(</span><span class="op" id="3754516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754520">default</span><span class="op" id="3754527">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3754531">pos</span>&nbsp;<span class="op" id="3754535">:=</span>&nbsp;<span class="ident" id="3754538">p</span><span class="op" id="3754539">.</span><span class="ident" id="3754540">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3754546">p</span><span class="op" id="3754547">.</span><span class="ident" id="3754548">errorExpected</span><span class="op" id="3754561">(</span><span class="ident" id="3754562">pos</span><span class="op" id="3754565">,</span>&nbsp;<span class="string" id="3754567">&#34;declaration&#34;</span><span class="op" id="3754580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3754584">sync</span><span class="op" id="3754588">(</span><span class="ident" id="3754589">p</span><span class="op" id="3754590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754594">return</span>&nbsp;<span class="op" id="3754601">&amp;</span><span class="ident" id="3754602">ast</span><span class="op" id="3754605">.</span><span class="ident" id="3754606">BadDecl</span><span class="op" id="3754613">{</span><span class="ident" id="3754614">From</span><span class="op" id="3754618">:</span>&nbsp;<span class="ident" id="3754620">pos</span><span class="op" id="3754623">,</span>&nbsp;<span class="ident" id="3754625">To</span><span class="op" id="3754627">:</span>&nbsp;<span class="ident" id="3754629">p</span><span class="op" id="3754630">.</span><span class="ident" id="3754631">pos</span><span class="op" id="3754634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3754637">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754641">return</span>&nbsp;<span class="ident" id="3754648">p</span><span class="op" id="3754649">.</span><span class="ident" id="3754650">parseGenDecl</span><span class="op" id="3754662">(</span><span class="ident" id="3754663">p</span><span class="op" id="3754664">.</span><span class="ident" id="3754665">tok</span><span class="op" id="3754668">,</span>&nbsp;<span class="ident" id="3754670">f</span><span class="op" id="3754671">)</span><br>
<span class="lineno"></span><span class="op" id="3754673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3754676">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="3754756">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3754773">func</span>&nbsp;<span class="op" id="3754778">(</span><span class="ident" id="3754779">p</span>&nbsp;<span class="op" id="3754781">*</span><span class="ident" id="3754782">parser</span><span class="op" id="3754788">)</span>&nbsp;<span class="ident" id="3754790">parseFile</span><span class="op" id="3754799">(</span><span class="op" id="3754800">)</span>&nbsp;<span class="op" id="3754802">*</span><span class="ident" id="3754803">ast</span><span class="op" id="3754806">.</span><span class="ident" id="3754807">File</span>&nbsp;<span class="op" id="3754812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754815">if</span>&nbsp;<span class="ident" id="3754818">p</span><span class="op" id="3754819">.</span><span class="ident" id="3754820">trace</span>&nbsp;<span class="op" id="3754826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754830">defer</span>&nbsp;<span class="ident" id="3754836">un</span><span class="op" id="3754838">(</span><span class="ident" id="3754839">trace</span><span class="op" id="3754844">(</span><span class="ident" id="3754845">p</span><span class="op" id="3754846">,</span>&nbsp;<span class="string" id="3754848">&#34;File&#34;</span><span class="op" id="3754854">)</span><span class="op" id="3754855">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3754858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3754862">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3754939">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3754979">if</span>&nbsp;<span class="ident" id="3754982">p</span><span class="op" id="3754983">.</span><span class="ident" id="3754984">errors</span><span class="op" id="3754990">.</span><span class="ident" id="3754991">Len</span><span class="op" id="3754994">(</span><span class="op" id="3754995">)</span>&nbsp;<span class="op" id="3754997">!=</span>&nbsp;<span class="num" id="3755000">0</span>&nbsp;<span class="op" id="3755002">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755006">return</span>&nbsp;<span class="builtintype" id="3755013">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755022">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755041">doc</span>&nbsp;<span class="op" id="3755045">:=</span>&nbsp;<span class="ident" id="3755048">p</span><span class="op" id="3755049">.</span><span class="ident" id="3755050">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755063">pos</span>&nbsp;<span class="op" id="3755067">:=</span>&nbsp;<span class="ident" id="3755070">p</span><span class="op" id="3755071">.</span><span class="ident" id="3755072">expect</span><span class="op" id="3755078">(</span><span class="ident" id="3755079">token</span><span class="op" id="3755084">.</span><span class="ident" id="3755085">PACKAGE</span><span class="op" id="3755092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755095">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755149">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755200">ident</span>&nbsp;<span class="op" id="3755206">:=</span>&nbsp;<span class="ident" id="3755209">p</span><span class="op" id="3755210">.</span><span class="ident" id="3755211">parseIdent</span><span class="op" id="3755221">(</span><span class="op" id="3755222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755225">if</span>&nbsp;<span class="ident" id="3755228">ident</span><span class="op" id="3755233">.</span><span class="ident" id="3755234">Name</span>&nbsp;<span class="op" id="3755239">==</span>&nbsp;<span class="string" id="3755242">&#34;_&#34;</span>&nbsp;<span class="op" id="3755246">&amp;&amp;</span>&nbsp;<span class="ident" id="3755249">p</span><span class="op" id="3755250">.</span><span class="ident" id="3755251">mode</span><span class="op" id="3755255">&amp;</span><span class="ident" id="3755256">DeclarationErrors</span>&nbsp;<span class="op" id="3755274">!=</span>&nbsp;<span class="num" id="3755277">0</span>&nbsp;<span class="op" id="3755279">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755283">p</span><span class="op" id="3755284">.</span><span class="builtintype" id="3755285">error</span><span class="op" id="3755290">(</span><span class="ident" id="3755291">p</span><span class="op" id="3755292">.</span><span class="ident" id="3755293">pos</span><span class="op" id="3755296">,</span>&nbsp;<span class="string" id="3755298">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="3755322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755328">p</span><span class="op" id="3755329">.</span><span class="ident" id="3755330">expectSemi</span><span class="op" id="3755340">(</span><span class="op" id="3755341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755345">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755424">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755464">if</span>&nbsp;<span class="ident" id="3755467">p</span><span class="op" id="3755468">.</span><span class="ident" id="3755469">errors</span><span class="op" id="3755475">.</span><span class="ident" id="3755476">Len</span><span class="op" id="3755479">(</span><span class="op" id="3755480">)</span>&nbsp;<span class="op" id="3755482">!=</span>&nbsp;<span class="num" id="3755485">0</span>&nbsp;<span class="op" id="3755487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755491">return</span>&nbsp;<span class="builtintype" id="3755498">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755507">p</span><span class="op" id="3755508">.</span><span class="ident" id="3755509">openScope</span><span class="op" id="3755518">(</span><span class="op" id="3755519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755522">p</span><span class="op" id="3755523">.</span><span class="ident" id="3755524">pkgScope</span>&nbsp;<span class="op" id="3755533">=</span>&nbsp;<span class="ident" id="3755535">p</span><span class="op" id="3755536">.</span><span class="ident" id="3755537">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755547">var</span>&nbsp;<span class="ident" id="3755551">decls</span>&nbsp;<span class="op" id="3755557">[</span><span class="op" id="3755558">]</span><span class="ident" id="3755559">ast</span><span class="op" id="3755562">.</span><span class="ident" id="3755563">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755569">if</span>&nbsp;<span class="ident" id="3755572">p</span><span class="op" id="3755573">.</span><span class="ident" id="3755574">mode</span><span class="op" id="3755578">&amp;</span><span class="ident" id="3755579">PackageClauseOnly</span>&nbsp;<span class="op" id="3755597">==</span>&nbsp;<span class="num" id="3755600">0</span>&nbsp;<span class="op" id="3755602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755606">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755624">for</span>&nbsp;<span class="ident" id="3755628">p</span><span class="op" id="3755629">.</span><span class="ident" id="3755630">tok</span>&nbsp;<span class="op" id="3755634">==</span>&nbsp;<span class="ident" id="3755637">token</span><span class="op" id="3755642">.</span><span class="ident" id="3755643">IMPORT</span>&nbsp;<span class="op" id="3755650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755655">decls</span>&nbsp;<span class="op" id="3755661">=</span>&nbsp;<span class="builtinfunc" id="3755663">append</span><span class="op" id="3755669">(</span><span class="ident" id="3755670">decls</span><span class="op" id="3755675">,</span>&nbsp;<span class="ident" id="3755677">p</span><span class="op" id="3755678">.</span><span class="ident" id="3755679">parseGenDecl</span><span class="op" id="3755691">(</span><span class="ident" id="3755692">token</span><span class="op" id="3755697">.</span><span class="ident" id="3755698">IMPORT</span><span class="op" id="3755704">,</span>&nbsp;<span class="ident" id="3755706">p</span><span class="op" id="3755707">.</span><span class="ident" id="3755708">parseImportSpec</span><span class="op" id="3755723">)</span><span class="op" id="3755724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755733">if</span>&nbsp;<span class="ident" id="3755736">p</span><span class="op" id="3755737">.</span><span class="ident" id="3755738">mode</span><span class="op" id="3755742">&amp;</span><span class="ident" id="3755743">ImportsOnly</span>&nbsp;<span class="op" id="3755755">==</span>&nbsp;<span class="num" id="3755758">0</span>&nbsp;<span class="op" id="3755760">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3755765">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755792">for</span>&nbsp;<span class="ident" id="3755796">p</span><span class="op" id="3755797">.</span><span class="ident" id="3755798">tok</span>&nbsp;<span class="op" id="3755802">!=</span>&nbsp;<span class="ident" id="3755805">token</span><span class="op" id="3755810">.</span><span class="ident" id="3755811">EOF</span>&nbsp;<span class="op" id="3755815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755821">decls</span>&nbsp;<span class="op" id="3755827">=</span>&nbsp;<span class="builtinfunc" id="3755829">append</span><span class="op" id="3755835">(</span><span class="ident" id="3755836">decls</span><span class="op" id="3755841">,</span>&nbsp;<span class="ident" id="3755843">p</span><span class="op" id="3755844">.</span><span class="ident" id="3755845">parseDecl</span><span class="op" id="3755854">(</span><span class="ident" id="3755855">syncDecl</span><span class="op" id="3755863">)</span><span class="op" id="3755864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755873">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755879">p</span><span class="op" id="3755880">.</span><span class="ident" id="3755881">closeScope</span><span class="op" id="3755891">(</span><span class="op" id="3755892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755895">assert</span><span class="op" id="3755901">(</span><span class="ident" id="3755902">p</span><span class="op" id="3755903">.</span><span class="ident" id="3755904">topScope</span>&nbsp;<span class="op" id="3755913">==</span>&nbsp;<span class="builtintype" id="3755916">nil</span><span class="op" id="3755919">,</span>&nbsp;<span class="string" id="3755921">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="3755940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755943">assert</span><span class="op" id="3755949">(</span><span class="ident" id="3755950">p</span><span class="op" id="3755951">.</span><span class="ident" id="3755952">labelScope</span>&nbsp;<span class="op" id="3755963">==</span>&nbsp;<span class="builtintype" id="3755966">nil</span><span class="op" id="3755969">,</span>&nbsp;<span class="string" id="3755971">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="3755996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3756000">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756052">i</span>&nbsp;<span class="op" id="3756054">:=</span>&nbsp;<span class="num" id="3756057">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756060">for</span>&nbsp;<span class="ident" id="3756064">_</span><span class="op" id="3756065">,</span>&nbsp;<span class="ident" id="3756067">ident</span>&nbsp;<span class="op" id="3756073">:=</span>&nbsp;<span class="keyword" id="3756076">range</span>&nbsp;<span class="ident" id="3756082">p</span><span class="op" id="3756083">.</span><span class="ident" id="3756084">unresolved</span>&nbsp;<span class="op" id="3756095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3756099">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756133">assert</span><span class="op" id="3756139">(</span><span class="ident" id="3756140">ident</span><span class="op" id="3756145">.</span><span class="ident" id="3756146">Obj</span>&nbsp;<span class="op" id="3756150">==</span>&nbsp;<span class="ident" id="3756153">unresolved</span><span class="op" id="3756163">,</span>&nbsp;<span class="string" id="3756165">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="3756190">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756194">ident</span><span class="op" id="3756199">.</span><span class="ident" id="3756200">Obj</span>&nbsp;<span class="op" id="3756204">=</span>&nbsp;<span class="ident" id="3756206">p</span><span class="op" id="3756207">.</span><span class="ident" id="3756208">pkgScope</span><span class="op" id="3756216">.</span><span class="ident" id="3756217">Lookup</span><span class="op" id="3756223">(</span><span class="ident" id="3756224">ident</span><span class="op" id="3756229">.</span><span class="ident" id="3756230">Name</span><span class="op" id="3756234">)</span>&nbsp;<span class="comment" id="3756236">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756274">if</span>&nbsp;<span class="ident" id="3756277">ident</span><span class="op" id="3756282">.</span><span class="ident" id="3756283">Obj</span>&nbsp;<span class="op" id="3756287">==</span>&nbsp;<span class="builtintype" id="3756290">nil</span>&nbsp;<span class="op" id="3756294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756299">p</span><span class="op" id="3756300">.</span><span class="ident" id="3756301">unresolved</span><span class="op" id="3756311">[</span><span class="ident" id="3756312">i</span><span class="op" id="3756313">]</span>&nbsp;<span class="op" id="3756315">=</span>&nbsp;<span class="ident" id="3756317">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756326">i</span><span class="op" id="3756327">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3756332">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3756335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756339">return</span>&nbsp;<span class="op" id="3756346">&amp;</span><span class="ident" id="3756347">ast</span><span class="op" id="3756350">.</span><span class="ident" id="3756351">File</span><span class="op" id="3756355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756359">Doc</span><span class="op" id="3756362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756371">doc</span><span class="op" id="3756374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756378">Package</span><span class="op" id="3756385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756390">pos</span><span class="op" id="3756393">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756397">Name</span><span class="op" id="3756401">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756409">ident</span><span class="op" id="3756414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756418">Decls</span><span class="op" id="3756423">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756430">decls</span><span class="op" id="3756435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756439">Scope</span><span class="op" id="3756444">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756451">p</span><span class="op" id="3756452">.</span><span class="ident" id="3756453">pkgScope</span><span class="op" id="3756461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756465">Imports</span><span class="op" id="3756472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756477">p</span><span class="op" id="3756478">.</span><span class="ident" id="3756479">imports</span><span class="op" id="3756486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756490">Unresolved</span><span class="op" id="3756500">:</span>&nbsp;<span class="ident" id="3756502">p</span><span class="op" id="3756503">.</span><span class="ident" id="3756504">unresolved</span><span class="op" id="3756514">[</span><span class="num" id="3756515">0</span><span class="op" id="3756516">:</span><span class="ident" id="3756517">i</span><span class="op" id="3756518">]</span><span class="op" id="3756519">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756523">Comments</span><span class="op" id="3756531">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3756535">p</span><span class="op" id="3756536">.</span><span class="ident" id="3756537">comments</span><span class="op" id="3756545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3756548">}</span><br>
<span class="lineno"></span><span class="op" id="3756550">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
