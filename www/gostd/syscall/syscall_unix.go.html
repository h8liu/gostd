<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2428036">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2428091">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2428145">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2428196">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2428261">package</span>&nbsp;<span class="ident" id="2428269">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2428278">import</span>&nbsp;<span class="op" id="2428285">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2428288">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2428299">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2428307">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2428316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2428319">var</span>&nbsp;<span class="op" id="2428323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428326">Stdin</span>&nbsp;&nbsp;<span class="op" id="2428333">=</span>&nbsp;<span class="num" id="2428335">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428338">Stdout</span>&nbsp;<span class="op" id="2428345">=</span>&nbsp;<span class="num" id="2428347">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428350">Stderr</span>&nbsp;<span class="op" id="2428357">=</span>&nbsp;<span class="num" id="2428359">2</span><br>
<span class="lineno"></span><span class="op" id="2428361">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2428364">const</span>&nbsp;<span class="op" id="2428370">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428373">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2428388">=</span>&nbsp;<span class="ident" id="2428390">runtime</span><span class="op" id="2428397">.</span><span class="ident" id="2428398">GOOS</span>&nbsp;<span class="op" id="2428403">==</span>&nbsp;<span class="string" id="2428406">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2428415">&amp;&amp;</span>&nbsp;<span class="ident" id="2428418">sizeofPtr</span>&nbsp;<span class="op" id="2428428">==</span>&nbsp;<span class="num" id="2428431">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428434">dragonfly64Bit</span>&nbsp;<span class="op" id="2428449">=</span>&nbsp;<span class="ident" id="2428451">runtime</span><span class="op" id="2428458">.</span><span class="ident" id="2428459">GOOS</span>&nbsp;<span class="op" id="2428464">==</span>&nbsp;<span class="string" id="2428467">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2428479">&amp;&amp;</span>&nbsp;<span class="ident" id="2428482">sizeofPtr</span>&nbsp;<span class="op" id="2428492">==</span>&nbsp;<span class="num" id="2428495">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428498">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2428513">=</span>&nbsp;<span class="ident" id="2428515">runtime</span><span class="op" id="2428522">.</span><span class="ident" id="2428523">GOOS</span>&nbsp;<span class="op" id="2428528">==</span>&nbsp;<span class="string" id="2428531">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2428540">&amp;&amp;</span>&nbsp;<span class="ident" id="2428543">sizeofPtr</span>&nbsp;<span class="op" id="2428553">==</span>&nbsp;<span class="num" id="2428556">4</span><br>
<span class="lineno">25</span><span class="op" id="2428558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2428561">func</span>&nbsp;<span class="ident" id="2428566">Syscall</span><span class="op" id="2428573">(</span><span class="ident" id="2428574">trap</span><span class="op" id="2428578">,</span>&nbsp;<span class="ident" id="2428580">a1</span><span class="op" id="2428582">,</span>&nbsp;<span class="ident" id="2428584">a2</span><span class="op" id="2428586">,</span>&nbsp;<span class="ident" id="2428588">a3</span>&nbsp;<span class="builtintype" id="2428591">uintptr</span><span class="op" id="2428598">)</span>&nbsp;<span class="op" id="2428600">(</span><span class="ident" id="2428601">r1</span><span class="op" id="2428603">,</span>&nbsp;<span class="ident" id="2428605">r2</span>&nbsp;<span class="builtintype" id="2428608">uintptr</span><span class="op" id="2428615">,</span>&nbsp;<span class="ident" id="2428617">err</span>&nbsp;<span class="ident" id="2428621">Errno</span><span class="op" id="2428626">)</span><br>
<span class="lineno"></span><span class="keyword" id="2428628">func</span>&nbsp;<span class="ident" id="2428633">Syscall6</span><span class="op" id="2428641">(</span><span class="ident" id="2428642">trap</span><span class="op" id="2428646">,</span>&nbsp;<span class="ident" id="2428648">a1</span><span class="op" id="2428650">,</span>&nbsp;<span class="ident" id="2428652">a2</span><span class="op" id="2428654">,</span>&nbsp;<span class="ident" id="2428656">a3</span><span class="op" id="2428658">,</span>&nbsp;<span class="ident" id="2428660">a4</span><span class="op" id="2428662">,</span>&nbsp;<span class="ident" id="2428664">a5</span><span class="op" id="2428666">,</span>&nbsp;<span class="ident" id="2428668">a6</span>&nbsp;<span class="builtintype" id="2428671">uintptr</span><span class="op" id="2428678">)</span>&nbsp;<span class="op" id="2428680">(</span><span class="ident" id="2428681">r1</span><span class="op" id="2428683">,</span>&nbsp;<span class="ident" id="2428685">r2</span>&nbsp;<span class="builtintype" id="2428688">uintptr</span><span class="op" id="2428695">,</span>&nbsp;<span class="ident" id="2428697">err</span>&nbsp;<span class="ident" id="2428701">Errno</span><span class="op" id="2428706">)</span><br>
<span class="lineno"></span><span class="keyword" id="2428708">func</span>&nbsp;<span class="ident" id="2428713">RawSyscall</span><span class="op" id="2428723">(</span><span class="ident" id="2428724">trap</span><span class="op" id="2428728">,</span>&nbsp;<span class="ident" id="2428730">a1</span><span class="op" id="2428732">,</span>&nbsp;<span class="ident" id="2428734">a2</span><span class="op" id="2428736">,</span>&nbsp;<span class="ident" id="2428738">a3</span>&nbsp;<span class="builtintype" id="2428741">uintptr</span><span class="op" id="2428748">)</span>&nbsp;<span class="op" id="2428750">(</span><span class="ident" id="2428751">r1</span><span class="op" id="2428753">,</span>&nbsp;<span class="ident" id="2428755">r2</span>&nbsp;<span class="builtintype" id="2428758">uintptr</span><span class="op" id="2428765">,</span>&nbsp;<span class="ident" id="2428767">err</span>&nbsp;<span class="ident" id="2428771">Errno</span><span class="op" id="2428776">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2428778">func</span>&nbsp;<span class="ident" id="2428783">RawSyscall6</span><span class="op" id="2428794">(</span><span class="ident" id="2428795">trap</span><span class="op" id="2428799">,</span>&nbsp;<span class="ident" id="2428801">a1</span><span class="op" id="2428803">,</span>&nbsp;<span class="ident" id="2428805">a2</span><span class="op" id="2428807">,</span>&nbsp;<span class="ident" id="2428809">a3</span><span class="op" id="2428811">,</span>&nbsp;<span class="ident" id="2428813">a4</span><span class="op" id="2428815">,</span>&nbsp;<span class="ident" id="2428817">a5</span><span class="op" id="2428819">,</span>&nbsp;<span class="ident" id="2428821">a6</span>&nbsp;<span class="builtintype" id="2428824">uintptr</span><span class="op" id="2428831">)</span>&nbsp;<span class="op" id="2428833">(</span><span class="ident" id="2428834">r1</span><span class="op" id="2428836">,</span>&nbsp;<span class="ident" id="2428838">r2</span>&nbsp;<span class="builtintype" id="2428841">uintptr</span><span class="op" id="2428848">,</span>&nbsp;<span class="ident" id="2428850">err</span>&nbsp;<span class="ident" id="2428854">Errno</span><span class="op" id="2428859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2428862">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2428934">type</span>&nbsp;<span class="ident" id="2428939">mmapper</span>&nbsp;<span class="keyword" id="2428947">struct</span>&nbsp;<span class="op" id="2428954">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428957">sync</span><span class="op" id="2428961">.</span><span class="ident" id="2428962">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428969">active</span>&nbsp;<span class="keyword" id="2428976">map</span><span class="op" id="2428979">[</span><span class="op" id="2428980">*</span><span class="builtintype" id="2428981">byte</span><span class="op" id="2428985">]</span><span class="op" id="2428986">[</span><span class="op" id="2428987">]</span><span class="builtintype" id="2428988">byte</span>&nbsp;<span class="comment" id="2428993">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429042">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2429049">func</span><span class="op" id="2429053">(</span><span class="ident" id="2429054">addr</span><span class="op" id="2429058">,</span>&nbsp;<span class="ident" id="2429060">length</span>&nbsp;<span class="builtintype" id="2429067">uintptr</span><span class="op" id="2429074">,</span>&nbsp;<span class="ident" id="2429076">prot</span><span class="op" id="2429080">,</span>&nbsp;<span class="ident" id="2429082">flags</span><span class="op" id="2429087">,</span>&nbsp;<span class="ident" id="2429089">fd</span>&nbsp;<span class="builtintype" id="2429092">int</span><span class="op" id="2429095">,</span>&nbsp;<span class="ident" id="2429097">offset</span>&nbsp;<span class="ident" id="2429104">int64</span><span class="op" id="2429109">)</span>&nbsp;<span class="op" id="2429111">(</span><span class="builtintype" id="2429112">uintptr</span><span class="op" id="2429119">,</span>&nbsp;<span class="builtintype" id="2429121">error</span><span class="op" id="2429126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429129">munmap</span>&nbsp;<span class="keyword" id="2429136">func</span><span class="op" id="2429140">(</span><span class="ident" id="2429141">addr</span>&nbsp;<span class="builtintype" id="2429146">uintptr</span><span class="op" id="2429153">,</span>&nbsp;<span class="ident" id="2429155">length</span>&nbsp;<span class="builtintype" id="2429162">uintptr</span><span class="op" id="2429169">)</span>&nbsp;<span class="builtintype" id="2429171">error</span><br>
<span class="lineno"></span><span class="op" id="2429177">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2429180">func</span>&nbsp;<span class="op" id="2429185">(</span><span class="ident" id="2429186">m</span>&nbsp;<span class="op" id="2429188">*</span><span class="ident" id="2429189">mmapper</span><span class="op" id="2429196">)</span>&nbsp;<span class="ident" id="2429198">Mmap</span><span class="op" id="2429202">(</span><span class="ident" id="2429203">fd</span>&nbsp;<span class="builtintype" id="2429206">int</span><span class="op" id="2429209">,</span>&nbsp;<span class="ident" id="2429211">offset</span>&nbsp;<span class="ident" id="2429218">int64</span><span class="op" id="2429223">,</span>&nbsp;<span class="ident" id="2429225">length</span>&nbsp;<span class="builtintype" id="2429232">int</span><span class="op" id="2429235">,</span>&nbsp;<span class="ident" id="2429237">prot</span>&nbsp;<span class="builtintype" id="2429242">int</span><span class="op" id="2429245">,</span>&nbsp;<span class="ident" id="2429247">flags</span>&nbsp;<span class="builtintype" id="2429253">int</span><span class="op" id="2429256">)</span>&nbsp;<span class="op" id="2429258">(</span><span class="ident" id="2429259">data</span>&nbsp;<span class="op" id="2429264">[</span><span class="op" id="2429265">]</span><span class="builtintype" id="2429266">byte</span><span class="op" id="2429270">,</span>&nbsp;<span class="ident" id="2429272">err</span>&nbsp;<span class="builtintype" id="2429276">error</span><span class="op" id="2429281">)</span>&nbsp;<span class="op" id="2429283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429286">if</span>&nbsp;<span class="ident" id="2429289">length</span>&nbsp;<span class="op" id="2429296">&lt;=</span>&nbsp;<span class="num" id="2429299">0</span>&nbsp;<span class="op" id="2429301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429305">return</span>&nbsp;<span class="ident" id="2429312">nil</span><span class="op" id="2429315">,</span>&nbsp;<span class="ident" id="2429317">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429325">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429329">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429359">addr</span><span class="op" id="2429363">,</span>&nbsp;<span class="ident" id="2429365">errno</span>&nbsp;<span class="op" id="2429371">:=</span>&nbsp;<span class="ident" id="2429374">m</span><span class="op" id="2429375">.</span><span class="ident" id="2429376">mmap</span><span class="op" id="2429380">(</span><span class="num" id="2429381">0</span><span class="op" id="2429382">,</span>&nbsp;<span class="builtintype" id="2429384">uintptr</span><span class="op" id="2429391">(</span><span class="ident" id="2429392">length</span><span class="op" id="2429398">)</span><span class="op" id="2429399">,</span>&nbsp;<span class="ident" id="2429401">prot</span><span class="op" id="2429405">,</span>&nbsp;<span class="ident" id="2429407">flags</span><span class="op" id="2429412">,</span>&nbsp;<span class="ident" id="2429414">fd</span><span class="op" id="2429416">,</span>&nbsp;<span class="ident" id="2429418">offset</span><span class="op" id="2429424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429427">if</span>&nbsp;<span class="ident" id="2429430">errno</span>&nbsp;<span class="op" id="2429436">!=</span>&nbsp;<span class="ident" id="2429439">nil</span>&nbsp;<span class="op" id="2429443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429447">return</span>&nbsp;<span class="ident" id="2429454">nil</span><span class="op" id="2429457">,</span>&nbsp;<span class="ident" id="2429459">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429470">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429494">var</span>&nbsp;<span class="ident" id="2429498">sl</span>&nbsp;<span class="op" id="2429501">=</span>&nbsp;<span class="keyword" id="2429503">struct</span>&nbsp;<span class="op" id="2429510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429514">addr</span>&nbsp;<span class="builtintype" id="2429519">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2429529">len</span>&nbsp;&nbsp;<span class="builtintype" id="2429534">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2429540">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2429545">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429550">}</span><span class="op" id="2429551">{</span><span class="ident" id="2429552">addr</span><span class="op" id="2429556">,</span>&nbsp;<span class="ident" id="2429558">length</span><span class="op" id="2429564">,</span>&nbsp;<span class="ident" id="2429566">length</span><span class="op" id="2429572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429576">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429617">b</span>&nbsp;<span class="op" id="2429619">:=</span>&nbsp;<span class="op" id="2429622">*</span><span class="op" id="2429623">(</span><span class="op" id="2429624">*</span><span class="op" id="2429625">[</span><span class="op" id="2429626">]</span><span class="builtintype" id="2429627">byte</span><span class="op" id="2429631">)</span><span class="op" id="2429632">(</span><span class="ident" id="2429633">unsafe</span><span class="op" id="2429639">.</span><span class="ident" id="2429640">Pointer</span><span class="op" id="2429647">(</span><span class="op" id="2429648">&amp;</span><span class="ident" id="2429649">sl</span><span class="op" id="2429651">)</span><span class="op" id="2429652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429656">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429697">p</span>&nbsp;<span class="op" id="2429699">:=</span>&nbsp;<span class="op" id="2429702">&amp;</span><span class="ident" id="2429703">b</span><span class="op" id="2429704">[</span><span class="builtinfunc" id="2429705">cap</span><span class="op" id="2429708">(</span><span class="ident" id="2429709">b</span><span class="op" id="2429710">)</span><span class="op" id="2429711">-</span><span class="num" id="2429712">1</span><span class="op" id="2429713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429716">m</span><span class="op" id="2429717">.</span><span class="ident" id="2429718">Lock</span><span class="op" id="2429722">(</span><span class="op" id="2429723">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429726">defer</span>&nbsp;<span class="ident" id="2429732">m</span><span class="op" id="2429733">.</span><span class="ident" id="2429734">Unlock</span><span class="op" id="2429740">(</span><span class="op" id="2429741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429744">m</span><span class="op" id="2429745">.</span><span class="ident" id="2429746">active</span><span class="op" id="2429752">[</span><span class="ident" id="2429753">p</span><span class="op" id="2429754">]</span>&nbsp;<span class="op" id="2429756">=</span>&nbsp;<span class="ident" id="2429758">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429761">return</span>&nbsp;<span class="ident" id="2429768">b</span><span class="op" id="2429769">,</span>&nbsp;<span class="ident" id="2429771">nil</span><br>
<span class="lineno"></span><span class="op" id="2429775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2429778">func</span>&nbsp;<span class="op" id="2429783">(</span><span class="ident" id="2429784">m</span>&nbsp;<span class="op" id="2429786">*</span><span class="ident" id="2429787">mmapper</span><span class="op" id="2429794">)</span>&nbsp;<span class="ident" id="2429796">Munmap</span><span class="op" id="2429802">(</span><span class="ident" id="2429803">data</span>&nbsp;<span class="op" id="2429808">[</span><span class="op" id="2429809">]</span><span class="builtintype" id="2429810">byte</span><span class="op" id="2429814">)</span>&nbsp;<span class="op" id="2429816">(</span><span class="ident" id="2429817">err</span>&nbsp;<span class="builtintype" id="2429821">error</span><span class="op" id="2429826">)</span>&nbsp;<span class="op" id="2429828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429831">if</span>&nbsp;<span class="builtinfunc" id="2429834">len</span><span class="op" id="2429837">(</span><span class="ident" id="2429838">data</span><span class="op" id="2429842">)</span>&nbsp;<span class="op" id="2429844">==</span>&nbsp;<span class="num" id="2429847">0</span>&nbsp;<span class="op" id="2429849">||</span>&nbsp;<span class="builtinfunc" id="2429852">len</span><span class="op" id="2429855">(</span><span class="ident" id="2429856">data</span><span class="op" id="2429860">)</span>&nbsp;<span class="op" id="2429862">!=</span>&nbsp;<span class="builtinfunc" id="2429865">cap</span><span class="op" id="2429868">(</span><span class="ident" id="2429869">data</span><span class="op" id="2429873">)</span>&nbsp;<span class="op" id="2429875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429879">return</span>&nbsp;<span class="ident" id="2429886">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429898">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429932">p</span>&nbsp;<span class="op" id="2429934">:=</span>&nbsp;<span class="op" id="2429937">&amp;</span><span class="ident" id="2429938">data</span><span class="op" id="2429942">[</span><span class="builtinfunc" id="2429943">cap</span><span class="op" id="2429946">(</span><span class="ident" id="2429947">data</span><span class="op" id="2429951">)</span><span class="op" id="2429952">-</span><span class="num" id="2429953">1</span><span class="op" id="2429954">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429957">m</span><span class="op" id="2429958">.</span><span class="ident" id="2429959">Lock</span><span class="op" id="2429963">(</span><span class="op" id="2429964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429967">defer</span>&nbsp;<span class="ident" id="2429973">m</span><span class="op" id="2429974">.</span><span class="ident" id="2429975">Unlock</span><span class="op" id="2429981">(</span><span class="op" id="2429982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429985">b</span>&nbsp;<span class="op" id="2429987">:=</span>&nbsp;<span class="ident" id="2429990">m</span><span class="op" id="2429991">.</span><span class="ident" id="2429992">active</span><span class="op" id="2429998">[</span><span class="ident" id="2429999">p</span><span class="op" id="2430000">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430003">if</span>&nbsp;<span class="ident" id="2430006">b</span>&nbsp;<span class="op" id="2430008">==</span>&nbsp;<span class="ident" id="2430011">nil</span>&nbsp;<span class="op" id="2430015">||</span>&nbsp;<span class="op" id="2430018">&amp;</span><span class="ident" id="2430019">b</span><span class="op" id="2430020">[</span><span class="num" id="2430021">0</span><span class="op" id="2430022">]</span>&nbsp;<span class="op" id="2430024">!=</span>&nbsp;<span class="op" id="2430027">&amp;</span><span class="ident" id="2430028">data</span><span class="op" id="2430032">[</span><span class="num" id="2430033">0</span><span class="op" id="2430034">]</span>&nbsp;<span class="op" id="2430036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430040">return</span>&nbsp;<span class="ident" id="2430047">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2430059">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430094">if</span>&nbsp;<span class="ident" id="2430097">errno</span>&nbsp;<span class="op" id="2430103">:=</span>&nbsp;<span class="ident" id="2430106">m</span><span class="op" id="2430107">.</span><span class="ident" id="2430108">munmap</span><span class="op" id="2430114">(</span><span class="builtintype" id="2430115">uintptr</span><span class="op" id="2430122">(</span><span class="ident" id="2430123">unsafe</span><span class="op" id="2430129">.</span><span class="ident" id="2430130">Pointer</span><span class="op" id="2430137">(</span><span class="op" id="2430138">&amp;</span><span class="ident" id="2430139">b</span><span class="op" id="2430140">[</span><span class="num" id="2430141">0</span><span class="op" id="2430142">]</span><span class="op" id="2430143">)</span><span class="op" id="2430144">)</span><span class="op" id="2430145">,</span>&nbsp;<span class="builtintype" id="2430147">uintptr</span><span class="op" id="2430154">(</span><span class="builtinfunc" id="2430155">len</span><span class="op" id="2430158">(</span><span class="ident" id="2430159">b</span><span class="op" id="2430160">)</span><span class="op" id="2430161">)</span><span class="op" id="2430162">)</span><span class="op" id="2430163">;</span>&nbsp;<span class="ident" id="2430165">errno</span>&nbsp;<span class="op" id="2430171">!=</span>&nbsp;<span class="ident" id="2430174">nil</span>&nbsp;<span class="op" id="2430178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430182">return</span>&nbsp;<span class="ident" id="2430189">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2430199">delete</span><span class="op" id="2430205">(</span><span class="ident" id="2430206">m</span><span class="op" id="2430207">.</span><span class="ident" id="2430208">active</span><span class="op" id="2430214">,</span>&nbsp;<span class="ident" id="2430216">p</span><span class="op" id="2430217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430220">return</span>&nbsp;<span class="ident" id="2430227">nil</span><br>
<span class="lineno">90</span><span class="op" id="2430231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2430234">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2430299">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2430370">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2430437">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2430450">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2430469">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2430485">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2430490">type</span>&nbsp;<span class="ident" id="2430495">Errno</span>&nbsp;<span class="builtintype" id="2430501">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2430510">func</span>&nbsp;<span class="op" id="2430515">(</span><span class="ident" id="2430516">e</span>&nbsp;<span class="ident" id="2430518">Errno</span><span class="op" id="2430523">)</span>&nbsp;<span class="ident" id="2430525">Error</span><span class="op" id="2430530">(</span><span class="op" id="2430531">)</span>&nbsp;<span class="builtintype" id="2430533">string</span>&nbsp;<span class="op" id="2430540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430543">if</span>&nbsp;<span class="num" id="2430546">0</span>&nbsp;<span class="op" id="2430548">&lt;=</span>&nbsp;<span class="builtintype" id="2430551">int</span><span class="op" id="2430554">(</span><span class="ident" id="2430555">e</span><span class="op" id="2430556">)</span>&nbsp;<span class="op" id="2430558">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2430561">int</span><span class="op" id="2430564">(</span><span class="ident" id="2430565">e</span><span class="op" id="2430566">)</span>&nbsp;<span class="op" id="2430568">&lt;</span>&nbsp;<span class="builtinfunc" id="2430570">len</span><span class="op" id="2430573">(</span><span class="ident" id="2430574">errors</span><span class="op" id="2430580">)</span>&nbsp;<span class="op" id="2430582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430586">s</span>&nbsp;<span class="op" id="2430588">:=</span>&nbsp;<span class="ident" id="2430591">errors</span><span class="op" id="2430597">[</span><span class="ident" id="2430598">e</span><span class="op" id="2430599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430603">if</span>&nbsp;<span class="ident" id="2430606">s</span>&nbsp;<span class="op" id="2430608">!=</span>&nbsp;<span class="string" id="2430611">&#34;&#34;</span>&nbsp;<span class="op" id="2430614">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430619">return</span>&nbsp;<span class="ident" id="2430626">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430636">return</span>&nbsp;<span class="string" id="2430643">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2430652">+</span>&nbsp;<span class="ident" id="2430654">itoa</span><span class="op" id="2430658">(</span><span class="builtintype" id="2430659">int</span><span class="op" id="2430662">(</span><span class="ident" id="2430663">e</span><span class="op" id="2430664">)</span><span class="op" id="2430665">)</span><br>
<span class="lineno"></span><span class="op" id="2430667">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2430670">func</span>&nbsp;<span class="op" id="2430675">(</span><span class="ident" id="2430676">e</span>&nbsp;<span class="ident" id="2430678">Errno</span><span class="op" id="2430683">)</span>&nbsp;<span class="ident" id="2430685">Temporary</span><span class="op" id="2430694">(</span><span class="op" id="2430695">)</span>&nbsp;<span class="builtintype" id="2430697">bool</span>&nbsp;<span class="op" id="2430702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430705">return</span>&nbsp;<span class="ident" id="2430712">e</span>&nbsp;<span class="op" id="2430714">==</span>&nbsp;<span class="ident" id="2430717">EINTR</span>&nbsp;<span class="op" id="2430723">||</span>&nbsp;<span class="ident" id="2430726">e</span>&nbsp;<span class="op" id="2430728">==</span>&nbsp;<span class="ident" id="2430731">EMFILE</span>&nbsp;<span class="op" id="2430738">||</span>&nbsp;<span class="ident" id="2430741">e</span>&nbsp;<span class="op" id="2430743">==</span>&nbsp;<span class="ident" id="2430746">ECONNRESET</span>&nbsp;<span class="op" id="2430757">||</span>&nbsp;<span class="ident" id="2430760">e</span>&nbsp;<span class="op" id="2430762">==</span>&nbsp;<span class="ident" id="2430765">ECONNABORTED</span>&nbsp;<span class="op" id="2430778">||</span>&nbsp;<span class="ident" id="2430781">e</span><span class="op" id="2430782">.</span><span class="ident" id="2430783">Timeout</span><span class="op" id="2430790">(</span><span class="op" id="2430791">)</span><br>
<span class="lineno"></span><span class="op" id="2430793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2430796">func</span>&nbsp;<span class="op" id="2430801">(</span><span class="ident" id="2430802">e</span>&nbsp;<span class="ident" id="2430804">Errno</span><span class="op" id="2430809">)</span>&nbsp;<span class="ident" id="2430811">Timeout</span><span class="op" id="2430818">(</span><span class="op" id="2430819">)</span>&nbsp;<span class="builtintype" id="2430821">bool</span>&nbsp;<span class="op" id="2430826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430829">return</span>&nbsp;<span class="ident" id="2430836">e</span>&nbsp;<span class="op" id="2430838">==</span>&nbsp;<span class="ident" id="2430841">EAGAIN</span>&nbsp;<span class="op" id="2430848">||</span>&nbsp;<span class="ident" id="2430851">e</span>&nbsp;<span class="op" id="2430853">==</span>&nbsp;<span class="ident" id="2430856">EWOULDBLOCK</span>&nbsp;<span class="op" id="2430868">||</span>&nbsp;<span class="ident" id="2430871">e</span>&nbsp;<span class="op" id="2430873">==</span>&nbsp;<span class="ident" id="2430876">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2430886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2430889">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2430942">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2430984">type</span>&nbsp;<span class="ident" id="2430989">Signal</span>&nbsp;<span class="builtintype" id="2430996">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431001">func</span>&nbsp;<span class="op" id="2431006">(</span><span class="ident" id="2431007">s</span>&nbsp;<span class="ident" id="2431009">Signal</span><span class="op" id="2431015">)</span>&nbsp;<span class="ident" id="2431017">Signal</span><span class="op" id="2431023">(</span><span class="op" id="2431024">)</span>&nbsp;<span class="op" id="2431026">{</span><span class="op" id="2431027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2431030">func</span>&nbsp;<span class="op" id="2431035">(</span><span class="ident" id="2431036">s</span>&nbsp;<span class="ident" id="2431038">Signal</span><span class="op" id="2431044">)</span>&nbsp;<span class="ident" id="2431046">String</span><span class="op" id="2431052">(</span><span class="op" id="2431053">)</span>&nbsp;<span class="builtintype" id="2431055">string</span>&nbsp;<span class="op" id="2431062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431065">if</span>&nbsp;<span class="num" id="2431068">0</span>&nbsp;<span class="op" id="2431070">&lt;=</span>&nbsp;<span class="ident" id="2431073">s</span>&nbsp;<span class="op" id="2431075">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2431078">int</span><span class="op" id="2431081">(</span><span class="ident" id="2431082">s</span><span class="op" id="2431083">)</span>&nbsp;<span class="op" id="2431085">&lt;</span>&nbsp;<span class="builtinfunc" id="2431087">len</span><span class="op" id="2431090">(</span><span class="ident" id="2431091">signals</span><span class="op" id="2431098">)</span>&nbsp;<span class="op" id="2431100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431104">str</span>&nbsp;<span class="op" id="2431108">:=</span>&nbsp;<span class="ident" id="2431111">signals</span><span class="op" id="2431118">[</span><span class="ident" id="2431119">s</span><span class="op" id="2431120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431124">if</span>&nbsp;<span class="ident" id="2431127">str</span>&nbsp;<span class="op" id="2431131">!=</span>&nbsp;<span class="string" id="2431134">&#34;&#34;</span>&nbsp;<span class="op" id="2431137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431142">return</span>&nbsp;<span class="ident" id="2431149">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431161">return</span>&nbsp;<span class="string" id="2431168">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2431178">+</span>&nbsp;<span class="ident" id="2431180">itoa</span><span class="op" id="2431184">(</span><span class="builtintype" id="2431185">int</span><span class="op" id="2431188">(</span><span class="ident" id="2431189">s</span><span class="op" id="2431190">)</span><span class="op" id="2431191">)</span><br>
<span class="lineno"></span><span class="op" id="2431193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2431196">func</span>&nbsp;<span class="ident" id="2431201">Read</span><span class="op" id="2431205">(</span><span class="ident" id="2431206">fd</span>&nbsp;<span class="builtintype" id="2431209">int</span><span class="op" id="2431212">,</span>&nbsp;<span class="ident" id="2431214">p</span>&nbsp;<span class="op" id="2431216">[</span><span class="op" id="2431217">]</span><span class="builtintype" id="2431218">byte</span><span class="op" id="2431222">)</span>&nbsp;<span class="op" id="2431224">(</span><span class="ident" id="2431225">n</span>&nbsp;<span class="builtintype" id="2431227">int</span><span class="op" id="2431230">,</span>&nbsp;<span class="ident" id="2431232">err</span>&nbsp;<span class="builtintype" id="2431236">error</span><span class="op" id="2431241">)</span>&nbsp;<span class="op" id="2431243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431246">n</span><span class="op" id="2431247">,</span>&nbsp;<span class="ident" id="2431249">err</span>&nbsp;<span class="op" id="2431253">=</span>&nbsp;<span class="ident" id="2431255">read</span><span class="op" id="2431259">(</span><span class="ident" id="2431260">fd</span><span class="op" id="2431262">,</span>&nbsp;<span class="ident" id="2431264">p</span><span class="op" id="2431265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431268">if</span>&nbsp;<span class="ident" id="2431271">raceenabled</span>&nbsp;<span class="op" id="2431283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431287">if</span>&nbsp;<span class="ident" id="2431290">n</span>&nbsp;<span class="op" id="2431292">&gt;</span>&nbsp;<span class="num" id="2431294">0</span>&nbsp;<span class="op" id="2431296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431301">raceWriteRange</span><span class="op" id="2431315">(</span><span class="ident" id="2431316">unsafe</span><span class="op" id="2431322">.</span><span class="ident" id="2431323">Pointer</span><span class="op" id="2431330">(</span><span class="op" id="2431331">&amp;</span><span class="ident" id="2431332">p</span><span class="op" id="2431333">[</span><span class="num" id="2431334">0</span><span class="op" id="2431335">]</span><span class="op" id="2431336">)</span><span class="op" id="2431337">,</span>&nbsp;<span class="ident" id="2431339">n</span><span class="op" id="2431340">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431348">if</span>&nbsp;<span class="ident" id="2431351">err</span>&nbsp;<span class="op" id="2431355">==</span>&nbsp;<span class="ident" id="2431358">nil</span>&nbsp;<span class="op" id="2431362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431367">raceAcquire</span><span class="op" id="2431378">(</span><span class="ident" id="2431379">unsafe</span><span class="op" id="2431385">.</span><span class="ident" id="2431386">Pointer</span><span class="op" id="2431393">(</span><span class="op" id="2431394">&amp;</span><span class="ident" id="2431395">ioSync</span><span class="op" id="2431401">)</span><span class="op" id="2431402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431409">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431412">return</span><br>
<span class="lineno"></span><span class="op" id="2431419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431422">func</span>&nbsp;<span class="ident" id="2431427">Write</span><span class="op" id="2431432">(</span><span class="ident" id="2431433">fd</span>&nbsp;<span class="builtintype" id="2431436">int</span><span class="op" id="2431439">,</span>&nbsp;<span class="ident" id="2431441">p</span>&nbsp;<span class="op" id="2431443">[</span><span class="op" id="2431444">]</span><span class="builtintype" id="2431445">byte</span><span class="op" id="2431449">)</span>&nbsp;<span class="op" id="2431451">(</span><span class="ident" id="2431452">n</span>&nbsp;<span class="builtintype" id="2431454">int</span><span class="op" id="2431457">,</span>&nbsp;<span class="ident" id="2431459">err</span>&nbsp;<span class="builtintype" id="2431463">error</span><span class="op" id="2431468">)</span>&nbsp;<span class="op" id="2431470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431473">if</span>&nbsp;<span class="ident" id="2431476">raceenabled</span>&nbsp;<span class="op" id="2431488">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431492">raceReleaseMerge</span><span class="op" id="2431508">(</span><span class="ident" id="2431509">unsafe</span><span class="op" id="2431515">.</span><span class="ident" id="2431516">Pointer</span><span class="op" id="2431523">(</span><span class="op" id="2431524">&amp;</span><span class="ident" id="2431525">ioSync</span><span class="op" id="2431531">)</span><span class="op" id="2431532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431538">n</span><span class="op" id="2431539">,</span>&nbsp;<span class="ident" id="2431541">err</span>&nbsp;<span class="op" id="2431545">=</span>&nbsp;<span class="ident" id="2431547">write</span><span class="op" id="2431552">(</span><span class="ident" id="2431553">fd</span><span class="op" id="2431555">,</span>&nbsp;<span class="ident" id="2431557">p</span><span class="op" id="2431558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431561">if</span>&nbsp;<span class="ident" id="2431564">raceenabled</span>&nbsp;<span class="op" id="2431576">&amp;&amp;</span>&nbsp;<span class="ident" id="2431579">n</span>&nbsp;<span class="op" id="2431581">&gt;</span>&nbsp;<span class="num" id="2431583">0</span>&nbsp;<span class="op" id="2431585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431589">raceReadRange</span><span class="op" id="2431602">(</span><span class="ident" id="2431603">unsafe</span><span class="op" id="2431609">.</span><span class="ident" id="2431610">Pointer</span><span class="op" id="2431617">(</span><span class="op" id="2431618">&amp;</span><span class="ident" id="2431619">p</span><span class="op" id="2431620">[</span><span class="num" id="2431621">0</span><span class="op" id="2431622">]</span><span class="op" id="2431623">)</span><span class="op" id="2431624">,</span>&nbsp;<span class="ident" id="2431626">n</span><span class="op" id="2431627">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431633">return</span><br>
<span class="lineno"></span><span class="op" id="2431640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2431643">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2431694">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2431746">var</span>&nbsp;<span class="ident" id="2431750">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2431768">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431774">type</span>&nbsp;<span class="ident" id="2431779">Sockaddr</span>&nbsp;<span class="keyword" id="2431788">interface</span>&nbsp;<span class="op" id="2431798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431801">sockaddr</span><span class="op" id="2431809">(</span><span class="op" id="2431810">)</span>&nbsp;<span class="op" id="2431812">(</span><span class="ident" id="2431813">ptr</span>&nbsp;<span class="ident" id="2431817">unsafe</span><span class="op" id="2431823">.</span><span class="ident" id="2431824">Pointer</span><span class="op" id="2431831">,</span>&nbsp;<span class="builtinfunc" id="2431833">len</span>&nbsp;<span class="ident" id="2431837">_Socklen</span><span class="op" id="2431845">,</span>&nbsp;<span class="ident" id="2431847">err</span>&nbsp;<span class="builtintype" id="2431851">error</span><span class="op" id="2431856">)</span>&nbsp;<span class="comment" id="2431858">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2431901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431904">type</span>&nbsp;<span class="ident" id="2431909">SockaddrInet4</span>&nbsp;<span class="keyword" id="2431923">struct</span>&nbsp;<span class="op" id="2431930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431933">Port</span>&nbsp;<span class="builtintype" id="2431938">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431943">Addr</span>&nbsp;<span class="op" id="2431948">[</span><span class="num" id="2431949">4</span><span class="op" id="2431950">]</span><span class="builtintype" id="2431951">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431957">raw</span>&nbsp;&nbsp;<span class="ident" id="2431962">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2431979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431982">type</span>&nbsp;<span class="ident" id="2431987">SockaddrInet6</span>&nbsp;<span class="keyword" id="2432001">struct</span>&nbsp;<span class="op" id="2432008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432011">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2432018">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432023">ZoneId</span>&nbsp;<span class="builtintype" id="2432030">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432038">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2432045">[</span><span class="num" id="2432046">16</span><span class="op" id="2432048">]</span><span class="builtintype" id="2432049">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432055">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2432062">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2432079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2432082">type</span>&nbsp;<span class="ident" id="2432087">SockaddrUnix</span>&nbsp;<span class="keyword" id="2432100">struct</span>&nbsp;<span class="op" id="2432107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432110">Name</span>&nbsp;<span class="builtintype" id="2432115">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432123">raw</span>&nbsp;&nbsp;<span class="ident" id="2432128">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2432144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2432147">func</span>&nbsp;<span class="ident" id="2432152">Bind</span><span class="op" id="2432156">(</span><span class="ident" id="2432157">fd</span>&nbsp;<span class="builtintype" id="2432160">int</span><span class="op" id="2432163">,</span>&nbsp;<span class="ident" id="2432165">sa</span>&nbsp;<span class="ident" id="2432168">Sockaddr</span><span class="op" id="2432176">)</span>&nbsp;<span class="op" id="2432178">(</span><span class="ident" id="2432179">err</span>&nbsp;<span class="builtintype" id="2432183">error</span><span class="op" id="2432188">)</span>&nbsp;<span class="op" id="2432190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432193">ptr</span><span class="op" id="2432196">,</span>&nbsp;<span class="ident" id="2432198">n</span><span class="op" id="2432199">,</span>&nbsp;<span class="ident" id="2432201">err</span>&nbsp;<span class="op" id="2432205">:=</span>&nbsp;<span class="ident" id="2432208">sa</span><span class="op" id="2432210">.</span><span class="ident" id="2432211">sockaddr</span><span class="op" id="2432219">(</span><span class="op" id="2432220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432223">if</span>&nbsp;<span class="ident" id="2432226">err</span>&nbsp;<span class="op" id="2432230">!=</span>&nbsp;<span class="ident" id="2432233">nil</span>&nbsp;<span class="op" id="2432237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432241">return</span>&nbsp;<span class="ident" id="2432248">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432253">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432256">return</span>&nbsp;<span class="ident" id="2432263">bind</span><span class="op" id="2432267">(</span><span class="ident" id="2432268">fd</span><span class="op" id="2432270">,</span>&nbsp;<span class="ident" id="2432272">ptr</span><span class="op" id="2432275">,</span>&nbsp;<span class="ident" id="2432277">n</span><span class="op" id="2432278">)</span><br>
<span class="lineno"></span><span class="op" id="2432280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2432283">func</span>&nbsp;<span class="ident" id="2432288">Connect</span><span class="op" id="2432295">(</span><span class="ident" id="2432296">fd</span>&nbsp;<span class="builtintype" id="2432299">int</span><span class="op" id="2432302">,</span>&nbsp;<span class="ident" id="2432304">sa</span>&nbsp;<span class="ident" id="2432307">Sockaddr</span><span class="op" id="2432315">)</span>&nbsp;<span class="op" id="2432317">(</span><span class="ident" id="2432318">err</span>&nbsp;<span class="builtintype" id="2432322">error</span><span class="op" id="2432327">)</span>&nbsp;<span class="op" id="2432329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432332">ptr</span><span class="op" id="2432335">,</span>&nbsp;<span class="ident" id="2432337">n</span><span class="op" id="2432338">,</span>&nbsp;<span class="ident" id="2432340">err</span>&nbsp;<span class="op" id="2432344">:=</span>&nbsp;<span class="ident" id="2432347">sa</span><span class="op" id="2432349">.</span><span class="ident" id="2432350">sockaddr</span><span class="op" id="2432358">(</span><span class="op" id="2432359">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432362">if</span>&nbsp;<span class="ident" id="2432365">err</span>&nbsp;<span class="op" id="2432369">!=</span>&nbsp;<span class="ident" id="2432372">nil</span>&nbsp;<span class="op" id="2432376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432380">return</span>&nbsp;<span class="ident" id="2432387">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432395">return</span>&nbsp;<span class="ident" id="2432402">connect</span><span class="op" id="2432409">(</span><span class="ident" id="2432410">fd</span><span class="op" id="2432412">,</span>&nbsp;<span class="ident" id="2432414">ptr</span><span class="op" id="2432417">,</span>&nbsp;<span class="ident" id="2432419">n</span><span class="op" id="2432420">)</span><br>
<span class="lineno"></span><span class="op" id="2432422">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2432425">func</span>&nbsp;<span class="ident" id="2432430">Getpeername</span><span class="op" id="2432441">(</span><span class="ident" id="2432442">fd</span>&nbsp;<span class="builtintype" id="2432445">int</span><span class="op" id="2432448">)</span>&nbsp;<span class="op" id="2432450">(</span><span class="ident" id="2432451">sa</span>&nbsp;<span class="ident" id="2432454">Sockaddr</span><span class="op" id="2432462">,</span>&nbsp;<span class="ident" id="2432464">err</span>&nbsp;<span class="builtintype" id="2432468">error</span><span class="op" id="2432473">)</span>&nbsp;<span class="op" id="2432475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432478">var</span>&nbsp;<span class="ident" id="2432482">rsa</span>&nbsp;<span class="ident" id="2432486">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432502">var</span>&nbsp;<span class="builtinfunc" id="2432506">len</span>&nbsp;<span class="ident" id="2432510">_Socklen</span>&nbsp;<span class="op" id="2432519">=</span>&nbsp;<span class="ident" id="2432521">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432540">if</span>&nbsp;<span class="ident" id="2432543">err</span>&nbsp;<span class="op" id="2432547">=</span>&nbsp;<span class="ident" id="2432549">getpeername</span><span class="op" id="2432560">(</span><span class="ident" id="2432561">fd</span><span class="op" id="2432563">,</span>&nbsp;<span class="op" id="2432565">&amp;</span><span class="ident" id="2432566">rsa</span><span class="op" id="2432569">,</span>&nbsp;<span class="op" id="2432571">&amp;</span><span class="builtinfunc" id="2432572">len</span><span class="op" id="2432575">)</span><span class="op" id="2432576">;</span>&nbsp;<span class="ident" id="2432578">err</span>&nbsp;<span class="op" id="2432582">!=</span>&nbsp;<span class="ident" id="2432585">nil</span>&nbsp;<span class="op" id="2432589">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432593">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432604">return</span>&nbsp;<span class="ident" id="2432611">anyToSockaddr</span><span class="op" id="2432624">(</span><span class="op" id="2432625">&amp;</span><span class="ident" id="2432626">rsa</span><span class="op" id="2432629">)</span><br>
<span class="lineno"></span><span class="op" id="2432631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2432634">func</span>&nbsp;<span class="ident" id="2432639">GetsockoptInt</span><span class="op" id="2432652">(</span><span class="ident" id="2432653">fd</span><span class="op" id="2432655">,</span>&nbsp;<span class="ident" id="2432657">level</span><span class="op" id="2432662">,</span>&nbsp;<span class="ident" id="2432664">opt</span>&nbsp;<span class="builtintype" id="2432668">int</span><span class="op" id="2432671">)</span>&nbsp;<span class="op" id="2432673">(</span><span class="ident" id="2432674">value</span>&nbsp;<span class="builtintype" id="2432680">int</span><span class="op" id="2432683">,</span>&nbsp;<span class="ident" id="2432685">err</span>&nbsp;<span class="builtintype" id="2432689">error</span><span class="op" id="2432694">)</span>&nbsp;<span class="op" id="2432696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432699">var</span>&nbsp;<span class="ident" id="2432703">n</span>&nbsp;<span class="builtintype" id="2432705">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432712">vallen</span>&nbsp;<span class="op" id="2432719">:=</span>&nbsp;<span class="ident" id="2432722">_Socklen</span><span class="op" id="2432730">(</span><span class="num" id="2432731">4</span><span class="op" id="2432732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2432735">err</span>&nbsp;<span class="op" id="2432739">=</span>&nbsp;<span class="ident" id="2432741">getsockopt</span><span class="op" id="2432751">(</span><span class="ident" id="2432752">fd</span><span class="op" id="2432754">,</span>&nbsp;<span class="ident" id="2432756">level</span><span class="op" id="2432761">,</span>&nbsp;<span class="ident" id="2432763">opt</span><span class="op" id="2432766">,</span>&nbsp;<span class="ident" id="2432768">unsafe</span><span class="op" id="2432774">.</span><span class="ident" id="2432775">Pointer</span><span class="op" id="2432782">(</span><span class="op" id="2432783">&amp;</span><span class="ident" id="2432784">n</span><span class="op" id="2432785">)</span><span class="op" id="2432786">,</span>&nbsp;<span class="op" id="2432788">&amp;</span><span class="ident" id="2432789">vallen</span><span class="op" id="2432795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432798">return</span>&nbsp;<span class="builtintype" id="2432805">int</span><span class="op" id="2432808">(</span><span class="ident" id="2432809">n</span><span class="op" id="2432810">)</span><span class="op" id="2432811">,</span>&nbsp;<span class="ident" id="2432813">err</span><br>
<span class="lineno">215</span><span class="op" id="2432817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2432820">func</span>&nbsp;<span class="ident" id="2432825">Recvfrom</span><span class="op" id="2432833">(</span><span class="ident" id="2432834">fd</span>&nbsp;<span class="builtintype" id="2432837">int</span><span class="op" id="2432840">,</span>&nbsp;<span class="ident" id="2432842">p</span>&nbsp;<span class="op" id="2432844">[</span><span class="op" id="2432845">]</span><span class="builtintype" id="2432846">byte</span><span class="op" id="2432850">,</span>&nbsp;<span class="ident" id="2432852">flags</span>&nbsp;<span class="builtintype" id="2432858">int</span><span class="op" id="2432861">)</span>&nbsp;<span class="op" id="2432863">(</span><span class="ident" id="2432864">n</span>&nbsp;<span class="builtintype" id="2432866">int</span><span class="op" id="2432869">,</span>&nbsp;<span class="ident" id="2432871">from</span>&nbsp;<span class="ident" id="2432876">Sockaddr</span><span class="op" id="2432884">,</span>&nbsp;<span class="ident" id="2432886">err</span>&nbsp;<span class="builtintype" id="2432890">error</span><span class="op" id="2432895">)</span>&nbsp;<span class="op" id="2432897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432900">var</span>&nbsp;<span class="ident" id="2432904">rsa</span>&nbsp;<span class="ident" id="2432908">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432924">var</span>&nbsp;<span class="builtinfunc" id="2432928">len</span>&nbsp;<span class="ident" id="2432932">_Socklen</span>&nbsp;<span class="op" id="2432941">=</span>&nbsp;<span class="ident" id="2432943">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432962">if</span>&nbsp;<span class="ident" id="2432965">n</span><span class="op" id="2432966">,</span>&nbsp;<span class="ident" id="2432968">err</span>&nbsp;<span class="op" id="2432972">=</span>&nbsp;<span class="ident" id="2432974">recvfrom</span><span class="op" id="2432982">(</span><span class="ident" id="2432983">fd</span><span class="op" id="2432985">,</span>&nbsp;<span class="ident" id="2432987">p</span><span class="op" id="2432988">,</span>&nbsp;<span class="ident" id="2432990">flags</span><span class="op" id="2432995">,</span>&nbsp;<span class="op" id="2432997">&amp;</span><span class="ident" id="2432998">rsa</span><span class="op" id="2433001">,</span>&nbsp;<span class="op" id="2433003">&amp;</span><span class="builtinfunc" id="2433004">len</span><span class="op" id="2433007">)</span><span class="op" id="2433008">;</span>&nbsp;<span class="ident" id="2433010">err</span>&nbsp;<span class="op" id="2433014">!=</span>&nbsp;<span class="ident" id="2433017">nil</span>&nbsp;<span class="op" id="2433021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433025">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433036">if</span>&nbsp;<span class="ident" id="2433039">rsa</span><span class="op" id="2433042">.</span><span class="ident" id="2433043">Addr</span><span class="op" id="2433047">.</span><span class="ident" id="2433048">Family</span>&nbsp;<span class="op" id="2433055">!=</span>&nbsp;<span class="ident" id="2433058">AF_UNSPEC</span>&nbsp;<span class="op" id="2433068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433072">from</span><span class="op" id="2433076">,</span>&nbsp;<span class="ident" id="2433078">err</span>&nbsp;<span class="op" id="2433082">=</span>&nbsp;<span class="ident" id="2433084">anyToSockaddr</span><span class="op" id="2433097">(</span><span class="op" id="2433098">&amp;</span><span class="ident" id="2433099">rsa</span><span class="op" id="2433102">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433108">return</span><br>
<span class="lineno"></span><span class="op" id="2433115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433118">func</span>&nbsp;<span class="ident" id="2433123">Sendto</span><span class="op" id="2433129">(</span><span class="ident" id="2433130">fd</span>&nbsp;<span class="builtintype" id="2433133">int</span><span class="op" id="2433136">,</span>&nbsp;<span class="ident" id="2433138">p</span>&nbsp;<span class="op" id="2433140">[</span><span class="op" id="2433141">]</span><span class="builtintype" id="2433142">byte</span><span class="op" id="2433146">,</span>&nbsp;<span class="ident" id="2433148">flags</span>&nbsp;<span class="builtintype" id="2433154">int</span><span class="op" id="2433157">,</span>&nbsp;<span class="ident" id="2433159">to</span>&nbsp;<span class="ident" id="2433162">Sockaddr</span><span class="op" id="2433170">)</span>&nbsp;<span class="op" id="2433172">(</span><span class="ident" id="2433173">err</span>&nbsp;<span class="builtintype" id="2433177">error</span><span class="op" id="2433182">)</span>&nbsp;<span class="op" id="2433184">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433187">ptr</span><span class="op" id="2433190">,</span>&nbsp;<span class="ident" id="2433192">n</span><span class="op" id="2433193">,</span>&nbsp;<span class="ident" id="2433195">err</span>&nbsp;<span class="op" id="2433199">:=</span>&nbsp;<span class="ident" id="2433202">to</span><span class="op" id="2433204">.</span><span class="ident" id="2433205">sockaddr</span><span class="op" id="2433213">(</span><span class="op" id="2433214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433217">if</span>&nbsp;<span class="ident" id="2433220">err</span>&nbsp;<span class="op" id="2433224">!=</span>&nbsp;<span class="ident" id="2433227">nil</span>&nbsp;<span class="op" id="2433231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433235">return</span>&nbsp;<span class="ident" id="2433242">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433250">return</span>&nbsp;<span class="ident" id="2433257">sendto</span><span class="op" id="2433263">(</span><span class="ident" id="2433264">fd</span><span class="op" id="2433266">,</span>&nbsp;<span class="ident" id="2433268">p</span><span class="op" id="2433269">,</span>&nbsp;<span class="ident" id="2433271">flags</span><span class="op" id="2433276">,</span>&nbsp;<span class="ident" id="2433278">ptr</span><span class="op" id="2433281">,</span>&nbsp;<span class="ident" id="2433283">n</span><span class="op" id="2433284">)</span><br>
<span class="lineno">235</span><span class="op" id="2433286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433289">func</span>&nbsp;<span class="ident" id="2433294">SetsockoptByte</span><span class="op" id="2433308">(</span><span class="ident" id="2433309">fd</span><span class="op" id="2433311">,</span>&nbsp;<span class="ident" id="2433313">level</span><span class="op" id="2433318">,</span>&nbsp;<span class="ident" id="2433320">opt</span>&nbsp;<span class="builtintype" id="2433324">int</span><span class="op" id="2433327">,</span>&nbsp;<span class="ident" id="2433329">value</span>&nbsp;<span class="builtintype" id="2433335">byte</span><span class="op" id="2433339">)</span>&nbsp;<span class="op" id="2433341">(</span><span class="ident" id="2433342">err</span>&nbsp;<span class="builtintype" id="2433346">error</span><span class="op" id="2433351">)</span>&nbsp;<span class="op" id="2433353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433356">return</span>&nbsp;<span class="ident" id="2433363">setsockopt</span><span class="op" id="2433373">(</span><span class="ident" id="2433374">fd</span><span class="op" id="2433376">,</span>&nbsp;<span class="ident" id="2433378">level</span><span class="op" id="2433383">,</span>&nbsp;<span class="ident" id="2433385">opt</span><span class="op" id="2433388">,</span>&nbsp;<span class="ident" id="2433390">unsafe</span><span class="op" id="2433396">.</span><span class="ident" id="2433397">Pointer</span><span class="op" id="2433404">(</span><span class="op" id="2433405">&amp;</span><span class="ident" id="2433406">value</span><span class="op" id="2433411">)</span><span class="op" id="2433412">,</span>&nbsp;<span class="num" id="2433414">1</span><span class="op" id="2433415">)</span><br>
<span class="lineno"></span><span class="op" id="2433417">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2433420">func</span>&nbsp;<span class="ident" id="2433425">SetsockoptInt</span><span class="op" id="2433438">(</span><span class="ident" id="2433439">fd</span><span class="op" id="2433441">,</span>&nbsp;<span class="ident" id="2433443">level</span><span class="op" id="2433448">,</span>&nbsp;<span class="ident" id="2433450">opt</span>&nbsp;<span class="builtintype" id="2433454">int</span><span class="op" id="2433457">,</span>&nbsp;<span class="ident" id="2433459">value</span>&nbsp;<span class="builtintype" id="2433465">int</span><span class="op" id="2433468">)</span>&nbsp;<span class="op" id="2433470">(</span><span class="ident" id="2433471">err</span>&nbsp;<span class="builtintype" id="2433475">error</span><span class="op" id="2433480">)</span>&nbsp;<span class="op" id="2433482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433485">var</span>&nbsp;<span class="ident" id="2433489">n</span>&nbsp;<span class="op" id="2433491">=</span>&nbsp;<span class="builtintype" id="2433493">int32</span><span class="op" id="2433498">(</span><span class="ident" id="2433499">value</span><span class="op" id="2433504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433507">return</span>&nbsp;<span class="ident" id="2433514">setsockopt</span><span class="op" id="2433524">(</span><span class="ident" id="2433525">fd</span><span class="op" id="2433527">,</span>&nbsp;<span class="ident" id="2433529">level</span><span class="op" id="2433534">,</span>&nbsp;<span class="ident" id="2433536">opt</span><span class="op" id="2433539">,</span>&nbsp;<span class="ident" id="2433541">unsafe</span><span class="op" id="2433547">.</span><span class="ident" id="2433548">Pointer</span><span class="op" id="2433555">(</span><span class="op" id="2433556">&amp;</span><span class="ident" id="2433557">n</span><span class="op" id="2433558">)</span><span class="op" id="2433559">,</span>&nbsp;<span class="num" id="2433561">4</span><span class="op" id="2433562">)</span><br>
<span class="lineno"></span><span class="op" id="2433564">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2433567">func</span>&nbsp;<span class="ident" id="2433572">SetsockoptInet4Addr</span><span class="op" id="2433591">(</span><span class="ident" id="2433592">fd</span><span class="op" id="2433594">,</span>&nbsp;<span class="ident" id="2433596">level</span><span class="op" id="2433601">,</span>&nbsp;<span class="ident" id="2433603">opt</span>&nbsp;<span class="builtintype" id="2433607">int</span><span class="op" id="2433610">,</span>&nbsp;<span class="ident" id="2433612">value</span>&nbsp;<span class="op" id="2433618">[</span><span class="num" id="2433619">4</span><span class="op" id="2433620">]</span><span class="builtintype" id="2433621">byte</span><span class="op" id="2433625">)</span>&nbsp;<span class="op" id="2433627">(</span><span class="ident" id="2433628">err</span>&nbsp;<span class="builtintype" id="2433632">error</span><span class="op" id="2433637">)</span>&nbsp;<span class="op" id="2433639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433642">return</span>&nbsp;<span class="ident" id="2433649">setsockopt</span><span class="op" id="2433659">(</span><span class="ident" id="2433660">fd</span><span class="op" id="2433662">,</span>&nbsp;<span class="ident" id="2433664">level</span><span class="op" id="2433669">,</span>&nbsp;<span class="ident" id="2433671">opt</span><span class="op" id="2433674">,</span>&nbsp;<span class="ident" id="2433676">unsafe</span><span class="op" id="2433682">.</span><span class="ident" id="2433683">Pointer</span><span class="op" id="2433690">(</span><span class="op" id="2433691">&amp;</span><span class="ident" id="2433692">value</span><span class="op" id="2433697">[</span><span class="num" id="2433698">0</span><span class="op" id="2433699">]</span><span class="op" id="2433700">)</span><span class="op" id="2433701">,</span>&nbsp;<span class="num" id="2433703">4</span><span class="op" id="2433704">)</span><br>
<span class="lineno"></span><span class="op" id="2433706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2433709">func</span>&nbsp;<span class="ident" id="2433714">SetsockoptIPMreq</span><span class="op" id="2433730">(</span><span class="ident" id="2433731">fd</span><span class="op" id="2433733">,</span>&nbsp;<span class="ident" id="2433735">level</span><span class="op" id="2433740">,</span>&nbsp;<span class="ident" id="2433742">opt</span>&nbsp;<span class="builtintype" id="2433746">int</span><span class="op" id="2433749">,</span>&nbsp;<span class="ident" id="2433751">mreq</span>&nbsp;<span class="op" id="2433756">*</span><span class="ident" id="2433757">IPMreq</span><span class="op" id="2433763">)</span>&nbsp;<span class="op" id="2433765">(</span><span class="ident" id="2433766">err</span>&nbsp;<span class="builtintype" id="2433770">error</span><span class="op" id="2433775">)</span>&nbsp;<span class="op" id="2433777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433780">return</span>&nbsp;<span class="ident" id="2433787">setsockopt</span><span class="op" id="2433797">(</span><span class="ident" id="2433798">fd</span><span class="op" id="2433800">,</span>&nbsp;<span class="ident" id="2433802">level</span><span class="op" id="2433807">,</span>&nbsp;<span class="ident" id="2433809">opt</span><span class="op" id="2433812">,</span>&nbsp;<span class="ident" id="2433814">unsafe</span><span class="op" id="2433820">.</span><span class="ident" id="2433821">Pointer</span><span class="op" id="2433828">(</span><span class="ident" id="2433829">mreq</span><span class="op" id="2433833">)</span><span class="op" id="2433834">,</span>&nbsp;<span class="ident" id="2433836">SizeofIPMreq</span><span class="op" id="2433848">)</span><br>
<span class="lineno"></span><span class="op" id="2433850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433853">func</span>&nbsp;<span class="ident" id="2433858">SetsockoptIPv6Mreq</span><span class="op" id="2433876">(</span><span class="ident" id="2433877">fd</span><span class="op" id="2433879">,</span>&nbsp;<span class="ident" id="2433881">level</span><span class="op" id="2433886">,</span>&nbsp;<span class="ident" id="2433888">opt</span>&nbsp;<span class="builtintype" id="2433892">int</span><span class="op" id="2433895">,</span>&nbsp;<span class="ident" id="2433897">mreq</span>&nbsp;<span class="op" id="2433902">*</span><span class="ident" id="2433903">IPv6Mreq</span><span class="op" id="2433911">)</span>&nbsp;<span class="op" id="2433913">(</span><span class="ident" id="2433914">err</span>&nbsp;<span class="builtintype" id="2433918">error</span><span class="op" id="2433923">)</span>&nbsp;<span class="op" id="2433925">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433928">return</span>&nbsp;<span class="ident" id="2433935">setsockopt</span><span class="op" id="2433945">(</span><span class="ident" id="2433946">fd</span><span class="op" id="2433948">,</span>&nbsp;<span class="ident" id="2433950">level</span><span class="op" id="2433955">,</span>&nbsp;<span class="ident" id="2433957">opt</span><span class="op" id="2433960">,</span>&nbsp;<span class="ident" id="2433962">unsafe</span><span class="op" id="2433968">.</span><span class="ident" id="2433969">Pointer</span><span class="op" id="2433976">(</span><span class="ident" id="2433977">mreq</span><span class="op" id="2433981">)</span><span class="op" id="2433982">,</span>&nbsp;<span class="ident" id="2433984">SizeofIPv6Mreq</span><span class="op" id="2433998">)</span><br>
<span class="lineno"></span><span class="op" id="2434000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434003">func</span>&nbsp;<span class="ident" id="2434008">SetsockoptICMPv6Filter</span><span class="op" id="2434030">(</span><span class="ident" id="2434031">fd</span><span class="op" id="2434033">,</span>&nbsp;<span class="ident" id="2434035">level</span><span class="op" id="2434040">,</span>&nbsp;<span class="ident" id="2434042">opt</span>&nbsp;<span class="builtintype" id="2434046">int</span><span class="op" id="2434049">,</span>&nbsp;<span class="ident" id="2434051">filter</span>&nbsp;<span class="op" id="2434058">*</span><span class="ident" id="2434059">ICMPv6Filter</span><span class="op" id="2434071">)</span>&nbsp;<span class="builtintype" id="2434073">error</span>&nbsp;<span class="op" id="2434079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434082">return</span>&nbsp;<span class="ident" id="2434089">setsockopt</span><span class="op" id="2434099">(</span><span class="ident" id="2434100">fd</span><span class="op" id="2434102">,</span>&nbsp;<span class="ident" id="2434104">level</span><span class="op" id="2434109">,</span>&nbsp;<span class="ident" id="2434111">opt</span><span class="op" id="2434114">,</span>&nbsp;<span class="ident" id="2434116">unsafe</span><span class="op" id="2434122">.</span><span class="ident" id="2434123">Pointer</span><span class="op" id="2434130">(</span><span class="ident" id="2434131">filter</span><span class="op" id="2434137">)</span><span class="op" id="2434138">,</span>&nbsp;<span class="ident" id="2434140">SizeofICMPv6Filter</span><span class="op" id="2434158">)</span><br>
<span class="lineno">260</span><span class="op" id="2434160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434163">func</span>&nbsp;<span class="ident" id="2434168">SetsockoptLinger</span><span class="op" id="2434184">(</span><span class="ident" id="2434185">fd</span><span class="op" id="2434187">,</span>&nbsp;<span class="ident" id="2434189">level</span><span class="op" id="2434194">,</span>&nbsp;<span class="ident" id="2434196">opt</span>&nbsp;<span class="builtintype" id="2434200">int</span><span class="op" id="2434203">,</span>&nbsp;<span class="ident" id="2434205">l</span>&nbsp;<span class="op" id="2434207">*</span><span class="ident" id="2434208">Linger</span><span class="op" id="2434214">)</span>&nbsp;<span class="op" id="2434216">(</span><span class="ident" id="2434217">err</span>&nbsp;<span class="builtintype" id="2434221">error</span><span class="op" id="2434226">)</span>&nbsp;<span class="op" id="2434228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434231">return</span>&nbsp;<span class="ident" id="2434238">setsockopt</span><span class="op" id="2434248">(</span><span class="ident" id="2434249">fd</span><span class="op" id="2434251">,</span>&nbsp;<span class="ident" id="2434253">level</span><span class="op" id="2434258">,</span>&nbsp;<span class="ident" id="2434260">opt</span><span class="op" id="2434263">,</span>&nbsp;<span class="ident" id="2434265">unsafe</span><span class="op" id="2434271">.</span><span class="ident" id="2434272">Pointer</span><span class="op" id="2434279">(</span><span class="ident" id="2434280">l</span><span class="op" id="2434281">)</span><span class="op" id="2434282">,</span>&nbsp;<span class="ident" id="2434284">SizeofLinger</span><span class="op" id="2434296">)</span><br>
<span class="lineno"></span><span class="op" id="2434298">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2434301">func</span>&nbsp;<span class="ident" id="2434306">SetsockoptString</span><span class="op" id="2434322">(</span><span class="ident" id="2434323">fd</span><span class="op" id="2434325">,</span>&nbsp;<span class="ident" id="2434327">level</span><span class="op" id="2434332">,</span>&nbsp;<span class="ident" id="2434334">opt</span>&nbsp;<span class="builtintype" id="2434338">int</span><span class="op" id="2434341">,</span>&nbsp;<span class="ident" id="2434343">s</span>&nbsp;<span class="builtintype" id="2434345">string</span><span class="op" id="2434351">)</span>&nbsp;<span class="op" id="2434353">(</span><span class="ident" id="2434354">err</span>&nbsp;<span class="builtintype" id="2434358">error</span><span class="op" id="2434363">)</span>&nbsp;<span class="op" id="2434365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434368">return</span>&nbsp;<span class="ident" id="2434375">setsockopt</span><span class="op" id="2434385">(</span><span class="ident" id="2434386">fd</span><span class="op" id="2434388">,</span>&nbsp;<span class="ident" id="2434390">level</span><span class="op" id="2434395">,</span>&nbsp;<span class="ident" id="2434397">opt</span><span class="op" id="2434400">,</span>&nbsp;<span class="ident" id="2434402">unsafe</span><span class="op" id="2434408">.</span><span class="ident" id="2434409">Pointer</span><span class="op" id="2434416">(</span><span class="op" id="2434417">&amp;</span><span class="op" id="2434418">[</span><span class="op" id="2434419">]</span><span class="builtintype" id="2434420">byte</span><span class="op" id="2434424">(</span><span class="ident" id="2434425">s</span><span class="op" id="2434426">)</span><span class="op" id="2434427">[</span><span class="num" id="2434428">0</span><span class="op" id="2434429">]</span><span class="op" id="2434430">)</span><span class="op" id="2434431">,</span>&nbsp;<span class="builtintype" id="2434433">uintptr</span><span class="op" id="2434440">(</span><span class="builtinfunc" id="2434441">len</span><span class="op" id="2434444">(</span><span class="ident" id="2434445">s</span><span class="op" id="2434446">)</span><span class="op" id="2434447">)</span><span class="op" id="2434448">)</span><br>
<span class="lineno"></span><span class="op" id="2434450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2434453">func</span>&nbsp;<span class="ident" id="2434458">SetsockoptTimeval</span><span class="op" id="2434475">(</span><span class="ident" id="2434476">fd</span><span class="op" id="2434478">,</span>&nbsp;<span class="ident" id="2434480">level</span><span class="op" id="2434485">,</span>&nbsp;<span class="ident" id="2434487">opt</span>&nbsp;<span class="builtintype" id="2434491">int</span><span class="op" id="2434494">,</span>&nbsp;<span class="ident" id="2434496">tv</span>&nbsp;<span class="op" id="2434499">*</span><span class="ident" id="2434500">Timeval</span><span class="op" id="2434507">)</span>&nbsp;<span class="op" id="2434509">(</span><span class="ident" id="2434510">err</span>&nbsp;<span class="builtintype" id="2434514">error</span><span class="op" id="2434519">)</span>&nbsp;<span class="op" id="2434521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434524">return</span>&nbsp;<span class="ident" id="2434531">setsockopt</span><span class="op" id="2434541">(</span><span class="ident" id="2434542">fd</span><span class="op" id="2434544">,</span>&nbsp;<span class="ident" id="2434546">level</span><span class="op" id="2434551">,</span>&nbsp;<span class="ident" id="2434553">opt</span><span class="op" id="2434556">,</span>&nbsp;<span class="ident" id="2434558">unsafe</span><span class="op" id="2434564">.</span><span class="ident" id="2434565">Pointer</span><span class="op" id="2434572">(</span><span class="ident" id="2434573">tv</span><span class="op" id="2434575">)</span><span class="op" id="2434576">,</span>&nbsp;<span class="ident" id="2434578">unsafe</span><span class="op" id="2434584">.</span><span class="ident" id="2434585">Sizeof</span><span class="op" id="2434591">(</span><span class="op" id="2434592">*</span><span class="ident" id="2434593">tv</span><span class="op" id="2434595">)</span><span class="op" id="2434596">)</span><br>
<span class="lineno"></span><span class="op" id="2434598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434601">func</span>&nbsp;<span class="ident" id="2434606">Socket</span><span class="op" id="2434612">(</span><span class="ident" id="2434613">domain</span><span class="op" id="2434619">,</span>&nbsp;<span class="ident" id="2434621">typ</span><span class="op" id="2434624">,</span>&nbsp;<span class="ident" id="2434626">proto</span>&nbsp;<span class="builtintype" id="2434632">int</span><span class="op" id="2434635">)</span>&nbsp;<span class="op" id="2434637">(</span><span class="ident" id="2434638">fd</span>&nbsp;<span class="builtintype" id="2434641">int</span><span class="op" id="2434644">,</span>&nbsp;<span class="ident" id="2434646">err</span>&nbsp;<span class="builtintype" id="2434650">error</span><span class="op" id="2434655">)</span>&nbsp;<span class="op" id="2434657">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434660">if</span>&nbsp;<span class="ident" id="2434663">domain</span>&nbsp;<span class="op" id="2434670">==</span>&nbsp;<span class="ident" id="2434673">AF_INET6</span>&nbsp;<span class="op" id="2434682">&amp;&amp;</span>&nbsp;<span class="ident" id="2434685">SocketDisableIPv6</span>&nbsp;<span class="op" id="2434703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434707">return</span>&nbsp;<span class="op" id="2434714">-</span><span class="num" id="2434715">1</span><span class="op" id="2434716">,</span>&nbsp;<span class="ident" id="2434718">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434735">fd</span><span class="op" id="2434737">,</span>&nbsp;<span class="ident" id="2434739">err</span>&nbsp;<span class="op" id="2434743">=</span>&nbsp;<span class="ident" id="2434745">socket</span><span class="op" id="2434751">(</span><span class="ident" id="2434752">domain</span><span class="op" id="2434758">,</span>&nbsp;<span class="ident" id="2434760">typ</span><span class="op" id="2434763">,</span>&nbsp;<span class="ident" id="2434765">proto</span><span class="op" id="2434770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434773">return</span><br>
<span class="lineno">280</span><span class="op" id="2434780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434783">func</span>&nbsp;<span class="ident" id="2434788">Socketpair</span><span class="op" id="2434798">(</span><span class="ident" id="2434799">domain</span><span class="op" id="2434805">,</span>&nbsp;<span class="ident" id="2434807">typ</span><span class="op" id="2434810">,</span>&nbsp;<span class="ident" id="2434812">proto</span>&nbsp;<span class="builtintype" id="2434818">int</span><span class="op" id="2434821">)</span>&nbsp;<span class="op" id="2434823">(</span><span class="ident" id="2434824">fd</span>&nbsp;<span class="op" id="2434827">[</span><span class="num" id="2434828">2</span><span class="op" id="2434829">]</span><span class="builtintype" id="2434830">int</span><span class="op" id="2434833">,</span>&nbsp;<span class="ident" id="2434835">err</span>&nbsp;<span class="builtintype" id="2434839">error</span><span class="op" id="2434844">)</span>&nbsp;<span class="op" id="2434846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434849">var</span>&nbsp;<span class="ident" id="2434853">fdx</span>&nbsp;<span class="op" id="2434857">[</span><span class="num" id="2434858">2</span><span class="op" id="2434859">]</span><span class="builtintype" id="2434860">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434867">err</span>&nbsp;<span class="op" id="2434871">=</span>&nbsp;<span class="ident" id="2434873">socketpair</span><span class="op" id="2434883">(</span><span class="ident" id="2434884">domain</span><span class="op" id="2434890">,</span>&nbsp;<span class="ident" id="2434892">typ</span><span class="op" id="2434895">,</span>&nbsp;<span class="ident" id="2434897">proto</span><span class="op" id="2434902">,</span>&nbsp;<span class="op" id="2434904">&amp;</span><span class="ident" id="2434905">fdx</span><span class="op" id="2434908">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434911">if</span>&nbsp;<span class="ident" id="2434914">err</span>&nbsp;<span class="op" id="2434918">==</span>&nbsp;<span class="ident" id="2434921">nil</span>&nbsp;<span class="op" id="2434925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434929">fd</span><span class="op" id="2434931">[</span><span class="num" id="2434932">0</span><span class="op" id="2434933">]</span>&nbsp;<span class="op" id="2434935">=</span>&nbsp;<span class="builtintype" id="2434937">int</span><span class="op" id="2434940">(</span><span class="ident" id="2434941">fdx</span><span class="op" id="2434944">[</span><span class="num" id="2434945">0</span><span class="op" id="2434946">]</span><span class="op" id="2434947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434951">fd</span><span class="op" id="2434953">[</span><span class="num" id="2434954">1</span><span class="op" id="2434955">]</span>&nbsp;<span class="op" id="2434957">=</span>&nbsp;<span class="builtintype" id="2434959">int</span><span class="op" id="2434962">(</span><span class="ident" id="2434963">fdx</span><span class="op" id="2434966">[</span><span class="num" id="2434967">1</span><span class="op" id="2434968">]</span><span class="op" id="2434969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434975">return</span><br>
<span class="lineno">290</span><span class="op" id="2434982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434985">func</span>&nbsp;<span class="ident" id="2434990">Sendfile</span><span class="op" id="2434998">(</span><span class="ident" id="2434999">outfd</span>&nbsp;<span class="builtintype" id="2435005">int</span><span class="op" id="2435008">,</span>&nbsp;<span class="ident" id="2435010">infd</span>&nbsp;<span class="builtintype" id="2435015">int</span><span class="op" id="2435018">,</span>&nbsp;<span class="ident" id="2435020">offset</span>&nbsp;<span class="op" id="2435027">*</span><span class="ident" id="2435028">int64</span><span class="op" id="2435033">,</span>&nbsp;<span class="ident" id="2435035">count</span>&nbsp;<span class="builtintype" id="2435041">int</span><span class="op" id="2435044">)</span>&nbsp;<span class="op" id="2435046">(</span><span class="ident" id="2435047">written</span>&nbsp;<span class="builtintype" id="2435055">int</span><span class="op" id="2435058">,</span>&nbsp;<span class="ident" id="2435060">err</span>&nbsp;<span class="builtintype" id="2435064">error</span><span class="op" id="2435069">)</span>&nbsp;<span class="op" id="2435071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435074">if</span>&nbsp;<span class="ident" id="2435077">raceenabled</span>&nbsp;<span class="op" id="2435089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435093">raceReleaseMerge</span><span class="op" id="2435109">(</span><span class="ident" id="2435110">unsafe</span><span class="op" id="2435116">.</span><span class="ident" id="2435117">Pointer</span><span class="op" id="2435124">(</span><span class="op" id="2435125">&amp;</span><span class="ident" id="2435126">ioSync</span><span class="op" id="2435132">)</span><span class="op" id="2435133">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435139">return</span>&nbsp;<span class="ident" id="2435146">sendfile</span><span class="op" id="2435154">(</span><span class="ident" id="2435155">outfd</span><span class="op" id="2435160">,</span>&nbsp;<span class="ident" id="2435162">infd</span><span class="op" id="2435166">,</span>&nbsp;<span class="ident" id="2435168">offset</span><span class="op" id="2435174">,</span>&nbsp;<span class="ident" id="2435176">count</span><span class="op" id="2435181">)</span><br>
<span class="lineno"></span><span class="op" id="2435183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2435186">var</span>&nbsp;<span class="ident" id="2435190">ioSync</span>&nbsp;<span class="ident" id="2435197">int64</span>
</div>
</body>
</html>
