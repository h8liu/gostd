<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3595180">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3595236">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3595290">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3595341">package</span>&nbsp;<span class="ident" id="3595349">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3595357">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3595419">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3595439">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3595513">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3595541">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3595616">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3595654">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3595723">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3595796">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3595871">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3595923">//</span><br>
<span class="lineno"></span><span class="comment" id="3595926">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3595942">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3596011">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3596090">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3596169">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3596245">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3596324">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3596402">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3596483">import</span>&nbsp;<span class="op" id="3596490">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3596493">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3596503">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3596508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3596511">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3596585">const</span>&nbsp;<span class="op" id="3596591">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596594">MaxVarintLen16</span>&nbsp;<span class="op" id="3596609">=</span>&nbsp;<span class="num" id="3596611">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596614">MaxVarintLen32</span>&nbsp;<span class="op" id="3596629">=</span>&nbsp;<span class="num" id="3596631">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596634">MaxVarintLen64</span>&nbsp;<span class="op" id="3596649">=</span>&nbsp;<span class="num" id="3596651">10</span><br>
<span class="lineno"></span><span class="op" id="3596654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3596657">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3596738">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3596792">func</span>&nbsp;<span class="ident" id="3596797">PutUvarint</span><span class="op" id="3596807">(</span><span class="ident" id="3596808">buf</span>&nbsp;<span class="op" id="3596812">[</span><span class="op" id="3596813">]</span><span class="builtintype" id="3596814">byte</span><span class="op" id="3596818">,</span>&nbsp;<span class="ident" id="3596820">x</span>&nbsp;<span class="ident" id="3596822">uint64</span><span class="op" id="3596828">)</span>&nbsp;<span class="builtintype" id="3596830">int</span>&nbsp;<span class="op" id="3596834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596837">i</span>&nbsp;<span class="op" id="3596839">:=</span>&nbsp;<span class="num" id="3596842">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596845">for</span>&nbsp;<span class="ident" id="3596849">x</span>&nbsp;<span class="op" id="3596851">&gt;=</span>&nbsp;<span class="num" id="3596854">0x80</span>&nbsp;<span class="op" id="3596859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596863">buf</span><span class="op" id="3596866">[</span><span class="ident" id="3596867">i</span><span class="op" id="3596868">]</span>&nbsp;<span class="op" id="3596870">=</span>&nbsp;<span class="builtintype" id="3596872">byte</span><span class="op" id="3596876">(</span><span class="ident" id="3596877">x</span><span class="op" id="3596878">)</span>&nbsp;<span class="op" id="3596880">|</span>&nbsp;<span class="num" id="3596882">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596889">x</span>&nbsp;<span class="op" id="3596891">&gt;&gt;=</span>&nbsp;<span class="num" id="3596895">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596899">i</span><span class="op" id="3596900">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3596904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596907">buf</span><span class="op" id="3596910">[</span><span class="ident" id="3596911">i</span><span class="op" id="3596912">]</span>&nbsp;<span class="op" id="3596914">=</span>&nbsp;<span class="builtintype" id="3596916">byte</span><span class="op" id="3596920">(</span><span class="ident" id="3596921">x</span><span class="op" id="3596922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596925">return</span>&nbsp;<span class="ident" id="3596932">i</span>&nbsp;<span class="op" id="3596934">+</span>&nbsp;<span class="num" id="3596936">1</span><br>
<span class="lineno">50</span><span class="op" id="3596938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3596941">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3597009">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3597077">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3597123">//</span><br>
<span class="lineno"></span><span class="comment" id="3597126">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3597151">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3597199">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3597250">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3597253">func</span>&nbsp;<span class="ident" id="3597258">Uvarint</span><span class="op" id="3597265">(</span><span class="ident" id="3597266">buf</span>&nbsp;<span class="op" id="3597270">[</span><span class="op" id="3597271">]</span><span class="builtintype" id="3597272">byte</span><span class="op" id="3597276">)</span>&nbsp;<span class="op" id="3597278">(</span><span class="ident" id="3597279">uint64</span><span class="op" id="3597285">,</span>&nbsp;<span class="builtintype" id="3597287">int</span><span class="op" id="3597290">)</span>&nbsp;<span class="op" id="3597292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597295">var</span>&nbsp;<span class="ident" id="3597299">x</span>&nbsp;<span class="ident" id="3597301">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597309">var</span>&nbsp;<span class="ident" id="3597313">s</span>&nbsp;<span class="builtintype" id="3597315">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597321">for</span>&nbsp;<span class="ident" id="3597325">i</span><span class="op" id="3597326">,</span>&nbsp;<span class="ident" id="3597328">b</span>&nbsp;<span class="op" id="3597330">:=</span>&nbsp;<span class="keyword" id="3597333">range</span>&nbsp;<span class="ident" id="3597339">buf</span>&nbsp;<span class="op" id="3597343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597347">if</span>&nbsp;<span class="ident" id="3597350">b</span>&nbsp;<span class="op" id="3597352">&lt;</span>&nbsp;<span class="num" id="3597354">0x80</span>&nbsp;<span class="op" id="3597359">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597364">if</span>&nbsp;<span class="ident" id="3597367">i</span>&nbsp;<span class="op" id="3597369">&gt;</span>&nbsp;<span class="num" id="3597371">9</span>&nbsp;<span class="op" id="3597373">||</span>&nbsp;<span class="ident" id="3597376">i</span>&nbsp;<span class="op" id="3597378">==</span>&nbsp;<span class="num" id="3597381">9</span>&nbsp;<span class="op" id="3597383">&amp;&amp;</span>&nbsp;<span class="ident" id="3597386">b</span>&nbsp;<span class="op" id="3597388">&gt;</span>&nbsp;<span class="num" id="3597390">1</span>&nbsp;<span class="op" id="3597392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597398">return</span>&nbsp;<span class="num" id="3597405">0</span><span class="op" id="3597406">,</span>&nbsp;<span class="op" id="3597408">-</span><span class="op" id="3597409">(</span><span class="ident" id="3597410">i</span>&nbsp;<span class="op" id="3597412">+</span>&nbsp;<span class="num" id="3597414">1</span><span class="op" id="3597415">)</span>&nbsp;<span class="comment" id="3597417">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597437">return</span>&nbsp;<span class="ident" id="3597444">x</span>&nbsp;<span class="op" id="3597446">|</span>&nbsp;<span class="ident" id="3597448">uint64</span><span class="op" id="3597454">(</span><span class="ident" id="3597455">b</span><span class="op" id="3597456">)</span><span class="op" id="3597457">&lt;&lt;</span><span class="ident" id="3597459">s</span><span class="op" id="3597460">,</span>&nbsp;<span class="ident" id="3597462">i</span>&nbsp;<span class="op" id="3597464">+</span>&nbsp;<span class="num" id="3597466">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597470">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597474">x</span>&nbsp;<span class="op" id="3597476">|=</span>&nbsp;<span class="ident" id="3597479">uint64</span><span class="op" id="3597485">(</span><span class="ident" id="3597486">b</span><span class="op" id="3597487">&amp;</span><span class="num" id="3597488">0x7f</span><span class="op" id="3597492">)</span>&nbsp;<span class="op" id="3597494">&lt;&lt;</span>&nbsp;<span class="ident" id="3597497">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597501">s</span>&nbsp;<span class="op" id="3597503">+=</span>&nbsp;<span class="num" id="3597506">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597512">return</span>&nbsp;<span class="num" id="3597519">0</span><span class="op" id="3597520">,</span>&nbsp;<span class="num" id="3597522">0</span><br>
<span class="lineno"></span><span class="op" id="3597524">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3597527">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3597607">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3597660">func</span>&nbsp;<span class="ident" id="3597665">PutVarint</span><span class="op" id="3597674">(</span><span class="ident" id="3597675">buf</span>&nbsp;<span class="op" id="3597679">[</span><span class="op" id="3597680">]</span><span class="builtintype" id="3597681">byte</span><span class="op" id="3597685">,</span>&nbsp;<span class="ident" id="3597687">x</span>&nbsp;<span class="ident" id="3597689">int64</span><span class="op" id="3597694">)</span>&nbsp;<span class="builtintype" id="3597696">int</span>&nbsp;<span class="op" id="3597700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597703">ux</span>&nbsp;<span class="op" id="3597706">:=</span>&nbsp;<span class="ident" id="3597709">uint64</span><span class="op" id="3597715">(</span><span class="ident" id="3597716">x</span><span class="op" id="3597717">)</span>&nbsp;<span class="op" id="3597719">&lt;&lt;</span>&nbsp;<span class="num" id="3597722">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597725">if</span>&nbsp;<span class="ident" id="3597728">x</span>&nbsp;<span class="op" id="3597730">&lt;</span>&nbsp;<span class="num" id="3597732">0</span>&nbsp;<span class="op" id="3597734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597738">ux</span>&nbsp;<span class="op" id="3597741">=</span>&nbsp;<span class="op" id="3597743">^</span><span class="ident" id="3597744">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597751">return</span>&nbsp;<span class="ident" id="3597758">PutUvarint</span><span class="op" id="3597768">(</span><span class="ident" id="3597769">buf</span><span class="op" id="3597772">,</span>&nbsp;<span class="ident" id="3597774">ux</span><span class="op" id="3597776">)</span><br>
<span class="lineno"></span><span class="op" id="3597778">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3597781">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3597848">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3597916">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3597981">//</span><br>
<span class="lineno">90</span><span class="comment" id="3597984">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3598009">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3598057">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3598108">//</span><br>
<span class="lineno"></span><span class="keyword" id="3598111">func</span>&nbsp;<span class="ident" id="3598116">Varint</span><span class="op" id="3598122">(</span><span class="ident" id="3598123">buf</span>&nbsp;<span class="op" id="3598127">[</span><span class="op" id="3598128">]</span><span class="builtintype" id="3598129">byte</span><span class="op" id="3598133">)</span>&nbsp;<span class="op" id="3598135">(</span><span class="ident" id="3598136">int64</span><span class="op" id="3598141">,</span>&nbsp;<span class="builtintype" id="3598143">int</span><span class="op" id="3598146">)</span>&nbsp;<span class="op" id="3598148">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598151">ux</span><span class="op" id="3598153">,</span>&nbsp;<span class="ident" id="3598155">n</span>&nbsp;<span class="op" id="3598157">:=</span>&nbsp;<span class="ident" id="3598160">Uvarint</span><span class="op" id="3598167">(</span><span class="ident" id="3598168">buf</span><span class="op" id="3598171">)</span>&nbsp;<span class="comment" id="3598173">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598213">x</span>&nbsp;<span class="op" id="3598215">:=</span>&nbsp;<span class="ident" id="3598218">int64</span><span class="op" id="3598223">(</span><span class="ident" id="3598224">ux</span>&nbsp;<span class="op" id="3598227">&gt;&gt;</span>&nbsp;<span class="num" id="3598230">1</span><span class="op" id="3598231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598234">if</span>&nbsp;<span class="ident" id="3598237">ux</span><span class="op" id="3598239">&amp;</span><span class="num" id="3598240">1</span>&nbsp;<span class="op" id="3598242">!=</span>&nbsp;<span class="num" id="3598245">0</span>&nbsp;<span class="op" id="3598247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598251">x</span>&nbsp;<span class="op" id="3598253">=</span>&nbsp;<span class="op" id="3598255">^</span><span class="ident" id="3598256">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598259">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598262">return</span>&nbsp;<span class="ident" id="3598269">x</span><span class="op" id="3598270">,</span>&nbsp;<span class="ident" id="3598272">n</span><br>
<span class="lineno"></span><span class="op" id="3598274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3598277">var</span>&nbsp;<span class="ident" id="3598281">overflow</span>&nbsp;<span class="op" id="3598290">=</span>&nbsp;<span class="ident" id="3598292">errors</span><span class="op" id="3598298">.</span><span class="ident" id="3598299">New</span><span class="op" id="3598302">(</span><span class="string" id="3598303">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3598346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3598349">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3598433">func</span>&nbsp;<span class="ident" id="3598438">ReadUvarint</span><span class="op" id="3598449">(</span><span class="ident" id="3598450">r</span>&nbsp;<span class="ident" id="3598452">io</span><span class="op" id="3598454">.</span><span class="ident" id="3598455">ByteReader</span><span class="op" id="3598465">)</span>&nbsp;<span class="op" id="3598467">(</span><span class="ident" id="3598468">uint64</span><span class="op" id="3598474">,</span>&nbsp;<span class="builtintype" id="3598476">error</span><span class="op" id="3598481">)</span>&nbsp;<span class="op" id="3598483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598486">var</span>&nbsp;<span class="ident" id="3598490">x</span>&nbsp;<span class="ident" id="3598492">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598500">var</span>&nbsp;<span class="ident" id="3598504">s</span>&nbsp;<span class="builtintype" id="3598506">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598512">for</span>&nbsp;<span class="ident" id="3598516">i</span>&nbsp;<span class="op" id="3598518">:=</span>&nbsp;<span class="num" id="3598521">0</span><span class="op" id="3598522">;</span>&nbsp;<span class="op" id="3598524">;</span>&nbsp;<span class="ident" id="3598526">i</span><span class="op" id="3598527">++</span>&nbsp;<span class="op" id="3598530">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598534">b</span><span class="op" id="3598535">,</span>&nbsp;<span class="ident" id="3598537">err</span>&nbsp;<span class="op" id="3598541">:=</span>&nbsp;<span class="ident" id="3598544">r</span><span class="op" id="3598545">.</span><span class="ident" id="3598546">ReadByte</span><span class="op" id="3598554">(</span><span class="op" id="3598555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598559">if</span>&nbsp;<span class="ident" id="3598562">err</span>&nbsp;<span class="op" id="3598566">!=</span>&nbsp;<span class="ident" id="3598569">nil</span>&nbsp;<span class="op" id="3598573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598578">return</span>&nbsp;<span class="ident" id="3598585">x</span><span class="op" id="3598586">,</span>&nbsp;<span class="ident" id="3598588">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598598">if</span>&nbsp;<span class="ident" id="3598601">b</span>&nbsp;<span class="op" id="3598603">&lt;</span>&nbsp;<span class="num" id="3598605">0x80</span>&nbsp;<span class="op" id="3598610">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598615">if</span>&nbsp;<span class="ident" id="3598618">i</span>&nbsp;<span class="op" id="3598620">&gt;</span>&nbsp;<span class="num" id="3598622">9</span>&nbsp;<span class="op" id="3598624">||</span>&nbsp;<span class="ident" id="3598627">i</span>&nbsp;<span class="op" id="3598629">==</span>&nbsp;<span class="num" id="3598632">9</span>&nbsp;<span class="op" id="3598634">&amp;&amp;</span>&nbsp;<span class="ident" id="3598637">b</span>&nbsp;<span class="op" id="3598639">&gt;</span>&nbsp;<span class="num" id="3598641">1</span>&nbsp;<span class="op" id="3598643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598649">return</span>&nbsp;<span class="ident" id="3598656">x</span><span class="op" id="3598657">,</span>&nbsp;<span class="ident" id="3598659">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598676">return</span>&nbsp;<span class="ident" id="3598683">x</span>&nbsp;<span class="op" id="3598685">|</span>&nbsp;<span class="ident" id="3598687">uint64</span><span class="op" id="3598693">(</span><span class="ident" id="3598694">b</span><span class="op" id="3598695">)</span><span class="op" id="3598696">&lt;&lt;</span><span class="ident" id="3598698">s</span><span class="op" id="3598699">,</span>&nbsp;<span class="ident" id="3598701">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598707">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598711">x</span>&nbsp;<span class="op" id="3598713">|=</span>&nbsp;<span class="ident" id="3598716">uint64</span><span class="op" id="3598722">(</span><span class="ident" id="3598723">b</span><span class="op" id="3598724">&amp;</span><span class="num" id="3598725">0x7f</span><span class="op" id="3598729">)</span>&nbsp;<span class="op" id="3598731">&lt;&lt;</span>&nbsp;<span class="ident" id="3598734">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598738">s</span>&nbsp;<span class="op" id="3598740">+=</span>&nbsp;<span class="num" id="3598743">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598746">}</span><br>
<span class="lineno"></span><span class="op" id="3598748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3598751">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3598832">func</span>&nbsp;<span class="ident" id="3598837">ReadVarint</span><span class="op" id="3598847">(</span><span class="ident" id="3598848">r</span>&nbsp;<span class="ident" id="3598850">io</span><span class="op" id="3598852">.</span><span class="ident" id="3598853">ByteReader</span><span class="op" id="3598863">)</span>&nbsp;<span class="op" id="3598865">(</span><span class="ident" id="3598866">int64</span><span class="op" id="3598871">,</span>&nbsp;<span class="builtintype" id="3598873">error</span><span class="op" id="3598878">)</span>&nbsp;<span class="op" id="3598880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598883">ux</span><span class="op" id="3598885">,</span>&nbsp;<span class="ident" id="3598887">err</span>&nbsp;<span class="op" id="3598891">:=</span>&nbsp;<span class="ident" id="3598894">ReadUvarint</span><span class="op" id="3598905">(</span><span class="ident" id="3598906">r</span><span class="op" id="3598907">)</span>&nbsp;<span class="comment" id="3598909">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598949">x</span>&nbsp;<span class="op" id="3598951">:=</span>&nbsp;<span class="ident" id="3598954">int64</span><span class="op" id="3598959">(</span><span class="ident" id="3598960">ux</span>&nbsp;<span class="op" id="3598963">&gt;&gt;</span>&nbsp;<span class="num" id="3598966">1</span><span class="op" id="3598967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598970">if</span>&nbsp;<span class="ident" id="3598973">ux</span><span class="op" id="3598975">&amp;</span><span class="num" id="3598976">1</span>&nbsp;<span class="op" id="3598978">!=</span>&nbsp;<span class="num" id="3598981">0</span>&nbsp;<span class="op" id="3598983">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598987">x</span>&nbsp;<span class="op" id="3598989">=</span>&nbsp;<span class="op" id="3598991">^</span><span class="ident" id="3598992">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598998">return</span>&nbsp;<span class="ident" id="3599005">x</span><span class="op" id="3599006">,</span>&nbsp;<span class="ident" id="3599008">err</span><br>
<span class="lineno"></span><span class="op" id="3599012">}</span>
</div>
</body>
</html>
