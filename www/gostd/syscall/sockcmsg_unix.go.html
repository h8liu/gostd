<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html" class="current">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2395085">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2395141">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2395195">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2395246">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2395311">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2395339">package</span>&nbsp;<span class="ident" id="2395347">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2395356">import</span>&nbsp;<span class="string" id="2395363">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2395373">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2395436">func</span>&nbsp;<span class="ident" id="2395441">cmsgAlignOf</span><span class="op" id="2395452">(</span><span class="ident" id="2395453">salen</span>&nbsp;<span class="builtintype" id="2395459">int</span><span class="op" id="2395462">)</span>&nbsp;<span class="builtintype" id="2395464">int</span>&nbsp;<span class="op" id="2395468">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2395471">salign</span>&nbsp;<span class="op" id="2395478">:=</span>&nbsp;<span class="ident" id="2395481">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2395492">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2395556">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2395618">if</span>&nbsp;<span class="ident" id="2395621">darwin64Bit</span>&nbsp;<span class="op" id="2395633">||</span>&nbsp;<span class="ident" id="2395636">dragonfly64Bit</span>&nbsp;<span class="op" id="2395651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2395655">salign</span>&nbsp;<span class="op" id="2395662">=</span>&nbsp;<span class="num" id="2395664">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2395667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2395670">return</span>&nbsp;<span class="op" id="2395677">(</span><span class="ident" id="2395678">salen</span>&nbsp;<span class="op" id="2395684">+</span>&nbsp;<span class="ident" id="2395686">salign</span>&nbsp;<span class="op" id="2395693">-</span>&nbsp;<span class="num" id="2395695">1</span><span class="op" id="2395696">)</span>&nbsp;<span class="op" id="2395698">&amp;</span>&nbsp;<span class="op" id="2395700">^</span><span class="op" id="2395701">(</span><span class="ident" id="2395702">salign</span>&nbsp;<span class="op" id="2395709">-</span>&nbsp;<span class="num" id="2395711">1</span><span class="op" id="2395712">)</span><br>
<span class="lineno"></span><span class="op" id="2395714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2395717">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2395787">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2395846">func</span>&nbsp;<span class="ident" id="2395851">CmsgLen</span><span class="op" id="2395858">(</span><span class="ident" id="2395859">datalen</span>&nbsp;<span class="builtintype" id="2395867">int</span><span class="op" id="2395870">)</span>&nbsp;<span class="builtintype" id="2395872">int</span>&nbsp;<span class="op" id="2395876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2395879">return</span>&nbsp;<span class="ident" id="2395886">cmsgAlignOf</span><span class="op" id="2395897">(</span><span class="ident" id="2395898">SizeofCmsghdr</span><span class="op" id="2395911">)</span>&nbsp;<span class="op" id="2395913">+</span>&nbsp;<span class="ident" id="2395915">datalen</span><br>
<span class="lineno"></span><span class="op" id="2395923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2395926">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2395993">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2396040">func</span>&nbsp;<span class="ident" id="2396045">CmsgSpace</span><span class="op" id="2396054">(</span><span class="ident" id="2396055">datalen</span>&nbsp;<span class="builtintype" id="2396063">int</span><span class="op" id="2396066">)</span>&nbsp;<span class="builtintype" id="2396068">int</span>&nbsp;<span class="op" id="2396072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396075">return</span>&nbsp;<span class="ident" id="2396082">cmsgAlignOf</span><span class="op" id="2396093">(</span><span class="ident" id="2396094">SizeofCmsghdr</span><span class="op" id="2396107">)</span>&nbsp;<span class="op" id="2396109">+</span>&nbsp;<span class="ident" id="2396111">cmsgAlignOf</span><span class="op" id="2396122">(</span><span class="ident" id="2396123">datalen</span><span class="op" id="2396130">)</span><br>
<span class="lineno"></span><span class="op" id="2396132">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2396135">func</span>&nbsp;<span class="ident" id="2396140">cmsgData</span><span class="op" id="2396148">(</span><span class="ident" id="2396149">h</span>&nbsp;<span class="op" id="2396151">*</span><span class="ident" id="2396152">Cmsghdr</span><span class="op" id="2396159">)</span>&nbsp;<span class="ident" id="2396161">unsafe</span><span class="op" id="2396167">.</span><span class="ident" id="2396168">Pointer</span>&nbsp;<span class="op" id="2396176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396179">return</span>&nbsp;<span class="ident" id="2396186">unsafe</span><span class="op" id="2396192">.</span><span class="ident" id="2396193">Pointer</span><span class="op" id="2396200">(</span><span class="builtintype" id="2396201">uintptr</span><span class="op" id="2396208">(</span><span class="ident" id="2396209">unsafe</span><span class="op" id="2396215">.</span><span class="ident" id="2396216">Pointer</span><span class="op" id="2396223">(</span><span class="ident" id="2396224">h</span><span class="op" id="2396225">)</span><span class="op" id="2396226">)</span>&nbsp;<span class="op" id="2396228">+</span>&nbsp;<span class="builtintype" id="2396230">uintptr</span><span class="op" id="2396237">(</span><span class="ident" id="2396238">cmsgAlignOf</span><span class="op" id="2396249">(</span><span class="ident" id="2396250">SizeofCmsghdr</span><span class="op" id="2396263">)</span><span class="op" id="2396264">)</span><span class="op" id="2396265">)</span><br>
<span class="lineno"></span><span class="op" id="2396267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2396270">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2396331">type</span>&nbsp;<span class="ident" id="2396336">SocketControlMessage</span>&nbsp;<span class="keyword" id="2396357">struct</span>&nbsp;<span class="op" id="2396364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396367">Header</span>&nbsp;<span class="ident" id="2396374">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396383">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2396390">[</span><span class="op" id="2396391">]</span><span class="builtintype" id="2396392">byte</span><br>
<span class="lineno"></span><span class="op" id="2396397">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2396400">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2396468">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2396481">func</span>&nbsp;<span class="ident" id="2396486">ParseSocketControlMessage</span><span class="op" id="2396511">(</span><span class="ident" id="2396512">b</span>&nbsp;<span class="op" id="2396514">[</span><span class="op" id="2396515">]</span><span class="builtintype" id="2396516">byte</span><span class="op" id="2396520">)</span>&nbsp;<span class="op" id="2396522">(</span><span class="op" id="2396523">[</span><span class="op" id="2396524">]</span><span class="ident" id="2396525">SocketControlMessage</span><span class="op" id="2396545">,</span>&nbsp;<span class="builtintype" id="2396547">error</span><span class="op" id="2396552">)</span>&nbsp;<span class="op" id="2396554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396557">var</span>&nbsp;<span class="ident" id="2396561">msgs</span>&nbsp;<span class="op" id="2396566">[</span><span class="op" id="2396567">]</span><span class="ident" id="2396568">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396590">i</span>&nbsp;<span class="op" id="2396592">:=</span>&nbsp;<span class="num" id="2396595">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396598">for</span>&nbsp;<span class="ident" id="2396602">i</span><span class="op" id="2396603">+</span><span class="ident" id="2396604">CmsgLen</span><span class="op" id="2396611">(</span><span class="num" id="2396612">0</span><span class="op" id="2396613">)</span>&nbsp;<span class="op" id="2396615">&lt;=</span>&nbsp;<span class="builtinfunc" id="2396618">len</span><span class="op" id="2396621">(</span><span class="ident" id="2396622">b</span><span class="op" id="2396623">)</span>&nbsp;<span class="op" id="2396625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396629">h</span><span class="op" id="2396630">,</span>&nbsp;<span class="ident" id="2396632">dbuf</span><span class="op" id="2396636">,</span>&nbsp;<span class="ident" id="2396638">err</span>&nbsp;<span class="op" id="2396642">:=</span>&nbsp;<span class="ident" id="2396645">socketControlMessageHeaderAndData</span><span class="op" id="2396678">(</span><span class="ident" id="2396679">b</span><span class="op" id="2396680">[</span><span class="ident" id="2396681">i</span><span class="op" id="2396682">:</span><span class="op" id="2396683">]</span><span class="op" id="2396684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396688">if</span>&nbsp;<span class="ident" id="2396691">err</span>&nbsp;<span class="op" id="2396695">!=</span>&nbsp;<span class="ident" id="2396698">nil</span>&nbsp;<span class="op" id="2396702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396707">return</span>&nbsp;<span class="ident" id="2396714">nil</span><span class="op" id="2396717">,</span>&nbsp;<span class="ident" id="2396719">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2396725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396729">m</span>&nbsp;<span class="op" id="2396731">:=</span>&nbsp;<span class="ident" id="2396734">SocketControlMessage</span><span class="op" id="2396754">{</span><span class="ident" id="2396755">Header</span><span class="op" id="2396761">:</span>&nbsp;<span class="op" id="2396763">*</span><span class="ident" id="2396764">h</span><span class="op" id="2396765">,</span>&nbsp;<span class="ident" id="2396767">Data</span><span class="op" id="2396771">:</span>&nbsp;<span class="ident" id="2396773">dbuf</span><span class="op" id="2396777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396781">msgs</span>&nbsp;<span class="op" id="2396786">=</span>&nbsp;<span class="builtinfunc" id="2396788">append</span><span class="op" id="2396794">(</span><span class="ident" id="2396795">msgs</span><span class="op" id="2396799">,</span>&nbsp;<span class="ident" id="2396801">m</span><span class="op" id="2396802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396806">i</span>&nbsp;<span class="op" id="2396808">+=</span>&nbsp;<span class="ident" id="2396811">cmsgAlignOf</span><span class="op" id="2396822">(</span><span class="builtintype" id="2396823">int</span><span class="op" id="2396826">(</span><span class="ident" id="2396827">h</span><span class="op" id="2396828">.</span><span class="ident" id="2396829">Len</span><span class="op" id="2396832">)</span><span class="op" id="2396833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2396836">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396839">return</span>&nbsp;<span class="ident" id="2396846">msgs</span><span class="op" id="2396850">,</span>&nbsp;<span class="ident" id="2396852">nil</span><br>
<span class="lineno"></span><span class="op" id="2396856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2396859">func</span>&nbsp;<span class="ident" id="2396864">socketControlMessageHeaderAndData</span><span class="op" id="2396897">(</span><span class="ident" id="2396898">b</span>&nbsp;<span class="op" id="2396900">[</span><span class="op" id="2396901">]</span><span class="builtintype" id="2396902">byte</span><span class="op" id="2396906">)</span>&nbsp;<span class="op" id="2396908">(</span><span class="op" id="2396909">*</span><span class="ident" id="2396910">Cmsghdr</span><span class="op" id="2396917">,</span>&nbsp;<span class="op" id="2396919">[</span><span class="op" id="2396920">]</span><span class="builtintype" id="2396921">byte</span><span class="op" id="2396925">,</span>&nbsp;<span class="builtintype" id="2396927">error</span><span class="op" id="2396932">)</span>&nbsp;<span class="op" id="2396934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2396937">h</span>&nbsp;<span class="op" id="2396939">:=</span>&nbsp;<span class="op" id="2396942">(</span><span class="op" id="2396943">*</span><span class="ident" id="2396944">Cmsghdr</span><span class="op" id="2396951">)</span><span class="op" id="2396952">(</span><span class="ident" id="2396953">unsafe</span><span class="op" id="2396959">.</span><span class="ident" id="2396960">Pointer</span><span class="op" id="2396967">(</span><span class="op" id="2396968">&amp;</span><span class="ident" id="2396969">b</span><span class="op" id="2396970">[</span><span class="num" id="2396971">0</span><span class="op" id="2396972">]</span><span class="op" id="2396973">)</span><span class="op" id="2396974">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2396977">if</span>&nbsp;<span class="ident" id="2396980">h</span><span class="op" id="2396981">.</span><span class="ident" id="2396982">Len</span>&nbsp;<span class="op" id="2396986">&lt;</span>&nbsp;<span class="ident" id="2396988">SizeofCmsghdr</span>&nbsp;<span class="op" id="2397002">||</span>&nbsp;<span class="builtintype" id="2397005">int</span><span class="op" id="2397008">(</span><span class="ident" id="2397009">h</span><span class="op" id="2397010">.</span><span class="ident" id="2397011">Len</span><span class="op" id="2397014">)</span>&nbsp;<span class="op" id="2397016">&gt;</span>&nbsp;<span class="builtinfunc" id="2397018">len</span><span class="op" id="2397021">(</span><span class="ident" id="2397022">b</span><span class="op" id="2397023">)</span>&nbsp;<span class="op" id="2397025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397029">return</span>&nbsp;<span class="ident" id="2397036">nil</span><span class="op" id="2397039">,</span>&nbsp;<span class="ident" id="2397041">nil</span><span class="op" id="2397044">,</span>&nbsp;<span class="ident" id="2397046">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2397054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397057">return</span>&nbsp;<span class="ident" id="2397064">h</span><span class="op" id="2397065">,</span>&nbsp;<span class="ident" id="2397067">b</span><span class="op" id="2397068">[</span><span class="ident" id="2397069">cmsgAlignOf</span><span class="op" id="2397080">(</span><span class="ident" id="2397081">SizeofCmsghdr</span><span class="op" id="2397094">)</span><span class="op" id="2397095">:</span><span class="ident" id="2397096">h</span><span class="op" id="2397097">.</span><span class="ident" id="2397098">Len</span><span class="op" id="2397101">]</span><span class="op" id="2397102">,</span>&nbsp;<span class="ident" id="2397104">nil</span><br>
<span class="lineno"></span><span class="op" id="2397108">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2397111">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2397178">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2397229">func</span>&nbsp;<span class="ident" id="2397234">UnixRights</span><span class="op" id="2397244">(</span><span class="ident" id="2397245">fds</span>&nbsp;<span class="op" id="2397249">...</span><span class="builtintype" id="2397252">int</span><span class="op" id="2397255">)</span>&nbsp;<span class="op" id="2397257">[</span><span class="op" id="2397258">]</span><span class="builtintype" id="2397259">byte</span>&nbsp;<span class="op" id="2397264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397267">datalen</span>&nbsp;<span class="op" id="2397275">:=</span>&nbsp;<span class="builtinfunc" id="2397278">len</span><span class="op" id="2397281">(</span><span class="ident" id="2397282">fds</span><span class="op" id="2397285">)</span>&nbsp;<span class="op" id="2397287">*</span>&nbsp;<span class="num" id="2397289">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397292">b</span>&nbsp;<span class="op" id="2397294">:=</span>&nbsp;<span class="builtinfunc" id="2397297">make</span><span class="op" id="2397301">(</span><span class="op" id="2397302">[</span><span class="op" id="2397303">]</span><span class="builtintype" id="2397304">byte</span><span class="op" id="2397308">,</span>&nbsp;<span class="ident" id="2397310">CmsgSpace</span><span class="op" id="2397319">(</span><span class="ident" id="2397320">datalen</span><span class="op" id="2397327">)</span><span class="op" id="2397328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397331">h</span>&nbsp;<span class="op" id="2397333">:=</span>&nbsp;<span class="op" id="2397336">(</span><span class="op" id="2397337">*</span><span class="ident" id="2397338">Cmsghdr</span><span class="op" id="2397345">)</span><span class="op" id="2397346">(</span><span class="ident" id="2397347">unsafe</span><span class="op" id="2397353">.</span><span class="ident" id="2397354">Pointer</span><span class="op" id="2397361">(</span><span class="op" id="2397362">&amp;</span><span class="ident" id="2397363">b</span><span class="op" id="2397364">[</span><span class="num" id="2397365">0</span><span class="op" id="2397366">]</span><span class="op" id="2397367">)</span><span class="op" id="2397368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397371">h</span><span class="op" id="2397372">.</span><span class="ident" id="2397373">Level</span>&nbsp;<span class="op" id="2397379">=</span>&nbsp;<span class="ident" id="2397381">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397393">h</span><span class="op" id="2397394">.</span><span class="ident" id="2397395">Type</span>&nbsp;<span class="op" id="2397400">=</span>&nbsp;<span class="ident" id="2397402">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397414">h</span><span class="op" id="2397415">.</span><span class="ident" id="2397416">SetLen</span><span class="op" id="2397422">(</span><span class="ident" id="2397423">CmsgLen</span><span class="op" id="2397430">(</span><span class="ident" id="2397431">datalen</span><span class="op" id="2397438">)</span><span class="op" id="2397439">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397442">data</span>&nbsp;<span class="op" id="2397447">:=</span>&nbsp;<span class="builtintype" id="2397450">uintptr</span><span class="op" id="2397457">(</span><span class="ident" id="2397458">cmsgData</span><span class="op" id="2397466">(</span><span class="ident" id="2397467">h</span><span class="op" id="2397468">)</span><span class="op" id="2397469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397472">for</span>&nbsp;<span class="ident" id="2397476">_</span><span class="op" id="2397477">,</span>&nbsp;<span class="ident" id="2397479">fd</span>&nbsp;<span class="op" id="2397482">:=</span>&nbsp;<span class="keyword" id="2397485">range</span>&nbsp;<span class="ident" id="2397491">fds</span>&nbsp;<span class="op" id="2397495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2397499">*</span><span class="op" id="2397500">(</span><span class="op" id="2397501">*</span><span class="builtintype" id="2397502">int32</span><span class="op" id="2397507">)</span><span class="op" id="2397508">(</span><span class="ident" id="2397509">unsafe</span><span class="op" id="2397515">.</span><span class="ident" id="2397516">Pointer</span><span class="op" id="2397523">(</span><span class="ident" id="2397524">data</span><span class="op" id="2397528">)</span><span class="op" id="2397529">)</span>&nbsp;<span class="op" id="2397531">=</span>&nbsp;<span class="builtintype" id="2397533">int32</span><span class="op" id="2397538">(</span><span class="ident" id="2397539">fd</span><span class="op" id="2397541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397545">data</span>&nbsp;<span class="op" id="2397550">+=</span>&nbsp;<span class="num" id="2397553">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2397556">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397559">return</span>&nbsp;<span class="ident" id="2397566">b</span><br>
<span class="lineno"></span><span class="op" id="2397568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2397571">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2397640">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2397704">func</span>&nbsp;<span class="ident" id="2397709">ParseUnixRights</span><span class="op" id="2397724">(</span><span class="ident" id="2397725">m</span>&nbsp;<span class="op" id="2397727">*</span><span class="ident" id="2397728">SocketControlMessage</span><span class="op" id="2397748">)</span>&nbsp;<span class="op" id="2397750">(</span><span class="op" id="2397751">[</span><span class="op" id="2397752">]</span><span class="builtintype" id="2397753">int</span><span class="op" id="2397756">,</span>&nbsp;<span class="builtintype" id="2397758">error</span><span class="op" id="2397763">)</span>&nbsp;<span class="op" id="2397765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397768">if</span>&nbsp;<span class="ident" id="2397771">m</span><span class="op" id="2397772">.</span><span class="ident" id="2397773">Header</span><span class="op" id="2397779">.</span><span class="ident" id="2397780">Level</span>&nbsp;<span class="op" id="2397786">!=</span>&nbsp;<span class="ident" id="2397789">SOL_SOCKET</span>&nbsp;<span class="op" id="2397800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397804">return</span>&nbsp;<span class="ident" id="2397811">nil</span><span class="op" id="2397814">,</span>&nbsp;<span class="ident" id="2397816">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2397824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397827">if</span>&nbsp;<span class="ident" id="2397830">m</span><span class="op" id="2397831">.</span><span class="ident" id="2397832">Header</span><span class="op" id="2397838">.</span><span class="ident" id="2397839">Type</span>&nbsp;<span class="op" id="2397844">!=</span>&nbsp;<span class="ident" id="2397847">SCM_RIGHTS</span>&nbsp;<span class="op" id="2397858">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397862">return</span>&nbsp;<span class="ident" id="2397869">nil</span><span class="op" id="2397872">,</span>&nbsp;<span class="ident" id="2397874">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2397882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397885">fds</span>&nbsp;<span class="op" id="2397889">:=</span>&nbsp;<span class="builtinfunc" id="2397892">make</span><span class="op" id="2397896">(</span><span class="op" id="2397897">[</span><span class="op" id="2397898">]</span><span class="builtintype" id="2397899">int</span><span class="op" id="2397902">,</span>&nbsp;<span class="builtinfunc" id="2397904">len</span><span class="op" id="2397907">(</span><span class="ident" id="2397908">m</span><span class="op" id="2397909">.</span><span class="ident" id="2397910">Data</span><span class="op" id="2397914">)</span><span class="op" id="2397915">&gt;&gt;</span><span class="num" id="2397917">2</span><span class="op" id="2397918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2397921">for</span>&nbsp;<span class="ident" id="2397925">i</span><span class="op" id="2397926">,</span>&nbsp;<span class="ident" id="2397928">j</span>&nbsp;<span class="op" id="2397930">:=</span>&nbsp;<span class="num" id="2397933">0</span><span class="op" id="2397934">,</span>&nbsp;<span class="num" id="2397936">0</span><span class="op" id="2397937">;</span>&nbsp;<span class="ident" id="2397939">i</span>&nbsp;<span class="op" id="2397941">&lt;</span>&nbsp;<span class="builtinfunc" id="2397943">len</span><span class="op" id="2397946">(</span><span class="ident" id="2397947">m</span><span class="op" id="2397948">.</span><span class="ident" id="2397949">Data</span><span class="op" id="2397953">)</span><span class="op" id="2397954">;</span>&nbsp;<span class="ident" id="2397956">i</span>&nbsp;<span class="op" id="2397958">+=</span>&nbsp;<span class="num" id="2397961">4</span>&nbsp;<span class="op" id="2397963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2397967">fds</span><span class="op" id="2397970">[</span><span class="ident" id="2397971">j</span><span class="op" id="2397972">]</span>&nbsp;<span class="op" id="2397974">=</span>&nbsp;<span class="builtintype" id="2397976">int</span><span class="op" id="2397979">(</span><span class="op" id="2397980">*</span><span class="op" id="2397981">(</span><span class="op" id="2397982">*</span><span class="builtintype" id="2397983">int32</span><span class="op" id="2397988">)</span><span class="op" id="2397989">(</span><span class="ident" id="2397990">unsafe</span><span class="op" id="2397996">.</span><span class="ident" id="2397997">Pointer</span><span class="op" id="2398004">(</span><span class="op" id="2398005">&amp;</span><span class="ident" id="2398006">m</span><span class="op" id="2398007">.</span><span class="ident" id="2398008">Data</span><span class="op" id="2398012">[</span><span class="ident" id="2398013">i</span><span class="op" id="2398014">]</span><span class="op" id="2398015">)</span><span class="op" id="2398016">)</span><span class="op" id="2398017">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2398021">j</span><span class="op" id="2398022">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2398026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2398029">return</span>&nbsp;<span class="ident" id="2398036">fds</span><span class="op" id="2398039">,</span>&nbsp;<span class="ident" id="2398041">nil</span><br>
<span class="lineno"></span><span class="op" id="2398045">}</span>
</div>
</body>
</html>
